function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.496884412231514e-01   +2.534574106869150e-01   -1.568214241985698e-01   +2.175994232925345e-01   +9.630578944522178e-02   -1.295690862618905e-01   +3.779508242894455e-02   +4.033674691456741e-02   +1.324856616884711e-01   +8.886448103802902e-02   -1.010220969469557e-01   +2.057653975376760e-01   +2.947843352926555e-03   -2.005187358697393e-03   -1.717912415978272e-01   -4.378509867725947e-01; +3.427872686394641e-01   +1.881679239951939e-01   +1.978964213155752e-01   -2.303720572798222e-01   -3.375491031039448e-01   +1.717503884763367e-01   -2.070206252796545e-01   +1.802565425052343e-01   +5.966999007281687e-02   +1.169479056708789e-01   -1.208198985345734e-01   -3.110263532771480e-01   -3.467255478410012e-01   -1.697253123381334e-01   +2.128793670910557e-01   -1.665723623201281e-01; +5.733379461006824e-02   -9.793588127600006e-02   +1.547829464389525e-02   +9.391584778710536e-02   +1.706420934991830e-01   -1.985654692025104e-01   +8.174213342589721e-02   +9.935336799482958e-02   -1.162916673719804e-01   -4.595668134078788e-02   +5.081054320938846e-02   -3.671280203505685e-01   -2.661035044203811e-01   +6.636407397137248e-02   -1.154471649961405e-01   -4.061162460818879e-02; -4.803589461580909e-01   +2.046688051733211e-01   +2.524298227960935e-01   -1.308043498060794e-01   +1.031406286190429e-01   -3.535678813460434e-01   +8.328452719352307e-02   +1.781929400558416e-01   +1.968336996635636e-04   +1.399119555751747e-01   +2.055993184868242e-01   -1.404226460604162e-01   -3.175847454324933e-01   +6.523108069176142e-02   +2.088274170035118e-01   +4.457861463684075e-01; +7.598353919419817e-02   -7.752998145242669e-02   -7.971616307634655e-02   -1.087490139188912e-01   +3.406500803795022e-01   -2.256645732750485e-01   +3.569335710889203e-01   +1.239948506318045e-01   +9.104621018487644e-02   -1.821851983278222e-03   +3.983821842617323e-01   +6.650302088941555e-02   +2.053383875708573e-02   -2.113451001185484e-01   +1.175716641665324e-01   -1.479900347472333e-01; -3.453260846738446e-02   -1.044288429878753e-01   -3.183561822294824e-01   -2.100186487623142e-01   -7.882608145838323e-03   +1.914873041359476e-01   -1.861411814313717e-01   +3.093343880757876e-02   -1.057799086910728e-01   -2.707718917839635e-03   -3.787902150993542e-01   -1.680919985594886e-01   -2.222494166527146e-01   +7.617945319039870e-02   +2.651971075573808e-01   -2.011721218839156e-01; +6.348982280704236e-02   -2.988001198476101e-01   -7.280200037905823e-02   +2.777438835567101e-01   -3.783095412679599e-02   +4.734559717184487e-01   +2.871981498781606e-02   -2.640988719187717e-01   -4.659969760733124e-01   -1.174469978332591e-01   -4.433180861100483e-01   +8.738103196172320e-02   +3.510878327175533e-01   -2.668245133304326e-03   +2.400158493848096e-01   -2.650016585021525e-01; -2.618025168538818e-02   -6.757829126113574e-02   -7.086194616846354e-02   -1.817624815003302e-02   -4.789231036522908e-01   +2.150799014638548e-01   +6.935820156127713e-02   -2.162708044650156e-01   +8.818121506616915e-02   +2.196462270477891e-01   -1.786248319144356e-02   +1.141967492815794e-01   +2.444325128278333e-01   -2.189727511278962e-01   +1.078291979664279e-01   -2.518219413489614e-02; +1.874495469275843e-01   +2.120640359431497e-02   +1.994746974608869e-01   -1.063253473914863e-01   +1.483588170436920e-02   -2.377578839710437e-01   -1.126497280719783e-01   +3.609050546399690e-01   +1.004844740481327e-01   -2.230948419994124e-01   -4.626349161664679e-01   -3.879456166000104e-01   +2.365834052265156e-01   -2.700715640897378e-01   -4.054917094789678e-02   -2.601857019680952e-02; +2.759008690962524e-01   -2.043803114147031e-01   +8.328333037576428e-02   -3.365111103183620e-01   +2.098609408635646e-01   -8.233463693206157e-02   +9.277168554640360e-02   -2.423038793479643e-01   +6.072021465748963e-02   +1.162901649248320e-01   +2.091218550938193e-01   +7.478221636730353e-02   -3.802485598444452e-02   -1.620371388174322e-01   +3.640138902175589e-01   +2.056229923360903e-01; +1.028108226005987e-01   -4.561196771881209e-01   +6.000109483868851e-02   -7.820959161328225e-02   +1.994647938041583e-01   +4.641470858498671e-01   +4.281258731723723e-01   +9.113221898717633e-04   -3.362378932743264e-01   -8.949486525056977e-03   +4.009499501446392e-01   +2.012034971163468e-01   -4.604453250744793e-02   -5.224971522623507e-02   +7.642376100028136e-02   +2.584399219132348e-01; -1.071773810831067e-01   -7.721091471877028e-02   +3.780323493984457e-02   +4.793767783531107e-01   -4.197053632076686e-01   +1.355545432713591e-01   -6.920351094221122e-03   -1.229518298290581e-01   +1.947896969896691e-01   +5.322861614302569e-02   -1.214323468350316e-01   +1.480089975838114e-01   -1.293994777705731e-01   +4.024661793654283e-02   -9.103031382811261e-02   +2.688110118894531e-01; -3.927505400215689e-02   -5.181483766546745e-02   +9.641575633392363e-02   -3.239906114079162e-01   +7.342129079839319e-02   -2.775188714730057e-01   -3.008817180681918e-01   -3.359872803989798e-02   +1.655296970483913e-02   -1.809028953739273e-01   +4.340240870283635e-02   -4.337256850021072e-01   -2.615233303956954e-01   -4.087424384910191e-01   +3.385597444800675e-01   +2.511799252741126e-01; +2.621986872653634e-01   -2.092206800630593e-02   +3.341080102710567e-02   -1.457895763876156e-01   +1.511679178506504e-01   +1.448785362247347e-01   +2.236378445647627e-01   -9.189715994940290e-02   +9.323894449445538e-02   -9.750182128809300e-02   +1.147336788482676e-01   +1.609331691848068e-01   +1.421423425563612e-01   +1.333830458671073e-01   -6.072068288862586e-02   -8.041469290723223e-02; -1.849558136251620e-01   +4.052808071107324e-01   +2.759742216451171e-01   -2.901050052618883e-01   -2.656251329984103e-01   -3.699619962698186e-01   +1.706871348603869e-01   +2.949591420859058e-01   +2.183418237048635e-01   +5.277269383553795e-02   +2.598152564906772e-01   -1.305358410011448e-04   -4.194081656655314e-01   -6.252316617059027e-02   +9.246556882623563e-02   -3.417815541443096e-02; -4.882621891676512e-01   -1.232891710624463e-01   +2.782530003616608e-01   +3.087269158055389e-02   -1.741920021182262e-01   +1.780596472886255e-01   -5.274005525162558e-02   -1.250863629795791e-01   -2.299697433114464e-02   +1.746352032690004e-01   +3.588252909261345e-01   -5.637798115409622e-02   +8.114787189449302e-03   -2.372397936917490e-01   -5.517510859490798e-02   +2.051752580826234e-01];
L1E_L1I_iGABA_netcon = [-4.211763447380316e-01   +1.236456702038749e-01   +1.099772901089657e-01   -2.275006002310255e-01   +2.004784987579596e-02   +2.250662664047105e-02   +8.360641589779996e-02   -5.412597480502110e-02   +9.812345332621812e-02   -1.531565807616592e-01   +2.288898152868793e-01   -3.454572630373056e-02   -2.547148194157887e-01   -1.489202696494857e-01   -2.265447883219206e-01   +9.475019879260731e-02; +1.415492771160748e-01   +1.572207711026418e-02   -2.141801759978429e-01   -4.705231433416124e-01   +1.001960170554200e-01   +1.160469997281482e-01   +4.692442660107650e-02   +1.896570187789526e-01   +5.188867412166825e-02   -3.420947895920209e-02   +9.444091086841026e-02   -3.925379623021334e-01   -4.849731598000039e-01   +4.516697276266932e-02   -1.051231802699395e-01   +1.828781690131341e-01; +3.359668437272221e-01   +3.235462326035125e-01   +9.030358920351492e-02   -1.631448080273305e-01   -2.435732570046828e-02   -3.931084738080257e-01   +1.901782756332018e-01   -3.268440581380181e-01   -1.357177143062634e-01   +1.599976192432744e-01   -1.869285564719785e-01   -3.161196413397334e-01   -5.853684520090927e-03   -2.365414097862489e-01   -1.106012764714766e-01   -3.976061337337423e-02; -1.654001084497213e-01   +3.992079945906165e-01   +3.606701179582801e-01   -4.883579820531903e-02   -2.843340557131341e-01   -3.614523430575515e-01   -1.179703037695312e-01   -5.486293277093370e-01   -1.126922629731269e-02   +4.657388941038244e-01   -4.070001139858950e-02   +7.473855070269757e-02   -1.130518093386309e-01   +1.894562033489505e-02   +9.254593882171872e-02   +5.014308297584743e-02; +1.181028420760513e-01   -3.184324269602750e-01   -5.317547026285163e-01   -3.338202239750646e-01   -4.930928522029044e-01   -8.313817534932737e-02   +1.810182882606695e-02   +2.098561288442057e-01   -8.115596633364322e-02   -2.428009762378051e-01   +7.010849749875932e-03   +3.302179461552569e-01   +1.115276127957816e-01   +7.452953768997465e-02   -1.203172608554417e-01   -2.071998997098048e-01; +9.168390008221691e-02   +1.246578620869704e-02   +1.036120581536601e-01   -1.603626426874447e-02   -2.995891837458320e-01   -1.575802969596102e-01   +1.335376985686896e-01   -2.781678095580405e-02   -2.638479898275533e-01   +5.085621048660181e-02   +7.479940326488233e-03   +3.241612446506271e-01   +5.188034028549409e-01   +4.244191767466826e-01   +2.585720066030607e-01   -1.735112206012296e-01; +1.697966799894647e-01   +2.390292957247331e-01   +4.663449692328443e-02   +2.936656308385135e-01   -3.417810219189912e-01   +1.377801782572289e-01   +3.199727373645199e-01   +6.714274805055226e-02   -4.850051371055626e-01   +1.974741644109954e-01   -6.524494267407030e-02   +3.198619138552629e-01   +4.097356174284505e-01   -1.796344389750400e-01   +1.988359594004095e-01   -3.868617717268447e-02; -1.319919562056804e-02   -3.361570978252429e-01   -2.794173785197334e-01   +1.160661641838326e-01   +1.455425347817322e-01   -1.125890577174945e-01   +8.327541254561194e-02   +9.649454245780560e-02   -4.694743333227266e-02   +2.278080523936039e-01   +9.029259114499801e-02   +2.506597720660495e-01   -1.386346639529266e-01   -2.590113893597814e-01   +6.834681934751186e-02   +8.067626337877405e-02; +3.338701320818306e-01   +7.987112067807442e-02   -2.669406243848840e-01   +9.716791246196638e-02   -4.499637587027839e-01   -3.029044021293965e-01   -2.261044069865127e-01   +7.244949983205766e-02   -1.847213379144065e-01   -2.645228551236054e-01   +2.423979178193940e-01   +8.011363539421638e-02   +3.166531465258092e-01   +2.197701798404758e-01   -1.858491225980384e-01   +5.351584592811812e-02; -1.790184586478836e-01   +4.245193785375162e-03   -5.329739778355114e-02   -3.698388250711226e-01   +1.354557908616061e-01   +8.450155241250248e-02   +4.191742125826536e-02   -4.055979007712139e-01   +1.190093516940907e-01   +1.146842261618770e-01   -1.253470377703356e-01   -5.132437997212691e-02   +5.532148545657732e-02   -1.709744221043449e-01   +3.315553190218052e-02   -3.071786846776836e-01; +6.520611686892597e-02   +5.750669580426444e-02   +3.220364364501617e-01   -8.096210147380765e-02   -2.671676819631454e-01   -3.634068524384753e-02   -1.729016684784947e-02   -2.044936776324242e-01   +1.839610709286014e-01   -4.546488336293304e-01   +5.477744175315245e-02   -1.265159711027536e-02   -2.000156252880922e-01   +4.296341807977601e-01   +6.287370187095215e-03   +3.264861877469343e-01; -2.816736070281108e-01   +1.261979578185370e-01   -6.478997241997317e-02   -2.587768374485433e-04   -2.145616708612715e-01   +3.151791134988183e-01   +2.437873571120658e-01   -2.613906093255481e-01   +5.092454388864970e-01   +3.173775735379968e-01   -7.052186590903323e-02   +4.668333659887686e-02   +1.043752125906333e-01   -1.819426663334501e-01   -5.634704599242099e-02   +5.584175137307937e-02; +3.126596839180433e-01   +2.283221500806392e-01   +4.907116708148868e-02   -2.951534579287817e-01   +2.195564885960845e-01   +8.846006823605033e-02   -1.094154699961305e-01   +2.012812173842928e-01   +4.977183877729155e-02   +6.902579346788007e-02   -1.386667517592572e-01   +1.092102894928032e-01   +3.308046974723918e-01   -2.096897776365279e-01   +2.439740037927134e-01   +3.510454746511050e-01; -2.229185029985128e-01   -2.813432551088329e-01   -2.181829453787035e-01   -3.227338668378819e-01   -5.603493577104945e-02   -3.117912953054940e-01   -6.806802266050249e-02   +3.315723633064851e-01   +2.047988576805900e-01   +1.794953184228853e-01   -1.031709796542489e-02   -1.747916654563463e-01   -2.400112272707947e-01   +6.407185832947740e-02   -3.024418051771176e-01   -6.015011212987802e-02; +7.881050902622272e-02   -5.337969243056777e-02   +1.368430346373282e-01   +1.903816548354230e-01   -1.511705171984440e-01   +2.062409771179857e-01   -2.419872440896875e-01   +5.003599525681974e-01   +1.095700045284957e-01   -1.210056109673677e-01   -4.679173262808115e-02   +1.618002692855919e-01   +2.260363332271593e-01   -4.668007349881128e-01   -1.475656406063737e-01   -2.792112474963178e-02; +1.249161111863356e-01   -2.786150334373852e-01   -7.516179492521526e-02   +3.987049288055090e-01   +1.321243600667218e-02   +1.947131799450541e-02   +3.972421055720842e-01   +3.473548627916415e-02   -2.599210095180873e-02   +1.898960177759333e-01   -1.193871443171476e-01   +3.423122932614726e-01   +3.372445107114933e-01   -1.362756173700613e-01   +1.989489814159178e-01   -4.108515529227681e-01];
L2I_L1I_iGABA_netcon = [-6.845314172299341e-02   -5.520419423487948e-02   +1.947087361704786e-01   -2.005780264200693e-01   +5.041870689081880e-01   +4.158002714428382e-01   +9.284499305640248e-02   +4.893700369141506e-02; -4.674505103760437e-02   +1.817644184524125e-04   +9.648065858698791e-02   -2.993615563916833e-01   -2.560687917089746e-02   +2.837701371965752e-02   -2.639816494973277e-01   -1.608890364584009e-01; +2.364832490513302e-01   -2.052086309267091e-01   +6.341223945348484e-02   +1.614325451224597e-01   +3.689703942416464e-01   +5.450665203760666e-02   -2.584733492899338e-03   +2.202019557618843e-01; -6.877358357891999e-02   +1.670076124433347e-01   -2.300000323933213e-01   -3.863367717248197e-02   -7.876771860782525e-02   +5.032827504895980e-01   +5.308251295686884e-01   -1.489357163224597e-02; -2.694695616947555e-01   +9.088130045438429e-02   +8.194138945236826e-02   -9.119269672270958e-02   +2.068604218274085e-01   +1.682831891697455e-01   +2.462763189621378e-01   -1.726299454926095e-01; -1.040483644228549e-01   -4.692574215038874e-01   -2.153852374322978e-01   -1.097707933057001e-01   +2.261751187034161e-01   -1.878165820789715e-01   +9.757359671160920e-02   +1.513285675620556e-01; -3.817568913633056e-02   -1.139274704146462e-02   -3.220900218288384e-01   -1.011629060030740e-01   +2.084199495937080e-02   +1.825450332123741e-01   -1.961923270445167e-01   -1.652126283505355e-01; +1.363080108566177e-01   +4.412660463346580e-01   +1.124749370439036e-01   -1.440859123112923e-01   -1.115733947757658e-01   -1.881293578571454e-01   -2.278522302493725e-01   +5.913304931822200e-02; -1.453270521259482e-02   +4.172046506696958e-02   +2.173663800497157e-01   +2.372879709671177e-01   +3.263823843060989e-01   -1.277409975989432e-02   +1.569628197947622e-01   +6.552326988909006e-02; -1.248093776168816e-03   -1.395381165248566e-01   -7.816966475617555e-02   +1.933658143619052e-01   -1.721710793763554e-01   +1.335229668638407e-01   +4.518962733562670e-01   -6.269032121843698e-02; +4.624289873431764e-01   +4.888082708155780e-01   +6.966581741489918e-02   -2.822374471878788e-01   -2.535547113304029e-01   +1.095436619398346e-01   +2.609818641301666e-01   +3.470676195052101e-01; +2.369242690051975e-01   +1.869631633487664e-01   +1.654490927418930e-01   +5.922584158014006e-01   +4.601874954923434e-01   +1.193797873386651e-01   +3.924616393627628e-01   +1.014487043425996e-01; +2.269500372260932e-01   +8.907141870540930e-02   -3.155514897245402e-02   -2.423613331614862e-01   -2.382386780031311e-01   +1.290347467006628e-01   -1.751478577788445e-01   +1.057467624038717e-01; +5.757374089350240e-02   -2.631798986028546e-01   +9.724234044964079e-02   -3.399256269159404e-02   -2.991897417889547e-01   -4.287904249400277e-01   -3.197667999443316e-01   +1.362796843019590e-01; -2.845824007761715e-02   -2.998794200634154e-01   +3.613802524573247e-01   -3.931630717633573e-01   +6.233977221733600e-02   -1.044512351537341e-01   -1.011260840444778e-01   +2.871888751806959e-01; -1.213842579739229e-01   -1.480160169617226e-01   +2.868973191805920e-01   +1.537988956201340e-01   -7.551705067868497e-02   -3.572434609168634e-01   +7.859821211416818e-02   -1.768000102523723e-01];
L1I_L2I_iGABA_netcon = [-1.558883302259818e-01   +5.191171792598731e-03   -3.876976187341435e-01   -4.537721988577964e-01   -6.660407040020978e-02   -2.087380214607085e-01   +3.309995683903431e-02   +1.527744735017486e-01   -2.886629699013207e-01   +2.148686186174070e-01   +3.864872105145310e-01   -1.054268169400179e-01   +1.046178874903577e-01   -9.005246056295446e-02   -2.488714163776165e-01   +1.180070169083596e-02; +1.053655422823481e-01   -2.433053059715030e-01   +3.522461602137603e-01   -3.450166381275435e-01   +3.673881133349415e-01   +3.945954838200358e-02   -2.212457935238082e-01   -2.997425081300731e-01   -5.303467511009263e-01   +1.359451084774318e-01   +4.675446946391595e-02   -1.846128713008988e-02   +1.152635668746909e-01   +4.003247458461818e-01   +3.109725973587852e-01   -4.815603393454740e-02; +4.974663521658200e-02   -3.001235772262575e-01   +3.214195360175914e-02   -1.974459933216645e-01   +3.668009388938102e-01   +8.285585121125612e-02   +4.062286861104150e-02   -4.712570581167147e-02   +2.206060489095004e-01   +3.501588254286317e-02   +3.044011117053181e-01   +5.518787366240615e-02   +2.862609629437336e-02   -4.694603699532144e-01   -2.043514359312013e-01   +1.078708250396954e-01; +3.450512998555227e-01   -1.424050575600259e-01   +1.480203467321018e-01   +7.801836085724342e-02   -3.768054528249165e-01   -1.289179850841651e-01   -7.972092366221417e-02   -2.943495753558163e-01   -1.303352712087649e-01   +8.410495903593343e-02   +6.463875523346670e-02   -1.621379728173142e-01   -5.399839798967057e-02   +1.365403410654764e-01   +8.206969430727365e-02   +3.501676420499632e-01; -2.945300344297505e-01   +2.773369210806539e-01   +2.422356978145377e-01   -1.746100350442622e-01   +3.082870565940016e-01   +3.209279832408451e-02   +2.026643552501352e-01   +3.593603702184704e-01   -1.696275837612019e-01   -3.088397427765677e-01   -1.012469199814808e-01   +3.248275613308851e-01   +6.497011571998228e-02   -6.607972927665917e-02   +1.520859284242331e-01   +2.918981717353922e-01; -6.880564594330393e-02   -2.618250050566956e-01   +5.027943603219232e-02   -1.083644193610686e-01   +6.342752166187357e-02   +4.476285343774303e-02   +7.913688618471890e-02   -4.997539291049802e-02   -6.877222145919076e-02   +1.568981463044771e-01   -1.985096413698589e-01   +7.959991974911024e-02   +1.098507413505196e-01   +2.580670082979741e-02   +5.278549863316139e-02   +1.828711836677156e-02; -2.265257084742963e-01   +2.344475902999597e-01   +3.091231473196786e-01   +2.409313667218899e-02   +1.900455904811413e-01   +7.175523630973416e-02   +2.147462472025351e-01   +2.716576808967063e-01   +2.682486403801208e-01   +2.481225996838037e-01   +3.761287821764718e-02   +4.227236530587734e-01   -7.842885019905990e-02   -1.120296161513620e-02   -2.115606982585840e-01   -2.707332448031396e-01; -3.528299215755956e-01   -2.781296487406540e-01   -4.920175944265724e-02   -8.134082790621940e-02   +3.388252358411096e-01   -2.514223561905644e-01   +2.239486829541515e-01   +1.827131087331090e-01   +2.691917037284265e-01   -1.948575416958750e-01   -2.478678869049679e-01   -2.015070623564961e-01   -2.242826219991125e-01   -1.485948245029521e-01   +1.498178263240812e-01   -1.354640861698438e-01];
L2E_L1E_iAMPA_netcon = [+1.079422350143100e-01   -6.014292623191797e-02   +3.791442182591934e-02   +1.439903443584218e-01   +1.649925936511795e-03   +4.881998281817221e-02   +3.603582853192457e-02   +1.190022550940827e-01; -1.797194286458141e-01   -2.816105476787704e-01   -3.026854952735736e-01   -1.136046859561986e-01   -5.299075218862079e-01   +5.274976985866608e-02   +1.733922028939531e-01   +1.974980656581266e-02; +1.287109540518016e-01   +3.693808326055926e-01   -6.226834557276753e-02   +2.954044632627976e-01   -2.682913702651804e-01   +2.468579809340948e-02   +9.856821307633104e-02   -2.834983614991742e-02; -7.927561804122026e-02   +4.610129281373607e-01   -2.134693409004197e-01   -1.262412049583370e-01   +2.905160351800102e-01   -1.131734668196777e-01   +2.464552967204080e-01   +4.192168744119082e-01; -2.747693600593434e-01   -3.813802039261996e-02   -4.742732328436757e-01   +1.325922914460111e-01   +1.355913550468065e-01   +3.864456139995933e-01   -2.261445893517981e-01   -1.456768145779192e-01; +1.664577510956036e-01   -1.878853912571878e-01   +6.173596807978318e-02   +4.678859247740373e-02   +1.177154694280518e-01   +1.925114992375885e-01   +3.462405987371904e-02   -1.093764119012300e-02; -3.301249748188095e-01   -5.941913313006737e-02   -3.302694250572499e-01   -1.027162148753922e-01   +1.080560480158136e-01   +1.142705596236650e-01   -2.466863374793538e-02   -2.053424660544853e-01; +3.219122185177396e-02   -3.072060956608497e-02   +1.403626262513770e-01   +1.578221757236423e-01   +2.394916310167536e-01   -1.333868668956209e-01   -7.547984360141191e-02   -5.434109491380676e-02; -1.423597415359086e-01   +3.252874164932381e-01   -7.659498102972062e-02   +1.784529420736634e-01   -1.674112912691357e-01   -1.775948439931905e-01   -2.885587935343492e-03   -3.696374767239369e-01; +9.462400037006141e-02   -2.256640539945273e-01   +1.671009711635505e-01   -1.216723991884101e-01   -1.258747854610338e-01   -3.051155062287573e-01   -2.299167486109502e-01   -1.157568630165264e-01; +2.270023462248277e-01   +1.149183706289939e-01   +8.325490339372979e-02   +1.077226523785781e-01   -1.246681904123352e-01   -1.322601155591207e-01   +1.516665428521413e-01   +7.266203375230529e-02; +2.140971309325187e-01   +2.621928233368548e-01   -2.368798791367047e-01   +3.209678036685714e-01   +4.270249510643622e-02   +1.242203782746283e-01   -1.925143948821894e-01   +4.132292336461696e-02; -3.945009610311539e-01   -1.695379575245238e-01   +3.605774824652963e-01   -5.283737618835786e-02   +1.871672877584365e-01   +3.393892374139980e-01   +5.295929760589022e-02   -2.301779439638513e-01; -2.528195010397428e-01   -2.802908799906427e-01   -1.256740447966283e-01   -1.761255745760579e-01   +2.697234306500877e-01   -3.721137475436579e-01   +5.206940804388045e-02   -3.021330011999575e-01; +6.503434150879535e-02   -6.329969122045545e-02   +2.470329127232626e-01   -1.333489687278416e-01   -3.483426255271451e-01   -1.242491783019933e-01   -3.576931154887105e-01   +2.035214876379384e-01; -5.801015877929078e-02   -2.493683364048855e-01   -9.663842506529768e-02   +9.150595850264703e-03   -4.186373755194044e-01   -1.434159261940794e-01   +1.026855879911412e-01   +1.282468065965613e-01];
L1E_L2E_iAMPA_netcon = [+7.606736446205464e-03   -1.175881712183129e-01   -4.969294321482262e-02   -1.836270250169552e-01   +1.196048351353399e-02   -2.126345704791113e-01   +9.082908130065473e-02   +1.695167246973981e-01   +1.381227516369768e-01   -2.062930180988053e-02   -1.352329673541917e-01   +1.433344409634253e-01   -4.221655848898002e-01   -4.191215047712492e-01   -1.539025045874730e-01   +7.501123261711218e-02; +7.347522772602769e-03   -4.290908930445703e-01   +2.092612991021571e-01   +2.073869468940358e-01   -1.466972385054347e-01   +2.851574418091865e-01   +4.437290928520881e-02   +1.215650250710863e-01   +1.751480798092495e-01   +2.768016430725171e-01   +1.650545127522459e-01   -1.111845849985755e-01   -2.850079479933506e-01   -2.795579265486099e-01   -9.191468257285305e-02   -3.704671173219282e-01; -2.627334061103727e-01   +2.213279247298595e-02   -1.444580900291155e-01   +2.806844634624137e-01   +2.081166598493450e-01   +2.222124056569918e-01   -2.359530749902801e-01   -1.391196903597194e-01   -2.835278946448291e-02   +2.204437019429583e-01   -9.650525321873893e-02   -1.632835171035072e-01   -1.069230073411268e-01   +4.981430927244400e-02   +7.353858287739397e-03   -7.302335209814162e-02; -3.942660552024600e-02   +4.042336717597569e-02   -4.448073084465128e-02   -6.231920628622795e-04   +1.421366196700053e-01   +3.079806775725307e-01   +1.974404464388340e-01   -2.896747613866182e-02   -4.220692562882135e-02   +1.022913948259290e-01   -1.700588132588969e-01   -3.975678618292839e-01   -1.265266351978489e-01   +8.195175575684729e-02   -5.179079827495124e-02   -3.626748754950572e-01; +2.160265513967158e-01   +3.406165070384993e-01   +3.382180258592126e-01   +1.048547277545648e-01   -1.466916914868462e-01   +4.482213775340712e-01   +2.647385149401768e-01   +8.728062193734043e-02   +1.980078074680494e-01   -1.071118703007707e-01   +1.448890393097932e-01   -5.433870997163993e-02   +2.515206645665711e-01   -2.163725560901344e-01   +2.506379793309674e-01   +1.172581883506423e-02; +2.982835322432820e-02   -4.699729577600769e-01   +1.696175248182291e-01   -1.902005894899055e-01   +3.962287665106857e-02   -2.630269249512567e-01   -1.406650183736680e-01   +1.749086252475458e-03   +1.313366818332156e-01   +1.521710033599615e-01   +2.153862354340962e-01   +1.610536252003025e-01   -3.980575497824086e-02   +2.842469081184696e-01   +7.352040490225212e-02   +1.341035826171348e-01; -7.091517941608372e-02   -2.581263796008154e-01   +1.020972604138425e-01   -2.512320943049959e-01   +5.397022342712958e-01   -6.203545639950625e-02   -6.840693246937633e-02   -1.845032877152756e-01   +2.716322760329958e-01   +7.665457294932859e-02   +1.031389189343143e-01   -2.187163617701758e-01   +4.073274539734747e-01   +1.995237347532142e-01   -1.048075196995928e-01   +1.348530456644707e-01; -1.715499053634056e-01   -3.750712626931438e-01   -2.045814857078840e-01   +6.407067284368394e-02   -1.255671955783814e-01   -3.368066511131069e-01   -4.545460945485791e-02   -2.071473412011270e-02   +1.135814967225638e-01   +1.463346587184540e-01   +3.750941469999021e-01   +2.785719314511759e-02   -2.185569307813188e-01   +2.251560980002937e-02   -2.669773002775085e-01   +2.960521134073733e-01];
L2I_L2E_iAMPA_netcon = [+2.148574627946794e-01   -2.124328595923259e-01   +2.355411721730702e-01   -2.062670039750820e-01   +1.605158538244336e-01   +1.063774193361370e-01   +1.173177634171261e-02   +2.989653354478716e-01; -3.405617318397620e-02   +2.685994754609813e-01   -7.410337839142578e-02   -1.294034992256745e-01   +6.944981947526029e-02   +2.439376533690934e-01   -1.646329435599104e-01   +6.254062553088298e-02; +2.859993985341535e-01   +6.904551191871852e-02   -1.521263035828114e-01   +1.306172408731053e-01   +2.334552437457243e-01   +9.376691081743949e-02   +3.609170681083102e-01   +2.150073264713828e-01; +2.046888831606471e-01   -2.967439190847562e-01   +2.011802961489374e-01   -5.484563179533559e-02   +2.097889728745394e-01   +1.224273748587197e-02   -1.417519614247985e-01   -2.011039094285114e-01; -1.288547397407856e-01   +4.692791495623005e-02   -3.752634660943679e-01   +4.010680897881024e-01   +7.036202795243873e-02   -1.279045992172057e-01   -7.855196573607184e-03   -2.555816635610942e-01; -3.994127510307749e-02   +2.955446278653065e-02   -6.688924420123453e-02   -1.098837940488057e-01   +3.371964732830215e-02   +2.434535471092508e-01   +2.105974148437589e-02   +1.590684738981447e-01; +5.805015391131798e-01   +3.364289781108734e-01   -1.202552857009336e-01   +9.731740687017729e-02   -3.529941824610602e-02   +1.213370042083915e-01   +1.829466108451509e-01   -4.085088802956255e-02; -2.690831393332163e-01   +1.975634727255739e-01   +8.133975220152934e-02   -9.242483108338199e-02   +4.732343661535091e-03   -2.926762285256288e-01   +5.318927981315342e-01   +1.053784232026527e-01];
L2E_L2I_iGABA_netcon = [-1.690134769582890e-02   -4.843175598827248e-02   -5.419926001543054e-02   -2.382548410647632e-01   -7.200510994211651e-04   -1.321448777529806e-01   -9.434937358265419e-02   -2.443053681972425e-01; +5.417069519319462e-02   -2.723200109570204e-01   +1.169066434008967e-01   +3.066242160251618e-01   +2.824871885245461e-01   -1.081665944606144e-01   -1.938111015947135e-01   +2.622101160121130e-01; -1.203569365596147e-02   -1.462756511811509e-01   -1.749342000549493e-02   -4.168627331287772e-02   +2.751431785144718e-01   -1.714242195232478e-01   -9.963427948870980e-02   +2.937207101772906e-01; +2.208684874708071e-02   +6.645824445850650e-02   +4.451224162922878e-01   -5.742165189956170e-01   +3.781135388936496e-01   -3.140016981491631e-01   -4.007017994740505e-01   +2.429198900608703e-02; +1.563189623668174e-02   +1.458899374950065e-01   -1.522453012303324e-01   +1.839030093381062e-01   +3.563218322648178e-02   +2.232825234185883e-01   +2.563860821837449e-02   +1.971140376039967e-01; +3.258298158940756e-01   +4.785717391578449e-01   -1.128747211897121e-01   +1.048646956361265e-01   -6.966644474482986e-02   +2.323451315510191e-02   -1.207758624091584e-03   +1.219778946592249e-01; -4.599712395998629e-01   -2.385118975993878e-01   +1.599108869828927e-01   +3.267979417598108e-01   +7.922342087232800e-02   +2.843686183579983e-01   +8.910635909481818e-02   -2.663801551446643e-01; -2.003701920858493e-01   -2.561811624305370e-01   -1.453401221395493e-01   +2.487311362072295e-01   +1.401032813175815e-01   -1.895637783843233e-01   -2.111998411622129e-03   +3.119478930697356e-01];
L3E_L2E_iAMPA_netcon = [+3.174094139364041e-01   +2.413891450172383e-01   -2.098444600434202e-01   -1.664998007874034e-02   +2.997767569652126e-01   -1.807508302407599e-01   +8.734208574591736e-03   +2.839862528602960e-01   +1.719788477180808e-02   +5.046975561694844e-01   -1.345973046006589e-01   -2.297586534303422e-02; +2.989246433878334e-01   +4.594821224962575e-01   -7.813981137658491e-02   +8.261163042669313e-02   -2.977819652831544e-01   -5.357120449670009e-01   +1.267590458947313e-01   -1.754375297853250e-01   -9.329557767700020e-02   +7.025110266316119e-02   +1.323520022472822e-01   -3.101982184229144e-01; +1.158505820513547e-01   +4.795593466902227e-01   +9.099183891437301e-02   -4.153023012587378e-02   -3.832311391753793e-01   +2.338449410036520e-01   +2.393807660925962e-02   +1.436471404727575e-02   -1.795124799211788e-02   -3.569221471857316e-01   +1.025348737613814e-01   +1.447393962038402e-01; +2.964211107468595e-01   -1.497879748769219e-01   -2.897938661404657e-01   +2.075257458665483e-01   +2.525034109673501e-01   +2.011787204799315e-01   +2.920738491519772e-01   -6.013076607369727e-02   -1.786560837633311e-02   -3.452952603098222e-02   +2.379268183644731e-01   +2.470400127156730e-01; -2.564295701751580e-01   -1.614262263780435e-01   +1.435779452292387e-01   +1.558597675945703e-01   +3.603871713856299e-01   +4.109767585471864e-01   -9.213678262077081e-02   -8.746786980818344e-02   +2.818219503246815e-01   +1.687359626131539e-01   -1.180924078151012e-01   +4.950144098624695e-03; -3.826116401197197e-02   -3.347733868295390e-01   +1.357907672282363e-01   +2.985040923786583e-01   -2.639219727299471e-01   +3.520986927165975e-01   -4.156833277413702e-02   -2.444540526381619e-01   -4.200667779250938e-02   -2.900847937024688e-01   -2.455571788578063e-01   +5.425164764307407e-02; -1.773928354179710e-01   -3.392826331125590e-01   +7.753208624213417e-02   +2.802245234446741e-01   -4.615247718697443e-02   +9.181227332771232e-02   +1.990965228396299e-02   -2.714596765278136e-01   +1.419548701305119e-01   -9.914304180871372e-02   +1.854763731464986e-01   +1.222757672090352e-01; +9.482474773644983e-02   +1.354398752716182e-01   +2.944649045957652e-01   -2.305884306167502e-01   +2.830004544218314e-01   +9.648767923397766e-02   -1.424588715214238e-01   -4.003971695993005e-01   -2.146513953417845e-02   +2.103759489347092e-01   -8.359020796596145e-02   -4.655288891293254e-02];
L3I_L2I_iGABA_netcon = [-4.191873248492886e-02   +3.269623893922895e-01   -8.802080191024206e-02   +7.542539118076824e-02   -3.972926438543501e-01   -1.174637690791395e-01   -6.625072037966911e-02   -3.473816879396733e-01   +1.767729909854118e-01   -2.503552227416827e-01   -1.831749608888889e-01   +1.443896212737928e-02; -1.079734991191958e-01   +2.830500802446236e-02   -2.987733831367885e-01   -4.824479933803882e-01   +1.640263688251712e-01   -1.093476942672329e-01   -7.348296752819197e-02   -3.347198852122979e-02   -9.439811682733552e-02   -2.061447521225603e-02   -3.301035228212587e-01   +3.406382785537617e-01; -5.858902605411789e-02   -3.206795289596803e-01   +2.301887376787835e-02   +1.475398203067241e-01   +2.519775039620747e-02   -2.949389169485996e-01   -4.312261070592221e-01   -2.818228701556140e-01   +1.237627976398221e-03   -8.612774027551745e-02   -1.577876415831135e-01   +1.226308712776161e-01; +1.805043784840485e-01   -3.591761908488919e-02   +1.563155301232766e-01   +4.057095162510020e-01   -8.261543759223056e-02   -1.073931375147480e-01   +1.040501082685814e-01   -8.013745135958766e-02   -3.389599120266082e-01   -1.653424111506150e-01   +2.831434874267366e-01   -1.634671720585598e-01; +2.706372581897910e-01   +7.478177484014226e-02   +3.453413203309025e-03   -9.166702466301610e-02   +5.775836553561069e-02   -1.400929305927375e-01   +2.711039806371237e-01   -1.664413927706530e-01   -1.067391364964019e-01   +3.132546511829973e-01   -1.071514342563215e-01   -3.762117515502553e-01; -2.335474251612046e-01   +4.839547868623484e-01   -3.923592860225815e-02   -1.136043244291549e-01   +7.673127185787605e-02   -1.678783796203018e-01   +6.602383870723114e-02   +4.194670394681600e-01   -1.451752604695234e-01   +1.998164470587791e-01   +1.098860382757776e-01   -9.028776773916497e-02; -1.593034710485127e-01   +2.300202822036023e-01   +3.581650661522793e-01   -2.682552786560988e-01   +1.406317363314481e-01   -2.009006189629699e-01   +1.908293585475544e-02   +1.061117387958292e-01   -1.100058986507235e-01   +4.076666992217171e-01   +1.885587358038927e-01   -3.127071572821201e-01; -6.234937794221942e-02   -2.122155116691297e-01   -1.269918258199702e-01   -1.676331382619984e-01   +1.955838919938482e-01   -3.413911304170668e-01   -1.546616359208006e-02   +1.736984229267136e-01   +2.247417722744167e-01   +4.109037344967827e-01   -8.309417022575116e-02   -2.771336778702529e-01];
L2E_L3E_iAMPA_netcon = [+7.634267263228271e-02   +2.946042201359518e-01   +2.538350565991029e-01   +2.547079224582769e-01   +8.076875405417364e-02   -3.233922955200808e-03   -1.457273507684607e-01   +2.297849078254642e-02; +1.627685423201630e-01   -1.665583642713837e-01   +7.127114043587213e-02   +2.926579919784729e-01   -2.451275589514878e-01   +1.239099618224678e-01   -1.151986546117730e-01   -2.678915449490595e-01; -8.519036032679850e-02   -3.002891505708200e-01   -1.249560752250346e-01   +2.258636123941798e-01   -2.449646381632808e-01   +8.888409146646155e-02   -3.798003309820104e-02   +1.194293567817406e-01; +1.995748503134664e-01   +2.851904363391718e-01   -3.417967862889199e-01   -3.340394960232273e-01   +2.372911934681645e-01   -8.834053784386393e-02   +3.938823766063374e-01   -2.099105629361650e-02; +1.205093109092272e-01   -2.409138162759917e-01   +9.578112250640659e-02   +4.484414002716552e-01   +1.923405337204707e-01   -3.969885749912577e-01   -1.043746348996842e-01   -3.341274510216333e-02; -1.165003129046763e-01   -2.084576901103510e-02   -3.076959395532487e-01   +2.071896007362112e-01   +1.686357828122557e-01   -5.563151814538575e-02   -7.567853419370642e-02   +2.778628919836851e-01; -3.137175912116259e-02   -2.529260400923266e-01   -3.037211365586628e-02   +7.110661228175962e-02   +1.340849171065468e-02   -3.772743475837922e-02   -8.204503308168350e-02   -1.119449678146388e-01; -2.798465942369293e-01   -1.037830598209596e-01   +5.240964778837103e-01   +4.045607657276434e-01   -3.056159880241988e-02   +2.165802465250019e-02   -3.376656789588982e-01   +2.274317587469344e-02; -3.397524461179979e-01   -7.643835140584229e-02   -5.506926101706031e-02   -4.058577275245571e-02   +5.028389045674209e-03   -1.263951929513648e-01   -1.804514463596298e-01   -6.197763968774475e-02; +3.182772544133838e-01   +2.573831837995891e-02   +9.465099129171836e-02   -4.287596596230733e-02   -3.356509802232032e-01   +2.915328856343069e-02   -6.047556157432585e-02   -2.766057460406393e-01; -4.912062921714401e-02   +1.703476615632965e-01   -1.674398127453912e-01   -7.420460330788274e-02   -3.503334026061949e-01   -4.062418077434143e-02   -5.350974295774366e-01   +4.886741293620226e-01; -1.246420727722183e-01   -1.845097799587350e-01   +7.894818347185656e-02   -1.962560102091289e-01   -3.819141844764432e-01   -7.051337743464028e-02   -1.858267647716488e-01   +5.794072533905439e-02];
L2I_L3I_iGABA_netcon = [-4.868740945550967e-02   +1.487516206603025e-01   -3.214789415687515e-02   +3.525325751752973e-01   -1.509261212152398e-02   +1.924795888761935e-01   +1.812690400686577e-01   +1.695994970605766e-01; -2.284574026260069e-01   +1.444900728670178e-01   -2.828596382380772e-01   -2.185300413598040e-01   -7.894564278342901e-02   +1.243313868425067e-01   +6.670909194900984e-02   +1.161609782282833e-01; -3.277711632749328e-03   +8.987177405899736e-02   -5.574620166308392e-02   -1.012745045162224e-01   -9.200515670933729e-02   +1.216895711984519e-01   +1.416022047978247e-02   +1.016378129425458e-01; +3.201808574327507e-02   +1.874159802236376e-01   -3.153932270171939e-01   +2.806368097902942e-01   +3.088212599971384e-01   +4.349900154796056e-01   +3.702546195284402e-01   -1.910600482038797e-01; -5.221130348943787e-02   +1.777496566065073e-01   +1.312536689513780e-01   +3.407934631077642e-01   +2.971050138254203e-01   +6.393941729303641e-02   +4.469858588977083e-01   +8.671860893483034e-02; +1.389748968535096e-01   +2.840915927337289e-01   +3.437024096909244e-01   -3.595172026997973e-02   -2.144227159424609e-01   -1.920485555226258e-01   +1.702560224504995e-01   -1.670681007557850e-02; +8.521134659589957e-02   -1.014586044981291e-01   +2.460977101318863e-01   -1.993227124835542e-01   -7.294730355235805e-02   +1.600554074764617e-01   +2.316912418606740e-01   -2.592142690562567e-01; -4.764738065127051e-02   +2.291286625352646e-01   +1.249955808944072e-01   +5.249848893624164e-02   -1.837487594610511e-01   -2.728509049080631e-01   +3.859749455432380e-01   -8.936127872177722e-02; +1.806741391997893e-01   +4.300216208822787e-01   +1.111234645969989e-01   +1.658866662732032e-01   -7.390134890099058e-02   -7.509197161587595e-02   -8.367203391102503e-02   -2.435965774206493e-01; +1.219493836693505e-01   +1.300107122954388e-01   -2.011308174470467e-01   -2.045398706665354e-02   -3.264878081372818e-02   -5.581483619669758e-02   -1.922588974077812e-01   +2.582899229706719e-01; +1.206871512082570e-01   -5.823808698411814e-02   +1.381545836574178e-01   +2.477867728861299e-02   -1.610423302347245e-01   -3.859649886798968e-01   -9.830867663248508e-02   -1.101218490316271e-01; +1.792247042462126e-01   -2.292585749324844e-01   -3.310645848201109e-02   -4.053075749692607e-01   -2.178475103970426e-01   -3.520970168648970e-01   +1.376699734591416e-02   -1.641457319007120e-01];
L3I_L3E_iAMPA_netcon = [-3.097882949247289e-02   -2.593352561769342e-01   +1.085097215575876e-01   +7.208132972649772e-02   -4.280383166615662e-02   +2.546038540534293e-01   +4.337566961125593e-02   +9.190697257482497e-02   -2.424105029253536e-01   +4.288041205909549e-02   -6.485830521628953e-02   -1.434444807506956e-02; +2.767043058419172e-01   -8.478236249603613e-02   +6.768822990310255e-02   -1.844097254094045e-01   -1.579828680064694e-01   -3.836200859304510e-01   +2.061763181146730e-01   +1.345808282471415e-01   -2.695148707325919e-01   +2.931525734813590e-01   -3.213396213081549e-01   +5.195326444553286e-02; +1.624387213662062e-02   +2.101538778048454e-01   -3.217556144613829e-02   -1.080790306551753e-01   +1.526059384441504e-01   -1.154871738396232e-02   -2.880063177573849e-01   -1.218122853681338e-01   -3.482681378930619e-01   +9.303558771173914e-02   +1.977656648674476e-01   -7.988672314456648e-02; -3.556315917748199e-02   -7.524602116238752e-02   -1.532856927407454e-01   -7.999438513066801e-02   +2.111996592610096e-01   -1.518003254289240e-01   +1.662781385480324e-01   +3.505407469614244e-02   +4.224026877839032e-02   +7.078031850188415e-02   +1.858354575424369e-01   -1.377286433002124e-01; -1.877869891368588e-01   -2.592925471910280e-01   -3.105481394789444e-02   -3.615093670945074e-01   +2.435229301125042e-01   +1.380619798763901e-01   -1.932791162303739e-01   -1.227842740320228e-01   +4.154486966427167e-01   +4.482790532581136e-01   +6.214004390062242e-02   -8.570211732166587e-02; -6.063019975181770e-02   -7.627980818896525e-03   -9.847189766985628e-02   -3.334576458281988e-01   +3.773755683799330e-01   +1.908489773164482e-02   -4.014339827218336e-01   +1.895933990319520e-01   +2.130618335648432e-01   +1.587686754071143e-01   +7.511566235504402e-02   +1.076056756463346e-01; -3.302920020732505e-01   +6.989216391619563e-02   -2.537545638765916e-01   +2.359916478337911e-01   -2.475139247703628e-01   -1.779720395689082e-01   -2.981016724100183e-01   -9.867821928447056e-02   -2.759125158140361e-02   -3.336977650730610e-02   -1.549554299426220e-02   -6.792109354902141e-02; -1.446507231549943e-01   -5.324107680872833e-02   +5.794235550002468e-02   +2.879474441200803e-01   +1.698686260169667e-01   +3.325264369546330e-01   -1.107825836437159e-01   +2.956777734920349e-01   -6.525306082232307e-02   -2.415250476980552e-01   +1.529641045623826e-01   -2.988642514004103e-04; +1.885128964119963e-01   +2.960307646996564e-01   +2.098743297364321e-01   -8.081966953010035e-02   +2.012994500400086e-01   +2.065858189406967e-01   -2.584063445272078e-01   -1.444050087764190e-02   -1.276849894565114e-01   +7.711616991148303e-02   -2.884631750947418e-01   +4.604912849724618e-02; +3.121060695584995e-01   -9.894923425995433e-02   -1.277474015646209e-01   -1.046070644552679e-01   -4.498225385608414e-01   +2.498200159741057e-01   +2.387631992506346e-01   +2.336940798896232e-01   +2.260244732220236e-01   -1.347829183673385e-01   -2.188873205302742e-01   -2.841778117972675e-01; -1.317137441825475e-01   -3.828033178628200e-01   -7.299557197911660e-02   -1.936627023977491e-01   +2.527144826925755e-01   +1.514270914713287e-01   +5.214899145883864e-02   +9.223572722269960e-02   +3.017665735697128e-01   +1.851286688672913e-01   +9.182714867217941e-02   +4.294529480241028e-01; -2.374840460887113e-01   +9.656096384421833e-02   -9.143677483216717e-02   +2.779829506112438e-01   -3.458680143810712e-02   -2.093223366982679e-02   -7.079542368594571e-02   -9.693826951386236e-03   +1.826637952306198e-02   +2.826844253615641e-01   -2.313883321057899e-01   -3.768039723988287e-01];
L3E_L3I_iGABA_netcon = [+3.389414993039220e-01   -1.887030716285178e-01   +1.152483152093934e-01   +8.300065962474065e-02   -3.697340490676299e-03   -4.801497388537607e-03   +3.965265712818635e-01   +3.104686894209173e-01   -2.921887495502700e-02   +5.189912666793454e-02   +3.173092663639109e-01   +1.219936205123416e-02; -2.092620269645675e-01   +3.532010503743598e-01   +5.166368346248692e-01   -1.373467551018739e-02   +2.110759960528497e-01   -2.520262802399883e-01   +9.073349591043611e-03   -8.130460479565339e-02   +6.725247866172120e-02   +2.856776019535284e-01   +8.692729819004394e-02   +1.288113232925472e-01; -1.704202939778731e-01   +4.932934741036558e-01   +1.355189516287951e-01   +2.754812226423446e-02   +2.956268153763536e-01   +6.167424297615490e-02   -1.405699830091195e-01   +2.327114203892561e-01   -2.753839967721419e-01   -5.783678015693319e-03   +1.629704723195017e-01   -1.767824403428868e-01; -3.638427546440318e-01   -2.289027672103301e-01   +2.257618239895023e-01   +2.221337241771205e-01   -7.535320551200346e-02   +1.935817543471074e-01   -2.772812815024646e-01   +2.053305104885855e-03   -2.708378208387685e-01   -9.857557376164443e-02   +9.197845341427628e-02   -1.287076760676362e-01; -2.528842435988709e-01   -2.227019828505123e-01   +4.647897497034340e-01   -1.070663288160804e-01   +3.180489471032441e-01   -3.908055753498130e-02   -7.690061196384665e-02   +1.611897678222502e-01   -3.202263894804185e-01   +6.533003133385627e-02   -3.533369392844026e-01   -1.102627069037963e-01; +6.381340888897620e-02   -3.777474521780908e-01   -2.840851580755549e-02   +3.046057977761217e-01   -2.351002653541053e-01   +3.657937470525516e-02   +5.676643824759740e-02   -5.012759147841406e-02   +1.328717207043388e-01   -1.467546997426693e-01   -3.754850853376905e-02   +9.681949995408751e-03; -1.572982467150653e-01   -2.947789253956362e-03   +4.128507020769420e-02   -3.797840868361711e-02   +2.821138105719035e-01   +3.214208909914736e-01   -4.146031229883669e-02   +1.116182073191040e-01   +4.764136230459520e-01   +1.075690213289213e-01   -1.002342583778912e-01   +2.306130290945254e-01; -4.697526061947403e-01   -1.593822326623166e-01   +2.579973269736243e-01   +4.792888147649580e-02   +1.384485917178171e-01   -2.464209052100955e-01   -2.789905760101581e-01   +2.658429252691858e-01   -1.060395738045630e-01   +2.303545322631760e-01   -4.494468616140903e-01   +4.689122717084586e-01; -4.132626510935112e-01   +9.614414667431158e-02   +8.706764928003698e-02   -5.639826455957372e-02   -1.125723455121052e-01   -6.346162427296807e-02   +1.981403371445164e-01   +4.245401868070577e-01   +8.044662075310077e-02   +3.875974837625193e-01   -1.583169619129629e-01   -2.644028659633716e-01; +1.254140508506013e-01   -4.105038258596448e-02   +5.721724986590844e-02   +6.239345056244539e-02   +3.084954931109612e-01   +2.958357230972093e-01   -1.174758733781176e-01   -3.134882912315911e-01   -1.752785756212586e-01   -1.490109488639825e-01   +1.935013443922586e-01   +1.578967273704311e-01; -6.766776550912412e-02   +1.417291809368281e-01   -1.215767892582839e-01   +3.196479598605002e-01   +1.823946310216759e-01   +4.241834496160135e-02   +2.770296281687416e-01   +8.076539519666137e-02   -4.222144478566323e-01   +2.206121482895826e-01   -2.299012155193736e-01   +2.665010585044497e-01; +3.301854747495404e-02   -1.333475462273805e-01   +8.293054915920195e-03   -4.184285971435829e-01   -1.347492149542356e-01   +3.227388869837258e-02   +3.847419108721538e-02   -1.622455831815647e-01   -4.249337297380414e-01   -1.471778921396624e-01   +2.399926113854457e-01   -2.732579273755509e-01];
L2E_Input1_iAMPA_netcon = [-3.836342618399632e-01   -2.882061669191265e-01   -4.941779390826819e-01   -3.712852188532401e-01   +1.993779550542535e-01   -1.278370265438700e-01   -6.155893874584178e-02   +2.843452660328434e-01];
L2I_Input2_iAMPA_netcon = [+8.727415704507702e-02   -1.443210399851424e-01   +2.099587420542369e-01   +4.192851952565879e-02   +2.706880097299285e-01   -4.386667695550930e-02   +8.947340819881802e-02   -3.003319049315142e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
