function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.843564038654605e-03   -3.259043549417052e-01   +5.435213658076047e-01   +3.970310077734039e-01   +4.504174083900605e-02   +3.356733212573220e-01   -5.664956969494869e-01   +1.141559602255325e-01   +5.005706125290423e-01   +6.553984622544631e-01   +1.051911298147439e-01   +6.186615905311540e-01   +2.821724510162300e-01   -1.434033946929368e-01   -2.534951567838291e-01   +1.305188502050434e-01; +3.572324308044371e-01   +1.730602747082706e-01   +7.936424665868753e-02   +2.137584754053303e-01   -1.825189283075419e-01   +5.694365123178264e-01   -6.683182226798761e-01   +1.147991629624090e-01   +7.596590596321491e-01   +2.048998070969702e-01   +9.292338889257269e-01   +5.204115236040473e-01   +3.556451959336921e-01   -1.830913902561570e-01   -2.258245078777324e-03   -1.048577071278722e-01; +6.706389870487333e-01   +2.774042368130175e-01   -1.382041560600395e-01   +2.420043441347869e-01   +1.757665500903557e-01   +1.005160310826545e-01   +4.490714723748606e-01   +9.635053966322404e-02   +3.330275612033186e-01   +9.409940602059930e-02   +5.298785445510104e-01   +2.249885308379276e-01   +3.286427421137000e-01   -2.214189329765016e-01   -4.634177249094173e-02   +2.131142360092473e-01; -3.313416287103015e-02   -2.511307783890881e-01   -7.157334390416627e-02   +5.286476543551223e-01   -1.031153397274774e-01   +2.348737981744910e-01   +4.556579182413641e-01   +6.443414333488431e-01   +6.126151190444149e-01   -4.681619364556194e-04   +4.867345953136622e-01   +5.126003176019676e-01   +2.666132465158936e-01   +3.548829882414565e-01   +4.504682844062525e-03   +7.320959135106166e-01; +5.254435280781804e-01   +2.839564958209923e-01   +3.600478261758404e-01   +8.035516241081907e-01   +1.738478178034741e-01   +2.513828919392121e-01   +9.039283541255953e-02   +3.965666354665134e-01   -2.232555323755595e-02   +3.368205668834834e-01   +5.338170236734362e-01   -3.087000902553000e-01   +1.570230713727868e-01   +1.499616677371086e-01   +6.215299419688268e-01   +2.119141507551585e-01; +8.555210931048425e-02   +4.797777446029932e-01   +9.198559213579575e-02   +1.755901957996946e-02   +8.856581452502863e-01   +1.610936562938343e-01   +4.840047936327008e-01   +2.500128548526415e-01   +2.918246135230243e-01   +3.256988122457280e-01   +1.843264797339435e-02   -2.421178631933184e-01   +4.747908759195877e-02   +2.799061930629257e-01   -3.598282599377076e-01   -1.121360511132899e-01; +2.918181603558309e-01   +4.324716428234746e-01   +3.234827613537021e-01   +2.368697336644945e-01   +1.810456214866644e-01   +3.723014338106286e-01   +3.578311144646391e-01   +1.840760207502785e-01   -3.506592995095102e-02   +3.040335721624851e-02   -2.284784887600408e-01   +2.757896702912254e-01   +3.102077149607532e-01   +2.596709114660229e-01   +4.319474560040417e-01   +4.722821736499444e-01; +3.188570460357432e-01   +8.562669637606281e-02   -2.230626485000946e-01   +6.615693570309725e-01   +1.396619582945754e-01   +9.039940687439520e-02   -9.146266294446079e-03   +6.410490590485691e-01   +5.395270101475790e-01   +3.223916449895838e-01   +2.361131285455657e-01   +2.599518794821511e-01   -1.446369032867339e-01   +2.557335543071361e-01   -2.473125192377445e-01   +2.282615990374344e-01; +1.737828641960820e-01   +3.260418234916834e-01   -2.353643335423464e-01   +4.566528914350400e-01   +4.245158637452010e-01   +5.686435953330543e-01   +1.699337689192806e-01   -4.497732956168792e-01   +2.952008075038714e-01   +4.984370786564977e-02   +6.486086644659054e-01   -1.441680582302320e-01   +3.620228531833601e-01   +4.414778112783516e-01   -4.210115432410649e-02   +1.488646677546075e-01; +1.123863420329438e-01   +4.577335463004247e-01   +4.466960273723433e-01   +3.252936707628223e-01   +2.103473226237239e-01   +5.104100189441149e-03   +5.506031116945990e-01   -1.053703343374672e-01   +1.107785710815177e-01   -8.484281461898009e-02   +2.360036418369445e-01   +1.177869685740058e-01   +6.755892152724827e-01   -1.305223005597009e-01   +2.075083317821060e-01   +3.927295815689020e-01; +1.687946668867197e-01   +6.465542140908177e-01   +8.402321854792555e-02   +1.006844653324290e-01   +5.325964035514271e-01   +1.366287850419980e-01   +5.343284342005293e-01   +1.548659213463374e-01   +5.598396286448512e-02   +4.720831625732795e-01   -2.765239816170330e-01   +3.197651073842052e-01   -4.196838856614797e-01   +5.730384699535399e-01   +6.420349047398931e-01   +3.123338755734216e-01; +2.835585269550517e-01   +2.864937816540235e-01   +1.611105228393140e-01   -2.095247504476888e-01   +3.710097281888186e-01   +2.049872396582705e-01   +3.453980503630560e-01   +4.424223843724210e-01   +7.460744136548340e-01   +9.936718826283529e-02   +3.452076397369233e-01   +4.434521406381045e-01   +5.787236035682021e-01   +1.713675314003986e-01   -3.624325979376375e-01   +3.773356096630018e-01; +6.947616688873197e-02   +2.438765603832448e-01   +5.204149019303924e-01   +2.580874932341414e-01   +3.560010402547333e-01   +3.916022204138351e-01   +2.668197094178636e-01   +5.583853494789015e-01   +6.990262817360258e-01   +6.816519533231478e-02   +1.913690516176453e-01   +4.096562282900540e-01   -6.969153087508891e-02   +9.499651271150916e-03   +1.017402005814239e-01   +3.282213226475850e-02; -1.041795043383176e-01   +2.995459187164388e-01   +3.951201034240807e-01   -6.920856180040121e-01   +1.046429825805786e-01   +7.279552418175086e-01   +9.143348830619510e-03   +4.972120181564121e-01   -1.803063237069050e-01   -1.213035961679116e-02   +5.244437327703549e-01   +7.927977450382889e-02   +3.512469324489228e-01   +4.301533082505761e-01   -4.599006953446295e-02   -2.282822176099140e-02; +3.755428472936800e-01   -2.865643401926320e-01   +4.101298214563984e-01   +4.837381591684582e-01   -4.778158724482704e-01   +7.507400956701617e-02   +4.863029579307361e-01   -1.891043547075003e-01   +1.030699238468448e-01   +7.328563619932774e-02   -2.029911732188307e-01   +3.415974175649547e-01   +3.380421309111198e-01   +1.567136604818351e-01   +5.013092642380610e-02   -3.911376383582199e-01; -5.000743393419386e-01   +5.343736448416044e-01   +1.609266812358102e-02   +4.512960158760133e-01   +1.000000000000000e+00   +8.805175488109414e-01   +8.930894692464487e-02   +7.684863990270063e-01   -1.418004563769911e-01   +5.029054932231348e-01   +3.729998054915076e-01   +4.046809165024757e-01   +4.237420240666482e-01   +5.826703077435125e-01   +7.755977918568038e-01   +1.406072523236459e-01];
L1E_L1I_iGABA_netcon = [-1.751044398889401e-02   +2.029957375136097e-01   +3.594258770861955e-02   -1.616352721931724e-01   +5.572496439657461e-01   +2.310320511651980e-02   +1.667002086454785e-01   +2.895907629575161e-01   -3.208821414770404e-02   -3.318897118015855e-02   +4.694916342842351e-01   +4.706574304811134e-01   +6.680654120260915e-01   -5.248364163533893e-01   -1.527319712406162e-01   +8.968905380860013e-01; -2.748453888613351e-01   -1.187946257094541e-01   +4.449526790515619e-01   -3.389261839671029e-01   +5.484072113933498e-02   -2.870784015821778e-01   +4.935556548132092e-01   +2.969788195705002e-01   +5.603866829207790e-01   +2.111638027229092e-01   +6.004039240580272e-01   +7.895701368126434e-03   +6.450195167366571e-01   +2.325052170443232e-01   +2.584706934564324e-01   +4.603215575847491e-02; +2.174677002915063e-01   +1.338009744026277e-02   -3.533783591898361e-02   +4.499848420577093e-01   +2.088477646357599e-01   -2.046227193807691e-01   +3.265857189699655e-01   -5.365370023577128e-03   -1.830067836655042e-02   +9.159417978526820e-01   +2.966710607048786e-03   +2.343253718171281e-01   +9.386287784642207e-02   -1.069447812624558e-01   +4.922913441829714e-01   +4.344449647255921e-01; +4.677919179713392e-01   -2.135845919537361e-01   +2.739053245074127e-02   +4.194010427031151e-01   +2.356033047295220e-02   +2.771677008682021e-01   +8.720522034483695e-02   -2.101824708342387e-01   +9.718745418370404e-02   +2.042706659708791e-01   +3.494996939116600e-01   +4.887560862761143e-01   +1.418086283555403e-01   +4.030605407146757e-01   -9.494990932170570e-02   -4.049297970975752e-01; +1.921694344054657e-01   -3.450811617520343e-02   -6.086781203243468e-02   +2.727010252612299e-01   +2.824994005062352e-01   -1.365689360468313e-01   +6.170433420068976e-02   -2.069997768175816e-01   +6.024059282684233e-03   +1.145550393552300e-01   -2.170485860770105e-01   +7.208190458661321e-01   +2.238641378929561e-01   +6.622814538989823e-02   +1.990271582135870e-02   +4.959091515513188e-01; +2.032319219030529e-01   +2.198302360375045e-01   +7.265305789070374e-02   +1.533751177172656e-02   +6.094817771323612e-02   +6.250114280667606e-01   +6.665732047606782e-03   -4.073830081370929e-01   -2.273560279778150e-01   +2.536349548959767e-01   -1.151903595050569e-01   +2.680161610963722e-01   +1.615583777857505e-01   -2.287224595211709e-01   +5.614203956121399e-01   +2.225483303078633e-01; -1.001586529691304e-01   +1.428725289096069e-01   -1.594380921353514e-01   -1.431303752336556e-01   +4.933463366317231e-01   +2.630743621691337e-01   +4.656557159724280e-02   -1.415729341210269e-01   +1.171412459001543e-01   +2.366521735236914e-01   +3.885973326599331e-01   +3.351453443228866e-01   +7.029716171594554e-02   -2.361544225871455e-02   +9.770233544095444e-01   -2.260592740551050e-01; +2.131828985581046e-01   +2.612504450717982e-01   -2.743548372001035e-02   +7.909497459766289e-02   +9.712961821399921e-02   -2.824691523622169e-01   +3.802466606663005e-01   -2.886799609575942e-02   +5.761837949854456e-01   +1.477960575736418e-01   +2.178879537164466e-01   -3.944568779286898e-01   +2.621321283238595e-01   +4.227999059720143e-01   +3.956483270260895e-01   +1.376501697422941e-01; +6.880809341869649e-01   +8.452712931192375e-01   +2.999976832757254e-01   -1.799693579111289e-01   -2.952014695702364e-01   +2.711645032428830e-01   +1.873845591439315e-01   -4.248808276090795e-01   +1.902498541681618e-01   +1.366037942443020e-02   +2.509975642632514e-01   +1.976478525365428e-02   +1.415198588218889e-01   -1.672224506048533e-01   +6.994439934712099e-01   +3.074740114711889e-04; +1.976249216948235e-01   +5.879626564873223e-01   +2.876799011050685e-02   +4.348274997457906e-02   -1.888877082429730e-01   +2.913068254097911e-02   +1.983070343846479e-01   +9.846011722397609e-02   +2.533782723855521e-01   +2.721157577918046e-01   -4.308434172168848e-01   -2.122240351913896e-01   +3.238529501894545e-01   +5.037039454971008e-01   +2.673823464909720e-01   +1.854765666965432e-01; +2.357480724575330e-01   +2.833441862202257e-01   +4.040326597884302e-01   +3.946103998634751e-01   +2.916048608270366e-01   -5.432313826735672e-02   +1.610084330260772e-02   -1.321304202477253e-01   +4.375957908488953e-01   +2.906153373259465e-02   -2.408164778884100e-02   +7.112863248223618e-01   +6.932315637496782e-01   +1.472639326279201e-01   -3.608463827179620e-02   -2.643956606243153e-01; +3.189131362301638e-01   +3.854807431374964e-01   +1.059968586459834e-02   -3.441498193604229e-01   -8.630584909923057e-03   +1.899685552888853e-01   -1.751496687460946e-02   +4.516538811689721e-01   -2.621083868384081e-01   -1.347413561014940e-01   +3.102831764878816e-01   +4.023782949015446e-01   -2.644970918216843e-01   +5.044154200891553e-02   +3.164084150704685e-01   +4.554035899862097e-01; +2.107978568080087e-01   +3.179909707738178e-01   +5.598838971040240e-02   +5.377673462988436e-01   -8.437369780122292e-02   +4.276782177575150e-01   +3.766102278586463e-02   +3.741611957228211e-01   +4.665283944009285e-01   -2.929657933855228e-01   +1.587988651727232e-01   +1.440443175318289e-01   +2.781371065971643e-01   +3.056909629358412e-01   +4.794847770448779e-01   +2.490777968368926e-01; +6.375675540504053e-01   +2.038157758554872e-01   -6.468494267451325e-02   +1.480196554890550e-01   +5.509211654064231e-02   -1.429958439808228e-01   +1.018152757056440e-01   +2.602164152091067e-01   +3.733322459360754e-01   -1.583888987972315e-01   +4.287963240186444e-01   -1.814518229627390e-01   +2.915847006386407e-01   -1.081722107498649e-01   +1.623429779335484e-01   -3.457360368636302e-01; +3.735700706874817e-01   +2.157710656137508e-02   +1.472682612181044e-01   -7.493993987781149e-02   +2.511328353213484e-01   +2.433915413954386e-01   +3.874763565072946e-01   -4.912087172883232e-02   +4.721977629049424e-01   -5.102668386327219e-02   +3.110408061751680e-01   +2.661658693244943e-01   +2.535123096432283e-01   -2.702795697752068e-01   +4.991997220892363e-01   +4.791764534229118e-01; -3.557195590847459e-01   +3.035921222185254e-01   +2.309211932097925e-01   +8.128794973684543e-02   +1.101408636635492e-01   +4.336075522067194e-01   +2.689208203852675e-02   +2.135171027878167e-01   -8.515270490652667e-02   +2.963513772709667e-01   -2.005142171850221e-02   +2.951926157358359e-01   +1.764328691638923e-01   +1.577656739829568e-01   -2.448661332835839e-01   +4.709429664842983e-01];
L2I_L1I_iGABA_netcon = [+1.628754410029872e-02   -3.114392170710371e-01   +2.332764144576269e-01   +5.984873704656788e-01   -8.393760552615410e-02   +8.050058350709920e-03   +2.512424284706292e-01   -2.975298762571317e-01; +5.014484833463161e-01   +7.110282176622281e-01   -2.935847644413564e-01   +1.880450658394671e-01   +2.988793901558318e-01   +5.940046084429909e-01   +3.225561353343662e-01   -2.940711433523443e-01; +5.112132443933430e-01   +2.796314838787074e-01   +1.037560572584759e-01   +2.948246767375767e-01   +4.229267330926350e-01   +2.685971345497047e-01   -9.752174292779957e-02   -7.187080250791003e-02; +5.899252932087579e-01   +1.085431666764876e-01   +3.541666398730873e-01   -1.959817365463312e-02   +5.928558766830888e-01   +3.819347970600756e-01   +6.652364312792288e-01   +2.091473874460877e-01; +1.487624002815276e-01   -2.874063255814116e-03   +4.047509341774131e-01   +3.976773873056864e-01   +3.943003618597408e-01   +2.474365869012825e-01   +3.225143216476989e-01   -4.731567643899853e-02; -1.017741517068647e-01   -1.480503634045739e-01   +2.944089732044385e-01   +4.077401726393184e-01   -2.747449825492937e-01   +2.823970436450707e-01   +1.870459497963791e-01   +5.765777057981110e-01; +7.186453514190125e-01   +1.936139486117549e-02   +2.686958703577264e-01   -2.371402963534393e-01   +4.166945329907505e-01   +5.091739053071815e-01   +5.925854102507009e-01   +3.471708896049498e-02; +7.239535807822518e-02   +4.321498947277489e-01   +2.660097127590744e-01   -1.340844472839691e-02   +4.153988663736370e-01   +2.834343572195078e-01   +3.616493834259766e-02   +2.099370249171969e-01; +2.165492483226185e-01   +9.942608392454567e-01   -5.084669756600417e-01   +2.882320522000602e-01   +4.626133372084976e-02   +2.907715699551288e-01   +1.289141489701221e-01   +2.620500308728070e-01; +1.353379232439740e-01   -2.064279575658240e-01   +1.039208690832760e-01   +3.111002572950156e-01   +4.990173962655375e-01   -1.181588874390308e-01   +4.529180155708533e-02   +2.291469683486265e-01; -4.497209555410370e-02   +5.242623516241931e-02   +4.153438274140904e-01   +6.297133600282996e-02   -1.675972271411365e-01   -1.048903373478574e-01   +7.754620700640044e-02   +2.858648739899745e-01; +1.446123920660084e-01   +4.920211263248833e-01   +7.111781004347828e-01   +4.194150841035645e-01   +7.944838109874541e-02   +2.316783220067892e-01   +2.525943905152961e-01   +2.818150754470810e-01; +3.775770163866963e-01   +6.144690620362586e-01   +4.072370872928242e-01   -1.975211744809572e-01   +2.232624817799100e-01   +3.494401293221396e-01   -2.449235994913333e-01   +3.151052451665519e-01; +2.455262952413311e-01   -2.043553897700114e-01   +2.055311023721198e-01   -8.211853096448088e-02   +6.828039434988638e-01   +7.129675226632247e-02   +4.827049118760924e-01   +2.688106968271383e-02; +3.403644305011574e-01   +1.639613679428321e-01   +3.883184649418640e-01   +2.311687917120960e-01   +9.392858224281991e-02   +9.963624818723623e-01   +2.683402253794305e-01   +4.005970330288852e-01; -1.272768997831340e-01   -2.145785840030948e-01   +3.096929893680513e-01   +7.912495551203132e-02   +4.580100280421820e-01   +2.272029505056636e-01   +1.877324151658051e-01   +2.130979217279238e-01];
L1I_L2I_iGABA_netcon = [+3.419335263651420e-01   +1.032823763422522e-01   -1.531184751425408e-01   +4.471312882473190e-01   -2.137594654719517e-01   +1.239269930597082e-01   +1.071801075860852e-01   +3.208718896370987e-01   -2.482494793012104e-01   +5.919203840896701e-01   -8.261958168795946e-02   +1.577905321236212e-01   +3.363403332737890e-01   +2.453287482393213e-01   +1.682607249519496e-01   +4.426327071172344e-01; +4.848940276375928e-01   +1.888301714170276e-01   -1.783535707219669e-01   -2.215328242256285e-01   -2.499777784277576e-01   +2.762787238092230e-03   +4.626647602508103e-01   +3.328587019247163e-01   +3.648739285102500e-01   +6.805943315223340e-01   +9.173949359250723e-02   -3.089399674349445e-01   -5.807982655317286e-02   -5.055524501557934e-01   +2.665229626119138e-01   +4.901440262156821e-01; +9.039669321379638e-02   -1.330179763338774e-01   +5.427885386692985e-01   -1.062091580365482e-01   +1.997768382337541e-01   -1.428972519606547e-01   +5.907280940920105e-01   +5.414752178354730e-01   -3.038833229519283e-01   +2.092185909678729e-01   -1.822409198807725e-01   +3.096182030200127e-01   +6.379327819446605e-01   +5.460110360818545e-01   +8.081833084906014e-01   -2.572905115799243e-01; +4.067587750286230e-01   +4.225102920894745e-01   +3.984655867165032e-01   +8.402506479260426e-02   +5.455201966125397e-01   +4.354611378990690e-01   +8.452965283322755e-01   +4.654608924703383e-01   -3.464600098285781e-01   +6.474479498839271e-01   +6.828033964593254e-01   +2.834010969120771e-01   +3.052413697208196e-01   +8.002678178026795e-02   +2.170702745049019e-01   -3.387613606425870e-02; -8.096634976764251e-02   +1.293240922084126e-01   -1.255936709141837e-01   +2.625891188181629e-01   -1.041151007631614e-01   +7.865650276367679e-01   +7.835563725891102e-01   +2.406014258044274e-01   +6.219537359198578e-01   +5.532633618119509e-01   -3.510577559980991e-01   +2.172421654195196e-01   -5.497076009529062e-01   +4.345913917779057e-01   +1.597684018531423e-01   +6.326633771448799e-01; +1.468568399015726e-02   +3.014061677375547e-01   +3.818258571098219e-02   +5.520074487760017e-01   -2.008859878259609e-01   +3.014406564639556e-01   +4.493932547361417e-01   -4.828377747915172e-02   +2.131633499120395e-02   -1.532824683288718e-01   +2.235793516358746e-01   -1.273612323377148e-01   +5.029947030975426e-01   +1.000000000000000e+00   +4.452463919789189e-01   +6.401673642974590e-01; +4.946592334996808e-01   +4.581084176684912e-01   -1.195289298525713e-01   +7.193850835984074e-02   +4.213517977806177e-01   -2.584242857666392e-01   +5.425914638417419e-01   -8.045619786414829e-02   -1.122003496835115e-01   +3.246323328428192e-01   +5.617378856373254e-01   +3.312070646145273e-01   +8.853190631432155e-02   -9.832465584182143e-02   +1.177778943966552e-01   +3.993743382207339e-01; +3.510032352625201e-01   +2.509131190448545e-01   +1.785969506583267e-01   +2.348992820005371e-01   +8.113386124040901e-02   +4.401521065511811e-01   +3.204018761653403e-01   +1.934264684084315e-02   -1.406828653116620e-01   +3.010974207561178e-01   +6.931609938357836e-01   +5.062274185459851e-01   +4.049036007215748e-01   -1.052107626150688e-01   +3.629746755431107e-01   +3.222473183779869e-01];
L2E_L1E_iAMPA_netcon = [+4.647772818991195e-01   +1.036972965539930e-01   +7.982694779699158e-02   +3.781873416663849e-01   +1.000000000000000e+00   +5.126209923074434e-01   +4.702660844447121e-01   +3.466211604519288e-02; -3.102698867747521e-01   +2.884927650088633e-01   -2.106046385081210e-01   +1.045541169251614e-01   +5.170204240092807e-01   +1.765818253259084e-02   +4.042156970217812e-01   +3.093274445801620e-01; +7.057245208303028e-02   +4.704007617945527e-01   +5.124350261219136e-01   +2.919538306858845e-01   +1.441044762260010e-01   -1.123842089580440e-02   +2.473575115447825e-01   +3.436588236618845e-01; +3.460484986940355e-01   +1.217980834134874e-01   -3.661394004921204e-02   +4.441473289425418e-01   +3.875537893025844e-01   +1.755439861840127e-01   +1.998110751967824e-01   -1.841351943455496e-01; -7.427487868672666e-02   +2.517971077010857e-01   +5.569075046131026e-01   -2.580643457438026e-01   +1.073320963530374e-01   +4.392626933163359e-02   +2.695722294765309e-01   +5.792725738174199e-01; +3.652128213244074e-01   -3.125172450499811e-01   +2.213884744414387e-01   -3.246555674946659e-02   +5.475042883412152e-01   +8.214779866910067e-01   +4.882550704598072e-01   +2.893775998519381e-01; +1.386358633880124e-01   +4.717151377943000e-01   +3.429363482191837e-01   -1.487243841130684e-02   -2.232162088785737e-01   +3.265265942977241e-01   +9.498683704783532e-01   -1.316973655088792e-01; +2.899682157928797e-01   +3.901048058589114e-01   +7.623307285501710e-01   -1.345610711419074e-01   +2.689185028551154e-01   +1.814885628193183e-02   +2.684684182804227e-01   +2.640224105357252e-01; +4.879084894204611e-01   +4.294347520621465e-02   +4.105949403932008e-01   +7.444423118698312e-01   -1.544525931797383e-01   +5.360199288538647e-01   +3.464285503562426e-01   -1.122660076791819e-01; +2.580886291174198e-01   +1.457520857087655e-01   +2.301224381884391e-01   +3.425920511827655e-01   +2.877294941963884e-01   -9.146916935071296e-02   -3.233065533687773e-02   +3.670030376154966e-01; -3.833630075154923e-01   +5.441644857954023e-01   +4.629479338712238e-01   -1.797551871556331e-01   +1.977786765736374e-01   +2.085736130612326e-02   +1.879706842461999e-01   +2.836617538499273e-01; +3.552438749792009e-01   +3.156914386693166e-01   +6.017617864994184e-01   +3.133179436431373e-01   +1.677750257986698e-01   +4.645127714772397e-01   -2.215441814743951e-01   +1.512307829229853e-01; -3.073417417930732e-01   +1.707683687657510e-01   +3.212395195598864e-01   -3.023439162212900e-02   +4.395940552893953e-01   +1.762513126229444e-01   +2.513121677107931e-01   +1.018419770180684e-01; +3.156959421485900e-01   +6.030444259206093e-01   -4.883531050819820e-01   +1.158159438497561e-01   +3.595265898632665e-01   +2.857656769722660e-01   -2.093172086350724e-01   +3.008050765351926e-01; +2.894819253127676e-02   +1.022580694015438e-01   +3.538166672406343e-02   +4.769998964590993e-01   -1.024984286211055e-01   -9.544267531667573e-02   +2.179667760746578e-02   +1.380295038050482e-01; +1.238866795257058e-01   -8.368357487846839e-02   +1.295235229545884e-01   -1.642728502892960e-01   +2.434650439637779e-01   +1.551517455164243e-01   +4.523993215467834e-01   +5.410629061101643e-01];
L1E_L2E_iAMPA_netcon = [+3.202631565468984e-01   +2.037802084150806e-01   +1.215805725945594e-01   +1.632364324155349e-02   +3.930881378693286e-01   +2.830794511863459e-01   +1.367999874968700e-01   +1.872011096867112e-01   +5.741360582782920e-02   +2.778484392012247e-03   +4.774216544370826e-01   +1.100579389827268e-01   +2.278477400852175e-01   -4.910356174987633e-02   -3.694592935033128e-01   -1.383445709063740e-02; +2.745006221971062e-01   -4.138058159987716e-01   +8.606036402622362e-01   +5.227964634131549e-01   +1.267567754370034e-01   +1.458486772020250e-01   +6.580807892538028e-01   +3.608339703614745e-01   -1.349161465806313e-01   +1.456294874212899e-01   +3.392151514846076e-01   +3.361792239703892e-01   +5.070041928897859e-01   +3.446153694570169e-01   +4.536004811638891e-01   -1.099587967622994e-01; +5.768319345947110e-01   +2.800775680079730e-01   +1.008415486536803e-01   +1.983107595914370e-01   +1.455820601025442e-01   +3.883790465112986e-01   +2.131221865566263e-01   +3.514092100152705e-01   +9.875966504418567e-02   -2.039719003361304e-01   +3.774080340412900e-01   +7.344654427719784e-01   +1.060869317942725e-01   +4.618718190549780e-01   -1.174262628134832e-01   -6.455581603286381e-02; +1.767432927483592e-01   -2.619208081010470e-02   +1.990873629906303e-01   +8.323017212476526e-02   +1.095430767821005e-01   +5.759999807178402e-01   +1.000000000000000e+00   +3.724376705293030e-02   +2.069336690883140e-02   +1.766512188511924e-01   +3.110902953026276e-01   -1.015132101870457e-01   -1.815979586859491e-01   +8.039311536822698e-01   +2.774789083836418e-01   +1.040526032485697e-01; -5.594976976725264e-02   -4.181778677462351e-01   +4.213357852468695e-01   +6.993671005613633e-02   +3.608510942226776e-01   -1.050324594731549e-02   +4.129992419152299e-01   +1.307490409178415e-01   +3.384304717013135e-01   -3.437118347720000e-02   -7.457031440703783e-02   -3.506124597342156e-01   +3.483876883859299e-01   +7.819935146308664e-02   +7.999680792165432e-01   +1.580972608356250e-02; -1.550224594161921e-02   +4.872414068974004e-01   +7.406381657059379e-02   +6.461317494569415e-01   +4.978239187921958e-01   +2.011505385606751e-01   +5.048136274691675e-01   +2.218162364754536e-01   +4.113325520753511e-01   -2.300787089228177e-02   +5.719108185321519e-01   +5.671464087985258e-02   -2.192176724728180e-01   -8.339451867939872e-02   -4.009524885303146e-01   +2.438222134879676e-01; +1.794883777358107e-01   +1.012896266601400e-01   -2.531888976557695e-02   +3.503686251507657e-01   +3.819224468789921e-01   +4.342124483074827e-01   +4.606208271751647e-01   -9.455014585281657e-02   -1.658761818250176e-01   +1.598387735117818e-01   -2.076813269659036e-01   -1.717458505101023e-01   -2.914286555116687e-01   +1.548751477965986e-01   +5.300092143726689e-01   +8.502314485923824e-02; +2.616891270385197e-01   +3.982767065229859e-01   +1.856185055678559e-01   +4.456183172520407e-01   +4.355624734458290e-01   +7.049138992849230e-01   +5.557597204516167e-01   +1.766643355804082e-01   +2.600663797359267e-01   +2.591325443371444e-01   +1.329153471938016e-01   +1.994962029222618e-01   -3.894849141497070e-01   -1.148095106382234e-01   +3.927306078933112e-01   -6.952827268420159e-02];
L2I_L2E_iAMPA_netcon = [+1.396904124080080e-01   +6.635241661076586e-01   +4.225267924689022e-01   +1.881365497775158e-01   -8.049362543581247e-02   +4.745510559197717e-01   +1.080550638670870e-01   +6.795914499192341e-01; +6.975513809050673e-01   -2.673778947812724e-02   +9.997152935836376e-01   +6.936630063222119e-01   +4.956694422859727e-01   -2.061133067737585e-01   +1.410238821078679e-02   -2.979702473088911e-01; +1.005078997933796e-01   +3.252521427575151e-01   +9.606461384551204e-02   -1.569234979225402e-01   -1.053058046728840e-01   +1.401885167350551e-01   +4.587963500100072e-01   +2.757703169102518e-01; +2.573434684217791e-01   -2.731550323402261e-02   -3.904212737386785e-01   +5.944238910407770e-01   +3.424463319093280e-01   -4.145213970981286e-01   +3.227845979805195e-01   +1.733083210765596e-01; +2.377508438854926e-01   +1.594257889162248e-01   +1.031470660594040e-01   +5.137539406581484e-01   +3.020566779381984e-01   -2.172773272810038e-02   +4.288093405376026e-01   -1.796096346100381e-01; +3.021256477407074e-01   +4.196259870309124e-01   +6.849297805300757e-02   +4.117147575587862e-01   -8.281623649152865e-02   +2.365577336360224e-01   +2.746298234171770e-01   +2.094789163684089e-01; +4.110274341202052e-01   +4.828375826682821e-02   +5.691635411991810e-01   +6.212003770651501e-01   +2.935327309095671e-01   -2.093608841552919e-01   +7.764922469635255e-01   +9.154141477518635e-02; +1.398874991552232e-01   +8.373070119502372e-02   -3.278342413165516e-01   -8.863541672989581e-02   +9.524521505787879e-02   -8.638884530966164e-02   +9.574456836139601e-03   +5.671958385121548e-01];
L2E_L2I_iGABA_netcon = [+2.277811099381959e-02   +1.465313633427663e-01   +5.612326146239943e-01   -2.022281342595064e-01   -2.953156840062531e-01   -7.220192318789508e-02   -1.845430268137586e-01   +4.803538401308465e-01; +1.792893400360914e-01   +1.697483955043248e-01   +2.434914582179626e-01   +6.787641795586739e-01   +6.098741914357181e-01   +3.258836296908459e-01   -4.494712808250734e-01   +2.705268468536977e-01; +1.091170106860022e-01   +6.478457938359835e-01   -1.944095305248325e-01   -3.182773667158857e-01   +2.699867808140720e-01   +5.741187623591530e-01   +2.556424447285323e-01   +4.832392696710618e-01; -1.031226096923300e-01   +5.729479774638444e-01   -1.933173634314912e-01   +7.124876881095452e-01   +5.841137224342483e-01   -4.450592287008424e-01   -3.214832660049193e-01   +8.958977540121331e-02; -4.019847600945294e-02   -4.137174174336510e-01   -1.613605849126598e-01   +1.841172045459073e-01   +7.605912255177154e-01   +2.259752307035695e-01   +1.855182574601815e-04   +1.387287808708835e-02; +6.635489126629882e-01   +2.993587453203834e-01   +2.176035490811349e-01   +4.900460003746651e-01   +3.656088617437571e-01   -3.218880195141861e-01   +4.902001666908346e-01   -3.906853151396688e-01; +3.642118434521224e-01   +2.856358449277247e-01   -2.690277850213830e-01   +1.615028705790286e-02   -1.210648209654610e-01   -3.053568515087050e-01   +1.944044015471371e-01   +8.216429204892827e-01; -7.799001908506915e-02   +5.208851816410944e-01   +4.401522678247030e-01   -2.148563365092220e-01   +2.668672616733981e-01   +4.318919887712193e-01   +3.702206447452709e-01   +5.545147409400624e-01];
L3E_L2E_iAMPA_netcon = [+3.292488028503611e-01   -5.065378631893221e-01   +2.598148779478388e-01   -1.959841512639598e-02   +4.878492031783719e-01   +1.957125372466578e-01   +2.224075066433021e-01   +4.734481235028610e-01   +3.005171707598189e-01   -2.801421174833026e-01   +1.065512726213508e-01   -1.240953220820402e-01; +2.714382076935441e-01   +6.612196309669157e-01   +1.837191804508306e-01   +2.742648036668455e-01   -1.375735535127027e-01   -4.195211737999227e-01   +1.294533985379687e-01   +4.637606109424173e-02   -2.273409894644435e-01   +2.617059386670603e-01   -1.253109242808914e-03   +4.868185031242200e-01; -3.870016789536992e-01   -1.239834188892925e-01   +2.552013706818996e-01   +2.690325612583150e-01   +7.723930211992811e-01   +2.103590743974119e-01   +3.345906799765668e-01   +2.400777984553472e-01   +8.323612245315738e-01   -3.638021503869042e-01   +7.359648455676044e-01   +5.060537342214360e-01; +2.887016017597187e-01   +2.600800775425570e-01   +4.336160524936997e-01   +3.040807587274884e-01   +4.919575282856496e-01   +2.169835402581705e-01   +1.571343408233316e-02   +3.966309506477847e-01   +1.202998510646251e-01   +7.775122050441644e-02   -1.124537382374548e-01   +6.522390794825492e-01; +1.089115422940442e-01   +2.083969706855942e-01   +3.735872586330339e-01   +6.008818153118384e-01   +5.080905322872438e-01   +2.104428215274111e-01   +3.001137089365846e-02   -9.812382753699778e-02   +1.697083044944644e-01   +4.405513749776102e-01   +4.737612839359092e-01   +4.378724020276235e-01; +3.762510450577022e-01   +1.757055754212157e-01   +1.372781091610926e-01   -3.089654905810568e-01   +2.776997426530726e-01   +4.479113968886411e-01   +1.777389380423108e-01   -2.030482900139285e-01   +1.721626937598660e-01   +4.020810075698331e-01   -1.098847326518272e-01   +1.962970051722438e-01; +5.187683650885630e-02   +2.758943686359240e-01   +7.408347860651074e-01   +8.452115062335817e-02   +3.598091086709106e-01   +3.206694871524894e-01   -2.147633015202811e-01   +1.282177283211194e-01   +1.314429019796725e-01   +3.553473859911807e-01   +9.980453660353943e-02   +2.901078279773969e-01; -3.433950896952095e-01   +1.000000000000000e+00   +3.858377070614924e-01   -5.155638903146613e-01   +4.309944548653439e-01   +7.344939603957180e-02   -5.840500181084286e-02   +1.849823076149164e-01   +2.942158115714247e-01   +3.677731575336172e-01   +1.167069557305844e-01   -1.024163202731541e-01];
L3I_L2I_iGABA_netcon = [+6.811244338149782e-01   +4.496540268081606e-01   +1.585062733163000e-01   +1.696682065211140e-01   -4.321852026400681e-01   -6.689843980381177e-03   +1.000000000000000e+00   +6.480724204201753e-01   +7.245845498231008e-01   +1.627240082693807e-01   +2.500201376436061e-01   +3.079237389659047e-01; +1.751813380736097e-01   +1.627255622089028e-01   +2.165496371711124e-01   -6.355540152428547e-02   +3.082396700519660e-01   +1.760802338211511e-01   +5.394802276943937e-01   +1.410030543845049e-03   +1.526861672100757e-01   -2.128978558460695e-01   +4.411873804724143e-01   -1.120867251582892e-01; -9.575330483830134e-02   +5.712629813319158e-01   +2.939246083469533e-01   -1.328615749794511e-01   -6.688424463364259e-02   +2.240510401332390e-01   +2.626291299510430e-01   +2.305183487629560e-01   +3.007821236768954e-01   -1.276122129236693e-01   -1.721184184828393e-01   +7.772339856565534e-01; +4.544919550385225e-01   +5.029878192679456e-01   +4.422876165061106e-01   -1.264738070030787e-01   +2.025916436723454e-01   +1.395501806740848e-02   +3.401928636103586e-01   -2.456194723184613e-01   +5.391508779287263e-01   +4.427590980589312e-01   +5.768046990011867e-01   -1.363761125515297e-02; +2.180093425364226e-01   +3.585882647846405e-01   -7.615936066574450e-02   +3.109325663845375e-02   +5.711737868496536e-01   +5.037483210507366e-01   -1.484442070882554e-01   +8.245488086648709e-01   +6.149918549990192e-01   -8.368892697366168e-02   +3.027009487854536e-01   +8.930615702981783e-02; -1.244966625857306e-01   +5.300722685330582e-01   +3.543648684252238e-01   +8.098960728082802e-02   +4.790924482096462e-01   +3.675970771623934e-01   +2.259582226013636e-01   -2.841021924606902e-01   +3.519196483949655e-01   +4.002724703487732e-01   -2.639821219147352e-02   +1.838880261672173e-01; +4.366083484182669e-01   +2.640487443042701e-02   +3.847528577599740e-01   +7.354649061498718e-03   +4.300018583904320e-01   +5.180069895104130e-01   +4.451921871346928e-01   +1.764805661579986e-02   -5.810884616253995e-01   +7.833408102303134e-01   +3.366243734286951e-01   -1.868886009112773e-01; -5.150932343386339e-02   +3.055180232787878e-01   +2.349628848263950e-01   +3.929851943259047e-01   -4.645921126135924e-02   +4.680947799284835e-01   +6.158884283706593e-01   +6.835478268510171e-01   +4.038757701127868e-01   +4.410457661223610e-01   +3.972341392073628e-01   +3.734406219871911e-01];
L2E_L3E_iAMPA_netcon = [+6.676580667447922e-01   +2.750106192372960e-01   +4.485859475981908e-01   -4.955036168150736e-01   +1.289914045953963e-01   +2.474450331169259e-01   +4.313266570016966e-01   +5.017603906627743e-01; -6.443644320484335e-02   +2.545841790546162e-01   -1.101163944836661e-02   +3.722939542624376e-01   +5.191757023599751e-01   -2.149294732767164e-01   -1.404348255799033e-01   -3.006250524679238e-01; +2.044383804746439e-01   -2.319694767272268e-01   +2.086279276811260e-01   +5.414355143656691e-01   +3.149790096550131e-01   +2.156009293737962e-01   +1.235080841287788e-01   +3.101688448655515e-01; +2.202078299770852e-01   +3.685807760666259e-01   +8.637258584371018e-01   +7.492841546798409e-01   +7.582327241682130e-02   +7.482249160608819e-01   +4.861484209017689e-02   -1.682394647167789e-01; +2.701785036540144e-01   +1.048158539727262e-01   +1.224646186956407e-01   +4.908121479712022e-01   +3.283828517899026e-01   +1.611773783760792e-01   -4.019965594265259e-03   -5.375448157607161e-02; +1.245602650635230e-01   +7.284607476800425e-01   +5.554864449219662e-01   +6.999616784717909e-01   +3.534208552610893e-01   +2.064027678588376e-01   +1.897722643494339e-01   +1.811960455389821e-01; +6.794992676879910e-02   +5.833495494436793e-01   +7.661833799065434e-01   -9.997285323308377e-02   +5.508929147362292e-02   +6.782478773730856e-02   -1.302272931097058e-01   +4.011496945162907e-01; +3.407407434211051e-01   +3.543791493563559e-01   +1.577575807642386e-01   +1.828838791127493e-01   +1.367947546043714e-01   +2.668176471789502e-01   +1.643714369755996e-01   +7.667795479822549e-01; +3.200365636693222e-01   +7.505379579450117e-01   +4.342067520209784e-01   +3.000018502117358e-01   +9.005427904494805e-02   +6.511266928438481e-02   +6.073557424699547e-01   -1.891067457356281e-01; +1.772695370214034e-02   +2.486244440920172e-01   +3.440778076427936e-01   -4.139329919469532e-02   -9.406732127704241e-02   -2.291428563410206e-01   +2.666287482428418e-01   -9.644902622861934e-02; +5.761831292054547e-01   +1.260692700001591e-02   -2.299520997881756e-01   +8.439422233796529e-01   +1.624932266983733e-01   +4.756431233523119e-01   +2.945735916265562e-02   +3.519290491141089e-01; +1.103007383515188e-01   +6.777851652414002e-01   +4.653582577610873e-01   +4.809588001445690e-01   +1.216327569820048e-01   -8.386507578394077e-02   +1.453285055221286e-01   +2.710485820070128e-01];
L2I_L3I_iGABA_netcon = [-1.271717366733523e-01   -1.264346089588560e-02   +1.078060089103744e-02   +3.128901775360383e-01   +3.168659510766629e-02   +7.927122192712555e-01   +4.668130336972197e-01   -2.002567372660333e-01; +6.864728551754887e-02   +3.122978443674884e-01   -3.300227465214727e-01   -3.503743898288131e-02   +1.906494045560682e-01   -1.351743506200474e-01   +5.202195416991645e-01   +3.410848699769369e-01; +7.871454510638622e-01   +1.000000000000000e+00   +1.790610692778385e-01   +5.692805277025853e-01   -4.970738881800881e-02   +7.428607591623139e-01   +3.229772702612436e-01   +3.110481721331124e-02; -1.332678543535233e-01   +2.226051652358655e-01   +6.389312258451488e-01   -4.242658039463642e-01   -5.009270297020764e-03   +6.823824209074062e-01   +1.861859670281419e-01   +2.787782353200136e-01; +4.955531873227648e-01   +1.769742963674169e-01   +2.311216053566798e-01   +2.789643170781803e-01   -2.852555703483095e-01   +2.683461725753227e-01   +1.132075574835918e-01   +2.525197964958589e-02; -9.568542811926525e-02   +2.637135608142547e-01   +8.094244259076252e-01   -2.236205475679326e-01   +4.336367148488822e-01   +9.012878842883977e-01   -3.452456135354009e-01   +1.786089848070756e-01; +4.018434447640932e-01   +3.271591068566811e-01   +9.681675283920109e-02   +3.351540824823561e-01   +2.052000233154316e-01   +4.922941288254559e-01   +8.577150025438232e-01   +4.835892392178250e-01; -2.714140260128409e-01   +4.674848219033860e-01   +3.148809685307519e-01   +2.510035478878297e-02   +8.194843855637893e-02   +2.214222275970628e-01   -5.350580159180563e-02   +7.314884583896724e-01; -9.662030358327628e-01   +9.193507531527632e-01   +6.692464705475061e-01   +6.683175134726643e-02   +3.618107408277461e-01   +2.134633590461637e-01   +5.552337015026371e-01   +2.395983460683074e-01; +2.126514535420389e-01   -3.246207650057085e-01   +2.825165899122082e-01   +2.856007773691179e-02   +3.437549562340697e-01   +6.404337415945208e-01   +3.391400255663272e-01   +3.765424921863272e-01; +7.622373440137634e-01   +3.769451614817785e-01   -4.851621971249657e-01   +2.901721402613670e-01   +3.806850263837804e-01   +3.991390383619051e-02   +6.529330893892143e-01   +6.913945137302355e-01; -6.585162627142923e-01   +8.044732686681103e-01   -1.131687911694382e-01   +8.528305425636580e-01   +6.575832356216669e-01   +3.082065719220545e-01   -6.194664707108403e-02   -1.679977727366033e-01];
L3I_L3E_iAMPA_netcon = [+1.976799130311662e-01   -3.829858249468536e-02   +2.188689499418886e-01   +2.707004631671328e-01   -1.351923756553062e-01   -7.017891565053490e-02   +1.727593914968908e-01   +2.198637988926156e-01   -6.848384223462320e-02   +5.337522221669908e-01   -7.566715542419809e-02   +2.023358710520163e-01; +6.635372641560949e-02   -9.401559671413699e-02   +3.138790680107762e-02   +6.316649709902529e-01   +3.018474055752824e-01   -1.773642781299114e-01   +4.826429797467741e-01   +4.248890088763751e-01   +3.570357563334298e-01   +6.442305345288618e-03   -1.578300198084732e-01   +3.904138848456152e-03; +8.515380137598864e-02   +4.032188202924655e-01   +5.008372569467383e-01   +1.535162295559860e-01   +6.858004108801921e-01   +3.249566097334287e-01   +5.781035915704650e-01   +2.448489083167858e-02   +4.318420645054552e-01   +3.709706259833703e-01   +1.158617117606033e-01   +4.367532192971773e-01; +5.125879486945213e-01   +3.048294657014408e-01   +5.579464394394509e-01   -1.049558368906889e-01   -8.671855332401990e-02   +7.243968795100246e-01   +8.919185629586095e-02   +2.934340878368196e-01   +2.692199807214709e-01   +2.387000932877050e-01   -1.697380774856275e-02   +9.695658567051957e-03; +4.329225601307864e-02   -1.092254595561114e-01   +8.451121408816669e-01   +2.944317536342401e-01   +2.153533439990699e-01   +3.130967861863677e-01   -7.362600516548726e-02   +3.276394216108596e-01   +2.334943951890270e-01   +4.206812178610040e-01   +4.033330228262899e-01   +1.222482024086701e-01; +8.637966548020812e-02   -1.772483145520092e-01   +8.874027497618793e-02   +1.288388211219570e-01   -2.352834780013835e-01   -6.297416542838620e-02   +2.550868106612676e-01   +2.075301516746917e-01   +2.619933150991123e-01   +4.372024326420998e-02   +1.107857531687567e-01   +6.213654484793539e-01; -3.046034854754714e-02   +1.267457955256340e-01   -2.751532861138077e-01   -3.524491145326534e-02   +9.076754254207867e-02   -5.300186166066023e-02   +4.797616504763860e-01   +2.305040177049877e-01   +1.454922579034418e-01   +1.529301517108036e-01   +4.313696596545788e-01   +1.577090717360380e-01; -4.047409029691852e-02   +2.732475120658325e-01   +1.461391418171094e-01   +1.936281617180277e-01   +7.147072121524840e-02   -1.075290946242147e-01   +2.064073775035220e-02   +1.223969120338451e-01   +4.706809002362653e-02   -3.637154897590544e-01   +1.114892003662022e-01   +1.149681943818070e-01; -1.514133120005134e-01   +5.736842813614346e-01   +1.598419051885648e-02   +1.146072331549182e-01   +8.764075152708797e-02   +6.411972580401478e-01   +1.971271482897249e-01   +4.924741214920462e-01   -6.526607736550813e-02   +1.381837436163523e-01   +6.333902236298111e-01   +7.986232541265446e-01; +6.492100049713138e-01   -5.353841282454112e-01   +7.128060080257983e-01   +1.017159535937062e-01   +1.888510221688510e-01   -4.551994364020748e-01   +3.899534460682801e-01   +2.779631285736022e-01   +7.087512637228541e-02   -2.006992441248827e-01   +9.182894874679156e-01   -1.383360309198564e-02; -5.346500122227661e-01   +3.894003595259811e-01   +7.371067836079315e-01   +4.095361691638905e-01   -1.067953053091578e-01   +8.790133002166026e-02   +2.995722923017823e-01   +8.927017802167514e-02   +5.798015350715641e-01   -1.746716884271854e-01   -4.443693381916630e-02   +3.314039401080156e-01; -2.368727011853944e-01   +2.956427466965324e-01   +2.746731502234044e-01   +3.896063041837207e-01   -1.935414019492225e-01   -1.046022915438194e-01   -2.241476575643819e-01   +1.385993851015408e-01   +5.699204808115420e-01   +2.935384727085398e-02   +2.069616269606939e-01   +7.350462110173325e-02];
L3E_L3I_iGABA_netcon = [+2.151293822768485e-01   +1.158715346430726e-01   -6.678175229004224e-02   +1.674235978315995e-01   +2.879895339266889e-01   -9.848602401099422e-02   -1.974181698579870e-01   +3.497594818383253e-01   -3.387681210321522e-02   +5.096503424840476e-01   +2.891955440358480e-01   -7.524710341499845e-02; +2.277731480016514e-01   +4.135221510399779e-01   +3.434086365202010e-01   +1.342136523011351e-01   +4.986073521525404e-01   +7.955487218755909e-02   +8.401157042408496e-02   +1.255772674790333e-01   -5.340644569509632e-01   +8.665882012865049e-02   -4.227795559917359e-01   +1.015492111876235e-01; +1.591281537192412e-01   +1.400848476610402e-03   -1.978282866202455e-01   +1.054892311692441e-01   +2.614626089325491e-01   -4.594661862780899e-02   +1.904343214699824e-01   +2.862947161107329e-01   -4.326405338973714e-02   +1.264161725538985e-01   -8.357534558266869e-02   -5.833840028285587e-02; +3.212348729666432e-02   +2.013974534607660e-01   -4.503545306724022e-01   +5.505897558398994e-01   +8.840889963515978e-01   +1.487201986393560e-01   +3.184769590424220e-02   +1.614110333872594e-01   +6.072634520895547e-01   +2.597135845999054e-01   -1.034765306866293e-01   -1.097927519358914e-02; +3.333736929351634e-01   +1.043627149411689e-01   -5.752396801512876e-02   +4.453071124925320e-01   +6.677710108647247e-02   +1.046677545175710e-01   -1.220031463567279e-01   +5.949140291208338e-01   -9.821561472032916e-02   +4.767122034708379e-01   +1.754135212465431e-01   +1.894498616165513e-01; +3.088964562906061e-01   -4.873769051160576e-02   -4.749344639412875e-02   -1.745302128528389e-01   -7.876422278289844e-02   +2.272730909896727e-01   +1.180722341619780e-01   +2.440986898945674e-03   +5.751594177630162e-01   +3.005140031867198e-01   -6.452575822875867e-02   -2.996185530647655e-02; -1.187249608471475e-01   +9.122667319528113e-02   +3.474239999889804e-01   +9.139406065328581e-01   +9.818343193698542e-02   +2.977088324938045e-01   +5.075768621006305e-01   +1.127730914808998e-01   -1.136240181412741e-01   +2.124138880260068e-01   +4.916773024369416e-01   +5.335556910122601e-02; +1.821316974900973e-01   +1.786333788407505e-01   +2.927778150430998e-01   +2.648192602303399e-02   +1.472053092185081e-01   -2.619965089822687e-01   -7.859805601770134e-02   +5.656011220039382e-01   -7.648093301197764e-02   -1.266177932800458e-02   -2.284782957261302e-02   +2.896421294372310e-01; +4.002778464579296e-01   -2.008242270980954e-01   +4.118858737107908e-01   +7.987435745972013e-02   +1.859067608893898e-01   +5.622699860873942e-02   -4.278578345376788e-01   -2.343166120259999e-01   +5.485887281291389e-01   +2.828042608415688e-01   +9.700061031027134e-02   +7.204159327095734e-01; +8.677285646355276e-02   -7.004251961381942e-02   +3.664721213797631e-01   -1.981104903707881e-02   -3.773200046086490e-01   +2.184623686846106e-01   -4.051360466283156e-02   +2.067955099666095e-01   +2.558538218734682e-02   +1.949054739697070e-01   +2.471058551584331e-01   +1.282777673942064e-01; +2.999043934498103e-01   -1.933252858371292e-02   +3.871880927420232e-01   -1.211444529375425e-01   +1.158351025074637e-01   -2.470864887833185e-01   +2.309399930353985e-01   +1.907979671331821e-01   -2.486278761306985e-01   -9.217515483628153e-02   +2.422875915272896e-01   +4.254145419579143e-01; -1.007870119959176e-01   +2.418667844558973e-01   -9.792168755759965e-02   +9.339180740020231e-02   +7.214442734915687e-01   +4.119650502412058e-01   +3.021021854459277e-01   +3.765262004634840e-01   +1.392237401731191e-01   -2.161937131283844e-01   +3.954473900792153e-01   -2.381775165951501e-01];
L2E_Input1_iAMPA_netcon = [+8.474072937016391e-01   +6.927798266841249e-01   +6.450855411063874e-01   +8.446798461276124e-01   +1.000000000000000e+00   +4.984910198265404e-01   +4.055546189809526e-01   +6.656832075598899e-01];
L2I_Input2_iAMPA_netcon = [+6.031610071463568e-01   +8.757191468186998e-01   +7.682782302115790e-01   +6.012064741084890e-01   +2.401540820942311e-01   +1.000000000000000e+00   +2.506253737952586e-01   +1.593848852274806e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
