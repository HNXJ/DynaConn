function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.182322218942523e-03   +4.688922228130502e-02   +8.724027326503886e-02   +6.562369307719174e-02   +5.903422216982879e-02   +1.023651496561737e-01   +4.711355293975700e-02   +1.427847156427703e-02   +2.384657948108437e-02   +4.506801469605009e-02   +6.045091252438570e-02   +2.567273647705344e-02   +4.022713556310547e-02   +6.687579613644905e-02   +4.417709271771889e-02   +7.333007523789979e-03; +3.807109203830911e-02   +4.296416423950533e-03   +5.196464877517778e-02   +5.955496785967739e-02   +2.603921952454065e-02   +3.038334040774357e-02   +9.470615785111008e-02   +9.802556904064555e-02   +6.434059961993063e-02   +2.351489483064923e-02   +9.823766588917122e-02   +2.067036142790924e-02   +1.776495132352779e-02   -3.811968896751612e-03   +5.761572145459051e-02   +4.044381290060102e-03; +6.726780056578069e-02   +6.940447089926670e-02   +8.906643511638961e-02   +4.837220328483231e-02   +1.032644391001653e-02   +8.880365655810482e-02   +8.683567189968551e-02   +4.464354442447195e-02   +4.438609582001350e-02   +3.781710169573722e-02   +4.739534796139963e-02   +1.956706437586277e-02   +2.023222033988341e-03   +1.843586409789937e-02   +8.580040848041025e-02   +5.676470113493703e-02; -1.114834053199620e-03   +3.763084731535636e-03   +4.758563485640066e-02   +6.320304813486187e-02   +2.072201588448468e-02   +7.388309216952881e-02   +4.692624165382780e-02   +9.426912664735593e-02   +3.942380565957172e-02   +2.681739260212791e-02   +8.692881629223069e-02   +9.210598708621266e-02   +1.641625719393216e-02   +9.231695384829108e-02   +2.242308016938774e-02   +2.968259998790576e-02; +4.862733574714009e-02   +6.625645418888124e-02   +6.256943337544150e-02   +7.380843215747843e-02   +3.761674587469249e-02   +8.919347928408564e-02   +4.869546133583416e-02   +2.351111624202998e-02   +5.272435881973558e-02   +8.360489701175784e-02   +3.619622646921696e-02   +6.714335175283956e-02   +2.311428300077291e-02   +2.688355125756422e-02   +9.792691278355266e-02   +1.565551362428964e-02; +4.884074118304061e-02   +1.156305775597222e-02   +8.673753084886901e-02   +1.679719569263617e-02   +5.870507791561658e-02   +3.248474024295897e-02   +4.039662716201311e-02   +1.999327829943724e-02   +4.525511419907038e-02   +4.600993833421647e-02   +6.817778194100509e-02   +2.168450745213040e-02   +4.605071046727580e-02   +5.476802370844782e-02   +5.017104679353261e-02   +7.033863151889869e-02; +3.195696159796240e-02   +6.717064425854405e-02   +9.110743879054255e-02   +6.451810542456550e-02   +4.254132900129148e-02   +5.994429201306670e-02   +3.942443288800419e-02   +8.557019505900025e-02   +9.654983711000667e-02   +3.704927176261480e-02   +1.466259650166979e-02   +1.792758239896189e-02   +4.492747095424104e-02   +9.291564861846149e-02   +5.834065447277182e-03   +2.440896560136378e-02; +5.589980449444255e-02   +3.596699986181584e-02   +6.957427143481625e-02   +6.174817486676409e-02   +5.958242571532037e-02   +1.770532891566691e-02   +3.184555511155553e-03   +4.695646427760070e-02   +7.403873615077858e-02   +6.387785192471036e-02   +2.492940592869477e-02   +7.781430049608080e-02   +2.430222136257653e-02   +1.133495411838643e-02   +6.526065607521242e-02   +5.953165269644042e-02; +3.568348783114094e-03   +6.384914050536777e-02   +6.515184852632962e-02   +6.363096158592665e-02   +5.484654576365891e-03   +9.128901007552438e-02   +4.090271427704732e-02   +4.624067137600566e-02   +4.938488688056479e-02   +4.787477875809873e-02   +2.074248327424082e-02   +8.877783505793188e-02   -3.836187813386698e-03   +7.426847517701865e-02   +3.310940310414226e-02   +4.384043993291024e-02; +6.524597860280021e-02   +1.477659029328405e-02   +8.870516619049459e-02   +8.201485878229842e-02   +5.880416017935292e-02   +1.689263872118909e-02   +1.336084424402274e-02   +4.985965379455492e-03   +7.409560224972568e-02   +4.138717695703736e-02   +8.738298518101286e-03   +5.442866590031099e-02   +8.723147857130027e-02   +1.919146625091532e-02   +8.418419614348242e-02   +6.157291832195524e-02; +4.244967881097400e-02   +5.070890902692413e-02   +5.068667682551057e-02   +7.650350557141858e-02   +8.815205183299468e-02   +1.876931830256939e-02   +6.003842830404087e-02   +6.007522499786135e-02   +2.361868491665657e-02   +2.351738415513082e-02   +6.970126446613038e-02   +9.331039631096846e-02   +1.620020038101680e-02   +6.794614822405921e-02   +7.758906934243036e-02   +2.035206712217961e-02; +5.083650151355684e-02   +2.638140821900797e-02   +6.917869608901774e-03   +2.078842809482036e-03   +9.022791269305028e-02   +9.286067412059716e-02   +6.273620480226172e-03   +7.091685541707543e-02   +6.695624547624007e-02   +3.005048364667922e-02   +1.341582209364451e-02   -5.881361064625551e-04   +8.954102607645614e-02   +8.248065108108217e-03   +5.229638852797380e-02   +4.308517576888926e-02; +6.520218090508983e-02   +7.527833246984809e-02   +8.362849956418709e-02   +1.685470952285305e-02   +6.439075824083146e-02   +6.663811055012103e-02   +7.387025974931644e-02   +6.805538960736018e-02   +8.301287298000871e-02   +4.514752995033976e-02   +3.800499272101336e-02   +9.364738876794042e-02   +8.286761965408350e-02   +6.892298005815027e-02   +4.730376067970662e-02   +9.057178963576185e-02; +8.068192016618558e-02   +6.425528135631162e-02   +3.161074371610786e-02   +5.644046585989856e-02   +1.540575334939231e-02   +2.652641789902373e-02   +1.306002250738492e-02   +2.125943175439887e-02   +3.139364574699099e-02   +7.176702105857495e-02   +1.959409425626427e-02   +8.501895494180166e-02   +5.856729264585655e-02   +6.515722980100395e-02   +3.986206490379048e-02   +3.396479098463262e-02; +1.617487080288421e-03   +5.393733165528210e-02   +8.570528360626826e-02   +5.464320194724315e-02   +3.111115254907364e-02   +1.703211316287084e-02   +2.714262962558533e-02   +4.101777772244235e-02   +2.456514728378149e-02   +9.488046753335413e-02   +3.015358745138666e-02   +8.709361676434239e-03   +1.208909197452252e-02   +7.203508240586333e-02   +4.952373012721054e-03   +6.327403392104758e-02; +7.788286970666834e-02   +3.327858949182066e-02   +1.988571086812096e-02   +9.424547855286648e-02   +9.117438497256273e-03   +1.359838066893251e-02   +8.510277740618342e-02   +1.169297215987862e-02   +5.386470644137855e-02   +7.925445542473054e-02   +7.091486173564011e-02   +1.402768192417135e-02   +7.462112640205691e-02   +7.642676397866688e-02   +9.525425879079939e-02   +8.891993911854079e-02];
L1E_L1I_iGABA_netcon = [+4.574271210512316e-02   +5.725525378723275e-02   +4.712434511141087e-03   +2.619095365693978e-02   +8.102119218006365e-02   +4.001143177069386e-02   +3.596365551348326e-02   +2.021947291032199e-02   +8.287126398960242e-03   +3.107730132059603e-02   +3.385725214745212e-02   +5.739465126591375e-02   +2.865500759604326e-02   +8.640589944120960e-02   +2.159026279570421e-02   +4.636932160990484e-02; +5.633592331990091e-03   +8.936339265835307e-02   +5.290660821078181e-02   +8.311352430908660e-02   +4.284904349796497e-02   +4.581142753857385e-02   +1.539092830631032e-02   +5.070854619845332e-02   +5.031725193816252e-02   +1.303832778274263e-02   +1.721302387197159e-02   +6.858495850000297e-02   +4.080045388390893e-02   +6.964164424145516e-02   +4.956554445359351e-02   +6.869252705257867e-02; +6.125442140884049e-02   +9.567429751652438e-02   +8.372685170010095e-02   +6.723104765364379e-02   +1.366772981006252e-02   +5.172945768171545e-02   +6.400381531015022e-02   +8.898600283811782e-02   +8.884217665358148e-02   +9.889184044939671e-02   +6.717354141083151e-02   +5.179208603732854e-02   +9.548464039962232e-02   +8.046184385136444e-02   +4.137164521913053e-02   +5.672332199347461e-02; +2.594689469195228e-03   +1.709527110646090e-02   +9.024475267900142e-02   +1.030268769132844e-02   +1.658938794612029e-02   +7.145351510001399e-02   +7.655434083273724e-02   +4.960250608097204e-02   +5.250015320354835e-02   +9.915329937995174e-02   +6.496543601843331e-02   +8.866581537917455e-03   +3.409137292140794e-02   +2.069577502681396e-02   +1.027328488190075e-02   +9.956730567666520e-02; +4.329764813019772e-03   +9.027554386018832e-02   +4.912259896063999e-02   +1.296665725712091e-02   +4.109413014071640e-02   +8.437158126848626e-02   +6.989427960518294e-02   +4.185074929271014e-02   +2.005586599493619e-03   +1.831502917266181e-02   +6.629253131710172e-02   +1.129963319741301e-02   +8.201422118938369e-02   +4.114015885016114e-02   +6.083024769792303e-02   +4.737931032461457e-02; +8.108393704162171e-02   +8.988778022947332e-02   +9.808209385811896e-03   +6.827798500018407e-02   +3.199408239230232e-02   -5.406810982309512e-03   +6.710035979093097e-02   +2.671186032262138e-02   +8.589261446270753e-02   +1.679464058144909e-02   +8.971987150957506e-02   +1.620487841766414e-02   +3.779614093026968e-02   +6.814425078523928e-03   +6.106598649892193e-02   +1.442050647664161e-02; +4.927124699477407e-02   +2.277752317642974e-02   +1.766240626347917e-02   +2.691240859025937e-02   +1.262650854585658e-02   +3.725701382355894e-02   +3.482129599372474e-02   +4.998053256834303e-02   +8.933747021813888e-02   +1.802467990915350e-02   +7.655081011497525e-02   +9.764092401488773e-02   +1.013766754497403e-01   +4.655511483678428e-02   +5.145895533593833e-02   +3.127166308023731e-02; +2.847613813348664e-02   +1.793949318759087e-02   +4.252689655567589e-03   +1.592064075061475e-02   +6.737766966824914e-02   +5.106187355539474e-02   +5.103655608034765e-02   +5.776681202199675e-02   +2.077517403777753e-02   +4.007802891701796e-02   +8.561707084726551e-02   +9.840223936843903e-02   +5.305981319676460e-02   +4.712890782953350e-02   +1.515245289720662e-02   +6.672783327483535e-02; +3.373047196303815e-02   +5.887159004371723e-02   +3.001486232198326e-02   +7.968812398935985e-04   +1.637293580289926e-02   +6.425250170599792e-02   +7.909692057284753e-02   +8.662108207332976e-02   +3.554164114857979e-02   +1.030134732437078e-02   +7.088673892286962e-02   +4.122952863238553e-02   +9.024738584500044e-02   +9.772100894509393e-02   +5.657011604899612e-02   +1.099267513724796e-02; +5.187327479393646e-03   +3.929965869384239e-02   +2.220609853012988e-02   +5.670817626053952e-02   +3.418160314701646e-02   +7.800549867767026e-02   +2.754209720589550e-02   +2.552259789109099e-02   +9.234949199805551e-02   +7.711933371046892e-02   +2.520385478810647e-02   +5.649310927649898e-02   +7.445270278679790e-02   +1.692515907075336e-02   +6.771208474046819e-02   +2.289191245356454e-02; +8.363489523380332e-02   +7.420378013720554e-03   +3.319230798900363e-02   +4.221938667660816e-02   +5.464570198226301e-02   +6.760117571573344e-02   +4.514154743556519e-02   +9.820795972847284e-02   +3.572717286806786e-02   +3.790843069695906e-02   +5.916687305869562e-02   +4.929796973259833e-02   +2.244362607576613e-02   +9.680714839490002e-02   +8.142963986043859e-02   +3.046661020755034e-02; +1.748953059346433e-02   +9.299829158715636e-02   +5.193762547317253e-02   +8.995730327737606e-02   +9.582341266016509e-02   +6.892983810323960e-02   +4.781056665485982e-02   +1.271391485167775e-02   +6.953186828642099e-02   +5.107570820024967e-02   +2.972009602038628e-02   +7.951890871967604e-02   +7.023073059417301e-02   +5.041147825028314e-02   +7.929684530164351e-02   +1.961396888384820e-02; +7.092701940606691e-02   +7.426078890105661e-03   +5.540627346874491e-02   +1.218943237282552e-02   +5.295712119053499e-02   +5.319649908488618e-02   +5.883031529580038e-02   +2.241286537136311e-02   +7.126483593871488e-02   +8.644294047602850e-02   +2.542537997233663e-02   +8.129865921305132e-02   +9.634818782405007e-02   +5.874028439563772e-02   +3.414515355528593e-02   +9.501625827302412e-03; +2.590511711927028e-02   +2.972327897518227e-02   +2.652693472741273e-02   +1.103916534695343e-02   +2.043372989795065e-02   +8.601970816584417e-02   +9.146849569142272e-02   +7.262157868461512e-02   +4.615934360425478e-02   +6.066011844837225e-02   +9.592596623852770e-02   +7.332135575234040e-02   +6.344557979123182e-02   +8.170378272506390e-02   +6.139868949064439e-02   +6.917689316797651e-02; +4.574276291919443e-02   +2.201038956481388e-02   +4.396193382334346e-02   +8.132769866109830e-02   +5.779992257920447e-02   +5.253477559032405e-02   +1.216034645497145e-02   +3.201761302567367e-02   +1.277872646388701e-02   +5.417479289679688e-02   +3.011179058030860e-02   +4.415525840266667e-02   +3.078067048731536e-02   +2.585575617377985e-02   +9.592138258241302e-03   +2.433675682268291e-02; +3.885711193590609e-02   +2.018597733203834e-03   +1.844268196142219e-02   +9.291388946005943e-02   +9.509157523466626e-02   +1.043644670614468e-02   +2.208569983730476e-02   +8.622865141462888e-02   +8.243399358431225e-02   +1.061120656252986e-02   +3.468548775910836e-03   +6.174372326878195e-02   +6.770624646820123e-02   +4.888144718609552e-02   +4.183331682347362e-02   +4.635016203661672e-02];
L2I_L1I_iGABA_netcon = [+9.925138515481387e-02   +4.542459781028048e-02   +3.455084494184003e-02   +8.504085496044472e-02   +9.535378241017249e-02   +9.184481058588338e-02   +3.789056936424546e-02   +7.399212990230913e-02; +7.895036615303321e-02   +7.781073103773886e-02   +6.898501402438674e-02   +2.636884315622239e-02   +3.954474751036372e-02   +6.162141881848405e-02   +8.717905449632914e-02   +2.587435246925717e-02; +1.654410027310995e-02   +2.103318886611818e-02   +2.256093407839421e-02   +4.101303982906831e-03   +7.634216104625019e-02   +9.319774661000685e-02   +9.386868800577283e-03   +5.920693826534504e-02; +3.970789065979917e-02   +7.793836025276031e-02   +7.017178677621172e-02   +6.196685599018417e-02   +6.072632327815680e-02   +5.744896397039969e-02   +4.899124019800739e-02   +7.490157656466341e-02; +3.358884608370646e-02   +1.183407063934809e-02   +6.399399522862044e-02   +5.946799106219013e-02   +4.150757127888074e-02   +6.954455657616737e-02   +4.708428900844052e-02   +5.304533600611797e-02; +7.636382147670895e-02   +6.856919333017741e-02   +9.349131052221596e-02   +4.813171366092982e-02   +2.265037446678971e-02   +6.536104587473976e-02   +4.707195630042563e-03   +6.880682924991523e-02; +1.091924587342263e-02   +4.458797222740629e-02   +4.134565899174501e-02   +2.548327417628162e-02   +7.282865758341095e-02   +2.733237306513605e-02   +2.284013860423944e-02   +6.985111545290874e-02; +6.174591797268469e-02   +3.235069778016016e-02   +7.676937121411510e-02   +4.489788710996591e-02   +2.811581613583082e-02   +7.254851703078767e-02   +4.230733073144097e-02   +3.372654394680532e-02; +4.688031223585775e-02   +6.749941894892111e-02   +2.067264640756236e-02   +2.215316417511062e-02   +3.160020082137078e-02   +1.663875506320802e-02   +4.275124601762013e-02   +1.013155163451310e-01; +5.843619275925401e-02   +6.532189222099871e-02   +2.214315740569757e-02   +4.661066741805537e-02   +6.107400449825695e-03   +6.964073981723350e-02   +8.893761632786898e-02   +6.536159526417212e-02; +5.141893776356256e-02   +7.678700841062906e-02   +8.077235473984194e-02   +3.307108863767259e-02   +6.878577012242024e-02   +9.025481866556170e-02   +1.782748413051510e-02   +2.374290628962238e-02; +8.196059682767687e-02   +4.946321380604272e-02   +6.358742485756567e-02   +4.260852640089186e-02   +8.734725267222213e-02   +2.222943446617752e-02   +6.057398807891354e-02   +3.343134554697412e-02; +3.095089653201768e-02   +9.709656869685312e-02   +8.722328489512299e-02   +1.228062403697575e-02   +5.254768971922735e-02   +3.611011870822905e-02   +3.027468970149149e-02   +5.482249652245075e-02; +7.264667500588692e-02   +2.182348007258219e-02   +9.811536772141244e-02   +5.123340229240906e-02   +8.293109742338710e-02   +1.945360597743077e-02   +9.104694431628284e-02   +2.389476994366492e-02; +9.933922145013943e-02   +2.375529418209524e-02   +2.762400414175179e-02   +9.175557050967635e-02   +6.536886694083550e-02   +1.428270203698969e-02   +3.868485565289612e-02   +6.675950597426104e-02; +1.985181323038572e-02   +6.802567893322820e-02   +6.626549259398194e-02   +6.227005768590509e-02   +8.615930839497958e-02   +1.404752587417373e-02   +9.784650741367398e-02   +2.900113378588866e-02];
L1I_L2I_iGABA_netcon = [+5.623577425568750e-02   +6.874006434898164e-02   +2.224211810370970e-02   +5.223960830935696e-03   +5.502248673797817e-02   +3.061497847235584e-02   +9.625048136323491e-02   +6.335871057717367e-02   +4.091552639101545e-02   +7.603700418133688e-02   +1.844641599502155e-02   +3.000015265860249e-02   +1.091829468221259e-02   -3.065809296076655e-04   +2.045864506861519e-02   +8.241143923869645e-02; +7.577591746446041e-02   +6.308002146028682e-02   +3.883534146612407e-02   +5.228042249615525e-02   +9.648618395870873e-02   +4.504323155697194e-02   +6.181594751626014e-02   +9.299805441115296e-02   +4.909642926946539e-02   +9.404865765054472e-02   +6.445928987284484e-02   +3.555500043643460e-02   +5.128751045285755e-02   +6.190613960983247e-03   +4.027916212752415e-04   +8.871212718291721e-02; +8.822103166038622e-02   +5.727980983982831e-02   +1.990760634401157e-02   +7.564424472003582e-02   +3.375548143465304e-02   +8.514524113394427e-02   +6.839293440452636e-02   +6.529231527722518e-02   +3.313690374610912e-02   +4.124814496912511e-02   +6.071518077758119e-02   +4.426376286587998e-02   +3.266375888790431e-02   +1.448932048234464e-02   +5.798219351903996e-02   +1.764339405750984e-02; +4.189703610255704e-02   +4.004709208291238e-03   +5.812101230687564e-02   +7.914728098273879e-02   +1.418186642177918e-02   +4.913549995671541e-03   +3.526089644657748e-02   +2.874910817200549e-02   +3.039532904651577e-03   +6.250263544419106e-02   +5.223172616967452e-02   +4.443587959350868e-02   +2.357965061049187e-02   +4.485484505241352e-03   +8.010337969688557e-02   +5.224214532575838e-02; +7.753024463594162e-03   +8.203747415483943e-02   +7.125490195620809e-02   +6.551549611535835e-02   +6.114533818631568e-02   +4.951806261280553e-02   +5.689077194660823e-02   +8.441058936866014e-02   +5.951791818170692e-02   +4.975626734320733e-03   +3.025593370683065e-02   -1.741174783670998e-03   +2.743839062974338e-02   +8.418132014884229e-02   +1.960081064711433e-02   +5.316166443144173e-02; +5.941987393648109e-02   +6.852421929566756e-02   +7.481411372408691e-03   +9.036974269271093e-02   +5.847185023415384e-02   +9.309863059106355e-02   +6.893837049760253e-02   +7.734418671718933e-02   +5.536624987166675e-02   +5.769062489957576e-02   +9.731485666086293e-02   +7.661267232680011e-02   +1.238891190139167e-02   +9.095897358904374e-02   +6.837846981478178e-02   +9.216021360827817e-02; +7.758033528156086e-02   +1.272076247548552e-02   +8.847565893604899e-02   +9.712492632723850e-02   +3.923216539955083e-02   +9.822208693951988e-02   +5.165587649105260e-02   +4.546739812752260e-02   +1.618600132649493e-03   +5.578364394039556e-02   +3.522055652417131e-02   +3.297876413781070e-02   +7.333153349642890e-02   +3.835399947325980e-02   +7.956377269856564e-02   +5.834297073797284e-02; +6.534642490236778e-02   +6.472035614946682e-03   +8.441837932279177e-02   +7.131765437987789e-02   +4.977126310045482e-03   +7.505754023690936e-02   +6.136554449332068e-02   +7.932733783512685e-02   +3.760742686454201e-02   +8.517015422676129e-02   +2.394277938959959e-02   +5.028028581359481e-02   +4.679452971291416e-02   +5.778204455361920e-03   +8.445616546234913e-02   -8.192589007699581e-04];
L2E_L1E_iAMPA_netcon = [+8.194723087085658e-02   +2.869312433725476e-02   +1.142710337795876e-02   +9.757095003228179e-02   -2.075423035341865e-03   +4.662510557806953e-02   +6.140988928305965e-02   +7.558353115194095e-03; +9.451002707337912e-02   +8.674871074838483e-02   +5.608237432598273e-02   +3.799986341095198e-02   +4.631742528480907e-02   +2.055376510172200e-02   +9.166167357402347e-02   +4.074626251350692e-02; +1.158619280478413e-02   +1.728860712962434e-02   +2.645215212455301e-02   +1.702379864748674e-02   +5.903606855061245e-02   +7.949036451540431e-02   +3.431220166238971e-02   +3.347106636745124e-02; +2.515525185765570e-02   +7.326345736389608e-02   +1.840252066282298e-02   +6.770643476838245e-02   +8.062957153424169e-02   +3.054132568897864e-02   +8.952483356126062e-02   +9.007360805207261e-02; +1.896254607206790e-02   +9.934970470893643e-02   +1.423850822095033e-02   +3.017317529183335e-03   +9.009465156992388e-02   +9.463192927904530e-02   +6.923715986534167e-02   +3.805638566402201e-02; +7.216624499643408e-02   +5.485457106639872e-02   +9.055836961761037e-02   +7.866155517672264e-02   +6.374493268318959e-02   +2.248868404739606e-02   +7.414211591514805e-02   +6.399383152796587e-02; +1.002301385854464e-02   +3.064171576411728e-02   +2.376578041025297e-02   +4.160155950150847e-02   +8.636274953292371e-02   +4.519472863582520e-02   +1.765422938460197e-02   +3.066772613592312e-02; +8.212736173271135e-03   +1.603757965201640e-02   +5.419015171631893e-02   +6.296951754632783e-02   +3.685502565550092e-02   +9.067878242777162e-02   +9.278240299507690e-02   +8.831316689488736e-02; +3.663968232891385e-02   +9.004476004560298e-02   -2.535621249729301e-03   +3.027650163789525e-02   +1.852300628851756e-02   +9.824459279458921e-02   +5.761295344962018e-02   +8.206224383906436e-03; +2.762248601817419e-02   +2.285263449530344e-02   +8.635337991925168e-02   +3.920826294820356e-02   +8.330648547849173e-02   +7.819314267424219e-03   +1.746228293531449e-02   +9.429098594896752e-02; +5.315124213703037e-02   +4.505825793491815e-02   +1.516240481778875e-02   +5.916083719111306e-02   +3.835792289530048e-02   +3.732239816815318e-02   +5.699628082025750e-02   +8.722174450262941e-02; +2.105153861779166e-02   +4.859950407693311e-02   +8.036968075021551e-02   +7.069649952906672e-02   +6.578936119091301e-02   +2.183167505046528e-02   +9.562441394231178e-02   +2.583538879244410e-02; +5.451347655523331e-02   +8.107491613854967e-02   +2.190148536487438e-02   +4.445103011784557e-03   +9.589736244375947e-02   +6.882101263535824e-02   +3.958967509449111e-02   +8.128508817468297e-02; +4.074089401228941e-02   +5.500162165517629e-03   +8.328561027360350e-03   +7.260737740881214e-02   +5.626410928963552e-03   +2.805469976498094e-02   +8.538519584063837e-03   +7.752163996846577e-02; +3.051126476958413e-02   +1.563875026068001e-02   +6.407062957399351e-03   +7.979242158761976e-02   +9.968160623615815e-03   +9.767675242381070e-03   +4.380179189354958e-02   +2.025780326668639e-02; +1.165860630717471e-02   +4.691789636651129e-02   +5.365109661727169e-03   +5.555571146931286e-02   +2.287799770504031e-02   +5.809381128367971e-02   +7.526621785371376e-03   +8.256433499402388e-02];
L1E_L2E_iAMPA_netcon = [+3.684519061785559e-02   +2.129204745412659e-02   +9.478475923486988e-02   +9.299972669808056e-02   +2.967437644824160e-02   +9.058780817005735e-02   +4.837051542048736e-02   +9.501282965390626e-02   +1.781000660816994e-02   +6.192651877813928e-02   +5.911464359326279e-02   +7.392525521156389e-02   +3.786111196246603e-02   +6.444056684565795e-02   +4.952491453653922e-02   +4.686753394774700e-02; +3.957764121940264e-02   +5.700023118218134e-02   +1.845052407221996e-02   +6.982962690156706e-03   +9.752630342981617e-03   +6.534531891162972e-02   +3.835338423342575e-03   +3.153320110508365e-02   +2.735257081382928e-02   +2.901945356507614e-02   +2.398886122039454e-02   +9.593245781097200e-02   +1.465834042059741e-02   +2.077105673689156e-02   +5.808514150261528e-02   +2.847299024901609e-02; +3.615910699428472e-02   +5.950347386502249e-02   +8.525653332743739e-02   +9.001627818843055e-02   +9.132738010883967e-02   +8.629754293947937e-03   +3.034745032716899e-02   +3.891502388428837e-03   +4.244680379944846e-02   +6.132609112777387e-02   +3.363944733562184e-02   +4.255541572464998e-03   +6.698235966752536e-02   +5.707234640158929e-02   +8.542737670296599e-02   +8.405541310851949e-03; +7.036554082698880e-02   +6.239123299082258e-03   +2.106930619387541e-02   +1.564763920539306e-02   +6.894679547680185e-02   +2.954653348265528e-02   +9.462011534273713e-02   +8.708792206218152e-02   +7.539948907618452e-02   +7.708013071506190e-02   +4.405514333669468e-02   +5.498630275233686e-02   +9.488089264660364e-02   +3.098684039639303e-02   +9.010761418043421e-02   +8.993145860728850e-02; +1.761806931053057e-02   +9.507267445805555e-02   +8.286597022631791e-02   +5.273832124149028e-03   +2.097804714766259e-02   +7.614145130176855e-02   +8.429395906134297e-02   +1.740892190878547e-02   +5.397984361731986e-02   +4.109809963906992e-02   +5.657044144569980e-02   +7.533514316440165e-02   +2.571375597490699e-02   +5.785301637699101e-02   +9.827972872461410e-02   +2.033095226526037e-03; +4.869354491902633e-03   +9.006213438451606e-02   +3.320322605982041e-02   +8.191432268334808e-02   +9.685438964112614e-02   +8.625571432457461e-02   +4.629446278307967e-02   +8.745909834722766e-02   +3.339037335757083e-02   +4.135038202330305e-02   +8.551388198518844e-02   +9.172352870746281e-02   +7.919259106686385e-02   +5.966440878763998e-02   +1.429490480945293e-02   +5.654092046837766e-02; +3.115452910505967e-02   +1.773670341698084e-02   +6.140835425998847e-02   +2.580788829572393e-03   +3.965421423083028e-02   +5.029728166672364e-02   +7.496897822484690e-02   +5.718268327978539e-02   +5.420946499858328e-02   +7.783978675274805e-02   +6.524613616729980e-02   +1.198585153831329e-02   +4.057465683689505e-02   +5.775611273260047e-02   +1.953882468592782e-02   +3.039558767396185e-02; +6.291440952389012e-03   +5.289526677306442e-02   +4.505325646013526e-02   +3.883663250409890e-02   +7.098657222971905e-02   +9.831226964157909e-02   +9.609564723660785e-02   +5.961481472935554e-02   +8.629593683490824e-02   +4.228001939942412e-02   +3.577892652251930e-02   +9.751235357937012e-02   +6.930947979962662e-02   +8.399219988525633e-02   +2.694465303580761e-02   +1.287666106796681e-02];
L2I_L2E_iAMPA_netcon = [+6.682683005674940e-02   +3.020447926114225e-02   +8.474886322180171e-02   +4.104883032881627e-02   +7.715524021510003e-02   +4.306981499951626e-03   -1.086307310498519e-03   +8.769169944272298e-02; +1.495582626961826e-02   +1.824681715215260e-02   +1.703511252486694e-02   +7.592922949643792e-02   +7.904077080350717e-02   +3.498628349590067e-02   +7.052700335442254e-02   +4.613028463782233e-02; +8.309058261789182e-02   +7.640477102447552e-02   +8.171368869499843e-02   +6.806100191404964e-02   +5.040780684318032e-02   +5.598923720906881e-02   +4.684327936101786e-02   +7.224186380836084e-02; +3.705848151631980e-02   +2.080111086087068e-02   +8.667223518958184e-02   +4.346762095562991e-02   +9.803971719308001e-02   +1.556905658403426e-02   +4.523035077913404e-02   +8.708026179633932e-02; +6.258926403088198e-02   +8.680085593254744e-02   +5.751058049166503e-02   +5.784607797723600e-02   +8.925432663752084e-02   +7.762952231993826e-02   +4.101587144686748e-02   +7.428321835186624e-02; +5.629803575730930e-02   +2.842882841048979e-03   +8.611071263117155e-02   +7.347999868152626e-02   +5.673853740249448e-02   +2.127806608902402e-02   +1.173527381440755e-02   +6.936172066866717e-02; +9.832685694167334e-02   +4.791421391624301e-02   +1.139040659495936e-02   +6.560816856981606e-04   +1.536069223449999e-02   +2.504867555498808e-02   +1.858809655554023e-02   +2.184262501977911e-02; +9.427237721358636e-02   +2.529770931255463e-02   +5.423144749070296e-02   +5.001188174197963e-02   +8.400362337153389e-02   +2.625482922731662e-02   +9.064811926377658e-03   +8.270557577444229e-03];
L2E_L2I_iGABA_netcon = [+9.037034111626836e-02   +1.782270314182531e-02   +1.832132634153518e-02   +1.494904050911389e-02   +6.489451698243745e-02   +3.922295775133938e-02   +7.810776711581721e-02   +9.046222728624766e-02; +2.389107950615228e-02   +3.745325287513806e-02   +1.369476941720583e-02   +3.548418187850388e-03   +9.841718532476197e-02   +6.728986950368211e-02   +7.419510155637185e-02   +5.394220451953828e-03; +6.742641799810914e-02   +3.625692454401296e-02   +5.398873379211447e-02   +1.029561881073381e-02   +3.324525048642507e-02   +4.754252726300217e-03   +8.883800540089543e-02   +7.974754723586572e-02; +8.059711079068423e-02   +3.691843402242084e-03   +2.584766957340883e-02   +7.258297669433622e-02   +8.809643402022227e-02   +6.514079736379323e-02   +4.536096953861367e-02   +6.353811225750673e-02; +1.399368465548132e-02   +8.597749174488820e-02   +5.649636781082461e-03   +8.044640243726703e-02   +3.150404854619159e-02   +3.524489228796801e-02   -4.668970459425685e-04   +2.479250576977021e-02; +7.211279657441101e-02   +1.340086969375678e-03   +5.106431384729473e-02   +7.781436966738378e-02   +9.003063376240246e-02   +2.735293916073108e-02   +8.908961680666178e-02   +7.638130821377306e-02; +1.534462694307430e-02   +9.667506646915296e-02   +2.749141551288073e-02   +1.815697674544824e-03   +7.511273336229372e-02   +4.705039495223062e-02   +5.970531646878253e-02   +5.532652167305086e-02; +8.333783624510625e-02   +3.051472499525501e-02   +5.364164054574096e-02   +1.945295958783465e-02   +4.180773207745138e-02   +7.782819425496902e-02   +9.287240448213710e-02   +6.273266124537775e-02];
L3E_L2E_iAMPA_netcon = [+3.367760082580731e-02   +6.665796565981891e-02   +8.396931237699266e-03   +7.168944054970145e-03   -9.584094435444116e-04   +9.227265433254192e-02   +3.779865281034781e-02   +8.656575332257797e-02   +1.325816678922748e-02   +2.493402322970203e-02   +2.600527962396536e-02   +9.819978562255348e-03; +2.912745999331776e-02   +8.794607890653995e-02   +2.851659062825454e-02   +3.576479395876282e-02   +4.688881566609343e-02   +5.353915486468359e-02   +8.661558393894844e-02   +9.683925388781520e-02   +6.059070087149264e-02   +9.372099441653904e-02   +3.241180484370069e-02   +2.556268603678494e-02; +1.009854271345277e-02   +7.839273545602819e-02   +1.425008965963824e-02   +7.155745274440131e-02   -8.876438981308717e-04   +1.039149154534511e-03   +5.610273280924209e-02   +9.898050126553930e-02   +5.950133941334843e-02   +5.567802592413343e-02   +2.701587092475067e-02   +6.666111007232993e-02; +4.803718001046842e-03   +2.054899995600238e-02   +7.805976653370937e-02   +2.976737430616340e-02   +2.707705421350140e-02   +1.443083759284713e-03   +3.431131174103096e-02   +4.379831159977477e-03   +2.002449306826357e-02   +3.325569802138998e-02   +1.979908136496853e-02   +3.188343561493812e-02; +8.806207473820761e-02   +3.762113244480497e-02   +3.548432781415808e-02   +9.188497489722028e-02   +6.902938290889438e-02   +3.767946739033338e-02   +9.417426240590643e-02   +1.712577539301448e-02   +8.350946494397712e-02   +4.621858147321718e-02   +7.038566667090207e-02   +3.323357943994960e-02; +8.626217571787345e-02   +6.140006516046607e-02   +9.649412607473349e-03   +4.443827511475513e-02   +5.962355150870353e-02   +1.015439330393926e-01   +9.143202443302084e-02   +3.290935258301930e-02   +4.709876882009718e-02   -4.140381438819913e-03   +6.218972722090391e-02   +2.274765110362242e-02; +5.939977815108501e-02   +4.776064284590616e-02   +6.444107012838621e-02   +2.817803171435546e-02   +7.814176066129239e-04   +3.636179110646594e-02   +1.168485074878034e-03   +3.399504407424106e-02   +3.371234215366891e-02   +8.142627875628392e-03   +2.768884650259217e-03   +4.066505437271783e-02; +8.324275523008204e-02   +1.422357443493912e-02   -5.502609569109379e-05   +2.892274025847116e-02   +5.175816896101276e-02   +8.217631846799156e-03   +6.595849396232874e-03   +4.423904318610366e-02   +5.272055576318393e-02   +8.384069587721177e-02   +7.076998367469307e-03   +5.885898565924792e-02];
L3I_L2I_iGABA_netcon = [+9.581281350367836e-02   +5.380621641355269e-02   +5.854503931899339e-02   +3.197414928411536e-02   +9.093347795392766e-02   +3.965695693677894e-02   +7.573508737178718e-03   +3.309634254295665e-03   +8.761312280504026e-02   +4.381701649745030e-02   +7.675001528829150e-03   +7.764047809207544e-02; +8.831370281424188e-02   +9.406029462364357e-02   +8.135025047583094e-02   +1.422707288864111e-02   +4.633649647863489e-02   +7.966887011779913e-02   +7.500386290892419e-03   +1.414565525820235e-02   +4.581105458545099e-02   +6.666663827769617e-02   +1.192990094581147e-02   +6.248588110558553e-02; +7.953131924544395e-03   +8.449700884882205e-02   +9.556064940344378e-02   -1.585896926714571e-05   +6.680422521429068e-02   +3.441338334626684e-04   +6.328828117139031e-02   +9.007286369344486e-02   +7.035455083127101e-02   +1.522440041223737e-03   +6.474197336665026e-02   +1.269450293237116e-02; +9.632657204912536e-02   +5.504809516238738e-04   +5.327149373092165e-03   +6.419653061595666e-02   +8.565643648329463e-02   +5.805129625786370e-02   -3.799209544473927e-03   +6.757357799140907e-03   +8.940113061792268e-02   +7.738918689772836e-02   +9.714291272356587e-02   +5.183995228225067e-02; +1.936179896175864e-02   +9.707553209425662e-02   +3.978800064851547e-02   +4.129528112499126e-02   +5.635333539133841e-02   +9.230040260961075e-02   +3.684079924251314e-02   +1.549452338564873e-02   +9.685602930151514e-02   +5.106658945774112e-02   +2.602968672850578e-02   +1.592656344937492e-02; +1.330349227578103e-03   +6.964791192245146e-02   +2.213851477835528e-02   +2.275893966805260e-03   +1.436417159989438e-02   +6.340964998834450e-02   +7.384140693891987e-02   +1.891866633949072e-02   +4.779061118126739e-03   +7.541561810274422e-02   +8.188425522476460e-02   +5.329775396340883e-03; +6.308616444007592e-02   +9.049979536038950e-02   +5.369803418418041e-02   +6.567630301834780e-02   +4.396178927788909e-02   +2.404220908825946e-02   +6.316823436313478e-02   +5.367900966579383e-03   +8.999737848044034e-02   +3.479903590503285e-02   +4.659365097158297e-02   +7.283305379554515e-02; +4.744676380334409e-02   +2.281166621625576e-02   +3.335517910763447e-02   +5.879615219465488e-02   +3.655942686559690e-02   +1.168607217642876e-02   +2.324202133398466e-02   +2.831292258214397e-02   +5.657524524693254e-02   +9.653632585277633e-02   +2.519722889641835e-02   +2.801114776591481e-02];
L2E_L3E_iAMPA_netcon = [+6.190270917632762e-02   +6.648110758324741e-02   +2.393288755942582e-02   +8.166355595176229e-02   +7.064600433804274e-03   +5.226833584839671e-02   +6.814882702152621e-02   +9.545667358080011e-02; +5.116766304139882e-02   +6.644486726556482e-02   +7.450665950766361e-02   +7.996407985871648e-02   +2.589145645558436e-03   +5.424113473528104e-02   +8.067419675373014e-02   +6.417530164473743e-02; +7.792640733937373e-02   +8.537437264028318e-02   +8.421229871920410e-02   +9.367709231424558e-02   +5.776441244636427e-02   +6.467302684740979e-02   +8.778229469514544e-02   +5.785850863610946e-02; +3.745383389766014e-02   +9.514242016373328e-02   +8.201884424919260e-02   +6.305359186762202e-02   +4.802598222129656e-02   +5.300550256037796e-02   +2.716674242373550e-02   +1.416746450149874e-02; +1.010756392454842e-02   +5.461232342877716e-02   +2.772416937071410e-02   +4.081558492736679e-03   +1.535211815319082e-02   +5.110756693113525e-02   +8.690166405707893e-02   +7.842173700746774e-02; +4.772704767889017e-02   +1.028527142315776e-01   +8.661288969275671e-02   +5.310009324985271e-02   +5.348925771849236e-02   +9.231198925782674e-02   +6.908396694401379e-02   +9.502045129968216e-02; +4.990988612030080e-02   +7.850247846487080e-03   +4.922477105992789e-02   +4.332848015928495e-03   +3.355098720149933e-02   +8.146357179207031e-02   +3.416887281390629e-02   +7.801946409438526e-02; +8.646886844941490e-02   +6.457931842415873e-02   +4.843352699572005e-02   +7.764915120883238e-02   +3.744982069116753e-02   +7.738179268576383e-02   +4.757877424398980e-02   +3.346315103671476e-02; +4.505839831194448e-02   +5.073963263846482e-02   +9.271065358013039e-02   +5.792167871982418e-02   +5.988870926615419e-02   +3.459118275880742e-02   +5.488959462674284e-02   +6.405372096875418e-02; +2.075576231160610e-02   +1.743195148220624e-02   +7.691798465651087e-02   +8.333570760104043e-02   +9.294417966574268e-02   +1.500909842442309e-04   +1.055373425746615e-02   +6.312292419054383e-02; +5.908683628246481e-02   +2.635064741712339e-02   +7.453014010637583e-02   +7.904312509814265e-02   +9.002833574848361e-02   +1.011729000890655e-01   +2.339052123300591e-02   +3.192908647705191e-02; +1.143007920099237e-02   +5.654263858521386e-02   +4.100523840633147e-02   +8.767121650862056e-02   +4.783549463175317e-02   +2.001043622639869e-02   +6.077638355483807e-02   +8.697949643711739e-02];
L2I_L3I_iGABA_netcon = [+9.206767793151968e-02   +4.147391579236809e-02   +2.420287507497208e-02   +6.716075382457214e-02   +7.379619524322878e-02   +8.575794050930888e-02   -6.237947594975926e-04   +5.090529444155112e-02; +5.236839632345358e-02   +4.163168394192822e-02   +7.328656015567582e-02   +1.512158529147747e-02   +8.636683144927725e-02   +8.215072735208817e-02   +4.680902519781446e-02   +2.708462448515294e-02; +7.704175647569164e-02   +7.136941218962854e-02   +9.223514127665432e-02   +5.614144067679397e-02   +3.511239946510796e-02   +6.108422561111922e-02   +4.575467676016935e-02   +1.505678312169792e-02; +2.001641327227160e-02   +8.092973728898607e-02   +2.318400426377584e-02   +4.437702075271457e-02   +6.282873512661112e-03   +3.036821218963195e-02   +4.008399462542322e-02   +1.014956498191381e-01; +3.137084625642748e-02   +3.552913113007267e-02   +5.150205298020225e-02   +4.448903728493897e-02   +3.900096177410076e-02   +6.538275160812107e-02   +1.215379980608609e-02   +1.585235240709351e-02; +6.534587824815982e-04   +2.767648687006721e-02   +3.609375475742712e-02   +1.590687499792806e-02   +3.486113221983841e-02   +4.078092578410719e-02   +5.197055052780968e-02   +7.241995490532901e-02; +3.653010985516993e-02   +4.754219206520284e-02   +9.199762388980341e-02   +6.267784750761857e-02   +7.594438746346600e-02   +2.833762216740800e-02   +3.454094392038649e-02   +3.433041246867366e-02; +1.757954436527953e-03   +9.942369464456716e-02   +2.806295195721571e-02   +8.299796180389381e-02   -1.304420759151479e-03   +7.276996944143901e-02   +5.327700385249731e-02   +7.542485365675743e-02; +8.834466979122219e-02   +3.275990091395391e-02   +8.254693203897835e-02   +7.713549276573967e-03   +5.025908002669533e-02   +2.949161315428993e-02   +3.870933423570908e-02   +4.156570587856766e-02; +7.356716430558105e-02   +5.223900061410056e-02   +2.124153762441251e-02   +5.103465641890507e-02   +6.109625245408588e-02   +3.224080091752526e-02   +1.755101597863104e-02   +3.442226185090054e-02; +7.379903450195385e-02   +9.505289926422471e-02   +5.674505129033349e-02   +6.384751137031995e-02   +3.371131695801956e-02   +3.993100354857129e-02   +8.598206300126723e-02   +1.560116966534055e-02; +6.899688715165002e-02   -2.884136646011313e-03   +3.612277605495402e-02   +1.805446919074720e-02   +1.194705975824333e-02   +9.579590848449887e-02   +5.043262373797983e-02   +5.530224967566792e-02];
L3I_L3E_iAMPA_netcon = [+4.749944045632429e-02   +9.672486516686199e-02   +2.780182741296437e-02   +5.714548345152322e-02   +7.536639460950076e-02   +3.611575531755308e-02   +3.165616045728525e-02   +2.210732702411505e-02   +3.045549880375835e-02   +2.617618992496344e-02   +2.389929945506505e-02   +4.470816867925651e-03; +3.783404961964549e-02   +7.857781728510796e-02   +2.805089332111088e-02   +8.095656060594590e-03   +6.722479189993878e-03   +5.470261108345477e-02   +5.577999283115735e-02   +4.934280519287475e-02   +1.865228433434381e-02   +4.762915528922865e-02   +7.107282957040439e-02   +5.324926354044341e-02; +2.990356801198440e-03   +6.007577978325829e-02   +5.221498767282542e-02   +5.742160171411922e-02   +5.020581942086788e-02   +4.593295202627536e-02   +4.874574280116546e-02   +4.464575075544723e-02   +4.229159424431761e-02   +5.422126598054277e-02   +4.224613775817226e-02   +5.518216076760948e-02; +4.184760986614813e-02   +7.759957787752943e-02   +6.676206890922487e-02   +4.776448725050535e-02   +4.403568555471578e-02   +8.833771758314345e-02   +7.555162706303661e-02   +1.669456613954323e-02   +9.005175565085445e-02   +9.027038113439342e-02   +2.263341079683562e-02   +7.089950708390610e-02; +1.116250224640646e-02   +3.889946063266845e-02   +8.489771096613235e-03   +8.208075586960185e-02   +7.794294631563152e-02   +5.857934035183157e-02   +9.660689797827086e-02   +5.752585009361439e-03   +9.700074963765422e-02   +5.986937323336383e-02   +3.370622059652183e-02   +1.273517670159918e-02; +3.720406842506700e-02   +5.451610560417413e-02   +8.263562006630941e-02   +4.441549768876501e-02   +9.677714241052382e-02   +3.141845165204720e-03   +8.621938969798958e-02   +3.191689039937872e-02   +6.889873401517249e-02   +6.830395309414402e-03   +3.602031000548618e-02   +1.615162329853899e-02; +7.867258123153781e-02   +4.053297579078483e-02   +3.505955171362869e-02   +2.892768655217403e-02   +6.550567002524207e-02   +1.448728139040548e-02   +5.556803641110798e-02   +9.067577222566926e-02   +8.055461052120974e-02   +9.659520291053071e-02   +5.556277402229289e-02   +7.087255812124742e-02; +7.038845642531125e-02   +1.907639502602253e-02   +6.787821621961536e-02   +6.354196579830558e-02   +9.762191254280152e-02   +5.413517038762353e-02   +6.655111751979645e-03   +4.856399415377388e-02   +4.634757799112230e-02   +2.934199975463539e-02   +2.056351957854968e-02   +9.133820027898772e-02; +1.254528064557122e-02   +8.625829107479013e-02   +6.765661226922881e-02   +7.731403039886174e-02   +3.830463335867425e-02   +7.717264206168609e-02   +1.728238402768861e-02   +7.886835198170299e-02   +7.754590897587536e-02   +4.746743559688062e-02   +2.321193514119902e-02   +1.769552693345902e-02; +8.594088474006333e-02   +8.382531646495833e-02   +4.186278264863742e-02   +2.166406136237382e-02   +5.186705085618872e-02   +8.254391905868182e-02   +5.484233561416366e-02   +8.869289435341152e-02   +7.128632211365371e-02   +3.895854261367804e-02   +8.414419270334873e-02   +2.158033389335417e-02; +4.463232234428782e-02   +3.409540359068028e-02   +9.477879405737342e-02   +9.010663523476352e-02   +4.139679062081269e-03   +5.694799365794087e-02   +4.424798989983622e-03   +2.339653411233848e-02   +7.681761323183730e-03   +9.015326988745247e-02   +7.625403219484905e-02   +4.085651877871523e-02; +2.737624961966046e-03   +1.765090178375048e-02   +4.889592161415613e-03   +4.602963860256394e-02   +4.641252660782782e-02   +2.387685766785457e-02   +7.777417570376537e-02   +1.966646602955042e-02   +3.328897512322983e-02   +2.288797946185491e-02   +7.551105383406989e-02   +3.112793186846723e-02];
L3E_L3I_iGABA_netcon = [+1.308269146079233e-02   +4.089147932119622e-02   +3.000609240725255e-02   +9.179735342118520e-02   +7.732814724938035e-02   +5.497478547021532e-02   +3.346142401909948e-02   +7.547420380188247e-02   +5.828262822737379e-02   +6.770583946351179e-02   +5.527469095751227e-02   +2.535329580867605e-02; +7.560307363264027e-02   +6.584617238650760e-02   +3.503518192210617e-02   -1.161470253002976e-03   +3.212246276964586e-02   +7.389807806364350e-02   +6.270732926456828e-02   +9.589168838259729e-02   +7.851531581290579e-02   +3.958756859807199e-02   +1.345036616189598e-02   +1.538540929360365e-04; +5.525346529323907e-02   +9.701994532828594e-02   +9.703126364219622e-02   +8.329125891730267e-02   +1.417366941434087e-03   +7.609968600547148e-02   +5.970206125037331e-02   +6.745958863474538e-02   +4.174762621239872e-02   +4.157359934496380e-02   +2.676258833126391e-02   +1.246737691578820e-02; +4.058497492792155e-02   -1.432224397528795e-03   +2.195123869826179e-02   +7.376614146827730e-02   +7.314621957062994e-02   +3.039492247039342e-02   +4.418638888182720e-02   +3.960272175566815e-02   +9.452573736658806e-02   +4.259384848805527e-02   +7.678139600836962e-03   +6.780576821267309e-02; +4.184950085856096e-02   +4.413848682796567e-02   +1.037832952916799e-01   +1.999307692984957e-02   +5.361655398602384e-02   +8.061591343047661e-02   +9.882262482357282e-02   +9.128271286787873e-02   +2.578153135207559e-02   +5.693564926568862e-02   +8.601140745189520e-02   +3.980496595776706e-03; +6.659774782581118e-02   +4.604404180362393e-02   +8.020599317997337e-02   +2.827812997567103e-03   +5.658906613840000e-03   +9.870463667058932e-02   +7.498306145455562e-03   +5.366659316020292e-04   +7.690493936641041e-02   +6.084322526466848e-02   +2.125286431441047e-02   +2.333417003181665e-02; +5.335589457417338e-02   +3.474375264536887e-02   +5.172271195656807e-02   +5.812376432537193e-02   +6.485453237930186e-02   +5.146949199466663e-02   +3.619874879170614e-02   +5.708573022662458e-03   +3.634595002822513e-02   +1.522477355315111e-02   +3.074819516178177e-02   +6.721583990509421e-02; +2.700430483488837e-02   +1.074699305524943e-02   +1.368495562797748e-02   +9.312713101946961e-02   +4.271062423241018e-02   +7.847777860451477e-02   +5.083082183210490e-02   +7.709572110787753e-02   +7.720632483892555e-02   +8.731088484000971e-02   +1.560200716763560e-02   +6.291160026204179e-02; +2.475275137541990e-02   +1.797263935743995e-02   +8.146879398748262e-02   +1.448294785767405e-03   +9.876089391433261e-02   +8.762252672404248e-02   +1.527261146587986e-02   +7.354458101048261e-02   +2.010946035640530e-02   +3.347193651626170e-02   +4.608030282354274e-02   +6.091643040896798e-02; +7.927006557491920e-02   +3.514288879851522e-02   +8.463989729526154e-02   +3.112285956546281e-02   +4.254378622047485e-02   +9.348045430425098e-02   +6.897918687272490e-02   +5.649830857955511e-02   +8.721686755566607e-02   +9.241359937631420e-02   +1.801301387770154e-02   -1.508005279474355e-03; +5.446162294474710e-02   +1.347058471552540e-02   +2.263083708282480e-02   +2.473836100023232e-02   +7.103813204220230e-02   +4.862302121352093e-02   +9.232171515791388e-02   +6.397169411045506e-02   +5.357800389429993e-02   +1.586156099747741e-02   +9.691567220895909e-03   +7.644078574701879e-02; +6.310528988438920e-02   +5.375151424884211e-02   +9.293342062217855e-02   +6.798404070465384e-02   +5.328755729634692e-03   +4.819912469904826e-02   +9.561865238666013e-02   +6.626393219860504e-03   +7.329840944156886e-02   +4.052357789284747e-02   +4.861030519486197e-02   +3.940323589751403e-02];
L2E_Input1_iAMPA_netcon = [+9.815507366851264e-02   +9.506925281334937e-02   +9.834768102795308e-02   +9.784503927140913e-02   +1.006417530228976e-01   +1.079143540804103e-01   +9.997287235511723e-02   +9.632075653453030e-02];
L2I_Input2_iAMPA_netcon = [+9.586173791604902e-02   +1.033209578118978e-01   +1.004431893763320e-01   +9.923613336467178e-02   +9.532471710869972e-02   +9.909613764420733e-02   +1.017977078362050e-01   +9.159470311957149e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
