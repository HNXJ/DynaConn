function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.852722877801541e-01   -4.933267810471296e-02   +6.350006445710055e-01   +2.538978402532449e-01   +6.408974225821620e-02   +5.720836147786892e-01   -2.915283998059569e-01   +4.189505384466796e-01   +3.129260452326478e-01   +8.723611495579530e-01   +3.675612836333773e-01   +2.732014196125208e-01   +2.100859394382432e-01   +1.486703270667515e-01   -1.628135764462911e-01   +9.272129269726409e-02; -7.627636395644788e-03   +6.923751647601242e-02   +5.215800426429857e-02   +8.189955866318788e-01   +1.795680419545916e-01   +3.007136322385882e-01   +1.915574952015045e-02   +6.233956459469249e-01   +4.935248321128867e-01   +2.916108553760707e-01   +6.326581188756631e-01   +6.946024978822701e-01   +2.417855367138342e-01   +3.856566998614944e-01   +2.885283995425701e-01   +2.043119917227239e-01; +8.628685084152712e-01   +2.850840090278610e-01   +9.778712122443756e-02   +1.774378705362203e-02   +2.086734425898144e-01   +1.992170793854177e-01   +7.401659296793733e-01   +3.687152904805767e-01   +2.761796771720984e-01   +4.784416083343958e-01   +3.535821046775057e-01   +5.247575071499369e-02   +3.434441233470268e-01   -1.457908916467898e-01   +1.620597149620149e-01   +2.478356234851575e-01; +3.113421192498254e-01   -1.340903653856083e-01   -6.016060949799583e-02   +3.198650469895478e-01   -1.219558486003895e-02   +1.959816045615314e-01   +8.549563229367707e-01   +6.949053330858952e-01   +3.696265641511800e-01   -4.065216835221019e-02   +4.209971208266947e-01   +4.956324423655305e-01   +3.239077247696022e-01   +4.613253115888658e-01   +1.672348927307577e-01   +5.966964197532847e-01; +6.681525040283250e-01   +6.156599715213300e-02   +7.354811793793541e-01   +7.153443316201558e-01   +7.855305982274827e-02   +5.929397400796323e-01   -1.368082205902478e-01   +5.351236565413777e-01   +1.771332808475833e-01   +3.811074302624191e-01   +4.978210944604641e-01   -7.690124765541551e-02   +2.316961592068465e-01   +4.085442551597567e-01   +5.698042777348575e-01   +2.636204639538772e-01; -2.813762089455839e-02   +6.809416166390729e-01   +4.976695361083069e-01   +2.065697666253969e-01   +7.433993741810917e-01   +3.691821661420948e-01   +9.678315433495532e-01   +2.930517740156182e-01   +2.855500379058356e-01   +4.250674032568263e-01   +4.910933129946594e-01   +4.297441728997234e-02   +6.894515948651843e-01   +4.405563315721088e-01   +1.492747816194530e-01   +1.184670883040117e-01; +5.665369191927521e-01   +5.393979939564811e-01   +3.242533590759500e-01   -1.533513389202859e-02   +1.803865468277949e-01   +2.209803543769000e-01   +2.004735945672395e-01   +1.119593184349177e-01   +5.853357780113508e-01   +5.493496385963561e-01   +7.089579106910048e-02   +2.922815065042291e-01   +3.048771745800724e-01   +4.053419701022871e-01   +5.117468707433973e-01   +2.452170248093890e-01; +4.408605685493195e-01   +5.659303380962662e-01   +1.085010169403112e-01   +9.558946592655448e-01   +7.924476918734771e-02   -2.921341078847783e-02   +5.032215381558560e-01   +6.555647311824999e-01   +7.213505045143571e-01   +6.119514909170740e-01   +3.830236439800398e-01   +6.495662111382453e-01   +1.453819306062927e-01   +1.556662234204053e-01   +4.506673847369412e-01   +4.863593985772834e-01; -2.139498377121999e-01   +7.296975616740190e-01   -1.262282842592253e-01   +5.218848471667863e-01   +1.090218713695544e-01   +5.561579486044070e-01   +2.989512229631297e-01   -1.739665624823418e-01   +2.811167037958203e-01   +5.213800669312429e-01   +9.506958559076546e-01   -4.064786697043220e-01   +4.680315342569119e-01   +4.420961202732752e-01   -1.971451959438684e-02   +3.289850361592497e-02; +1.996380437795399e-01   +3.286577374565994e-01   +5.344694325803708e-01   +4.573083508151915e-01   +8.508673224515497e-01   +3.447506036595819e-01   +6.067101090908710e-01   +3.789351499699805e-01   +1.443633877309431e-01   +5.499276388562005e-02   +7.327855054034371e-02   +2.123393412987103e-01   +9.126722259185205e-01   +2.295963477788978e-01   +1.551993362990027e-01   +4.532006798908386e-01; +3.279480166820645e-02   +8.395586991138517e-01   +4.041646757850533e-01   +3.491586958995262e-01   +8.273921627441756e-01   +8.672253728383784e-01   +6.872612788282010e-01   +1.706412482385353e-01   +3.045522654405027e-01   +5.561341822449899e-01   +2.156299322678189e-01   +4.371043985320632e-01   +8.835086116721227e-02   +6.241630740254680e-01   +7.270362870749982e-01   +5.225734802688264e-01; +6.375073490131001e-01   +5.422534001976723e-02   +1.491378864979072e-01   +1.997111935784068e-01   +2.438068565279590e-01   +5.613763411368191e-01   -7.337739295861749e-02   +3.987635084260204e-01   +8.647836215917329e-01   -2.980934687457082e-01   +1.639152670711665e-01   +5.750278157993980e-01   +2.667029588497431e-01   +4.585359446755433e-01   +8.919781214036174e-02   +2.436116767905279e-01; -2.962239431637616e-01   +4.773030612717911e-01   +6.470783824509652e-01   +5.932823962493421e-01   +7.952038879987736e-01   +6.686061977050600e-01   +1.367531970859929e-01   +5.658069178250724e-01   +9.649996468715099e-01   +6.757477077060117e-01   +3.949772142711953e-01   -1.527472175105164e-02   -2.821633526685857e-01   +1.315693971085772e-01   +2.064353546209308e-01   +1.729293654111601e-01; +2.278111269197673e-01   +5.666098341514365e-01   +4.019583987686973e-01   -1.584152966328594e-01   +2.663571264252708e-01   +7.084964655174008e-01   +1.801900311335002e-01   +4.132325539184808e-01   +7.793143760947835e-04   -4.701892713500559e-02   +7.758590159227863e-01   +7.215072109074266e-01   +8.472754961958926e-01   +3.694559535099079e-01   +4.402577615559630e-01   +2.782257005100101e-01; +5.130611460545894e-01   -1.174629355230288e-01   +6.535730920444289e-01   +7.181808740866701e-01   -1.052701507452340e-01   +7.873810593416355e-02   +5.950070064376241e-01   +8.140383186820654e-02   -2.974067813085668e-02   +2.062602843447340e-01   +4.013419458039849e-01   +3.335268295593021e-01   +3.671399028626388e-01   +1.692507359959745e-01   +2.524299238729990e-01   -1.225929637934585e-01; -6.696367883517487e-02   +3.419671375010434e-01   +4.114088465373944e-01   +5.366837553120505e-01   +8.299437597164354e-01   +7.341405640906417e-01   -2.347042325303547e-01   +6.835074727614201e-01   -1.014828546180987e-01   +6.409607643544925e-01   +5.954521664201234e-01   +4.112951503144763e-01   +2.697734838926527e-02   +8.117123886599188e-01   +8.180849605013291e-01   +7.533496511357848e-02];
L1E_L1I_iGABA_netcon = [+2.981086233855338e-01   +4.627068234035416e-01   +1.848775090066738e-01   +1.735939918820832e-01   +3.748799622346085e-01   -1.743405508411252e-01   +2.498915064353368e-01   +1.320037835857732e-01   +6.002260556829641e-02   -5.681708314260842e-02   +2.406958232193912e-01   +1.122884838862727e-02   +4.678105294321505e-01   -1.904740477035121e-01   -4.384272379408998e-01   +1.000000000000000e+00; -1.585733709832607e-01   -1.125293820418396e-01   +2.894835526499994e-01   +1.456231780982929e-02   +1.022371700479496e-01   +2.500611585208561e-01   +4.862852259370631e-01   +2.708855276222580e-01   +4.891081119474904e-01   +1.646771316885408e-01   +4.539749527265278e-01   +9.238471118105616e-02   +7.902146626327884e-01   +2.033586854148813e-01   -7.836685476838862e-02   -7.955717094820448e-02; -2.662046017012987e-02   +2.652635890842842e-01   +1.349276992096917e-01   +4.989267622377743e-01   +3.621003827637616e-01   -1.400947644618928e-02   +1.359308107175342e-01   +2.746592526280909e-03   +1.324067618525225e-01   +7.930251430339894e-01   +3.949750916962289e-01   +1.304114034003483e-01   +2.051783267343701e-01   -2.298999515380223e-01   +2.379310340500063e-01   +4.708890201562337e-01; +5.679316994847065e-01   +3.985140568724271e-02   +1.160569703877337e-01   +3.237059774866817e-01   -1.461581911029158e-01   -9.696608371405606e-02   +3.086251163005326e-01   -1.462781134462582e-01   +9.171930847813010e-02   +2.530806453670965e-02   -8.360448062054941e-02   +4.262598906505844e-01   -4.448632117447010e-02   +4.664314039343487e-01   +3.452878830216565e-01   +8.074771763589053e-02; +2.628687110771871e-01   +3.337984067785674e-01   +1.905402246655615e-01   +1.084914724637898e-01   +6.934654055763614e-01   -2.663974269096780e-01   +1.626899956980453e-01   -7.542084973746110e-02   +2.535607392684165e-01   +2.620083702330740e-02   +5.313271428040615e-03   +3.067841887641617e-01   +2.840004328623130e-01   -2.800468949720928e-01   -1.021164251816440e-01   +2.977123013638763e-01; +8.566143328768092e-02   +1.670268369201262e-01   +4.040025257351723e-01   +1.783126376160344e-01   +1.821328370752030e-01   +3.651376038635002e-01   +1.763565173857697e-01   -2.743070833195071e-02   +1.182238687519367e-01   +1.199276108001790e-01   +6.823967915238915e-03   +4.587353614771031e-01   -5.852879328569442e-02   -3.080057426406217e-01   +4.901762786849511e-01   +5.321474728069628e-01; +8.454225755148279e-02   +1.116840073126076e-01   -1.309952487487279e-01   +1.105659558272025e-01   +8.728730106700494e-02   +3.216008543885411e-01   -1.091925889036178e-01   -1.946724953749122e-03   +7.253691703120957e-02   +8.639799010526644e-03   +2.090438625624548e-01   +1.617230144346776e-01   +4.424043469641232e-01   -3.088005283283042e-01   +3.764383789739715e-01   +8.931133498223244e-02; +2.665629988836604e-01   +5.826031333049710e-01   +1.517464128335496e-02   +3.530877028606483e-01   +1.263181032795900e-01   -1.648382612379765e-01   +3.563254672537294e-01   -1.285797542201288e-01   +5.818384215688390e-01   -5.398692235267032e-02   +1.421506961782118e-01   -1.685161807752308e-01   +3.074700995834255e-01   +2.368317824610899e-01   -1.942221971485438e-02   +2.387687738536942e-01; +4.484091544704433e-01   +3.315284577907237e-01   +3.587381496043184e-01   +6.683435631892716e-02   -2.734624404440162e-02   +4.938551449444473e-01   +2.781149123553079e-01   +1.251301199633920e-01   +3.433461571988292e-01   +4.304734812312301e-01   +1.017922792295547e-01   +3.640156512364534e-01   -1.042069019734105e-02   -1.151077127566176e-01   +5.354478708219724e-01   +2.436655166858605e-01; +2.420007751844905e-01   +4.814562261539023e-01   -1.290771331905794e-01   +3.318394740370899e-01   +1.722751967100418e-01   +4.282734609757053e-01   +1.900920217138865e-01   +1.964120349969996e-01   +4.971042563579399e-01   +2.174607969733915e-02   -8.732563307182017e-02   +3.502460246589584e-01   +3.522102506640143e-01   +5.327061481836859e-01   +1.219366793308251e-01   +6.824338623117285e-01; +1.092778022748939e-01   +1.187601028960805e-01   +3.663574169022543e-01   +1.352352367444492e-01   +1.280192045251601e-01   +3.111451356195264e-01   +2.747826860236378e-01   -7.018729367721900e-02   +3.230815490132706e-01   +3.059897160858909e-01   +9.806073006094161e-02   +4.588794537874374e-01   +4.298030921303271e-01   +1.191233814015582e-01   -1.064388542640333e-02   +1.954415032787483e-01; +5.473873318178742e-01   +3.166974168012006e-01   +5.036873025439698e-02   -2.297687140747628e-01   +1.375350359048528e-01   +1.547143185016267e-01   +2.008466279303041e-01   +2.902922206727144e-01   -1.031346201947250e-01   +1.884627403554814e-01   +4.582144018790048e-01   +5.359237019632362e-01   -1.829122560122498e-01   +1.820622099934351e-01   +7.069390170925748e-02   +1.556381147717591e-01; +2.635620098806671e-01   +3.099372323673051e-01   -1.151316537623113e-02   +5.908528208105140e-01   +7.983515137129830e-02   +1.747827395179322e-01   +1.166733289096713e-01   +3.777731627956859e-01   +1.382352810707564e-01   -1.697912923607638e-01   +3.760144337255227e-01   +2.043793816593748e-01   +1.152114157182967e-01   +2.709171753504920e-01   +5.609309032360720e-01   -3.529045169288176e-02; +4.013266212662976e-01   +2.140531535371830e-01   +2.725193865886369e-01   +3.595829774902010e-01   +2.768861530997350e-01   +2.243121590120166e-01   +3.539446374702410e-01   +3.435751132290030e-01   +3.027813929310295e-01   -5.397002936209123e-02   +3.391621364973458e-01   -7.529011619097924e-02   -1.638728573789358e-02   -5.469895929465503e-02   +1.420710454970216e-01   +9.447974883310785e-02; +3.915594962242188e-01   -1.239352506395379e-01   +2.141855291264571e-01   +1.562010253323789e-01   -1.692811361764025e-01   +1.114642660650994e-01   +2.171826595104103e-01   +1.672375938160642e-01   +3.114490544915956e-01   +1.120106231292362e-01   +5.010740736111384e-01   +3.414193202137928e-01   +1.171778753138367e-01   -1.386397698194519e-01   +4.147763115400401e-01   +2.378900421806565e-01; +3.514012616775642e-01   +1.253073058504622e-01   +2.906167237096793e-01   -5.759129003863522e-02   +4.475169433391766e-01   +2.067975313502739e-01   +2.782712156121411e-01   +3.123502487190040e-01   -1.147861524588047e-01   +3.564653571526507e-01   +2.877874795374737e-01   +4.440929988817701e-01   +2.297784113022934e-01   +1.186720126527250e-01   -3.748953843961104e-03   +3.993973085201158e-01];
L2I_L1I_iGABA_netcon = [+2.550410740759784e-01   +9.732452707731415e-02   +1.421173888033843e-01   +4.361141128525152e-01   +6.418158262630792e-02   -9.335363366873674e-02   +6.979079015386733e-02   +1.878105991261389e-01; +5.136147693570623e-01   +8.354965333570912e-01   +2.758500392089423e-01   +3.719728263537169e-01   +4.506745306084865e-01   +3.277777405829701e-01   +4.159553005762598e-01   -6.790699056510682e-02; +3.432867661088611e-01   +1.425963984855711e-01   +7.086661249213306e-01   +2.699730167290718e-02   +5.232931612770226e-01   +8.277616593629351e-02   +6.514409274199214e-02   -3.165290557911308e-01; +6.469354804485949e-01   +2.321209199884603e-01   +3.467253475461208e-01   +9.629254408346567e-03   +7.476669322138175e-01   +4.653309531369171e-01   +6.034823195877687e-01   +6.121592362108477e-01; +1.109726161044373e-02   +5.895854369382180e-01   +4.151533937105257e-01   +2.858855668639760e-01   +5.217120183345004e-01   -1.070618462225896e-01   +5.711364679674137e-01   +2.048579887737134e-01; +3.719392276515780e-01   -1.657114763998417e-02   +5.540324975123926e-01   +5.156584935506898e-01   +1.975430866331547e-01   +6.894572428098182e-01   +2.697684350285374e-01   +5.392044604558042e-01; +6.498910824309311e-01   +5.626359439721577e-01   +5.879886593351656e-01   +8.695970590932349e-02   +5.794657895284629e-01   +2.329019547696588e-01   +5.374827328749952e-01   +1.385978838239190e-02; +2.697946274126204e-01   +2.695794172902761e-01   +4.021040357088239e-01   +1.479918455854020e-02   +2.492873052191485e-01   +7.975549357719441e-03   +2.154265114525280e-01   +3.420702499079455e-01; +7.555743259420122e-01   +1.000000000000000e+00   +1.343292027225943e-02   +6.828709835330801e-01   -1.363561969054354e-01   +2.928937917071084e-01   +1.815860758986755e-01   +2.393761720965887e-01; -9.703644084458812e-02   +4.728342607515327e-02   +1.799922641668050e-01   +5.969895925977278e-01   +6.328401832690344e-01   -4.670349319778841e-03   +8.804200805467637e-02   +8.497639233203934e-01; +3.817099308171456e-01   +2.003996769208049e-01   +5.150343022178449e-01   +5.915307771089335e-01   +2.234286603465227e-01   -4.604756160944430e-03   +4.761802004502742e-01   +2.154566580326248e-01; +1.082210326064456e-01   +5.069390895209894e-01   +4.974948852030698e-01   +4.517660238117109e-01   -7.937747458462996e-02   +4.296394414169128e-01   +1.709480385426436e-01   +2.945464064705772e-01; +1.167575334170436e-01   +6.645441144040919e-01   +8.517876118255804e-01   -2.826562751664822e-01   -8.668581233761441e-02   +3.268443609451275e-02   -1.383407334665011e-01   -1.232796289728648e-01; +2.236118751203043e-01   +6.632031635240344e-02   +1.667044765596453e-01   -2.819691028331911e-01   +4.673828787825349e-01   +3.433028104656380e-01   +3.166319977711307e-01   +1.292863970913989e-01; +7.069638800279193e-01   +6.785272715514641e-01   +7.254801902737614e-01   +7.086557854475812e-01   +3.373283292157694e-01   +9.268761031633981e-01   +5.260531365000201e-01   +6.771255418547187e-01; -1.960105394718686e-01   +1.023131489830340e-01   +6.726016793450568e-01   +4.723569153035291e-02   +1.644077465840042e-01   +1.164736597807905e-01   +2.331913833698997e-01   +6.537174543681096e-01];
L1I_L2I_iGABA_netcon = [+1.642275257996987e-01   +4.944190408914917e-01   -4.328258518337672e-02   +5.885551624377255e-01   +3.076161042633406e-01   +2.288491353735427e-01   +4.059980673405846e-01   +5.129177065890763e-01   -2.577533840387455e-01   +7.735947865685888e-01   +1.581432077239845e-01   +7.028717343742523e-02   +5.026022184430584e-01   +3.175008077632940e-01   +2.450152787029337e-01   +4.670647023220822e-01; +1.451796391742337e-01   +3.908311692375510e-01   +1.968942297998840e-01   +2.905061312381462e-01   -2.959808654640245e-01   +3.387496771246807e-01   +8.197410734217090e-01   -1.913117173790066e-02   +4.831687238349027e-01   +4.634862364664674e-01   +2.563069103558069e-01   -1.679590785765423e-01   +1.543315221002257e-01   -3.790677675993572e-01   +1.548017248688952e-01   +4.245338629650880e-01; +2.197038002535811e-01   +1.686803770454837e-01   +4.102737520771439e-01   +3.481320442044490e-01   +3.104127577642855e-01   +3.137730997934234e-01   +3.921099406826853e-01   +4.657751165789087e-01   +3.293037070563279e-02   +3.914459860735364e-01   +1.144306440599324e-01   +3.627656533957378e-01   +3.117291503601805e-01   +6.171444098353118e-01   +5.919666698815662e-01   +1.527993614141580e-01; +3.736221084152619e-01   +2.440108183102096e-01   +1.910030028249368e-01   +2.645616966187502e-01   +6.510141472250184e-01   +3.763758595212613e-01   +5.958239735705623e-01   +7.504844587416433e-01   +1.855745940101200e-01   +6.033573022301607e-01   +2.313762297285338e-01   +3.796742509404942e-01   +4.053407915075022e-01   +5.179094688535672e-02   +5.140924542028881e-01   +2.834076244676498e-02; +1.235481969695525e-01   +2.392710591237364e-01   +2.509184655421792e-01   +3.807939015188311e-01   +1.832145625317364e-01   +1.000000000000000e+00   +5.152641339176289e-01   -4.225148645721340e-05   +5.542800701823106e-01   +4.288668720769833e-02   +6.025719485445974e-02   -4.193272336275557e-02   -1.644168996103408e-01   +3.472300458522138e-01   +3.213441714627505e-01   +6.431423840436845e-01; +2.243091013278004e-01   +4.523705640090361e-01   +4.421978066877116e-02   +9.952768007408946e-01   +1.662975600461298e-01   +5.890318570999431e-01   +5.431402572845248e-01   +1.925455499551210e-01   -7.256455209683427e-02   -2.398464693169927e-01   +5.147713688222532e-01   +1.227365477283975e-02   +3.839059825207016e-01   +6.046631294561904e-01   +3.171608560544582e-01   +3.567921721783277e-01; +6.186336757949572e-01   +7.819217163878733e-01   +2.059666419737564e-01   +4.002122824925302e-01   +2.579110131658116e-01   +5.658954751384195e-02   +6.003572485795504e-01   +4.383282426576197e-02   +6.663093571148990e-02   +4.774172386431854e-01   +4.082268069571329e-01   +1.754926774412959e-01   -1.026125542344701e-01   +2.405964532685171e-01   +2.468316608799024e-01   +4.813739648589095e-01; +5.210245277598795e-01   +1.762760062725235e-01   +2.816618976448778e-01   +3.182492310611856e-01   +3.063269839961144e-01   +6.463639988330194e-01   +2.585869901779350e-01   +2.045821454612405e-01   -1.832243037184070e-03   +2.070574155082006e-01   +7.111511664126180e-01   +4.598994179816041e-01   +4.962691408898749e-01   +3.182861048306617e-02   +3.499261094062840e-01   +1.919915562324164e-01];
L2E_L1E_iAMPA_netcon = [+4.614903018392721e-01   +1.529860649647147e-01   -5.941541918566218e-02   +5.099258513793921e-01   +7.429058862759765e-01   +4.722502402899101e-01   +3.429570137673178e-01   +1.705878368145848e-01; -7.787380535827759e-03   +4.990836976245032e-01   -1.178233696056479e-02   +1.622273240179092e-01   +3.247608803570451e-01   -1.598592411230359e-01   +3.901924283118562e-01   +6.603100660787629e-01; +1.876120281300236e-01   +7.533352789744500e-01   +4.366229849702140e-01   +3.096467290975906e-01   +6.619489095455101e-02   +4.158474353205633e-01   +4.521023803016492e-01   +3.816695500276307e-01; +5.370739816657732e-01   +1.344533183619446e-01   -2.206354477045120e-01   +6.237385740373173e-01   +2.621310371104991e-01   +1.403152819423573e-01   +1.701690379748594e-01   +1.708002030245334e-01; -7.820830016177889e-02   +5.496350053088190e-01   +3.281315927671096e-01   +2.279032241901532e-01   +5.750325981439939e-01   +2.234498448190983e-01   +6.463931136458261e-01   +7.810474075792323e-01; +3.873346258401924e-01   -2.777199489557101e-01   +6.867071546839866e-01   -1.076930082041084e-01   +7.191034539258669e-01   +7.360918141764774e-01   +5.404314655998574e-01   +3.915565077486859e-01; +3.234676298875579e-01   +3.195483902308709e-01   -4.815185862994748e-02   +2.882896106591749e-01   -1.077958452129204e-01   +2.266864651912739e-01   +1.000000000000000e+00   +5.773573116470018e-02; +2.278109699318081e-02   +4.300519594674381e-01   +6.364671324153266e-01   +1.612544636026590e-01   +5.118949198725018e-01   +3.084750255841761e-01   +4.120414930722444e-01   -1.316972231312758e-02; +5.669761496465475e-01   +1.781632519027305e-01   +2.939407742025012e-01   +8.785376465096147e-01   +2.347032302892556e-01   +6.167816273166752e-01   +1.103010121001416e-01   +4.640983544051320e-01; +3.837821835723027e-01   +7.171775224648014e-01   +3.977957614138529e-01   +4.548123253130768e-01   +1.439883163216578e-01   -2.912265077758030e-02   +3.719733851952953e-01   +3.548268968811674e-01; -9.918851058393353e-02   +4.291528794033656e-01   +2.199991385247796e-01   +2.308169903180233e-01   +1.516811191576226e-01   +2.337679172955254e-01   -1.702494911142516e-01   +2.577842232083548e-01; +2.063814651945434e-01   +1.655098102580392e-01   +7.255643239634775e-01   -5.565081718398732e-02   +2.316841045414358e-01   +3.267928442327372e-01   -3.714183117302119e-01   +3.038668699756273e-01; +1.425690151044258e-01   +2.569470823642581e-01   +9.484149439166742e-02   +4.199662640737120e-01   +2.470195212789358e-01   -7.044062346747067e-02   +5.113218877529341e-01   -1.181288807286447e-01; +2.611677271558168e-01   +2.779622148330181e-01   +3.169397430284165e-02   +5.887016406665773e-01   +1.554016246865411e-02   +4.166529226744325e-02   +4.415086711484137e-01   +2.051273648102284e-01; -1.509395175890302e-02   -1.265847969528357e-01   +3.975441407300433e-01   +3.298840260256464e-01   -3.370735629140319e-03   +4.075890431414124e-01   +4.264886195177811e-02   +2.365560687610606e-01; +3.359773381077146e-01   -3.374168255812349e-02   -1.042367904055957e-02   +1.043703885725456e-01   +5.131700045954338e-01   +4.453505842152801e-01   +2.445424295659303e-01   +7.705440460488910e-01];
L1E_L2E_iAMPA_netcon = [+1.930167462629585e-01   +1.750981421179053e-01   -9.240322109916970e-03   +3.858071456648052e-01   +1.156153246060656e-01   +4.274330318836180e-01   +3.886162084550641e-01   +2.476238802920919e-01   +2.307262852051144e-01   +2.857057525020109e-01   +5.234579551707166e-01   +6.546982586784842e-01   +6.405509401334629e-01   +2.043286131152191e-01   -1.172036143315120e-01   -6.389644342829810e-03; +2.545565278676361e-01   -2.418735751097844e-01   +2.372637932463192e-01   +4.184740017240162e-01   +2.385115302585378e-01   +2.213987473734020e-01   +2.273770227018279e-01   +2.638755406144139e-01   -2.645451112342919e-02   +5.164068206583353e-01   +1.781670945621125e-01   +5.983156332901248e-01   +4.395172418617430e-01   +3.729293811915224e-01   +4.720508652885392e-01   +7.748077324264957e-02; +6.996631372983596e-01   +3.026775156436748e-01   +2.171701921749698e-01   -5.906114299942245e-02   +2.046886148718376e-01   +2.774483987179614e-01   +3.167896482031888e-01   +6.475056676806697e-01   +5.701250813015265e-01   +2.177546979313560e-01   +4.224633294082967e-01   +3.120026887746452e-01   +1.175075495828822e-01   +4.840594213699583e-01   +1.227863019691593e-01   -2.038009400851085e-01; +2.933975473925056e-01   +6.361178360055070e-04   +7.437231367600348e-01   +6.622883986260840e-02   +4.660187308712407e-02   +3.262411203913888e-01   +1.000000000000000e+00   -9.788713299967339e-02   +4.596818913415455e-01   +4.119283785987123e-01   +6.327516353528354e-01   +7.930595140591291e-02   +1.586260180222576e-02   +5.900193848236580e-01   +4.153281166727371e-01   -2.221953888123631e-01; +2.541493609366495e-01   +1.565452411305793e-01   +9.163003062011146e-01   +3.173390975637345e-01   +3.628556483381841e-01   +5.121651504847212e-01   +6.361566093912170e-01   +2.628773150017532e-01   +4.752267732084581e-01   +3.799855433361148e-01   +7.075575432712493e-02   -2.884487038633260e-01   +5.357424450253605e-01   +1.809806475459750e-01   +9.211373518251018e-01   +2.879237488799037e-02; +2.382295593380156e-01   +6.287565363013855e-01   +3.790573946150870e-01   +6.205349222177442e-01   +2.603193426519027e-01   -8.913674325495335e-02   +4.732810443422057e-01   +3.370185190209345e-01   +3.591696110603043e-01   +2.843277458094609e-01   +4.389683980821492e-01   +9.181145915540945e-02   +1.271162233185085e-01   -1.183460484902487e-01   -7.010661508257528e-02   +3.738309713613368e-01; +1.355010431316706e-03   +1.881820879772833e-01   +2.477892223686365e-01   +6.035961425246461e-01   +1.793162710767520e-01   +1.449128145001900e-02   +8.026934922472957e-01   +1.260140976983694e-01   -1.161330499816670e-01   +3.371479458842573e-01   -9.298198394069826e-02   -1.497949233141226e-01   -2.179412962733879e-01   +1.707620733046291e-01   +2.826296467870868e-01   +5.292868975680359e-02; +4.012347452167015e-01   +2.435780467197208e-01   +4.104574243895396e-01   +6.316852272838946e-01   +5.443394557881210e-01   +7.991415984701955e-01   +8.035529397219870e-01   -3.869158143228036e-02   -2.113017981429967e-01   +5.531314223679477e-01   +5.232573889341031e-01   +3.112131387074609e-01   +4.264116358757566e-02   +2.910041385235423e-02   +3.572418140402858e-01   +1.971217389143060e-01];
L2I_L2E_iAMPA_netcon = [+4.896678775129255e-01   +4.666539567527020e-01   +4.493454755089145e-01   +2.480262418364405e-01   -6.850214531231133e-02   +6.234900960863440e-01   +3.406856521248151e-01   +3.464175769423737e-01; +6.028263528178952e-01   +7.980614134340219e-02   +5.513916897458118e-01   +5.414632796553764e-01   +3.931643675787171e-01   +3.182214697997290e-01   +2.509533709071137e-01   +3.709855983515346e-01; +3.418202517204788e-01   +5.556003846074271e-01   +2.246187169305257e-01   -1.980911757540183e-01   +1.328913621013650e-01   +2.146592978020482e-01   +2.371249080981837e-01   +9.196233106637465e-02; +1.843212347843239e-01   +4.218473274848718e-01   +1.541073074103086e-01   +6.167968235356334e-01   +1.700065157176312e-01   -7.361098800590024e-02   +1.788076426466697e-01   +1.375928657463488e-01; +6.012945150268030e-01   +2.327036318980238e-01   +2.540530874951853e-01   +4.824226503194597e-01   +4.853459208232593e-01   +2.054141701006367e-01   +6.856173780909796e-01   +1.114624260555305e-01; +3.536491275729300e-01   +3.445937953434189e-01   +1.531387762642550e-01   +4.657928695918268e-01   +3.475766376863716e-02   +4.042334158908031e-01   +3.217246337771367e-01   +1.842200860801254e-01; +3.561451650330423e-01   +1.355178703208250e-01   -9.691287723143319e-04   +5.191796027583312e-01   +3.319379233065010e-01   +1.069148158122757e-01   +1.000000000000000e+00   +1.348974350793388e-01; +6.347227543630882e-01   +2.654706303889945e-01   -1.917096701020340e-01   +3.186838767278048e-01   +2.484741395811647e-01   +4.407850041590779e-01   -1.205893170640659e-01   +3.160233938851146e-01];
L2E_L2I_iGABA_netcon = [-2.658619457111918e-02   +5.484579085522630e-01   +5.851665482601237e-01   +4.002733695191980e-02   -1.539165806757251e-01   +4.143770270173630e-01   +1.649914303594457e-01   +5.063912101275260e-01; +1.985756531415994e-01   +6.004481267164467e-01   +4.463286496408684e-01   +5.690502595793966e-01   +5.244600003980844e-01   +5.809827965488393e-01   -2.608772833676944e-01   +3.537949942783862e-01; +2.131872894790969e-01   +6.788319819201053e-01   -1.749329222257110e-01   +1.862730315280553e-01   +5.400493323660377e-01   +6.499705989400513e-01   +1.098087743603607e-01   +1.000000000000000e+00; -9.906961264698004e-02   +5.214280087942861e-01   +3.710698644121460e-01   +4.232445318384060e-01   +7.079891973838101e-01   +2.000095780889078e-01   -7.200081203750089e-02   +3.857860137471313e-02; +4.135934543134591e-01   -2.417938163979643e-01   +9.106752008704735e-02   +6.902437186512752e-01   +6.022012556998297e-01   +3.343910214383747e-01   +1.847585032062410e-01   -2.990197528227788e-02; +1.773151540080063e-01   +6.383845447046814e-02   +4.525439133911206e-02   +4.492457081435347e-01   +3.415911420846157e-01   -1.959090302049931e-01   +3.092971769905746e-01   +6.199236475392213e-02; +4.713592232352081e-01   +3.284837501709061e-01   -1.684547697120378e-01   +1.505470617223721e-01   -5.190316510765716e-02   -1.482282782213504e-01   +2.438119023988613e-01   +8.997395154596700e-01; +3.745432066234829e-01   +5.797889857264441e-01   +6.190624846912066e-01   -3.984212063332692e-01   +4.190829138090732e-01   +2.022094685636768e-01   +6.190344331880628e-01   +4.967522167986931e-01];
L3E_L2E_iAMPA_netcon = [+5.904830061265323e-01   -2.335230740614804e-01   +6.302654078572459e-02   +3.113148437827868e-01   +6.196191465529062e-01   +3.459867824403556e-01   +3.247545751701165e-01   +6.217313342958537e-01   +2.896390851290600e-01   +8.923433688635053e-03   -1.633436223894228e-01   +4.428707028540286e-01; +2.636489319386872e-01   +8.742946927001967e-01   +3.310987048755676e-01   +1.387898413431293e-01   +1.604181059087519e-01   -3.274454469269834e-01   +1.034672399400188e-01   +1.931759205436979e-01   +1.757657175171982e-01   -3.268660510109757e-02   +1.844953317075229e-01   +3.113974972077783e-01; -5.131948284476578e-03   -1.387651241719182e-01   +4.663354300755944e-01   +1.517659283463689e-01   +7.636853833716272e-01   +4.665627400810768e-01   +4.060021818344555e-01   +5.307116631071035e-01   +4.700038109900417e-01   -2.394984371690681e-01   +2.384406941659509e-01   +6.008349568287276e-01; +2.812565485938324e-01   +1.213360029381600e-01   +3.291918039381839e-01   +3.957207063983459e-02   +5.186235631691452e-01   +2.668507799360135e-01   +3.747755636125769e-01   +2.771360701459912e-01   +5.720009505517922e-01   +7.306563653273621e-01   +1.343094423836542e-01   +1.066131021093444e-01; +4.753592773482473e-01   +2.152988444993719e-01   +3.584853800807132e-01   -1.175653520231374e-01   +7.311454923777356e-01   +3.242895230234577e-01   -3.848859225161955e-03   +2.026285266267923e-02   +3.806179746442532e-01   +3.328128347291220e-01   +5.989987839978412e-01   +4.129246399669503e-01; +4.734824239874817e-01   +7.477813432550660e-01   +6.462110211289770e-01   -2.090053182725676e-01   +4.322601992894075e-01   +8.129023550308703e-01   +5.044021659241411e-01   -8.829413521081377e-02   +1.861758909439755e-01   +5.567595237116589e-01   -4.561286085691588e-02   +4.340434697982224e-01; +4.465132884134667e-01   +1.090396954507431e-01   +6.111413072674269e-01   +3.036979417726264e-02   +9.084845767546568e-02   +4.411439756035191e-01   +1.843909733496055e-01   +3.843838776197052e-01   +3.949281564647074e-01   +5.238883604049712e-01   -5.165085263500985e-02   +1.886947884581216e-01; -1.483464796694165e-01   +6.250188196595129e-01   +4.000254055999068e-01   -3.618008116893088e-01   +5.561856972991351e-01   +1.502479559724040e-02   +1.880720707777776e-01   +1.136314750217067e-01   +5.662382204621906e-01   +6.167378196334411e-01   -2.734514359334299e-02   +1.168728909752472e-01];
L3I_L2I_iGABA_netcon = [+6.506770915837446e-01   +5.577692747569584e-01   +1.943415355502645e-01   +3.825178249469585e-01   -4.722510667124202e-04   +3.708630512893984e-01   +6.835207060155618e-01   +3.118054138063876e-01   +7.325852739793771e-01   +9.486454383297177e-02   +1.478105616754810e-01   +5.830791384172858e-01; +3.569982764454814e-01   +3.049514574788256e-01   -7.270999261084431e-02   +2.194448396361348e-01   +6.851857223975292e-01   +3.117952391055620e-01   +3.534632199920951e-01   -1.454046224886219e-01   +3.543855028422461e-01   +2.611312462206086e-01   +3.293537097527834e-01   -4.146582128292464e-01; +1.915385228103317e-01   +4.690864725756252e-01   +5.839356399225973e-01   -1.186212979633372e-02   -1.233456955484598e-02   +2.600178587198466e-02   +4.953121618099761e-01   +7.425707894089220e-01   +9.062188027008269e-02   +2.030529924567748e-01   -1.413988301101871e-03   +5.843684213275310e-01; +4.208511772062959e-01   +4.640714626286793e-01   +2.310445141495505e-01   -7.442878519677057e-02   +9.148246368351512e-02   +4.853883977990219e-01   +1.255936074231477e-01   +8.589425753138194e-02   +2.670628542953723e-01   +1.481930891232233e-01   +4.605523076784646e-01   +1.873225536492855e-01; +1.931629251901659e-01   +2.777208486307048e-01   +2.620118167296085e-01   +5.415774305638148e-01   +5.275976527796816e-01   +4.986195827222958e-01   +8.921848044280678e-02   +9.088914040360354e-01   +5.555946721858146e-01   -1.049360448148703e-02   +9.062607085319752e-03   +6.353891334372965e-01; -1.741874196714402e-01   +5.564188574844271e-01   +1.726277044140174e-01   +3.045066822702327e-01   +7.129549398824445e-01   +3.650055118091997e-02   +1.933709443225849e-01   +2.742783361677829e-01   +3.362013669925422e-01   +5.289054559640891e-02   +4.190601183268902e-01   +3.769844969678697e-01; +5.305494215111703e-01   +1.885644417464968e-01   +7.405754336292832e-01   +3.495179333569759e-02   -1.162279515877933e-01   +5.361793676337853e-01   +4.640313822349839e-01   +5.667969106628260e-02   -1.368744643701651e-01   +4.044064564925006e-01   +4.345907993168883e-01   +2.728407498189962e-01; -8.688737202009952e-03   +2.809457432548830e-01   +6.885914405383385e-01   +6.093536433742424e-01   -1.162248511140503e-01   +4.630581996598586e-01   +5.455677656944147e-01   +5.832859127369417e-02   +7.520298374390940e-01   +1.795372104481472e-01   +4.566303932847094e-01   +3.213582170904163e-01];
L2E_L3E_iAMPA_netcon = [+5.927733072630049e-01   +3.847311094175590e-02   -1.918699950477956e-03   +1.340619244841249e-01   +1.513157908961821e-01   -4.332075282311025e-02   +1.256484239306311e-01   -2.010827617756471e-01; +2.180408009639686e-01   +1.960633011447029e-01   +3.352606296672092e-01   +1.802432455408102e-01   +3.375740312114315e-01   +1.379011599267090e-01   -4.242592885502276e-01   -4.494537213215883e-01; +8.402550333715463e-01   +3.258179651273965e-03   +5.343170379955178e-01   +6.993476206516956e-01   +5.888896841166187e-02   +2.111480045929267e-01   +2.243445400088487e-01   +6.054417031838288e-01; +1.336183411514873e-01   +2.841611809842489e-01   +4.348365205138948e-01   +8.200609639729932e-01   +8.764432914123153e-01   +5.560074416287305e-01   +3.483649713376264e-02   +4.879148690034235e-02; +2.099011732781880e-01   +4.566889896133974e-01   +4.182696041355393e-01   +8.370967725809020e-01   +9.208040591964721e-01   +2.406607419561938e-01   -9.551766516899370e-02   +3.060593803995193e-01; +4.767112786417350e-01   +7.006538594313149e-01   +9.259949432240460e-01   +7.382997486977606e-01   +6.985542311978218e-01   +3.983037352478714e-01   +5.822556801624130e-01   +9.125426940376939e-02; -2.280153698738033e-02   +4.045064692071743e-01   +9.784730323590708e-01   +3.925703509310942e-01   +2.224761800940915e-01   +8.253757031314143e-02   -1.286517060285193e-01   +4.329330786850843e-01; +2.841965273545447e-01   +5.033369292842916e-01   +4.152951651830722e-01   +1.644510715948730e-01   +3.140890221957828e-01   +2.663730349506800e-01   +5.477744936420530e-01   +9.210662256040564e-01; +6.946484802145292e-01   +3.035819765916259e-01   +3.262206270711545e-01   +1.478876509509553e-01   +5.011793535608815e-01   +2.889097101451724e-02   +8.073016916389446e-01   -6.382772142731595e-02; -6.903622273928084e-02   +5.328989176128133e-01   +3.338572858943951e-01   +5.221818402050296e-01   +4.626324164369730e-02   -3.451115229326076e-02   +6.930861670750197e-01   +1.127758495659859e-01; +3.125125617791859e-01   +2.286856045612319e-02   -1.552517978819060e-01   +6.520208012134473e-01   +5.120961482770512e-01   +5.558255002272332e-01   +3.812445731789804e-01   +6.329250034861569e-01; -4.141244934906763e-02   +8.263380258064654e-01   +7.177053215073375e-01   +3.982287889113186e-01   -2.148530329978274e-02   +1.867860353588557e-02   -2.595102851029123e-02   +6.904405171772847e-01];
L2I_L3I_iGABA_netcon = [-2.077409433609387e-01   +1.844717500847748e-01   +6.075664199655929e-01   +3.947876868288764e-01   +5.424776223031407e-02   +6.206280316445790e-01   +3.475732467765801e-01   -2.378838850607117e-01; -1.005005483578854e-02   +4.917999986128567e-01   -3.954472401699129e-03   +8.228155811219856e-02   +3.507294297669492e-01   +9.532970951686365e-02   +2.180699665417810e-01   +4.365513050098630e-02; +6.230074627042828e-01   +4.443667891005931e-01   +1.709206557909048e-01   +5.268470030405583e-01   +1.733978592886776e-01   +1.000000000000000e+00   +2.492919816786963e-01   +6.986357057463194e-02; +2.160071118504887e-01   +5.120891896487730e-01   +6.668667404235755e-01   -1.757168455065228e-01   +2.715212177690022e-01   +3.278778476714299e-01   +4.250556097027906e-03   +4.391632334698533e-01; +6.717082306405281e-01   +5.493700204055924e-01   +1.656451164464680e-01   +3.812200438983933e-01   +2.395399722549531e-01   +3.356213562520177e-01   +1.509548815125506e-01   -7.569861494843104e-02; +6.564586323534759e-02   +2.927421577943700e-01   +7.418890548163246e-01   -4.005296431910629e-01   +6.879705341654525e-02   +6.587693960647303e-01   +6.028364725185305e-02   -1.971626197371878e-02; +7.294590143203314e-01   +2.439876647123119e-01   +3.726181141723849e-01   +4.518183252116808e-01   +2.859876536001917e-01   +3.747985252145989e-01   +6.024796124336249e-01   +2.411747859498421e-01; -2.974163505420028e-01   +6.705543577388738e-01   -8.972443031548545e-02   -1.222622687707716e-02   +1.579923366673549e-01   +1.292244023624587e-01   +1.832061733696561e-02   +6.446649260313662e-01; -4.333736636592648e-01   +4.257731785929461e-01   +4.445416129923925e-01   +2.064880965945129e-01   +2.442242631089971e-01   +5.866523585760702e-01   +2.201392653708954e-01   +4.378668480281971e-01; +5.460398276443947e-01   -1.577143852684981e-01   +5.016741947377320e-01   -9.301434598048773e-02   +4.615073611270055e-01   +6.041717241194765e-01   -6.650193936860881e-03   +5.385512316511482e-01; +7.514258459106345e-01   +1.482284024321283e-01   +9.290123063422619e-02   -1.054683987060957e-01   +5.911322239502026e-01   -2.336753792293147e-01   +4.175099564240707e-01   +8.326754786594450e-01; -2.482441541732367e-01   +4.263285215881431e-01   -2.877831389946406e-01   +4.764016637361631e-01   +7.203386103218334e-01   +1.223657054404424e-01   +1.905602236955035e-01   +5.242240144736553e-01];
L3I_L3E_iAMPA_netcon = [+5.785831143677782e-01   +4.741815004748053e-01   -8.151159909640965e-03   +3.637006865452647e-01   +3.604411490660283e-01   -6.840428111946704e-02   +2.683391159410293e-01   +2.678987906452518e-01   -6.426605090190982e-02   +4.789936757446205e-01   -1.008746637659636e-01   +5.917376377352674e-01; +2.690193498265022e-01   +3.425651692445662e-01   +4.885308197018275e-01   +6.323614129345647e-01   +8.580077637628418e-01   +1.717419219477139e-01   +1.519352539019779e-01   +3.558003290173837e-01   +6.422865838334541e-01   +3.388465367506370e-01   +1.092343341411389e-01   +2.068113546890988e-01; +5.073147950455933e-01   +7.396047586292133e-01   +8.714956146504566e-01   +3.187482650981124e-01   +6.565460445676576e-01   +2.828591723040730e-01   +5.100000475733339e-01   -1.743256829330017e-01   +4.905152357330226e-01   +8.296797429278991e-01   +1.043849795541260e-01   +5.192734871466010e-01; +3.600153451258460e-01   +5.708926223750341e-01   +4.206800452461166e-01   -1.993990463092666e-03   +2.933767747161887e-01   +6.217907347675461e-01   -3.313365779965591e-01   +3.574540542601071e-01   +1.461980633650453e-01   +1.716598725235493e-01   +1.754218807710164e-01   +4.029047333720660e-01; +3.220575745745799e-01   +1.489088350067460e-01   +8.483233158968613e-01   -1.544626220458534e-02   +3.275041051344334e-01   +1.936844186657200e-01   -1.570296657802206e-01   +3.649268328881933e-01   +5.791017963917605e-01   +5.196112289187643e-01   +5.761567799812634e-01   +2.019934198154125e-01; +1.016038224944461e-01   +1.945241934099611e-01   +4.639342088015899e-01   +1.734923584915036e-01   +7.226688196795358e-02   +3.425568487567719e-02   +4.068324331333592e-01   +2.372051871783348e-01   +2.659961949548247e-01   -8.656656929781485e-02   +3.854175948403022e-01   +3.318113182326740e-01; +3.631531477478272e-02   +2.561273945979049e-01   -2.369361825194915e-01   +1.086527728219964e-01   +5.317183680073569e-01   -6.007718669951093e-02   +4.292422162136351e-01   +4.385693198116053e-01   -1.870154145440059e-01   +3.522878558893539e-01   +5.198864658044727e-01   +2.243756962492581e-01; +2.466790780228933e-01   +3.577774164588278e-01   +3.664449081927404e-01   +2.197986069671234e-01   -1.761889341117581e-01   +3.973176371569735e-01   +1.820411744990107e-01   +3.594461641133508e-01   +1.527508012377718e-01   -2.393151724522903e-01   +9.513833588601429e-02   +4.919393502717970e-01; +5.234941474881084e-02   +6.570626190257071e-01   -6.257384605852429e-02   +4.539418938697176e-01   +2.391749739630525e-01   +7.490720563950239e-01   +1.457941751381022e-01   +5.902988314839830e-01   +5.236800847471607e-01   +3.815861525923149e-01   +5.883463360608823e-01   +7.272399157213387e-01; +7.616085523781755e-01   -3.191917645141149e-01   +8.077983792057416e-01   +3.441453921507957e-01   +4.342705275016103e-01   -2.770696433856222e-01   +3.448445360497328e-01   +2.825374845026509e-01   +4.045098933768889e-01   -7.393380264453130e-02   +7.737632873596693e-01   +5.363321129719334e-02; -5.528856513208877e-02   +2.265968854893702e-01   +5.799169449998673e-01   +4.136518237652860e-01   +5.858736823465436e-01   +1.850221717385301e-01   +3.403608571142015e-01   +3.099419776017894e-01   +8.481262683367499e-01   +1.365756876644507e-01   +4.201239482959177e-01   +4.252047451346909e-01; +1.211983847037295e-01   +3.821370870285573e-02   +4.396652329462433e-01   +3.439259351156232e-01   -7.655929750874479e-02   -1.132105635088706e-01   -8.166995179549166e-02   +2.374815288847427e-01   +8.498559545357057e-01   +9.037583398642103e-02   +3.260850408158970e-01   +1.262610592908958e-01];
L3E_L3I_iGABA_netcon = [+1.444615815598361e-01   +5.090284239675206e-01   +1.506237189824337e-01   +4.742283412274108e-01   +4.107085228189061e-01   -1.412888176000505e-02   -1.446475965060618e-01   +6.075352835594575e-02   +9.480538581821552e-02   +3.510673426709344e-01   +4.042535468213413e-01   +1.189520417636153e-02; +2.486408819115431e-01   +3.260606119438579e-01   +5.565172017648454e-02   -7.787448509269963e-02   +3.774296980316997e-01   +1.063633264682915e-01   +1.421997955593865e-01   +2.861522620419988e-01   -1.811098877608535e-01   +1.606672253693914e-01   +1.510734633621810e-02   -3.991118923850291e-02; +4.034259487122955e-01   +8.509621353278980e-02   -1.021215497243835e-01   +8.135489915644618e-02   +3.405229517832228e-01   +4.063127279237879e-01   +2.736618916615569e-01   +3.652153443610482e-01   -2.160125527923351e-01   +3.093703807039758e-01   -1.364014682011761e-01   -1.056606476787493e-01; +1.444386396011851e-01   +2.512647670516384e-01   -2.391590681753275e-02   +5.915134902006432e-02   +6.762207825429097e-01   +1.484909621506780e-01   -2.461144952909436e-01   +1.415859277685435e-01   +6.627038684495863e-01   +5.723684999847932e-01   +2.766915464150427e-01   +2.050691836543637e-01; +3.248408982404029e-01   +1.648802126381753e-01   +1.588108534661756e-01   +6.584506045670464e-01   +1.861523798542383e-01   +3.160820248146315e-01   -3.640089446146615e-01   +3.989695864181812e-01   +2.866469357690223e-01   +6.296504505153264e-01   +3.124254119390911e-01   +3.410965563939445e-01; +4.417182610826514e-01   +7.971014523626870e-02   -7.954612744916914e-02   -9.359150684500032e-02   +5.380019691678523e-01   +4.641957385810299e-01   +8.345486683286629e-02   +3.681769655463489e-01   +4.774398885729648e-01   +4.157531071953268e-01   +4.034788225097001e-01   +3.370976268967903e-02; +6.674775451512227e-02   +3.747991316767911e-01   +5.734807700946508e-01   +1.000000000000000e+00   +1.848065442475641e-01   +1.918581935666996e-01   +5.810103190994801e-01   +5.569648750274142e-01   +2.533944294779965e-01   +4.334568162944999e-01   +6.234899692635418e-01   -1.925238933992639e-02; +2.430922125660926e-01   +1.480944493226761e-01   +3.765744199619357e-01   +2.808565090316866e-01   +3.136425944795682e-01   +1.482248455075024e-01   +3.114987005867796e-01   +2.672289335676645e-01   +2.547882823454262e-01   +2.875433093284668e-01   +3.980011414647047e-01   +1.893544861914858e-01; +1.656092926422757e-01   +3.038864194486661e-01   -2.205146090062427e-02   -1.707805633908615e-02   +1.512659225119500e-01   +1.759155897755984e-01   -8.478927321662495e-02   +2.319024933150219e-01   +6.559537845842282e-01   +6.249811518604425e-01   +5.933307800878519e-01   +3.891231469933955e-01; -1.794439536528759e-01   +9.895321158501744e-02   +3.860921451801134e-01   +7.411762566035918e-02   -1.883682634079409e-01   +9.989137753655553e-02   +2.937796168312319e-01   +1.108665719500747e-01   +2.976271544961828e-01   -4.107902200166536e-03   +3.442437817926847e-01   +3.456029564139871e-01; -9.753565348789361e-03   +2.257704088681748e-01   +1.676632035918456e-01   -1.626872939063979e-01   +3.619566194247437e-01   +4.214774999408098e-02   +3.403248370306169e-01   +2.630319056451428e-01   +8.582525559389180e-02   +2.908711442026125e-01   +2.416323761054041e-01   +1.368091451665913e-01; +3.541461406152995e-01   +3.869459299812459e-01   -1.649403142038668e-01   +4.431019063112804e-01   +8.292113351583376e-01   +6.412493045734651e-01   +5.644450428916040e-01   +2.709858182790555e-01   +4.006704375233105e-02   -5.393386396277242e-02   +2.025788391055689e-01   -8.756865447802871e-02];
L2E_Input1_iAMPA_netcon = [+4.194437949683412e-01   +6.917703836370693e-01   +8.560587025610649e-01   +9.627772355805402e-01   +7.237650836986714e-01   +7.614734827134274e-01   +5.710075474142491e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+5.917463748193748e-01   +5.376873425860048e-01   +7.373185085839772e-01   +6.226500328165726e-01   +1.286112754546999e-01   +9.459009265633155e-01   +4.307371314461212e-01   +3.336428554809524e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
