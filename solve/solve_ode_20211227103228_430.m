function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.415179348108793e-01   +8.066191690526349e-02   -3.004680961662279e-02   -4.708850527709722e-02   +1.422874365761156e-01   +1.905210696449383e-02   -1.694288709181477e-01   -2.807660601567541e-01   +9.892138259594578e-02   -2.077023000740608e-01   -8.905339905026470e-02   +7.504754833320026e-03   -6.542548355882755e-02   +1.872246502100983e-01   -4.593087686891282e-01   +7.078131465999085e-02; +6.809544217507392e-02   +1.682302381935870e-01   -3.231164942351147e-01   +7.152053752579307e-02   +1.171705200494976e-01   -6.336817244837860e-03   -3.721492644966081e-01   -7.065602783294826e-02   +1.164021974649364e-01   -4.125522496727136e-01   -2.142048058234151e-01   +4.075821496854908e-02   +4.746583397456362e-02   +4.058954508235025e-02   -2.714721866210956e-02   +1.403107716445230e-01; +1.098120714937642e-01   +4.637615365471529e-01   +9.032691400975688e-02   -9.718524757738392e-02   -5.753699603437829e-02   -1.537638635111747e-01   +3.393798341693288e-02   +8.221090972882156e-02   -3.120225996219416e-01   +1.201876502620818e-01   +1.909227371084156e-01   -5.910921145513670e-03   -3.634818150420669e-01   -3.259969000531248e-02   +3.366229692518723e-02   -1.716799776182265e-01; -2.614988284468275e-01   -1.212121793138968e-02   -9.741227329135352e-02   +2.553692220183099e-01   +3.107134116080035e-01   +3.736662601409591e-01   -1.066218845747907e-01   +2.061086461867090e-03   -6.112012626197569e-02   -4.601674166376146e-02   -2.662141195057690e-01   +1.219163662094376e-01   +1.939474505502985e-02   +1.330869128939967e-01   +6.825296725758324e-02   +1.067603859991714e-01; +1.669126860933812e-01   +1.604112437294387e-01   -6.064771546318293e-03   +1.230507562985206e-01   -8.331128324702099e-03   +2.269319888010498e-01   -1.774082423162860e-01   +2.162630423224896e-01   -1.550948806081456e-01   +3.733527419406812e-01   -4.317513286683682e-02   +3.341329093152364e-01   -1.552358152401395e-02   +2.236579072042759e-01   +1.428564435157195e-01   +1.733609097871898e-01; +2.932643552818037e-01   -2.477094322513473e-01   -3.219264529102079e-01   -4.259898784554995e-03   +4.362069286582837e-01   -1.341704886076635e-01   -8.010894672783220e-02   +2.745727998299656e-01   +1.071987319877376e-01   +1.053452676002136e-01   -5.275021197601333e-01   -4.721925258338835e-02   +1.405823003180203e-01   +1.198604092255716e-01   -3.303194053840476e-01   +2.232477263532200e-02; -1.383475424863752e-01   +8.057032991924673e-03   -3.204405768513494e-01   -4.799066400719743e-02   -2.126745488097040e-01   -7.638069149725982e-02   -1.710254124514103e-01   +6.138705220186305e-02   +1.961894911295141e-01   -2.335994565317755e-02   -1.321119468825694e-01   +4.005522955859295e-01   -5.765201501592629e-02   -1.142324091450493e-01   +2.854927576968986e-01   -1.375513928214257e-01; +3.459715913098234e-01   -1.460630800577874e-01   -1.351633968329697e-01   +1.159945003157702e-01   +1.229186391568978e-01   -9.606785247940475e-02   -2.933310039693061e-01   +4.383332950324205e-02   +9.512187965612928e-04   -1.349125946929042e-01   +1.269803624692309e-01   +2.049962759896563e-01   -1.359904397377329e-01   +4.393101187936150e-01   -1.184167527509183e-01   +8.232659514226949e-02; +1.401499563606289e-01   +4.252441827057729e-02   -5.345417877919945e-02   +5.575176707767743e-02   -3.219628191984835e-01   -1.573803523681603e-01   -2.008844543933815e-01   -9.499578188014618e-02   +1.205871854614748e-01   -4.575578787247304e-01   -2.495224695086125e-02   -1.214859465378962e-01   -1.325465937024611e-01   +7.913746020034604e-02   +6.626571481699366e-02   +2.161207510375683e-01; -1.125702297596931e-01   -2.078416915785406e-01   +9.182510726106213e-02   +1.642353817432974e-01   +4.141456211758150e-02   -8.206319160736252e-02   +6.976198727940075e-02   -4.826774299630495e-01   +3.393865959974160e-02   +2.953143062397562e-02   -1.942256102715451e-01   +5.602041816322946e-02   +2.197037152159413e-02   -8.134573304740222e-02   -7.301738565566428e-02   +1.438541308967229e-02; +4.560885042657526e-02   +7.937782466854959e-02   -4.508242465565697e-01   -8.148401907247460e-02   -8.267145804197451e-02   +2.407591624771049e-01   -1.834863554641863e-01   +6.977006221030987e-02   -3.866408217839230e-01   -5.075295337353471e-02   -6.252354494640983e-02   -8.254533475150919e-02   +1.033571437176602e-01   +1.067840666801560e-01   -1.983231788982637e-01   +7.560279678862716e-02; -2.368907848423124e-01   -1.574812190114008e-02   +2.341890505378637e-03   -2.141263499322131e-01   -2.223797813539652e-01   +1.648667004361812e-01   -1.518536373140252e-02   +1.553705594856693e-01   -8.139628160372585e-02   +4.385807518975052e-01   -2.192994446016870e-01   -2.967939320952391e-01   -1.287991662004732e-01   +8.181777830844865e-02   +3.800290006265103e-02   -6.536803543523807e-02; -1.222426974017251e-01   -1.490581226991629e-01   -1.887596547286121e-01   +6.423387500748096e-02   +4.410144737790629e-02   -3.349687844039950e-02   -2.777639275419007e-01   +3.676202292360465e-02   +2.730931012448046e-02   -3.274458872085739e-01   -1.635816270801267e-01   -2.923021157384907e-01   -4.681949212907417e-02   -9.763702196577081e-02   -5.969845684383419e-02   +2.322354057766007e-01; +4.764969910015174e-01   +2.042219207560641e-01   -2.753836159222682e-01   -1.744639048179405e-01   +1.567796367648335e-01   -3.634246033875149e-01   -8.264090537199181e-02   +3.052559636504716e-01   -7.945974607023831e-02   -2.592469808510542e-01   +1.482440193616261e-02   -3.351290801400003e-01   +5.572472251994476e-03   -2.124497541854051e-01   -1.388365671464115e-01   -1.259496671418040e-01; +1.062910277188654e-01   +1.560048522794806e-01   +1.621100615467039e-02   +3.754892411112790e-02   -2.027507939806020e-01   +2.469048178788135e-01   -2.653103313617308e-01   -1.539271243081356e-01   +9.233005161070384e-02   +4.164513153589291e-01   +7.288847735828555e-02   -2.023510995416624e-01   +3.160919353578738e-02   -5.872393938684329e-02   -2.103770569658752e-01   -1.448358255048522e-01; +2.322762458322815e-01   +3.078509318621591e-01   -2.695320738069620e-01   -3.009022040579210e-01   +3.575385713832030e-02   -1.315219682418442e-01   +4.535018573227350e-02   +4.513170378608359e-01   +7.482368380638942e-02   +6.195671474156548e-02   +1.028629405155968e-01   +3.856229299841023e-02   -1.733145395792479e-01   +5.669412084598845e-02   -1.960478021338062e-02   +7.869216073042987e-03];
L1E_L1I_iGABA_netcon = [-5.853999685952622e-02   -1.004844440459866e-01   +6.884239124611261e-02   -2.562467980615672e-01   -1.183086940950838e-02   -1.009663168902227e-01   -2.190263956179969e-02   -4.259148331252572e-01   -8.981951113664491e-02   +1.423753467526012e-01   +1.805570812957956e-01   -8.106215599755218e-04   -5.506883771384374e-02   +1.703753790668459e-02   +4.326829655760235e-02   +7.081343828563863e-02; +2.489902351304693e-01   +2.505596710038678e-02   +3.831317357414841e-01   +1.989903073296286e-01   -2.870567873366259e-01   -2.571389430716835e-01   +4.200953233684704e-03   +4.983714444157794e-02   +4.066025238068237e-01   -9.051428560672473e-02   -3.278873194291033e-01   -2.196522379580146e-02   +1.699530038464268e-02   +2.607643755798132e-02   +6.799676396987143e-02   +2.516304029779712e-01; -1.998894653614998e-01   +2.142409461965686e-01   -2.777535634288638e-01   -6.983367426260055e-02   -3.236830247787520e-01   -1.020288296769892e-01   +3.267118055678875e-01   -2.177416281781818e-01   +8.682315456344892e-03   -1.382745769598046e-01   +2.023541662146464e-02   -1.063420411600425e-01   -9.465490686780655e-02   -2.120480608137588e-01   -2.888000101427971e-01   +1.199285631189552e-01; -2.563183035400879e-01   +6.836130012631002e-02   +5.938747952675995e-02   +7.400712070080276e-02   +5.242766424572241e-02   +1.920006210748122e-01   +3.184476045166364e-01   -1.887316655655616e-01   -3.174542401052089e-01   -1.625554820634680e-01   -1.458528159114571e-01   -1.624900287913163e-01   +2.325501644106513e-01   -2.339479456723590e-01   +2.188224813629426e-01   -2.349982777224275e-01; -2.657612421522456e-01   +4.336553170955099e-02   +3.309006103898499e-01   -2.854447170288467e-01   -4.320493784874940e-02   +1.748294063555951e-01   -6.545147153986752e-02   -2.440099117390730e-01   -4.540182869804284e-02   +4.076676194090400e-01   +1.352405238616917e-01   +1.189901157618772e-03   +7.026742320307582e-02   +1.855178678436982e-01   -2.728055269036869e-01   -2.036102363824846e-01; +1.515832059289473e-01   +1.814005894555848e-01   -1.733527543269450e-01   -3.200315502506929e-01   -6.847957652063630e-02   +3.878359304314583e-02   +1.850951556167020e-02   -1.404956525823137e-04   -1.218877093548224e-01   +8.439613862100503e-02   +1.863999944271407e-01   +4.266813175145810e-01   +1.056438247377024e-01   -2.602214967276036e-01   -2.520205934416839e-01   -2.190613199616202e-01; +1.520474752805617e-01   -3.577055413798762e-01   +1.988469309559558e-02   -2.153113594798316e-02   -1.089469752217505e-01   +3.240758726628994e-02   +6.913408962422794e-02   -1.531605328897647e-01   +1.698959386400625e-01   +1.345920572777169e-01   +2.891598888561187e-01   -1.205255901740913e-01   -9.452631786042018e-02   -8.049245842340651e-02   -1.657103021287427e-02   +3.403311684438800e-01; +1.450545868361092e-01   -1.897079124675862e-01   -1.391718925861456e-01   +9.011726028446884e-02   +2.265357803756871e-01   -1.212917713169261e-01   +1.179530863825378e-01   +2.895974756814530e-03   +2.143103383161155e-01   +2.714254814361726e-01   -2.186963279042712e-01   -2.436964993762545e-01   -2.810372350593471e-01   +1.802152123091281e-01   +6.330491496889139e-02   -2.320506232390440e-01; -1.070667427871692e-01   +1.121811754409146e-01   +2.701610823861840e-01   +1.661342570441615e-01   -3.445213270800711e-01   -1.764221671816072e-01   +1.137623247933251e-01   +1.808425575249667e-01   -2.491939555521880e-01   -3.292559025928582e-02   -7.263487581225143e-02   +7.796965753689364e-04   -3.766749076616929e-02   +1.380920141157789e-01   -4.019795884372397e-02   -2.033882654376554e-01; -2.471721170647424e-01   -2.077543466479136e-01   -1.887161168517432e-01   -7.140593814707469e-02   +9.958983729936802e-02   +2.070123282737392e-01   +9.051248272400665e-02   -1.862619633687489e-01   -3.543282569012700e-01   +1.183199763257691e-01   -4.506816586291417e-02   +5.130924473821564e-01   +1.100124719612504e-01   +1.894689487428141e-01   -7.268354353259052e-02   -7.941019125535748e-02; +2.975744819793817e-01   +2.722606207908221e-03   -2.351649275861898e-01   +5.014059083189045e-01   -5.193564567807333e-02   +1.622801606940738e-01   -4.989888393045520e-02   -1.182934246503873e-01   -4.467521817559944e-01   -2.861439025100536e-01   +7.390482692715675e-02   -9.429344068569417e-03   +2.964599805603018e-01   -5.110626485539377e-01   -8.443266007236092e-03   -4.229261137003762e-02; -2.726217679357560e-01   +1.069223123079081e-01   +9.285392097741656e-02   -3.225937424018447e-01   -2.547503002045978e-01   +3.500169705508444e-01   -1.621851118660170e-02   +8.322049948446941e-02   +3.513586838325228e-01   +7.915393347892478e-02   +9.540665689482142e-02   -2.083548350116352e-02   +4.024575072933769e-02   -1.786206051102200e-01   -6.984453435868052e-03   -3.794107661503805e-03; +1.385386667172905e-01   +1.136515822721468e-01   -6.744548558411829e-02   -8.518014604970986e-02   -3.492076001181432e-02   -3.181773772603016e-01   -1.159050746372999e-01   -1.034165995399747e-01   +5.409620950041234e-02   +1.654563633123323e-01   -9.537066673793904e-02   -1.021514488367276e-01   -1.322272713420597e-01   +2.520029984195748e-01   -6.941478759822017e-02   -1.612753077712545e-01; +1.822527246082628e-01   +3.592383779025042e-02   +3.484023225992992e-02   -2.424017523657328e-02   -3.479533967217305e-01   -1.783853307771492e-01   -3.975290243668136e-02   +1.546246232327625e-01   +2.038976993873901e-01   +2.968612357722056e-01   -2.205357003172123e-01   +1.134634303565309e-01   +6.105635663657280e-02   -2.646140971350230e-02   -1.750674452392871e-01   -6.800405603449074e-02; +8.816937693860685e-02   +1.856842461060903e-01   -2.053100791261072e-01   +2.095499721311525e-01   -3.280489654082095e-01   -6.749694732755129e-02   +2.660127606404497e-01   -2.116654747879165e-01   -3.053355850026104e-01   +5.007671671688392e-02   +1.597444203373689e-01   -2.250118378322224e-01   -8.137330756898134e-02   +3.402347609966694e-01   +3.750808303903748e-01   +3.048301470928811e-01; -2.190621823389624e-03   -1.432111152898441e-01   -3.364641182268098e-01   +2.659709089198641e-01   +6.924396656572906e-02   -1.489689346342143e-01   +1.245636544958525e-01   -1.856730621200246e-01   -2.307870432689568e-02   +1.727535944175911e-01   +1.727458888820130e-01   -1.158285859434974e-01   -2.250296552854844e-01   -5.973236551052905e-03   -1.066979354638255e-02   -2.647289593828538e-01];
L2I_L1I_iGABA_netcon = [+1.363884880588639e-01   +2.431061382930618e-01   +7.460354839951677e-02   -1.169269048209469e-01   +1.487746191041417e-03   -2.785039131961157e-01   +3.328351552388693e-01   +1.520622171148826e-01; -4.729456538693211e-02   -7.067797681870649e-02   +1.101394852488187e-01   -1.413400514297806e-02   -2.247002372049577e-01   -3.390839883124446e-01   -1.327914068044893e-01   -2.708932107556437e-01; -1.565750817420527e-01   -2.084554068085377e-01   -1.966168286821138e-01   -1.620990800654712e-01   +1.017454759845777e-01   -9.067212765435580e-02   -8.661088326066940e-02   +3.570343737031702e-01; -1.988635318308137e-01   +5.934693786891415e-02   -1.161423628034463e-01   +1.045468824732357e-01   -4.387568989274865e-04   -9.404508058578673e-02   +2.837263435412425e-01   +8.363590736377312e-02; -1.901785340010551e-01   -1.930347577025295e-01   +2.340891250315222e-02   +1.407453160990357e-01   +1.847527952119297e-01   -1.229387020145727e-01   +7.762762086479014e-02   -5.519974731931565e-01; +6.094513431586668e-02   +1.211718684457577e-01   -1.561135118869909e-01   -3.847478197756795e-01   -8.427487016237287e-02   +3.846338988402469e-03   +1.384564585262167e-01   -3.235886317589407e-01; +1.682102070373878e-01   +2.225851637325073e-01   +2.738888490243262e-02   -2.456615109940916e-01   -1.917223692474235e-01   -1.910550861068759e-01   +7.807351028793302e-02   -2.198212323985942e-01; -7.744711757063465e-02   +2.883177547225132e-01   -1.710692243890903e-01   -1.782833489184094e-01   +4.969308618447391e-02   -4.831870046671288e-02   +2.000494363994346e-01   -3.854106061781137e-01; -2.925156250049518e-01   -2.856256936619985e-01   +2.971441350992342e-02   -2.018062979460113e-01   -2.900617323944090e-01   +1.457056179094069e-01   +5.043332529407250e-01   -2.030825331942582e-01; +1.331082104185189e-01   -2.987494944329206e-01   -7.025133747276369e-02   +3.331295944436805e-01   +2.118222001842807e-01   -1.331342668165657e-02   -5.392658003806629e-02   +1.122573278083655e-01; +2.268922736473750e-02   -1.527246387722794e-01   -1.435551241083441e-01   +4.633365322744289e-01   -7.628241688371727e-02   -2.429562925551177e-01   +3.050361654396110e-01   +7.281717833164369e-02; -4.751910329885067e-02   +2.057568647329110e-01   +7.195475452038236e-03   -3.783772244636830e-01   +1.770456530035201e-01   -6.161627263050916e-02   +1.112185776218163e-01   -1.248538640965593e-01; +3.424099729736729e-01   -4.620823926167167e-02   -2.749704033290594e-01   -1.117651601980399e-01   +1.184139218168004e-01   -4.905983523898122e-03   -1.750588525296769e-01   -2.683797523375896e-01; -4.585832925216378e-01   -2.218466687175195e-01   -1.145922832165412e-01   +1.071072639945842e-01   -1.810626945966000e-01   -1.187003341408964e-01   +2.098354416530610e-01   +1.621029209580633e-01; -3.297291190576396e-04   -1.978001068454428e-02   -1.111673920473207e-01   -2.603820382806512e-01   +2.616714601152182e-01   +1.699293571787333e-01   -2.920408940809410e-01   +1.704203888886287e-01; +3.285235731325289e-01   -6.786937401502904e-02   -1.331351952488280e-01   +5.052105837275524e-02   -1.691841803568553e-01   -1.870025999479984e-01   +2.871903066226052e-01   -3.015583067951934e-01];
L1I_L2I_iGABA_netcon = [+3.065322893127173e-01   +3.815753877585202e-01   -2.189068329148208e-01   +5.520079954659014e-02   +5.602156366688300e-01   +1.340860884692879e-01   +9.887794020051661e-02   -6.687174164020537e-03   -3.730356691041568e-01   +2.277036386762132e-03   +1.942475191986343e-02   +2.322285163553005e-01   -1.877025766234394e-01   -9.046299225546450e-02   -2.364960629105589e-01   -1.233146667048705e-01; +1.298859583723393e-01   -4.941075298431483e-02   -9.100736603533545e-02   +4.502011211826804e-01   -5.928502690316934e-02   +2.042251230879103e-01   -4.786920279612578e-02   -1.668414017780323e-01   -2.072483078131500e-01   +4.426353379290149e-02   +4.508590221640828e-01   -5.083290762618024e-02   +3.748861035533975e-01   -1.226785906533104e-02   -2.821365622431036e-01   +1.360101585336891e-02; -2.385773265484974e-02   -4.586116420156808e-02   +5.009198568109996e-03   +2.046232495353713e-01   +2.427053031129398e-02   -1.132980186561007e-01   +4.080933448282683e-02   -1.625592382449714e-02   +2.088100671917719e-01   +2.193883846681099e-01   -2.296799375364971e-01   -1.241425398273445e-01   +4.034073406195635e-01   -7.627635888221934e-02   +5.094904683880526e-02   -5.061508180545277e-01; +1.599280750533855e-03   -1.170082388771120e-02   -3.640592668379880e-02   +1.553441575951983e-01   -2.262693700790826e-01   -1.312915420281622e-01   -2.146348362650619e-01   -7.422162537235411e-02   +2.999921200208626e-01   -1.501233891997279e-01   -2.466472781886926e-01   +3.268473051046533e-02   +2.950092529385860e-01   +3.408968588290317e-02   +4.171354205066002e-02   -2.311876913530568e-01; +1.051538258827314e-01   -4.758671967566566e-02   -2.765986017718730e-02   -1.490636854954406e-01   -2.318800850228419e-01   +9.416730294679915e-02   -2.769759460633410e-01   +3.119696089218755e-01   -4.842190178141766e-02   -6.945172671196392e-02   +1.529719010902877e-01   +2.083183810688450e-01   +2.869190903811517e-01   +2.276896307459446e-02   +3.209950642313056e-01   +3.255117604819493e-01; +2.856479305523568e-01   -1.094412293383176e-01   +1.786325064583713e-01   -7.219847716784999e-02   -4.695216716299540e-02   -8.868756930119512e-02   -1.290052959817646e-01   +2.511092897341874e-01   -5.896822209627435e-02   -8.208841576560338e-02   -4.334476672512779e-02   +1.950784457979070e-02   -1.283558484927630e-01   -1.973922811415408e-01   +6.882284483711969e-03   +1.596547751247291e-01; -2.125726428625744e-01   -5.621055971128087e-02   +1.032558885483174e-01   +5.548939491003477e-02   -1.063139206069600e-01   +3.163426309045309e-02   +5.874453245967456e-02   -2.017954405350579e-01   +2.293485042556578e-01   +8.629087431546270e-02   +1.849699582043783e-01   -8.558356952417062e-02   +3.308116818244833e-03   +2.445960919044950e-02   -2.222030054037158e-01   -1.765550581013827e-01; +9.638501642210753e-02   +2.900474703249111e-01   +1.708057653199785e-01   +8.433709472955694e-02   -2.111994152248824e-01   -8.195482558863645e-02   +1.285329622516520e-01   +3.029035110656854e-01   +2.847286963151283e-01   -1.029863244776064e-01   -1.058824635369360e-01   -4.087288062436131e-02   -8.199787718087140e-02   +2.217430420850090e-01   +1.367081424342256e-01   +1.531829811608411e-01];
L2E_L1E_iAMPA_netcon = [+2.211407824152892e-01   -3.720896520037599e-01   +2.054297030398647e-01   +1.628856708845182e-01   -3.888107570888563e-01   +1.439094996784624e-01   +1.404297011950945e-01   -6.005331285403137e-02; -6.793949789897344e-02   -2.953217725266956e-01   -4.260455941225470e-01   +3.787864497461861e-02   -1.933177843701173e-01   -7.131066228754088e-02   +2.461212017788547e-01   -2.602314134099006e-01; -7.520261238150479e-02   +2.327738494624373e-01   +1.055802785987979e-01   -2.311584947831573e-02   -2.170841226383702e-01   -1.503486429813432e-01   -2.675437546967974e-01   +3.567337718128399e-02; -2.033039981578593e-02   -1.107482133768759e-01   -7.703755591290982e-02   -3.351075644252197e-01   +2.415356445983543e-01   -2.200824596959370e-02   +7.074791922251189e-02   +8.711617937516633e-02; +1.057999436219615e-01   -3.769554288578368e-02   -5.654573581573401e-02   +2.072199684214511e-01   -3.806116298172436e-01   -8.661874128969951e-02   +6.884774664850574e-03   -1.518567448447152e-01; +2.310051654775544e-02   -1.402771637064680e-01   -4.520754474728543e-02   +1.162711194474342e-01   +3.616830236464119e-01   +1.190074630876988e-01   -1.212281272287357e-02   +2.214726128605516e-01; -8.848024675294699e-02   +1.672078367620438e-01   -8.595200354300842e-02   +1.055167291135560e-01   +8.601624632471784e-02   +3.462485631598566e-03   -2.081889303280176e-01   +7.528798419267899e-02; +1.247894802970608e-01   -1.460226660157898e-01   -2.820955655384003e-01   +2.852795948740201e-01   +1.131243446933068e-01   -7.209644844832802e-02   -1.913522189834327e-01   -3.955341238936154e-02; -1.087176405471273e-01   +2.005240885107570e-01   -9.822779884296651e-02   +2.090421252830701e-01   +1.741343575726132e-01   -1.667462972124703e-01   -2.120630158516859e-01   -3.253136101578095e-02; -1.001906145139927e-01   -1.505627752185051e-01   +1.720466425241911e-02   +1.146907482325152e-02   +2.358435656762376e-01   -6.741392478523821e-02   +1.079479008801713e-01   -2.705749345731951e-01; -2.762684188483038e-01   +2.386801475644607e-01   -2.697164917709162e-01   -5.219833764934667e-02   +1.668066035962990e-01   -2.516578890393584e-04   -1.808865067177904e-01   +5.576696177714643e-02; +1.388591776897208e-01   -3.889482378970330e-01   +9.024058005058483e-02   +2.852488293287383e-01   -3.219440015237064e-01   +3.410396483310314e-01   -9.751411047822620e-02   +1.343823747707514e-01; +1.782145773199807e-01   -3.296817618068574e-01   -6.196270951738295e-02   -6.172612335361519e-02   +3.467966236523721e-02   +5.490352373574638e-02   +4.460714707306386e-01   -9.274205055415283e-02; -1.627290799472108e-01   +9.294134131046426e-02   +6.991463218234810e-02   +2.555277546095737e-01   +1.867764945838707e-01   +2.968805112327934e-02   +6.274317975659655e-02   -2.609928997820477e-01; +2.423417256590832e-01   -2.008604441609194e-01   -1.030866731461826e-01   +1.528278468322355e-01   +5.286698483026253e-02   +8.759394238352931e-02   -1.441684265122886e-01   +2.640449112664689e-01; -9.521114170238520e-02   -3.692303176042589e-01   -1.424512147046203e-01   +1.507792571674446e-01   -3.981547071239301e-02   -1.098644168134299e-01   +3.177421157081204e-01   -5.663793094238621e-02];
L1E_L2E_iAMPA_netcon = [-4.146798704767196e-01   +1.683158453265962e-01   +4.424698898487800e-02   -1.068383915524113e-01   -7.965978285722444e-02   -4.071331654417512e-02   +2.228655098061163e-01   +1.178420059669158e-01   -2.029471466176954e-01   +4.450653342044817e-02   +2.324906755868608e-02   -1.471674900621939e-01   +7.835899094492375e-02   -1.254265151884207e-01   +2.463193245443298e-01   +7.506568704098743e-02; -2.528169160561682e-01   +8.278742657654715e-02   -2.467426967309223e-01   -5.252313462308690e-02   +1.362588031830084e-01   -2.634293617555539e-01   +1.196582425963948e-01   +1.060189420312870e-01   -1.206305974958498e-01   +2.009652903741903e-01   -9.348827851928096e-02   -1.891806825113357e-01   -3.753667351526642e-01   +1.158572984609270e-01   +1.869918971481506e-01   -3.929436642486594e-01; -1.591047457182963e-01   -5.580404423291016e-02   -1.968659896134078e-01   -1.414706862944410e-01   -4.569507450812392e-01   -2.298191608232800e-01   +1.246331776330067e-01   -1.566757505375692e-01   +2.623495656891469e-01   +1.427968129177939e-01   -4.774875862408106e-02   +2.817585931186438e-01   -2.576039202308241e-01   +1.436287455514462e-01   +1.165429502246268e-01   +1.912722522980637e-01; -2.059269573315716e-01   -1.974788326945016e-01   -5.384313508015411e-02   +3.798395402725309e-01   +5.044519309870789e-02   -2.166557707445471e-02   -1.692425066325635e-01   -8.313475491026748e-02   -1.309972308038571e-01   -3.971778665273703e-01   -1.325271660111900e-02   -1.985422557127183e-01   +1.485978500407500e-01   +1.494538465277157e-02   +1.174735815912985e-01   -4.332885306923750e-02; +2.752656727573353e-01   +4.251946664051216e-02   -3.146320996739219e-02   +5.416101385505454e-02   -3.439745549556393e-02   +8.675679672521619e-02   -2.343154036091261e-01   +1.188903642609137e-01   +6.978826375655497e-02   +9.497438252209073e-02   +2.203323016797794e-01   +2.875645741666389e-01   +3.619704797933461e-01   +2.064914885144193e-01   -1.446109728382761e-01   -4.062013024666715e-02; -9.874249188443550e-02   -1.439712681932504e-01   +9.597535146563209e-02   +6.598001561948658e-02   +3.645879832700966e-01   -1.640038802053881e-01   +1.768108303041225e-01   +2.301430999836434e-01   +1.133471964987728e-01   -3.124054343335140e-01   +1.664028130946623e-01   +1.345044622843691e-01   -2.660813954859459e-01   +1.143392855793425e-01   -1.521813446746962e-01   -2.311116171008699e-01; -3.465448903551657e-02   -1.109887089869607e-01   -4.762863251505343e-02   -1.356182997035007e-01   -6.977019668206352e-02   -1.029073552077600e-01   -1.122958478382478e-01   -7.564404591266963e-02   +1.357247726892104e-02   -1.748808921950695e-02   +3.006140070073476e-01   +2.036129423216911e-01   -3.484405009373032e-02   +2.598670638475489e-02   -4.578967684786676e-01   -8.864168666991126e-02; +2.800149940674326e-01   -4.505147493335585e-02   +1.366211655921772e-01   -1.099755316478064e-01   -1.911553472079861e-01   +1.285640921262424e-01   +8.962135585765646e-02   -1.861617799657878e-01   -1.828463621447232e-01   +3.139992859014266e-02   +2.240801805452395e-01   +1.552223449072659e-01   +2.370681689543156e-01   +1.136117894896438e-01   +6.415596541275885e-02   +6.802033457928967e-02];
L2I_L2E_iAMPA_netcon = [+3.904228581126654e-01   +3.913933442018970e-01   -2.838558282374337e-03   -1.469995244996054e-01   +2.445590644691585e-01   -4.647277015743725e-02   +1.759117139081364e-01   -1.911986967577231e-01; +3.954154557234632e-02   +1.779390784311062e-01   -1.343247218910982e-01   -3.491308861832183e-01   -8.493005519894833e-03   +1.721007663710896e-01   -1.801064693982383e-01   -2.114308517644360e-01; +8.687461480713919e-02   +4.432204583148648e-02   -9.785458210678714e-03   +1.452184326333804e-01   -1.317073942814955e-01   +1.549734718139452e-01   +3.566882240038425e-01   -6.768141369825068e-02; -3.323498535354684e-02   -6.904129777593386e-02   -9.926716689511798e-02   -2.046198504469999e-01   +9.901038411468774e-02   -1.539320373547654e-01   +1.081903470496857e-01   +6.796439492699069e-02; -3.264489202454720e-01   -3.175562342583357e-01   -2.401272325903309e-02   -1.429116919235391e-01   -1.238446669603708e-01   +1.505821208369576e-01   -2.341967723180073e-01   -1.705557943358793e-01; +1.424463991589675e-01   -2.591769039740195e-02   +1.131265767974677e-01   -2.707566194513476e-01   -6.736636834521439e-02   -1.845238371916202e-03   -1.037755166414365e-01   +2.934681203173955e-01; +1.372700879632728e-01   +1.530153095425383e-01   -1.106358607166300e-01   -1.230511447332603e-01   +1.319217898887693e-01   -5.416516946506451e-02   -1.296887122654496e-01   -9.652938925036457e-02; +2.472211338232330e-02   +2.406213906381481e-02   +2.429846616231627e-01   +9.657346387061830e-02   +1.167029947519602e-01   +1.964767650870974e-01   -5.848391102629788e-02   +2.487728800514621e-03];
L2E_L2I_iGABA_netcon = [+7.938378240498051e-02   -4.971853998827561e-03   +3.515861354322191e-01   +3.732665797396167e-01   +1.473467279534338e-01   -1.314167341519488e-01   -4.453836868399892e-01   +1.328556477653005e-01; +1.747827454653270e-02   -1.081762320189188e-01   +3.279369106657934e-01   +2.869445887081563e-01   +4.114699766021879e-02   +7.203634755144975e-02   -2.476276669840675e-01   +6.006093358139776e-02; +2.426449117978132e-01   +1.864232117238021e-02   -1.216554095054698e-01   +4.086609184477339e-01   +4.882146739018794e-02   +4.633427827356353e-01   -1.705625527778133e-01   -2.068852581764630e-02; -4.905942992159369e-02   +3.034167385906497e-01   +1.948298111247150e-01   +1.288257844267722e-01   -1.228168224593393e-01   -2.744114225320073e-01   -1.174246890268991e-01   -2.132694460116528e-01; -1.658533501328290e-01   -2.687482944766247e-01   -2.331805288645680e-02   +2.590386007296957e-01   -1.872395693843113e-01   +1.487028633976167e-01   +1.966593711322920e-03   -6.512720189678085e-02; -1.205964379742997e-01   -1.211697926116431e-01   +4.018449595339792e-02   -1.863670736773403e-02   -7.991794453888471e-02   -6.821035438901554e-02   +4.867062812529562e-02   -4.663533825129337e-02; -2.651389804724530e-01   -1.073268950299790e-01   -6.658236952493728e-02   -3.497868550715483e-02   +1.693609897979746e-01   -4.114539610576436e-01   +5.422918584597586e-02   -1.963121165490914e-02; -1.310798326812656e-01   -5.261853601112922e-02   -1.762036115015755e-02   -6.837932827089421e-02   +1.941634684248447e-02   -3.862054103080168e-01   -1.520485693693151e-01   -1.580208847169622e-01];
L3E_L2E_iAMPA_netcon = [+6.787283435889463e-02   +1.034229074062104e-01   +7.208347456308511e-02   -1.943003482111985e-01   -2.677236218354663e-01   +2.451550453555698e-03   +2.727817246439669e-01   +3.345798180424233e-01   +2.111896715835770e-01   -2.380454126225272e-01   +6.391421085105331e-02   -9.256758258706310e-02; -2.470291500504962e-01   -3.144227501270661e-01   -2.623483919744574e-01   +3.410509362081912e-01   +1.953043445045393e-01   +3.722707904451607e-02   +1.648254893441683e-01   +2.286239417857293e-01   -2.158238794691885e-01   +8.032338191032562e-02   +8.953841154570374e-02   -1.732228575796174e-01; -6.670392965925354e-02   +4.143353890717962e-02   -4.398190885376806e-01   -2.013500290549582e-01   +9.458461407042881e-02   -4.347947791794152e-02   +4.015790896616817e-01   +4.098647462112011e-01   -3.637682801318143e-01   -1.054504589642644e-02   -2.067611185741400e-01   -1.693096944402533e-01; +3.116287957862713e-01   -1.993738121121256e-01   -1.602995477645751e-01   -4.231107588775005e-01   +1.445757731416251e-01   +2.018822207814203e-01   +1.826450540162821e-01   -2.295395172747904e-01   -2.740676471805213e-01   -1.470812607303538e-01   +1.961797434684925e-01   +2.180003394488856e-01; -1.755685323728321e-01   -2.668061438293351e-02   -1.516431238569057e-01   +6.287969902331361e-02   -1.067212439818680e-01   +1.847051502636271e-01   -2.830238221281800e-01   -2.481612202403172e-01   -9.846902047185996e-02   +1.679596922636842e-01   +4.667592776899138e-01   +2.234018244825645e-01; +2.581540232387500e-01   +2.581431644673827e-01   +4.421869328728972e-01   -7.397816122764461e-02   +1.312418331363546e-01   -2.258640346586231e-01   +2.588645127599913e-01   -2.766512363662073e-01   +1.153347335431449e-01   -4.758937804132379e-01   +1.184456714780046e-01   +1.600056524526627e-01; +3.099777533558902e-02   -1.186718145606297e-01   -2.012676624771771e-01   +1.428698646682887e-01   +2.741355268259973e-01   -1.240687319142483e-01   +1.478859545947220e-01   +2.029702898091519e-01   +1.744433681345632e-01   +1.668946097962005e-01   +2.092004636021431e-01   -9.991612665465804e-02; -1.411346408530765e-01   -1.744638279108323e-01   +3.630942175108005e-01   +2.643856992072892e-01   -1.617911929591850e-01   -3.598764311941827e-01   -3.449638187966338e-02   -1.965384684783560e-01   -1.087558276524511e-01   -1.154695032429374e-02   -4.315667703430945e-01   -1.422105853352887e-01];
L3I_L2I_iGABA_netcon = [-2.640809798014395e-01   +5.425000388872869e-02   -1.240785450478057e-02   +9.505574169000089e-02   +1.268331463932602e-02   -1.088883842450316e-01   +6.290067709435815e-02   +6.907385686263710e-02   +1.588155949447421e-01   +1.369619488325888e-01   -2.885151594754546e-01   +1.812963124785677e-01; +3.844314679665323e-01   -1.993045221178350e-01   -7.804681639784408e-02   +7.768605864534991e-02   -3.527679384403488e-01   +6.378125532263976e-02   -1.552218686844679e-01   -7.265176419580842e-02   +1.361768455361368e-01   -1.583868614688690e-01   -1.416445100509902e-01   +4.591724438297907e-01; -1.998852576474743e-01   +1.006887797571622e-01   -1.412807858276595e-01   -1.522616349642107e-01   +3.899885536007643e-01   -1.266755965993186e-01   +3.772628216444959e-01   +7.966598339827308e-02   -3.228643118355459e-01   +2.866997667513940e-01   -1.852222554096753e-01   -1.459596489861159e-01; -2.242351609392121e-01   +1.546806656848499e-01   -7.924581911044630e-02   +3.068248284088619e-01   -1.574991544245987e-01   +1.869007919952931e-01   -1.614148675127068e-01   -1.092457787842462e-02   -2.599781692861800e-01   +2.256891416973689e-01   +9.368099955888290e-02   +1.075327472317292e-02; -4.755075811832858e-02   +3.096607115515598e-01   -2.422253003416352e-01   +3.825125405876580e-01   +7.447427698715298e-03   -1.244221446182206e-01   -6.024404504493984e-02   +2.980840858546818e-01   +1.509473589706117e-01   +3.074057463656261e-01   -2.900453706654972e-01   +7.602997235768723e-02; -2.875669699733840e-01   -2.613861579664782e-01   +2.647928789334920e-01   -2.023278475251661e-01   +7.808261856018706e-02   -1.764782449850501e-01   +6.630117278684537e-02   +2.819062363336004e-01   +2.094790777031779e-01   +3.971838109529396e-02   -1.567819447585699e-01   -1.281546226319234e-01; +1.050123238498452e-01   +4.027415710382720e-01   +7.788768374593429e-02   +2.232526156622092e-01   -2.741289575079924e-01   -3.511502014151037e-01   -6.615967736692957e-04   -2.105498998596751e-01   -1.700996991017148e-01   -1.405934793182938e-02   +3.887801293321542e-01   +1.218831962046660e-01; +4.923026556440161e-02   -3.917111387809107e-01   +7.299114259778593e-02   -3.548484988712723e-01   +1.211617584975069e-01   -2.081408759558138e-02   +5.489761664998233e-02   +1.013595367769168e-01   -1.061215397872972e-02   +6.147511716165682e-02   +1.464291244452866e-01   -2.020360347201424e-01];
L2E_L3E_iAMPA_netcon = [+1.821832915044726e-01   +2.998854595243816e-02   +1.078888395827274e-01   -1.395608193960285e-01   -1.723437972814988e-01   +2.236096161396584e-01   +2.838418641981700e-01   -1.685345078211165e-01; +1.881657205149330e-01   +2.589479025216512e-01   +2.611082383977264e-01   -2.593013705037258e-01   +1.042222732261573e-01   -2.703555045680481e-01   +2.105154174849354e-02   +1.640193221913252e-01; +5.616899131649422e-03   -2.182070868451668e-01   -1.386315125647662e-01   +2.406578463535816e-02   -4.157262807814188e-02   -1.711791871617460e-01   +1.919504500709636e-01   -2.489365318719048e-01; +1.554250415679125e-01   +1.152605946748163e-02   -4.391684172067956e-02   +5.876129104175121e-02   -1.206997453205783e-01   +1.109842104793739e-01   -3.209606136028352e-01   +2.858557289013915e-03; -7.423712957689475e-02   +2.632610084748117e-01   +7.836301198759899e-02   +7.377468717318962e-02   +2.979794166644585e-01   +1.148558977060534e-01   -2.626606666440411e-01   -1.044250405320509e-01; +2.335114126647302e-01   -1.622186232493765e-01   -2.341968210527360e-01   +9.675388326554402e-03   -4.931667514602220e-01   +1.786283087166901e-01   -3.759259575803756e-01   +1.110212368595384e-01; -1.772588296004321e-01   -2.188940299642310e-01   -1.756909457664178e-01   +1.074051852591646e-01   +1.818502182576294e-01   +1.415635738780829e-02   +8.085557670146128e-02   -2.106222612929292e-01; -3.257307972325278e-01   +3.418382758174524e-01   -2.279970741725384e-01   +1.884291248784097e-01   +1.753292781166171e-01   +7.074466951937125e-02   -1.413934230788117e-01   -3.353756667769277e-02; +1.800881693496705e-01   -3.131614752156114e-01   +1.345915470601833e-01   +1.917408959584616e-01   +1.261463790203533e-01   +2.308881683763829e-01   -3.285022945467351e-01   -2.531955483563467e-01; -2.474361268773390e-02   +4.348055217762448e-01   +8.843783582416559e-02   -2.826715412367761e-01   -1.151334795671037e-01   +9.321405883116372e-02   +1.367731354245615e-01   -1.457794501484123e-01; +3.458364087035117e-01   +2.404410938169557e-02   -7.199638134169795e-02   -6.239428652939721e-03   -4.184679919801113e-01   -7.791809615040546e-02   -1.479188991641234e-03   +2.593865217916355e-02; +3.117061583254872e-01   -1.378985180717478e-01   -6.553303753973445e-02   +3.094245939093410e-03   +1.770932429650582e-02   -9.554888830078576e-02   -2.757550188255616e-01   -6.185535813156842e-02];
L2I_L3I_iGABA_netcon = [+3.667194140566231e-03   -4.235608279743979e-01   +4.474270240711149e-02   +1.753684155437751e-01   -1.333562601866854e-01   -1.964592966620391e-01   -3.992183612539967e-03   -1.128136248974315e-03; +8.056218054813474e-02   +1.266850541531431e-01   +9.912544369644834e-02   -3.396512098806141e-02   -2.212629352302497e-01   +2.465791492205301e-01   +2.042697198941444e-02   -2.786312443816339e-01; +1.964429720964283e-01   -1.686280468105807e-01   +1.695715054134833e-01   +4.786639798984597e-01   +2.572890381917103e-01   +2.329275910014547e-01   +5.453177518082672e-01   +1.639697205516241e-01; +1.426798415957535e-02   -3.616674366474589e-01   -2.841277918086184e-01   +4.581831482126357e-01   -2.777174159659103e-01   +1.437405219244909e-01   +1.429857462981863e-01   -4.391147368104056e-01; -2.681292927067827e-01   -1.478276666240628e-01   +6.234168426784856e-02   -3.295030066554275e-01   -2.631536567233612e-02   +3.865955575500943e-01   -3.317501684339201e-01   -2.849483532257288e-01; +1.591009594277981e-01   -3.580786009047571e-01   +1.389620245153739e-01   -3.396149660583392e-01   +1.753091870915817e-01   -1.450781600691554e-01   +2.432044458874563e-01   +1.393205389732753e-01; -4.762451480926743e-01   -1.710763910890613e-01   -3.659176939156262e-01   -8.015467826929565e-03   -1.369540352687363e-01   +7.899467176797641e-02   -3.151530952165799e-01   -1.661832919112269e-01; +2.396480916024799e-02   -1.340243658337473e-01   +1.710815502664789e-01   -1.377434067549015e-01   +3.340582026851280e-01   +2.446490983714165e-01   +2.188008556514959e-01   -3.802999723236498e-02; +5.070709870968335e-02   -1.983998718566934e-01   -1.895724733453108e-01   +3.637650342970333e-01   -2.788601189003593e-01   -1.629503307557854e-01   -6.807669937318941e-02   +2.306595904204347e-01; +2.465532542933536e-01   +1.900566709844908e-01   -2.053441512950110e-01   +3.098690050601681e-01   -4.072733282282029e-02   +4.220258916446783e-01   +8.819759550655740e-02   -2.480916811444051e-01; +1.284725634297114e-01   -1.765037565001787e-01   +3.640079043774843e-01   -2.469378207005551e-01   +1.824493915154644e-02   -6.350529828071340e-02   +3.729489915353268e-02   +1.476173873099478e-01; -1.453024334043632e-01   -7.797942288245464e-03   +5.970535940145316e-02   +1.161175131180025e-01   -1.176847660314891e-01   +2.979899556469719e-02   -9.687600066634100e-02   +1.263128553183271e-01];
L3I_L3E_iAMPA_netcon = [-5.440733710684018e-01   +8.570667215718483e-02   +2.244304933258250e-01   -1.141240283817048e-01   +2.528794426701786e-01   -2.501779373609882e-01   -2.268090611970012e-01   -1.702342819691846e-01   -1.321857453393395e-01   +4.100114054716256e-02   -2.452876978878785e-01   -4.114759208910874e-01; -1.155076203751855e-01   +7.317461315853910e-02   -2.575324980293258e-01   -1.687947024658182e-01   -2.391396828539817e-01   -1.729756228393005e-01   -2.125220980771103e-01   -2.804840268821913e-01   -3.358042861337414e-01   +1.867696446298125e-01   +2.707142252775353e-02   -1.078575416610174e-01; +1.288946221755807e-01   -3.570094521057550e-01   -2.283239217661078e-01   +4.905428290090390e-02   +3.797966778422247e-01   +7.670977187747358e-02   -6.595839459820391e-02   -1.492368537961356e-01   +9.375873554732163e-02   -1.071331950372925e-02   +4.694074593296561e-02   +1.240361726896813e-01; -3.635339938699089e-02   +2.731295714401051e-02   -2.033972877510889e-01   +1.618410743797099e-01   -1.465058197311001e-01   +4.873702989283756e-02   +3.542926931540809e-02   -1.366697076345125e-01   +1.041593193659659e-01   -4.819387836301147e-02   +4.337888709806845e-02   +5.805369089024100e-02; -3.299701457609728e-01   -2.014200973634457e-01   -1.303947637107628e-01   +1.136747417279115e-01   -3.089079329506553e-01   -1.933170262966042e-01   -1.340168603763459e-01   +8.583323251066727e-02   -2.978939658648908e-01   -3.386449555162892e-01   +1.761068503914749e-01   -3.685961831685763e-01; -3.310247604840736e-01   +1.055834095889971e-01   +7.279888343534874e-02   +5.409365942121517e-02   +9.447764081102963e-02   -2.602544646394918e-01   +7.518260479897523e-02   +8.493328131729393e-02   -1.092270722877030e-01   +2.467595651766573e-01   +7.339448670102179e-02   +7.749412997948651e-02; -9.792801188077657e-02   -1.194932775388685e-01   -1.716234760130236e-01   +2.068627030471924e-01   +8.059303292339734e-02   -8.872977068858058e-02   -9.982110729355557e-02   -1.301693555772554e-02   +5.461458345468304e-01   -1.149510151363101e-01   -1.540012038543882e-01   +3.298568893767381e-01; -5.358394311665637e-02   +1.907229839104491e-01   -3.654616553677509e-01   +1.134355848229537e-01   -2.106432044859710e-01   -1.037429624484727e-01   -3.358948749326737e-01   -4.638040625494947e-02   -1.072889267898273e-01   -4.693514416955357e-01   +1.818270704327897e-01   +2.660240269568244e-01; -2.914925502708352e-02   +1.623767437570116e-01   +1.421434838341402e-01   -8.252152851491044e-02   -1.311223511567147e-01   +1.504320769257854e-01   -1.695464071885011e-01   -2.344160029667770e-01   +2.100213778913554e-01   -4.751816893878442e-01   -3.090197532703941e-01   -3.087622950089794e-02; -3.767252259794628e-02   +2.386415060336947e-01   +2.193143806654416e-01   +2.200484701700730e-01   +2.916471323896013e-01   -4.680469578117966e-02   -6.254467714359238e-02   -2.463744277069431e-01   +3.322852312687850e-02   -6.218582250956765e-02   -3.358486288971371e-02   +3.175203775867835e-02; +7.673233893315534e-03   +1.095810125297048e-01   +2.237855919312827e-01   +3.184847588154387e-01   +2.261704521432032e-01   -1.731852505556727e-01   -7.454430915526206e-02   -9.832828024926872e-02   +2.013918735945105e-01   +2.519871427304502e-01   +1.202341580520720e-01   +2.307784215354781e-01; +2.462943903319276e-03   -1.830034283143413e-01   +3.383790574114460e-01   -1.743818873568579e-01   -4.610887381008893e-02   +3.549819640807956e-01   -4.550604640082583e-01   +1.795817829908826e-01   +1.668590150706232e-01   +2.434011965995938e-01   -2.513059669487385e-01   -7.503318356937025e-02];
L3E_L3I_iGABA_netcon = [+4.834028076717189e-01   +1.727471339667516e-01   -3.107391259375614e-01   +1.066914761042392e-01   +7.195383484390655e-02   -1.097839163945524e-01   -2.069487642790580e-03   +5.323644861645924e-02   +1.889395173382399e-01   -2.112822669327504e-01   +2.084253725335957e-01   +3.247193106756558e-01; -1.633358899194307e-02   +1.506486202642476e-01   -1.392525831101204e-01   +1.028800500081514e-02   +3.772588596003371e-02   -2.102550300983090e-01   -3.326461368688175e-01   +3.045386953569480e-01   +3.435175424789971e-01   +8.120810564559493e-02   +2.871816843017141e-01   -1.906592980444420e-01; -3.295756459317254e-01   +4.745811795873045e-01   -6.014909687543757e-03   +1.652688813059855e-01   -2.566908178873701e-01   -3.621620719263983e-02   -1.284646180352693e-01   +2.156756705636120e-01   +1.717841112619172e-01   +4.510103110437924e-01   +2.327965206868343e-04   +2.053652499927680e-01; +3.124719145831755e-02   -4.612967569596135e-02   -1.297864260441687e-01   +4.346892548544931e-01   -1.206092567362865e-01   -2.465228289080719e-01   -2.079507312664734e-02   +1.622399363722413e-01   -1.282711748843704e-01   -1.511406969149475e-01   -6.267997496738953e-03   -2.008848639694780e-01; -5.723187917644219e-02   +7.496383048144069e-02   +3.074970336788784e-01   +4.705387669683538e-02   +1.863216465368451e-01   -2.582811635100697e-01   -4.462445193727370e-02   -1.726615190512628e-01   -1.641752969044969e-01   -2.830493556104817e-01   -1.714180283779704e-01   -1.321863962002627e-02; -3.703071803274048e-02   +5.691769886220102e-02   -3.081676885781531e-01   +1.396158583860024e-01   -1.233479040049624e-01   +1.999709331738840e-01   +1.452040760332963e-01   -8.004377618522311e-02   -1.008420354885833e-01   +2.791993239023093e-01   +6.621985355102998e-02   -1.753205649049986e-01; +1.260062656502444e-01   -2.281107914687888e-02   +3.942346188677594e-02   +1.088088403892544e-01   -1.427658584559579e-01   +3.103293861132123e-01   -1.210579705732138e-01   -5.972983962985873e-03   -8.542730383861805e-02   +1.182055541196263e-02   -7.260151245110660e-02   +8.848938512132455e-02; +8.346866864475930e-02   -2.283775726077117e-01   +5.809307005807345e-02   +4.913887106541029e-01   -4.344252840873686e-02   -2.125879165433936e-01   -4.360426949455816e-01   +3.154728640056030e-01   -5.214642235369277e-02   +2.075060028672857e-01   -1.615595234242325e-01   +2.992607199514986e-02; +3.171043996359939e-01   -1.980012637021566e-02   +2.763363473828412e-02   -5.672455866902852e-02   -3.603615137455576e-01   -2.051472901801333e-01   -2.963442261497750e-01   +4.384770701182332e-01   +2.434043298389004e-01   -1.289735477768289e-01   -3.192789803658781e-02   -1.029201977647227e-01; +1.250348474260239e-02   -2.381808063394526e-01   -2.082170671681542e-01   +2.792701883107940e-01   +1.966922978212277e-01   +3.925760685565555e-01   +7.694692734091060e-02   -1.701171405213736e-01   -1.396411170407914e-01   +3.730615632302368e-02   +3.359191260456513e-01   +7.551510447674127e-02; -2.247413177401865e-01   -4.271067975292785e-01   -2.249270021149279e-01   +8.051464318201949e-02   +2.524385324013594e-01   -1.219861623518129e-01   +3.524747554224732e-01   -1.650195089247733e-01   -1.048614716067915e-01   +7.918831603490809e-02   +4.160374753016843e-01   +1.925797496700028e-01; +2.447444139499417e-01   -6.035915325653295e-02   -7.366241053548653e-02   +1.109225822213704e-01   -1.459694081677713e-01   +2.937313597323777e-01   +4.305355341381593e-02   +1.756283051699331e-02   -1.007448895802474e-01   -3.700469431152167e-01   -1.354252141748457e-02   -5.664224715239330e-02];
L2E_Input1_iAMPA_netcon = [-2.236441750231330e-01   +1.746302946206164e-01   +2.443645336221078e-01   -3.944422871663968e-02   +3.011804489336031e-01   -2.137685222526420e-01   +1.082454822076821e-01   +2.311962903873964e-01];
L2I_Input2_iAMPA_netcon = [+2.462044066220789e-01   -1.361587218488609e-01   +2.788113501138489e-01   +1.767926644292674e-01   -1.864319304734799e-01   +2.937924996288599e-01   -2.280621437209533e-01   -1.743497949672038e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
