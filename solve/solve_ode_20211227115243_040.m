function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.036131782348810e-02   +5.228333671407640e-02   +3.126974424604839e-01   -1.603505680566243e-01   +4.355276223491523e-01   -2.568198231249930e-01   -3.321689424412599e-01   +1.317950826789616e-01   -7.260288746596374e-02   +2.341451177318951e-01   +9.666576962527072e-02   +3.189829080852434e-01   +2.141955659607764e-01   -4.559230684738173e-02   +2.657105449762058e-02   -8.468908042442454e-02; -2.106703785047850e-01   +2.122407848804500e-01   +1.009802434123668e-01   +1.785573220667686e-01   -2.204463012366395e-01   -6.785533354427449e-02   -1.660144334472130e-01   +2.792521252976938e-01   -1.566489492713625e-01   +4.125007889664847e-02   +2.047675509239280e-01   -1.959710029694992e-01   -2.532948247468170e-01   +3.062408508159237e-01   -1.437880323197837e-01   +1.914978407458612e-01; +7.049408928428347e-02   +8.302003513041158e-02   -3.926458643580617e-02   +4.001849150380789e-01   -1.835463517857487e-01   +8.597303141964047e-02   -3.503558609769399e-01   -3.584173258258786e-01   +2.874289276598054e-01   -3.220778978498479e-01   -1.766158487304411e-01   -4.243983864913135e-01   +1.413592064269353e-01   +5.094199704588190e-02   +1.228293260274069e-01   -3.837488538358649e-03; +1.550532752658478e-01   +1.812117757056244e-01   +1.140159433741274e-02   -7.603538845151336e-02   -1.652631909352615e-01   -3.200176490722858e-01   -3.121243069702136e-01   -7.251957154839288e-02   -2.657573547498481e-01   +7.218242327748844e-02   +4.987519448573003e-01   -1.478307086509014e-01   -2.499141753843862e-01   +9.326827132058713e-02   -3.836544615139738e-01   -1.609247557429458e-02; +6.494463642116405e-02   -4.157830085279973e-01   -3.020089807536623e-01   +1.480898107715330e-02   +1.566549032962366e-01   +1.625847929183691e-02   +3.334033252372481e-01   +3.724359481159643e-01   +1.860938474205057e-01   -5.090074154256302e-03   -2.255609951570287e-03   +6.929426765975759e-02   -1.106246696207986e-01   +4.240693887318452e-01   +1.679543445951633e-02   -2.251072469880219e-01; -2.524936649932000e-02   +2.164715811110687e-02   -9.834133640878860e-02   -1.851179448545396e-01   +8.379945758948865e-02   -4.459469014400256e-02   -3.060112916225057e-01   -8.088229035305572e-02   -1.357018526890543e-01   -1.406161689989958e-01   +1.479975724319444e-01   +8.686876103649091e-02   +7.543328458177381e-02   -9.065159822399402e-02   -2.500388971877293e-01   -1.936751164939154e-01; -2.397632987864223e-01   +5.778641416071802e-02   -1.299432872951580e-01   -2.154646701894086e-02   -1.599049273774971e-01   -4.792845262989528e-01   -1.689948501357242e-01   +1.917746960655242e-01   -2.938007164542170e-01   -4.095782499994205e-03   -1.052548213974280e-01   +1.186078883135497e-01   +3.119573883402551e-02   -1.285125314345092e-01   +3.053340730502576e-01   +8.701145664916390e-02; +5.576727331046011e-02   -1.715591577844972e-01   +3.039577015360631e-02   -2.295860315343366e-03   +8.155614015698762e-02   -1.522887260882000e-01   +2.414033957695767e-01   +1.560625356750742e-01   -1.639254995233066e-01   -2.849256390976024e-01   +2.218515745314564e-01   +5.806709849617635e-02   +4.846191305143549e-04   -1.380721411453673e-01   -1.567537438472263e-01   -8.993386594837595e-02; -4.709019442106787e-02   +8.442728920504003e-02   +4.109357383585022e-01   -2.827416631110712e-01   -1.844103032143105e-01   -3.611605186713466e-01   +8.733963641251183e-02   +2.793999107160950e-01   +8.367150143526580e-02   +3.690743150812838e-02   +1.381837509962551e-01   -2.375608748637154e-01   +1.616747312011919e-01   +3.614922719939677e-03   -2.118382359483544e-02   -3.382816821161344e-01; -7.201917799040022e-02   +6.750444349397554e-02   +2.263335626435555e-01   +2.330918604126605e-01   +2.093888026161470e-02   +2.303299681698763e-01   -5.680958603933194e-02   -3.247480168828605e-01   +2.205786779306112e-01   +1.321801457524353e-01   +1.839697568024178e-01   -3.025790148205228e-01   -2.354566401497821e-01   -2.017017587346280e-01   -4.065391216068048e-01   +6.435343124632592e-02; -2.984241256950128e-01   +2.751881055974724e-01   -4.455223401638383e-01   -6.203548246736604e-02   +2.562965256216418e-01   +4.955429845163793e-01   -1.167971335275340e-01   +2.008802968285733e-01   -6.908764604631745e-03   -2.337474734901714e-01   +3.130090560954406e-01   +1.428054840638862e-01   +3.363191149495913e-02   -1.618877074010873e-01   -3.195192903149061e-01   +1.846408338549569e-01; -5.232155162879726e-03   -2.095711082976408e-01   +4.315408007900180e-01   +4.521044355387472e-01   -2.734537082434316e-01   +3.303275664635175e-01   -2.067356807855849e-01   +2.563186514683030e-01   -3.345274818508869e-01   +2.935159670724100e-01   -2.769973165880998e-01   -1.034361864901669e-01   -7.673085740673227e-04   -1.164811380849307e-01   +1.764906439165810e-01   +3.468523599949452e-01; +1.578639150342950e-01   +4.802660124394106e-02   -3.921839519522471e-02   +1.258546016908764e-01   -1.815975832332902e-01   +2.481437916745179e-02   +1.851536339407189e-02   -2.485470577807966e-01   -9.580575179788407e-02   +1.810509014248227e-01   +2.072726170362841e-01   +1.925574552820305e-01   -3.537074992306280e-01   -6.956206651380760e-02   +4.229129796007364e-02   -2.496177054188341e-01; -1.417950690294548e-02   -1.601676739616701e-02   +6.843496061674881e-02   +3.027572919657836e-01   -6.319138375481514e-02   -1.421511677413487e-04   -2.819820566149419e-01   +1.624297194575966e-01   -3.502193196106564e-02   +3.909023135597832e-02   -2.289135434950049e-01   +1.458491893295779e-01   -1.020732933566314e-01   -9.850514800687757e-02   +9.114227729486081e-02   +1.413935519933468e-01; -1.368238817790778e-01   -3.421857082307516e-02   -2.187623679636634e-01   +1.438181202249706e-01   -1.944792367136166e-01   +1.729397231973070e-01   +2.257979364146297e-01   +1.216259702949318e-01   +8.668882807247202e-02   -1.335791803490708e-01   -2.876991654807183e-01   -2.469189531844027e-01   +2.513675915633751e-02   -1.984652981082965e-01   -8.940650454898498e-02   -2.036278895756380e-01; +1.076488752638370e-01   +4.699115829477930e-02   +3.953559071803612e-01   +5.867786184230479e-02   +1.938052280392039e-01   +3.352471700929884e-01   -1.527639759410907e-01   +3.046361710676219e-02   -2.826910028294391e-02   -1.222642206292854e-01   +1.541655634802861e-01   -3.059487194561157e-02   -1.835972903398530e-01   -3.324144064625664e-01   +1.776556130811481e-01   -1.922720909317720e-01];
L1E_L1I_iGABA_netcon = [+1.113808808964149e-01   +2.068596376562352e-02   +1.081367204518624e-01   -1.909212696473123e-03   +8.340266848698044e-02   +6.119938682455298e-01   -3.036643881743445e-01   -1.673603817268886e-01   -2.293623969534079e-01   +3.397780206693649e-01   -2.322880324749310e-01   +1.865673510198352e-01   +1.646599732683163e-01   -2.849327177532652e-01   -2.573152027514279e-01   -5.499891098949420e-01; -3.193635976357253e-01   +4.567985166761278e-02   +2.509552005011024e-02   +7.839422114023366e-02   -1.305596066857857e-01   +2.926816902642956e-02   -1.815570398575569e-01   +3.146905768587069e-01   -2.466458280856453e-01   -4.075297578266395e-01   +3.803333031651615e-01   +6.573029684217738e-02   -8.978263596340533e-02   +3.226196826356600e-01   -5.408082842760338e-02   +8.982005250798700e-02; +5.391229679244441e-02   +3.112067462345443e-01   +1.409369983584923e-01   -2.205046753785678e-01   +3.676169116281266e-01   +1.035528520506456e-01   -9.122929886870859e-02   +1.426087667528395e-01   +1.187311316411015e-01   +1.831914085706710e-01   -1.257785707709886e-02   -1.453939252253754e-01   +2.521114569064771e-01   -3.321817171637590e-01   +2.158842473844210e-01   +2.587863778002116e-01; -1.704698013087228e-01   -1.125985093771125e-01   -2.166921313225736e-01   -3.651044753874300e-02   -1.712842747228828e-01   +7.950698660307326e-02   +3.428071648993546e-01   +2.443911679975750e-01   -1.163354477927368e-02   -4.729052914485832e-01   -2.425241613182073e-02   -1.632494356364554e-01   +2.785798223105359e-01   +2.917427599995550e-01   +5.818953494302168e-02   -1.211072328216894e-02; -4.059492254308580e-01   -2.010794180054287e-01   -9.027292312059836e-02   -2.006061437938023e-01   -1.697190888207799e-01   -4.182866184167049e-01   +2.614888972405213e-02   +5.327785404067004e-03   +6.596456806871384e-02   +9.982766288666448e-02   +2.232054446202232e-01   -2.993656395546643e-01   -2.324463798960887e-01   -1.954167211396971e-01   +1.702528181079238e-01   +1.713969245643031e-01; -1.173881296680421e-01   -2.961219032986662e-01   -2.363776538266359e-01   -1.290957003945043e-01   -1.648302983685160e-02   +4.972600401397810e-01   -2.377272939966192e-01   +1.125673654276974e-01   -2.546796891659726e-01   -3.558966170205260e-01   +1.730404265869513e-01   +5.456428289581239e-02   -3.913342232298464e-01   -1.975684151829367e-01   -1.162422742111529e-01   -1.291852403695353e-01; -9.398916203226049e-02   -1.809931752724758e-03   +1.068972749845703e-01   +8.366965775273011e-02   +3.699377224931567e-02   +1.903416722309532e-01   +1.328781199151510e-01   -4.525578605698477e-01   +3.323272410554790e-01   +7.448719941052294e-02   +7.173796074896654e-02   +3.268229192526694e-01   -2.369798621602187e-01   -1.256160575112371e-01   +3.136319502664388e-01   -1.926442823846813e-01; +1.170063644148785e-01   +9.104177780136367e-02   +3.347839067292643e-01   -1.544758500273340e-01   -4.210745706370542e-01   +1.496642134254408e-01   +3.182979248461523e-01   -7.284456387265748e-02   -2.305288771453050e-01   -2.199883967784460e-01   -2.065421145782365e-01   +3.353775464174299e-01   +4.172685827582930e-02   +1.504413276033270e-01   +2.980204537262810e-01   -6.896171919727886e-02; -4.174011662947775e-01   +1.397632377591296e-01   -4.197596376326488e-01   -1.310690146938443e-01   -1.577568383361670e-01   +4.247373252074837e-01   -1.211040798355857e-01   +6.775774873421814e-02   -1.720010532271906e-01   +4.024209208068726e-01   -2.847647274352100e-01   -4.451437242162405e-01   -2.168886900925296e-02   +4.277322876237364e-01   -3.294590011215002e-01   +1.164577644673379e-01; -2.081773591277064e-01   -4.077783121275642e-02   -2.339138935022952e-01   +1.575801346887904e-01   +3.080269191810248e-02   +3.039958837649887e-01   +2.779764890054159e-03   -4.917521838093686e-02   -1.386684750528329e-01   +1.479493889996300e-01   -1.726188332574252e-01   +1.827585256616381e-01   -1.863741487547902e-01   +8.789610946833828e-02   -1.335044719616014e-01   -6.018527109482495e-02; +5.687874150525742e-03   -1.517182595453017e-01   +3.809777430179165e-02   +2.970399913493942e-01   -4.969164927171353e-02   +1.033555781473722e-01   +2.668063286508279e-01   +1.829995806723972e-01   -2.761821355191910e-01   +7.132917798858812e-02   +1.459803504187917e-01   -5.530188759753608e-02   +2.433513220918374e-01   +2.347995983440146e-01   +2.781608644836386e-01   +2.097768565262580e-01; +1.350937426051202e-01   -2.514672054525127e-02   -5.406720852125954e-02   +3.455661531843564e-01   -1.137394661102286e-01   +4.621144250201930e-01   -3.264974465628226e-01   -2.746179185220899e-01   -1.603482107251997e-01   -7.093592908526387e-02   +2.906692178589758e-01   +1.552278721458483e-01   -1.287699378207025e-02   -1.636729917920736e-01   -3.129516238510902e-02   -4.408716292386123e-01; +2.289670839934069e-02   -4.987805018890040e-02   +2.952197140026553e-01   +2.498383828165125e-01   +1.571355965545052e-01   +7.076388881398810e-02   -8.779670311277268e-02   +1.998188278953828e-01   -6.967674771025974e-02   -5.018317495658109e-02   +5.651978152296232e-02   +2.053664447649449e-01   +5.440218808240596e-03   -2.223441680830573e-01   -4.135147963891068e-01   +2.538963481259324e-01; +2.333102628236251e-01   +2.749436593240921e-01   -2.746027289035802e-01   -3.343560425092567e-01   -5.745620575674570e-02   -7.058005706609249e-02   +2.340818924545466e-03   -4.609699188286695e-01   +3.607236400962900e-02   -5.506991576860396e-03   +1.201342141818778e-01   +1.580898063577709e-01   -6.431416429816281e-02   +1.438742638737686e-01   +1.864210802840439e-01   -2.162217647558509e-01; -3.085755272813608e-02   -1.935028237818489e-01   -3.333035428348739e-02   +2.928491447684087e-01   -3.078428997119136e-01   +1.640448919807464e-01   +5.571178698314130e-02   -2.312639410950592e-01   +5.901583278817037e-02   +1.988802799357804e-01   +3.688847185997213e-02   -1.025154936598848e-01   -4.613230056673884e-02   -2.983209191345092e-01   +2.743920352096824e-02   -5.743934464565279e-01; -4.010717991416368e-02   -1.244436501942432e-01   -2.005628662974551e-01   +1.977828930192172e-01   -8.665656209256847e-02   +8.793046001357624e-02   -7.828763376770839e-03   +2.084406005189117e-01   -1.883599665410595e-01   +5.241640107359037e-02   -1.436893710994230e-01   +3.619533922067318e-01   -2.420129334205598e-02   +3.999493695628731e-02   +1.590617461631549e-01   -2.787147304931311e-01];
L2I_L1I_iGABA_netcon = [+6.224586557888419e-02   -1.276580997520542e-01   +2.497554808763441e-02   -1.725827657959378e-01   +2.886086410476415e-01   +2.495799380589196e-01   +6.480605873633037e-02   -1.631765383901193e-01; +8.943265243465134e-02   -2.182802183030142e-01   -1.854460089324949e-01   +3.223548659325338e-01   -2.159577852478498e-01   +3.037918496070431e-01   +3.541953581395069e-01   +1.171692900678128e-01; +4.530431259034244e-02   -4.122176044633401e-01   +4.899511129530963e-02   -3.013268890087391e-01   +4.251225911426654e-01   -3.800833256164539e-01   +1.067586617739016e-01   +1.501585316542608e-01; -2.752686375420323e-01   +1.401143257524942e-01   -2.405810989135229e-01   +5.871574953745302e-02   +8.062133173639362e-02   +1.677714638774730e-02   +7.026236516683415e-02   -1.255396306427581e-01; -4.078105038470989e-01   -1.396960373095351e-01   +2.860587401410714e-01   +1.581685943898410e-02   +4.515836398039147e-01   -6.730079726732498e-02   -2.631928037531533e-01   -4.543574079701522e-02; -3.939056561144932e-03   -3.020854804000476e-01   +2.433021241632359e-01   -2.297164528768491e-01   +1.988578523538136e-01   -1.071375455750716e-01   -1.682004045427633e-01   +1.718241364935497e-01; -2.435555013773387e-01   -3.894446841925135e-01   +8.143314909084648e-02   +3.604095438423792e-01   -2.682073869638950e-01   +1.896209484608775e-01   +4.177134536205063e-02   +4.165645495205525e-02; +4.205528019565695e-01   +1.595936064947922e-01   -8.343827610838965e-02   +1.979366336651833e-01   -1.500398231477253e-01   +2.381792174197390e-01   +1.389511111693862e-01   -5.830591864215790e-02; +9.688190620307577e-02   +1.350548530092320e-01   +1.127517571070135e-01   -4.445201994307576e-02   -6.563182528584927e-03   +6.522466353262106e-02   +2.542740350243365e-01   -4.479088755648855e-02; +9.428927083550816e-02   +2.755961574158138e-01   -3.374624696607411e-01   -3.193100289695072e-01   +1.665601927333666e-01   +3.263161719290789e-01   -3.065795568156607e-01   -2.615136336843383e-01; +1.721628863446342e-01   -1.362315336121120e-01   -1.235368314152321e-01   +3.780070402434667e-02   +2.705575797143950e-01   -4.058627198486940e-01   +1.279194195214866e-01   -3.697679876744631e-02; -4.695498274408879e-01   -2.970760880028150e-01   -2.335256273246170e-03   -8.014589660172115e-02   +1.140038206641229e-01   +3.401974119963317e-01   +3.072589478910882e-01   -1.096611631328531e-01; +1.231391179386031e-01   -1.677757788447903e-01   +1.010414249437956e-01   -1.094494927231654e-01   +4.828628931764953e-02   -1.735166133474129e-01   +1.892037370300436e-01   +6.779579904864716e-02; +2.516839045523783e-01   -1.505898471715841e-01   +9.578975726757630e-03   -1.890874587312755e-01   +2.319426056876193e-01   -3.390342684478487e-02   +1.521589807625668e-01   +1.119572080718526e-01; -1.339032204120774e-01   +2.932438023087430e-02   +1.131771789361942e-01   -9.290309664548348e-02   +5.322046846488259e-01   +4.350157996214828e-02   -1.134705540690597e-01   +6.526777404685799e-02; -2.202024317793461e-01   +2.278104299156485e-01   +8.986133366653480e-02   +1.913182830676520e-03   -5.914616002353417e-03   +1.490390343120355e-01   +6.620822183251934e-02   +1.713238780855351e-01];
L1I_L2I_iGABA_netcon = [+2.509325758724604e-01   -1.994372688647386e-01   -1.320546265403664e-01   +2.371269165667108e-01   -4.321486433183437e-02   -8.040377685886078e-02   -1.654362820650151e-01   +6.048690119354100e-02   -8.536303541121111e-02   -1.079643678185480e-01   -1.740882994520395e-01   -2.393359505696509e-01   -7.827964107440619e-02   +1.362365521744844e-01   +2.933241176356581e-01   -2.834090974313402e-01; -2.929074689824061e-01   -1.623938794329138e-01   +1.852829152523384e-01   -3.356273316693268e-01   +6.217537085954629e-02   -4.507200787721537e-03   -3.359038056097129e-02   +4.976719234211048e-02   -4.465700183518551e-02   -7.273105742183433e-02   +5.133118539861445e-01   +2.422682062568857e-01   +2.512866688273127e-01   -7.374110904042863e-02   +6.418142703862159e-02   -1.081143038787644e-02; -4.433178564894004e-02   -1.082373287478140e-01   -1.842159788289558e-01   +9.162687786977097e-03   -7.646469908178044e-02   +3.373834201858094e-01   +2.866592283847166e-01   +8.743569654270433e-02   +1.418514830160597e-01   +1.150631804965932e-01   -1.910167764977688e-01   +6.845053898204495e-02   -3.152796538397279e-01   +5.784739775170955e-02   -7.339486026798550e-02   +4.463543908488439e-01; +1.053159454507435e-02   +2.578275848831513e-02   +6.647896377100604e-02   -6.210743475007528e-02   +3.818741785339412e-02   -2.427053548897997e-01   +1.416070210506311e-01   +1.831224882349535e-01   -1.763521702944099e-01   -2.924338485017959e-01   -6.389446650313943e-02   -1.439553067309090e-01   -4.477873070699823e-02   -7.670253642531727e-02   +1.062182116776011e-01   -1.161166283284984e-02; +2.745763917501592e-01   +3.908973767242173e-01   +8.011040197892140e-02   -1.382555248916064e-01   +1.798392174068297e-05   -2.250721586395539e-01   -2.187360694249749e-01   -9.195402121936630e-02   +2.930967135903870e-01   -1.052403808737653e-01   +3.679317671213627e-01   +8.033518525686345e-02   -1.729472497221156e-01   +2.768370438221610e-01   -8.565341710894378e-02   -4.510258573836677e-01; -3.648025311576711e-01   +6.577761659065379e-02   +2.881132759155586e-02   -1.633268278875884e-01   +1.091415801187539e-01   +2.450248342171667e-01   +4.293480872948461e-01   +1.230963311072122e-01   +3.909285569546905e-02   -3.757824403358190e-01   +6.355290011550846e-02   -8.309381728198936e-02   +2.195882356072394e-01   -9.601143205216564e-02   +8.899258446906325e-03   -2.634461359187861e-01; +2.038799012447469e-01   +1.446543187741177e-01   -1.163389419785889e-01   +2.211421768384511e-01   -1.544556362508399e-01   +1.524241254760032e-01   +2.634810129369787e-01   -3.583002063637258e-02   +4.089413084861630e-01   +1.465191081152717e-01   -2.125708154861921e-01   -4.435721288863798e-02   -3.666362826647374e-01   +1.058583845680288e-01   +3.057522836272815e-01   +3.391550841336137e-01; +1.172155062846756e-01   +1.144891675447956e-01   -4.530511159288349e-01   -2.437761194282396e-01   +8.080569526351296e-02   +1.230031936998425e-01   -3.433691059366110e-01   -2.048503656233985e-01   +3.028420393905132e-01   -1.119901510252059e-01   +1.442496820959571e-01   -4.770714337215728e-02   -5.111043107932896e-01   -1.391029236326842e-01   +4.269318331659266e-01   -1.410115602919089e-01];
L2E_L1E_iAMPA_netcon = [+1.907165269380602e-01   -3.521007189143703e-01   +1.823298352385562e-01   -5.663859467296924e-02   -1.957634869520002e-01   +2.399025253198806e-01   -1.617028375612273e-01   +2.105448950297741e-02; -1.083316621216457e-01   +2.134979032241262e-01   -4.994982492099128e-02   +3.619182033456531e-01   +3.170594526882885e-01   -1.244998063012588e-01   +1.527616050481304e-02   -4.363158022682367e-02; -1.255457529336417e-01   -2.644238543680733e-03   -1.279469219001156e-01   +2.170573193574887e-01   +3.756798825269146e-01   +5.668881531616159e-02   -1.329202614644066e-03   +1.258666245185549e-01; +3.783589101828131e-01   +2.070945170908974e-01   +9.360971720516087e-02   -4.334288454703159e-01   -1.256571833317485e-01   -1.382527073754060e-01   +1.860568073659573e-01   -2.301559253715312e-01; +1.112675879451483e-01   +1.128173741457986e-01   +1.057764626189389e-01   -2.893540492362526e-01   +1.492496186985363e-01   -2.257250200562231e-01   -2.273137859578394e-01   +3.899526477850718e-02; -6.694532702533076e-02   +1.846381752620359e-01   +1.909755137585430e-01   -8.169459254027059e-02   +2.716634144161387e-01   +7.052246518897601e-02   -2.259776507835576e-01   -3.491640347870382e-01; -1.879350693969959e-01   +1.065409411199023e-01   +1.726437620960687e-01   +1.202402048991355e-01   +7.069119106488526e-02   -1.120929023424204e-01   -1.642908388498262e-01   -7.990381118320804e-02; +2.369036838719621e-02   +2.309177445530710e-01   +3.491776981732428e-01   -2.254983482877173e-01   +4.327052365435740e-01   -1.750167703738216e-01   -3.325611941688814e-01   +4.143478630246828e-01; +2.710995307164130e-02   +9.657048183115190e-02   -2.305678343809131e-01   +1.942478650220930e-01   -6.781862946375714e-03   +3.595475577894279e-01   -2.234251789948697e-01   -1.359490610187090e-01; -1.227922562816161e-02   -4.307050581357744e-01   -2.044109839634115e-01   -3.916791431839877e-02   +1.780865128291928e-02   -3.223992404587061e-02   -6.552704797276436e-02   +1.692685954796328e-01; +4.407279630092196e-01   +5.432250687776082e-01   -1.984214500288341e-02   +2.824206906575059e-01   +6.981105376134487e-02   -1.052655376994479e-01   -3.955594246335678e-02   -1.701686531021238e-01; -2.791024190871209e-01   +8.982025026898022e-02   +4.207428437013902e-02   +1.918959849025108e-01   -6.326325908356173e-02   +4.879460129331105e-02   -8.696803558335389e-02   -3.538673800472781e-01; +1.136637245091979e-01   +3.268985378370167e-02   -3.825111844061728e-01   -5.801138543666907e-03   +3.441487461969266e-02   +1.578674712801416e-01   +1.884860972938964e-01   +1.057973268243326e-01; +1.986113880178424e-01   -2.124335812689375e-01   +2.777564452185126e-01   -2.444411312797650e-01   +9.289395067402277e-03   +1.182096678525119e-03   +9.772760685538298e-03   +1.798896496535319e-01; +9.028843157073198e-02   +1.007507439668239e-01   -5.288405163717532e-02   -1.980017830574942e-01   -6.122142766135227e-02   -3.453556609359965e-01   -4.714651832861937e-02   +1.307365365745418e-01; +3.546445741385912e-01   -5.268464966720502e-02   +1.652955916585698e-01   -1.324139842718914e-01   +1.987803251968953e-01   -1.332003841655042e-01   -9.824783547361929e-02   -1.825614399221622e-01];
L1E_L2E_iAMPA_netcon = [+1.504777167792010e-01   -8.102033656098075e-02   +1.074945626167683e-01   -1.196530611392088e-01   +4.387255492421704e-01   +5.156418099050181e-02   +8.757307404607102e-02   -1.054875983195536e-01   +1.634308005534169e-01   -1.664337531839231e-01   +9.406048190997486e-02   -1.047689380992302e-01   +4.091702534444289e-01   +1.174903667270788e-01   -7.825776628542666e-02   -2.414568197048482e-02; +1.275755751404035e-01   +5.934260048729926e-02   +3.384217844958015e-01   -4.899379955399271e-01   +1.996045314225290e-01   -2.108407134681604e-02   -2.944568996710841e-01   -1.633485109830196e-01   +1.652492231292745e-01   -2.366291751939652e-01   -4.622325964090361e-01   -3.648018217695076e-02   +4.535378497797816e-02   -1.881607485768566e-02   +1.694035509474635e-01   -7.953321029376405e-02; -7.341762290098051e-02   +1.777094928986983e-01   -1.152685550883599e-01   +2.564623709452012e-01   +5.288471998863374e-02   -1.073290766142607e-02   +1.527946745219327e-01   +1.245411591395404e-01   -1.807645380154180e-01   +2.641319648689261e-01   +4.745198390422118e-01   -6.793376687276687e-02   +4.132734811793180e-03   +4.557266678357698e-02   -3.092479620803737e-01   -1.718703228007110e-01; -1.829859488566879e-01   +4.271695629151895e-01   +1.192133006145968e-01   -6.280968968971347e-02   +1.217751820225468e-01   -5.647599540325404e-02   -1.280933703394630e-01   +2.316991034948303e-01   +4.554439200231700e-02   -3.205013838250301e-01   +2.255262705467646e-01   +6.555394979555380e-02   -9.140132256798660e-02   -1.499940537698648e-01   -1.689734241372554e-01   +1.352319752612775e-01; +1.882001756391470e-01   +1.711297897094173e-01   +3.371632879865728e-02   -1.220161239214036e-01   +2.049789541984512e-02   +2.398213024935742e-01   -3.591297207166222e-01   -1.271589465065556e-01   +1.318042049645134e-01   -6.079466256398620e-02   -3.129947491340272e-01   +1.888042606098669e-02   +1.301240527590044e-01   -8.734507105739460e-02   -1.415670133971539e-01   -5.515893026244086e-02; +1.832106163395524e-01   -1.446785135348980e-01   +2.754338254017090e-01   -3.257416648052393e-02   -2.846379547150611e-01   -2.146188334692353e-01   -1.680451471423678e-01   +2.276084770556815e-01   -1.493722893227376e-01   -2.584685196664673e-01   +1.228731256837242e-01   -1.103258770363626e-01   -2.399509724924443e-01   -1.505233161378421e-01   +1.976055886987881e-01   +2.791057193295423e-02; +1.527299946850121e-01   +3.096717305893879e-01   +3.914635340531149e-02   -2.404470535736367e-01   +5.839397489170968e-02   +3.451101085199012e-01   +1.042248152369672e-01   -2.938545215040307e-01   -4.148237857890810e-02   -2.581503695556107e-01   -4.270282115713479e-01   +2.001717654878871e-02   -5.060635349481046e-02   +1.914642525121008e-01   -1.477685919614025e-01   -1.519511070424885e-01; -1.059402399366045e-01   -1.797162713368670e-01   +7.870002248836036e-03   +3.679617778163930e-01   -1.597769919043505e-01   +1.145491643461435e-01   +1.759627252534721e-02   +3.783270373462307e-01   +4.312699984273232e-01   +1.976503072538938e-01   -2.622103706958938e-01   -4.560910224788953e-01   +6.685329460659516e-02   -2.424816566047198e-01   -2.499512934585293e-01   -2.028388263392857e-01];
L2I_L2E_iAMPA_netcon = [+8.548135215140573e-02   -4.776822859226164e-01   +1.015912205784781e-01   +3.653762071386487e-02   +7.719383068328517e-02   +5.021441941401025e-01   +1.700760376488721e-01   -3.129886830244345e-02; -7.572702512621592e-03   -1.510873552830359e-01   +3.156492621650807e-01   -1.675309512760949e-01   -8.900985931846245e-02   +3.227440043821913e-01   +9.191245587466665e-02   +5.053768725481676e-02; +4.076244538454780e-03   +3.960071554205191e-01   +2.136931232855054e-01   -2.762758240918602e-03   +6.725458364007225e-02   +3.935565323451937e-01   -1.174638302928613e-01   -3.418749254305098e-01; +2.851675024678429e-01   -1.348403987353854e-01   -1.738050903079310e-01   -9.709006663802162e-02   -1.052523093910606e-01   +8.255505645741405e-02   +1.113931902377185e-01   +1.321805564463886e-01; +7.585311054832566e-03   -3.155413401625213e-01   +2.175377116248364e-02   +2.136370385119414e-01   -2.821649317998010e-01   +6.852991374056948e-02   +1.231667587162845e-01   -2.099062152543176e-01; -3.891907119106114e-04   +2.738778180137069e-01   +7.572102915542542e-02   +9.518528468392295e-03   +1.665240112365746e-01   -2.300113684398988e-01   +2.855869593608478e-01   +6.266963496480704e-02; +9.758609155973205e-02   +1.430198429484362e-01   +1.081721824679069e-01   +9.373931386742279e-02   -1.670226528517761e-01   -2.526414729217459e-01   -5.207778568925751e-02   -9.768306303601346e-02; -1.385306827633937e-01   -3.301316141850935e-01   -1.508626077335901e-01   +3.052052784878537e-03   -3.569674270479921e-02   -2.115009137936497e-01   -3.702478340474994e-01   +2.578394841795219e-01];
L2E_L2I_iGABA_netcon = [-2.080843958073889e-01   -3.140489142231456e-02   +1.344563008527210e-01   +3.863197123793864e-01   -3.266989015973366e-01   -4.017198158772037e-01   -2.241096843964490e-01   -3.205666712408666e-01; -5.054311255233580e-02   -3.639789740586406e-01   +1.614007613721874e-01   -3.832417472049306e-01   +7.265176288450359e-02   +1.862308411581386e-01   +1.124184306374956e-01   -5.701043940369904e-02; +2.627809176227611e-02   +1.314509926463298e-02   -2.427037937083068e-01   -2.912831375067803e-01   -1.156179599337903e-01   -1.198760418922290e-01   -4.037329537776366e-01   +2.596935027325775e-03; -2.569911895447677e-02   +1.984887549155919e-01   +2.840099526819516e-01   +4.647504280998890e-01   +1.376291155172719e-02   +2.283479245812661e-01   -2.039537718487824e-02   +7.621338967178110e-02; +1.354894565659183e-01   +1.329988787023288e-01   +1.235791840425787e-02   +2.700461813156674e-01   -1.356997168925395e-02   +2.279428097926937e-01   -1.941102590467456e-01   -2.611574732973582e-01; -2.862322409617960e-01   +1.612143305946211e-01   +2.665017670179970e-01   -1.420619233792711e-01   +5.287304816776570e-02   -1.982006478211126e-02   -2.960076273165880e-02   -3.255752636568598e-01; +4.979820160949880e-02   +3.941452012955884e-02   -1.866589444248235e-01   -1.315443450600024e-01   -1.422978595937205e-01   -3.227500640278241e-03   +1.849518077433132e-01   +2.578099477999228e-01; -2.222716648916056e-01   -1.232753562377608e-01   +9.241325154758323e-02   -8.384424318816786e-02   +2.905161988014995e-01   -3.496130894121402e-01   +2.229777568249773e-01   +2.066202201854374e-02];
L3E_L2E_iAMPA_netcon = [-1.111761991977149e-01   +2.238451816424594e-01   +2.050390007111014e-02   +4.840250705939834e-02   -4.445174356469545e-04   -1.018436838415529e-02   +1.426889216628508e-01   -3.080543732708980e-02   +2.097081959305627e-02   -2.692204962747008e-01   -3.267101478901961e-01   -9.660081037626116e-02; +1.757023161317892e-01   +1.975178963261748e-01   +2.783750025763271e-01   +3.085253308609172e-01   -1.092633105346349e-01   +1.372811724655879e-01   -2.441222872706296e-01   +3.946454363314840e-01   -1.877925662216116e-01   +3.117866628792868e-01   +5.627484796799244e-02   +5.570512120026352e-02; -1.267200383497430e-01   +1.767364536586534e-01   -2.026321032634071e-01   +1.251885853040453e-01   -7.430240381595271e-02   -1.555332739072802e-01   -1.682799121472413e-01   +2.847167859391831e-01   +2.529585164332518e-01   -1.574744744566103e-01   +9.512310214047744e-03   +4.457633629832166e-02; +2.635078209564373e-01   -3.535077529952245e-01   +2.025776428582034e-02   -1.327718661841563e-01   +1.801982627397584e-01   +2.907017197826388e-01   +1.087842330472309e-01   -1.047280739334261e-01   -2.130119224767372e-01   -1.422158314795454e-01   +1.585946363719123e-01   +3.014102823001455e-01; -1.196931259802513e-01   -2.675680998461487e-01   +3.617558939597944e-02   +1.241379639021550e-01   -3.430553469809074e-02   +1.016842366397750e-01   -2.467504435762790e-01   -2.656915207885270e-01   +2.616382792450153e-02   +3.041769425580421e-01   +2.311879971963210e-02   +3.799860366993081e-01; -5.650635653028297e-02   +3.126705402920613e-02   -2.316609423434736e-02   -1.076269465895570e-01   +1.200378993133104e-01   +2.872418784997350e-01   +3.078450584173197e-02   -2.453087152227551e-01   -2.178740958319816e-02   +2.106724518630067e-01   -1.735422422764838e-01   -1.415866439322455e-01; -3.454034470549980e-02   -8.319306744794099e-02   +1.978919288261081e-01   +1.866618121837285e-01   +1.131961859409736e-01   +2.797294642390650e-01   +4.131647813969533e-01   +3.651726754639965e-01   +1.723798138189948e-01   -2.554903406640825e-01   -1.538887058518431e-01   -2.422182539177826e-02; -2.550539069971541e-01   -1.250161323328682e-01   +6.211493943642554e-02   -1.600117525366586e-01   +2.750930037216831e-01   +3.159811265671209e-01   -3.889927564526263e-02   -1.336421594698744e-01   +1.312032288339709e-01   -2.706434492550083e-01   +5.431756386307099e-02   +5.002612806793658e-02];
L3I_L2I_iGABA_netcon = [+3.695628322342612e-01   +1.599527584732994e-01   +3.080043668790021e-01   +1.637732826548925e-01   +1.717098371481888e-01   -1.566948582143186e-01   -2.661790358303445e-01   +2.526530312668069e-01   -1.094981040712695e-01   +9.120498362012530e-02   +8.545663624895081e-02   -7.880057543243987e-03; +1.340335797314038e-01   -1.513346200184642e-01   +1.066081414934967e-01   -1.255114286504444e-01   +3.284047267930401e-01   +2.503404123853431e-01   +5.260024225329363e-01   +3.540726714264520e-01   +2.689573296082622e-01   +2.141186081769506e-01   -1.427931245246838e-01   -2.286317062718976e-01; +9.737456247647330e-02   -3.646909048695973e-01   -1.376815457052102e-01   -4.818448665100824e-02   +1.007423888543422e-01   -1.983358521520252e-01   +2.011096690218078e-01   -1.447258046788705e-01   +1.385035629367661e-01   -2.779295585173094e-01   -1.615315403395404e-01   +4.484348024569988e-01; -1.270157760646134e-01   +1.255872283069402e-01   +2.357943020552755e-01   +3.079468412449916e-01   +2.162985771675645e-01   -1.650571526918164e-01   +8.375844447252706e-02   +1.231164293090443e-01   +7.490414250523457e-02   +2.513292345983631e-01   +2.193595253219011e-01   +1.272178801859202e-01; -4.942403308956805e-01   -2.027088419415532e-02   +2.683605320900055e-01   -2.321483042957689e-01   +2.427393786551638e-01   +3.851638402937129e-01   -9.083903833761736e-02   -4.471609783868902e-01   -8.507961934779622e-02   -2.308402357221802e-01   +1.785954803302529e-01   +1.627286218814651e-01; -3.496075619798254e-01   +1.715304707765551e-01   +3.350782946212755e-01   -3.620633729599725e-02   -1.929640365305656e-01   +8.188646739226094e-02   +9.028205341062159e-02   +2.306789564742494e-01   -1.857936072602656e-01   -1.848044796481564e-01   +3.832206927283466e-02   -2.476834412541875e-02; -2.596592930420747e-01   -4.191151599179239e-01   +2.141700076699692e-01   +8.677250179826768e-02   +4.428789094481994e-03   +1.932299120740679e-01   +2.307302211533294e-01   -3.167714975651285e-01   +2.002359210476912e-01   -4.151338086242015e-01   -3.130959246963687e-01   -2.942765024676872e-01; -2.429378611099268e-02   +1.042621518266014e-01   -2.110266046866252e-01   -1.235520450949735e-01   +2.301991940153885e-01   +1.878254257280575e-01   +2.215815155616057e-01   +1.412790161094477e-01   -3.142626043902285e-01   +2.114282597174263e-01   +2.266305612690755e-01   +3.756137981255969e-02];
L2E_L3E_iAMPA_netcon = [-3.372839486240990e-02   -9.958069773480102e-02   -1.034749479398503e-02   +2.559448131871973e-02   +1.485162420355338e-01   -2.023897142638185e-01   +1.743961854965062e-01   -8.231470739131996e-02; +1.822978436024586e-01   -2.001300111058714e-01   -1.221717456470205e-01   -2.405465030137473e-02   -4.023431283736730e-01   +1.220505363273935e-01   -2.277121444114752e-01   +3.156435564150092e-01; +2.012528654928527e-01   -2.740848395978737e-01   +8.421880728730721e-03   -1.827904336279416e-01   +1.637715887285712e-01   +2.755979798549081e-01   +4.291823909822605e-01   -5.739836128341164e-02; +1.100042610584683e-01   +5.787600417083547e-01   -6.524751308134218e-02   +2.208960319181007e-02   +3.152796616791544e-02   -3.346639379696867e-01   -2.510974413066089e-02   -8.987192921880799e-03; -2.738057495035006e-02   -4.529957956007913e-05   +2.085344925969484e-01   -5.162980914625490e-02   -1.766098038909001e-01   -2.789073545834249e-01   +8.936623966355155e-02   +4.548280114095746e-02; -1.083456448669498e-01   -1.613040557539345e-02   +1.928895074645665e-01   -3.589726516712801e-01   -4.346937477148374e-02   +6.716327478739556e-04   -1.748276967375026e-01   -1.322547111635608e-01; -1.663786188010117e-01   -3.087884890567577e-03   -1.958929666280934e-01   +5.654844077559559e-02   +4.288923485652150e-02   +1.196336777459400e-01   +7.759802160916845e-02   -8.985756411377888e-02; -4.166797434388002e-02   +5.032663865490108e-01   -3.384522033570976e-02   +1.308043022655370e-01   +7.143677606021731e-02   -7.391937632122755e-02   -3.361743384838793e-01   +8.542026971852518e-02; -1.767187835789611e-01   +3.853735224380192e-03   -7.985082928303699e-02   +1.781671732736337e-01   +3.161533904772516e-02   +2.672499956156894e-01   -9.662253549165317e-03   +5.667713728794047e-02; -2.859043641945946e-01   +2.873432068768360e-01   -4.373664842666934e-02   -1.573555266077237e-02   +3.220876814650848e-02   +4.245144839335862e-01   -1.393608603479691e-01   +1.164349642675343e-01; +2.575559085351116e-01   +4.151349366827889e-02   -2.401706527953750e-01   +7.475325910281705e-02   +1.088858800130477e-01   -2.010026431891394e-01   -1.486392799327324e-01   +1.701236472021992e-01; +2.280944792955955e-01   +2.593035329463508e-02   +3.621952412553453e-02   -6.942499515964592e-02   -1.133490295169992e-02   +9.592479624289822e-02   -9.871425933117439e-02   +2.291223770128941e-01];
L2I_L3I_iGABA_netcon = [+2.022935492512660e-01   +8.599928637694279e-02   +5.939501467840280e-03   +1.377084785494291e-01   -2.397986594187179e-01   -2.224046540409342e-01   +8.396643750418156e-02   +2.675194151797265e-01; +3.671505600311933e-02   -1.302197905775901e-01   +9.920714550710950e-02   -5.606577591871043e-02   +2.259264932664114e-01   +9.912860974470800e-02   -5.376230542445538e-01   -4.133166832924542e-02; -2.803272995477776e-02   +1.565734318809642e-01   -8.111748906342020e-02   +1.809337632482202e-01   +2.749033061518948e-01   -7.946415542921789e-03   -1.937317835066942e-01   -2.445120085087691e-01; -2.230671765035830e-01   +2.096453503042469e-01   -1.825818657049894e-01   +4.927026867578439e-01   +1.493113027797320e-01   +2.861086137528135e-01   +1.789525362191643e-01   +1.089779331572935e-01; +9.317023024629473e-02   +9.015611444066174e-02   +1.003604072396675e-01   -3.278623550769685e-02   +2.930642193599846e-01   -5.773213645581884e-02   -2.790026842379548e-01   +1.988919774830282e-01; -2.089578948923828e-01   +4.509209095696766e-01   +9.481158976281186e-02   +4.877008669156641e-02   +4.099911298329357e-01   -1.558753987477747e-01   +3.337790245746186e-01   +3.023197470830408e-03; -1.607934867759409e-01   -4.473273377594322e-02   -3.057112491419260e-01   -2.205084329747791e-01   -3.039364861399989e-01   -1.983915772232472e-01   -3.469981549803308e-01   +1.087414346801742e-01; +3.085524546826927e-02   +1.254984620724041e-01   +1.172553139790004e-01   +1.603482033497926e-01   -3.413283995149098e-02   +2.317630375151081e-02   +3.430015730444877e-01   -1.721062440717895e-01; -1.019356552346066e-01   +5.727147085047235e-02   +2.745927129343227e-01   +2.725366101069598e-01   +1.055854135277629e-02   +2.626293709440328e-02   +2.547726453790518e-01   +9.057625048729669e-02; +1.256794998417692e-01   +6.869731049611989e-02   +3.371889905037170e-01   -1.524083103036312e-01   -6.801699628490561e-02   +2.244246569935504e-01   +1.136682197267105e-02   +3.612947136966981e-01; +2.170513282881444e-01   +2.613119264645991e-02   -1.489404376572242e-01   -1.193933279382534e-02   -1.179738410346446e-01   +9.228436448973562e-02   -2.516868891778618e-02   +2.041759277469114e-02; -2.075118570810362e-01   -3.927067273260824e-01   +2.095215020263910e-02   -1.814896106059683e-01   +2.959555859083982e-01   -3.549239264445612e-01   +8.544406394954793e-02   -2.537558650923926e-01];
L3I_L3E_iAMPA_netcon = [-1.737142545228035e-01   -1.876332455629367e-01   +1.109187515100312e-01   -2.335101269381629e-01   +1.019702165036503e-01   -1.769784512976922e-01   +1.874280125756639e-01   -7.499016906419824e-02   -2.925027901415567e-01   +1.288212849387239e-02   -2.483233374796526e-01   -1.617990967539279e-01; -2.502908656231817e-03   -3.355141623432466e-02   -7.745715537315741e-02   +2.706807004426778e-01   +1.042428359223532e-01   -1.554092576102301e-01   -5.583231367272110e-02   +3.468641646293809e-02   -2.456731183715882e-02   +9.935103408384326e-02   +1.695264816060504e-01   +1.951678618292590e-01; -1.950153798712082e-01   -2.957761841936135e-02   -1.216706632539684e-01   +1.272939432592619e-01   +1.752102911501355e-01   -6.313652248885676e-02   -1.041837991131901e-01   -1.023004399762935e-01   +2.151380999103418e-01   +5.114908847916273e-02   +3.310359119483448e-01   -1.525444567302825e-01; +1.145411601387438e-01   +2.212463380377102e-01   -2.409577444784519e-02   -3.798346671971507e-02   +6.281016929184458e-02   +8.866526045102936e-02   +3.719334049532567e-02   +9.651348888734285e-02   -1.232214406217718e-01   +1.040036220688441e-01   -9.555045738251175e-02   +1.279937612640495e-01; -1.013834123636534e-01   -3.186430800121378e-01   +3.407284365035639e-01   +2.974656301200302e-01   +4.329793758850446e-03   +2.100041450352959e-01   +2.325088922448624e-01   -1.017059934840661e-01   -2.196912848023637e-01   +1.116287377326698e-01   -2.493314396657244e-01   -4.364197944233688e-01; -8.795185964637178e-02   +2.089082254756502e-01   -4.673565713248168e-02   -1.983932859443936e-02   +3.198502285937481e-01   -1.330050481953100e-01   +1.456086564465859e-01   +1.264939516190033e-01   +6.299119488770935e-02   -2.624057818689789e-01   -1.163987556384274e-01   -3.501533983544634e-01; +1.540874743672241e-01   +6.729667264654218e-02   +3.507887863614050e-01   +2.063783364080872e-02   +4.325761740685722e-01   -1.365723230471236e-01   -1.178111373550515e-01   +1.958026758667974e-01   +2.081226421211563e-02   +2.631961801273773e-01   -1.207779960839866e-01   +3.562887665803703e-02; +9.066844320996750e-02   -1.627162938203636e-01   +3.709551338101025e-01   +4.095162391337341e-01   -2.800333769595584e-03   +1.594976261505270e-02   +1.546980866591348e-01   -7.960336724281719e-02   +2.952353164733945e-02   +1.686631832649798e-01   +1.181292054122060e-01   +3.057675618940114e-01; -3.219009480254093e-01   +3.761702305904668e-01   +1.565005097895138e-01   -1.217906158945206e-01   +2.076032206750988e-01   -1.061846032012820e-01   -1.955194832686261e-01   -2.329224096324461e-01   +2.838267403799143e-01   +2.584260811068579e-01   -3.343670843462919e-01   -1.540573501817971e-01; -2.793770843531240e-01   +9.522801264808053e-02   +3.374756010019769e-01   +2.884314733938911e-01   -1.288186141421007e-01   -1.621326692873262e-01   +2.184248038202170e-01   -6.999714489604923e-02   +4.987016938233596e-02   -3.834281322885955e-01   +2.484567354275294e-01   -4.312165604573283e-01; +1.285199825006496e-01   -1.372152180045650e-01   -2.847128130662456e-01   +2.736829425424138e-01   -2.186533783519393e-01   -4.865703812218197e-02   -1.941558749797711e-01   -6.438444403793263e-02   -3.053690970001492e-01   +2.440973046424626e-01   -8.303603307271720e-02   +2.006210895003675e-01; -2.314672026471955e-01   -2.184293379336275e-01   +2.365999507310801e-01   +1.396718837483802e-01   +1.703700948615144e-01   +1.994416065532194e-01   +1.720388442596301e-01   -1.099789684936724e-01   +8.667020746404680e-02   -8.883549401176964e-04   -1.632660530948681e-01   -1.334702521256126e-01];
L3E_L3I_iGABA_netcon = [+2.661735424751009e-01   +1.518934325412957e-01   -3.412151538549919e-02   -2.589073650425459e-01   +7.274648069178354e-02   -3.831968765387507e-02   -2.730525908262544e-01   -1.524351875915558e-01   -1.101907024075066e-01   +8.127361971556024e-02   +8.343526333210885e-02   -1.209908287065822e-01; +6.933301728700887e-02   +1.174683503743927e-01   +2.456939903777587e-01   +3.264418052620001e-01   -3.362251114442003e-01   -8.962726414670745e-02   +1.024882648123552e-01   -1.368310441644855e-01   +5.048609250751834e-01   -9.415576386187552e-02   +2.423511052029977e-02   -2.695156603540163e-01; +1.736025336964358e-02   +2.551721474379194e-01   -1.531052626388095e-01   -1.453229869466298e-01   +6.485215294546273e-02   -1.531422787300258e-01   -5.483524515107364e-02   +3.199452450280261e-01   +1.838015621964126e-02   +1.945586190445495e-01   +2.622013837777372e-01   +3.378330797231822e-02; -6.260165012750510e-02   +1.257167734296019e-01   -3.075620419896012e-01   +3.951184713877573e-02   +9.287306879658135e-02   +2.049609290259539e-01   -3.106785401599449e-01   +2.548167930360195e-01   -9.440853260971661e-02   +3.112018100359887e-02   -1.051298032118632e-01   -1.211582880921463e-01; +1.210256041880829e-01   +8.244730580046933e-03   +8.884044253349185e-02   +1.452586688505499e-01   -1.042814310349536e-01   +4.536317842408288e-02   -3.493640751104448e-01   +4.872268628502721e-03   +4.936950485605062e-01   -4.346583989518875e-01   -1.323021200549757e-01   +1.906059074577710e-01; -3.735934486680146e-01   -1.249027757760049e-01   -3.189760490600325e-01   +1.520333633590752e-01   -3.746183703104950e-01   +2.734650938676542e-01   -6.541916861944816e-02   +9.905765399110862e-02   +2.934498339236749e-01   +6.182359750557080e-02   +2.163413745149548e-01   +1.603760736445125e-01; -2.764486592023000e-01   +2.536943186618533e-01   -1.228054975950698e-01   +2.468140558913340e-01   -1.858626795966845e-02   +5.422917652954018e-02   -1.657739954162054e-01   +2.460181388318081e-01   -2.733114893404798e-01   -1.000257205414877e-01   +6.460004982899360e-02   -5.787906013580367e-02; -1.277651373090486e-01   -1.707893096229852e-01   -4.829165367633227e-02   -6.073352538253165e-02   -1.277920802089655e-01   +4.994287130354853e-01   +1.335766009271735e-01   +3.669115440983903e-01   +3.801479037169829e-02   -1.433238884350399e-02   -2.938598875323782e-01   -2.510618991556305e-01; +3.478399885931072e-01   +4.355205669289829e-01   +1.754530573156516e-02   +9.928109709674894e-02   -1.869126023139928e-01   +8.717859514937115e-02   +3.509406252121522e-01   -1.652934771271481e-01   +5.610903431057856e-03   -1.849077807638421e-01   -1.389928764149015e-01   +3.585477002256379e-01; +3.326425211487715e-03   +1.717300460937829e-01   +1.293387862900148e-01   +3.429941797247039e-01   -1.089229469533407e-01   -3.963394173779728e-01   +2.152911039998198e-02   -5.142657725086552e-02   -2.904936212073632e-01   -1.321048223618845e-01   -2.928277347334231e-01   +9.781068688733627e-02; -4.487674017976213e-01   +5.378477256566217e-02   +3.571172083203109e-01   +1.144337672420384e-02   -1.089850562519727e-01   -1.079738487078424e-01   -1.873339940456180e-01   -2.847398868759276e-01   +8.745648881896821e-02   -1.424340853441115e-01   -3.045753661805645e-01   -1.856719664392447e-01; +6.434144617013331e-01   +1.008545413385019e-01   +3.860991621921486e-02   -6.080207498263657e-03   +3.391560805363945e-01   -8.284757453950806e-02   -2.649629126737864e-02   +2.193671521842965e-01   -8.408933758713849e-02   +1.014816611867048e-01   +4.210426769488855e-01   +1.076209579955947e-01];
L2E_Input1_iAMPA_netcon = [-1.650951237306195e-01   +1.806926159250987e-01   -2.232949841435405e-01   -5.877538706184857e-02   +2.860276173456428e-01   -2.147851993908796e-01   +1.375175086228710e-01   +3.580244308558235e-01];
L2I_Input2_iAMPA_netcon = [+2.783672208838954e-01   -3.088882786517556e-01   -6.684653846834404e-02   +1.025287287496700e-01   +1.348946407458682e-03   -1.112768739337402e-01   +1.277753142312362e-01   +1.104242658633738e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
