function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.552765443380939e-01   -1.128935372937397e-01   +2.555012453224082e-01   -4.362066571722956e-01   +6.204701401558188e-01   -8.706688190144331e-02   -2.314403329061361e-01   +7.127089409127654e-01   +3.670785179438441e-01   -3.935687361129099e-01   +5.043882905037101e-01   +1.173247970565801e-01   +3.515908124648118e-01   +5.576139566088004e-01   +4.672033139793714e-01   +4.371567925982220e-02; +5.026390237081759e-01   -4.793893232996082e-01   -5.080090024742510e-01   -1.030232656803485e-01   -4.015329995457420e-01   -3.516580540700726e-01   +2.322987435870173e-01   +1.984510032000028e-01   -1.948351131401998e-02   +2.024887458439557e-01   +3.553362640600551e-01   -1.534732995809497e-02   +1.712901588085126e-01   -3.056115521279198e-02   -4.074387080298295e-01   -5.093468979320451e-01; +3.139458934750063e-01   +7.650312809101674e-01   +5.315171042050804e-01   -5.341731066800497e-01   -9.001190836730382e-01   +9.370684533381331e-02   +2.043886818973798e-01   -7.786508338503910e-02   -3.856911336668208e-02   +3.092906479066833e-02   -4.571293417468799e-01   +4.925743620582954e-01   +9.532805185315991e-02   +3.267621239451078e-01   -7.137025902295269e-01   -6.014262553289434e-01; -6.649075990363386e-01   -3.415282046108777e-01   +4.852746431503233e-01   -5.906752013981246e-01   -7.012145896789518e-01   -2.301146980536853e-01   -7.037088508396501e-01   +2.514012392013671e-01   +2.469366410318668e-02   -9.586733152370940e-02   +3.351389151667250e-01   -4.364323923252394e-01   -1.236693770406397e-01   -1.896312827297423e-01   -3.627609442159194e-01   -6.660353932386839e-03; +2.267897952869550e-01   +6.168224767994536e-04   +4.288005791584024e-01   +7.295444187410067e-01   -2.043096384202915e-01   +2.508165332985440e-01   +3.138232408180847e-01   +2.195147791659851e-01   +4.109873584203555e-01   +1.322422219727332e-01   -1.344868437654489e-01   -1.914883349298259e-01   +2.387326253427518e-02   +2.496638442752845e-01   +6.733680731911493e-01   -2.911897839713054e-01; -8.801985544328835e-01   +8.649344900911103e-02   +1.558862959101272e-01   -2.194259812976660e-02   +1.342842688409526e-01   +1.423669081037949e-01   +4.997871473170690e-01   -3.367826991726641e-01   -7.678925621232127e-01   -2.487028036941005e-01   -6.914939568573363e-01   +2.516216518559828e-01   +3.429360638610776e-01   -1.506732682852878e-01   -4.622356548886075e-02   -3.635320485941604e-01; -5.128137410008002e-01   -1.987278269903812e-01   -4.168833824104676e-01   +5.625133738514811e-01   +6.071266793764474e-01   -1.955814187765411e-01   +2.260496247068016e-01   +2.032229988468220e-01   +6.248314697810941e-01   -1.869038122475183e-01   -6.754109577672947e-02   -7.185547261407681e-01   +5.561947258119783e-02   -2.452650486428419e-01   -3.116481393424673e-01   +4.228179067448413e-01; -1.260633319731830e-01   -8.343865587634123e-01   +1.384725167056367e-01   +2.301420485197074e-01   -1.104790542312627e-01   -3.286429633898237e-01   -6.496841963268821e-01   -2.230424517270671e-01   -1.903639691999577e-01   -1.243619412712605e-01   +2.992093931041763e-01   -1.329288093313246e-02   +4.779880952714572e-01   -7.875176738059302e-02   +2.458765725006190e-02   -8.224070882226217e-01; +2.011075132492059e-01   +3.611820590582394e-01   -7.742832578206787e-01   +2.132221948779666e-02   -2.505012916099844e-01   -1.562450232767721e-01   +1.098039497372117e-01   -1.000000000000000e+00   +2.242784270813606e-01   +2.666895889889944e-01   -4.146093540134237e-02   +4.267858160768646e-01   +1.385921582921714e-01   +1.182418266897786e-01   +6.743816011699222e-01   -4.159795907331355e-01; -9.114899865156409e-02   +3.906275663106581e-01   +7.869875809825125e-01   +2.812986793972158e-02   -2.980376338096378e-01   -1.362590028852711e-01   -1.959797117122286e-02   +5.741778073759204e-01   -1.531489198811284e-01   +1.828555046938869e-01   +1.132045212428825e-01   -4.303558451304899e-01   +9.877833061198221e-02   +3.685861143162503e-01   +2.574545475928869e-01   +4.948289323549355e-01; +2.979317546193161e-01   -2.568083268628646e-01   -4.574104624622276e-01   +4.970062135677936e-01   -4.395207595938955e-01   -1.470002079594827e-01   +4.886880006790978e-01   -5.164066271567767e-02   +4.503474373780419e-01   +6.045845508851264e-01   -4.460189411402202e-01   +5.621519310440351e-03   -2.927050852405472e-02   -5.042223465724895e-01   +1.592582556151974e-01   +8.564344222765058e-03; -5.483100542181706e-01   +4.963974984963210e-01   +4.059036773572797e-01   -1.208681356843398e-01   -2.112481863601910e-01   +3.676421096533636e-01   -5.959327798465201e-02   +6.964885461642066e-03   +5.505620295233642e-01   -2.550236222608670e-02   +1.334197421391317e-01   +5.047531534101066e-01   +6.449517979321386e-01   -5.326033328969901e-01   -2.522637097846235e-01   -5.485302675142751e-01; -7.758143582979420e-01   -3.040942853123630e-01   +1.879128294280381e-01   -3.348209132453422e-01   +5.674968646655186e-01   -2.303737128774360e-01   +9.261822545217270e-02   -2.843091660701210e-01   +5.972160886091596e-01   +7.822873746459190e-02   +3.608290301100525e-06   -1.549180701288284e-01   +3.238560779882101e-01   +4.909501926093059e-01   -3.726581471056274e-01   -5.001088569732489e-01; -3.412809926115491e-01   +2.883091556510833e-01   +2.662454681746843e-01   +4.651353862709100e-01   -2.038612837100903e-01   +4.012718499995605e-01   -4.860407282174866e-01   -2.249190968877886e-01   +4.877808064550232e-02   +6.530955566020981e-01   +3.862130675558262e-01   +4.048389995212026e-03   +7.450463516014050e-04   +4.681107981293853e-01   -4.147027484973685e-01   -1.453162323537995e-01; +1.306651959643391e-01   -1.838921064643525e-01   -2.386077642162575e-01   -3.979827879136539e-02   -3.658911429365750e-01   -3.112860000870604e-01   +3.498587876740782e-01   -4.303718977922730e-01   +5.875206762394962e-01   +8.601593545089485e-03   +1.224675868344244e-01   -7.303854004133182e-01   +2.310543150307751e-01   +4.404339511488587e-02   +2.559191560147650e-01   +5.012088537420318e-01; -8.129564492462740e-01   -5.414676630979877e-01   +4.898065911945985e-01   +8.989909542111839e-01   +2.852109877827705e-01   +4.344852626125117e-01   -3.460237649639094e-01   +6.328673738452460e-02   -6.576169960663035e-01   +3.093339830286163e-01   +2.071478152091388e-01   +1.411749395988400e-01   -3.964312112858918e-02   +2.041947561943634e-01   -1.468563091042968e-01   -4.974933462824241e-01];
L1E_L1I_iGABA_netcon = [-3.881305302174005e-01   -1.110238772641565e-01   +1.000000000000000e+00   +2.860318289251231e-01   -1.176964487691161e-01   -1.872186646069967e-01   -4.750200952327849e-01   -1.794980127233611e-01   +9.230312563174017e-02   +5.193153654928341e-01   -3.184693595990449e-01   +4.330503203511623e-01   +1.554084183908762e-01   +6.989682259047836e-01   +1.529426060262252e-02   -7.465870381964431e-01; -2.604391253242294e-02   +2.468650804046174e-01   +4.189038328900355e-01   +8.383551448551374e-02   -1.137075080439452e-01   -4.604817927782295e-02   +2.462411912160417e-01   +6.886287389699169e-01   +4.750408927046228e-01   +4.504997490312346e-01   +1.804818243582747e-01   +4.577573793785876e-01   -3.190008135954451e-02   +1.348254476686628e-01   -1.423801802740676e-03   -2.029221422992861e-03; +1.612859561438718e-01   -2.057062949033225e-01   +5.997589258813421e-01   -1.550315872038646e-01   +6.176262169337687e-01   -2.889960094059800e-01   -2.099741488745799e-02   -4.291728184992686e-01   -1.307632512196862e-01   -2.767669326719123e-02   +4.190911185439520e-01   -1.089326128898537e-01   -2.473295158791267e-01   -2.883951630675047e-01   +1.628726577564048e-01   -4.314685718037874e-01; -3.209205259228071e-01   +1.189505848181116e-02   -1.422532816026676e-01   -1.465961418178325e-01   +2.628211646659980e-01   +2.272014687097601e-02   -3.797992401856556e-01   +1.899525767939584e-01   -2.361238105845085e-02   -5.190379096101485e-01   +1.811519324583415e-01   -2.571591434321343e-01   +1.608978144160565e-01   -4.161346377056084e-01   +1.711266139990904e-01   -7.599916603824737e-01; +4.987980186044570e-01   +2.019013907043657e-01   +4.902746414750627e-01   +3.169796003643699e-01   +4.845733408112093e-01   +1.132673500189052e-01   -5.357228392507300e-02   -8.233193152792284e-03   +5.277740588739777e-01   -4.074329868622979e-01   +2.509486678026212e-01   -3.822969299792757e-01   -5.538253871984576e-01   +2.506234155274982e-01   +2.349497260287297e-01   -1.437760091386294e-01; -1.087052924465765e-01   -1.821826002183334e-01   +2.244674920754581e-01   -6.042229393448837e-02   +1.100846772198351e-01   +8.087552425246267e-03   +8.817382433957497e-03   -1.202581305526198e-01   -4.014632471855046e-02   +3.839222529130011e-01   +3.700721647497405e-02   -1.366928381658049e-01   +9.367179247630740e-02   +2.126868710570910e-02   -3.447664652174885e-01   -2.016864969393417e-01; +4.177068370942292e-01   -1.590776857553835e-01   +1.611728428931672e-01   +1.756352010547284e-01   +4.915734873139052e-01   +6.910504901608579e-02   +4.146372606675642e-01   -1.125211105574174e-01   -9.544468012847457e-02   -3.360933464008065e-01   -2.648460551083912e-01   +3.311301466017119e-01   -2.354703213014005e-01   -3.359071279065187e-01   +3.578654346249744e-01   -4.593684743823444e-02; -5.090358749245867e-01   -3.122467857657641e-02   +3.323899139798567e-02   -3.456509426130075e-01   -4.190688550053633e-03   -8.000469863838973e-02   +2.001568733574215e-01   -1.350822275517602e-01   +2.705012421739524e-01   -2.324001668222006e-01   +3.073383882369969e-01   +3.995760866285597e-01   -1.325838164665708e-02   -3.816183246784123e-01   -4.981918832940102e-01   +1.074758536885143e-02; -3.207787337112152e-01   -2.827463087289345e-01   -1.784025797211923e-01   +2.728688540773987e-01   -3.416996879105921e-01   -5.415511122935391e-01   -7.574330848500536e-01   -1.848803654588519e-01   +7.849891618968545e-01   +7.830233959905150e-01   -7.211220992002482e-02   -1.173103032670834e-01   +2.513211050737867e-01   +2.806553899919577e-01   -5.588585211460960e-01   -3.659320186657992e-01; -1.063823936918756e-01   +6.490624511631891e-02   +3.520071818937009e-01   +1.819938841016869e-01   +2.780512989926400e-01   -7.025543830341653e-02   -1.493161292771198e-01   +2.598269993788300e-02   -6.672475780617979e-01   +2.424200662256100e-01   +3.513690294156727e-01   -5.366918801181574e-01   -2.923954384154029e-01   -3.292067032034899e-01   -3.041283956219830e-01   -4.367103962910996e-01; -2.360299344167494e-02   -1.733944550528423e-01   +5.395904237595250e-01   -2.180308476264966e-01   -3.511100850816108e-01   +1.095278385281485e-01   -3.346066492690908e-01   -3.811434933199693e-01   -1.175216616620165e-01   -5.980783184026967e-01   -1.623345934646037e-01   +3.242533445700129e-01   +4.664753530263315e-01   +3.248803694525674e-01   +3.641447118256372e-01   -8.598857982756516e-02; -8.563489800813088e-03   -1.964443838121214e-01   +9.796759754271227e-02   -5.240336703289910e-01   -8.529690373825283e-02   -3.063884348545238e-01   -2.241944930636917e-03   -8.124676488364072e-02   +1.740350170641397e-01   -1.982124565228435e-01   +3.248377170811142e-02   -2.527960033445855e-01   -2.413230809602155e-01   -5.060112010687549e-01   +2.308062215402911e-02   -3.670827295472106e-01; -4.720671800994940e-02   +2.559394397257093e-02   -1.948649954872460e-02   -1.955390577804964e-01   +3.010561256264677e-01   -3.710998767367010e-02   -2.974449450616957e-01   -3.937685264744249e-01   -3.735677528045019e-01   -4.106943355066988e-01   -1.332139279719915e-01   +1.685501909770790e-01   -7.045848486995199e-01   +6.851198060039815e-02   -7.021472217623026e-01   -3.552128773695359e-01; -3.990669608267189e-01   -1.116059725303315e-01   -4.670372527435125e-01   -4.680347552004184e-01   +6.923779079869248e-01   +2.805182370868163e-01   -1.554864486111556e-02   +1.263518717958598e-01   +3.720884381826393e-01   +3.061636357839544e-01   -8.603037012396433e-02   -3.296022413972612e-01   -1.454809001739414e-01   -1.396442538520507e-01   +8.294060194551452e-02   -2.832269320502255e-01; -4.733031043009921e-02   +2.619670534041646e-02   +5.121320565332838e-01   -4.500588319114256e-02   -2.418236471802459e-01   +6.716814193905235e-02   +4.420505447458238e-01   -7.518177997814890e-01   -1.050974076527758e-01   +1.707537080547215e-01   +5.658579241275862e-01   -4.409386558083186e-02   -4.883582989217616e-01   -3.321202886210811e-01   +2.381273679314070e-01   +2.793939756634291e-01; -8.859595454588917e-02   +7.144290678098471e-01   +2.438514561397581e-01   -4.191615742071657e-01   +2.266804651350116e-01   -9.871698995717525e-02   +2.174464189063517e-01   -5.616533305030100e-01   +4.786761343927329e-01   +2.796540850470477e-01   -4.053206581823474e-01   +2.633441891506806e-01   +1.383026686880183e-01   +6.257791021770416e-01   +1.841896736662252e-01   +3.420538040778545e-01];
L2I_L1I_iGABA_netcon = [-2.985541625652345e-01   +4.499617641992892e-01   +3.735279299696694e-01   -2.092824772083867e-01   -2.623392954523661e-02   -7.538729339129221e-01   -5.928843189493695e-01   +3.010181453974039e-02; -8.452160549416898e-02   -7.128729963598723e-01   +9.694208499501450e-02   -9.391314745841947e-02   -9.553097236517524e-01   +2.138518540849855e-01   +7.676274621681985e-01   +4.429203452639999e-01; +3.856223759318581e-01   +8.138628249776661e-02   -4.014096783877395e-01   +3.284432829774468e-01   -4.627106726040023e-01   +7.060634760007173e-01   -7.568933648592923e-01   -3.939496322794819e-01; +8.002480536404684e-01   -4.327447458824060e-01   -3.126872742107307e-01   +4.230385831060149e-01   -4.956982372755888e-01   +1.000000000000000e+00   +2.571469776444969e-01   -8.160335392276811e-01; -2.429314565125204e-01   -2.694760794577422e-01   +6.133116472817939e-01   +6.440244193774577e-01   -4.574707110712316e-02   -5.592193800111925e-01   +2.440694582850166e-01   -3.014811443037897e-01; +2.185766170781948e-01   +4.921918571070847e-01   +2.225727706459409e-02   +1.168726746757431e-01   +3.379954498664807e-01   -3.728902205856775e-01   +2.212523812087349e-01   +7.057135858413627e-03; -6.257525914968871e-02   +3.221977837542146e-02   +1.198227390960831e-01   -3.481457515123235e-01   +5.350615216175855e-01   +1.053608313110079e-01   +1.965276472430403e-01   +3.335923205739681e-01; +2.023453731594232e-01   -9.410777673726948e-03   +4.550717117163505e-01   +5.012310364399686e-01   -6.798645773284294e-01   +1.411845863186117e-01   -1.231267201684163e-02   +1.195981680831459e-01; +2.321620748396486e-01   -1.092375897658837e-01   -8.848335798752449e-01   -3.792048299831313e-01   -1.834938159521709e-01   -6.655570655729395e-01   +2.323759150600320e-02   -1.032094365757130e-02; +3.051865027011363e-01   +6.243393415192355e-02   +2.248058082519733e-01   -2.861788175123117e-01   -4.702630665480085e-01   +3.092754234749182e-01   -7.556784503062254e-01   -1.536675459374662e-01; +1.927274455454074e-01   -5.822161217094691e-01   +4.367679781614894e-01   -3.192484180198166e-01   +2.929995478487120e-01   -3.328208531571934e-01   -7.224494607968905e-02   -1.643800205946414e-01; +1.941354443088995e-02   -3.153458604733392e-01   -5.840308143309726e-01   +5.948070886441772e-01   -6.761097956701739e-01   -7.743072495367307e-01   -4.750762160327664e-02   -2.764951096570841e-01; -4.324402464083101e-01   +3.595558793826136e-01   -7.522235145487158e-02   +2.756695298741455e-01   -1.793964064443451e-01   +1.977990148809823e-02   -7.277608626437455e-01   -2.443896538549513e-01; +7.424130669269228e-01   +2.232743842299836e-01   +2.058123043514020e-01   -5.459573454996657e-01   +7.225916434895761e-02   -7.019208700391809e-01   +6.929030909244049e-01   -6.701194520316965e-01; -1.964126450589027e-01   -7.056687099617701e-01   -4.253361612022366e-01   -9.008514352260230e-01   -6.877065299634769e-01   -1.657434527809108e-01   +6.559715043593577e-01   +4.163184522642020e-02; +2.744153775174564e-02   +4.964258529006488e-01   +1.902529258968746e-01   +3.501913550956643e-01   +6.020458730287701e-02   +1.556946397292505e-01   -4.555337008970358e-01   -1.632490323368254e-01];
L1I_L2I_iGABA_netcon = [+2.636201890458690e-01   +1.744566683261023e-01   -1.570196927663190e-01   +9.519160902385762e-01   -7.380295616718980e-01   +5.145776029387585e-01   +4.100526690122604e-01   +7.830092472898539e-01   +1.916806661914795e-01   +4.749001867838856e-01   +6.915455528229630e-01   +6.996749373332293e-01   -4.968144800527347e-01   +5.758846511000184e-01   +1.305324846696061e-01   +6.924341147738565e-01; -7.242800551185405e-02   +7.587259191397756e-02   +1.062740222961367e-01   -4.635299194308474e-01   +6.088940692910667e-01   -1.219287468902027e-01   +9.306351601039360e-02   +3.601838318419670e-01   -4.615460833241151e-01   +7.639183713900248e-01   +3.783824128888156e-01   +3.850347294975749e-01   +1.060684987105528e-02   +7.569568801521216e-01   -4.740279747131916e-01   +1.665861704418781e-02; -1.084052064768552e-02   +2.313268269807929e-01   +2.906223616001646e-01   -1.031296182774012e-01   -4.412606283435253e-01   -1.490751802389770e-01   -4.258436543321883e-01   -1.695115130071456e-01   -4.405635442773857e-01   -5.212398600121289e-01   +6.787471709787398e-01   -6.124024801058914e-01   +4.842805813684506e-01   -4.233441214711069e-01   -4.762245983194536e-01   +1.181636594017279e-01; -2.981166546903951e-01   +2.751942654457527e-01   -7.018630019781502e-01   -5.650839519634901e-01   -6.363202520517580e-01   +3.854106940983016e-01   -2.519875713354385e-01   -3.505968307659494e-01   +5.835641637423862e-01   +4.565888599162151e-01   +7.294623592871466e-02   -2.106953477932591e-01   -9.696713001619445e-03   -7.677732712301684e-01   -1.890443975082196e-01   +5.497558696714822e-01; -2.467995245516384e-01   -2.133877480674853e-01   +2.615548078508122e-01   +1.000000000000000e+00   +1.173641044487735e-01   +5.534174440455190e-01   -1.040937959716206e-01   -5.861486776368825e-01   +1.451511113391603e-01   +9.966749531745032e-01   +2.770086173543179e-01   -4.571060536893967e-01   +3.801691436145964e-01   +1.042412093382847e-01   -6.146491747713756e-02   +2.378228888108739e-01; -2.161835533409777e-01   -1.035915551933295e-01   -6.687107514409387e-01   +1.254180747011898e-01   -1.521713821830733e-01   -1.270135533793160e-01   +2.760931797608116e-01   +4.357515088253610e-01   -4.444798758425102e-01   -3.500834705813060e-01   +4.575461854923276e-01   -3.815368257777074e-01   +3.336016895983193e-01   -2.534242775683040e-01   -4.118218750965846e-01   +7.234895436381968e-01; +6.600936158228878e-01   +5.058909861246481e-01   -2.381839607061286e-01   -3.078983703850141e-02   -3.044543786385278e-01   +3.387867506095155e-01   -4.200587485624998e-01   -1.908032320779881e-01   -5.461250653667010e-01   +4.673199150178414e-01   -3.489728097141956e-01   +3.781773712424003e-01   +5.565105018194045e-01   +2.154396621334720e-01   +1.430047198893691e-01   +4.261883851898507e-01; +7.097501529159524e-01   +5.619761621024324e-02   +1.099216092648542e-01   -2.758779823392353e-03   -4.374812213502305e-01   +8.795264369214633e-03   +2.482130874221405e-01   +2.925438269117485e-01   -2.416867262521740e-01   -3.104205115291604e-02   +1.344345746642623e-01   +2.546236059408222e-01   -4.309452874764400e-01   +4.172516575967353e-01   -3.061888266470679e-01   -2.554545309590483e-02];
L2E_L1E_iAMPA_netcon = [+3.163433280769010e-01   +2.680554827255542e-01   -8.561271313795434e-02   -6.001235382609755e-02   +4.267701434188954e-01   -8.985494061640796e-01   +5.406574689224477e-01   -5.873089860176531e-02; +6.079508988206828e-02   -5.993778426170098e-01   -1.952047442990757e-01   -9.440195537010734e-01   -1.739124698296746e-01   -2.674801642213533e-01   -5.600345471776901e-01   +9.612026309036237e-03; -1.181731609503536e-01   -5.081576622049290e-01   -5.943238252772559e-01   -3.528489957658910e-01   -3.865686005913008e-01   -2.295785504322708e-02   +1.555748403037562e-01   -1.367526785578835e-01; -6.021251177665956e-01   +1.783540847871366e-01   -2.506394089337167e-02   +1.622790008428933e-01   +3.512211135335453e-01   -6.383878596188498e-02   +3.757013341209154e-01   -5.001770659034455e-01; -7.159796795959763e-01   -2.813111260105662e-01   -3.708591106191017e-01   +5.482433684723605e-01   +5.170793558777367e-01   -7.885475654251095e-01   -3.253297603880160e-01   -6.561061562755974e-01; +8.465231353153644e-03   +3.216152241649370e-01   +3.361635621232801e-01   -2.633824344468214e-01   -4.037257371660705e-01   +4.270287373530754e-01   +6.315602319674790e-01   +8.361586786787082e-01; +1.791582531243478e-01   -4.572884845678342e-01   +9.719382899818264e-01   -3.869102123773255e-01   -1.226220207840906e-01   +3.273945456085163e-01   +8.155215270631192e-01   +1.336547060860916e-01; -2.628039740419313e-01   -2.107930913141025e-01   +2.421468350190760e-01   +1.459852404210804e-01   +4.234102360185037e-02   -7.144693287969228e-01   -3.057998083558107e-01   +4.458178944308095e-02; +5.498357823789339e-01   +5.796327441856423e-01   +3.456557218220926e-01   -3.245348940578530e-01   +5.780672116536691e-01   +1.618631346622129e-01   -5.401152716274149e-03   +8.753184756207092e-01; -2.641035441437777e-01   +1.084888895044928e-01   +2.559445312682499e-01   +8.065081212593631e-02   -2.137244431223370e-01   +5.377017762029951e-02   +1.339611358399019e-01   +4.205309385076412e-01; +2.241194710139180e-01   +9.005648474073125e-01   -2.525075319778834e-01   +6.697749849480039e-03   +3.662138981190322e-03   +6.487070408062452e-02   -4.829931577063578e-01   -8.079679770336390e-01; -6.378407689134041e-02   +2.114803914931245e-01   +6.702803024820542e-01   -2.853192442364548e-01   -2.431854935288142e-01   -3.798016690234434e-01   +2.305928513226551e-02   +1.000719072962503e-01; +2.315374066092170e-01   +6.575968255069570e-01   -1.876245525919905e-01   +3.172715737452943e-01   -1.528153138440481e-02   -9.168920143749684e-01   -5.084630119576147e-03   +2.297309886273848e-01; -1.890711489930285e-01   +8.084541242781670e-01   -4.030736673869328e-01   -2.899788051074416e-01   +3.485378268864941e-02   -4.395956680396801e-01   +5.359916964539829e-02   -1.902022531473850e-01; -8.385988628998026e-01   -1.951007135335808e-01   +6.077770303712726e-01   +6.417628012701400e-01   -1.542868571549176e-01   +4.009477908923274e-01   -3.204528896371696e-01   +8.317401981140440e-01; +5.907419759898680e-02   +1.854441571409265e-01   -5.694088441409436e-01   +1.000000000000000e+00   +5.164434203248327e-01   +1.763596550129709e-01   +7.359650886736827e-01   -3.664103163134530e-02];
L1E_L2E_iAMPA_netcon = [-6.441042595774622e-01   -8.873896034034900e-02   -2.977065712578092e-02   +3.420083994669297e-01   -6.822646441668172e-01   -4.012164264755976e-01   +2.933242763092918e-01   -3.060205874877294e-01   -4.513012300790578e-02   +2.216076852186414e-01   -2.656447846610770e-01   +3.835123112015884e-02   -2.862918185708091e-02   -5.902152086303764e-01   -6.369620106904148e-01   +7.403195569380897e-01; -6.547575459451984e-01   -1.823567045193154e-01   -4.359195119377610e-02   +2.138437077490661e-01   +8.137027264320102e-01   +3.321657918092601e-02   +2.018299888900848e-01   +1.752792245294772e-01   -4.545888354001525e-01   +4.609676163215174e-01   +7.620448431008364e-01   +5.573025635076292e-01   +3.168032518500202e-01   -1.152327577547616e-01   +3.423996999489308e-01   -2.351832545076632e-01; +8.524047110560135e-02   -7.895462084372659e-02   +2.760789342455190e-01   -2.590970007467042e-02   +7.176803831319969e-01   -3.059108297516644e-01   +8.145731695483989e-01   +1.098419985010910e-01   +3.079681565967294e-01   +4.619209728241978e-01   +4.343943353338978e-01   +5.322450787702754e-02   +5.268704176198691e-02   +2.840444471485216e-01   -4.028695148556309e-01   +9.936437361192013e-02; -6.356608097156821e-01   +5.737452830996528e-01   +4.845911640906858e-01   -2.080242474322938e-01   -9.087559034900627e-02   -7.620834441746234e-01   +1.592374500420359e-01   -4.166564957938308e-01   -2.137633626984951e-01   +2.496754693937356e-01   -3.295210737924495e-01   -5.276697533043516e-01   -2.546322417068519e-01   -5.645023469634313e-01   -5.472289727367223e-01   +4.369234128467216e-01; +5.077825215457062e-01   +3.834436465329771e-03   -7.693105546151748e-01   +5.266931531871666e-02   -3.963754490132844e-01   -6.281755265131295e-02   -5.777994630858068e-01   +2.366547946629130e-01   +2.949347832663778e-01   -3.207223187071029e-01   -6.401636634460382e-02   +1.221809403450885e-01   -1.298775500045625e-01   -6.396101912640232e-01   -7.542495872359076e-01   -2.796627364868613e-02; -2.265061533513961e-01   -5.166574077014968e-02   +1.257785952319253e-01   +5.637957221664641e-02   +4.775212040887020e-02   +8.228830603666494e-01   -2.421772268129173e-01   +5.252689821379878e-01   -2.991093168889329e-01   +1.813288326870595e-01   -2.670449448661107e-01   +5.006725328601920e-01   -1.012366201249692e-01   -2.888079566667788e-01   +3.645537984425202e-01   -4.325882669637335e-01; +3.484225838468172e-01   -6.511838686212690e-03   -1.806743227755825e-01   -4.951644085812181e-01   +6.025261839605037e-02   -6.213528418642156e-01   +2.205795983755060e-01   +1.176962458171257e-01   +2.572005741116574e-01   +2.343777613294795e-01   +4.219316941086312e-01   -6.759622524065330e-01   -2.845685274916518e-01   +1.033886212646110e-01   -4.143296682281415e-01   +3.477880045773030e-02; +1.655947338412414e-01   -4.644266813939138e-02   -3.349784781347148e-03   +4.414810618217516e-01   -1.338930443836560e-01   +3.943004201578151e-01   -1.404839375529146e-02   -5.560548800226965e-01   -2.600787422037233e-01   +1.757883973493248e-01   -5.440780956383567e-01   -2.398428254819388e-01   -5.713956198322592e-01   -7.527003449960429e-02   +1.429754095500014e-01   -6.304374533487636e-01];
L2I_L2E_iAMPA_netcon = [+5.309165404809687e-01   +2.342702641951376e-01   -1.571167343112028e-01   -4.209783524920081e-01   -3.130400130815085e-01   -3.795159110640074e-01   -1.347358934307130e-01   -2.943585773624396e-01; +6.090565996456373e-01   +9.682581815028399e-02   -5.076319008905887e-01   +1.557520004603356e-01   -1.887359055991634e-01   +2.088144501852406e-01   +1.828842667156629e-01   +3.536029422467533e-01; +3.265979671686958e-01   -1.831268050717701e-01   -6.872333113293745e-01   -3.789415560934514e-01   +2.425139058368797e-01   -5.934161995197058e-01   +6.124221436039741e-01   +1.382292276515285e-01; +4.141635185872409e-01   -3.863971057661674e-01   +1.401505162482210e-01   -5.372362228418648e-01   -4.227362279665439e-01   -2.421846741566658e-01   +5.448536012514656e-01   +9.921395699916360e-02; -6.175653096398561e-01   +4.622233126774605e-01   +4.338338903682265e-02   -4.895111160346735e-01   -3.331182752815137e-01   +3.402800218137603e-03   -4.591545157251575e-02   +4.746187874406587e-01; -4.703257503536764e-01   +4.180897259283158e-01   -7.466059012159109e-01   +1.088626357406955e-01   -5.750424623562149e-01   -4.083450068580969e-01   -2.891032302862585e-01   +1.465519320968838e-01; +4.850712654582710e-01   +2.342832392582479e-01   +4.001894529670737e-01   +4.638063291673278e-02   +4.194434297804180e-01   +4.811794711229070e-01   -4.802787007953773e-01   +8.273332228657843e-02; -7.643895329249906e-02   -1.324908177713784e-01   +7.840325185317265e-01   -5.923921610923557e-02   +6.778164703140842e-01   +2.029227450980518e-01   +1.805442365374300e-01   -1.677732781619731e-01];
L2E_L2I_iGABA_netcon = [+5.663635781740481e-02   +5.857406488267359e-01   +1.000000000000000e+00   +4.171288576816171e-01   +1.999476845189855e-01   +2.203051438356801e-01   +1.308113178745444e-01   -1.249286369113811e-01; -6.650845656109429e-02   +2.642930258326124e-01   +2.486975363433143e-01   -5.309412103983234e-02   +4.725274178237234e-01   +1.713690412374020e-01   -4.858120946978088e-01   +2.228676584358567e-01; -1.030849525620754e-01   +2.514152997840881e-01   +5.542198301692123e-01   -3.876520747892661e-02   -1.087599549115110e-01   +2.550226818067854e-01   -1.646096154726146e-01   +1.299164652645837e-01; -8.502323662744785e-01   +5.091429113504666e-01   -1.341591886841606e-01   -5.926087194892398e-01   +6.333124434378620e-01   +5.159896469732036e-01   -6.459840318076114e-02   +3.737445481569612e-01; +1.635535011338269e-01   +7.800364278933695e-02   +3.183849231817907e-01   +5.733077664614201e-01   -4.261041010484256e-01   -6.384062174046594e-01   -6.353607031496997e-02   +8.066846255073109e-01; -2.225734776274466e-01   +2.478203518590862e-01   -6.796681971001746e-02   -1.979625160250783e-01   -7.911258242017500e-01   +4.366927055541055e-01   -1.244117317103784e-01   +4.437355434453875e-02; -1.623796540773528e-02   +2.271999074457041e-01   -6.326620888906164e-01   -3.803972277848594e-01   +4.176801281891103e-01   +2.577556652572079e-01   -5.822213751664664e-01   -3.270392181278357e-01; +8.189694235286868e-02   -7.230638652574120e-02   +4.175396910233953e-01   -9.733603737779548e-01   +1.349337490037421e-01   +3.769007358964928e-01   +6.457799554489565e-01   -2.088154879151249e-01];
L3E_L2E_iAMPA_netcon = [-1.593662212827471e-02   -3.657380784457573e-01   -4.027695923528470e-01   +2.722706577962457e-01   -9.812547628467246e-02   +2.735737690602442e-01   +7.373872686007278e-02   +1.444453776075158e-01   -2.368855002688872e-01   +2.419236857312385e-02   -1.147622322936577e-01   -8.850098905601187e-01; +3.061956041720764e-01   +2.568631287597083e-01   +3.716592039580530e-01   +1.056695874034849e-01   +3.480643289215593e-01   +6.688146072758334e-01   +6.169010599186959e-02   +3.129188566573041e-01   +3.405886142700308e-01   +5.437476814982345e-01   -7.558663278709608e-01   -1.446872055036972e-01; +3.819463111078562e-01   -6.625226609163541e-01   -3.152505627295839e-01   -2.655687052305752e-01   +3.640133127133564e-01   -2.247016451896304e-01   +6.079435600686622e-01   -5.752043681818781e-01   -4.138310562678995e-01   +4.465604474083763e-02   +3.600428860392773e-01   -4.264590959514838e-01; +3.992997721968552e-01   +8.957034246539890e-02   +4.149177320775781e-01   -6.145346390979044e-01   -2.491820361849940e-01   -4.291341369175827e-01   +9.659091101391623e-01   -7.118232667187175e-01   +2.115458411200713e-01   -1.593899913883090e-01   +5.699258086613886e-01   +1.217350142810832e-01; +4.966904870725502e-01   +3.000117564938350e-01   -5.797854899629211e-02   -8.051894374571227e-01   -1.670482972661329e-01   -3.942614430130165e-03   +1.641673708933028e-01   -5.543452385513516e-01   -4.416425164892278e-04   +8.625765560103370e-01   +6.040839500210026e-01   -6.635973213181512e-01; +3.813624068777566e-01   -2.159862642998892e-02   -1.447328879229895e-01   -2.080565926313832e-01   +7.114217141475315e-01   -4.720251320698174e-01   +5.029175653288859e-02   +4.258123774198181e-01   -1.060253439539646e-01   +3.153264710942922e-01   +3.485422241120781e-01   +1.825690760598525e-01; -4.796066067890434e-02   +5.488678743080008e-02   -6.771625782866142e-02   -3.228429377233556e-01   +5.608189600754898e-01   +1.020459671992412e-01   -4.304309459165694e-02   -2.377233518405880e-01   -1.231619736033562e-01   +3.138931219094256e-01   -3.883561219877658e-01   +1.284059139812830e-01; +2.886401114236390e-01   -2.694323778044097e-01   -5.544196844683981e-01   -3.752941230507763e-01   -2.192596001079496e-01   +4.811850640052766e-01   -4.776304509605643e-01   +1.262629051894830e-01   -5.110946442462315e-01   +1.000000000000000e+00   +8.050322070571825e-02   -3.413611344004236e-01];
L3I_L2I_iGABA_netcon = [-9.630298217320582e-02   -3.028438860814722e-01   +1.734054135827695e-01   -6.159570906954198e-01   -2.684183495321296e-01   +1.194818590025429e-01   -4.981954511699157e-01   +7.723634656029083e-02   +1.057052624551286e-01   -2.861400869891291e-01   +1.632908667187211e-01   -2.751060258979381e-01; -5.691965434979612e-01   +7.709149593626461e-01   -2.066975126492597e-01   +9.531243007267102e-01   -1.000000000000000e+00   -5.179232507665813e-01   +3.981909192539713e-02   +5.320227911633784e-01   -3.744155359097769e-01   -8.784333771932336e-02   -9.898150884763608e-01   -4.406452193563185e-01; -2.629506991492176e-01   +7.531784942069328e-02   +8.169522308886136e-02   -7.046747589812660e-01   +3.987243512349236e-01   +6.655281947665161e-01   -6.513042309825781e-01   +5.849499844217132e-02   -2.693813545872015e-01   +2.240103871361721e-01   +7.056364354672841e-01   -5.998142827324234e-01; +2.273208136858064e-01   +4.488646463666315e-01   -1.745080348832011e-01   -9.202697512672091e-02   +7.082271524570364e-01   +2.760480460139247e-01   -5.207472440101173e-01   +1.536261178728634e-01   -5.335446860465345e-02   +3.889128130859063e-01   +4.613714089000132e-01   +1.958919093166235e-01; +1.434161356951176e-02   +4.638412550286615e-01   -4.751890808724466e-01   -2.897086138662416e-01   -2.289869224216717e-01   -2.778361689449752e-01   +3.367791240771482e-01   +2.356719872880241e-01   +1.909672991776320e-01   -1.007160200676387e-01   +4.060885204637668e-01   -1.512215753168627e-01; -1.739682830724526e-01   +2.090059702958174e-01   -3.225594184908817e-01   -9.199364224592969e-02   +4.155590601857253e-01   -1.450196275350026e-02   +7.589806289163177e-02   +1.206046369801908e-01   +2.730548155316164e-02   +3.591360434305774e-01   +2.867900667325649e-01   +9.374165686053804e-02; +3.861206478468793e-01   +4.026810818335063e-01   -1.268914758065390e-01   -3.107807055170643e-01   -5.095155328410623e-01   +5.813551325783967e-01   -2.844784115802646e-02   +2.883798813758764e-01   -1.102380068785703e-01   -2.691777806240001e-02   -2.852623770826013e-01   -1.846202018713157e-02; +4.898318185347331e-01   +8.032312267993625e-01   -3.655359396783847e-01   -4.422223954196562e-01   +2.050942857638205e-01   +1.658267991335337e-01   -6.096741462349581e-01   -1.229839998941894e-01   +1.336689095131329e-02   -1.718436133233974e-01   -4.013775476743416e-01   -5.352831686152499e-01];
L2E_L3E_iAMPA_netcon = [-1.173834288751907e-02   -4.160329003167213e-01   +2.153842719816504e-01   -2.091266062141054e-01   +2.392689646308714e-01   -1.016507795988232e-01   -5.821772882293997e-01   -8.746376171590967e-02; -4.128650074799527e-01   -1.265482103697330e-01   -7.340520745687222e-02   -3.130107709641813e-01   -5.855213091314373e-01   -4.761855211507641e-01   +1.880886265244036e-03   +2.346324186777752e-01; +7.332751080064870e-01   -3.246375063660986e-01   +3.887248059344037e-01   +1.700636128418137e-01   -3.185253704914551e-01   -3.487168327016250e-01   +2.506940413429736e-01   -6.518034621923019e-03; +2.206310058264647e-01   +8.536528081017285e-01   -1.950590403191349e-01   +1.258258923672154e-01   +3.014936741548730e-01   +4.003333364365536e-01   +5.315750278705685e-01   +6.157415674493039e-02; +4.194618541737603e-02   +4.154886654430536e-02   +4.026024403919319e-01   +2.612271002105607e-01   +4.006310707866639e-01   +2.184306605376493e-01   -3.648970744955640e-02   -2.071918275134577e-01; -5.515722958848361e-01   +4.523109991877093e-01   +2.591430293616320e-01   +6.922224972313370e-01   -7.745350430032796e-01   +1.525592649410257e-02   +9.296171704220502e-02   +5.705920830709718e-01; -3.837642779496581e-02   -6.290443504270971e-01   -8.809144739334037e-01   -1.000000000000000e+00   +8.985020346787574e-01   -5.257526717715818e-01   +3.759442880859064e-01   -7.838074537789056e-01; +2.652642734315441e-01   -1.679315649285101e-01   -1.919827450032046e-01   -7.886970477453568e-01   +1.833680447264444e-01   -4.241597593909188e-02   -2.148426886938137e-01   -3.933347167786655e-01; -2.088054945668458e-01   -2.110712678363462e-01   -5.243701592514898e-01   +4.241763862275590e-02   +4.274820704032606e-03   +4.089119173288376e-01   -5.329807560652448e-01   -3.726370392487044e-01; -2.724198870331420e-01   +2.806062725463823e-02   -1.028741423211830e-01   +4.140013797718977e-01   -6.624744185678406e-03   -1.756030688921873e-01   -4.185244985277878e-01   -2.525619260425367e-01; -7.827152040501022e-02   -3.799560485262898e-01   -3.168547695901122e-01   +1.422602063458751e-01   +1.292213899692190e-01   +7.562838820229000e-01   -1.355194953589278e-01   +5.683332751209584e-01; +3.711929888972618e-01   +5.082008282885704e-01   +1.084249163424391e-02   -7.621777859838892e-01   -2.502205383491122e-01   -8.656641955246115e-01   +1.476255165369963e-01   +4.716258198758730e-01];
L2I_L3I_iGABA_netcon = [-3.155076508201521e-01   -5.543457326166017e-01   -8.418820874523514e-01   -1.849726665480668e-01   +1.818633782707932e-01   -5.580627034178489e-01   +5.024415122532319e-01   +6.894743578709923e-01; -7.288715558687411e-01   +4.102734659598201e-01   +5.853085888674932e-01   -4.149857084708740e-01   +1.930613423383519e-01   +7.814038190992285e-01   +2.961188776430956e-02   +1.867658594232578e-01; -3.448698802272533e-01   +1.169778249954609e-01   -3.028832558638686e-01   -1.020166968241916e-01   -2.705772622615316e-01   -1.060346241669295e-01   +4.590451506828147e-02   +8.247294961840526e-01; +1.353463857073570e-01   +3.465286683803933e-01   +4.481144711022743e-01   -2.181446784845235e-01   +4.702540694175187e-01   -6.347546164940128e-01   +7.506123403219296e-01   +4.364924826999589e-01; -7.595067957061558e-01   +2.724184355902582e-01   +6.407773372309281e-01   -1.702904092924583e-01   -6.005740966569584e-01   -2.451554738453662e-01   +8.986575077553688e-01   -5.239327132831041e-01; +2.672246469532458e-01   +1.909931832118290e-01   -5.706700472410130e-01   -8.242556593478039e-01   +9.208246941006065e-02   -3.704881213556170e-01   +1.639539714852700e-01   -3.915163431298733e-01; -3.921460166870311e-01   -3.539477030909772e-01   -1.991555407006022e-01   -1.920796802585041e-01   +3.070904635942585e-01   +3.933396335525191e-01   -4.260228337258811e-01   +3.359907458644228e-01; -3.224954425662137e-01   +1.073668747145010e-02   -2.335520674715658e-01   -8.281013500584673e-01   -4.863323882399669e-01   +7.929024733966353e-01   -3.070006485294141e-01   -3.073125325567548e-01; +4.921370708062018e-01   +3.963636399916413e-01   -6.773507870546740e-02   +1.808883000486661e-02   +4.175598260196048e-02   -1.804505230957796e-01   -8.059355628459368e-01   +2.290359165535517e-01; +4.369957770641714e-01   -1.491230934600747e-01   +4.372560610721490e-01   -6.505129714454517e-01   +3.073294478166974e-01   -3.579879625150472e-01   +3.435195891928958e-01   +6.524069743384986e-01; -2.962429450968599e-01   +5.479883118498285e-01   -3.451589742182113e-01   -6.059227880680452e-01   -3.811704399780708e-02   -3.836590543152123e-01   -5.037971601888197e-02   +3.502804765995243e-01; +3.521501361802516e-01   -1.757963588434596e-01   -4.530357978849884e-01   -6.568104736451521e-01   +3.655910486466646e-01   -1.352932968521044e-01   +8.746239010641882e-02   +1.400555469058939e-01];
L3I_L3E_iAMPA_netcon = [+3.629482546815577e-01   -8.109979438048769e-01   -5.267834431522296e-01   -5.373927484635671e-01   -4.423617410439686e-01   -4.170163692977072e-01   +8.216695059678686e-01   -6.562926020729969e-03   +5.780237997321144e-01   -2.667050893332441e-01   +4.395280758114838e-02   -1.363798314868480e-01; -2.998303200022577e-01   +3.636879778072508e-01   -9.978858914437581e-01   +4.434031395214316e-02   +6.973751175857641e-02   -6.372447349411546e-02   -5.112444083646183e-01   +6.544485249520826e-01   -5.265569048725324e-01   +3.409794304846454e-01   -2.323240932788538e-01   -5.012150117779424e-01; +2.668884650481866e-01   -4.600311436030374e-01   +4.992369486166843e-02   +1.721434047807303e-01   +2.253760481396513e-02   +2.073671260794065e-02   -6.997143400074826e-01   -1.769545976554990e-01   +4.361659030188418e-02   +3.413582829080580e-01   +1.039479755262353e-01   +4.696826905475067e-01; -1.804420656326924e-01   +3.320407195186402e-01   -4.453872696092003e-01   -4.689175086026642e-01   -7.386291155090423e-02   -8.124697953151412e-02   +9.429964425242339e-02   +8.991609610197157e-01   -6.708687977066077e-01   -5.375344389882224e-01   -3.054869555589286e-01   -1.072514789385433e-01; +1.167626605005141e-01   +6.896866141518708e-01   -4.779963490664167e-01   +9.410509606473965e-01   -6.696610330151548e-02   -1.718743827940036e-03   +1.297435666124908e-01   +2.097854957791800e-01   -1.758502213346436e-03   -3.776634770169089e-01   -6.864653697999334e-01   -5.723129092574482e-01; -6.818914468667845e-01   +5.704813825222145e-01   +6.113657988509655e-02   +8.083532786567550e-01   +9.444448424123247e-02   +1.470333350482788e-01   -8.146872830591001e-02   -2.263735862829541e-01   -5.446492693832720e-01   +3.019894246079564e-01   +6.284864620798918e-02   -7.779363030112924e-02; -6.750382037486701e-01   +7.918905641984585e-02   +2.265981656277325e-01   -1.599559907554846e-01   -8.862011476162664e-01   -6.625755695420252e-01   +4.552253251442765e-01   -2.252604858078871e-02   +8.772800523991111e-01   -1.857325475377391e-01   -3.607471731875969e-01   +4.337258203139885e-01; +4.104527188159059e-01   -8.998413573661442e-02   +7.833569390649726e-01   +1.651331524053833e-01   +4.409937559557978e-01   -9.035308162462091e-03   -3.507028301658402e-01   +3.684815284398315e-01   +4.496647567883291e-01   +2.061647510141340e-02   -3.083459720732346e-01   -2.866834810363922e-01; +5.559824209016392e-02   -5.057759707493063e-02   +4.286866058620966e-01   -2.817763966243874e-01   +4.636399550084936e-01   -6.354740029184515e-01   -1.293343389295296e-01   -6.694031509343322e-01   +3.533231325687512e-01   +1.919575740639729e-01   -5.117872861181343e-01   +1.362783775962738e-01; +3.242221034868578e-01   -4.782553999122022e-01   +3.047208440604001e-02   -3.710165338208827e-01   +4.029204573942372e-01   +2.129132183280429e-01   +8.792672957663706e-01   -2.949235089438589e-01   +2.141590978791368e-01   +1.208812249023252e-01   -7.490617643395580e-01   -7.064026887086872e-02; -7.699393074850402e-01   +1.238002804916253e-01   -1.323372407723673e-02   +7.332131786669827e-01   +1.603767127060815e-01   +3.188994473376877e-01   +1.288266136021475e-01   -4.081142900330163e-01   +3.909156383721772e-01   -5.198339917373001e-02   -1.000000000000000e+00   +1.669457672521409e-01; -3.621017892902210e-01   -3.186802413525572e-01   +6.288862876550373e-02   -2.216369799955586e-01   +7.843530629533318e-01   -1.497425425628934e-02   +6.294617329692735e-01   +5.813183265394049e-01   -8.989058445576703e-01   +2.918284257322616e-01   +1.775873004562725e-01   -2.391538319288706e-01];
L3E_L3I_iGABA_netcon = [+7.621678839222273e-01   +1.602740980438290e-03   -5.078711084615679e-02   -4.798102179237237e-02   +2.368439361718433e-03   -2.051898650961717e-01   +2.299408337643893e-01   +9.875521544611510e-02   +2.273178188625916e-01   -4.809328372855731e-01   -4.968111418752925e-01   -3.968151715014777e-01; -9.808651910627333e-01   +2.014967820740718e-01   -1.460147419680612e-01   -2.484512864774359e-01   -2.191831019079447e-01   -2.109781660704540e-01   -7.185050185918330e-01   -3.592387108280560e-01   -6.790873950504112e-01   +5.984524204785800e-01   -9.461789311499390e-01   -8.587597019688257e-01; -2.412381259899325e-01   +2.392063545676409e-02   +1.687758946452927e-01   -5.028008889312076e-02   -5.079919190198080e-01   -2.915667862571077e-01   +4.934375965640744e-01   -4.414053190231333e-01   -7.593280350532038e-01   -3.579460941030029e-01   +3.056921616176965e-03   -4.145358174612637e-02; +4.544000008713153e-01   -3.131170613126155e-01   -5.617670491726308e-01   +1.606555543535033e-01   +1.788034330045794e-01   +2.079186739488500e-01   -1.829858304134671e-01   -3.338862175161650e-01   +5.971276298459046e-01   -7.746167635419609e-04   +1.411322258866954e-01   +7.761686391702144e-01; -5.208284598145042e-01   +8.011851449546178e-01   -4.659516333148371e-01   +8.184183415777222e-01   +3.653881682920916e-01   -5.473347898565893e-01   +5.518612132946890e-01   -8.416242477671389e-02   -1.063936978809784e-01   +5.275725351795899e-01   -4.073593197926140e-01   +5.750492043769106e-02; +2.183952261989208e-02   -1.532714810495612e-01   +3.959386492458975e-01   -6.162408091642484e-01   -3.911708965023117e-01   +7.652406221636661e-01   -2.635060224176293e-01   -3.733139169114806e-01   +5.629261239423285e-02   +2.933064325964313e-01   +1.315035283748363e-01   -2.511675755803982e-01; +1.544771730175287e-01   +6.973551866182588e-02   +2.195010875947367e-01   +9.239131925842435e-01   +1.451620816513493e-01   +7.284835573174760e-01   +7.094858707578524e-01   -4.810558866306205e-01   -7.608967726521070e-02   -5.195592052643222e-01   +5.778990872637844e-01   +1.000000000000000e+00; +2.925337852495301e-03   -1.082383958431417e-01   -4.483342363071977e-01   +3.595931801786435e-02   +4.052008471635259e-01   -1.760138193586793e-02   -3.347939699468052e-01   +3.971131612664338e-01   +5.625447315250085e-01   +8.731540502103619e-02   +1.652706387275570e-01   -2.008730681521585e-01; +2.307724109939604e-01   +1.169527910171077e-02   +3.093957952212622e-02   -7.209681765599786e-01   -3.247078083561514e-01   +2.871935764818129e-01   -2.309472118177672e-01   +2.237307120848129e-01   +1.910853525413427e-01   -3.659506643923530e-02   -7.888612547774871e-01   +4.651136551811285e-01; +1.448073346325296e-01   +1.369682191037989e-01   +2.597912318616145e-01   -2.261822731784987e-01   +1.768160121184966e-01   -2.422308838945361e-01   +1.917312368226048e-01   -6.901896081240670e-01   +7.088718292949827e-01   -3.866984835028476e-01   -2.301073359169299e-01   -4.426810175226454e-02; +3.526240276461870e-02   -1.409293798856298e-02   +3.776888235518475e-01   -5.232206629950392e-02   -2.033054070408935e-01   +7.490108276500196e-01   -8.907286881780123e-02   -2.748433963320394e-01   -4.788359163418636e-01   +4.832968243126880e-01   -3.378521132545634e-01   -1.323800697378915e-02; -2.300792325806189e-01   -5.066223261132067e-01   +3.018172184872565e-01   -2.787750495824878e-01   -2.199247385270219e-01   -1.245356907931155e-01   +3.732018971200599e-01   +1.381753021464108e-01   -1.140966002275961e-01   +4.559370716276153e-01   +8.125674558572319e-01   +5.852320395029832e-02];
L2E_Input1_iAMPA_netcon = [+3.122180071542293e-01   -6.403269159398088e-01   +2.754285101057563e-01   -6.146240285959559e-01   -8.881985972022267e-01   +7.496697253794316e-01   +4.185054384831021e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+3.109014298054619e-01   +9.494864192828215e-01   -1.431765320070144e-01   +3.799203920246266e-01   -6.602510722992688e-01   -9.368872128160515e-01   -1.500365518015933e-01   +9.128035422536072e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
