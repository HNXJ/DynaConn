function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.445895526126456e-01   -2.567123536208815e-02   -1.632420329428986e-01   +1.559887471115748e-01   +2.468074840955726e-01   +7.156324823753529e-02   +5.569716931160704e-02   -2.813656739483227e-01   -2.679933132860829e-01   -8.600680132874555e-02   +3.414108390347576e-01   -1.001236809241319e-01   +1.902024343880996e-01   -1.064699808828750e-01   -1.281950544686275e-01   +4.703986071492243e-02; -8.121185126993027e-02   -1.862965294593952e-01   +6.228630407702315e-02   +1.169008104739236e-01   -4.089426819617843e-01   -1.671114764301808e-01   +9.765657198535808e-02   -3.171104695594515e-01   -1.732042805127653e-01   -3.969844655548984e-01   -2.560287000358911e-02   -1.354099766168024e-02   -1.226629618270252e-01   -2.503447892677997e-01   -9.076805882834346e-02   +2.752212909749721e-01; +1.064602364609107e-01   -2.103163221526669e-01   -2.254253649971163e-01   -4.236550077818434e-01   +3.288440495185762e-01   -3.402426824709279e-02   -2.632804570896266e-01   -2.446671912459667e-01   -4.719125538863175e-02   -1.691257442702087e-01   -2.436952966931517e-01   -7.225167783448148e-02   -7.744701956305740e-02   -7.274436092793105e-02   +4.525200050844529e-01   +1.934793601474247e-01; +2.414846062625400e-01   +2.137535410879360e-01   -1.271725196452493e-02   +2.552518390971618e-01   +1.639812330747499e-01   +1.293697774641657e-01   +1.978039366843344e-01   -1.503074467005112e-01   +9.337266311877335e-02   +1.576129393333841e-01   -1.118068006269979e-01   +9.156662393086257e-02   +1.979185101141396e-01   +1.341267768876036e-01   -3.335757719652103e-01   +1.768990554989523e-02; +2.351556677167397e-01   +1.405801926128368e-01   +3.719216274103865e-01   +5.399769210514441e-02   +2.670983275469882e-01   -2.695658282611473e-01   -7.807314472300279e-02   +2.466580141338645e-01   -7.702282290633393e-02   -1.719327759244854e-01   +4.468255625171197e-02   -1.261202530276662e-01   +3.614681525942362e-01   +3.948088378077341e-02   +1.326928491980916e-01   +1.163252540990197e-01; +1.087605589239975e-01   -7.884304621955920e-02   +1.301414386089514e-02   +5.553391440133490e-02   -3.661711355309796e-01   -2.671444036154566e-02   +2.935001091998572e-01   +2.480705687560945e-01   +4.204725440766267e-01   -2.962817505664458e-02   -6.272494627814722e-02   -7.307084147803780e-02   -1.100430454324538e-01   -2.839552095036756e-02   -9.927240927293571e-02   -6.461857562459181e-02; -5.571350023477159e-02   +2.195425050167880e-01   -1.681612210650085e-01   -1.477436984819216e-01   +1.508784038733875e-01   +4.453597830230936e-01   +2.519755830809533e-01   +2.295978594960008e-01   -5.305571906482584e-02   -2.640539781949054e-01   +4.057052314452371e-03   -2.759696254943257e-01   +2.866065422293256e-01   +1.090507030994383e-01   -1.259340241450815e-03   -1.195207006189730e-01; +2.371755587803940e-01   +3.133425162349656e-01   -4.035949782551076e-02   +3.974710928115993e-01   -3.151929268261023e-01   -2.631399998709679e-01   +2.437355383172608e-01   -4.198959344670077e-01   +1.534453837655436e-01   -2.808281301743196e-02   -6.849210496923613e-02   +1.157591509020936e-01   +1.768625976384331e-01   -2.107847541791821e-01   -2.138371017452968e-02   +3.737688597236085e-01; -1.870217198077831e-01   +1.696315226331507e-02   +1.913395428159419e-01   +5.474393627585136e-02   -4.755365017583132e-02   -9.983299906478504e-02   -2.385414139626798e-01   -1.007408890489307e-01   +3.719048798476416e-01   +2.251852013047998e-01   +4.037255341502664e-01   -2.184660916749023e-01   +1.398993549202854e-01   -1.435600379610211e-01   -9.742613435371666e-03   +1.416524495641560e-01; -1.618111739352552e-01   +1.075746132763435e-02   -1.853273186244988e-01   +1.823171840413316e-01   -1.455524560213297e-01   +3.015097451364278e-02   -1.838884386350376e-01   +1.253297120773590e-01   +4.003566408194112e-01   -1.897996118740056e-01   +3.314082294791126e-01   -1.657143177182219e-01   +1.764720840679311e-01   -4.390204196482430e-02   -1.254296189523243e-01   -1.568066078473086e-01; +6.004430093921162e-02   +1.272153494149363e-01   +1.071573996424639e-01   +1.456473847451012e-01   -2.916316300223306e-01   +3.347922033279380e-01   +2.887624156319322e-01   -1.982222369573596e-01   -1.600117512943767e-01   -7.306877099978878e-02   +4.012320657409025e-01   -2.967709213200817e-01   -2.863327311771005e-01   +1.337458664133979e-01   -2.691112428026727e-02   -3.610326003287803e-01; +2.476945819436351e-01   +5.354698520911996e-02   +7.278058909143023e-02   +3.897195836533204e-01   +2.056454452218123e-01   +1.935946692160817e-01   +9.728943565672946e-02   +1.383678979083015e-01   +1.247503230529533e-01   +2.300176564720703e-01   +3.739843040554935e-02   +2.403566301233014e-01   -1.584387519913925e-01   -6.501420143571636e-02   -2.822949069949408e-02   -1.026020141795646e-01; -2.342007666633269e-01   +3.318415473903630e-02   +2.248194493714809e-01   +4.376172266909639e-01   +1.296983340469225e-01   +1.445355925186233e-01   -1.050049496793386e-01   +3.237095589871801e-01   +3.341660553529723e-01   -1.419725926404158e-01   -3.665913169351924e-01   +2.522038604805766e-01   +4.455054756219236e-01   -2.041053127097946e-02   -1.138584525556205e-01   -1.196136837337596e-01; +1.357252325244480e-01   -8.746754847631390e-02   -1.882277432485925e-01   -2.697597677916952e-01   +2.730372224652832e-01   -9.171994268802140e-02   -3.161698525555691e-01   +6.075073046695151e-02   -4.602583336571987e-01   +2.866834304460270e-02   -3.891431493110430e-01   +3.950614436348006e-01   +1.960593716182088e-01   +1.617357839581832e-01   +1.916906222727522e-01   -1.039558104924676e-01; +1.093227249710086e-01   +3.641847124220830e-02   -2.574368764194518e-01   +4.076976460329501e-01   +1.324176940889967e-02   +3.039444352520975e-01   +3.847413304511565e-01   -2.079982255852481e-01   -1.584975198958737e-01   +1.391260295903756e-01   +2.141580381917509e-01   +2.562174884764354e-01   -2.157544920756982e-01   -1.570035022275131e-02   +7.223059728439458e-02   +2.332877869665766e-01; +2.200975471247765e-01   +3.348056395075827e-01   -8.649959393693193e-02   +3.010228209469228e-02   +1.125344279895302e-01   -2.737695525252135e-02   -9.850267449382506e-02   -9.668067145579209e-02   -5.047998171917927e-01   -2.043302702507882e-01   -1.398556467705727e-01   -7.041811463459663e-02   +7.993788909704416e-02   +1.606579931182351e-01   -1.467819549815995e-01   +1.071666194454961e-01];
L1E_L1I_iGABA_netcon = [-6.455536626167332e-02   -4.049744150374377e-01   +1.256189232904535e-01   +6.134926828602626e-02   +1.259659750398930e-01   +1.667227297716831e-01   +3.118844742688943e-01   -1.117156604752864e-01   +1.840860738603100e-01   +1.880636110704289e-01   -2.652399659892517e-01   +4.361315022617497e-01   -3.682870700240765e-01   -1.340206131595740e-01   -3.022900556956359e-02   +8.565278871089270e-02; +3.383528937509278e-01   +1.514741652215542e-01   -1.817821545417359e-01   +1.421380121951565e-01   +1.366538910557513e-01   +1.610089618070897e-01   -8.781154967629995e-02   -5.028309773074514e-02   +2.042637736099992e-01   +2.083676184556951e-01   +6.898159523581442e-02   +9.314034217591687e-02   +2.467660455992966e-01   +1.839337660497983e-01   +2.973429943063253e-01   -1.863492902070125e-01; -3.289903467748582e-01   -1.305592540892964e-01   +2.076120236364222e-02   +3.989247348711508e-02   -8.168883650873388e-02   +1.313048000389115e-01   +1.198451940379558e-01   -6.004220832230885e-02   +2.893952922025129e-01   -6.688126974622423e-02   -1.106660318224474e-01   -1.563563175030137e-01   +2.351270057526481e-01   -2.423553120635770e-01   +2.137215132240624e-01   -1.802070470842497e-01; +3.216118749986568e-01   -6.741069057883073e-02   -1.228936412287956e-01   -1.795582291090440e-01   -3.699751483772219e-01   -2.284784130079047e-01   +9.280525307618623e-02   +1.338740636247581e-01   +3.845950477190875e-01   +5.826598280729547e-02   +1.338936425972561e-01   +6.093532025792206e-02   -1.292152273569172e-01   +3.065458782689239e-01   +1.494842673021347e-01   -2.377813397038742e-01; -8.990423238401558e-02   +1.916053146966292e-01   -8.312209973348092e-02   -3.907963337544195e-01   +5.431943446977677e-02   +5.911590777814733e-02   +1.004781780771839e-01   -2.940336864958017e-01   -4.659755487034234e-02   +1.173302640598071e-01   -2.891414872974974e-01   -2.504954659517343e-01   +8.341271536972517e-02   -1.739714431089049e-01   +7.343399532649501e-02   -6.281057192889845e-02; -2.862491705854861e-01   +5.366875930013622e-02   +7.900163158733849e-02   -4.354852901244810e-01   +6.146230431943596e-02   +1.003839294636722e-01   -5.610250590819230e-02   -9.443084612159144e-02   +1.236473807709031e-01   -1.389192370178197e-01   +2.355038658115771e-01   -4.259191503208583e-01   +2.855270381518785e-01   +3.105605390576888e-01   +7.596334121092883e-02   -2.268513792156958e-01; -8.972184737163286e-02   +3.574094969192112e-01   +3.870784893094795e-01   -2.472291491091046e-02   -1.911401656542885e-02   +3.977859356734780e-01   +3.450716172351172e-02   -4.202462183635898e-01   -6.150769925076983e-02   -9.049843795637826e-02   +2.067854776047311e-01   +6.831596033816503e-02   +2.386585822082267e-01   -1.244453085796348e-01   +6.641952306371723e-02   -7.177840666554870e-02; -1.727511865091180e-03   -1.239487594097860e-01   -7.233547881922567e-02   +2.988474493616151e-01   -1.524859540974610e-01   +1.599773281132901e-01   +1.021363465551676e-01   -1.991816969338344e-01   -1.265594883261445e-01   -2.036950821787927e-01   +6.448704850277648e-02   -1.618148003742526e-01   +1.631546257083009e-01   -6.055130526705645e-02   -2.362927011525897e-01   -1.165265707698725e-01; -3.577965019102501e-01   +9.618867047115240e-02   +3.439854805983980e-03   +4.197737707000629e-02   +5.521734330859415e-02   -6.301073607198018e-03   +2.433488919979712e-01   +1.345099247980673e-01   -9.618453510092828e-03   -8.298993043218611e-02   -2.562941647983714e-01   -1.172214104481114e-01   +3.437552166513318e-02   +1.084528085924363e-01   +4.215552825993633e-01   -2.954079447996538e-02; -6.827831921929581e-02   -2.002166213232084e-01   -1.965341309683402e-02   +5.900732697291777e-02   -1.427899587370837e-01   +1.273811516362831e-01   -5.988909443402335e-02   -1.673369882984191e-01   +1.860472135667659e-01   +1.073829748083674e-01   -1.477098249530330e-01   +1.268944767909796e-01   -2.499768783635504e-01   +7.500244933024487e-02   +4.255861474051494e-02   +2.313817993885479e-02; -1.804496291373178e-02   +1.873931394369388e-02   +1.278679256192176e-01   -3.033312681735656e-01   -3.671752022120350e-01   +2.180200678760658e-01   +2.612369306976667e-01   +1.191390836390588e-01   -3.386957413545527e-03   -2.530485346190908e-01   -9.720493537798765e-02   +1.773176655158290e-01   +2.804385400540119e-01   +7.417774763566413e-02   +1.681511394318072e-01   -1.879278744674673e-01; -2.859289585368042e-01   -1.093951266920671e-01   -2.520612078554154e-01   -1.997591172620202e-02   -3.067228199346149e-02   +3.062875321427582e-01   +1.773735412377908e-01   +2.346081037555678e-01   +1.297751705686118e-02   +2.414147895774566e-01   +1.456676090113657e-01   -1.227708959697607e-01   +5.440375837075492e-02   -2.276437009329464e-02   -1.783972999706958e-01   +3.743180613669727e-01; +1.953740849107988e-01   -1.984826347925318e-01   +3.060150173577938e-01   +2.066814261868622e-01   -3.141422595973615e-01   -5.242756940038505e-02   +4.796395803665967e-01   -6.225865985739051e-02   +3.722660900508081e-01   +2.753719349702944e-01   +1.500280536105950e-02   +3.689542605284805e-01   +1.760752046071095e-01   -1.701996833267268e-01   -1.047918657188840e-01   -1.189128567659592e-01; -2.440239145711359e-01   +1.975911687485925e-01   +1.518195778534337e-01   +1.081913692388375e-01   -2.522214252435355e-01   +5.860844036149281e-02   -1.521742534497240e-01   +3.414320675470748e-01   -1.043749563595417e-01   +2.781639519496789e-01   +1.159583336040441e-01   -7.832145932930082e-02   -2.502686475503447e-02   -3.203609286274037e-01   -1.385210105001119e-01   -3.096823202064105e-01; +3.275921232387402e-01   -4.793632480219259e-02   +1.385513649355679e-01   -1.010782886395940e-01   +1.444688055487034e-01   +2.665654229108234e-01   +1.223557173797579e-01   +1.190746346974132e-01   +2.614295305723284e-01   -3.627260098883085e-01   +1.948634445113729e-01   +3.541202226734622e-01   +3.323337180408074e-01   +3.666084994409467e-02   +2.020822869728616e-01   +3.646970197207396e-01; +4.943589670951871e-02   -1.006484191635676e-01   -2.022705603303955e-01   -7.498849337802456e-02   +1.913158313556609e-01   +4.306526620465768e-02   -1.330031103688272e-01   +1.220934219999699e-01   -3.498561057715434e-03   -1.514336215000165e-01   +1.112452431796312e-01   -2.298977764204089e-01   -2.030265380342328e-01   -5.613670143862090e-02   +2.249700694434746e-01   +2.221002590114533e-01];
L2I_L1I_iGABA_netcon = [-2.348104334360008e-01   -1.194959623912076e-01   +2.635228768757831e-01   +2.959140642628154e-02   +1.259413098139366e-01   -2.418589251919158e-01   +2.782514638959240e-01   +2.549015947918970e-01; +1.401715354202078e-01   +5.067246271650669e-02   +2.689511184840096e-02   -6.646652584953312e-02   -1.137422904166354e-01   +3.903190995587945e-01   +2.625305288353906e-01   -2.505826427320226e-02; +8.771337296904527e-02   +1.057084771913371e-01   +9.673025021108345e-02   +2.462290322285721e-02   +1.382764921646573e-02   +9.349971729834275e-02   -4.296902942971588e-02   +9.722129855900619e-02; +3.103966804545067e-01   -2.157838634769854e-01   -3.896565457521327e-01   -1.839171992296822e-01   +1.521161286375950e-01   -1.137039982214097e-01   -5.185955440962275e-02   +1.621255488367104e-01; -3.532315449073954e-01   -3.314348487100036e-01   -3.623978576601164e-02   +4.100246225662463e-01   +1.160235586378523e-01   -2.004645756582067e-01   +2.112117056610252e-01   +5.971279411139030e-02; -5.097334676736062e-02   +1.972568583825789e-01   -1.309931194327323e-01   +3.275922433959430e-01   -5.049209809305570e-02   -3.992009146780941e-02   +7.239101933448673e-02   -1.365054382632638e-01; -1.607927470377143e-01   +3.602352188084918e-01   -1.850896356189600e-01   +1.583907387542693e-01   -3.617630591063040e-01   +2.783750958372779e-01   -1.270795371536927e-01   -1.507001714120901e-01; -1.794462245355910e-01   -1.065878168013073e-01   +9.877350954014871e-02   +1.478309830365836e-01   +3.673370120617257e-01   +1.587913920403981e-01   -3.331889535844416e-02   -2.593025327092169e-01; -2.018599776194410e-01   +9.533467975254914e-02   +4.454597499012466e-02   -1.710348996590276e-01   -7.991371953938292e-02   -2.481957750032456e-01   +1.513148799856611e-01   +9.051076627614833e-02; -3.681631192519878e-02   -1.126395815199209e-01   -1.223481588634186e-01   +7.307865792506188e-02   +2.337293575463743e-01   +3.254761857260613e-02   -1.278102137559483e-01   +3.344295912292310e-01; +2.759349133197217e-02   -1.295143114331958e-01   +2.262667484014717e-01   +1.524083591924680e-01   +2.424644549438537e-01   +3.040858924991454e-02   +6.262205094828707e-02   +4.806913335746613e-02; -7.069429146868847e-02   +1.477876138673622e-01   +2.156974657878904e-01   -2.562555043769367e-02   +3.494685648666904e-01   -6.174422496698917e-03   -1.080185528561216e-01   +8.290284424412309e-02; +2.989177608121535e-01   -4.141506303130510e-01   +4.983733286577388e-02   +1.223520074481935e-01   -3.521785126912899e-01   +8.017916152328060e-02   +3.454749316600129e-01   -7.352848050332141e-02; -3.454087450568730e-01   -1.131604402308190e-01   -1.804633367042337e-01   +1.633430851866487e-01   -2.616860641470774e-01   +1.737005202806614e-01   -6.674216002966399e-02   +1.773998043181684e-01; +1.609887759853664e-01   +1.082349458968948e-01   -6.646598005039554e-02   +1.275428349202390e-01   -1.691154243369041e-01   +1.138744950783125e-01   -2.368747945596045e-01   -1.457840578334346e-01; -9.750099629440492e-02   -5.622494931242656e-02   -2.968765229108724e-01   +1.506881241538158e-01   +9.851360742910018e-03   +1.168171608306765e-02   +3.715566633600498e-01   +1.661503190006630e-04];
L1I_L2I_iGABA_netcon = [-2.264241627904903e-01   +8.088907278143764e-03   +8.416232564623832e-02   +2.064710776269760e-01   +7.855770602632714e-02   -1.359974179648113e-01   +7.750512305981644e-02   +1.728604865260032e-01   +3.028102529163847e-01   -2.910646549237033e-01   -1.883696046495858e-01   +2.162339874325064e-01   -3.315168344993448e-01   +2.553161878363026e-01   +1.610940653590556e-01   -5.950399620113550e-02; -7.804554199397697e-02   +3.263738994725978e-01   +3.231001554382179e-01   +4.913615095582552e-01   -1.856221111014710e-01   -3.753702371076827e-01   -2.335824332060630e-01   +6.586961250557848e-03   -1.046543387479712e-01   -1.741533905592372e-01   +3.682211572774669e-02   -1.242778124836156e-01   -1.322208672821650e-01   +1.238554797356168e-01   +5.958120387587667e-02   +4.508233154294940e-01; -5.851255959605997e-02   +2.130256073141535e-01   +2.003912251013841e-02   +1.287457099781864e-01   +1.868259072617642e-02   -1.159712614283687e-02   +1.747913339905414e-01   +5.989289623931404e-02   -3.212527635191919e-01   +5.459159219830625e-02   -1.574870362279061e-01   -2.759680988986052e-01   -3.099406316174701e-02   +3.755097401884594e-02   -9.907333412147450e-02   +3.198265480008035e-01; +3.306566871502156e-02   -1.178194400222718e-01   -3.824934106917513e-01   -4.181842052941810e-02   -3.736055944781944e-02   +1.915605113620297e-01   +2.422029670113807e-01   +7.140469146624390e-03   +1.755921840791569e-01   +2.864757433054511e-02   -1.039781925787784e-01   -3.343689010988334e-02   +1.255609836996381e-01   +2.885788555811799e-01   -3.047846382508445e-01   -8.090231114113702e-02; +1.950219600190308e-01   +4.700982258864745e-01   -9.301495186218420e-02   +1.181305443409152e-01   +4.529642262175052e-02   -7.064412871523346e-02   +2.512350007385921e-01   +1.122574868249137e-02   -4.737794341338966e-02   +8.108185696000442e-02   +2.226877687062871e-01   +2.593026498516677e-01   -1.417194063100151e-01   -9.162782199826688e-02   +1.151606587191163e-01   +2.493674194897793e-01; +6.410188992493962e-02   -1.343983075183699e-01   -2.551442303062892e-01   +1.798310796344938e-01   -2.562556548816386e-01   -2.232852889873227e-02   -2.137260131417817e-01   +1.862536881870214e-01   +1.701521248018580e-01   +9.702513718609126e-02   +8.218871705910122e-02   +2.885440174449967e-01   +1.734848345910463e-01   +3.656744854844851e-01   +2.950487668608585e-02   +2.326148978691349e-01; -2.987808624062754e-03   +1.732824703967083e-01   -3.443227823354958e-02   +7.948142865139696e-02   -2.332495738518499e-01   +3.336104620391687e-01   +1.057672457286448e-01   -1.329020068266145e-01   -1.928936240145584e-01   -3.033443350219318e-01   -7.710066352971168e-03   -6.912029446026345e-02   -4.200561456879311e-02   +2.740558771411722e-02   -1.159097091611558e-01   -2.117968529231291e-01; -1.524711532143040e-01   +3.498825359013134e-01   +3.404665737085449e-01   +1.710720255801513e-01   +4.567834616728250e-02   -3.322780772621908e-01   -8.643408746851944e-02   -2.036821910189020e-01   +7.201273942187975e-02   -1.923868943743998e-02   -2.579320723486614e-02   +1.221843408634483e-01   +1.903475391933882e-01   -5.189628674665345e-02   +1.451837836579112e-01   +1.090172655407191e-01];
L2E_L1E_iAMPA_netcon = [+1.581191791903859e-01   +1.680835391964138e-01   +4.246033992770401e-01   +1.794527531341212e-01   +3.206751381446323e-01   +9.536760009001273e-02   +3.456141811869158e-01   -3.493216543261897e-02; +1.236653955975142e-01   -2.614034583006802e-01   -1.439396997969148e-01   -1.775802818099188e-01   +1.893267595646747e-01   -9.278968503573784e-02   +1.159031205224886e-01   +1.086326597089230e-01; +4.888384818324748e-02   +9.088552921115299e-02   +2.086465432634609e-01   +3.267663729413415e-01   +2.387399594805941e-01   -2.915178367208079e-01   -5.049457961704622e-02   -4.384897427699500e-03; +6.657043627193847e-02   +2.453814890564902e-01   -1.061119046584535e-01   -1.052535014491521e-01   +3.201525434279216e-01   +2.567706353438604e-01   +3.244119066758887e-02   -1.802046195844635e-02; -3.634031215996295e-01   +4.079216464688468e-02   -1.488788247140646e-01   +2.154508243214602e-01   +2.666829370941507e-01   -3.466606901159178e-01   +1.304229519323341e-01   -2.234163304033577e-01; -8.697252309508877e-02   -2.260376140702307e-01   -3.062674513887340e-01   -1.088499608917042e-02   +1.030368906073609e-01   -1.281790465386617e-02   +4.181784198845045e-01   +3.632025056440664e-02; -1.243346071241422e-01   -1.056350498985813e-01   -1.171337587043817e-01   +1.747828867303691e-01   +3.708829491708826e-01   +2.208398170593906e-01   -6.369781809910817e-02   +2.887194474124673e-01; +1.994611876658008e-01   +2.308416426070570e-01   +2.327603153364600e-02   -1.712220051436374e-02   +6.210656797570754e-02   -1.972485411123463e-02   +2.343999824194967e-02   -7.644115678799185e-02; -1.397428557191696e-01   -4.390831537497715e-01   +1.823971326056023e-02   -7.564573879845103e-02   -1.696407969709777e-01   +4.008695560481515e-02   -3.068646602994885e-01   -4.984732564533838e-03; +5.323536601689542e-02   +3.447604087746326e-01   -1.223738214970726e-01   +1.530003412233098e-01   -3.550967280654484e-01   -3.252578248990620e-01   -2.284113424220336e-01   +1.749085504613792e-01; -1.283512762004794e-01   +3.311520544663582e-02   -3.082239242035332e-01   -4.174816007759248e-01   +3.855678692143147e-01   -6.820246964224032e-02   +2.576201697291086e-01   -2.486650715751649e-01; -3.437263744689398e-01   -1.567960132612322e-01   -2.142058510168014e-02   +3.904486480929233e-02   -1.315120807557551e-01   +4.161372265222644e-01   +4.033700219592200e-01   +2.121185909541437e-02; -1.895229693015304e-01   -2.891999009339922e-01   +3.576193475118313e-01   -3.082564133124502e-01   -2.377467426741391e-01   +7.060554008395295e-02   +1.695106800229970e-01   +1.388196429352455e-01; -7.571134529538656e-04   -3.707452901398185e-01   +3.026684169011369e-01   +4.501325002481371e-02   -1.813250894857703e-01   +3.707423809404878e-01   -1.863349411994666e-01   -2.001907217060804e-01; +2.620283095759772e-02   +2.825169739386618e-02   +3.682020908706319e-01   -2.473638078041644e-01   +1.706630679199130e-01   +1.895382723416235e-01   +2.241710231693666e-01   -1.730654917656674e-01; -3.181025054366541e-01   +3.342707677205942e-01   -2.580036532569424e-01   -4.012297756440010e-01   -1.129069967927799e-01   -1.349533491419124e-01   +1.087710106604277e-01   -1.478255612748742e-01];
L1E_L2E_iAMPA_netcon = [+1.022156353309863e-01   -1.537099646928577e-01   +4.068662164227908e-01   -5.562965964998312e-02   -1.011996506729797e-01   -8.104473043203629e-02   -3.490902117580500e-01   -3.717315833536622e-01   +3.675077793660912e-01   +5.849707977326685e-02   -7.061530256378339e-03   +4.112384408858815e-01   +5.174389560616580e-01   +1.959785206863628e-01   -1.266613418513390e-01   -3.291035490094726e-01; -1.689896775716393e-01   +3.996014280001583e-01   -7.041749843956696e-03   -2.106521163907870e-01   +2.574604176792737e-01   -1.683290953114369e-01   +1.930728517422239e-01   -7.245840066318354e-02   -2.001717422338765e-01   +1.332809236238548e-01   -1.474573487730436e-01   -1.803537748963817e-01   +3.662474693977970e-02   -3.001463336410418e-01   +2.631003149662135e-03   -1.082249028082847e-01; +7.160317665109767e-02   -7.451807671247535e-02   +3.779142206728710e-01   +2.969512181753505e-01   +4.424508461805011e-02   +2.590552430174823e-01   +8.423113266204327e-02   +3.999496423391180e-01   -8.213608048366491e-02   -2.133530659415102e-01   +5.512370200033868e-02   +2.306967972822291e-01   +1.007768821887343e-02   -1.266106857945685e-01   +1.138967178185212e-01   +6.112906019509614e-03; +2.404463629207154e-01   -7.672298965831396e-02   +1.574373223032249e-02   -2.771417729950040e-01   -1.235624248570419e-01   +8.580303702865900e-02   -2.635811517602301e-01   +2.401196347892529e-02   +7.044913953162833e-02   -2.184279898803668e-01   +1.271046215836602e-01   -2.861294143613333e-01   -6.619106226251983e-02   +1.145108944376447e-01   +1.527600235685949e-01   +6.505100764577813e-02; -2.264209354751863e-01   -1.424456251352557e-01   -1.532673379857095e-01   -3.587200242343379e-01   +3.315345557812124e-01   +3.913997512909002e-01   +2.493631251889097e-02   -1.160013912989312e-01   -3.516504549622093e-01   -1.063146334338892e-01   +5.208828024994068e-03   +4.036285802085470e-01   -1.807039565895402e-01   +7.409441590102503e-02   -9.974275496208040e-02   -1.168841408194632e-01; -1.705505073955754e-01   -3.912574116248791e-02   +3.476073578611673e-01   -1.457730188459562e-02   +1.459894029401082e-01   +2.784168180479574e-02   +4.196766470089874e-03   +3.919991296995990e-01   +2.871258536861354e-01   +2.204729021512832e-02   +1.721828429593062e-01   +2.718838478744361e-01   -1.811748494540063e-01   -2.003066432635168e-01   +7.474176755537995e-02   +2.443540307010449e-02; +2.603147844716568e-01   -5.754994486038731e-02   -1.793847289630706e-01   -1.516012759972440e-01   +2.498146098603665e-01   -1.310934377786504e-01   -2.708487168140189e-02   +3.842690485863093e-01   +2.341776903682871e-01   +2.015828496032275e-01   -2.248326372788827e-01   +7.678603444465895e-02   +6.831030615939127e-02   -3.183084770234629e-01   +1.887831442037252e-01   -5.207013291854530e-01; +1.117261337871115e-01   -1.134982576275792e-01   -8.525305275946790e-02   +2.919799332749434e-02   -1.511119582845906e-01   +9.229346735032647e-02   +2.753508312869027e-01   -6.668793626328762e-02   +3.656712229752439e-02   +2.315851552613198e-01   -7.148709229547523e-02   +1.801647590833782e-01   +3.047626921343233e-01   -6.288682460321485e-02   +3.770264923450491e-01   +1.475882304425362e-01];
L2I_L2E_iAMPA_netcon = [-1.727675856941499e-02   -1.061247455900517e-02   +4.292561336040543e-01   +1.852169192394362e-01   -3.515229883318422e-01   -4.126698084293190e-02   +6.938051720019037e-02   -1.332524218352951e-01; +7.906746968000686e-02   +3.394778633732934e-01   -9.187948676127752e-02   +1.942913217342885e-01   -3.150037257542732e-03   -2.130968029288818e-01   +3.714052434222108e-01   -2.766792925052901e-01; +3.171593202914371e-01   +2.829423767880668e-01   +1.168761487998150e-01   -9.476492124168752e-02   -9.240976597322319e-02   -3.394777226901110e-01   -1.674989814306120e-02   -2.429142883862332e-01; -3.309103141038388e-01   -1.715181275946839e-01   +2.500974796123106e-02   -3.811808573931319e-02   +6.525941963381776e-02   +2.209150152482173e-01   -1.747161003108337e-01   -2.220621821166598e-01; +2.232777553757708e-01   -1.531654340883490e-01   -1.354371923923169e-01   -6.201930081583942e-02   +4.272568702709909e-02   +1.599070273147940e-01   +2.160207538362676e-01   +3.450688722463819e-01; -2.972324412148636e-01   -1.764493064518156e-01   +1.909899147009168e-01   -6.380587993557424e-03   +1.295477745693691e-02   -1.772614602708036e-01   +2.938267044817550e-01   -2.051769668772103e-01; +1.157975486635544e-01   -4.147884667378446e-02   +1.515713545621312e-01   +1.172965676566109e-01   -3.043772235567755e-01   -7.362111719210357e-02   -2.033867286321988e-01   +1.112719975086063e-01; +3.069243194833643e-01   -9.700701044965537e-03   +3.088376154459962e-01   +6.883093796481074e-02   +1.681072569087400e-01   +1.958480531880970e-01   -6.303782838728614e-02   +1.602982233240622e-01];
L2E_L2I_iGABA_netcon = [-9.662970677246054e-02   -1.956285513424001e-01   -1.557054750119125e-01   -2.245333037642381e-01   +1.418365380560445e-01   +2.991995288820969e-01   +1.794527744788688e-01   +1.769806328982208e-01; -2.859849676912615e-02   -1.589349683576830e-01   -1.990646511034956e-01   +3.961403254834200e-01   +3.408052257830264e-02   -5.024546552210529e-02   +1.443993618815933e-01   -2.614450468779894e-01; +1.986102878157378e-01   +2.328877643136624e-01   +1.015874614122602e-02   +2.447853065272104e-01   +8.493574623277976e-02   +9.793406251077420e-03   +5.999396528009800e-02   +1.686454075544001e-01; +2.861409643124094e-02   -5.093575869434473e-02   -1.084302060290229e-01   -2.503824173067142e-01   +1.079270619077014e-01   +3.310035870003925e-01   -2.176977875384364e-01   +2.202533499261059e-01; +4.167588341012607e-02   +3.326257858444602e-02   +2.989723271587738e-01   -2.310645964849054e-01   +1.103242311859978e-02   -8.633900760746126e-02   +2.591828357919645e-01   -2.402460691580831e-01; +1.157630942938367e-01   -2.518308726012806e-01   -1.688955554542844e-01   -1.218575778764810e-01   +1.378172484238780e-01   +1.126326801294135e-01   -9.343556275879975e-02   +1.622120283143570e-02; +1.279390148094176e-01   -4.723909456377914e-01   -1.639709801020927e-01   +2.730761334939530e-01   -1.209592010778078e-01   -9.086671446546304e-02   +1.063249592561227e-02   -4.323835622852928e-01; -3.793070330977609e-01   -1.034342633452225e-01   -2.841205417185467e-01   +1.308732847047584e-01   +6.860000530841023e-02   -3.660977127558449e-01   +2.487610093266235e-01   +3.271194671238282e-01];
L3E_L2E_iAMPA_netcon = [+2.553691978750112e-01   -2.392332732173845e-01   +1.855094020266012e-01   +7.442436509307070e-02   +2.744740073062690e-01   -2.056414381479933e-01   +5.532715363976802e-02   -2.972404240917361e-01   +4.605809218909879e-03   -2.930189967778029e-01   -3.282610797233484e-01   -4.490715177950145e-01; +3.784057860413434e-02   +2.609881364454496e-03   +3.472238295510657e-01   -2.944293446174430e-01   +2.092390553565061e-01   +4.327640911902865e-01   -2.098600145943653e-01   +5.723502940490173e-02   +2.564971914210364e-01   -2.562210902616326e-01   -2.073878898370821e-02   -2.506401959267439e-01; -9.602923098227259e-03   +2.898736952050430e-01   +8.754496581761285e-02   +3.032761786549373e-01   +1.890785509346157e-01   -2.621255751582965e-01   +1.914682170073196e-01   +4.334962223172587e-02   -3.053545563945134e-01   +1.101612427508507e-01   -2.720283130338624e-02   -1.838450444096577e-01; -4.373467882739820e-01   +2.052266528110863e-01   -1.719575732093423e-01   +4.049575219906597e-02   +1.297582368763532e-01   -9.541660106975253e-02   +8.297376404240046e-02   +1.252139445668728e-01   +2.480398848819761e-01   -3.220197920196607e-01   -2.976314745127572e-01   +1.808351071983434e-01; -1.029751084114922e-01   -5.341381186543544e-02   +1.894774025249497e-01   +1.426848675613087e-01   -3.770441857546578e-01   -8.399124489661948e-02   +3.680867235418341e-01   -1.489481915783630e-01   +4.171683811092701e-01   +2.086017226471198e-01   +1.698802747752647e-01   +3.449892835955309e-02; -1.911487065683417e-01   -1.138576639894646e-01   +4.847389779093863e-02   +4.584078469712745e-01   -1.615128347507228e-01   +2.453905099902846e-01   +2.386161604464806e-01   +1.538546285426540e-01   -6.339350126952001e-02   -3.079793883985646e-01   -3.318275006756664e-01   +5.623026944602621e-02; -1.354377556039162e-01   +2.032684009322428e-01   +2.135150739813245e-01   -2.834428651902475e-01   +1.832535952207696e-01   -1.566187743432578e-01   +3.068213826904869e-01   -8.728944612739054e-02   -1.900286113616368e-01   -1.012861782714673e-01   +8.071291428542887e-02   +1.935854038730625e-01; +1.585557336333227e-01   +7.411733145995301e-02   -1.601122955436919e-01   +1.323634531442729e-02   +5.789656873179715e-02   -1.744790405673718e-01   -2.047338953659217e-03   -1.668926734447868e-01   -1.751520218754697e-01   +3.613895803523171e-02   +3.089418181743697e-01   +1.922960918243609e-01];
L3I_L2I_iGABA_netcon = [+1.025448024735274e-01   -2.713267201201655e-01   +3.737098589372408e-01   +4.028103781597052e-01   -3.207240247178942e-01   -1.220242079272993e-01   +9.876530688412648e-03   -3.350082265694050e-02   -5.460284350319262e-02   +1.957022764995639e-01   +3.870828659708115e-01   +3.420489923990350e-01; -1.003573880514519e-01   -8.554498590341345e-02   +1.910951482669508e-01   +3.452833701352400e-01   -3.436897329641456e-01   +1.238002729611547e-01   +6.565275604933668e-02   -1.478291951395587e-01   -3.384942356232764e-01   +9.729730221169244e-02   +2.425678406019765e-01   +2.276165686204162e-01; +1.324654253746308e-01   +2.635478069831625e-01   +1.595756191117463e-01   +1.590844765629661e-01   -3.552356521923716e-02   +1.202464264170529e-01   +6.188962019984989e-02   -2.612814444704063e-03   -2.690623770552191e-01   +1.598487138353271e-01   +7.590713394029650e-02   -1.390063645302391e-01; +2.516468189430762e-01   -1.516529914175333e-01   -1.487399777637119e-01   +1.484592955849438e-01   -4.045489854000767e-02   +3.327739885890733e-02   -6.343977200440372e-02   -3.674718885456668e-02   +4.273335868681372e-01   +1.316882215866095e-01   +2.152613145752238e-01   -2.679387241637695e-01; -1.541840366831538e-01   +2.163676037719194e-01   +6.086329552789238e-02   -1.760871373403039e-01   -2.495474223071978e-01   -3.756986846449182e-02   +2.681906913214768e-02   +4.127580504625378e-01   +3.086409596134477e-01   -1.116302180583997e-01   +7.767675537926991e-02   +2.070344406706447e-01; -2.102429259181992e-01   -2.106354931936704e-01   -5.761019755899660e-02   -4.230713744204662e-01   -4.374532118960696e-01   +1.524106029024914e-01   +6.654672063765538e-03   +1.155107211503702e-02   +1.780040069931040e-01   -9.135098644647131e-02   -8.168252489394617e-02   -4.029325888280347e-01; -9.633680434241389e-02   -2.041427639697070e-01   -6.488904008538585e-02   -1.630662434771660e-01   -5.386419096170732e-02   +2.783238791646612e-01   +7.720901905235111e-02   -5.854702997352759e-02   +3.357385182708346e-02   -1.050057361145433e-01   -1.130283765547298e-01   -1.940611205755901e-01; -1.764142598549417e-01   +2.653342395248471e-01   -5.169146989334000e-02   +3.245255995138370e-02   -4.770439000050341e-02   -1.242542330070616e-01   -2.628613237099366e-01   -1.641876039643362e-01   +1.199170563474740e-01   +1.065608514499687e-01   -1.481350491241433e-01   +2.342336950470152e-01];
L2E_L3E_iAMPA_netcon = [-1.329436471008132e-01   -1.508905988776068e-01   +1.550738178154379e-01   +6.989591164913336e-02   -1.509131151497636e-01   +1.895338820881712e-01   -1.550859168450705e-01   -1.732274758868450e-01; +7.641998783984244e-02   +1.074680670494585e-02   -1.236363200385846e-01   -6.687521568519869e-02   +2.574190483698441e-01   -8.444067525704799e-02   +1.526046179565282e-01   -1.478539617169017e-01; +2.750860978890756e-01   -2.684577578000016e-01   -3.756032796150789e-01   +3.699843906536194e-01   -3.800014896665610e-01   +5.916351931391353e-02   -6.114109437096799e-02   +3.692883269217513e-02; +8.228471450814408e-02   -8.297340055906036e-02   -3.332888500875227e-02   +1.749869398335992e-01   -1.168211466245339e-02   -1.059322955367925e-01   -1.019087276355583e-01   +2.275490873502275e-01; +3.303483093862074e-01   -1.736644438400298e-01   +2.693541182486561e-01   -6.528954998554748e-02   -1.115947609785997e-01   -1.703618103236087e-01   -8.739448547062068e-02   -7.465355994225120e-02; -6.562550398482617e-02   -2.419130105238886e-01   -1.206933719689342e-01   -1.912887738210062e-01   -1.199712619861392e-01   +2.468067744856182e-01   -2.667452469017438e-01   +3.693322782773902e-01; +9.912720066701636e-02   +9.560106681512455e-02   -1.341536215358649e-01   -4.788362154558449e-01   -2.849275633865650e-01   -1.779983304161888e-01   +2.418927077501601e-01   -1.248615619102718e-01; +4.005588433710295e-01   +4.520597379495153e-02   +1.156570908686218e-01   +2.440770384549548e-01   +4.424713740315100e-01   +6.593751561356528e-02   +1.928903909229131e-01   -1.863322862981548e-01; +3.069636463640565e-01   -1.970327770603168e-02   +8.952638333680629e-02   -4.566556879337096e-02   -9.808536934358217e-02   -1.502692446995839e-01   -3.488245203718797e-01   -3.185604228183735e-01; -1.216504784267230e-01   +2.278270590959219e-01   -1.362105814888572e-01   +8.430287857570801e-03   +7.044808492537097e-02   -1.130329879145331e-01   -6.548411767254367e-02   -2.270649374910672e-02; +9.596733125198254e-02   -6.112958141219745e-02   +3.253888119630401e-01   -8.637512518197957e-02   +7.413648887981980e-02   +1.450013351212711e-01   -2.131068788400856e-01   +1.541078445638810e-02; +2.469129229287767e-01   +2.048067138880978e-01   +2.174883486975418e-01   +1.954437499490783e-01   +1.940535548062151e-01   -1.596153548198118e-01   -2.703016132436701e-01   +6.220302095302076e-02];
L2I_L3I_iGABA_netcon = [-1.058177688686008e-01   -2.122012041182008e-01   +1.810796479047458e-01   +3.754749974954442e-01   -1.254293027663903e-01   +4.432467392821146e-02   -1.766038023295725e-01   -2.190647498093655e-01; +3.051910000810708e-01   -2.105922023873390e-02   -1.167476455825444e-01   -4.936438169220930e-03   +3.388221879837577e-01   +1.635879352229107e-01   +4.569772932943204e-02   -3.379457426838914e-01; -8.384620681372495e-02   +2.415601165217360e-01   -1.645779573850706e-01   -1.293468129701564e-01   +1.633668104116029e-02   -8.328136099170702e-02   +2.059909974026029e-02   +2.526643095797251e-02; -1.733280329788181e-01   -2.501359501765487e-01   -1.295010600857476e-01   +1.149280132007259e-01   -1.277565617652635e-01   +2.258946276419631e-01   +1.042755617019581e-01   +8.823978042953072e-02; -1.091891688350779e-01   +1.798937835554246e-01   -1.090653823471326e-01   +1.623955758377593e-03   +1.964361005895569e-01   +2.700559386534246e-01   -4.333965792676489e-02   +1.082364471699299e-01; +2.251171284177024e-01   -5.069307250728423e-02   -2.469399468881109e-02   +7.054864489612776e-02   -2.076479475394957e-01   +9.890935333815501e-02   -7.987806774163744e-02   -2.729489846479564e-01; -7.676695223124766e-03   +1.957464114286468e-01   -1.135564015122261e-01   -2.381049966361458e-02   +1.282521581783626e-02   +4.920939265747973e-02   +2.550296363223934e-01   -6.894596027827121e-02; +2.864068415636984e-01   -1.697283136910497e-01   -6.700300858134291e-02   -1.612412330296282e-01   -3.570485361659956e-01   +2.814043643803905e-01   -2.592780005674074e-01   +2.047398909242682e-01; +7.085200863935107e-02   -1.925234452280326e-01   +2.850349639952209e-01   +1.559664383485378e-01   +8.405691045133538e-02   -1.130189955453553e-01   +2.946952098011201e-01   +2.165365394622886e-01; +1.105587134309829e-01   -1.005651946935283e-01   +1.213523862857106e-01   +3.125740768214147e-01   +1.339726329397974e-01   +8.362918818847417e-02   +1.602397312474867e-01   -3.028499414946560e-01; -2.675826274081353e-01   -3.364079307496881e-01   -3.124548626598627e-01   +3.199963324176714e-01   -9.726862527932452e-02   +2.437080816944923e-01   +1.449398007893649e-02   -1.199931054868520e-01; -1.695773882628813e-01   -3.471467546861846e-01   +1.421464237252339e-01   +2.593548135476988e-01   -5.789908502165908e-02   +3.291377013551697e-01   +4.352713537663438e-01   -2.462570738982962e-01];
L3I_L3E_iAMPA_netcon = [-1.041379244970417e-01   -2.799286896632718e-01   -1.122918496611422e-01   +2.353953416790756e-01   -3.708653141376757e-01   -1.155429981198424e-01   +1.066437669777494e-01   +6.293134064531027e-02   +2.345694775747930e-01   -2.065430520901273e-01   +1.180391263008816e-01   +1.399733956313531e-01; -2.083016575320740e-01   +6.216779115182744e-02   +3.056270541349232e-01   -1.348682184103701e-01   -2.075783208410770e-01   -1.585222131970897e-01   -7.317864452121631e-02   -1.923477270566643e-01   +2.325381779341487e-01   +4.350092058045927e-01   +2.210334612684788e-01   +6.963805514577498e-02; -9.215843406025709e-02   -2.185176669968073e-01   +1.182458231597407e-01   -9.754740474322593e-02   +1.227226214746625e-02   +3.261211014853854e-01   +1.564722936993394e-01   +3.482852360672278e-01   +4.341121714397034e-01   +5.749615800355100e-02   -1.943999602868741e-01   -3.290886680249429e-01; +1.302130621788445e-01   +2.793344171865680e-01   +3.189343288297222e-01   +5.448497790648260e-02   +2.721149507654902e-01   +2.065430001114096e-01   -9.401859510845662e-02   +1.172014822326748e-01   +1.116658496754355e-01   -2.370050639527239e-01   +3.087854056991235e-01   +4.641825903333757e-01; +2.841818332156086e-01   -9.584023830260978e-02   -1.539107869642160e-01   +2.633073007962247e-01   +3.224913837976379e-01   -1.357363915381923e-01   +1.327415763229878e-02   +6.861511707489394e-02   +7.012810262554925e-02   -1.028444259079158e-01   -1.484982969739646e-01   -2.028237437464651e-01; +2.180740272772158e-02   +1.106378293317362e-01   +2.084782315854705e-01   -1.532795357160010e-01   +3.688560093752458e-02   +9.943158891319429e-03   -1.351401298120332e-01   -1.728290993103936e-01   +3.899119475207843e-02   +4.515378342922968e-03   +1.589225146422393e-01   -1.511960065911622e-01; +2.390442541109925e-01   -7.928110373585093e-02   -5.131852757527067e-02   +3.919914467653836e-01   +4.546150238062509e-02   -6.477256922449037e-02   +3.010095603764779e-03   +3.436071802599419e-01   +1.258342220710130e-01   +1.457845202599176e-01   -3.294459045301813e-01   -3.399855545874700e-01; +7.600290461425101e-02   +5.171898289914267e-02   -1.208987359304247e-01   +1.993194273232123e-01   +2.691921457394136e-02   -1.071787643265331e-01   +2.205886427128018e-01   -2.142106897417716e-01   +1.262167398999119e-01   -1.122508008131541e-01   +1.320364571130234e-02   -3.243309467466657e-01; +3.382467749455577e-01   -7.584929602670390e-03   +2.532434189411982e-02   +5.244619470217979e-02   +1.087033313252942e-01   -1.858156336288062e-01   -6.013290624966244e-02   -4.285331555806376e-03   -7.047411827350689e-02   +1.323436122953828e-01   +3.516418060451109e-01   +2.285592383990481e-02; -1.557129880861224e-01   -1.871103243173414e-01   +3.262874484916758e-01   +1.147177469716106e-01   +2.175502859400424e-01   +3.791654907966197e-02   -2.377411493254551e-01   +2.683782755830201e-01   +5.360374408818150e-02   +1.005781153231632e-01   +2.074831476671351e-01   -1.122909564273963e-02; -2.928008996808242e-02   -1.409357926929850e-01   -2.819056656878426e-01   -3.265670257858662e-02   +2.551874012697128e-01   +1.768201468864005e-01   +1.713017069278414e-01   -1.413000920012199e-01   -3.058019331989980e-01   +2.167823849236202e-01   +1.915619763714837e-01   -5.055749792427650e-04; -2.171070029886369e-01   -1.660476594555888e-01   -1.456278912288572e-02   +1.627403066924534e-01   -2.872186543441438e-01   -1.601888107135830e-01   -2.699835013310015e-02   -3.632938326714220e-01   -2.148818299181630e-01   +2.656989460959780e-01   -1.030149222397439e-01   -1.354324975620986e-01];
L3E_L3I_iGABA_netcon = [+2.140099365480196e-01   -1.118419015452679e-01   -4.486950436318714e-02   -2.767783571410006e-01   -2.556551593326381e-01   +6.335208236468430e-03   -2.224841061786038e-01   +1.896957092050925e-01   +4.206825799849726e-01   -3.279267478149651e-01   -8.725330033278920e-02   -6.322409132382914e-02; -5.618168330831771e-02   -1.243496954500139e-01   +6.921727662246235e-02   -6.233170184985053e-02   +2.629913223502632e-01   +1.723706205665625e-02   +2.185638075344251e-01   +1.144975274394007e-01   +3.487462955460940e-02   -1.926058847581893e-01   -1.515699125370649e-01   -2.149694844880893e-01; -2.369071774156170e-01   -8.567689182957201e-02   +6.245217648978286e-02   -2.381346552184933e-01   +3.159159657373810e-01   -1.802178025459447e-01   -2.059448649037636e-01   -1.993017934976186e-01   +6.666810002192586e-02   +5.603258594872427e-02   -2.097604613408373e-01   -2.331713063212175e-01; -1.208230365428538e-02   -9.701829324483677e-02   -2.882908425825007e-01   +1.869672121742804e-01   +1.314753892633551e-01   -1.868195891060309e-01   -1.878533280735692e-01   +8.271391151620047e-02   -3.880723654200969e-02   -2.400667831196788e-01   -5.720269487749437e-02   -2.455755939750552e-01; +5.469098651922315e-02   -3.908747290343138e-02   -1.463645651782286e-02   +1.162409998612509e-01   -1.364751854705408e-01   +1.150899240074145e-01   -2.647735904078304e-01   -2.662601361966240e-01   +2.140703004955264e-01   -9.547474187601603e-02   -1.659588437553572e-01   -9.074932614944811e-02; +5.359819672224635e-02   +8.667200502495379e-02   +9.967370449646039e-02   +2.027507897844994e-01   +2.230697172800024e-01   -1.171878197796189e-01   +1.014302842333337e-01   +1.440595235780699e-01   +3.979842544768257e-02   -2.363306909994583e-01   +3.201487538597169e-01   +1.022186529419364e-02; +2.430250643872190e-01   -6.200278929921518e-03   -8.313948929058096e-03   -3.678102807694689e-01   +4.998081407440366e-02   -1.915680660513649e-01   +2.160607640765766e-02   +8.942969475870938e-02   -1.838482539257850e-01   +1.378874696964522e-01   -1.548475830804658e-01   +6.416135782515045e-02; +3.260623169017720e-01   -2.209575771269388e-01   +3.736320273297733e-02   +3.098412627016854e-01   +1.390017280003120e-01   +3.110713914897884e-01   +2.311642040784629e-01   +2.074529128788317e-01   -1.447751706465349e-01   +5.957075969277267e-02   +1.239556686083584e-01   +1.335784050999027e-01; -2.650134749266252e-01   -4.965379954400564e-03   -2.816792724985254e-01   +1.244407512897819e-01   +1.998153101306520e-01   +2.146132236829414e-01   +1.981437784174074e-01   +1.761517423390064e-01   +2.421715003294242e-01   +2.071110556162921e-01   -3.132061305380707e-01   -4.654763239558581e-02; +2.815750701316854e-01   +3.615684640971542e-01   -2.052554436260401e-01   -2.847706438395770e-01   +4.232347466026053e-02   -2.163770798701370e-01   -1.340186061599375e-01   -3.729853820177621e-02   -1.854907075207391e-02   +1.937247409422177e-01   +1.685374964115854e-01   -7.910893230306248e-05; +9.228129305505722e-02   -1.249854893095899e-01   -4.840980672782290e-01   -1.103186693457130e-01   -2.990382386319983e-01   -1.553271510440677e-01   +2.309574071678971e-01   -5.638411366739982e-02   -1.470898036435628e-01   -1.192800900426690e-01   -1.182781979790849e-02   -1.365275788120249e-01; -3.642265477182968e-02   -2.712555649044153e-01   +3.798947836874006e-02   +1.110264718546645e-01   -1.904947246742473e-01   -5.582402362445320e-02   +1.228008335242574e-01   -1.098986016148959e-01   -2.629168957377309e-01   -6.973405632098953e-02   -9.819325907486867e-02   +1.928439211013442e-01];
L2E_Input1_iAMPA_netcon = [-1.757003955273010e-01   -8.781656012078531e-03   -1.821440262555317e-01   +4.053898076822574e-02   -3.306060016783286e-01   +3.350170075033673e-02   -2.274772385118715e-01   -2.252367921132876e-01];
L2I_Input2_iAMPA_netcon = [-1.998725706478103e-01   +8.809760647934331e-02   +5.737639686604248e-02   -2.319584150881388e-01   -2.505339380286507e-01   +3.019396819237692e-01   -5.048547472878123e-01   +1.234028444467967e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
