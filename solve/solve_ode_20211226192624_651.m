function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.219304029347026e-01   +1.607669065236829e-01   -1.834631395021978e-01   +9.921002854630687e-02   +3.429367490766175e-01   +5.608205924457790e-02   +1.643509756377610e-01   +1.909144842269315e-01   +2.171701748190313e-01   -1.540946260717383e-01   -1.753616319424932e-01   +9.394972102179218e-02   -3.809055964992459e-01   -1.221625846207230e-01   -7.733126276750743e-02   +8.289898835794401e-02; +2.268783675226660e-01   -4.305891295913056e-01   -5.405804187857090e-02   -1.418833069312696e-01   -1.436610598118080e-01   +9.938389270035175e-02   +3.440138349655278e-02   -2.194179276422232e-01   -2.275412002399081e-01   -8.746608850775772e-03   -2.368865804753191e-02   -1.718816773226263e-01   +2.451944979133839e-01   -2.063407914057185e-01   +2.772854566887118e-01   -2.253811077731524e-01; +1.130130086719888e-01   -3.425061938478643e-01   -8.743239661046043e-02   -1.284270013353221e-01   -5.145778509280535e-02   +4.837221924455737e-02   +2.471221498070852e-01   +2.744096739418794e-02   -7.695047077363641e-02   -5.301966973352382e-02   -1.911395363742727e-01   +4.406041157662921e-02   +5.226135488123733e-02   -6.911861552769868e-02   -3.553120772250192e-01   -2.377493900019177e-01; +5.590405274634791e-02   -1.151874523804809e-01   +1.172951577251741e-01   -3.545465009403387e-01   +1.133563296290810e-02   -1.051162499166109e-01   -1.829482732924384e-01   -2.360590626657211e-01   +4.408822309311192e-01   +3.980949231498699e-01   -2.876953928274027e-02   -2.593225692436079e-01   +6.704518413007127e-02   -1.664502084221031e-01   +6.998714136904971e-02   +4.378708248757193e-01; +1.711912898060341e-01   +9.486149405370151e-02   -4.891792841710817e-01   +2.591683825607722e-01   +5.000161624212632e-01   -1.180757365282911e-01   -2.010181379515436e-01   -8.791431339690957e-02   -3.053822456612074e-01   -5.427356467160335e-01   +5.325805320634617e-02   -4.765579733465417e-01   -1.080429745207801e-01   +1.411757315981561e-01   +1.442868959863633e-01   +1.616110942389990e-01; -2.107715118549328e-01   -3.178017256231869e-01   -8.885824128159767e-02   +3.567687075935153e-01   +3.558972260791360e-01   +1.095296010811545e-01   +2.063312568003651e-01   -2.879941669144002e-01   -9.925924407244763e-02   -3.474079005454668e-01   +5.937128229987404e-03   +1.108939017078536e-03   +1.776063753121416e-01   +5.022061488459727e-01   +1.335579881466676e-01   +1.909609158991012e-01; -6.380581641144545e-02   +3.044749893124998e-01   -3.789839762035022e-02   +7.746079671050382e-02   +4.539615407255657e-02   +1.627695616815825e-02   +8.564538968732789e-02   -2.921085980294208e-02   -1.219727418547692e-02   -9.850044460319640e-02   +5.424158661150341e-03   -7.446374421908014e-02   +1.518910914918955e-01   -2.246768710932375e-01   -1.626114164928676e-01   +1.164446066830761e-01; -4.582831451819478e-01   +2.610434129421388e-01   -4.026236108657608e-01   -1.703445288083141e-01   +4.410855573459520e-01   +1.273596161553744e-01   +5.140214090707853e-01   +1.427342616569824e-01   -2.269353915971516e-01   +1.491711102895816e-01   +2.325913797795183e-01   -2.229908122292271e-01   +1.238603711061166e-01   -1.180306990295071e-01   +1.989190577838362e-03   -2.532641188426308e-01; -6.998570230142778e-02   -2.497036638687093e-01   +3.792632309604041e-02   -2.182759247589709e-02   -3.709845613312640e-01   +1.442084763766938e-03   -2.750558624108099e-01   -2.110765205782783e-01   +4.548365240217428e-04   +6.320744218027755e-02   -2.315275934278414e-01   +1.324851758467083e-02   +5.406487283941055e-01   -5.828205508058799e-02   -6.994769536663004e-02   -5.014923807367261e-03; -9.606653004764319e-02   +4.879969261739876e-01   +3.431020437765968e-02   -4.720563637223544e-01   +6.574273232000091e-02   +1.466173241077037e-01   +3.218550579187546e-02   -1.057719950894268e-01   +3.735164304708090e-01   +1.349388255215115e-01   +2.912427630094477e-01   -2.003194543428767e-01   -3.901043369549499e-02   +1.706722748959417e-01   -4.162339110356517e-01   -2.748912497620771e-01; -1.707144720134741e-01   -1.897238085517964e-01   -2.102038290314402e-01   +5.402342783990528e-01   -1.754979540833412e-02   -2.057933791292728e-01   +1.913578073519497e-01   -1.505027185824395e-01   -3.516873326627928e-01   -2.475316230928490e-01   +2.162023202546663e-01   +2.673105862903923e-01   -3.604333414554430e-02   -5.859112890252226e-02   +6.212043941945290e-02   +3.538564272875986e-02; +7.261336605991812e-02   -3.189594936823694e-01   -2.487271582371975e-02   -2.009991746562375e-01   -2.809393049511547e-01   +4.470646971537411e-01   -1.590380152805558e-01   -1.826563351329125e-01   +7.093357909209866e-02   -2.841660238460123e-01   +4.820406414003782e-01   -2.705110438178046e-02   +8.319899423616361e-02   +2.935222912592242e-01   -1.616060234033748e-01   +6.668324329529453e-02; +2.599069722265394e-01   -1.207380068035518e-02   +3.381678354126120e-01   -2.487869866658520e-01   +3.234983083624408e-01   +1.055736538286314e-01   +3.393584145015728e-02   +1.007200477981662e-01   +2.733955745796706e-01   +3.435158550723095e-01   -2.836013592764114e-01   -1.430813920027619e-01   +9.103508700642035e-02   +4.339808863435780e-01   -2.873512292820340e-01   +7.004502295531082e-02; -3.429974851255915e-03   +1.358999009587058e-01   -5.145558995098683e-02   -1.879404878497165e-01   -2.428839588709418e-01   +3.602892583809175e-01   -8.926564044903290e-02   -4.660989868227567e-01   +1.092045638335151e-01   -7.045113614487244e-02   -2.739720448870400e-01   -9.356651800424380e-02   +1.165824537413049e-01   -2.303090362934703e-01   +1.966985059926113e-01   +2.193353421177944e-01; +2.643572629186551e-01   +1.462664782083394e-01   +1.253222702938365e-01   +1.947678952445925e-01   -3.170514429787436e-01   +4.500329531715308e-04   -4.475025723346590e-02   +3.862632093406894e-01   -8.416161843798592e-03   -2.731405778010527e-01   +1.253449638223817e-01   +1.726012736584015e-01   -1.524378498800339e-01   -1.586079278633541e-01   -1.966800321744636e-03   -4.123618807466358e-01; +4.732091101217066e-01   +3.018295921964105e-01   +3.226103948958107e-02   +1.876203258398388e-01   -4.780802924840342e-01   +2.318440564818290e-01   +1.826141339599006e-01   -4.324374152165328e-01   -1.726369508048295e-01   -1.758164278045811e-01   -3.854080474857248e-02   +3.127825053283609e-01   -5.690306228403084e-01   -1.153874412666086e-01   +7.606029789482260e-02   +1.780157559627901e-01];
L1E_L1I_iGABA_netcon = [+7.776593574937846e-02   +1.088685408002548e-01   +1.975615366329027e-01   -1.079784316476095e-01   -3.073988140814730e-01   +1.293349688965308e-01   -4.360459991636393e-01   -5.154876725366807e-02   +2.381127437035093e-01   -2.032544564290621e-02   -1.924189913917413e-01   -1.643255608901676e-01   +5.736744963891438e-02   +2.165891268275200e-01   +3.031074320692142e-01   +1.881506342862954e-01; +5.704905864635541e-02   +3.908272646119702e-01   +1.094754420740248e-01   -1.251612931103754e-01   +1.349974643546628e-02   +6.863358860770383e-02   +3.379876456133074e-01   -1.332031361235263e-01   +8.342984444009863e-02   +4.766542903646768e-01   +2.726013155250032e-01   +1.271720870907659e-01   -3.528597228356355e-01   +3.167664904499119e-02   -4.233719113227582e-01   -1.105433909793822e-01; -2.271106874581059e-02   +2.493469405794065e-01   +1.767508888106544e-01   -2.725308347558528e-01   -1.801089922471738e-01   -5.631549915245168e-02   -9.939835660112700e-02   -4.449513040393686e-01   +2.989174335612651e-01   +1.494898184404531e-01   -1.797652630676252e-01   -9.199070064074269e-02   -2.029439361062682e-02   +6.018568100282107e-02   -1.573753547411968e-02   +2.134843540929612e-01; +2.164675447916792e-01   +3.018666630081944e-01   +2.159268089765829e-01   +5.969796036583824e-02   -8.343893485696451e-02   +1.942745624028472e-01   -3.750887939440128e-01   -2.076820150037500e-01   -1.056517634104155e-01   +2.395944362149718e-01   +9.191517411015880e-02   +3.873360359918014e-02   +2.150871539710445e-01   +8.730871648410417e-02   +4.732708553908457e-01   +2.054130170483480e-01; +8.648572628480945e-03   +1.069218290049878e-02   +1.406404416875825e-01   -3.417026144047516e-01   +7.513251784103279e-02   +1.726641148444652e-01   +3.008108709042273e-01   +1.388930064622015e-01   +7.319577100444970e-02   -5.947869730111811e-02   +1.212209793441443e-01   +2.817836800772019e-01   +3.373526107883808e-02   -1.228875395592202e-01   +4.213339227989006e-01   +9.624344073391605e-03; +5.639842741643262e-01   -6.244651025711645e-02   -2.393528343614520e-01   -4.577926662324534e-01   -4.068572861574959e-01   -2.725622355733454e-01   -9.454020154117668e-02   +2.656383699272914e-02   +1.765556637964520e-01   -2.489083731296574e-02   -1.849896489682685e-01   -3.351918063317821e-01   -3.305908990880042e-01   +5.258407109519573e-01   -7.931731818239454e-02   +1.781833788256597e-01; -3.207959187009413e-02   +2.499995238721397e-02   -9.945684687029159e-02   +9.109047458471176e-02   -3.040262720549668e-01   +2.591240305834145e-01   +2.200841834502506e-01   -4.828825835543156e-02   -2.216144870589481e-01   -2.164690028633865e-02   -1.295081118298219e-01   +2.680385507385419e-01   +5.084856566103119e-02   -1.238084809710346e-01   +1.251473984182351e-01   +3.822283635889132e-02; +1.111338570883744e-01   -2.390098680486649e-02   -4.947032083763884e-01   +8.934230608387360e-02   -9.185322849267746e-03   -1.262564937692982e-01   +1.830525651286802e-01   +2.625868084031036e-01   +2.766425739348434e-02   -1.087281535302782e-01   -1.850057458958175e-02   +4.383490297727310e-02   -7.530282172180659e-02   -2.837508348104220e-01   +3.051821785596427e-01   +1.896473215062122e-01; -2.098267395504760e-01   +3.909329885841860e-02   +2.471908590724246e-01   +4.246226073974035e-01   +1.174933352734083e-01   +1.403850510444518e-03   +4.173898752355755e-01   +2.649418102482394e-01   +1.939362210331256e-01   -4.400229086929239e-02   -2.147802995379444e-01   +5.876533450414113e-02   -2.631687979604140e-01   +5.213122057529285e-01   -8.303353374904004e-02   -7.798849294230632e-02; +3.045246080118678e-01   +4.628256774032539e-02   -2.414178090336924e-01   -1.315527585544327e-01   +1.863970421519116e-02   -4.278312466012353e-03   -2.833330255238318e-01   +1.217304570401398e-01   -2.609135968840319e-01   -4.244879658132853e-01   -1.098092409713970e-02   +7.437127995269673e-02   +1.921909089330059e-01   -3.916767522004089e-01   +6.023401294183230e-02   +1.639276564543361e-01; -2.424729740991288e-02   -1.284329280894574e-01   +2.263631074499292e-01   +4.464459060363096e-02   +3.068954378087210e-01   -1.836954819231986e-01   -7.073950777829699e-02   +8.178085110394928e-02   -8.880180890385239e-02   +2.115126895677711e-01   -5.174559780925708e-03   +2.339075011661720e-01   -9.776374888118558e-02   +1.643084683359851e-01   -2.140421553377344e-01   -9.884542853813091e-02; -5.572938980661900e-02   +3.446913122971578e-01   -1.115261135677505e-01   -2.554963753096700e-01   -5.455850175130301e-01   +3.210035426729938e-01   -4.322932304698779e-01   +1.385041170117199e-01   -1.929189958676468e-01   +3.175081193995480e-01   -1.210067872451311e-01   -2.630483522712002e-03   +3.791394445673270e-01   +1.022267650780675e-01   +3.618947392277614e-01   -3.590706121202018e-02; +1.387649984721082e-01   -3.026857458736504e-02   +2.818162349072003e-01   +2.600765834588523e-01   +4.007415147362887e-01   -2.593773925580371e-02   -1.409710977199439e-01   +1.351703717452736e-01   -2.965363279535712e-01   -3.556851896959946e-01   +1.219133645460657e-01   +9.795522641620322e-02   -1.054285275432095e-01   +1.611081203696752e-02   +3.807803589854464e-01   -2.874717346186475e-01; +3.796375447945952e-01   +2.428808073316483e-01   -1.227023438859743e-01   +1.997844395289522e-01   +1.057220912371021e-01   +1.347223091519822e-01   -3.020923983144470e-01   +1.048930623237066e-01   -8.949130753662157e-02   -3.314070493825523e-01   -2.212722608434908e-01   +1.078853093921325e-01   +9.945023822430615e-02   +2.806695009751839e-01   +9.585774332280586e-02   +2.494171922423846e-01; +1.605393766469515e-01   +5.597023460074818e-02   +3.298086339052743e-01   +2.631516585770575e-01   +1.239860450854424e-01   +2.617356898208839e-02   +4.658566016398190e-02   +8.725039921146575e-02   +1.151102937333419e-01   -2.665480697943108e-01   -9.003125927868368e-02   -2.911444752641772e-01   +1.216993235042618e-01   +3.592119268289152e-01   -6.903010955213629e-02   +7.883239407715856e-02; -4.044138753275704e-01   -1.064848228643198e-02   -2.401501697735156e-01   -2.851177271503882e-01   +2.252611675407922e-01   -2.253346896377963e-01   +3.565038518169770e-01   +9.787252411979386e-02   +1.776792222562518e-01   -2.262428687850279e-01   -1.531329330588333e-01   +4.266296474704269e-01   +3.615251831288138e-01   +3.769357474596553e-02   +3.017481654044169e-01   -8.297632222216099e-03];
L2I_L1I_iGABA_netcon = [-3.857803599019825e-02   -1.554656455583917e-02   +1.353468105146449e-01   -3.702270012044577e-01   -1.383411341393694e-01   +1.333940092002032e-01   +2.872031145773871e-01   +5.054568013212981e-02; -2.329229096496185e-01   -9.514776059084795e-02   +1.271277753105203e-01   +7.646211799741022e-02   -2.138096778434898e-01   -9.450544938395010e-02   -3.361268001415678e-01   +6.733008219676936e-02; -5.637455362332218e-02   +2.375434060403443e-01   -1.560628275320841e-01   -3.218529718885847e-01   +1.817971351524907e-01   +1.497987368284873e-01   +4.541009685514413e-01   -9.986840599221486e-02; -1.200037848029140e-02   -7.268175591177911e-02   -4.465921536098273e-02   -3.337177581246248e-01   -4.384005019941670e-02   -1.847419801638242e-01   -7.245678447394432e-03   -2.475388405374041e-01; -3.384589480969091e-03   +2.891219599696454e-01   -1.166417207012771e-01   -1.241145551989420e-02   +2.082110817215780e-01   -1.597580528308176e-01   +1.969309298315736e-01   -1.564215856383031e-02; +2.454632431057799e-01   +1.860092728622548e-01   -5.278913555372225e-02   +4.556319076033155e-03   +3.806521597986573e-01   -3.442092524130124e-01   -2.474520731785471e-01   -3.698461913461861e-02; +2.239424634285612e-01   +1.631279552545981e-02   -3.809265218698205e-01   -9.734850439734188e-02   +2.264685499149716e-01   +1.959072488050521e-01   -2.510263593977672e-01   -7.113324024498247e-02; +2.603662968183270e-01   +1.509618765808218e-01   +1.674767711256052e-01   +2.356260956991731e-01   -5.100683517546101e-02   +1.864332601203675e-01   -5.985735194161902e-02   +5.627466513327853e-02; -3.914439397322535e-02   +1.622701792547535e-01   +1.748291721941387e-01   +4.436011664462057e-03   +1.395356085406810e-01   +3.257792896451802e-01   -2.457060177391704e-01   +1.416576191230054e-02; +3.853989495128429e-01   -2.025264947528918e-01   -1.840555213308898e-01   +1.418422485329437e-01   -2.128113524399190e-01   -2.781404731965889e-01   -3.060019010336644e-01   -3.723273949251218e-01; +1.744016531090110e-01   -1.584579722504685e-01   +1.639397760000546e-01   -8.936210829565445e-02   -1.882775963784972e-01   +5.977522367090968e-03   -2.207091525202153e-01   -9.722565033933903e-02; +4.931178902660274e-01   +2.112672562285233e-01   -3.655655824895957e-01   +3.149770040900221e-01   +2.800975360204302e-01   +4.307987615396033e-02   -1.075654675682348e-01   -3.470459830828811e-01; -1.669967652316159e-01   -1.961850825663710e-01   -1.161485303057013e-01   -1.018530239307005e-01   +1.717167683505417e-01   +2.970420986279178e-02   -2.215207845167113e-01   +1.827922271682146e-01; -3.614504193364557e-01   +1.003938609156895e-01   -1.257283481793015e-01   +1.592577164752859e-01   +3.101163312487565e-01   +2.760264457783344e-01   -6.542773661148690e-02   +2.415714515903813e-01; -3.911339893456683e-01   +7.595041225379980e-02   -2.711418767998937e-01   -1.380840819641734e-01   -2.209133127469062e-01   -1.625366870353192e-01   +1.302245981376227e-01   +6.827198166451702e-02; -5.062826068686757e-02   -5.107796061376708e-02   +6.307653713450920e-03   +1.312059650031854e-01   +4.195450725968926e-01   +1.161469552503464e-01   -8.534717443869672e-02   -3.592221383671078e-01];
L1I_L2I_iGABA_netcon = [+1.087337232709157e-01   +2.276459842235221e-02   +3.109392527115784e-02   -1.996998369948062e-01   -8.861096816537076e-02   +4.795765136707182e-01   -1.951243174381024e-01   +1.010018991949926e-01   -2.580931932205709e-01   -4.086049459405920e-01   -3.011037461886147e-01   -1.704304451472682e-03   +2.791439282312791e-01   -1.197531780593394e-01   +7.473239736012985e-02   -2.413408434986099e-01; +1.851644789486691e-01   -2.648010457735558e-01   -1.195204299910671e-01   +2.582771315105297e-01   -3.074924468836291e-01   -3.615269041026160e-01   +5.400306685161255e-02   +4.044116539674140e-01   +1.365947157758257e-01   +2.015365594585195e-01   -1.117276405382552e-01   +6.817346272673150e-02   +1.477078948885045e-01   +4.016826341897084e-02   +6.900727202900306e-02   +3.009545723807379e-01; +4.173492457000947e-02   -2.650322579594424e-01   -1.467743848075831e-01   -9.084716143083760e-02   +2.156896224191189e-01   +4.670616711601497e-02   +3.780119178816474e-01   -2.349473050055211e-01   -1.579803449521068e-01   +1.265266781383498e-01   -2.027787979493488e-01   +1.782064337113962e-01   +3.556682088140892e-01   -4.491771930881948e-02   +1.061112538158658e-01   +2.731000201464630e-01; +5.204325303165498e-01   -1.978626361196329e-01   +3.314121055986751e-01   +1.713695558501120e-01   -1.644096313990331e-01   +1.746556697229344e-01   +1.990901386896273e-01   -1.917915848874802e-01   +1.152377148080348e-01   -2.197589670358568e-01   +8.377382040446829e-02   -2.839070738823662e-01   +2.356427905806753e-01   -2.410805731687069e-01   +1.355415287777149e-01   -1.111359952212912e-01; +4.560924494842966e-01   -3.813048021548475e-03   -6.785373529900718e-02   -2.863466067001862e-01   -1.496858100142412e-01   -2.423520364278803e-02   +3.973112861372766e-02   -2.748183984171884e-01   -2.230708910875853e-01   -3.344955885560696e-01   +5.715537545980998e-02   -1.248367275023439e-01   +3.196413577269130e-03   -2.559438040382346e-02   +9.201345190557721e-02   +9.036302953464428e-02; +1.976815481093833e-01   -1.852642391703379e-01   +3.319173740123496e-02   -4.702022496956464e-01   +4.178990987924056e-01   +1.832820243045151e-01   +5.385358537050221e-02   +8.506371030052354e-02   -3.502802463753146e-01   +2.876939930590605e-01   -1.219719580715608e-01   -8.363538268169979e-02   +4.108276225337482e-02   +1.266173271045061e-01   -2.224627000698112e-01   -3.895845023390622e-01; -1.746347425802705e-01   -1.148935110678487e-02   -5.950344380561644e-02   -1.825269761117898e-02   -5.252739981326381e-02   -1.921236351720904e-01   +7.278688273957583e-02   -8.012799839649942e-02   -2.057088455218967e-01   +2.959797368381979e-01   +2.423446068320157e-01   -3.556473913033571e-01   -2.983394818610828e-01   -2.224075930541398e-01   -2.377336427035108e-01   +1.494423427794692e-01; -4.174311648846828e-02   +4.455472362152222e-01   -3.320030482609216e-01   -1.581232165964823e-01   +2.863651496316298e-01   -2.821547694527775e-01   +2.821961935995645e-01   -2.404191738460083e-01   +1.310931949449580e-01   +1.309031958794274e-01   +9.929221205745548e-03   +2.514466477077460e-01   +3.943818385234051e-03   -1.697013304912791e-01   -1.181260514766078e-02   +3.174880298323496e-01];
L2E_L1E_iAMPA_netcon = [+2.775670643392764e-02   +1.496582654388116e-01   -1.824057874549357e-01   -2.009911495454085e-01   +1.980034680613389e-02   +1.884604877698367e-01   -7.438235971344875e-02   -4.575550227807785e-01; -3.517123926609952e-01   +2.467877742182964e-02   +2.819964256975057e-01   -1.270214444656212e-02   +1.929264587634295e-01   -8.101859423020422e-02   -3.389123643079259e-02   -1.637043097979056e-02; +5.904288079257489e-01   -1.973816034300051e-02   -1.901366546159539e-01   -3.801081545814233e-01   -1.159900858874498e-01   -1.924562855994815e-01   -2.129307041924233e-01   +1.520431243208102e-01; -2.795266532173273e-01   +1.376732960656457e-01   +4.347999257428881e-01   +2.627609853417814e-01   -4.131450541031566e-01   -1.880682717280397e-01   +1.712445124302614e-01   +2.417210420864663e-01; -1.537030155968073e-01   +1.068056506897548e-01   -3.770241334380169e-01   +4.888219967295612e-01   +1.452634423028511e-01   -2.321395032359370e-01   +3.983972488594067e-02   +3.225741326866339e-01; +1.680070668239434e-01   -1.055746302964532e-01   -3.240505624379328e-02   +2.517413259706327e-02   -2.438786696365087e-01   -1.123566299469319e-01   -5.184195244747189e-02   -1.513310659456239e-01; -2.140175773884272e-01   -2.435185594558006e-02   -3.158336204260069e-01   -5.939456573923914e-03   +3.576055206460561e-01   +1.200399866933888e-01   +4.631917783191101e-01   -2.050259555499904e-01; -1.680865845966779e-02   +2.037399315908406e-01   -2.879759926344455e-01   -1.757634532594812e-01   -3.740758284079079e-02   -5.551717764672634e-02   -3.328337803495632e-01   -1.330169689720060e-01; +1.943769273943290e-02   +2.171538006896651e-01   -4.316478525733581e-01   +1.423476175086893e-01   +1.274229327785204e-01   +4.050967462474361e-01   +9.492454838954059e-02   -4.160279504684465e-01; +9.099085257256993e-02   +5.361153859069031e-01   +2.162010452318071e-01   +3.260529674446450e-01   +1.336662345462507e-01   -2.112966175570687e-01   -1.685259125512079e-01   -1.802675614264589e-01; -1.295727127905443e-01   -2.403231782353382e-01   +4.790054251370086e-01   +3.690495641484951e-02   -1.993159057505782e-01   -1.846800074488394e-02   -4.907445161113364e-02   +1.539738051638598e-02; -4.311711334124800e-01   -3.948103801188269e-01   +1.434397091051899e-01   -1.593162964485619e-01   -1.045504015991533e-01   -2.081737259232642e-01   -2.272344510449486e-01   +1.504434262663575e-01; -7.199338302714174e-02   +2.889811043398141e-01   +1.424937946473913e-01   +1.199644533282272e-01   +2.565231132698771e-01   -9.427730010311378e-02   +3.852298076463638e-01   -8.075448139549621e-03; -2.343035356445095e-02   +1.967070717365699e-01   +3.197828846836893e-01   -1.132455590269420e-01   -1.733836647743272e-01   +1.360929969203547e-01   +1.023584220175385e-01   +9.920557562311000e-03; +1.665401965350699e-01   +5.498716473571637e-03   -1.779684787965322e-01   +2.149067583611080e-01   +8.842480263788839e-02   +1.483822899552445e-01   -2.361596373155349e-01   +1.791891811310686e-02; +1.579619974485634e-01   -1.979903186899187e-01   +8.973012272137781e-02   +7.805620891549625e-02   -4.077530740686540e-01   +2.544707968184138e-01   +2.151542333131782e-01   +2.715861302526119e-01];
L1E_L2E_iAMPA_netcon = [+1.001432091920261e-01   +2.291735003125358e-01   -7.588701931548743e-02   -9.181344961875948e-03   +5.370121321961969e-02   +4.020005824626049e-01   +1.848667036456678e-01   +8.720560407302486e-02   -1.383329915103586e-01   +1.554931253855467e-01   -1.479280154697435e-02   +6.722231983321515e-02   -1.182866547485714e-01   +1.032773973700941e-01   +7.679510267116414e-02   +1.667547667846392e-01; +3.925855279796383e-02   -3.899752694524730e-01   +2.159178265748917e-01   -3.020207426838517e-02   -9.776975889094186e-02   +2.180710131618670e-01   +9.998760795072685e-02   +2.089648644745075e-01   +4.597599704012078e-01   +3.798663538338991e-02   -3.552806341513320e-02   -6.455639911396555e-02   +3.038865366696473e-01   +1.944947720169991e-01   +2.996189723708007e-03   -3.894201581043058e-02; -2.932680332842674e-01   +2.544870539534709e-01   +4.626546889509663e-01   -6.823013977894826e-02   +2.005881597803624e-01   +1.298135392031824e-01   +1.374703708840294e-01   -1.901828559219597e-01   -1.008068382787219e-03   +1.397077339889935e-01   -1.306242518620699e-01   -2.270140463456902e-01   -1.775719997060402e-01   +2.537271942262182e-03   -2.258262232352521e-01   +1.344531007415927e-01; +1.782821131242598e-02   +3.919195661808711e-02   -1.352755548592416e-01   +7.378392584401081e-02   -1.112112151404247e-01   -3.157675671269291e-01   +1.425349401223636e-02   -3.029005839376103e-01   +9.647246078849081e-02   -1.475420574730384e-01   -3.476262009195058e-01   +3.809291608647518e-01   +1.643745419013761e-01   -3.519800867443700e-02   -1.244359796976618e-01   +4.434112758686429e-02; -3.243180826359100e-01   +2.553726090292666e-02   +5.281846638949219e-01   +3.154479676514001e-01   +3.014405207507148e-01   -2.649887936999976e-01   -2.129406163240285e-01   -1.202760892195722e-01   +3.421768537345548e-01   -2.633490226614307e-02   -2.469882082097903e-01   +7.382620613545529e-02   -9.026150950635758e-02   -4.266593226607063e-01   -2.233137744833833e-01   -1.649340914059035e-01; +2.410005929659380e-01   -1.155639464917959e-01   +1.532992691198837e-01   -1.772061898081802e-01   -3.929950030713028e-01   -2.142578449443235e-01   -1.625557280555672e-01   +1.507175120183802e-01   +1.207346931163426e-01   +3.504773291741086e-01   -3.417440398964881e-02   -4.765204011017862e-02   +1.257994595631425e-01   +2.191059830956243e-03   +2.963452293636415e-01   +8.827739406505747e-04; +8.468030095038777e-03   -2.814816208774631e-01   +1.296359759690036e-02   +2.665537512531593e-01   +3.093398548723029e-01   -1.565445406529562e-01   +3.010471035683739e-02   +2.160668667004527e-01   +3.182562541933703e-01   -1.545312250477847e-02   -9.784224236495659e-02   -4.887322026262242e-03   +1.787979797875560e-02   -2.620344545614331e-01   +6.839558458691553e-03   +3.250110434143151e-01; -9.205910692640165e-02   -7.230172211268111e-02   +2.353008183454780e-01   +1.493271829030805e-01   +1.469051753049193e-01   -4.673926614943670e-01   -4.826861174220879e-01   -2.124635726833290e-02   +1.532927529565822e-01   -2.947974922301222e-02   +2.779823954480966e-01   -1.609112249365410e-01   -2.538369420199132e-01   -8.508979258840418e-02   +1.590886262621540e-01   -1.175911437028676e-01];
L2I_L2E_iAMPA_netcon = [-1.177302933046952e-01   -1.252407851411765e-01   -1.293411062872791e-01   -3.347092920038218e-01   +1.229112928383068e-01   -3.200857128894428e-01   -4.589397461029240e-01   +3.107459653304806e-01; -3.286724626034775e-01   +2.522211437044966e-02   +3.564165514512208e-02   -3.065105628904986e-01   +2.542286156858779e-01   +4.660450657335187e-01   -1.014219839032146e-01   -2.087575622743054e-01; -6.654479997866636e-02   +2.544797375428680e-01   -3.510029805405693e-01   -3.049966151035329e-01   +3.487963146874305e-02   -1.151830936685291e-01   -1.238283605665218e-01   +1.374396694812291e-01; -2.507793861224341e-01   +2.815198176895827e-01   -2.278214741287860e-01   -2.531516718996395e-01   -5.116093855486209e-02   -2.667808598969715e-01   +2.018164801767900e-01   -4.088813110388211e-02; -9.237485233322296e-02   +5.634496576587821e-02   -8.306955314139601e-02   -4.124727780057139e-01   +1.738136419780392e-03   +1.008793202167141e-01   -3.940795178074756e-01   +7.854897981913546e-02; +1.069580863560415e-01   +4.041409370735538e-02   -4.765927327413529e-02   +2.019694114951114e-01   -3.518057416441664e-02   +4.415909886872723e-01   +1.843167099611747e-01   -5.725646048978220e-02; +2.598520367645163e-01   +1.671345782406411e-02   -9.873200335773223e-02   -1.299935948321478e-01   +9.871062044706846e-02   -1.248910819491682e-01   -1.001291415911517e-01   +2.032217497901820e-01; -8.619188384299878e-02   -1.481807363032738e-01   +2.656226630581024e-02   +8.384399848658186e-02   +2.557561117905052e-01   -1.583354460208649e-01   -2.282027962290340e-01   -1.436253452573546e-01];
L2E_L2I_iGABA_netcon = [-9.615790813020975e-02   +3.987733551016228e-01   -3.909182186875668e-01   -4.308390961747290e-02   +2.370864934561216e-02   +4.436792162416356e-01   -2.874097333713657e-01   -1.269327795337341e-01; +1.610756009650172e-01   -5.636289245359000e-03   +1.966620960425207e-01   -2.517585747824355e-01   +9.258294686315768e-02   -2.449642907564890e-01   -3.964930156391910e-02   -2.499113189187024e-01; +7.135667420459013e-03   +3.407549804912349e-01   -4.537749911937297e-02   -6.021667344046264e-02   -1.609719660127665e-02   +1.510453123371577e-01   +2.924812950155700e-01   -6.390744269250861e-02; -8.519358686139900e-03   +2.810823094745325e-02   -3.401478318258244e-01   -2.397600189219412e-01   -6.283811373918861e-02   -3.302468033348041e-01   +1.424327106646882e-01   +3.500204977505857e-01; -3.267505651800539e-01   +4.413933732366765e-01   -1.289883959599372e-02   +2.175571487534241e-01   +2.386605168217055e-01   +2.941807076246127e-01   -5.274811916879783e-02   +7.664916772874214e-02; -1.007408033947791e-01   -1.608021490545832e-01   -1.297150996473353e-01   +3.048573590435603e-01   -1.607091581159633e-01   +1.666650568249211e-01   +7.300882236162709e-03   -5.926041493093115e-02; -1.702035960904119e-01   -2.028299102725462e-01   -2.192553609735075e-01   +9.537242205899983e-02   +9.441791812192049e-02   -2.174089544150573e-01   -1.026221275980657e-01   -1.329323959186595e-01; -3.532811915947192e-01   +2.802204720364968e-01   +5.776779223948346e-02   -4.010745349035558e-01   -1.390048379904032e-02   -1.231794363874115e-01   -1.717184331724192e-01   -3.983531944395954e-01];
L3E_L2E_iAMPA_netcon = [+2.830507257893795e-01   -1.051910571622500e-02   +1.450180250828338e-01   +1.389669148946585e-01   +7.263614894096995e-02   +2.835819886850679e-01   +2.300658502156268e-01   +5.069953799382221e-02   -7.939200165252747e-02   -1.653309223112560e-01   +3.313400038222298e-02   +2.417790459574183e-02; +1.404867710309045e-01   +1.343784482941679e-02   +9.082520602882882e-02   -1.398995483379929e-01   +2.575192749154748e-01   -2.300119735242670e-02   -9.439897027910843e-03   +4.895848353108008e-01   -2.336438664288250e-01   -2.237112560151175e-01   -2.944149477034544e-01   +3.691800529861686e-02; +4.640516306188889e-01   +6.339876278075252e-02   +2.331751001334766e-01   -4.740575278567286e-01   +2.501151099367781e-01   -7.591320398548052e-02   -1.347765172829856e-01   +1.773385665486771e-01   +2.265626490066031e-01   +2.545160408299950e-01   -3.594937148696132e-01   +1.716276140128243e-01; +4.641756780654506e-02   +1.604883047352967e-01   +2.272993007571746e-01   +1.484051368234734e-03   -4.408557821627580e-01   +2.279221176618962e-01   +1.033603585165063e-01   +5.149930359379598e-02   +1.143931271269482e-01   -3.633468681585971e-01   -2.076886379886047e-01   -4.583315907089834e-01; -1.053293630720024e-01   +2.177009371812267e-01   +5.336247690389942e-02   -8.694628049613645e-02   +4.619431799255582e-01   -2.015646833842581e-01   +2.190112695768249e-01   +4.623840267990010e-02   -6.099302662085523e-02   +2.781158851926090e-01   -1.372190464110878e-01   +3.910261401572609e-02; +2.723476135183921e-01   +3.386697605430462e-01   -2.139984601384655e-01   -1.669923679376504e-01   -2.371754426988604e-02   +1.311086315922186e-01   +1.819831996656511e-01   -3.971887604192658e-01   +2.450623289087799e-01   +3.875574286847893e-01   -3.442081365060214e-02   +3.088966616132205e-01; +9.660897754299660e-02   +3.933682756434468e-01   +1.837034766262443e-01   -2.703992984324373e-02   -8.003967777659307e-02   -4.145314105223250e-02   +2.706349810274658e-01   +1.370408667586690e-01   +3.455136872489181e-02   -8.886505678754289e-02   +5.008611970946653e-04   -3.187668347692567e-01; -1.699068501671853e-01   +1.908653619315009e-01   -8.379644809279421e-02   -3.082756590002077e-01   +1.018626723186149e-01   +2.282434822616656e-01   -3.577174338695986e-01   -1.004073127536027e-01   -2.017542238039682e-03   -2.176568080263167e-01   -1.206908954431246e-01   +1.777297707332920e-01];
L3I_L2I_iGABA_netcon = [-2.299059772995681e-01   -2.143537020644957e-01   -2.138596387182374e-01   +8.125553049921766e-02   +1.229811356614046e-01   +4.994587068505544e-01   -3.210560406250718e-02   +8.512394398342357e-02   +4.888119133461432e-01   +2.527056991736064e-02   +9.995425456093511e-02   +5.725887047639960e-02; +1.608877915009620e-01   +1.840383066273549e-01   -9.603546300104687e-02   +3.412872931750457e-02   +9.050951522049674e-02   +3.416592615347587e-02   -2.760239201016655e-01   -1.575989222226016e-01   +3.854746147395512e-01   -1.575303683120904e-01   +2.189882472397599e-01   -5.015219276698346e-01; +7.003032501058799e-02   +2.233816833882494e-01   -8.438500032133436e-02   +1.880871180758519e-01   +1.104557805542547e-01   +1.757840328863893e-01   +3.981335976105850e-01   +1.919922244193059e-01   -2.351593695840640e-02   -7.665778419038746e-03   -4.572946056576608e-01   -2.458516348745918e-01; +1.768212956425544e-01   +4.370633193774924e-01   +1.435721146440262e-01   +9.608269029251869e-02   +4.480917636925039e-01   +8.608535715514584e-02   -2.166161007554805e-01   +1.162839314176051e-01   +1.078818319691474e-01   +1.187992652970192e-01   +1.078490569551102e-01   -1.243989082932473e-01; -2.404199727321215e-01   +2.806373493437066e-02   +2.131747180039336e-01   +5.703547644956525e-02   +4.026003850709992e-02   -2.626633362265569e-02   -3.291707820721090e-02   +8.768066626113356e-02   +2.306330868233241e-01   +2.346283220336742e-01   -2.518662276325800e-03   +1.339294198782172e-01; -2.030137114056206e-01   -2.850131035371818e-01   +1.241526138896399e-01   -4.234685075254754e-02   +1.556709742102699e-01   +5.427872036661513e-02   +1.888830690102429e-01   -3.196337554693753e-02   -1.553058281999156e-01   +4.071203921422953e-02   +2.694912665054660e-02   +1.175353487089551e-01; +3.594100949916152e-01   +3.065062954903021e-01   +3.913877943691869e-01   -2.926192293497701e-01   +1.658159141593770e-02   -1.406122726141938e-01   -6.770230000938282e-02   -1.590602836364735e-01   -1.431187910409477e-01   -8.676672549353938e-02   -1.290956261688329e-01   -2.321457103993532e-01; +1.552743394834301e-01   +2.674499146610149e-01   -2.000597019055782e-01   -2.120268219590829e-01   +3.433231175351711e-02   -5.912624080395594e-02   -2.645428108923374e-01   -4.646247033904111e-02   +3.676273625755208e-02   -1.834079990234317e-01   -1.230357668270871e-01   +2.175504158922617e-01];
L2E_L3E_iAMPA_netcon = [+2.608553170681773e-01   +1.366369163730604e-01   +2.250927479073709e-02   -1.579827326996374e-01   +3.159198009634964e-02   +5.061335485289703e-01   +1.399855832213154e-01   -3.460936380633687e-01; -6.622120774185264e-02   -2.390441971947296e-01   +1.042181716641004e-01   -3.202399885449299e-01   +2.171604719520275e-01   +2.569646141169521e-01   -1.029378272447004e-01   -7.775595752754394e-02; -2.287974395357386e-01   +1.346897534260663e-01   -3.056608794380730e-02   +2.765564202035443e-02   -2.034092348884075e-01   +2.521644470728276e-01   -3.544502124143438e-02   -6.105089163667831e-02; +4.944405144734386e-01   -1.781043076502269e-01   +3.553913456281935e-01   +4.204659672849380e-01   -2.119732197668850e-01   -7.824049943915495e-02   +4.209110640530955e-01   +1.661894717742932e-01; +8.882672528773680e-02   +1.844324180527973e-01   +9.740764067637631e-03   +2.349716685732618e-01   +1.532532430729086e-01   -7.993794985070954e-02   -7.518086798243853e-03   -6.874788349080088e-02; -1.127296791595791e-01   -9.843522975812180e-02   -1.761741136472706e-01   -2.297397343597291e-01   -1.127789382172428e-01   +1.167164109974553e-01   +2.165962330320971e-01   -3.088599993762628e-02; +4.480118379691266e-01   -2.273287534791402e-01   -1.804146268700042e-01   +1.382865265766821e-01   -2.983641493825924e-01   -6.406237213747884e-02   +1.072690402947735e-02   -1.421622717161155e-02; +4.153108479303460e-01   -5.856565962247279e-02   -7.370128859565561e-02   +4.032396577919725e-02   -5.659023447244653e-02   -2.363587051162853e-01   +2.388961633530042e-01   -3.276295180638273e-01; -2.594593027896220e-01   -1.471506691439080e-01   -1.204326966003043e-02   +3.596063426432339e-02   +4.978623522178648e-02   +1.594511794975070e-01   -3.364177589320401e-02   +2.377684313731096e-01; +6.996444986871475e-02   -4.982043563378075e-02   -2.642379238414508e-02   +1.399400074724695e-01   -2.979113797300574e-01   -1.563971247758655e-01   +4.522199677337821e-01   +5.758325294569273e-02; +8.059092177835013e-02   -5.628301950441279e-01   -5.412067902099307e-01   +2.139401413836603e-01   -1.560150490905430e-01   -9.619818275272043e-03   +4.051353465395994e-01   +2.161082335065519e-01; +3.509853149294098e-03   -3.615821068877400e-01   +3.036571982656806e-02   -1.856065560545848e-01   -1.205423686829864e-01   -1.652532715527054e-01   -5.055707829686391e-01   -2.400717494080956e-02];
L2I_L3I_iGABA_netcon = [-2.567467819705508e-01   -4.930530227550085e-03   +1.416886655366215e-01   +9.986221881915736e-02   +3.716467373348142e-01   -4.051184727866581e-01   -1.599704256061795e-01   -3.694437330974059e-01; -3.226726797984024e-01   +2.972727103280765e-01   -1.578587706877316e-01   -8.199410305661403e-02   +6.819942072346021e-02   -1.237736333320594e-02   -4.966444728279867e-02   -1.626218481014674e-01; +4.178336048191305e-01   +1.384059560095634e-01   +2.433713295462435e-02   +9.241699957062349e-02   +9.614433670490155e-02   -2.445095302215395e-01   -1.452320956784997e-01   -1.699690393022396e-01; -4.032039553706082e-02   -3.682819073982562e-01   -3.173032643640167e-02   +1.667369041537349e-01   -4.988326747814296e-01   -3.397246950518274e-01   +1.290320731338604e-01   -2.499352219692952e-01; -2.961486196812145e-01   +1.073848591155562e-01   +2.935439458514907e-01   +1.981974854763500e-01   +1.329178422941504e-01   +9.668702422211925e-02   +8.571552357492851e-03   -1.609300507763205e-01; +4.580507019857800e-03   -1.367650786214302e-01   -2.239674224769877e-01   +8.945262912614570e-02   -2.891703730290689e-01   -2.963504477576791e-02   +2.391197012109247e-01   -7.839573660135293e-02; +1.425505899431592e-01   +5.458998500609785e-02   +9.788518525690945e-02   +2.915430123047742e-03   -8.902032229839729e-02   +2.913982976704215e-01   +3.307910267815092e-02   +2.760164799145591e-01; -1.062579654281701e-01   -1.991976472444059e-01   -4.381921985524503e-02   +5.882938154354748e-02   -1.799257376467558e-01   +9.172787213585411e-02   +5.120980431954941e-01   -3.366456546687034e-02; -6.948119100253466e-02   -1.664890101109285e-01   +4.052374173094296e-01   -2.938088482295967e-01   -3.194037223888990e-01   +2.516846395020716e-01   -7.797058031404105e-02   +4.135885881217177e-02; +4.495719872927129e-01   +2.815432212196854e-01   -1.035413055564608e-01   -2.437811494531119e-01   +3.569968598330421e-01   -1.771421542468242e-02   +1.074435227502363e-01   -3.136196581227444e-01; -7.271314372090727e-02   -1.609991274030046e-02   +3.117502427549104e-02   -1.193581202778669e-01   -5.648562576509544e-01   -1.635506917599852e-01   -6.457104684472886e-04   +1.023534644045766e-01; -9.628229466882572e-02   -6.627516332123308e-03   -1.242272861772673e-01   -2.048245628548959e-02   -1.905419318286247e-01   +5.514318984893440e-02   +2.527799074550011e-01   -9.855357396266788e-02];
L3I_L3E_iAMPA_netcon = [+5.351966985209800e-02   -1.917090379177222e-01   +4.130138478605471e-01   +1.839972961705683e-01   +1.337864933739429e-01   +5.349167274649638e-02   -6.604252464319077e-02   -7.756009555137947e-02   -1.890932904581354e-01   +9.799601870166864e-02   +1.410209684656632e-02   +5.702466069786422e-02; -1.957887559932622e-01   -3.128635550932498e-01   -3.669229070615760e-01   -1.405847766385348e-01   +2.914157751261911e-01   -1.658272557424647e-01   -2.751933005669039e-01   -1.662598152543696e-01   -7.155155799520455e-02   +3.543236576869140e-01   +1.440239682408492e-01   -3.776144823541515e-02; -2.346412263726315e-01   +6.048564142596800e-01   +3.393644204400175e-01   -1.867230112995789e-01   -1.611790706200278e-02   +1.277010824983575e-01   +2.685187600319530e-01   -1.908053424766337e-01   -1.679472122150351e-02   +1.148700894550960e-01   -3.713030669510467e-01   -4.135098576142098e-01; -4.316422649722388e-01   +4.673536551123595e-01   -1.638718514835840e-01   +2.614538989404465e-01   -3.953543519106189e-01   -2.782869929926085e-01   -1.953010655946326e-02   -3.223155630817842e-01   +7.825364085234757e-02   +1.137749068679642e-02   -1.678248600285115e-01   -1.861493447397092e-01; -3.262403849567527e-01   -5.996074874806852e-02   -1.467785743990999e-01   +3.651105334246902e-01   +3.484743915881168e-01   -1.508614895028230e-01   +4.068615240089433e-01   +2.655853424050194e-01   +4.869273191852029e-01   -2.206781885125518e-01   -2.029259737135502e-01   -1.488792687986218e-01; -1.005386845235794e-01   +4.427113356622240e-01   +1.062523728336274e-01   +4.980310353410298e-01   -1.298572071506264e-01   -2.088102634117576e-01   +2.092909047229979e-02   -1.081507320333815e-01   -6.793558806884012e-02   +1.213904716310551e-01   +4.959965774162098e-02   +2.427693923918769e-01; -1.140314711423561e-01   -1.237398498002773e-01   +1.986586395950851e-01   +5.060397823177924e-02   +1.850562876748001e-01   -4.453546632523301e-01   -4.382899614999106e-01   -1.006079586991343e-01   -1.918524250519673e-01   +2.324992442654394e-01   -5.647522235913269e-02   -4.087825368721190e-01; +3.354097474256545e-01   -1.300385070760019e-01   -2.672825828806538e-01   -6.569804656184505e-02   -4.109578867355738e-01   -1.056495784018892e-01   +3.203228940410952e-01   -8.689355327703283e-02   +2.265378785402518e-01   +2.164354789802108e-01   +1.752541325658772e-01   -4.084023279871198e-02; +1.854268708220435e-01   -2.636718364627161e-01   +4.392513638013005e-01   -2.429198402339062e-01   -2.875956501259796e-01   -4.004880540248168e-03   +1.743870417213033e-01   -3.382630523697905e-01   -3.563749010571804e-01   -3.174653605655522e-01   +6.293198720406622e-02   -2.985400214945491e-01; -1.363032522496183e-02   +1.001883497094418e-01   +2.346279055258704e-01   -2.511557375469856e-01   -1.831120504058820e-01   -2.925384761688817e-01   -4.112577499524450e-01   +8.925394890701925e-02   -3.080365873026980e-02   -2.196388521689902e-01   -1.181352205664010e-01   -9.426287819650285e-02; -1.139555352705861e-01   -3.464719160853272e-01   -3.751029689300007e-01   -4.715695514336302e-01   +2.174893549560770e-02   -1.811083420271126e-01   -1.252191730298482e-01   +3.254140879149121e-01   +1.512149174994532e-01   -3.537920972186823e-01   -1.286028115100049e-02   -2.385057940045944e-01; +3.958208062950157e-03   -7.919646751928563e-02   -4.408590988389606e-01   +1.618450696748313e-01   +3.583020586252871e-02   -1.217005715292030e-01   +1.847191940496381e-01   +1.822839831142590e-01   +1.115132148335078e-01   +3.131259877908575e-01   +1.945288676793999e-01   +6.818417024587187e-04];
L3E_L3I_iGABA_netcon = [-4.948188271128962e-01   -2.623987852109332e-01   -1.571179699056990e-02   +5.336701012482603e-02   -3.031622704607022e-01   +1.644648816612237e-01   -1.939220636885530e-02   -1.687660389452289e-01   +2.723539782742879e-02   -3.759136423226334e-02   +8.574442237246052e-02   -3.429210238528043e-01; +3.445749907054152e-02   -1.052458799355433e-01   -2.267408808591804e-02   -3.258270551075025e-01   -1.130375650406871e-01   +4.606839636035609e-02   -2.499470418630178e-02   +2.039352610115625e-01   +9.613374128510863e-02   +2.141880095959224e-01   +2.600753211355847e-02   -7.470003174197290e-02; -5.993070598339392e-02   +2.463873349339873e-01   -2.905361169820207e-01   +1.358096150117651e-02   +1.421300627117004e-01   +3.945857661871020e-01   -2.086846967625582e-01   +2.670776313702983e-01   -3.680897474587881e-01   -2.557573774699317e-01   +1.285260024077180e-01   -3.057641009947453e-01; +1.105734560760805e-01   -2.612831073236813e-01   +2.303235176638341e-01   +2.027887184621018e-01   -3.597487063077925e-01   +7.763965767938540e-02   -2.501295660953553e-01   +2.824657832421397e-01   +9.531398433803107e-02   +1.345626098945444e-01   +3.505415461263746e-01   +1.148155971772102e-01; -1.269231426626652e-01   +2.996827410963677e-01   +4.560825506223328e-01   +1.343652437349765e-01   -1.863159931530169e-01   +3.906429177542758e-01   +5.937023796221912e-01   -1.150789261185393e-01   +8.990002849676673e-02   +1.493018429383014e-02   -1.321284649548838e-01   +1.639919684874010e-01; +1.563018944019195e-03   +7.321482583888454e-02   +9.618696180736989e-02   -8.355760001232870e-02   +6.533227620615210e-02   -1.695231106222344e-01   -4.081563767105158e-02   -2.770897566431698e-01   +1.644187519364620e-02   -1.548737708251464e-01   +6.949702499806645e-02   -6.862465427608422e-02; -5.195239502000901e-01   -1.288809689635834e-01   -9.335125171180017e-02   -2.414701740110373e-01   +1.068339203278251e-01   +1.789291466333937e-02   +7.881982629900025e-02   +1.055831240891175e-03   +3.259152340720890e-01   -1.203280884723826e-01   +2.547489579996836e-02   -2.009713125565588e-01; +1.094253661287040e-01   +1.538692873806065e-01   -4.108239688322493e-01   -1.460722644203029e-01   +7.346414099250409e-02   +3.015952244171212e-02   +1.275815117072837e-01   +3.465311489548092e-02   -9.088116037173606e-02   +1.772688784135483e-01   -4.583306235215064e-02   +1.045753340087521e-01; -2.552160833503490e-01   +3.411462063532572e-03   -5.099823692614747e-03   -2.052327648308292e-01   +1.803664037959313e-01   +1.329386638313686e-01   -3.125809246312899e-01   +2.543633893662247e-01   +8.415771835825878e-02   -6.266933259832480e-02   -2.158227213698224e-04   +1.771510853876899e-01; +1.957023084029741e-01   -1.338467882311025e-01   +5.047085689219577e-03   -4.567440967042744e-01   -3.903340777168252e-04   +7.011216445872528e-02   +1.655117312572188e-01   +5.413507520930584e-02   +1.333829576571177e-01   -9.923815765330218e-03   -1.409130110626367e-01   +3.012301948463965e-01; +2.962120941617087e-01   -3.735361235029500e-01   +2.666581009759713e-01   -2.769842732412823e-01   -5.915568604430259e-02   +6.429648532143722e-02   +3.232826318268130e-01   +9.941823026560576e-02   +1.141987375396920e-01   +8.586262362541114e-02   -1.323867724103140e-01   +2.765333174121445e-01; +1.179717083943475e-01   -2.597473316303512e-01   +1.501958636135445e-01   -1.203098941479370e-01   +2.373170641998318e-01   -1.079038656224796e-02   -9.685850163491869e-02   +2.392199137212989e-01   +2.184411288480373e-01   -1.759954922990972e-02   -3.280459372259081e-01   -2.606909265831842e-01];
L2E_Input1_iAMPA_netcon = [+6.645722048105712e-02   -2.411650163793198e-01   +2.359311851626896e-01   +3.187085179701448e-01   +1.488592502112019e-01   -1.562829496386848e-01   -3.024251179845739e-01   -1.167472354433953e-01];
L2I_Input2_iAMPA_netcon = [-3.674468476643321e-01   -2.956908702077672e-01   +1.781893226046172e-01   -3.132639809025216e-01   +1.715767984866738e-01   +9.314225954564578e-02   -3.038732854917028e-02   +1.474368906690378e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
