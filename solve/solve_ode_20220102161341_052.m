function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.650653447911869e-01   +3.214081643858687e-01   +1.484766261196228e-01   +5.402664054290215e-01   +1.691585825367344e-01   +8.568143841793348e-01   +5.422166640250583e-01   +8.626322178728348e-01   +2.102246952196744e-03   +7.954736503002237e-01   +2.122799100836056e-01   +5.924248969111655e-01   +1.329345896048043e-01   +6.233694543688193e-01   +2.236487776926527e-01   +4.466208122809537e-01; +8.306169294018151e-01   +8.486649237226843e-01   +7.177137994494009e-01   +3.972581098523948e-01   +3.419873231460410e-01   +6.795580080567356e-01   +7.445383660765913e-01   +6.980066149165751e-01   +5.358936020527848e-01   +6.797327755749554e-01   +6.556551940784042e-01   +1.797741438504730e-01   +6.130330817559271e-01   +3.446351317067040e-01   +1.445506411168639e-01   +7.664518493905176e-01; +5.940431573991444e-01   +4.800802344411816e-01   +8.145810564793280e-01   +8.145447927315145e-01   +1.115144552334591e-01   +4.452605452202211e-01   +4.038598869418490e-01   +2.507177626497172e-01   +6.010473276907867e-01   +5.445407705128755e-01   +5.084453775707800e-01   +7.337342338346279e-01   +1.812537803365922e-01   +4.981909546083970e-01   +3.525208129246146e-02   +4.797507476929208e-01; +3.063208909178332e-01   +7.793224330605399e-01   +6.106906261870884e-01   +2.052552679782891e-01   +7.133910362835485e-01   +8.494859040481759e-01   +1.601937248317109e-02   +7.281722986906065e-01   +8.761595587300922e-01   +9.070544410970403e-02   +5.156349248665826e-01   +1.128570653923904e-01   +3.186335294983745e-01   +1.667900874601412e-01   +2.147654257411392e-01   +5.425977690056192e-01; +3.137236615773111e-01   +1.432367608449976e-01   +8.578821000099444e-01   +2.666355239329147e-01   +3.281571192604522e-02   +2.331764601305118e-01   +4.413780834624216e-01   +2.351981553937557e-01   +4.817707210086625e-01   +5.497288945035740e-01   +2.552095736222154e-01   +5.835129604439572e-01   +1.725002807657899e-01   +4.150402844754679e-01   +1.264937777253773e-01   +1.564149020358943e-01; +5.263885817640492e-01   +8.871589469396328e-01   +6.111912971515183e-01   +8.565397670195481e-01   +8.477776640700451e-01   +6.373156089655061e-01   +6.175456912075904e-01   +3.778614073875671e-01   +2.061079532706261e-01   +4.856991757699387e-01   +2.508909269642030e-03   +8.564247254660297e-01   +2.446478360506399e-01   +7.242524747048713e-01   +3.994718136858912e-01   +3.049920181928148e-01; +7.919283780632940e-01   +6.299092578862638e-01   +1.316684801228073e-01   +7.771717952631787e-01   +6.975339007397994e-01   +7.391140873774045e-02   +8.337371223189495e-01   +5.608716795178731e-01   +1.150401637861219e-01   +8.824204710756057e-01   +7.034056421058906e-01   +3.981705597347183e-01   +6.446788284619103e-01   +4.249927169952912e-01   +5.071818693101828e-02   +1.512159268913753e-01; +2.099166841895325e-01   +2.728959578158688e-01   +6.701922338408374e-01   +2.740166792801736e-01   +3.602764832092332e-01   +7.717989302445226e-01   +2.408631779348829e-01   +2.166099077565850e-01   +6.948047066835313e-01   +5.462555041551311e-01   +7.843145688734328e-01   +8.069619396441637e-01   +5.004017877658350e-01   +1.150568824284760e-01   +1.494407938188424e-01   +7.489873445978305e-01; +2.502154360513461e-01   +2.351567151354765e-01   +6.639087863404824e-01   +8.831134470425734e-01   +3.670581415194677e-01   +7.989028685142929e-01   +6.666742227230438e-01   +6.596717866137044e-01   +5.199779877334820e-01   +3.976949370336341e-01   +7.587522587929031e-01   +4.070565065633033e-01   +7.654997895979854e-01   +7.897415632373230e-01   +3.036091770485205e-01   +8.326882590298756e-01; +2.759233043959190e-01   +6.233501827708899e-02   +4.047372932863799e-01   +1.155386143513202e-01   +2.917259685475151e-01   +5.530129774333871e-01   +3.028183688920354e-01   +2.753869692782632e-01   +1.779518164492656e-01   +2.984276670637351e-01   +5.957270878642775e-01   +3.135131259216609e-01   +2.313377739136770e-01   +7.072481636881366e-04   +6.000907147642324e-01   +7.324970436337787e-01; +8.087195832924308e-01   +6.928885260889315e-01   +3.696187226877622e-01   +4.793706520142875e-01   +3.470816313913244e-01   +1.781848311422279e-02   +2.637095628554353e-01   +7.618055431513878e-01   +1.282487920910537e-01   +7.101600429900660e-01   +5.990841459973238e-01   +3.976809915260340e-02   +6.260565999522785e-01   +2.559175551757263e-01   +3.962223910776034e-01   +6.727901785291088e-01; +4.724488116886821e-01   +7.887186653761148e-01   +1.302022135550109e-01   +1.275799851829697e-01   +7.409226041530052e-02   +2.639321939909955e-01   +4.423208151976841e-01   +7.468363384759521e-01   +2.579090382779702e-01   +4.911753364431889e-01   +4.469979626800217e-01   +3.083437894769623e-01   +6.162126253677647e-01   +3.775067249389181e-01   +4.484464484121624e-02   +1.067844367751011e-01; +8.022961379754301e-01   +6.796546495482767e-01   +8.257303233462384e-01   +3.489268433653657e-01   +6.569198482141827e-01   +3.220957570921938e-01   +6.670381362214270e-01   +9.328042622111973e-02   +7.338915256835993e-01   +3.973911434879543e-01   +4.487684888704462e-01   +4.365918412807867e-01   +8.984717029535024e-01   +1.258889592787842e-01   +8.394513894926895e-01   +8.786068366407275e-01; +4.671456151495412e-01   +3.028049481587154e-01   +7.591321857875911e-01   +5.503006677453756e-01   +1.633720099072671e-02   +2.828752386293379e-01   +1.791869006161061e-01   +3.418725432069922e-01   +5.761248673737761e-01   +7.087523471488914e-02   +3.558228687582052e-01   +3.856005269037678e-01   +8.407588034209151e-01   +8.000024856603902e-01   +7.703589253380232e-02   +5.182700304921921e-01; +1.622345482437060e-01   +5.241491484638975e-01   +6.930391461051604e-01   +6.552888991523768e-01   +3.651471960243712e-03   +2.492762590964103e-01   +5.236442005361696e-01   +5.603666671303471e-01   +6.459606672725424e-02   +5.724924907258304e-01   +7.932879812465505e-01   +5.680185515417473e-01   +1.692880633217436e-02   +7.988091848951203e-01   +3.693661112528615e-01   +3.942254646328933e-02; +5.233474979392844e-01   +8.199340965595748e-01   +8.176580837240368e-01   +2.205981877947449e-01   +2.581109567871617e-01   +2.908518979016139e-01   +5.588885898024984e-01   +5.134622391211918e-01   +4.173754541561661e-01   +3.428055470930341e-01   +1.530597435932776e-01   +6.466351304785918e-02   +2.009653904489865e-02   +8.674810071305263e-01   +1.901574167161583e-01   +8.022698519452878e-01];
L1E_L1I_iGABA_netcon = [+3.601468339751743e-01   +2.920137481933474e-02   +3.546682789159293e-01   +1.993149929452194e-01   +7.748662863589219e-01   +2.475943506631863e-01   +7.145602871670506e-01   +8.331039770343409e-01   +4.896733562066270e-01   +6.026368947337032e-01   +7.093742868887292e-01   +3.451537418172196e-01   +4.719965185296028e-01   +5.905514379186093e-01   +1.416031765491596e-01   +7.900238168172100e-01; +6.107002810164233e-01   +6.569809297682717e-01   +2.089342784233538e-01   +2.084499702655195e-01   +6.099074752729702e-01   +2.186155809061115e-01   +2.082332665279584e-01   +3.026898429924767e-01   +4.366027861110187e-01   +8.777932454722254e-01   +1.552033367701318e-02   +5.012664895900190e-01   +6.412934900656773e-02   +2.306540581126485e-01   +5.278885273219873e-01   +1.660461969934185e-01; +6.389570642774112e-02   +3.090161708456068e-01   +7.733280269981847e-01   +3.779030827713711e-01   +3.095706414750742e-01   +8.057851172198159e-01   +2.631768776839771e-01   +2.852861770964912e-01   +7.160438476722742e-01   +8.233399235337870e-01   +1.606987110920546e-01   +3.013248484466417e-03   +8.526631737770202e-01   +3.080161748368777e-01   +3.312073510834512e-01   +6.910749496721756e-01; +8.210237307078312e-02   +7.623357641734601e-01   +1.974445445337032e-01   +2.368650124107423e-01   +1.503995273633175e-02   +1.379731841081860e-01   +6.632210129982922e-01   +5.041300691419280e-01   +4.138021812814980e-01   +2.908052224216964e-01   +1.717747114205621e-01   +1.307375131261593e-02   +1.349381502382316e-01   +2.106686018728389e-01   +1.627279854114388e-01   +8.900926525141408e-01; +1.245991658850466e-01   +2.582791948956510e-01   +5.542778145429275e-01   +5.471625613126586e-01   +6.045592172213881e-01   +6.229121723331690e-01   +7.864293243136160e-01   +6.569533049122362e-01   +6.928008820307514e-01   +2.775206102635285e-01   +8.499921178922432e-02   +2.475778291275879e-01   +8.913205435565333e-01   +6.831579467629754e-01   +4.154627209513710e-01   +5.068970925479499e-01; +8.158179214938611e-01   +7.279526615011628e-01   +1.595602455264858e-01   +8.927766355088100e-02   +6.593421900857588e-01   +6.576627002887397e-01   +5.909336713213106e-01   +1.681983541269217e-01   +1.964292508982061e-01   +8.879289733701583e-01   +8.667340070138655e-01   +4.438535113142770e-01   +3.444916161968645e-01   +7.846246842347464e-01   +2.826434877901335e-01   +5.979927089064669e-01; +4.801219754502879e-01   +5.916618135473400e-02   +8.821515229479678e-01   +7.567864437445183e-01   +7.227848918391288e-01   +3.293465367816226e-01   +4.962492846549618e-01   +8.525444659763542e-02   +7.717658725184838e-01   +2.796636483067855e-01   +8.537906423779607e-01   +5.468787921684714e-01   +5.443501990180418e-01   +7.334954451131732e-01   +2.239227331329489e-01   +5.034546656510979e-01; +5.510727440566865e-01   +7.463401878304281e-01   +2.973218413064688e-01   +2.527360564650857e-01   +5.355489785827462e-02   +8.736658908454252e-01   +2.412950020180412e-01   +6.216558380599341e-01   +5.412471814965452e-01   +1.499177125354213e-01   +8.061718728107795e-01   +8.457569914850518e-01   +5.617757859344436e-01   +5.271880776836453e-01   +5.595264279756888e-02   +3.856598213464610e-01; +4.481314848084651e-02   +4.946371341891493e-01   +1.853817552548804e-01   +4.413090194864104e-01   +9.028218860998929e-02   +3.929365420375688e-02   +9.442179192756044e-02   +2.139239907686494e-01   +5.584740527610995e-01   +4.260106197832415e-01   +2.583739797171965e-02   +8.740890792230767e-01   +6.662868343944234e-01   +2.067615314381109e-01   +5.680272232339163e-01   +3.302618366653786e-01; +8.669115029708088e-02   +7.895733109415053e-01   +6.694834989781595e-01   +8.952320260867861e-01   +1.547851458466687e-01   +3.213827639379595e-01   +8.345574835126733e-01   +6.750420056618281e-01   +7.378233235096268e-01   +8.982405442344072e-01   +8.797590387210318e-01   +1.217983072155927e-01   +1.517132667405320e-01   +7.773659041111999e-01   +1.872497756651958e-01   +6.150009873653330e-01; +6.419595545177872e-02   +2.026215167175049e-01   +4.585228624543902e-01   +7.256116067913977e-01   +6.936713860818471e-01   +5.422945738244677e-01   +5.306787502771982e-01   +4.192169546885916e-01   +5.890539554526408e-01   +8.392025209796776e-02   +3.607301777105203e-02   +3.162405315047392e-01   +7.528429024591062e-01   +7.489299029713476e-01   +7.802941610544097e-01   +7.580424487576968e-01; +1.797886749831251e-01   +4.865883976666803e-01   +3.846773029848634e-01   +4.110919090641543e-01   +1.439330743716487e-01   +8.860593474969664e-01   +4.268805188753332e-01   +4.641189444991582e-01   +2.805565622709962e-01   +2.456413024190299e-01   +3.987676605389517e-01   +5.094308719473620e-02   +7.281801826682799e-01   +5.415954154444628e-01   +3.561185360253300e-01   +1.024248993717565e-01; +4.839307967318227e-01   +3.331621804857975e-01   +1.379247529420271e-01   +1.711856276076850e-01   +6.965256351069533e-01   +6.467430249877566e-01   +2.996971329223787e-01   +5.696488203485075e-01   +7.640280582912826e-01   +3.993189787002637e-01   +2.858508304145306e-01   +5.562991036063115e-01   +5.330761349053951e-01   +6.344593734488044e-01   +4.234101341402999e-01   +8.914116579292731e-01; +5.623897343840119e-01   +8.935019557799030e-02   +5.129802885009067e-01   +7.148773520619104e-01   +8.668556456485520e-01   +1.567366004195974e-01   +5.870380731345867e-01   +4.349846798913319e-02   +2.897523674870909e-01   +2.493275167012095e-01   +6.474790033760954e-01   +8.332053039745113e-01   +2.133405431794655e-01   +1.917930261921779e-01   +5.344010506262529e-01   +1.652882223636818e-01; +4.261169665053004e-01   +7.551970450074006e-01   +5.485552444255146e-01   +7.978029609666278e-01   +2.441240161222401e-01   +5.430391146398442e-02   +5.383354221362722e-01   +4.150671932309311e-01   +8.383380276414699e-02   +4.157045363337576e-02   +3.745307459148973e-01   +6.800031735262245e-01   +7.084347384738717e-01   +4.333629421390059e-01   +8.657025503685111e-03   +3.330559147036077e-01; +9.319484401874609e-02   +1.867259743682391e-01   +7.625997229440290e-01   +5.963726385591498e-01   +4.603636571870289e-01   +2.193351889142459e-01   +8.639022327096485e-01   +6.763200576703895e-01   +6.992330360012895e-01   +4.621803467074903e-01   +7.629562355664066e-01   +7.788178603618046e-02   +6.629327987186134e-01   +4.057051464221712e-01   +7.621878052974741e-01   +3.764302232372248e-01];
L2I_L1I_iGABA_netcon = [+1.258355474449112e-01   +8.533655081580638e-01   +7.482446741808565e-01   +3.001009329910533e-01   +8.364013706180475e-01   +2.015500331134921e-01   +6.540513857425365e-01   +7.924486286287957e-01; +2.138089825917838e-01   +6.261782650504281e-01   +8.145325801183388e-01   +3.824053113337552e-01   +6.663349840110186e-01   +8.736307660037411e-01   +8.533246755602454e-01   +2.877160225078609e-01; +4.878921275838635e-02   +8.198095899861976e-02   +8.375996794921013e-01   +6.420873011357348e-01   +6.372396999814767e-01   +1.543390318688996e-01   +7.444790110755258e-01   +2.790310655980028e-01; +2.231585237245606e-01   +4.456761278557017e-01   +5.435383510485857e-01   +6.768403446348624e-01   +5.595473207035795e-01   +5.252161063059689e-01   +3.227326950844323e-01   +2.647193887273717e-01; +7.468673460895230e-01   +6.355279985786850e-01   +4.306783006270878e-02   +3.333329849780570e-01   +8.572106751098255e-01   +2.436436311909810e-02   +8.989673492783242e-01   +4.970602451219731e-01; +4.861084077583008e-02   +4.166929126465545e-01   +4.168278644509598e-01   +3.627367984896526e-02   +8.531915511647985e-01   +7.096425712249035e-01   +2.472677123413564e-01   +8.446734044075667e-01; +6.548462594522324e-02   +6.988168149651682e-01   +6.691395114229203e-01   +2.557873321560623e-01   +3.841578308931983e-01   +6.076225004869398e-01   +6.416126717375545e-02   +6.994263838535040e-01; +8.674881361409774e-02   +1.844723182507069e-01   +8.154510976547924e-01   +3.517532026565530e-01   +8.717625139680009e-01   +6.482469375109103e-01   +8.986314907946257e-01   +3.519939037183926e-01; +6.345419167827183e-01   +2.855300243029359e-01   +4.535399900494956e-01   +2.954947976154729e-01   +7.901506685403913e-01   +4.355740425561113e-02   +5.427650041015664e-01   +4.141781302028129e-01; +1.321975047835532e-01   +1.633443516621014e-01   +5.797019867954436e-01   +7.824023186601957e-02   +4.730530025854900e-01   +9.080224901104152e-02   +5.167444725031031e-01   +5.975223650608896e-01; +6.720538209337025e-01   +1.931931234830515e-01   +8.880192625444852e-01   +4.178181408925448e-01   +1.697353751906725e-01   +3.787058911267184e-01   +5.960776471372334e-02   +3.421900255949547e-01; +6.599578668038726e-01   +6.477718903572595e-01   +3.647468733831537e-01   +7.246760113736603e-01   +8.106646638757836e-02   +1.383459791613572e-01   +2.057498770460433e-01   +5.124747105499990e-01; +2.785236691557244e-01   +2.776339888160750e-01   +8.364410529346000e-01   +8.063950104384296e-01   +6.875788056918236e-01   +8.071507393216373e-01   +7.103913029804029e-01   +7.284864249331011e-01; +8.437696000088980e-01   +7.953607835219927e-01   +7.204117916476314e-02   +3.245749848224583e-01   +5.510644059518369e-01   +8.707044034019663e-01   +1.354308987047144e-01   +3.832833115403124e-01; +6.322843928851400e-01   +8.991342546494370e-01   -1.679931726306162e-04   +3.996585904511769e-01   +4.439115483095281e-01   +3.120829286908285e-01   +6.313665214979580e-01   +5.183233392022482e-01; +8.301907238074951e-01   +7.651046504062581e-01   +3.363824305660017e-02   +1.777975629961717e-01   +5.671783040544952e-01   +4.430131379113626e-01   +4.316377618670516e-02   +1.595277229617909e-01];
L1I_L2I_iGABA_netcon = [+7.733538265753924e-01   +2.739505063101452e-01   +3.316141753800872e-01   +2.529113333878676e-02   +1.685127440403527e-02   +3.490059528623025e-01   +4.580952305246708e-01   +7.682311139883959e-02   +1.992797471881017e-01   +7.359279985319129e-01   +1.364968905763146e-01   +6.032359660400968e-01   +5.293973263744042e-01   +4.357722061298154e-01   +7.295246204474711e-01   +2.214926553010872e-01; +3.865988957732788e-01   +9.482957013763832e-02   +4.145492047560791e-01   +8.745654745218066e-02   +8.877931843702737e-01   +6.316706097430188e-01   +3.920518213009892e-01   +4.248905427513002e-01   +9.258764623502666e-02   +8.234182859316902e-02   +8.802596697352929e-01   +1.568744417716170e-01   +8.545611018060423e-01   +5.593643998910759e-01   +7.453577347746908e-03   +6.577772270090986e-01; +3.010384066135778e-01   +4.004882905898092e-01   +2.213647164483963e-01   +2.807982657560682e-01   +1.293234523731966e-01   +8.171076072210692e-01   +7.657977599129343e-01   +7.360844091162287e-01   +5.748513328364028e-01   +2.934220372455207e-01   +6.136550138354409e-01   +5.782438497460568e-01   +3.628111520312964e-01   +4.754686287677360e-01   +7.395409177394993e-02   +2.736928525148522e-01; +5.255784866143043e-01   +8.668482261029850e-01   +3.521374507270438e-01   +7.911678545872904e-02   +6.698839973972189e-01   +3.111660858690294e-01   +2.715498982618892e-01   +3.924005252089356e-01   +2.797441945543953e-01   +4.348464647060263e-01   +6.537122495001753e-01   +2.581867669319911e-01   +7.140951632896527e-01   +7.285528170432378e-01   +1.254651050668353e-01   +5.215091508246800e-01; +6.667449601714541e-01   +4.226524323417429e-01   +3.553035426591744e-01   +6.084697140790849e-01   +1.972949920390972e-01   +6.262162456785344e-01   +9.692245046152168e-02   +2.230299808790018e-01   +8.105925246030492e-01   +8.089741064822789e-02   +6.806302090052119e-01   +7.257061953592331e-01   +2.726081127773700e-01   +3.020070166893084e-01   +3.873872289361033e-01   +7.694701617391556e-02; +6.945420545550324e-01   +8.372204375380988e-03   +1.206978578976675e-01   +1.596717116220227e-01   +2.531411501580361e-01   +6.107993665518564e-01   +4.396245953373374e-01   +7.742403614577660e-01   +7.242059665373872e-02   +6.011401327313052e-01   +5.736872784338606e-01   +4.103775396531760e-01   +3.260994572803440e-01   +8.679516892768372e-01   +4.061641260237193e-01   +3.204654581746044e-01; +5.918337480408143e-01   +3.936095572642634e-01   +7.005666093572372e-01   +1.660371260418441e-01   +2.332480181620043e-01   +1.671603961743821e-01   +7.426331133150988e-01   +3.706203612494376e-01   +2.974753276723303e-01   +7.034551711766961e-01   +6.628521429122346e-01   +1.372786397868572e-01   +8.637825841277497e-01   +4.134299010695476e-01   +5.106283238001907e-01   +7.985833580428875e-01; +7.765749977094832e-01   +5.019446295587208e-01   +4.728817504394364e-01   +5.348564411204941e-01   +9.892504396238634e-02   +4.897119697911549e-01   +7.829948725052294e-01   +6.854491382853739e-01   +7.681825851007921e-01   +4.220784909408338e-01   +6.525375999357237e-01   +1.145968870654057e-01   +4.312561721132927e-01   +6.560865174307453e-01   +1.153544909205752e-01   +4.497576442064454e-01];
L2E_L1E_iAMPA_netcon = [+1.736465244751499e-01   +7.422020397781621e-01   +4.471144185529017e-01   +7.707322976796246e-01   +4.553419954227520e-01   +3.732973490510937e-01   +3.508886126644877e-01   +2.039167869360843e-01; +3.762927786849464e-01   +1.162990889557755e-01   +6.984611834556765e-01   +2.750856199463885e-01   +1.166710877546719e-01   +7.314569277101659e-01   +2.338145890107764e-01   +2.371311075481528e-01; +7.166205343737942e-01   +2.243752467057491e-02   +8.279696996251990e-01   +8.747442884387253e-01   +2.830190786418665e-01   +2.960767975343702e-01   +7.414807891923304e-01   +2.951125912721502e-01; +4.032656972033207e-02   +3.337942611634005e-01   +2.863019906537140e-01   +8.398032320130502e-01   +8.297936862106781e-01   +8.516355001411954e-01   +6.235871597456940e-01   +3.817539262130759e-01; +7.299125110899338e-01   +6.810611541122172e-01   +5.035965742285697e-01   +8.921479915129458e-01   +7.095040039402627e-01   +6.692233028019746e-01   +4.039595880959637e-01   +2.655138379100438e-01; +1.785193777911858e-01   +1.698680553068688e-01   +4.148232958216986e-01   +4.210141552423393e-01   +2.614434525375783e-01   +3.758500404443420e-01   +5.355079776067458e-01   +8.824651650051627e-01; +8.941087310683978e-01   +1.320169918674740e-01   +6.132019310847581e-01   +3.708987972108985e-02   +6.511345368987886e-01   +8.116149644038023e-01   +7.227026846084247e-01   +1.117261260083778e-02; +5.046923264515135e-01   +3.198759571886305e-01   +4.305562456125924e-01   +6.929356852046623e-01   +1.006871548137481e-01   +8.029708951425440e-01   +1.452118465008498e-01   +4.896770026841951e-01; +7.936195161801497e-01   +6.009190466063483e-01   +5.236311214830626e-01   +6.037213420168212e-02   +6.123941210297307e-02   +7.584830614386098e-01   +8.415984425110827e-01   +7.315209590401081e-01; +1.702997821060340e-01   +3.450216980512640e-01   +3.051343779756112e-01   +5.425658413921183e-01   +6.938869902065832e-01   +2.600549661168743e-01   +7.546772588302775e-01   +5.021930428420847e-01; +6.935156205507168e-01   +1.242317349853330e-01   +6.939940444506445e-01   +7.930835953621519e-01   +2.119377204727497e-01   +1.495355946059856e-01   +7.174971428947496e-01   +3.529922493248508e-01; +7.211368455769905e-01   +8.105742343978203e-01   +1.028635343243308e-01   +2.925232952942781e-01   +3.034304629711175e-01   +3.477447993574724e-01   +3.174843941288398e-01   +1.301507485250174e-01; +5.422342006317888e-01   +5.780536388517392e-01   +8.322521683557217e-01   +1.505382076535660e-01   +5.095543747966029e-01   +3.154122711807084e-01   +6.444010811461981e-01   +6.767133505257299e-01; +7.427667443102438e-01   +4.862393736360935e-01   +4.250461429871432e-01   +6.418754073040690e-01   +3.308418202843001e-01   +3.863305238316548e-02   +1.292072622124699e-01   +3.651707365886874e-01; +4.564622755100158e-01   +3.242119088881349e-01   +7.755210154407570e-02   +1.292556952428384e-01   +1.300112452670381e-01   +8.729529420911092e-01   +8.515842135602889e-01   +5.821896670499297e-01; +7.564132272829645e-01   +3.697604172486001e-01   +1.228526052507668e-02   +8.699616200924469e-01   +1.316384712736770e-01   +6.272502856797698e-01   +2.894652151091243e-02   +2.061943569362539e-01];
L1E_L2E_iAMPA_netcon = [+3.516372879462482e-01   +8.138303887083999e-01   +3.565161749202574e-01   +8.366692982405863e-01   +5.672144128196811e-01   +7.975415146731609e-01   +1.821844626827164e-01   +3.155172794579626e-01   +7.860908727913915e-02   +8.309842032282823e-01   +4.182382524677370e-01   +5.609302918132468e-01   +8.114554366347443e-01   +6.703294431358544e-01   +8.255121317415876e-01   +4.243315374418767e-01; +1.447797467480737e-01   +2.591646595954286e-01   +4.502206253634891e-01   +4.391969997983154e-01   +1.902254006358803e-01   +8.592293963184057e-01   +4.110654068390553e-02   +1.735570309118380e-01   +7.194653701178524e-01   +7.849130737809614e-01   +6.968269614099534e-02   +4.748795240445219e-02   +7.432902187473565e-01   +7.577921569622542e-01   +5.646172968030188e-01   +2.502758378084555e-01; +2.833928066081167e-01   +2.723133256453086e-01   +9.926299236570453e-02   +3.707590724830179e-02   +4.311979089587833e-02   +6.885661651445674e-01   +7.720792461995152e-01   +3.542423650631907e-01   +1.953895756275824e-02   +8.885427605898683e-01   +4.017612370389086e-01   +5.333709495587862e-01   +5.394875840853508e-01   +8.827277314603339e-01   +3.051411586859706e-01   +4.894265560107191e-01; +4.530633952450464e-01   +2.916721948710757e-01   +6.957488011126597e-01   +6.806111620863294e-01   +1.993569564205886e-01   +2.023689685119891e-01   +6.104011195993619e-01   +4.277632230437798e-01   +6.257724192617913e-03   +4.892443069764391e-01   +6.735174350132243e-01   +7.532336122166176e-01   +1.594530310201178e-01   +7.738574701738296e-01   +5.850996314565526e-01   +3.485640227778639e-03; +3.017102141467893e-01   +1.236389983342970e-02   +2.972506201182023e-01   +7.287030355945753e-02   +3.116294070446499e-01   +2.757088942700408e-02   +6.716077134985363e-02   +3.613483707992205e-01   +3.541655655491327e-01   +8.395658653160369e-01   +1.815755879046459e-01   +3.940533405255178e-01   +7.402238975830256e-01   +2.448369646336898e-01   +5.393478877224090e-01   +5.982658159772498e-01; +2.632607832354820e-01   +6.521306793720989e-01   +4.986112746319253e-01   +3.018643363726247e-01   +4.394493167568692e-01   +1.226734469915770e-01   +6.938704480391160e-01   +2.618520889225794e-01   +4.271352856081224e-02   +6.190917863592092e-02   +3.480704355234178e-02   +8.648745653318944e-01   +4.540965839378817e-01   +1.481388470863133e-01   +3.525787585750459e-01   +7.303808872273353e-01; +2.207534646077046e-01   +3.280468165527481e-01   +6.077102638547601e-01   +5.078533592261902e-01   +5.856950570464616e-01   +6.761625767317883e-01   +3.339428640437572e-01   +3.200835229930046e-02   +2.592777067721337e-02   +8.820065916776185e-02   +4.429423395072165e-01   +7.319906557288363e-01   +8.225394218297330e-02   +8.774491457597042e-01   +4.039555963661260e-01   +2.777804426395765e-01; +2.557147423821834e-01   +1.364472810513294e-01   +3.279585896719688e-01   +2.974474295259838e-01   +4.976027560320345e-01   +2.056379793216754e-01   +3.677271487673344e-01   +6.434113109852822e-02   +3.791777735259926e-01   +1.449372931725355e-01   +7.733300971888732e-01   +8.300871716433120e-01   +2.603820351261525e-01   +4.210079762771964e-02   +1.234483919720453e-01   +4.272170797467099e-01];
L2I_L2E_iAMPA_netcon = [+1.187895331996425e-01   +2.001543810872473e-03   +4.449821417687071e-01   +4.701758336794356e-01   +4.734086050811265e-01   +4.469420848664566e-01   +1.005420949450540e-01   +5.459725647478942e-01; +5.407970951837469e-01   +1.400393402750238e-01   +8.991089439182429e-01   +2.147185947452696e-01   +6.878993993069771e-01   +3.462561840727763e-01   +7.805818037792791e-01   +1.290536638869455e-01; +6.890431278357946e-01   +1.555608232257914e-01   +7.915728975300630e-01   +8.566735898855161e-02   +7.167247132964164e-01   +7.688398241761167e-01   +8.585882694020102e-01   +8.524845145129124e-01; +2.135082501836455e-02   +5.188539545625666e-01   +1.194868030728231e-01   +4.945643463822315e-01   +1.016925883263682e-01   +7.798248047417367e-02   +5.960392618026259e-01   +1.973193769215867e-01; +8.881696665605749e-01   +5.069472890001326e-01   +1.858335552208218e-01   +5.251697374900205e-01   +1.402479420548916e-01   +4.261355049204779e-02   +3.361755592037993e-01   +3.879733853977523e-01; +3.982201488019361e-01   +8.973659866566585e-01   +2.938398461962215e-02   +8.021783577991114e-01   +4.738415889422800e-01   +1.565691368823272e-01   +6.606928531846136e-01   +2.162191072249120e-01; +4.130326632677885e-01   +4.658806979984360e-01   +2.056808652240277e-02   +3.387362151089963e-01   +4.413369899415038e-01   +8.208695823761418e-02   +1.636123344312082e-01   +4.727294798787755e-01; +8.061585132959557e-01   +4.775930329187770e-01   +8.156007400340558e-01   +7.138998330091778e-01   +4.566615790406831e-01   +7.822984939427843e-01   +3.215059375542444e-01   +8.630068335097606e-01];
L2E_L2I_iGABA_netcon = [+4.679741457578436e-01   +1.303926346434354e-01   +7.963493660896535e-01   +7.642480286251113e-01   +1.588997820691052e-01   +7.382773895336706e-01   +4.798620467601669e-01   +7.252299354445001e-01; +4.969953856403554e-02   +6.079662998310257e-01   +3.669415100138423e-01   +7.829475375251768e-01   +8.855207238904361e-01   +6.311033264840621e-01   +1.245274605387522e-01   +4.397854188589731e-01; +8.758743019719419e-01   +2.335940648061876e-01   +3.113734644081716e-01   +8.380625872623230e-02   +2.815530034481418e-01   +7.759467459355802e-01   +5.516938833601297e-01   +3.076649922104540e-01; +2.380679754809154e-01   +4.497180285799483e-02   +6.248081677772128e-01   +5.687443446248712e-01   +4.615824100181946e-01   +3.415993438170342e-01   +6.088004622558389e-01   +2.555514585976396e-01; +8.399699582023166e-01   +1.230764601846916e-01   +2.601794277482651e-01   +4.247896094173342e-01   +8.784849638990666e-01   +1.032164739912059e-01   +2.971140515105621e-01   +2.894245085639066e-01; +5.338105470268690e-01   +7.935688744154792e-01   +7.146564803691371e-01   +1.014845052721562e-01   +7.552495274648396e-01   +7.093230271041835e-01   +7.495941393185585e-01   +5.932376313809953e-01; +4.614302002091247e-01   +2.041791654518562e-01   +7.181425381067934e-01   +7.992623451826225e-01   +7.637186367875528e-01   +1.708876975936014e-01   +5.755474318343398e-01   +4.302291957972482e-01; +7.466831420193040e-01   +4.952705245289908e-01   +7.055822187074051e-01   +7.496724538301622e-01   +7.636987943210978e-01   +4.658659891800400e-01   +3.976451446401648e-01   +7.661183524554599e-02];
L3E_L2E_iAMPA_netcon = [+7.575313524631160e-01   +6.038687638854561e-01   +7.219275092892212e-02   +1.445417923372737e-02   +4.282160645413714e-01   +5.254538501352752e-01   +3.235598921549709e-02   +2.374466113909426e-01   +7.637256632848684e-02   +3.743185319302073e-01   +8.281217227390944e-02   +1.549701891904978e-01; +1.305434589696088e-01   +2.948562305951734e-01   +4.390814520099762e-02   +3.730339301724894e-01   +5.855186408999259e-01   +6.570220326481885e-01   +3.731135873430151e-01   +2.809809041221846e-01   +8.186617674492098e-01   +5.275100473311601e-01   +6.673355102400202e-02   +4.664053952348197e-01; +1.965656450971175e-01   +7.797760752154719e-01   +5.300181161128559e-02   +3.868452817547168e-01   +8.729324223737452e-01   +4.876612296409514e-01   +1.911794847070396e-01   +5.593797119251680e-01   +8.410096340850305e-01   +5.195951297335962e-01   +2.674263327112913e-01   +8.384350494405567e-01; +3.008878846371877e-01   +1.871325579015337e-01   +6.418826555188744e-01   +5.681450401598122e-01   +7.662797597597011e-01   +2.188235484639588e-03   +7.972944115963758e-01   +1.147705763907781e-01   +1.904160842701543e-01   +4.668244769919759e-01   +4.492156460396455e-01   +2.946364781720480e-01; +9.453127418451657e-02   +7.402617582118507e-01   +6.598148462645496e-01   +8.530279635067954e-01   +6.897709342929195e-01   +1.317356511815620e-01   +3.477489667797860e-01   +7.098584957924906e-02   +2.561703550400344e-01   +3.762309067065850e-01   +2.072119851971362e-01   +3.171047362159794e-01; +3.312880446493425e-01   +1.241761872333196e-01   +2.275875116355049e-02   +6.806655643128265e-01   +8.635051143539356e-01   +7.893183815594242e-01   +7.134596530796574e-01   +8.816144305046367e-01   +2.453673013552074e-01   +8.781423235253554e-01   +6.980150650674514e-01   +8.130110300484292e-01; +5.825700141027237e-01   +5.918771698624039e-01   +1.059045811873994e-01   +7.211055803897327e-01   +3.388512847203191e-01   +3.944559895810451e-01   +8.987539302404046e-01   +2.315619375214183e-01   +3.811220122453601e-01   +6.673009728860173e-01   +1.871823424030868e-01   +4.122843971361647e-02; +1.394160960505487e-01   +7.268519851777132e-01   +1.104067783805672e-01   +1.290829866673733e-01   +6.507954259446443e-01   +7.257670619399347e-01   +3.271917527196268e-01   +4.500639561738348e-01   +6.633018178698366e-01   +5.199147750726738e-01   +8.274418900840129e-01   +7.723764370600552e-01];
L3I_L2I_iGABA_netcon = [+8.065300403176185e-01   +5.457217105265476e-01   +5.851439027875526e-01   +2.827461288759616e-02   +7.490865570859446e-01   +3.007845225024102e-01   +3.104214004865401e-01   +5.890454947957150e-01   +2.094528152530102e-01   +7.959980660775501e-01   +7.177256096137711e-01   +5.994332573111163e-01; +8.185860090780623e-01   +6.428286037796868e-01   +7.111208532799741e-01   +7.821685630250945e-03   +2.211466812418817e-01   +1.468806362226420e-01   +2.954862386529669e-01   +3.193987607199899e-01   +4.679433713430264e-01   +7.455394802881448e-01   +6.260089207098838e-01   +8.941920185757737e-01; +6.618645662840410e-01   +1.842150274785322e-01   +5.341463517179348e-01   +6.073874679220966e-02   +7.452685032428453e-01   +6.575929841880279e-01   +1.771033037098502e-02   +3.131110828064947e-02   +6.126212241071106e-01   +7.306744609389191e-01   +2.418909585686458e-01   +8.872753236250799e-01; +6.672800057218014e-01   +2.483583296199214e-01   +8.438506810763918e-01   +7.445902987154560e-01   +2.922548549500052e-01   +8.228204762475272e-01   +2.293030180174317e-01   +1.071936631365473e-01   +3.311475652937913e-01   +8.704670195773628e-01   +6.282812814496060e-01   +5.347689836336708e-01; +7.168352555490590e-02   +1.334427771007630e-02   +2.305551380940664e-01   +4.583249039336423e-01   +8.834704505852857e-01   +8.594054377550888e-01   +7.721544036225121e-01   +7.571967479846899e-01   +5.862750089867292e-01   +1.201040944119437e-01   +2.359603759822158e-03   +2.491261237194380e-01; +1.867227564504828e-01   +6.677891401329824e-01   +7.152374088816056e-01   +1.423620959943485e-02   +4.958175159112113e-01   +6.701999637860049e-01   +5.776853442820473e-01   +6.574533529366402e-01   +8.461302368702953e-01   +1.764181687143192e-01   +4.935757950170916e-01   +3.071796979890684e-01; +8.587658068492942e-01   +5.150301066072227e-01   +7.909767836251551e-01   +5.264163243808915e-01   +3.520109078818466e-03   +4.218456040663552e-01   +2.709741693485022e-01   +4.885124082602051e-01   +3.614528519726103e-01   +3.552959369343046e-01   +2.933043687727590e-01   +4.889252577451593e-01; +5.831497438783887e-01   +2.973365013895216e-01   +6.720814419047912e-01   +8.371099883175381e-01   +4.571038942954389e-01   +6.308514505364764e-01   +4.863274788711616e-01   +6.296962430558468e-01   +6.557341132286411e-01   +1.148829392337825e-01   +2.096856521865060e-01   +7.477802425207374e-01];
L2E_L3E_iAMPA_netcon = [+4.114502852909798e-01   +8.253074764655743e-01   +2.179396411345741e-01   +8.715558423884431e-01   +7.016781817047095e-01   +3.777327310704989e-01   +2.436899761749941e-01   +8.433406253471894e-03; +1.884694000738774e-02   +4.898222201941011e-01   +7.026510581024960e-01   +7.303814905795210e-01   +1.673103937488921e-01   +1.040537359234910e-02   +6.833909723666299e-01   +1.173465987717620e-01; +6.980622351522073e-02   +3.413090762530644e-01   +8.779951007738966e-01   +6.971241918110649e-02   +8.599691429742721e-01   +4.751814997099438e-01   +1.469167507242423e-01   +7.461476191953180e-01; +2.859132918633379e-01   +5.108750803183698e-01   +6.794444545597023e-01   +3.423876484349284e-01   +3.434156142877461e-01   +1.787194603500989e-02   +2.061219716549926e-01   +6.610807834238039e-01; +5.306952697777227e-01   +7.167143057943083e-01   +8.626289481737694e-01   +4.004720692610070e-01   +7.976383697634760e-01   +8.505806673455093e-01   +3.245581161871998e-01   +5.494325793916548e-02; +8.417214287738617e-01   +8.338124189718713e-01   +3.760637973972659e-01   +6.654392193685550e-01   +2.127141180852010e-01   +2.797656279211802e-01   +5.402191566343270e-01   +2.641394300795872e-01; +2.096351514731627e-01   +3.152124971428997e-01   +1.317046997417057e-01   +5.306591799548395e-01   +6.212355910405526e-01   +6.895187455778304e-01   +6.811576009514109e-02   +6.720269976237738e-01; +3.184585551402326e-01   +8.158798009437679e-01   +1.333596279287209e-02   +8.274416310625898e-02   +2.825359944690584e-01   +1.395890550354605e-02   +2.010722461078233e-01   +4.247387199845136e-01; +7.633296004194502e-01   +7.509701368279230e-01   +4.745260129259780e-01   +6.861411662372038e-01   +3.186837685039995e-01   +4.289419058561218e-01   +6.759260233203463e-01   +3.346547835844674e-01; +6.041168347368644e-01   +4.121663999783389e-01   +4.598205276432407e-01   +6.394603261407599e-01   +5.879752996807391e-01   +7.765901487825715e-01   +7.031844879976370e-01   +5.291252147423476e-01; +4.122704535356964e-01   +1.419836139908209e-01   +5.138638506931529e-01   +3.699048745448230e-01   +8.133491740180561e-02   +3.864167681242989e-01   +8.948602264952478e-01   +6.874077913884127e-01; +3.582969019737546e-01   +4.356122353354416e-01   +1.492548339046418e-01   +3.691603091741418e-01   +6.519101411800984e-01   +2.780901922365162e-01   +5.413266450457955e-01   +1.205268986722926e-01];
L2I_L3I_iGABA_netcon = [+4.383054298434712e-01   +7.076301648111074e-01   +8.309719997118561e-01   +8.614128586055730e-01   +6.401934446946406e-01   +3.173925161525674e-01   +7.645375180961429e-01   +1.411292978648053e-01; +8.357587956374121e-01   +2.861810148768382e-01   +4.466297088979562e-02   +5.271049010618638e-01   +7.884235099043746e-01   +1.152020144230287e-01   +5.382315055580215e-02   +2.504137988850296e-01; +1.329202333029339e-01   +6.729672232812145e-01   +2.402851755926930e-01   +7.194954464225045e-01   +5.996485564327040e-01   +1.239727030129647e-03   +2.235069835610981e-01   +7.096588274278299e-01; +5.897115811063427e-01   +1.771010199014972e-01   +3.308632663283476e-01   +5.965148008715941e-01   +3.820831563822041e-01   +6.494508245985745e-01   +7.480781205335446e-01   +1.817894013738359e-01; +7.029814360514691e-01   +7.974076523642281e-01   +2.705774740321177e-01   +4.336210724453899e-01   +1.512915092284991e-01   +4.365346645751733e-02   +2.098792176635028e-01   +8.333704176104431e-01; +7.866178329257258e-01   +8.394088105451152e-01   +4.757883994094534e-01   +5.853245934696132e-01   +2.728287237603432e-01   +1.786214322846510e-01   +1.073374383833858e-01   +3.730834940991646e-01; +6.602969895291049e-01   +3.568103171163118e-02   +6.281766638340731e-01   +4.791705012225453e-01   +2.150539628581189e-01   +7.021383225124820e-01   +7.358202700486483e-01   +6.365991483862617e-01; +3.543482619123450e-01   +6.033861426165197e-01   +7.529111466517875e-01   +7.416385418697800e-01   +9.280032481779502e-02   +2.277055300105884e-01   +5.174818101406075e-01   +3.206485953778030e-01; +8.283896491486069e-01   +1.473518595909192e-01   +7.379508174630861e-01   +4.346494995324784e-01   +8.674869329413012e-01   +5.507885473324143e-01   +9.857981246288201e-02   +6.558830533988129e-01; +2.438480398356230e-01   +7.924778610298448e-02   +4.790286560326301e-01   +7.679225956282437e-01   +2.622629254880469e-01   +2.227678997886398e-01   +5.593648021129894e-01   +7.730366518104628e-01; +5.913714204059991e-01   +8.429946469556675e-01   +8.189695856406166e-01   +4.919125666228516e-01   +5.433258324876139e-01   +6.502278142098409e-01   +9.101095512705693e-02   +5.690290803280885e-01; +5.069101909846269e-01   +2.887338428428021e-01   +3.199968795168537e-01   +7.438962968324242e-01   +8.246002829651776e-01   +4.988770170701123e-01   +8.670712756522846e-01   +7.448432561880191e-01];
L3I_L3E_iAMPA_netcon = [+7.618770410628065e-02   +1.414009719205494e-01   +5.399668410464952e-01   +6.909572229663787e-01   +8.483786586326689e-02   +1.940952283827151e-01   +8.069897909113237e-01   +1.322579357206766e-01   +7.450152346394906e-01   +8.157132713139890e-01   +8.736381273601219e-01   +4.024378000797803e-01; +7.821028385211635e-01   +7.315444303551899e-01   +4.786184776317156e-01   +6.939450569951303e-01   +7.773870838112399e-01   +8.346566491093799e-01   +6.416375076682282e-01   +5.341584512495183e-01   +2.919332949899726e-01   +2.794918416319621e-01   +4.419635074816870e-01   +4.714933899697020e-01; +3.185047811569228e-01   +1.676845201419958e-01   +2.883685227404827e-01   +6.522829201372279e-01   +4.736456262515953e-01   +6.834062198607842e-01   +6.054522628100523e-01   +7.453382016449329e-01   +5.404408310689895e-01   +6.641288464910536e-01   +6.107691492019325e-01   +4.511653753452098e-01; +6.725226425929375e-01   +6.680506259697440e-01   +7.668704015352359e-01   +7.449766978699559e-01   +3.494774972655837e-02   +1.115392744116802e-01   +5.263588016999440e-01   +6.530970839113456e-01   +1.803977657357175e-01   +8.008393758754949e-01   +8.019119070261009e-01   +1.064471626330554e-01; +2.406878576248846e-01   +3.203202934601487e-01   +6.972880817665456e-02   +3.407562054520319e-01   +1.599162543701831e-01   +8.244071288825666e-01   +7.484939006921651e-01   +1.133325754450304e-01   +4.708410344606989e-01   +8.929198206062834e-01   +8.380501555022444e-01   +8.611475982784043e-01; +7.955331099645115e-01   +7.859531568935662e-01   +2.085010951822115e-01   +4.156849303501691e-01   +8.149921654385028e-01   +5.800351059539567e-01   +7.297165441796509e-01   +6.191613900009506e-01   +4.166987535497644e-01   +5.681767956549765e-01   +2.208980319452676e-01   +1.394661790659788e-01; +1.902406056286975e-02   +2.459822645272397e-01   +6.369829530289226e-01   +1.128932989201847e-01   +5.971493783774910e-01   +4.329685653244388e-01   +1.291266751397487e-01   +3.045896532579159e-01   +6.805223369789862e-01   +1.467985746060284e-01   +1.191443636711771e-01   +8.586786498568683e-01; +8.781145210453967e-01   +6.104614678910336e-01   +3.682931622842900e-01   +6.478600210239548e-01   +3.420620183183307e-01   +3.365909124828397e-01   +4.701364009769644e-01   +2.335059316637082e-01   +6.599395141816830e-01   +6.358685208981107e-02   +8.248515566307275e-01   +4.669184965309068e-01; +2.556642207211487e-01   +7.680700666503874e-01   +3.275941813666819e-01   +7.097722844307625e-01   +6.336651686784017e-01   +3.215741158516351e-01   +2.981342874675064e-01   +8.662478248368891e-01   +7.300718030382604e-01   +5.274891804120182e-01   +7.231934408602773e-01   +5.667755962503394e-01; +4.137807243982242e-01   +2.221863986711853e-03   +5.605311173109878e-01   +4.536985147236099e-02   +2.552126459971448e-01   +7.731463084670541e-01   +1.428706257822645e-01   +4.708458064059112e-01   +7.766670917289723e-01   +8.925986282061174e-01   +2.238277488619798e-01   +8.057870052601657e-01; +9.891974315349887e-02   +7.439112997980223e-01   +2.011925276352266e-01   +4.295084383017483e-01   +3.534954121054257e-01   +6.351316425239764e-01   +8.535752719330095e-01   +7.276168772518818e-01   +4.482627314359155e-01   +2.788685526382523e-01   +3.066511777445964e-01   +5.180964427201218e-01; +2.920316277277121e-01   +5.069404957174211e-01   +2.378273784578680e-01   +1.404805040782512e-01   +5.007851249620129e-01   +2.730116108510089e-01   +4.839865253784026e-01   +6.120305721711912e-02   +3.619139327838355e-02   +5.806912961807930e-01   +3.569866083564480e-01   +4.821268835827738e-01];
L3E_L3I_iGABA_netcon = [+6.119342356653876e-01   +6.370313018769536e-01   +6.877906827225930e-01   +2.036288524212025e-02   +2.518651360905105e-01   +5.343592589954107e-04   +3.602179215035203e-01   +3.326364572901026e-01   +6.933474354209430e-01   +1.444586140696511e-01   +3.631527557847428e-01   +7.573034017243387e-02; +1.583096491630148e-01   +8.874269240989884e-01   +3.363457310739113e-01   +5.098835123565931e-01   +2.471550981303670e-01   +5.155574770834207e-01   +8.428281574726852e-01   +9.262966488310141e-02   +5.703774370926307e-01   +1.144949697566584e-01   +1.041053154390436e-01   +4.595164301423316e-01; +3.164212716830394e-01   +7.698548671528888e-01   +4.099983003283820e-01   +8.503847020552767e-02   +9.229466098009036e-02   +6.722260388064285e-01   +4.022420367047937e-01   +2.389865655709183e-01   +6.088627730248348e-01   +1.349306931332995e-01   +8.227011373209125e-01   +6.457483905802374e-01; +3.363459317876638e-01   +7.764104017155162e-01   +5.884521313568032e-01   +7.973242462398614e-01   +4.096283546403812e-01   +5.926123131891569e-01   +8.098058223955056e-01   +9.347033135299833e-02   +6.756384203669719e-01   +4.948116601011627e-01   +7.265057010154264e-01   +2.260571545758909e-02; +7.326375377970098e-01   +7.177483530623427e-01   +3.307457289257706e-01   +3.404115682679718e-01   +1.636938934415693e-01   +4.642257501888898e-01   +7.453851746951590e-01   +4.114442657234468e-01   +5.235405282722885e-01   +4.046670496604550e-01   +6.311552190191616e-01   +5.756251111253889e-03; +4.981223526592771e-01   +5.351724328905954e-01   +1.080021477237422e-01   +6.255832035360183e-02   +3.988514326970046e-01   +1.115518272828347e-01   +6.781087591028896e-01   +1.968712314220218e-01   +8.685292054026147e-01   +1.047192335328646e-01   +6.147174511005293e-01   +1.078702199213243e-01; +4.724986543144979e-01   +4.838763364506343e-01   +1.266947261426388e-01   +5.396271069375144e-01   +5.268418006704181e-01   +8.193458459324962e-01   +8.024023459754163e-01   +6.585410826975246e-01   +4.271543700906273e-01   +6.031324202599634e-01   +8.291284501977955e-01   +1.348884514210515e-01; +8.348992880042687e-01   +3.354633537798670e-01   +4.339177397389752e-01   +6.439544594375222e-01   +1.379737906521719e-01   +2.852603766548191e-01   +3.109662587173923e-01   +3.138283187167339e-01   +3.322402517441130e-01   +3.559073723037002e-01   +3.304956269311916e-01   +8.592097234098911e-01; +6.512910273026462e-02   +4.065540730720538e-01   +8.255382213681954e-01   +3.080321527984057e-01   +3.868083990661002e-01   +7.737867841184644e-01   +7.800884219412620e-01   +9.869638701221196e-02   +8.203457534789306e-01   +4.859211390485206e-01   +4.512578636731029e-01   +6.299216404252248e-01; +2.053468706814137e-01   +5.014783166008391e-01   +1.047821895615175e-01   +8.619175026697414e-01   +6.469909212563348e-01   +3.456019859852305e-01   +3.756416234387807e-01   +5.229473294830803e-01   +6.943762280115624e-01   +8.163183662944549e-01   +7.108542974934171e-01   +2.681815730784292e-02; +2.137852248251343e-01   +8.128994835255120e-01   +5.377271714633960e-02   +5.010972414479656e-01   +8.338530953029244e-01   +3.341670024954549e-01   +3.272488558832982e-01   +1.489773301003951e-01   +7.539601038858603e-01   +6.185523296592068e-01   +2.419373048826775e-02   +7.108076229110593e-01; +4.104120399930639e-01   +1.370748535792134e-01   +7.770099602646217e-01   +2.645502437840550e-04   +6.719941342068212e-01   +8.046594601431180e-01   +1.829896365677224e-01   +3.667428140482840e-01   +6.909394069366359e-01   +3.448287862141609e-01   +2.973458361878499e-02   +2.395997792391988e-01];
L2E_Input1_iAMPA_netcon = [+6.253665293502401e-02   +1.177348114312390e-01   +8.089519479444226e-01   +3.090309124015935e-01   +1.057303213693605e-01   +3.891831165907568e-01   +2.990689681729921e-01   +1.518067790145072e-01];
L2I_Input2_iAMPA_netcon = [+2.126922313799524e-01   +3.877578283244965e-01   +2.654568613993573e-01   +3.657740604778179e-01   +4.771877092621173e-01   +4.907164879834348e-01   +1.876124975609867e-01   +8.084019055961702e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
