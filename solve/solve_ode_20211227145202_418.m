function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.032102265856317e-02   +2.573966999064701e-02   +5.724223638322364e-03   +6.677447244490403e-03   -3.865891876686869e-02   +3.098358516041556e-02   -1.487980988047174e-02   -4.796288617529784e-03   +5.328836096520029e-02   +2.165712359676149e-02   +1.062224616081554e-02   +4.720741286983685e-02   +6.716325875082146e-02   -2.411628037428740e-02   -2.298464466076995e-02   -2.044768216384303e-02; -2.950209904323152e-03   -2.176194635740425e-02   +7.968507932156324e-03   +1.966010872458682e-02   +2.632783433777608e-02   +2.569633367005730e-02   -1.419526076648558e-02   -1.527861085362957e-02   -1.728666612917618e-02   -3.517263409783617e-02   +2.848694486855141e-02   -7.302861520177496e-03   -1.044383720154593e-02   -1.037921635854759e-02   +3.047432269996982e-02   +6.058257108851225e-02; +2.431183431263765e-02   -2.665281582614377e-02   -4.595225216030530e-03   +2.764344076952835e-02   +5.945668008880026e-02   +1.719870307498306e-03   -3.854450333650665e-03   -1.381985388759406e-02   -7.529128245482515e-02   +4.451413037854769e-02   +3.894005328502789e-02   -7.886169152046144e-02   +7.444636710046779e-03   -1.298650991720727e-02   +8.440640162527040e-02   +1.647601802985356e-02; +4.045046896431310e-02   -1.110726442688376e-02   +1.687973388503731e-02   +3.404735170208149e-02   -1.154352288914119e-03   -9.290024673902443e-03   -4.657282808548065e-02   -1.666692904640175e-02   +1.144402364818165e-02   -4.075196698316343e-02   +8.953009806822450e-03   +1.818892026697551e-02   -3.645088338887000e-02   +2.331912142588296e-02   +2.050097952652889e-02   +3.983208405145411e-02; -1.022128743175737e-02   -3.414506068154575e-02   -1.359876204934124e-02   +1.407536765387762e-02   -6.973225693705351e-02   +7.709704365205956e-02   -3.497446704767627e-03   +6.961948049315678e-02   +2.938697227079214e-02   +4.099214088061305e-02   -3.051999386185878e-03   -2.056464789179554e-02   -1.945187510825194e-02   +4.092907659171563e-02   -2.026945473471790e-02   +1.380375296500573e-02; -7.727978006709202e-02   -1.471124383890024e-02   +7.901768076931714e-02   +1.787795046186414e-02   +2.549744462557604e-02   +2.757249447748931e-02   +2.715594652352538e-02   -3.195043692200787e-02   -8.432331135470287e-03   -3.128437422705472e-02   -2.115574015856170e-02   +1.318302998122377e-02   +4.158267473781755e-02   +5.475707206098841e-03   -5.976550596607174e-02   -8.036479653368319e-03; -7.918343152699740e-03   +6.399398740568039e-02   +4.424955162596575e-03   -5.009496034248618e-02   +2.379522817586430e-02   +1.537800604100348e-02   +1.299236992777411e-02   -3.655940050938261e-02   -4.824393875411812e-02   -5.858300733366099e-02   +5.478616448769760e-03   +5.772091423533603e-02   -1.272330214566537e-02   +1.519637407590563e-02   -4.771335577875471e-02   +5.531571464834711e-02; +1.017778617492590e-01   -4.540458710836436e-03   +4.434886594736019e-02   -8.163666463181433e-02   -8.489265894573975e-02   +3.154480918653618e-02   +2.077999355179664e-02   +3.728628123769452e-02   -1.059056947272569e-01   -6.804270830338013e-02   +5.485843245550641e-02   -2.239830290972838e-02   +5.420929416733226e-03   +1.445618443700214e-03   +3.811284858404559e-02   -4.203460615711834e-02; -7.952594185985024e-02   -1.154140407473996e-02   -1.965591479121880e-02   -1.069038953253844e-02   +6.899337329094611e-03   +3.234892376196850e-02   +4.656376725036006e-02   -2.520446001019402e-03   -5.676716159606809e-02   -4.055151530457416e-03   +1.172332708599781e-02   -4.494681499803958e-02   +1.935688882157726e-02   +2.316382312264673e-02   -4.506451593122828e-03   -1.330179132676255e-02; +2.062644657384070e-02   -1.051871628985926e-02   +3.030361383749626e-02   -9.831371119658700e-03   +1.570913321937958e-02   +3.931804813769753e-02   +5.356052528343971e-02   -3.372337061539429e-02   +1.367283176383112e-02   -1.857363622431875e-02   +2.983883463018958e-02   -1.745326258200786e-02   +2.627965556093167e-02   +7.153814054441848e-02   -1.841171448749599e-02   -3.284191017942560e-02; +4.597197721818112e-02   -2.024318567561186e-03   +2.242424969108185e-03   -4.072992891907021e-03   -4.687996760247217e-03   +1.010841741169419e-01   -1.962973476457614e-02   +8.932646586644635e-03   -2.153580738880513e-03   -6.165191366829671e-03   +4.311592559767305e-02   +3.020911200852398e-02   +2.188545682247300e-02   -1.275615338451088e-02   -1.264412574686237e-02   +6.695005729474596e-03; -6.737776934281714e-02   -3.052051387705196e-02   -5.673808910202083e-03   -1.163115021540834e-02   -2.757990959424782e-02   -6.357529156841093e-03   +3.598801957962600e-02   +3.343310362691668e-02   -4.663264333406418e-02   +1.719363804147171e-02   -1.787087350515638e-02   -8.742111842915335e-03   +4.568228277970436e-02   +2.897569470420156e-02   +1.736976086356767e-02   -7.297343152424059e-02; -6.187621345029393e-04   -2.203330041957670e-02   +4.396687764645339e-03   +1.830803162745178e-02   +5.259689140242930e-03   +5.500498612677223e-03   -2.996646706249292e-02   -2.907870732561266e-02   +8.264988126143849e-02   -7.266822138379318e-02   -3.635756817076567e-02   -1.306884151454163e-02   +2.214494600299303e-02   +1.245297739600490e-02   +2.122112030544959e-02   +2.212964857948975e-02; +3.777170985820284e-02   +1.923917636874199e-02   +3.105400363949507e-02   -4.754855464887234e-02   +1.466055814464982e-02   -2.145931366506922e-02   +1.756741526747696e-02   -2.478601565956748e-02   -9.090459491616822e-03   +1.343429767437575e-02   -4.241178836606314e-03   -3.890018226922023e-02   +2.635189098346940e-02   -3.896207037735547e-02   +3.223911375316903e-02   -4.904505013759138e-02; -2.665679489913035e-02   +1.919891425727450e-02   -1.297274826143606e-02   -2.668383893669372e-02   +5.597215962930956e-02   -3.660479742982048e-02   -3.419387748570912e-02   +1.541487182812930e-02   +1.681644670259880e-02   +5.684527310835538e-03   +2.824320697596031e-02   +4.799055651671590e-02   -3.046121242559854e-02   +6.567662817114813e-03   +5.157838734610974e-03   -4.394902744287839e-03; -6.253392856255222e-02   -1.538636799444651e-02   -1.905730366846053e-02   +1.193740495144497e-02   -3.174594273529671e-02   -5.617883523366218e-02   -1.701031481578339e-02   -1.213617015316705e-02   +1.992191987643237e-02   +5.154481968910898e-02   -2.307899246653189e-02   +7.702520566402525e-03   -6.603898179068249e-02   -7.121152531268839e-02   -2.124469156598563e-02   -1.834064192165888e-02];
L1E_L1I_iGABA_netcon = [+1.285316267567818e-02   +1.892923243953753e-02   -1.392636872968260e-02   +3.533878519174913e-02   +9.703159539269399e-03   +1.270018721768356e-02   -7.019851582840894e-02   +7.317299824890945e-02   +3.930752152315597e-02   -2.723973442387289e-02   -3.241837609944880e-03   +1.809526524818345e-03   -1.291233695213500e-02   +4.066501010203501e-02   -3.768592988982247e-02   +2.038514539230658e-02; +6.627646103939731e-02   -3.998889853158386e-04   +1.154544286614735e-02   -2.487775892057208e-02   +4.071317890915521e-02   -8.511995412491043e-03   -1.334452704620981e-03   -2.949264370383461e-02   +2.825895616923639e-02   +3.799633803885087e-02   -2.668115673808790e-02   +9.070181322639559e-02   +8.662050455691270e-03   +2.830641465444816e-02   -3.247853668577465e-03   -4.348556423874241e-02; -2.225825315997462e-02   -2.019130339041297e-02   -3.696873489303930e-02   +6.453347759742931e-02   +4.057360790159073e-03   -2.302732780521823e-02   -1.109734618657878e-01   +3.268717914054971e-02   +9.579805750383544e-03   -5.258178625145709e-02   +5.378123830920987e-03   +3.800401896869554e-03   +3.158977707608564e-02   -2.299142621673489e-02   -5.472013961209530e-03   +9.002400618597917e-04; -5.811684379812401e-02   +7.312869245382805e-02   -7.381784634557237e-02   -2.293072946125573e-02   -1.582949224407101e-02   -1.236559628594820e-02   -3.279116382444944e-02   +5.949938264350441e-02   -3.157316307999335e-02   -9.478691367758129e-03   +5.048158525564013e-02   +3.508180142931354e-02   -1.495121803393616e-02   -4.845512325252805e-02   +3.407124147142784e-02   -4.501029066155938e-02; -2.322556043760924e-02   +3.143040513594753e-03   +6.413233043981428e-02   +2.051570745286554e-03   -1.793914070082571e-02   +2.126578650046745e-02   -1.329996860357169e-02   +5.344779875082939e-02   -7.865477996030950e-03   +3.331965699482595e-02   -2.224163507860477e-02   -7.752115928248789e-02   +4.850368542261286e-02   -4.064753942932492e-02   +1.881600207350346e-02   +1.150812280197535e-02; -6.671312158712840e-03   +5.803142968843059e-03   +5.387175688282633e-03   -2.911039618733978e-02   -1.849003522972289e-02   -2.640130940569790e-02   +6.944379936334816e-02   +5.014589721774596e-02   +5.547193742447266e-03   +6.995859991439340e-02   +7.247014558976087e-03   +2.951784944139780e-02   +6.655095575405549e-02   +5.555186848893610e-02   -2.345994673523394e-02   -4.394670308207816e-02; -5.967547131836908e-02   -1.908456514355165e-02   -2.239850359501177e-02   -3.406941109208970e-02   -3.870075262433091e-02   +6.026796108569009e-02   -2.075964472672328e-03   +7.830832115144991e-02   -4.606546246488962e-02   +6.708932860743114e-02   +4.824280330607343e-02   +1.133543024694412e-02   +7.939488762523145e-02   -3.560650811621389e-02   -4.268685663156614e-03   +3.489991878272513e-02; +3.339411938096520e-02   -6.736217212601037e-03   -5.901330561418507e-02   +1.067833167914611e-02   -1.099069764648777e-02   +1.823985770158653e-02   +1.410522721828173e-02   +3.388383202108369e-02   -2.115010187087498e-02   +5.684894439599388e-02   -1.242258969595326e-02   +4.474230317276676e-03   -2.723044838670450e-02   -2.457153285755464e-02   +1.161604546856417e-02   +1.480874817488281e-02; -5.289959881647239e-02   -8.631039775347478e-02   -2.229845910721332e-02   +4.326689742833226e-02   +2.331513096596694e-02   -2.142073366777625e-02   +1.281522215791829e-02   -5.494903667767079e-02   -8.747319370685565e-02   -4.123848398063607e-02   -1.564358240385240e-02   +3.122671325680194e-02   +2.178337118053533e-02   +4.245208721823718e-02   -1.304702818305843e-02   +3.500361332780765e-03; +1.789071357318546e-02   +2.016124988218306e-02   +1.281174807086165e-02   +7.159193905910831e-02   -7.498327317724354e-02   +1.061445982066407e-01   -5.836925935453556e-02   -9.275909248341558e-03   +1.676519840790313e-02   -9.150047851494017e-03   -1.045337027492015e-01   +2.992509720641731e-03   +2.076049436914038e-02   -6.660545533537920e-02   +3.536363553891693e-02   -1.985913080664726e-02; +5.369793138904282e-02   +2.353927359401133e-02   +5.202201905671280e-02   -1.108500295719120e-02   +3.457434396446481e-02   -5.580467747042146e-02   -2.814613968766463e-02   -2.061868929617515e-02   -2.556562424679363e-03   +1.477446509450678e-02   -2.427470347957669e-02   -3.656950320210298e-02   -1.678661100645488e-02   -1.651753710588763e-02   -1.346876288600780e-02   -4.528852378745008e-02; -5.804762890134220e-02   +5.996783492061873e-02   -3.175678699230193e-02   -5.930517347349616e-02   -5.248464444569265e-02   -2.322104684173237e-02   -5.416992316157331e-02   +1.338973085376987e-02   +2.234326757065707e-02   +2.663160122598604e-03   -5.107062282821412e-03   -1.213079914313127e-02   +3.379626281555288e-02   -9.256168066500457e-03   +5.003870847237921e-02   -3.449007080560420e-03; +5.203172139247891e-02   +5.140430565386523e-02   +1.874636725653333e-03   +2.590226379569768e-02   -8.810127969400842e-03   +6.350389558069236e-02   -3.419410722899769e-02   -3.346868412193071e-02   -3.478439624124523e-02   -1.630433607315438e-02   +7.707234392645262e-03   -4.053975041529736e-02   +1.274152312086059e-02   +6.113274221100987e-03   -8.297564575069652e-02   +4.197399309789782e-02; +7.525097905638695e-02   -7.290725214512042e-02   -1.224997046977194e-02   +3.206435243739506e-02   -3.427301047927853e-03   -1.140096076878902e-02   -6.220794248930222e-03   -3.140320570458168e-02   +5.409580729565967e-02   +4.221267611955528e-02   -1.102903732228955e-01   +1.717874165988063e-02   +3.041146322804239e-02   +1.804956934289381e-02   -5.011837794702101e-02   +1.696756317961567e-03; -5.048023283559389e-02   -2.359311528118864e-02   -7.073217767151245e-02   +1.981987885925117e-03   -1.942882770693009e-02   +4.403534285845369e-02   +4.330827527952368e-02   +8.882307764819934e-03   +8.769922759043393e-02   +4.309693325965038e-02   +3.977168165073722e-02   -2.757324128524528e-03   +1.682888801051476e-02   +3.761585538716018e-03   -1.001988405164239e-02   -4.109345001812765e-02; -3.358154194617900e-03   +7.754183554248313e-02   +6.636622729224258e-02   -2.184210394028390e-02   +3.556298861858896e-02   -2.578889028748917e-02   -1.961949407370878e-02   +3.943391943178517e-02   -4.215613688370940e-02   -3.343851524321487e-03   -6.084466955977110e-03   +1.258946395880477e-02   +3.184566229476937e-02   +4.027925658683014e-02   -2.389020839076824e-02   -5.685253781926389e-03];
L2I_L1I_iGABA_netcon = [-3.246708637127694e-02   -7.946444203833489e-03   +2.500243963136147e-02   -4.695498119983728e-02   -8.901285053113223e-02   -1.018312068652855e-02   +1.504928599688160e-02   -2.495367631832758e-02; -2.239867479664571e-02   +3.099917330094128e-02   -2.997126452910879e-02   +5.060611336951558e-02   +4.683870970755219e-02   +3.858874395808767e-02   +9.268676986976358e-04   -2.584187839371477e-02; -6.677446729031737e-02   -6.655794674660599e-02   -9.089412475007122e-03   +2.086204021906657e-02   +1.184081175915453e-02   -1.923279688879951e-03   -6.850299108036720e-02   -3.662374559925976e-02; -2.378829464240166e-02   +3.828830596537593e-02   -7.687668389689856e-02   +1.016136634671905e-01   +8.138205315532896e-03   +1.489329400438599e-02   +6.413619974884185e-02   -5.695023163728136e-03; -1.509266555535528e-02   -6.140585343446744e-03   -1.165506517738549e-02   +1.942251154176659e-02   +4.177520181095699e-02   -6.786751628794392e-02   +1.220621320810471e-02   +2.285832520274024e-02; +7.415524992734848e-03   +9.733518135127806e-02   +6.163906482070407e-03   +4.130332777656334e-02   -2.174982910535223e-02   +1.448235423708414e-02   -2.949405087574573e-02   +8.225872757924316e-03; +8.205638641144253e-03   -1.029216972498578e-02   +7.773592258060175e-02   +3.296452201086127e-02   +6.280437699725387e-02   +2.602845071970759e-02   +1.401297234826437e-03   +3.306374641679657e-02; -4.123445624312875e-02   -6.560234164037676e-02   -4.003784337569313e-03   -7.509018051269606e-02   +4.280271686933474e-03   +5.415675189187887e-02   -1.336270124497080e-02   -2.634850135835929e-02; -8.642341682411564e-03   -7.165223640825297e-02   -1.083599973846184e-02   +5.399771126052737e-02   +4.823807717060098e-03   +1.896149612138911e-02   +1.012369898318462e-01   +9.524523959112494e-03; -2.021443723792315e-02   +2.765045389622162e-03   -1.867069470054086e-02   -2.842556005418303e-02   -4.184041868448940e-02   +7.738342781109103e-04   +3.139070407886495e-02   -4.929861305986941e-02; -3.362022907448558e-02   +3.552027050320670e-02   +3.282823354778801e-02   -1.236196502904217e-02   -4.801615670103555e-03   -3.590651341564398e-02   +4.432813214823514e-02   -2.466509524576192e-03; -8.029029232368323e-03   -2.422086270530141e-02   -7.078048932338574e-02   +2.752738802778900e-02   +4.281125619737178e-02   +8.713766652553824e-02   +1.315793854775113e-02   -3.616431301416336e-02; +5.363333930516295e-02   +2.339479288544753e-02   -1.300807736562627e-02   +2.567308847842889e-02   +4.193208628169265e-02   +6.593791980674264e-02   -2.031538088720583e-02   -2.275594333028064e-02; +2.580309154594618e-02   -1.302603296489988e-02   -5.662658106236576e-02   +3.916886898411377e-02   -2.257440279144819e-02   -4.042473192397657e-02   -1.341001488274683e-02   +2.069319919757222e-02; +3.392656416927128e-02   +1.833458102079909e-02   -2.602396328816348e-02   -4.930773355778027e-03   -4.208317786969905e-02   +5.564733120047013e-02   -2.028619814407785e-02   +6.715313424471570e-04; +2.670472322255121e-02   -2.334164150436063e-02   -9.837085893299484e-03   +9.215245003084696e-03   +1.197007972456384e-02   -5.746590645335491e-02   -3.421071542383863e-02   +1.175495633861114e-02];
L1I_L2I_iGABA_netcon = [-5.289303573223794e-02   -1.005781681698171e-02   +1.901500946142227e-04   -3.422238766767870e-02   -9.038025063084626e-02   +1.301382560248430e-02   -1.519081843760901e-02   +8.390912273603460e-03   +4.154766845912639e-02   +2.006482590166105e-02   +1.649407373567133e-02   +1.317318712674756e-02   -2.630166509500521e-02   -6.480334954896990e-03   -7.099820175836172e-02   -6.589583018465420e-02; -4.391433974107577e-02   +5.295002989945941e-03   +2.446238647548149e-02   +5.954299329164418e-04   -5.340281892508005e-02   -7.012188429100886e-03   +1.117885507476893e-02   +6.861320451330484e-03   +5.448613156378244e-02   -6.106264156955071e-03   -8.910441343096159e-03   -5.697295724452099e-02   +1.725734088412150e-02   +2.846905576324465e-02   -3.812928849832176e-02   -2.307176055794467e-03; -1.101399283637279e-02   +2.550340429551266e-02   +2.924175975470386e-03   -4.758721979582947e-02   -3.008310621065820e-02   +2.270448401894231e-02   -1.339618275243758e-02   -1.759103460983961e-02   +2.747389398196761e-02   +3.206063035701281e-02   +1.472503683739263e-02   -4.272588447727577e-02   -9.466595161763680e-03   +3.833004281738830e-02   -2.371760983906079e-02   +4.217094640306409e-02; -6.941364839787693e-03   -1.597778294051551e-02   +1.999497230369822e-02   +6.279995225385662e-03   -3.797074303258824e-02   -2.018937132075724e-03   -2.439502421241937e-02   +2.410000784960132e-02   -6.135821691863071e-02   -4.120935835592145e-02   +2.421886566983915e-02   +5.240517195625594e-02   -2.090082274144145e-02   +1.876478428468362e-02   +5.745884108978126e-02   +1.874032175979141e-02; -3.611060850718602e-03   -5.466868888783231e-03   +3.021091801724811e-02   +1.246647796551245e-03   +4.887981593408685e-02   +2.931096787041507e-02   +8.427114095548452e-02   -5.143927456168382e-02   +1.040168516914168e-01   +4.988669468186451e-02   +4.224471981347137e-02   +2.723166886306259e-02   -2.615101190730547e-02   +5.610987738511141e-02   +3.261840188193484e-03   -5.048829878009012e-02; +3.221364255947250e-02   +2.715919207634120e-02   -5.556267698552081e-03   +2.787707234917104e-02   -2.869419873058458e-02   +4.454902965112788e-02   +2.490109154325652e-02   -6.367226299844334e-03   -9.474234860136883e-03   -4.489533475566063e-03   +6.022926344732153e-02   -1.330814806597332e-02   +7.751043253794363e-03   -1.183332536388297e-02   -1.744801951427391e-02   -6.890751714772519e-02; +8.662383868182470e-03   +2.852026544531015e-02   +2.665332223063098e-02   -2.024802019538073e-02   +7.793680818005071e-02   +5.963980909594210e-02   +5.087841573089905e-02   -1.806729150177475e-03   -2.071915117919124e-02   -1.054942826547502e-01   +3.076367118010695e-02   +2.629651949255261e-03   +2.936988070369510e-02   +5.047684305797918e-02   -6.124991737062883e-03   +3.511281496994052e-02; +2.029402626008888e-02   -8.131992450974969e-02   -2.725784161623248e-02   +3.379286448320397e-02   -5.170363183650095e-02   -1.561437017329679e-02   -5.371909521441244e-02   -3.124926915701152e-02   +2.925116988514963e-04   -9.116631501494330e-03   +2.950397488008569e-02   +3.049248435034468e-02   -7.002112276227380e-02   -2.763625044990664e-03   -2.963868858886098e-02   -8.716924947388631e-02];
L2E_L1E_iAMPA_netcon = [-7.048855128680211e-02   +1.212008872871677e-02   +3.086371195752516e-02   -3.660218483879981e-02   -7.460213108741988e-03   -3.611479602201088e-02   -1.663724358333786e-02   -1.907676586361434e-02; +5.667395674699083e-03   -3.601322696302632e-02   -1.263471322996070e-02   +6.336462441606269e-02   +7.539557139639529e-02   -3.255698329836759e-02   -5.908577628368088e-03   -2.653761697954716e-02; +3.334075078517942e-02   -7.340006621573787e-02   -6.324681643446686e-02   -4.912366042119971e-02   +3.000803500745677e-02   +2.664235146163508e-02   +6.877430450182223e-02   -2.817344448964877e-02; -1.865127743277889e-02   -5.029443733703256e-03   +4.731620870219039e-02   -6.144735137905055e-03   +2.523801722556005e-02   -1.518529566146187e-02   +4.106059841654734e-02   +4.690418160320016e-02; +2.239573080280117e-02   -6.787216775296666e-02   -1.964518241886835e-02   +2.595072822722575e-02   -8.739700244429896e-03   -1.858695171643361e-02   +1.271570477750387e-02   +4.446487898973092e-02; +6.162124094500752e-02   -5.845678131081008e-02   -1.249444092634024e-02   +5.903425636541183e-02   -6.875379582053866e-02   -9.667260941722974e-03   -3.008144316282078e-02   +2.196319784072764e-02; -4.621241304829079e-02   +1.482978445535468e-02   -1.516547966291387e-02   -5.757671781340963e-03   -1.581704176665388e-02   +3.766948927865752e-02   +2.263897619465904e-02   -6.866861124145758e-03; +3.993372531407091e-02   +1.930914646466080e-02   -3.198132770236700e-02   +2.158495889960511e-02   -2.702383997299731e-02   +2.385250663682980e-02   -3.167810777172649e-02   +6.087050241926982e-02; -1.421183407594448e-02   +7.531211742491207e-03   -3.587861461136060e-02   +9.563978152089946e-02   -3.002874441901203e-02   -4.120723507786561e-03   +2.062849053399338e-02   -6.322820279375604e-02; +6.619874319514904e-02   -1.111895332217267e-02   +5.012881980810286e-02   -3.158820777485485e-02   -1.174061541490689e-02   +1.067112919558830e-02   -3.896297261256566e-02   -2.199407908637720e-02; -4.573180241128293e-02   -2.022330035710592e-02   +2.791888351734111e-02   -4.603086894040349e-02   +8.408580283915466e-02   -9.060587096208189e-03   +2.708562817173040e-02   -6.583544927227233e-02; -3.121392307438504e-02   +6.806472334070438e-04   +2.675443534538730e-03   -3.877744459538890e-02   +1.792598809979877e-02   -1.983425816443250e-02   -5.016261325886950e-02   -3.215422589809204e-03; +1.624098855883138e-02   -4.320717146412714e-02   +3.060240359233118e-02   -3.889549371067140e-02   -3.425341973714672e-02   +7.419663291078423e-03   -5.976052997716658e-02   -7.045178478272320e-02; +8.255489287113839e-04   +3.356786571056421e-02   -2.389944451057122e-02   -3.355355942975293e-02   -5.153194354984521e-02   +1.816069243191887e-02   +2.503707237629189e-02   +7.131673793088000e-02; -4.936532217915544e-02   -2.904401648414044e-02   +1.995633923004490e-02   -3.139810345254521e-02   +2.471003118343328e-02   -1.683030651894499e-02   +1.880739472147964e-02   +9.514348582026317e-03; -3.198411087079834e-02   -7.180209103259866e-03   +2.220701048244341e-02   -4.325650535770677e-02   +1.789460446149619e-02   +3.396278140252902e-02   -4.174244988696123e-02   -4.362597514996274e-03];
L1E_L2E_iAMPA_netcon = [+2.800530270074256e-02   -1.526268973773405e-03   +1.527872971134269e-02   -8.690573810124724e-02   -4.920067725732754e-02   -3.040923444483304e-02   +5.126943924327164e-03   +3.205884987980239e-02   -4.147075025907503e-02   -1.571409977540424e-02   +2.279273996775788e-02   -1.616565883815524e-02   +2.088748812299322e-02   -4.644572995415618e-02   +2.941107557681596e-02   -1.050767746459792e-02; +4.873178241573316e-02   -9.152786714859019e-03   -4.750574831605978e-02   +4.614681384182285e-02   +2.952782787972478e-02   +2.602690082342981e-02   +2.240578318039188e-02   -2.245065167164905e-02   -2.377894444528676e-03   +3.017863160787086e-02   -5.778704959459361e-02   -3.692266167606856e-02   +6.933108833026083e-02   +3.224481657883645e-02   -4.578058690942864e-02   -4.221581449798782e-02; -2.386636283807924e-02   -1.886308331955585e-02   +8.255963410446611e-02   +3.190396818971677e-03   +2.312038160201560e-02   -1.279633587961125e-02   -2.232541595817203e-02   -2.682616591081280e-02   +2.871422816992632e-03   +1.241106396401003e-03   +5.210177672827058e-03   -3.706598813633684e-02   -1.486919847320510e-02   -1.142935111670938e-03   -1.328046422033331e-02   +1.331813579153247e-02; -2.274872244331694e-03   -5.429388142751864e-03   -4.598257313545553e-02   +4.913258140266821e-02   +4.064342680211084e-03   -6.916022350452841e-02   +7.080431907900368e-04   +5.058017255493044e-02   -5.071452094795108e-02   -8.682241904004509e-02   -2.088811512169592e-02   +1.052954982850502e-02   +1.210079775489059e-02   +6.756443259826839e-02   +1.005209592662836e-02   +1.838638901069650e-02; +9.748350384312435e-03   +3.068546581528368e-02   -4.320667372581323e-02   +9.170171445269633e-03   +4.950584630309885e-03   +3.624993984306853e-02   -2.457622100377186e-02   -1.903998204293089e-02   -1.912688848698899e-02   -1.220039457772417e-02   +2.815115254346309e-02   +3.652781628669844e-02   +2.238432243302838e-02   +4.394974861772818e-02   +6.241036965853255e-02   -1.088857995337012e-02; -3.180817313113578e-02   -8.599433694724934e-03   -7.976215000808091e-03   +5.768682886725955e-02   +4.926104091793291e-03   +7.066189953410813e-03   +1.763550957049428e-03   +1.768634690622993e-02   -6.938240209667348e-02   -1.768393362380980e-02   -1.571058650128751e-02   +7.147500701016161e-02   -1.895338306417636e-02   +3.278722205267490e-02   +4.003686312984844e-02   -9.649191121172738e-03; -3.212424224717972e-02   +8.850110021480545e-02   +1.185214914757485e-02   +2.233141700013541e-02   -7.472326409471280e-02   +1.446425642948540e-02   -1.936613216889382e-02   -1.130787645172892e-03   -5.015357307760544e-03   -1.918305293834750e-02   +4.735851382321440e-02   +3.322432012848622e-02   -1.844677791453152e-02   +7.542072197387648e-02   +1.189235473306546e-02   -4.348885576095927e-02; +4.204589553546055e-02   +1.564720857268618e-02   -2.896641403945389e-03   +2.320956404032651e-02   +2.536240971478431e-02   +1.105380905997329e-01   +6.228787754790906e-03   -2.535443396164655e-02   +1.306081773999540e-02   +6.855047397077801e-02   +4.431308882307119e-02   -1.326914427942232e-02   +9.275664621748411e-02   +6.397045187251905e-03   -2.613119240980669e-02   +6.822172627872086e-02];
L2I_L2E_iAMPA_netcon = [+3.221201892099190e-02   -5.716113954760400e-02   +7.345704241609699e-03   +1.368854301081958e-02   +8.733540403437384e-02   -5.243493101425811e-02   -1.852978651628469e-02   -9.087626093300510e-02; -4.652494714399708e-03   +8.067963523957677e-03   -2.249574311362779e-02   +9.006441168637774e-02   +5.932616480487450e-03   -9.451678401661060e-03   -6.060005920355812e-02   -1.362627811180794e-03; -5.412373406814868e-03   +1.231634150315694e-02   +8.859613094404365e-03   +5.749565891656883e-02   -5.067928832235143e-02   +2.762570957291376e-02   +4.055444267604576e-02   -7.655495032501958e-05; +4.192125234011272e-02   +3.088300720587392e-02   +1.798100078627424e-02   +3.196595881176575e-02   +1.447928322951311e-02   +2.313783190424921e-02   -8.795552123846601e-03   -2.448549802189912e-02; +4.343348984584843e-02   +5.559261567655948e-02   +1.277230848172791e-02   +3.508863404879405e-02   -4.799440235432025e-02   +7.993393806574590e-03   +3.498714541377365e-02   +6.826397660482433e-02; -2.247721681133464e-02   +2.455373991197267e-02   -4.580724242865174e-03   +3.336418488871983e-02   +5.440175900049170e-02   -5.174870865409339e-02   -6.297656431224580e-02   -1.726425557347615e-02; +1.761907889353027e-02   -1.360942653896547e-02   +6.177832650682914e-02   +8.428099362511892e-03   -4.988044129890027e-02   +6.149348406853096e-03   -2.534059731902614e-02   +1.930531847278115e-03; -2.464786756293610e-02   -1.381995534051828e-03   -1.128689646123848e-03   +2.486100109668274e-02   +8.774178923005370e-02   +4.038251398942616e-03   -3.918546229884444e-02   -3.863963117057527e-03];
L2E_L2I_iGABA_netcon = [+5.863903410302870e-02   +1.102255446344737e-02   +1.463306214821401e-02   -6.142220670967804e-03   +6.150863582472634e-03   -1.050420478751167e-03   +2.297063709439398e-02   +2.409485724909367e-02; +3.904079803527589e-03   -2.109883973889519e-02   +2.700666270886713e-02   -3.292935590269981e-02   -4.903877778728524e-02   -5.601276646035269e-02   -5.388512580154257e-02   -2.802137942859249e-02; -1.386416791816538e-02   +1.858150233856033e-02   -4.583973014510442e-02   +5.754091267628068e-02   +1.881433632691851e-02   -3.924316387122642e-02   +2.710276167095614e-03   -2.142662788158219e-02; -3.329508353602961e-02   -1.629305036580064e-02   +7.244799706867383e-02   -8.366620122577177e-02   +2.387133989053662e-02   -5.714329032785983e-03   -1.594691843535741e-02   -2.884155476250110e-02; -3.833970552740006e-02   -2.336746914036803e-02   -4.654605155678176e-02   -2.660698093030835e-02   +1.530470135137428e-02   -7.072364802844139e-02   -3.728017929412766e-02   -1.633974505954611e-02; -3.452209913471446e-02   -1.392413599456079e-03   +5.920324222079963e-03   +2.738086911971471e-02   -3.483397933380092e-02   +2.159235237865443e-02   +6.553298922261064e-02   +5.145805376748419e-02; -1.963477473996079e-02   -1.726536090957256e-02   +3.542646576343170e-02   +1.018192044244429e-01   +6.817267191410842e-02   +8.884939741462587e-03   +6.358522533781649e-02   +1.478373427786026e-02; +1.788108478591280e-02   -1.723324743910046e-02   -6.983740057046638e-02   -3.748208523259947e-02   +4.316522695552508e-04   +8.059139715551290e-02   -5.153025954426800e-02   +3.661309014658556e-03];
L3E_L2E_iAMPA_netcon = [-3.679222962351916e-03   +4.392220306780361e-02   +2.156104493074726e-02   +2.890716358750791e-03   +1.703603895687110e-02   -1.618549985608244e-02   -3.300347216021676e-02   -1.338498227240154e-03   -8.088277503742552e-03   +6.925571687607307e-02   -5.308170847302819e-02   -3.926717471620617e-02; -3.728695455343921e-02   -4.066307849593041e-02   +2.219736548633550e-02   +7.622038330614256e-03   +2.607938005924705e-02   -1.190268443878708e-02   -8.634500272889957e-03   -2.072871631313314e-02   +1.831922916300305e-02   +4.031660879712398e-02   +2.571323507786441e-02   +5.524642300498912e-02; -6.359752459750417e-02   -7.374542832906315e-02   -7.230669859881259e-02   -2.168987509739233e-02   -4.768091997002820e-02   +4.416707046025730e-02   +3.831534206424313e-02   -4.269104316855083e-02   +4.034638473615315e-02   +1.256561333955159e-02   -1.624424306025097e-03   -1.639993666802378e-02; -1.626829941950354e-02   +2.732739490426557e-03   +2.929232715967360e-02   +4.064315661998646e-02   -5.544694405696721e-02   -1.205691526350932e-02   +3.955641498491706e-02   +7.723054840547719e-02   +6.060110889799909e-02   +2.123221830650026e-02   +1.604961650507077e-02   +3.602110504100853e-03; +4.957266264920514e-02   +5.315748291750895e-02   -4.788790014961265e-02   -1.381182659944384e-02   +5.907550412511946e-03   -1.834532242178458e-02   +6.180658398905216e-02   -4.230620512719283e-02   +6.159492415549243e-03   +2.518241175960572e-02   -3.402931536166489e-02   -8.934341599610457e-02; -2.972239668383818e-02   +4.541800691889612e-02   +6.251301881194726e-03   +7.071418206800907e-02   -3.065203073607757e-02   +1.790767001473362e-02   +9.655952938554634e-03   +1.900346009659102e-02   +4.497347109688463e-02   +4.338611695194113e-02   +2.243658556431195e-03   -3.048405896048133e-02; -2.865267439488271e-02   -3.822811673008639e-03   -5.644987931520234e-02   -1.050930026760608e-02   -1.340717884273874e-02   +3.421752619112281e-02   +2.513300923128498e-02   -4.127741586445405e-02   +5.416768643417454e-02   -1.443626437894988e-03   -1.738592578732284e-02   +2.363955524519185e-02; -6.885049142157315e-02   +2.648349859281714e-02   -4.144813881074014e-02   +5.374709069396780e-02   -2.154276941733181e-03   -1.850339216002419e-03   -9.031250929594548e-03   +4.528180243115654e-02   +1.582192802638196e-02   -2.196974836843976e-03   +2.597372774557034e-02   -4.402725000217630e-02];
L3I_L2I_iGABA_netcon = [+3.537083208015226e-02   +1.895367114012288e-02   +6.352822454848567e-02   +5.753524599695413e-03   -5.061959308676305e-02   +1.366030923644231e-02   -2.047732445489894e-02   -1.592455164851980e-02   -4.252715411379530e-02   -1.605000148713361e-02   -2.658074876437005e-02   +2.683999109026045e-02; -3.890432933366863e-02   +7.126270047039160e-02   +1.023235539289176e-02   -2.586657042168216e-02   -3.946105348091100e-02   -3.329032020579317e-02   -3.426135030995973e-02   -2.851561744647658e-02   -8.595121012205855e-03   +5.618623724326736e-03   +2.543035851370427e-02   -9.473678600804912e-03; -2.531035684157556e-03   -8.444291867502886e-02   +5.942419850047306e-02   +3.060778659807396e-02   -4.082118691399539e-02   +2.264449280169477e-02   +3.335949398795460e-02   +1.335794684310293e-02   -1.815861560633061e-03   -3.341551530745612e-02   -5.026748044222092e-04   -2.264272854726204e-02; +2.995125653938536e-02   +2.724469707757691e-02   +1.709921963331329e-02   -3.748486806134330e-02   +3.706416248996725e-02   +5.032450279296136e-03   +4.065429154938995e-02   +4.373603998194960e-02   -5.646787022725122e-03   -2.300597878884480e-02   +1.422439331293037e-02   -4.257768503302832e-03; +4.683598706946658e-02   +3.273851812173525e-02   +4.596913446699585e-02   +4.079149811092254e-02   +2.405554575408596e-03   +2.318677141651721e-02   +3.126994574277166e-02   +3.246773340336063e-03   +1.408316745924833e-02   -6.269869866375159e-02   +1.053065501810213e-02   +1.482124337100566e-02; +3.520151756902700e-03   +2.467197185927048e-02   -5.457318125496521e-02   +5.132784067028555e-02   +8.229465240797358e-02   +2.016088705141413e-02   +1.950961660125539e-03   -2.074847618719933e-02   -4.446566783355595e-02   +1.203365522030164e-02   -3.663795380010403e-02   -2.581842808978695e-02; +6.939531092227450e-03   +1.740139114898442e-02   -6.255536049166104e-02   +1.701663887505558e-02   -4.245390873382181e-03   +1.023139512367696e-02   -1.466547724403217e-02   -1.773833435256675e-02   -3.474882622848505e-02   -6.082983940593044e-02   +1.264170838435208e-02   +2.328979744394995e-03; -3.852042462968600e-02   +2.246189329774149e-02   +1.464358313190059e-02   -2.708027537770562e-02   -7.459815343859844e-02   -2.355932015884451e-02   +4.775512439726193e-02   -2.802000916807716e-02   -1.662676104758961e-02   +5.504742351979178e-03   +4.025477685351849e-02   -3.152076142471405e-02];
L2E_L3E_iAMPA_netcon = [+1.384280602945393e-02   -8.534543715444304e-02   -5.592310713199427e-02   -9.500671304031798e-02   -4.366487105336662e-04   -3.671542348600787e-02   -7.399416404134622e-03   -5.676974947265150e-02; -1.821684864627172e-03   +4.626047746864748e-03   +7.979482507843617e-02   +2.074081884074217e-02   -1.355725703057086e-02   -1.271719999126697e-02   -5.612879464907275e-02   +7.867235645226099e-02; -1.216659270980379e-02   +9.987568495925334e-03   +2.436561939712577e-02   +1.149690239349080e-02   -1.845702930169589e-02   -1.426645434212951e-03   -2.311803928279514e-02   +5.467986141358398e-02; +7.339612043962224e-02   +1.644682236631198e-02   +3.983548118504768e-03   +2.546548564652342e-02   +7.858227649841776e-02   -3.154754928953298e-02   +2.830518070252462e-02   +2.448282370308047e-02; -3.855223771822962e-02   +4.812474904574711e-03   -5.256458664165412e-02   -5.736948381874928e-02   -4.533993929913130e-02   +5.623690914529780e-02   +8.743494240423852e-03   +1.013788417075855e-02; +6.114147643340578e-02   -7.291021937310599e-02   -1.523778879159630e-03   +6.310527113108165e-02   +2.648579437820370e-02   -2.628306983903450e-02   +1.310978916310684e-03   +3.240106289023792e-02; +1.362823988983873e-02   -2.269653678420418e-02   -3.679491780686380e-02   +4.406149229790992e-02   +1.130920602106019e-02   +2.620735853579251e-02   -4.483031093421982e-02   +2.270895277531685e-02; +2.740548168157964e-02   +4.792100258847153e-03   -4.960669539218280e-03   +4.935403930455406e-02   +6.972034722202089e-02   -7.220103922401452e-03   -5.183935795669491e-02   -2.331898065025956e-02; +2.052311735685441e-02   -2.869041315923447e-02   +3.737052272268598e-03   -2.459097722330015e-02   +2.738074589158372e-02   +5.793797565361421e-02   -3.521055492680696e-02   -2.573162026233584e-02; +4.095466535227340e-02   -6.715143341690587e-02   +1.202804398939548e-02   +4.955245752398129e-02   -3.970015681231502e-03   +1.286972104361828e-02   -2.262778687901126e-02   +6.960879391268127e-02; +1.243272651828010e-02   +2.431940299836971e-02   -2.820882846426120e-02   -4.288482510637066e-02   +2.434545148660445e-02   +7.728205429828282e-03   -9.488225525616446e-02   -6.077198260406340e-02; -3.920910904182145e-03   +8.701102560189254e-02   -5.558486800871734e-02   +2.649948909155641e-02   -2.413762779020015e-02   -3.937230237244678e-02   -1.234628405760690e-02   -4.167762056041420e-02];
L2I_L3I_iGABA_netcon = [-4.377252762473538e-02   +2.018007623717049e-02   +1.840596362522635e-02   +2.046875651649652e-02   -4.452324338652355e-02   +3.587508193444297e-02   +1.397673901375266e-02   +3.066596652427741e-03; -5.823489314600478e-03   -7.130445303331005e-03   +1.471101168659799e-02   -1.574721303809511e-02   -5.674591359037505e-02   +3.023059684858773e-02   +1.546001224151789e-02   -6.371580039656365e-02; +3.249191549722170e-02   +4.680658217891906e-02   -9.544134866955674e-02   +1.736993633106647e-02   -1.211859504696093e-03   +1.899775549390671e-02   +7.310758482442561e-02   +6.148451821827853e-03; -2.655510023265574e-02   -2.341104830341650e-02   +2.086081053406098e-02   +7.572560745938907e-03   +2.891601998180955e-02   +5.609005006937780e-03   +7.010615435471967e-02   -3.912503888144635e-02; +5.603765394014130e-02   +3.950658321038088e-02   -8.533065194476538e-02   +5.133672455084887e-02   +3.880745584285512e-02   -1.220751850023422e-03   -5.091291401961423e-03   +1.985576312023871e-02; +5.112892912064362e-02   +2.322847203283387e-02   -3.417126226885365e-02   -1.400475754254561e-02   +1.227144043242014e-02   +8.192003470963646e-02   +5.238779981945788e-02   +5.919013638198670e-03; -2.221840499410029e-02   -5.107501390975756e-03   -2.975233561608660e-02   +2.952022447758351e-02   -2.835129641797912e-02   -6.058363951822582e-03   -1.102640143486880e-02   +2.564769833252045e-04; +1.092338709973370e-03   +3.340302479630908e-03   -1.227651034237919e-02   -1.279222825769356e-03   +3.308104132869108e-02   +2.417008063386868e-02   -1.593938199265864e-02   -1.104237410734892e-02; +4.228845448153280e-02   +9.599115213010512e-02   +3.946382630316842e-03   +9.012745514410407e-02   -7.552735948885838e-03   +1.199951825895319e-03   -1.714479081664818e-02   -1.039039088127018e-02; +5.488101940200058e-02   +1.496711319322536e-02   +1.179230787250501e-02   +5.976886103148331e-03   +4.783334002774015e-02   -2.907584035209573e-02   -7.984378999737063e-03   -6.582263414457300e-03; -3.017963762564441e-02   +1.345164649516509e-02   +3.710137077237827e-02   -1.490941194580700e-03   +1.727472000513613e-02   +8.606806811684088e-02   -3.757348910962529e-02   -2.066981310876898e-02; -7.517345753468971e-02   -1.493392736630635e-02   +2.906792789212684e-02   +9.551209651529320e-02   -1.010193137302627e-03   -2.556634501225895e-02   -6.704182874601769e-02   -1.136558242699456e-02];
L3I_L3E_iAMPA_netcon = [-7.527231584451040e-03   +3.706520675802197e-03   +5.373597913389422e-02   +3.009510962989227e-02   +2.634918251053540e-02   +7.540048867520546e-03   -4.528065436821031e-02   +1.989432525895659e-02   +3.276327071689719e-02   -6.154721870178149e-02   -1.268960516397695e-03   -2.640901283125426e-02; -8.264050063564250e-03   -1.921103616964970e-02   -1.580416420191997e-02   +1.087444055959907e-03   +3.236411823028339e-02   -3.352192775351116e-02   +1.549811584575941e-03   -1.506423027511153e-02   -2.751344313671496e-02   +2.298800415364856e-02   -6.931231927973230e-02   +1.830772645221168e-02; -1.430035184253503e-02   +3.802057054662340e-02   -3.946004174047574e-02   +2.898274158176806e-02   -5.927549248264062e-02   -1.475636867891210e-02   -8.491500505104676e-03   +2.893319310998272e-02   -4.722784394069852e-02   +1.878612525412366e-02   -5.122061488263294e-02   -1.072744563685700e-02; +2.637912552913405e-02   -1.098851172733083e-03   +4.391707651632176e-02   -2.378233933674044e-02   -4.964739937214223e-02   -1.843592219319693e-02   -2.140469939051214e-03   -5.280746043178977e-02   +7.393225944051525e-03   -3.218179883588643e-02   -2.186142860314081e-02   +2.920426888209597e-02; +2.629242793061312e-02   -5.033606922942106e-02   -5.768099234748905e-02   -7.444443715831874e-03   -3.264397130244808e-02   -4.064847064036103e-02   +2.800226474672768e-03   -4.699356641411617e-03   -1.211739170440598e-01   -7.399974199250524e-02   +1.476312272117336e-02   +4.521268906806242e-02; -6.558982854450345e-02   -1.289789333582073e-02   +9.355869792384802e-02   +4.809011661105324e-02   +1.994742553672817e-02   +8.561278801594908e-02   -5.263641392714081e-03   +2.517542987148345e-02   -3.377036600991902e-02   +6.231804370303101e-02   +2.025334782424162e-02   +9.897616695510765e-03; +9.003463306615732e-02   -5.113589582942138e-02   +1.438415471215248e-02   +6.079782307664192e-03   +1.083948892286849e-02   -1.498592073800898e-02   +1.949555868753158e-02   +6.813883776372387e-02   +3.948397154141670e-02   -6.651087644607484e-02   +3.388437272303462e-03   -3.897243568723334e-02; +2.104316436276478e-02   +2.326704572151939e-02   +7.109083067530955e-03   +1.748491086678194e-02   +6.826880658769876e-03   +1.984297962020909e-02   +4.905930058858957e-03   +3.306276279294827e-02   +3.572958327926846e-03   -2.547900777266685e-02   +1.727203939812313e-02   -7.226545769567612e-03; +4.697366684170400e-02   -3.061039718816123e-02   +3.935606659349263e-02   +5.404680836457176e-03   +6.823008114236095e-03   +6.609872174812713e-03   -6.298582849166992e-02   +6.075684568489571e-02   -5.282196373342014e-02   +6.155099546369094e-02   -6.225707979160007e-02   -4.268484959977362e-02; +4.444886440162551e-03   +4.143323284705545e-03   +3.840793660510319e-02   +2.500779469951364e-02   +9.815350836158108e-03   -4.615338444914391e-02   -7.630994259272877e-02   -1.172786895269577e-03   +1.379204609066611e-02   +3.567154336139133e-02   +3.180965021134212e-02   +2.737295581909117e-02; -1.880416198607167e-03   +5.806679855484939e-02   -4.622590118470653e-02   -3.419631940635846e-02   +1.731952482808378e-04   -1.308077074834284e-02   -1.707283761457777e-02   +1.876572698516124e-02   -1.773061227904786e-04   -5.299327301988813e-02   +5.922111366193906e-02   +5.491303144536074e-02; +4.431855883168451e-02   -1.919905410285292e-02   +5.734132725823363e-02   +6.599424629258972e-02   +8.956948278211081e-02   -1.825593812433955e-02   -3.724015886081354e-02   -7.990418020322326e-02   -2.737544593978775e-02   +6.737305383172207e-02   +1.537744376415498e-02   -2.659668706363939e-02];
L3E_L3I_iGABA_netcon = [+4.728367568915426e-03   +5.016161080650255e-02   -5.768600366964147e-02   +2.643459076113927e-03   +2.409499929847960e-03   -4.592665379460024e-02   -1.301535712292123e-02   -3.868137692252011e-02   -9.946681805031282e-03   +2.045886393781503e-02   +2.838281408853509e-03   +4.161896078194796e-04; +3.550783912576991e-02   -3.051754463596864e-02   -1.564534262540222e-02   +2.850094638991163e-02   +3.685014496993079e-02   -8.494249169354917e-02   -7.312168265681994e-03   -1.041314665235374e-02   -3.900350395446726e-02   -1.353157924782834e-02   +7.500103026740669e-02   +9.220585183924596e-03; -1.908698439443388e-02   -4.538559875379690e-03   +5.237850640315810e-02   -1.351644037743427e-02   +7.943372024084246e-03   +1.349231129914173e-02   +3.652489328331575e-02   -3.333534095491190e-02   +5.229178165396450e-02   +5.388657263383792e-03   -1.059730077807436e-02   -2.120089876730260e-02; +6.182788647329937e-02   +8.722065657409975e-03   -8.657877064797044e-04   +1.179089643360687e-02   +3.498899675799685e-02   +4.118529521553225e-02   +2.917155316159503e-02   +4.734051738692052e-02   +6.700988730850400e-02   +4.572216108444736e-02   -8.522346352879898e-02   +1.802981152089975e-02; +5.636089646795482e-02   -1.093155960413134e-01   +5.345055886780800e-02   +7.868787058767923e-02   -4.450262962580573e-03   +6.970577892245722e-03   -1.503735342164348e-02   -2.715316372142659e-02   -1.051776195142909e-02   -2.990889812343353e-02   +5.203574891358553e-02   +4.269544865415058e-02; +4.542743015333883e-02   +3.071332523269638e-02   +3.056402153427202e-02   -6.326046700472765e-02   +2.702826545223363e-02   -4.278188970579822e-02   +2.709035324146035e-03   -1.835447914898558e-02   +9.392870238704634e-03   -8.692764867603616e-03   -3.039183725997893e-02   -1.797632485879443e-02; -3.954370830026670e-02   +1.667754077506547e-02   +6.132941344939642e-02   +7.069781159645145e-03   +2.603845721501207e-02   +4.269489142448972e-02   +4.017574286664119e-02   +6.669088685362380e-03   -3.029914682814439e-02   +1.175731061478622e-01   +9.303664854190249e-03   -2.612340669106034e-02; -2.126361294585082e-02   +6.712052488727015e-02   -1.939648743693774e-02   -3.241537358196935e-02   -2.615110956502411e-02   +1.687570530971205e-02   -1.987259562712078e-02   +7.315902047623741e-03   -6.801412366813385e-03   +4.959398990273418e-02   -5.921087696355803e-02   -2.645398608983775e-02; -3.000099186258400e-02   +6.031957126228811e-02   -1.203239694981099e-02   -6.094859457411360e-03   -6.887802342580895e-02   +4.065863757936258e-03   -2.530119019526452e-03   -1.315239144039504e-02   +4.717949726403995e-02   +3.211266318360197e-02   +4.743215497140414e-04   -4.737514664388193e-02; +5.737069806688197e-02   -6.075516910288332e-02   -3.159101735916619e-02   +2.740371413785656e-03   +4.176921547866438e-02   -2.658038190686246e-02   +3.106852059046074e-02   +1.663577556380611e-02   -4.052692367553345e-02   -3.360916129181877e-04   -8.181002332513287e-02   -6.274215782332331e-02; -1.350460384444343e-02   +7.976509898551749e-02   -4.704031543481904e-02   -3.293128394986831e-03   -6.170558626355571e-02   +5.313353047065611e-02   +1.650915235338117e-02   +4.486384198266764e-02   -2.088662485940268e-02   -2.369501751009153e-02   -3.360130303232367e-02   +2.251502340254414e-02; -2.969115113252725e-02   -1.106462368953934e-02   +1.406825992745456e-02   +4.697994987462269e-02   +3.028164901501042e-02   -1.480734131003521e-02   +5.105905961370538e-02   +6.371235036760214e-03   +1.402980039361299e-02   +7.905436164631773e-02   -2.861706944211705e-02   -3.375018956453153e-02];
L2E_Input1_iAMPA_netcon = [-3.788995644259493e-03   -1.241728858600874e-02   +5.335137957170870e-02   -6.487562767052221e-02   +1.567318239208809e-02   -7.377394392088692e-02   -3.075950082122687e-02   +2.497168776416953e-02];
L2I_Input2_iAMPA_netcon = [-6.511814833998673e-03   +2.696563424025516e-02   +3.220500503232378e-02   -6.719231328900448e-02   +6.674378413278224e-02   +4.388875149299298e-02   +1.787725327968278e-02   -5.608710121059327e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
