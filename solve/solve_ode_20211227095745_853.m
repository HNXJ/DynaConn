function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.943700732703938e-01   +3.076180965026705e-01   -1.676404186040928e-01   +2.605256388029920e-02   +2.108551994749670e-01   -3.866527708503922e-01   +1.519972680512025e-01   -4.129208426149439e-01   -5.522522423132414e-01   +1.981141973308828e-01   +2.833362336824555e-01   +2.447404698043342e-01   -2.142347671008198e-01   -2.497532116354075e-01   +5.040605853939775e-01   -3.359454256057369e-01; +5.115629195283411e-03   +3.086954757673728e-01   +5.571770646208209e-01   -9.689990280335811e-02   -2.503022119894560e-01   -3.941783019359215e-01   -2.902803745395174e-01   -1.410959916636540e-01   -9.742076880290695e-02   +6.609240137891866e-02   +9.985200852045874e-02   +1.552965966443018e-01   -1.372171146983591e-01   +1.810343036570109e-01   -1.934721705833656e-01   +3.904486221143491e-02; +1.955322201635544e-02   +1.743695134494697e-03   -3.624739646371649e-01   -3.553512639466753e-01   +3.617667989505965e-01   +3.170257442814678e-02   +7.635657524233803e-02   +2.741867058489124e-01   -2.859615672820275e-01   -1.743775025127230e-01   -8.283187372257916e-03   +1.541099792213159e-01   -2.455024597140670e-01   +2.255809402033559e-01   +3.699434663409258e-01   +6.837801917170735e-02; +6.196970084064027e-02   -2.678264106002078e-01   +8.158484070238298e-02   +3.440237289132499e-02   -1.918309629863448e-01   +1.178271410639674e-01   +4.009681525440129e-01   +1.761328208040296e-01   -1.848459487392158e-02   +4.244059388475952e-01   -3.958689872355402e-01   -3.329290659885392e-01   +1.898098352406763e-01   +2.487223046762131e-01   -2.485592652872435e-01   -8.572936164160089e-02; -2.998660339406187e-01   +1.540706436597192e-02   -3.396166697069322e-02   +1.142151843238664e-01   +1.082765524995430e-01   +2.244246084636736e-01   -3.056136002668955e-01   -4.419951897232346e-02   +2.424593555138078e-02   +6.223049764385069e-02   +1.373696549431445e-02   +2.679770369851048e-02   -1.504610339895991e-01   +2.056638490033091e-01   -3.293123891392950e-01   -1.886447548009035e-01; -1.328559738616735e-01   -3.264720611240740e-02   -6.335868727156296e-02   -5.653216881996047e-02   -3.866093837494596e-01   -1.386848519197855e-01   +6.874168959992494e-02   +2.845568649710301e-02   -9.936258888343294e-02   -2.114981148247748e-01   -5.840647510024946e-02   +3.389979221739385e-01   -2.790928149108054e-01   +9.066417056107282e-02   +2.715956843370037e-01   -2.191051793756283e-01; -6.203411820138816e-02   +8.363354212279894e-02   +2.249607675774523e-01   +3.790175076556734e-01   +3.273970796355518e-01   +1.019443551452354e-01   +1.680508376429248e-01   +6.014512335698483e-02   -1.630146181201037e-01   -2.551287286814177e-01   -1.555281428388520e-01   -4.512346243451157e-01   +1.399610920036526e-01   +6.322861893710180e-02   -8.138158924754391e-02   +2.284008412370578e-01; -2.092917414595702e-01   +1.694803132013552e-01   +3.944621111110765e-02   +3.011783472881700e-02   -3.135343264402912e-01   -1.880017956041912e-01   -1.860084824408098e-01   +1.004767582274267e-01   -2.655827590603906e-01   -1.405215666930896e-01   -7.810717443748422e-03   +8.328881805199284e-02   +1.150157103945044e-01   +1.260055461075205e-01   -1.366715257610939e-01   -1.640119533520605e-01; +1.938399393032060e-02   +3.350959805067990e-01   -2.210780886666665e-01   +1.978468814044501e-01   +1.878755413734176e-01   +1.812088760060319e-01   +1.307890216674543e-01   +3.831532055949947e-01   -2.060004332529621e-01   +2.889815370934753e-01   +7.277012862234702e-02   +3.009962747425460e-03   -1.710282529380540e-01   -4.787579728613586e-01   +1.580149831613880e-02   -1.682316283436019e-01; -2.573575607935453e-01   +9.372294092038425e-02   +1.311048355417809e-01   +3.472081792739312e-02   -2.005135705612389e-01   -3.814329204033883e-01   +2.931979233981391e-01   -2.345836204629900e-01   +8.247844428309808e-02   +1.790629322794562e-01   +3.422849989557168e-01   +1.502315503659582e-02   +2.154030802368164e-01   +1.740373129468734e-01   -4.888659110457203e-01   -3.652069161452006e-01; +8.293164713856074e-02   +3.189798414474834e-01   -2.084726890177462e-01   -3.039411673208918e-01   -9.271849992612530e-02   +1.205851456572988e-01   -2.421079747109164e-01   +3.211248822933699e-01   +1.049773974795664e-01   -3.938352579257246e-02   +3.201454605927105e-01   -3.100541484370015e-01   -2.402851768476151e-02   -3.203596941350120e-02   +7.880613468098829e-02   -3.189956844286998e-01; +5.500824146075672e-02   -9.389834664114133e-02   +1.084268771244487e-01   +2.687196668096586e-01   +3.436103393286427e-04   +1.630840243217205e-01   -1.246817476819581e-01   -2.403922574287365e-02   +1.575980072193152e-01   -3.650986628762490e-01   +6.470895140915989e-02   -3.301595284195300e-01   +1.145525949437278e-01   -7.774583193229107e-02   +3.915583599430275e-02   +7.082820017409604e-02; -1.238967293517651e-01   -3.819450606558766e-01   +6.938683081147812e-01   +1.418886917919866e-01   -2.031139055688012e-01   +2.835169776222826e-01   -4.307295719835845e-02   -3.951092643625741e-02   -5.142151365761275e-01   -5.159614379990736e-01   +2.016159244623463e-01   +2.158135933036692e-01   -8.793207910179399e-02   -4.021621696625970e-01   +3.355976194818401e-02   +8.146706341647580e-02; -1.059007252446544e-01   +4.454694701474337e-01   +2.148786456401268e-01   -9.930756389332371e-02   -1.345305736578583e-01   -5.539712386477028e-03   +1.440901800705794e-01   -3.804266559368620e-02   +2.556385280527566e-01   -1.775606290327812e-01   -4.280400315603277e-01   -6.703816381314312e-02   +2.911392784820833e-01   +3.138470337728408e-01   -4.184263794044309e-01   +1.030490286173082e-01; -3.342954071754902e-02   -2.728102664434792e-02   +2.032299979098311e-01   -3.054898628173089e-01   +1.403584577674555e-03   +1.520153749932561e-01   -8.194529405923717e-02   +3.800157869854541e-01   -2.827854654308484e-01   -4.939034817155735e-02   +1.293208667620470e-01   +6.690211045558635e-02   -3.729691706062948e-01   +3.786613327182654e-01   -5.712102210311890e-02   +9.899513425986216e-02; -8.788963497971050e-03   -2.645230316590667e-01   -1.873034319950127e-01   -5.336117160804057e-02   -3.831534923231937e-01   +5.818295447946244e-02   +1.712375824387700e-01   +4.013984937279527e-02   +1.895161436566050e-01   +1.320344856906208e-01   -2.746835034344322e-01   +4.268155864935210e-01   +2.725491335541674e-01   +5.523280191965088e-03   +7.856659685651807e-02   +5.028273830935256e-01];
L1E_L1I_iGABA_netcon = [-4.574432899780940e-01   -4.111996190871070e-01   -1.833751736961259e-01   -4.317213188571132e-01   +4.043220530981946e-01   +4.099703187945448e-02   -1.180760938507628e-01   -2.719677176220010e-01   +2.407694723362914e-01   -1.681564022014435e-01   +5.536955287820799e-02   -2.902222435200380e-02   -1.441410486702732e-01   -1.266618814594820e-01   -2.694359011533486e-01   -4.514826801162690e-02; -2.611940559354944e-01   +3.255949412993437e-01   -2.117042215970167e-01   +1.991373491769977e-02   +1.263315799631275e-01   +1.859090748131536e-01   +1.069585295508457e-01   +8.428906218754209e-02   -7.312826920169629e-03   -1.811311706663671e-02   +1.742387628192465e-01   -2.218691217309536e-01   -3.884514507042845e-01   +1.393509950481096e-01   -3.176145312870635e-02   -2.791144009187192e-01; -2.180265139730491e-01   -9.056958702672424e-02   -3.804261074231126e-01   +1.611745816621597e-01   -2.144513958359310e-01   +1.289819233641717e-01   +1.051657484731217e-01   -8.105366492308641e-05   +2.629286794643230e-01   +1.347512720564041e-01   -1.232900239788731e-01   -2.341154060986483e-01   +1.779391013600962e-01   +3.106661867709711e-01   -1.880205153194851e-01   +3.988263268388382e-01; +4.836778736818119e-02   -1.257844686510761e-01   +2.437832696026768e-01   +3.426045486533418e-01   +7.239738090407580e-02   +1.557098297729017e-02   -1.622545342129753e-01   -1.291584413844330e-01   -2.673557839560996e-01   +2.235195376288565e-01   -2.093951623228696e-02   -5.279109368927196e-02   +3.002436772866225e-01   -5.757494318224088e-03   -1.240272926661749e-01   -1.096074223265718e-01; -1.475735348224715e-01   -1.802764741668772e-02   +6.478298145540418e-02   -8.326915335200155e-02   -1.018840913782023e-01   +1.948736184281751e-01   -3.142771742473485e-02   -6.495094359109710e-02   -2.293523207527082e-01   +2.576980478299657e-01   +2.393590956414451e-01   -2.624052258935156e-01   -1.274495676722663e-01   +2.340349447912212e-01   +2.090309187517442e-02   +1.070745424366967e-01; +1.517326711593655e-01   -2.253138073106770e-01   -2.521121109897489e-01   -3.338224423800580e-01   +1.668118900948807e-01   +1.676782584649223e-01   +2.150854593852071e-01   -7.781765466585849e-02   +2.102202578928197e-01   -2.061911097744185e-01   -3.718354328101325e-02   +2.752788382933496e-01   -1.504242947804135e-02   +3.692626746423455e-01   +3.363846927700245e-01   +1.120891763856848e-01; +2.908818780827958e-02   +6.623962818822510e-02   -1.940413327470941e-01   -6.725438915795676e-02   +1.270868220731062e-01   -5.603730788461075e-03   +6.945391896242316e-02   +2.114662496602835e-01   -1.302451358987787e-01   +3.267256351801052e-01   -4.030367380554574e-01   -3.443512091326493e-01   +1.559237177855988e-02   +1.882073319322616e-01   -2.539383868047259e-01   +1.572793085413828e-01; +8.631192725359910e-02   -4.988999529201346e-02   -1.137485854301493e-01   +1.314621348709438e-01   -2.057918730075181e-01   +2.774045074553865e-01   -2.467021274242026e-01   -1.400858415639767e-01   +1.525580796128308e-02   +3.532836819631823e-01   -2.844295805628877e-01   -7.315254639506495e-02   +1.733915519324483e-01   -6.106869348854665e-02   -4.932850217246636e-02   +3.919499452685259e-01; -5.057854004767262e-02   -3.501345392215147e-01   +1.085071369056571e-01   +2.511777231334867e-01   -1.694152237822076e-01   -8.388188277266936e-02   -3.422844643810622e-01   +6.463226126309427e-02   +2.104367466110385e-01   -1.576905796746811e-01   +3.254921763572771e-01   -3.946427551214390e-01   -3.707924005428392e-01   -1.959992774366618e-03   +3.458776184388345e-01   -1.368015479066122e-01; -2.081577504651131e-01   -2.267412961545967e-02   -1.459600842200868e-01   +4.417892464503297e-01   -1.575951854864211e-01   +5.125530651785715e-02   -4.559861790550560e-01   -5.236595618861504e-02   -1.194578192831983e-01   -2.704722316977930e-01   -5.204543742850724e-01   +1.625305015105098e-01   +1.698888097339014e-01   -2.170866179830867e-01   +3.288176461243452e-01   -2.911536107977969e-02; -2.944185136093693e-01   -1.123813461169333e-01   +1.891991240815616e-01   +3.210243883259294e-02   -2.410802933116199e-02   +1.350642600479323e-01   +3.934590682196539e-01   -2.375819204964486e-01   -1.319287818126172e-01   -1.286232858955144e-01   -1.817963310076999e-01   +4.375363238550908e-02   -2.883902918814258e-01   +1.099948675076356e-01   -9.551567398401974e-02   -5.840453100018801e-02; +2.961866382298915e-01   -2.016528415556184e-01   +7.465881038659097e-02   -4.498879591314678e-02   +1.547271737873694e-01   +9.203579101290069e-02   -2.400412711072762e-01   +3.988149949819834e-01   +4.682369207429005e-01   -2.180640168591505e-01   -1.071337273115118e-01   -1.284378670820137e-01   +3.239431208478317e-01   +3.691421374462662e-01   -2.029227881666035e-01   +9.855489896541483e-02; +1.973696651316541e-01   -2.988700411084531e-01   -1.199839628949032e-01   -3.997255283241663e-02   +4.137392187334018e-02   -9.196790018825585e-02   -6.177308025139622e-02   +1.931591164667599e-01   +1.181026120018989e-01   -9.064074751834170e-02   -1.668384417417366e-01   -6.419599766714390e-02   -6.546989479021291e-02   -4.219523800425471e-01   -1.011128776876618e-01   +4.961845780170169e-01; -3.966115720969043e-02   +7.943191171158429e-02   -3.173533736945001e-02   +7.052151565703463e-02   -4.328375811993727e-02   -5.281937076250391e-02   +6.699523996832740e-04   -1.083189387154978e-01   -5.623234065205082e-02   -3.166523141153538e-01   -1.322789289972394e-01   +2.624397771171771e-01   -5.617222633910043e-02   +9.520548188448681e-02   +9.693547642283598e-03   +3.669780478550254e-02; -3.470881268074064e-01   +2.287649424784683e-01   +2.088406046936574e-01   +1.951392162789090e-01   -2.764534329483537e-03   +5.247532943766489e-01   -2.196599474388073e-01   -3.381885456129824e-01   +1.548405474406821e-01   -3.125223358177998e-03   -2.424322300380449e-03   +2.563959700392285e-01   +1.545188789074405e-01   -4.522025129240868e-01   +5.623036499950354e-02   +1.939416578088796e-01; -3.363596651998262e-01   -8.728222888331836e-03   +1.424975684537527e-01   -3.751734595258671e-01   +9.550432932711936e-02   -1.151845187980468e-01   +2.045107405950480e-01   -4.858716590746770e-02   -1.353825130769259e-01   -2.446607384549825e-01   +1.697817058162416e-01   +1.428015891513145e-01   +3.067664523391976e-01   +2.108662901864318e-01   +1.224595701656140e-01   +2.340935312014337e-01];
L2I_L1I_iGABA_netcon = [-1.696712686547057e-01   +1.016510938644738e-01   +3.998127510482398e-01   +2.285421604514717e-01   -2.509116290542170e-01   +2.233791994332108e-01   +1.319584031632627e-01   +9.348373169021802e-02; +2.105120724140123e-01   +9.300157199288042e-02   +1.010031878580147e-01   -2.811226603488393e-01   -3.169850522511884e-01   -1.184008235589123e-01   -3.855420340727631e-02   -1.837333462651291e-01; +2.123363759869193e-02   +1.375866100745695e-01   -1.017245332970101e-01   +3.263108917900424e-01   +1.549848113269363e-01   +1.581943378807110e-02   -1.828348385999476e-01   -9.078374908122971e-02; +2.995045943062562e-01   +3.822352544622752e-01   +7.330939187905128e-02   +2.029152698676123e-01   -1.160099696977874e-01   -2.649811329224374e-01   -2.150770643155961e-01   -5.861266847020666e-03; +2.169213929524212e-01   -5.878488222953787e-01   +2.686407249748750e-02   -4.550037724934809e-02   +3.925312482177538e-01   -1.435230313404722e-01   -4.001582305022705e-02   -2.232729912059902e-01; +1.703633941873412e-01   +2.683794940927794e-01   +1.758265529944481e-01   -3.094296250405156e-01   +3.419647133658503e-01   +2.100949134200694e-01   -2.036137549085833e-02   -1.368954707730966e-01; -1.114145896683478e-01   +7.921869419284053e-02   +7.400588267284136e-02   -5.963622335393914e-02   -4.516797210364828e-01   -1.025139688752479e-01   +1.939218018224330e-01   +5.787089121967926e-02; -3.220356495614442e-02   +2.985581921865876e-01   +2.643329515864423e-02   +1.715434185437592e-01   -9.476580665389352e-02   +2.637038466631259e-01   +2.251341341569946e-01   +5.111383989097846e-01; +2.433023848482729e-01   -3.369863442149407e-01   -1.098550224795247e-01   -7.562626564931173e-02   -2.303903569187260e-01   -7.683232461511266e-02   +1.813378760005230e-01   -9.515105430499431e-02; -1.626116730803686e-01   -2.713538376303091e-01   -3.592043222736126e-01   -3.733172458442405e-02   +5.294123232521597e-01   +3.215783858353685e-02   -8.103150284239906e-02   +1.161857763215314e-01; -4.110940524126769e-02   -5.321285276863408e-02   +5.847348332833013e-03   +7.775553685600964e-02   -4.657938418738979e-01   -2.615621763144081e-01   -7.612340636396886e-02   -1.151185460182971e-01; -1.121758882710147e-01   +2.303922917536259e-01   +3.039653550823841e-01   +1.723356294343664e-01   +2.875230321566363e-01   -2.694677418464270e-01   -2.935699056642266e-02   -2.742704296631070e-02; -2.110054081640415e-01   +2.234231847879471e-01   +1.648673604161257e-01   +2.059841628094693e-02   +4.595517070526386e-02   +1.002764760722351e-01   -2.028679072154054e-01   +4.037744140130214e-02; -8.035894502113024e-02   -2.793391199056536e-01   -1.242451303263776e-01   -6.802828585627782e-02   -9.853849578749707e-04   +3.401937418385335e-01   -2.725733933791079e-01   +1.897980813482356e-02; +3.287867963676598e-01   +8.709496656389565e-02   +2.912791839166213e-01   +1.782407935109860e-01   +1.956486303453287e-01   -3.868822681004666e-01   +1.228734842223799e-02   +4.025957352827494e-02; +2.109761790168954e-01   -1.328621073705650e-01   +1.278892707079838e-01   +7.496665103413068e-02   -1.142726125605903e-01   -1.994574745019883e-01   -1.479406105733714e-01   +1.155460675223163e-01];
L1I_L2I_iGABA_netcon = [+3.100239249338799e-02   -3.700176055266636e-01   -1.350328662004419e-01   +1.445649507636766e-01   -2.243525540024660e-01   +3.589936142410269e-01   -8.636489200151824e-02   +2.713568132877086e-01   -7.499046180174475e-03   -1.327526598636220e-01   +7.965531678143201e-02   +1.515646185372282e-01   +1.106819272564436e-01   -4.403528989699140e-01   +2.330022973431828e-01   +4.179010234575176e-03; -1.749483309183971e-01   +4.695403694297512e-01   -1.805143481604854e-02   -1.850345864276428e-01   -6.030964689890986e-02   -3.319598907591331e-01   -3.232346553398623e-01   +1.633104265583978e-01   +8.092816199974295e-02   -5.491925035161414e-01   -2.880763534204606e-01   +4.942487019102705e-02   -3.014068172011091e-01   +2.399962655707599e-01   +1.909638610638914e-01   +2.287484041026575e-02; -8.221710903660828e-02   +2.051393233074655e-01   -5.144160361458915e-01   -2.669226534954433e-02   -3.361247261396400e-02   +8.543785343409055e-02   -6.524862018097338e-02   +4.328455588852281e-03   +4.127404045668885e-01   -8.290835933997129e-02   +1.250835582872602e-01   +1.758019395651004e-01   +1.451344996350052e-01   -8.099471578192471e-02   +3.456549442750438e-01   -1.211957256315823e-01; +2.088573838817502e-01   -3.979026855589972e-01   +1.442794961957513e-01   +4.426633149683788e-01   -1.197634753338731e-01   +1.183039435819133e-01   -2.355150834721237e-02   -2.891512522142683e-01   -2.085422128258813e-01   -3.078820592606121e-01   +8.751034611730735e-02   -2.057520974076434e-01   +2.204789010884465e-01   +1.858461675402117e-01   -1.744505873249806e-01   -3.282113823982047e-02; +1.581254304716232e-01   -2.621648822882494e-01   +1.539633142184696e-01   -1.114391891056402e-01   +1.494204584927393e-01   -2.001268867470274e-01   +9.742734548970550e-02   +3.502386987546732e-01   +2.219829120738056e-01   +3.119852612221994e-01   -7.917129685230800e-02   +3.215341815772593e-02   +1.220192974149912e-01   -2.483071617464192e-01   -1.789265659114970e-01   -2.833041417543662e-01; +8.667033985003572e-02   -7.356427217382977e-02   +2.337800101389986e-02   +3.359535838681239e-01   +1.045999279540534e-01   +3.903372575012882e-01   -1.106616116885027e-01   -3.163715625181010e-01   -2.769847943744362e-01   -2.501820571185667e-02   +1.028883787876493e-01   +2.258392635664453e-01   -1.287242005664213e-04   -1.034551047353798e-01   +9.439841143494883e-02   +1.132569120482566e-01; -4.034764031580043e-02   -2.870745329507789e-02   +2.551983604856024e-01   -2.943909592468882e-01   -3.492846033832803e-01   +8.004213894380408e-02   -3.465543993148007e-01   -1.784514493441881e-01   +1.844222570872794e-01   +1.061744016019309e-01   +1.908033976847646e-01   +3.811433244067258e-01   -1.450727015894812e-01   +7.239098257733607e-02   -6.734177249798008e-02   +3.273304837782878e-01; -1.686459054926915e-01   -1.876158937187607e-01   +2.947960446354496e-02   +1.626705856134109e-01   +2.513055194380818e-01   -8.588164202714271e-02   -5.315014427926769e-02   +3.810888118245816e-01   -8.151152497175052e-02   +1.114659985276221e-01   -3.241749807619544e-01   +1.820751615084970e-01   -4.369636694406173e-01   +1.386234450155090e-01   +3.630242237795764e-01   +1.960751893767575e-01];
L2E_L1E_iAMPA_netcon = [+1.209270126966972e-01   +3.037729289247971e-01   +2.078840570148852e-01   -2.369922979578787e-01   +2.008764741914650e-01   +4.471327275587716e-02   -1.484813798591516e-01   +1.769024068987090e-01; +1.677259291190241e-01   -1.611156542080047e-01   -3.694774623071390e-01   -3.381830294950280e-01   +2.847787122773189e-01   -2.586915424299811e-01   -4.836540575620525e-01   -3.559406417312863e-01; -1.927765718798428e-02   +6.274897205454177e-02   +4.303666274626338e-01   +1.958177601708551e-01   -1.219604493845047e-01   +1.227331766688446e-01   +1.081127725913165e-01   -7.054343202275073e-02; -1.524348785237926e-01   +2.448789800504344e-01   -4.253591880819602e-01   -2.429850109505491e-01   +1.005962005684336e-01   -2.472966668614984e-01   +3.716359502655945e-01   +1.958780541968924e-01; +3.403060096452354e-01   +3.178966999282477e-01   +8.267913394887773e-02   +6.150319291492490e-02   -1.257298058325681e-01   +2.800022214230661e-01   +3.046690656164457e-01   -7.873198322500295e-02; -3.746738262288915e-02   +1.427444893765788e-01   +2.611427692982560e-02   +1.473270326716992e-01   +2.264653348269604e-01   +7.133202932814312e-02   -2.641491618740138e-01   -1.024462604525601e-01; +6.698067677378411e-02   -3.585405616891650e-01   +1.282754354861348e-01   +4.008567943459483e-01   -3.187255419656670e-03   +1.675301772777676e-01   -3.454781506518296e-01   -1.481890080644612e-01; -4.940593756225199e-01   +2.973764324867481e-02   +1.499414290605644e-01   +3.294483065131162e-01   +4.661819381993292e-01   +1.272594196986179e-01   +2.697588625794966e-01   +1.706353990420331e-01; -1.555541905556888e-01   -5.030014850201412e-02   +1.929602169703354e-02   +3.054576304155087e-01   +2.748199842583336e-01   +4.901216149751897e-01   -4.342749693743116e-02   -3.264373017860168e-01; +1.638729703534736e-05   -8.452926983176420e-02   +1.358782700067587e-01   +1.879453535609223e-01   -3.230320444241297e-01   -2.456104150477709e-01   +1.269752362843219e-01   -1.175851996146598e-01; +1.892264950009064e-01   -8.540800676659542e-03   +3.851120979462616e-01   +3.218478495338795e-03   -5.323575419800414e-02   +6.941235041766006e-02   -1.105633759175195e-01   +2.458637283410091e-01; -2.128299122466169e-01   -1.106536262806923e-01   -1.787754893333939e-01   -3.331259514705680e-01   -3.559723503103998e-01   -3.701268089209592e-02   +1.813409764449022e-01   +1.389426949750799e-02; -1.114444735949813e-01   -3.133701814318525e-01   -1.871099812743094e-01   +4.134750055505874e-01   -1.259903812860401e-01   -5.599711089597650e-02   -3.648444911624836e-01   -1.311993896796639e-01; +3.284226242049888e-01   +2.550681899037307e-02   +1.546753446501500e-02   +3.331442353196661e-02   +2.099230357564210e-01   -3.330051642659017e-02   +1.355282163857351e-01   +1.787455313741123e-01; -1.249546903238613e-02   -8.700948299873029e-02   -1.025549734803277e-02   +2.300219222803313e-01   -1.894986499877432e-03   -1.618247605424913e-01   -2.919586086323130e-02   -1.167787129973591e-01; -2.076471437654292e-01   -3.246315285141531e-01   +7.468702810584855e-02   -3.843909279280106e-01   -1.851248072965732e-01   +1.658323588479249e-01   -1.395649451318032e-01   -8.374503468042047e-02];
L1E_L2E_iAMPA_netcon = [-3.116163823735145e-01   +3.704761703029787e-01   -2.881506979914893e-01   +3.076118607995077e-02   +9.679425182605556e-02   -1.046888454708166e-01   -5.268676904518543e-02   -2.043756452396307e-01   +2.645269954292848e-02   -1.359655512754569e-03   +1.591455334881429e-01   +1.269601658182831e-01   +2.779809012934116e-01   +6.228264889693857e-02   -1.957937505351210e-01   -2.687241106526023e-01; -2.514126691310641e-01   -3.698368789149225e-01   -7.999237976070966e-03   -2.950689335617400e-02   +1.623254525294508e-01   +2.086760749796771e-02   -4.477665103796007e-01   -8.316813995923419e-02   +1.851434878994759e-02   +2.153301662267876e-03   -3.085544408123013e-01   +1.708385327768635e-01   +2.324286029359199e-01   -7.980091364343364e-02   -1.050913625434172e-01   +5.990617097380416e-02; +1.760148223890448e-02   -2.499872627349731e-01   -2.383350736490792e-01   +4.836277718829121e-03   -9.884100986032285e-02   +7.994979525145297e-02   -2.916681290647377e-02   +3.920587716966535e-02   +4.906834422121338e-01   +2.341198565635771e-01   -7.631033854578702e-02   +6.334652766211031e-02   -7.462776261474577e-02   +3.697767847880810e-01   +1.808886681699209e-01   +1.743030116041522e-01; -4.644734052729731e-01   -2.152878064587903e-01   +4.825045151661529e-02   -2.148963338193847e-01   -3.821206628542434e-04   -7.151867632600936e-02   -2.180986803550959e-01   +2.124109193624422e-01   +3.960998351218728e-03   +2.307413157989152e-02   +9.768885770924868e-02   +1.265731613707673e-01   +8.813860136847464e-02   +1.333285320478454e-01   +1.540879354789316e-01   +1.306494631821801e-01; -1.230506230667391e-01   +1.268763622370956e-01   +2.891386678796394e-01   -9.032646966506382e-02   +2.800097582986385e-01   +1.176606738143610e-01   -1.552718056287766e-01   -2.704128422169101e-01   +8.900006677522296e-02   -2.051554704538108e-01   -2.387387999454161e-01   -1.023050092439292e-01   +1.109212770848060e-01   +3.031830482684958e-01   -1.377821318029764e-01   +3.597499998208918e-01; +3.602578463695136e-02   -1.030263397297274e-01   +3.043305663119868e-02   -1.953989078640895e-01   +1.712787382447964e-01   -2.189296551106508e-01   -1.312805664622417e-01   -3.759317933904814e-01   -3.457467829401776e-01   -1.505921245006709e-01   +4.523476546092961e-02   -1.890671762080451e-01   -9.921315173244960e-04   -1.721985955765431e-02   +2.003095602713898e-01   +1.207798026286615e-01; -1.005332919884250e-03   -3.170255118189271e-01   -5.011357611948527e-01   +3.625281445749358e-01   +2.971307905925624e-01   -5.995098596500703e-01   -1.460689691373149e-01   -2.307880401684788e-01   -1.603822226046536e-01   +1.520914306650552e-01   +4.760713996374696e-02   +4.350301462852313e-01   -3.457908971667054e-01   -3.974891158126326e-02   +4.803579066004108e-01   +1.906949923960199e-01; +1.888342119756926e-01   +5.119810809403577e-02   -1.128178536896524e-01   +3.792707289424299e-01   +9.807582617918244e-02   +1.421707747485611e-01   +2.570579037422762e-01   +2.796344350887367e-01   +3.118438442356775e-01   -2.578091127559946e-01   -2.833061392901698e-02   +8.720979320416973e-02   -2.226543082192900e-01   +3.529951633530932e-01   -1.843973903534973e-01   +5.297002530079153e-02];
L2I_L2E_iAMPA_netcon = [+3.063651840770018e-01   -2.823668601908309e-02   +3.412419513792022e-01   +1.297954014431985e-02   -1.200621662520062e-01   +4.684693716686764e-02   +9.844844478879215e-02   -2.031028812864476e-01; +2.704775217621493e-01   -3.696731452506580e-02   +1.320691580892919e-01   +1.355578767323377e-01   +8.932023492951005e-02   -5.878121935864589e-02   -1.135382126655032e-01   -3.992734458658193e-01; +9.220469427633934e-03   -2.497197459958530e-01   -1.975546065946670e-01   -2.046936879124978e-02   -1.744495600634771e-01   -3.037050512666546e-02   -1.188726636755417e-01   +3.789041083910211e-02; -4.287982768670420e-02   -9.332062513062023e-02   -4.893756138381428e-02   +1.757773636782554e-01   +2.121234728478053e-01   -6.775463177925753e-02   +1.831979257237839e-01   -1.291186915161940e-01; -3.193701635325131e-01   +4.061495304439754e-01   -9.154118508495430e-02   -3.184028795938180e-01   +4.008794785159724e-01   -1.409726502849210e-01   +2.100301889942732e-01   -1.847943464919259e-01; -2.090536978936843e-01   -4.453492644912134e-01   +1.207731727471640e-01   +2.524652654557130e-01   -1.295075938522089e-01   +7.923453423800701e-02   -2.291556492103070e-01   +3.197093776125389e-01; +7.198116000011440e-02   -2.172398667179029e-01   +3.056769155669574e-01   +1.404010286220767e-01   +5.708815667404792e-02   -6.718584529803100e-02   +6.130291947387889e-02   -1.554354092609865e-01; +2.332763348986717e-01   +3.740603278500970e-01   +7.383097831284355e-02   -3.578872205512776e-01   -2.085708378205434e-02   -4.230972320733600e-02   -5.967948785844220e-02   +4.540024339147815e-02];
L2E_L2I_iGABA_netcon = [+2.885004889338659e-01   +2.693878645470718e-01   +1.785773092260016e-01   +1.083625177594930e-03   +3.035993554108784e-01   -6.256652598860485e-02   -4.226772497489941e-01   -5.679161015416965e-01; +1.581834215935420e-01   -2.270928787210780e-02   -1.152427910390777e-01   +1.140692644353879e-01   -9.225661293603311e-03   +4.019316292604128e-02   +3.433507665360584e-01   -6.668655125741749e-02; +4.473421955432704e-01   -4.862532939575778e-01   +9.546388840938674e-02   +1.477291399147111e-02   -3.464830201573106e-01   -3.034796188651065e-01   +9.501415405638156e-02   -5.891599245217960e-02; -1.259254261306725e-01   -2.771870360628399e-01   -1.729856309517604e-01   -2.099146256047315e-01   -2.963060626371204e-01   +1.338835918371620e-01   +3.401244175419312e-01   -8.059979399917211e-02; -3.559930809060075e-01   -8.868854208395071e-03   +5.200460776877812e-02   -4.681041385925588e-02   -1.382072119270709e-01   -9.985619720275268e-02   +4.142988664662899e-01   +9.562952274739642e-02; +9.534397420511975e-02   -2.669394186814300e-01   -2.679226108178561e-01   +6.814656947928299e-02   -9.935398882325186e-02   -9.078040902547485e-02   +2.117338325043339e-02   -7.486552094534443e-03; +2.635227341627875e-01   -3.509195440896846e-01   -3.345623476598772e-01   +3.611631737863233e-03   -2.703505563654915e-01   +2.115180761680579e-01   +2.091645568326927e-01   -6.933421018447919e-02; -3.494983395303760e-01   -2.832920610484277e-01   +3.313629351672507e-01   -4.517815128168883e-02   +1.846939038097737e-01   -9.781832005818970e-02   -1.565765686076713e-01   +4.463878499912714e-01];
L3E_L2E_iAMPA_netcon = [-4.916991669153485e-02   -2.534661651796853e-01   -4.267798767930987e-01   -2.267859571985305e-01   +2.594710784915944e-01   -3.408923319479543e-01   -9.181136556903113e-02   -4.714996743247823e-02   -3.670052245448918e-01   -2.180377435496600e-01   -5.368359177025277e-02   -2.478445249639022e-01; +3.714986725310865e-01   -1.039264711278940e-01   -2.283302939614990e-01   +2.289293624566319e-01   +3.012506764976723e-01   -7.925799311996495e-02   +9.279338512242521e-02   +1.856901296359015e-02   +3.263703353644019e-01   -5.114893471217539e-01   -1.315318583630994e-01   -8.705914089304140e-02; +1.586678140813228e-01   -3.441138144040766e-01   +1.580956464462889e-01   -5.004458538254158e-02   -4.225308957689433e-01   +1.518216772982514e-01   +2.993199277162952e-01   -1.036407427267560e-01   +2.507457169625987e-02   -1.176616226825362e-01   -2.289551511059899e-01   +2.621183630351358e-01; +3.521162301883934e-01   +2.284921124667051e-01   +1.773891967095916e-01   +7.938835287592852e-02   +1.547888665608455e-01   -2.212774479905254e-02   +3.369734864174173e-01   +1.597157699727995e-01   +2.165096555410760e-01   -2.417903910544247e-01   -9.337976149853386e-02   -2.911484920518139e-01; -1.668682554595583e-01   +2.536189522135271e-02   +4.846867098986335e-02   +3.919437517975677e-01   +1.012382454222321e-01   +1.866412876894646e-01   -3.323442392112897e-01   -7.818848488588911e-02   -2.786343423252710e-01   -2.454945643597189e-02   -9.282103744579440e-03   -9.188347765975116e-02; +5.839322533583137e-03   +3.859081401499388e-01   +2.050666288470620e-01   +1.784933931806965e-01   -1.343671527273794e-01   +1.118914419945412e-01   -2.223536573223311e-01   +2.605953925477794e-01   -2.046997667530718e-01   -2.907655766984572e-01   -1.041218481242451e-01   -1.826850727905154e-01; -1.461471141979614e-01   +3.780533963951525e-02   +1.077270011986606e-02   -2.068568896847411e-01   +1.828793902677233e-01   -1.316437766350910e-01   +1.580332643189717e-01   -2.841575572563499e-01   +2.698471032939500e-01   +2.525264815453811e-01   -1.371940564195202e-01   -6.529071083087873e-02; -2.008675910333358e-01   +4.330679600050552e-01   -2.111764328744807e-01   +3.350633341454404e-02   +1.910269172896324e-01   +6.875079614828054e-02   +4.750032950052068e-02   +1.201656375053348e-01   -1.310783264572229e-01   -1.758666799842062e-01   +2.563227884968351e-01   -3.277385056929780e-01];
L3I_L2I_iGABA_netcon = [-1.332025969752576e-02   -2.614528262098152e-01   -3.341063892692408e-01   -1.296514764951927e-01   +1.419565526910654e-01   -1.408379426736399e-01   -2.200717267309570e-01   +1.674472547190822e-01   +4.494388357659196e-03   -3.559787512098188e-01   +1.143094613225139e-01   +3.132214494677693e-02; +2.220262234455450e-01   +2.711694617059006e-01   +2.150073374326639e-01   +1.012133418689531e-01   -1.959537153535137e-01   -1.592059899775648e-02   -1.305286598565585e-01   +2.210032749247131e-01   -3.513188630505663e-02   +4.975843782751225e-01   +2.217883594157573e-01   +2.333314246636634e-01; -3.268846526851463e-02   -8.579526771669885e-02   -1.061953195825612e-01   -4.211799226802585e-01   +3.086305045589648e-01   +1.720484396911766e-01   -1.216326449517749e-01   -1.233307163289930e-01   +1.152226940650767e-01   -8.282449239239276e-02   -3.954347536400415e-02   +2.265810052273888e-01; -1.642511088001425e-02   -1.971626917017984e-02   -1.045180232429700e-01   +2.278082510282018e-01   -4.760435407325460e-01   +1.169414332517497e-01   -3.507915226729748e-01   +2.715108412360046e-01   +2.390706675948206e-01   +1.307340936507084e-01   +1.461821591760533e-01   -1.170004416277635e-01; +6.294507294560144e-02   -9.359935104928521e-02   -9.678601281526646e-02   -3.391240322253530e-01   -1.067364678041155e-01   +3.067854169819647e-01   +2.229274690877568e-01   +4.226185554884735e-01   +5.428232047654580e-03   -3.041018680871074e-01   -3.319088900351337e-01   +2.159008389371271e-01; -2.852524482823622e-01   +1.473573927405603e-01   -1.682586832542059e-01   -4.085592969001784e-01   +6.610243138608109e-02   +1.268138874999601e-01   +3.531370208063149e-01   +2.515517566532329e-01   -6.701673755892021e-02   -1.107154832585339e-01   +3.899838996246416e-01   +3.336469971325115e-01; -2.923134255318720e-01   +2.088925872477358e-02   -9.695229949960499e-02   +2.610111496287975e-01   -3.368924053170800e-01   -2.308878505566297e-01   -9.619134024020684e-02   -1.437133826428692e-01   +1.759907272138046e-01   -3.662961295860861e-02   -4.257886339854531e-01   -3.720374788182833e-01; +5.626288424308681e-02   -2.610643664531657e-01   -1.970384164981286e-01   -9.114118375315694e-02   +1.830875872804447e-02   +1.869273846968987e-01   -1.073030973519660e-01   -2.407233884461444e-01   -3.923327422576319e-01   +2.795642942896173e-01   -8.536558031314531e-02   -3.618405259985048e-01];
L2E_L3E_iAMPA_netcon = [+6.950961233737035e-03   +2.974259304757877e-01   -2.726395033307797e-01   -1.651725498230593e-01   -2.486006319912542e-02   +2.366997852373673e-01   -3.337624841320342e-01   +1.316473557231610e-01; -2.020911027765758e-01   -4.999334955742485e-02   +1.666861968248535e-01   -4.046392266853674e-03   +5.307826330785897e-02   -4.640997358927275e-01   -1.753132258049131e-01   +9.478538227885396e-02; +1.583242950523899e-01   -3.998901064844470e-01   +6.335648642798498e-02   +2.900016299593516e-02   -5.335727056399184e-02   -3.638294752465365e-01   -2.853647065537507e-01   -2.749678064422491e-01; +3.785914796415609e-01   +1.212044367148581e-01   +4.295756562645212e-02   +1.887873790153441e-02   +3.090136290369762e-01   +2.503892632958374e-01   +1.840208805033084e-01   +3.925959924872485e-01; +8.122034537377082e-02   -2.932021515456577e-01   +6.351128150856149e-01   +1.619219998686087e-01   +1.024657964021214e-01   +1.815742375584118e-01   +4.089504279893075e-03   +1.080981811825061e-01; -9.213957136694678e-02   -2.064746360486616e-01   +1.103560004363984e-01   -6.832625268901145e-02   +4.077229338684868e-01   -3.086804545677575e-02   -3.173240629089776e-01   -1.543271741542336e-01; -5.332542717912552e-02   -3.584583497517047e-01   +9.717362708718677e-02   +1.922950325136076e-01   -3.631664440203465e-01   +2.324401531342084e-01   -1.319667716333714e-01   +2.735823601971301e-01; +9.615967389905929e-02   -5.783218429913115e-02   +6.620696388448846e-02   -1.099595163906432e-01   -1.334430066743342e-01   -5.751807532687488e-02   -1.903771540394577e-01   -1.037688546328028e-01; +1.878150487867849e-02   +5.061498804020065e-01   -7.837366052331027e-03   -1.853919978823293e-01   +7.446407729718019e-02   +3.848486710885808e-01   -1.439655031366663e-02   +2.112375867563635e-01; -3.092443963266159e-02   +1.925736585948630e-01   +5.472865722592118e-03   +1.860995184076724e-01   +1.278536237554595e-02   -2.063741189354193e-01   -2.113015737921270e-01   +3.703423368029062e-02; +3.465148999117706e-02   -2.815974236291845e-01   -1.022813777891148e-01   +2.215745992427015e-01   -1.891368557649701e-01   -3.163244039472746e-01   +3.162904734082935e-01   +1.592524356394989e-01; +1.398523604318044e-02   +2.305380558802817e-01   +3.025661935403292e-01   -2.050765959969207e-01   +1.191238304488905e-01   +2.125468710615053e-01   -1.498456490496139e-01   -7.756070877798796e-02];
L2I_L3I_iGABA_netcon = [-2.275090704966511e-01   -1.156111926344285e-01   +6.824164655789616e-02   +3.227517074679506e-01   +2.499235585220960e-02   -9.278859048647931e-02   +1.811049644036184e-01   -1.406940240663314e-02; -1.003854384850805e-01   -8.051932188150990e-02   +2.608769094490753e-01   -1.956023593716998e-01   -4.296618323363565e-01   +4.038694246378021e-01   -2.980595594002838e-02   -1.612330937096912e-02; +5.890950711407456e-03   -1.339424363356839e-01   +2.088560833444544e-01   +6.721270689559872e-02   -1.209643081243931e-01   -1.903430072794509e-01   -2.046991213388621e-01   +1.869362329209405e-01; -5.793473826961243e-02   +3.226133872791549e-01   -4.496788717567206e-02   -1.428903647902194e-01   +6.480554075044080e-02   +3.718170566132963e-01   -2.203722705866854e-01   -7.547060031032257e-02; +3.877885204403376e-01   -1.572711518908802e-01   +4.296091165875278e-02   -6.590561616858157e-03   -1.253821011014904e-01   -1.139136932945250e-01   +1.817279165969102e-01   -7.144583931999274e-02; +3.070495701834236e-02   -2.420951809374646e-01   -4.773001616704564e-01   +2.223469728726188e-02   +9.299439585432558e-02   +4.021302516761537e-01   +1.831087963809549e-01   +2.120365733133243e-01; -2.847693455432221e-01   +1.546313455489904e-01   +6.703398910943548e-02   +2.757882765359091e-01   +4.690198933481892e-01   -7.480793339583869e-02   -6.780590457618416e-02   -4.266410004503635e-02; -3.213499495746164e-01   -4.260140609861962e-01   +2.999290094742710e-01   -7.398775467920128e-02   +1.750108794247760e-01   +4.458062906171422e-01   +1.155830820856951e-01   +6.626930843863693e-02; +2.166742048351684e-01   +2.167301467064638e-01   +1.603895034375069e-02   +2.242298138751217e-01   +1.177008478884320e-01   -2.612888738410694e-01   -2.283534500284046e-01   +3.386077608176360e-01; -1.580667936666579e-01   -7.394812121335402e-02   -4.337621677493619e-01   -1.214957688730269e-01   +2.015507183710554e-01   +5.470748737769150e-02   -2.442140980473137e-02   +7.964181464320842e-02; -2.186227256910622e-01   +1.469034815101865e-01   -1.016936028704299e-03   -1.591473003221211e-01   +1.418866426771885e-01   +4.436424219031745e-01   -2.495031319996546e-01   -2.000324519836361e-01; -6.467843989612557e-02   -1.597404712084740e-01   +2.000453665610842e-01   +1.163846148010658e-02   -4.090675101366134e-02   +4.452456691713169e-02   -2.890102277738809e-01   +9.459189068541440e-02];
L3I_L3E_iAMPA_netcon = [-1.398270307074238e-01   -7.214802962185402e-02   +2.316764150133771e-01   -2.302294792451652e-01   -8.711174541384223e-02   -1.033854933679049e-02   +2.676971191290643e-01   -2.713531892563721e-01   -1.784838869967894e-01   -1.578934948291471e-01   -1.470597847667939e-02   -7.412364241072139e-03; -2.576558630177422e-01   +2.796544677142924e-01   +2.552256190147021e-01   -3.973129356690149e-02   +1.981562154732973e-01   +7.576506701813060e-02   -2.829503999614100e-01   +1.757882551135219e-01   -1.590287607163050e-01   +1.467246317816169e-02   +3.540461614554442e-01   +4.173702094498682e-02; +1.104036298448670e-01   -4.155426335363520e-01   -1.838742407592601e-02   -3.566037495970902e-01   +1.638518716844418e-02   -1.410703273191767e-02   +7.994273025990462e-02   -4.509001244026955e-01   -3.078002033509333e-01   -2.311227925526334e-01   -3.496322495800235e-01   -7.008234027480872e-02; +2.057667584972036e-01   +3.635957123913229e-01   -4.222297147164143e-01   +3.561418223271596e-01   -5.698025039864749e-02   -1.823966546267307e-01   +1.216003540156445e-01   -2.503047405196483e-02   -1.330235657737494e-01   -9.328597069472147e-02   +2.994308814886871e-01   +2.453622455506594e-01; -2.373276598117854e-02   +1.767642990677726e-02   -1.561491108881358e-01   +2.436319604754315e-01   +1.877803717085078e-01   -2.176960310126735e-01   -2.592900061618555e-01   -3.523935995385155e-01   +2.175325215839548e-01   +1.674904525127469e-01   -7.029186431322273e-02   +8.238441990357062e-02; +1.549306789622826e-01   -2.018149430865706e-01   +2.285874326465198e-02   -3.447624837578694e-01   -3.105945237072522e-01   +1.577616022006312e-01   -4.298162092434089e-01   +1.636696307333450e-01   -2.142646446342347e-01   +1.202927148128546e-01   +4.575279835257509e-01   +4.529351329410794e-02; -7.166892074009848e-02   +8.890797453424532e-02   +1.449844475855456e-01   -1.867056821679660e-01   +1.818113377071770e-01   -4.408506801740970e-01   -2.621612506979604e-01   -3.129759544148739e-01   +5.440503686649840e-01   -7.394630808648495e-03   -3.151735868637290e-03   -2.613188546252070e-01; +1.535698129698497e-01   +8.259127137475994e-02   +7.109267899514396e-02   +3.262118862498573e-01   +1.004936166068453e-01   +6.939506384967759e-02   -1.213378088338851e-01   +1.892788358526681e-01   -2.773081165818471e-01   -1.524809136467147e-01   -5.139942103416140e-01   +2.971389853785862e-01; -2.269979550052429e-01   +2.181317732407038e-01   -1.202326985530409e-01   +2.904179151540219e-01   -1.911739181267285e-01   +1.382728238490152e-01   -1.457337062106645e-01   -1.646166402499073e-01   +2.492000803144859e-02   -4.464248076535196e-01   -2.121556423699439e-01   +1.181019304342271e-01; -3.200813986333941e-01   +2.493894793054430e-02   -2.362747275956341e-02   -7.323228151987655e-02   -1.144829530477482e-01   +2.065853589377420e-01   -3.445002245976195e-02   +6.870550016429722e-02   -3.785595855545691e-01   +2.062528917762534e-01   -2.671957529117466e-01   -1.301971757323316e-01; -9.351669679015226e-02   +2.351361705535105e-01   +7.889948055322599e-02   +1.314339861802374e-01   -1.388015733116960e-01   +2.165406985478165e-01   -1.862824720793999e-01   +2.640297830285541e-01   -3.520202804067501e-02   +1.459786663983002e-01   -1.607884849765774e-01   -1.931319527617606e-01; -1.047873192846927e-01   +2.763950451484227e-01   +1.119033018173119e-02   -2.534939286181876e-01   -9.522839062234359e-02   -1.163298467638494e-01   +1.447444774816675e-04   +3.898830698357014e-02   -1.737036753295261e-01   +4.204986278087230e-01   +1.173798472235613e-01   +1.972957741861242e-02];
L3E_L3I_iGABA_netcon = [-2.345971749050660e-01   -2.506553686147944e-01   +2.547854701646380e-01   +4.177847475329718e-01   +1.506942841169050e-02   +3.604910201674427e-01   +3.495264837237301e-01   +1.516456276334214e-01   -7.876695002722986e-02   +3.616695285333481e-01   +2.485652592813163e-01   +1.156730949645287e-01; -3.672210672459942e-01   +3.140891974297960e-01   -3.229860098152179e-02   -1.621331344258073e-01   +1.106613993065430e-01   +1.373338700102343e-01   +1.696579493040858e-01   +9.436990871813176e-02   -6.011131332248367e-02   -1.406659886534930e-01   -6.174470187541646e-02   -9.108633609068732e-02; +2.516413471797639e-01   -5.726842023354570e-02   -1.758073962796433e-01   +3.560838278655828e-01   +2.915689706541962e-01   -8.930057152781024e-02   -3.724204815604904e-01   -2.842535266476893e-01   -5.349469725812757e-01   -3.336030788588757e-02   -4.315079757518455e-01   -1.013081417664242e-01; +4.881122810202115e-01   -5.631528574375129e-01   -7.092822833674360e-02   -1.073519849290741e-01   -1.074048280927015e-01   -1.036109293422687e-01   +1.259767453303182e-01   -2.492781073850106e-01   -2.780360903080046e-01   +1.161410710452296e-02   -3.378612309439973e-01   -1.196083742337234e-01; -4.705515330505779e-02   +3.577815804500395e-01   +1.577301653289829e-01   -3.908035455694387e-01   +2.436211927004910e-01   +2.609958270727203e-01   +2.460172249277930e-01   +2.006411488383121e-01   -1.817030715719258e-01   +1.170240205959430e-01   -3.172593253980480e-01   -1.912531792516850e-01; +3.612502755686554e-01   -1.490341361264259e-01   +6.140419366867404e-02   +1.521315477023683e-01   +2.559388673695379e-01   +2.142037764693113e-02   +2.255134775742655e-01   +8.925810859801615e-02   +2.449136678948031e-01   -2.718784470441526e-01   -3.171332718697933e-01   +7.304872310924482e-02; +1.702015339158144e-01   -3.323043879932689e-01   -1.947543542169855e-01   -4.207298439197019e-02   -1.658687109406353e-01   -2.374779679283625e-01   +1.122185710069767e-01   +1.408536979729067e-01   -3.539950759544531e-02   -3.790690709063588e-02   +2.366782154906825e-01   -2.590180793218264e-01; -1.211674927068838e-01   +1.428780819524884e-01   -1.200689418192483e-01   +4.615566119196854e-02   -3.119269003947763e-01   +1.781676702637875e-01   +1.771918240084051e-01   +3.963408940108192e-01   -1.155211561554495e-01   -2.977419204821571e-01   -3.484026433740315e-01   +6.075441578239768e-02; +5.815239835144873e-02   +3.019541466319750e-02   +7.265765423896921e-02   +1.978180049182904e-02   +1.316987324468410e-01   -2.174122835715371e-01   -7.647376695477298e-02   +3.114447944410222e-01   -2.023514706603069e-01   +3.714615402745155e-02   +1.052271182940413e-01   -1.391503808322438e-01; -5.174576708671060e-02   -7.995479063608049e-02   -7.549639604236935e-02   -2.205598033070166e-01   +2.831566328726040e-01   +3.549821503734213e-01   +4.025150775649489e-01   +2.708453598689112e-02   +2.417648390520585e-01   -2.256969206531053e-01   +1.404275215544528e-01   +1.374820307178106e-01; +1.989731633250698e-01   -3.522166179038146e-01   +4.815482815583107e-03   -1.313598452563091e-02   -2.281967156753030e-01   +3.104677857944819e-01   +1.835371771006138e-01   +3.063666515132388e-01   +8.166253196173140e-02   -2.094335625022500e-01   +2.054878209359948e-01   +9.437931265836952e-02; +1.066657626617284e-01   -2.410450012169132e-01   +2.957225105760495e-01   -1.051872741107727e-02   -3.786458545014783e-01   +7.309422236024182e-02   +1.946174942770897e-01   -2.805434265208517e-01   -1.946110127023122e-01   -1.143673640803559e-01   +2.549358736128621e-01   +1.070060820840264e-01];
L2E_Input1_iAMPA_netcon = [+5.889852834554041e-03   -1.907811046152552e-01   +2.299179396765219e-01   -2.798482049564612e-01   -7.237944899495985e-02   +1.710354571061809e-01   -1.319566843499828e-02   +2.480020874431645e-01];
L2I_Input2_iAMPA_netcon = [+4.154788805495038e-02   -4.558531597315898e-01   +2.615900211681428e-01   -2.343640005955302e-01   -3.893620162358880e-01   -5.171379686053282e-02   -1.641655939046070e-01   +1.617604228664482e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
