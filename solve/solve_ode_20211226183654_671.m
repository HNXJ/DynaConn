function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.158801149368113e-01   +2.981653481306974e-02   +6.110408431109211e-01   -3.112254297861137e-01   +2.481561337730653e-01   +2.108264766133076e-01   -7.460487840273817e-01   -1.932076991257788e-01   -2.439633202326318e-01   -4.545655523290427e-01   +4.350153872957572e-01   -1.971306063954107e-01   -7.941212087867289e-02   +1.994055084322441e-01   +3.796064357467972e-01   +3.495895763736506e-01; +9.624896127528160e-01   -9.943851475929627e-03   +4.488447231093955e-01   +3.252291010984021e-02   -8.536001481246716e-02   -1.865459416457177e-01   +7.211272536445035e-02   +4.773656715815436e-01   +1.137561662248517e-02   -9.142209056835354e-04   -1.793294578109781e-01   -3.135602115653896e-01   -1.031416169444855e-01   +3.844040361444014e-01   +3.594431630565501e-01   +3.865691142733241e-01; +1.157682132942057e-01   +2.503433362644235e-01   -6.735633954536804e-02   +1.163933650516064e-01   +2.428631019699221e-02   +9.574954482521540e-02   +1.641323375588047e-01   -2.617425595829965e-01   +2.502620347819171e-01   +4.068046572078681e-01   -3.779987930544960e-01   +3.971450684204665e-01   -4.385917989916913e-02   +1.010647804016124e-01   -3.004935102408958e-01   -4.596619883352187e-01; +4.900281105629319e-03   +4.775127886162041e-02   +4.729993168030264e-01   -4.020826719698479e-01   +4.444321393764220e-01   -2.890514463953787e-01   -3.887203314380434e-01   -6.101920614556690e-02   -7.291745232590968e-02   +2.367874988253952e-01   +2.571574864731807e-02   +1.655195746645076e-01   -2.277028895045068e-01   -5.533047629993117e-01   +7.312702340949755e-02   -1.202382386011186e-01; -2.308727919708692e-01   +8.304194017606216e-02   +1.440858023508287e-01   -1.634575242466694e-01   -2.932054177775471e-01   +3.125433071491986e-01   +4.977682155090458e-02   -6.852041187843504e-02   +8.685739788835145e-02   -2.987030905314709e-01   +3.102385965816217e-01   -3.552412124243358e-01   +1.705764787116229e-01   +3.530873605739960e-01   +1.804742416729211e-01   -5.512119245294673e-01; +4.389858193407881e-01   -1.710006751871912e-01   -3.882650921885545e-01   -1.253296873167892e-01   -1.312262422912935e-01   +4.124064981074163e-01   -1.148476593776877e-01   +2.573198696095360e-01   -3.941366782489161e-01   +5.225901655020056e-02   +1.130735387000504e-01   -6.366976220708312e-01   +2.141297727375048e-01   -2.514691599660594e-01   -1.802506451284733e-01   +3.307017084996615e-01; -2.534125593108250e-01   -1.099468525933266e-01   -4.481533542020705e-01   +2.969162805324718e-01   +2.234621777152669e-01   -3.056769655679645e-02   +1.846674367591782e-01   +2.133754946780853e-01   +2.519457024255709e-01   -2.882296181544262e-01   -2.991012687754351e-01   +1.877718534083709e-01   -4.993429956421280e-02   -3.695961355351866e-01   +1.500683011854557e-01   -2.978184718650128e-01; -4.188854766493014e-01   +7.216405589867927e-03   +5.098089419154965e-01   +2.095162574829035e-01   +2.291840133961383e-01   +8.621995445826325e-02   +5.431307889843079e-02   -3.558423469984111e-01   -3.704426384745391e-02   -6.827343934329323e-02   +3.906329707994231e-01   -3.566301621982303e-01   +4.676892154401355e-01   +2.228059942342148e-02   +4.646088666417754e-01   -5.338995302299675e-01; -3.071470367600362e-02   -3.379236231364290e-03   -3.755688724095387e-01   +4.115539833522750e-01   +4.157266099619394e-01   -1.204832709957074e-01   +5.021352899000842e-01   -2.637220236826205e-01   -1.065379713018267e-01   -1.059335396009937e-01   -1.854465251986543e-01   +4.111853206824940e-01   -6.384606783600506e-01   +3.944139891555784e-02   +2.098036741282914e-01   -4.540452643322563e-01; +1.828180394275798e-01   -3.252429734758757e-01   -3.090268101893283e-01   -1.599404741521093e-01   +5.692832021059323e-01   +5.189202218391988e-01   -6.348496761345230e-01   +4.475819334609761e-01   -3.791010562852414e-01   +1.610526888265740e-01   +5.321026051012846e-02   -3.105172554715633e-01   -7.376697465047444e-02   +6.936388182841771e-02   -1.557941187607103e-01   +3.492944685443004e-01; -2.349745714325835e-01   -2.902304583825295e-01   +1.801228383546504e-01   +2.792334284103938e-01   +2.606302038099764e-01   -3.884077808843532e-01   +2.545682139367938e-01   -7.728537613712784e-02   -2.298854565568729e-01   -2.970368618759944e-01   +3.943035851884102e-01   -1.608146741811390e-01   -3.711887541643906e-01   +1.837883210069284e-01   -2.129655228066464e-01   +3.342149275302649e-01; +1.264066192642710e-01   -3.527876322872216e-01   -2.275044402412453e-01   -6.156219296554172e-01   +2.116783492029514e-01   -2.807959292940589e-01   -2.076728416995390e-01   -5.030274189593530e-01   +1.777513760313440e-01   +4.413370004874295e-01   -2.476264933707761e-02   -2.137893667273209e-01   +1.773424539310537e-01   +1.742871436874428e-01   -4.692235431693090e-01   +2.666683374947956e-01; +1.605302920518178e-01   -3.233355426963631e-01   +2.364363477390019e-02   +5.522434299625025e-01   -1.530047937900502e-01   +3.540050678385351e-01   +5.001007551396382e-02   +2.890685534520817e-01   +3.056438895900236e-01   +1.079261882905651e-01   -2.306858221661825e-01   -3.730364217139227e-01   -1.344995904632805e-01   -9.143986420536769e-02   -7.542289161559768e-01   +2.736616441453131e-01; -5.742161200834160e-01   +3.049603117364249e-01   -2.241878347747519e-01   +8.572544913730508e-02   -3.218199952750201e-01   -4.173347120274129e-01   +3.221136163206847e-01   +2.789376868975328e-01   -3.182066540849551e-01   -5.455226656057620e-01   +1.855726647961430e-01   +4.002489271862217e-01   +3.840081725402421e-02   +3.325608984581610e-01   +1.095229771285596e-01   +4.968170052719946e-01; +9.904481650328072e-02   +1.851893925297241e-01   +3.122156277390504e-01   -7.487083730126548e-03   -3.058605318729398e-01   -1.564190197558983e-01   +1.141950966643052e-01   +5.458266513455715e-01   +2.481667280620372e-01   -2.768632331452789e-01   -3.038548387167392e-01   -3.754147590506467e-01   -4.289983106191275e-02   +1.738323739125757e-01   -4.251557955425951e-01   +9.358293655269267e-02; +9.629632256428536e-02   -1.589812719472344e-01   +1.358339362359010e-01   -6.582762502479361e-02   +1.258704006286434e-01   -4.791868508793433e-01   -2.574040148849265e-01   -2.973829324545944e-01   +4.350107617000629e-01   -1.627121761833103e-01   -3.298340126958080e-01   -2.135765076187737e-02   +1.573772764061075e-02   +3.530884549133873e-01   +1.634658049407654e-01   +2.665217352740631e-01];
L1E_L1I_iGABA_netcon = [-6.319282623339305e-01   -1.769360000441740e-01   -5.870285756434788e-01   +8.762387554414294e-02   +3.642400826056540e-02   -2.771347967749084e-01   +2.252117017231980e-02   -3.282464444881468e-01   -3.801218449289427e-01   +3.472415957843786e-01   -9.120318088645896e-02   +3.830308480803295e-01   +3.644547381525642e-01   +2.607429482802903e-01   +2.754877437157874e-02   -6.184041688635996e-01; -8.373418042736752e-03   +1.133898624633940e-01   -6.597781822184456e-02   -1.120390306719198e-01   -2.115513667172706e-01   +1.366779251970901e-01   +3.181024376422454e-01   -1.973968472892128e-01   -5.370976314103633e-02   -3.178591201594194e-02   -5.696006569924589e-01   +3.230036461096331e-01   -3.264436606133149e-01   +2.556671605219524e-01   +9.836762715886201e-02   +2.988129742067623e-01; +4.296071220923351e-01   -4.428320525515069e-01   -2.257758616020409e-01   +5.671037459088627e-01   +3.110800654004489e-01   -7.544329962295899e-01   -7.261521231152747e-02   +1.899030903335352e-01   +6.143050207171279e-01   +2.835865727228917e-02   -4.598190078381422e-01   +1.547826090176191e-01   -1.240582885021964e-01   +5.102706508070802e-02   -5.117994382246943e-02   -2.620566448201586e-01; +4.920050087351474e-02   -3.244403983427219e-02   +2.398528867247476e-01   -2.323716395863483e-01   +1.240044755125272e-02   +4.660842049753255e-01   -3.079935304576241e-01   -6.001281835148942e-01   -1.122963345192087e-01   -1.300337546917986e-01   -4.674658165058592e-01   -6.027588476780995e-01   -1.677080347485546e-02   +4.671048065469648e-02   +2.519044806714882e-02   +2.805509838451389e-03; -5.660607358710746e-01   +8.664445304651536e-02   +1.358915548643963e-01   +8.207884311338533e-02   +2.442834406231665e-01   +1.658288479054767e-01   +7.305472749969422e-01   -4.713611194699070e-01   +1.010782811489908e-01   -4.853702168982671e-01   +6.171345266591409e-01   -1.776961489010350e-01   -2.053526085183007e-01   -9.659742630660315e-02   +4.654761820282072e-03   +9.011026604174850e-02; -4.485488715040089e-01   +2.934791371633518e-01   +1.512634483152453e-01   +2.987342961989141e-01   +4.627088638009513e-01   -1.295281270301689e-01   -5.203659624801508e-01   +3.898193209224213e-02   -6.582376092373394e-01   +8.060087680494078e-02   -3.901460556107123e-01   +7.866262877076131e-02   +1.660109459923291e-01   +2.163471705377663e-01   -5.599720544035877e-01   -3.899630998344431e-01; +7.906434572030233e-01   -2.665742081041910e-01   -7.141778294007925e-02   -5.633166109142641e-01   -2.491835113993965e-01   -3.492856729721159e-02   +2.163380727973301e-01   -1.469174882101707e-01   -1.991054503676227e-01   +5.570027284003102e-01   -2.004007454091515e-01   +1.362249563834119e-01   -3.033703368341741e-01   -9.499275382732469e-02   +3.610966628509621e-01   +3.129753180127892e-01; -2.189675807712350e-01   +4.100673207204952e-01   +9.734290800620782e-02   -3.994207662742462e-02   +4.411096668464797e-01   +8.549499547543699e-02   -2.079317387321787e-01   +7.309792163171728e-01   -5.715119528500373e-03   +4.484473531479735e-02   -5.155895282040657e-01   +2.321117210613407e-02   -2.205421576002934e-01   -5.379781109273183e-01   +7.254903304803068e-02   -7.175904592734518e-02; +1.793255227213301e-01   -1.385984370956139e-01   -4.916674752577462e-01   +3.212105506624859e-02   +3.015155018420741e-02   -2.549189485822695e-01   +3.929306516080621e-01   +1.124938165444309e-01   -3.442436027814704e-01   -1.866660167396305e-01   -4.414572671931665e-01   +3.278019777825589e-01   -2.062914709895136e-02   +9.260691485742467e-02   +3.991983804262579e-02   +2.945156046554642e-01; +2.293060763227240e-01   +6.685478943488846e-02   +4.677524863841754e-01   -3.984589203264629e-01   -5.411125002335029e-01   +3.596140471285416e-01   -5.374999753167361e-01   +1.685930673308562e-01   -4.585916754337618e-01   +8.833560076868302e-02   +2.245304688024914e-01   -2.045083912019106e-01   +8.893679580789585e-03   +1.463584897734838e-01   -3.188044444810103e-01   -2.635110296305940e-01; -3.291163511895815e-01   +1.918394378964231e-01   -2.431458535248436e-02   +1.338525943621714e-02   -2.568717153097429e-01   -7.363321406535109e-02   +1.833239548731560e-01   +1.877029579534307e-01   +4.387691569512671e-01   +6.570372576370194e-02   -5.864621888387736e-02   +6.506629947873638e-01   +5.634432571529117e-01   +5.067321837605135e-01   -3.495786820731067e-02   -4.927583370478473e-01; -6.094011330891386e-01   -4.800418371128762e-01   -3.531427480523877e-01   +1.899918266631418e-01   +5.499526688716400e-01   -1.493436840231376e-02   -2.221922526342084e-01   +2.617251256505519e-01   +5.363287399540437e-01   +5.412618582661652e-01   -1.834064367980807e-01   -7.289655999861637e-02   +1.777753320906608e-01   +3.101955872510032e-01   -4.383501879004237e-01   -7.721732032235791e-01; +8.832193329984686e-02   +2.119607548073021e-02   -5.712643383543369e-01   -7.100290262411649e-01   +3.769693432422760e-01   -4.164501038414842e-02   -3.377189942339793e-01   -6.118763894335577e-03   +2.333762388114266e-02   -2.027099921206688e-02   -4.093371611884485e-02   -6.207106853579881e-01   +4.393498926585239e-02   -2.083671896914732e-01   +7.757889814251417e-02   +5.564112343233189e-02; +3.231845200940683e-02   -3.089011156472299e-01   -3.911100580353788e-01   -5.222147081474573e-01   +3.080633615960877e-01   +5.861285114618511e-02   -6.524514200389174e-02   +4.229827063491749e-01   +9.289291113272727e-02   -1.975965917870692e-02   -1.710461434292027e-01   -3.214090807957311e-01   -5.412241769785053e-03   -4.209630235561823e-01   -8.169431873067333e-02   -9.340264526265442e-02; -7.902200288275161e-01   -7.913649828135258e-02   -3.697198773690694e-02   +9.872594843654328e-02   -4.584396785479778e-01   -8.731420660613914e-03   +4.476882402023358e-02   +1.946647965586902e-01   -1.387293447770490e-01   -4.692851298115706e-02   +1.865402633766978e-02   +5.472127319290259e-01   +2.804066509790938e-01   +3.257252207299328e-01   -1.941860642395751e-01   -1.698118538613192e-01; -8.015609587635772e-02   -2.946654181174249e-01   -4.710589520824424e-01   -4.252240038740712e-01   -9.566704786391350e-02   +5.075721949644557e-02   +1.243929851529735e-01   -6.296273584657266e-02   +4.228181378372203e-01   -7.480436319931354e-01   -2.346692688026001e-01   +7.846953556242947e-01   -3.234899807072901e-01   -1.954479704112638e-01   -6.027967190622288e-01   -6.120994092432784e-02];
L2I_L1I_iGABA_netcon = [+2.977554796796758e-01   +2.237940035408021e-01   +2.301000556825693e-01   -3.570859355429221e-01   +8.858256162855803e-02   -3.360322420748309e-01   +3.438133124588330e-01   +1.272263137050471e-01; +1.026799023925139e-01   -3.836479534381000e-02   +1.055060245225970e-01   -4.401118534558724e-01   +2.112864021541003e-01   -2.367569196882249e-01   +2.661839855451446e-01   +2.772178755155943e-01; +1.887878601809991e-01   +5.427235176487513e-01   -1.192075442204240e-01   +1.477075615187763e-01   -5.935847627838244e-01   -7.021674675780317e-01   +2.639494088929855e-01   -2.722387246464235e-01; +1.244171829044405e-01   -1.495382151119110e-01   +6.121513386600568e-01   +3.214855373309498e-01   -2.336043947168661e-01   +3.613823202608798e-01   -3.640418884918128e-01   +1.200357037953758e-01; -3.985511643646676e-01   -8.915800507531385e-02   +3.972588401407129e-01   -5.087185803556618e-02   +4.881596946601441e-01   -4.028910517625316e-01   +1.751414304064950e-01   +1.944264325554676e-01; +1.967041840194921e-01   -1.453292422814195e-02   -2.951256136636623e-01   +8.009647338575214e-02   -7.698687291574913e-04   -3.226100307303780e-01   +1.328104318287543e-01   -2.127100618828151e-02; -1.661386467007348e-01   +6.367511098362686e-01   +5.460794664334473e-01   +7.089581213533314e-02   +5.724575727844401e-01   -4.404623878192495e-01   +3.751221841423300e-02   -1.644242268798535e-02; -5.194538446961314e-02   -7.030744118981629e-01   -4.837124986372722e-01   +5.179914202630934e-02   +2.251234296377846e-01   +1.816681821895252e-01   -6.025821065567728e-01   +2.518087902433896e-01; +2.279348121002640e-01   -4.781535066737397e-01   -4.861290140754791e-01   -5.538618100701677e-01   -3.001176512543062e-01   +1.320485697302692e-01   -1.329714524478086e-01   +2.847588653880571e-01; +6.126027037030135e-01   -6.114274668116975e-01   +1.835192298064091e-01   -2.045709349857205e-01   +3.440618658551641e-02   -8.935854212601235e-02   +4.806316765574880e-01   +1.706069409511485e-01; -4.432021837381669e-01   +1.369743539225637e-01   -1.528322984989783e-01   -7.306617373969126e-02   -2.473040711371068e-01   -2.317812010265687e-01   -7.664705318509537e-01   +4.772400027269938e-02; -2.283057166286034e-01   -2.306951152653321e-02   -4.430553693975222e-01   -2.980640906976892e-01   +4.151146563297653e-01   -4.961199775003777e-01   -3.604691528574400e-01   +3.089764998737163e-01; -5.101110410848312e-01   -4.399062922225360e-01   +2.494630891053203e-01   +2.440999723720709e-01   +1.073497001238354e-01   +2.803494389085678e-01   +2.182509082645672e-01   +1.770337999251627e-01; -2.916587938618537e-01   -3.669696823563249e-01   -1.447341445832974e-02   -3.590743884060000e-01   +4.442600041058675e-02   -7.446772999166174e-02   -5.878813590174004e-01   -1.091375375768033e-01; -4.615586804505573e-01   -4.956070373084241e-02   +4.525068647921210e-01   -3.856236941541579e-01   -3.512248806075046e-01   +2.096546115041921e-01   +3.502744405016845e-01   +3.667924794475486e-01; -1.430915152996839e-01   +8.167130257162534e-01   -1.416928210163458e-01   -1.935433998443500e-01   -1.653680479593422e-01   +5.055702842577565e-01   -1.793317077350948e-01   +2.917913407774021e-02];
L1I_L2I_iGABA_netcon = [+5.114378568965388e-01   +1.389533623546804e-01   -8.198984531629572e-02   -6.622268499464271e-02   +3.087215279101086e-01   -3.220995040280425e-01   -3.564637262558707e-01   -2.303175279431587e-01   -4.261906433481453e-01   +4.576752046753548e-01   +1.173831287005448e-01   -2.476936495832312e-01   +6.119177115843939e-02   +4.999029393684167e-01   -1.549158659716051e-01   -1.150880527758727e-01; -5.972671974905981e-01   +1.320582005211932e-01   +9.974825810595145e-02   -5.617316889466994e-01   -1.079876916159664e-02   +4.753217187680973e-02   +3.714259591886256e-01   -7.838280558081639e-02   -4.654301816712576e-01   +4.954737145500029e-01   -2.857927136371863e-01   -1.992709142620752e-02   +1.905092508862237e-01   +8.122725175076561e-01   +4.410794467512273e-01   +6.260941817527108e-01; +4.321884095955934e-02   +5.853986926341761e-01   +4.169337701361950e-01   +1.188603243617165e-01   -4.772126212578710e-01   -3.988283727761787e-01   -3.813672563778731e-02   +3.539558963073665e-02   -7.535797107716236e-01   +3.626580191045110e-01   -3.484901099062273e-01   -2.448467513928596e-02   -3.835600986157296e-01   -5.476504024095048e-01   -8.513305211658315e-02   +3.224871662462206e-01; -2.139233991646262e-01   +2.435906704969382e-02   +3.731150226076644e-01   +2.822893372812117e-01   +1.004281511179256e-01   -6.140890763840609e-01   +1.901059530977730e-01   -2.104687693651832e-01   +4.564594197116243e-01   -2.461013537295595e-01   -8.044632394382965e-02   -7.956381304620921e-02   -6.407378215296361e-02   -5.085547224238897e-01   -2.255856382842568e-01   +4.835681774160506e-01; +9.336046214828700e-02   -4.915779542314871e-01   -2.556383938378302e-01   -4.093335731739108e-02   +4.291923771026440e-03   -2.304884281785999e-01   -2.004584782203533e-02   -1.999576085831258e-01   +1.517795938152914e-01   -2.983572799406331e-01   +2.371457197661206e-01   +1.824004444544652e-01   -8.781815487865373e-02   +4.869443061618718e-01   -1.189783120238983e-01   -5.984241816074517e-01; +2.307949506580345e-01   +2.554655694287021e-01   +8.489962256853778e-04   +6.522499200699843e-02   +9.556533447323809e-02   -3.519793484848771e-01   -1.575958360593599e-03   +8.344405096727695e-01   -4.698815931750984e-01   -2.096474842906750e-01   +4.590696988003197e-01   +9.774389588299663e-02   -6.583745999218302e-01   +1.786432151649815e-01   -4.124590211508464e-02   -2.062860750794662e-01; +1.897236757112922e-01   -4.057724187612646e-03   -2.546190580677160e-01   -3.967190031270386e-01   -1.998308993606514e-01   +3.457583013508271e-01   -4.127132196790270e-01   -7.311767282917564e-02   +2.118367517874201e-01   -1.228539563159003e-01   +2.974255003683140e-01   +6.631209451973614e-01   -2.341305362628168e-01   -3.002048755508085e-01   +7.740959176154842e-02   -5.907548245675621e-01; +1.510460412408841e-03   -7.688170316123696e-02   -1.355630157271350e-01   +4.877611431548395e-01   +7.552392657348843e-01   -9.262416507787388e-02   -1.637353592500977e-01   -3.288964080816045e-01   -4.663237041564916e-01   +1.818003983032757e-02   -1.490468722249680e-02   +1.252937256333947e-02   -8.495422479632929e-02   -1.464759055757313e-01   +5.467620126106341e-01   -1.700134527995086e-01];
L2E_L1E_iAMPA_netcon = [-2.066204754092439e-01   -4.030270769850270e-01   -8.277103743311476e-03   -1.211887250683044e-01   +4.169048297497233e-02   +8.413030548061953e-02   +5.539866987906482e-01   +2.426192492650083e-01; +2.483696801542639e-01   -3.767809370318688e-01   -3.718422865324469e-01   +1.777491099833904e-01   -1.638367514960321e-01   -2.733618753102570e-01   +2.482208943829015e-01   -6.369017403450289e-01; -1.106989840959822e-01   +8.519659977664051e-01   +1.772075433967315e-01   +3.631389078165564e-01   -5.002934836113763e-01   +2.827761320906372e-01   -2.115885283176686e-02   -3.786578047640850e-02; -4.648805105680658e-01   +3.328725072401979e-01   -6.255386971438300e-02   -3.169031511003224e-01   -1.722937546391405e-01   -3.398771130193320e-01   +7.934388453491803e-02   +6.697577622591895e-01; -4.678113767251918e-02   -1.039454838225210e-01   -1.427141804009446e-01   +1.314439187514347e-01   -2.791580614382410e-01   -4.769443195146030e-01   +3.006600637816327e-01   +1.084810987336086e-02; +3.389170927332817e-01   -2.921765655266789e-01   -1.554653991521527e-01   +4.464999805626554e-02   -2.975690757989792e-01   +1.399512864582003e-01   +8.942224013768231e-01   +7.274429028134605e-02; -1.234739609258015e-01   -1.787081205788368e-01   -3.964631431696309e-01   -2.622261969721789e-01   +2.739301137209136e-01   +6.839076177065218e-02   -1.254523073943749e-01   +2.320865590131603e-01; -3.717576849803670e-01   -7.839959977475300e-02   +4.565946535084045e-02   +1.771995818265944e-01   +4.486209536046796e-01   -2.798830159358581e-01   -2.388938058002790e-01   +4.731920579097297e-02; +8.421503699117031e-01   +5.964475951791266e-01   +3.724721822745316e-01   +8.600169581965376e-03   -1.283086005057804e-01   +6.734358860146638e-01   +4.077368612414077e-01   -3.208053294967639e-01; +5.992437729975517e-01   +9.531528096422941e-02   -2.032961252060787e-02   -4.983944962945491e-01   +4.211532603758323e-01   -5.507619062848093e-01   -9.823562663145788e-02   +2.176659797799382e-01; -6.426528614859817e-03   -5.187127961080381e-01   -3.255690298534163e-02   -9.436313026792070e-02   -8.173319721402648e-02   +5.100878736454068e-01   +4.763799062132811e-01   -8.803985296500529e-02; -1.349556671016242e-01   +5.834126062077657e-01   -4.357964027174741e-02   -3.009952554548408e-01   +1.185823416817534e-02   +2.466022921359561e-01   -2.677254272100399e-01   +9.168692267844561e-02; +3.426006112313187e-01   +2.031664353096664e-02   +3.055650817530680e-01   -2.580474040092061e-01   -5.670301046614406e-02   +2.795661353357098e-01   -2.955318685146055e-01   +4.464018716820162e-01; -1.790572047802229e-01   +3.223934480504128e-01   +3.697491433245405e-02   -2.246280969793547e-02   +6.042559210846477e-01   -1.572270235760601e-01   +5.353889782116161e-01   +1.967415451538779e-01; +6.848166945193614e-01   -5.891869247314621e-01   +8.320995797809205e-02   -3.985188027921405e-01   +1.023300817554398e-01   +1.238239331676620e-01   +1.209388918859887e-01   +5.879444968998393e-02; +4.031655050349636e-01   +5.151098967080865e-01   -2.035554413363739e-01   +3.249621991088659e-01   -5.264817224034870e-01   +1.664377995982745e-01   -5.619697397722710e-01   -4.366653533646847e-02];
L1E_L2E_iAMPA_netcon = [+1.779782209546024e-01   +1.319111105963827e-01   -2.779064177561965e-01   +4.018078551513416e-01   +8.829127233748754e-02   +3.892410042847110e-01   +1.109344911551843e-01   +3.874483429979032e-01   -1.218739442831059e-01   +6.786681057152043e-02   -4.970423032511374e-01   +2.029264991030054e-01   -5.899274862731844e-02   -6.303656274633636e-01   -1.710847413814988e-01   -3.178216761104964e-01; +1.438600677334565e-01   +7.773673408987654e-01   -3.435784421736929e-01   +9.294012504556118e-02   +2.437985454510318e-01   -2.116643511097056e-01   +3.654979243270387e-01   -1.565414444385280e-01   +1.057552173761278e-01   +4.242729742161643e-01   +5.773857234634507e-01   +4.457814250276534e-01   +3.558211273990460e-01   +3.206759720906600e-01   +6.241086828041980e-01   -1.250963342971071e-01; +5.744920346223617e-02   +5.470461284126951e-02   +1.294475800938064e-01   -7.656811683466466e-01   -1.574969988856022e-01   +4.553185478953993e-01   -2.136984390092075e-01   +5.363348915283377e-01   +6.804519070687997e-01   +6.728657354013258e-01   -1.790211076713727e-01   +1.954043108827402e-01   +1.501628158209865e-01   -5.443198558864918e-01   -5.395453176984611e-01   -1.608235446665222e-01; -2.164470583953279e-01   -4.021618641474863e-01   -2.680846600133130e-01   +3.232909091012859e-02   +1.017847318297789e-01   -3.793976493504442e-01   +1.134712935315019e-01   +5.039338681481279e-01   -8.239695847303270e-02   -2.394694448211357e-02   +3.813933044899026e-02   -7.764914460854592e-03   -1.505121969502530e-01   +2.468440694480056e-01   -3.019241261630272e-01   -6.975073650944453e-01; -2.401658865374565e-01   +4.669759865761502e-01   -4.723630771962202e-01   +3.203481006239479e-01   -6.731488368726915e-02   +7.272022040297427e-01   +9.536516842239844e-02   -3.314475197152125e-02   -3.907063771359179e-01   +8.384922478454350e-02   -1.401250442584419e-01   +4.788074233158528e-02   -4.409353836201749e-02   -2.477433109883750e-01   -9.152569992845494e-02   -1.096566006713093e-01; +5.744565287129109e-01   -2.013647021050362e-01   -1.022258874755580e-01   +1.809362988087500e-01   -3.190680400245113e-01   -1.953158801653574e-01   -6.681970581321039e-02   +4.672472540767738e-01   +1.750026356809465e-01   -8.538663127639398e-02   +2.857862565233127e-04   +6.231714246710600e-01   +3.883947485313279e-01   -4.652622474443695e-01   +3.116746372475370e-01   +3.633379635037717e-01; +3.561875060018166e-02   +4.196387107775597e-01   +1.706886781784439e-01   +2.337080258749265e-01   -1.374158602182170e-01   +1.532299402937899e-01   +3.757321063542816e-01   -1.086040105852865e-01   +1.192922838196864e-01   +2.444751929782166e-01   -2.882883327393922e-01   +2.404944760231260e-01   +2.977060344774759e-01   +1.800448500912912e-01   +8.367825088548414e-03   -2.375879929742098e-01; -2.336020228829429e-01   +4.018494741320584e-01   -1.413300885090746e-01   -6.301928967054407e-03   +2.377211713983987e-01   -4.779331485520993e-01   +6.023750679704486e-01   +7.038359733932804e-02   +6.926732184510098e-01   +1.372020962300511e-01   +2.225053720907100e-01   -5.354073013199665e-01   +1.628269655029539e-01   -1.614267697020123e-01   +1.983736262439456e-01   +1.800452877181895e-01];
L2I_L2E_iAMPA_netcon = [-4.739035400879382e-01   -1.094085136454983e-01   -1.565259333817027e-01   -1.351314941279496e-01   -1.014231824277437e-01   +1.787294089471709e-02   +1.245269061115180e-02   +4.650731538809167e-01; +5.024995606284551e-02   -1.762207634922469e-01   -1.185937030381213e-01   +3.482482825803339e-01   +1.195812802910995e-01   +5.305332046866992e-02   -2.245218634523796e-01   -1.236121134018303e-01; -8.101545381163437e-01   -2.446236134496988e-01   +3.420123354146651e-01   -2.514736944190736e-01   -4.025640326401798e-02   +1.848390810490683e-01   -2.522321834893189e-01   -3.673290333698098e-01; +3.010549758163674e-01   -1.933752275806615e-01   -3.575894572059719e-01   +3.805341802349174e-02   -7.839786305483740e-02   +4.448451212842993e-01   -6.673174536490094e-02   -2.608318471159241e-01; -3.315573204121205e-01   +1.045860319022404e-01   +1.378845919448511e-01   +2.651018549442896e-01   -3.613155990424525e-01   +1.759093529443460e-01   +5.243130089358568e-02   +1.892361577274759e-01; -3.628695467522746e-01   -1.781419245925821e-01   +1.550139250739999e-01   -2.907531276111974e-01   +1.708009438457885e-01   -3.235264007913713e-01   -1.990896556156261e-01   +1.073332145273103e-01; -6.934745793590179e-02   +3.546863797266397e-01   -1.948557736628916e-01   +5.578094233858235e-01   -1.603615154398030e-01   +2.305118655926373e-01   -2.539401714081931e-01   -4.756404734909015e-01; +8.048413829006065e-02   -3.652551611012627e-01   +6.508805799435754e-01   +4.564450826991998e-01   +3.027376910787804e-01   -2.175516259118085e-01   +1.833043109087246e-02   +6.477478796528854e-02];
L2E_L2I_iGABA_netcon = [+1.683465748186658e-01   -2.823276594409488e-02   -6.130336344470501e-01   -5.753495489822332e-01   -1.348079244739349e-02   +2.835774114044846e-01   -1.211776738251382e-01   -2.182078404484132e-01; +2.597036210932514e-01   +5.139502412680659e-01   +1.228085861491239e-01   +2.624179627003292e-01   +7.623366860829225e-02   -3.966108708848827e-01   -4.440959588568157e-01   +2.155716947611390e-01; -3.388881918837537e-01   +1.948456759558088e-01   +2.643081928488789e-01   -8.248627360525307e-02   +4.002573110265794e-01   +4.400448735920749e-02   -8.436450295557654e-02   +3.951044268217940e-02; +1.419734552929349e-01   +4.665918025710769e-01   -2.242574588662436e-01   -6.419524520154742e-01   +3.861944694654721e-01   -8.104863922573907e-01   +3.280041170606547e-01   +7.948259192634329e-02; -1.974706103949745e-01   -5.674502226074642e-01   -6.010488356000817e-01   -5.712027030361880e-02   -7.867369741559234e-02   -6.283142830736228e-01   +5.864584453067945e-01   +2.998540796475779e-01; +5.224731116480354e-01   -3.451008809931341e-01   +4.963915767301188e-01   +1.909297015994614e-01   +3.418202917039180e-01   -7.545906099225176e-03   +4.107322636492435e-01   -2.459750320883968e-01; -9.302031803262932e-02   -9.213662185401818e-02   -6.012789560991818e-01   +8.658687332942361e-02   -8.629958903682476e-02   +8.259666304923929e-02   +2.756726770970220e-01   -4.184306176368173e-01; -5.079353764767747e-01   +2.193854154253809e-01   +2.758073684036273e-01   +1.439820122086997e-01   -3.817415552773463e-01   -3.215241671705259e-01   -2.105829105958690e-01   +1.865158849446960e-01];
L3E_L2E_iAMPA_netcon = [+4.477973875614842e-01   -4.165548912142865e-01   +5.533948994008027e-02   -8.537338960156750e-02   +2.003554368714895e-01   +9.548939735909598e-02   -1.889758971443946e-01   -4.204966237347307e-01   +4.406397597929218e-01   -5.582399598455636e-01   -3.396449846007328e-01   -1.110363699829876e-01; +1.569322076528297e-01   -1.802027019840757e-02   -3.031254515915725e-01   +3.458022099319846e-01   -2.269713859708717e-01   -2.261037687164699e-01   +2.727151946956556e-01   -1.812708968286628e-01   +3.484591178652527e-01   +1.850813655870591e-01   -6.174787098530741e-01   -4.290182493130812e-02; +3.572592778816244e-01   -3.688845841233460e-01   -6.473665717028546e-01   +4.206003564177713e-01   -1.867169914968902e-01   +3.203840616816431e-01   +3.744063834802525e-02   +9.696605455284421e-02   +3.023685434805189e-01   -4.735515052135258e-01   +3.120610010923101e-02   +4.550055908963703e-01; +2.577667565728034e-01   -1.075665379188059e-01   +1.965631012941995e-01   -7.243190640171108e-01   +2.977423311499945e-01   -1.856030361949505e-01   -3.961005908879313e-01   -7.210676118650520e-01   -2.530222867681223e-01   -3.732748259426265e-01   -3.456581663224350e-01   +2.903532171988751e-01; -3.431699962784934e-01   -3.189407551045169e-01   +2.556178084103590e-01   +6.936193165319433e-02   +4.555480145130354e-01   +2.344384540614677e-02   +1.644361613416101e-01   -2.372719470705968e-01   -3.147819563444915e-01   -2.424539860646830e-01   +3.955728507534875e-01   +7.165788405352544e-02; +1.141231167123616e-02   -2.801572316770614e-01   -4.774925735972110e-01   +2.052427758806155e-01   -9.113739508160576e-02   -1.335671100893121e-01   +2.698836834366645e-01   -2.280134342222434e-01   -8.947754538182043e-03   +4.023088214153976e-01   -1.069393156074412e-01   +2.908444118131370e-02; +2.779908405172078e-01   +4.454907935363540e-01   +2.113945363793921e-01   -1.949460408963341e-01   -1.919126315790070e-01   -6.628257999799483e-01   -9.207460678219820e-02   +6.407654439418322e-01   +1.830315841849521e-01   -1.276804969637564e-01   +4.910274118526993e-02   +1.068427156149748e-01; -3.287663665683868e-01   -2.611518744810071e-01   +1.234568542711203e-01   -9.137054265851163e-02   +2.275711639525858e-01   -7.130620685403406e-01   +2.049836978252191e-01   -9.442812118173620e-02   +2.539863348494712e-01   +4.293525311488265e-01   +1.891539160062574e-01   -4.726689097064096e-01];
L3I_L2I_iGABA_netcon = [+8.858698179133756e-01   +3.960155423702252e-02   +1.300835082177849e-01   +5.145701957527780e-02   +6.961236771606895e-02   -6.443888884188865e-01   +3.407194148109717e-01   -4.095378427359936e-01   -5.084648327919288e-01   +1.237030437048723e-01   -5.317921858814898e-01   +1.025966710639097e-01; -5.406863966936024e-01   +6.682284865570458e-02   +2.839571086502773e-01   +4.199812171440710e-01   -3.439565477408722e-01   -6.424697777505767e-01   +1.397741864330252e-01   -3.708164068834149e-02   +1.686876427404149e-01   -6.022076425491650e-01   -7.030079642360548e-01   -3.081861525694594e-01; +4.768536784285228e-01   +2.418645167018346e-01   +6.810627019256535e-02   +9.888180864454549e-02   +2.466005002923966e-01   +2.891660119146542e-01   -6.304362770739349e-01   +3.630716411196428e-01   +7.530081870250629e-02   +6.332244268520509e-02   +2.103286955875165e-01   +4.925356460561937e-01; -5.338769954980103e-01   +6.427900426053346e-01   +3.352945119282181e-01   -2.165086914007125e-01   +6.629242366338455e-01   -2.720793891326933e-01   +4.012425433152855e-01   -7.074963328627674e-01   +2.113030500338678e-01   -6.859134653559230e-01   +1.211918619840927e-01   +2.156635637198739e-01; -1.203834998478457e-01   +1.986411534925431e-01   -2.430913508490805e-01   -3.628012820138299e-01   +5.701891974278760e-01   -3.957438620037170e-01   +4.309380580693857e-01   +2.357931232839877e-01   +2.679349854242437e-01   -2.080660547088180e-01   +5.880082773343269e-01   -1.805176658047358e-01; +1.594822235167335e-01   -6.950492376988507e-01   -1.017242613309047e-01   -3.423566008200858e-01   -4.580369698132873e-01   +1.985778207193661e-01   -1.526298831249538e-01   +2.135054962764018e-01   +7.388493667698196e-01   +7.361839000469227e-02   -1.546218828227702e-01   +6.293165575872266e-01; +2.676096885314945e-01   -6.324117994789794e-02   -3.573544200412744e-01   +5.591383984845609e-01   -4.863526879004434e-01   -2.098643156139560e-01   -1.227089250410088e-01   +2.433561949360442e-01   +9.667957076188380e-02   -3.865135681369888e-01   -5.145310095001479e-01   -2.770716892314596e-01; +3.636476724952808e-02   -6.827345846006419e-02   -9.087543450078407e-01   +3.165929122831931e-01   -1.063411473538699e-01   -1.792000466614169e-01   +4.464781463303946e-01   +9.065670869919643e-01   -8.198322224299035e-01   -7.985840670664790e-03   -1.754793433063939e-02   -1.879971397393511e-01];
L2E_L3E_iAMPA_netcon = [+1.819014650948877e-01   +2.461789566634420e-01   -2.563588515604543e-01   +7.770568896933517e-01   -4.310579221992875e-01   +3.040730887820346e-01   -6.140964932635925e-01   +4.622794532321998e-01; +1.366170717560575e-01   -2.914282140283914e-01   +8.720249946923297e-02   -7.945845366750485e-01   -1.277264223148064e-01   -3.195173587345642e-01   +1.396040669949601e-01   -1.399690944992462e-01; -1.246209183179981e-01   +3.305521776630905e-01   +4.444748408355556e-02   +3.950894500224339e-01   +1.043024516164816e-01   -4.506446330801894e-01   -7.414568200387744e-02   -5.283622448264549e-01; +1.895483999912645e-01   +1.671852456278662e-02   +9.210386103304686e-01   -3.435968803759587e-01   +2.041849058403261e-01   +4.844907790002533e-01   +5.730176012075475e-01   -3.025098930981590e-01; -6.672125065175927e-02   +2.577446629647145e-01   +1.826776718866591e-01   +1.425235319735932e-01   +2.664682767453382e-01   -3.513953540493547e-02   +1.531222582605244e-02   +5.442048551891738e-01; -4.968747700048939e-01   +9.746717122038209e-02   +1.959642211598542e-01   -2.167333485576110e-01   -3.784176084550528e-01   +2.358229326274060e-01   -4.026021398828530e-01   +5.870673034037496e-02; +4.271719770923386e-02   -1.224104782004978e-02   -3.061963716581884e-01   -1.117133432893250e-01   -5.542067856952831e-01   -3.106618327363527e-01   -4.810312592498833e-01   -2.686867705011021e-01; +5.444603072145949e-01   +4.297295579726729e-01   -2.797787683914401e-01   +8.421275154523427e-01   -4.629215648577562e-01   +4.206516462681146e-02   +2.386308261375085e-02   +4.744407912242217e-01; -3.043352304287077e-01   -1.570030005431574e-01   +5.116743190239054e-01   +4.232829489115558e-02   -1.833686886628507e-01   +2.844455299979721e-01   +2.212689052036216e-01   -4.276112969116844e-01; -4.653282190985256e-01   +4.590337257284976e-01   -4.459508343051450e-01   -3.523032791002869e-01   -1.991578796036872e-01   +8.505331478101799e-02   -3.765350017863502e-01   +8.446987778113599e-02; -4.439852597534594e-01   -4.624572317573239e-01   -6.679960238345778e-01   +1.866642589842784e-01   +4.744594426905036e-01   -3.043787218758777e-01   -1.489922003011344e-01   -3.606753514631688e-01; +3.218295632041596e-02   +4.396107277075936e-01   +6.745593055054376e-02   +2.393252882268498e-01   -2.199139340197804e-01   +4.168258495748137e-02   -2.561280955546240e-01   +3.286764205392292e-01];
L2I_L3I_iGABA_netcon = [-3.172926509126622e-01   +3.054660726921113e-01   +1.637209654593198e-01   -3.390247779375031e-01   +1.037595936781636e-01   +4.482571586458569e-01   +2.291544885778149e-02   -1.070586251301962e-01; +1.689521909979213e-01   +7.885270431465531e-01   +9.212167219048391e-03   -1.871005505065685e-01   +3.621436406453241e-01   -2.174006325108471e-01   -2.859548145993774e-01   +5.919665647927019e-01; -4.460103819471295e-01   -3.598334619079794e-01   -6.918731742649739e-02   +3.671219968086702e-01   +5.552942896223235e-01   +6.248391064602128e-01   -2.192292416260909e-01   +2.884474526884164e-02; -2.096066312788298e-01   +2.844308213537363e-01   +5.264769385570600e-02   +2.804810855542156e-01   +8.158717129308296e-03   +3.554913461535211e-01   +2.945230084484451e-01   +8.295314402366855e-02; -2.630553081716286e-01   -1.564728366095094e-01   -4.983848601119205e-01   -4.976455468382832e-01   +4.601633858641122e-01   -2.131759955101842e-01   -1.669579563468256e-01   -4.329899146253328e-01; -2.875662801875053e-01   +1.693366063552159e-01   -7.662700498468655e-01   +1.173809733765105e-01   +3.370122624173433e-01   +5.335926072336622e-01   -1.331535005328635e-01   +4.532077592475119e-01; -1.992525919603794e-02   -3.174486122623333e-01   +2.368497255190169e-02   -1.460594299145138e-01   +6.202522555562465e-01   +1.035858017936076e-01   +4.779375970272539e-01   +3.861603273294628e-01; -1.434818839614255e-02   -1.957103430966634e-01   -3.433521283206556e-01   +3.603248593188716e-01   -1.546729934850276e-01   -2.611507143204055e-01   +4.643290044396367e-01   +4.991616357380552e-01; -7.530271627517610e-01   +4.095444361956570e-02   -3.791842841596784e-02   +2.256070321309086e-01   +1.987675113019381e-01   -3.762818341521438e-01   +4.943755093383425e-01   +1.026959182439925e-01; +1.506818148147847e-01   -2.125361160015689e-01   +2.742286782676092e-01   +3.321176520311000e-01   +3.064748268826287e-01   -4.111647430901582e-01   -8.387298648816500e-01   -6.578422150041088e-02; -2.478965976821495e-01   +2.569891961286190e-01   +9.136002194856835e-02   -2.140800042606051e-01   +3.151819687937678e-01   +4.388809987071678e-02   +5.462956804918693e-02   +2.158978408717737e-01; -5.575819565181069e-01   -2.078963679329364e-01   +2.500314213077931e-01   -1.955011195283966e-01   -4.524150083636195e-01   +4.077869670534128e-01   -5.203079527952281e-01   -1.727767956164079e-01];
L3I_L3E_iAMPA_netcon = [-3.334104472707304e-01   +3.563922865277451e-01   -3.859077442275940e-01   -3.532356579576421e-01   +4.278169929255133e-01   +1.620886706480467e-01   -4.929912962169798e-01   -2.503927791432402e-01   -3.758006877611104e-01   -4.771548189211018e-01   -1.958945365061960e-01   +5.671138587096650e-02; +7.405994812219351e-01   +5.523916677094287e-01   +1.907178178205266e-01   +1.069575760662541e-01   +5.598873142231416e-01   +2.847415472145919e-01   +2.697354582063852e-01   +2.514793234347804e-01   -1.067724003156720e-01   -3.017812940464694e-01   +1.284979318934300e-01   +2.942021587989885e-02; -1.237773164475015e-01   -4.008267015473417e-01   -4.237106817030813e-01   -8.749657949514600e-02   +1.869247400566319e-01   +2.775254878308741e-01   +1.003695649743352e-01   +1.578185088067023e-02   +2.197022062661328e-01   -1.297643086815888e-02   +2.480154067628993e-01   +9.961893313227330e-02; +2.361677982912300e-01   +6.933626725740971e-01   +3.862333036044454e-01   -6.628449416703019e-01   -2.317809673496973e-01   +3.106432921104440e-01   -4.683943371845456e-01   +7.100717603411302e-01   +1.693007793282260e-01   -3.381118465918746e-02   +4.283239320301232e-01   -4.655449003979815e-01; -1.393136248326303e-01   -4.710700618597219e-01   +2.205660304484360e-01   +6.892993202851914e-01   +2.033009910390582e-01   +1.016661995624055e-01   -3.455678286056452e-02   -6.855658187718485e-01   +1.017883623379311e-01   -8.286358102889543e-01   -1.691122285829311e-01   +3.489311088792011e-01; +9.277051234317711e-02   -6.880626833689424e-02   +2.073790701029508e-01   +1.881999612224687e-01   -2.455253142164722e-03   -6.697642704536770e-01   -4.569490253429365e-01   +2.598132690925220e-01   +7.193029748526363e-03   +6.554437854333207e-02   +9.553288312215839e-02   -1.197170549600056e-01; +4.463994627448972e-01   -3.839638455207935e-02   +5.194762939817319e-01   +2.011389091598687e-01   -1.007727430573835e-01   +1.901580052286589e-01   +8.667732737915185e-02   +6.221866977786334e-01   +3.509934811433743e-01   +4.758369908547758e-01   +3.839913251921543e-03   -3.209358089564099e-01; +4.803449054293158e-02   +8.622504789957075e-02   -1.673667102323078e-01   -2.528184680356613e-01   +4.173842477860620e-02   +4.466842305700187e-01   -5.293566008354791e-01   -5.759471619474307e-01   -7.424399709414924e-01   -9.816860860840596e-02   -1.706442801732465e-01   +2.549971483998067e-02; +3.459562230762064e-01   +3.786028617156806e-02   +3.677300342523693e-02   +2.771798628558133e-01   -7.160874182689612e-02   +2.053691096106141e-01   +1.796347471743039e-01   -2.414812538968557e-01   -2.654634084343711e-01   +1.937497292020737e-01   -3.342971540451750e-01   -2.284314393372363e-01; +9.964074046061300e-02   +4.811385828009827e-02   -2.492618592951681e-02   -2.239438907682870e-01   -2.193409588245886e-01   +3.086426049541466e-02   -4.700724458014750e-02   +3.285243694341001e-01   -1.081114539464503e-01   +4.582128610300883e-01   -1.133760916136100e-01   +1.190899436163197e-01; -4.122848008423396e-01   -1.333502821125243e-01   -3.680158110586218e-01   -3.153195827125930e-01   +4.001685544807968e-01   +2.404851509311835e-01   -5.204886315884562e-02   +8.120746408900583e-01   +6.457803249586565e-02   -2.345959283389279e-01   -2.765995654416191e-01   -6.292539976378095e-01; +4.140766398082001e-02   +1.386426185255343e-01   -1.274184843506596e-01   -5.383806499623633e-01   +1.305827177244472e-01   -1.421770149924776e-01   -6.300208058837093e-01   +2.398607929939029e-01   -2.453260272614194e-01   -1.474527308922269e-02   +5.941207637302005e-01   -2.431178709471347e-01];
L3E_L3I_iGABA_netcon = [-2.914767151406838e-01   -1.627634760881697e-01   +7.656503817175558e-02   -4.757070006406494e-01   -2.539385719484547e-01   +2.072860615120398e-02   -4.010269139197546e-01   -2.952380975077046e-01   -1.210998785214048e-01   +4.265852475792196e-01   +2.906079906703257e-02   +7.546158814455864e-01; +1.224866716223860e-01   -2.033948034968782e-02   -1.137173625893646e-01   +3.008562462447151e-01   +2.869538977782204e-01   +2.431070430578130e-01   +5.204984709091832e-01   +1.390854221886947e-01   +1.684132464019802e-01   +2.621516163816138e-01   +6.721499449442475e-02   -3.084061287997880e-01; -7.185743442961572e-01   +1.491769861153083e-01   +5.071083837453055e-01   +2.755660242172821e-02   +1.558851502191951e-01   +8.606115625397165e-02   +8.384317987046905e-03   +5.849149003078364e-01   -2.953987836219343e-01   -1.324548201570380e-03   -7.217562640135804e-01   +4.648872303441806e-02; -3.018831542539345e-01   -4.899010116891845e-01   +2.882957545030410e-01   +2.264022711811582e-02   -4.449961452765762e-01   +4.908486634759347e-01   -2.249436450415509e-02   +5.342855982113751e-02   -7.103547047680388e-02   +3.893282317397454e-01   +3.753515645667050e-01   -4.037685015604354e-01; -5.778057199367067e-01   +8.969320146603589e-02   +1.251092489197512e-01   +1.240772498357582e-01   +4.566612417959252e-01   +1.917792974458370e-01   +3.791836467956071e-01   +7.751681137116448e-02   +9.570743997757121e-01   +4.277013052689013e-01   -4.839259441593520e-02   -5.641025511446249e-01; -6.694355455138712e-02   +1.757959272144265e-01   +6.106897610869115e-02   +5.107900273269973e-02   -8.857152993295092e-02   -1.975092093559242e-01   -7.299332053534863e-01   +4.101130317174543e-01   -5.620452724671308e-01   -1.352624174427970e-01   -3.227437373207133e-01   +1.824475480722052e-02; +3.213706408755201e-01   -3.091739621544293e-02   +3.764968207843408e-02   +3.453454879668794e-01   -1.807262810581195e-02   +3.468038929070615e-01   -5.463613057559621e-01   +7.119702024847835e-01   +4.969530443721334e-01   -4.342562657106059e-01   -4.873386006594478e-01   +2.200545241689912e-01; -3.776087409752085e-01   -3.126386643073545e-01   +3.427052764806463e-01   -1.867551400568912e-01   +3.267978385146372e-01   -1.526952769341496e-01   -8.119473177806008e-02   +5.006105578776390e-01   -4.595460799174318e-01   -8.200561107359322e-01   +5.208562541898581e-02   -2.908148141971749e-01; -2.033642164016137e-01   +4.410815159243042e-01   +4.367542089411149e-01   +2.357859138027564e-01   +7.296542331332401e-01   +2.316454965155141e-01   -2.205593281506755e-01   -1.640449274035841e-02   +1.413494412604619e-01   +2.499427684927258e-01   +5.324171076758309e-01   -5.037246006180246e-01; -2.495010742125076e-01   +3.996508237334278e-01   +1.543131369033570e-01   -5.422374723440569e-01   +2.731226253524648e-01   +1.447674567392783e-01   -5.726103931260019e-02   -9.013548090352846e-02   -1.062876101656590e-01   -5.187842126672543e-01   -2.175500671051976e-01   +4.292683689012405e-01; -5.580482257631778e-02   -2.214348534342749e-01   -2.567567368584716e-01   -2.187982688986558e-01   -1.883042464679763e-01   +2.930117884545760e-01   -2.660924581364047e-01   +1.837718400124227e-01   +3.570895880498545e-01   +9.357123501052269e-01   +6.476908719558307e-01   +6.926124669229159e-01; -2.109342770823165e-01   +4.641187617488385e-01   +1.116024258996960e-01   +3.549228509013092e-01   -2.335614290801116e-01   +1.581361193095243e-02   -7.441543930213593e-02   +3.402707660983316e-01   +3.184591897231773e-01   -2.967567396674414e-01   +4.464898436916950e-01   +4.086007061836570e-01];
L2E_Input1_iAMPA_netcon = [+2.454749890349018e-01   +2.779549407941701e-01   +4.519507474034673e-01   -2.420472478272515e-01   -3.480324648016173e-01   +1.335212798283179e-01   -7.644249519237797e-01   +5.079207240539168e-01];
L2I_Input2_iAMPA_netcon = [-2.735790360932945e-01   +1.609612305507441e-01   +4.452441945097430e-01   +1.211506956491805e-01   +6.845759186275582e-01   +3.127152946715979e-01   +4.377756004113087e-02   -9.364808079872469e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
