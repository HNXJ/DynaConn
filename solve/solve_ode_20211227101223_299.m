function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.114002451570175e-01   -1.017978393872337e-01   +1.161367001636807e-01   -2.633616400190240e-04   -2.538935289541396e-01   -1.569170476363210e-01   +9.916428337295810e-02   +1.205523356465005e-01   +2.337956529851044e-01   -2.062825042232008e-02   -2.486594929169793e-01   +4.135809122528182e-01   -1.124717492316784e-01   +5.135476367007100e-02   -4.200589584885081e-02   -2.005181996701123e-01; +2.149172708191017e-01   -1.095889403042965e-01   +1.210521735006951e-01   -1.247751288522516e-01   +8.198528726140009e-02   -6.036742315143166e-02   +8.723620127736145e-02   -1.464346117584171e-01   -1.006476485694257e-02   -1.621695015744488e-01   +1.067781599446759e-01   +1.455450950712846e-01   -3.059501552817445e-01   -3.085312655050180e-02   -7.980042960852526e-02   -3.009179114152274e-01; -3.410282570400969e-01   -8.700281406601862e-02   +7.246794468240098e-02   +7.454389757136820e-02   +3.951225553299575e-01   -1.730807300339431e-01   +4.182388128596180e-02   +1.161465821676440e-01   -1.967481842697782e-01   +1.615582748365062e-01   -1.910923190817203e-01   +7.846998451247277e-03   +1.479800958494357e-01   -1.942187373433742e-01   +3.631776422279581e-01   -1.001011032633813e-01; -1.998630870014304e-01   +3.501801841329683e-01   -6.762214036573075e-02   +3.014740278400680e-01   +1.268285915879367e-01   +5.274733844476315e-02   +1.331879227530315e-01   +1.474400905598210e-01   +1.018724158791184e-01   +4.791716367242436e-01   -3.728914810433345e-01   -4.283583386640577e-03   +7.587960768582917e-03   +3.529896608434653e-01   -2.852331475878415e-01   -1.085013384092160e-01; -1.548113305485483e-01   +9.093489252863302e-02   +1.967953994622041e-01   +1.452495381680404e-01   +1.151933176303138e-01   +2.856288674993219e-01   +8.737647633952747e-02   +3.593496693589414e-01   -5.298433791131237e-02   +2.964402186184814e-02   +5.183859873073102e-02   -4.968678143071073e-02   -1.989791144082352e-01   -1.931495173579167e-01   -5.835990185431631e-02   -1.844386037672410e-01; +1.311674131831276e-01   +5.536122758981193e-02   -3.521272686685853e-01   +1.855075206975955e-01   -3.493930887444484e-02   -6.990132011731587e-02   +1.930516547694226e-02   +1.872931231037734e-01   +2.040355259077244e-02   -3.679897093445392e-01   +4.368079054645283e-02   -2.949299089136529e-01   -7.602351007088594e-02   -2.865559487322319e-01   -1.569543713805384e-01   -4.644592759535894e-02; +1.432884929980842e-01   +2.730660976430759e-01   -9.689401967517303e-02   +2.718184016048734e-02   +1.306338678833740e-01   +5.558211191443095e-02   -2.025964320774596e-01   -2.239579435114064e-02   -8.146328329990035e-02   +2.376631851003509e-01   +1.342935285580462e-02   +6.035346012927186e-02   -1.161128523336629e-01   -1.613445706011002e-01   +1.821488082971126e-03   +2.501992902966114e-01; -1.131733934202737e-01   +5.908313865629247e-02   -1.652021335905255e-01   -9.589457804234024e-02   -2.778521491782157e-01   -1.214592135693980e-01   +1.367980595944695e-01   +1.045001647291284e-01   -1.139804773924775e-03   +8.294329897581468e-02   -3.061354194609142e-01   +1.679439821775488e-02   +1.028125724621415e-01   -1.836416631691198e-01   -8.629964452121644e-02   -4.016788877459479e-01; +7.103783236616119e-02   +1.117215756866418e-02   +5.893038231038777e-02   -5.408821940736819e-02   -4.273090995345001e-03   +5.915916028611782e-02   -4.023413512787905e-02   +1.639127850178856e-01   -1.522554888008212e-01   +1.077107137074910e-01   -2.197825655706551e-01   -3.557862474708443e-01   -6.881875241017499e-02   -1.864560411808508e-01   -2.276770618033354e-01   -1.734183670484502e-01; -1.729184108313123e-01   +2.879847600304913e-01   -8.666630249698760e-02   +1.547086463586860e-01   -1.816287431372711e-02   +3.998074251091602e-02   +2.269064854001573e-01   -1.962460282030536e-01   -3.249779738635802e-01   -1.337818607122053e-02   +9.926181850900795e-02   -1.351441528210831e-01   +1.397207286762190e-01   -6.417549833489460e-03   +1.386320754793190e-01   +8.112890607863807e-02; -2.847142530184499e-02   +3.349213618899663e-02   +1.266691949615683e-01   +1.420387958290806e-03   +1.534520369049858e-03   +1.674126565259300e-01   +3.396196172831040e-02   -6.820087087537377e-02   -1.652325801717269e-01   -1.859779710185399e-01   -2.015400089216805e-02   +8.031223494240018e-02   -3.522846489802925e-01   +1.961631571196460e-02   -3.818669082632060e-01   -9.073881941006759e-02; +3.190104230122492e-01   +2.098924250375819e-01   -1.784385173778832e-01   +6.491423718917558e-02   -6.546409026913130e-02   +7.076441879541633e-02   -1.262859625435908e-01   -9.619506658373514e-02   -7.031661910523662e-02   +1.032948039238611e-01   -2.103987642517564e-01   +6.573535936677616e-02   -1.512654325443035e-01   -2.398188422429670e-01   -2.421307697946025e-01   +2.516690569347380e-01; +1.532702982648332e-01   +1.459927511277808e-01   +1.821985082555372e-01   +6.697827966759429e-02   +9.218446678618442e-02   +2.220516718658010e-02   -1.917622286211059e-01   +1.988138202878454e-01   +8.006261683139893e-02   -1.650925236047754e-01   +8.692010520595039e-02   +2.345118364070068e-01   +1.496994080370710e-01   +1.534212766639000e-01   -5.824779044591263e-02   -7.574464645491770e-02; -9.415114439605254e-02   -1.463812884602591e-02   -1.456744749007782e-01   +3.263321705977427e-01   +2.194750017589542e-01   -1.660272361476469e-01   -1.485371919261833e-01   +2.180366924399756e-01   -1.022742760855106e-01   +5.268360693992841e-02   +1.372726192498238e-01   +6.622569397883889e-02   -8.963459909578822e-02   -3.280793364631426e-02   +9.729077033243623e-02   -2.064096642621075e-01; -1.393376310841663e-02   -1.818308120454767e-01   -1.259415499167381e-01   -1.511064331097548e-01   +8.270394234924756e-02   -3.236683508480420e-01   -1.621046836299527e-01   +2.200068991222421e-01   -1.335536115888783e-01   +1.838106046631181e-01   -2.353326317646762e-01   +3.760785285497354e-02   -1.803472061621107e-01   -3.046723469236050e-01   -5.125227238089499e-03   -1.929700630773579e-01; -1.620895305818340e-01   -6.477166458805322e-02   -4.816372408071222e-01   -1.441732400096178e-01   +5.612688109865833e-02   -1.911396455231057e-01   +3.229483504112319e-01   +8.516141180873901e-02   -7.521011861347589e-02   -1.231458823663318e-01   -1.040007769145791e-02   +4.202456701045609e-02   -7.495810568227040e-02   -2.480330796064668e-01   +7.628171550473703e-02   -5.087412022593628e-03];
L1E_L1I_iGABA_netcon = [-1.209208961406787e-01   +7.578926954077708e-02   -3.366375018803375e-01   -3.638072814993114e-03   -2.722793447443504e-01   -2.804853562782569e-01   -8.619215794295693e-02   +2.716591965036365e-01   -1.393801281213706e-02   +7.868949229330079e-02   -2.930379272113804e-02   -2.795708359111407e-01   -1.781441683240043e-01   -1.037189144348577e-01   +1.878866604553171e-01   +2.936588529106652e-01; -1.606625112774768e-01   -1.199257298097736e-01   -4.566598217197693e-02   +1.112449240098290e-02   -7.091349995248725e-02   -2.024149700320878e-02   +1.300388348120316e-01   -8.578099607151578e-03   -3.449026168972165e-02   -2.012264397853954e-01   +5.686586497931672e-03   -3.245618654354116e-01   +4.319853425517480e-02   -1.885381860337628e-01   +4.543637096986407e-02   +1.200544676398148e-01; +4.365027854177819e-02   +1.391675712696621e-01   -1.908900701358602e-01   +1.145865302956000e-01   -1.793902281309576e-01   -1.584008268882308e-02   -8.916190569354673e-02   +5.229038724231683e-02   -1.369776603299803e-01   +4.031352573855856e-02   -2.926243488783080e-01   +2.594938686908712e-01   +2.041672655864258e-01   +9.066294430803801e-02   -3.283362469635429e-02   -9.543353741181637e-02; -8.037684034652109e-02   -3.066313605081233e-01   +1.866717641074047e-02   -4.455123070137187e-01   +4.127087951604086e-02   -6.750794451199366e-02   -3.508268658812897e-01   -2.029822312066042e-01   -6.813886512385725e-02   -3.068963943252550e-01   -3.457646734339636e-01   -8.828844887010021e-02   +6.064134743939688e-02   +1.039493981427391e-01   +1.261534898076541e-01   +8.265002716745463e-02; +1.660518462228986e-01   +6.114442064494086e-02   -1.267023043665861e-01   +1.088816065106985e-02   +2.584510685013820e-01   +2.276731546179918e-01   +1.980528987703042e-01   -4.935134808031916e-02   -1.801812827020494e-01   -6.091441007020118e-02   +1.458306620783578e-01   +2.028035909996839e-01   -4.199593924210326e-02   +1.239876192456774e-01   +2.501393496147707e-02   +4.259628614807762e-02; +1.316717348596442e-01   +6.818063991067724e-03   +1.383170155706184e-01   +6.603911855496841e-02   +3.056642710959027e-01   -1.270239991502256e-01   -3.426510900223239e-01   -1.688176996911973e-01   -1.191963838474026e-01   +7.623036334643761e-02   -9.538344335492260e-03   +4.185968213472144e-02   -9.148078461472499e-02   +3.823315088137829e-01   +5.085088803611072e-01   -6.180586834493727e-02; +3.565954602333374e-02   +1.648085711622354e-02   +1.133975302256242e-01   -4.038919631488160e-01   -5.327687416481831e-02   -9.423966671998399e-02   +1.974312987149718e-01   -1.137809514599276e-01   +2.972857371015439e-01   -6.493916763571683e-02   -1.002228911875324e-01   -9.802560947182198e-02   -2.437554255215653e-01   -3.124969837802792e-02   -1.512368816684565e-02   +2.004680491410520e-01; +3.713113629529486e-01   -2.468485895650441e-01   +1.203928345939358e-01   +3.418407547797311e-01   +2.573006718078815e-01   +2.490684544176826e-01   -9.390226465869692e-03   -9.621065056016433e-02   -1.976828574483862e-01   -5.950654608782732e-03   -1.017456383271537e-01   +7.589367217899973e-02   -1.657340117096560e-01   -1.546442412332936e-01   +1.035865707807395e-01   +8.542988964066656e-02; +2.361050703247741e-01   +9.101761391764694e-02   -5.813645773226846e-02   +9.212328702322196e-02   +4.337149313602777e-02   -2.260358180359613e-01   -3.584489484516263e-01   +5.943302615162263e-02   +2.138170977881177e-01   -2.718554012828140e-01   -1.499347468618805e-01   +6.651041898642721e-02   -1.593032917005869e-01   +1.596935727985666e-01   -1.847851003192582e-01   -5.852026648662924e-02; +1.029047326738058e-01   +6.485042972103991e-02   -1.075240188259247e-01   +1.589103077640920e-01   -3.953142658258436e-01   +1.406469352715193e-01   -3.167896437057312e-01   -7.785642441567339e-03   +3.158830028279118e-01   +2.634402521609997e-02   -2.713618190895908e-01   +1.866404022908251e-01   -5.562240352304114e-02   -1.649384821328289e-01   +4.100724963129342e-02   -1.223110847514403e-01; +1.788764348023371e-01   -3.075741903758648e-01   +5.099907026117545e-02   -9.320039369274244e-02   -2.860561030793976e-01   +2.122806686483915e-02   -1.053802438871266e-01   -3.191134709618719e-02   -9.579225277476586e-02   +3.708872365049392e-01   -3.275459381173364e-01   +1.691720476638017e-01   +9.116140514099652e-02   +8.798523880900108e-02   -2.012611624837291e-01   +2.198008597208861e-01; -2.601000740516232e-01   -3.352046831606230e-01   -1.498600416293188e-01   +2.254909504509485e-01   -2.175760250482110e-01   +4.946710608480392e-02   +1.369767351280135e-01   +2.105755048046992e-01   +1.135033692872046e-01   -2.256681992217092e-01   +2.566869837738947e-01   -2.211545394515752e-02   +3.935659401590623e-03   -9.072558984167296e-02   -1.575783600836648e-01   +2.761161948656752e-01; +1.297153781495712e-01   -1.950119324823216e-01   +2.999791127528009e-02   +2.193559368117299e-01   -1.397782152345065e-01   +8.434354574588879e-02   +6.945380917391718e-02   +4.588092612122666e-02   -5.161135236380846e-02   +1.148125671636029e-01   +2.974624020657005e-01   -3.262940160681230e-02   +2.502395638320020e-02   +7.392490430058778e-03   +5.882787843288206e-02   +4.215868966593784e-02; -3.320909940883587e-02   +2.825789998898637e-01   -2.139666163429057e-01   +9.776964674817021e-02   +3.305226559043447e-01   -7.040808626210197e-02   -3.142835361548632e-01   -4.443213873541604e-02   +4.308602852136525e-01   +8.279768827950815e-02   -2.495330254514257e-02   +1.419096502697179e-01   +2.152694736354287e-01   +1.814643933129686e-01   +1.726499180459389e-02   -3.807154532475470e-02; -4.752944368467777e-03   -2.567652044408578e-01   +2.892397852243905e-01   +1.611901694124326e-01   +1.124622053447550e-01   -2.237496905587812e-01   -7.047840342076483e-02   +1.110136258191730e-01   -8.496877768874786e-02   +3.706541748440116e-02   +1.367939716456973e-01   -8.401158370251419e-02   -1.295105219061107e-01   +1.602280240638371e-01   +3.774532566923839e-02   +4.045607470856362e-02; +1.738462798782579e-02   -4.706259999666566e-02   +1.440864180901601e-01   -1.670232645037129e-01   +2.140173195089037e-01   -2.396227814239829e-01   +1.902993441549224e-01   +3.121444708117956e-02   +4.582744671479205e-03   -3.317587698783633e-01   -7.142482979763935e-02   +9.322846808304658e-02   +9.581919077531147e-02   +1.496089119318868e-01   -1.600520840161309e-01   -2.560596920314581e-01];
L2I_L1I_iGABA_netcon = [-2.579566744242993e-01   -3.770544035744200e-03   +9.464601916291908e-02   -2.028779937815643e-02   +2.606073702563658e-02   +1.866383488427183e-01   -2.609666605623742e-01   +6.343840953222013e-02; +3.440421999018469e-01   +4.518753199812610e-02   -2.593858126677257e-01   -1.461114985244575e-01   -2.319522277916679e-02   -9.917978932743363e-02   +2.226236016678155e-01   -2.570606825531584e-01; -1.144112647650003e-01   -5.535829041848814e-02   -9.356102470525156e-02   +1.880351447939474e-02   +2.244422010261505e-01   +2.005678338887651e-01   +5.867476060900591e-02   -2.181945736042647e-01; -2.960341866311432e-01   +1.984715829315776e-02   -5.824285480593183e-02   +3.306094264473146e-01   -6.658566546482531e-02   +1.239894564103001e-01   +1.304196597245651e-01   +5.150544112660103e-02; +1.906693412479153e-01   -1.828430206278950e-01   +1.337876367684578e-01   -1.813052651364146e-01   +2.586855010088246e-01   -5.909005967222743e-02   +7.173755133384792e-02   -1.730220987455734e-01; -1.600056209513556e-01   +2.596167231381917e-01   -9.563603373945448e-02   -2.538481003082321e-01   +9.009100318086123e-02   -3.432738172895390e-02   -3.059388483721323e-01   -5.265159530967652e-02; -1.956424886210803e-01   -1.345230522802897e-01   +4.624556166980734e-02   +1.663652893303980e-01   -2.759173232995628e-01   -4.731174328743257e-02   +5.323173078354762e-02   +6.451910725025270e-02; -1.164281254413314e-02   -4.892721328669884e-02   -1.597714687891748e-01   -8.030186297882644e-02   -1.232199911256677e-01   +1.595973201117622e-01   -1.381393931613851e-01   -3.181563324896056e-02; -2.784200531293329e-01   +1.366543316913350e-01   -1.947406743002015e-01   +6.350609026357845e-02   +1.047790358260474e-01   -1.951642145310136e-01   +8.088669578240486e-02   +5.600461334798071e-02; -3.418568037683370e-01   +1.855103937709852e-01   -9.523412749752660e-02   +3.769178354591411e-02   +2.717614181138173e-01   -2.325723760559530e-01   +1.008270953061970e-01   -4.257439949173182e-01; +5.163896171811302e-02   -2.189726885865144e-01   -2.413421686262479e-02   +2.746713385531053e-01   +2.292758474189209e-01   +2.462047963264364e-01   +3.614311227126613e-02   +2.209876300288155e-01; -2.808594979695009e-01   -8.112616283430374e-02   +9.608643879178920e-02   +2.808575762332039e-01   +3.181485952591670e-02   -1.961732424726498e-03   +1.022500459075315e-01   +1.585941005960179e-01; +7.109339453980529e-02   +1.263423918309898e-01   -2.228300821760999e-01   +2.853581577530905e-01   +2.303367926501831e-01   -1.108475047989055e-01   -4.292125435436708e-01   +2.193854633569561e-02; -1.923118606203072e-01   -2.270389277315907e-01   +2.492651772337091e-01   +1.070635454765887e-01   +2.469746240352605e-01   +5.313646482222466e-02   +2.437003213686898e-01   -1.335535518434756e-01; +1.618670312543107e-01   -4.574743837178091e-02   +8.768028166497632e-03   -9.214420677156314e-02   +2.422266529188515e-01   +1.209195650544437e-01   +6.729914165773411e-02   +8.574198325406569e-02; +5.636557065204250e-02   -1.850793390161583e-01   +2.959419007350073e-01   -9.860735455446148e-03   -5.310475839391214e-02   +6.934204293989846e-02   -3.680551813910601e-02   +7.320246180683353e-02];
L1I_L2I_iGABA_netcon = [-3.145181255641356e-02   -2.287073840325009e-01   -1.682705506605754e-01   +6.867674995392935e-03   +8.657025387460177e-03   +1.445645828187438e-01   +2.494059524008103e-01   -1.134067757186477e-01   +8.404337057876626e-02   -2.504610070801100e-02   -1.141779055051938e-01   -4.327818064245789e-02   +1.542610873738351e-01   -4.397960490289343e-03   +2.134084266527293e-01   -2.857056230091209e-01; -3.466794466785330e-01   +3.166957826401239e-01   +4.301039848109370e-02   +1.018385333071453e-01   -1.386759983719119e-01   -2.813717524379581e-01   -5.113001266151608e-02   +1.267497245660461e-01   +2.162356464831506e-01   -2.122877615286980e-01   -2.431242708587185e-01   +3.566456973132039e-01   -2.954389652571989e-01   +2.144743915098843e-01   +6.575844639032252e-02   -1.719830743990096e-01; -1.006776347792429e-01   -6.289755272219591e-02   +3.555640890018519e-01   +2.146325349293247e-01   -1.134733502000564e-01   -1.788867231576881e-01   -2.477974254495694e-02   +1.138647831299790e-01   -2.292439321709528e-01   -2.540843678336989e-01   +3.331261227182510e-01   +5.722153890937288e-02   +1.517512507657619e-02   -4.563850000040579e-02   +2.049899874037530e-01   -2.268902086179195e-02; -2.626906437716665e-02   +4.425762100394659e-02   +1.185160727158984e-01   -6.883686107124743e-03   -1.045869650776484e-01   -5.255226426734747e-02   +1.834347551240450e-01   -5.519371253728646e-02   -8.694577538420555e-02   +2.306578505072493e-01   -6.547829565802839e-02   +2.127268850222006e-01   -1.767978846743979e-01   +1.150117299150129e-01   -1.097244803498056e-01   +2.829861077948681e-01; +3.656688599019196e-01   +5.049392094770661e-02   +2.851071731544072e-01   -5.013639544208712e-02   +1.540900376086005e-01   -6.405237011960896e-02   +3.553109241020340e-01   +1.993394793794835e-01   +6.004982199798471e-02   +1.174741658620999e-01   -2.029515530589755e-01   +8.783507839926534e-02   -4.827939468781298e-02   -6.159374342612157e-02   -1.311967984267569e-01   -2.953234141026935e-01; -2.504859791843578e-01   +2.632954377146636e-01   +3.399865502511748e-01   -2.056268364461657e-01   +1.840533710022472e-01   -5.878600777977622e-02   +2.679880112487456e-01   -2.857536803725057e-01   -2.322050155450576e-01   -2.860035457654388e-02   +3.002964787855942e-02   +2.316692342178775e-02   +2.136922214823600e-01   +2.057632404204324e-01   -2.740597726053320e-01   -1.213480849948684e-01; -2.796350902986291e-01   +1.519233661758095e-01   +4.168490295082396e-02   +9.541817872691713e-02   -7.172445378687345e-02   -3.333706430952589e-01   +4.419902529423653e-02   -2.234390415951501e-01   +1.482455640535197e-01   +1.215720734618436e-01   -9.518341791606716e-02   -2.001699185224610e-02   +1.281402607285009e-01   -3.433538001134419e-01   -1.827722108263594e-01   +1.015434900514132e-01; -3.551289643923691e-01   +2.087228587200477e-02   -1.648912046253179e-01   -6.091501072102247e-03   +1.093290107337978e-02   -2.801100141908200e-01   -8.125177050755918e-02   +6.058906868515801e-02   +5.995088100470886e-02   -1.948580142638543e-01   -1.714476208026233e-01   +4.276925219011747e-01   -1.704010020393955e-01   +1.201198127678115e-01   -2.664355764689552e-02   +6.934959429011961e-02];
L2E_L1E_iAMPA_netcon = [+1.736248570743039e-03   +3.013517455859753e-01   +4.656264188603396e-02   -5.914892415619649e-02   -2.405258543732319e-01   -2.386643032913021e-02   -2.164901554979152e-01   -3.130387502136159e-01; +2.194732829210459e-01   +6.541925691859220e-04   -2.997742722539728e-01   +1.711298038523672e-01   -1.200509342001349e-01   +1.818383898352255e-01   +2.827948271561083e-02   -1.130983956152353e-01; -3.706835518193878e-01   +2.988456250843409e-01   +1.954896800811431e-01   -7.765376045219451e-03   -3.320345198789978e-02   -1.578695990644160e-01   -2.448012295165258e-01   +2.629152011924731e-01; -3.479075046363544e-01   -5.381715183107066e-02   +6.796967419712893e-02   -3.455478510141200e-01   +3.342730869510037e-02   -9.898686461732864e-02   +2.111462060198918e-01   +1.955301883296550e-01; -1.672885399111346e-01   -2.727820698248901e-01   +2.660991241109323e-01   -5.664871164220919e-02   -9.662217773103199e-02   -1.288232626989020e-01   +3.608795736108625e-01   +3.799636643532958e-02; -2.452950065559286e-02   +7.153751131204525e-02   +1.164067544215804e-01   -1.539133391186282e-02   -1.113248482245738e-01   -3.351999589625534e-02   -4.599933148002735e-02   +1.860786474505366e-01; +1.602718384548759e-01   -1.320473654705793e-01   -1.195523772517068e-02   +5.044990268258759e-02   +9.329318209241676e-02   -5.835409348240184e-02   -1.383694279355107e-01   -2.355134955974979e-01; -5.793234232676167e-02   -3.452120284163053e-02   -1.153227331470730e-01   -7.895663884777587e-02   +2.364356775999263e-01   -5.107594818534245e-02   -4.220641801249034e-02   -2.124928051924893e-02; -9.383671340955115e-02   +1.463960052072041e-01   -3.862301762007699e-03   -8.702965534538962e-02   +1.773551052809465e-01   -5.832965581813792e-02   +3.315367799041416e-01   -2.284419517229843e-01; +2.510289679390850e-01   -4.220273507505635e-03   +9.362019530891873e-02   -1.923054645845446e-01   -1.965689103879439e-01   +7.377563055286340e-02   +2.279275472724498e-01   -2.582003713399340e-01; -2.211455764290898e-02   +1.390256302843638e-01   +8.937200762847927e-02   +1.735141202060500e-02   -1.289816180962124e-01   +1.207080927000135e-01   -1.825917873397870e-01   +1.899233170312848e-01; +2.910891037384949e-02   -3.878493149638589e-01   +3.033159843221223e-03   -3.318505477163357e-01   -3.011882201367306e-02   +1.006711179567333e-01   -3.443976440428188e-01   -5.653876760072511e-02; +2.720467828476589e-02   -1.192212237771418e-01   -8.440686826761318e-02   +3.321602287774012e-01   +1.296023762485145e-03   -2.184325945726671e-02   -2.415187650109189e-01   -5.246556237673367e-03; +5.195589674011135e-02   -1.225754151626305e-01   -3.625886252548802e-01   -2.128943033117778e-01   +9.196394449610476e-02   +1.063244882369143e-01   +3.128874014835122e-02   -2.844495999873458e-02; -6.518955073771460e-02   +5.443773192264267e-02   +1.678316143002081e-01   +7.950986922565244e-02   +2.463581123943501e-01   -2.602095441852114e-01   +7.293476807003001e-02   +1.819384930250336e-01; -1.023554909563379e-01   +9.394235941490751e-02   -1.402265267331026e-02   -3.211379541499052e-01   -5.850753466983591e-02   +2.179628429791485e-01   +1.163822721215218e-01   -3.809601639062073e-01];
L1E_L2E_iAMPA_netcon = [-8.259308176829816e-02   +8.445097728810330e-02   -6.073094387654202e-03   -1.375799555278760e-01   +5.893787049796270e-02   -1.830728008449043e-01   -4.211843345289132e-02   -8.505182507185083e-02   -4.280262757237464e-01   +7.115029785799930e-03   +3.507591891349535e-02   +2.109122456503619e-01   -2.061058973805993e-01   +1.650262200825795e-01   +4.309099441653427e-02   -7.060842596922258e-02; +7.016827385527553e-02   +3.000199762919917e-01   -4.461428848450419e-02   +2.104280059586128e-01   -1.141258973922230e-01   +1.286854051317632e-01   +5.584430981833954e-02   -5.073429635363724e-02   +2.671957971908667e-05   +1.865273490918362e-03   -2.609190203119230e-01   +1.192001573764437e-01   +6.703866400802255e-02   -3.449907113573108e-01   -1.839133510469030e-01   +5.339079487760530e-02; -1.372864500797814e-01   +9.790567839717129e-02   -7.259253372752635e-03   -3.206676445074420e-01   +1.944746415588730e-01   +7.561769280954349e-03   -5.723906465160254e-02   -8.388164960427667e-02   +1.307575022050370e-01   -2.526959744636516e-01   -1.995820292088480e-01   +9.851132922324066e-02   -4.361625205399873e-02   -2.681129392546461e-03   -9.475871494428170e-02   +7.684201446767953e-02; +3.380931465100963e-02   +6.806124324947189e-02   -1.228300739826268e-01   +1.643115359387918e-01   +8.326267850302185e-02   +1.161026055498875e-02   +6.885752301451273e-02   +1.516921124707783e-01   +2.475862484534169e-02   +4.542588711620107e-02   +2.592313457404055e-01   -1.783180047914800e-01   +2.982902286365578e-02   -4.312566772631643e-02   -9.949138956845444e-02   +1.627751918994869e-01; -8.609033019945243e-02   -3.068771728517686e-01   -3.266018778588195e-03   +6.751186504400593e-02   -2.291149253402787e-01   +1.713144075598557e-02   -3.000589093551296e-02   +8.287520271987356e-02   -1.280156096963445e-01   -9.497618610069125e-02   -2.115389889868347e-01   -3.125467911495872e-02   +3.626906656735997e-02   -1.097955941917154e-02   +4.635463762439764e-01   +1.481206401088476e-01; -4.390730735325781e-01   -3.058955053430636e-02   +1.884231151151154e-01   -1.273276322039146e-01   +2.360375373767885e-01   +1.251919514994903e-01   +1.745610376879294e-01   -1.057743055947166e-01   -4.225071031275456e-02   +1.652220591347797e-01   +1.386935548579319e-01   +2.680468944095130e-01   -2.016208488871247e-01   +2.816209767235581e-01   -9.869737355962736e-02   +9.437597175228855e-02; -1.010149386180141e-01   -2.642623394531689e-01   +3.453017566437548e-01   +5.171690007098580e-02   +4.460923021145050e-03   +1.786335283915508e-02   -2.303850727785472e-01   +5.360298860393198e-02   -1.279119887827135e-01   +1.884225196254210e-01   +2.081723451069056e-01   +8.431458342513889e-02   -6.243796196783725e-02   -1.789261902659391e-01   -1.452245440199292e-01   +7.004227513085863e-02; +2.998856617817341e-02   +2.073713046463144e-01   -4.816694314269516e-02   -7.506178533240965e-02   +5.990604141828952e-02   -1.630691990715376e-01   +1.597962089511659e-01   +1.386252552664116e-01   -3.977988834800240e-02   -8.135746385012510e-02   +1.887148556404197e-02   -5.689519089532515e-02   +7.329255784807270e-02   -1.323775873672536e-01   -2.260024044986332e-01   -5.234821578625617e-02];
L2I_L2E_iAMPA_netcon = [+2.380248404844722e-01   +1.766190199640329e-01   -4.009489792346380e-02   +2.828511051458716e-02   -9.244375361093082e-02   -2.739478122904281e-01   +1.066553454918226e-01   +1.136122243405609e-01; -2.195582632899151e-02   +7.654837284768265e-02   -3.268082819902481e-01   +1.236324175361808e-01   -7.574620156147738e-02   +3.394311366391538e-02   +9.973168624815965e-02   +1.009681998467522e-01; +6.729267737929871e-02   -1.972880262329280e-01   +1.012766082938080e-01   +4.281318410569933e-01   +3.223293469771376e-02   +1.419984973489873e-01   +6.907641764133951e-02   +4.318118918531186e-02; -1.984296773011526e-02   +1.308723466643283e-02   -1.475132473894026e-01   -5.292151271904998e-02   +2.372415019740502e-02   -7.182487027775683e-02   -3.377257276461895e-02   -1.514593578697064e-01; -1.656599827214400e-01   -1.069337107007974e-01   +1.467260882057082e-01   -1.926437697940012e-02   -5.634023994222724e-02   -1.376883618818013e-01   -1.610887565850389e-01   +1.315155692067231e-01; +2.636524128563564e-02   +2.104247328520137e-01   +2.595864931047969e-02   -1.954677123373407e-03   -3.103498546601350e-01   -4.630058704815108e-02   +1.678050892638878e-01   -3.473333477865992e-02; -2.846119726372360e-01   +2.292184452290430e-01   +1.631121706465387e-01   -1.624157653038701e-03   +6.937188532047914e-02   +7.443694645497301e-02   -8.753305020432328e-02   +1.039042685708700e-01; +1.374364509542269e-01   +5.706997464537383e-02   -6.664470518876642e-02   -2.368273823144807e-01   -2.749582686057302e-01   +1.004600078780679e-01   -6.999825072940372e-02   +2.552733827135200e-01];
L2E_L2I_iGABA_netcon = [+8.345888903591100e-04   -1.180566630894173e-01   -1.562671886145311e-01   -1.276079826461233e-02   +1.827610410977859e-01   -1.434758327976857e-01   -5.662256918851671e-02   -1.016052997097621e-01; -1.838845044978364e-01   +2.183808424411008e-02   -7.355509557371291e-02   +1.998396312396935e-01   +1.489661348034722e-01   +3.685624664181580e-02   +2.600249496715190e-02   +3.914228819904553e-01; -8.861572243650434e-02   -1.616499914910347e-02   +1.193438815579312e-01   -2.515261848730507e-01   -1.155670756859775e-01   +5.493468257417921e-02   -9.179260924488894e-02   +1.479911982850994e-01; -1.243972495760325e-01   -1.775608558265140e-01   -1.773459507453766e-01   -2.362397423826805e-01   -2.209194997999667e-01   +2.788503750706352e-01   +4.222407590719028e-01   +2.681842109368517e-01; +1.826222698269498e-01   -3.132047272574517e-01   +2.376782769684734e-02   -1.534142160852840e-01   +1.890183656852014e-01   -2.910946240138873e-01   +5.494370356724002e-02   +1.205477688611116e-01; +2.215930327735875e-01   -1.866066489131464e-01   +6.634037795867430e-02   -1.954587760475989e-01   +1.004813539985194e-01   +4.563658179447289e-01   +1.229674806392493e-01   -2.155095713293320e-01; +6.578520222005818e-02   +3.468008154488194e-01   -2.083497949676916e-02   +5.426052071930929e-02   +1.220641009058793e-02   +1.742193835658077e-01   -2.319177176540093e-01   +1.196188792758618e-01; -3.697050826309927e-02   -9.856932661364168e-02   +2.911317453964728e-01   -1.964591364901524e-01   +2.566544870707473e-01   -2.546166066037067e-01   +2.991317286933049e-02   +3.695004506558626e-01];
L3E_L2E_iAMPA_netcon = [+1.073443163817392e-02   -2.072337305910456e-01   +2.144326682457367e-01   -2.313320323704234e-02   +2.571765602725285e-01   -3.943462795357488e-02   +1.338842287390178e-01   -3.872855299738047e-01   -1.067808431766176e-01   +4.594344253032111e-02   +1.044409541005166e-02   +1.362744337158664e-01; -1.155355302837425e-01   -3.966985558470384e-01   -1.309970932388803e-01   +3.281413916372023e-01   -1.804640787379074e-01   +1.674874847493131e-01   +1.068740186163224e-01   -1.894700850461112e-01   -1.470471165167078e-01   +1.545067333093761e-01   +5.221576714196449e-02   -3.195550313413144e-01; +2.767002983112837e-03   +2.643890654228001e-03   -3.364559966938436e-01   +1.332716828107872e-01   -2.410516714800134e-01   -1.617739346632457e-01   -1.735081599090920e-01   -3.053993667144319e-01   +6.168956090884959e-02   -1.116694839292582e-01   -1.991578281524128e-01   -2.673748062867680e-01; +6.367978410756728e-02   -1.544716827670279e-01   +2.433501003025856e-01   +1.397770105949687e-01   +1.408779135827281e-01   -2.199750921776660e-01   -2.893895109291006e-02   -5.828295297473254e-02   -2.340705073587753e-01   -1.242547263219378e-01   -3.804220271676117e-02   +4.595684452843322e-02; +1.776654948877799e-01   -3.327089723896737e-02   -4.079143242599934e-02   +7.190977620346098e-02   +7.944128809319784e-02   +1.520040235880762e-01   +3.830010961533311e-01   +5.977806510665312e-02   +1.435156617458954e-02   -9.907675064668615e-02   +4.244239215837586e-02   +2.532256625896294e-01; -5.465246234867181e-03   +1.723077745133923e-01   -2.749455535136144e-01   -7.721591089084028e-02   -3.100545657366552e-02   -1.977959647104768e-02   +2.257793779897270e-01   -6.704063872510772e-02   -2.023631737889091e-01   +2.284989132742013e-01   -1.783517418859864e-01   +1.736566559154904e-01; +2.265566744823214e-01   -2.276613053763604e-02   -2.074470275990108e-02   -1.633277010463752e-01   -1.635801917024105e-01   -1.703678782030819e-02   +9.933303828374372e-02   -2.455607192725659e-02   +1.820960791820632e-01   +1.905006207154698e-01   -3.522394143920917e-01   -1.506345101196408e-01; -2.853253764346301e-01   -2.238097997947004e-01   -1.677274225776203e-01   -2.665532985268147e-01   -1.274093506925071e-01   -1.856179062539497e-02   +5.431112467518033e-02   +5.355487762928988e-02   -1.614708939698221e-01   -8.586758005761025e-02   -8.328110970968901e-02   +2.464958758983444e-01];
L3I_L2I_iGABA_netcon = [+2.440717019713982e-01   -1.580028847347656e-01   -3.841147111307455e-02   -1.916988960480095e-01   +1.324783807849179e-01   +1.350170568900123e-01   +1.273525407655286e-02   -3.440532539674391e-01   +1.368497670240317e-02   -2.037795148016360e-01   -4.303110253084313e-02   +3.477144121582850e-01; +2.442141786068785e-01   +6.793799578032805e-02   -9.960888736746462e-02   +6.145098965684045e-02   +2.515531445739126e-01   +4.110460860004077e-01   -2.185861929343207e-01   +1.075095857979813e-01   +8.393114567834752e-02   +1.200230655344241e-01   -1.835816237991739e-02   +2.093345706246669e-01; +1.530904588947933e-01   +8.716538121933862e-02   +3.150569802347403e-01   +3.053307155365957e-02   +9.698060514862841e-02   -9.031022909218293e-02   +4.663487770257739e-02   -1.358171921177230e-01   +7.643929288415762e-03   -2.085488580904912e-01   -2.737476024843269e-02   -1.489939398022287e-01; +3.923328300148979e-01   -8.568306096526586e-02   +3.116968381146279e-01   -2.284709625649056e-01   +8.475738108810990e-02   -1.604925256881771e-01   -1.137817641797587e-01   -2.028011694454266e-01   +1.311508971549536e-01   +1.018102870663503e-01   -4.631501552868975e-02   -4.202265519130665e-01; +2.464875542379665e-01   +1.164814908182842e-02   -8.263065852314985e-02   +4.605975669029091e-03   +4.184495543368151e-02   -1.568843132170581e-01   -1.839805852997458e-01   +5.135135344036254e-02   +3.291439353805931e-01   +2.350160611298747e-01   -2.194739328411641e-01   -1.937162400855333e-02; -4.509347174926974e-02   +2.881433313459510e-02   -1.843339395573731e-01   +6.706351163370985e-02   +1.660653681432246e-01   -1.744508971040798e-03   -3.599017918939808e-02   -1.030113486287183e-01   -1.112747131859089e-01   -1.852054650703563e-01   -1.836486353498194e-01   -2.066469659530554e-01; -2.044614308623736e-02   +1.830879942434110e-01   +1.370020553381744e-01   +2.733759053802023e-02   -6.695999582912629e-02   -3.588417845363827e-01   -3.151541899291362e-02   +2.006936856227487e-01   +1.834086815086306e-01   -7.408171452765241e-02   +9.831327717533098e-02   +5.575145134377518e-02; +4.578868700932276e-01   -2.281883377722324e-01   +6.335939154138676e-02   -3.382090882090023e-01   -9.126502744643700e-02   +2.189757361785036e-03   -2.873855004451084e-01   +2.109956443620675e-01   -9.344113349476339e-02   +5.255482789119813e-02   -1.653678066210766e-01   -1.281009322997920e-01];
L2E_L3E_iAMPA_netcon = [+1.910728122894035e-01   +7.016489690129564e-02   +2.430177850708051e-02   +3.473242456129826e-02   +2.754399923170840e-01   +3.281390445455904e-01   -9.954662977456566e-02   +3.622477040154006e-01; -2.068348724510197e-02   -2.470038325856664e-01   -2.255056832844159e-02   -3.826055098776531e-02   +2.598759558196369e-01   +5.658868889246754e-02   -2.625462869840234e-01   +2.257260012236876e-01; +1.085883736737689e-01   +3.242214892427876e-01   -5.316885970302219e-02   -3.416920803806554e-02   -9.807447077784773e-02   +4.422405001268337e-02   +1.306648222292205e-01   -3.445006738607988e-01; +1.932630250167932e-01   +3.308527942319672e-01   +7.253479192747844e-02   +5.903549704903540e-02   +3.412004906448850e-02   -1.471552383148662e-01   -2.734894173106834e-01   +8.697414692215791e-02; -3.505587305360115e-02   +2.122199656468085e-01   +2.756053753950265e-01   -2.175637018597071e-01   +2.077661786964265e-01   -4.208983249235156e-02   -2.327473676024399e-02   -1.854650612142335e-01; +1.163431044806695e-01   +8.689397995799472e-02   +1.071098825363239e-01   -2.623517160783512e-01   +9.935615263714140e-02   +1.322650591830264e-01   +1.915378566758877e-01   -2.016770860686875e-01; +6.612362782778855e-02   -9.821712526684934e-02   -2.361381219689777e-01   +9.330676784494471e-02   -1.061334227264277e-02   +1.493479611006265e-01   -2.933786433551165e-01   +1.827523015731915e-01; +1.134891370868019e-01   +1.213979596790601e-01   -3.190277256301698e-01   +3.242675995796754e-01   -5.950653612518981e-02   +2.240309390916424e-01   +1.412325754200857e-01   -6.682375148143693e-02; +3.219209025429182e-01   +2.881568674573350e-01   +3.048438331415481e-01   -3.455029876578711e-02   -9.911979171921356e-02   +2.539763684910427e-01   -8.090264412747021e-02   +2.260818432553702e-01; +6.611012391148997e-02   -1.966409634807818e-01   +5.003574775974221e-02   -2.039409737155023e-01   +2.363412786342990e-01   -1.140371937407745e-01   +1.765749830080531e-01   +1.553185483612794e-01; +1.668953782980797e-01   +1.534609877647678e-02   +5.751173119941529e-02   -1.070769886932919e-01   -7.441268599435001e-02   -1.733255037971144e-02   +2.262304885722648e-01   -1.589519150472748e-01; +1.288145689652047e-01   -3.423536919870931e-01   +1.510668588697265e-02   -1.501141585320846e-01   +1.688835813103204e-02   +2.934473220707565e-02   -1.243993058341027e-01   -4.586276756708261e-02];
L2I_L3I_iGABA_netcon = [-1.458895591810355e-01   +5.071326470409351e-02   -4.866431144428601e-02   -2.748333019961874e-02   -2.695664656353729e-03   +1.503282751534790e-01   +2.055088209710323e-01   -1.938867390735617e-01; -1.166435413178202e-01   -1.190158757832531e-01   +7.998968044149200e-02   -1.386828739473200e-01   +2.502570824157447e-02   +8.010844091238041e-02   -2.297668975212286e-01   -4.767580843237966e-03; -7.815210082471773e-02   -9.140906102947259e-03   +3.011962022601361e-01   +1.342692525862369e-01   +2.365571764606290e-01   -1.642651440606321e-01   -1.045891039555743e-02   +5.694135874858754e-02; +2.339881120136134e-01   +1.472508967184381e-01   +5.939928974457154e-02   -3.037401915733307e-02   +3.826060102734374e-01   -9.760135449321193e-02   +1.772083994224873e-01   -3.689201281215352e-01; -2.668229739613190e-02   +2.321286196364686e-01   -1.209245541777224e-01   +1.815816470717954e-01   -1.261923810533949e-01   +1.347936957228867e-01   +1.782078485374333e-01   -2.322783280477174e-01; +3.027937924769825e-02   -1.241318272770605e-01   +2.007962584226718e-01   -1.620916971872929e-01   +1.052600148859558e-01   +1.743580142724302e-01   -1.812100921023414e-01   +2.459518346957017e-01; +1.088215910230035e-01   -9.674201199477189e-02   -3.821421344832538e-01   -1.041857429584360e-01   -4.255642217846206e-01   +3.720371267342748e-02   +1.836040529597867e-01   -2.585853531359935e-01; -1.180432677713810e-01   -1.197816094040837e-01   +2.402953615725039e-02   +4.162702562471537e-02   -2.312323546084366e-01   +2.432757979767742e-01   -1.523384474230619e-02   -7.099004442964446e-02; +1.700203043276716e-01   +3.347338825861378e-03   +1.438171401272546e-01   -1.464060713786304e-02   -1.692013716535165e-01   -2.946646437270143e-01   +5.878033893366767e-02   +9.365755951111454e-02; -2.507821059299775e-01   -1.579873692860511e-01   +2.371000098980328e-01   +7.283485097189955e-02   -3.869914290217476e-02   -3.322698833911518e-02   +1.744638140512331e-01   -1.444654621272643e-01; -6.614296856074660e-02   +8.635673365983328e-02   -8.680411875805683e-02   +4.466900404131835e-03   +1.352513282631786e-01   -8.112692732355235e-02   +3.885800732201863e-01   -1.111007673308977e-01; +1.062589818654484e-01   +1.627943667362063e-01   +1.897856436203773e-01   -4.653129832090332e-02   -2.672951956222574e-01   -8.453239737932645e-02   +1.554677121075846e-01   -1.793707396520129e-01];
L3I_L3E_iAMPA_netcon = [-1.104734355331258e-01   +1.602983968613718e-01   -6.122823931577399e-02   -3.850785883955625e-02   +1.154130695809713e-01   +3.516361954866901e-02   -2.359092424657317e-01   +8.849486222942490e-02   +3.501154648387958e-02   +3.328549286249197e-01   +1.343013702383369e-01   -5.549647168892322e-02; +1.248191254297414e-02   -2.388713260003677e-01   -2.494504334580297e-01   -2.761512387418787e-01   -1.395312620905871e-01   -1.651887386345290e-01   -4.199209380539853e-02   +2.118660513807135e-01   +6.350757528749666e-02   -2.396629098304631e-01   -5.675018106306630e-02   +1.001317612475441e-01; -1.786963312520672e-01   -1.323538526372055e-01   -2.254006677325942e-01   -5.716744008310294e-02   +1.888258744660181e-01   -1.006161326602125e-01   -3.807361749645203e-02   -1.096378320600744e-01   -2.874602303864903e-01   -1.030404525335916e-01   +2.519504520295496e-02   -1.219914318484093e-01; -2.656525306312497e-01   +8.593820984063316e-02   +1.449750814771049e-01   +2.921123780073016e-01   +1.664578778496333e-01   +7.459434487331243e-02   -7.308395579970477e-02   +9.730419561682395e-02   -2.922367653845523e-01   +8.602454810913519e-02   -2.920624177856119e-01   +1.860218032965998e-02; +1.542720419202547e-01   -4.573739293953362e-02   -1.634163719020967e-01   -2.541276467135911e-01   -4.643543579032028e-01   -5.609440314342934e-02   -1.283092264135466e-01   -4.166389680669866e-01   +1.616293215698285e-01   +1.547062053647678e-01   -2.286639238051192e-01   +1.089618151365880e-02; +2.236701691505329e-01   -1.745107712298777e-02   -3.022248696871572e-02   +1.978454099999399e-01   +1.346250610901181e-01   -4.092396553362097e-02   -1.213763305134799e-01   +2.373063581394076e-01   +2.608115351462582e-03   -2.826669021607717e-01   -7.214857920772227e-02   +2.108260240980201e-01; -1.242528565063647e-01   +2.307320874646686e-01   -7.896069922010113e-02   -8.075372555822677e-04   +2.195255740906195e-01   -2.025224126624794e-02   +1.118722629465553e-01   -9.965773179303214e-02   +2.438167862951941e-01   -2.263551203786745e-01   +9.870631328997564e-02   +3.036725323118319e-02; -6.278927932153444e-02   -1.198965181753823e-01   -1.050370098220679e-01   -3.206699804294023e-02   -9.103538894485495e-02   +1.980167476343357e-01   -4.608265211785181e-02   -3.303220944620114e-01   -1.322262376822342e-01   -8.783021736900008e-02   -2.078489544383485e-01   -2.192581775512107e-01; -7.981770840897819e-02   +2.032974807238474e-01   -1.321003657216739e-01   -1.386931073455557e-01   +2.152327752863228e-01   -7.973866535026525e-02   +1.656049649721968e-02   +2.280294949024223e-01   -1.145124692538252e-01   -1.537693215987902e-01   -1.803950404510267e-01   +2.224585295882192e-01; +4.633197710455228e-02   +5.484445133730989e-02   -7.168533297461903e-02   -1.177940323477248e-01   +5.840474912240305e-02   -1.777145074138613e-03   +2.485262843077862e-01   +2.784134930158031e-02   -4.080508960505218e-02   +2.567827851718805e-01   -2.296893282686072e-01   -1.325957565594244e-02; -1.685703240770547e-01   -2.033218819320495e-01   +2.560783919434938e-01   -5.801600097954766e-02   +1.156033071974953e-01   -1.447267252420029e-01   -6.431670844441639e-02   +1.855447228001178e-01   -5.903676625547531e-02   +1.057626010394991e-01   -1.404756757885336e-01   -4.494688317556361e-02; -1.281899357420344e-01   +4.889003921939569e-03   -1.687545677012804e-01   -1.255837172509394e-01   +3.851290805225737e-01   -2.185098951661782e-01   -1.098412368369374e-01   +9.650161060169174e-02   +1.899826411551265e-01   -7.290799137115760e-02   -3.480104090757413e-02   +4.248601601266782e-01];
L3E_L3I_iGABA_netcon = [+2.221600862373787e-01   +1.572722983394151e-01   +2.311447628515757e-02   +5.149419061387700e-02   +2.353486264045678e-01   +3.557427244039332e-02   -1.732954120824193e-01   +9.549282642334436e-02   -2.593210903082949e-02   -1.092500551962816e-01   +2.044620988310415e-01   +8.846231480918236e-02; +1.203160066964495e-01   +3.716908070845784e-01   +8.297283202844422e-02   -1.936503017456489e-01   -1.598574608594105e-02   +1.292509503501117e-01   +9.806841581990117e-02   -8.411199973802294e-02   -9.914016966574375e-02   +1.474925753571402e-01   +6.443121467690306e-02   +6.567700452956442e-02; -7.142854939777024e-02   -1.712002520510836e-01   -1.262261753580816e-01   +1.730260874044602e-01   +2.173285705034801e-01   +8.531935042414357e-02   -7.521952244275969e-04   -1.937691013084212e-01   +1.287322689046264e-01   +2.725189362988697e-01   -5.190261981076562e-02   -1.247434402447323e-01; +9.240770356406586e-02   +4.850780538254909e-02   +2.823997049539290e-02   -2.865475320615381e-02   -1.076214623063975e-01   +2.982698652404601e-01   +8.466816554145076e-02   +1.059775016019339e-01   -2.776553008671173e-01   -1.887055832181523e-01   -8.618662516037631e-02   +1.998079456743926e-01; -1.706512926744251e-02   +5.781113027339482e-04   -1.048489174867068e-02   -6.537930610511750e-02   -1.503267813516800e-01   -4.762951659210834e-02   +4.535811716802079e-02   -7.920279275301246e-03   +2.025781589701752e-01   -2.916658655434657e-01   +6.687545596386392e-02   -2.786094705097927e-01; -5.197380594739311e-02   -2.908636346735138e-01   -1.044090882322402e-01   -6.042017205114251e-02   -1.062428912278119e-01   -1.612281449777338e-01   -1.524983582894352e-02   -6.751335260451646e-02   -1.187361103495702e-01   -5.424011942723465e-01   +6.851972550533875e-02   -4.375697403716887e-02; +1.032905778545211e-01   +1.242506292846417e-01   -1.309734346111577e-03   +9.538677245502281e-03   -2.193909327611656e-01   +8.222792493229814e-03   -1.162403139565239e-01   +4.051754964920563e-01   +1.283187767830485e-01   +7.835568817073535e-02   +2.192156092462398e-01   -3.428793890992255e-01; +6.919915539178695e-02   -3.419720293782439e-02   +3.736704392528499e-01   +1.022901756599980e-01   -3.082437786679638e-01   +2.065579691686677e-02   -9.224145949547090e-02   +3.457276048021918e-01   -1.235961531807968e-02   -1.966062475445966e-01   -1.001209380101680e-02   +1.400517406265420e-02; -8.561264273673348e-02   +2.393535655683562e-01   -3.104686749373247e-01   -4.176416289011104e-02   +4.953810082227364e-02   +3.854004535671480e-01   +7.468567814532455e-02   +2.046692144581879e-01   -7.468169385614258e-02   +1.745937662299157e-02   -2.874549480205508e-01   +3.528811112666726e-02; +1.783505031973008e-01   -9.094140602308734e-02   +1.336637932899016e-01   +6.253042898256973e-02   +6.667807573774293e-02   +1.474404622771537e-01   +1.999280968151037e-01   +1.919914489599957e-01   -3.087464146279601e-01   -1.501822026717736e-01   +5.175546504477540e-02   -1.034716380847666e-01; +1.238581968200718e-01   +7.939695778445215e-02   -8.475650330939950e-02   +1.831635614323706e-01   -1.090594069846392e-01   -1.157766717064169e-01   -1.135235316316870e-03   +4.069462412304296e-01   +3.473763470480462e-01   +1.270239152342378e-02   +1.081320516018826e-01   -1.749214003252925e-01; +1.614081844024283e-01   -1.957520091958346e-01   -3.133675356153457e-01   -6.030240833127892e-02   +9.087826475116145e-02   -7.865471531303604e-02   +1.322685361156216e-01   -2.732044423127527e-01   -2.777905379206763e-01   +1.051367040067378e-01   -8.382378972651845e-02   -9.585764284501352e-02];
L2E_Input1_iAMPA_netcon = [-7.912814961782391e-02   +8.369664901264645e-02   +1.072361144264739e-01   -2.643769244895610e-02   +2.559951087750104e-01   +2.283030158262392e-01   +1.220157924478523e-01   -1.597876914923574e-01];
L2I_Input2_iAMPA_netcon = [-6.610162588185718e-03   +2.646320773026892e-02   +2.392295548452334e-01   +2.882844470623377e-02   +9.110601008941858e-02   -3.628701220167132e-01   +1.707837155345417e-01   -3.748135193225279e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
