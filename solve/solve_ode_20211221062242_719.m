function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.467515313172637e-02   -1.630042829394056e-01   +4.872364145453884e-01   +2.694386516487284e-02   +2.119993340214462e-01   +4.197470818472063e-01   +6.281921933680751e-01   +2.253593823741937e-01   -5.544224207651637e-01   +3.071799164813908e-01   +6.658160125530097e-02   +3.933512689928684e-02   +8.492655618687492e-02   +2.100582812911635e-01   +7.580786745073375e-01   +9.528903877138561e-02; +1.645163116046457e-01   -3.768511038214441e-02   -5.580465408779357e-01   -5.731552710780909e-01   +6.258512003782375e-01   -2.629713127019846e-02   +4.110984056646084e-01   +4.913078869407232e-01   +4.514823276425030e-01   +1.072864752392654e-01   +3.701539775890803e-01   +6.896649373052495e-01   -5.198050438597631e-01   -3.090021052180125e-01   -9.110522161646710e-02   +1.270246001010739e-01; -4.651287769254053e-01   +3.054641573318599e-01   +1.435459112003605e-01   -7.634297252249228e-02   -6.301642215297603e-01   +3.204282460366930e-02   -3.553803114062373e-01   +7.599123723875630e-02   -1.900029886586108e-02   +3.709017913895354e-02   -4.844699324552854e-03   -5.465865117113190e-01   -6.916485370168196e-02   +6.465748084891965e-01   +2.835824785376239e-01   -5.551538757874325e-01; +2.419976836972148e-01   +4.217548559623376e-01   +3.526133898220613e-01   +1.681139278491366e-01   -6.826981327078423e-02   -2.346525916017961e-01   +3.850706207294816e-01   +2.936680682338614e-01   +2.827377682517717e-01   -1.247723077930393e-01   -6.926033458512227e-01   -4.155908698006529e-04   +4.160175278994700e-01   -6.478715236993182e-01   +2.787764440673824e-01   -3.253833742027833e-01; -6.372554032676310e-01   -3.149914725926549e-01   +4.789028655075380e-01   -7.000535304186208e-01   +5.134691501945328e-01   -4.997127186657795e-01   -1.249322772159812e-01   -8.516801883068320e-02   +3.503249063358045e-01   -4.203711809758151e-01   -1.500569317244983e-01   +9.376109422051582e-02   -1.622049935246749e-01   +5.895266534459261e-01   +1.718211916525406e-01   +8.322079207564029e-01; +3.032821084045600e-01   +5.207700508795629e-01   +2.214139808305623e-02   -2.076106793806347e-01   +2.913334920263635e-01   -3.438857615700882e-01   -5.111272148092812e-01   -1.289742495598617e-01   -9.886641967304582e-02   +6.835394292733004e-01   +3.651495387987155e-02   +6.174628004198592e-01   +8.593145773168324e-02   -1.779393226746186e-01   +1.079028848586868e-01   -6.971553480119745e-01; +2.581621600292286e-01   -2.088217990262928e-01   +7.052822906325146e-01   -1.584560099641235e-01   +1.131867940197882e-01   +3.319817650248124e-01   +3.180299942791842e-01   +2.729451089123756e-01   +8.083826390311071e-01   -5.314417973680350e-01   -6.375239067971968e-01   +1.113460103028876e-01   +1.940365135264372e-01   +5.021056698102537e-01   -4.255525736520616e-01   -5.294918279165838e-01; -1.840338513299891e-01   -3.668826289417937e-01   -3.744046847628552e-02   +2.537522613033787e-02   -7.222849106416726e-01   +3.436638270466637e-01   +1.641592355627723e-01   -2.989729842725954e-01   +2.798014693909873e-02   +5.198695509792629e-01   -6.325352149326569e-01   -7.132418674521488e-01   -3.468345492805112e-01   -7.367932451346609e-01   -3.159357925820780e-01   +2.058205230654058e-01; -5.448648094885522e-01   +1.450265214947650e-01   -3.615982115212804e-01   -4.899607399064882e-02   +5.847169374218741e-01   +1.220124173342387e-01   +3.818047929686796e-01   +1.421487889541373e-01   +7.947063827153303e-02   -2.867403605586030e-01   +5.308589316331395e-01   -1.934274868290654e-01   -2.774293310094064e-01   -6.432436708446883e-01   +2.327280730199545e-02   -1.020966928982443e-01; -6.443945749270376e-01   -3.910158578496343e-02   -5.862465342202239e-02   -1.255151470427116e-01   +1.000000000000000e+00   +8.693950758751047e-02   -2.278849548483253e-01   -8.680626461335283e-01   +7.568306221224279e-02   -7.002260322181904e-02   -2.394998375898988e-02   -5.197253412967596e-01   -4.800564640024396e-01   -1.531322024867321e-01   +1.246249249234735e-01   -2.503772226373854e-01; +4.797486009856173e-01   +9.077509324215859e-02   -4.349613248754211e-02   -3.591283104133429e-01   +7.350094735875655e-01   -1.875320587662455e-01   -5.605142700369552e-01   +1.343635913887974e-02   -1.148680305104842e-01   -1.931591216377639e-01   -4.423894417177466e-01   -7.319725921071035e-01   -3.943682298889254e-01   +4.865967003394713e-02   -2.929454827157106e-02   -6.154561410832847e-01; +8.990303028399163e-01   +7.921508125382767e-01   -1.645898971813226e-01   -2.396045167159824e-01   +7.465653942385250e-02   +6.380064221405077e-01   +6.703790232766593e-01   -2.815106885969134e-01   +5.862250841650767e-01   -2.897771438341538e-01   +3.399707360762318e-01   +1.014033288012838e-01   -5.764116203026178e-01   -5.881086131889662e-01   -2.426591840455124e-01   -8.298421807674481e-01; -1.813207480478833e-01   -6.312212575391383e-01   -5.758809839676450e-01   +1.902787867906015e-01   +3.348413394470447e-02   -1.478042689705052e-01   +9.522200924286420e-01   -4.704660413514998e-01   +2.837888564608331e-01   +2.235261911062302e-01   -1.261747885381616e-01   -7.029258585909460e-01   -4.374734578060128e-01   +2.843249530319539e-01   +3.505273725808072e-01   +3.413252186003641e-01; +4.778301870944448e-01   -1.944132391287347e-01   -1.936391841188873e-01   +5.427886872405764e-01   +4.704715795502205e-01   +5.693742179366930e-01   -1.779965363452786e-01   +3.383882051904868e-01   -5.253804811192206e-01   -8.007391958431388e-01   -3.356418969467571e-01   -1.894830468331646e-01   +7.667188722869080e-02   -6.869836029618698e-01   -5.128575923659460e-02   +7.568639429359719e-02; +2.077024357136446e-01   +7.417101801207152e-02   -7.780576629190481e-01   -5.447673211373376e-01   -3.373501838218950e-01   +1.951805858360850e-01   -6.582607993560168e-01   +5.857767464082849e-01   +3.118217289441130e-01   -4.888236931623368e-01   -5.180382875423122e-01   +6.118642980758104e-01   -2.886544128089024e-01   +1.966143214512585e-01   -5.461313860749859e-01   +4.152116512728686e-01; -4.467555970184613e-01   -2.140007284310013e-01   -1.912155423309453e-01   -2.561498940922038e-01   +5.108335500867696e-01   -2.586359729595993e-01   +9.153254420452510e-02   -2.903222914537490e-01   -3.999144097684788e-01   -6.775978843515448e-01   -7.401208179524851e-01   -2.033959195731950e-01   +4.768372013963761e-01   -2.723385705967307e-01   +4.831462459372888e-01   -5.406229683849610e-01];
L1E_L1I_iGABA_netcon = [+1.463704229684835e-01   -2.592416807510630e-01   -2.896516295696133e-01   -3.531811378186709e-01   +5.874230966618711e-02   -3.087697671028327e-02   +3.362675862322144e-01   -2.554994890298403e-02   +3.641555935876039e-01   -3.935122665285554e-01   -3.256067002958123e-01   -4.280557548581740e-01   -4.074900274813539e-01   -8.473598706550707e-01   -8.356300060459761e-02   +1.905291508434557e-01; +5.639323698867982e-01   -7.218803126177482e-01   -6.003683796772017e-01   -1.740568202820526e-01   +1.621610541869547e-01   -5.999780435560913e-02   +4.817984511920411e-01   +2.080119771922590e-01   +1.459563196774251e-01   -3.784895220185323e-01   -9.900400120312768e-02   -6.498080347677151e-01   +4.576601945820193e-03   -2.861838260396272e-01   +1.144406939317905e-01   +4.334480187455015e-01; +6.608873308155310e-01   +5.408899698096624e-01   +9.407985385744788e-01   +3.538103734583774e-01   +3.351721742552562e-01   -6.349953896927177e-01   +9.899767583795261e-01   +8.780390835875483e-01   -2.653270980454642e-01   +3.395037681198819e-01   +5.004913213642125e-01   -1.960291595892751e-01   -2.732441506559538e-01   -3.029776021948505e-01   +1.980104295942497e-01   +4.875353100568694e-01; +5.084920915607092e-01   -6.957472724012530e-01   -7.495379495649735e-01   -6.406114470567559e-01   +4.344465218231969e-02   +4.745029062624674e-01   -6.308166169363557e-01   +3.824050598649052e-01   -4.268689628126133e-01   +8.164581098675087e-01   -4.077779106302508e-01   -2.202331737184041e-01   -5.296280957069013e-01   -7.663293805492086e-01   +5.323306239981470e-01   +1.181167952988717e-01; +1.329831900747694e-01   -1.167457842483676e-01   +2.691214728179623e-01   +1.031015549995346e-01   -6.730195923042279e-02   +3.073225513371267e-01   +2.534329558727838e-01   +3.402285766384028e-01   +3.746681912126166e-01   +3.064718648826584e-01   +3.288143610043064e-02   -3.063909138364557e-01   +5.771658510478453e-01   +3.131607785222453e-01   +2.960331500209555e-02   +1.087783711435815e-02; +8.895828083363061e-01   -1.229447245161263e-01   +1.950858410797618e-01   -4.159373585623913e-01   -5.743848592067281e-01   -6.495467904036429e-01   -4.757437398045094e-01   -6.170234784950971e-01   -4.014438109556392e-01   +4.093320071651612e-01   +9.249120298380195e-01   +6.895067203908303e-01   +4.614616647037169e-01   +7.317378357224181e-01   -3.648790695698422e-01   +2.351921635284056e-01; -2.578024997762352e-01   -1.899400374329986e-01   -2.513962064780342e-01   -1.174902318968813e-01   -6.310639578321835e-02   +4.486037209021358e-02   -1.283682083163073e-01   -7.148327467476580e-01   +3.170614988656040e-02   -5.759942059064568e-01   -3.866070015480752e-01   -8.454054230031258e-01   +4.852565513954475e-01   +9.702638405166768e-01   -2.463818857129020e-01   +2.067958119204229e-01; +1.271323891732191e-01   -9.460864257052602e-02   -2.165415164499127e-01   -5.310847768326441e-01   -5.231051725525012e-01   -6.641962700576298e-01   +1.971552696748273e-02   +2.438291936734156e-01   +4.034485918853323e-02   +8.294641378439881e-01   -8.616044853518695e-01   -8.142352297008449e-01   +1.248876812201664e-01   -2.108157299026723e-01   +3.359265694511769e-01   +3.074195530875908e-01; -9.458654816004124e-02   +4.150570010865506e-01   -1.484700985186894e-02   +9.596568204781321e-01   +6.345276999834153e-01   -4.531880455939457e-01   -1.026477926692184e-01   +1.757928078772455e-01   +7.469993675178166e-02   -2.982749781864136e-01   +6.271217373115310e-01   +5.631322588601604e-01   +6.184515192673481e-02   +5.715648521357347e-01   +3.451911429092021e-01   -7.025421889911754e-02; +1.217797921305395e-01   +4.948557783558143e-01   +4.087974362065163e-01   +6.558023614617011e-01   +4.405416652966284e-01   +8.420409325630678e-02   -5.210930937008739e-01   -5.077448405251067e-01   +5.316996761553215e-02   -3.522634361841583e-01   +1.191649740374207e-01   +3.890753493175203e-01   -3.793735028399854e-01   +4.997320114382480e-01   -7.147540901961400e-01   -1.399996335671502e-01; +2.552561894337105e-01   +2.315199457765822e-01   +7.074872364257965e-01   -2.938710972673171e-01   +5.540647504863007e-01   -1.743844798305886e-01   -4.615930719846058e-01   +3.523263418052576e-01   +3.261372754895883e-01   +4.048707883464616e-01   -4.264119927048799e-01   -1.734453970598828e-01   -4.008520808857594e-01   -1.504913393724610e-01   -7.228000298730668e-02   +4.492969249181057e-01; +4.917110801828435e-01   -2.452679007662374e-01   -3.430859991412127e-02   +4.470877149093013e-01   +4.419565268069029e-01   +1.035010758401079e-01   -4.044106397942970e-01   -2.684350402211527e-01   +1.197632465945258e-01   +5.442868770313490e-01   +7.795368711993781e-01   -7.966464027944192e-02   +3.568276288880725e-01   +1.990509589000128e-01   -4.613980175454700e-01   -1.000000000000000e+00; -4.218645051368009e-01   -2.749380592229796e-01   +6.475233401079608e-01   +3.847205194435009e-01   -4.121827698197584e-02   +1.379972185247072e-01   +2.873006846617349e-01   -2.305401492307417e-01   +3.944583116818758e-01   +6.056462341375486e-01   +1.942711381590620e-01   -5.213207069994350e-01   -3.293054303443311e-02   +2.539005889128900e-01   +1.250144577763777e-01   -6.582473071821401e-01; -4.631031683882359e-01   -3.459422261127896e-01   -1.764599919729978e-01   +7.753810636881069e-02   -1.853579702538872e-01   +2.896579834678709e-01   +5.729030838061365e-01   +3.588582864456994e-01   +9.893818002344335e-02   +4.496004545508902e-01   -9.440563996118653e-02   +4.049871620794408e-01   +3.162818355194227e-01   -8.482519305808527e-02   -6.950248310623549e-01   +4.382639052176661e-01; -2.054307201526150e-01   -1.436554064136864e-01   +1.886598047158293e-01   +2.631264045374632e-01   +2.046457553415132e-01   -3.908018705256062e-02   -4.106459325846203e-01   -5.814026817662535e-01   +6.532107330785855e-01   +4.721403214312357e-01   +2.287914541869552e-01   +1.061611333656379e-02   -5.321187038621359e-02   +5.623662563371314e-01   -4.699915527009453e-01   +5.481358352374780e-02; +3.556430986164465e-01   -3.557467350029170e-01   +1.696830722918967e-01   -5.082626004125744e-01   +3.777990789363668e-01   +5.630712768564429e-02   -1.445861902420358e-01   -2.040111411861391e-01   -1.838761787563934e-01   +5.097146399862176e-02   -8.028131303466428e-01   +2.120182813141105e-01   +6.256061119572550e-01   -4.394458246341857e-01   -5.702504724617076e-01   -8.316187835435258e-01];
L2I_L1I_iGABA_netcon = [-2.165561273282469e-01   +3.559119856633897e-01   +2.612646710333983e-01   +3.206744692764001e-01   +1.608709811106992e-01   +7.711155167688367e-02   +2.422819794160629e-01   +6.730646788485752e-01; +2.299161142794177e-01   +2.295592553468513e-01   -5.782741683014536e-01   -1.894845514563849e-01   +9.651581448709065e-02   +7.198198545285310e-01   -5.204966197742920e-01   -4.697182114749555e-01; -1.588047015680337e-02   +4.750768872280953e-01   +2.284247097767058e-01   -2.993979728802315e-01   -4.538089280150762e-01   -8.628375512503137e-01   -2.682167461343081e-01   +2.306837175736502e-01; +4.810073894174756e-01   -4.447924903808809e-01   -3.098444521751257e-01   +1.165332296126681e-01   -3.517223894326480e-01   +6.479593963711601e-01   -6.427265988718764e-02   +3.265102258934393e-01; +2.514985318203999e-01   -2.188993965722837e-01   +1.328734312797928e-01   +5.804067506988017e-01   -6.801361730710676e-01   +7.858423471791873e-01   +4.248380533033537e-01   +1.261264787900087e-01; +5.813279192490887e-02   -2.552141210842457e-01   -8.637088767778771e-01   -2.363408857558894e-01   -7.486833967038241e-01   -7.065088027738108e-01   -4.961959637524668e-01   -3.463630222187229e-01; -3.386953268260665e-01   -1.976248794286676e-01   +4.513641021599278e-01   +2.002035552929048e-02   -5.639165078749947e-01   +6.493203942785615e-01   -8.139524309332480e-01   +1.339688270938384e-01; +7.015010158428457e-01   -3.028509894911498e-01   +4.198216652768859e-01   +1.602362777684276e-01   +3.162437521377328e-01   -5.300252247654272e-01   +5.683344156673958e-01   -3.090894822421661e-01; -7.324332278908381e-02   -4.351652733197003e-02   +2.409101063322805e-01   -2.185290239474977e-01   +6.296457617236354e-01   -1.716893797004304e-01   -5.467808999173809e-01   +8.890772806394796e-01; -1.474917267455307e-01   -4.797077548173570e-02   -3.270935114417264e-01   +4.556106320167299e-01   -6.453977376980632e-01   +8.745719324206330e-01   +4.751316092459905e-01   -4.019081972467310e-01; +1.984782458921804e-01   -3.111616711542020e-01   +4.852038906681334e-01   +2.123086743045452e-01   -2.223722163178997e-01   +1.124118476404177e-01   -4.665262595550069e-01   -5.053398467651481e-01; -9.388870481728326e-01   +1.084096871046789e-01   -4.928857037015023e-01   +4.019253487739712e-01   +9.683022161584676e-01   +3.529706574104112e-01   -4.072650175225846e-01   +5.435923172163568e-01; +7.070232650303065e-01   +4.248216019404586e-01   -4.459568793978877e-01   +2.954988761545745e-01   +3.550514690900417e-01   +6.113697681848309e-01   +1.594725007944734e-02   +3.086271093207692e-02; -1.258330608699078e-01   +7.746155137889008e-01   -5.122040119957656e-01   +6.064409809599667e-01   -3.026198132040754e-01   -2.556201723354160e-01   +4.250505034694644e-01   +2.925175110132595e-01; +6.118294234400350e-01   -1.694839149231183e-01   +2.549105065876586e-01   -3.872429678625385e-01   -2.691419905778610e-01   -1.081526703500619e-01   +9.159950827546215e-01   +1.000000000000000e+00; -2.739371908084249e-01   -5.741137311147022e-01   -1.694792311246315e-01   -2.924159188139432e-01   +7.112084115084366e-01   -6.226072839677308e-01   +7.733265974518320e-01   +6.608065200110272e-01];
L1I_L2I_iGABA_netcon = [-4.935482493726938e-01   +5.137334161370615e-01   -7.103228518712386e-01   -4.038901546593260e-01   -2.305318693376937e-01   -4.676001625904755e-01   -5.955292675622973e-01   +1.645264917221717e-01   -5.597048302019035e-01   +8.199600357154496e-01   +5.715141070429068e-01   +3.890269793404004e-01   +3.321936774609306e-02   +1.515596996739655e-01   +1.842094141182722e-01   +2.304318203184477e-01; -4.685612163322584e-01   -9.743123530802027e-02   +7.881743724012912e-01   +4.586696920124205e-01   +2.863870585010996e-01   +7.822202784579763e-01   +1.812190526575710e-01   -6.528967186736188e-01   +4.518546746529232e-01   -5.637658765408835e-01   -3.087867159492820e-01   -2.541369616395949e-01   -1.866456007819868e-02   -3.664813672418714e-01   -2.000083137072445e-01   +3.639639144114473e-02; +2.010938671513478e-01   +6.801522614318305e-01   -3.478260173406664e-01   +2.614583600468366e-01   -6.366544268994289e-01   -3.813693902202824e-01   -3.403053061141937e-01   +9.671477947639971e-02   +7.645995557942650e-01   -3.610352088728594e-01   -1.774873341977001e-01   -2.998184469610271e-01   +4.476226299081976e-01   -1.836176590828323e-01   -3.114963294994052e-02   +9.438973687193479e-03; +7.106605046437411e-01   +5.043345907529578e-01   -1.795738592096598e-01   -1.816781299791433e-01   +4.993259609120662e-01   +2.984088107890695e-01   -9.735334751225032e-02   -3.958777536016815e-01   +2.007188291970950e-01   -1.079046198500727e-01   +4.898131375270197e-01   -4.099574861434402e-01   -4.788200866663220e-01   +8.413952985115063e-02   +6.551336838066850e-01   +3.623031901226255e-01; +6.448592621981959e-01   +5.445987588589264e-01   +2.222360302584088e-01   +2.455310250346132e-01   -5.599517832303775e-01   -9.759196307906264e-02   -1.882552722237896e-01   +4.774419255090733e-01   +5.040566128209936e-01   +5.213554477897817e-01   -3.232279019544296e-01   -4.803077665530480e-01   +1.000000000000000e+00   +4.760844157175873e-01   +4.420059043355978e-01   +2.289860285414541e-01; +5.997340895072761e-03   -6.654970957646772e-01   -5.601937795012083e-01   -7.999425401160372e-01   -6.479208243198118e-01   -3.657044114193390e-02   -3.479152603981198e-01   -5.464980741937341e-01   -7.736633125412384e-01   +1.681429016306226e-01   -3.973283041363951e-01   -7.532556380260155e-01   -5.887548128014746e-01   -3.960517313575244e-02   -7.154528499807136e-01   +7.973413094624020e-01; -6.432122246246323e-01   +1.523001177587927e-01   +6.045866778404185e-06   -4.157764746598434e-03   +1.977630089916169e-01   +6.221370152366515e-01   +1.232212836511992e-01   -6.444819622155445e-01   -6.661957541527334e-01   +7.928457804032175e-02   -5.014067693557425e-01   -1.126672872666541e-01   -5.336959730715800e-01   -2.593785574039810e-01   -2.964712388773667e-01   +5.507548968156847e-01; +1.280069821357129e-01   -4.249113070219497e-01   -2.982367459777684e-01   +3.775211835899440e-01   -5.195459765006766e-01   +5.282163782896032e-01   -7.207867875139266e-01   +5.131902760749817e-01   +4.341717121354189e-02   +6.297231737904188e-01   +7.035559219794506e-01   -5.630410689176015e-01   -2.396443650241827e-01   -8.564272364325097e-01   -2.520731601827126e-01   -4.473629698619982e-01];
L2E_L1E_iAMPA_netcon = [+2.875589910278475e-01   +1.657606453252192e-01   +1.272695379929252e-01   -4.784528225787513e-02   -9.017194530260894e-02   -4.400741998645018e-01   +1.189131706945430e-01   +2.246751079626327e-01; +8.740234726951145e-02   +4.508119414655957e-01   +4.933400461194672e-03   -2.004256034889688e-01   -1.605580864918550e-02   +3.004863904084391e-01   -9.559153473227835e-02   -1.791759300008343e-01; -3.843749936087816e-01   -3.389674102988581e-01   +4.560107297420123e-02   +7.664353021404142e-01   +3.234979827052439e-01   -7.922075362006978e-01   +3.159652822220854e-01   -1.000000000000000e+00; +2.022537982150497e-01   -1.444059961952322e-02   -7.260759206469931e-01   +1.352299846586452e-01   -6.387017713391636e-01   -6.698751630647774e-02   +2.351395231080248e-01   +3.746143332361611e-01; -2.636163190763938e-01   -5.013653689425633e-02   -2.867654796382462e-01   -4.136360743621417e-01   -2.467173899937408e-01   +3.276298424357566e-02   -1.397298923864603e-02   -4.253857183269231e-01; +1.529748885393449e-01   -5.390544555323807e-01   +2.288190348220327e-02   -4.130425549755786e-01   -5.252409433298878e-01   -1.410973009225646e-01   -2.902946723023843e-01   +4.423443606564617e-01; -3.832336979971999e-01   +1.317109704519017e-01   -6.904930758069905e-02   -3.837976362342215e-01   -1.011490585432003e-01   +2.784171353585055e-01   -7.360962946490059e-02   +4.720084120637860e-01; -3.911947384049261e-02   +3.230784791456994e-02   -1.509490806194215e-01   +2.784982284888991e-01   -5.245004869217776e-01   -3.860452743028584e-01   +5.158598023254896e-01   +4.937560386319065e-01; -5.692122734463398e-01   +6.631921671620028e-01   +2.618654092718875e-01   -3.915908257863532e-01   -2.431122860191665e-01   -2.480566133084327e-01   +6.711067330244371e-01   +1.330877302885889e-01; +9.904863862963020e-02   +4.118352655679484e-01   -5.335011615968363e-02   +2.497955956459620e-01   -1.674608094916730e-01   -1.162808663238860e-01   +4.035047244967071e-01   +3.630033737689629e-01; +3.764183817269547e-02   -5.027951314324561e-01   +6.781212695610793e-01   -4.587587142600671e-01   +1.754544731219825e-01   +3.153781136512151e-01   -8.997892431742931e-04   -6.414757971283575e-01; -6.166072048544032e-01   -3.988772459683531e-01   -3.694330557039742e-01   +8.053411880544652e-02   -4.495673606290920e-01   +3.015916774661632e-02   +1.729567075046958e-01   -2.847949319255341e-01; -3.083389861460651e-01   +6.195306920129576e-01   -2.830993039206254e-01   +2.280969491232582e-01   +1.579024004633314e-01   +1.764492627402123e-01   -1.674618330467051e-01   -1.674810957556535e-01; -6.880699653801623e-01   +4.039411072769009e-01   -3.159020630211734e-01   -5.331525618611777e-01   +6.429189374520932e-01   +7.566814044803643e-01   +2.369434706303546e-01   -3.463248019789729e-01; +2.045606785083857e-01   +5.178488052739662e-01   -1.211935830524029e-01   -5.705997065014856e-01   +2.694471075981283e-01   +6.207367103720954e-01   +1.852868237435375e-01   -5.568458390074842e-01; -1.504660053252226e-01   -5.174747766662027e-02   -1.696412308618951e-02   +6.577986043494646e-01   +5.770871812287390e-01   +2.872014459023632e-01   +2.890851327765403e-01   +4.142692045663419e-01];
L1E_L2E_iAMPA_netcon = [-5.278820724010537e-01   -6.292419314495852e-02   -4.864257131286003e-01   +1.330597503978002e-01   +3.832185517210143e-01   -1.318898296027410e-01   -3.225658336717280e-01   -4.007670614501462e-01   +2.137596472657706e-02   +3.898328410176302e-01   +2.807570229352009e-01   -1.761020579144261e-01   -8.217318333201969e-02   +4.767796331316329e-01   -2.322216688408914e-01   -3.050671960936374e-01; -1.501378127244384e-01   -4.307984643496923e-02   -2.283771438578871e-01   -2.051235892987460e-01   +1.114594532482742e-01   -6.363368787804328e-01   +2.134252298734873e-01   +7.157932833982679e-01   -4.542664713104058e-03   +7.850449925656958e-01   +2.090196574163479e-01   -3.783780844193491e-03   -6.176183509652651e-01   -5.073262119649685e-01   -5.078548968070787e-01   -8.080478101722383e-02; -7.854421896674904e-01   -1.270425522819192e-01   -4.363650503263659e-01   -5.495545642068448e-02   +8.024689990895033e-02   +1.353529719434703e-01   -5.242524739554677e-01   -5.728141909730521e-01   +7.801026337027708e-03   -8.375382330448418e-01   -1.496792189584573e-01   +4.954327977102894e-01   +4.564619323713230e-01   +2.762399802453351e-01   +2.520978003325621e-01   +7.696157481926662e-01; -8.727176930654439e-02   +4.360010287767106e-01   +1.635327263726844e-01   -2.162498257051522e-01   +1.772005838343218e-01   -6.544463541978067e-02   -2.903231596742877e-01   +5.088327137168260e-01   +2.202918151123256e-01   +1.016313397858939e-01   +3.554250901782399e-01   +3.252904423398971e-01   +4.062442690347786e-01   -2.622958419867191e-01   +7.135576483693964e-02   -1.365753705119870e-01; +7.910424102793818e-01   -4.671129818232290e-01   +2.795264859763148e-01   +4.044600507316334e-01   +6.916739343443060e-01   -5.401859704299994e-01   -3.858713799783703e-01   -5.157307769546879e-01   +4.133013424073216e-01   -1.287358923331940e-01   -5.898640797470671e-01   +2.994974955562999e-01   +3.672843824314006e-01   -9.948543892477309e-02   +1.781082024453590e-01   -1.313186527322227e-01; +3.046388177300353e-01   +3.763406962102903e-01   -2.563314812230151e-01   +5.783087992682933e-01   +6.281261451710142e-01   -5.164479036378075e-01   -4.985401946852313e-01   +1.252541552816884e-01   -1.992060427429343e-01   -1.662673369223617e-01   +2.552966859342445e-01   -2.501857663200974e-01   -7.471490338678124e-01   -2.739513388912564e-01   +9.948135086583260e-02   -2.724476845807034e-02; +9.665314767435577e-02   +5.399034099186151e-01   +7.979311787792914e-02   +2.254122176691554e-02   -2.097774988426323e-01   +7.079083180777185e-02   +4.813183810431801e-01   +1.251693579759575e-01   -7.535590263052907e-01   -5.094650303330862e-01   +4.191801060174122e-01   -1.180830282608521e-01   +4.777634558750251e-01   -4.267269987030129e-01   +6.541065506221171e-01   +4.177799404847194e-01; +6.293662315910359e-01   +2.659830382292119e-01   -2.438543304459449e-02   +1.763199045034703e-01   +1.769516602869171e-01   +1.938365394102221e-01   -2.865204395723659e-01   -6.679556703870362e-01   -1.000000000000000e+00   +7.110201419142569e-01   -1.238954671320402e-01   -1.045635412574547e-01   +2.568067716586177e-01   +5.250586703775247e-01   -4.133555877559141e-01   -3.649351879150803e-01];
L2I_L2E_iAMPA_netcon = [-9.235281192673784e-01   +4.151368636726753e-01   -1.283375046223965e-01   +3.739274563558731e-01   -3.329810435020804e-01   +3.442316570238104e-02   -3.199981117239492e-01   +5.524783481383868e-01; +5.489769923395503e-01   -4.929453683785884e-02   +1.321135922089387e-01   -7.196959313527262e-02   +5.781056842802728e-01   +3.802597573476131e-01   -5.640029408673993e-01   -3.801526114345753e-01; -2.511215103336949e-01   +7.218599064940614e-01   +6.705130311667410e-01   -6.632863576004436e-02   -4.502946232843983e-01   +2.500782413889689e-01   +4.262804117941692e-02   +8.206990029081741e-02; -4.228473947966116e-01   +8.518515771918223e-01   +3.246884912820809e-01   -1.924406608701884e-01   +1.000000000000000e+00   -2.020060404287609e-01   +6.590253330081077e-01   -1.508190840967395e-01; +5.325195150492407e-01   -4.350936448999970e-01   -4.753036587351085e-01   -7.487058105938885e-01   +2.046745552239034e-01   +5.848779420001154e-01   -1.167025755988493e-01   +6.077082193883871e-01; +1.348905606316915e-01   -3.079500521085606e-01   +3.987936266089955e-01   +3.443290779740944e-02   +2.349074091130111e-01   -1.163481057468266e-01   -3.839143839420233e-01   -2.083061280301927e-01; +5.398649194705084e-01   +3.139395510904094e-01   +3.083614498127172e-01   -1.456238569272602e-01   -7.952636950889040e-01   +3.203552586822476e-01   -6.812725151239113e-01   -4.310945428777944e-01; +4.132905122875294e-01   -4.262196769815911e-01   +3.650616274449402e-01   +1.053641320732412e-01   +4.716616901688046e-02   -2.324001776034261e-01   -9.639471422774201e-02   +4.796401306701667e-01];
L2E_L2I_iGABA_netcon = [+3.154401577689984e-01   -7.984150608960914e-01   -4.006027398159564e-02   +2.536826723998105e-01   -1.802724316982469e-01   +5.986050062163907e-01   +2.143186766445655e-01   +4.750219951087702e-01; -8.262442073675694e-01   +2.523844533989841e-01   -6.540856992987009e-01   -5.766105761955621e-01   +3.012276930380858e-01   +4.990774998601690e-01   -1.315753153838129e-01   -1.000000000000000e+00; +2.746563010684133e-01   +2.794363871589325e-01   +2.202950415152137e-01   +8.966691767190659e-01   -5.228768592897989e-01   -9.012712618183174e-01   -6.025637560704407e-02   -3.990988820602230e-02; -7.629245074830052e-01   +3.422849394841437e-01   +2.553738841331282e-01   -2.897697182988641e-01   -2.921649336084085e-01   +2.803116259750322e-01   +1.641346899465886e-01   +2.575547964724963e-02; +7.763637888375395e-01   +3.322690236889856e-01   -5.421138113423184e-01   -2.322798926980463e-01   -4.038761360065529e-01   +2.550648674396802e-01   +2.155741311871570e-01   +4.535409944022192e-01; +6.398759943494469e-01   +5.108097094777796e-01   -4.845013595443702e-01   +1.548253604282494e-01   +6.012300791353622e-01   +4.557395835035341e-01   +2.273654149336202e-02   -3.118282574397141e-01; -7.691108745361367e-01   +3.626687395415204e-02   +6.629372382058355e-01   -3.929915847728343e-01   -4.371848267217445e-01   +2.221098101095613e-01   +1.793120008247044e-01   +1.117862421634476e-02; -2.616957476282830e-01   -6.942389354329768e-01   -5.554280355635591e-01   +3.853407169128759e-01   +6.649873304768227e-01   +1.966919555514331e-01   +5.813715901682798e-01   +4.797601387247721e-01];
L3E_L2E_iAMPA_netcon = [+7.626482546797003e-01   +3.819963347979727e-01   -2.607627505594604e-01   +1.000000000000000e+00   +6.953317116180528e-02   +6.247315829887694e-01   +5.202285470081716e-01   -2.696042133347991e-01   -1.185903225520909e-01   -4.207221241882616e-02   -4.986752588919325e-01   -3.998242234956430e-02; -8.130700133248834e-01   +7.838485896590266e-01   +9.445033397173783e-01   -3.150217190789774e-01   +7.432698718938782e-02   +5.707730166828997e-01   -7.472410608820166e-01   -7.451243547741454e-01   +8.246999636108215e-01   -1.787832783458748e-01   -3.856488634507754e-02   +5.169127872059074e-01; +5.290856180088981e-01   -1.873545865017994e-01   +4.664065481931513e-02   -4.644719884446120e-01   -1.915482056487489e-01   +3.630737346859795e-01   +3.479896375172836e-01   +1.788774437595758e-02   -5.511339025092781e-01   -1.457987348638543e-02   -2.350559838459237e-01   -1.311909894716936e-01; -3.768888380810689e-01   +3.105420036837485e-01   -5.511020609961034e-01   -2.324260323554325e-01   -3.950629730574700e-01   -5.655320137542558e-01   -4.925726957841899e-01   +2.126873389293559e-01   +6.455110793656611e-01   +5.177365311832238e-01   -1.857844774089872e-01   +3.046218325823823e-01; +4.594457295420530e-01   -9.449933518357737e-01   +1.291216828074855e-01   +3.853273641548600e-01   +2.229609774333773e-01   -3.260795918670639e-01   +5.296263973259465e-01   +1.941807863369837e-01   -1.058499366671964e-01   -5.723345519680592e-01   +3.512468253220763e-01   -4.616510945514813e-01; -2.219051450498713e-01   +6.053523834547324e-01   -5.865647880334056e-01   -2.200794512143767e-01   -2.904582184129606e-01   +7.544806577552404e-01   -4.573796568227735e-01   -4.823756905746332e-01   +7.806063150813556e-01   +8.240586957334572e-01   -5.197973308751058e-01   +8.143875919551797e-01; -4.112856168665875e-01   -3.158672072904809e-01   +7.599254225435260e-01   -5.801848308977371e-01   -8.660223332793199e-02   -2.182169352905117e-01   -2.236499798208607e-02   +7.451555720482045e-01   +1.578390515703982e-01   +5.725044313922247e-02   +3.884107205615168e-01   -3.202705006740415e-01; -2.322801822620958e-01   +2.528936177378569e-01   +4.103382322661115e-01   +3.175873753531931e-01   -4.159420658965834e-01   +1.685637822484386e-01   -7.200900500501779e-01   -3.668809601132800e-01   +1.110017202513573e-01   +9.436252152240805e-01   -3.145762259778147e-01   -4.324547897146559e-01];
L3I_L2I_iGABA_netcon = [+4.165225359298896e-01   -5.446293758937165e-01   -4.281630842465711e-01   -4.983573475084579e-01   -8.688847783562444e-01   -2.292981974481010e-01   -7.423777665609446e-01   -8.010881004083094e-01   -9.297758047072210e-01   +5.999575813241338e-01   -1.000000000000000e+00   +1.894661967867923e-01; -3.624485968814918e-01   +1.946625069497903e-01   -1.496783933343009e-01   +8.841825264874011e-02   -3.611193183144565e-01   +1.112791317176624e-01   +8.514827136425468e-01   +8.968735271976011e-01   -5.614214717390538e-01   +4.027534845847120e-01   +1.480116560880179e-01   -6.129726169503974e-02; +1.649102073657237e-01   -3.133677419864902e-02   +8.612867850162630e-01   -8.314040568089852e-01   -2.597911157444932e-01   +5.427413842441038e-01   -2.553375857253878e-01   +1.399004199786313e-01   -2.852572105064611e-01   +2.298905191488227e-01   +7.359420461464605e-01   +3.595650921048671e-01; +5.913882631758779e-01   +2.202713899901302e-02   +2.842181518350427e-01   -9.098722147758769e-01   -1.180686125635918e-01   +4.783792421073400e-02   -4.599319439062498e-01   -2.846149667676458e-01   -4.905641686678111e-01   +8.612859333125921e-01   -5.357323746474603e-01   +4.438105761166486e-01; +4.830142137234813e-01   -6.118758331826207e-01   +1.298415023602089e-01   -4.796187897139434e-01   +8.590958187346463e-02   -5.332039160586881e-02   -1.074994686693893e-01   -6.535534827723900e-03   -4.491004282325441e-01   -3.908196815464382e-01   -4.117061270743470e-01   +1.375751376585596e-01; +7.995272955473433e-01   -5.333945675636621e-01   +7.960796822231513e-02   -2.403432967822461e-01   -5.449060248753048e-01   +5.026415787294528e-01   -5.117331006166513e-01   +3.519598550035296e-01   +3.970895915262354e-01   +3.208979167363321e-01   -3.109400872249936e-01   -5.238000597260207e-01; +3.711535882524066e-01   +3.837125279935562e-01   -3.923138329598417e-01   +2.731363070138902e-01   +1.314815278123490e-01   +3.037464166749442e-01   -8.423649154183072e-01   +8.388871215863241e-01   -4.949712009694331e-01   +2.099122171152415e-01   -3.265424086641479e-01   -3.994625024014761e-01; -3.047752308819960e-01   -3.952013153969098e-01   -3.855655046318363e-02   -3.893521691034270e-01   -4.217495537498208e-01   +5.549957437837350e-02   -2.501315657892119e-01   +1.656267740204186e-01   +2.880814142306731e-01   -9.396963815173079e-02   +2.014250270621407e-01   -3.212993899827291e-01];
L2E_L3E_iAMPA_netcon = [+8.299677260458506e-01   +6.827796433804885e-01   +1.714878239768292e-01   +5.241848555207638e-01   +3.967424974528523e-01   +2.758207442460196e-01   +7.150777057605555e-02   +1.949004997257069e-01; +4.882016178232992e-03   -1.451589932895375e-01   +7.397120002216161e-01   +2.764067810476201e-01   +1.148570348182330e-01   +3.662761578786006e-01   -5.431895769073117e-01   -1.650295972177552e-01; +3.760071552654703e-01   -3.898049962572095e-01   -4.583649814223514e-01   -3.626631090644948e-01   +2.278568138808774e-01   -1.589543273504823e-01   -6.711941999842967e-01   -3.224127262757046e-01; -3.612787153111811e-01   -9.571151954980617e-02   +4.565129772305245e-01   +7.529304795080082e-01   -5.991214331713400e-02   -2.033245843970278e-01   +1.278471806219350e-01   +7.716110607952360e-01; -2.071156582451297e-01   +7.119428049072094e-01   -3.911027625932437e-01   -4.115572461459225e-03   -6.207628720916083e-01   -1.224697058961422e-01   -9.033203750653476e-02   +2.091072100844445e-01; +2.977503693426677e-01   +5.666846627969023e-01   -8.741625873915628e-01   +6.207203089047788e-01   +7.478921575882994e-02   -3.319330082234603e-01   -1.412097295116010e-01   -7.058293966134457e-01; -7.744051044781423e-01   -5.754138050426281e-01   +1.580733578785570e-01   +2.105277165843614e-01   -3.308495850846034e-01   +2.615364013589657e-01   +1.253019804545303e-01   +5.065177081787400e-01; +5.894965725597672e-01   -2.467314163728980e-01   -4.660434202158497e-02   +2.421063002437053e-01   -4.059123744061173e-01   +1.192294268887622e-01   -9.306324410245097e-01   -1.443225434672028e-01; -5.326692244872491e-02   +1.982872085524752e-01   +5.157630051535330e-01   +6.536707849463008e-03   -4.223846116141106e-01   +1.544282831146923e-01   +8.439454855361223e-02   -4.957361144810143e-01; +1.295991254680371e-01   -6.851819167513454e-01   -4.240625359029986e-02   +2.578131314239360e-01   +8.723299757209648e-01   -6.091991824872189e-01   +1.015104740111151e-01   -2.952877224412795e-01; +8.290638613147024e-01   -2.122960578788119e-01   +7.882998205657415e-02   +6.776064491578416e-01   -6.174946224706834e-01   +3.418685593970224e-01   +7.690609611296724e-01   -9.764756736596896e-01; -1.929340320813645e-01   +7.887314065406053e-03   -3.793761639646291e-01   -3.138858415299735e-01   +2.342814638702020e-01   +1.000000000000000e+00   +4.612061153981667e-01   -3.891425308952948e-02];
L2I_L3I_iGABA_netcon = [+4.658800253023918e-01   -9.455925500354262e-01   -1.869854149375239e-01   -7.214286005850314e-01   -8.980290292777445e-01   +4.437177939705130e-01   -2.279164686277080e-01   -2.584051751074292e-01; +3.525921968319313e-01   -1.056861511753966e-02   +5.911076202583847e-02   +4.686290868458211e-02   -3.220743177769854e-01   +4.108165114730897e-01   -4.298697683670086e-01   +3.410493171978076e-01; +6.753243840588019e-01   +4.028903617205304e-01   +1.630398185872891e-01   +4.651562142565022e-01   +2.038385675466610e-01   +2.652242378228020e-01   -8.251543691184116e-02   +1.000000000000000e+00; -6.664841301994427e-04   -4.663917579579674e-01   -5.542197516453242e-01   +2.491448327551479e-02   +2.158083985467323e-01   -1.397961676472304e-02   -1.557078615031309e-01   -6.164549226670858e-02; +1.179080302979909e-01   -4.645066462059900e-01   -5.010069995460018e-01   +8.184273640113944e-01   +5.832650355574768e-01   +3.096400393254914e-01   -4.092537823872225e-01   +8.891844271747937e-01; -7.600059441789168e-01   +2.879375850085096e-02   +6.956570820875843e-01   +1.049485856275099e-02   +8.721399223191614e-01   -4.573011688900872e-01   +2.819653049157909e-01   +5.263261886524446e-01; +7.426845062505503e-01   +4.595328864478673e-01   +7.349025443870992e-03   +2.246925235114009e-02   +1.099642958031165e-01   +5.363584842081304e-02   +5.588032014007304e-01   +1.024644894498733e-01; +3.760505625053631e-01   +8.224106724179513e-02   +8.088346786665634e-01   -6.822517836950522e-01   -5.061925288351510e-01   -6.300907182273638e-01   +3.729785598761161e-01   -9.396817790485810e-01; -4.581814889123044e-01   -5.506066610963192e-01   +1.014070552140506e-01   +8.826957111809155e-01   +4.587075341743125e-01   -3.030453053520663e-01   +1.011870381566165e-01   +1.596864107891016e-01; +6.368182688175171e-02   -6.934801031950022e-01   -4.252944148209716e-01   -3.936580461490223e-01   +4.452349637746348e-01   +1.949587219411051e-01   -3.691456556245252e-01   -1.990560724034455e-01; -2.799434955679313e-01   -6.370656678251579e-03   -8.285265501656102e-03   +6.808366947817236e-01   +2.330017441157519e-01   -7.269026016941187e-01   -5.546466215579158e-01   -2.932807050915118e-01; -5.725394260902776e-01   +1.637919947713982e-01   -6.929054787428010e-01   +4.594193034609694e-01   +6.541055757729917e-01   +5.418534564010051e-01   -7.964698568318856e-01   -6.467493379281416e-01];
L3I_L3E_iAMPA_netcon = [+2.910825046965088e-01   -2.919476174636195e-01   -7.377870093372519e-01   -2.826109240583579e-01   -5.527801363513986e-01   +1.277889400227207e-01   -8.706536593327336e-01   -5.055803790683649e-02   -5.691146368657591e-01   -4.997426585331763e-01   -5.959102385334355e-01   -1.000000000000000e+00; -4.812775549692568e-02   +4.497425979825505e-01   +1.955654187384667e-02   -2.539234773927255e-01   +6.719357144762017e-01   +4.484457155603058e-01   -5.318336314179820e-02   +5.490635864314422e-01   +3.163682707887630e-01   -1.985700139729565e-01   +5.835077986996663e-01   +5.837650420207339e-01; -3.467992734069417e-01   +1.168184276676754e-01   +9.459946581488557e-01   +2.211022455482896e-01   +3.301511066820880e-02   +7.387728374513668e-02   +4.644828998964068e-01   +8.037398280587167e-01   +6.702521199168740e-02   +4.886941611227470e-01   -5.102668723385754e-01   +5.545226901786721e-01; +2.480472277578007e-01   -4.289363750711678e-01   +7.641480555392134e-01   -2.460610426300668e-01   +2.252668016521123e-01   -4.169455374966109e-02   -2.251730316892067e-01   +3.608596183973573e-02   +1.249715836168884e-01   -2.985790936627978e-01   +5.399566290019429e-01   -7.771576495781009e-01; +2.910545847229547e-01   -2.856556637561097e-02   -3.814249685801523e-01   -9.313914840839458e-03   -7.091736764058260e-01   -5.417292342896144e-01   -6.385139401024553e-01   +6.051944994518148e-01   -2.491638433575777e-01   +4.694273798899539e-01   -1.135098068553017e-01   +4.147970952478222e-02; -2.939819121510812e-01   -3.489794791714948e-01   +1.113792539208270e-01   +1.321537050628115e-01   +7.523024952137429e-01   +2.058628678590187e-01   -3.621494890351953e-01   -1.252867418499248e-01   -5.159306804480526e-01   -9.211583365812183e-01   +5.684606030610375e-01   -4.821505067871887e-01; -6.183352591800502e-02   +5.366667915059471e-01   -1.548328816024487e-01   -6.980343562813648e-01   +5.217959705371369e-01   +6.153537806262835e-01   -6.362033058995995e-01   -3.698995357895976e-01   +3.323698790315669e-01   +2.120678366563208e-01   +5.160266820698763e-01   +3.767105574118608e-01; -3.124675762180538e-01   -2.187989462714642e-01   -5.236786483480373e-01   -4.651362442939584e-01   -4.255552920373741e-01   +1.022484980147108e-01   -6.656801947647968e-01   +1.422197177311113e-01   +4.143382596364538e-01   -6.618869994176934e-01   -3.313185355353529e-01   +3.510828055768191e-01; +2.269446898400844e-02   +5.590628240577936e-01   -8.316629439948329e-01   +5.829854978934361e-01   +5.475567224143866e-01   +2.391555700792979e-01   +4.398736078957184e-01   +1.053669485249160e-02   -5.445719887557395e-01   -3.860835435579902e-01   +3.472410385999080e-01   +4.556654199347946e-01; -2.663125188327872e-01   -4.792675170790131e-01   +4.405652245217301e-01   +4.870811609009050e-01   -5.152608192012424e-01   +2.425093746218911e-01   -2.345385404294903e-02   +2.759874578948218e-01   +4.303196373488821e-01   -4.627297475678046e-01   -1.224068113457923e-01   -1.726855558825872e-01; +4.446024841465961e-01   +1.392865456257960e-01   -2.008505206459301e-01   +7.780185638983421e-01   -5.357382426293235e-01   +3.178177029385758e-01   -8.113578896018209e-02   +3.952187650512389e-01   -2.233240040606484e-01   +4.372347886153492e-01   -6.767202888366690e-01   -8.083962812944281e-01; -2.482306406463059e-01   -5.795715993889178e-01   -5.337160472330762e-01   +3.321550753574220e-01   -8.103575037841441e-01   -1.934867441547025e-01   -4.825322483117479e-01   -8.895278545060499e-02   -5.647382355775611e-01   -7.247355528216848e-02   -5.229570907626785e-01   +9.736396163553042e-01];
L3E_L3I_iGABA_netcon = [-5.082606638810848e-01   +2.571403989158066e-01   +2.465382583092982e-01   +3.770348077155277e-01   -3.421342421890791e-01   +9.588289654717862e-02   -2.839462600978821e-01   -2.649265374235747e-01   -3.057164806120852e-01   +1.161902849721768e-01   +5.931614566162886e-01   -4.160180999706742e-01; -1.257459020087411e-01   +2.632302344756753e-01   +9.633323547521160e-02   -4.990567314073660e-01   -6.809454412903917e-01   +1.200639182764349e-01   -2.254738893406992e-01   +3.333273627359241e-01   +5.304619539364948e-01   -5.973979766699429e-02   +9.583934999441084e-01   -8.283955434847709e-02; +6.078062943606648e-01   -1.503364119843960e-01   -2.923822542481340e-01   -4.229391350731372e-01   +4.770496992256330e-01   +5.170494148484475e-02   +8.708585377519240e-01   -5.544778693085563e-02   -7.916200108147884e-01   +2.400340516491637e-01   +5.005768568322402e-01   +2.878578614548679e-01; -5.963810852283018e-01   +4.701809776247566e-01   +8.077675287910625e-01   -5.613645899060762e-01   -1.801560668021795e-01   +3.719522740951696e-01   +3.992205160356758e-01   -7.069150888368540e-02   -2.361574761302514e-01   +1.838154230058590e-01   -4.066221154076670e-01   +5.924511039511107e-01; -4.005333047053801e-01   +5.620972375000720e-01   +4.144931129850215e-01   -1.037876144671965e-01   -7.560059874118796e-01   -5.117287904154091e-01   -2.921141658864093e-01   -6.416454461092203e-01   +5.776817306397550e-01   -8.421433204842601e-01   -8.660277603277876e-01   +5.706227449485237e-01; +1.107867357412650e-01   +1.135523093315500e-02   +7.124564147462652e-01   -4.207510431135567e-01   -6.179164203978311e-01   -9.365269862886207e-01   +2.088035421539341e-01   +5.237095873501437e-01   +4.898913283671408e-01   -1.773908080583413e-01   +6.178172767345111e-01   +3.586680585845318e-01; +2.271182409464655e-01   +4.215497882102875e-01   -5.198027475373485e-03   +4.207863594972519e-01   -1.827574416306453e-01   +5.594881509485879e-01   -3.234536806683143e-01   -5.819449000342689e-01   +5.903520255547207e-01   +2.062003241401755e-01   +3.297716845675869e-01   +4.340257738509076e-01; +1.147085721844876e-01   +6.154886885305711e-01   -7.302978479824459e-01   -6.273516847345881e-01   +1.683525707820073e-01   -5.691631490562068e-02   +2.538141498221211e-01   +4.710909007595399e-01   +2.992987001642244e-01   +5.973300516143715e-01   +2.621502548076165e-01   -6.175828535851676e-01; -2.463885586090152e-01   -4.080369627510086e-01   -1.437089973711654e-02   -8.609563459432541e-01   -7.005491912454914e-01   +3.411431159239556e-01   +2.031610763137984e-01   +4.582572177570906e-01   -7.331874983479328e-02   +4.824673707249036e-01   +1.988143007267580e-01   +4.119583291201547e-01; -6.448675956720697e-02   -1.516536842135127e-01   +5.501010575506561e-01   +6.417425481560294e-01   -4.214910613323251e-01   -6.363137318951720e-01   +3.104049332764899e-01   +3.690542010155311e-01   +7.291606238763655e-01   -4.240458244404406e-01   +2.368715576898475e-01   +7.620757807667573e-01; +3.851844479561906e-01   -1.386152490179806e-01   -5.949839973905339e-01   +4.277731760471538e-01   +5.245143822217935e-01   -3.240374690814967e-01   +4.032215603430834e-01   +6.442996977727340e-03   +5.288004651594194e-01   -1.000000000000000e+00   +1.897075873084596e-01   +3.573456853868554e-01; -1.731805581265330e-01   -3.168630710818355e-01   -3.308489349699077e-02   +6.169688424537194e-01   -1.873432855082970e-01   +2.146715023724996e-02   +7.011765168715340e-01   +3.006805998162016e-01   -2.481066440346874e-01   +7.481149123779557e-02   -4.300794745376220e-03   +2.679583224001191e-01];
L2E_Input1_iAMPA_netcon = [-7.081594426325292e-01   +3.756674515659968e-01   -3.636374430613407e-02   +3.430281717732816e-01   -5.804081736865183e-01   +5.122407991967698e-02   +2.658303690788852e-01   -2.106271135747824e-01];
L2I_Input2_iAMPA_netcon = [+9.124995849949541e-02   -8.746332479922636e-02   +7.069516339903954e-01   +4.191231139620939e-01   +1.047427104932121e-01   -5.221133958296847e-01   -3.944585634966818e-01   +3.948267295229288e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
