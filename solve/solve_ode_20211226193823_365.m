function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.421755453489119e-01   +4.824470280293363e-01   -5.392105941111657e-02   -2.078751405423963e-01   +1.529166176662772e-01   -4.624522651982036e-02   +2.490906368521361e-01   +3.300129742013516e-01   +6.855333939002861e-02   -2.031437194215731e-01   +3.712946241717027e-02   -1.869316229599065e-01   +3.169641979360232e-02   +4.077117539188697e-01   +9.671657044685644e-02   -1.828730886173099e-01; +1.712708738095451e-01   +3.328234633420888e-01   -2.315399601125639e-01   +8.222514901328538e-02   +1.636722631938064e-01   +2.327030500407066e-01   +5.631044858305164e-01   +2.709021172209707e-01   +4.316150808932950e-01   +1.200307421670668e-01   -1.295462001001841e-02   +5.797115656562603e-01   -1.526353657744730e-01   +1.038806270338330e-01   +1.202067302511394e-01   +3.274503989539614e-01; -6.716409276754255e-02   +2.483706134331398e-02   -3.274128292480000e-01   -6.542356395969545e-02   +3.061642906937859e-01   -8.591788994263574e-02   -1.738357049145012e-01   -1.307754231177137e-01   +6.191893735825021e-01   +1.451926701443661e-01   +3.129440120526399e-01   +2.066961207799979e-02   +1.313266292900672e-01   -9.358135566598531e-02   +3.935809936089656e-01   +3.748738534485302e-01; -5.265407625011515e-02   +1.314241800930442e-01   +1.425775977891807e-01   -1.187377142108091e-02   +2.304198702502588e-01   +6.541519437811318e-02   -4.110122338625818e-01   +3.572729775120455e-02   +9.733059759626553e-02   +2.784628744410539e-01   -1.754590058793584e-01   -4.004059750665963e-01   +2.770188569212479e-01   -7.337073005911082e-02   +3.292027561306226e-01   -7.988970691260920e-02; +1.836714919762114e-01   -1.950485656486313e-01   +1.234139717362071e-02   -7.404774620207670e-02   +3.076285775408459e-01   +4.009177067702524e-02   -9.379629191204436e-02   -1.106860093825904e-01   +4.441254373744669e-01   +2.384668443189972e-01   -3.451612897291951e-01   +4.258858317018573e-02   +2.869566227782302e-01   +1.002630125261222e-01   +5.374364334041332e-01   -3.523050664887141e-02; +3.874453293724006e-01   +2.025930636235870e-01   +2.520566708998676e-01   -1.110595728239510e-01   -1.456933224210251e-01   +8.634588590276653e-03   +1.869509316304573e-01   -8.319636525289503e-02   +4.272660453595273e-01   -4.084502338939079e-01   +9.899334227147313e-02   -8.509929406947170e-03   -1.343661753768074e-02   -4.086159456428978e-02   +1.154288657716983e-01   +1.540314573692589e-01; +3.066005781510378e-01   +3.317480602403483e-01   +1.854166324468573e-01   +2.279927637826563e-01   +9.467984564292956e-02   +2.278185420576253e-01   -1.872094529796993e-01   -3.424411873203456e-01   +9.507669341810725e-02   +2.961948536591519e-01   -2.355464372582022e-01   -1.464011320734263e-01   +2.178083077694740e-01   +5.020655461376875e-01   +2.378775514482444e-02   +3.229983883913737e-02; +1.678900564670971e-01   +1.007240078695662e-01   -2.033290146998451e-01   +1.313327829030363e-01   +4.423670748655301e-01   +1.594899055709673e-01   -2.070612295757849e-01   +4.541867757140039e-01   +5.511662289367802e-01   +1.314883630591719e-02   +4.846897577486617e-01   +7.440198884304264e-02   +3.053066263513594e-01   +2.413345531260087e-01   +1.559244555249609e-01   +2.009277381772410e-01; +1.296708823668698e-01   +5.448926407759049e-01   +3.539759088551993e-01   +4.519011180977324e-01   +3.697169199867789e-01   +4.303955374238106e-01   -2.620541759253527e-02   +2.439694983101210e-01   +2.155453375871690e-01   +2.455132288183326e-01   +8.937910421994155e-03   +3.237022939631368e-01   -4.702607142414545e-02   +4.143288913827025e-01   +2.890759414907958e-01   +4.088858574992267e-01; -4.972924448499475e-02   +1.622604392594898e-01   -3.267596611646693e-02   +2.928560285424972e-01   +3.153398295399129e-01   +2.609792661464115e-01   +6.152370983920759e-01   +6.674585316304238e-02   +3.644660674893750e-01   +7.227410554907253e-02   +1.923349124192090e-01   +4.691712725366085e-01   +3.061764429905821e-01   +1.633886334467501e-01   +2.441454843422421e-01   -1.481106469377721e-01; +4.909598860684583e-02   +8.237523868468373e-02   +2.117507444423495e-01   -1.340149113987018e-02   +3.314047977498422e-01   -2.445585423042394e-01   +2.282768163731995e-01   -3.202195995158658e-01   +5.311658371838885e-01   +2.901836518725988e-01   +2.938467578803608e-01   +6.550101178935383e-02   +1.538199698115823e-01   +4.065058764484139e-01   +3.637425927922017e-01   +4.175104965721798e-01; +8.253107694792547e-02   +3.127209861839806e-01   -4.500406988703073e-01   +2.858666414830403e-01   -5.887271494148547e-02   +7.036581967057520e-02   +5.563262039418333e-01   -1.842092240134244e-01   +5.366560566338910e-02   +2.299738196315625e-01   +4.310510150975486e-01   +2.412632489970135e-01   +1.840345686091639e-02   -2.120720584109334e-01   +2.625674708041671e-01   +1.947073500786033e-01; +3.066185175912535e-02   +2.356205310406151e-01   -5.439879565197375e-02   -2.324315076885973e-01   +3.916991659587504e-01   +2.198371155611343e-01   +8.189357655687726e-02   -7.888479306590702e-02   -8.957967890411836e-02   +5.546827944462157e-01   +3.624359619682328e-01   +1.987005415837676e-01   +4.753179875733655e-02   +5.217959258204760e-02   +8.558195375071102e-02   -1.778312867442590e-02; +1.453909659756117e-01   +1.318439529408386e-01   +2.600596421806859e-01   +5.869050355439696e-01   +3.730747187327648e-01   -1.182620950952883e-02   +3.660019075972494e-01   -3.545724167130802e-02   +1.816659810336994e-01   +1.699804183742888e-01   -3.201340095927293e-01   +2.581195661411768e-01   +2.732900206042573e-01   +1.243819307140952e-03   +3.059352271145134e-01   -2.911265061602507e-01; +5.387555779447019e-01   +2.988116733995949e-01   +2.004869236952930e-01   +1.657760223042356e-02   +1.863088312796299e-01   -3.312270071028535e-01   -6.200769159887294e-02   +1.276314792238298e-01   +5.422928250894916e-01   +3.450209934015387e-01   +2.334640879732367e-01   +2.066842252392549e-01   +2.791297151735189e-01   -1.741980630442397e-01   -3.300416521289403e-01   -1.723587816794145e-01; +8.586124168206816e-02   -1.677821905604566e-01   +2.198565034402891e-01   +2.164772268613015e-02   +7.207063681824732e-02   -1.035666606735023e-01   +5.654398558264160e-01   -6.656143533023653e-02   +2.340563520893248e-01   +9.611802029558590e-02   +2.146966148979860e-01   +1.512957706866903e-01   +3.463557948708390e-01   -3.942889011706058e-02   +2.700591608536575e-01   +3.837566424404841e-01];
L1E_L1I_iGABA_netcon = [-4.604715380645874e-02   +8.465798031679822e-02   +2.361322236567665e-01   +1.873664637027352e-01   -1.738020995796067e-01   -2.406146931683279e-01   +1.865540172074197e-01   +1.995274130076557e-01   +2.668856839491219e-01   +3.551805339639854e-01   +1.093404754805903e-01   +3.364767716834000e-01   -8.345839848892110e-02   -7.679214557793707e-02   +6.494012742587085e-02   +2.850954969393951e-01; -2.012082046477173e-01   +3.083837798743972e-01   +6.796709200440226e-02   -1.732830323511965e-02   +1.608238495537407e-01   +1.613365914279332e-01   +1.267487329226736e-01   -3.519576272491450e-01   +3.437888697059245e-01   -1.892924038244034e-02   -5.181642166119451e-02   -3.591877056519470e-03   +1.000289498835847e-01   -1.360623290093874e-01   -1.102925852417370e-01   +1.631645535969930e-01; +7.216409033372053e-01   -4.725952520243347e-02   +2.622080488162433e-01   +8.712076113789036e-02   +2.568630376738043e-01   +2.185274427816108e-01   +8.020700398925605e-02   +4.129476322062353e-01   -8.424775037918823e-02   -1.427246262486276e-01   +4.153187123126253e-01   +8.450191970742996e-02   +1.558027829029458e-01   +4.776566338346860e-01   -1.909984368195845e-01   -2.490831985176911e-03; +3.890195991122007e-01   -5.297434869378476e-02   +1.391459306483264e-01   +3.309322148180457e-01   +3.149865424735665e-01   +2.211298481339676e-01   +4.327561697552617e-01   -2.370551488675493e-01   +7.226020502056968e-02   -7.286505088183802e-02   +4.686804583073633e-01   +9.265900321539830e-02   -3.175112898002193e-02   +1.996844292220739e-01   -7.231602171592869e-03   +3.016371856668886e-01; +3.556165936456283e-01   +7.222434618339416e-02   +8.316688173412290e-02   +1.559735247844355e-01   +5.976604472082678e-01   +4.637074276251105e-01   +6.943362610397576e-02   +1.685158060822503e-01   +3.569090892408239e-01   +3.365658550707481e-02   -7.003900169065681e-02   +4.632415235292219e-01   +4.071443980891649e-01   +4.331060830001502e-01   -1.631842747830290e-01   -8.682744152645011e-02; +1.101742048726348e-01   +4.655244158869315e-02   +1.616873547504731e-01   -6.646315947404913e-02   +1.304646078059570e-02   +2.156862018339323e-02   -8.701671644448529e-02   -1.950578847290055e-01   +2.733953409032540e-01   -3.288959516623626e-01   -1.100131248215478e-01   +2.217013552529840e-01   +1.916386383096376e-01   +2.646867409710191e-01   +3.771727967298094e-01   +2.425898408938342e-01; +1.650700924068846e-01   +1.950059111376355e-01   -5.436961294819714e-03   +5.412845302124202e-01   +2.351370103650339e-02   -6.306397054344701e-03   +1.795856851755075e-01   -3.393271653811635e-01   -9.156424640085115e-02   +3.026615076336503e-01   -1.199160834510912e-01   -2.014520697864191e-01   -2.644607690037758e-01   +9.753078843269411e-02   +9.206865526830449e-02   +1.100871942060967e-01; +3.508501608276682e-01   +3.842655540112616e-01   +2.266423581829450e-01   +1.306438395309885e-01   -2.056849979800218e-01   +6.037061720224358e-02   -3.738144441375785e-02   +1.897607965046580e-02   +2.227811768247516e-01   +7.263498546072129e-03   +2.774991172598772e-01   +1.971583165391979e-01   -2.041526424602905e-02   -3.144580511957090e-01   -5.674429874343884e-02   -1.426997657462709e-01; +2.928827992504827e-01   +7.330154542061018e-02   +4.093140425189202e-02   +5.907845136111681e-02   +1.922511893663052e-01   +6.322158732827856e-01   -1.870824097006017e-01   +1.418416922407956e-01   +2.296534507954739e-01   +2.469786198331769e-01   -2.667625150196347e-01   -3.300787986215759e-02   -1.574828316670211e-02   -4.973111110224200e-01   -2.001810213808866e-01   +5.179275779647563e-01; -1.341383954530597e-01   +2.149287626049660e-01   -3.729490307850213e-01   +1.499557190225896e-01   +2.449118167373772e-01   +2.154079438320443e-01   -9.649701957520737e-02   +9.285489123543453e-02   +1.814494588499873e-02   +2.641168629599376e-01   +1.735267765017774e-01   +3.736412844610720e-01   +3.687013757396531e-01   -1.150236017276828e-01   +3.839857560376012e-01   +3.218802998765407e-01; +5.106651480896163e-02   +1.346659581968556e-01   +6.572257588415359e-02   -2.422724229408623e-01   +2.748348003034692e-01   -3.528683108583373e-01   +7.493341278690233e-01   +2.751106868587058e-01   -4.154918008777615e-02   +1.625213937897307e-01   +9.502205436777867e-03   +1.640911400923265e-01   +2.685774066626471e-01   +2.822180316597219e-01   -5.846535746640873e-01   -3.165049388028631e-01; +1.896941663461827e-01   +1.132598714842173e-01   -2.731648697775728e-02   +1.475758603390354e-01   -1.911858935729623e-01   +7.010682301977799e-01   -2.515446644143157e-01   +2.081158070921702e-01   +3.041280031509748e-01   -4.090465023382350e-01   +5.493015440274432e-03   -4.513299739689418e-02   +2.542757513413216e-01   +1.295836231127868e-01   +3.003281633541007e-01   +1.997825854614189e-01; +1.438177418715766e-01   +1.551036141133217e-01   -1.299638775625182e-02   +1.800211108484738e-01   +2.974013945842729e-02   +5.463848968039975e-01   +1.611677791011701e-01   +7.162869920542152e-02   +1.315996141109175e-01   +3.152515741283800e-01   +5.719697997586632e-01   +3.837252581208682e-01   +2.151369806056596e-01   -1.549506503578124e-01   +1.843199995461145e-02   -6.548704849647670e-02; +3.239768982821863e-01   -5.840902090602618e-02   -2.446317049499338e-01   +9.276568896127482e-02   +3.087687372885227e-01   +1.655435930756636e-01   +2.544723880712014e-01   +6.708740301974668e-02   +2.871123376678900e-01   +4.977224910970433e-01   -9.256102394696229e-02   +1.763964172380847e-01   +1.914853616014722e-01   +1.424381529909726e-01   -2.315697809741652e-01   +1.056757734472175e-01; -1.834455490050976e-01   +1.052205988628415e-01   -3.776913129223953e-02   +1.237565977372798e-01   -1.844049621509350e-01   +4.145420574978178e-01   -2.465502854760045e-01   +1.240909016641347e-01   -3.089873733865898e-01   +4.160875591157628e-02   -4.163274379910890e-02   +4.415845435836109e-01   -3.067554591939999e-02   -9.977428640497357e-02   +3.081183429847195e-01   -1.767008034745741e-01; +3.258391624090759e-01   +3.748702298390798e-02   +2.452735111122747e-01   +3.592708657558993e-02   +4.774247187582076e-01   +3.051715614274971e-01   -1.296416835608042e-02   -1.398657023351609e-01   -3.343177692085308e-02   -1.031370199043279e-01   -2.741355738726917e-02   -2.574049171973262e-01   +6.313788871654000e-01   +3.890846556798945e-02   -2.645381479932694e-01   -1.542521146439889e-01];
L2I_L1I_iGABA_netcon = [+2.479793322764092e-01   +1.673036051466162e-01   +1.836757623450081e-01   +5.123795254025798e-01   +4.785243216389155e-02   +1.070064852284391e-03   -3.115672575326863e-02   +1.529803832236407e-02; -2.814261682507032e-01   +3.600214804410522e-02   -1.731003916403165e-01   -1.361103265310691e-01   +1.561409006862661e-01   +4.997334774953204e-01   +1.564196664646396e-01   +4.608585132773958e-01; +3.812773483641987e-01   +9.965561375870144e-02   +3.202232498374820e-01   +3.145944918803311e-01   +5.417666433499304e-01   +2.671533324023130e-01   -1.130142831705438e-01   +4.094456853452157e-01; +1.389205842435828e-01   +2.793266680773872e-01   +1.433017344990603e-01   +1.651391202502439e-01   +2.442214040444722e-02   +1.512550540775353e-01   +2.351145289858633e-01   -1.345472117043941e-01; -1.258372546717726e-01   +4.995328839259471e-01   +2.235218995694990e-02   +1.943502805493538e-01   +9.502432684257361e-02   +7.500776401414996e-02   +5.966667093413024e-02   +5.431720267849949e-01; +4.456852482485000e-01   +2.016248884797278e-01   +2.491033381673267e-01   -4.602827233124024e-02   +1.279447646257530e-01   -5.537443455430793e-02   -1.943675209400202e-01   +3.960269972117088e-01; -1.318329042579032e-02   +2.865062063795143e-01   +6.054839847436259e-02   +4.561615351697865e-01   -8.745440416727052e-02   -3.803578187431148e-02   +1.239525495944457e-01   +2.831341738196321e-01; -9.441919802787140e-02   +1.387535607337702e-01   -1.009551674052325e-01   +9.069149791186315e-02   +5.321836392809268e-03   -1.035777071368148e-01   -2.290377796000015e-02   -1.931215342145731e-01; +4.361871288757765e-01   +2.300179544579239e-01   -8.287399583649631e-02   -1.732486936067716e-02   -2.190687832749464e-01   +6.937319517103531e-03   +5.929000899263597e-02   +1.396478898879403e-01; +6.997906172656954e-02   +3.666383743750659e-01   -1.159192363202651e-01   -2.927275540372424e-01   -1.196988585334421e-01   +6.390043729943833e-02   +9.693633059841195e-02   -6.667598856384137e-02; +2.165680376428721e-01   +2.358501584766950e-01   +5.524478021678472e-01   +1.607640268980578e-01   +8.151829144678222e-02   -2.094968258627376e-01   +2.798709125838290e-02   +8.897570508051925e-02; -8.663329370657960e-03   +3.457546715548226e-02   +1.868794742971516e-01   +3.205495317013285e-01   +1.241872836756977e-01   +8.136737489116982e-02   -5.097388526827189e-01   +1.039526154814699e-02; +1.585059836389626e-01   +1.831486124112727e-01   +2.377844406978293e-01   -8.136038086853607e-02   +1.065038815926007e-01   +9.747041224464953e-02   -2.742437738006909e-01   +3.584717915320123e-01; +4.739221386710973e-01   +2.019889467763323e-01   -1.842227870370477e-01   +1.151581307096406e-01   -2.179711730780422e-01   +1.244705170362339e-01   -6.076360074155888e-02   -2.977608832855334e-02; +5.533745822857190e-01   -3.792937636217784e-02   +7.674065741519326e-02   +2.955912945667502e-01   +2.108620571821630e-01   +1.708642381323246e-01   +2.560985600915612e-01   +4.504786694577038e-01; +5.442301942108598e-01   +1.544240047708389e-01   +1.738950315230114e-02   -1.288764965703728e-01   +2.620067154353733e-01   +3.415350394276514e-01   +2.851277452072998e-01   -1.121606674845383e-02];
L1I_L2I_iGABA_netcon = [+4.358993047908961e-01   -1.684079014060602e-01   +4.644995143992312e-01   +4.409258278584470e-01   -1.393761111017630e-01   +7.076145105380713e-01   +2.316421791109366e-01   -1.959783544214592e-01   +2.870225004130828e-01   +3.075888491866501e-01   -8.329265065269126e-02   -3.441851023792339e-02   +5.577505500842568e-02   -1.144554907054783e-01   -4.561871481787448e-02   +4.807569429299123e-01; -3.371300593299274e-02   -7.022752219390840e-02   +2.545173906143889e-01   +2.820382581693444e-01   -1.143744607133113e-02   -8.724428291907932e-02   -1.230173082608388e-01   +4.248381800096964e-01   +8.803212414257940e-02   +2.862944123920719e-02   +2.180891567609521e-01   +2.260800267721851e-01   -9.181387687386450e-02   +1.579794282413386e-02   -1.329938005011280e-01   +1.480760827435972e-01; +4.916935276378347e-01   -3.356685139135848e-01   -1.205115164794192e-01   -1.024029260863468e-01   +7.763486933930197e-02   +7.132961799959570e-02   +1.489498872179469e-01   -6.046252521499595e-02   +2.663042533903485e-01   +3.292614562330129e-01   +3.109882266769332e-01   +1.841863289951561e-01   +1.516280501074606e-01   +8.070154724270069e-02   -2.389887580569846e-01   +5.937762218667231e-02; +4.119721315793442e-01   +4.074728470428528e-01   -1.002482451344726e-01   +8.435410672570010e-02   -1.971647545725402e-03   +2.652799591494022e-01   +8.864937060556408e-02   +3.708922712247403e-01   +1.462952848884888e-01   +2.786130429757882e-01   +2.365440817098978e-01   +4.514964043827028e-01   +1.985331386125303e-01   +2.087345948494166e-02   +1.403174563619124e-01   -1.467485834098413e-01; +6.096624716117288e-01   +6.972374630442967e-02   +4.775934942067254e-01   +1.720611477721000e-01   +1.246075870940204e-01   +8.010326483396731e-02   -1.514818687004056e-02   -2.989689704350405e-01   +7.295936663665493e-02   +9.976151703890007e-02   +4.507910405478290e-01   -1.875586405621950e-01   +2.523229842841883e-01   +7.071612928621004e-02   +1.376428097247586e-01   +2.401655221060343e-01; +5.022356485961307e-01   -5.330488048933141e-02   +3.626791164700705e-01   -3.172402675397637e-01   +2.956673825899986e-01   +2.670772624888971e-01   +1.053061563004031e-01   -2.694159853657098e-01   +4.907119091614339e-01   -3.753054107559804e-01   +1.188091158708064e-01   +4.040553491893807e-01   +3.153782658099653e-01   +4.356728209057973e-01   -1.197475073553888e-01   +4.865853975406403e-02; -1.425967078385839e-01   -5.733991708674012e-02   +4.328149708291364e-01   -1.150725774393179e-01   +2.799479942358886e-01   -2.066131956896123e-01   +1.144787689413597e-01   -3.329806997571585e-02   +1.611117503392836e-01   -1.837252364226269e-01   -5.655362202139066e-03   -3.173330389727322e-01   -1.482065545273508e-01   +5.840934688435205e-01   +2.963544168532159e-01   +4.356953816652814e-01; +1.593291731846082e-01   +1.745222250209204e-01   -2.354203962083878e-02   +3.055624191862937e-01   +3.172559315846794e-01   -3.842463253291403e-01   +8.163753158868386e-04   -8.668312651600353e-02   +2.581178511308722e-01   +1.573974132888096e-01   -4.012121693423451e-01   +2.035347895381977e-01   +1.401991696948322e-01   +2.726602589765730e-01   +5.689835324283454e-01   +2.155042370110922e-01];
L2E_L1E_iAMPA_netcon = [+4.838422101828668e-01   -2.413935592777097e-01   +2.351988515400810e-01   -1.882900886822956e-01   +1.838331734099245e-01   +2.638508364286922e-01   +1.880210625975806e-03   -4.707052547258393e-02; +3.437300945614923e-01   +9.291507259640164e-02   +6.627446679425023e-02   +8.794245153283110e-02   +4.490097358226862e-01   +9.627560259793547e-02   +6.913615447070764e-02   +1.098594928525858e-01; +4.452234896788001e-01   +5.497998658114860e-01   -8.956422096112390e-02   +2.149843882384771e-01   -1.364643159611199e-01   +5.515029049554081e-01   +1.912476529408789e-01   +1.482012594334281e-01; +5.513815997930166e-01   -4.556386984060637e-02   +9.015881054672134e-02   +4.009662121111698e-02   +1.041684014827223e-01   +5.686564974590087e-02   -7.768709366452953e-02   +2.259833138884108e-01; -8.018272058220473e-02   +7.356306958179577e-01   +2.397659280018757e-01   +1.057184966617379e-01   +2.608938454526112e-01   +1.496282632090655e-01   +2.391673890526336e-01   +2.128412614547898e-01; +1.071308796858067e-01   -9.564956535655642e-02   +4.352219875379028e-01   -2.333640041600811e-01   +2.365892041526602e-01   -1.230978586068135e-01   +6.701320569245183e-01   +6.082096943368466e-01; -2.179638221229286e-01   +2.337366922629344e-01   +2.210171560704673e-01   +4.120213953925449e-01   +6.497702471835118e-01   -3.469889441682982e-01   +1.768076067795175e-01   +2.512789765521980e-01; +4.150931656841235e-02   +4.596847152653561e-01   +4.076483105399178e-02   -4.009542230848757e-01   +2.168434942786559e-01   +1.996616736268980e-01   +4.409096073084540e-01   -2.540071653932201e-01; -4.513355234119945e-02   -1.732473515415880e-01   -1.807882807128941e-01   -9.658668553365110e-02   +3.388596342675606e-01   +2.504956736762997e-01   -1.667023387297070e-01   +2.486666338127288e-01; +1.468428212724118e-03   -3.636700696011259e-02   +5.701682876797151e-01   +3.579116123715864e-01   +1.943786534589271e-01   +4.504083818918851e-01   -2.327277516221491e-01   +3.717682428065195e-01; +8.146385078321186e-02   +3.076870068754179e-01   -1.528061640399306e-01   -1.581145875635288e-01   -2.003070351894708e-01   +2.220680335768678e-02   +2.130249029989426e-01   +3.270417632708615e-01; -6.694870138913571e-02   -1.811463648918703e-02   -6.051379071009701e-03   +2.282842506435915e-01   +3.536406505918419e-01   +4.049478765672469e-01   +2.199270966012160e-01   +2.326869903251385e-01; -1.643959020943905e-01   +5.628773187383683e-01   +2.728818563593209e-01   +1.688285288018349e-01   -2.660351151592769e-01   +2.160187773780284e-01   +4.405550039507963e-02   +1.063996663006350e-01; +4.288250310595192e-01   -4.202099876264068e-02   -1.371062355096956e-01   +1.704701043219094e-01   -1.367617544806577e-01   +2.514501427374208e-01   -6.293060780805222e-02   +3.321344390834167e-01; -2.011492413065353e-01   +1.415410326825857e-01   +4.149356529031324e-02   +1.181890247724722e-01   +3.029271172284181e-02   +1.359387382509109e-02   -4.144120143048927e-01   -3.731159889423030e-01; +4.469926170651283e-01   +3.162469822870578e-01   +1.836990587117169e-01   -1.348110012579777e-01   -8.926730842182137e-03   +2.344925921107563e-03   +2.938653447358840e-01   -2.436855521873817e-03];
L1E_L2E_iAMPA_netcon = [+1.797178540177679e-01   +5.102010943619710e-01   +3.355736471522119e-01   -2.608529814698407e-01   +3.433354004831793e-01   +1.333368967711642e-01   -6.085372166877496e-02   +2.986195192416675e-01   -1.130371610603861e-01   -1.907637277327517e-02   -3.157506931958980e-03   +3.380689086655755e-01   +1.971562074745170e-01   -6.090238472151411e-02   +2.967936715484506e-01   -2.044784621870477e-02; -5.298048819830918e-02   +7.303702651007503e-01   +2.293683719606814e-01   -1.351851968584770e-01   -6.808983876973967e-02   -7.501525498860295e-04   +5.047149554239842e-03   +1.614280112186260e-01   +5.457554863931879e-02   +1.048118994828895e-01   +2.978146063585303e-01   +2.614044970321244e-01   -3.398808939223056e-01   +3.770133706853825e-01   +3.713189381976710e-01   +5.938671377666258e-02; -1.108015385133326e-01   +4.317727048123111e-01   +2.042632873848381e-01   -3.118477163964260e-02   +8.482841677732353e-02   +2.759875111935292e-01   +9.031980943700503e-02   +5.176784937695499e-01   +2.055477795369172e-02   +1.206415712641145e-02   -3.358731935288094e-01   +2.483003823330516e-01   +3.555885862109471e-01   +2.704373226259246e-01   +2.325303092807889e-01   +7.587970883842926e-02; +2.086699491415011e-01   +1.495139642548212e-01   +1.826855597991845e-01   -2.320351217318263e-01   -5.852200029753142e-02   +4.129252116226864e-01   +3.482769418041997e-01   +2.760479749498811e-01   +3.704320663720286e-01   +1.927388057231242e-01   +3.220751284855071e-01   -1.734088285687747e-01   +2.864441555367877e-01   +2.099490955641410e-01   +9.385074663950724e-02   +7.315409709715073e-03; -1.648310089794119e-01   +9.380751900142997e-02   +3.973041777024615e-01   -2.428348559752204e-01   +1.148974852971642e-01   +2.462112146879378e-01   +3.025343466010433e-01   +1.359988260321100e-01   -8.796033082215597e-02   +1.371179412288226e-01   -1.118389720428034e-01   -2.843262225709131e-01   -1.835482950795920e-01   -3.100050613341520e-01   +6.181333555936808e-01   -2.234356196188604e-01; +3.825466061027603e-02   +7.212245651305921e-02   +1.174016595207498e-01   -2.509784548390128e-01   -2.554857800408344e-03   +3.413579605888291e-01   -7.933356185662142e-02   +4.922674144161292e-01   +7.104507705489342e-03   +3.868669305620948e-01   +7.617872807461915e-02   +6.168722893125450e-03   +8.250378001290984e-02   +2.580355071940641e-01   +6.161568410606655e-01   -1.394563889379430e-01; -5.568872677912138e-02   +1.508716326167419e-02   +6.240732552076805e-02   +5.784425494294536e-01   -2.179954794768832e-01   -1.399049146956279e-01   -8.369809601713447e-02   +1.906944803740293e-01   +4.473790929643581e-01   +8.187304283449492e-03   +3.882838745847777e-01   -1.336937874294837e-01   +1.928782687501926e-01   +8.421722838661938e-02   -1.057188112057023e-02   +6.311137756500164e-02; +3.303205739284953e-02   +3.717823180083783e-02   +2.164745339726177e-01   -1.990697985037972e-01   -1.637233716454039e-01   +3.574935488135192e-01   +4.950158531721689e-01   -1.570898874146023e-01   +1.145437156820858e-01   +1.502003497385113e-01   +3.561104178199421e-01   +2.145380183050445e-01   -3.914333238635144e-01   +2.050882977458866e-01   -1.885365782989451e-02   +1.603505719659598e-01];
L2I_L2E_iAMPA_netcon = [+8.898339270757390e-02   +1.613849077836957e-02   +8.268489858728231e-02   -1.270995055189569e-01   +8.384639884969750e-02   +4.817810294990191e-02   +3.869966271996247e-01   -8.313247121631154e-02; +1.820231326314221e-01   +1.351085956578013e-01   +1.260407972360261e-02   -8.455207370437684e-02   -7.515353582859425e-03   +2.141538910142551e-01   -4.787931086940600e-02   +1.680285391617807e-01; +2.776654051031679e-01   +6.314121113528966e-02   +1.012020832791949e-01   +6.078407682867826e-03   +9.680656403939888e-02   +5.723590879193620e-01   -3.350597118323122e-01   +2.257419645338128e-01; +6.085095756478096e-01   +2.127931211783938e-01   +2.953722028325094e-01   +2.988907880338328e-01   +2.877262373975947e-01   -2.169138330566853e-03   +2.176618873865881e-01   -1.572034750196193e-01; +1.668616996690822e-01   -1.244356785134648e-02   -7.055010413460984e-02   +2.378905232444247e-01   +1.766214530252275e-01   -3.271344053040658e-03   +4.275382671699817e-01   +1.713878002082952e-01; -2.134401491672738e-01   -3.325858929641447e-02   +6.979557317769682e-02   +7.397836124232508e-02   -2.075242547538560e-02   +4.071328821029101e-01   +1.882909611055284e-01   +3.241766753181920e-01; +1.034320557894187e-01   +5.502697948450161e-01   +1.982121101673144e-01   -1.498893020606376e-01   +2.722395168394848e-01   +3.912768057392088e-03   -1.405747622002763e-01   +2.758460022628082e-01; +1.325916254348442e-04   +1.182565824965680e-01   +2.874973839211715e-01   +3.152947163902086e-01   +3.449111343972751e-01   +3.858137002604732e-01   +4.607408281066914e-01   +1.474120866151155e-01];
L2E_L2I_iGABA_netcon = [+3.185215133367961e-01   -2.790570300685168e-01   +2.311694790661302e-01   +4.792529427041782e-01   -1.089768976362461e-01   +1.184625902567771e-01   -1.066662370257397e-01   +2.575905754299591e-01; +6.513683290556831e-02   -1.474564285482086e-01   +2.367000268017611e-01   +5.732037206216866e-01   -1.717411902299422e-01   +7.114276312317816e-02   +2.526942355640169e-01   +1.737385189717142e-01; +5.398851210178404e-01   -4.436891713941748e-01   +2.661905741135694e-02   -1.149570460884047e-01   +6.888923036812078e-02   +3.756248491348313e-01   +4.672267437426973e-01   +6.504353370395556e-02; +1.011657093482099e-01   +2.873674704435215e-01   +7.096849502315231e-02   -2.579188897937982e-01   +4.110616695388864e-02   +5.182759072940929e-01   +1.868883348587341e-01   -1.813705316595828e-02; +2.308136802257819e-01   +3.833397157092512e-01   +1.185169309232131e-01   -1.644811578953944e-01   +2.842764905915143e-01   +2.118706556427929e-01   -1.576885978687515e-01   +3.799029432079838e-02; +1.032582621146688e-01   -1.621867282791458e-01   +6.270390184379552e-01   +1.453749204074027e-02   +2.034248316695832e-01   -6.626751096299788e-03   +1.041292618622318e-01   +3.842847667917677e-01; +4.057627060140562e-01   +5.655439992982078e-01   -2.362357923072701e-01   +3.138532985536494e-02   +2.519892603233512e-01   +3.073110878037118e-01   +9.013163168558812e-02   -3.340714060230041e-01; -2.032726835724296e-01   +6.413377142704184e-01   -3.226480126815125e-02   -7.745838693768262e-02   +3.437593307612783e-01   -1.675170183534169e-01   +2.011039022180550e-01   +3.219587389657145e-01];
L3E_L2E_iAMPA_netcon = [-3.971508931401872e-02   +1.149615657569629e-01   -2.444624304806890e-01   +1.589743805477020e-01   +3.910862652666072e-01   +5.453050660623684e-01   +2.268425321962184e-01   -4.646044099097957e-02   +3.270179758571063e-01   +1.000407860918757e-01   +2.157708279632850e-01   +3.780204951800213e-01; +2.735658887796393e-01   +3.671711791459714e-01   +2.294080824332909e-01   +2.106989277145989e-01   +3.380592663709813e-01   +3.675502724013289e-01   -8.611486646151849e-02   +5.116539072032286e-03   +1.045348821166641e-01   +3.740123861797153e-01   +9.707920103747621e-02   -2.831364084550705e-02; -3.993250053782233e-02   +4.407443748650169e-01   +2.481061126274762e-01   +1.081788418097629e-01   +4.841233108552110e-01   -2.433673261896044e-01   -3.099430297419358e-01   -1.068236623104971e-04   +2.224761922760513e-01   +2.912324472612349e-01   +3.533161844922652e-01   +2.321772473532606e-02; +4.536974041833236e-02   -1.298337998482013e-01   -9.284433504320647e-02   +3.826130438473716e-01   +3.053016035220690e-01   +1.373433494367776e-01   +5.057466218342714e-01   +1.986466299285854e-01   +4.669509403701245e-01   +1.887170419127503e-02   +2.724038043929304e-01   +4.262880324523042e-01; -2.268883520248522e-02   +6.840965504934685e-02   -3.443730733918460e-03   +2.454002948921130e-01   +2.317720713785814e-01   +5.817579012015565e-01   +4.794774827741637e-01   +1.752262042920826e-01   +4.377522063396079e-01   +2.350995747114295e-01   +5.928062265585923e-01   +2.820512403768399e-01; +9.605131844413134e-02   +1.267610977278360e-01   -1.364666645970289e-01   -5.958418250780322e-02   -3.164253209751630e-02   -2.524942463503190e-01   +2.123879818451833e-01   -1.512297377724319e-01   +7.264270434443239e-02   +3.718813213311354e-01   -1.968274230373898e-01   -1.675954007852802e-01; +4.203413353595946e-01   -5.078464278030111e-02   -1.310905273920365e-01   +3.646388833010052e-01   +8.560613993187592e-02   +2.568999676164558e-01   +6.267605920321986e-01   +3.189955588262885e-02   +1.942769913649922e-01   +5.943811848851421e-02   -1.405398823183777e-01   -2.520463475591628e-02; +4.803494298369435e-02   +2.972316576852114e-01   +5.469758639449348e-01   +3.383525258757222e-01   +4.547782504698667e-01   -3.720263003175532e-01   +1.811216853439198e-01   -1.201606977536943e-01   +1.060994500359481e-01   +3.589576723110154e-01   +4.713955530577317e-01   +1.380090515857726e-02];
L3I_L2I_iGABA_netcon = [+1.380259197220187e-01   -1.135978380705209e-01   +3.726874534057587e-01   +3.021090130583427e-01   -2.401713982219889e-01   +4.470815599437692e-01   +1.063154580158224e-01   -7.389292691483945e-02   +4.704069538927929e-01   -3.534331711896214e-02   -4.344467719502645e-02   +2.654076057821114e-01; +5.284317419416020e-01   -1.009312636279723e-01   +2.001532725174138e-01   +2.231019841606907e-01   +3.371361417003665e-01   +1.205344023661156e-01   +8.874044470796742e-02   -1.276795953765935e-01   +3.503041351645437e-01   +1.018984948699842e-01   +1.702279464807321e-01   -2.192721613167133e-01; +3.177877476920972e-01   +3.213003201835200e-02   -5.478192326087813e-02   +2.318598866703637e-01   +6.826991311989174e-02   -2.621791730988502e-01   +1.963711280707477e-01   +2.201873979289092e-01   +3.210127419496603e-01   -3.098754224366838e-01   +2.208553028259071e-01   +4.559931003708780e-01; +1.777545949344342e-01   -1.059042713920957e-01   +1.662367351423058e-01   +5.091372285194990e-02   +1.350606154978108e-01   -3.070118068587285e-01   +3.437432780602480e-01   +6.396970181017525e-02   +1.016089808593598e-01   -2.934362095608282e-01   -1.754634926325913e-01   +2.563365491581151e-01; +3.255876258618289e-01   +4.848515814061731e-01   +1.046994475458123e-01   +4.214795221809566e-02   +1.898758666511767e-01   +1.272834783493726e-01   +4.367030904519007e-01   +1.869290216469974e-01   +4.901161132183804e-02   +1.106327233067284e-01   -2.068088582937423e-02   +3.236408131925231e-01; +3.868304200065936e-01   +8.400500336811384e-02   +4.340229245810884e-02   -3.094002056637971e-02   +1.079083652955778e-01   +4.650697365826580e-01   +3.106036327824704e-01   +6.582655024946595e-02   +4.190992635966981e-01   +1.413969311720267e-01   +7.684050736562971e-02   +8.395843239230502e-02; +1.676670128798307e-01   -1.860720351363616e-02   -1.333413525303258e-01   +8.973828654452769e-02   -1.186142434150375e-01   -1.593895013444751e-01   +4.574745880093952e-01   +3.697379852317241e-02   +5.506638770568660e-01   -2.355823520959277e-01   +2.673621683816853e-01   +2.190927001753758e-01; -1.339566406483435e-02   +9.551014198419286e-02   +2.574968086072857e-01   +4.187146615752836e-01   -5.149675566272667e-02   +1.501216661297294e-01   -4.458623793526570e-01   -2.593066412513315e-01   +2.967388285330915e-01   +2.512722560357359e-01   -1.881790668266771e-01   -2.995745044889928e-01];
L2E_L3E_iAMPA_netcon = [+2.220364564101134e-01   +7.758722644268641e-02   +3.979773766766177e-01   -2.396021656785582e-01   +7.485456488579234e-03   -1.694734377987413e-01   +4.893759392920340e-01   +3.770787692212562e-01; -1.986706107070950e-01   +1.020230644705508e-01   +1.669875023985365e-01   +2.319764745352735e-01   +4.173080957449173e-01   -2.981858142108192e-01   -3.750941539764788e-02   -1.204906981659870e-02; +6.070172236075388e-02   +3.869434651274787e-01   +8.221769761628109e-02   -3.399699676160217e-01   +3.715087921532910e-01   +9.992501364595564e-02   +2.422209615009980e-01   +3.824642665075128e-01; +2.720911110493692e-01   +3.926556292524221e-02   -1.502236224441628e-01   +2.290023155704788e-01   +6.303149340018538e-02   +4.341999067010592e-01   +2.301705481701086e-02   +5.643712759125721e-02; +4.262721260851358e-01   +2.575103768407354e-01   +6.057885229535945e-01   +5.716455715903741e-02   +5.617845901501197e-01   +2.144021368521293e-01   +8.842303252440142e-02   +9.004762199065452e-02; -3.414871615372553e-02   -6.551437044914032e-02   +4.100039961115416e-01   +3.851516206127817e-01   -2.776914699966345e-02   +3.393649870106379e-01   +1.579102131327426e-01   +4.580687509073569e-01; +1.791482890810976e-02   -5.468800024387721e-02   -3.246089933453863e-03   +1.240365559086828e-01   -9.923895972000676e-02   +4.748276202750782e-01   -2.629920148117997e-02   +3.633603392978956e-01; +3.319162848742679e-01   +3.907894049281720e-01   +4.486698424239731e-01   +7.392960806989964e-01   -1.723301622678813e-01   -1.403816742220445e-01   +7.075075352468163e-01   -1.628598586911705e-01; +3.115328804094444e-02   +3.814473892972746e-01   +1.273210659254749e-01   +5.150378577843753e-01   +2.428940671647302e-02   +1.609496211750434e-01   +1.306954825777704e-01   +1.884076950260940e-01; +1.348470249640648e-01   +5.768960232356899e-01   +1.800764410012108e-02   -3.729908512286715e-01   -1.463956922487420e-01   +2.169740110946015e-01   +3.096370917182123e-01   +9.838046722421886e-02; +2.031442820312789e-01   -1.226586470192147e-01   +1.653346413916685e-01   -2.768621621296185e-01   -1.413049669488598e-01   +2.109760725316454e-01   +1.010877083307846e-02   +4.327741099402682e-01; +1.838325150351272e-01   +6.167845892130805e-01   +5.956579303722118e-01   -3.761796260490143e-02   +1.674345852807911e-01   +1.761100661446256e-01   +1.646437449293645e-01   +3.371363313814820e-01];
L2I_L3I_iGABA_netcon = [+4.014386815296684e-01   +5.431232806397084e-01   +4.637025180458826e-02   -1.039677029709168e-01   +3.681704965919816e-01   +4.584192411229019e-01   -5.648415024878738e-02   -2.949814938537026e-01; -1.403140000855229e-01   +2.233011608816977e-02   +3.771601685125864e-01   +1.635767824621472e-01   +4.789979587307246e-01   +1.874033322149102e-01   +1.656123009779116e-01   +4.959835022449073e-01; -5.649387163401118e-02   +1.764332632270973e-01   -1.459243481815113e-01   +1.964122693181549e-01   +2.415710192651117e-01   +2.808102837897732e-01   +5.745827817402094e-01   +4.240650265803608e-02; +2.328310194347949e-02   +4.408271290076565e-04   +2.801040997158590e-01   -9.581679074317630e-02   +1.325668777628616e-01   +1.597495798915100e-01   +1.508121252883776e-01   +2.247996929412064e-01; +1.789854682359172e-02   +2.852859600293406e-01   +6.100510456850654e-02   -1.292749228676875e-02   +1.729252265491186e-01   +1.488116849900786e-01   +3.618840197572312e-01   -3.054173758237536e-01; +1.817224212915660e-01   +1.066754848572898e-01   -6.879384001972738e-02   -1.924833116842745e-01   -1.276580290231866e-03   +3.501653352173653e-01   +1.155918689437582e-01   +5.475959727218520e-01; +3.001835932690906e-01   +3.856533781757919e-01   -2.289671987595671e-02   +1.442563322133679e-01   +9.251935825498037e-02   +3.544585647790681e-02   +3.691677695361422e-02   +3.483131615973904e-03; -1.497620338469737e-01   -3.007396103485500e-02   +3.238352522772154e-01   -3.175473042068863e-01   +6.379369323218586e-01   +2.938477622275948e-01   +3.177488749655981e-01   -7.972052163299466e-02; -2.614804830051753e-01   +2.308483344308109e-01   +3.743457852714458e-01   -7.515688516335500e-02   +2.180642541682075e-01   +5.584104102742261e-01   +5.312473657621903e-01   +1.815760592917863e-01; +1.498010227289458e-01   -3.047589877265249e-01   +6.021970208682516e-02   +2.576841278825905e-01   +3.670662207253972e-01   +5.127250837260077e-01   +3.892634515057072e-03   -7.943155287222438e-02; +4.774361582230666e-01   +2.035541765269565e-01   +3.924531640998516e-01   -1.521904434462486e-01   +2.818180696849691e-01   -3.141709474351384e-01   +4.662488547509593e-01   +6.328712192153723e-01; +2.080549758373528e-01   +6.664405826396426e-02   +5.074980535154059e-01   -2.170167297891125e-01   -2.495135742498663e-01   -7.586469382991824e-02   +1.241608913770921e-01   +3.710547511481323e-01];
L3I_L3E_iAMPA_netcon = [+4.448022173351796e-01   +2.701131902143985e-01   -1.127477428755663e-02   -5.141828879055454e-02   +1.979375666007292e-01   +1.487229103577481e-01   +5.566238594425500e-02   +1.198012163350231e-03   -1.851955774703714e-01   +1.378792271057290e-01   -1.102208187351675e-01   +1.200382046986178e-01; -2.109380280102228e-01   -1.806015541145891e-01   +2.212760000045448e-01   +2.164246529545940e-01   -4.174094698841219e-01   +6.416172681636361e-01   +2.013038890570278e-01   +1.891565139046400e-01   -2.081160845713413e-01   +1.662138924263962e-01   +5.937040083971883e-02   +6.303985779364605e-01; +4.450010495786915e-01   -1.675200185266257e-02   +9.188119639990225e-02   +2.734159156749008e-01   +1.503868327524265e-01   -2.103716494331287e-02   +2.257003601205385e-01   +5.778012389060859e-02   +1.742112057910190e-01   +4.947864811068938e-01   +6.219920231555866e-02   +2.629856620101111e-01; +1.014506609880141e-02   +1.405786604850837e-01   -7.290785176675478e-02   -1.575708262342020e-02   +5.031891249740823e-01   -2.008706571261185e-01   +7.780822351627664e-03   +4.204304485948629e-01   +1.545033979791379e-01   -2.120840028308639e-01   +7.110563139777087e-02   +1.911555075209849e-01; -3.823574903859061e-01   +1.852578584174511e-01   -1.667207064735489e-01   +2.974594523926640e-01   +2.605827161775605e-01   +2.609102059987872e-01   +2.466342954961115e-01   +3.666877625771647e-02   -9.316395194982077e-03   +3.062018542288537e-01   +5.711657693567498e-02   +1.302790943320974e-02; -4.490256579841768e-02   +3.637227887588995e-02   +1.168260245922187e-02   -8.333081888373461e-02   +1.570625027940999e-01   +4.951534161619902e-01   +1.481008888664909e-01   +4.154626077324068e-01   +4.623223650074276e-01   +3.288886738514566e-01   +2.655196719625802e-01   -1.470344576735027e-01; -6.259867483450793e-02   +1.898519866731146e-02   +3.712576227692226e-01   +5.804560946020318e-02   +2.442978836910649e-01   +2.481403425446861e-01   -1.475232676187500e-01   +1.715027203118102e-01   +4.345207297498460e-01   +6.513757435817822e-01   +2.448783909830742e-01   +3.974514669642898e-02; +1.763185197619741e-01   +1.082104045112941e-01   +2.526771406472638e-01   +3.953150144304572e-01   -1.336075079743685e-01   +2.528645339596409e-01   +1.583694097124306e-01   +1.011320178678103e-01   +1.838225083425401e-01   +1.770881887545499e-01   +1.305038922258152e-01   -6.886011310274651e-02; +2.374152385070663e-01   +4.586247864745876e-01   +5.281091018555746e-01   -1.093613528433247e-01   +1.336646298195713e-01   +2.816570992121951e-01   +3.515728908715499e-01   -1.371187674721737e-02   +2.164408832356955e-01   +1.011211469732569e-01   +3.838845098710104e-01   -1.658432968595149e-01; -2.157347014743220e-01   +2.960984198803059e-01   +2.506427333991754e-01   +3.886065710921693e-02   +4.733328219318293e-02   +4.622326409971889e-02   +1.705651537219244e-01   +5.144644155657078e-02   +1.678087194000637e-01   +1.215636819871323e-01   +2.841327558346089e-01   +5.421691498813769e-01; +4.520596840466628e-01   +1.051871690910984e-01   +2.250934437653139e-01   +5.432668944126546e-01   +4.134360214384259e-01   -1.451618922109381e-01   +9.077501653327727e-03   +2.261059097518328e-01   -4.291401957924419e-02   +3.794726716661463e-01   +2.638607483763393e-01   -1.638394719341826e-01; -1.191070019950171e-01   +3.647877527170945e-01   +1.365221194127041e-01   -1.272834050137138e-02   +3.185615572717669e-01   +1.680406475087555e-01   +1.336024232634085e-01   +5.210831196064448e-02   +8.938770523894052e-02   -3.820140135583178e-02   +1.275335900519370e-01   +5.504977279640998e-01];
L3E_L3I_iGABA_netcon = [+1.353049702496681e-01   +2.262577602460729e-01   +9.931856098550462e-02   -5.688183258517238e-02   -6.387906425253199e-02   +5.156821171983003e-01   +1.472618296551154e-01   -1.347527420532783e-01   -3.033051993328388e-01   +2.858309249532162e-01   -1.876892507308702e-01   -2.312424572563938e-01; +2.982637977434260e-01   +4.265893874597499e-01   +4.949966000900867e-02   +2.126660891812260e-01   +1.295608793170782e-01   +2.210333132898175e-01   +6.026118478798955e-01   -1.579379981940945e-02   +1.795756813805338e-03   +2.227175002074697e-01   -8.653531427168371e-02   +1.471555845850529e-01; -1.453849303201276e-01   +1.110476123278131e-01   +3.899825780677728e-02   -1.294544994634025e-02   +4.147633259823513e-01   -3.165016851659664e-01   +2.077280042095815e-01   +2.325370147037316e-01   -9.790555210250952e-02   -5.848924522239105e-02   +4.616143052861508e-02   +5.244303206200491e-01; +4.947877655051225e-01   -1.274257353989952e-01   +3.406216505742966e-01   -1.393087889698728e-01   -1.465709258402532e-01   +3.119113569494889e-01   -1.981698347099635e-01   +2.230454066176146e-01   +2.424857899647979e-01   +7.024993377042771e-02   -7.384899686209312e-02   -4.721592178284168e-02; +4.089564546654700e-02   +2.190082022560116e-01   +3.806655490731766e-01   -5.319825142679209e-02   +4.181837852930388e-01   +2.786815609477614e-01   -1.030418235599962e-01   +1.208420027587547e-01   -1.601225598639447e-01   +2.277333833616013e-01   +2.339226592215740e-01   +4.056004857735763e-01; +2.604063505862462e-01   -4.430177763290769e-02   +1.664785039406475e-01   +1.170612647024443e-01   -3.480180473022682e-02   +4.400078031327313e-02   +2.959057065845546e-01   -5.506752171953156e-02   +3.059214410830033e-01   -1.312094054012783e-01   +2.633111768245366e-01   +2.524725358602241e-01; +3.317835138434508e-01   +4.214654416139458e-01   +9.336863474191538e-02   +5.838397037207349e-01   +3.368158979835937e-01   -6.128754108724405e-03   -1.955902621750272e-01   -7.562567299078463e-02   +2.153395838079898e-01   +5.971206324409768e-01   -6.701626435176702e-02   -9.880078794753197e-02; +5.799915328541674e-01   -1.171651499278048e-01   +3.787093407921632e-04   -1.116249387548860e-01   +2.623005798123395e-01   +2.416000368412643e-01   -9.056558062475466e-02   +2.437311572604239e-01   -2.891647766267044e-01   +1.985287042053188e-01   +2.065275740786918e-02   -1.770348375997098e-01; -1.355907693372502e-01   +3.899557170773362e-01   +4.879645381813270e-01   +1.500583471858451e-01   +5.785550697373290e-01   -1.117000873753924e-01   -4.017015662058326e-02   +1.484394849248505e-03   -2.120906406496968e-02   +4.728191456829906e-01   +5.249576051825190e-02   +1.978977791387123e-01; +1.532252370395270e-01   +2.705554688532897e-01   +2.212917545729601e-01   +3.310751869346620e-01   -4.833751959815460e-02   -6.873826135422287e-02   +1.490279482774574e-01   -8.171669393274783e-02   +2.229921693510534e-01   +7.117627792894923e-02   +3.147263072093260e-01   +2.066412221665360e-01; +4.733542795893445e-01   +2.080408321347789e-01   +2.932709301152600e-01   +5.835902631561842e-01   -3.236167476044913e-01   +2.924525291160769e-01   +1.650593343786045e-01   -2.813992711673178e-01   +5.363342756615758e-02   +1.063289708884358e-01   +1.897452109216596e-01   +1.681003638500830e-01; +2.178792579713477e-02   +3.501074121282824e-01   +2.698768269098717e-01   +4.915656424852771e-02   +3.680958018138036e-01   +6.311850618135411e-01   -1.760351844372314e-01   -1.116101428792143e-01   +1.592521290447290e-01   +4.467314188540605e-02   +3.388088816447031e-01   +1.962168123157722e-01];
L2E_Input1_iAMPA_netcon = [+1.652788716798719e-01   +1.362149872331773e-01   +3.385479679366328e-01   -1.771704429145471e-01   +2.783266223588588e-01   -3.809243587919305e-01   -2.997391191592662e-01   +2.402312776198783e-01];
L2I_Input2_iAMPA_netcon = [-1.227250763577283e-01   +1.597936275336191e-01   -1.444907511364256e-01   +1.787286769654349e-01   +2.049901565513388e-01   +3.701102167989361e-02   +3.021970136434230e-01   +5.696030214937858e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
