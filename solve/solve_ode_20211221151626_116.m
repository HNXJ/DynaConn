function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.734017309044570e-01   -4.582297072867512e-01   -1.183187286560219e-01   -3.521498379675383e-01   +4.658346577675630e-01   +4.355799876120136e-01   -1.245087180607895e-01   +8.008265871802785e-01   +7.084438586870687e-02   -4.517615914036187e-01   +6.092411204816817e-01   -3.082281819260868e-01   +6.179645426024998e-01   +3.654587216390740e-01   +4.320011787837544e-01   -4.204322224397385e-01; +5.704676040106983e-01   -2.868150164961786e-01   -7.696981923250535e-01   -7.541852514910106e-01   -1.188269122491416e-01   -2.365779713701867e-01   -7.773874656612556e-02   +4.800352714891779e-01   +2.013592471747490e-01   -2.949482718670740e-01   +5.741980629350786e-01   -1.081036817786787e-01   +2.758885229747096e-01   +6.104061503169511e-02   -6.383506871079816e-01   -5.278618902670642e-01; -1.118195705151870e-01   +7.271357377992275e-01   +2.056314149030087e-01   -3.163138708537931e-01   -8.118578239806639e-01   -4.263036172738606e-02   -1.820542811829144e-01   +4.061044149391328e-01   -1.162867851168411e-01   -1.808470169768729e-01   -3.002854492492950e-01   +5.071643770764857e-01   +3.294244447093650e-01   +6.347343336643154e-01   -7.065218194393769e-01   -5.844578766438168e-01; -6.020696820986191e-01   -6.686604236574663e-01   +2.453384260713238e-01   -6.106849261179366e-01   -4.431274986549880e-01   -1.556634571407980e-01   -7.339454617518324e-01   +4.783398280793737e-02   -5.569410248873990e-01   +3.206667508266590e-01   +3.167248918931813e-01   -3.622627694078140e-01   -5.457104505205072e-01   -4.928713666008918e-01   +1.159689069871865e-02   -3.457984366198187e-01; +6.059862986342115e-01   +2.013334998256545e-01   +1.522045719328043e-01   +5.585046144058974e-01   +2.115887799239543e-01   +7.462256380935491e-01   +2.013213101838141e-01   +6.461514905158163e-01   +2.488573815271673e-01   +2.578540770245640e-02   +3.300186425528348e-01   -7.355234874027287e-01   +3.771399829457958e-01   +3.183872208932816e-01   +5.522937865569950e-01   -8.830395604592070e-01; -7.171855913406031e-01   -4.658882589763013e-01   +4.726071404498086e-01   -2.582674121822496e-01   -4.004526786186047e-01   -2.941292491670514e-01   +5.487825929579583e-01   -1.252650823841928e-01   -1.000000000000000e+00   -2.098206107157231e-01   -7.549802117679353e-01   +4.849675094224375e-01   +1.987583629980445e-02   +2.303724223658920e-01   +3.393388051020779e-01   -2.402418608195414e-01; -2.845485834356314e-01   -7.205903774731012e-01   -1.687792868385505e-01   +4.123708487241393e-01   +6.147895108954682e-01   +3.003206746390967e-01   +1.954157864557410e-01   +5.495345337960721e-01   +4.775242386029120e-01   -7.093935908105040e-01   +4.303979835112595e-01   -6.124379512365603e-01   +5.681076375638262e-01   -1.796403028498866e-01   -4.531363498043643e-01   +6.636584195588012e-01; +1.703764705725468e-01   -8.117880244661951e-01   +4.246377157461975e-02   +6.690234579654751e-02   -1.025343549296518e-01   -2.074239573725279e-01   -7.810403426899190e-01   -1.287656837337717e-01   -2.352331558401611e-01   -4.963846582398219e-02   +2.923000412304331e-01   -3.082239542156469e-01   +7.829672668204007e-01   -3.193506590305660e-01   +1.056811950777276e-01   -6.414118769472270e-01; +3.929342291114080e-02   +4.711983010930599e-01   -8.019861883081019e-01   -4.528906153350817e-01   -3.075173059481241e-01   +2.325658889729622e-01   +7.318766264999518e-01   -9.112753695011456e-01   +4.543949923153180e-02   +5.097746303349290e-01   -4.591169181480698e-02   +4.877895804239533e-01   +1.276101922060917e-01   -6.645672244749841e-02   +5.956766687478480e-01   -3.493206839613567e-01; -1.461597952445181e-01   +3.075263819569782e-01   +6.126335067940781e-01   +1.182438340448097e-01   -4.337249105375518e-01   -7.985041624023682e-01   +9.554163105755710e-02   +4.368010398045797e-01   -3.996359923957507e-01   -2.078984313435663e-01   +6.233738445520997e-01   -3.623837491319902e-01   -1.939293475197673e-01   +7.117784389547585e-02   -1.860167624485260e-01   +6.659025349068762e-01; +5.430329168915605e-02   -2.960672859666448e-01   -8.728681627671612e-01   +5.203503598632648e-01   -5.416033457523902e-01   -3.183049935572521e-01   +7.955534824544316e-01   +9.369011789429522e-02   +9.922839371909500e-02   +7.323038633429206e-01   -6.160424320858737e-01   -5.143760234308673e-01   -4.247303247028945e-01   -1.857771994830713e-01   +5.211436047808368e-02   +1.054189673877751e-01; -2.736425075133662e-01   +8.771677423522206e-01   +6.584689500072440e-01   +2.950610608505408e-01   +4.777794018364700e-03   +1.767384699571349e-01   +2.297506870273338e-01   -4.099624629298057e-01   +6.137689817598152e-01   -4.892184497621514e-01   +2.201923365855112e-01   +6.600442627985130e-01   +5.941872205690215e-01   -7.026056380863207e-01   -1.184946317298352e-01   -2.905282793622615e-01; -7.290002825912480e-01   -4.685266133935785e-01   +4.530397277344637e-01   -8.684810936251623e-01   +5.118420286817513e-01   -1.932238229591103e-01   +3.574777040768299e-02   -1.353630978623855e-01   +9.822383869028508e-01   +6.310670424655958e-01   -4.882374765197465e-01   +1.776345578391418e-01   +3.049052088724548e-01   +1.583111601095843e-01   -6.034674546358098e-01   -4.140052707577598e-01; -5.512596163932725e-03   -6.826445667173942e-02   +8.857942821277761e-01   +6.237189613391952e-01   -2.535534285926223e-01   +4.283651793492259e-01   -2.270136919388421e-01   -4.572653722488209e-01   -2.129122922269839e-01   +4.799961932054730e-01   +2.125861506950869e-01   -1.571455710671224e-01   -2.080058867430991e-01   +1.609978103864525e-01   -1.764320989385035e-01   -2.120934148012522e-01; -1.616591981810216e-01   +2.016692649410068e-01   -5.190726754391226e-02   -4.252234009543363e-01   -2.069136844102006e-01   -1.958243297265159e-01   +1.399214164970368e-01   -5.412934988633013e-02   +8.356700454861468e-01   -5.482149299591236e-01   +3.701615457550061e-01   -4.861252373545234e-01   -2.359549669817137e-01   +4.154170497770741e-01   +3.124658028106919e-01   +3.707658970919246e-01; -6.787841530454221e-01   -5.445902587265918e-01   +4.672434721917769e-01   +9.316637023166712e-01   +4.443439541510919e-01   +1.075615683299038e-01   -5.106568476795180e-01   -4.691958226090922e-01   -4.053828941073035e-01   +7.141191767126253e-01   +1.872976948343228e-01   -1.797316967272569e-01   -9.620385294072001e-02   +4.300793419666674e-01   +2.967801290141637e-03   -8.322072441362690e-01];
L1E_L1I_iGABA_netcon = [-3.174422834879054e-01   -1.097528184681864e-02   +9.637618996700053e-01   +1.149200007890973e-01   -2.370699675953782e-01   -2.503997058796225e-01   -3.466979449620077e-01   +1.795124400816600e-01   +3.307001261141558e-01   +8.631303310991127e-01   -2.854583302053361e-01   +4.176588957302515e-01   -1.897025120423516e-01   +6.045605334632937e-01   +1.305448553884817e-01   -6.571157094197301e-01; -1.932175543799818e-01   +6.624604007456371e-01   +3.574755771407630e-01   -3.322590995303817e-01   -2.367429904646626e-01   -4.581844062599909e-01   -1.832403551524034e-01   +7.394032247430811e-01   +1.823415510740077e-01   +6.239036338294079e-01   -2.456299791340516e-01   +7.241307406271330e-01   -1.157882493329394e-01   +5.995677592957802e-01   +2.109128543695111e-02   -1.424071036297852e-01; -9.835358206475278e-02   -2.405081889241136e-01   +3.814348419948571e-01   -6.528406559669402e-01   +5.936530733726877e-01   -1.131029544396062e-01   -2.541825727937207e-02   -8.936881572528524e-02   +2.706850487831060e-01   -1.910028590941784e-01   +5.014945830491211e-01   -4.434725668936969e-01   -3.255758030315256e-01   -5.748973635617621e-01   +3.943618767154866e-01   -4.136302321340278e-01; -5.101242746033694e-01   -9.161810054046027e-02   +2.900420337761797e-01   -7.583807580531072e-01   -1.744366946574630e-02   -4.506646194444794e-01   -3.759847720322567e-02   +7.982907454185675e-01   +4.238438903389273e-01   -8.640412047928443e-01   +2.442981932976254e-01   -1.631147280116168e-01   +8.032375807338634e-01   -3.931473128727981e-01   -2.646697197646777e-01   -8.494168945259170e-01; +2.082137316327204e-01   +3.029477186662267e-01   +3.630239789819421e-01   +6.175626026834687e-02   +8.566414889588978e-01   +1.378542785869286e-01   -3.542526825366167e-01   +3.509577515172863e-01   +5.985600177438859e-01   -5.008768076223572e-01   +1.322343001620750e-01   -4.916049820262185e-01   -1.000000000000000e+00   +7.101499505232177e-01   -1.346621827648393e-01   -4.761737432023038e-01; -2.323703494936407e-01   -2.490880336391254e-01   +2.476186789182712e-01   -1.343950874690384e-01   +1.029576977156526e-01   -2.354009175050515e-01   +1.199198333904544e-01   -7.739733108649195e-02   -4.206136517559313e-01   +1.307762686376581e-02   -2.941748551174442e-01   -2.212546256976634e-01   -3.788037187654183e-01   -5.851352948736448e-02   -4.018958074518351e-02   -1.579902724504329e-01; +1.373735639611074e-01   -3.300944997837026e-01   -1.257707839115900e-01   +4.929082367253267e-01   +2.783472626387235e-01   -3.195644100608599e-01   +3.848415363315951e-01   +2.659309126778681e-01   -1.525166203588276e-01   -7.337766888467089e-02   +6.818541577104421e-02   +1.255758553382696e-01   -4.005248026817241e-01   -3.297466605122142e-01   +5.036892555584596e-01   -1.877017690310666e-02; -6.858023971669654e-01   -4.649927217820568e-01   +7.700948760547635e-02   -2.224082666315838e-01   -1.420097995126756e-01   -1.807016990828967e-01   -2.664808428356609e-01   -5.107296903643348e-02   -1.177525329893323e-01   -2.434846136552865e-01   -1.145168276460768e-01   +4.165288884938737e-01   +3.583291767813070e-01   -9.396877252044210e-02   -3.590527603957429e-01   +8.653869804704659e-03; -7.311160052999756e-01   -1.569487979878670e-01   -7.534205197070357e-01   +2.520188659067152e-01   -4.165258549291503e-01   -3.112862026898324e-01   -7.899630655748114e-01   +1.861660838720517e-01   +6.949109533473560e-01   +8.337036607652925e-01   +1.129954360492497e-01   -3.740819246555073e-01   -1.010440130173330e-01   +1.783474986210644e-01   -3.651684230747828e-01   -1.948926608267881e-01; +1.255796322875940e-01   +1.696586742464717e-01   +2.245963482142357e-01   +5.326910503851685e-01   -1.684478106942129e-01   -1.058902587904279e-01   -1.101671691999482e-01   +2.357227656852682e-01   -9.697500683814247e-01   +5.716431872283275e-01   +4.547886827113682e-01   -6.860011775401904e-01   -5.632915038807521e-01   -2.183839116580430e-01   +8.094284878861972e-04   -2.899075014028979e-01; +1.044657887417611e-01   -3.466607882861406e-01   +4.348922592392853e-01   -6.021391302429198e-01   +5.617773357905732e-02   -3.232681022843372e-01   -3.062080824211765e-01   -2.594230551840615e-01   -2.626082373997787e-01   -6.673399412671445e-01   -6.374085204672548e-03   +4.679622463552591e-01   +1.331729986100974e-01   +1.487450391055094e-01   +4.760721401192504e-01   -5.324383833874339e-01; +2.412841451239887e-01   -1.660463236086993e-01   +1.278296132833708e-01   -3.165794392526288e-01   +1.692398212951728e-01   -1.408715802659821e-01   +4.269199668322503e-01   +4.704788092032214e-01   +3.258517340013813e-01   +2.128315884350647e-01   -3.131938707016233e-01   -2.777444845737259e-02   -6.227432654954917e-01   -5.549026901216558e-01   +1.909936455844818e-01   +9.576995986420544e-03; -2.081051044452120e-01   -4.962277433297209e-01   +4.708615275099768e-01   -7.977419897600523e-01   +4.308745987775467e-01   -1.328979816886669e-01   -2.916529521732780e-01   -1.487138887316844e-02   -3.393686314793484e-02   -2.686744920765713e-01   -4.309048735606036e-01   -1.036457845127974e-01   -5.154446834054086e-01   -7.722940360810533e-02   -6.987185568942079e-01   +2.093585346789432e-02; -3.245943642413543e-01   -4.970380415427018e-01   -7.359972434731625e-01   -5.378359877537205e-01   +7.543292901077353e-01   +5.492066547625397e-02   -4.498408263586963e-01   +6.400840747070464e-01   +6.001357575994752e-01   -6.317747104145787e-03   +2.163805157794078e-01   +4.932271244847956e-02   -3.695144321948388e-01   +1.868734732977821e-02   -6.677772827544619e-03   -2.525467935606024e-01; +3.174216510278738e-01   +1.219775697357863e-01   +4.717714328565817e-01   -4.611188932663590e-01   -3.464783550567134e-01   -4.734141942352325e-01   +1.921396930532182e-01   -8.287590702101686e-01   +4.245124112671607e-01   -3.234326690382207e-01   +4.954895566469192e-01   +1.654263117975369e-01   -4.073014596499585e-01   -2.093988479410641e-01   -1.042481231416485e-02   +7.107651941487900e-01; -4.705473263803684e-01   +5.553670891379675e-01   +1.744540800495715e-01   -1.111787528774771e-01   +5.553356361558880e-02   +1.206287699295744e-01   -4.455804991485939e-02   -9.291458525121328e-01   +4.124593422370289e-01   +8.537807772485919e-01   -4.474348375215728e-01   +6.606439895287792e-01   +9.446334356913123e-02   +4.045667704135256e-01   +7.501728907458719e-01   +1.749456231868692e-01];
L2I_L1I_iGABA_netcon = [-7.054551527159048e-01   +1.260440980039664e-01   -1.468099303968908e-02   +2.933096546506414e-01   +2.550726199089642e-01   -8.459866954213139e-01   -4.539136131460030e-01   -1.272382401504451e-01; -3.439938809555230e-01   -4.950379773307744e-01   +5.757617929662889e-04   +4.347121466852443e-01   -7.513689522731207e-01   +3.995294883908948e-01   +5.922746665711247e-01   +3.641450865991365e-01; +3.586612221395444e-01   +1.515146469233491e-01   -8.743851025781967e-02   +3.389315831996038e-01   -2.254661283698641e-01   +7.515257137337054e-01   -6.362515684330928e-01   -4.112577838524608e-01; +5.833557037684057e-01   -4.085097733804061e-01   -6.376441133104546e-01   +2.961914987509667e-01   -5.588534392778551e-01   +8.648248493094376e-01   +2.817200168630453e-01   -6.889416998710878e-01; -6.522979051119538e-01   -5.821873374103340e-01   +2.937276642237746e-01   +6.993622091512305e-01   -3.998368736694660e-01   -6.575625210012402e-01   +4.430669878075851e-01   +8.309697906563027e-02; +4.076240657432652e-01   +1.282218904477489e-01   +2.796795398140222e-01   -2.853282352075657e-01   +4.883212000847338e-02   -4.349517992345253e-01   +2.651595006077561e-01   +5.351013511768316e-01; +1.884920238116157e-01   -9.453820646989473e-02   -1.352205445607420e-02   -1.000000000000000e+00   +1.660253298401833e-01   +2.460483824902730e-01   +1.848475547918442e-01   -1.308202981539973e-01; +5.623189627364782e-01   -3.002100162796133e-01   +1.947622222808611e-01   +3.317709119217591e-01   -6.767389678554314e-01   -2.972291476817205e-01   +1.456970861410566e-01   +5.695785859092786e-01; -2.236445241404208e-01   -6.308603129984074e-01   -9.570345307181473e-01   -6.347063828702627e-02   -3.622335495652703e-02   -7.196503923470862e-01   -1.476223003120268e-01   -3.106579469556263e-01; +2.771037980834172e-03   +3.413898321213615e-02   +1.702005563732234e-01   -7.523791218270719e-01   -1.717984396979788e-01   -1.112273441474049e-01   -5.322149761956572e-01   -5.124639682842771e-01; +5.575674894076658e-01   -2.852113181741242e-01   +3.945614653416618e-01   -2.559532493293779e-01   -5.265283822427082e-02   -6.405014820303188e-01   +8.189744629029409e-02   +3.411092137252901e-01; +1.424633486369286e-02   -1.472445166890362e-01   -3.415625470913007e-01   +3.506036498531900e-01   -7.331410367526066e-01   -7.754166814800435e-01   +1.972588140594769e-01   -6.814719426283078e-01; -5.720269389665728e-01   +8.160347191837630e-01   -4.617675666636754e-01   -1.873682749286122e-01   -4.169566132576989e-01   -2.599839895535053e-01   -4.321697281570411e-01   -2.207776545377400e-01; +7.254508884313993e-01   +5.909912093155055e-01   +7.645341205911678e-02   -1.949725587706212e-01   +4.813633787494567e-01   -4.293312142242099e-01   +8.122166783240158e-01   -4.642707432232652e-01; -6.064219191658977e-01   -7.763545783045860e-01   -1.564033518765384e-02   -6.924629887391327e-01   -4.561552487940043e-01   +7.520905059852065e-02   +4.840849521747035e-01   -2.321064592663541e-02; -1.779420436058808e-01   +8.241728122077735e-01   -2.139327491272188e-01   +8.876643302395774e-02   +5.632350093549010e-01   -6.354582132988094e-02   -1.942113462757082e-01   -1.182718179101917e-01];
L1I_L2I_iGABA_netcon = [+7.013032291366788e-01   -2.973520278553581e-01   +3.400186717795472e-01   +9.579350637099892e-01   -6.588557976416510e-01   +2.948117827567237e-01   +1.785115170879505e-01   +7.159676514074421e-01   +6.176065659413771e-01   +1.781377764668389e-01   +5.537883698463045e-01   +6.289601419499016e-01   -1.401322039863673e-01   +3.659132327449936e-01   +5.809668599517739e-01   +9.634583876630078e-01; +2.047433410426251e-01   +7.061885416733196e-02   +3.688937974217654e-01   -2.108333236258284e-01   +6.749602856082885e-01   -5.572724508725241e-02   -2.520460807826771e-01   +1.156586893969771e-01   -7.121965378016946e-01   +7.051767566082595e-01   -4.148395116285963e-02   +5.833382384526190e-01   -4.929935699197425e-01   +7.010269057515052e-01   -6.454270855436663e-01   +3.664791952903033e-01; -5.218978636931551e-01   +7.540119734314087e-01   +5.566919925934701e-01   -3.453022978141108e-01   -3.514920124249331e-01   -2.445363002474683e-01   -1.841606368118724e-02   +2.028458751238537e-01   -4.891449489693980e-01   -8.009041575763801e-01   +1.000000000000000e+00   -4.245504095704546e-01   +7.503511535427051e-01   -4.304540188119042e-01   -6.139789194131414e-01   +3.280161134967558e-01; -3.620593223438981e-01   +5.192051784135812e-01   -6.671627667396355e-01   -3.818991225916327e-01   -7.318037540888898e-01   +4.639659515007802e-01   -5.143063374252328e-02   -2.927855626339287e-01   +6.754629247442142e-01   +3.263487524157593e-01   -4.172320360969310e-01   -8.842656225652411e-01   -9.616343266635678e-02   -5.147884428745381e-01   -5.044620831543745e-01   +3.216558873518090e-01; -1.386349354011741e-01   -2.732617470792472e-01   +1.046349120769211e-01   +9.515720018151010e-01   -4.003383000504316e-01   +4.191771309621505e-01   -1.088613121981464e-02   -2.466236791133660e-01   +1.455086475184248e-01   +8.806064186154928e-01   -1.179056488424201e-01   -5.262547302648589e-01   +6.626240377312389e-01   -1.946285909556245e-01   +1.748847121919922e-01   -2.350271825610639e-01; -2.664862166427446e-01   -5.754882524267504e-01   -6.334390548678447e-01   -1.486182203636444e-01   -2.348469014175950e-01   +2.747040804601421e-01   +7.127520391989576e-01   +7.549587677289266e-02   -6.380504390190496e-01   -1.955349476754144e-01   +2.173746710969325e-01   -3.050994406302873e-02   +4.603549826043919e-01   +2.685968483378091e-02   -6.472643144802422e-01   +5.919576359109920e-01; +8.315284769620497e-01   +8.633457920634571e-01   -7.760813888096426e-01   +2.555124611480851e-02   +2.000813396303133e-02   +4.140624371457283e-01   -2.424081997795813e-01   +1.881716006177914e-01   -7.934017752925557e-01   +9.483421121525413e-01   +9.381513890948204e-02   +6.904955410317443e-01   +7.118885886144823e-01   -2.828640475027420e-01   -2.858231707015078e-01   +3.087844631859638e-01; +5.696950444993742e-01   -3.679052814045221e-01   -6.993252827380894e-02   -2.413908498562456e-01   -3.695759067568889e-01   +1.233254449016086e-02   +7.209085520367599e-01   -1.054441642084685e-01   -1.779085908409797e-01   -6.164317445239376e-01   +6.534520002383214e-01   +1.896699700269013e-01   -2.187246594874765e-01   +4.045348419813130e-01   -8.361062581895126e-01   +8.338729393091229e-02];
L2E_L1E_iAMPA_netcon = [+2.110508671957075e-01   -1.321911571966985e-01   -3.659477222878370e-01   -4.104978898417878e-02   +2.658887691217530e-01   -7.716926975287939e-01   +4.811057974532331e-01   +3.479750415390657e-02; +7.404747407992007e-02   -4.814155403865216e-01   -5.116374700637493e-01   -8.490999495545284e-01   -2.151393576206696e-01   +6.749423455138508e-02   -3.052337515092043e-01   +5.519282629298099e-01; +2.584584785367440e-01   -3.583288119271373e-01   -5.306062527302690e-01   -7.401525519514943e-03   -3.631901702028922e-01   -3.091133846675034e-01   -8.752174294124547e-03   -8.486849328278366e-02; -3.863481457554201e-01   +3.347988124071858e-01   -3.801991716379370e-02   -2.916860933580094e-01   +4.321831145156319e-01   +1.682471042656912e-01   +4.999000160257060e-01   -5.341741477674072e-01; -4.606484963532501e-01   -4.042508546168485e-01   -1.167792915719336e-01   +2.751375720465842e-01   +9.862341939359687e-01   -7.246325156994979e-01   +1.161541678453343e-01   -5.496510951029089e-01; -4.001955538055866e-01   +1.615915189258011e-01   +2.023730210321017e-01   +1.842381001349940e-01   -4.617760984322289e-01   +7.194945480205786e-01   +7.105291213145533e-01   +8.872087404779792e-01; +7.716152548431026e-01   -1.472838541932430e-01   +1.000000000000000e+00   -3.897836686695842e-01   -1.070386549226905e-01   +6.333015812435283e-01   +6.843099293586707e-01   +6.342840875376632e-01; -1.803353580585771e-01   -6.465269995088494e-01   +3.133377081024414e-01   -3.343225059692700e-01   +1.495313010362590e-01   -4.362831297624837e-01   -1.143312354225948e-01   -5.433109189767258e-01; +2.999066386411928e-01   +3.269749865730227e-01   +6.181818731905064e-01   -3.942034699983969e-01   +5.403938446009741e-01   +7.124758589571382e-01   +5.442445766934716e-01   +9.777104114706633e-01; -6.707576106311573e-02   -1.211804028057512e-02   +2.589321775010337e-01   +7.028257519127334e-01   +1.150884564374712e-01   +1.146160699199635e-01   -1.518766909266825e-01   +6.098980990413033e-01; -2.019063440210309e-01   +9.589172419304199e-01   +1.831675260135950e-01   -2.707246457756436e-01   -2.717805037361404e-01   -1.656250091045923e-01   -2.828044147695949e-01   -7.427968649066065e-01; +8.371381257682886e-02   +2.608752848320021e-01   +8.700419515861995e-01   -8.772434248327500e-01   +1.258172852319190e-01   -8.205393837286179e-01   -2.251508145897192e-01   +1.927278879143995e-01; +3.480650749770512e-01   +3.483923498127155e-01   -5.504346572038402e-02   +5.273418166666272e-01   -4.356214603304465e-01   -7.261522004335281e-01   -3.461326172831683e-01   -1.708519786461612e-01; +9.516323763153098e-02   +6.719403640582636e-01   -7.413089610348016e-01   -3.468841516750711e-01   +5.701321607767194e-01   -3.902833543652916e-01   +3.093777634765676e-01   +2.374351296705347e-01; -7.626530013177354e-01   -5.271991742268295e-01   +4.139314886669264e-01   +4.005609851555567e-01   -3.895769205657640e-01   -2.223227209657965e-02   -2.603658380368741e-01   +8.375501255314480e-01; -1.184177744010284e-01   +7.178884223749373e-01   -4.866461804110833e-01   +9.531278002531305e-01   +2.216808969267737e-01   -1.458937335806654e-01   +5.792461557959063e-01   -4.840131259825253e-02];
L1E_L2E_iAMPA_netcon = [-4.625750577421262e-01   -4.369775168742612e-01   -2.099070985265718e-01   +2.959440166367526e-01   -7.637105714249567e-01   -4.303342811050211e-01   +4.945326985863036e-01   -1.584002798039331e-01   -1.713165051251161e-01   +7.497688851730080e-01   +2.104705424640657e-02   +3.273971634015229e-01   +4.243750346370625e-01   -1.893382552910026e-01   -2.464289179024973e-01   +4.526806816817644e-01; -3.361919820744171e-01   -4.670584899822612e-01   -3.679322710482781e-02   +3.900962142082253e-01   +5.468116536688340e-01   +1.492354713578476e-01   +3.963021005272153e-01   -3.326005509491132e-01   -3.561368863870806e-01   +3.025285147679566e-01   +4.836732334314609e-01   +4.783757575787262e-01   -1.456832894764351e-01   -5.736539954538039e-01   -1.508244670460412e-02   -4.595494569763413e-01; +1.894254375036775e-01   -1.155234121036074e-01   +3.881717746756889e-01   +4.733572558867496e-01   +3.919696530305376e-01   -2.417619638820939e-01   +5.949457563556476e-01   -3.477462240429567e-01   -9.184177944655711e-02   +5.886025880301152e-01   +3.681431043040373e-01   -2.490676400812308e-01   +5.256106316008600e-01   +3.190394338154192e-01   +7.007629090666860e-02   -4.481322476567311e-01; -2.264997790557675e-01   +3.753763856002486e-01   +2.688516068985989e-01   +7.968476132953765e-02   -4.949547210222625e-01   -3.953995705832140e-01   +8.554669148795206e-02   -3.938007004757383e-01   +8.861715454017016e-02   +2.864308083035191e-01   -3.366940182021928e-01   -6.723042473500015e-01   -9.553381750553069e-02   -2.626551623715949e-01   -3.661954554227659e-01   +6.765963776183573e-01; +6.473152437358997e-01   -2.531957856833806e-01   -5.913626554844781e-01   -3.164435896586899e-01   -2.069902883914608e-01   +3.591962686012338e-01   -4.478537314936575e-01   +4.256880999663082e-01   +6.891580269983298e-01   +1.450450223441254e-01   +1.293232312991386e-01   +6.905239975418480e-01   -2.225054720651185e-01   -4.271138170214268e-01   -7.444349527090743e-01   -1.447779606436496e-01; +1.346199439952833e-01   +5.084732171597894e-01   +4.077576833611891e-01   +5.883301285819786e-01   -3.113892274425783e-01   +1.000000000000000e+00   +2.685059201922999e-01   +4.072470878822879e-01   +1.522243746096682e-01   +6.219693491047460e-01   +2.000485963416096e-01   +3.329158293198568e-01   -2.491776033504525e-01   -1.136747699692581e-01   +5.071130624680762e-01   -3.086676503685183e-01; +3.103161610093962e-01   +1.623763869711876e-01   -1.140430500957074e-01   -2.189415992126519e-01   +4.772965452224924e-02   -5.192085018861875e-01   -2.992765555065495e-01   +6.064357571210739e-01   +3.819881683074242e-01   -2.428028899164336e-01   +1.551705692916163e-03   -3.214666306102598e-01   -2.036882837874868e-01   +1.608311521646672e-01   -4.008649860954039e-01   +3.237017205415689e-01; -1.365249397745122e-01   -3.024394619392423e-01   -2.673994118417594e-01   +1.743831349562770e-01   -2.312734767695493e-01   -1.087388185958828e-01   -1.167898015231094e-01   -2.694562749633664e-01   -7.897639169614976e-01   +6.491445409842083e-01   -1.029727328258476e-01   +2.887315254333536e-01   -5.287825034917396e-01   -4.289928296336482e-01   +2.458649595932613e-02   -2.338078455786164e-01];
L2I_L2E_iAMPA_netcon = [+4.257613714965183e-01   -2.345705992503738e-01   -3.157122589414651e-02   -4.104957749885706e-01   -5.082688969678820e-01   -6.163333804273824e-01   -7.271187765498924e-01   -6.895124315238051e-02; +6.198241375188778e-01   -2.661172832220550e-02   -3.780636586369791e-01   +4.662961132917840e-01   -3.378772113949389e-01   -2.293362580263167e-01   +5.654913515968704e-01   +2.158562896290095e-01; -1.235469379575763e-03   +2.327422889485196e-01   -5.894282193213464e-01   -4.249228350931201e-01   +4.834568770312874e-02   -2.705974053400666e-01   +4.299718470541518e-01   +1.041196222562257e-01; +7.094811276404269e-01   -2.760550391025956e-02   +4.155250838530652e-01   -6.853884750299537e-01   -8.233255410104409e-02   -2.013525159935304e-01   +4.217768255709142e-01   -1.661000270303429e-01; -6.182193158565596e-01   +2.591472719630036e-01   -5.449979045140793e-01   -6.704775951833924e-01   -5.604349947175167e-01   +9.233688802950758e-02   +4.514218987068426e-01   +4.185149207623797e-01; -2.960559725703564e-01   +1.078517951724318e-01   -1.000000000000000e+00   +7.428255856872542e-01   -2.752764054870002e-01   -1.143246352099613e-02   -3.450663405243274e-01   -1.290998353830798e-01; +2.855382696323726e-01   +6.903494238078947e-01   +4.704166625739404e-01   -3.289641472877354e-01   +2.840252419040507e-02   +6.857796988877093e-01   -9.500943462214317e-02   -2.555649100643617e-01; -2.973097728404618e-01   +4.328408723376506e-02   +6.626877899331256e-01   -1.426188744659433e-01   +4.937492521130332e-01   +4.893931961637439e-01   +5.252532030332270e-01   -1.694378692763100e-01];
L2E_L2I_iGABA_netcon = [+2.850104586118812e-01   +5.355031578355935e-01   +9.169768550620969e-01   +2.163668924821363e-01   -1.533891926798742e-01   +2.681747962422961e-01   +7.133527494992966e-01   +1.500691740090404e-01; +2.634782352828459e-01   +2.697183252846476e-01   -4.576352520764401e-02   +5.035795483267854e-01   +1.886137969214079e-02   -3.618647411319441e-01   -2.460604599674627e-01   -2.890791811029872e-01; -4.723252548644984e-01   -8.173341916022524e-02   +1.558148941634478e-01   -4.589229930103307e-01   -3.276640890193338e-02   +6.683754918637125e-01   +1.044310593849451e-01   +8.897111313970202e-02; -6.596666061955637e-01   +5.266379490735654e-01   +1.787443220495019e-01   -2.473796077142655e-01   +2.574724042210665e-01   +5.984407403523562e-01   -5.206438051508770e-01   +2.126155553180577e-01; +1.712662838197132e-01   -1.173176751278826e-01   +2.596938625919276e-01   +1.000000000000000e+00   -2.195361009179772e-01   -3.043078156562372e-01   -4.841023176489193e-01   +4.620468719888174e-01; -1.470404097390813e-01   +3.455794069829842e-01   -1.681024794721289e-01   -6.073280542902142e-01   -5.790174714806195e-01   +5.991961566039673e-01   +5.996977489691079e-02   +3.682373452730293e-01; +3.517274541487508e-01   +1.130000460641323e-01   -5.161929704527713e-01   -5.268172408327423e-01   +3.456923299853735e-01   +1.844052245165621e-01   -3.021801753448250e-01   -7.071785097669034e-03; +4.077375293614350e-01   -4.868994852921255e-01   +5.773669708355296e-01   -8.501226152568434e-01   +2.042391504548310e-01   +2.253520326503212e-01   +3.792398212199882e-01   -4.466876823729876e-01];
L3E_L2E_iAMPA_netcon = [+3.651834070356010e-01   +6.994285168852712e-02   -1.484150108483278e-01   +1.963222782062240e-01   -5.832239059874617e-01   -1.056240063590974e-01   +6.347862543915133e-01   +4.561981153752476e-01   -1.397877368669549e-01   -1.086867263618099e-01   -6.397839342131632e-01   -1.000000000000000e+00; +7.346574448129354e-01   +4.856278703584149e-01   +1.189554174941031e-01   +5.014264576997429e-01   +5.117122295927370e-01   +4.500912518718579e-01   +3.627849070020882e-01   -4.244887178157761e-02   +3.217300064664361e-01   +4.496497251309558e-01   -5.563490704475638e-01   +1.405498943031372e-01; +3.395007521678474e-01   -3.603473320533537e-01   -5.980125052552148e-01   -5.213659074565118e-02   +2.339548874981469e-01   +1.709502937775161e-01   +6.998300528912389e-01   -4.047671843779401e-01   +1.374615844553661e-02   +4.074122930562881e-02   +2.898033485523966e-01   -4.441723625891448e-01; +5.648944427698879e-01   -9.535877017389418e-03   +1.745111451831139e-01   -4.592048266966057e-01   +1.494641998820311e-01   -6.547922641678261e-01   +9.443405988821263e-01   -5.038694829951418e-01   +3.510558146585952e-01   +2.865489536282855e-01   +4.343088034991808e-01   +3.087313170009310e-01; +2.119489661551125e-01   +3.665358525513724e-01   +4.114001919015782e-01   -5.792547496353397e-01   +2.192027218541053e-01   +2.486797836925167e-01   +4.090996753993419e-01   -4.324515327869192e-01   +2.576588459879880e-01   +6.474614099531266e-01   +5.580405222731823e-01   -7.082238638413504e-01; +4.792420683313010e-01   -5.187174286986941e-01   -3.608097471640825e-01   -2.669896478947301e-01   +6.018126921560570e-01   -3.550550635857626e-01   +3.077693355668435e-01   +4.484518276611502e-01   +2.748014732553142e-01   +3.962702876274330e-01   +3.914007792945231e-01   -2.591955605187277e-01; -5.774101520970799e-01   +3.548029809503816e-01   +8.868275389309012e-02   -8.031661299375712e-01   +3.481603165879718e-01   +3.228882053376585e-01   -5.181178596113535e-01   -2.857072621712395e-02   -1.278815805843238e-01   +3.306626170037578e-01   +1.799179913502262e-02   -3.199559036006722e-01; -1.947948642451032e-01   +9.654394986275114e-02   -5.114409682163026e-01   -3.629446357913366e-01   +2.724329657079964e-01   +1.714319745750382e-01   -2.252969897292569e-01   -1.036502864702603e-01   -6.736256016645431e-01   +9.133931741297707e-01   -4.432690732027630e-03   -3.458671147037696e-01];
L3I_L2I_iGABA_netcon = [+2.722173695409852e-01   -5.403139068301104e-01   +9.337385848324317e-02   -5.581200627270801e-01   -4.986347314761884e-01   -4.216541791183288e-01   -3.724685494028792e-01   +3.195404840680739e-01   +5.434207294796671e-01   -7.254243579137257e-01   +3.721278377383999e-02   +1.725513591636959e-01; -3.148443047750095e-01   +1.000000000000000e+00   +4.063712358211870e-02   +7.941466087090753e-01   -8.912870138238289e-01   -5.867176494210490e-01   +3.454651628112978e-01   +5.587692087468453e-01   -2.641909789758774e-01   +3.294716476104965e-01   -8.449017417048071e-01   -2.253677371316976e-01; -2.606990686166696e-01   +5.083826409873586e-01   -1.663102768977244e-01   -5.238725275924475e-01   +2.448437892463473e-01   +4.750732519780247e-01   -6.783618732682047e-01   -3.715697307962668e-01   -2.685407970824942e-01   +6.941966757226745e-01   +5.681283945759790e-01   -4.187496650057208e-01; +9.841647974944956e-04   +4.824805833620127e-01   -3.161282858592585e-01   +1.575085607598259e-01   +5.219530358772639e-01   +1.642616957525238e-01   -3.070794619434687e-01   +5.059057944996013e-01   +2.747140261540950e-01   +3.395158147995080e-01   +7.935875702007531e-01   +8.423867396007574e-02; +2.511366132011016e-01   +3.611867109910895e-01   -3.975130989327775e-01   -7.868946507119888e-02   +2.322589622198520e-01   +1.489485480388290e-01   +3.901060958150125e-01   +4.514801067922465e-01   -5.194056836294843e-02   -2.660823796398444e-01   +3.571788898683191e-01   +3.807685130346944e-01; +3.962032484634950e-02   +1.271330134293718e-01   -5.406187329860800e-01   -4.786141302125438e-01   +2.104824153932711e-01   +2.717845386237675e-01   +1.200281141722270e-01   +2.671596858107278e-01   +4.252433972821684e-01   +5.187884914133344e-02   +5.096225379024362e-01   -3.757017505638749e-01; +7.914966366762767e-01   +6.408045857916280e-01   +3.813171807146613e-01   -4.650306192966422e-02   -7.721860125488297e-01   +3.677719522868955e-01   -1.909446324089131e-01   +1.109332857440067e-01   -8.773244039247470e-02   +6.462987409119221e-02   -1.978443477111635e-01   -4.776561189363634e-01; +8.989581781563634e-01   +7.802764802986404e-01   -5.140535663793024e-01   -1.263519894172846e-01   +3.427812028484427e-01   -1.119281474278583e-02   -2.895541866035464e-01   -5.408285024295059e-01   +1.365601344449635e-02   +1.658580225485622e-01   -6.280210279482052e-01   -6.065219560181380e-01];
L2E_L3E_iAMPA_netcon = [+2.068678144244613e-01   -9.834459532783257e-03   -1.430455986875568e-01   -4.186921666800352e-01   +3.551367755449499e-02   -1.671462314778960e-01   -2.174443845005520e-01   -2.271702715019162e-01; -7.122149700680973e-03   -3.320973210143749e-01   +3.696739248779202e-01   +1.878687580782208e-01   -3.820845923238966e-01   -8.001832950873965e-01   +3.904562055513827e-01   -5.406739309746152e-02; +6.604537796234253e-01   -4.494586220436039e-01   -3.024711640684639e-02   -5.404660187480621e-02   -9.088211717591209e-02   -3.953658051584449e-01   +8.867894474610795e-01   +1.144093634543033e-01; +7.144598242926383e-01   +6.020417043352023e-01   -3.981067182181927e-01   +4.790189308255723e-01   +1.916183349062395e-01   +3.109244960436968e-01   +4.206711828228561e-01   +1.032762628808097e-01; -3.170962813287396e-01   -4.477235357675199e-02   +5.355460423276770e-01   +8.577617747327825e-02   +6.920567259221712e-01   +2.385206596093198e-01   -4.527778922270918e-01   +2.774539984097907e-01; -5.155600494706364e-01   +5.117996252921128e-01   +1.770583874952928e-01   +5.485475485302009e-01   -1.000000000000000e+00   -1.545813924764199e-01   -3.778069353618604e-01   +9.173560574308289e-01; +4.071862961392803e-01   -4.575588362189805e-01   -6.868972712140490e-01   -7.109990057321154e-01   +8.790457402505899e-01   -2.587235337527309e-01   +3.260401579654833e-01   -4.767918312384513e-01; +7.224693879951219e-01   +2.339042133100995e-01   +1.519737291516292e-01   -6.369938517749740e-01   -9.180050488562017e-02   +1.388297566418261e-01   +8.284312443726125e-02   -1.335215732617276e-01; -3.359563394741081e-01   -3.391971411856533e-01   -2.156131222590824e-01   +1.092660347707323e-03   -9.391817389206562e-02   +4.829587672356321e-01   -3.363160928463178e-01   -4.600653512900805e-01; -3.870424197958173e-01   +2.742229015851042e-01   -1.393129018639685e-01   +4.748045919497025e-01   +9.169123659234805e-02   +3.459730192671349e-01   -5.184696856362228e-01   +1.571957841331348e-01; -4.687864167910652e-01   -4.173262794394894e-01   -7.104130854514175e-02   +5.373486206698724e-01   +5.670287982628571e-02   +5.653473504994865e-01   -5.750797056375015e-01   +7.097954063313986e-01; +5.959783788066182e-02   +6.575400327712088e-01   -5.663251466109084e-01   -4.188550497652665e-01   -4.750551573858784e-02   -5.395745545132711e-01   -3.192492415097470e-01   +4.453874777769504e-01];
L2I_L3I_iGABA_netcon = [-3.479580122353967e-01   -9.793493610900722e-01   -4.539070957744408e-01   -1.562283304250697e-01   +5.057890044920728e-01   -2.858155907622012e-01   +3.351572464855103e-01   +6.370605633570937e-01; -3.799366753668117e-01   +6.116894391183901e-01   +9.367540111082643e-01   -5.754087333036567e-01   +7.965038674019747e-01   +6.930333856545356e-01   -2.385976458520695e-02   +5.391641894081899e-01; -7.617470937429057e-01   -4.392984039153188e-01   -2.161173757932127e-02   +4.131427336287295e-01   +6.181132889845425e-02   +3.962030004968744e-01   +6.585466208224605e-01   +7.201992866939947e-01; +5.533589153427742e-02   +6.717553101055455e-01   +6.386180388964277e-01   +2.790756361781496e-01   +3.389157372419811e-01   -6.215509668777697e-01   +7.586624642800732e-01   +5.391369787815048e-01; -6.626716841422077e-01   -6.522652028505763e-02   +3.427104160189310e-01   +2.582443973198426e-01   -1.445181132117175e-01   -4.437245831707936e-01   +8.553912327423330e-01   -4.027410442060789e-01; -2.412669951698798e-01   -2.117170331058595e-01   -6.127763940116124e-01   -6.695902322388225e-01   -3.656431879255654e-01   -4.819311621015973e-01   -1.250993709950056e-01   -7.990032491141568e-01; -6.512763223838746e-01   -4.574126064986533e-01   +3.122147279668452e-01   -6.343797378772863e-01   +2.731616445853642e-01   +1.000000000000000e+00   -9.830416332828322e-02   -2.231427568284439e-03; -2.101217251509636e-01   -2.034524901974400e-01   -4.631309957807245e-01   -7.682919948076866e-01   -3.476460473467352e-01   +4.814983691327229e-01   -3.060491673882402e-01   -1.960821808905532e-02; +3.249315847219171e-01   +6.932881000007806e-01   -1.634195388156169e-01   +5.808686053447958e-01   +1.467125545787098e-01   -5.523255621491634e-02   -7.304304665067259e-01   +4.392513583299471e-01; +5.323468196655052e-01   -3.413675268038054e-01   +6.101461775302588e-01   -8.818963144669685e-01   +2.505287977668953e-01   +1.947169193983610e-02   +5.643141263735446e-01   +5.759667130709970e-01; +4.613963383628756e-02   +4.046889621514641e-01   -2.502106018817070e-02   -3.872722799670408e-01   -5.909842994384529e-01   -4.794754659840299e-02   -2.702236233045285e-01   +2.565750045948510e-02; -1.343113450106217e-01   -3.950307764945037e-01   -6.143690911326571e-01   -2.446467440672323e-01   +8.667516651629024e-02   -2.580340839128183e-01   +3.872539022306300e-01   -1.046796011113059e-01];
L3I_L3E_iAMPA_netcon = [+5.200498213360627e-03   -6.769529758884683e-01   -7.195212424440400e-01   -6.260160572529866e-01   -9.109916018440295e-02   -5.509699690325851e-01   +6.621943964436626e-01   +4.927127301521499e-01   +6.635814295759608e-01   -5.292224124716964e-01   -9.224522799728388e-02   -1.787096821676967e-01; -3.680103326589372e-01   +3.828361650272070e-02   -8.034185915147116e-01   +5.202065946483506e-01   -2.121874520575917e-01   +7.936144852285298e-02   -1.539157472215999e-01   +3.473118682992305e-01   -2.104041208713436e-01   +4.462650635398192e-01   -3.279795438709239e-01   -6.375018458085331e-01; +6.338556488129765e-01   -8.407316491921607e-01   -4.314471784749524e-01   +1.860668430437707e-01   -1.247322883861998e-01   +5.749721971204818e-02   -6.254365001348449e-01   -6.172491550854697e-01   +3.708485079587059e-02   +6.583660815334529e-01   +5.589603074028560e-01   +7.036985309631927e-02; -8.027658235225990e-01   +1.862277938020649e-01   -6.722884344787013e-02   -5.031967897855852e-02   +1.171280843489610e-01   -4.627669840402627e-01   +6.226025589591929e-01   +7.030716128505922e-01   -7.796567448312595e-01   -5.182682263591005e-01   +1.440828281787495e-01   -1.841117441541750e-01; +2.181825336106533e-01   +6.555895797163831e-01   -4.118564043685555e-01   +6.983790795586590e-01   -6.738154247542731e-01   -3.986155710773022e-02   +7.012795624843124e-01   +2.232481972441828e-01   +3.154592787153868e-01   +3.425457811100065e-02   -3.383170870945952e-01   -5.529064448835770e-01; -3.272470982664683e-01   +4.651251174038135e-01   -5.630969689743398e-02   +6.787793967699545e-01   -1.101601771074727e-01   +3.008900167411796e-02   +2.092169388834609e-01   -1.579026424078995e-01   -8.862496791554784e-01   +3.652646734754692e-01   +2.510772893653138e-01   +3.686501132353665e-01; -6.538280500767689e-01   +8.382468097056672e-02   -1.331211078008441e-01   -3.194857491570894e-01   -8.325178271280487e-01   -8.522925149667715e-01   +3.717397809574532e-01   +5.089822923790447e-01   +6.000811336048528e-01   -1.746455262454025e-02   -3.064257450981693e-02   +3.755355093177409e-01; -2.795261166954892e-02   -4.538402885537033e-01   +4.911216791894126e-01   +4.089492523907339e-01   +5.566536950256126e-01   +4.450236555136476e-01   -2.863147492404554e-01   -1.091878128199913e-02   +2.549564345130774e-02   -3.583803066226846e-01   +1.455764882806960e-01   -1.815680553050318e-01; -2.606847138120134e-01   -3.820944567998265e-01   +6.408339987933105e-01   -1.863434640378132e-01   +3.355332170593027e-01   -3.070912918190166e-01   -5.016894202045997e-01   -3.663363641178604e-01   +2.688167362193317e-01   +7.391185009876383e-02   -3.150734994445822e-01   +5.462734346317148e-01; +2.207760340255212e-01   -3.433801047412413e-01   +2.250131351219117e-02   +6.541596375509183e-02   +5.246704306718620e-01   +5.980846898385644e-01   +6.041261952096845e-01   +1.028584345697553e-01   +2.798182218110235e-02   -4.051389253013594e-01   -5.642499266870694e-01   -2.821693528270601e-01; -7.219943637244288e-01   -1.767370694482378e-01   +7.642531035837929e-02   +5.706506728797608e-01   -1.580402189271104e-01   -1.243514185121691e-01   -2.538461559472452e-01   -3.711184338770949e-01   -1.929053612425100e-02   -2.133653944404164e-01   -8.103407161970471e-01   -1.379891445351407e-01; -1.454577324582775e-02   +4.724953921491500e-02   -2.724858207456474e-01   -4.107920947591764e-01   +5.473236037914578e-01   -5.850381135739736e-01   +2.949276519310082e-01   +3.272191765401669e-01   -1.000000000000000e+00   +3.170713287618154e-01   -2.602143379049416e-01   -5.476191085572102e-01];
L3E_L3I_iGABA_netcon = [+6.581592111578415e-01   +4.740391562735822e-02   -7.682455487447848e-02   +5.122387463004847e-01   -2.387517600232197e-01   +2.119578823101073e-01   +8.286121533157566e-02   +3.569689269518193e-02   +4.874969115377231e-01   -2.256214431251571e-01   -4.517067493595033e-01   -2.969491963911962e-01; -8.392109701894901e-01   -8.013599614461696e-02   -4.726423375459709e-01   -8.336804655057384e-02   +2.735714801942661e-01   +1.942096923927825e-01   -6.962458146514865e-01   +6.768497880147986e-02   -5.313765850458123e-01   +3.098054151074508e-01   -7.544503980928648e-01   -1.000000000000000e+00; -7.016052793447068e-02   +3.538090375457231e-01   -3.486567867536017e-01   +3.109736765871841e-01   -6.132616839138049e-01   -1.261673527571367e-01   +3.583929194393088e-01   -7.865699036364246e-02   -6.158405094792465e-01   -4.769640564110557e-01   -2.740925143714769e-01   +3.683192728600447e-01; +8.328343714967987e-01   +4.753843672654801e-02   -9.243525997455851e-01   -3.189757470975824e-01   -2.122366829092305e-01   -1.456956649984228e-01   -5.735573706602106e-01   -4.506594965440051e-01   +2.866318884681083e-01   +4.537659022630228e-02   +5.049756030245267e-02   +6.337832727569706e-01; -4.700264986887992e-01   +7.167203579864199e-01   -1.371872467628143e-01   +5.394770615916475e-01   +2.251375005372051e-01   -3.545015628185330e-01   +4.550650392753897e-01   +1.505686541228048e-01   -4.034556562175967e-01   +7.905838655180654e-01   -3.233970347345254e-01   +5.547947685123363e-01; -3.034236519167925e-02   -5.255655746659327e-01   +4.588733215922812e-01   -2.493275050762632e-01   -5.480488891728940e-01   +9.064085102772699e-01   -2.119000202778564e-01   -4.944329722353563e-01   +1.801022946618354e-01   -6.800739604528806e-02   -2.648666194293945e-01   +2.252489544019253e-01; +2.102590855224717e-01   +1.076123346964013e-01   +2.871562389310646e-01   +7.003589870516974e-01   +2.549387549332698e-01   +6.688904709764024e-01   +6.659512936881515e-01   -3.187283915039731e-01   -5.302357984628697e-02   -2.482051112566257e-01   +4.099170545740229e-01   +8.124640288104343e-01; -1.662802511417183e-01   +2.646411321519532e-01   -5.947218295093534e-01   -2.445528059839097e-01   +7.350330044475352e-02   +4.467605880525736e-01   -1.775619310202248e-01   +6.921618650298135e-01   +3.216344358529036e-01   +3.195254526212313e-01   +4.098712488190719e-01   +2.214510163608514e-01; -1.331991052583850e-01   -2.643568113104451e-01   +7.616752696313935e-02   -9.102474908546359e-01   -2.335526105501916e-01   +6.502198345360837e-01   +2.832138860688233e-01   -3.041833704246855e-02   -2.389137003883403e-03   +2.037896795505483e-01   -5.134633630806421e-01   +5.496785086317366e-01; -5.388023258723840e-02   -2.810499926737825e-01   +4.682846227545949e-03   -8.928192283967865e-03   +6.665451451217520e-01   -4.864697188157688e-01   +5.943173325917479e-01   -5.894882422245444e-01   +6.479651033016582e-01   -4.919628836349947e-01   -2.189194384821485e-01   -4.882793825104962e-01; +2.003681289514487e-01   -2.454196734359173e-01   +6.687807325077547e-01   -6.649656988232585e-01   -8.426899674909379e-01   +6.270351270153462e-01   +1.887264676881374e-01   -1.394027697362940e-01   -1.406301332083576e-01   +1.513949645860407e-01   -1.175915919974276e-01   -1.529253504067089e-01; -4.195117716177232e-01   -4.611021379301541e-01   +2.322616949820243e-01   -6.245546472027677e-01   -2.197285664062603e-01   -3.136127449199512e-02   +9.995035261228231e-01   -3.775694703984529e-02   +4.373796093062251e-01   +1.839708010920091e-01   +5.591741069757090e-01   +6.711648608944603e-01];
L2E_Input1_iAMPA_netcon = [+4.474776131928754e-01   -8.454671324241442e-01   -9.532392257415266e-02   -1.000000000000000e+00   -8.240521531270686e-01   +7.461492065486504e-01   +3.481099358318752e-01   +9.422063873447782e-01];
L2I_Input2_iAMPA_netcon = [+3.801953236716263e-01   +8.097604223220496e-01   +3.784052280761047e-01   +9.407708363460474e-01   -8.390207431444320e-01   -6.925434485271262e-01   -1.094980642755649e-01   +7.540744966873194e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
