function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.702494599612467e-01   +4.235112493475807e-01   +6.337273909659956e-01   +1.201905521006537e-01   +4.548324392653877e-01   +8.294658404215539e-01   +7.344276186826038e-01   -1.286408496454227e-01   +4.636365678544967e-02   +1.617095562966501e-01   +5.669661765988963e-01   +5.998922668729834e-01   +3.905175876880801e-01   +3.893017156228974e-01   +7.720893570604225e-01   +4.881978969776065e-01; +4.946449393772466e-01   +2.043595665808398e-01   +4.184560858676725e-01   +3.141366450676749e-01   +4.313103597841116e-01   +1.873724622152486e-01   +3.554361604869369e-01   +6.220778261678157e-01   +7.685827466628099e-02   +7.926476854116422e-01   +4.880570286267460e-01   +6.807340071383715e-01   +8.387049155197656e-01   +2.193531433414181e-01   +7.613196331635657e-01   +4.012442850599293e-01; +1.196692191880206e-01   +3.192794293773552e-01   +6.404781044919171e-01   +8.583130849469434e-01   +8.965453744833943e-01   +2.646115411216210e-01   +1.579700170488672e-01   +4.909736412926737e-01   +1.435458048666023e-01   +8.116819291018718e-02   +5.314079630075846e-01   +8.685212517364208e-01   -1.280507806458907e-01   +1.795779770505501e-01   +6.498729153110088e-01   +1.297064702132163e-01; +5.414260240838588e-01   +8.186775541467461e-01   +6.917798736056854e-01   +8.428852832555203e-01   +1.654744881596925e-01   +5.001371551224310e-01   +9.321626705940252e-01   +4.926543098375308e-01   +8.544711247691139e-01   +3.334797343998854e-01   -3.976983520424712e-02   +6.340664672550611e-01   +5.997600808161472e-01   +7.893787362580995e-01   -1.100333790019192e-01   +4.479652867091591e-01; +2.791945304996353e-01   +7.744344634607128e-01   +2.636883710979210e-01   +4.616047360108839e-01   +3.038182533646256e-01   +1.730451855372108e-01   +3.586598197201569e-01   +4.391175739553379e-01   +8.087930197986870e-01   +3.204596236525711e-01   +5.784700083455901e-01   +5.928729483993542e-01   +1.621118038704536e-01   +6.595824524350316e-01   +4.216383893268297e-01   +2.159104735533235e-01; +9.188198170221588e-01   +8.662366764749687e-01   +5.534286576363370e-01   +2.662794054304356e-01   +2.526774543003552e-01   +6.953753058348270e-01   +8.482111053038903e-01   +2.489758973558029e-01   +1.263479598409302e-01   +6.981702927725401e-01   +3.386168280292129e-01   +7.862060065255921e-01   +5.980290968773164e-01   +5.085223706009396e-01   +9.256881717623735e-01   -6.894037912696588e-02; +6.622862848692148e-01   +6.442775081343535e-01   +6.227241168581201e-01   +4.000194470253172e-01   +6.093444440636830e-01   +3.495966124051606e-01   +5.383203456005160e-01   -4.751875153574796e-02   +1.828094774473019e-01   +1.880219931723724e-01   +4.052951325644304e-01   +4.786089852212749e-01   +8.010268851736626e-01   +4.670310371760528e-01   +7.305097474946677e-01   +1.206569155009378e-01; +5.694607921685194e-01   +5.517604029138787e-01   +7.772232836818556e-02   +2.278423692797797e-01   +3.477797479010921e-01   +2.386151972825557e-01   +6.716514351820930e-01   +3.958217279447483e-01   +8.402269879506603e-02   +2.287224394755836e-01   +4.490811638512429e-01   +3.527571217666574e-01   -5.150474164098589e-02   +6.602333252594188e-01   +3.233076112681782e-01   +1.407188983993866e-01; +7.996376822033873e-01   +3.196301603773669e-01   +7.439091003940235e-01   +1.410964779628166e-01   +6.268169188338339e-01   +5.372935931319228e-01   +3.068535241493546e-02   +2.361213779686013e-01   +5.135782809607740e-01   +2.354775229727846e-01   +3.776679775153253e-01   +6.267561276545175e-01   +6.231233949202939e-01   +7.058835888691203e-01   +4.865849395078635e-01   +6.550642440091216e-01; +1.692943554741341e-01   +6.506420398209923e-01   +4.043187638112049e-01   +4.370085824250767e-01   +6.260948726173708e-01   +9.215596058525807e-01   +6.010354655997900e-01   +4.668316289729291e-01   +2.235570602974380e-01   +7.069536121461945e-02   +3.057815705616260e-01   +4.558085958883152e-01   +2.182693082615050e-01   -5.903500679387028e-02   +3.437587028180658e-01   +3.714124191641293e-01; +2.509321708756203e-01   +1.197954428994472e-01   +3.478754316315382e-01   +4.312532676627383e-01   +6.505292389397749e-01   +7.988602852326894e-01   +8.206148487452224e-01   +3.224180489622222e-01   +8.615451364885212e-01   +2.725760373156288e-01   +5.652872119926008e-01   +5.880866662220291e-01   +1.582504309040552e-01   +1.401204234772810e-01   +6.769927302733395e-01   +2.211932937915772e-01; +4.401836330504541e-01   -2.496109278103683e-02   +2.288260576042201e-01   +3.144209041382959e-01   +1.723873687903298e-01   +7.361798274571840e-01   +3.431742896398990e-01   +8.525523527062111e-01   +7.291957982476284e-01   +7.863289862981780e-01   +4.582735377047492e-01   +7.670653696911424e-01   +4.544433625428945e-01   +2.618678207924765e-01   +6.014962350325921e-01   +7.648248195492008e-01; +7.461074272240715e-03   +1.000611054135791e-01   +7.914606745921301e-01   +2.949391013909280e-01   +5.399891450985699e-02   +6.043656688374156e-01   +6.442658326501786e-01   +6.103152306099464e-01   +8.291945493162801e-01   +9.233862267756412e-01   +2.205348113449642e-01   +6.135190357281970e-01   +6.911062339720057e-01   +5.515147320920073e-01   +9.323100494435332e-01   +2.806476099906957e-01; +4.774816557777826e-02   +8.812471205581811e-01   +5.445874359913211e-01   +1.945402494302536e-01   +3.124971621875652e-01   +6.809106975880437e-01   +6.392474367465164e-01   +7.793407453681801e-01   +1.418436402454293e-01   +7.435934499882817e-01   +7.260416731195041e-01   +3.962995784768505e-01   +7.671340686368217e-01   +6.072820609277446e-01   +1.157240835243145e-01   +8.004054885507206e-01; +3.304897238244260e-03   +3.300632123004548e-01   +7.656472236197845e-01   -1.088735454490053e-02   +1.744995793410773e-01   +3.212373623364770e-01   +8.663088731091576e-01   +6.965242306087485e-01   +6.825957130103361e-02   +1.000000000000000e+00   +2.226602099842580e-01   +2.074579146554242e-01   +3.049781138991964e-01   +1.022767127020663e-01   +5.262466763943924e-01   +5.220638779768646e-01; +4.539105538838991e-01   +7.567562359803732e-01   +7.881102481850112e-01   +6.880786990001927e-01   +7.285799344259648e-01   +4.589743806200076e-01   +2.260983818653723e-01   +5.685244889939099e-01   +5.528038764459300e-01   +7.652756522098157e-01   +1.408968063888730e-01   +5.135902584776583e-01   +4.381545725273758e-01   +8.569365110278968e-01   +6.002467545973855e-01   +7.961928872914456e-01];
L1E_L1I_iGABA_netcon = [+3.901325017418742e-01   +2.319777167508532e-01   +1.575175517363467e-01   +3.640196171574309e-01   +3.128436805086219e-01   +4.335736158066186e-01   +3.290465650390106e-02   +3.888807551279062e-01   +5.855492213035042e-01   +1.922986364352526e-01   +5.995838194809361e-01   +4.826743857078656e-01   +6.971263367104970e-02   +5.658710465684331e-01   +5.714889685502963e-01   +1.916199514775889e-01; +2.608080777301311e-01   +6.081157759781672e-02   +6.908889079577242e-01   +5.047630774827669e-01   +3.207336556229593e-01   +2.386495262833129e-01   +4.994650674158907e-01   +3.678020845760845e-01   +1.400179591042828e-01   +3.590483436145135e-01   +2.458480602218208e-01   +4.210710578522348e-01   -4.284168418214433e-02   -4.311065781892214e-02   +5.305934179230084e-01   +3.233883426907663e-01; +4.964980600977580e-01   +3.250289909797324e-02   +4.735721291089096e-01   +5.813681610269317e-01   +4.833763149706651e-01   +4.557703916236000e-01   +4.635351422240433e-01   +5.186408981015227e-01   +2.085957483847172e-01   +2.336075829794286e-01   +5.070457987522693e-01   +2.994794920780461e-01   +9.354629079869478e-01   +5.544479554866774e-01   -5.836952538519033e-02   +6.052239947817766e-01; +3.135458466627777e-02   +8.143635319122068e-01   +6.074336081318777e-01   +2.961886412097610e-01   +6.552333044860196e-01   +6.220609226085372e-01   +1.212789675271668e-01   +4.761802774870560e-01   +1.465478148926004e-01   +2.620469245230146e-02   +2.052536758419049e-02   +3.135931520852060e-01   +1.157033661545957e-01   +3.518783216435143e-01   +2.290288356979271e-01   +4.331121462871076e-01; +2.145004624551207e-01   +1.354314628840981e-01   +1.980833774626110e-02   +3.956223839381994e-01   +1.005415465814397e-01   +5.603703005095717e-01   -2.553510858422998e-02   +2.093721869552118e-02   +1.716835782527577e-01   +1.222516582839385e-01   +9.147153639068686e-02   +7.616989293081946e-01   +3.453902734523381e-01   -2.296746818087642e-02   +6.035585491463653e-01   +8.987572166397767e-01; +4.375005026413571e-01   +1.352377506111929e-01   +8.187932799740653e-02   +1.964973580073316e-01   +2.125568793272361e-02   +4.867495378976984e-01   +1.839004684296966e-01   +6.865899680313422e-01   +4.655205107169977e-01   +8.481766522306864e-01   +7.386535746063253e-01   +8.128699036819103e-01   +5.149192165637773e-01   +4.576164994901407e-01   +5.776937628843274e-02   +2.733633462151714e-01; +5.599734441959414e-01   +1.454591833537240e-01   +1.915042068587296e-02   +8.749303017175161e-02   +7.803726371834843e-01   +5.033813438217790e-01   +6.238454016042776e-01   +7.110653483213619e-02   +2.674166106842690e-01   +8.053149694386383e-01   +1.622483159041073e-02   +5.767792192816547e-01   +4.333580599510067e-01   +5.359678091907401e-01   +2.706261646282618e-01   +1.780267265109038e-01; +4.006604144049446e-01   +8.927507130995227e-02   +6.445983912599490e-01   +1.000000000000000e+00   +1.781069487386291e-01   +5.259913589569951e-01   +1.207903276560717e-01   +7.176428128543350e-01   +3.790813855742840e-01   +2.660718200230716e-01   +5.451367774022953e-02   +7.511642719705881e-01   +4.624431888440304e-01   +1.160394465517310e-01   -9.856051792164468e-02   +5.831994107247221e-01; +3.366446252472894e-02   +6.896648520556679e-01   +4.854910630591281e-01   -3.383243544057929e-02   +6.758566416761832e-01   +3.008400316177019e-01   +3.821844482675684e-01   +3.969297290915640e-01   +2.550292509224403e-01   +7.703745427637906e-01   -1.293014507756792e-01   +8.292729023549427e-01   +1.268475677051226e-01   +2.319839883629228e-01   +4.996195960315485e-02   +4.260658757048611e-01; +2.696604905537759e-01   +5.268301398023483e-01   -1.129031285559017e-01   +1.323893669588556e-01   +6.375796548361451e-01   -8.547800506262340e-02   +5.481509507257959e-01   +7.563827428746237e-01   +4.343668846288792e-02   +6.200557073830718e-01   +1.429613407605131e-01   +6.923366148216644e-01   +2.030023165581400e-01   +2.796782650872071e-01   +3.615807088742306e-01   +8.065205569065965e-01; +7.619866090354409e-01   +5.215187343721976e-01   +5.649757700058866e-01   +7.621151513975282e-01   +6.896928096481068e-01   +4.916958657002664e-01   +4.260664576514697e-02   -6.705680275391789e-02   +5.186437170882754e-01   -2.253994900098444e-02   +4.706906694806878e-01   +4.695228222612116e-01   +1.611253485347558e-01   +8.997557116113912e-01   -1.218434554940837e-01   +5.206518915856807e-01; +3.760613841378876e-02   +4.997899375262837e-01   +4.014296424242538e-01   +7.530530748452875e-01   +7.602057566025559e-02   +2.479639065809454e-01   +3.417236056404570e-01   +3.821958699042962e-01   +7.612371056062910e-01   +3.536586073452161e-01   +5.295390292139459e-01   +7.222120406729827e-01   +2.256661946465542e-01   +7.496378292767801e-01   +5.395740493288385e-01   +4.824313243278717e-01; -8.191968547483232e-04   +5.581331991689383e-01   -2.549645225938728e-02   +5.398268819957920e-01   +1.092805936048746e-01   +5.301640358949612e-01   +4.951145277100759e-01   +4.324201429773309e-01   +5.253169752251405e-01   +6.352643275140655e-01   +2.699458241633464e-01   +2.974404596774566e-02   +2.879171060849686e-01   +2.091382853768559e-01   +2.135092713932380e-01   +7.624359015056790e-01; +7.466643546008510e-01   +3.167040729477691e-05   +5.491058193112716e-01   +5.858181407659147e-01   +4.246961160835731e-01   -5.422133152646314e-02   +2.590643583170134e-01   +8.786030503179237e-02   +5.250875920822010e-01   +2.002226713758526e-02   +4.049812428089885e-01   +6.565042541677801e-01   +5.063046000341889e-01   +7.500342582982285e-01   +1.181824766847213e-02   +3.160761701596652e-01; +1.921752537131769e-01   +4.111578792675781e-01   -1.881868946874396e-02   +1.337850437141441e-01   +5.545636565979341e-01   +3.318217201478477e-01   +6.823175868077043e-01   +5.958866040125881e-01   +7.614009950539681e-01   +6.984284280769817e-01   +6.766371956052130e-01   +3.534627044860933e-01   +2.757292686653065e-01   +7.731702210240236e-02   +3.608958122171479e-01   +3.125946021261784e-01; +3.924836023331074e-01   +1.684603345220835e-01   +5.480980678186759e-01   +5.551462402593330e-02   +3.991495475700693e-01   +7.024647069082547e-01   +4.169030101049546e-01   +1.504691656720745e-01   +6.661122227371811e-01   +7.594622603467096e-01   +7.076744177963683e-01   +4.653358703546197e-01   +4.982612347014139e-01   +1.857658345178438e-01   +4.488882526837778e-02   +5.637904225311120e-02];
L2I_L1I_iGABA_netcon = [+6.211372793783243e-02   +4.430355504788789e-01   +5.960658653548344e-01   +2.124787723916687e-02   +6.154768259287540e-01   +2.899514652355571e-01   +4.169408438281710e-01   +6.990423034906607e-01; +1.565997418445323e-01   +3.037628722279266e-01   +2.763909789699645e-01   +1.581020574647951e-01   +7.821585494409063e-01   +1.972443687748853e-01   +5.657180415781730e-01   +8.169334486576134e-01; +1.486345698505311e-01   +6.200421581712824e-01   +5.839070233273373e-01   +5.226738003574394e-01   +5.025469688967408e-01   +3.606021443509408e-01   +2.080890821495415e-01   +2.290537839618823e-02; +4.625031394693522e-01   +4.311122538331977e-01   +4.370197350188394e-01   +7.964399070393104e-01   +2.454178141383686e-01   -1.268535326183845e-02   +4.246147231423932e-01   +8.565927933874591e-02; +9.070536765754547e-01   +2.567842269192275e-01   +3.299212939465518e-01   -5.463887643617174e-02   +5.948091677308731e-01   +1.095617518824679e-01   +9.247350298229378e-01   +2.031738358956413e-01; +4.748957565431405e-01   +4.814883238559202e-01   +7.297932953658443e-01   +8.212384490767798e-01   +7.677536781293580e-01   +7.319565603525884e-01   +2.867942242360215e-01   +5.980864036616100e-01; +8.406120617890036e-01   +1.982781822541299e-01   +4.294159882207461e-01   +2.208760343247375e-01   +6.258076964235738e-01   +3.558066380165977e-01   -8.775844781906000e-02   +5.350494968124609e-01; +5.587704430769420e-01   +4.075759068683207e-01   +1.266828958794676e-01   +6.100475599397477e-01   +6.876257050854427e-01   +8.002880192822281e-01   +4.462442127663767e-01   +2.822491521764349e-01; -1.775070994468236e-01   +5.053767543988109e-01   +8.929006064971136e-02   +3.191504717836025e-01   +3.555979653997389e-01   +5.376030973535786e-01   +5.888829502883086e-01   +2.119732855999571e-01; +6.047356391602526e-01   +8.917321259447667e-01   +2.574753260538178e-01   +5.425365078697322e-01   +1.410053821181757e-01   +1.683886556668621e-01   +4.423087590723099e-01   +2.203712617836916e-01; +2.148066229057809e-01   +1.520905779680934e-01   +5.408602802259358e-01   +5.011222345131774e-01   -6.637076556558008e-02   +1.043699049261996e-01   +4.746297858342493e-01   +2.740627989715435e-02; +8.851090023548694e-02   +1.601414911362857e-01   +1.927453986973077e-01   +5.201305917305087e-01   +1.594361475372732e-01   +4.863373880579975e-01   +1.343972243284722e-01   -2.468538902520600e-02; +6.453604956948584e-01   +7.724828451866346e-01   +1.951623503354993e-01   +5.056806450662296e-01   +3.181065701320043e-01   +1.577460264024558e-01   +1.115932016560930e-01   +7.321505848249167e-01; +3.488609319765832e-01   +7.576423060463819e-01   +3.889067350585049e-02   +1.796895254621007e-01   +4.640406814145280e-01   +5.422497922703475e-01   +5.440482467637169e-01   +5.038844148977147e-01; +2.905666333219314e-01   +3.183518622128255e-01   +3.852114819602589e-01   +2.660082942212693e-01   +5.582505984724528e-01   +1.811065772849914e-01   -1.504396963650641e-02   +4.690537742006254e-01; -1.597010568251381e-02   +2.310167804844286e-01   +3.185990247649622e-01   +1.093307111384791e-01   +4.689109984889102e-01   +6.679425434437813e-01   +2.163015447090579e-01   +2.792006227904402e-01];
L1I_L2I_iGABA_netcon = [+9.340832683880555e-02   +6.222582107781370e-01   +2.235166373137557e-01   +1.492798022691631e-01   +8.043963143004156e-01   +7.411780009561534e-01   -1.291259626996611e-01   +2.095691443645461e-01   +4.851178400406254e-02   +6.207710024567099e-01   +5.901124865419153e-01   +4.069888609815470e-01   -1.253237562824352e-01   +2.474593359238011e-01   +5.031864685654394e-03   +7.081996905101030e-01; +7.689169272436187e-01   +4.583729351385925e-01   +4.703151311254757e-01   +2.702832560457415e-01   -2.034332443633464e-03   +2.546454860319757e-01   +4.610905699418151e-01   -3.306894971715232e-02   +2.542318360301629e-01   +2.759671290198800e-01   +4.164862803927769e-01   +1.847046947647211e-01   +5.383911973738515e-01   +5.412941929167356e-01   +1.000000000000000e+00   +7.521276414175944e-02; +3.744105846065840e-01   +4.250939362332987e-01   +8.285310185530416e-01   +3.709462075093467e-01   +1.439730254093766e-01   -3.706754091817940e-02   +7.070139749498950e-01   +4.517740999524215e-01   -1.984055201172440e-01   +6.532792345055729e-01   +1.935833157958066e-01   +3.898222122811909e-01   +7.265975423659335e-01   +6.189928975244866e-01   +1.803912672510059e-01   +1.234905778056909e-01; +6.105088331007954e-01   +4.564521900919994e-01   +4.093419461766805e-01   +3.156959987873137e-01   +6.345804244239941e-01   +4.638132782936721e-01   +4.603331931644535e-01   +1.537495053716822e-01   +4.096523825223631e-01   +2.713568188484160e-01   +2.293883898662208e-01   +2.349661336054809e-01   +2.781427985625733e-01   -2.241575920123272e-01   +2.783469159532949e-02   +4.615276195261009e-01; +6.821574534237139e-01   +4.555051897015847e-01   -9.414313728735323e-02   +8.537787271907096e-01   +6.345583490891913e-01   +3.297504125647836e-01   +5.430757775885207e-01   +1.093515383677540e-01   +7.647839236366368e-01   +4.166678932957582e-01   +6.631449016197832e-01   +8.034745793208679e-01   +7.349313116222745e-01   -1.041029579901380e-01   +5.045416284352627e-01   +6.699142387236685e-01; +3.264415324767237e-01   +1.851892891047355e-01   +7.796332141883179e-01   +1.608453086541838e-01   +2.025820893970091e-01   +4.172674770263803e-01   +4.750460793947384e-01   +6.678212687216171e-01   +5.527553690966482e-01   +4.367087358384093e-01   +7.771550990241700e-01   +6.041501747375418e-01   +5.480130965951222e-01   +7.546100371552802e-02   +2.626364518745237e-01   +7.688383053842647e-01; +2.520465720243834e-01   +1.099043427979540e-01   +1.864850380253248e-01   +6.273766432041672e-01   +4.719640103707226e-01   +4.806017130493344e-01   +2.434178204486716e-01   +3.014291878288414e-01   +1.658755031347193e-01   +2.452499206306746e-01   +3.086975670096921e-01   -6.814506611151820e-02   +5.691015292024395e-01   +4.064072463287847e-01   +6.129218792686727e-01   +1.669804095501332e-01; +4.593948702640139e-01   +6.544182473402731e-01   +5.640787625637251e-01   +2.135764998216035e-01   +4.687801756233857e-01   +2.317870414969985e-01   +5.791839619566536e-02   +5.863242755837982e-01   +5.075257566594900e-01   +3.068083190263576e-01   +1.400704466192456e-01   +7.339550419137912e-01   +3.947485168161876e-01   +6.635516079842344e-01   +3.046766183198301e-01   +3.651505693378273e-01];
L2E_L1E_iAMPA_netcon = [+2.668274724954962e-01   +5.589614326737824e-01   +6.904893761280588e-01   +4.015583015511350e-01   +3.769125949222433e-01   +7.357254265905766e-01   +6.454611664263631e-01   +3.214970514077253e-02; +3.306939925078750e-01   +1.382876826543611e-01   +2.048047575225651e-01   +1.569223701478257e-01   +3.376908220401379e-01   +3.889420481884369e-01   +6.495593271461979e-01   +1.543462981625882e-01; +1.403500562369910e-01   +2.637721564017422e-02   +8.442310554610493e-01   +4.969977951199920e-01   +3.770031451008202e-01   +4.672394800106962e-01   -9.734687690838070e-02   +4.708803692189025e-01; +1.182213657545058e-01   +1.661092906122309e-01   +8.650992947318944e-01   +1.733335799995580e-01   +2.957983620620023e-01   +6.869526002298502e-01   +1.976689390480463e-01   +3.098915535537088e-01; +5.484871364617303e-01   +1.429615620490121e-01   +5.701734529688067e-01   +6.490685952375537e-01   +2.293750286172060e-01   +5.264887916543287e-01   +5.676094254248517e-01   +7.501393535837246e-01; +7.854466849824716e-01   +2.848425787473318e-01   +6.055939451459079e-01   +5.053676568232970e-01   +2.686448861844148e-01   +8.444553576708351e-01   +5.568526011429835e-01   +8.922976130772485e-01; +7.511897354814671e-01   +7.940557786024844e-01   +7.813133142825978e-01   +7.561603113879754e-02   +6.761275292904789e-02   -8.927768801312901e-02   +6.555349114813251e-01   +6.361596547962659e-01; +5.639706987190229e-01   +8.647921392738758e-01   +6.109145062917216e-01   +4.907579145859265e-01   +4.630560299524332e-01   +6.937865571261933e-01   +6.976310067365593e-01   +5.125732806464226e-01; +6.319980268556559e-02   +2.625537024674822e-01   +5.613384765888736e-01   +4.674078909764213e-01   -3.433248727610015e-02   +5.990547066316011e-01   +5.889726325490346e-01   +9.734320900494745e-01; +1.038044035639285e-01   +1.302622994597580e-01   +3.812502220900549e-01   +2.955105566176683e-01   +5.112933841092115e-01   +2.684522562784196e-01   +3.513537253413737e-01   +6.366820744998223e-01; +5.425841278828080e-01   +8.391024046670037e-01   +4.179799057907208e-01   +1.204903990147876e-01   +2.920906668242202e-01   +7.041063883148724e-01   -4.025856068829528e-02   -3.655877604099396e-02; -1.069650302528211e-01   +4.162075559126887e-01   +7.404962101003641e-01   +1.218122699677215e-01   +2.501608760580956e-01   -9.580420900573974e-02   +5.686595804504730e-01   +4.571378467387174e-01; +2.095578349857661e-01   +5.627390258415109e-01   +9.747793014688177e-01   +1.031291446776586e-02   +4.438002194521299e-01   +1.036036481016211e-01   +2.725899968245384e-02   +6.843618021263937e-01; +2.829746048127460e-01   +3.809437141217273e-02   +2.804214485029796e-01   +6.081113137312458e-01   +6.432600394897762e-01   +7.542796983867429e-01   +2.151266189358913e-01   +8.110098980076330e-02; +5.999117165011738e-01   +5.215789215110089e-01   +2.505375414665919e-01   +5.397714197028093e-01   +5.247340156119271e-01   +2.970281900366018e-01   +4.250105912283101e-01   +5.920934791305545e-01; +3.709044059700128e-01   +6.514646491969081e-01   +1.381355306081508e-01   +5.599994545982623e-01   +1.168288708920385e-01   +4.805061636707625e-01   +3.112089477176866e-01   +4.098840734024240e-01];
L1E_L2E_iAMPA_netcon = [+6.108753982118416e-01   +5.089571816662728e-01   +1.199305537411580e-01   +5.683835030117493e-01   +8.322552830696327e-01   +1.341956424282555e-01   +2.863061405751782e-01   +7.521222577994244e-01   +1.023900781526491e-01   +2.884219689509350e-01   +5.150884374354338e-01   +7.729143965979590e-01   +8.662260936997694e-02   +8.179905172506959e-02   +7.453480616071508e-01   +3.461478264199624e-01; +7.110791845659875e-02   +1.606578805589189e-02   +4.544535367614165e-01   +1.914228752918845e-01   +3.058331904754599e-01   +4.288195565910813e-02   +3.115886899943168e-01   +2.006318774353655e-01   +4.939972074504260e-01   +9.181644818507952e-01   +4.881366810342008e-01   +1.030638797807576e-01   +9.297813580285585e-01   +9.002574479683785e-01   +4.943072957860927e-01   +5.506320701678711e-01; +2.516570680230980e-01   +7.097127666954851e-01   +1.714781169104517e-01   +2.279789996473837e-02   +6.327531437590486e-01   +6.911735554387677e-02   +7.838196803029933e-01   +6.939117277648892e-01   +6.742381467445433e-01   +4.617368318674823e-01   +6.190037545876316e-01   +2.073235357347412e-01   +4.150832770478046e-01   +2.876537353901607e-01   +1.466446616137762e-01   +4.812853600766179e-01; +7.013343855975969e-01   +2.041863850311975e-01   +3.964123007549567e-01   +1.958692726939343e-01   +3.403293894150815e-01   +3.582304028301452e-01   -1.159148974535094e-01   +5.351872954133055e-02   +7.168189736596190e-01   +2.422880398229017e-01   +3.658903559997466e-01   +1.292522762584422e-01   +5.292114695670971e-01   +6.675441879976610e-01   +5.008594926720094e-01   +5.538138803352223e-01; +4.181650174580190e-01   +2.073601423489930e-01   +1.797715583944994e-01   +4.705739941106898e-01   +3.575745231097268e-01   +5.150273625853743e-01   +3.474655161801512e-01   +3.939555841489507e-01   +3.671033582572081e-01   +3.816364921032936e-01   +2.448866372587037e-01   -1.092687584373221e-01   -2.145752461503074e-02   +6.305790552554498e-01   -1.492132434740978e-01   +7.227911035514321e-01; +8.925404437764680e-01   +8.903852295321495e-02   +2.211182988099131e-01   +5.602047572194666e-01   +4.017914011138375e-02   +1.159264654121991e-01   +5.951707409148577e-01   +1.311861336485833e-01   +4.156720930253124e-01   +2.194537483625448e-01   +4.041040255919908e-01   +8.212454163838355e-01   -2.095315302325574e-01   +1.722093534338351e-01   +3.472348203576076e-01   +5.684221522819234e-01; +3.275144466165502e-01   +6.548447320041798e-02   +3.006704734130252e-01   +2.258791104846365e-01   +8.711693471879222e-01   +4.783996532329152e-01   +3.942976593691506e-02   +5.844780243178218e-01   +3.500543258023162e-01   +7.303637068244849e-01   +4.671679454087095e-01   +5.626193122080203e-02   +3.226501194610563e-01   +1.475507285324397e-01   +4.853752794935822e-01   +1.984200075435006e-01; +3.417009295409461e-01   +2.908364637652004e-01   +6.474220375954820e-01   +4.430332014546559e-02   +6.430217528479643e-01   +2.109939204454019e-01   +1.888767175816182e-01   -1.139434102589637e-01   +1.384520441504443e-01   +6.550557204195940e-01   +4.375878441270017e-01   +1.023935620741036e-01   +7.858517455766445e-01   +5.679598993549618e-01   +1.776738939704468e-01   +1.296514504918633e-01];
L2I_L2E_iAMPA_netcon = [+4.579861199721671e-01   +7.987951568404651e-01   +3.198948663540007e-01   +6.768945904861475e-01   +8.090731441240639e-01   +6.640998127317935e-01   +6.023814463994035e-01   +2.684149011274500e-01; +9.904891387097013e-01   +1.855441715131122e-02   +5.258421987800066e-01   +1.739344875866154e-01   +7.913785616388460e-01   +4.664674897012763e-01   +4.164303229024716e-01   +7.692678909831101e-01; +9.951171936380528e-01   +3.427834280736853e-01   +7.887037566308255e-01   +4.935465380321211e-01   +2.370215043589368e-01   +6.651972797625083e-01   +1.401723604808648e-01   +7.617155709622019e-01; +3.965297681245532e-01   +8.780023508090808e-01   +3.681912699130799e-01   +2.483684665279897e-01   +5.040664218516752e-01   +5.505360711458869e-02   +5.980498871976347e-02   +4.170121339526647e-01; +4.076461880492681e-01   +4.091456904336169e-01   +5.729867451299343e-01   +1.505065697711841e-02   +7.631495671968260e-01   +9.673136024232598e-02   +1.339717863787219e-01   +5.806576686275666e-01; +2.375570001019644e-01   +2.144530161795755e-01   +5.521733715507082e-01   -1.005786108007407e-01   +5.314452599867626e-01   +6.773128894975634e-01   -3.885833132900394e-02   +3.612139261327384e-01; +3.098312654039601e-01   +1.156468774072794e-01   +5.005625595044780e-01   +4.937696046003400e-01   +1.743135006639353e-01   -2.560773426298614e-01   +3.157307511796674e-01   +5.752492849715182e-01; +3.854472770276725e-01   +5.497144624848733e-01   +6.617524959642841e-02   +7.091712286775680e-01   +6.670670086766683e-02   +7.656338465082265e-01   +3.068122580319424e-01   +6.395696196169111e-01];
L2E_L2I_iGABA_netcon = [+1.227510212730205e-01   +3.766860156308153e-01   -1.282967464693994e-01   +8.366734331840175e-01   +4.805717720749793e-01   +9.021067351158155e-01   +7.430055188665353e-01   +1.859950855211989e-01; +6.201769905814160e-01   +5.376018295093787e-01   +3.915668765746939e-01   +4.354600061065959e-01   +5.601747870921718e-01   +3.395833847533849e-01   +1.417500362115582e-01   +9.596655995433379e-01; +2.988768907840035e-01   +1.736486170643520e-02   +5.449315749449308e-01   +5.479227914196239e-01   +2.283473531845331e-01   +3.178052861328371e-01   +1.699002505017312e-01   +8.367842468815254e-01; -1.420369059984287e-02   +7.181469826706203e-01   -3.293517142410701e-02   +7.422645846646151e-01   +3.560178635829580e-01   +4.819812517307436e-01   +8.505592746901908e-01   +8.883070471662614e-01; +3.970242863104139e-01   +4.697721280291879e-01   +2.665999807854927e-01   +2.764180516249814e-01   +1.522000133498725e-01   +6.610704531722363e-01   +9.209138114828394e-02   +2.339969049146027e-02; +7.139274026695964e-01   +8.216251211223872e-01   +9.789228137263318e-01   +1.000000000000000e+00   +7.545619814729803e-01   +4.986411497052355e-01   +3.239683694821754e-01   +4.699065074555316e-01; +1.418147244322411e-01   +2.766783169372491e-01   +2.582982209994579e-01   -1.096854957484857e-01   +2.514217787354133e-01   -1.120997614252582e-01   +2.118038692615483e-01   +6.898900628271727e-01; +7.548811955068685e-02   +6.463164573686311e-01   +6.786061497110445e-01   +2.067592177908202e-01   +4.200686638109569e-01   +5.410796452680460e-01   +5.013917164786424e-01   +8.219242547492241e-01];
L3E_L2E_iAMPA_netcon = [+3.477045694710036e-01   +5.821351015890728e-01   +4.881233377482541e-01   +1.148369746158636e-01   -5.080846645622959e-02   +8.403730041633969e-01   +8.552689288417222e-01   +7.523507789836217e-01   +6.187437609124115e-01   +7.039743577784956e-02   +2.848553441240750e-01   +1.843574190513561e-01; -3.847724280232432e-02   +8.857804917861308e-01   +9.305268353191228e-02   +9.304429916774035e-02   +3.918827779525538e-01   -2.604595322480278e-01   +4.550441708917402e-01   +1.600881165864417e-01   +3.522672675195392e-01   +5.055315606149368e-01   -1.384214821259118e-02   +1.769488278877845e-01; +2.491952928049809e-01   +2.590132108711796e-01   +3.530298798673863e-01   +5.800674722458047e-01   +3.534706608942135e-01   +7.669249252770129e-01   +6.903989408591533e-01   +7.781055291696166e-01   +2.298419725766473e-03   +7.053373321179329e-01   +5.206966569583487e-01   +7.077811327853351e-01; +6.706456304082390e-01   +4.175508710763606e-01   +7.058927447288533e-01   +5.011376896527134e-01   +3.715961693357880e-01   +1.000000000000000e+00   +3.769009507055734e-01   +2.028022142743430e-01   +6.144453443201692e-01   -2.072939804155925e-01   +2.652463525903898e-01   +7.657386601201047e-01; +6.685277640535721e-01   +3.320333265650051e-01   +4.186044096068524e-01   +5.197565696840951e-01   +5.535181880404327e-02   +4.484685282411146e-01   +3.948912229178809e-01   +6.334365623499966e-01   +9.166519132178509e-01   +2.975263601009178e-01   +6.854329036622345e-01   +2.465164204503075e-01; +2.901141026337402e-01   +2.168062833991018e-01   +4.686801680379276e-01   -1.801331521241449e-02   +1.379124645607270e-01   +4.260177798024758e-01   +4.585685806979664e-01   +7.231516887185330e-01   +5.217140813145439e-01   +4.088229375637649e-01   +4.892701690270497e-01   -1.528642610587560e-01; -2.342699363109498e-03   +1.475391242284575e-01   +2.927362643818760e-01   +3.825263569113332e-01   +9.543803255167960e-01   +6.539196713832810e-01   +6.483181435968616e-01   +3.078657828904907e-01   +4.559604707420685e-01   +2.869831818814557e-01   +2.871476447753952e-01   +4.358611105869304e-01; +2.026732778471809e-01   -1.390343663157796e-01   +6.031330913741846e-01   +7.865836210355306e-01   +4.732826315683921e-01   +7.083696494053336e-01   +6.782925007281860e-01   +2.429778140772626e-01   +5.894605602888006e-01   +2.027285211054518e-01   +5.422556648397689e-02   +3.656572803060527e-01];
L3I_L2I_iGABA_netcon = [+8.524356290212629e-01   -3.676008863669977e-02   +4.620868540828673e-01   +7.625705136681526e-01   +3.597194411724197e-01   -8.851739279477738e-02   +2.059030487810272e-01   +3.156930926326720e-01   +3.195654093490136e-01   -2.771857997332852e-02   +2.356526768805650e-01   +9.479120465312479e-01; +8.496855509995831e-01   -1.365288290764577e-01   +1.786394870830856e-01   +6.601293801222107e-01   +8.175147496762047e-01   +3.560921546945923e-01   +5.128615499690661e-01   +4.574087995170718e-01   +2.412588554907323e-01   +6.147321530183808e-01   +1.880261661231270e-01   +3.918422658167834e-01; +8.343136063281715e-01   +2.220151478489414e-01   +7.223921523478666e-01   -1.683208311228046e-01   +6.871455892451145e-01   +1.911195466733603e-01   +5.909341622698228e-01   +1.309079419707447e-01   +3.233813030029712e-01   +5.109948213989366e-01   +3.460394766689949e-01   +9.358463745962377e-01; +4.883388872073683e-01   +3.262099436748716e-01   +9.082841795024441e-01   +9.669374767178213e-01   +6.511390047317159e-01   -3.484285058436226e-02   +7.693499359196680e-01   +1.599883722931359e-01   +8.993690571281809e-01   +6.277925039244059e-02   +1.575609485755711e-01   +6.215980365669773e-01; +2.569828164431734e-01   +2.609985100983204e-01   +6.198188176731159e-01   +3.468778807572725e-01   +6.534145202068548e-01   +8.264482447691062e-01   +3.770117405224680e-01   +8.042664564137540e-02   -5.302643653668843e-02   +2.252729317837274e-01   +9.976679654276147e-01   +1.137307720021268e-01; +9.349401502947332e-01   +3.017405148166710e-01   +6.395529414767835e-01   +9.566420126082527e-01   +6.599433470795363e-01   +2.317845183371640e-01   +4.112808320002967e-01   +1.205824087024487e-01   +4.028786223442681e-01   +5.269738458937547e-02   +1.663341955615971e-01   +2.531528633646583e-01; +5.856320265041222e-01   +6.009255875542878e-01   +7.706438437828361e-01   +3.770917493176180e-01   +2.695990609763093e-01   +7.003364679283511e-01   +4.696846121498280e-01   +6.519305284439788e-01   -3.238753859201115e-02   +1.000000000000000e+00   +2.742052265089087e-01   +8.206199483578237e-01; -6.699262903958718e-02   +2.987762141159695e-01   +6.192122110809789e-01   +6.412737084369990e-01   +1.441446611341208e-01   +2.117652687124540e-01   +1.286997819197337e-01   -4.732202595261126e-02   +6.506647456149706e-01   +5.351128251009689e-01   +2.982500486562070e-01   +1.485092338652491e-01];
L2E_L3E_iAMPA_netcon = [+3.109996243675417e-01   +9.993390521880701e-01   +4.218117782158780e-01   +6.836646191805398e-01   +3.217622374519247e-01   -1.010494267071226e-01   -2.926913945686664e-02   +3.254362383094099e-01; +4.139376316162535e-01   +3.947139520754456e-01   +5.470499034582516e-01   +2.714381573176448e-01   -5.151215025631144e-02   +1.985959339105593e-01   +6.576317043430479e-01   +5.793171947022759e-01; +9.886145502014633e-02   +1.478921423591568e-01   +1.000000000000000e+00   +9.420327246415284e-01   +5.172200998845542e-01   +2.276351929051418e-01   +4.045191438224071e-01   +6.290898529654164e-01; +3.075252759322690e-01   +3.389686005458906e-01   +1.908235250078259e-01   +4.897308319530327e-01   +3.559985855345095e-01   +6.428856410338817e-01   +6.198555592807814e-01   +8.725264356022018e-02; +3.374076402401535e-01   +7.098335332615896e-01   +6.467024573655820e-01   +8.615268291697885e-01   +6.624562496951424e-01   +6.657444640951719e-02   +9.165317771103851e-02   +9.421080860965869e-01; +9.323410420111116e-01   +6.694269718526665e-01   +3.444635381668765e-01   +1.228351980473791e-01   +4.344753161170909e-01   +7.279641629348497e-01   +4.763857452440982e-01   +7.902352881002337e-01; +6.150756089840403e-02   +4.828616681785380e-01   +2.481347240858003e-01   -1.362104110937433e-01   +2.401497070475576e-01   +4.176530676957740e-01   +2.710166065247964e-01   +2.165879480511662e-01; +4.992443239159375e-01   +6.423311754380338e-02   +9.287429829056536e-01   +1.605809943627475e-01   +1.558542786294072e-01   +3.230733066336804e-01   +2.076085961956456e-01   -6.196927814103743e-02; +4.202765244974412e-01   +7.995203937999864e-01   +5.505098486417899e-01   -1.509780848403151e-01   +3.684913116680005e-01   +5.596627294800754e-02   +4.823032629278934e-01   +6.682565273454526e-01; +3.840380113680676e-01   +6.473776440172307e-01   +3.759840767480863e-01   +5.062858041621550e-01   +6.491891226223279e-01   +4.854204079283217e-01   +6.538613951541000e-01   +3.853528051516011e-01; +5.809967664472796e-01   +2.663137986422760e-01   +6.865506891332560e-01   +2.185956224472624e-01   -1.153081213676015e-01   +1.515566211577574e-01   +7.395502858309408e-01   +5.691898978618097e-01; +6.448219173781504e-01   +4.045484978264560e-01   +5.315777151912097e-01   +7.090654790060718e-01   +3.412593067801716e-01   +5.767959059032940e-01   +3.643485596110785e-01   +5.141330351284858e-01];
L2I_L3I_iGABA_netcon = [+2.404316355854743e-01   +2.212911733510795e-01   +7.779431930287848e-01   +1.997925870115503e-01   +1.150626489078715e-01   +4.148448079314057e-01   -1.265793267356560e-01   +4.823828384789982e-01; +1.795589516029042e-01   +9.511563901269561e-02   +6.176681365306117e-01   +5.895265584327646e-01   +3.566673777247443e-01   +2.984991897477049e-01   +7.433326606876611e-01   +3.953622344653855e-01; +2.836079130432378e-01   +6.630169377987992e-01   +1.422904692874156e-01   +2.604230684627379e-01   +9.727549186757274e-02   +8.011462734856654e-01   +2.824843539459991e-01   +4.873674980417084e-01; +5.153153012290330e-01   +2.611270771474884e-01   -5.386947506879096e-02   +3.453535454222956e-01   +5.048872917753056e-01   +2.199006084994806e-01   +3.191189044101442e-01   +8.983156640780508e-02; +5.423422834981052e-01   +3.443985992252671e-01   +4.508265182182875e-01   +6.924604155856656e-01   +1.535861284540716e-01   +4.099871404839831e-01   +3.421189209615618e-02   +1.908342651114603e-01; -2.653577469958400e-01   +9.747466842593219e-02   +4.286836586278194e-01   +7.216475257887730e-01   +6.488653376554545e-01   +6.490665665647233e-01   +6.575354608864603e-01   +1.530169750432897e-01; +2.963622450232306e-01   +2.127389631742892e-01   +3.331026506754508e-01   +5.071477037115190e-01   +1.272017640333820e-01   +7.820217990095811e-01   +7.465158371617944e-01   +1.000000000000000e+00; +3.647093527846708e-01   +5.228750064635301e-01   +2.541430088082419e-01   +1.780647724367317e-01   -1.145873403231058e-01   +1.574834657527152e-01   +1.992261106919894e-01   +2.712486114169830e-01; +1.574986728091811e-01   +2.767172645670095e-01   +1.096549652183100e-01   -1.623354594118555e-01   +5.503708050735809e-01   +1.283485227166785e-01   +1.309535663302691e-01   +2.354319264225818e-01; +2.449587119435992e-01   -1.117792782073104e-01   +5.369836535688591e-01   +5.248557464566274e-01   +6.446680194495581e-01   +6.119482139693875e-01   +7.463872587732540e-01   +1.529394046007526e-01; +4.413437079793039e-01   +2.928717742859234e-01   +7.035195313334796e-01   +7.832145345401041e-02   +7.150226192797909e-01   +3.433832977849558e-01   +7.386161172820294e-01   +2.251263483950295e-01; +6.543500720996384e-01   +1.722979800837811e-01   +2.809983991685617e-01   +6.512089530576456e-02   +5.467394051432418e-01   +6.838660711698210e-01   +3.809859310976509e-01   +8.694541462983271e-02];
L3I_L3E_iAMPA_netcon = [+4.118003457014313e-01   +3.796946792201546e-02   +3.571801791375726e-01   +9.985764328413271e-01   +1.000000000000000e+00   +1.463895417674395e-01   +3.629003226608973e-01   +1.762521422824161e-01   -7.601181512891445e-02   +1.562268298514440e-01   +4.344295749246433e-01   -2.806652582561237e-01; +3.806867665276642e-01   +5.617964650455057e-01   +3.639190394999217e-01   +4.897715688189714e-01   +2.559133435848767e-01   +1.099192903687469e-01   +2.955631843042606e-01   +1.833196703515889e-01   +1.683872525550778e-01   +5.384960719596531e-01   +3.903397865511840e-01   +7.057343570686526e-01; +2.277701852016856e-02   +9.514332785174101e-01   +6.051394057275095e-01   +4.286750602623475e-01   +6.242910762851377e-01   +2.317168771618303e-01   +3.726732499458041e-01   +5.338673733135652e-01   +2.979114752800411e-01   -1.296382316643293e-02   +8.126064394014424e-01   +2.874711296391964e-01; +6.204211193872160e-01   -1.524212900188342e-01   +6.285761928957132e-01   +2.212801923254023e-01   +8.194152729078000e-01   +2.286803659334578e-01   +1.932226958429717e-01   +4.091749036777347e-01   +4.904355283311621e-01   +3.736245069370078e-01   +4.421037187246179e-01   +1.007130833464690e-01; +4.327196319115180e-02   +8.139079389570486e-01   +9.010549129895463e-02   +2.882006943459731e-01   +6.620164760443324e-01   +1.949992716393282e-01   +8.782506825441448e-02   +1.694284377500790e-01   +7.147480175953670e-01   +1.138228354794644e-01   +5.116711666986794e-01   +7.996281421425237e-02; +2.058494901397500e-01   +2.836345430396566e-01   +7.956972393136941e-01   +2.295934754055140e-01   +2.735974352707756e-01   +5.560938456893004e-01   +2.138694485298264e-01   +2.792515058213484e-01   +6.097095955626682e-01   -1.131684760484851e-01   +2.743890149781677e-01   +7.369794078550039e-01; +4.668646130576241e-02   +7.724071778211239e-01   +4.242294531512399e-02   +4.567706915493894e-01   +4.357907211051277e-01   +5.881361215445455e-01   +5.383080853018383e-01   +2.153608797847804e-01   +5.777297468377595e-01   +9.194436225114525e-01   +1.988439401569449e-01   +7.708683698508887e-01; +1.160397252996930e-01   +5.487890750896053e-01   +7.167132706670331e-01   +4.392618002121214e-01   +9.144141164092930e-01   -4.799703335190499e-02   +9.888041610536070e-01   +2.567799346707906e-01   +7.829887380230094e-01   +5.237668781655749e-01   +7.798600867016220e-01   +4.696378131781694e-01; +7.364064882892029e-01   -2.863010138150777e-02   -4.111978150387367e-02   +6.256589019832475e-01   +8.576271632962053e-01   +4.825763435652455e-02   +1.171144894756820e-01   +4.409928336739490e-01   +4.292674315361258e-01   +9.237940191535426e-01   +4.792634152648357e-01   +3.242028538757237e-01; +6.839477885854912e-01   +5.947978912245138e-01   +4.655672878655588e-01   +4.155855208464014e-01   +2.793302514137990e-01   +1.087562232662414e-01   +9.110108424426364e-01   +6.976453875954273e-01   +4.577520216287589e-01   +1.869791664580969e-01   +1.774555007131813e-01   +5.525945326652452e-01; +1.925221481553117e-01   +5.357854234062711e-01   +1.465582076771925e-01   +5.088116750179793e-01   +6.909755916797399e-01   +1.916288079255420e-01   +6.691510770021467e-01   +8.697185325845163e-01   +1.372043949524937e-01   +6.527056005402855e-01   -7.196084190260407e-02   +8.991641188343823e-01; +5.053323468348118e-01   -1.476586904220852e-01   +4.046283970947473e-01   +8.665956537552580e-01   +8.810973870324093e-01   +3.857838493486418e-01   +1.835269614135011e-01   +4.049638396447420e-01   +8.457271204672733e-01   +6.337518284908996e-01   +2.603194196054932e-01   +4.646349532173805e-01];
L3E_L3I_iGABA_netcon = [+9.014021072159152e-02   +5.302767619940176e-01   +4.092533887094842e-01   +5.856357502504249e-01   +7.647197556394398e-01   +5.352080656463362e-01   +6.826383349632872e-01   +8.568141692509477e-01   +8.501320010557529e-01   +2.628811594322027e-01   +3.018263363760005e-01   +4.377837849237775e-01; +5.191832395590646e-01   +6.564301705209685e-01   +6.550270587650681e-01   +7.947223991915449e-01   +3.535095814922870e-01   +6.785868544474175e-02   +5.874097645866505e-01   +6.699166639582584e-01   +8.117964886333298e-01   +6.150958945008190e-01   +3.286552188353326e-01   +4.024367498701794e-01; +3.678731247220623e-01   +9.672848470528641e-01   +1.726181668668593e-01   +8.852517966550678e-01   +1.702239609217186e-01   +5.115918754086721e-01   +5.313487307799677e-02   +4.533903156979557e-01   +1.520540558332911e-01   +1.728088327381924e-01   +1.087338436219935e-01   +5.138795847503395e-02; +2.483881105054986e-01   +1.012274392378343e-01   +7.381247852353158e-01   +6.362781585482781e-02   +2.363868050511997e-01   +9.116649430662999e-02   +8.445310762684873e-01   +4.846475767133802e-01   +6.026192409513343e-01   +3.564305570253950e-01   +1.044295377732319e-01   +2.739759447205257e-01; +8.535224222659920e-01   +6.743544906925040e-01   +7.941493062561988e-01   +3.711517874895329e-01   +5.581408851353996e-01   +5.455980610852771e-01   +5.640518872542950e-01   +9.570052304328089e-01   +8.185249585382971e-02   +7.926870213391717e-01   +5.211181396590715e-01   +4.678161649494371e-01; +8.198974581598411e-01   +7.556654397843147e-01   +3.811783393105933e-01   +5.221144179174854e-01   +4.646888800776708e-01   +7.141480907449953e-01   +2.793177669312111e-01   +8.068804314037538e-01   +1.890529386641329e-01   +4.755846915279538e-01   +2.285865559813452e-02   +2.598878873655998e-01; +6.037220688683401e-01   +5.568147041609937e-01   +1.122338292058362e-01   +9.009730093395951e-01   +3.661856711188971e-01   +3.402338037249195e-01   +4.281728980868251e-01   +3.341664238111656e-01   +2.606528506360555e-01   +3.463820469587767e-01   +1.000000000000000e+00   +6.599580275053576e-01; +7.225809903710501e-01   +2.399044047514501e-01   +3.772885685914397e-01   +5.636257582342541e-01   +8.492962977758749e-01   +3.463485645842387e-01   +2.706957759803186e-01   +3.308864635781479e-01   +3.088875624877894e-01   +7.067286155268083e-01   +1.744393370623932e-01   +4.357150848401825e-01; +2.319669910082247e-01   +3.477014830601555e-01   +6.238370329531659e-01   +6.737285916009554e-01   +1.965081865190151e-01   +5.601558986215073e-01   +7.968029288132092e-02   +6.330443338548920e-01   +2.339845391233785e-01   +8.495979181471898e-02   +8.940641165764676e-01   +3.111450860896491e-02; +3.393991951713896e-01   +5.793393525638424e-01   +4.223164070665792e-01   +3.348207108195354e-01   +1.252303270026345e-01   +6.647822841726838e-01   +2.321477014679257e-02   +6.938954772325613e-01   +1.961558335689567e-01   +3.922575557609524e-01   -1.127337136973710e-01   +1.096110225542225e-01; +8.171295763018711e-01   +1.729592464734236e-01   +7.089023709682470e-01   +2.254518368791787e-01   -3.659565604829902e-02   +2.829071275655002e-01   +5.470715535238234e-01   +1.892049409282556e-01   +2.952183509572684e-01   +6.206901200791837e-02   +5.008559039845347e-01   +5.199960290642719e-01; -2.529910811433916e-02   +3.973853903910148e-01   +7.700228638134557e-01   +6.176977670643234e-02   +2.183543961848531e-01   +4.755576423592849e-01   +7.574800104801162e-01   +5.934550087526107e-01   +7.130374417531059e-02   +2.478629145702627e-01   +1.439181253776488e-01   +4.335646518908148e-01];
L2E_Input1_iAMPA_netcon = [+8.845597648481538e-01   +8.462136151091021e-01   +6.488474523506104e-01   +9.064092754785970e-01   +8.725809920305736e-01   +8.883541396455701e-01   +1.000000000000000e+00   +8.939752062715948e-01];
L2I_Input2_iAMPA_netcon = [+8.641365334346990e-01   +8.372949801418539e-01   +7.770992920543067e-01   +8.800302978670642e-01   +6.681677149772846e-01   +6.636767331058407e-01   +8.037509808134534e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
