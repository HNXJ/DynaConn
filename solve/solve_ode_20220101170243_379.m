function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.187173250064526e-02   +1.127781505173069e-01   +4.883675538425284e-01   -1.677066928394882e-01   +2.102823083487677e-01   +4.883440600386807e-01   +6.223771623536785e-01   +4.718635634582919e-01   +1.021869900946459e-01   +2.132287281404912e-01   -1.046190653354043e-01   +2.443603358092309e-01   +1.302940150427684e-01   +3.089916330340365e-01   +7.271533330913525e-01   +7.423597337728938e-01; +8.979787948921791e-03   +3.676131623934855e-01   +3.092847977622367e-01   +2.271594602396829e-01   +5.508642222570094e-01   +4.760833494410376e-01   +1.202650996131485e-01   +4.478799595327720e-02   +6.296489659817708e-01   +1.978718324648485e-01   +5.774356083994223e-01   -7.957607667511683e-02   +2.431094895118399e-01   +2.430515554226119e-01   +2.517033806320613e-01   +1.453344165156584e-01; +5.569164066079876e-01   +6.934908459592021e-01   +1.202783353744319e-01   +2.724648937014297e-01   +4.156293895781775e-01   +4.883888284468085e-01   +5.411451862293378e-01   +4.856624391675661e-01   +1.450517934249121e-01   +5.228188238855747e-01   +4.106869158320909e-01   +3.987274922189094e-01   +1.777447156359373e-01   +6.646459258708176e-01   +2.697679764472773e-01   +2.588464329674827e-01; +3.795368825813852e-01   +1.824717322840763e-01   +4.399284704320834e-01   -1.205574007510489e-01   -3.260789921965372e-02   +1.265222908669969e-01   +1.901632555662750e-01   +3.951236042979113e-01   +3.973928117572221e-01   +1.734878622208390e-01   -2.095133784900582e-01   +3.819431942963307e-01   +1.179598500059372e-01   +1.603114589431484e-01   +2.949978044342000e-01   -1.787617623164081e-01; -6.189387627505887e-02   +2.247935608044250e-01   -1.400143869145490e-01   +4.593128508139044e-01   -8.523140612732465e-02   +2.230289669734430e-01   -1.651468511305501e-01   +5.900593535151608e-01   +4.364999521247069e-01   +1.556965645790683e-01   +1.196421838994390e-01   +1.759328950317357e-01   -7.404887288593830e-02   +7.685518542677963e-01   +6.388944775348185e-02   -1.492348964320541e-02; +1.980335126345485e-01   +7.513199972035600e-01   +2.539320353934801e-01   +4.003527322845268e-01   +1.060158690730110e-01   +8.087928557625601e-01   +3.756897865256647e-01   +1.576591873871515e-01   +2.087491232139043e-01   +2.198356706212797e-01   +4.876012709410581e-01   +2.863561255534465e-01   -1.039573424812218e-02   +7.369776090671167e-01   +6.329524099029574e-02   +7.314672620280865e-02; -7.222479910248743e-02   +3.925407646027700e-01   +4.575962818263295e-01   -1.923008474519142e-02   -8.693864667490257e-02   +3.430118091810457e-01   -1.900495009928332e-01   +2.042768273632878e-01   +3.019585608122994e-01   +2.333754727171963e-01   +4.184268846461246e-01   +7.144405240040673e-02   +4.179811999791021e-01   -3.793803692563298e-01   +1.952560666025360e-02   +5.550770571618497e-01; +3.264879448972950e-01   +1.874870625796240e-01   -5.878129025889837e-02   +6.037474650910442e-01   +2.778660458473805e-01   +8.182367860410363e-01   +2.721072399485406e-01   +8.874110749117993e-02   +3.402695963357940e-01   +1.984320123397760e-01   -2.588168916119710e-03   +3.766687082277599e-01   +2.334228456460653e-01   +1.303142287716453e-01   +7.502419189008818e-01   -2.774350604330159e-01; +1.023267222289374e-01   +8.177180878693059e-01   +4.288142933530305e-01   +4.584910654958513e-01   -2.412579734140305e-01   +2.193891413117399e-01   -1.196245504753612e-03   +5.637916512429462e-01   -3.545133373465664e-02   +3.242000125078658e-01   +1.484466522224096e-01   +7.422755214977322e-02   +2.503499572629874e-01   -1.615004897660860e-02   +1.239255815281110e-01   +4.723484738703436e-01; -3.764808592553783e-01   +7.296450702149706e-01   +1.404259380316229e-01   +2.694092626689334e-01   -1.073275704632153e-01   +5.427849909305663e-01   +2.587518143576016e-01   +2.553667212873988e-01   +6.088303278780587e-01   +1.477109591236500e-01   +3.034616593574083e-01   +4.586789415643805e-01   -1.356560953557559e-02   +1.462794977793963e-01   +4.332639870940048e-01   +3.897515233881864e-01; +5.258340073267005e-02   +3.731207028706888e-01   +2.210093585023206e-01   +4.189371564753130e-04   +6.556525760712029e-01   +1.055065362031021e-01   +4.250434108448597e-01   +2.275199765250729e-01   +1.945680654807681e-01   +4.634811635593236e-01   +1.486978301698917e-01   +7.066320471690075e-02   +2.570967959389772e-01   +7.513296454508007e-01   +1.648115153707913e-01   +2.982349029571658e-01; +5.583631830515225e-01   +3.042605378855459e-01   +1.885567179365885e-01   -3.988354931815100e-03   +4.296427905384561e-01   +3.008961455661158e-01   +1.800842042076673e-01   +5.137044372773591e-02   +2.263139960764175e-01   +6.406310643014559e-01   +2.747163859536729e-01   +3.136061546267576e-01   +5.078902765984351e-02   +2.864668217154106e-01   +7.217317545437545e-01   +9.467376128674533e-02; +4.429776753356565e-01   +5.119251571867441e-01   +3.261596166753041e-01   +3.382717382182160e-02   +6.119649405609512e-02   +3.385050449552362e-01   +2.505231585048120e-01   +3.575191856415295e-01   -6.260227911067812e-03   +1.749495272009647e-01   -2.494072168290080e-02   +7.446216889252669e-01   +2.664803084710772e-01   +5.775092295488854e-01   -2.710300648871631e-01   +7.568712674634398e-01; -2.215782599055055e-02   +1.865056878531063e-01   -8.933441572840690e-02   +1.818175927763166e-01   +3.833113082862500e-01   -4.638067238098535e-02   +6.349556669612803e-01   +1.683174907930030e-01   +3.257029827063573e-01   +3.926049611873539e-01   +3.961866865741279e-01   +6.532585120201984e-01   +5.580262748822571e-01   +8.294016036675228e-02   -5.658609969141073e-03   +7.226528749488270e-02; +4.346791881858961e-02   +1.235698091608800e-01   +2.207546018021765e-01   +8.990271814305237e-01   +5.032461340157068e-01   +2.146104834977718e-01   +3.823378204263118e-01   +2.062533735541305e-02   +1.007816266413251e-01   +1.809486162405014e-01   +4.265926595316444e-01   +3.390021182801770e-02   +2.424712229265130e-01   +2.319190293464801e-01   -8.489861799333365e-03   +5.075784650797763e-01; -5.728332245543397e-02   +7.034614312993336e-01   +1.492539443277144e-01   +3.324455728750947e-01   +1.277872285455892e-01   +7.875930145693024e-01   +3.644921843175677e-01   +8.355475717397464e-01   +4.209246989040802e-01   +1.443043281093444e-01   +3.279742326534021e-01   +5.575357553346501e-01   +7.231986804689801e-01   +3.471451208998110e-01   +2.623487441223500e-01   +4.668917348733383e-01];
L1E_L1I_iGABA_netcon = [+7.500197475826982e-01   -2.050696447068050e-01   +3.114171241019896e-01   +8.385263194528227e-02   +1.000000000000000e+00   +3.807633392504237e-01   +4.853749053657125e-01   +6.398230638028345e-02   +4.857758146676013e-01   +4.139236203019412e-01   +1.912469815208495e-01   +2.202167806977042e-01   +4.809905961222751e-03   +3.838753896174635e-01   +1.291096255850974e-01   -7.817065816333953e-02; +3.245931954791290e-01   +3.516391987829286e-01   +2.937246344194803e-01   -5.633063534726122e-02   +3.358425756488385e-01   +7.934667580252982e-01   +4.022727243237978e-01   +5.473143294640956e-01   +2.617325710501716e-01   +3.411812509052204e-01   +3.172595039969042e-01   +5.827041061239777e-01   +3.565994047115251e-01   +2.385715473451379e-01   +6.453329190640876e-01   +5.140135875249836e-01; -2.207563121447864e-02   +6.083369465855907e-01   +1.106522412231270e-01   -5.698361231813989e-02   -2.657115201449892e-01   +1.959362464847731e-01   +1.473765182892861e-01   +4.136820965564676e-01   +2.178192804200511e-01   +5.334141659214900e-01   +2.907139053140939e-01   +2.112496428078602e-01   -1.748033612532068e-01   -1.191357997935039e-01   -2.644625882221764e-01   +1.591221735340932e-01; +4.577130592360959e-01   +4.873818889104372e-01   -3.571730103695223e-02   +3.606505337447936e-02   -7.284392722470626e-02   +1.879546408344938e-01   -6.663457070060949e-02   +1.005331727124796e-01   +3.433466054018995e-01   +4.860784753115861e-01   +1.887678603607872e-01   -2.939773377989592e-01   +2.867230351236530e-01   -8.499095076910886e-02   -2.343696287960893e-01   +1.437195748873074e-01; -1.948007916309358e-01   +1.959926128300291e-01   +9.758983450842580e-01   +3.895454454300551e-01   +3.699404011387084e-01   +2.753496506253222e-01   +3.340682931519991e-01   +1.639701041175414e-01   +7.127400311920986e-01   +6.945891586564101e-01   +4.843913452335481e-01   +3.549758763481028e-01   +4.064516230915735e-01   -1.083243587227159e-01   +4.966758609445073e-02   +4.649343109265776e-01; +8.779926901975611e-02   +2.383963024787317e-01   -1.804400142924504e-02   +5.567577410626096e-01   +6.975125060682144e-01   +3.502063311595676e-01   +6.532266571834815e-01   +4.471072625881199e-01   +2.682664638709399e-01   +2.312815225471024e-01   +1.250906946640475e-01   +4.131768702976578e-01   -1.305852517844704e-01   +2.080929145004831e-01   +2.760868648582988e-01   -2.587690885666116e-01; +4.851815820267570e-01   +2.038303075467638e-01   +3.331915671459398e-01   -1.334354367440863e-01   +4.274216776230759e-01   +3.114188050216005e-01   +4.689047558801223e-01   +7.313862395166574e-01   +7.548724420475093e-02   +6.702348053931368e-01   +5.752949785235124e-01   +2.558722051948115e-01   -8.042111244268890e-02   +3.979269239187840e-01   +3.291331527453314e-01   +1.000456482193321e-01; +8.976105215520308e-02   +5.507826049535713e-01   +4.048368708455357e-01   -1.305054615068508e-01   +1.759675330699607e-01   +2.190484417354067e-01   +2.052425299860609e-01   +3.995449448265636e-01   -1.279414480927504e-01   +2.639504465118304e-01   +6.339414603652183e-01   +3.728417487190979e-01   +7.825011575053610e-02   -1.445443661917935e-01   +1.741295693915225e-01   -1.585691224224641e-01; +2.795243735259839e-01   -1.308332268605892e-01   +3.229466670881559e-01   +1.043652968891708e-01   +1.456797392831896e-01   +4.745037175201165e-01   +6.025525789072841e-01   -6.226461548464796e-02   +3.713871535467272e-01   -2.208696890224888e-01   -1.851388352995749e-01   -1.235158958271411e-01   -8.374120973679967e-02   +2.264812233540138e-01   +5.271578919945052e-01   +2.093152759783945e-01; +5.586944671656504e-01   +4.070671130092458e-01   +2.424699748983472e-02   +3.926824684705825e-01   +1.246860514753926e-01   +3.377007804404287e-01   +9.259381887285306e-02   +3.037316605419033e-01   +7.404701480485575e-02   +3.971984072398579e-01   +2.129894098983427e-02   +5.872300915016565e-01   -5.320272312173149e-02   +6.457996964382159e-01   +3.287811100611132e-01   +2.699213117722835e-01; -1.668785467942337e-02   -1.261719098093151e-01   +5.202881749499910e-01   +6.560440768050569e-01   +3.987200452968324e-01   +1.169378854069783e-01   +5.963701510975808e-01   -3.067948490080900e-01   +5.854404612130969e-01   -3.861493749999943e-02   +3.342483977171620e-01   +6.195953796700581e-01   +1.767626794670258e-01   +4.184275842693261e-01   +3.310474266934500e-01   +7.281890154233194e-01; -4.517061297004971e-02   +9.071567054530832e-02   +3.118534889567915e-01   +1.583579523167564e-01   +1.681118887677217e-01   +7.282546460420641e-02   +2.151991695754042e-01   +5.636228214341373e-01   +3.327821953986088e-01   -6.444088189027519e-02   +4.665925475048448e-02   +2.767756010143173e-01   -2.974312871549694e-01   +2.388543750398777e-01   +6.463267745719417e-01   +3.600605285014962e-01; +5.613256522877211e-01   +1.581711625283682e-01   +4.422154050813879e-01   +2.522838310085788e-01   -2.774620251229946e-02   +4.784236399404840e-01   -1.556553539703174e-01   +2.669180387607188e-01   +2.754896316596476e-01   +3.472242997392014e-01   -6.033124959252682e-02   +1.052286066059335e-02   +3.968885166050146e-01   +4.413006910801297e-01   +1.671628987167616e-01   +1.415164863503415e-01; +3.303692654131252e-01   +2.037633612835821e-01   +4.443031789928605e-01   +6.798105717083823e-01   +5.101855217024017e-01   -1.644241099468400e-01   +3.757323745490810e-01   +2.612596461604577e-01   -1.321430643555457e-01   +4.632881329439391e-01   +2.622898313443683e-01   +5.184548061723572e-01   +1.115800757164874e-01   +5.261856535470244e-01   +1.643248797604144e-01   +1.344338987594319e-02; +7.924236405502452e-01   +1.719169307749619e-01   +3.235960624368797e-01   +1.558944038955670e-01   +3.956274027146006e-01   -2.232167989126622e-01   +2.180001398189223e-01   +2.370948085014551e-01   +2.144975252029943e-01   +5.153236023555322e-01   +4.090405304651552e-01   +9.461173029974713e-02   -8.945922740688933e-02   +3.352921205819211e-01   +4.171114377681858e-01   -2.950824323582376e-01; +2.185004984543416e-01   +2.725621026163928e-01   +2.157995915095426e-01   +3.666545003060608e-01   +1.689084462979917e-01   -3.996018887260601e-02   +4.480241073693416e-01   +7.054779395703002e-02   +3.716514346982187e-01   +6.429288557211290e-01   +5.175173022550816e-01   +1.016099488738673e-01   +4.192816382257413e-01   +7.479239383519928e-01   +1.118150311525024e-01   +3.384535412816295e-01];
L2I_L1I_iGABA_netcon = [-9.128676530390556e-02   +4.825192056658841e-01   +6.327769262542228e-01   +5.089100676065390e-01   +4.399674787436703e-02   +4.566687980567900e-01   +4.308069794172679e-01   +3.814793245650393e-01; +6.719594376590591e-01   +4.673303319386191e-01   +3.004273286258197e-01   +6.296458026195861e-01   +2.251865040937214e-01   +2.577081230215897e-01   +6.372343778601767e-01   -1.831722154595400e-02; +2.659532940672005e-01   +1.685395052642002e-01   +8.152235610461964e-01   +9.254466929259685e-01   +1.393652539150887e-01   +4.007765397659898e-01   -3.006545087383888e-01   -2.931092908906628e-01; +1.425297990071687e-01   +2.490265593780796e-01   +4.703505756410079e-01   +7.147265215486580e-01   +6.941821054669706e-01   +3.995389389029966e-01   +9.323995233943300e-01   +4.035728878376662e-01; +2.336508062470087e-01   +2.421510531371499e-01   +4.953791899805879e-01   +6.595591584956668e-01   +6.355625260990014e-01   +7.731093135981970e-02   +6.289690978492705e-01   +5.841693066628775e-01; +7.193939158480797e-02   -5.612619338749235e-02   +1.281912288981767e-01   +6.512068823991325e-01   +2.831424067277660e-01   +4.589714510866546e-01   +3.186720663916923e-01   +1.529176964526921e-01; +5.493986316021986e-01   +4.990791172332976e-01   +5.437198698423431e-01   +5.653403823364651e-01   +7.640788755045094e-02   +7.717927502404236e-02   +5.463020946435768e-01   -1.421585723193335e-01; +5.502082325390769e-01   +3.601001848203328e-01   -4.729924448169395e-02   +2.221910397125260e-01   +4.435336892385245e-01   +6.888680403775354e-01   +5.886812523620258e-01   +1.355390980608206e-01; -5.063436910261343e-02   +9.117742803985677e-01   -9.468533767666922e-02   +2.520946940244981e-02   +2.858104062616255e-01   +4.544294177734232e-01   +7.798698836436824e-01   +3.849566052595847e-01; +5.179842831833825e-01   +4.460629209031367e-01   +8.309921178873451e-01   +8.751852322186268e-02   +2.183616793960597e-01   +2.786231648824281e-01   -2.061435512690699e-01   +2.141723162528240e-01; +5.671911084153249e-01   +6.886332349776205e-01   +1.936522514501041e-01   +4.426952612066209e-02   +4.049149868825291e-02   +5.404717016314295e-01   +2.989187663323416e-01   +3.140653551070718e-01; +3.029404019299151e-01   -6.245907931158201e-02   +2.894120433737544e-01   +2.827203991011318e-01   -2.253643074721867e-01   +3.245309472662377e-01   +6.838696677159227e-01   +2.631141170046074e-01; +1.690244778018716e-01   +4.106933308445613e-01   +1.212444950950569e-01   +5.877710714601211e-02   +5.458278283466275e-01   -1.482332816412812e-02   +1.003810794871144e-01   +1.448868584797250e-01; +7.233548444235079e-01   +5.276412492380942e-01   +9.616113125508087e-01   +1.408281847179594e-02   +3.737329024363159e-01   +6.544380367226811e-01   +8.384449897037087e-01   +2.930470390581788e-01; +4.226767533888320e-01   +4.273377709272898e-01   +3.714502204282693e-01   +2.903371473445086e-01   -4.914447992913658e-02   +2.726149690792760e-01   +1.817816342346497e-01   +2.333595366659595e-02; +5.225221845455830e-01   -1.281156673657506e-01   +6.574831625412183e-01   +4.737967733814169e-02   +1.508820794943951e-02   +5.778228373847667e-01   +2.796030827771535e-01   +1.644119935256294e-01];
L1I_L2I_iGABA_netcon = [+7.455031654842122e-02   +2.173535317688472e-01   -5.583161901693476e-02   +2.891165850206344e-01   +5.070579353053966e-01   +3.929214242929879e-01   -7.724537118278395e-02   -1.683896137057082e-01   +3.192840204903369e-01   -2.963657188351935e-01   +6.627901988560584e-01   +1.804294742570957e-01   +4.016272901429556e-01   +4.408777600656903e-01   +2.939499683989272e-01   -2.535252978494912e-02; +3.122885910573886e-01   +4.648319773767283e-01   +7.355127166302053e-02   -1.057924874071858e-03   -8.088388862097809e-02   -1.146189635330115e-01   +2.218220636016775e-01   +5.405504957018652e-01   +8.605196222303569e-01   +4.156952788081691e-01   +2.960472917037723e-01   +2.979293637742450e-02   +3.246946534704098e-01   +1.648741213703992e-01   -3.365641547352211e-02   +3.278953439905489e-01; +5.022697401715586e-01   +3.064444770367737e-01   +3.434197611553638e-01   +5.857569450741904e-01   +1.653003241669107e-01   +2.419076124539846e-01   -2.898469852437611e-01   +2.670937877352498e-01   -5.479316805229936e-03   +5.517085295779490e-01   +2.204773025291329e-01   +9.133391352518770e-02   -2.278438401523098e-01   +9.221025816226856e-02   +7.002233023552557e-01   +2.614195103127125e-02; -7.747112562677375e-02   +3.564576966395303e-01   +5.508744858181994e-01   +5.391182485460445e-01   -6.080944119472811e-03   +5.662182130564163e-01   +9.112926173871241e-01   +9.718898962587433e-01   +1.074288169875933e-01   +4.997518196586684e-02   +2.142638256364456e-01   +9.253526540053586e-02   +6.513944206668961e-01   -4.142123405972993e-02   -1.611311315584925e-01   +1.221508306155361e-01; +1.144494338561014e-01   +5.561736814427787e-01   +2.223750526777606e-01   +3.798463724003752e-01   +5.425858740670567e-01   +4.142049173342484e-01   -3.323991153017961e-02   -9.342531116723896e-02   -7.643455529492496e-02   +8.654503472049780e-01   +6.452692135308966e-01   -4.073193571212071e-02   +5.893564812759678e-01   +9.474456703496917e-02   +8.920521437573417e-01   +2.292313738483076e-01; +2.289480296503782e-01   -1.703493202142641e-01   +4.095648944367562e-01   +4.931322078206974e-01   -1.228918984355865e-02   +6.974435358123274e-01   +4.610936354755700e-01   +3.668890422551358e-01   -4.387232064613011e-01   -2.759090619501525e-01   -7.773671357628742e-03   +3.276812795203393e-01   +6.167785596351553e-01   +7.995878780009151e-01   +3.656532175428618e-01   +3.235895664405455e-01; +4.670098866670406e-01   +6.011751166223656e-01   +3.896275864693654e-01   -8.985218246057469e-03   +7.887279295645581e-01   +3.534031328556450e-01   +9.644346009788998e-02   +1.978257651462969e-01   +7.534917260449041e-02   +4.398067552031926e-01   +6.576319246265591e-01   +1.399117737051480e-01   +8.148902079353967e-01   +5.038404981372038e-01   +2.072431757812352e-01   +3.981321254749095e-01; -2.303047301681584e-01   +1.683890363755596e-01   +6.950772421229325e-01   -8.220395059407379e-02   +4.570838463160372e-01   +2.709016541953841e-01   +2.858095571299258e-01   +3.528877822088282e-01   +6.478265279820880e-01   +3.610934161924421e-01   +2.392956252450529e-01   +8.103863478103371e-02   +2.614330708131920e-01   +7.526525485262850e-01   +4.619941030469995e-01   +3.411498154967346e-01];
L2E_L1E_iAMPA_netcon = [+3.232961485705736e-01   -9.307449847928541e-02   -1.208445423461299e-02   +9.146883939288217e-02   +5.220675992757614e-01   +2.199963483584361e-02   -1.444674698182864e-01   +6.391041769049879e-01; +9.452825294420084e-02   +1.063263182703907e-01   +7.418016367640052e-01   -9.905031794558261e-02   +2.736883642846010e-01   +9.804884507209943e-01   -4.680415259915908e-02   +2.690139291199419e-01; +8.641620333834914e-01   -2.800556300076973e-01   +3.431185673169120e-01   +3.202383144911310e-02   +3.027218289918440e-01   +3.776099571860032e-02   +3.218322875736742e-01   +3.245706663608330e-01; +5.709868240518169e-01   +3.953690081299013e-01   -6.660400807035838e-03   -2.725297672339244e-01   +4.448017683685428e-02   +3.038648394233477e-01   +1.275023206302752e-01   +5.388152418317491e-01; +5.200539527730115e-01   +8.528432208487939e-01   +2.703470374078859e-01   +1.789227740501800e-01   -4.117466506326835e-02   +3.904512682469887e-01   +6.678082197022847e-02   +4.499079737803614e-01; +3.561854988924658e-01   -5.286674965170091e-02   +8.482931666105644e-01   +5.411539528904281e-01   +4.916102200584626e-01   +7.303087848150627e-01   +2.543393865173184e-01   -6.213570365001947e-03; +3.745547366258590e-01   +4.066598968962336e-01   +2.368300901475413e-01   +1.343207199924283e-01   -1.923161138877867e-01   +1.137303387124979e-01   -6.730110119296026e-02   +2.662695934900438e-01; +2.580562420251827e-01   +4.900878899353707e-01   +4.162297206730786e-01   +7.231913746913502e-01   +1.307498071520290e-01   -1.020524340926873e-01   +5.208044581337693e-01   +1.264178475990777e-01; +3.469811310595066e-01   +1.579082383895708e-01   +2.075862741586599e-01   +6.251979195791381e-01   -5.627358570511698e-02   +7.628915920749376e-01   +6.508257397525069e-02   +1.025293732276780e-02; +2.527276060562388e-01   +3.859791100530343e-01   +4.197398693563830e-01   +7.157744657568157e-01   +6.827978040229160e-02   -1.267690713913958e-01   +2.871068547697103e-01   +2.146009362002224e-01; -2.640668235093203e-02   +2.517547699938334e-01   +2.861037296603860e-01   +2.151542923583419e-02   +1.891661539805751e-01   +3.001455974783593e-01   +4.541847350623910e-01   -3.492814332322333e-02; +9.725650585078599e-01   +4.691685453499654e-01   -5.577431897412213e-02   +2.017260852163208e-01   +1.235953336604339e-01   +3.968163788259919e-01   +4.807534542473202e-01   +7.655106103011546e-01; +5.663532367779094e-01   +5.569858687838519e-01   +9.143481003988370e-01   -3.133613664751761e-03   +5.715075082149323e-01   +2.156253365213271e-02   +8.580407546519755e-02   -8.723755155751971e-02; -8.637786761082999e-02   +4.839381829091667e-01   +4.328681955499942e-01   +4.222429398627964e-01   +3.156860548516811e-01   +4.489260492871189e-01   -1.388712639658346e-01   +4.999775444185718e-01; +5.299599918606535e-01   -1.497312334204900e-01   +1.189552228574616e-01   +3.374938753964135e-02   +4.726534804946286e-01   +6.026900183933050e-01   +7.668536522695477e-01   +2.460682673933399e-01; +2.310950215266472e-01   +3.777432430113005e-01   +2.570135538253087e-01   +5.321944544929313e-01   +1.572203734776487e-01   +3.283312089215715e-01   +1.190177899381181e-01   +4.862306191113348e-01];
L1E_L2E_iAMPA_netcon = [+6.331332284876657e-01   +9.068823866258358e-02   -2.504410715313112e-01   -2.270283046036234e-01   +6.248888090512399e-01   +1.119976354451201e-01   +2.054508570430128e-01   +4.275017171705993e-01   +6.551822381431680e-01   +4.245063018621758e-01   +3.215290329702540e-01   +7.237713380448280e-01   +5.278607063218864e-01   -1.078476407638580e-01   +2.685068193147609e-01   +4.676009019629924e-01; +2.976774488794355e-01   +4.077252738178343e-01   +4.001136319877214e-01   +3.643588303842880e-01   +4.547205399967814e-01   +5.815848466900253e-01   +6.773824859403661e-01   +2.453133014138698e-01   +3.769555717275169e-02   +2.745956439471191e-01   -3.151696213989073e-02   +3.094255661188032e-01   +3.292558610053439e-01   -1.991570440770428e-01   -1.248985977165401e-01   +7.004927242863682e-02; +2.269311556283245e-01   +4.585393213816248e-01   +3.749513210354768e-01   +9.491647025095550e-01   +5.187326771039148e-01   +6.021248315872259e-01   -1.960531109908906e-01   +2.156078834551367e-01   +4.577447985792632e-01   -1.388591702059317e-01   +4.274419320230947e-01   +6.112166359596047e-01   +3.984212850358946e-01   +7.057117188319232e-01   +1.794527881124824e-02   +6.353010876094666e-01; +1.012319734872162e-01   +7.851559980440670e-01   +5.530501427780166e-01   +7.240149680291361e-02   +3.251708071764223e-01   +5.915056168457823e-02   +3.410722756533248e-01   +4.857963474237622e-01   +3.119166127934399e-01   +3.716013872719066e-01   +1.196936102767719e-01   +2.188620407078648e-01   +4.330115301230337e-01   +7.789868694720180e-02   +6.640692642808063e-01   +6.206220894408445e-01; +2.264920131817959e-02   +4.943245551774618e-01   +5.952117238110005e-01   +3.497513103789879e-01   +7.560916193445687e-01   +2.354319203309396e-01   +4.871495452417427e-01   +4.538995465117416e-01   +5.729044920512395e-01   -7.216121397295544e-02   +8.130440839337423e-01   +7.990828394910066e-01   +1.411323159786474e-01   +4.027655280684832e-01   +3.419808645215417e-01   +8.999438143656338e-01; +5.457714649552535e-01   +8.061989659393777e-01   +6.368258362018444e-01   +4.210174510913684e-01   -4.470874001751075e-02   +1.556664204278831e-01   +3.313567253022454e-01   +4.423695079110279e-01   +6.566414600630859e-01   +4.169389790884587e-01   +5.139391261482658e-01   +1.741424743077132e-01   +9.213444432942121e-02   +4.856815958951310e-01   -1.993111837560285e-01   +2.054159981120744e-01; -1.050688048041683e-01   +7.567051059114236e-01   +6.777201616177109e-01   +3.099162096419033e-01   +6.702929521020300e-01   +4.073022514580826e-01   +5.848191117369339e-01   +4.043171252311500e-01   +4.576736020087621e-01   +4.142942768861476e-01   +1.174872052225348e-02   -1.267755524000344e-02   +8.560285661723727e-02   +1.660324394716975e-01   +2.077867004656891e-01   +2.139166494455790e-01; +2.485804621118037e-01   -3.831961019498563e-01   -1.901545918400515e-01   +3.267665799407285e-02   +1.724232407479505e-01   +5.127142665641591e-01   +4.867261565162153e-01   +2.386327636988166e-01   +3.890153857287310e-02   +3.494558054119423e-01   +1.507611044154648e-01   +6.489194357450336e-01   +7.111143833733764e-01   +2.298057846816933e-01   +4.821223749553051e-01   -2.382969131061192e-01];
L2I_L2E_iAMPA_netcon = [+3.204599935942281e-01   +1.875783255862868e-01   +6.847503950065779e-01   +4.430443463105813e-01   -6.354407190532906e-02   +4.973741227949934e-01   +5.638773257381172e-01   -8.643814850409159e-02; +4.175405616726760e-01   +3.910732192382353e-01   +7.109180855634690e-01   +4.174366575039236e-02   +5.576552944533343e-01   +2.701282148292378e-03   +2.368406014461044e-01   +2.695589441582823e-01; +1.490569542330773e-01   +6.010494783764486e-01   -2.609232492065254e-01   +3.002736202759860e-01   -2.617809474166048e-02   +4.737616424679036e-01   +2.282984281363142e-01   +6.560319057132741e-01; +2.161602587059618e-01   -7.125363279984817e-02   -1.455365075178953e-01   +4.328131889192555e-02   +3.019403134073743e-01   +1.590138744570606e-01   +1.282910703835252e-01   +5.963703891898793e-01; +7.569380512813473e-01   +8.567738612783286e-01   +1.254784350323265e-02   +5.934060359231352e-01   +3.751786951019517e-01   +6.674843202981854e-01   -3.644863590151017e-02   +3.877432851259982e-02; -8.907173067687911e-02   +3.396949933531235e-01   +1.885010143706051e-01   +3.268344768456610e-01   -5.794177936947445e-02   +4.894095491712774e-02   +2.054941536686984e-01   +4.128400512867195e-01; +7.261130622009833e-01   +4.273628952243311e-01   +2.424431687029781e-01   -1.137044650363999e-01   +2.988087139493310e-01   +9.873248918385048e-01   +4.151987331576281e-01   -2.114376291292504e-01; +6.142355410981349e-01   +6.269043442123617e-01   +5.270850934053108e-01   +6.321699610967442e-01   +6.373566152483588e-01   +3.512060147051128e-01   +1.654069866414820e-01   -1.606233811281148e-02];
L2E_L2I_iGABA_netcon = [+5.629724548419310e-01   +1.185886060080127e-01   +3.239609344592045e-01   +4.648581785120146e-01   +1.709320046461338e-01   +6.113056583363342e-01   +8.145098182389435e-01   +4.034062178757403e-01; +5.062298524397243e-01   +4.149491408044381e-01   +4.525606090134733e-01   +1.921862302173422e-01   +5.505893500001271e-01   +9.827162415166055e-02   +5.508927193862043e-01   -1.596273338814595e-01; +2.044132921609370e-01   -1.851870098642693e-01   +6.082860010968543e-01   +4.731555427508838e-02   -3.146476621051534e-01   +7.199868997833096e-02   +2.381739750097434e-01   +3.672058730266973e-01; +4.929731569987462e-01   +7.359933363651773e-01   -4.964410974370928e-02   +3.128262096527164e-02   +7.953646935655131e-02   +7.879953614932115e-01   +7.490664479706148e-01   -3.091644182846646e-02; +2.308683260354936e-01   +4.173259973107011e-01   +3.569831617429788e-01   +2.381399464411544e-01   -1.231181780061652e-01   -7.985749959160214e-02   +3.397241645905812e-01   +3.214926571402044e-01; -7.304467606025006e-02   +5.670130420194356e-01   +8.304385206300573e-01   +3.947701561872732e-01   +2.494313925472134e-01   +4.247973031124558e-01   +6.206534784609697e-01   +3.342805954179692e-01; +5.163150995023597e-01   -1.170122385874434e-01   +1.237066273324006e-01   +4.488196981710226e-01   +5.346071290013655e-01   +1.830342381650195e-01   +9.867809971044122e-02   +3.879247219861628e-01; +1.100573428199602e-01   +2.531219530958547e-01   +2.969021048181177e-01   +4.192677258510327e-01   +1.328276360186735e-01   +2.164291214733816e-02   +7.741295962779612e-02   +3.258358377950344e-01];
L3E_L2E_iAMPA_netcon = [+1.780952766740292e-01   +6.569571163642578e-01   +6.910954501112019e-01   -4.164686484806740e-01   +4.882571660267986e-01   +3.772964522090425e-01   +1.080801322267069e-01   +1.584709232702050e-01   +8.166741140462335e-01   -2.349455984790608e-02   -5.133675846025229e-02   -2.205265511220536e-02; +2.120365455294362e-01   +5.705237567434247e-01   +2.226983570159055e-01   +4.500885471555078e-01   +8.377659276127147e-01   +2.802935855739372e-01   +2.994936199481937e-01   +5.922780299554077e-01   +1.708248482459642e-01   -1.264927992391409e-01   +3.660384899501283e-01   +6.323653513301878e-01; +4.236994694643333e-01   +2.838074236902510e-01   +6.815895887469942e-01   +4.932989203426734e-01   +4.375216415029426e-02   +7.558941619710796e-01   +6.030893338722529e-01   +2.181142629437621e-01   +2.800325971574089e-01   +3.341241987692986e-01   +2.665399713471318e-01   -2.066122996956043e-01; +5.057214890605394e-01   +4.918882454753993e-01   +4.378089455810535e-02   +1.218524418461893e-01   +6.970349392828855e-02   +2.269245960096227e-01   +4.682248786619500e-01   +4.815824385849579e-01   +3.436367955655386e-01   -1.083874076886742e-01   +4.126735951865627e-02   +6.919428511900647e-01; -1.836149079084456e-01   +5.557720460133186e-01   +9.257484691355780e-02   -3.473221521338562e-01   +3.111787423495380e-01   +3.115135812394563e-01   +4.778716232764666e-01   +2.267208502065631e-01   +7.488116708273037e-01   +2.258115148138535e-01   +3.177289081786263e-01   +6.871024176728497e-01; +3.538677440967349e-01   +3.854410750940352e-01   +4.889097748851654e-01   +3.127078039803223e-01   +3.374587661998635e-01   +1.697741679912643e-01   +3.899554000963097e-02   +5.238615408532775e-01   +3.227261947497729e-01   +4.386949734418040e-01   +4.074855683110402e-01   +5.187515974112760e-01; +8.125283759792495e-02   +7.358539473882272e-01   +1.896313282739826e-01   +6.001012067239980e-02   +3.312791872019437e-01   +1.260602718312369e-01   +8.527718707636890e-01   +2.811816364625535e-01   +7.940240265938773e-01   +3.464870378524775e-01   +7.776320480139444e-01   +1.116225683668230e-01; -5.685967454598626e-02   +3.254566703747043e-01   +3.975347940455815e-01   +2.306808502301175e-02   +2.260558613377592e-01   -1.228103472548530e-01   +1.672123059334586e-01   +4.780181471560390e-01   +1.550791083202976e-01   -2.370827293922751e-01   +3.104610487444170e-01   +4.786146916581059e-01];
L3I_L2I_iGABA_netcon = [+1.759510341680757e-01   +6.620110660805200e-01   +3.052405514656786e-01   +2.425861890820003e-01   +3.997894548614450e-01   +7.517149187119488e-01   +7.078322905851935e-01   +8.358881654992002e-01   +1.950928835178417e-01   +3.603222556859184e-01   +6.687327542871202e-01   +4.217540990212879e-01; +1.518756124572670e-01   +7.473499285105159e-02   +3.103972461502355e-01   +2.741367081563405e-01   +7.397978462539972e-01   +3.394649534314806e-01   +5.529755847352054e-01   +2.901161649749814e-01   +7.262354010823731e-02   +2.774272082296826e-01   +2.132906635897411e-01   +4.578682751007027e-01; +2.202010241712068e-01   +3.766687563704777e-01   +3.994909747816988e-01   +1.568879643736837e-01   +5.874986440853766e-01   +7.808185573006030e-01   +1.268175201595624e-01   +4.674357584196024e-01   -1.218292597876862e-01   +8.050380217997261e-01   +5.301394131263183e-01   +2.538695720978642e-01; +4.718142910439726e-01   +1.438274329960031e-01   +5.102806863477842e-01   -1.735172358184738e-01   +6.246106277687791e-03   +3.693075260319678e-01   +3.444119466083723e-01   +5.775173344425325e-01   +5.102341319966113e-01   +2.868867106996658e-01   +4.719507784354042e-01   +2.631354679465371e-01; +5.635811866171748e-01   +4.143851722293516e-01   +4.167921379940379e-01   +5.687880955025120e-01   +2.647420467413879e-02   -7.793476124629992e-02   +7.525170420055916e-01   +3.915350058786981e-01   +4.647017223532531e-01   +4.941280988898844e-01   -3.296195835224101e-02   -1.586047214900131e-01; +7.484443177392368e-01   +4.242056696681210e-02   +7.144424394441882e-01   -8.806451683544805e-02   +3.694010890984998e-01   +6.685398726601763e-02   +4.497000480115210e-01   +1.498062285675219e-01   +7.524763301957881e-01   -2.766857019630942e-02   +9.955721760997567e-01   +2.171196590086214e-01; +3.491558648538114e-01   -6.698288825497697e-02   +4.138249496215609e-01   +3.356168551458552e-02   -4.861110704207437e-02   +3.675691643192485e-01   +1.831103811981631e-01   +4.129382638134489e-01   +2.489278737671341e-01   +6.622485411394813e-01   +8.835121729486567e-02   +3.589077745048096e-01; +7.380857315638232e-01   +1.708355318282717e-01   +3.049179127192413e-01   +2.995783100500439e-01   +8.515200022418298e-01   +6.177200009969941e-01   +3.452677264717383e-01   +3.268234785197203e-01   +2.682057927981041e-03   +2.710823856457221e-01   -5.179179787605602e-02   +9.706428640113192e-02];
L2E_L3E_iAMPA_netcon = [+6.064525831371219e-01   +5.112021308278336e-01   +8.621591217488531e-01   +2.394192145785292e-01   +5.021854702927979e-01   +2.842546895701417e-01   +6.813362804349129e-01   -1.671021149475965e-02; +3.657384222278794e-01   +4.857261405713458e-01   +5.829809666625096e-01   +7.425170014774949e-01   -3.416335188440288e-01   +4.045124812615351e-01   -6.864877830598290e-03   +3.474401731386484e-01; -2.112288661054276e-01   +1.449119632715467e-01   -2.284105003296683e-01   +1.562664367927530e-01   +2.714287128860232e-01   +5.361949365044011e-01   +6.294824476671427e-01   +5.680891340973971e-01; +3.598556309629982e-01   +5.400338552684449e-01   +8.137159687966833e-01   +4.840178598784906e-01   +1.392543765309747e-01   +1.069630912487247e-01   +5.252996201749113e-01   +2.642428586148319e-01; -2.270836419027995e-01   +6.147842572009600e-02   +4.702692297387395e-01   +6.684411804781913e-02   +9.521607950463762e-01   +4.932258505399371e-01   +3.872115167114373e-02   +3.175020169243515e-01; -1.266789167305264e-02   +7.616315720240774e-01   +5.455905980583277e-01   +5.534452434293375e-01   +4.752919664471871e-01   +6.764199233233516e-02   +6.045548229606325e-02   +1.340102954134053e-01; +2.983261574990036e-01   -3.977315382320060e-02   +7.034986009747364e-01   +7.458599585621702e-01   +5.246761049346985e-01   -1.354875005465447e-02   +4.368200923033414e-01   +6.892755213889441e-01; +3.116309165009242e-01   +6.198610273765931e-01   +4.659160970687764e-01   +2.445063455755528e-01   +7.857271504127522e-02   +7.744609374915652e-02   +2.708168318615388e-01   +4.672038784660415e-02; +3.527222209615738e-02   +5.171900496668760e-01   +2.553905283597208e-01   +6.860043114403282e-02   +2.813406720285803e-01   +1.726974337668158e-01   +1.050436947911050e-01   +3.453521782832919e-01; +3.870715548723176e-01   +4.298068986959970e-01   +1.846917982447859e-01   +7.943018658347082e-01   +1.022022754931887e-01   +8.364250227525644e-01   +6.518119034074767e-01   +5.148913230384797e-01; +8.071077751398513e-02   +5.685175827532010e-01   +4.135778528859698e-01   +4.319497675230155e-01   +2.107193976856889e-01   +6.603912589608857e-01   +2.808526379736657e-01   +2.023411326809562e-01; +1.280484490926754e-01   +1.682835764899910e-01   +4.709908891987418e-01   +3.662869102983364e-01   +1.632094863656067e-01   +3.001872607590075e-01   -4.433442666129518e-02   +2.214000009323491e-01];
L2I_L3I_iGABA_netcon = [+1.226435090165592e-01   +5.488536521278159e-01   +9.360830682816899e-01   +5.746941830401119e-01   +7.215663678356058e-01   +6.072507814568272e-01   -9.963908228491636e-04   +6.841881543995612e-02; +2.565992056880908e-01   +7.936757037145036e-01   +6.462969018862722e-01   +2.033355862087609e-01   +4.158907867107984e-01   +3.726375968145402e-01   +3.393780931342740e-01   +5.748936771725818e-01; +7.657269722193322e-02   -1.801798238193800e-01   +8.788178148317562e-01   +3.720408641014181e-01   +3.787280396061818e-01   +4.190852833213996e-01   +3.778742785699571e-01   +1.556589295924113e-02; +1.327777093531280e-01   +1.705737742968834e-01   +5.443013142567759e-01   +2.858086189524463e-01   +3.072988675595908e-01   +7.767358971193531e-01   +5.291704367912498e-01   +4.135319885776900e-01; +1.765818884185353e-01   +3.592621164786280e-01   -2.059180428297366e-01   +7.187222967802161e-02   +5.353414397206564e-01   +3.345232432279553e-01   -1.587615042032493e-02   +1.257895048193362e-01; +6.573605665931093e-01   +7.250464585555940e-01   +3.383897093489049e-01   +5.890879394169145e-01   +6.182846557213790e-01   +9.196005703578880e-02   +2.842946116542230e-01   +1.551629962155300e-01; +8.822108730312674e-02   +4.140062059528880e-01   +1.491369242169971e-01   +4.512467904363728e-01   +2.103951284452498e-01   -6.148458747773802e-02   -8.961254460211399e-02   +4.653193001198195e-01; -1.156978437349687e-01   +5.604166572092739e-01   +2.310207991985895e-01   +1.084272383043636e-01   +3.583507925958400e-01   +6.691955894771591e-02   +9.990425203377801e-02   +3.619963938184167e-01; +1.610690555459919e-01   +3.341221872292369e-01   +1.348996875254822e-01   +9.727241219783972e-02   +1.731816096863672e-01   +6.280589380412925e-01   +4.636909403535583e-01   +3.639227057789570e-01; +2.087463904062511e-01   +6.406954953958524e-01   +4.794997890559595e-01   +4.999496455561333e-01   +4.669750134185391e-01   -2.968451668322061e-02   +5.522055792463878e-01   +4.080796097087986e-01; +4.766894359742577e-01   +2.719506371501353e-01   -8.230947950878520e-02   +4.112773396826569e-01   -2.294109444496167e-01   +3.054842404181911e-01   +2.612242464176376e-01   +2.680889789452502e-01; +1.340221121117096e-01   +8.225422827633691e-02   +9.324374232398960e-02   +1.491575563362697e-01   -1.333584491368273e-01   +4.897982527355600e-01   +4.574952651040193e-01   +2.523104829143805e-01];
L3I_L3E_iAMPA_netcon = [-2.839662667172932e-01   +7.137528396567808e-02   +8.583797924219352e-01   +7.300287484266403e-02   +7.718916182933999e-01   +2.104399305183935e-01   +1.203043445942876e-01   -3.989491434190412e-02   +3.751959245180822e-01   +6.236975585255183e-01   +4.167732257935356e-01   -4.899311181525914e-02; +8.079060447936288e-01   +7.889777814725207e-04   +1.148783746081608e-01   +1.899001091912257e-01   +6.342290107173399e-01   +1.779980483898453e-01   +3.366191968525383e-03   +5.218279266380873e-01   +6.126250431863870e-01   +2.267908342796522e-01   +1.363191231452603e-01   +3.904165518495346e-01; -4.812604828435245e-03   -1.534906861685608e-01   +4.058140636162914e-02   +5.993616951505691e-01   +1.196315072502771e-01   +1.905968415374714e-02   -3.977406323298371e-01   -3.055423754880514e-01   +7.643189407315041e-01   -1.387685466104461e-02   +2.943307406743708e-01   +3.506110722496733e-01; +5.857925454996925e-01   +1.349711863852924e-01   +3.328550492796923e-01   +3.727822766928917e-01   -8.687337230383053e-02   -5.504471262896916e-02   +6.324834132841809e-01   +4.105624501797291e-02   +1.982815168007556e-01   +2.823236848402285e-01   +6.063038085406719e-01   +6.010702616446069e-01; +5.927444372734736e-01   +3.114774839220831e-01   +3.912927620933599e-01   +1.759088752700982e-01   +6.536139394875301e-01   +4.940526729094672e-01   +8.542308111031840e-01   +2.160456740321779e-01   +3.233712088016494e-01   +8.255860151763600e-01   +3.486883890634928e-01   +5.021217309058351e-01; +2.327169924204919e-01   +5.803024314128801e-02   +7.451121115502170e-02   +2.941882064898653e-01   +2.513726274646862e-01   +1.306471279119799e-01   +4.564341211001746e-01   -4.427446777694074e-02   +4.141818168740767e-01   +7.334669356509675e-01   +4.931030373536096e-01   +4.095390433530491e-01; +7.759779716690833e-01   +2.285221642058020e-01   +1.564970756001249e-01   +4.103631791923354e-01   +4.593171575226414e-01   -3.048030970537970e-01   +3.878326933238174e-01   +8.004437291973666e-01   +2.376274756100123e-01   +3.547639586695187e-01   +5.063192924568772e-01   -3.782106300575778e-02; +2.400952408892359e-01   +3.481732714865801e-01   +7.276327233470027e-01   +5.023626954229852e-01   -1.079230965183577e-01   +4.342152332496700e-01   +4.606836899857306e-01   +1.910787274088054e-01   +7.086118120396454e-02   +3.282718949406111e-03   +1.647953812755348e-01   +3.513320013801830e-01; -1.803744981462740e-01   +1.413650353988827e-01   +1.215548519652412e-01   +5.648847927278500e-01   -4.536287005725276e-02   +3.369202847342399e-01   +1.531286399765557e-01   +6.203074942083664e-01   +4.952644666580848e-01   +5.869877742520934e-01   +2.947503028668185e-01   +1.793991673430730e-01; +3.665684082427209e-01   +5.070426040584365e-01   +5.342470737694361e-01   +7.752125493242340e-01   +5.381126674712019e-01   +3.182597451684132e-01   +4.948983182332892e-01   +3.990062730984180e-01   +1.172982109928031e-01   +8.228154914896257e-02   -1.339060438752102e-01   +8.736473784011373e-01; +1.000000000000000e+00   +5.684342573389372e-01   +2.145255629560116e-01   +2.570559708488247e-01   +5.948719614462546e-01   +2.526696034895766e-01   -4.398521072443365e-01   -5.023128185291340e-02   +4.853969842707163e-01   +1.751551049962984e-01   +3.045570140912493e-01   +6.288817370055345e-02; +3.637302792951242e-01   +3.328003059046473e-01   +2.083029018253824e-01   +4.580202145542697e-01   +5.187861175690318e-01   +1.959676205898218e-01   -1.633084393658381e-01   +2.130879523784424e-01   +3.348347306782009e-01   -1.112699896243224e-01   -9.217262208990144e-02   +6.107332152613928e-01];
L3E_L3I_iGABA_netcon = [+4.425372873459935e-01   +6.447032960695133e-01   +4.418419679836811e-01   +3.995783229794360e-01   +1.753508031184043e-01   -2.453951969221316e-02   +2.194294478088945e-01   +2.955569738316455e-01   +5.922703330562060e-01   +3.371313919306121e-01   -3.661905499491708e-01   +1.814119491922148e-01; +4.713096311460035e-01   +5.061114903237440e-01   +1.329048245166352e-01   +4.913092408884377e-01   -1.081904570489686e-01   -3.762596996830697e-01   +4.608592876599686e-01   +7.808536066560963e-01   +2.524817061013361e-01   +1.228691942599118e-01   +3.230576561016073e-01   +4.132414067266122e-01; +1.311932911396689e-01   +3.475428486554650e-01   +1.367847734028023e-01   -2.598061051593198e-01   +5.594263573892322e-02   +8.783294462468236e-01   +6.433811366101921e-01   +4.898618998404545e-01   +5.652571316694448e-01   +2.901558104515572e-01   +1.646455575858879e-01   +3.460912999486452e-01; -9.172136560849473e-02   +2.635517647479631e-01   +1.388996744056057e-01   +4.294533827464222e-01   +4.393351024490906e-02   -4.351251990129668e-01   +3.456808884592966e-01   +5.562198872394302e-01   +2.901774081525302e-01   +4.487181717735511e-01   +3.770990993377279e-01   +2.599451515576516e-02; +2.549798468848067e-01   +5.137781010017671e-01   +1.600240367431081e-01   -2.331806163321646e-01   +3.164139229254984e-01   +2.741842600518686e-01   +7.066079498306992e-01   +4.616890784909908e-01   +2.056605418894399e-01   +4.408262786250446e-01   +3.089954736269851e-01   -1.610235742717699e-01; +6.073509323052345e-01   +8.017010679791030e-01   +7.260180886358714e-01   +1.829388624769294e-01   +5.991263907900497e-01   +4.460097478474707e-01   -7.464769356417056e-02   -1.444143346599662e-01   -3.391954391672593e-02   +7.268739082955553e-01   +6.365174419044364e-01   +6.705594691197218e-01; +1.598477388184623e-01   +5.569105829464531e-01   -1.743672830719365e-01   +4.785695863656687e-01   +7.496173282119604e-01   +3.851216935219737e-01   +1.114046833533735e-01   +9.387234957884898e-03   -1.114839273120781e-01   +6.188121320993548e-02   +1.556725114757563e-01   +4.141978211532596e-01; +3.485347574355068e-01   +2.571868818271714e-01   +6.438908845183847e-01   -8.848305551725205e-02   +5.470219012793229e-01   +3.920465782376123e-02   +1.909092612737669e-01   -8.414043053841005e-02   +9.035727665854972e-01   +4.658362958334946e-01   -1.962971836502450e-01   +6.225627724228356e-01; +2.430305412512575e-01   +3.972602700718891e-01   +4.295341189278787e-01   +5.307628644179950e-01   +2.424072635995084e-01   +2.576682959807353e-01   +7.789168894283061e-01   -2.238993593782662e-01   +1.467796128914850e-01   +1.903176078590242e-01   +5.641500437845889e-01   +3.278760421170090e-01; +5.917556221848592e-01   +3.789676190561865e-01   +3.955710837540652e-01   +3.297201285476690e-01   +2.929913998591869e-01   +2.909175340993747e-01   +3.595279352349289e-01   -2.492999411820732e-02   +3.292305459630969e-01   +1.806785255713100e-02   +6.646046745876316e-01   +2.060676175102895e-01; +3.055920929823407e-01   +9.303105574783874e-02   +1.795508878242800e-01   +4.002480199831431e-01   +7.383208800613753e-02   +2.487298559030009e-01   +5.139689474176088e-01   +3.748075331226604e-01   +3.436905881886405e-01   -1.242796378019479e-01   +5.899060200545129e-01   +4.809793458850458e-01; -1.033854587962064e-01   +2.007642640673597e-01   +1.274069876032105e-01   +5.262397279418178e-01   -2.142989527916169e-01   +2.503187168689400e-01   -2.628137498352993e-01   +1.227432577669933e-01   +2.066047386524141e-01   +7.546729838836804e-01   -1.559201700972644e-01   +9.725245205161731e-02];
L2E_Input1_iAMPA_netcon = [+2.644831100877967e-01   +3.316284351030415e-01   +1.341015880499302e-01   +1.717252226838165e-01   +1.504706591685274e-01   +6.572597141833598e-02   +3.761070150869694e-01   +1.421538807722013e-01];
L2I_Input2_iAMPA_netcon = [+2.383133639358598e-01   +5.685454749305126e-01   +1.666465851769752e-01   +2.120757695024132e-01   +8.241345507585072e-01   +3.653583338153522e-01   +2.635102521123148e-01   -2.429136608811682e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  33.63 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
