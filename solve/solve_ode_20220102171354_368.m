function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.165820381687926e-03   +8.710005703751477e-03   +1.064598052508544e-02   +1.396184784152588e-02   +2.138477324612168e-03   +7.067944528422916e-03   +2.576994831854760e-03   -2.096429603132167e-03   -6.626467236153132e-03   +1.034170972288249e-02   +8.313458710029644e-03   +3.219076196327126e-03   +8.060297760583486e-03   +4.597886877632487e-03   +6.829794381032481e-03   -7.579902386826891e-03; +5.624014672436761e-03   +1.675019154151591e-04   +9.079369881038479e-03   +1.088370959869211e-02   +5.712715626364598e-03   -2.695904594307493e-03   +1.007387552834853e-02   +2.490533076214926e-03   +3.281214106708940e-03   +9.836818014422719e-03   +9.023972116229099e-03   +1.063189081922177e-03   -5.226047373895239e-03   -6.396404597218104e-03   -2.102517859915239e-03   -1.015629231522347e-03; +1.274324895146153e-03   +8.069730974778686e-03   +7.154090308468200e-03   +6.250315754568554e-03   -4.385956132554404e-03   +4.154648242477468e-03   +1.029045961258768e-02   +1.730135366794378e-03   +4.644247601145891e-03   +4.718541639178620e-03   +9.066599651351042e-03   -3.818703637069536e-03   +6.260212959447410e-03   +1.586801896520561e-03   +7.753152060650637e-03   +4.743513199498101e-03; -2.442868534252988e-04   +3.387525361541670e-03   -3.365497326523176e-03   +4.318586448148710e-03   -3.078445637122462e-03   +4.826885646458309e-03   +7.743434728363531e-03   +2.237501678837506e-03   +9.828368274011384e-03   +2.904669702335391e-03   +1.008028688613213e-02   +7.200544371537572e-03   +4.864745535993801e-04   +9.317147916927478e-03   +1.456194703471636e-04   +5.573816812846673e-03; +4.791975247483852e-03   +2.692009200636575e-03   -5.119140418903025e-04   +4.610022313645042e-03   +1.259950884236066e-02   +5.757088805514860e-03   +7.041654068553477e-04   +2.318968771759405e-03   +5.080664205881735e-03   +1.334790590715595e-02   -1.401823167764077e-03   +5.886441039010738e-03   +2.263873729475840e-05   +8.873458811331730e-03   +7.345374020607247e-03   -2.409864895522002e-03; +1.123259331953001e-02   +2.521704808664724e-03   +1.887142992638672e-03   +3.530243370656227e-03   +3.695225873459384e-03   +1.569540880709565e-03   +4.601137801328523e-03   -7.433384516001200e-03   +8.334866958683037e-03   +6.496588710497956e-03   +5.179793780331714e-03   -2.148037556616666e-03   +6.923425407549186e-04   +2.942031200952121e-03   -1.983770809522032e-04   +1.009711054186861e-02; +5.010016392147994e-03   +5.366690209937767e-03   +3.212149876713510e-03   +7.533575921751441e-03   +9.643838344320687e-03   +9.424761599228090e-04   +5.471342062917077e-03   +1.031813935837647e-02   +8.178307904056683e-03   -8.954782596050522e-04   +4.608703013392875e-03   +8.894267368403769e-04   +3.760028896664017e-03   +1.593931140964287e-03   +5.842445898650412e-04   -2.374931235645401e-03; +5.381363263144175e-03   -7.607035770138809e-03   +8.704824202071302e-03   +6.606364530078070e-03   +5.608723657144233e-03   +1.748104077572206e-03   -3.678189189383245e-03   -3.636628216412722e-04   +6.368329769248946e-03   +9.112192232762406e-03   +3.207460443116036e-03   +1.007660535129703e-02   +5.068019203210870e-04   +1.447115646914623e-04   +5.957568914219244e-03   +7.788470762863504e-03; -3.143261821802397e-03   +6.036722334725782e-03   +5.096857162920337e-03   +7.250539534308938e-03   +1.622112774010762e-03   +8.523472664450362e-03   +1.540503610219908e-03   +7.399322445033090e-03   +5.894474138032905e-03   +4.872775898287255e-03   +5.622050312923153e-03   +5.057153060076524e-03   +4.696498860980428e-03   +8.204451636062751e-03   -8.626974407002518e-03   +6.183494120930612e-03; +1.719753091001632e-03   +8.399236400464843e-03   +1.706004492987859e-02   +8.944166378402899e-03   +2.225825804418229e-03   +8.438979312773679e-04   +9.495167654067660e-04   -3.437325396123233e-03   +5.488703384711391e-03   +3.619779870477220e-03   +4.609760884160505e-03   +4.775532134801467e-03   +1.923403155668861e-03   +4.220408243659731e-03   +1.431072250402324e-02   +9.015030882473926e-03; +9.437853709335156e-03   +6.947938445914813e-03   +1.009985300117315e-02   +8.385873179817045e-03   +3.024221033740972e-03   -1.977739999148803e-03   +9.876026181721604e-03   +1.232270944325810e-02   +4.837874740660152e-03   +3.542978180151327e-03   +7.370581671948556e-03   +3.655403443457941e-03   +3.677407743876185e-03   +6.378748962616824e-03   +7.786747012243300e-03   +4.726644322561121e-03; +6.881796104660429e-03   -4.689299543622194e-03   +1.604996859886016e-03   -3.727531551223546e-04   +6.637778491649591e-03   +1.134124196889202e-02   -8.082090788887994e-04   +1.068920530475005e-03   +3.728780819154245e-03   +3.245263193986494e-03   -5.954629911073074e-03   -3.384716117113854e-03   +5.869279633928718e-03   +3.030884388731799e-03   +2.831110965419348e-03   +2.561871402345582e-03; +5.627679985089248e-03   +3.217652698500050e-03   +5.207713080839658e-03   +3.306557596952334e-03   +1.376695964002324e-02   +1.730411230163141e-03   +5.812847629701189e-03   +1.625308051466693e-02   +7.358064590788280e-03   -8.466971219085459e-04   +4.518127232314866e-03   +1.031034840915188e-03   +8.632753104084600e-03   +4.911158598917122e-03   +5.279307945973448e-03   +9.098688688502816e-03; +4.373770329979467e-03   +1.148097079221889e-02   +8.324286735958700e-03   +4.697633753091495e-03   -3.795966054165406e-03   +4.751455339566394e-03   -2.051083975184245e-03   +7.796288727051466e-03   -6.222090378326548e-04   +7.216528376574001e-03   -1.304546731713068e-03   +1.096988737769688e-02   +7.820193968401832e-03   +4.548484480506198e-03   -1.551273120336596e-03   +3.814484008667847e-03; -2.561927195050338e-03   +1.072206695524553e-02   +9.505938729779241e-03   +1.565826761752608e-03   +2.452368492361276e-03   +3.564851590957041e-03   +2.191510339175460e-03   +1.056581126424530e-03   +5.849840247299024e-04   +1.211554771754352e-02   +2.100345005754244e-03   +2.479050418706242e-03   -1.508988636781436e-03   +1.571589422640680e-02   -2.414547516953701e-03   +2.005878325545920e-03; +6.981237697983011e-03   +9.169208739245884e-04   -3.925773394350965e-03   +9.512384295776768e-03   +3.545496841335048e-03   -3.723704249262957e-03   +9.292524118704806e-03   +3.675554374349748e-04   +2.816986842239866e-03   +1.039442473454305e-02   +9.886407692559980e-03   -7.611749098047194e-03   +1.798485960696130e-03   +4.181667911758087e-03   +1.155043601669555e-02   +1.229299346754154e-02];
L1E_L1I_iGABA_netcon = [+3.962114425603442e-03   +9.538840452903700e-03   +4.462447209274471e-03   +6.494205042330509e-03   +6.813845784021700e-03   +5.328119848214212e-03   +9.170991905857483e-03   -4.376168362614759e-03   +2.392218971170514e-03   -4.045162944589871e-03   +2.717688519935849e-03   +4.293423356717761e-03   +9.945353855286273e-03   +1.329311965261560e-02   -3.968683330150407e-04   +6.421630025750681e-03; +1.480591005177342e-03   +1.527026182268591e-03   +8.836628896314296e-03   +8.056235865393760e-03   -9.709276893413508e-04   +2.523426176251663e-03   -1.152778011421007e-04   +1.025739105893934e-02   +6.951961690851010e-03   -7.204729366941814e-03   -4.497356185530968e-03   +9.047318226289304e-03   -4.729297617999223e-04   +2.588730141454128e-03   -3.723616394978800e-03   +6.559452300330988e-03; +6.829434491364446e-03   +9.791974299700423e-03   +3.116004864738294e-03   +1.994260015536515e-03   +1.667593794258687e-03   +4.648769603923424e-03   +1.005389181309557e-03   +2.500444896990210e-03   +3.588516414405679e-03   +5.562616002452695e-03   +6.456516274483868e-03   +4.725846311083957e-03   +8.908457384913835e-03   +1.015196743738521e-02   +5.319916629538310e-03   +9.894878323482946e-03; +6.839325690576264e-04   +5.168145982644852e-03   +1.150238841660143e-02   +1.898631709794094e-03   -3.247987249072136e-03   +7.483624424042219e-03   +4.879862131252632e-03   +7.544440986318303e-03   +1.060154365155428e-02   +7.187020661843969e-03   +1.305319457014190e-02   +3.465696988620664e-03   +3.926858569359861e-03   +4.941149843482947e-03   +6.074839157169869e-04   +7.566745481607768e-03; +3.769061502974069e-03   +9.146767679462304e-03   +4.778154453295441e-03   +6.213311608128969e-03   -1.161659569465872e-03   +7.801142023952943e-03   +6.119714998001664e-03   +7.451032264717701e-03   -8.205882592874436e-04   +2.867165828577723e-05   +6.297877979933834e-03   +2.736873063544089e-03   -3.723021812768497e-04   -4.140132510399192e-03   +4.927875266360407e-03   +4.876007728938016e-03; +7.267848009771332e-03   +6.704865375947380e-03   -4.573007023456048e-03   +8.577242974252483e-03   -3.705706302090724e-03   -2.441697855104040e-03   +1.347054494199415e-02   +5.468522290665051e-03   +6.674032380534998e-03   +2.726306804540763e-03   +1.089579831602535e-02   +2.790272293056005e-03   +5.254005405991980e-03   -1.481263509898351e-03   +1.228569452500752e-03   +1.864731581104651e-03; +6.317890774013777e-03   +2.294743015363190e-03   -1.362084143918135e-03   +4.789653007128212e-03   +6.539150630895042e-03   +5.392132949780984e-03   +8.679392612478978e-03   +6.954011065913472e-03   +3.755979426598734e-03   -1.014086379504195e-03   +8.117781037956935e-03   +1.148248560532323e-02   +7.281656208187387e-03   +4.323876492858602e-03   +3.886443557904130e-03   +1.759400285545796e-03; +5.471721043513064e-03   +3.360392923647604e-03   +6.432463413459202e-04   -1.528469677343627e-03   +5.222792685164237e-03   +3.810550059597767e-03   +1.083652269896139e-02   +8.990251012621235e-03   -6.853289406761914e-03   +3.412500902756685e-03   +4.508258267634194e-03   +5.518532431294456e-03   +2.235398156848106e-03   -5.382537631084196e-04   +6.081743092073760e-03   +6.731010667959798e-03; +5.492983428012310e-03   -3.063887275808128e-03   +1.231945793088502e-03   -7.727866656349112e-03   +8.901239565862733e-03   +8.971716326055656e-03   +1.354165750807626e-02   +1.131331507846814e-02   +2.237719580597487e-03   +6.730836518357724e-03   +9.392158329625547e-03   +3.223098074369396e-03   +8.241517256309894e-03   +8.851761337364842e-03   -1.034570903300077e-03   +6.177296678931916e-03; -3.047949598164461e-03   -5.386036759663427e-04   -6.907817118961006e-03   +6.642152278243682e-03   +3.781434625450099e-03   +1.345994001249890e-02   -3.960609508851835e-04   -2.162407257987400e-05   +7.882063806456396e-03   +9.990284564979754e-03   -1.275617685840440e-03   +1.540045507521054e-02   +1.060416796394658e-02   +4.089884562444027e-03   +9.724679431959801e-03   +5.643850639732027e-03; +9.192443700843272e-03   -4.371763762794901e-03   +4.144760230344433e-03   +9.635352808003599e-04   +7.205064587393346e-03   +2.380799522975158e-03   +1.067736759333100e-02   +1.191107621824467e-02   +1.669545730751606e-03   -1.495492427780267e-03   +5.815872100731750e-03   +6.723662474117587e-03   +5.236738829030650e-04   +8.410276533137109e-03   +4.557603347805498e-03   +5.411581644096951e-04; +5.400275880175919e-04   +8.880736101749866e-03   +1.041002763224390e-02   +2.998924555880345e-03   +1.465500098100871e-03   +1.452911127654249e-03   +7.283138358743940e-04   +3.604956414330084e-03   +7.446341526826269e-03   +7.165971649928356e-04   -3.817543101395258e-03   +3.830935521318884e-03   +3.924816127764634e-03   +4.893392908345678e-03   +5.705868945650524e-03   +1.335218684873473e-05; +1.007797198295554e-02   +2.434150695576510e-03   +8.568371778449883e-03   -1.915601706878995e-04   +5.955988369850907e-03   +1.481997368880146e-03   +5.172541126174248e-03   -3.519766417503263e-03   +6.968986985097039e-03   +3.436196822145416e-03   +2.544560702506942e-03   +7.026957928206068e-03   +6.694178013109411e-03   -7.842260849361996e-04   +4.022691041892863e-03   +4.662546372155090e-03; -3.733549705722116e-04   +1.972670222237029e-03   +7.622578710231885e-04   -6.253292048013741e-03   -3.533248071107954e-03   +9.409079810411881e-03   +1.371109106473173e-02   +6.433386711252187e-03   +4.467062591296905e-03   +9.761266134272653e-03   +7.181983661444398e-03   +1.084013122688532e-02   +1.181648725130826e-02   +8.901042037117038e-03   +7.065660963326014e-03   +1.170093236817765e-03; +4.987742747606963e-03   -2.516334400335540e-03   +2.628727226048248e-03   +1.005314814821931e-02   +6.371098925494607e-03   +4.693917499920800e-03   +1.347267884942606e-03   +1.215220818393644e-03   +3.145978760576255e-03   +4.217889191303758e-03   -1.330370616840129e-03   +1.181688897118292e-02   +4.274523901240529e-04   +7.271259430205802e-04   +4.087891152929440e-03   +7.553241250877444e-03; +4.783366690310116e-03   +4.797805821520037e-04   +1.394219307799624e-04   +1.765651475089054e-03   +8.375737857962208e-03   +6.809596702310844e-03   +3.790702292807984e-03   +7.137803032907836e-03   +9.177049962264519e-03   +4.507368238256048e-03   +1.511445127851027e-03   +4.405088199649377e-03   +7.512479491121249e-03   +7.640767499309481e-03   +6.074375792452168e-03   +1.157428518874562e-02];
L2I_L1I_iGABA_netcon = [+9.411168775042045e-03   +1.295993320430837e-03   -1.607505110759649e-03   +1.322755521982872e-02   +6.240513428644433e-03   +6.098316890095034e-03   +7.052619885946290e-03   +7.265417896558988e-03; +8.155895132182473e-03   -1.110531624316308e-03   +2.812579690886320e-03   +1.358931766779556e-03   +3.138931492959155e-03   -3.327319076230034e-04   +5.597522421518984e-03   -3.160625392946469e-03; -8.286755355318988e-04   +7.755293743826890e-04   -3.797012517369867e-03   +8.744201161253660e-03   +1.162997089961577e-02   +1.664390021292259e-02   +4.670669104991441e-03   +6.635902013055537e-03; -3.650360394818249e-04   +2.274279656166919e-03   +8.594701296868913e-03   +6.449474533669546e-03   +6.725450888683178e-03   +7.161346155590544e-03   +6.214565788345149e-03   +1.284751997471543e-02; +9.384860968317402e-04   +3.479667537800903e-04   +3.539282495815487e-03   +5.754089978543628e-03   +4.477887158773001e-03   +7.918253705409967e-03   +3.332452924468334e-03   +1.318104822083620e-03; +1.330389227527736e-02   -2.087572689994753e-03   +5.795618965603891e-03   +1.046367810326603e-02   +7.998874512552686e-03   +6.918650181756203e-03   -2.057993669610036e-03   +4.024021220092487e-03; -3.838741327539405e-03   +8.543586600205258e-04   -2.397175331022939e-03   +3.661868559046801e-03   +4.527939403731337e-03   +5.983651783781023e-04   +2.080831646827766e-03   +8.408197605782600e-03; +1.027391764095264e-02   +1.065968750299092e-03   +4.834265501396937e-03   +9.232085363947314e-03   +1.503664893007578e-04   +1.189028825887827e-02   +1.626847054652078e-03   +3.675489523044365e-04; +2.868288349560549e-03   +2.041594406564572e-03   +2.928193072030871e-03   +1.480760432330061e-03   +3.089553170026169e-03   +7.821765794923737e-04   +1.072290837759398e-03   +1.014478030467176e-02; +3.645074437921302e-03   +2.240928243132303e-03   -4.583190260061428e-03   +4.905972266273908e-03   -4.027977070719190e-04   -5.684761927460495e-03   +8.916804594209356e-03   -4.715351740068457e-04; +9.550270384771171e-04   +8.795278087108780e-03   +1.078744874859146e-02   +5.933983591173994e-03   +8.382512108833033e-03   +7.534995133996743e-03   +4.016718533529732e-03   +4.015672280941997e-03; +9.693543165266976e-03   +4.507664460806105e-03   +3.571505429335583e-03   +4.022915233283470e-03   +1.437904018428882e-02   +3.703691578318529e-03   +8.124203159369093e-03   +7.499545529018180e-03; -6.574814981352942e-03   +4.518316845661962e-03   +8.261495291259613e-03   -1.260484693647322e-03   +1.536778712988316e-03   +1.623290944908038e-03   +7.178063592131188e-03   +9.028871047021172e-03; +2.715150144754350e-03   -1.631502510687696e-03   +8.345739525636645e-03   +3.710090934003429e-03   +6.728504451620726e-03   -1.966808611348133e-03   +8.459508498190339e-03   +6.629407470387703e-03; +9.428215055522359e-04   +1.569862372861119e-03   -6.840681316260466e-04   +8.703375123808494e-03   +7.806776244028467e-03   -4.211409202924358e-03   +9.220622332821934e-03   +2.438748598043751e-03; +1.833945659078691e-04   +4.044117857945079e-03   +7.352695414781510e-03   +4.392974216062260e-03   +1.044456413467434e-02   -3.114361835839660e-03   +6.710914621575821e-03   +1.274956908871632e-03];
L1I_L2I_iGABA_netcon = [+1.173723348106719e-02   +9.887053749064446e-03   +2.209467883453766e-03   +5.296647187375629e-03   +1.330193465626848e-03   +7.686920302419704e-03   +1.480304212080890e-02   +8.829010100090632e-04   +8.650403378917293e-03   +6.047595040864421e-03   -1.602413696574972e-03   -2.887208353597751e-03   +1.017692870964236e-02   +3.665517709273943e-03   -5.113884384282502e-03   +1.306465391126089e-02; +6.425850112375075e-03   +4.214219556803759e-03   +3.145588767252607e-04   +6.833858978544220e-03   +6.477519112409638e-03   +6.328814891988392e-03   +6.081657215465971e-03   +1.027255138258716e-02   +1.542659166695493e-03   +1.240957345311159e-02   +7.288393054669936e-03   +2.808375664644273e-03   +2.481333644270011e-03   +7.729783007193131e-03   +1.737969083455962e-03   +6.585593710701524e-03; +8.578869876578941e-03   +3.156873748035807e-03   -1.206189227523142e-03   +7.036256199947744e-03   -3.887974781775319e-03   +8.259351011689417e-03   +7.738894520165657e-03   +8.947879437156436e-04   +3.480551837268220e-03   +9.872614588053564e-03   +6.495608843590005e-03   -1.037070391020635e-03   +4.526723957464000e-03   +1.417711507468406e-03   +5.678082607641909e-03   +6.696811531295041e-03; -1.126346543098006e-03   +5.259437680218634e-04   +9.753106714356992e-04   +3.656670918337630e-03   +3.378452901495365e-03   -3.088520653602067e-03   +4.876600037375761e-03   +7.515274319143215e-03   +2.345914529023769e-03   +1.614271805017254e-03   +8.236342550173345e-03   +2.933626675662585e-03   +6.008586935366526e-03   -3.793217765651007e-03   +3.116878758758332e-03   -1.129778840712812e-04; +5.299565866527440e-04   +5.077186963420262e-03   +6.572687059367164e-03   +3.863476512022456e-03   +4.840296539239127e-03   +6.097387100611389e-03   +1.123214738216334e-02   +1.606066969437561e-02   +4.860678837058952e-03   +4.697060901953999e-03   +7.722770812796269e-03   +5.287068506464957e-03   +1.211966294373899e-02   +4.711768901340171e-03   +2.220352806327662e-03   +3.598128582713641e-03; +1.059450494264546e-02   +7.818736505834563e-03   -5.304495142716130e-03   +7.989620671421524e-03   +1.090507959970468e-02   +7.799992501235988e-03   +1.360311973219878e-02   +4.892819046772730e-03   +5.281135762174545e-03   +1.075885519638441e-03   +2.439316203952551e-03   +6.609310913556532e-03   +1.833111219127210e-03   +1.261833668500116e-02   +9.765507872525768e-03   +2.850447371660985e-03; +8.014358753158467e-03   +4.150477463444408e-03   +9.483581278160373e-03   +5.089389200803813e-03   +1.080247624318035e-02   +1.185088992007290e-02   +4.970508524078899e-03   +3.467742904527743e-03   +7.482112420067071e-04   +5.489963178910007e-03   +1.829746152770683e-03   -8.604392295599194e-04   +5.036324936501723e-03   -2.513912495669105e-03   +7.396498699682056e-03   +2.608916738704435e-03; +8.392485333325818e-03   +4.349811438757945e-03   +6.503294038633612e-03   +5.247421019812354e-03   +5.892266472960542e-04   +5.076918516013075e-04   +5.489525014659880e-03   +4.811526367863053e-03   -1.321906916046918e-03   +5.542702568805008e-03   -1.088753157473956e-03   -4.715734074843365e-04   -3.335523938668853e-05   -6.556981494557860e-04   +3.957503775054885e-03   +5.900294730249732e-03];
L2E_L1E_iAMPA_netcon = [+5.164430580059331e-03   +3.256911229265145e-03   +3.799330404438227e-03   +3.078391426243548e-03   -2.016120382969979e-03   -1.243635898800879e-03   +5.751061516542094e-03   +1.733942597576742e-03; +1.067904827115907e-02   +8.013880994383460e-03   +7.889469652658713e-03   +1.002880869481700e-02   +9.138876556120806e-03   -1.791126115496690e-03   +7.542289872922308e-03   +2.757054977767700e-03; +6.672773717394148e-04   +5.545424892141689e-03   +3.213511186352123e-03   +8.409929762244261e-03   -3.022172381751415e-04   +1.113384880270866e-02   +5.475444417824293e-03   +3.591243822226809e-03; -5.591286278210194e-03   +8.816981529094894e-03   +5.990277564432211e-03   +1.087921183484672e-02   +9.651351259675846e-03   +4.790420484642092e-03   +5.012918413401864e-03   +9.389754289412865e-03; -2.283677662818672e-03   +1.022258575681124e-02   +8.727649807808578e-04   -5.263710482351975e-03   +6.899860152061440e-03   +3.964469075392413e-03   +1.319326768032517e-02   +2.081561005314797e-03; +2.273688527597079e-03   +5.361481087792524e-03   +1.152833338683528e-02   +1.032671658032958e-02   +1.063376102729034e-02   -4.008731220791293e-03   +2.835570893669211e-03   +3.942456490457586e-03; +2.743093035801814e-03   +7.040533759136722e-03   -4.048955928340430e-03   +3.894125582961832e-03   +3.588474270257542e-03   +4.279624141667417e-03   +3.434067548161555e-04   +6.350565601557963e-03; -4.397747640071493e-03   -5.141017324087734e-03   +3.286721705840423e-03   +1.218819837192187e-02   +5.265602162294429e-03   +5.748637014471696e-03   +9.520145348670359e-03   +6.274303982483822e-03; +4.832943342432196e-03   +9.297165760978861e-03   -3.481766932210696e-03   +6.640274364758942e-04   -3.030720818203470e-03   +8.652979055308785e-03   +8.034133680756271e-03   +6.892124480907058e-03; +1.006218098169632e-02   -1.976568772682390e-03   +6.950321390852564e-03   +5.362311682750989e-03   +1.525017548888018e-02   -8.529724545275089e-04   -5.012782414967876e-03   +2.953848666805007e-03; +8.171909406016923e-03   +6.208932830431052e-03   -4.258030165941152e-03   +4.167021105927617e-03   +8.468498836179747e-03   -1.230672804481419e-03   +6.221380811995747e-03   +7.011045534409048e-03; -6.100804610284059e-03   +4.455700995341256e-03   +9.744275291029779e-03   +2.404680734873461e-03   +8.211886644223738e-03   -2.405609582755206e-03   +1.365300211487625e-02   +2.453615731174167e-03; +3.328076900445174e-03   +5.492927400243435e-03   +1.053613226775144e-03   +3.789885649238926e-03   +1.749610014945375e-02   +6.085438136338098e-05   +6.816213033335839e-03   +8.759712664346116e-03; +1.830414943041197e-03   +3.060380713506351e-03   +3.455789489193680e-04   +2.041489759205303e-03   +1.480891723795993e-03   +3.769088141562698e-03   +2.078368236975469e-03   +1.285610255504775e-02; +1.437804048928624e-03   +3.693454954759118e-03   +3.667365360675507e-03   +8.397271167048812e-03   +2.064404328229370e-03   +7.799519209934244e-04   +1.050188125597649e-02   +3.556183706791328e-05; +5.909891107735024e-03   +6.228834523066294e-03   -4.725298385034413e-03   +3.233588048456780e-03   -6.114860598490010e-03   +1.084657672321336e-03   +5.828348451798075e-03   +1.318206351617543e-02];
L1E_L2E_iAMPA_netcon = [-1.808455908114139e-04   +1.577013573516333e-03   +2.933423665907016e-03   +8.556750557590805e-03   +1.319687491040748e-02   +1.248305112190087e-02   +5.994076753790819e-03   +1.108359238099391e-02   +6.825725578214169e-04   +1.661814293328214e-03   +4.421390658033432e-03   +1.557246254730021e-03   +5.480688614267789e-03   +6.140326173289217e-03   +3.087403237160300e-03   +8.707552196369043e-03; +5.598354289013703e-03   +1.009556130352309e-02   +7.749045268623541e-03   +9.026528975144643e-04   +2.211478971432016e-03   +9.667825183931129e-03   -1.240313060658154e-03   +1.343847780865408e-03   -2.993325309949497e-03   +7.367778630550090e-03   +1.876925761319348e-03   +1.478619044264843e-03   -3.220271837407328e-03   +5.650405026381347e-03   +6.088027816143513e-03   +3.321375987414618e-03; +4.569897371969927e-03   +4.119920333219174e-03   +7.477596693225541e-03   +1.174539363048779e-02   +1.209076925190968e-02   +4.080171074311402e-03   +2.270533180177579e-03   +2.612113984184680e-04   +2.086241634780445e-03   +6.887591137688170e-03   +3.340683612687166e-05   -3.008565577591849e-03   +5.801924595448055e-03   +2.162292977547242e-04   +1.233767634178732e-02   +1.520350160313627e-03; +7.324340320056603e-03   -2.891287440170628e-05   -2.594849127185828e-04   -6.995466568581517e-05   +6.164146479254416e-03   +9.214074123706952e-03   +1.002051015336292e-02   +4.304753437605323e-03   +2.810130310420334e-03   +1.142551554556897e-02   +6.157236974215892e-03   +8.898335376708753e-04   +7.708601832231028e-03   +3.002857105479352e-03   +8.945689544508712e-03   +7.876466829773250e-03; +2.110896574083823e-03   +4.292890521040166e-03   +5.292212829398096e-03   +4.815593788709436e-04   +3.170028859280471e-03   +5.945731032647159e-03   +6.516193698177451e-03   +3.217078046764051e-03   -1.031925948494936e-03   +1.960352643885315e-03   +2.492533275607414e-03   +1.140622066433898e-02   +1.330878736485656e-03   +9.884828309026190e-04   +1.096779876267894e-02   +7.680113496702978e-04; +6.296241210595585e-03   +1.066175745604684e-02   -2.531273786319389e-03   +9.013492354989361e-03   +1.807211217859717e-02   +7.433474974670590e-03   +5.206156999833246e-03   +8.088303081262604e-03   +3.571244273118697e-03   +1.513244319353039e-03   +7.314214455207998e-03   +8.931722220623507e-03   +1.038445585003053e-02   +1.330350818249218e-04   +4.073427603611012e-03   +9.114788583914780e-03; +3.797178095173714e-03   +3.460331084756689e-03   +6.108930464485114e-03   -3.802881141396229e-03   +1.430574690550232e-03   +2.300123704567076e-03   +7.961864855145601e-03   +1.184515699635913e-02   +4.383907806612014e-03   +5.479980051450103e-03   +1.901954772141692e-03   -3.427103079084077e-03   +7.764347326438899e-03   +4.989033424624998e-03   -1.391163096537756e-03   +5.205143448995459e-03; -2.704722643616267e-03   +4.838690937373290e-03   +6.725648690851637e-03   -8.119783313076412e-04   +4.154138733306401e-04   +8.270737896442726e-03   +1.301992240814718e-03   +1.279903843604450e-02   +4.445991083204657e-03   +4.802070649499690e-03   -4.482904833563403e-03   +9.484073244853383e-03   +8.083162816593398e-03   +4.145117648392534e-03   +1.826563068109170e-03   +3.836839352693485e-03];
L2I_L2E_iAMPA_netcon = [+6.900122796577689e-03   +9.962704122618321e-03   +2.988867140466002e-03   +9.099691537090502e-03   +8.076553217310767e-03   +6.487972360251278e-03   +2.987015706203629e-03   +3.773478056542074e-03; -5.823732757609756e-04   +4.380520544033654e-03   -6.644979831630338e-04   +9.325185777858390e-03   +2.337948157093662e-03   -2.427495605818424e-03   +2.693810364179336e-03   +5.667478788446384e-03; +9.572143832802688e-03   +5.289427447806523e-03   +4.793403377939158e-03   -4.473795928303438e-04   +3.827587216389433e-03   +6.693152400892737e-03   +7.219180736583015e-03   +3.340230780607473e-03; -4.008095932329508e-03   +1.089412122090364e-03   +9.025718832238579e-03   +3.116567967951011e-03   +7.643430456882755e-03   +5.181189350127778e-03   +3.538756231229081e-03   +9.322155866869707e-03; +4.836665465046643e-03   +4.462271499396833e-03   +5.506145180195867e-04   -3.227118512068534e-03   +1.157947493582463e-02   +4.029224691827174e-03   +2.272021703267493e-03   +2.718210162752309e-04; +1.831361315547665e-03   -1.841212767803081e-03   +2.194925442077176e-03   +3.799764779069030e-03   +8.080064087526704e-03   +9.702509936541759e-03   -4.204099222887435e-03   +9.810660713556071e-03; +8.922788255408936e-03   +1.078766612196734e-03   -1.587704664958716e-03   +1.320317143680067e-04   -6.232359970558902e-03   +4.279496029998506e-03   -2.379175786533913e-03   +9.071393213221861e-03; +4.805031063862692e-03   -4.022425438943901e-03   +3.496891426867047e-03   +8.040086383881576e-03   +1.206651654349867e-02   +6.436607219205729e-03   +8.426519091994681e-03   -3.406439223011816e-03];
L2E_L2I_iGABA_netcon = [+7.587807705141768e-03   +2.146958320060048e-03   +2.820307191830350e-03   +3.139659427858460e-03   +1.394951738520296e-02   +1.896031510609039e-03   -9.161299989708335e-04   +6.697931296249256e-03; -3.161150778241168e-03   +6.139879955808736e-03   +5.390842735460409e-03   -2.818979611645807e-03   +7.397116568790892e-03   +9.329219508337363e-03   +8.399312093899628e-03   -5.249498039896128e-04; +8.023876529728289e-04   +1.283184758599119e-03   -1.352250555092521e-03   +6.752964690993742e-03   +9.795439875050254e-03   -1.519028917980453e-03   +9.671623432526031e-03   +1.284791635463924e-02; +1.182323861522555e-02   +3.119441736993316e-04   -2.197066905193876e-03   +6.387185438830797e-03   +7.824628162754681e-04   +4.769420313136824e-03   +5.864616891294376e-03   +6.652610269639340e-04; +1.584849988790421e-03   +3.790484133465450e-03   +7.546302706536314e-03   +6.702537501747641e-03   +4.086231010844679e-03   +2.942595480509271e-03   +7.685406363618392e-03   +9.997152137093692e-04; +6.286579790875132e-03   -4.915025019894800e-03   +6.362546007581968e-03   +9.544746162496096e-03   +8.689837784343974e-03   +2.392844996728987e-06   +8.288117183510741e-03   +9.152428954879253e-03; +6.911497704922626e-03   +7.803188119509002e-03   -4.470109075791014e-03   -3.850611108478513e-03   +4.298426940155298e-03   -3.564417165932948e-03   +2.204636158233699e-03   +3.249003386507547e-03; +8.823244837270103e-03   +5.113535965120696e-03   +3.394345625494911e-03   -5.357577302996568e-03   +2.839518492148591e-03   +9.017218978961903e-03   +6.188954356188518e-03   +7.147956292356438e-03];
L3E_L2E_iAMPA_netcon = [+2.927858910882621e-03   +1.320063854051742e-02   -7.183205409981019e-04   -2.902575292970388e-03   -5.651086779698544e-03   +4.462460104745923e-03   +6.499108545190568e-03   +9.122480239811600e-03   -1.601377245799669e-03   +1.702421594567067e-03   +2.220518456110577e-03   +6.363335631548359e-04; +3.239669249098053e-03   +1.349818635923052e-02   +9.433029456727962e-03   +1.862041406775590e-03   +3.369166042469825e-03   -2.414609197161398e-03   +1.057893158043673e-02   +7.044128616622336e-03   +1.173063750251700e-02   +8.452646374322515e-03   +1.059253508404439e-03   +2.038255263820820e-03; +1.018197395517455e-04   +6.731129075352808e-03   -4.547791479933065e-03   +6.907593687844570e-03   -1.775393617062774e-03   -5.092927411933325e-03   +7.801014987456268e-03   +9.490160942318712e-03   +7.371637367364642e-03   +8.024349476609132e-03   +7.452087683650870e-03   +7.435536658251270e-03; +4.398075612430078e-04   +3.642908738412339e-03   +3.799391568033329e-03   +1.286482441537678e-02   +2.190655738962565e-03   +2.099446005451029e-03   +4.456998013680599e-03   +1.605500111355912e-03   +3.942743106550066e-03   +7.971826074118738e-03   +1.472915008536719e-03   +2.271095755696263e-03; +6.226073830542129e-03   +2.218541379347171e-03   +5.688867182119569e-03   +1.076769168395032e-02   +5.602127350680310e-03   +7.412357996616045e-04   +1.011282039586830e-02   -5.120235023601925e-03   +2.711652583615859e-03   +1.229734688872963e-02   +9.432807507889922e-03   +4.842397135932703e-03; +9.209505205167867e-03   +3.919764634598585e-03   -9.793195749585048e-04   +9.155448273804679e-05   +2.647906419977809e-03   +1.614198326564658e-02   +1.209263931363996e-02   +7.551532706141082e-03   +1.027923508403911e-02   -2.107231836206610e-03   +8.551975952595259e-03   +8.496811737862206e-05; +5.466640244333706e-03   -3.538421016592011e-05   +7.611818405463279e-03   -3.246515781349302e-04   -6.545170800348894e-03   +5.310073644410085e-03   +2.793750864162518e-04   +7.545347232866539e-03   -9.562147116051252e-04   +5.320694490523841e-03   +1.789765750576133e-03   +6.113213633277588e-03; +1.036051853317393e-02   -3.574367806049916e-04   +1.010320100569047e-03   -3.050534801079131e-05   +1.165509178654339e-02   +5.931658844145822e-04   +3.467706646079650e-04   +1.366273850902899e-03   +2.103762638073243e-04   +8.401838329168252e-03   +2.217533715543481e-03   +1.894291659374709e-03];
L3I_L2I_iGABA_netcon = [+4.473142845775137e-03   +7.065698814716932e-03   +1.275798073725242e-02   +7.663563164819380e-03   +9.707844847849728e-03   +2.054387020530690e-03   -2.334942217307740e-03   -6.479000233901598e-03   +5.112072554664017e-03   +5.666421203047255e-03   -5.452032987801629e-03   +1.672967571212232e-02; +5.443309834641558e-03   +5.737772284881164e-03   +7.819255397270752e-03   -1.883082096330849e-03   +8.587078306704033e-03   +8.062259229841762e-03   +5.391103543322662e-03   +1.602501237193852e-03   +6.707665440860018e-03   +4.111192296013112e-03   -3.263036727136836e-03   -3.129202875289524e-04; -1.047894528074505e-03   -1.444894892941221e-03   +1.144211996829974e-02   -2.143676054702552e-03   +1.348592434384975e-03   -6.886205737298680e-03   +3.933211224604289e-03   +3.658154436272194e-04   +1.061977632960779e-02   +3.578159614180307e-04   +3.591898848219489e-03   +4.539050665513356e-03; +1.572431048193345e-02   -1.422915151292602e-03   -3.060685798231909e-03   +7.648500956871276e-03   +5.881509818527513e-03   +7.412307438759692e-03   -5.659448922704119e-03   +3.153783866225865e-03   +7.117547551677961e-03   -2.442598463288435e-04   +1.016832786034129e-02   +1.313300923980593e-02; +1.803270746086766e-03   +6.771364170084126e-03   +1.633401566287183e-04   -5.574363222055366e-03   -2.149241503455293e-03   +1.396970029503542e-02   -4.945187775156400e-03   -6.772669421937537e-04   +9.176028986086436e-03   +1.449122404703506e-02   -5.217169276569594e-03   +3.185941099155556e-03; +7.816249824519786e-04   -1.373154285229086e-03   +7.789383034755468e-03   +3.411471148451865e-04   -7.535922201978220e-04   +4.369452000664712e-03   +7.247524991737142e-03   +5.825031841586406e-03   +1.911621859894362e-04   +3.848987238645640e-03   +3.315723903355840e-03   +8.430735301048194e-04; +5.498043706352444e-03   +7.029113023928885e-03   +6.545894764544159e-03   +7.476021580419345e-03   +3.434869994028322e-03   -4.815379107087673e-04   +3.825952139475149e-03   +8.087318850987381e-03   +4.280521360029996e-03   +7.045874416604791e-03   -1.926888447672751e-03   +9.752501810087176e-04; -1.090884966583810e-03   -7.208179831044987e-04   +6.353005432230968e-04   +6.528461925833664e-03   +4.503822189810421e-03   +1.447515167828248e-03   -7.544422797039842e-04   -4.764353538688510e-05   +1.357468056176474e-02   +4.506581993236902e-04   +5.550094426711593e-03   +4.129151521581312e-03];
L2E_L3E_iAMPA_netcon = [+1.041160876036768e-02   +6.835992963941492e-03   +3.266519603278876e-03   +6.310207404345348e-03   -3.515547286176811e-03   +4.245853006224330e-03   +1.054438132644746e-02   +4.438238575897689e-03; +7.069155178095868e-03   +7.283142027047447e-03   +9.538883157278237e-03   +8.181984918621491e-03   +5.984874028628737e-03   +5.112318494718571e-03   +9.849641309337603e-03   +3.870532802469930e-03; +4.296096562757997e-03   +8.106516482507606e-03   +9.784682027368728e-03   +8.150582480987484e-03   +9.037437922806047e-03   +9.071380060168947e-03   +1.013379788522511e-02   +7.275936707985120e-03; +4.074198316551092e-03   +6.172270034567768e-03   +6.892144731804143e-03   +3.332088587972557e-03   +2.370389756310983e-03   +5.177423287142678e-03   -8.475949696074243e-03   +7.401391517726886e-03; +5.996687083072732e-03   +3.093320744254938e-03   -3.544197291019516e-03   -1.250055758121784e-03   +1.061585831514395e-03   -8.163537803128431e-04   +1.037015048569038e-02   +6.976330109955903e-03; +9.102558491049507e-03   +6.142666731096790e-03   +6.790963121581074e-03   -2.075044128194585e-03   +9.540323797599018e-03   +1.416260948054055e-02   +3.118746574843854e-03   +1.001148107655263e-02; +5.352898790269647e-03   -1.140245616612943e-03   +1.170238394505945e-02   -1.486173692916946e-03   +2.563326369021226e-04   +1.087883559943978e-02   +1.572505708085190e-03   +6.894334502158333e-03; +1.542731798377278e-02   +3.385960677781250e-03   +7.261360588643782e-03   +4.724570429567520e-03   +8.630355008526080e-03   +1.073194482360952e-02   +4.524624129851869e-03   -6.804861477296845e-05; +7.118308585849529e-03   +3.366294613624227e-03   +2.165436529237633e-03   +7.855123979186737e-03   +5.836366617084867e-03   +8.417552302576944e-04   +7.522401309398224e-03   -1.293699860649897e-03; +1.509876918733745e-04   +4.663986962091194e-03   +2.972081773007056e-04   +5.061398382565219e-03   +7.887928807268962e-03   +4.565472415083647e-03   +3.362046300850405e-03   +1.059261477239466e-02; +4.609292401219761e-03   -1.403759761153579e-03   +6.517026790830695e-03   +9.478568147719009e-03   +1.734517908444018e-02   +1.119688581927488e-02   +2.295539226571849e-03   +4.555614306101274e-04; +3.664038405852554e-05   +1.056661982623658e-02   +5.840854330900673e-03   +6.601432644036575e-03   +4.772028934297116e-03   -1.230145505681708e-03   +1.136957250654901e-02   +8.013159155627312e-03];
L2I_L3I_iGABA_netcon = [+1.115709255959798e-02   +6.149347684768439e-03   +5.319589618773664e-03   +6.438642770810378e-03   +8.301084074725587e-03   +7.605924528476887e-03   -2.311103619604691e-03   +4.769194592491904e-03; +1.344084351803844e-03   +1.619942163601933e-03   +1.202793731668106e-02   +2.281846246257061e-03   +5.334597482139535e-03   +6.689319361195848e-03   -1.921435454000733e-03   +6.000205547439009e-03; +4.501766918168391e-03   +7.930487263251683e-03   +2.167957607761311e-03   -4.847704067642159e-04   -3.595010608646609e-05   +1.928200741343839e-03   +7.849033005125756e-03   -2.366842876134105e-03; -2.919926074988883e-03   +1.063010935359164e-02   +2.622016214261821e-03   +1.644842737212552e-03   -4.509535228598781e-03   -4.557448921886817e-03   +4.539271605578943e-03   +8.195340516213227e-03; -1.260320794676917e-03   -1.927077116440885e-03   -5.173127182721039e-04   +2.020096206534037e-03   +7.804672773644786e-03   +7.867849929655831e-03   +4.699363520779678e-03   +1.613771992104888e-03; -4.461877926200068e-03   -3.867777548204458e-04   +6.189758083091223e-03   +7.401498627126525e-03   +3.822676857947653e-03   +7.692107114566062e-04   +1.715930332014754e-03   +9.580404598233739e-03; +2.696185345863179e-03   +9.031627466255937e-04   +1.243711095265788e-02   +6.493490738236036e-03   +5.865903498401134e-03   +6.004865294498363e-04   +1.154970181056953e-03   +8.316021284806090e-03; +3.588826614981071e-03   +1.173235322665139e-02   +7.166062282872174e-03   +5.907452408154290e-04   +2.191396672637794e-03   +8.270273961866593e-03   +5.373203989306268e-03   +6.627781457807134e-04; +1.015961931496948e-02   +2.246035223482400e-03   +1.243358428585761e-02   +3.663335672954000e-03   +3.884045467350268e-03   -3.951287025954747e-03   +1.442439602884266e-03   +4.723282340488341e-03; +7.591022503106309e-03   +6.012114554738000e-03   -2.415681584523573e-03   -7.862795216224284e-04   -2.080524363563757e-03   -4.698522380357931e-03   +3.317446189637789e-03   +9.545350330059483e-04; +6.503014598505437e-03   +6.942427601029467e-03   +1.046935242015999e-03   +4.677751624144555e-03   +2.137436815199267e-03   +4.726004125943851e-03   +1.006387158549796e-02   +2.426527697842965e-03; +2.269773851412733e-03   -4.790321377188217e-03   +1.003365117983006e-03   +4.520232679437516e-03   +2.068332259552166e-03   +9.135406885982224e-03   +1.173974578577611e-02   +3.646323664467801e-03];
L3I_L3E_iAMPA_netcon = [+9.984708143876348e-03   +5.741440915767774e-03   +3.830936517975887e-04   +1.034759797269444e-02   +1.244177535360973e-02   +5.313073065088146e-03   +6.530826771293873e-03   -4.192680384511585e-03   +6.995740466160775e-03   +1.795245781386496e-03   -5.027655075907835e-04   +2.362520183218841e-03; +4.677423815686179e-03   +3.484536873596852e-03   +1.751481158292400e-03   -4.217671185355932e-04   -6.783886188114298e-03   +1.788179825059632e-03   +5.552670249631616e-03   +8.116565661971805e-03   -2.019852792833241e-03   +3.098014205072679e-03   +2.442872500713331e-03   +9.629461639198249e-03; +5.154590334497419e-03   +8.320469474814206e-03   +3.100174823736427e-04   +6.180376553991306e-03   +2.449107281558911e-03   +6.583880701909304e-03   +5.320739392697811e-03   +4.043027049848302e-03   +7.266498640607843e-03   +1.064820320695095e-02   +3.568078549692915e-03   +1.813993408562320e-03; +7.103432238048029e-03   +1.219645424013724e-02   +8.802131074523527e-03   +7.101627968397670e-03   +5.814504058509717e-03   +6.744261033797895e-03   +1.227511096811240e-02   +3.839234389239404e-03   +8.258114752088451e-03   +9.180123851018922e-03   +2.524154566038867e-03   +1.176686552338120e-02; +3.403246761357362e-03   +1.727673026678130e-03   +2.166148665782533e-03   +7.075608692184471e-03   +2.735354480699974e-04   +6.023380964437233e-03   +7.415120549800892e-03   +1.200362171288555e-03   +3.441958879652068e-03   +3.106398334004802e-03   -7.986370944889597e-04   +6.450903076648684e-03; +8.990251492033638e-04   +8.730687135326549e-03   +3.801497390421323e-03   +1.149300795048689e-02   +4.674509569699239e-03   +1.012224612413846e-03   +9.311852375610687e-03   -3.778289764763112e-04   +7.723867543011060e-03   +1.349690019438024e-03   -3.443287971238331e-03   +5.484132267097135e-04; +9.201090841361543e-04   -1.169327229541830e-03   +2.991704452732578e-03   -1.921204395116891e-03   +8.252548021276708e-03   -2.905223622354077e-03   -3.195279435599565e-04   +9.974125308204717e-03   +3.460410804021240e-03   +7.673092461076176e-03   +3.731793297770496e-03   +7.758239839869173e-03; +7.833323680202273e-03   +1.332476889478424e-03   +7.898693407137530e-03   +1.092437942543849e-03   +2.915675375170589e-03   +6.526198434615798e-04   -2.341735383063740e-03   -1.043996893590138e-03   -1.576682519310881e-03   -3.037578169548063e-04   +2.819757311772885e-03   +3.978088931594881e-03; -1.362297506620850e-03   +3.902912957923799e-03   +6.692676446777894e-03   +7.265989422546333e-03   +2.567709180585769e-03   +6.923309665623865e-03   -2.891872148552839e-03   +9.465241701976698e-03   +1.279966367745522e-02   +8.701093241181341e-03   +5.816196631124863e-03   -2.305961409829693e-03; +3.310702986269667e-03   +9.772184766886280e-03   +8.731347932036193e-03   +1.829758378966561e-03   +6.496490630271851e-03   +9.583095035805362e-03   +3.901090187732797e-03   +1.398871723581268e-02   +7.716019418713046e-03   +1.892674082400748e-03   +7.873173357410907e-03   -1.603115818670338e-03; +5.564911792753403e-03   -1.103999769689256e-06   +1.482003262971712e-02   +5.796744516084527e-03   +1.097958225572921e-03   +5.148932180161925e-03   +6.784003277117025e-03   +5.680129538703251e-03   -5.686940075450383e-03   +9.618816612144308e-03   +5.356080302063993e-03   -1.745461996692186e-03; -6.466694364922703e-03   +1.041232760391820e-02   -5.148276340794155e-04   +6.683774652746956e-03   +7.029161418644760e-03   -5.282524030550001e-04   +1.220149042378951e-02   -7.126158713478253e-03   +3.344428461483123e-03   -2.391991650148776e-03   +1.238587392549872e-02   +5.433480451002043e-03];
L3E_L3I_iGABA_netcon = [+5.426548605045967e-04   -8.085577832020669e-04   +1.283033213250334e-03   +9.869332966162082e-03   +6.467308283944962e-03   +1.460131019224437e-02   +2.859151271306008e-03   +3.398108044975373e-03   +6.895749872507402e-03   +3.957428088298314e-03   +6.959410523867823e-03   -1.184648398756529e-03; +8.918296870697206e-03   +8.225895658056408e-03   +3.404157565409295e-03   +1.397681181643027e-03   +3.911711799249830e-03   +4.137382258801018e-03   +4.730497296664297e-03   +5.425963889385372e-03   +6.224308905205478e-03   +3.921563547684960e-03   +1.186690964806045e-03   +5.817913980313279e-03; +3.698921250495675e-03   +6.978167867147326e-03   +6.113231921870571e-03   +2.049869382705155e-03   +2.741314858904949e-03   +1.040753898109669e-02   +6.017244663809128e-03   +4.716064702824147e-03   +5.498666212096632e-03   +5.262155599325223e-04   +5.578919996059588e-03   -3.200640418109704e-03; +2.897037955030776e-04   +5.605091945328736e-03   -6.288268653855839e-04   +1.039505808631343e-02   +7.033493189729646e-03   +3.185993594634331e-03   +1.207864360210737e-03   +1.676406384873233e-03   +9.198240873885228e-03   -1.868662565175465e-03   -4.222190952072887e-03   +8.063884404826869e-03; +1.731793248643356e-03   +5.725135336463485e-03   +1.306926421824040e-02   +4.554313115643103e-03   +5.294081586933456e-03   +4.425026360643935e-03   +1.019263948143816e-02   +1.031793865259424e-02   +7.248648161304811e-03   +1.028991777233637e-02   +1.462744611136383e-02   +3.045906746088228e-03; +7.290848055115785e-04   +5.333127611913064e-03   +1.141267711275749e-02   +3.607052781924127e-03   +2.120770965980668e-03   +1.239301778516254e-02   +2.948137216343283e-03   -7.807799843380794e-03   +5.662888622901591e-03   +2.910156823524864e-03   +5.732553680337045e-03   -2.071621535529388e-03; +5.154031613422623e-03   +6.685365377803655e-03   +8.959886280865050e-04   +7.792337179455587e-03   +3.875573534544055e-03   +8.779079006432556e-03   -1.044962413110292e-03   -1.231349507553524e-03   +3.695205966114814e-03   -1.562773408005315e-03   +1.935151109994643e-03   +9.982852691055919e-03; -1.329332688324076e-03   +3.813332918211061e-03   +6.765559508489804e-03   +8.535261556892739e-03   -3.633306161186501e-04   +4.417504469570753e-03   +2.268595048600287e-03   +1.966381472181692e-03   +6.484305620483527e-03   +8.897855542718699e-03   -2.078455688411586e-03   +6.999766625887450e-03; -4.338754619212862e-04   -2.338700831190952e-03   +6.773317919117453e-03   +2.715592257209978e-03   +7.699637748233947e-03   +4.446984596008422e-03   +1.988416862381705e-03   +1.225528601356940e-02   +2.211327020422401e-03   +6.047449487563402e-03   +4.638329360755983e-03   +7.768374941139952e-03; +8.508592931183081e-03   -3.316541719869530e-03   +6.889462998377919e-03   +2.002439482092816e-04   -4.431587798511175e-03   +7.514822236236639e-03   +7.551155296922178e-03   +7.988564539858535e-04   +1.097955196364659e-02   +1.035048945122385e-02   +5.497391211454246e-03   -5.212149155535471e-03; +4.209433005758927e-03   +1.210617957781248e-03   +1.316566792079169e-03   -1.474420527451673e-03   +7.126786440131929e-03   +3.281917102069671e-03   +1.551086990133644e-02   +1.922490322506374e-03   +1.172028679849014e-02   +5.633230750335428e-03   +1.426786330102533e-03   +4.190077741717861e-03; +1.157934410914131e-02   +4.381422611640177e-03   +3.344862167246930e-05   +2.665329925431760e-03   +2.526358151216916e-03   +4.764004613160910e-03   +1.298545541572389e-02   -2.610790977072912e-03   +1.467846294244871e-02   +4.020347497612157e-03   +1.937453251567458e-03   +2.690357779080326e-03];
L2E_Input1_iAMPA_netcon = [+5.058323282500088e-03   +1.244875453593205e-02   +1.027490698464073e-02   +6.496320861367737e-03   +1.301470457974181e-02   +1.104751460795856e-02   +2.981263592574072e-03   +5.056629722679912e-03];
L2I_Input2_iAMPA_netcon = [+7.216777815970512e-03   +1.117986577853218e-02   +1.172338995675074e-02   +5.232897970702801e-03   +5.326688500864036e-03   +5.095716279434931e-03   +7.946657865373486e-03   +1.105398725542755e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
