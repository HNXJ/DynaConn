function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.358119137396805e-02   +3.661468409859238e-02   +2.515407288975992e-02   +1.077894312489787e-02   -3.197593077879718e-02   +2.653364750387939e-02   +1.847614319549831e-03   +5.287038488630543e-03   +2.567702758478984e-02   +4.591376581406081e-02   -1.139386766080232e-02   +6.263685965442974e-03   +3.912276037453236e-02   +2.726616331326977e-02   +1.429132208081505e-02   -4.577324676190384e-02; +2.563308758005992e-02   -2.784282611688355e-02   +4.168535496448517e-02   -1.382441818757905e-04   -3.282583062228658e-03   +6.745567447949040e-02   -2.147777198806966e-02   -6.416251502007243e-03   +1.065576934903234e-02   -1.934286282339959e-02   +3.343183333988006e-02   -2.463457373636541e-02   +1.599868692703775e-03   -6.975324607788790e-03   +1.061316293429393e-02   +5.633145894469013e-02; -9.487898512841177e-03   -6.836812614924906e-02   -1.119059502951361e-02   +3.877690977623374e-02   +2.074755111593716e-02   -4.241554071894294e-03   -2.488426703414232e-02   +2.138917933785030e-02   -7.560915975690731e-02   -1.429322130667224e-04   +2.602513606329388e-02   -3.761965205872080e-02   +6.196298977152664e-02   +1.329738825788126e-02   +5.050440491281856e-02   -1.648635691176555e-02; +3.115608978870302e-02   +6.101252495451718e-03   -2.052143875956346e-02   +4.705052015270589e-02   +1.404162544345273e-02   -8.093344735099317e-03   +8.158481411945924e-03   -2.653678555407510e-02   +2.694407081572897e-03   -3.661986797751603e-03   +5.631143329417256e-03   -5.528356020380105e-03   -3.529011622341521e-02   +5.032452256987036e-02   +2.812506404913401e-03   +5.731891642335298e-02; +3.001838240351835e-03   -4.323260565644312e-02   -4.312658981369691e-02   -1.260318343155805e-02   -7.668287407889018e-02   +6.397385700603232e-02   +1.964467194996266e-02   +2.850580315214747e-02   +4.858599514377480e-02   +6.827353256885771e-05   +3.763212642771283e-02   -2.267231720107506e-02   -1.715575083660775e-03   +2.638196451111938e-02   -1.875925139895569e-02   -4.907187731859467e-02; -4.667315884136613e-02   +1.242941970169086e-02   +8.593170899037196e-02   +2.998766950539706e-02   +2.843957286846440e-02   +2.849009485993973e-02   +6.148141755810201e-02   -3.732491966676975e-03   +9.926003394577486e-03   -1.783698569559785e-03   +4.077507220338459e-02   +3.405909696409823e-02   -1.386453411576235e-02   -1.359546963943961e-02   -4.270448061715076e-02   -8.077436899302574e-03; +8.409980150864547e-03   +4.741047945723441e-02   +1.628698224953910e-02   -8.838950912481280e-03   +3.833246359187427e-02   -3.082143388887603e-02   -3.901286146050750e-02   -2.650572793895116e-02   -4.804343673852862e-02   -2.899618302821147e-02   +2.227101513303003e-02   +4.511704163482874e-02   -1.757451132356146e-02   +1.837201712622423e-02   -1.527639888695317e-02   +4.460097857472431e-02; +1.053327194863050e-01   +1.752696215536443e-02   +6.769334555602199e-02   -4.650183646794192e-02   -7.379392122244313e-02   +6.269331744118528e-02   +2.990243714631101e-02   +3.218764634204676e-02   -7.801363942470907e-02   -2.755844103480114e-02   +5.611728771507927e-02   -1.314852547064011e-02   -9.481972793879138e-03   +3.234735881440493e-02   +4.036412343981009e-02   -5.705842123788953e-02; -9.684539920622362e-02   -8.870082209815142e-03   +2.066749684388582e-02   -3.814988627155301e-02   -2.402109689146359e-02   +2.183284527228829e-02   +1.333841586448371e-02   +4.285410766150071e-02   -9.689343088688809e-03   -1.821182545947703e-02   -5.530019665844708e-03   -7.838465295857969e-02   +1.090281026549028e-02   -3.050837179041316e-02   +1.038557787210950e-02   +1.455656469884304e-02; +3.945839693190080e-02   -1.466677098503029e-02   +1.587215025155099e-02   -1.713285794709847e-03   +4.047088454851361e-02   +4.189871362770300e-02   +6.365274340948568e-02   -1.604474164594920e-02   +1.227938759396670e-02   -1.362489780370936e-02   +2.469985290814962e-02   +1.398198504094180e-03   +3.855877095819381e-02   +8.905163367232949e-02   -5.216595872340828e-02   -6.040316078818567e-02; +8.278901556785342e-02   -3.386859153418232e-02   -8.252846669502266e-03   +2.925339195481221e-02   -2.235610071224076e-02   +6.180559746832354e-02   -5.764916594170527e-02   -4.121369110389297e-02   +2.441535078570158e-02   -4.320274196302850e-03   -1.935929473207247e-02   +1.421439194801156e-02   +2.650708554074440e-02   -3.342987573249280e-02   +5.264456856318482e-03   -7.568876095511004e-03; -7.326662889073191e-02   -2.255934919519410e-02   +1.441703245337449e-02   -1.242959962939906e-02   -3.436632276916302e-02   +3.831434482581188e-03   +4.915353944655483e-03   +7.042075215749155e-02   -2.197548006120676e-02   -4.467506574199961e-03   +9.229385216242994e-03   -3.392471202203504e-02   +5.438028973229467e-02   +9.001221476003220e-03   -1.883436760104106e-02   -6.265404273216842e-02; -2.405576262467510e-02   -3.526604400787715e-03   +1.189346181274285e-02   +3.139840391456668e-02   -2.168184271469677e-02   -5.636691813419361e-03   -1.168496053430448e-02   -4.737422304114318e-02   +1.126165353182129e-01   -5.851650497818997e-02   -4.086422747373482e-04   -3.544075927352242e-02   +5.116806184122094e-02   -7.965058394473755e-03   +3.671268475716698e-02   -3.862517231129596e-02; +2.612484204604237e-02   -3.553596808557431e-03   -7.205682373417248e-03   -1.035116004884156e-02   +2.018995301262505e-02   -1.860665365211032e-02   +6.665334863064157e-03   -2.597557775824693e-02   -4.501066441739415e-02   +5.098463659401174e-02   -3.210860063767686e-02   -3.651320053928601e-02   +4.110661829796816e-02   -7.041719676868696e-02   +3.285101368522828e-02   -5.956107971738844e-03; -2.760098140705727e-02   +2.964999559896106e-03   -9.207428666751713e-04   -1.201977082718989e-02   +4.982228903843037e-02   -7.184786645602129e-03   -2.884376294869912e-02   +2.411848667960208e-02   +2.854817138230065e-02   +3.444636565696149e-02   +3.406948370645032e-02   +1.656404937513601e-02   -1.641866303723949e-02   +5.132704973505746e-02   +3.474760937536530e-02   +3.903859118320322e-02; -6.711450947615616e-02   +4.875851972779636e-03   -4.335533517886219e-03   +7.514549745381474e-03   -2.133920494949615e-02   -2.308818094852694e-02   -5.027730315414051e-02   -3.044001650858622e-02   +5.079319635685046e-02   +6.009871227703753e-02   -2.217527913824174e-02   +3.281480966906633e-02   -5.836698210618804e-02   -4.705557510930229e-02   -2.163488343911009e-02   +2.399232830154366e-02];
L1E_L1I_iGABA_netcon = [+3.702812124214331e-02   +6.187534816735966e-02   +2.227945428154588e-02   -6.408103714503007e-03   +1.435587075554394e-02   +9.063023350717656e-03   -2.187451701092540e-02   +4.960956053655894e-02   +2.293564448502448e-02   -4.717603119936360e-03   +6.521994844575975e-03   +1.774143267847796e-02   -2.153049585316336e-02   +5.338713336138021e-02   -2.767176986332983e-02   -1.299971198904928e-03; +5.960842759708224e-02   -5.136694599474530e-02   +3.701432808996321e-02   -1.399352693531781e-02   +2.704471898140032e-02   -5.504982422025644e-02   -3.757490265757491e-03   -3.578344077628264e-02   +5.347565349884893e-02   -2.575889014028169e-02   -4.931284821690516e-02   +2.419005164634842e-02   -5.422555038392146e-03   +5.814218574827830e-02   +7.655139172228482e-03   -1.648502507438776e-02; +5.929317517139390e-04   -3.914541489038735e-02   -2.968720123743329e-02   +2.802207000614343e-02   -7.441486689448518e-03   +1.001387143970096e-02   -7.454929884258792e-02   +6.086756066259058e-02   +4.480621359446796e-03   -5.135501986952622e-02   -2.094588523975875e-03   +1.126118807864860e-02   +3.953079768687429e-02   -4.905539762711753e-02   -3.233033488090391e-02   +3.402512493386394e-03; -8.225080314538120e-02   +5.477171234045164e-02   -8.208646415776502e-02   -1.868300872441483e-02   +7.757219277881740e-04   -4.800927569244105e-03   -4.528755714422104e-02   +2.129232997658337e-02   -1.069853523588584e-02   -2.747073766834427e-02   +4.599759391536117e-02   +6.968787673534406e-02   +1.840700527902225e-02   -4.287140571270917e-02   +6.846936607068579e-02   -7.921790463736606e-03; -3.961651797590300e-02   +2.722507090014568e-03   +6.741681529603903e-02   +5.341300899384244e-02   +2.622501991294183e-03   +4.101662020546609e-02   +2.474683622774970e-02   +2.818697600444715e-02   -9.444798955697838e-03   -1.702311409656324e-03   +2.255699545356892e-02   -1.230019775441110e-02   +2.580788266712517e-02   -6.331812437441431e-02   +2.422407627231941e-02   +6.274547847331902e-03; -1.874351547333780e-02   +1.218923856820432e-02   -6.467424567945142e-03   -1.256455631721295e-02   +3.718714923315106e-03   -6.306124963043852e-02   +8.992195806755640e-02   +4.860913849416823e-03   -1.476131103575659e-02   +6.134066527669558e-02   +8.988827731775366e-03   -1.528447651656212e-02   +4.358531003061174e-02   +3.387391698779074e-02   -6.897017765602198e-04   -5.509922978842381e-02; -4.627081790901121e-02   +2.694020405755206e-02   -3.814650180712418e-02   -3.698484054669005e-02   -6.527370742200424e-02   +6.494941011825273e-02   -3.200725475437968e-02   +8.330745515268051e-02   -2.122222903147421e-03   +7.686079815680293e-02   -2.054925421075068e-02   -4.962157264764734e-02   +3.282049563152495e-02   -4.048924563094332e-02   -4.155341271182458e-02   -9.497188371697655e-03; -6.262488176650014e-03   +3.163140516090390e-02   -5.678966811733240e-03   -1.878423012903209e-02   -6.524831836139538e-03   +9.613018466982693e-03   +3.964903066042646e-02   +1.802302880168465e-02   -2.002301857814597e-02   +4.884746094634334e-02   -4.870031821144796e-02   +2.952268890876281e-02   -7.908767848559848e-03   +2.314191323487818e-02   +2.783856329756334e-02   +1.300770157041992e-02; -5.853431172725496e-02   -1.184228729299157e-01   -1.556560450228370e-02   +6.229966074848257e-02   +7.948110349601179e-03   -4.974125082888940e-02   +2.261601549821785e-02   -5.330916159017162e-02   -9.337759485088135e-02   -3.872075424873589e-02   -7.601286728845831e-03   +1.809084970752597e-02   +5.494051613442859e-03   +1.667919569915540e-02   +1.731020505557055e-02   +2.900694296433492e-02; -1.408940715999724e-02   -3.195288603821893e-02   +1.276815194973520e-02   +9.060003273774246e-02   -5.987387353450978e-02   +5.944740314977302e-02   -5.617674653531841e-02   -1.078957421892900e-02   +2.402086766849137e-02   +8.840630585846457e-03   -6.324913211009178e-02   -8.603658731768254e-03   +1.326149586048290e-02   -6.958119910867630e-02   +9.209015958642690e-03   -2.885847474749608e-02; +4.800087865339590e-02   +1.628393399942688e-02   +7.757021863158731e-02   -2.027441439028760e-02   +4.283153552679344e-02   -6.429260762202142e-02   -1.481656415898018e-02   -3.447037357975133e-02   +3.097852385031213e-02   -2.396085494963011e-03   -1.323994877948927e-02   -6.168309485414029e-02   -6.780044206633788e-02   +3.300244538691079e-03   +1.841199159538718e-02   -1.993351125994115e-02; -4.776710923622390e-02   +2.165211578572388e-02   -4.336644284071081e-02   -1.547427053996279e-02   -1.005517151709496e-02   -4.508242983827446e-02   -4.370092984616376e-02   -1.891741323617921e-02   -4.273141013159627e-03   +1.777903369697685e-02   -5.130409882803180e-02   -1.794312947612536e-03   +2.188529694774036e-02   +6.056271060296704e-03   +6.179637971103588e-02   -3.978243116632873e-02; +4.919393623997205e-02   +5.894096979846004e-02   -1.940662500819071e-03   -1.235887489601788e-02   +2.390218549670214e-02   +5.474995630891634e-02   +1.182625983313301e-02   -1.373423588142779e-02   -3.821220959423272e-02   -3.643850440898416e-03   +2.732674346094406e-02   -1.624486918288822e-02   +5.471893120704974e-03   +2.544004304256760e-02   -1.014281543053024e-01   +4.698100011046490e-02; +4.762541201301613e-02   -3.205781809632902e-02   -5.287961031444806e-03   +1.928059509084805e-02   -3.920802157898255e-02   -7.528962045583103e-03   +1.020749560386998e-02   -1.553344429850463e-02   +1.651410695243283e-02   +1.097978783840190e-02   -7.105402101710313e-02   -1.015457503985813e-02   +1.801029060989895e-02   -8.423476015774808e-03   -1.807563664462418e-02   -2.396099382266993e-02; -4.844493328615711e-02   -2.522554646412770e-02   -1.871198631703124e-02   -3.928471741426874e-02   +2.674753637313432e-02   +4.572604843040762e-02   +3.154154345036232e-02   -1.700105793907559e-02   +9.236741958805313e-02   +3.221640024583539e-02   +8.497516247804392e-02   +1.623580667131638e-02   +2.749847417712421e-02   +3.483778778307101e-02   +2.998038949503942e-02   -4.874588301380438e-02; +1.151975048307156e-03   +6.561586152604451e-02   +7.727635540632648e-02   -1.059733580699667e-02   +3.423563496050549e-03   -1.878688213923478e-02   -2.752178290888171e-02   -1.705468901687621e-02   -3.680482989640363e-02   +3.069456484342616e-03   -1.351369898856136e-02   -5.577654320880792e-03   -1.796921444430051e-02   -3.556038700527481e-03   -1.478246710503269e-02   -2.609321336757054e-02];
L2I_L1I_iGABA_netcon = [-3.101205768399666e-03   -5.708128891938849e-02   +1.066284200557714e-02   -4.731155223207850e-02   -9.243669219477524e-02   +3.445489761623431e-02   +5.161740438011888e-02   -3.786835936867942e-02; +1.192890708420290e-03   +4.978537631753152e-02   -2.894300233180293e-02   +2.719842668873712e-02   +4.333998976470819e-03   +4.648072167435821e-02   +1.448918147647163e-02   -2.665411639248248e-02; -6.663176091969074e-02   -2.863486668601271e-02   +1.714611356837263e-02   +6.895048525889201e-04   -2.700361895263490e-02   -1.026060057048118e-02   -9.330034024365122e-02   -3.284832445552083e-02; -3.666585745233093e-02   +2.807707407472627e-02   -5.309996864630427e-02   +4.645632046716261e-02   -6.089472650281423e-03   +2.698172125889711e-02   +6.687321610830299e-02   +1.646393458821741e-02; -4.546861155303762e-02   +1.059681460648805e-02   +1.365348222319272e-02   +1.922183726280264e-02   +8.561036125854040e-03   -2.999446708117374e-02   -2.084959387397439e-02   -1.243832633011305e-02; +4.246327399587045e-02   +6.883054379310936e-02   +3.247489873095774e-02   +7.939643542579072e-02   -3.058691227922727e-02   +3.424122732549131e-02   -5.054094769706526e-02   +5.824558947611455e-03; -1.017650761021679e-02   +2.034036501777346e-02   +2.845965016722948e-02   +1.683203766284619e-02   +6.279431825741594e-02   +3.870225069754797e-04   +9.879755441251440e-03   +4.498660620727611e-02; -4.305560073957868e-02   -4.236546280819220e-02   +1.123221642748167e-02   -7.434603948506630e-02   -6.002687957313801e-02   +3.942130514670045e-02   -1.847166005348077e-02   -1.850444997129264e-03; -4.946631296675182e-02   -6.768415040983776e-02   -3.161434789980615e-02   +8.302378331196646e-03   +1.537605809130699e-03   +5.070240946246016e-03   +4.693962181904239e-02   +2.370561627695286e-02; +9.298251971508863e-03   +1.691172751741141e-02   +5.316772298185928e-03   -2.682203383199367e-02   -6.201684398193021e-02   -1.062798821055914e-02   +1.316019279832467e-02   -1.555197830200731e-02; -5.620853268117577e-02   +5.305497432430887e-02   +7.142948637845625e-02   -9.827986095917098e-03   +9.469694043472511e-03   +1.632328202154868e-02   +3.293502539827509e-02   +2.268954392542976e-02; -2.812017163993169e-02   -3.610890967669569e-02   -1.595927798948499e-02   +1.252528335388513e-02   +7.390707612247557e-02   +8.131281966005344e-02   -9.242702972075967e-08   -5.669876131478058e-03; +6.688081818389488e-02   +4.305635460506281e-03   +3.741826124180975e-03   +1.683284128977354e-02   +2.607822150465420e-02   +4.823100076526298e-02   -4.882139125973382e-02   -4.291660398293636e-02; +5.486676063500118e-02   -1.174055822734369e-02   -4.759226106564766e-02   +5.822530774454349e-02   -5.186341892343605e-02   -2.245641130976303e-02   +2.806230411763403e-02   -8.820546922049640e-03; +4.978351591942431e-02   -2.107068112644091e-02   -2.800655986127285e-02   -7.821636485483166e-03   -6.236003991718258e-02   +7.303216641809970e-02   -4.906685127797107e-04   -3.265487921720080e-02; +2.921407619927027e-02   -2.739421221058519e-03   -9.147206354763893e-03   -2.108411427230607e-02   +3.128633270720351e-02   -4.872261532359304e-02   -2.733959291928583e-02   +3.265467928496488e-02];
L1I_L2I_iGABA_netcon = [-5.567988221272276e-02   -2.769742504368670e-02   +3.007593401209504e-02   -5.142246957073485e-02   -7.227902218941616e-02   +6.706641912628412e-02   +5.212224569751633e-03   -1.608238945594183e-02   +6.193564049349739e-02   -7.624312862038549e-03   +6.654070531103290e-03   -1.572397784308043e-02   -4.542591761244390e-02   -1.580840836247172e-02   -7.520513264284345e-02   -9.038186177857467e-02; +1.866646532165497e-02   +2.638123509649198e-02   +2.935436011800208e-02   +1.392148263962882e-02   -7.864547493020077e-02   +8.456427208078439e-03   -1.237630125952038e-02   -1.193400950504660e-02   +7.184967337538557e-02   +1.703444813654239e-02   -2.551602544879036e-02   +2.449154241456693e-03   -2.218298292982385e-02   +2.148811217174675e-02   +1.036840136951513e-02   -1.475557019066823e-02; +2.091230774201977e-02   -1.861185911274255e-03   +1.172864862396720e-02   -2.143059026182069e-02   +2.029291561254545e-02   +3.946225403501135e-02   +1.717492049046582e-02   -3.022923733861696e-03   +1.407717394439081e-03   +3.871669767740635e-02   +2.192979227822618e-02   +1.233581323956543e-02   -6.117242719162361e-02   -9.664258533448846e-03   -7.858438902575003e-03   +3.894378626478198e-02; +1.161766216485307e-02   -4.633473716190436e-03   +3.206413559550982e-02   +1.058574323459474e-02   -1.809224380987879e-02   -2.557711636493197e-02   -5.253290923223709e-02   -1.973051102257580e-02   -4.510765774413961e-02   -2.315093223087178e-02   +6.538921190778202e-05   +1.127046760158562e-02   +1.524831106973385e-02   +2.411392701357927e-02   +7.122898062172739e-02   +2.026852353109305e-02; +1.967793240449824e-03   -1.030049353440986e-02   +1.759580711380834e-02   +1.989633920305854e-02   +3.497291705518050e-02   +3.717096663323404e-02   +1.772418163354346e-02   -3.722253369962192e-02   +7.228512970020413e-02   +5.946937230070470e-02   +2.409450687764762e-02   +2.769323483891538e-02   -6.047664294931669e-02   +4.228136055110900e-02   -2.124431708700544e-02   -1.043093795701619e-02; +4.768954880981843e-02   +6.197032055447861e-02   -4.512373769461334e-02   +4.800904128354704e-02   -2.335778159951061e-02   +1.168503223307552e-02   +6.252273876457125e-02   -1.310249695171732e-02   +4.707930255288307e-03   +1.011489724509579e-02   +4.461307681814213e-02   -2.120334847302692e-02   +3.982553489449553e-02   +3.448584849108132e-02   -1.262352425745700e-02   -6.209445512995967e-02; -6.278168386284234e-03   +3.665333296284767e-02   +1.450010165180902e-02   +1.281632824423145e-02   +2.279993409315480e-02   +3.053498872652702e-02   +1.635321044942445e-02   -1.796943457205817e-02   -4.448546491945608e-02   -4.384659518130921e-02   +4.985229304257346e-02   +2.522671114117824e-02   +3.713784149315711e-02   +7.697296790400904e-02   +3.796323477268857e-03   +2.939072792402712e-02; +1.202987521033659e-02   -8.066423635216950e-02   +2.520106679342218e-02   +1.855155494441027e-02   -4.886998449215053e-02   +4.287493511566143e-03   -5.409798981522653e-02   -3.878434578434842e-04   +1.943769663599577e-02   +3.648903264015132e-02   +4.852383089788375e-02   +4.414953094307652e-02   -9.188031067317193e-02   -2.741798981648822e-02   -1.451482904673066e-02   -7.712415329277804e-02];
L2E_L1E_iAMPA_netcon = [-6.449943957535591e-02   +4.072220437415576e-02   +4.942016726781211e-02   -4.281084582856517e-02   -1.264897118777965e-02   -3.521656816835679e-02   +1.597936594165227e-02   -5.758439467005760e-02; +3.232154212775166e-02   -6.070124623989178e-02   -2.292323282147389e-02   +2.701130329236352e-02   +4.714343030724941e-02   -5.250083710574263e-02   -1.839882118078695e-02   -1.226272557424482e-02; +6.511781778973959e-02   -4.117478485572241e-02   -5.869151126684061e-02   -4.801942327674111e-02   +3.419078020296583e-02   +7.172112781276296e-02   +2.855877612699027e-02   +1.843584601660629e-02; +1.092650401236341e-02   -2.945886692926249e-02   +3.149349261383173e-02   +1.991455823124841e-02   -1.046077416678660e-02   +1.601959368301656e-02   +2.367740779383611e-02   +2.376596882693892e-02; +3.872200850826392e-02   -3.854668614547861e-02   -5.184820767000022e-02   -4.703017683066822e-03   -1.463025288939526e-02   -1.206552402136496e-02   +3.567587026300387e-02   +5.380644483772681e-02; +2.369472195207059e-02   +9.662830512935986e-03   -1.451094807228470e-02   +5.924903708764193e-02   -2.870639705131563e-02   +3.809435658891977e-02   -7.679257457567045e-04   +2.160157232775514e-02; -8.313432728642584e-02   +4.879621965715704e-03   +2.027477268825619e-02   -2.658675481315485e-02   -4.379638018752723e-03   -9.442979045935333e-03   +2.455732240433801e-02   -6.989744908623113e-03; +1.001997135459710e-02   -2.227623991681868e-03   -2.621456211976406e-02   +5.077428095566291e-02   -3.234061004368190e-02   -6.606797598215552e-03   -2.870081935688311e-02   +6.292335641549343e-02; -8.425868680633650e-03   -3.751542109756221e-02   -6.535017624945216e-02   +6.082074399541158e-02   -2.500225554008926e-02   +2.170659897193843e-02   -9.437787298633076e-03   -2.442858566429410e-02; +4.032766403388946e-02   +1.015967567948223e-02   +5.193978311519851e-02   -2.347352160718054e-02   -3.144585278366514e-02   +5.165907192128627e-02   -6.299996188348519e-02   +1.743792014425836e-04; -6.325612987444898e-02   -5.043069430613622e-02   +5.856023066554898e-02   -5.098537260196866e-02   +9.835275259655873e-02   +1.835183725365714e-02   +4.405623742234292e-03   -3.315519744988213e-02; -1.634443170744765e-02   +8.960842874313505e-04   +5.519954667186842e-03   -6.882613097450067e-02   +3.531571414846384e-03   -4.907751986645580e-02   -2.533979921103137e-02   +1.118611652221584e-02; -1.170203307767022e-02   -7.643383927594835e-02   -1.724679078858051e-02   -8.524640425001133e-03   -3.719942625244125e-02   +2.805122933196619e-02   -7.072408989873732e-02   -5.665174465245195e-02; +4.674476164700359e-02   +2.546611184685464e-02   -9.279803782011745e-03   +2.096787724642444e-02   -5.827937556717001e-02   +5.051440726569018e-02   +1.203658474339033e-02   +2.990066864759184e-02; -2.476164335467858e-02   -4.721221785395183e-02   +2.656472118398063e-02   -2.184612675920675e-02   +3.758435057405172e-02   -4.138968633518832e-02   -5.894922972913105e-03   +3.496089795670403e-02; -4.356786052411110e-02   -1.683872329335306e-02   +3.548826566554174e-02   -5.998079599621547e-02   +2.121129874125272e-03   +3.514515551818135e-02   -1.797170380348277e-02   -1.810286320918259e-02];
L1E_L2E_iAMPA_netcon = [-5.863610640037525e-03   +1.165506807188432e-02   +2.854316481765675e-02   -3.733947389072897e-02   -3.027344768961802e-02   -2.166848450146699e-02   -2.331657667184265e-02   -1.316342893730898e-02   -2.077881112967494e-02   -1.574026764932471e-02   +6.373878809786364e-02   +1.302388050281678e-02   +3.515306872497784e-02   -8.390694173071781e-03   +4.698772794938370e-02   -2.269366288002133e-02; +2.564148778002083e-02   +4.591171225807703e-03   -2.804925259234375e-02   +4.035875616107579e-02   +3.618251808759465e-02   +2.154487754428415e-02   -1.104439483165279e-02   -1.812381597883896e-02   +2.180354403370540e-02   +3.997478242315350e-02   -5.647050208622495e-02   -8.593005647960464e-03   +4.685602298779763e-02   +4.289137389226334e-02   -3.255631013268132e-02   -2.792500233405169e-02; -1.158495318115016e-02   +1.081038067678101e-02   +5.640661686620903e-02   -1.066523044033473e-02   +3.378720221914950e-02   +3.486019567792746e-02   +2.954843155956704e-02   -3.369219211873672e-02   +1.879343873091681e-02   -1.984941372902609e-03   -2.410685299769741e-02   -3.618588890281329e-02   -8.348687166318452e-04   -1.299438769603154e-02   -4.706359570826756e-02   -1.628560202549192e-02; -1.770482254271295e-02   +1.120635670901708e-02   -5.630422743797217e-02   +2.054826034358985e-02   +7.078402740562026e-06   -3.495690717181309e-02   -2.605667791944921e-02   +3.284611732720049e-02   -7.110674618446397e-02   -5.287358148473861e-02   -3.394707411055073e-02   +1.166099507571482e-02   -1.152476837773804e-02   +5.875585099776392e-02   +8.787669429949798e-03   +6.395682686565533e-03; +5.100130049675772e-02   -7.317530662306358e-03   -2.038831496352464e-02   -1.170145999066289e-02   -3.944061186632083e-03   +4.194427850806250e-02   +2.659441804844816e-02   -5.549443273066140e-02   -1.114550272288507e-02   -4.276113339140970e-02   +2.672666512821355e-02   +2.050709872011773e-02   +2.864450089922444e-02   +5.769983168865365e-03   +4.324997857376419e-02   +1.030839248108919e-02; -3.017213975041530e-02   +1.149248759547303e-02   -5.935601735781178e-03   -1.594246018620658e-02   -1.491388545144455e-03   +3.193835760005903e-02   -1.123079601254103e-02   -2.785516804055315e-02   -3.311436554007635e-02   -3.887920162729394e-02   -3.351153708221589e-02   +4.839232749364993e-02   +1.118456330825324e-02   +6.707263186034585e-03   +2.179454169508284e-02   +1.586906102181901e-02; +7.365419066255076e-04   +8.689992108755325e-02   +1.321962742861094e-02   +4.945408807961068e-03   -6.080771692877257e-02   +4.594660587940204e-05   -2.461296727164249e-02   -2.170100269094550e-03   +8.877364963572401e-05   -9.614390404853457e-04   -1.815622707699180e-03   +5.406845864003700e-02   -2.522093574620604e-02   +8.774756089663349e-02   -2.754189005568762e-02   -3.619617501730794e-02; +4.271870103967475e-02   +4.721485812647240e-02   -2.094339085281003e-02   +2.353269324976784e-02   +4.164949729953095e-02   +6.897563727773608e-02   +4.468791442292058e-02   -9.364256808648096e-03   -1.231989453794184e-02   +1.485478480631859e-02   +5.829258590846612e-03   -4.771747510889962e-02   +1.054965181077560e-01   -2.114338325251335e-02   -3.967683719167871e-02   +1.367165419051015e-02];
L2I_L2E_iAMPA_netcon = [+1.811669281609834e-02   -4.150123999711902e-02   -1.985329933444196e-02   +1.004012684121943e-02   +8.349685992510250e-02   -6.675070411390595e-02   +1.041881487754683e-02   -7.114601704898378e-02; -3.048805466234052e-02   -2.051940783399803e-02   -5.524232376941289e-02   +9.378240491376326e-02   -1.896367871511442e-02   -1.097172419432339e-02   -5.532840125971440e-02   -2.901567802471462e-02; +2.235227281774062e-02   +1.281546420673444e-02   +2.287039566128292e-02   +6.173158455331749e-02   -6.405166311870504e-02   +4.989184607002726e-02   +8.271715320504897e-02   -3.416636705070555e-02; +2.522170218996190e-02   -2.993935303748013e-02   -3.983609162165306e-02   +1.497225641146302e-02   +1.365080825753554e-02   +4.293025866610816e-03   -1.762016244256279e-02   +1.734797043407344e-02; +5.910458430085611e-02   +1.298943868428594e-02   +4.785670960364400e-02   -6.947220506615885e-03   -6.228916074890231e-02   +4.917489241197616e-03   +6.288739597864280e-02   +6.091553002004600e-02; -9.346701188082743e-03   +4.097795125639431e-02   +2.779268307549692e-02   +6.971925553561652e-03   +6.537298401515711e-02   -7.243386432657545e-02   -7.347119408557745e-02   -1.985963620383694e-02; +6.173900374023853e-03   -1.689979210778781e-02   +4.791361470265394e-02   -2.874958597242239e-02   -3.020616316581920e-02   -1.565499581379966e-02   +3.197706929906686e-02   -8.457433954954983e-03; +1.040662664449005e-02   -1.326772969160748e-02   +2.085654967122676e-02   +2.817258752640438e-02   +5.317873484674474e-02   -4.907034912963169e-03   -5.642222981311627e-02   +2.034814838717591e-02];
L2E_L2I_iGABA_netcon = [+7.648566202623752e-02   +5.134769811933145e-03   -1.038019488935749e-02   -3.223964614161869e-02   +1.802588092686054e-02   -3.146882190171934e-02   +3.369694898827335e-02   +1.919344336777445e-02; -2.306068685660148e-03   -3.791728114333427e-02   +4.131582186793799e-02   -6.532922884403491e-02   -4.933654899696516e-02   -5.657962762263508e-02   -6.892472746093362e-02   -2.869080938343675e-02; -1.951662012189450e-02   +2.153501562853578e-02   -6.649065154771117e-02   +4.048640966682451e-02   -4.159561832926125e-03   -4.823624988478997e-02   -2.518160874890694e-02   -3.240627860442923e-02; -9.534580179981909e-03   +5.557914913133767e-03   +5.562832430467103e-02   -8.779137104320507e-02   +1.301345610580795e-02   -2.867438248730758e-02   +9.271435796855101e-03   +9.198265007453204e-03; -2.039798588232827e-02   -2.509819942828449e-02   -1.082002150081376e-03   +7.317480375959359e-03   +1.473043560012474e-02   -3.462019615561106e-02   -4.033286315183688e-02   -2.964072566739079e-02; -4.325205188846676e-02   +4.350366359628578e-02   -5.161523774743532e-03   +1.394145243678724e-02   +1.818874400662893e-02   +4.231653482183527e-03   +5.496479848834207e-02   +2.961944780016704e-02; +1.252105124657644e-02   +1.133470432855259e-02   -7.363823990560216e-04   +7.104703200821134e-02   +1.229425181134550e-02   -7.210624119625310e-03   +4.900150141062505e-02   +2.580727743210042e-02; +5.770873483486533e-02   +4.706654994844277e-03   -1.854225324674796e-02   -7.274509007091143e-02   -3.890270911850957e-03   +4.283352349592839e-02   -6.789818739525637e-02   +1.447093841496869e-02];
L3E_L2E_iAMPA_netcon = [+5.019931738349834e-02   +1.177350390647739e-02   +2.146469893528494e-02   -1.721843807695935e-02   +2.119168650651412e-02   +6.288096901982963e-03   +1.217511503080833e-02   -2.931657258116105e-02   -1.061915219078539e-02   +9.897189494068451e-02   -1.275112136555754e-02   -8.114734554035803e-02; -3.039515549255425e-02   -2.813300618831475e-02   +1.681775593115114e-02   +3.847052717861307e-02   -8.813788298829565e-03   -2.258529906454040e-02   -4.706718422184211e-02   +7.199810446574011e-03   +2.324315221542608e-03   +2.004415346376513e-02   +4.375093346521636e-02   +4.213206288711642e-02; -3.355307796467794e-02   -6.382815206296472e-02   -9.579458008668983e-02   -5.765978048284520e-02   -2.641849985526344e-02   +3.755413665754429e-02   -1.153838701271164e-02   -4.965027659684977e-02   +6.792882963250072e-03   -2.209223566347346e-02   +1.899225503010504e-02   +6.737114906938770e-03; -1.671539627410942e-02   -3.545594048040891e-02   +6.778227599707616e-03   +4.031237947721831e-02   -3.052812194986232e-02   +2.313056473699308e-02   +5.938204580500098e-02   +1.338531225389063e-02   +4.059676158742201e-02   +6.362815654983028e-02   +1.826907224603036e-02   +6.767517168323745e-03; +1.136928124900208e-02   +5.354690435252043e-02   -1.225206378019090e-02   -2.056244250748037e-02   +4.852791548336228e-03   -2.756786599416988e-02   +3.635043862382122e-02   -3.751489198101780e-02   -3.686948870650599e-03   +2.287625909058698e-03   -7.034628630137559e-02   -4.536710623778327e-02; -1.569502024853714e-02   +7.363732933219751e-02   -4.602825957226290e-02   +5.930291163141366e-02   +1.365758603018691e-02   +4.191043003510282e-03   -1.578888160163400e-02   +3.996920465823659e-02   +4.008903251628212e-02   +1.965163863756999e-02   +3.778672396334875e-02   -3.715486659258288e-02; -1.981806591843474e-02   +3.630503566671707e-03   -4.125137883697980e-02   -2.450696572808247e-02   +3.388565854556654e-03   +5.274016632551638e-02   +4.242720544702130e-02   -4.443406240642321e-02   +3.096944428024203e-02   -3.242202564674004e-02   +1.103379148466738e-02   +3.564949979218694e-02; -3.024894014278003e-02   -1.120097939774838e-02   -6.436976832298914e-02   -8.862736503931233e-03   +1.294344437989961e-02   -1.552572698719050e-02   +2.789209528507336e-02   +2.320714787034050e-02   +2.160265729973997e-02   -4.847243393260470e-04   +2.420952209194661e-02   -3.875025200579663e-02];
L3I_L2I_iGABA_netcon = [+2.524697816053147e-02   +4.101455365265291e-03   +3.907724944894131e-02   -2.055437145458433e-02   -4.818716424356083e-02   +1.109821628093335e-02   +3.598473482191125e-03   -3.706409724806920e-03   -2.977558307121405e-02   -2.544882951209339e-02   -6.586762024788212e-02   -2.090604087824221e-02; -2.255815459274491e-02   +5.113510518413411e-02   +2.472096745390380e-02   -9.835046697468687e-04   -1.290847961677185e-02   -2.728790351065197e-02   -2.904690263537403e-02   -6.287452131255566e-02   -1.794076843501770e-02   +5.138329950606293e-02   +8.205659798768271e-03   -3.809398761220491e-02; +5.423154699086345e-02   -5.111984265292580e-02   +7.108439785666276e-02   -1.306439713377274e-02   -1.735873988941621e-02   -8.534978907259877e-03   -2.075629050631521e-02   -3.197974673881221e-03   +1.865464333558361e-02   -1.707536538942809e-02   +3.713849096521961e-02   -6.310202752218710e-02; +5.735082597202901e-02   +1.174204570465347e-02   +5.677608250356751e-02   -3.872486110691499e-03   +6.515578077287094e-03   +3.683698581399339e-02   +5.248615835320069e-02   +2.546766956024773e-02   -3.823575733438279e-02   -2.148504819036591e-02   +1.320871819316455e-02   +1.895280111328682e-02; -3.648437649468123e-03   +3.487794454811621e-02   +4.760617052156209e-02   +2.097605443345825e-02   +1.437703251140651e-02   +3.304555083661563e-02   +4.367629655180415e-02   -1.916132143735993e-02   +4.412676621538918e-03   -1.247742889925565e-02   +6.019086112060393e-02   -3.099933225166930e-03; +4.563994544897835e-03   +5.114785221904529e-02   -5.394361367610019e-02   -1.201970397360822e-02   +4.342534253961463e-02   +2.657361773244806e-02   -3.303518234954928e-02   -2.287048232194680e-02   -4.014208131892798e-02   +2.255517362835277e-02   -4.891922528217851e-02   -1.588214185711733e-02; -2.712099918935538e-02   -2.849871376770428e-02   -6.981783294099958e-02   -1.565060751585244e-02   -3.119080109308758e-02   -6.825255355620140e-03   -4.099969089114381e-02   -2.818071543337911e-02   -1.690565308723838e-02   -6.024921690069208e-02   +2.905907194575331e-02   +3.919871413853766e-02; -4.832992368470113e-03   +4.112836892723037e-02   -2.617442237319543e-02   +3.269082484789683e-02   -3.310825192625345e-02   -6.355851113124851e-02   +5.258794792455774e-02   -1.775444504911114e-02   -5.314552800535582e-02   -1.658778723731467e-03   -3.572092509943659e-03   -1.139728464690964e-02];
L2E_L3E_iAMPA_netcon = [+1.344270932694875e-02   -1.947862117501966e-02   -5.444312041572752e-02   -9.243448443776753e-02   +1.059784615650890e-02   -2.590740602148445e-02   +1.288533367704472e-03   -2.834476370384450e-02; +1.374615936915662e-02   -1.131336894927480e-02   +8.242324075829177e-02   +7.364990263034451e-03   -3.216666835788257e-03   +2.466898251675170e-02   -9.139972483622809e-02   +7.781704938276329e-02; -3.937594450059149e-02   +3.724114414319210e-02   +5.054637785763008e-02   +1.036090058762976e-03   -4.666541319399192e-02   -1.629560181945296e-02   +1.050774137950470e-03   +5.205707753431328e-02; +1.628494136974477e-02   +6.182097298060565e-02   -3.964914941417109e-02   -2.894693316920615e-04   +7.723240701772610e-02   -2.351117145774531e-03   +4.062821658426941e-02   +2.486826664064645e-02; -3.773150163272056e-02   +5.919545647530961e-03   -5.223698081270093e-02   -7.150623543717269e-02   -1.285051783036871e-02   +6.413000374642243e-02   +1.193498526175727e-02   +3.684100050145034e-02; +3.383938395922910e-02   -1.441411129745714e-02   +2.282709634461797e-02   +4.492023560192523e-02   +1.357822838371544e-02   -2.269656395390376e-02   -2.545611396357564e-02   +2.389639176734578e-02; -2.160494568509649e-02   +2.927625666947685e-02   -1.420843396129021e-02   +5.038415676492492e-02   +1.034840294666202e-02   +4.445388229750755e-02   -4.541281125155051e-02   +4.612896105040547e-02; +6.631451575050749e-02   +3.017356113384817e-02   -4.359706854325026e-02   +2.154688611245949e-02   +6.736582488250527e-02   +7.311285463915129e-03   +4.825618494590928e-04   +4.725693226314658e-03; +2.162008512526768e-02   +7.467493942459115e-03   +4.578703814290454e-02   -1.404786459192108e-02   +4.459642114029828e-02   +4.276636635514577e-02   -1.298936865584603e-02   -5.445229203351978e-02; -3.500809837306482e-03   -1.103419634268115e-01   +2.344546631094632e-02   +1.695219892945528e-02   -9.578336564551263e-03   -5.788957967864269e-03   +2.395281607539080e-03   +4.809093967374568e-02; +7.976604078185668e-03   -1.763927467738642e-02   -2.036597579791980e-02   -3.687366686399347e-02   +1.262010295662501e-02   -3.280715756824451e-02   -5.358855715011205e-02   -2.725604617266127e-02; -2.109836332778993e-02   +5.254075563695219e-02   -1.146140269309977e-02   +2.893984329547515e-02   -2.999403592807857e-02   -5.221092873258143e-02   -1.989051480833704e-02   -2.611011411630230e-02];
L2I_L3I_iGABA_netcon = [-4.386343637980209e-02   +1.361312225854000e-02   -4.172314223093768e-03   +1.693045685089937e-02   -5.281161865741565e-02   +7.746052278127721e-02   +2.160376532554168e-02   -4.484396560829053e-02; -2.620409375043603e-02   +3.191994252926426e-02   -2.790590914356728e-03   -3.698814206762172e-02   -6.285711679952204e-02   +3.923893437313346e-02   +1.450851559759677e-02   -7.132416391817853e-02; +3.927509465578847e-03   -1.144509868064920e-02   -9.471745905593551e-02   +2.242294372782457e-02   -1.559790145681877e-02   +1.475863146308421e-03   +4.907208786497877e-02   +4.400246906021346e-02; -3.070409273344001e-02   -2.238835639178875e-02   -2.864459024553638e-02   +1.252043006752747e-02   -2.729415656748927e-02   +1.994025360304727e-03   +2.475205906880230e-02   -4.324927534197905e-02; +7.703183473306986e-03   +8.189979337652638e-03   -8.334280262882886e-02   +4.332372058053638e-03   +3.134590145861699e-02   +2.975850173049260e-02   +1.252054590060444e-02   -1.296408714822689e-02; +5.467017192165163e-02   -9.114517927710952e-03   -4.998440343465717e-02   -3.209336773213153e-02   +2.408429662585382e-02   +5.197551973966833e-02   +1.039173659576284e-01   +1.929197912105235e-02; -2.370412939632027e-02   -1.339878233092815e-02   -5.470565744784146e-02   +1.268791003754309e-02   +2.142649452946610e-02   +1.118019843926802e-02   +3.921317116115479e-04   -1.751320366597840e-03; +2.043683625921267e-02   -3.351206500017002e-02   +1.283152180488550e-02   -1.697102536012679e-02   +6.171693620716462e-02   +1.400157746792153e-02   -2.211050287192202e-02   +1.148808636669498e-02; +3.200775843598983e-02   +1.074336442145006e-01   -3.936310772073130e-02   +5.931986755312611e-02   +3.863465652463564e-02   -4.577176086812372e-03   +1.433424733593276e-02   +2.573073806284149e-03; +9.164676727150770e-02   -6.323426207653698e-04   -1.397635469219027e-02   -2.479749709194860e-02   +1.713070609234028e-02   -5.578463549499205e-02   -1.631011266407761e-02   -1.501161429715002e-02; +9.929400035021064e-03   -1.035726494563292e-02   +4.199775067098288e-04   +2.560028550461696e-02   +6.122456114158127e-02   +8.772967532488035e-02   -8.484274073319316e-03   +1.597016623627182e-02; -6.094453150681929e-02   -2.893894885734812e-02   +1.473521073937046e-03   +9.808008321176961e-02   -1.573846374058934e-02   +7.442398475871385e-03   -1.273231339304103e-02   -8.656006255085414e-03];
L3I_L3E_iAMPA_netcon = [+3.137122102269440e-02   +2.387485723340613e-02   +3.020260389078049e-02   +2.757064596038637e-02   +1.935435125485180e-02   +5.106242046422037e-02   -5.480541834380425e-02   +5.435215604295586e-02   +2.619230753006654e-02   -5.857189498008508e-02   -6.995561110048631e-03   -2.403820295983873e-02; -4.931548381148040e-02   -2.427577549693292e-02   +3.332604950972936e-02   +1.505370960155790e-02   -2.337177732665044e-02   +1.492967119340018e-02   +1.175095417988860e-02   -2.580668391717278e-02   -4.835037606841921e-03   +2.267382126815853e-02   +3.065106865976070e-03   +1.521719804270153e-02; +1.827024457771057e-03   +3.633184369804202e-02   -4.641916910756858e-02   +1.634782408712700e-02   -7.528297486767137e-02   -2.366321869427497e-02   +7.994611737310003e-03   -9.360718672587006e-03   -4.371523756015703e-02   +6.686018515607538e-02   -2.070793786301912e-02   -8.786920494922353e-03; +3.990359925670130e-02   -1.589727599085831e-02   +6.868966062073974e-02   +1.529289045580983e-02   +8.086452076019417e-03   +2.052812023484787e-02   -1.667781065829313e-02   -3.247536647993224e-03   +2.477816980562363e-02   -4.907210220846187e-02   +5.480778801707026e-03   +3.842047673633711e-02; -5.294689505263638e-03   -2.306238466971674e-02   -3.925224257250715e-02   -3.795797691840506e-02   -6.585826559788123e-03   +5.622111699863847e-03   +2.058656936939926e-02   +1.668695932281509e-02   -7.318910200122160e-02   -6.333583729108508e-02   +1.747152572839388e-02   -8.095488334235037e-03; -1.773187639883746e-02   -1.405872831967723e-02   +6.873164712967338e-02   +4.651270306871052e-03   -6.315010120265313e-03   +9.226413322493018e-02   -3.007157094111495e-03   +5.893467765377865e-03   -3.096200745226762e-02   +4.157057745809093e-02   -2.830149445871899e-03   +4.753611394601632e-02; +7.235597336279842e-02   +3.504823594679844e-03   +1.786134193671981e-02   -5.736070176295642e-03   +5.394666098253995e-02   -4.656129753458741e-02   -1.340151913776740e-02   +4.786505865678467e-02   +5.592773957863849e-02   -6.271332406443321e-02   -3.729013821070026e-02   +8.453449459574046e-03; +1.853208624571610e-02   +9.364408071098789e-03   +2.230542459317990e-02   -3.629442096077231e-02   +2.235103823754506e-03   +8.140872246089371e-04   -1.767653613944043e-02   +1.842962662650986e-02   -7.584215378253054e-03   -1.888700229805679e-02   +5.847834455199569e-02   -1.143695182918167e-02; +3.536976490488381e-02   +4.615781171245635e-03   -1.001678558596032e-02   -4.779486811551121e-03   -1.593543843268709e-02   -2.038569669342794e-02   -1.417664282354733e-02   +5.114151292309350e-02   -3.700497554527420e-02   +6.472262474077516e-02   -4.612701079661516e-02   -8.254398397639133e-02; +5.370771635011599e-02   -7.994670075328746e-03   +1.009804972075532e-02   +8.336317889500794e-03   +2.867560082058857e-02   -4.382787229299950e-02   -7.626995881899122e-02   -3.097873394473224e-02   +5.108848516269442e-02   +8.541423168237666e-03   +4.306888079206515e-02   +2.664974996175754e-02; +3.258709512710981e-02   +4.456594173111189e-02   -1.123637678940913e-02   +1.514862263216856e-02   +1.331744198185438e-02   +1.366618583742178e-02   -1.664122684003004e-02   +5.620270312861213e-02   -2.123542077697013e-03   -4.025229260768563e-02   +4.643033150430689e-02   +5.386085295674312e-02; +6.080487664699512e-02   -2.947859992810353e-02   +1.794252748294324e-02   +3.829108115988789e-02   +4.642567951329385e-02   +1.499162543737956e-02   -9.444759758113883e-03   -6.306877195820790e-02   +3.235997720753128e-03   +3.758988314388985e-02   -1.964010940716293e-02   +8.219807129596733e-03];
L3E_L3I_iGABA_netcon = [-1.289856144298433e-02   +5.105698194122607e-02   -3.780212234223129e-02   -1.270421856102787e-02   +2.121584453871358e-03   -2.242637454397279e-02   +1.790144518694025e-02   -3.569384042238211e-02   -3.784389754196937e-02   -4.226588523260016e-02   +2.865270317140988e-02   +4.351738874977397e-02; +6.337447060516095e-03   -3.884444802096974e-02   +1.047310789179822e-02   +4.233507047126110e-02   +4.063316096250093e-02   -5.883824965763183e-02   +6.979942648862609e-03   -6.181490700670617e-03   -7.560739914110748e-02   +2.641190766306128e-02   +4.053610383332953e-02   -6.727480623037296e-03; +8.478101581176210e-03   +3.841011765018260e-02   +1.172829139116239e-02   +2.901810605228329e-02   +1.322595250735693e-02   -2.814073612156031e-02   +2.216469109802151e-02   +1.937435445515759e-02   +3.082787376793530e-02   +2.183877612721184e-02   -5.357829852550346e-03   -3.010243322355233e-02; +7.740698781717360e-02   -2.648512328768961e-03   -1.334393026636505e-02   -2.302208991858800e-03   +4.461932897927848e-02   +4.596472246192890e-02   +6.432944197882258e-02   +6.334216312832926e-02   +5.682128395588547e-02   +3.642449407713404e-02   -9.527853969315450e-02   -1.056231904645756e-02; +6.290160668232085e-02   -1.063846664495568e-01   +2.902854928841650e-02   +4.816418793781477e-02   +2.933381705313174e-03   -1.782763604701955e-02   -4.450507270296657e-02   -6.310287866073307e-03   -2.851465751402778e-02   -7.383765722379682e-02   +1.206603160026937e-02   +1.438501511907309e-02; +3.801472156687746e-02   +3.604479821093728e-02   +5.118191193574471e-02   -9.942606670094317e-02   +3.828755776561497e-02   -4.153762282745802e-02   -4.392660298779212e-03   -1.524770248520737e-02   +1.415214579640107e-02   -2.280308000033027e-02   -4.266187068096314e-02   -8.676017320536574e-03; -4.090645793362768e-02   -3.647434978441648e-02   +3.682438439616936e-02   +3.656181256124783e-02   +4.810181303534009e-02   +7.177326183856453e-02   -9.603070779954322e-03   +2.898388010573008e-02   -7.226404644890813e-03   +1.036532807797292e-01   +2.523657278446477e-02   +4.415806014573663e-03; -3.017995934509412e-03   +4.922865687599687e-02   -1.306667614592369e-02   -4.316088106437550e-02   -4.163104499336823e-02   +1.809857323636187e-02   +1.550005119671528e-02   +2.836315491470320e-02   -4.472084842676135e-03   +1.487295440196562e-02   -5.472004257414417e-02   -2.784060850445047e-02; -5.298341827255060e-02   +4.632040968925806e-02   +9.327228422844946e-03   +1.145186834920343e-02   -1.524954278610005e-02   -2.025599719663200e-02   -9.660899771003605e-03   -5.817138522087342e-03   +7.287140178056493e-02   +4.792586016294492e-02   -2.121778455421083e-02   -6.958168428094180e-02; +4.441347982136577e-02   -2.769963297115373e-02   -4.896747311485360e-02   -2.826098875777018e-02   -6.905888389410694e-03   -2.951150162841527e-02   +3.008649020179169e-02   +3.957847697428706e-02   -6.238282902459363e-02   +1.414500020651672e-02   -6.381908782058555e-02   -7.903513949684413e-02; -2.837147902898265e-03   +7.352498593518134e-02   -1.612851995855243e-02   +3.012831466250396e-02   -3.329122808790373e-02   +3.287990363007356e-02   +2.387982553248254e-02   +3.983968024948051e-02   -4.701665583307273e-02   -5.395406039209276e-02   +5.309620285018128e-03   +3.618056728824623e-02; -2.019530253085866e-02   +7.775817760646295e-03   +5.983559966192221e-03   +3.859697050201188e-02   -2.208045408578840e-03   -1.510058273638245e-02   +4.774162022103939e-02   +1.291391523018003e-02   -4.764211997563434e-02   +5.745147062552270e-02   -2.815644198700888e-02   -4.549146690278362e-02];
L2E_Input1_iAMPA_netcon = [+4.666523506006090e-02   -2.109443659762663e-03   +4.687708864847588e-02   -1.409439203348893e-02   +2.548551218245259e-02   -2.379400070255599e-02   -1.955219355583469e-02   +4.192812346949096e-02];
L2I_Input2_iAMPA_netcon = [-8.989766697797268e-03   +3.415724293262394e-03   +3.997581302157976e-02   -5.134219382140966e-02   +8.542479379544346e-02   +4.008924229894316e-02   +7.092877208515355e-02   -4.810085577834688e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
