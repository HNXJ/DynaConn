function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.211437415988384e-01   -8.425005303243353e-02   +7.561855471829958e-01   +1.906448308536295e-01   +2.012830719576344e-01   +6.665820076099577e-01   -4.219710043431714e-01   +4.911596765305224e-01   +3.452710332920079e-01   +9.272473239884452e-01   +2.765906477210849e-01   +1.078267304301437e-01   +3.524228965799198e-01   +3.252487440309246e-01   -1.099937212553909e-01   +1.038465674644565e-01; +6.956640155887836e-02   +2.155798171850009e-01   +1.227393867486939e-02   +8.841755438813357e-01   +9.018961186545951e-02   +1.791038906330076e-01   -1.416432996395206e-01   +5.067729921849816e-01   +5.431107660397636e-01   +4.359689735974918e-01   +6.630862441468814e-01   +5.644010475829855e-01   +3.299059732616434e-01   +5.587213665745093e-01   +2.487308738950849e-01   +5.632627102714184e-02; +8.140089008589314e-01   +1.172923185657929e-01   +5.403211764231182e-02   +5.110484483073725e-02   +2.009544499883748e-01   +1.563679216964970e-01   +8.027961768546157e-01   +4.180708288230521e-01   +3.540583319231066e-01   +5.198017587184033e-01   +4.417198410986065e-01   -1.014268232889407e-01   +1.674582414095714e-01   -1.812695738840918e-01   +2.609592703430890e-01   +2.501849357763511e-01; +4.381070549336269e-01   -1.680845430713616e-01   +1.186738166258257e-01   +3.598551823865460e-01   +1.193863505635261e-01   +9.454024069546596e-02   +8.595343763205703e-01   +7.808696011129290e-01   +4.829629626482071e-01   +1.315181925834590e-01   +4.210341708121308e-01   +6.703879664599010e-01   +3.689526916329023e-01   +4.358146524576567e-01   +1.809207586603722e-01   +4.652267665265700e-01; +7.603313405203157e-01   -2.035823986782324e-02   +6.955487580175491e-01   +7.739487978587267e-01   +9.918665661544218e-02   +4.330792478535622e-01   -4.520879830210599e-02   +6.382338006329716e-01   +3.078840250144234e-01   +5.074815618386781e-01   +6.468623388029275e-01   +3.012416699027270e-02   +2.434638632699856e-01   +3.613367130161055e-01   +4.389353138162634e-01   +2.299997459521530e-01; -1.553373495085398e-02   +6.213328248879476e-01   +3.590779205048658e-01   +1.478789009704394e-01   +8.964594037966762e-01   +2.563840776984324e-01   +9.062109742763600e-01   +2.023785244429407e-01   +2.831804732502473e-01   +2.641072294311635e-01   +5.984804551819577e-01   +1.001053282906299e-01   +5.496070188923216e-01   +3.277316297332032e-01   +8.467043899798288e-02   +4.188147967098110e-02; +5.330005658763425e-01   +4.385043912614588e-01   +4.623152049144878e-01   +7.349270550031001e-02   +2.909103231607217e-01   +3.317965306436617e-01   +9.887792368742827e-02   +1.357407320425225e-01   +6.832033208101564e-01   +3.850361292137000e-01   +1.292393721143514e-01   +3.321495581137106e-01   +2.115780935667878e-01   +3.799270219272673e-01   +5.439251465751219e-01   +4.151477738912601e-01; +3.131739911189581e-01   +4.950326695347959e-01   -3.748988019743314e-02   +8.399437129536066e-01   -5.125399120904328e-02   -1.350403749211788e-01   +5.125749001875866e-01   +4.785212707146294e-01   +6.663245239019445e-01   +4.930969827394356e-01   +2.576215438900931e-01   +4.885692695033813e-01   +1.626723162838309e-01   +8.680561211497970e-02   +5.669083643742837e-01   +6.073788439268236e-01; -7.911619827168587e-02   +6.480466723485041e-01   -1.678248185343113e-02   +3.502550566237914e-01   +2.164997533504991e-01   +5.174807492010840e-01   +4.206113440603066e-01   -2.411821074246285e-03   +1.932320526844392e-01   +4.059213662842640e-01   +8.233860338603306e-01   -2.546203692518179e-01   +4.583426838429488e-01   +3.829380696891150e-01   -4.473859119610171e-02   -1.133591141730246e-01; +1.670499824474099e-01   +1.897069528800610e-01   +5.832423455405298e-01   +5.291634879557637e-01   +7.082983096112153e-01   +3.020930745414406e-01   +5.922507192612693e-01   +5.235434931408931e-01   -3.511015632658836e-03   +1.805653241779037e-01   +2.199541474575900e-01   +3.742571082652716e-01   +8.104162289208348e-01   +8.131204424875078e-02   +3.183525756463896e-01   +5.988798391439112e-01; -2.510974994682118e-02   +7.316926740072268e-01   +3.902438340008383e-01   +2.234581618980368e-01   +7.420766671982485e-01   +7.205887979162394e-01   +6.080793027846857e-01   +1.108029054264061e-01   +4.700614922457395e-01   +5.960506680471785e-01   +3.379966439510222e-01   +3.463191521283660e-01   +1.493695958934617e-01   +5.383158581803629e-01   +5.605160510194118e-01   +4.225295164286729e-01; +6.061318150062175e-01   -3.435753862654520e-02   +7.792129258465977e-02   +1.301261656578157e-01   +3.612886441484411e-01   +7.246651638036063e-01   +7.121438693027286e-02   +3.827721804856540e-01   +1.000000000000000e+00   -3.895582663120967e-01   +1.378550650737135e-01   +4.424165154225451e-01   +1.145407301893799e-01   +3.925553177097194e-01   +9.936735715622104e-02   +4.107409398188581e-01; -3.265274271132555e-01   +3.963815952924434e-01   +5.675164503616467e-01   +6.176890015027059e-01   +8.456828018896282e-01   +6.253472061707084e-01   +3.035837254024418e-01   +4.974444524561899e-01   +8.789527021865118e-01   +5.654981170415951e-01   +2.686969307121259e-01   +3.611941850031616e-02   -1.391840795527495e-01   +2.816825340153304e-01   +2.897521825486504e-01   +1.384415913560025e-01; +3.764454116979599e-01   +4.323596053828381e-01   +5.250071586571150e-01   -3.118570895392865e-02   +1.864376534080590e-01   +6.311147442676325e-01   +3.029680096440633e-01   +4.027767259864447e-01   -6.967975229212339e-02   +1.143231765629636e-01   +6.049957260408653e-01   +6.492667156527204e-01   +6.846349568108206e-01   +2.439129078933341e-01   +3.586323739779727e-01   +1.798503897429412e-01; +5.897480484227720e-01   +3.671908273763255e-03   +5.678371874318325e-01   +7.799562762263736e-01   -3.033579733042997e-02   +2.171710579571627e-01   +5.621437285604121e-01   +1.013754869901940e-01   +7.761236812528115e-02   +8.730709884098813e-02   +3.197731905477075e-01   +3.970316614379785e-01   +5.446958759949414e-01   +3.360314713618768e-01   +4.203748491853097e-01   -1.583473810279853e-01; -1.034693727518901e-01   +3.029241112986192e-01   +5.417531583518856e-01   +6.459508626937871e-01   +9.026159110045452e-01   +5.996340490277527e-01   -1.266405504893520e-01   +8.386574054286380e-01   -1.634000295441826e-01   +5.391732393110961e-01   +4.626322833987238e-01   +3.412128272127440e-01   +1.676171507701453e-01   +7.170946083105011e-01   +7.543859073811986e-01   +1.598397549462465e-02];
L1E_L1I_iGABA_netcon = [+4.437632197027983e-01   +4.759830092845178e-01   +1.922877145879880e-01   +3.293039151888155e-01   +3.063022942369039e-01   -4.535969091363603e-02   +2.639497123985239e-01   +3.224347106964842e-01   +2.378743976924982e-01   -1.181362866420732e-01   +3.221776053844124e-01   +9.005488762966495e-02   +5.691836183561404e-01   -1.102073278290468e-01   -3.675797703199479e-01   +1.000000000000000e+00; -7.021579737608631e-03   +3.890141915704066e-02   +4.360923458015623e-01   -5.542195128649904e-02   +2.790829976617465e-01   +4.281249786055980e-01   +4.300599676420119e-01   +2.029328240209031e-01   +4.597620211043303e-01   +2.099744181614132e-02   +4.107079207945331e-01   -3.937844166053536e-02   +7.659523338223998e-01   +2.580830515032078e-01   -8.748988229664778e-02   -2.406821759705599e-01; +1.080416355700660e-01   +2.984674219425768e-01   +2.512097431555123e-01   +4.133916991144957e-01   +3.026312590410035e-01   +7.001617637511265e-02   +1.498122752058704e-01   -1.500089758097416e-01   +1.353230784639182e-01   +7.571701743648204e-01   +4.766480380868952e-01   +1.164731026739645e-01   +2.847152849036116e-01   -1.696056386775611e-01   +2.882391072484324e-01   +6.007590240980066e-01; +5.505727880514281e-01   +1.948247078490090e-01   -2.019784029729552e-02   +3.463499087523425e-01   -2.401074103933607e-02   -6.886468825578880e-02   +1.806234533609115e-01   +7.849136087180649e-03   +1.889291397340222e-01   +1.944115374808241e-01   -4.854815316862335e-02   +6.646860119405676e-01   -4.064552357522618e-02   +4.246735957943044e-01   +2.963240818591730e-01   +8.941402164207933e-02; +2.038024096761875e-01   +3.854030792150151e-01   +6.020838769888361e-02   +2.287176391729241e-01   +6.464188799153662e-01   -1.575563570195112e-01   +8.612429962875366e-02   -8.926524252747878e-03   +3.790165064668514e-01   +1.506545205431976e-01   +1.272338453748962e-01   +2.550797034953387e-01   +2.510239632225331e-01   -2.983139442155920e-01   -5.954359498828261e-03   +3.802085632211190e-01; +1.864849048172630e-02   +1.947360343079635e-01   +3.971379279510479e-01   +2.367089093712487e-01   +3.361602101607223e-01   +2.689388577324961e-01   +1.758369690356029e-01   +4.863391533617686e-02   +2.533736999361892e-01   +8.495379823446286e-02   +1.782203228536605e-01   +5.221257898582351e-01   +9.050251516069607e-02   -2.192198961778603e-01   +4.318567735401278e-01   +5.024081077948340e-01; +2.250736338061639e-01   +1.230144992022693e-01   -3.705643072538041e-02   +5.883771683997732e-02   +4.580126593512378e-02   +2.846728748428676e-01   +5.890495913355017e-03   +1.390848796386152e-01   +1.975401093029439e-01   -2.956247129176062e-02   +3.212422506925030e-01   +2.400990928569441e-01   +3.968173901860502e-01   -1.825353628921542e-01   +2.829019239623481e-01   +2.370211932797100e-01; +2.516991899507398e-01   +5.441943011407363e-01   -1.809735303035225e-02   +4.893236240294984e-01   +1.501232281233991e-01   -6.752729905114024e-02   +2.445099643582324e-01   +2.208963632955933e-03   +7.285576027878411e-01   +6.459478273411912e-02   +2.850070689882062e-01   -1.003042788627908e-01   +3.723646971675306e-01   +4.013358806618025e-01   +7.339278005666082e-02   +3.339953705198414e-01; +4.912996481708977e-01   +2.731923092264719e-01   +3.289845629277109e-01   +1.386901956827873e-01   +7.026287367113677e-02   +4.671799587982297e-01   +2.489318582021767e-01   +1.448472972829014e-01   +3.169988550919481e-01   +3.584858853385782e-01   +2.055136457459583e-01   +5.057582129033525e-01   -4.614325275262580e-02   -9.525094271438637e-02   +5.396589777013676e-01   +3.672962794773890e-01; +1.041175653824199e-01   +4.961572391769027e-01   -6.545925997418917e-02   +2.861794449651163e-01   +1.399710109732988e-01   +5.556581683815772e-01   +3.048015027178780e-01   +1.124406069698679e-01   +5.301604518311201e-01   -1.506783730532004e-01   -5.299001656700818e-02   +4.732762443906940e-01   +3.793789133665200e-01   +5.877170186365283e-01   +1.161322368509309e-01   +6.659069597265586e-01; +2.021833369709573e-01   +7.728579651493379e-02   +2.794601903693792e-01   +2.185125208691539e-01   +3.001496259481869e-01   +3.277191087930933e-01   +3.557314476062538e-01   +6.465628104141613e-02   +4.624687677124916e-01   +2.190003409654421e-01   +1.570630036866742e-04   +3.964972340622748e-01   +3.777848440365592e-01   +5.261894104441117e-02   +1.634002482635712e-01   +8.301735937681659e-02; +4.657507411013050e-01   +2.742732194037504e-01   +1.139673404189913e-01   -1.762900778396075e-01   +1.054578225867744e-01   +1.707772095845611e-01   +3.115943745081659e-01   +4.068170788566997e-01   -2.537674205694488e-01   +1.231172311220351e-01   +4.623663852288910e-01   +6.877076619948410e-01   -2.061265302590436e-01   +3.985326524943756e-02   +2.303610206261462e-01   +3.054251106424794e-01; +3.775760368207204e-01   +4.547036069270107e-01   +6.277557062712431e-03   +5.922342413083148e-01   +7.700267450135546e-02   +2.268536382550598e-01   +1.653183398730728e-01   +2.724290561224299e-01   +2.318599583385450e-01   -8.435601337617990e-02   +3.843765283608937e-01   +1.914833711821169e-01   +2.639733399926723e-02   +2.219931656295855e-01   +5.943710162333482e-01   +1.099728587695087e-01; +5.322077063726343e-01   +3.315320789318206e-01   +2.079142952180836e-01   +3.119130533060819e-01   +1.432881978581976e-01   +3.216092088574707e-01   +3.677455927201321e-01   +2.385871993796244e-01   +4.092084076182911e-01   +7.492794264060386e-02   +3.277163828701802e-01   -5.973103762667623e-02   +1.565551506334636e-01   -1.714110779611592e-01   +1.824223597572754e-01   +2.377926745259531e-01; +5.957153138026358e-01   +3.936303682139429e-03   +3.028069418253520e-01   +2.531917978033464e-01   -2.127949722896622e-01   +1.702839681979084e-01   +1.688161369659801e-01   +3.291186749996422e-01   +1.999819024438444e-01   +3.027728466603414e-01   +5.438735158802167e-01   +3.475453303824231e-01   -1.702688270181331e-02   -5.445285649931856e-02   +3.466553672029248e-01   +2.847613604293175e-01; +2.495709502498047e-01   +6.081712776924153e-02   +4.831777477812259e-01   +7.936132777487243e-02   +4.315847698284815e-01   +4.003501391754286e-01   +3.179918698446617e-01   +2.098742188940461e-01   -8.223969729188091e-02   +3.797735143041959e-01   +1.956664695761331e-01   +5.194223032264907e-01   +4.364118536104236e-01   +1.715482434974188e-01   +1.173285500404985e-01   +3.590689716244689e-01];
L2I_L1I_iGABA_netcon = [+4.258936224586391e-01   +2.126037419117603e-01   +2.865297200880974e-01   +3.561956904712262e-01   +1.548627001695977e-02   +6.801734192747574e-02   -4.325797585502771e-02   +2.145775761453222e-01; +4.269393495985001e-01   +8.959952632846400e-01   +2.463671525662084e-01   +3.755531034366912e-01   +5.155563388780486e-01   +3.986177336635175e-01   +6.227560424903749e-01   -1.557969192573192e-01; +3.478318133846544e-01   +2.727330385300301e-01   +6.678707435337260e-01   +1.544537700440038e-01   +6.091963548528607e-01   +7.472166748053266e-02   +1.568489825537551e-01   -3.482032352035653e-01; +6.342644375986505e-01   +3.743579912868862e-01   +2.170534945990457e-01   -4.774445143741064e-02   +9.424522031933242e-01   +3.543932129733661e-01   +4.884931529698955e-01   +5.682868779184395e-01; -3.937985876577878e-02   +7.193250982062176e-01   +5.559908188390571e-01   +3.092416874432727e-01   +5.845936444232342e-01   -6.621369016675627e-02   +5.238700152238345e-01   +2.500278315610969e-01; +5.359119941308312e-01   +8.121405103103888e-02   +5.205161645739547e-01   +4.198311614993172e-01   +3.892789701416563e-01   +7.198871298775683e-01   +4.721711466039207e-01   +6.037316741918139e-01; +7.761370923922675e-01   +7.872547261755068e-01   +6.205818107701924e-01   -1.834619388855649e-02   +4.740725352278372e-01   +1.345021073681834e-01   +5.672455635855714e-01   +1.360637342528999e-01; +3.029198931623808e-01   +4.046289313445823e-01   +6.178959745867133e-01   -2.058314668139472e-03   +1.178092908232155e-01   +1.698536375862725e-01   +3.793344076804692e-01   +2.036341647808893e-01; +6.824465067605852e-01   +9.799066839719549e-01   +1.226278049571469e-03   +7.299658048942493e-01   -2.993698220227019e-01   +2.691254852733962e-01   +3.162586042293328e-01   +3.313249745441986e-01; -2.639929691694970e-01   -9.168476514140375e-02   +1.859769959052225e-01   +6.322370258407992e-01   +8.216760627868759e-01   -8.873030440846058e-02   +1.399539644146940e-01   +7.711268994565275e-01; +2.511161246608573e-01   +3.118617239208364e-01   +6.487236867778692e-01   +6.380593916680320e-01   +2.981045693099504e-01   -1.637193884104211e-02   +3.783978086127873e-01   +1.066337651462186e-01; +2.218907408892798e-01   +6.254656756294356e-01   +4.117172154378974e-01   +3.774729804546090e-01   -1.274633197374061e-02   +3.674850341830345e-01   +2.362921050217291e-01   +2.490984975095476e-01; +1.872547195813894e-01   +5.633323154679437e-01   +8.537570697573246e-01   -2.069189833419842e-01   -8.947597389618644e-02   -3.973591744182439e-02   -6.558572712694168e-02   -7.327315220184516e-02; +1.886393053706671e-01   +1.985523418433969e-01   +6.282262304124189e-02   -3.379237968935184e-01   +4.901644094088774e-01   +2.245513689987068e-01   +5.154992678325057e-01   -1.734495605698266e-02; +9.160226889516857e-01   +6.089784648312149e-01   +6.629920230896100e-01   +7.165423285249615e-01   +5.351196203999889e-01   +8.835880590380744e-01   +4.594411929603262e-01   +7.787114339168473e-01; -4.822154035024356e-02   +1.859182868512599e-01   +8.114366995989301e-01   +8.842300903854762e-02   +1.575583649448488e-01   +7.734400976571283e-02   +3.976789426893815e-01   +7.041264683081359e-01];
L1I_L2I_iGABA_netcon = [+3.432262081949443e-01   +5.963501479846874e-01   -5.239966130731320e-02   +7.369375720174421e-01   +3.191863832595735e-01   +1.204119732873058e-01   +5.891685880572602e-01   +4.489918015472419e-01   -3.809911300471657e-01   +6.786411481397308e-01   +2.825309782835990e-01   +3.441390685315143e-02   +3.764549461484170e-01   +2.342940972673521e-01   +2.103732111929626e-01   +3.314173248959227e-01; +7.227766248914090e-02   +3.575007167669066e-01   +2.754245760942108e-02   +2.282088490165841e-01   -3.079807266647592e-01   +5.068697177056171e-01   +7.480246125841525e-01   +4.552083630782262e-02   +4.928261536008031e-01   +4.054585406016769e-01   +3.475182543221452e-01   -7.123326115324354e-02   +3.018288634458868e-01   -2.093464402436816e-01   +2.185662545674216e-02   +5.615307113874292e-01; +2.403723979923551e-01   +2.271152262339394e-01   +4.499591500574749e-01   +3.154740904716166e-01   +3.110068907673681e-01   +4.438462604469091e-01   +3.584742557882064e-01   +6.489612355448710e-01   +5.063350124219006e-02   +2.531582834802446e-01   +1.041313746594205e-01   +3.432660571116073e-01   +4.063199636211706e-01   +4.745574333035407e-01   +4.466168018040427e-01   +1.657197842672171e-03; +2.607993494534849e-01   +2.973934456845300e-01   +1.548062922332880e-01   +1.441879146554867e-01   +6.180919090463178e-01   +2.081197194547674e-01   +5.143521995845739e-01   +5.952719912591170e-01   +8.309402389009397e-02   +4.619490241651042e-01   +8.351358926039348e-02   +2.120020156481195e-01   +5.399476423889262e-01   +1.719254765849844e-01   +3.702971425493005e-01   +1.249707208196278e-01; +2.471374501232008e-01   +1.283752018067192e-01   +4.126107737776492e-01   +4.214180555411198e-01   +3.555230515520128e-01   +8.512886860560983e-01   +5.321195781704522e-01   -8.064965840804099e-02   +4.138941293871454e-01   +1.383877230993987e-01   -3.581982739645998e-02   +7.925956979213579e-02   -1.036689394871286e-01   +2.817608470640607e-01   +4.466368978429914e-01   +7.474130526197863e-01; +3.015347696740154e-01   +5.004378886512829e-01   +1.868874551487324e-01   +8.421299247880603e-01   +3.034297743016389e-01   +5.376393226000690e-01   +5.333701364975478e-01   +2.819586134816814e-01   +2.363393457959215e-02   -2.088606296752168e-01   +3.437382374493483e-01   +1.487888483844604e-01   +4.998656416932036e-01   +5.199904950335856e-01   +3.324979992515791e-01   +2.129690090547187e-01; +5.628843909281633e-01   +6.723725604495042e-01   +2.412301242261063e-01   +4.042283077586185e-01   +4.168083219172702e-01   -7.064193789099238e-02   +6.654091875749930e-01   +6.986136417144949e-02   +7.051863821581369e-02   +5.595182676258724e-01   +2.978973083839193e-01   +2.331705322842527e-01   +7.160554584234015e-02   +2.433776568386769e-01   +1.534562763845392e-01   +5.310630490784793e-01; +4.793017050196118e-01   +3.150276347993931e-01   +1.863612244884466e-01   +3.453319329975484e-01   +3.281620085547056e-01   +6.503971277936389e-01   +3.606809960681479e-01   +9.104696769079094e-02   -1.269220324782813e-01   +1.800774994928905e-01   +6.983367573118628e-01   +4.867363453892040e-01   +6.080060316545057e-01   -1.432657086382742e-01   +4.227238602261157e-01   +1.187702694033656e-01];
L2E_L1E_iAMPA_netcon = [+4.051478691528484e-01   +2.142855858656686e-01   -9.816637759328875e-02   +5.225570536282839e-01   +6.052483031173910e-01   +3.183353762844837e-01   +3.132165232560165e-01   +3.276792966798693e-01; +2.249082434419257e-02   +3.384787704258707e-01   +1.130551797897763e-01   +1.282277431420135e-01   +3.106274824837924e-01   -1.742548685698682e-01   +3.060260575843813e-01   +5.762157919382950e-01; +2.082890228050643e-01   +6.251537028615449e-01   +4.938170740667647e-01   +1.582838888372594e-01   -8.333524103666440e-02   +4.897767085414920e-01   +4.443921768417035e-01   +3.407765652711383e-01; +4.784056565825706e-01   +9.634458310847305e-02   -7.925023296050182e-02   +6.431814116822098e-01   +1.680073896263985e-01   +4.166893598666887e-02   +1.794477770876492e-01   +3.049534760166814e-01; -1.700667781112565e-02   +4.240828917488507e-01   +2.690193694977263e-01   +1.178516922251983e-01   +6.343513932774074e-01   +3.729612713116490e-01   +8.093465624231062e-01   +7.457402792787982e-01; +4.049973243073066e-01   -1.585208449409154e-01   +6.649911498232459e-01   -2.231753861751614e-01   +5.991859743459679e-01   +6.211424160503218e-01   +6.643167728021568e-01   +3.287360549740238e-01; +2.988341614734586e-01   +2.881235118493793e-01   +1.299824489439473e-01   +1.546696302576097e-01   -1.258380356053574e-01   +8.437645203683600e-02   +8.741156914747970e-01   -1.184751630856946e-01; +1.105110821330086e-01   +3.894005730457086e-01   +6.999525932144843e-01   +9.554548481042179e-02   +5.639128170068128e-01   +4.413350338111398e-01   +3.309333189839022e-01   +3.652675544778902e-02; +4.963595864650487e-01   +3.127331038865667e-01   +3.614227274304521e-01   +8.101784545154258e-01   +7.548983776785552e-02   +6.578931345252098e-01   -1.671158509609351e-02   +5.438764657329413e-01; +3.355207775139374e-01   +5.747560446352928e-01   +4.262894607262621e-01   +4.128134012550556e-01   +3.100685828263103e-01   +3.216368345554763e-03   +3.479245583921337e-01   +4.449642143075245e-01; +3.269076532340204e-02   +4.696109179899617e-01   +2.738363856280436e-01   +3.023612124260582e-01   +3.116813618102539e-01   +3.723440484434296e-01   -2.866488722836154e-01   +3.105514509408219e-01; +3.085756957222097e-01   +2.611639612578558e-01   +7.588422432441883e-01   +1.006197182510979e-01   +2.653108344065842e-01   +2.176639426700324e-01   -3.790788952699434e-01   +3.318845919307093e-01; +1.995709539356483e-02   +3.332595488700935e-01   +2.157900039172981e-02   +4.669482319377119e-01   +1.142527981649566e-01   +4.767689279958492e-04   +3.685921660319327e-01   +2.089270252154610e-02; +1.535393463805547e-01   +2.700134964007395e-01   +6.145511275373779e-02   +4.373467254243561e-01   +3.245382866995668e-02   -3.229527161623146e-02   +5.741228555222243e-01   +2.816036064220072e-01; +2.547312724999509e-02   +4.613241069290848e-02   +5.277799585860893e-01   +5.071603579593338e-01   -4.921689241150942e-02   +5.361968334296834e-01   +3.674641957511641e-02   +1.069153519754205e-01; +3.864233562977789e-01   -8.736243443144973e-02   +1.093095583132543e-01   -5.013617462476078e-02   +5.894680725287758e-01   +3.163138153239510e-01   +1.174639156654220e-01   +6.196467232493004e-01];
L1E_L2E_iAMPA_netcon = [+1.384168289607261e-01   +2.267904229579616e-01   +7.619945955332016e-02   +4.295477410437017e-01   +1.540509386500726e-01   +3.623584323030155e-01   +3.677579664701204e-01   +2.659501746216086e-01   +4.263165612407787e-01   +3.690390817641450e-01   +4.690702407919625e-01   +7.083015012112513e-01   +6.709085876169635e-01   +1.936194979579253e-01   -8.240093215271350e-02   +7.740735152602274e-02; +4.074865565330369e-01   -1.304235911640389e-01   +2.863911934603368e-01   +4.934955734429648e-01   +1.345881020785000e-01   +1.468401289557900e-01   +8.725852483520415e-02   +3.606843279896154e-01   +4.081453176396137e-02   +4.505662432541714e-01   +3.125024383866825e-01   +8.337196574906363e-01   +3.760645582403347e-01   +2.485396318237231e-01   +4.213716188371673e-01   +1.777777868111496e-01; +7.995628148211940e-01   +4.268714092862772e-01   +8.750278472960329e-02   +1.691958708462774e-02   +4.068611650025745e-01   +4.216501314027513e-01   +1.822623455351615e-01   +7.195444966567743e-01   +5.456609156797066e-01   +1.873438045422646e-01   +4.345267251574981e-01   +3.675501824093978e-01   -2.093960783408996e-02   +6.610916075735916e-01   +6.645791493627259e-02   -1.519927751385337e-01; +1.690177908614574e-01   -7.400602643756601e-02   +8.702840075349478e-01   +1.086744682738626e-01   +1.029703067587271e-01   +2.916650230244798e-01   +9.995067047660997e-01   -7.077509586496422e-02   +5.288465886134632e-01   +4.180030633403582e-01   +6.191559550319075e-01   +2.432385534615573e-01   +9.377660279486220e-02   +5.089983240760799e-01   +4.885302905597653e-01   -2.001161555416848e-01; +3.947510256832100e-01   +2.921559209113853e-01   +9.479792543812087e-01   +4.981520552030890e-01   +4.036497255316054e-01   +6.749922412025877e-01   +5.980953063061797e-01   +4.248609376288402e-01   +6.452763040486069e-01   +3.265911910092623e-01   -7.081656212785734e-02   -1.791410286276632e-01   +4.383496780077278e-01   +3.830400386362308e-01   +9.892980474845912e-01   +1.582399129730195e-01; +1.815916910141317e-01   +8.362980500542614e-01   +2.675589446940353e-01   +5.842957457810728e-01   +2.004964854302561e-01   -7.281022774746607e-02   +6.287954402777880e-01   +2.146464244896492e-01   +5.530619994905823e-01   +2.092264906011507e-01   +6.200964304437858e-01   +1.640351049217277e-01   +1.619169925297411e-01   +8.318697946669593e-03   -7.369398109009254e-03   +4.705255634034098e-01; +1.897341140649916e-02   +3.179762757446029e-01   +4.243458181383870e-01   +5.619674599801926e-01   +3.243390697116301e-01   +8.728133106808462e-02   +8.671845177852849e-01   +1.650787016089406e-01   +4.208895490909228e-02   +2.122074277448462e-01   -1.393377291478112e-01   -5.233177092560090e-02   -3.882604551798581e-01   +2.321976086334872e-01   +2.223917423410848e-01   -1.495517659636756e-02; +4.237660301681870e-01   +4.127425881561270e-01   +6.429657009990700e-01   +7.810598431100967e-01   +7.591870982398286e-01   +8.898413794504629e-01   +7.750325435666344e-01   +6.710748692252971e-02   -3.813776549889700e-01   +4.936172433392594e-01   +5.865198999176737e-01   +4.254096320858318e-01   +1.732967934129817e-01   -1.191483706353145e-01   +2.612798103696313e-01   +3.379224911443381e-01];
L2I_L2E_iAMPA_netcon = [+4.534899544706490e-01   +7.103788226267417e-01   +4.041853175240548e-01   +3.657967627858694e-01   +3.934753652004164e-02   +7.526009655540761e-01   +2.785797371956050e-01   +4.513270682007454e-01; +6.956153363456098e-01   +7.016990523909242e-02   +6.029231545214876e-01   +4.887117882401550e-01   +5.775085960103541e-01   +2.537466192928465e-01   +2.693342533371385e-01   +3.200993897604243e-01; +4.649130523202108e-01   +5.471242142436727e-01   +3.080006287153854e-01   -1.553311304645340e-01   +1.732502207329330e-01   +3.980333276914674e-01   +3.578956349941180e-01   +2.492854365975619e-01; +3.729359138219860e-01   +3.353476551284608e-01   +2.066820424716337e-01   +8.237038026498674e-01   +2.794102113287480e-01   +1.972052286068094e-02   +3.590332630329068e-01   +2.519665898530243e-01; +5.728771814967093e-01   +2.452328214192966e-01   +4.197081559834242e-01   +5.851469322200482e-01   +4.633101835115003e-01   +3.719606411981240e-01   +8.091662410641867e-01   +2.828362981820238e-01; +3.771603349520031e-01   +4.100894506355146e-01   +1.093264543492676e-01   +5.467588890811720e-01   +1.805283472703698e-01   +4.872731333987583e-01   +3.241957017577789e-01   +3.018969423775441e-01; +5.631487970013932e-01   +9.776328972434387e-03   +3.055323442027634e-02   +6.962777536463514e-01   +5.116248105297582e-01   +2.773311490225496e-01   +1.000000000000000e+00   +1.305364352277603e-01; +8.594533006924877e-01   +1.991749497488404e-01   -1.444436156889794e-01   +3.302109986757946e-01   +2.585549784106469e-01   +4.940794646943355e-01   -2.673679301087000e-01   +4.562923454043832e-01];
L2E_L2I_iGABA_netcon = [+1.064313305918111e-01   +4.015167934669375e-01   +5.794293464748845e-01   +8.274880648423331e-02   -1.677624656211939e-01   +5.038660967264135e-01   +1.336582883537785e-01   +4.889044276191153e-01; +3.539563967350799e-01   +6.887575125663256e-01   +4.581689574690948e-01   +4.347095822101373e-01   +5.366904792331179e-01   +4.638140311945669e-01   -1.511999537647845e-01   +3.691307268872680e-01; +1.106370038226621e-01   +7.763871030070045e-01   -2.460187677118446e-01   +2.633449003396587e-02   +6.513938791610401e-01   +7.756972499762370e-01   +1.504867689411182e-01   +9.178333002256991e-01; -1.323836972698733e-02   +7.044781779224383e-01   +3.951870064116360e-01   +5.278515777617215e-01   +8.983562639397572e-01   +2.961766056086573e-01   -1.420874286277312e-01   +7.353592937693502e-02; +4.173367204374214e-01   -1.988135946588670e-01   +1.287446503668626e-01   +6.630520077511334e-01   +4.817985365234365e-01   +1.837320362089260e-01   +3.715875108855747e-01   -5.652735842981345e-02; +1.559683794594838e-01   +1.336983393038069e-01   +1.592278097712106e-01   +4.056404254788438e-01   +3.364473734074158e-01   -1.435285307143574e-01   +3.741497243137396e-01   +1.994876360046312e-01; +4.185700544394561e-01   +4.282303173637058e-01   -2.188964461137355e-01   +2.200151854587750e-01   -2.599297501717673e-02   -1.239494619152025e-01   +2.486334040698942e-01   +7.797396267035932e-01; +4.572575339488004e-01   +6.560299243478638e-01   +5.012157728859231e-01   -3.678030422190572e-01   +5.633870465614692e-01   +3.174703312307769e-01   +7.526736689353462e-01   +3.546774525790715e-01];
L3E_L2E_iAMPA_netcon = [+5.140731240694248e-01   -1.590587256353052e-01   +1.525820738620156e-01   +4.213998019210907e-01   +4.811002160110976e-01   +2.161183663374200e-01   +2.722000220221025e-01   +6.643209156665426e-01   +3.030934287713432e-01   +3.587731600107329e-02   -3.682263732689837e-02   +5.894516825235983e-01; +4.082951311387627e-01   +7.731205174697655e-01   +2.561924703214597e-01   +4.017824579845878e-02   +1.331164950489959e-01   -2.175020542513710e-01   +4.947257481612777e-02   +1.745439905157408e-01   +1.127696660907104e-01   +5.919746075687378e-02   +3.451974179268293e-01   +2.884916073132959e-01; +1.671384722181171e-01   +3.717115804325757e-02   +6.119644666423012e-01   +1.392834984555172e-01   +9.036490030312384e-01   +4.813404688975244e-01   +5.172770281014787e-01   +5.582566814457907e-01   +6.116256814578780e-01   -1.333035677942180e-01   +1.874289853435433e-01   +6.957795645445906e-01; +2.021636022195445e-01   +2.850664238677852e-01   +3.888675363720942e-01   +2.162821945973329e-01   +4.796719181141368e-01   +2.219650484807758e-01   +2.191822459441307e-01   +3.836185576885106e-01   +4.376942964659851e-01   +5.523495258711930e-01   -4.401709999274556e-02   +7.937454567160558e-02; +6.048292938744710e-01   +3.480121389680829e-01   +2.155658533649065e-01   -1.602406690111355e-02   +6.668415050955157e-01   +3.572690395276412e-01   -1.340353016881593e-01   +2.172301380060130e-02   +4.726295804323477e-01   +4.811575446684290e-01   +6.848954680414558e-01   +4.806349467537909e-01; +3.944348190941683e-01   +5.966684417351581e-01   +8.154055567788629e-01   -9.623711412568792e-02   +4.384258229295853e-01   +8.428491653633365e-01   +4.573814779825947e-01   -1.323727272467432e-01   +1.179779244263254e-01   +5.513083526641096e-01   -2.246559581273467e-02   +3.036257870348794e-01; +2.731527149836749e-01   +2.306596255902091e-01   +7.309523650252229e-01   +9.982417003008287e-02   -3.640864880171246e-02   +4.598583701044328e-01   +2.153146047696919e-01   +4.756515296617310e-01   +5.484071999609451e-01   +3.649123801618752e-01   +6.413303734607304e-02   +2.049738245141547e-01; -1.070952737076164e-01   +5.973185111649536e-01   +2.417761516067524e-01   -2.440560559846388e-01   +4.115953235121195e-01   -1.812802938503098e-02   +2.542534243807597e-01   +8.418812272076731e-02   +5.757377626248615e-01   +5.363797524494527e-01   -1.250156583950000e-01   +2.240126826342484e-01];
L3I_L2I_iGABA_netcon = [+6.368288963270786e-01   +4.324931882457417e-01   +1.691027739395163e-01   +5.579609624204522e-01   -1.633009940630957e-01   +2.971994384876783e-01   +6.558360629022322e-01   +3.469599721890436e-01   +5.785147922426193e-01   -2.420944221080357e-02   +2.377918726117355e-01   +5.134436659143882e-01; +2.021882465142910e-01   +2.443447187468679e-01   +1.013850390937281e-01   +1.772892534066036e-01   +5.932221153304265e-01   +3.924215931602649e-01   +3.271489712429308e-01   -1.146187149946999e-01   +2.518765101243859e-01   +2.524502477690563e-01   +3.494720009952791e-01   -2.598197726608705e-01; +3.041139929907521e-01   +5.354799291975821e-01   +4.180502524556630e-01   +1.614343411311903e-01   -1.295214649107990e-01   -3.603884151119735e-02   +4.778191528039595e-01   +6.142424060220938e-01   -4.571246717950670e-02   +3.341411039286734e-01   -1.550351753513895e-01   +4.246328103255222e-01; +4.790163300982453e-01   +5.482503233268653e-01   +5.323220435301785e-02   -7.815706414063081e-02   +1.763699515026654e-01   +3.767462855350128e-01   +2.003045433370679e-02   +6.026264615298217e-02   +2.603006710435137e-01   +1.557229344595730e-01   +3.911484589027328e-01   +2.335064829297551e-01; +1.711377472355321e-02   +1.502255782103004e-01   +2.478584388563387e-01   +4.500084409928580e-01   +5.109465822289473e-01   +5.445538954248874e-01   +1.703125035612600e-01   +1.000000000000000e+00   +6.292423007039117e-01   +1.354956637077497e-01   +1.857844779543720e-01   +6.213579495875017e-01; -1.764556198416961e-01   +5.487588251126958e-01   +2.657971699773179e-01   +2.054990385201564e-01   +7.540717097583858e-01   +1.998065124030762e-03   +3.241209012395458e-01   +2.886195486949408e-01   +2.802206751643868e-01   +2.286473139531162e-01   +2.698852217394453e-01   +5.267805318853900e-01; +4.514057542601936e-01   +2.827715578820743e-01   +7.422162682273877e-01   +1.946953058379752e-01   -9.504213838036850e-02   +4.639291931628563e-01   +5.374048431553816e-01   -3.474023370994090e-02   -6.465228541782383e-02   +3.333314950421655e-01   +3.255573509029847e-01   +1.756253444511735e-01; +1.839581636125106e-02   +1.131947177383947e-01   +7.338110593230808e-01   +5.802126166454371e-01   -2.022478503031102e-01   +5.526176754236369e-01   +4.605804799082249e-01   +6.004053150340789e-03   +6.878827491240885e-01   +2.874209787797953e-01   +4.256635578735470e-01   +1.516009571180072e-01];
L2E_L3E_iAMPA_netcon = [+4.722754628929341e-01   -1.186105467464316e-01   -8.538982624153574e-02   +1.975190004276428e-01   +7.005746793774928e-02   +9.713782157172045e-02   +2.186495857848915e-01   -2.509371042501272e-01; +2.243759818793156e-01   +2.343455210104328e-01   +2.705403532169286e-01   +2.368237982884627e-02   +4.797958326488496e-01   +1.417768328454010e-01   -3.191464840683203e-01   -2.907385391528070e-01; +6.653462648310613e-01   -1.054022149690894e-01   +5.486422262716434e-01   +7.398299928699972e-01   +1.732794577853692e-01   +2.745337234153375e-01   +1.210997814683887e-01   +5.720291208717070e-01; +1.584678342767081e-01   +3.964795568544913e-01   +3.789042048818471e-01   +8.811327977104670e-01   +8.135296713936374e-01   +4.879994246758658e-01   +3.916874654624306e-02   -1.279859231888715e-01; +9.715629720421437e-02   +2.891098629000666e-01   +3.937315465726715e-01   +9.100420053831614e-01   +8.581548526688791e-01   +9.977996016737332e-02   +1.191463537644353e-03   +4.048166581903622e-01; +3.020118771698769e-01   +5.649631265675691e-01   +8.519604522134692e-01   +7.166018022204317e-01   +5.756001260045455e-01   +3.350351415558877e-01   +6.504415880962695e-01   +1.851260534724411e-01; -1.765523356216845e-01   +3.131329262142634e-01   +8.413879300162951e-01   +5.481400475209339e-01   +1.108098213488831e-01   +1.081328237494922e-02   +3.186788189904610e-02   +3.361517747510485e-01; +3.812022484323594e-01   +5.262219840909190e-01   +4.496575202166689e-01   +2.854037396937829e-01   +4.687516770637389e-01   +3.210352387449864e-01   +5.341415262956095e-01   +8.371656575163351e-01; +7.860084978028145e-01   +2.196245126982484e-01   +2.828247157716458e-01   +1.097580709022308e-01   +3.311677985586945e-01   +1.217339341981929e-01   +6.296585892679571e-01   +5.305889120993787e-02; -1.863640133397146e-01   +4.110369522875251e-01   +2.917263834118600e-01   +6.559230239766750e-01   +1.893904487010399e-01   +1.517598916717656e-02   +5.627474691238349e-01   +2.870529806400783e-01; +3.749007458074360e-01   +3.257243808573563e-02   -2.205781314362846e-01   +5.689860337297624e-01   +6.416063623447043e-01   +5.381283836086089e-01   +2.276937040152768e-01   +5.162239814552834e-01; -1.471684245891240e-01   +8.718423731511226e-01   +7.453704385125235e-01   +4.979364847060490e-01   -1.286157589401260e-01   -1.436473230509690e-01   +3.357959350269020e-02   +5.427091341640182e-01];
L2I_L3I_iGABA_netcon = [-5.283821502374585e-02   +1.945812361450369e-01   +6.118170107878720e-01   +5.408091635397581e-01   -3.006417956133286e-02   +5.184420475343373e-01   +3.255558754958808e-01   -9.225380387895493e-02; -4.851938874929624e-02   +3.966144855923983e-01   -8.596097925100328e-02   -4.444945192706291e-02   +4.801896371425072e-01   +2.539221318666134e-01   +3.743127744584073e-01   +1.905023998751372e-01; +6.046844361525889e-01   +5.720331849438137e-01   +3.552592531662481e-01   +4.997335923028902e-01   +2.950147742436796e-01   +9.477944074124514e-01   +3.616530687128522e-01   +4.459310308267446e-02; +2.682520015533459e-01   +4.096760959057860e-01   +6.712064634610947e-01   -2.453559368491169e-01   +3.746708095685274e-01   +2.976932968114535e-01   +1.000618518154983e-01   +6.316029786252885e-01; +5.814463991802290e-01   +6.875473895187595e-01   +9.741063325426880e-02   +3.746433102444909e-01   +2.852215910917819e-01   +3.654240549020443e-01   +1.435820874472697e-01   -2.135273336578754e-01; +1.045861983740643e-01   +4.997693388650939e-01   +7.644955063964936e-01   -4.322143531056568e-01   +1.202327860793125e-01   +5.519893321106323e-01   +2.128512095266381e-01   -1.208118626555108e-01; +6.575035187321876e-01   +3.861548731544616e-01   +2.940133768731465e-01   +6.184050478995494e-01   +3.563895056369893e-01   +3.159571251805892e-01   +5.447773833569337e-01   +4.239899112608672e-01; -1.594952747946987e-01   +6.376329864286426e-01   -2.157027100452078e-01   -8.701513051165312e-02   +3.129032770186064e-01   +1.929841949756461e-01   +1.346635874026704e-01   +5.689162182961205e-01; -4.448290561179759e-01   +3.194939160007368e-01   +4.587365254346980e-01   +1.186734477323370e-01   +1.359545108234944e-01   +6.301023610619333e-01   +3.255527332181948e-01   +4.661396983598565e-01; +6.290640986587092e-01   -2.985883325525311e-01   +3.904320257829819e-01   -2.641038200173435e-02   +5.697759971128210e-01   +5.261485333434824e-01   -5.116662286904647e-02   +4.680274939859442e-01; +6.967421231974431e-01   +1.275203789627724e-01   +1.018419744733250e-01   -4.872343711110602e-02   +5.096677341098895e-01   -1.011732691046857e-01   +3.510426009067716e-01   +7.810193431280730e-01; -1.360558025625587e-01   +6.158785634781695e-01   -2.441940767137845e-01   +4.002692146057487e-01   +8.533256555015949e-01   +2.402177576817212e-01   +3.923355755782949e-02   +4.169934511070115e-01];
L3I_L3E_iAMPA_netcon = [+5.975235933541909e-01   +6.417421858887313e-01   +1.636521705814903e-01   +5.077759534401673e-01   +2.051258767509445e-01   -9.470396742135803e-02   +1.271204802129949e-01   +1.124394771661738e-01   +5.628940119744237e-02   +3.418578363969625e-01   +2.649942807362922e-02   +5.013287670592208e-01; +3.157176275463299e-01   +3.765096630472189e-01   +4.033403024371781e-01   +4.920639372140614e-01   +1.000000000000000e+00   +2.238394877702885e-01   +9.802536578269007e-02   +4.039483547774780e-01   +6.597712196345223e-01   +3.737730577519988e-01   +6.651482755841684e-02   +2.476750297821189e-01; +3.557375527164700e-01   +6.290871257641079e-01   +9.344319922638579e-01   +3.093714373049988e-01   +5.920333506792610e-01   +3.431885586076132e-01   +5.091970434219945e-01   -5.449230451379580e-02   +4.173704351442511e-01   +6.785626486315288e-01   +4.852871759039099e-02   +5.644542644233245e-01; +3.826513372399190e-01   +4.837670677087799e-01   +2.671169279912209e-01   +2.695609966267016e-02   +2.833985920599768e-01   +4.953085976334374e-01   -2.017897025107155e-01   +1.808320897533673e-01   +2.012651047001172e-01   +2.581442207651169e-01   +2.899067975377883e-01   +2.481880817001670e-01; +3.662360785198029e-01   +1.694294877651270e-01   +6.787198784018624e-01   -2.471252305571083e-02   +2.488660503850978e-01   +2.212674369233390e-01   -2.665646893651897e-01   +2.381190056912488e-01   +6.134995969476505e-01   +6.225420371131934e-01   +6.257559576657105e-01   +4.529660204578460e-02; -2.464490954162486e-02   +2.287824515952274e-01   +4.628932259315024e-01   +9.784088328346546e-02   +1.897421299508044e-01   +1.237190002820757e-01   +4.845588800135815e-01   +2.266971339616072e-01   +2.482598901992369e-01   -1.539575442158502e-01   +3.320758820496026e-01   +2.282286532447317e-01; -1.770229008285030e-02   +1.400919338167116e-01   -1.751204401066854e-01   +2.766664548099695e-01   +4.699788575882314e-01   +2.835414335148531e-02   +3.230767513143462e-01   +2.628881162631426e-01   -3.151749696621470e-01   +2.141536237380689e-01   +3.984320017891770e-01   +2.613126448300487e-01; +4.150714853045103e-01   +4.025664334000683e-01   +3.553935842257842e-01   +3.978023671410543e-01   -9.582570359197420e-02   +5.324560132384076e-01   +1.566855505532260e-02   +4.459698038307484e-01   +6.299504566254004e-02   -1.532872737388749e-01   +2.245501172130845e-02   +3.370765960004569e-01; +1.166670223205101e-01   +6.740241209366469e-01   +3.315739769832928e-02   +5.650130735001123e-01   +2.430071197521412e-01   +6.223124044086765e-01   -1.438955002735348e-02   +7.018686232214931e-01   +5.745538872045149e-01   +5.179558772382524e-01   +5.215310070945117e-01   +6.349043420385229e-01; +8.074101936395114e-01   -1.699249142205446e-01   +7.861665273499068e-01   +2.220736371416954e-01   +4.554820448874868e-01   -1.048721948682286e-01   +4.149781191017101e-01   +1.965252441494971e-01   +2.449692154037396e-01   -5.789752327521631e-02   +6.688525233321092e-01   -2.163421505794968e-02; +1.033621166762585e-01   +2.939589450840110e-01   +5.176897223442717e-01   +3.204886055111351e-01   +6.042919690829481e-01   +1.396335936304041e-01   +2.288881381137169e-01   +3.803170946726844e-01   +7.538341092358014e-01   +2.378505940653206e-01   +3.964792730849451e-01   +5.813981679184218e-01; +2.015539017253150e-01   +7.479629414322914e-02   +4.188360084295750e-01   +4.699717239303220e-01   +6.107764805323047e-02   -2.815287434507306e-01   -3.868833395532336e-02   +4.041649576697197e-01   +7.223687353741769e-01   +4.692837418671865e-02   +4.975995271136256e-01   +1.947497618430752e-01];
L3E_L3I_iGABA_netcon = [+9.702699759090409e-02   +7.131367801358650e-01   +3.327436667422116e-01   +3.790975377329453e-01   +5.355469734403778e-01   -5.148488499133268e-02   -2.064608866088827e-01   +2.156471632910185e-01   -6.583794372997731e-02   +3.897075821518199e-01   +3.292226084419190e-01   +8.389348067440777e-02; +4.507210522754917e-01   +3.445011019576132e-01   +4.117605342276863e-02   -1.012172032681558e-01   +2.655103193490862e-01   +1.909644057475728e-01   +8.190425893969773e-03   +3.243058853529349e-01   -5.793418450877607e-02   +2.834985000072763e-02   -3.322319715769276e-02   +9.926773486019019e-02; +4.517743782712885e-01   -1.901681384173047e-02   -1.638055999774532e-01   +2.187449518679347e-01   +4.288667600516027e-01   +4.200781660659148e-01   +3.989063888125817e-01   +2.860388363284661e-01   -1.835019021584068e-01   +2.650241205057662e-01   -2.245116119503228e-01   -3.865495278311090e-02; +2.297035347424454e-01   +3.781250851082794e-01   +8.649736920627790e-02   +8.025657958369514e-02   +6.112024306111709e-01   +3.218939061800703e-01   -2.051153520466753e-01   +2.745723173202658e-01   +7.462573009026079e-01   +4.989118365266396e-01   +1.448203939577558e-01   +1.931282549000854e-01; +2.045080847479115e-01   +1.564500726609392e-01   +2.325604361370570e-01   +6.788968324017215e-01   +6.043484464550790e-02   +4.146585625175983e-01   -2.427205647862763e-01   +5.150577583964144e-01   +5.043303623826412e-01   +5.454221132675355e-01   +3.236525414631996e-01   +2.146876307360512e-01; +4.725421097655034e-01   +2.224551265282472e-01   -1.621111972742101e-01   -2.316640156884934e-01   +6.603255337860606e-01   +6.254436278053151e-01   +2.676770422702173e-01   +4.147429221228733e-01   +5.069631069449319e-01   +4.197373218067159e-01   +2.899403787207340e-01   -1.073087487922760e-01; +1.361981832360152e-01   +3.351867063515752e-01   +5.111921198447080e-01   +9.780459653545955e-01   +3.392277662311863e-01   +6.838410701073341e-02   +5.417249465957462e-01   +6.448326180620669e-01   +1.422557166993897e-01   +4.402295361293386e-01   +5.451572297500510e-01   +3.618819571386649e-02; +1.517261873078679e-01   +2.698108974730578e-01   +5.274309129281765e-01   +4.530714434069577e-01   +4.156116575796364e-01   +2.268885974601633e-01   +2.310097211461296e-01   +2.216185435993218e-01   +1.644403248318559e-01   +4.749279298470381e-01   +3.192203051064329e-01   +2.018345914225850e-01; +2.500580783094567e-01   +4.952834360886637e-01   +1.134493677217662e-01   +6.836709510883229e-02   +3.260617956113620e-01   +3.490586760082753e-01   +2.823070070394071e-02   +3.411627039910305e-01   +6.723530855453796e-01   +6.968798980110146e-01   +4.969321702564792e-01   +3.071924933427168e-01; -2.363712743095552e-01   +5.106407987602554e-02   +5.965710029989681e-01   +9.013345032959892e-02   -8.816179504641744e-02   +1.239430534323711e-01   +3.342443290756451e-01   +2.831886184607937e-01   +4.073811117939265e-01   +1.155281999238094e-01   +3.483548862484712e-01   +4.917760739358468e-01; +1.584278996928531e-01   +2.886916795525229e-01   +1.786966743765935e-01   -3.392790436345996e-02   +3.965467000523624e-01   +2.032994391307090e-01   +4.560366632016550e-01   +4.640335983113527e-01   +2.761165182210474e-01   +4.868712207583750e-01   +2.062397659211039e-01   +1.684131848503261e-01; +3.635254008970950e-01   +4.173643973303612e-01   -1.013844523857308e-01   +4.811231321236004e-01   +8.530139266063506e-01   +5.838758160365620e-01   +6.203802700692477e-01   +2.827801712003886e-01   +5.774521401226176e-02   +6.271045614295903e-03   +8.609313696419812e-02   -6.205401010743855e-02];
L2E_Input1_iAMPA_netcon = [+5.712684954105555e-01   +7.131096170665059e-01   +8.887093792416724e-01   +8.485684497002230e-01   +8.401335736827890e-01   +9.137513291081768e-01   +7.712261436789259e-01   +9.167025016986120e-01];
L2I_Input2_iAMPA_netcon = [+6.087282644678367e-01   +6.210258436668403e-01   +6.644053604870123e-01   +5.363249890318299e-01   +3.075553213456394e-01   +1.000000000000000e+00   +5.281451096794457e-01   +4.597342130235665e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
