function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.903981659177909e-01   +3.243594852086507e-01   +2.467298155414042e-01   +8.708632352632557e-02   +4.625146644527291e-02   +1.976538513213866e-01   +7.568014419998960e-01   +7.484449156532318e-01   +6.750447654694758e-01   +7.449141508953354e-01   +2.328649378724614e-01   +5.500268376927850e-01   +4.320508123129069e-01   +2.747385531030510e-02   +6.754833776756810e-01   +1.347415229885926e-01; +5.586389880855697e-01   +6.350731145297664e-01   +3.175205974404694e-01   +3.550766467463642e-01   +7.406328191550243e-01   +7.503222706369858e-01   +3.267797346145029e-01   +2.300600450452193e-01   +7.053294034291330e-01   +6.804193541589593e-01   +3.868038189283246e-02   +2.249139670670158e-01   +6.069427158137111e-01   +7.984715750199582e-01   +2.954791900035126e-01   +7.741180604783227e-01; +2.276123010781144e-01   +5.583829330996033e-01   +8.946106388754901e-02   +7.853783534126083e-01   +4.055386957272387e-01   +4.057307596478664e-01   +6.465437325830689e-01   +7.481172514983105e-01   +5.866119264308265e-01   +1.260506845482988e-01   +1.160647467713130e-01   +3.161186937510402e-01   +4.707485994546451e-01   +4.221451692356660e-01   +6.173264515935207e-01   +3.314994026033709e-01; +4.603645128433685e-01   +4.002095374665924e-01   +5.224831303054944e-01   +4.575661656663091e-01   +6.053622937573570e-01   +3.724909588560251e-01   +6.946288744319615e-01   +4.180249430532109e-01   +4.688707080698267e-01   +4.867864166487971e-01   +7.791942378845270e-01   +5.537494763770310e-01   +9.933381947634093e-02   +7.247660412368012e-01   +3.794650716880429e-01   +2.702213301481265e-01; +7.388366591275205e-01   +4.594832080778331e-01   +4.485394955744665e-01   +4.537059256941068e-01   +5.062787482365998e-01   +4.851475134618156e-02   +7.525489918713615e-01   +3.981429547462869e-01   +2.463604818385330e-01   +6.950177487607996e-01   +3.511122813274044e-02   +6.695293980428776e-01   +2.424935508374162e-01   +7.805963679805683e-01   +1.477089760563366e-01   +6.376773733757595e-01; +6.902678324673981e-01   +1.802154038539461e-01   +4.905783910825613e-01   +3.885107771919517e-01   +5.619475774196447e-01   +1.356031818871290e-01   +4.064802585297984e-02   +1.914799095143678e-01   +7.096804148553882e-01   +5.290322378196284e-01   +1.689463939627912e-01   +7.818648108233895e-01   +2.865059397128671e-01   +7.240959668573224e-01   +2.065711499816774e-02   +2.202541546176116e-01; +1.868493313305261e-01   +5.049790250532001e-01   +6.561209940151310e-01   +2.994078043962413e-01   +5.761480896856093e-01   +5.297841794816566e-01   +4.809357153484676e-01   +3.145028314892034e-02   +6.843269737407236e-02   +3.491849534608118e-01   +4.338029420681224e-01   +6.456842013935026e-01   +5.623804343735587e-01   +7.574342435111966e-01   +3.200291380965846e-01   +6.659362885649480e-01; +2.472995999859310e-01   +4.543314311174865e-01   +2.386489426599726e-02   +7.292582317813683e-01   +2.928965716508039e-01   +5.736669393942122e-02   +5.778828160540681e-01   +6.831496327325557e-01   +2.546925642999276e-01   +1.498351216197696e-01   +1.807053633899473e-01   +7.995801624346187e-01   +6.470656838417864e-01   +1.240854048278877e-01   +3.289069950003931e-01   +1.780992195892892e-01; +6.075020908795421e-01   +4.557711103477549e-01   +5.322126342411825e-01   +3.964028627336414e-01   +4.689641708232695e-01   +7.438090150815528e-01   +1.046704790140966e-01   +6.273709716856979e-01   +3.875498448267280e-01   +2.137130742969435e-01   +5.864553854518216e-01   +7.489906843488294e-01   +2.394277986741656e-01   +3.230050967101214e-01   +7.801903851929796e-01   +7.259601177674448e-01; +6.394427621254556e-01   +2.138051273097013e-01   +1.144745110428224e-01   +1.473652596720351e-01   +1.342730321314907e-01   +8.605889840119960e-02   +2.984417510465530e-02   +6.849124577108572e-02   +2.775625464121468e-01   +5.806676533605692e-01   +2.793486814121404e-01   +3.078687108773652e-03   +4.997429791620611e-01   +5.434242607135978e-01   +9.565704976926265e-02   +1.010605312727250e-01; +7.840867602778249e-01   +7.718893165894407e-01   +5.376612765644208e-02   +4.057014463288886e-01   +4.826841106784278e-01   +2.015613703386461e-01   +6.419007695509497e-01   +6.391548174882844e-01   +3.130323658902608e-01   +5.030721434210105e-01   +6.985463569584062e-01   +6.905759602203166e-01   +1.017249056368800e-01   +4.639423553318235e-01   +2.975778851747152e-01   +4.357140444643613e-02; +6.754730203583219e-01   +7.716773585468117e-01   +3.777542810194686e-01   +3.493860601586765e-01   +6.389911380380402e-03   +3.614994967826152e-01   +7.025310315903527e-01   +5.603587967272188e-01   +6.568658910724464e-01   +3.344987769904750e-01   +6.155049665750437e-01   +4.721596480662303e-01   +5.034519268574160e-01   +3.460704292070096e-01   +6.338103459154032e-01   +6.559882397545932e-01; +6.912692183003850e-01   +2.009640575710339e-01   +2.970592808258210e-01   +2.819507782583414e-01   +7.310497933006264e-01   +2.593216676057392e-01   +6.087614156842830e-01   +5.111001561641469e-01   +4.234258143575581e-01   +5.584422609025842e-01   +4.162949088178659e-01   +3.985788986881348e-01   +6.178127990241514e-01   +1.459677629440647e-01   +6.763893504058828e-01   +2.262477884237155e-02; +2.239269370086867e-01   +2.154968120537349e-02   +3.338000847215997e-01   +3.143310304474090e-02   +7.164552521002397e-01   +4.947979592041914e-01   +6.213237841759651e-01   +5.123439411488183e-01   +5.599682212606908e-01   +7.513127505167252e-01   +4.572321386137728e-01   +9.610210499861001e-02   +1.375946556595441e-01   +7.388605834330602e-01   +3.666850443153233e-01   +2.291708508510260e-02; +2.207433785587427e-01   +5.604108426169636e-01   +2.419437690640868e-01   +2.027008668627360e-01   +6.242009963773305e-01   +3.834718376558546e-01   +4.468556511981411e-01   +1.333900530850015e-01   +1.700979314393717e-02   +6.981251550477900e-01   +5.957460737139449e-01   +6.976278314346287e-01   +8.568354050832663e-02   +1.676531896659035e-01   +7.128502403592029e-01   +4.367265345765782e-01; +5.431557875115638e-01   +3.305091688940988e-01   +1.282487865090214e-02   +7.894637565910209e-01   +6.020868341677945e-01   +4.389953866863943e-01   +2.938668817612976e-01   +7.630632290692829e-01   +5.142752356789222e-01   +6.909795239760610e-01   +5.627250582569374e-01   +1.180085467560081e-01   +6.984361868493189e-01   +6.901293510952091e-01   +5.422550558871629e-01   +2.068986078943877e-01];
L1E_L1I_iGABA_netcon = [+5.781430845164497e-01   +7.890235342575463e-01   +6.154764259386802e-01   +3.608838151090072e-01   +6.009430771900603e-01   +2.945851171203540e-02   +7.565578135593225e-01   +7.519852228264586e-01   +6.973362670852169e-01   +1.209506888303987e-02   +1.322829951098465e-02   +3.332799421488678e-01   +2.396639504578505e-01   +4.053254894546859e-01   +2.762022400767439e-01   +3.688902581750210e-01; +3.745823910031899e-01   +7.868807478005855e-01   +3.290244795961095e-01   +4.004577411709952e-01   +2.333851753111006e-01   +6.613129041958740e-01   +4.494723409124298e-01   +7.821590354600523e-01   -5.676325398209017e-05   +4.321885301991367e-01   +3.017745389830094e-01   +2.195680632233766e-01   +7.927802895898457e-02   +2.703345571393955e-01   +3.235159586991664e-01   +6.935787918587051e-01; +6.636581647989021e-01   +6.958408138433675e-01   +7.798290675580984e-01   +6.502780125891068e-01   +1.340632065048050e-01   +6.394474128968232e-01   +2.943961477711496e-01   +2.997155076693671e-01   +2.742150141059226e-01   +6.529772917972949e-01   +3.493770404229288e-01   +4.331527968551824e-01   +6.646320690526084e-01   +5.078986665130706e-01   +1.839786874059794e-01   +6.349749047492890e-01; +9.471229438673495e-02   +5.530070119029813e-01   +2.743085220158001e-01   +4.698618458005983e-01   +7.625548192634604e-01   +3.289017110165549e-01   +3.154627631955966e-01   +6.225275215737153e-01   +5.794727901114289e-01   +5.636884298145768e-01   +4.622033238909823e-01   +7.749819384423395e-01   +2.820436662440173e-01   +5.731724157303913e-01   +7.827814434051525e-01   +6.257297433963960e-01; +3.278817602482126e-01   +3.717928435798104e-01   +4.438059503152187e-01   +7.621543095923493e-01   +3.189523839300326e-01   +3.002967403301594e-01   +4.474802629754858e-01   +7.837649888776012e-01   +2.545251153148095e-01   +2.432856575177760e-02   +7.313217371646793e-01   +3.214427196992439e-01   +6.501767576902459e-01   +7.015907241852519e-01   +4.857055821275287e-01   +1.104371718687650e-01; +7.829745070420929e-01   +4.698568854384300e-01   +8.516674184118564e-02   +2.608397739021260e-01   +3.635426354623139e-01   +1.899089988179341e-01   +4.873514169784622e-02   +1.995538499363037e-01   +5.768516762967866e-01   +7.331092260585879e-01   +3.333309910883198e-01   +4.461066393626757e-02   +5.013982241005553e-01   +4.390589345348609e-01   +1.592115294920811e-01   +5.995843439349836e-01; +6.982884719571669e-02   +1.700364991107041e-01   +5.401374366017874e-01   +1.989147114650693e-01   +4.107668600825383e-01   +1.544070252746730e-01   +2.724917246612955e-01   +9.113370604218653e-02   +2.837202344394907e-01   +6.383309793592936e-01   +5.931252435900399e-01   +2.821034087163993e-01   +3.399903176819177e-02   +1.753776161585964e-01   +4.835685822376551e-01   +3.787898619958894e-01; +7.103442068706999e-01   +1.384274801339784e-01   +2.286502393135227e-01   +5.323563263919217e-01   +5.015398687085819e-01   +3.105970745133504e-01   +1.785526050829689e-01   +2.654631737630363e-01   +4.650293603447579e-02   +8.722718696867696e-02   +1.664348917698412e-01   +7.413076214249259e-01   +1.189027734904849e-01   +2.550530221567451e-01   +5.334385175493216e-01   +7.030826110151885e-01; +1.274336856821233e-01   +3.395949665363672e-01   +2.072509123921361e-01   +2.969304046259437e-01   +2.028557198102695e-02   +2.568547022331016e-02   +1.829032380847423e-01   +1.874746950264761e-01   +5.180471962181138e-01   +1.523887163275646e-01   +1.355145491178936e-01   +6.514743529518695e-01   +5.066790090597740e-01   +1.731241869530644e-01   +6.651294128921167e-01   +7.173226278844229e-01; +1.765538442567839e-01   +4.893320059736473e-01   +7.577350858015121e-02   +3.843813802299696e-01   +2.462801248652268e-01   +4.437973617543204e-01   +7.309668113695496e-01   +1.146332640755948e-01   +7.282356407078443e-01   +3.800291680823034e-01   +5.808468737332172e-01   +6.866823955685104e-01   +4.633927070553812e-02   +5.177106212728444e-01   +3.140584914617279e-01   +6.902650485172908e-01; +7.614339295193273e-01   +6.133133301565802e-01   +7.225634150737866e-01   +2.740537895177814e-01   +2.331436058478316e-01   +4.438720895510723e-01   +2.596443072068981e-01   +5.177805013431899e-01   +5.923523889557945e-01   +6.750492336731782e-02   +4.992010228360751e-02   +5.298536238249083e-01   +3.863295623081865e-01   +6.545413750638960e-01   +2.978948684155506e-01   +5.085514879275339e-02; +7.088070978089163e-01   +2.972337297931675e-01   +7.815341343544678e-01   +2.743500597083995e-01   +2.359305626278556e-01   +6.404517922057954e-01   +4.138427100826359e-02   +6.327799755203700e-01   +1.351939875362879e-01   +6.185685248297884e-01   +6.754572841637791e-01   +1.748433814295977e-01   +4.234694076890636e-01   +3.742136139201879e-01   +7.537019318798600e-01   +3.040793254562492e-01; +3.051577192082775e-02   +2.139584380464909e-01   +2.665828005750066e-01   +1.676027082825911e-01   +5.754551430851297e-01   +3.455968008211484e-01   +7.846324222655793e-03   +4.262486031304842e-01   +5.191469473074696e-01   +3.529824513419744e-01   +7.822122738330599e-01   +3.249873628169372e-01   +2.519888012747409e-03   +5.892471696456362e-01   +8.782351916865105e-02   +6.699540725917775e-01; +4.266715927125656e-02   +6.569669845330519e-01   +4.996870748184675e-01   +1.806637454797702e-01   +5.165485674822426e-01   +5.079075894122799e-01   +6.174348410914718e-01   +1.360877482456442e-01   +6.949059697476483e-01   +7.134139513728039e-01   +3.022931643056342e-01   +9.066508755119650e-02   +7.623173363478295e-01   +7.845336213005227e-01   +2.469996977215252e-01   +6.553860375043103e-01; +1.743902572025747e-02   +5.377844806954822e-01   +7.854042919984142e-02   +2.630495419990676e-01   +1.483448752800593e-01   +6.302607371143213e-01   +6.553975692028674e-01   +6.728907401681689e-01   +4.486228844858094e-01   +4.527513592260444e-01   +3.789043736504545e-01   +4.267211282788825e-01   +4.741423376113931e-01   +1.739299677207304e-01   +3.269785817016149e-01   +2.490365558832427e-01; +3.235281134148106e-02   +4.772035706682393e-01   +2.716114253941714e-01   +3.101850798526632e-01   +7.405761589977333e-01   +6.955635755804157e-01   +1.682212607456781e-01   +7.290024985335960e-01   +6.308475327456083e-01   +1.489475251233326e-01   +2.465501623382432e-01   +6.461231646105684e-01   +7.868123454546623e-01   +6.933391681953759e-01   +4.070789729682577e-01   +4.391335653798585e-01];
L2I_L1I_iGABA_netcon = [+1.044097409707366e-03   +5.337498623654621e-01   +6.501944357658211e-02   +7.061080536331120e-01   +4.162043294089682e-01   +6.257854763802453e-01   +3.415444078465638e-01   +1.147229132955330e-01; +2.519938906178239e-01   +3.624687763623941e-02   +5.765983304384421e-01   +1.604220995970480e-01   +1.646292186353673e-01   +1.821878402508087e-01   +6.750121541142363e-01   +3.955419533020954e-01; +5.425724645615281e-01   +3.109714448522686e-01   +3.571173630194190e-01   +4.717289622549437e-01   +7.271304655335427e-02   +7.795792980088463e-01   +1.999746766543108e-01   +2.208641976017073e-02; +6.243759206537266e-01   +7.350967380462392e-01   +4.908295891174547e-01   +5.157293032066950e-01   +5.352261944040140e-01   +1.744630788966755e-01   +7.413423942962094e-01   +6.401325228917805e-01; +4.899657116573523e-01   +1.062997199401990e-01   +1.876813285732151e-01   +7.002628463922063e-01   +3.429005793453745e-02   +6.784308472544270e-01   +2.117529636835213e-01   +3.861886501685433e-01; +4.837809631114416e-01   +5.925783824430426e-02   +6.922873113891748e-01   +3.257980945894973e-01   +5.978874640017394e-01   +6.786516436062099e-01   +7.941930747598451e-01   +1.809347350982803e-01; +6.324356337976432e-01   +2.450311088507738e-01   +7.692818141041977e-01   +4.833698012117892e-01   +1.015876306163266e-01   +3.035318091997370e-01   +1.807470082141657e-01   +7.275997474758376e-01; +1.276217654702547e-01   +6.430850076946970e-01   +1.749592215243925e-02   +6.667993510291655e-01   +7.939751844865209e-01   +2.024983181445724e-01   +4.153776351468240e-01   +2.456573101618670e-01; +5.426830244082547e-01   +5.375185511363519e-01   +2.621656199927523e-01   +5.558972400149843e-01   +5.209610641737979e-01   +2.084200696361962e-01   +3.286904472851817e-01   +2.283513082195008e-01; +4.332789350557050e-01   +2.587855068436299e-01   +3.468385169118385e-01   +5.444653997121877e-01   +1.061916381292952e-01   +5.951400337603420e-01   +3.850734081270670e-01   +4.817137427807327e-01; +3.868241982521290e-01   +4.879699370296159e-01   +4.380346112228414e-02   +1.606315077552484e-02   +3.744845674895140e-01   +1.871460730685957e-01   +2.388807395005326e-01   +3.919799453306106e-01; +1.884266184619376e-01   +5.040932185324227e-01   +1.001688139639801e-01   +2.893029125709919e-01   +1.117925162056964e-01   +4.548105840798208e-01   +3.201360799302767e-01   +5.104926583418324e-01; +6.012003538994959e-01   +4.633193239877353e-01   +1.777271349092595e-01   +4.073974745048083e-01   +1.854628763465892e-02   +4.975244506142567e-01   +1.547648249702382e-01   +7.470954671392986e-01; +4.108801675854256e-01   +4.021009140435599e-01   +1.245053727808159e-01   +7.780555198927961e-01   +3.409714873004442e-01   +7.929529315335799e-01   +6.545950715336077e-02   +4.700842986824275e-01; +2.089905576005466e-01   +3.870080765997118e-01   +7.495383261417983e-02   +4.746473301851621e-01   +1.229280681350071e-01   +2.953821518147658e-01   +7.030991756645590e-02   +1.725820977570213e-01; +1.144977411912874e-01   +4.581820741667443e-01   +5.228661907620406e-01   +6.619908343917632e-01   +1.332793826261596e-01   +7.420879193823965e-01   +7.642470427035922e-01   -4.524277003387002e-03];
L1I_L2I_iGABA_netcon = [+4.398179529770093e-01   +2.165626084860331e-01   +3.398539338056857e-01   +2.303688625257329e-01   +1.068477590433958e-01   +5.924596612106781e-01   +3.772803922581532e-01   +6.688899198827503e-01   +2.726166323863673e-01   +5.652632368836186e-01   +5.807119624486515e-01   +7.052837999227960e-01   +3.566022594252524e-01   +6.550170850955241e-01   +5.072011045997330e-01   +3.548837160131538e-01; +3.052171449683234e-02   +1.124018507969877e-01   +2.183944340500254e-01   +2.136343738917363e-02   +7.460518073154355e-01   +5.354863524040314e-01   +5.829854584921101e-01   +5.460932755756516e-01   +5.246616953039510e-01   +3.142640640987480e-01   +2.829980430792765e-02   +3.330912417492910e-01   +4.735008639231539e-01   +3.864180075902646e-03   +6.128262565832631e-02   +5.121752181629001e-01; +1.117621995877975e-01   +8.027740660837694e-02   +1.222900257144889e-02   +1.836616601054984e-02   +7.823018086424747e-01   +5.550094168964768e-01   +7.457592487857908e-01   +6.882963558501578e-01   +2.332900304899742e-01   +2.254269516611187e-01   +1.554525545472311e-01   +1.659528218797583e-01   +6.976633928277339e-01   +1.751329646578176e-01   +2.207013182478575e-01   +6.211243226526399e-02; +4.169241980640286e-01   +6.588000277156384e-01   +4.151641340101698e-01   +2.809513469857431e-01   +2.379915363240204e-01   +4.388304582175326e-01   +3.541130290351702e-01   +5.618103403250716e-02   +2.019948767120943e-01   +4.450564751517651e-01   +7.206355442503266e-01   +7.267418474516094e-01   +8.249668475395554e-02   +1.057746619266622e-01   +2.692282454302649e-01   +4.701289635339679e-01; +3.421387239434186e-01   +2.261510203260094e-01   +7.837500057234727e-02   +7.078124773352117e-01   +4.464682709017445e-01   +6.863798022112767e-01   +1.018638728098607e-01   +4.337979598306128e-01   +7.550865294423347e-01   +4.530733940685301e-01   +7.086074641264672e-01   +2.198514715836882e-01   +1.309644087511229e-01   +7.852206291017533e-01   +6.590543619538091e-01   +7.745181013151362e-01; +2.720165236459823e-01   +5.647157429266667e-01   +2.533995947386765e-01   +6.249078985970791e-01   +3.318215766786414e-01   +5.962953286283823e-01   +6.559178567090050e-01   +5.383992116093995e-01   +3.206327080719079e-01   +6.934521283991882e-02   +4.403770333141210e-01   +7.093015761916559e-01   +2.342319966542726e-01   +5.007809396857108e-01   +7.344173402994260e-01   +2.835858325135333e-01; +7.554264436269131e-01   +7.223939792570791e-02   +3.353408584487284e-02   +1.933147564783529e-01   +7.808432903831074e-01   +4.883433586187259e-01   +7.558346618371170e-01   +3.272303732632477e-01   +7.460402708106081e-01   +1.997978754132152e-01   +7.881291142174600e-01   +4.211446138390389e-01   +3.406521337535611e-01   +4.440878699266474e-01   +1.922395437413549e-01   +6.214863275828896e-01; +6.092853996844931e-01   +5.244620321392571e-01   +2.191087499177445e-01   +2.411811394984565e-01   +6.543348112298859e-01   +2.944791069587685e-01   +3.202026768389968e-02   +1.259668444790205e-01   +2.913370302100061e-01   +2.548896520219532e-01   +8.770920344857873e-02   +7.209443366300671e-01   +3.958794896786349e-02   +1.618026814397010e-01   +7.571380275842671e-01   +7.855302578460365e-01];
L2E_L1E_iAMPA_netcon = [+7.418548275169106e-01   +3.007061147614884e-01   +5.473713555775949e-01   +4.509561922890386e-01   +8.407728888911511e-02   +2.591021829458945e-01   +6.999008626361596e-01   +5.549984240610172e-02; +2.675597790183265e-01   +2.481273594179657e-01   +6.511900785052404e-01   +1.758382569583594e-01   +5.711233027203589e-01   +4.705603860420687e-02   +2.512610569751894e-01   +5.641351595763480e-01; +2.502739703077983e-01   +1.148306330770154e-01   +6.058420584949383e-01   +5.269865168932377e-01   +3.893698950227655e-01   -2.396111601808692e-03   +1.799078017557822e-01   +2.873358533281089e-01; +4.802648382112332e-01   +1.494368882428336e-01   +2.245386125543890e-01   +7.646964233428070e-01   +4.183831920552625e-01   +1.884180865521114e-01   +5.033383920592145e-01   +1.913759343688867e-02; +1.509590430307136e-01   +4.002656801923285e-01   +5.621774331937046e-02   +1.449274944494968e-02   +2.146095093600224e-01   +4.296418091101470e-01   +2.045652627924967e-01   +1.881998472793057e-01; +2.033598096133880e-01   +4.309697181471289e-01   +1.245420114952296e-01   +3.640328042588550e-01   +7.157270952967114e-01   +7.676127500795331e-01   +6.867837597660754e-04   +6.610714933559202e-01; +3.289961631652429e-01   +3.204344106692738e-01   +7.625960157113955e-01   +3.036026533306512e-01   +1.998948885794492e-01   +1.022436620242994e-01   +3.425815795471056e-01   +3.925534989836423e-01; +1.460496051620546e-01   +1.364370618563515e-02   +5.725713327326997e-01   +5.394985009982125e-01   +2.329113026360894e-01   +4.023283884404001e-01   +6.520793566043316e-01   +6.242892288093236e-01; +2.096397752316149e-01   +6.650045921540758e-01   +4.939891972398005e-02   +6.678395421788925e-01   +5.468056513023219e-01   +2.215691235275168e-01   +2.169036613823021e-01   +2.618449532763330e-01; +8.911464115417940e-02   +7.099253378309898e-01   +5.934292399924095e-01   +6.367786082589411e-01   +3.380457820151130e-01   +7.864660047545216e-01   +7.667583772243886e-01   +5.348591404388605e-01; +6.354240421834144e-01   +2.794143241827977e-01   +4.355425403134659e-01   +1.130340310661375e-01   +3.810036810627710e-01   +5.981123815572605e-01   +2.424311967369099e-01   +1.825369055163899e-01; +4.873313262580722e-01   +7.672168339820348e-01   +3.039504697836993e-01   +6.846531460279740e-01   +7.813759566531355e-01   +6.247416231646582e-01   +3.845117109508082e-01   +7.727401524863006e-01; +4.082559033892750e-01   +4.432238848116958e-01   +1.649769219140368e-01   +7.039859401694044e-01   +7.925746949209565e-02   +1.939889712484570e-02   +2.052359675386272e-01   +2.711596567780821e-01; +3.443830355682680e-01   +4.388273657286279e-01   +7.256241578794278e-01   +3.161978138211847e-01   +4.017330315710466e-01   +4.939129527493595e-01   +6.926764489504255e-01   +4.050440995700317e-01; +6.317585880676959e-01   +2.032400540510663e-01   +3.249136897412805e-01   +1.715078323336938e-01   +1.955573750451546e-01   +6.197894299229517e-01   +7.501976077715562e-01   +5.117431140728674e-01; +4.738725808578774e-01   +8.784875434002512e-03   +2.227689680193423e-01   +6.159085619615835e-01   +3.640294939632291e-01   +5.797029597446223e-02   +4.094149917005867e-01   +5.937663775936551e-01];
L1E_L2E_iAMPA_netcon = [+1.127938135063922e-01   +2.913078207470644e-01   +6.141980791090121e-01   +6.027437153159457e-01   +3.067687880508331e-01   +4.775449448629124e-01   +4.357391802756897e-01   +7.319036126052733e-01   +6.404805755110359e-01   +3.860240842820217e-01   +2.388795810143394e-01   +7.663564456391490e-01   +3.577818969632877e-01   +2.248437962858638e-01   +4.364468249420118e-01   +1.518277298399381e-02; +5.966586923610171e-01   +5.175330363189942e-01   +7.630880341764921e-01   +1.674042130535456e-01   +3.435139925752722e-01   +5.636085465083364e-01   +5.493996309118876e-01   +2.784471169825189e-02   +2.140541856829651e-01   +2.354411523906646e-01   +5.847686394281149e-01   +4.292838234367805e-02   +6.476646495775815e-01   +3.867552847413361e-01   +2.195513929063100e-01   +6.297223582719659e-01; +2.772303243602333e-01   +3.122397267161977e-01   +1.831590877626720e-01   +7.875270645893401e-01   +4.720914788218196e-01   +4.514406017625839e-01   +6.565703004131574e-01   +2.255122627261219e-01   +2.533677139936526e-03   +1.718723167179497e-01   +1.439149452742203e-01   +4.705599107521709e-01   +7.351228228658060e-01   +1.494944996440613e-01   +2.680002694287185e-01   +4.149013708717658e-01; +1.198575760746729e-01   +2.701723854711201e-01   +1.117645756643423e-02   +3.831364502217591e-01   +6.277906181819339e-01   +6.399263418614263e-01   +4.570237192515413e-02   +1.701007685680681e-01   +6.982317956082787e-01   +3.396928967733375e-01   +6.472198067905721e-01   +2.650937284543242e-01   +7.937837644523473e-01   +2.319783973373168e-01   +1.583597284456463e-01   +4.284307877613664e-01; +1.674428692624569e-01   +1.343739900648147e-01   +2.961408425572832e-01   +3.959029424321290e-01   +2.303435641117395e-01   +4.783455492923746e-01   +4.878976105842063e-01   +3.326698566283199e-01   +2.288807614747136e-01   +5.542077615954136e-01   +2.519511561496485e-01   +4.602683923433291e-01   +1.286649266287195e-01   +2.976901297852774e-01   +7.229734808467071e-01   +3.933573711562085e-02; +3.841113035536560e-01   +4.214655197261992e-01   +5.768997187278357e-02   +3.963563613219546e-01   +1.861019213500149e-02   +2.951508143705422e-01   +5.045732218798004e-01   +5.510276541530879e-01   +2.242821162566503e-01   +6.400328888237627e-01   +7.007149574892085e-01   +2.399109655022081e-01   +1.354570403336805e-01   +4.205239880751340e-01   +4.797754312783910e-02   +4.817072818520555e-01; +5.519176533726062e-01   +1.401825418395619e-01   +3.795993776893121e-01   +5.588585765802062e-01   +1.607837265165558e-01   +6.602007940534428e-01   +6.657492168019834e-01   +8.238720199558608e-02   +7.545926997194575e-01   +7.199699286333677e-01   +4.386957637304612e-01   +3.222129154431454e-01   +2.379912977206706e-01   +2.749634773422748e-01   +6.065380949197766e-01   +3.490548949248809e-01; +1.003055689442450e-01   +2.688667011103853e-01   +8.744703349870761e-02   +1.854026141988433e-01   +6.588174844526787e-01   +2.196635307442955e-01   +1.929121297011128e-01   +5.704190509338020e-01   +7.176561749669617e-01   +5.282581701657710e-01   +2.353633250817199e-01   +6.992636688515838e-01   +2.131836006778217e-01   +7.992746499124857e-02   +7.112685082265381e-01   +5.569669781477190e-01];
L2I_L2E_iAMPA_netcon = [+4.638088589535991e-01   +6.074978586859473e-01   +6.731814431926592e-01   +7.223612683827867e-01   +2.261420256859351e-01   +7.995080814011526e-01   +6.353545600571313e-01   +3.843963086567310e-01; +1.297941705806686e-01   +5.623477475801111e-01   +4.089879289655535e-01   +4.860963273353550e-01   +2.736059744498653e-01   +2.965646025714067e-02   +6.137193777290034e-01   +4.929480223767013e-01; +3.653399519556903e-01   +1.772113993705887e-01   +7.336960059310730e-01   +4.608339989509521e-01   +4.025510669954366e-01   +7.752105472860593e-01   +8.610839291768800e-02   +1.332362080021636e-01; +2.353450154297524e-01   +5.908898319009602e-01   +6.696888845054856e-01   +5.665039775454563e-01   +7.866902771301101e-01   +7.800759273419376e-01   +4.864763550499756e-01   +7.048028640446145e-01; +2.339335992091852e-01   +9.769573269009492e-02   +7.090787533452093e-01   +7.841571759018514e-01   +6.566188082802314e-01   +6.083503447039602e-02   +4.822316812902084e-01   +6.406551752395837e-01; +1.478956047750344e-01   +6.197358161905566e-01   +5.489053313770285e-01   +4.097935311910515e-01   +4.706575202619602e-01   +5.887898889370734e-02   +4.858137714477225e-01   +6.560593701284791e-01; +6.476191453186725e-02   +5.816782853073186e-01   +4.400303714810699e-01   +3.350795737934435e-02   +7.125087001114581e-01   +3.291989535713120e-01   +5.936313158123747e-01   +6.687513647151877e-01; +6.714280852279504e-01   +2.572721653412177e-01   +5.071971532671201e-01   +5.691506338482254e-01   +1.391816352202693e-01   +6.179095618989061e-01   +3.441515688371675e-01   +3.705641459855145e-01];
L2E_L2I_iGABA_netcon = [+1.613301919963233e-01   +5.790243950615667e-01   +7.480737595652704e-01   +5.895528348647809e-01   +7.785481878603360e-01   +6.084797071637402e-01   +7.402394603249834e-01   +3.119160381187212e-02; +7.766424874202815e-01   +6.648960627946982e-01   +3.844526378710443e-01   +6.162271327802623e-01   +6.314599914840113e-03   +6.956333752380074e-01   +1.665374747682740e-01   +1.555699099765213e-01; +2.493682663444082e-01   +2.306945526124552e-01   +5.420576118219941e-01   +2.669045818312516e-01   +7.844994666721177e-01   +1.761781395219174e-01   +1.278023614578164e-01   +1.588947579505165e-01; +5.836729064562517e-01   +5.203804374104263e-01   +1.209791964774957e-01   +4.926725633998574e-01   +1.087312804027225e-01   +3.945164398502122e-01   +6.579319918470096e-01   +4.126538407368171e-01; +5.548697161710213e-01   +4.429055411250095e-01   +6.246596576713671e-01   +4.184915861366234e-01   +1.217451768895771e-01   +4.764941940680028e-01   +7.761275755959263e-01   +3.585684912160165e-01; +5.296846000552909e-01   +2.271514036471369e-01   +7.776248417987242e-01   +9.274814884085410e-02   +5.107916107839147e-01   +3.261665101399088e-01   +6.544409366817643e-01   +6.178271173175245e-01; +7.720633475462382e-01   +5.355532791193177e-02   +4.454599780950864e-01   +2.541029845739513e-01   +1.939205643878213e-01   +7.708094403421966e-01   +6.468694483926714e-01   +2.237887430792415e-01; +7.742362569741478e-01   +7.116720758220604e-01   +6.617321312970507e-01   +9.754148724215034e-02   +7.568321201805185e-01   +1.148598518023923e-01   +6.574312173455539e-01   +7.163456673691005e-01];
L3E_L2E_iAMPA_netcon = [+5.440386121918369e-01   +5.292103288207427e-02   +4.444532378902949e-01   +1.235097520707900e-01   +1.000386494499626e-02   +9.651213409138125e-02   +2.280386215887368e-01   +6.835962414917142e-01   +2.951491742106939e-01   +3.739901442663906e-02   +2.841708005574300e-01   +7.475348581285117e-01; +6.240402089316314e-01   +6.416645354959586e-01   +1.946900628940237e-02   +4.211381964098811e-01   +6.414218447793127e-01   +5.811869170386993e-01   +5.371672477301451e-01   +4.175064618413954e-01   +6.393750528926410e-01   +6.772271040488033e-02   +3.945522928716051e-01   +1.954728829072528e-01; +5.183886716564833e-01   +3.712768521515567e-01   +7.058952998012210e-01   +4.944240158191387e-01   +5.335332314013982e-01   +9.254861933200886e-02   +3.093069048778142e-01   +4.356507768714685e-01   +1.817633795952060e-01   +4.413766416080426e-01   +4.254160741566645e-01   +7.610974823129363e-01; +1.612591550859084e-01   +3.362912739021092e-03   +6.212288280700955e-01   +3.700494239193655e-01   +4.731660669956212e-01   +2.451507412154390e-01   +4.429803322658135e-01   +4.338171017007483e-01   +1.328245428569527e-01   +7.354493617431516e-01   +3.663492816243418e-01   +1.721074957488610e-01; +4.565207813806802e-01   +3.790958901312954e-01   +2.342307432299992e-01   +3.484895144007971e-01   +6.692174390628222e-01   +5.008105192871217e-01   +6.636336602951523e-01   +6.132727360395537e-01   +1.905158977121307e-01   +7.227255020262574e-01   +3.841840001485716e-01   +6.059793829501939e-01; +4.951598176899515e-01   +7.278482555945075e-01   +7.266599160725693e-01   +1.509395240188109e-01   +4.439529915345087e-01   +3.253523555387292e-01   +1.426789938303821e-01   +1.274958734852089e-01   +5.016975781578489e-01   +1.278438317143450e-01   +1.270270197928122e-01   +4.080196161360586e-01; +7.293643021476834e-01   +4.098886027971511e-01   +7.550014565832656e-01   +6.199954498871849e-01   +2.440294456801398e-01   +5.194974580444955e-01   +4.721620302256831e-01   +2.421357331739955e-01   +4.022139401565710e-01   +5.627845562019754e-02   +7.446145376633544e-01   +7.346406329207906e-01; +4.225952362832405e-01   +6.856803349210783e-01   +7.441041005438308e-01   +7.965388922961008e-01   +3.138778291329256e-02   +5.568605736481277e-01   +6.241657664693296e-01   +1.166711236415049e-01   +7.501942780589768e-01   +6.468973702842575e-01   +8.780988013291158e-02   +1.440798781087115e-01];
L3I_L2I_iGABA_netcon = [+6.261155282662461e-01   +5.331011483727720e-01   +3.466661962455570e-01   +7.007232232772749e-01   +6.333950331859746e-01   +7.436137682671896e-01   +5.895604513836496e-02   +7.941987191057958e-01   +6.894092462582426e-01   +3.579742379839437e-01   +1.002490629835772e-01   +1.274764380749946e-01; +5.536809413261363e-01   +3.570619232476806e-01   +5.273302937425406e-01   +5.201697432652983e-01   +4.921193722253872e-01   +5.504239717208884e-02   +1.873964017116925e-01   +7.183370149541135e-01   +3.075602413920173e-01   +5.368792529209089e-01   +5.896283132367224e-01   +2.180069057264841e-02; +1.544380849229622e-01   +4.079493381057087e-01   +6.596143341502954e-01   +7.723507127175451e-01   +2.317991598888853e-01   +6.853979195451281e-01   +5.181056331717424e-02   +3.112195234412068e-01   +3.832561911856339e-01   +2.649364035771241e-01   +6.740023776793283e-02   +3.982319306721879e-01; +5.956368977772930e-01   +3.081084546675151e-01   +7.316954678814073e-01   +7.956116477272677e-01   +1.318536692524132e-01   +5.625585624458217e-01   +4.800532596507702e-01   +4.904885167675732e-01   +5.018699330360133e-01   +2.423281269260987e-01   +5.089240922926718e-01   +5.974103209411467e-01; +1.712986856929764e-01   +7.456023795957343e-01   +6.628930305525969e-01   +5.752691671414321e-02   +3.215038549511140e-01   +6.309762558451673e-01   +4.617915754350769e-01   +7.385007031226534e-01   +1.877032428810239e-01   +5.275414984514488e-01   +5.918842004849136e-01   +4.341840780120512e-01; +2.604163247431506e-01   +6.162940362765501e-01   +5.312068842126553e-01   +4.931456745084748e-01   +7.050741637797532e-02   +2.275499124184408e-01   +4.481764553391434e-01   +6.007869727904694e-01   +7.731101293489733e-01   +1.911409845984945e-01   +4.300363829677652e-01   +4.994789119443085e-02; +5.431507881882611e-01   +4.566380325494960e-01   +4.356421634923621e-01   +5.684929349616930e-01   +4.466721308837238e-01   +2.643424228384864e-01   +1.114851140943608e-01   +1.699564590918025e-01   +2.011550766577038e-01   +7.149816440237483e-01   +7.555330935379310e-01   +5.792279556700897e-01; +5.168633555187259e-01   +6.809053809862371e-01   +5.952478926367901e-01   +7.764567768729694e-01   +7.963870224552465e-01   +9.696139994236186e-02   +6.944481070511983e-01   +6.848569460407833e-01   +5.348818471777714e-01   +7.776872432697377e-01   +6.367937808326454e-02   +4.099664310058766e-01];
L2E_L3E_iAMPA_netcon = [+3.035182259589942e-01   +6.968081060710271e-01   +2.656993197833910e-01   +7.512167121869936e-01   +4.344368086312014e-01   +5.274993862083452e-01   +5.489239518553996e-01   +3.300189950049405e-01; +3.755351621482299e-02   +1.794957208610248e-01   +5.227219454790137e-01   +3.045136012469442e-01   +3.341717711649405e-01   +4.352292930511483e-01   +6.661154893830830e-01   +7.115906252230326e-01; +7.468363069689904e-01   +2.785354730613249e-01   +8.124295705691169e-03   +3.819033551335196e-01   +4.594809086801769e-01   +7.396861092822442e-01   +3.811505747492373e-01   +4.958502489207509e-01; -1.996279449097586e-03   +6.436068142566146e-01   +2.571654445474755e-01   +7.589660328506462e-01   +6.728872015191540e-01   +6.596451444119219e-01   +2.473842588528183e-01   +6.214491458943162e-01; +3.842847944470818e-01   +2.279958600413457e-01   +1.501809906756913e-01   +5.165207431147681e-01   +5.019597205742221e-01   +6.298167340588294e-02   +1.223261344247984e-01   +4.826428301409255e-01; +6.216267948234275e-01   +1.842076489181281e-01   +9.244534403558854e-02   +2.272583924635133e-01   +7.938388624984192e-01   +6.474361792942644e-01   +1.727780591500136e-01   +3.912388343591511e-02; +5.879196447089652e-01   +4.268712421547629e-01   +4.763378885427496e-01   +3.347061057466211e-02   +3.744131660074113e-01   +6.677864976563442e-01   +8.001482788499280e-01   +4.227443216122057e-02; +3.750622115328329e-01   +6.037045557362314e-01   +6.163846422389206e-01   +1.925837569050952e-01   +4.540661958284705e-01   +4.608256871820794e-01   +4.533572082883742e-01   +5.782447607303605e-01; +2.385905754533451e-01   +3.702309707200474e-01   +4.888610559920622e-01   +7.014029093725403e-02   +5.032681844799536e-01   +2.254932899129749e-01   +3.160912757926592e-01   +7.341315160502715e-01; +2.081737538725794e-01   +5.103464037400862e-01   +4.555741942578161e-01   +2.876678906895553e-01   +1.973332479699519e-01   +4.223841588743520e-01   +5.136772458112903e-01   +3.477473960754450e-01; +3.422833377966763e-01   +1.975213162956617e-01   +6.859942307831051e-01   +6.807682986138583e-01   +3.738597401082315e-01   +3.673289679630145e-01   +7.945808108354272e-01   +2.677349947070536e-01; +1.794254894574146e-01   +3.617433004770422e-01   +3.922155243028902e-01   +7.413106044789014e-01   +2.095970239748249e-01   +4.363858367520252e-01   +3.381587207712826e-01   +3.156056534156710e-01];
L2I_L3I_iGABA_netcon = [+3.268994023437131e-01   +1.314660440272099e-01   +7.910254292158339e-01   +5.250477954130158e-01   +4.558257585771818e-01   +6.520193620710013e-01   +5.220298012326511e-01   +6.697908383641714e-01; +1.769533249288556e-01   +5.841035477861504e-01   +7.413825288403229e-01   +4.642083313413488e-01   +7.700003777278249e-01   +3.674890359397991e-01   +5.089715957960955e-01   +5.920609218699405e-01; +2.284750966898786e-01   +7.622676356329573e-02   +2.354268953101234e-01   +1.721393230153194e-01   +4.164231601807146e-02   +1.973171946151907e-01   +5.830109400620995e-01   +4.018290027554464e-01; +4.346387920443868e-01   +5.930120994931724e-01   +8.185987188416154e-02   +2.236243189474680e-01   +6.783722783373893e-02   +7.357388316277094e-01   +6.598114843467602e-01   +7.805458192295620e-01; +6.543618056752913e-01   +6.477164609869616e-01   +6.982304043267857e-01   +6.623227132576376e-01   +7.635440373660374e-01   +2.775975601276781e-02   +5.721495500786598e-01   +6.005564749403228e-01; +3.742300902844891e-01   +3.205660052786153e-02   +1.216733301088348e-01   +3.778992223836097e-01   +2.253243723046706e-01   +3.728355052507853e-01   +4.051698073160431e-02   +6.175665060861201e-01; +6.107089827159973e-02   +5.097960676358778e-01   +2.624304358421675e-01   +7.826802556027344e-01   +6.922300201652400e-01   +3.604682308510146e-01   +6.415359629211534e-01   +7.649955770619467e-01; +4.286273428306669e-02   +1.232301242587283e-01   +3.715470243388573e-01   +3.977410616982822e-01   +1.446735932811631e-02   +7.510842043270560e-01   +3.186415685399076e-02   +6.221039520132744e-02; +2.329712863396671e-01   +3.453925847026184e-01   +4.367445423576266e-01   +6.870653956282627e-02   +6.944784348489176e-01   +5.108716135824037e-02   +3.850709459726271e-01   +3.076299568219615e-01; +5.039871886640407e-01   +1.159234826918696e-02   +6.039162160539926e-01   +5.577403354190115e-01   +3.192268629678204e-01   +6.650604975901173e-01   +8.507300644353982e-02   +3.141140391688630e-01; +7.998110397321774e-01   +2.049909092102083e-01   +6.275793523889621e-01   +4.953692010723026e-01   +3.172874446912069e-01   +3.735260992480015e-01   +5.170834139579217e-01   +3.696119220106771e-01; +7.236991709863948e-01   +2.835556888866516e-01   +6.095610882645338e-01   +2.936175053146167e-01   +3.515593110779318e-01   +5.221605594984928e-01   +5.889465204725538e-02   +4.625051189850213e-01];
L3I_L3E_iAMPA_netcon = [+2.928641818354323e-01   +1.704824875903142e-01   +4.327965495316780e-01   +1.171530717278300e-01   +4.397832788998004e-01   +4.398701031684837e-01   +4.901180619861099e-01   +7.479074900394048e-01   +2.255426979181599e-01   +3.645575218319554e-01   +2.953422546233921e-02   +5.808460728531678e-01; +5.509075204975312e-01   +3.721155413809135e-01   +1.567053116780319e-01   +3.360978776635962e-01   +5.784437175680007e-01   +4.396070836683052e-02   +1.810004062183783e-01   +3.419145581274280e-01   +7.121647717350690e-01   +5.058423393484801e-01   +2.102455128772228e-01   +7.137956311400167e-01; +1.482461165408530e-01   +4.200225611356220e-02   +2.196495990828652e-01   +3.705112655007514e-01   +2.313257995592768e-01   +8.939043920803386e-02   +1.999436588956648e-01   +7.228308537307404e-01   +1.390492186019864e-01   +2.013964862918848e-01   +5.881872463377451e-01   +7.133932496686934e-01; +5.906871884495852e-01   +5.760659503073420e-01   +2.212107530888261e-01   +7.880883029793778e-01   +4.903493211958213e-01   +5.363610819424633e-01   +6.605582142140005e-01   +2.237226445453335e-01   +4.175323385905051e-02   +6.860339685860967e-01   +9.489674005825945e-02   +2.382697387530318e-01; +1.169841746637907e-01   +4.862530203795850e-01   +2.311795316582514e-01   +1.103687606805090e-01   +1.288441274840081e-01   +4.519325451837388e-01   +5.153984864908101e-01   +3.227189867764014e-01   +3.891480062184568e-01   +3.443936249370009e-01   +4.267949594835414e-01   +5.362124878926333e-01; +4.269383862883616e-01   +5.148274399290536e-01   +2.024637064737496e-01   +3.645988758986198e-01   +4.685999539800158e-01   +2.113642536675153e-01   +5.026004996744263e-01   +7.068028165436032e-01   +7.240062470146512e-01   -2.032709530887285e-03   +1.177626983272974e-01   +9.201165455601960e-02; +6.730700106047098e-01   +5.890112153366539e-01   +1.072678163839522e-01   +4.697117136526476e-01   +5.633297975376083e-01   +4.264382968880419e-01   +6.988735316907508e-01   +7.660814202129561e-01   +7.671147636448645e-01   +1.954661020860289e-01   +6.815836578218538e-01   +7.011514736869469e-01; +2.392381706380255e-01   +6.592911533087745e-02   +1.227864093924791e-01   +4.346828074611829e-02   +6.611140659953914e-01   +6.050603120196055e-01   +4.056869057216694e-01   +2.340293132555987e-01   +4.971502210789734e-01   +3.555234281863634e-02   +3.093280058764903e-01   +1.954272177494006e-01; +4.275233434452071e-01   +7.715003933849858e-02   +3.655410743626616e-02   +5.672729023565336e-01   +1.763981005329983e-01   +7.424580539844335e-01   +9.650304375297212e-03   +4.693113767583902e-01   +5.626255690292963e-01   +5.376682453710020e-01   +3.021405578306200e-01   +4.942930757208283e-01; +3.736711128099535e-01   +5.450446276776535e-01   +4.817800324293608e-01   +7.752188446838266e-01   +7.117458015253448e-01   +2.117328397378875e-01   +4.398083082686670e-01   +4.645244024355362e-01   +1.282386625454335e-01   +4.786629471944344e-01   +3.470143760586297e-01   +1.587264780674576e-01; +7.671081095365614e-02   +6.506190184586680e-01   +1.018949676302151e-01   +3.681947148424954e-02   +6.298655380150660e-01   +8.013375239876348e-01   +4.664784049078274e-01   +5.352112743156014e-01   +4.187748514200656e-01   +1.157217838192855e-01   +5.371810273710927e-01   +6.958231569130582e-02; +1.901855182672482e-01   +5.082730336360400e-01   +1.650910277243197e-01   +6.534550766783710e-01   +6.988205228084654e-01   +2.636706904706362e-01   +2.166058189816184e-01   +4.833148727807088e-01   +3.542370862131888e-02   +2.303027665109721e-01   +4.365681695517605e-01   +1.905483156742072e-01];
L3E_L3I_iGABA_netcon = [+6.594729383198654e-01   +4.665243332975380e-01   +1.802928803432889e-01   +4.389975901158568e-01   +4.334812231228880e-01   +1.054241380132049e-01   +4.356220733637304e-01   +6.339667149303255e-01   +4.629726645185241e-01   +1.505929153541807e-01   +1.768516075148802e-01   +5.423645085107703e-02; +5.113115251001968e-01   +1.164500926572908e-01   +2.637599063159444e-01   +7.087934051627268e-01   +3.243735687734271e-01   +7.062992180365083e-01   +5.758874395362472e-01   +6.029676744203267e-01   +2.342447063322146e-01   +3.279634143808933e-01   +3.708215543811390e-01   +3.827443286621907e-01; +1.730723820185832e-01   +2.303468520343933e-01   +7.855735273603369e-01   +6.043254612032286e-01   +6.466289465565472e-01   +1.756577552398987e-01   +3.824462914262745e-01   +6.788453589873015e-01   +6.248742668416052e-01   +3.924778139675852e-01   +9.217237918331625e-02   +1.806783265928661e-01; +2.223155531837445e-01   +3.182888479309881e-01   +7.152802589818276e-01   +5.954854852478642e-01   +1.553600345236210e-01   +6.289181879548956e-01   +2.567582983529448e-01   +4.565550505709789e-01   +6.992372585908056e-03   +7.412061394649793e-01   +7.798451675572701e-01   +2.874647277095309e-01; +6.064960900505922e-01   +3.454465809676283e-01   +6.079321887526915e-01   +2.110472592634882e-01   +5.090111284141366e-01   +2.188137700400969e-01   +7.628353025750743e-01   +2.859752641402591e-01   +6.206905403566474e-01   +4.026662263063979e-01   +3.322005832349457e-01   +3.699017890613491e-01; +7.468368617292106e-01   +3.146860574837462e-01   +4.652771546897367e-01   +1.088230705632463e-01   +6.382952753309888e-01   +8.572865137089794e-02   +6.591018220152909e-01   +2.351027800474134e-01   +1.319808517635057e-02   +2.104973156942816e-01   +6.088445454294029e-01   +1.887261983022112e-01; +4.934737479972189e-01   +5.856635487892378e-01   +2.940310585853789e-01   +1.815691204481428e-01   +1.375186553313008e-01   +7.770507327104096e-01   +1.163175873840571e-01   +7.354059457616583e-01   +4.999221716874852e-01   +5.978320812462756e-01   +2.726652156218659e-01   +2.096763505832186e-01; +2.048775165087910e-01   +3.826602001922589e-01   +5.410875802449390e-03   +7.304041009359167e-01   +1.451906741835701e-01   +3.157416959469077e-01   +2.254833672811464e-02   +1.158853263221678e-01   +5.999141113572816e-01   +5.967154169520577e-01   +3.906563548976548e-01   +3.726768892006604e-01; +6.173844018897174e-01   +1.618297648915662e-01   +6.241020936341067e-02   +5.468259819243305e-01   +3.657404002921686e-01   +7.457386001511634e-02   +4.645820092551248e-01   +2.568106997888372e-01   +7.134298146662609e-01   +6.854166780917497e-01   +1.855843792488892e-01   +7.825254851833234e-01; +4.472162995151113e-01   +7.520038791130784e-01   +7.980372297090839e-01   +5.909169418820970e-01   +1.398178000721681e-01   +6.763008075343299e-01   +3.200127608502965e-01   +2.239928246422064e-01   +4.512594217691336e-01   +6.005542331861339e-02   +5.140559099368670e-01   +7.597841386592286e-01; +9.613200250851332e-02   +3.922699635889809e-01   +7.038223670035847e-01   +4.957026209576539e-02   +4.253283464043957e-01   +6.731864837709439e-01   +5.262741582231160e-01   +2.191180245709564e-01   +2.149471706681230e-01   +3.695190182895365e-01   +6.352280192262121e-01   +7.238993121418924e-01; +5.842708356549589e-01   +9.484288765969512e-02   +5.282888247602869e-01   +6.201448715576636e-01   +6.966695262953367e-01   +1.245412194751295e-01   +5.652779770671498e-01   +6.278236687013211e-01   +3.564659807130720e-01   +6.218314365721078e-01   +2.760079910538978e-01   +3.758722408734453e-02];
L2E_Input1_iAMPA_netcon = [+5.319602154302892e-01   +3.316302908777033e-02   +1.140108793559657e-01   +7.301063579669876e-01   +1.653821460132006e-01   +7.080074825248429e-01   +6.717874515052658e-01   +4.138864393442193e-01];
L2I_Input2_iAMPA_netcon = [+7.083319589181332e-01   +1.631793591687169e-01   +7.827610584620875e-01   +7.036025232848583e-01   +5.356800643720180e-01   +7.170163771583437e-01   +2.886972783431391e-01   +6.153932816307077e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
