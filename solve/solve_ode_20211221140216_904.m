function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.208959372497246e-01   +2.850798734700907e-01   -1.584200652236763e-01   -6.364382227352794e-01   -2.947682324112312e-02   -3.644700321197361e-01   -2.982977648868589e-01   +4.295089001063770e-01   +4.807052895999049e-01   +1.044504098043361e-01   -8.357922630542615e-02   +6.634682034423558e-01   +1.234642464095790e-01   +4.408433603900679e-02   -2.263893694552077e-01   -4.238570001414531e-01; +1.178727875088340e-01   +1.747364232598598e-01   +1.836563235647190e-01   -7.391275104372806e-05   -2.133052249274034e-01   -8.604326341079346e-02   -1.761901040163216e-01   -3.395314982288185e-01   +7.014330559435816e-02   -1.346086497287379e-01   -2.165710236422360e-01   +2.444060973138990e-01   -4.043531333974815e-01   +2.891729083258383e-01   -3.262669701469705e-02   +4.301770791645560e-01; -1.061725055385722e-01   -3.818827693703032e-01   +8.406545645662759e-02   +1.257540904022929e-01   -5.477288789445818e-01   -6.560389079603310e-01   +3.320942530985905e-01   -1.119441654002062e-01   +1.035437110262804e-01   -4.944627510037997e-01   -3.310023542649305e-01   +2.564076084746601e-01   -1.606074726574159e-01   +8.185622304532109e-01   +1.447099109594160e-01   +6.947833898928713e-01; +6.863197102028848e-01   +1.135586270947067e-01   +1.818993617148016e-01   -4.799499394758622e-01   +7.677283750023185e-02   -2.277238885235866e-02   +4.729658925300160e-02   +6.452228128560368e-01   +3.838634755556939e-01   +1.139128697558829e-02   +7.823182517161380e-02   -7.817823418461339e-02   -3.606801109051757e-01   -1.632118748128876e-01   -2.209727436963933e-01   +4.559200558040303e-01; +6.663899483151856e-01   -2.229668734996446e-01   +1.492070837731331e-01   -1.254116386025841e-01   +1.435057141128711e-01   +1.195321151813475e-01   +1.202231901347314e-01   +7.727637115224835e-02   +6.452374611497544e-02   -2.843123235940594e-01   -5.074947957358941e-01   +2.461392036850193e-01   +3.671297358114231e-01   +3.704148382699588e-01   -9.961282881281572e-02   +2.600292900156022e-02; -3.663445709198824e-01   +5.268097871880714e-01   -1.359103988585532e-01   +1.808169422949155e-01   -3.268280664376853e-01   -3.293330860400236e-01   +3.540587377007084e-01   -6.340233464326879e-01   -8.121648184881254e-02   +1.284511781551127e-01   -3.853479169736413e-01   +4.891903011918923e-01   -5.983775165684353e-01   +9.456801843947386e-02   +4.690200530357643e-01   -4.990622984684250e-01; +3.306502568868454e-01   +3.101582357113933e-01   -4.069396898721085e-01   -2.287687879228737e-02   -2.271544555836928e-01   +6.550003058119730e-02   +3.742117614198885e-01   +5.928530045555845e-01   +3.682801705540422e-01   +6.479470174969515e-01   -9.020439650805255e-02   -2.178842593829433e-01   +7.848726502019530e-01   -2.399218861232019e-01   -4.542754002677989e-01   +4.668496610302035e-01; +1.000000000000000e+00   -2.026189438345416e-01   +6.954383443590676e-01   -5.025900659336461e-01   -1.052974890786721e-01   +1.450342181453257e-01   +2.624693178544060e-01   +7.253960013174024e-02   +1.579479877347529e-02   -2.092656158619073e-02   +3.951748348520761e-01   +3.978389671339297e-01   -7.650166363928849e-02   +4.259914952322567e-01   +3.199314747152231e-01   +2.173499058381506e-01; +2.947561320705134e-01   +3.701995934268077e-01   -3.360940923615253e-01   +6.745137655690772e-03   +1.079259185730984e-01   -3.440715717758582e-01   +1.618834478805272e-01   +4.297673350768383e-01   -1.881373154236275e-01   +4.237060513689737e-01   -5.302493930602734e-01   -1.162269285684416e-01   +4.631616874689493e-01   +1.977170574250230e-01   +2.065585377557935e-01   +1.983724807595981e-01; +7.933378657560595e-01   -8.249033104163281e-02   +2.284272227141653e-01   +2.769348155621310e-01   +2.988915027684655e-01   +2.999822139281324e-02   +9.892094290647342e-02   +4.949734376334541e-01   -2.106695009484294e-01   +1.080699825348750e-01   -2.992021003370340e-02   -3.116216986069186e-01   +3.611380122834753e-01   +5.039684705048537e-01   +6.447945781707226e-01   +4.854685699110687e-01; -4.027516991056717e-01   +3.074838034295458e-01   +4.055098054418810e-01   -1.883038051974885e-02   +3.743627345922957e-01   -2.175245344885158e-01   -2.704048945012387e-01   +2.434498918916839e-02   +8.942457440294792e-02   +6.904489662543924e-01   -1.524005425550848e-01   -1.961535737068925e-01   +2.127567428248871e-01   +6.746466906631123e-01   +5.522535009158900e-01   -6.786432176031640e-02; +8.284899802370094e-02   +6.499258614107452e-03   -4.276341310910517e-01   -2.857428658462923e-01   -6.686640890924778e-02   +9.577952174750447e-02   +6.153283769381935e-02   -2.617514466211305e-01   -2.737474227154013e-01   -1.313728707958053e-01   +9.861347586418381e-02   +1.977233267106580e-01   +5.949085757340008e-02   +6.997434550382302e-01   +2.727628221214065e-01   -2.376290687765304e-02; +7.503654985442318e-01   +1.725089454419088e-01   +1.016719274913859e-01   +4.833182829872406e-01   +1.680020375418915e-01   -6.467289656846653e-02   -8.918131508213330e-02   -7.981331697065433e-02   +3.833808009119633e-01   +1.701314941977056e-01   -1.034917235170860e-03   +3.966812381861013e-01   +4.779941802962764e-01   +9.014163941151502e-01   -3.015158116359624e-01   -2.481756798861935e-01; -1.410826712299624e-01   -7.106016066139996e-01   +2.239902409513871e-01   +9.228387393645698e-02   +2.272613613469802e-01   -4.402486777876744e-01   -2.444924328201523e-01   +8.135203052031224e-01   +1.099718577513907e-01   +3.266898549144337e-01   -4.308276528082778e-01   -2.534872528191178e-01   +2.186641660472475e-01   -5.635390904486293e-02   +7.198304935594525e-01   +3.762537775267278e-01; +1.858785133402140e-01   -3.882774359948381e-01   -7.222543839182431e-02   +2.048594122987528e-01   +2.257760099536183e-01   -2.645393360628495e-01   +1.111559045432769e-01   -3.866519386993628e-01   +4.529173408582029e-01   +2.559170381191433e-02   -3.910626269466234e-01   +7.461234064470593e-01   +3.378329358258133e-01   -1.896296182508675e-01   +6.201683743359151e-02   +1.162768676514840e-01; -8.738133857567606e-03   -2.413553531206047e-01   +5.950083713794344e-02   -3.393911641460033e-01   -4.512212884075281e-01   +4.919489103169045e-01   +4.685402803486450e-01   +3.503658510881302e-01   -5.440409936391399e-01   -6.311818252599857e-01   +2.186464249637178e-01   -1.072002264522676e-02   +5.586468762769713e-01   +5.416209651428477e-02   +1.814600353178597e-01   +7.185132135832871e-01];
L1E_L1I_iGABA_netcon = [+1.046895935256542e-03   +4.594386397407741e-01   -1.709237366486688e-01   -3.861572322476788e-02   -5.903926618183792e-01   -4.696786564904107e-01   -7.847468478188299e-02   +2.433276534592254e-01   +5.550593100851965e-02   +3.408187208539696e-01   +1.076817185979745e-01   +5.262750967973586e-01   +4.121192983894407e-01   +9.744615696488005e-01   -3.113250173754406e-01   -2.519421329504661e-01; +3.589079379598921e-01   +6.791363579654149e-01   -1.250903658522647e-01   -2.260180791539255e-02   -2.159870252406795e-01   -1.458726553602670e-01   +4.568975674073135e-01   +3.672412038975471e-01   +1.729743949879504e-01   -6.572158472868508e-01   +6.540903586768518e-01   +5.976151640993410e-01   +2.117540412607579e-01   +1.035424682437654e-01   +1.635522277606327e-01   -6.418746837443098e-01; +5.177876700787819e-01   +6.798167612104015e-01   +4.686683413864285e-01   +2.451770479913381e-01   -5.583002265279022e-01   -4.940334983189818e-01   +4.730721955719308e-01   -1.909960994238594e-01   -2.113151373354543e-02   +1.688355250306157e-01   -1.729222105679451e-01   +1.998615383718311e-01   -2.287497274197935e-01   -2.728874250046290e-01   -4.556392703278342e-01   +4.352715636644014e-02; -7.329809281656642e-01   -6.643551457084118e-02   -8.593977855995634e-01   +4.500601420351298e-01   +2.243631052504770e-01   +2.730318920207487e-01   +7.940608209667878e-02   -2.862042426672823e-01   -2.695720692242421e-02   -6.209571042634872e-01   +1.531725573494926e-01   +4.392669467169571e-01   +4.191136257755843e-01   -4.612050792572088e-01   -6.567980742512632e-02   -1.578198311825999e-02; -1.259677330918717e-01   +1.054369500006249e-01   -4.650802514088963e-02   +2.207143222862882e-02   -1.764388038478101e-01   +9.346592357048039e-01   -6.801398309842013e-01   +6.389760499189842e-01   +7.869902772361950e-01   -5.558415724147157e-02   -2.083126122853913e-01   +3.142764166582265e-01   -1.254455946330400e-01   -3.493079219005758e-01   -1.694761507211872e-01   +1.364146117321688e-01; +5.317230314254825e-01   -3.045572931616999e-01   -1.042539665493464e-01   -1.183355934327092e-02   -9.276108745822575e-02   +1.458888805606141e-01   -3.799769388585310e-01   +3.569491551642962e-01   -4.766432109325869e-01   -1.927356395401032e-01   +5.603959440959820e-01   +7.828747059177558e-01   +2.479812336739771e-01   -3.100347016129967e-01   +1.744748969393395e-01   +2.510939715383300e-01; -3.902655164935113e-01   +7.592041500808091e-01   +7.876578004690363e-02   +4.058735790647533e-01   +7.207442802208022e-01   +1.196154994213702e-01   -3.508095896793961e-02   +3.397028377924147e-01   -8.745042416311997e-02   -1.521749478263659e-01   +6.542834354628808e-02   +1.305903608543318e-01   -5.434041887282747e-01   +3.698015899311090e-01   +2.708420371440857e-01   +3.767391462287138e-01; +5.899853522838069e-01   +3.010958375721800e-01   +4.377847861323235e-01   +3.012843954192586e-01   +8.735088899908205e-02   -7.504325480640385e-02   -1.557494723068398e-01   -6.191709484632195e-01   -3.184002428340623e-01   +4.742930660254004e-01   -1.915299587253050e-01   +2.479829423295536e-01   -1.137708426392001e-01   +1.011200483879203e-01   -2.861312151263202e-01   +3.488509585950446e-01; +3.861318867876536e-01   +5.471699035847281e-01   -8.957287955353596e-01   +5.260023133520364e-01   +8.987873473219651e-02   -8.805634282482118e-01   +8.013183516076418e-02   -8.549342811242793e-01   +1.001886253556775e-01   +2.462132022423987e-01   +3.809936592438212e-02   +7.141028116498817e-01   -1.069340323377473e-01   +1.433934652953619e-01   -2.423694520986835e-01   -9.148241870611080e-02; -7.615619128422187e-01   -2.423329823623854e-02   +4.099723073773042e-01   +1.476917703287412e-01   +1.120858653995430e-01   +4.685814781847744e-01   -1.680070935591694e-01   -9.391000080173001e-02   +1.917731284610062e-01   +1.207537776349385e-01   +1.000000000000000e+00   +4.772169096466346e-02   +3.123017524273027e-01   -8.836998767653220e-02   +8.771108701039150e-01   -1.639225520269053e-01; +3.956643720150265e-01   +9.761204218009961e-02   +3.923096020192252e-01   -2.857117813021415e-01   -1.447254241614630e-01   +3.268983210564781e-01   -3.397357130120435e-01   -1.978315431030636e-01   -6.802102010733748e-01   -2.646696593947493e-01   -4.619350173088789e-01   +5.651621323740483e-01   +5.105740585334653e-02   -5.366528718234101e-03   -4.542047193648081e-02   -4.869499628203779e-01; -2.690836909139524e-01   -1.374878524844081e-02   -9.078104797896357e-02   -3.502984328447135e-01   +6.423039047441575e-01   -3.010740563258430e-01   +7.033361469269533e-01   +6.496182986710326e-01   -2.755299422357779e-01   +3.671328932169988e-01   +5.951155715107534e-01   +1.166742284282116e-01   -3.438937782292655e-01   -4.269830707163574e-01   +2.089503945801682e-01   +3.043403193631966e-01; -2.322671894261192e-01   +7.489460039815804e-02   -1.014916787625726e-01   -4.195188715081701e-01   +5.002827511844354e-02   +1.715447355084980e-01   -4.123618017312853e-01   -5.211421720060537e-01   +3.954949959408655e-01   -3.306407862280462e-01   -2.367940336525624e-01   +6.958848039940372e-01   +1.602708556215573e-01   -1.420981956632538e-01   +2.334334253051032e-02   +1.545716542030988e-01; +4.912210628465944e-01   -7.421861417675110e-02   +3.391995526364413e-03   -1.230723406424095e-01   +4.774095518047733e-01   +8.036309452589228e-01   +1.259323641783436e-01   +2.289381874724452e-01   -5.086794698670922e-01   +2.270726768826483e-01   -5.076169266239071e-01   +1.582774971027204e-02   +4.916029130055688e-01   +8.484249410497908e-01   +4.950508501491172e-01   -1.476230380377268e-01; -2.274883134465733e-01   +3.018784926047259e-01   +5.495783212416934e-02   -1.783300433650779e-01   -6.956955707702710e-01   +4.920013687457853e-01   +5.945842581377822e-01   -1.714052480821368e-01   +4.425707463937341e-01   -2.764387407106627e-01   +3.505148126104431e-01   -5.515729207301522e-01   +2.181183166474922e-01   -2.965223364528944e-01   +9.457749854151400e-02   -8.529998597805333e-02; +8.087126740026245e-01   +7.523031856204624e-01   -5.221532201487012e-01   -1.060487730345752e-01   +3.306989548897234e-01   +6.737358899711345e-02   -3.287626181210563e-01   +5.722304000450770e-01   -1.489526430335421e-01   -3.242478583317610e-01   -3.353366406880671e-02   +4.717742727912532e-02   -7.756872618677646e-02   -9.849943347398604e-02   -1.585053092813190e-02   +4.726746167427742e-01];
L2I_L1I_iGABA_netcon = [-2.522460050449882e-01   +1.175913077414359e-01   -3.244659729828189e-01   -1.406718161632198e-01   -5.102616801857838e-01   +6.184278590066860e-01   -1.980801367176100e-01   +4.334904594212385e-02; -4.964579722029606e-02   +6.388350468674273e-01   +3.813100290539973e-01   -2.650895821634658e-01   -1.989620986673835e-01   -9.906754811402062e-02   -6.331170643420132e-02   +1.294206858724491e-01; +3.077381175251053e-02   +2.378365471525669e-02   +9.419777083594074e-01   +7.956762849522915e-02   +2.035758862381451e-01   +2.541598557921952e-03   -2.337379294445250e-01   -5.786646533321288e-01; +1.000000000000000e+00   -8.584678457821282e-02   +1.641389714963347e-01   -3.371744753678650e-01   -4.609335015365562e-01   -3.854495067038327e-01   +3.085701108495993e-01   -3.892491154477383e-01; -2.282021471435534e-01   +7.134111062531576e-01   -5.288385542009167e-01   +4.778491429960073e-01   -8.741909427180506e-04   +6.405370615205116e-01   -6.064532880178886e-01   +9.384286659170121e-02; -1.025129895450738e-02   +1.835482727296780e-01   -6.735154253989283e-01   +1.085723392310833e-01   -1.668417422625623e-01   +1.373430221386396e-01   +6.128509256824843e-01   +3.223962617171992e-01; -3.045886821389557e-01   +3.028911098518317e-01   -3.115139824193486e-01   +2.893841353322115e-01   -2.260517481800216e-01   -1.357893151523849e-01   +5.760087188005383e-01   -3.060057784584875e-01; -3.813205287560743e-01   +8.009876418360865e-02   -2.963337050130603e-01   -1.651681512203618e-01   +5.325674738861248e-01   -2.916505534131595e-02   +2.745747123286293e-01   -3.308582212327425e-02; -2.324084008684539e-02   +2.907046297013302e-02   -2.951122311931024e-01   -1.785630106693627e-02   -4.508338879860442e-01   +5.160505954032964e-03   -3.587833339740329e-01   +4.353449060224996e-01; +3.485301591614405e-01   -5.562186439756902e-01   -1.965891337404495e-01   -4.545712058971831e-01   +5.372001124666983e-01   -3.035755421666297e-01   -2.542742478749413e-01   -3.494613744942995e-01; +9.543180982098317e-01   -3.049336825782562e-01   +5.261286246984351e-01   +3.258764710898112e-01   -3.001022597198786e-01   +1.806732813934999e-02   -4.720143360859264e-02   -5.341101633629927e-02; +4.398681897795716e-01   -1.365483583126553e-01   -1.107582454428120e-01   +6.037231548898195e-01   -1.001474874561705e-01   +4.408869527832469e-01   +9.603504548146115e-02   +4.276245555692855e-01; -1.071846278938318e-01   +6.748983592866453e-01   +4.593719452739954e-01   -3.635874153577663e-01   +3.716760957739028e-03   +6.027938980427613e-01   -3.773375197131463e-01   -1.027654659279391e-01; -1.423107465177560e-01   -3.518866548695745e-02   +2.373770773710160e-01   -3.081066426328189e-01   -5.050929551771185e-01   +1.942387858594361e-01   +7.713127095424391e-02   +6.568080046994018e-01; -8.320578574787144e-03   +9.017392641554914e-01   -3.283125984710821e-01   -1.498211485992166e-01   +4.248425303848235e-01   +2.886988173734645e-01   -5.000584601742453e-01   +5.802245529842618e-01; +2.928904334327591e-01   +6.292261107008842e-01   +2.730952861994388e-01   -3.064038306678618e-01   +1.897097618283602e-01   -3.351006323071976e-02   +3.966665937882758e-01   +5.268743848823968e-01];
L1I_L2I_iGABA_netcon = [+2.189815657162538e-01   -3.361462583955663e-01   -2.291266367840911e-01   +8.289495500217652e-02   -1.035842168956169e-01   -2.547095280523212e-01   +3.462280953115543e-01   +8.481864394817213e-01   -4.983047432620910e-02   -3.446239981302232e-01   +5.393554782231624e-01   -3.466666563291071e-01   +6.739931978731219e-04   +1.578956067293669e-01   +1.064779654634838e-01   +5.741263460369419e-01; +5.320756594144311e-01   -2.085151974086848e-01   +1.079702891744423e-01   +3.571341250577539e-01   -3.960010979595042e-01   +3.497275211551446e-01   +3.464259693901637e-01   -1.539740676899099e-01   -3.761213879336571e-01   +4.537244140000815e-01   +2.161402453782541e-02   +4.100194865380778e-01   +1.545283098227268e-01   +2.068651411298252e-01   -7.827073143572443e-01   -3.257722389504158e-01; -7.030136448777913e-01   +3.032445617920076e-01   -3.899233999166895e-01   -3.811290555212731e-01   -4.294134765385721e-02   +6.508347846615972e-01   -4.422674068275096e-01   +4.682153133399958e-01   -1.308450904897733e-02   +4.535165828401170e-01   -6.710004969402458e-01   +6.970101251683647e-02   -2.556741291285586e-01   -4.202367285695629e-03   -1.672364644263518e-01   -2.770388532475532e-01; -2.207992704786506e-01   +6.207557139029223e-01   +2.623726930628637e-01   +2.620226162094083e-01   +9.977766781121706e-01   +2.045550202877188e-01   +8.546218646155929e-01   -1.274051735230440e-01   -3.464851850438441e-01   -1.480529968310081e-01   +2.693137458096867e-02   -5.929651285862383e-01   +1.662334229239606e-02   -8.401836351834874e-02   +4.484661957962842e-01   +3.381683510433988e-01; -7.584096681138668e-01   +8.074389593814097e-01   +2.770314349979484e-01   -3.957528053353083e-02   -1.600694289968549e-01   -3.579556736698929e-01   -2.836542049968141e-01   -8.060205811721535e-01   -5.920711900300841e-01   -4.510127102055552e-01   +8.145295467113658e-02   +6.928713483956437e-01   +1.819389310956222e-01   +6.434024567998590e-01   -3.503790866549310e-01   -3.873863196760371e-01; +6.038223741996991e-01   -5.872301705764637e-01   -1.754369884095230e-01   -1.424867652732989e-01   +6.204418809010556e-01   +1.746023082185554e-01   +2.060197595106315e-01   -4.491425215017903e-01   +7.906770360328388e-02   -1.758343879361142e-01   +5.949263886545947e-01   +4.597334991770233e-01   +1.262466475011031e-01   +2.544785318334085e-01   -4.471971039040681e-01   -3.847347439698764e-01; +4.022587949753101e-01   +6.063074485812910e-01   +4.995801345618960e-01   -2.888475238756398e-01   -2.345995663921568e-02   +2.837111356439652e-01   +3.690719573703254e-01   -1.857735782124291e-01   +1.188713054217123e-01   -7.122103559720747e-01   -6.841722479702316e-01   -9.768441196597413e-02   +2.243307539492614e-01   +5.094056973707710e-01   +4.683350535366025e-01   +4.961148967640942e-01; -1.474239648201814e-01   +4.319631463947718e-01   +9.729398844832773e-02   -1.998218919934850e-01   +5.740464758674946e-01   +2.035075248458736e-01   -5.761061352290562e-01   -1.279104167796976e-01   +1.015541730833792e-01   +7.213823700212850e-01   +1.255968551144504e-01   -5.565213912422320e-01   +6.656964551935973e-01   -2.907863542222938e-01   +9.227792572435017e-02   +5.216051635066872e-01];
L2E_L1E_iAMPA_netcon = [-6.975435426872859e-02   -2.085049405406367e-01   -8.552386603933760e-01   +4.190595000017193e-01   -4.746469427869979e-01   +2.182493119136174e-01   +1.784488361940109e-01   +8.959230962394817e-01; -1.054226114345071e-01   +1.794060620194942e-01   +2.333860565228870e-02   -5.572127040947942e-01   +3.153132765974302e-01   +8.546031364638761e-02   +7.252637707779435e-01   -1.207037582157070e-01; -1.015773708776574e-01   -2.052604021989882e-01   +5.927277583532724e-01   +3.566749174270462e-01   -1.124556809451077e-01   +4.505718707766596e-01   +8.856177008099761e-02   +8.155982374429918e-01; -5.105672527008748e-01   -1.120558564654288e-01   +4.078283044790805e-01   +1.000000000000000e+00   +3.766373743695561e-01   +6.420053139279216e-01   -5.358106328372494e-01   -2.169637179081202e-01; -3.186466761229358e-01   +3.650641291643466e-01   +2.068054411926314e-01   +5.330879739173582e-01   +8.341072434602963e-01   +2.078039641369851e-01   +9.129560518883913e-02   -1.914617592182557e-01; -3.772438465639128e-02   +7.550999664345839e-01   -8.485767435396327e-01   +1.752644018872273e-01   -9.406702407002260e-02   +2.843862431101928e-01   +2.901220844300428e-01   -5.350949085909493e-02; +2.606559957675844e-01   +4.165880860657287e-02   -9.864913209846116e-01   +2.408246064291182e-01   -3.929755477260361e-01   +1.645506697943430e-01   +5.154927986405743e-01   +4.911929519547025e-01; -1.151725380643178e-01   +3.905292791410687e-01   -8.828510336347217e-02   +2.247323042280578e-01   +7.697756510210401e-01   -4.934248693523225e-01   +1.989819662530224e-01   +1.061496629411491e-01; -5.599513779594324e-01   -2.047837605130365e-02   +4.930980912841695e-01   -2.104788622369903e-01   +1.208294160336486e-01   -2.211524851116813e-01   -5.837313130956837e-01   +2.625859978724862e-01; -5.559824088321329e-01   -2.310410247511716e-01   +3.922163783304105e-02   +7.039703749717161e-01   +3.064674445797258e-01   +9.709707446680017e-02   +2.472896749211083e-01   +4.363859113180895e-01; +3.370639641050384e-01   +3.634534613537234e-01   +4.304403700008509e-01   +1.492709821003452e-01   -6.908696042909116e-01   -6.668278811311310e-01   +2.976156617601811e-01   -1.877625078825708e-01; +1.071823275148963e-01   -3.242529205054945e-01   +1.382447394446739e-01   +6.076157922603554e-02   -1.453854350096371e-01   +1.712103998258485e-01   +7.299222475502950e-01   +1.570193997177829e-01; -5.639966010134676e-01   +7.183416934506150e-01   -2.609656494802503e-01   -3.437551269599836e-01   +2.184028430310195e-01   -4.785703560262848e-01   -7.308683306316152e-01   -5.167524674730709e-02; +2.166733919679221e-01   +2.829049102942971e-01   +6.124644681174584e-01   +5.383983907491739e-02   -5.527371909658730e-01   +3.062025169626864e-01   +7.152756594378044e-01   +4.223457056163711e-01; +3.439477161664454e-01   +1.736057760549394e-01   +7.682527176074498e-02   +9.560739957104480e-02   +1.676265227031469e-01   -1.657884721479672e-01   -4.366531102379414e-01   -1.639336372193172e-01; -5.937468333366003e-01   +3.458429779433354e-01   +5.074951889305901e-01   +6.881442355262610e-01   -6.111878647844563e-02   +2.631239344524900e-01   +4.179367400820808e-01   -1.415873930831430e-01];
L1E_L2E_iAMPA_netcon = [-5.327101447638025e-02   +3.790999478259690e-01   -2.762906512055270e-02   +1.263191167653056e-01   +1.275828955830985e-01   +2.727784218034588e-01   +3.845924139519943e-01   +6.508160417882728e-01   -6.941587687204106e-01   -4.295980364593440e-01   +2.361872736603554e-01   -6.517618056307496e-01   -5.098928584459020e-01   -2.760461595218270e-02   +5.077821809479038e-01   -3.855836340834174e-01; -4.899210553860389e-01   +4.239597459161584e-01   +1.149956707693504e-01   +3.340332082209347e-01   +3.706603576156561e-02   -1.000868064853909e-02   -2.089324623167128e-01   +1.821452354693660e-01   -2.731054068310361e-01   +4.437375191633625e-01   -2.996840543394658e-01   +5.868225500156868e-01   +4.033187954407069e-01   -7.354849079133925e-01   -4.818235998779472e-01   +2.196213243165743e-01; +6.201338606214084e-01   -3.001809620753156e-01   -1.880532722406351e-02   -1.306923276984143e-01   -1.658727298044033e-01   +6.039582480123553e-01   +7.452556995925148e-02   -2.091833796048991e-01   +2.154780249646807e-01   +3.799923310062428e-01   -3.921036932414991e-01   +3.885923290751337e-01   +4.103082782792005e-01   +1.590204577202487e-01   +1.780955494150449e-01   -3.648201803394867e-01; -4.459710027660266e-01   -3.643585114167355e-02   +3.094002188640738e-01   +5.588936223903712e-01   -3.622403221029548e-01   +2.377035401489117e-01   +4.519515695554401e-01   +1.454317704282159e-02   -5.883784633516039e-01   -4.012629976746936e-01   -6.904408269590544e-01   +7.518136933524788e-02   +5.238865521284068e-01   +5.621456217126420e-01   -9.656405385649514e-02   -1.772112562320947e-01; +5.723137610001972e-01   -1.385637000359761e-01   +6.410139561333349e-01   +3.343996444163460e-01   +1.000000000000000e+00   +3.977548575801036e-01   -9.804566605838187e-02   -2.246690268023449e-01   -1.689046464764637e-01   -2.841990468333627e-01   +2.530725617515491e-01   +2.507109316558018e-01   -1.674931534800380e-01   +3.291933315335066e-01   +5.123497746867676e-02   +4.662955105997028e-01; +3.154957209284472e-01   -4.013102639375243e-01   -2.498431573556381e-01   +5.866001770262282e-01   +5.199776958150782e-02   +7.164304671948974e-01   -7.963037829834597e-02   -4.309648880373539e-01   +3.414058257679972e-01   -9.112763040880122e-04   +6.875700199944982e-01   +6.048411037129322e-01   -1.683989868251183e-02   -4.289076301046408e-01   +9.661949742353214e-02   +5.510817687422718e-01; +8.286116674361380e-02   -6.319763057009721e-01   +2.518316753119021e-01   -3.822613878024159e-01   -1.549994556681397e-01   -3.427413786652216e-01   +1.047761781845348e-01   -3.091521126260869e-01   +2.935567651697471e-02   -2.634645002894325e-01   +1.488753827589014e-01   -5.661760337723526e-01   -6.530439022507302e-02   +1.110761366829169e-01   +3.649222134032644e-01   +5.970534589757265e-01; +1.722973149716357e-01   +5.392290688879223e-01   +5.682574869840060e-01   -2.421655163973753e-01   -3.931502038745923e-01   +2.455539841814670e-01   -4.747151415718635e-01   +4.390318468176608e-01   +9.532587892375764e-02   +7.059161891656827e-01   -5.035562021048789e-02   -5.337054619425223e-01   +1.878912113980137e-02   +3.564688955174801e-01   -5.585407337151227e-01   +2.933840882647876e-01];
L2I_L2E_iAMPA_netcon = [-3.096315751664066e-01   -2.481882938455210e-01   -4.142881318976718e-01   -1.807998622455426e-01   -5.172054794950142e-01   +1.386897020315957e-01   +1.609456087661684e-01   +3.714170583410266e-01; -3.185459799433521e-03   +2.482160918276429e-01   +2.209555923354075e-01   +3.876020459442305e-01   +2.911619943026439e-01   -2.409240643801210e-01   +4.576497622886405e-02   +3.744035191115148e-01; +4.503119118172584e-01   +7.040981475436042e-02   +4.258273759588443e-01   -4.594009676142882e-01   -4.234860603425031e-01   +1.316510111988038e-01   +3.087238599360071e-01   +3.214666157075010e-01; -7.050883545715736e-02   -7.319109060424843e-02   -5.726187801481070e-03   -2.119877108955702e-01   +3.059248715698985e-01   -6.261499591911115e-02   -6.110532879905622e-01   -5.117955431928762e-01; -1.123412202057458e-01   +3.519257602484555e-01   -3.385925044272164e-01   +2.487266444504966e-01   +5.761654494732706e-01   +1.992179619949787e-01   -2.444402551371804e-01   +4.579610363451572e-01; +6.431418085974856e-01   -1.924932699246445e-01   -1.693428437720853e-01   -3.033188513086092e-01   +1.594164380803590e-01   -9.441191400532094e-01   -2.285097799894196e-01   +6.731029973940146e-01; +8.792567129938123e-01   +2.957845814685046e-01   +2.544383549016628e-01   +4.702073816108134e-01   +4.100259258690619e-01   +1.450068072724039e-01   -5.377530141740144e-01   -2.655696474711765e-01; -1.476053358268961e-01   +3.286033801602107e-01   -6.686746549226881e-01   +3.337558354792993e-01   +3.058398651122515e-02   +3.396338834996685e-01   +1.758033632168755e-01   +1.631261318473650e-01];
L2E_L2I_iGABA_netcon = [+7.306981846199809e-03   +4.391112836291616e-02   +4.987220716291163e-02   -3.421259413721939e-01   +5.875967397991674e-01   +2.814003382452922e-01   -2.194596286583144e-01   +6.709275595773494e-01; +8.609645853444235e-01   +3.697575824949568e-01   -2.361141447215520e-01   -2.341580035479508e-01   +2.519981148045015e-01   +6.796565608313545e-01   +2.631183981532457e-01   +1.016503021669125e-02; +6.977545893754060e-01   -2.334742388117566e-01   +6.626924664412559e-01   -3.812572152656465e-01   -6.186433517387002e-01   +5.136736477458164e-01   +9.555606279614670e-02   -3.894703078427163e-01; -2.853901434702846e-01   -4.903441148133544e-01   +6.523179719487051e-01   -5.155192181624630e-01   -2.788184643274422e-02   +1.547925640129625e-01   +7.898278797990526e-01   -5.034822334208513e-03; -2.405325510514126e-01   -5.996355444140137e-01   -4.877380810017400e-01   +2.550075160800925e-02   -4.371170063555739e-01   -7.560398445603780e-02   +3.311596045652520e-01   -6.799718891589199e-01; -6.487378824892894e-01   -5.181764455138986e-01   -5.603514819660310e-01   -5.472411071001236e-01   -2.052861495073590e-01   -4.334563540637698e-02   -2.119387123425158e-01   +5.184657315918494e-01; -2.928543205721357e-01   +1.651284172838152e-01   -4.648370022243123e-01   -2.063608444451464e-01   +1.863069827124602e-01   -2.857740318093566e-01   +5.975338675527226e-01   +4.065159247796661e-01; +1.403349321472390e-01   +9.512842972848323e-03   +6.910541356569430e-01   +5.937238502392166e-01   +4.398193604528858e-01   +1.627906473445014e-01   +3.963519373806250e-01   -1.981226723807549e-01];
L3E_L2E_iAMPA_netcon = [-4.589957730733107e-02   +6.032594066894399e-02   +2.381919382708583e-01   -2.257907595968867e-01   +3.226356976127867e-02   +4.682723653995161e-01   -4.353846568274349e-01   +3.202482923398204e-01   +3.938468630903694e-01   +3.540849225516313e-01   +6.487801202725872e-01   +2.795981431277155e-01; -3.967272710113539e-01   +3.321721876007036e-01   -1.649656395001507e-01   +7.415846375410448e-02   +2.066817404589579e-01   -4.905945927626816e-01   -1.777973745330785e-03   -1.887506746476792e-01   +1.559589742157407e-01   -4.998983004001361e-01   +1.124192113609083e-01   -4.621419845833409e-01; -5.031478718968363e-01   +5.725472206501693e-01   -3.985114788930455e-03   +2.118935563807998e-01   +2.971930734724801e-01   -5.550160623058265e-01   +4.505852950763743e-01   +5.158564447523329e-01   +1.740266370372052e-01   +6.573211823293166e-01   +3.449518740067889e-01   +3.931030254745942e-01; -1.916979945802515e-01   -5.534278810892238e-02   +8.852150196235677e-02   +3.958386062480048e-01   -1.760200285557081e-02   +3.851089941824192e-01   +1.788794797795308e-01   -2.312586224577766e-01   -3.707502095952110e-01   +9.222063090512667e-02   +8.068143839284241e-02   +5.962387759571193e-01; +4.134186113283813e-01   +9.198610520114198e-02   -3.077685163502222e-01   +1.874914221580232e-01   -1.845721377984929e-02   +6.153419535224254e-01   +5.787499688480637e-01   +3.998343541309788e-02   +4.493090721387012e-01   -8.082656241912417e-02   +2.204843913900962e-01   -2.807537789343145e-01; -7.143469531032186e-01   +3.057798405525627e-02   +1.221540879097205e-01   -5.479646643698790e-01   +8.088954379755005e-02   +1.640728800772087e-01   +4.172439389485143e-01   +8.177813801075896e-01   -5.289215177768170e-02   +4.883051572512622e-01   +2.835369364494323e-01   -4.573715131195707e-01; +3.519674639265334e-01   +4.926547042338904e-01   +3.303688949316798e-01   +7.905771592679813e-01   -7.289065605447850e-02   +2.787757528058709e-01   +2.468953006883240e-01   -4.545505433597395e-01   +4.540401865816637e-01   +2.991984925590510e-01   -5.027416826708325e-01   +1.000000000000000e+00; -1.811936034782616e-01   +6.423464919016021e-01   +6.736311313953470e-01   +3.583308455982493e-01   +2.393923216494610e-01   -1.359240528007638e-01   -3.500898366912616e-01   +6.375626072932291e-01   -4.178759472575650e-01   +1.748927877650734e-01   -4.813789292259209e-01   -4.236086760353029e-01];
L3I_L2I_iGABA_netcon = [+4.365387305251055e-01   +1.535566531825055e-01   +2.501989991390367e-02   +8.768057656262657e-01   -1.152980591939417e-01   -3.190900382848508e-01   -4.634669721672595e-01   -2.300992211272166e-01   +8.282327459756909e-02   -4.131581047204427e-01   +3.746277511914793e-01   -2.910069013375176e-01; -3.648501150052088e-01   +9.698138952018486e-01   -3.892274210743734e-01   +2.444419517936381e-01   +7.820545804437242e-01   -2.894954557454426e-01   -2.498230795620315e-02   +7.616985429077956e-01   +9.234306920004240e-02   +9.166841861169908e-02   +4.983851347350693e-01   +3.839269310816263e-01; +4.235384093358748e-01   +1.303262545352170e-01   +6.166307374800157e-01   +4.462614873928094e-01   +1.623818220992251e-01   +4.787970690221324e-01   +5.015895867246328e-01   +4.013892074898789e-02   +1.209781980676510e-01   +5.538176609450738e-01   +1.362373992099453e-01   +9.513124944296520e-01; +1.873815315200714e-01   +5.817802868446853e-01   +4.453227395508499e-01   +1.084578247093720e-02   +5.235660019359554e-01   -3.589141769382888e-01   +2.793894469065901e-01   -1.517722694340732e-01   +2.598237735021547e-03   -3.767791444232118e-01   -5.069442428801860e-01   +1.887462752534480e-02; -2.795507257087876e-01   -5.048932019607866e-01   -5.825016242412918e-01   +2.367729128636375e-01   -1.367586652196536e-01   -2.389218273548555e-01   +4.499453121500969e-01   +3.000926417784274e-01   -4.590266955991830e-01   -1.150524746248715e-01   +1.765673550158812e-01   -5.251564374348886e-01; +4.263719701168439e-01   -6.630638270876443e-02   +2.424767544024146e-01   +4.617774849399161e-01   +2.353608321941575e-01   +3.044553014353965e-01   +1.171550132937155e-01   +9.102261133065791e-01   +1.238377057724109e-01   -1.161386795149489e-01   -5.732398086512710e-01   -4.972577686901909e-01; +5.433241086647816e-02   +2.232209824906619e-01   +2.426168167441152e-01   -6.329223625624335e-01   +2.001246387002591e-01   -4.155891110706272e-01   -7.966963719517954e-01   +1.535975163619553e-01   +1.629142955542446e-01   +1.198308475913433e-01   -1.581287168438769e-01   +8.673465615289416e-01; -3.422556337412295e-01   -6.231254155072879e-01   +5.675854213913023e-01   +8.503804913209081e-02   -2.231664512436576e-02   -6.772729451026596e-01   -4.979081296183178e-01   +4.426168002789045e-01   +3.779146981253377e-01   +8.771479483470226e-02   -6.024866302763212e-01   +4.429305853136469e-01];
L2E_L3E_iAMPA_netcon = [-7.070759265274732e-01   -2.294156928821028e-01   +3.982134247600637e-01   +9.805933793500829e-01   +1.460098864820278e-01   -1.311601147691652e-02   -9.634282841622251e-02   -5.783379099541538e-01; +3.611516620918158e-01   +6.395963172340513e-01   -8.910479802889988e-01   +5.951197282837609e-02   -2.065804684129397e-01   +4.319760612809068e-02   -5.832910646383621e-01   +2.856197253476860e-01; -6.858332249496746e-01   -6.918852453421666e-02   +1.938556215185158e-01   +1.479665853816838e-01   +3.413257811224750e-01   -5.463408799075323e-03   -3.564913839216489e-01   +7.596541985933389e-01; -7.311462175355929e-01   -1.155508863979805e-01   +5.891678955384541e-01   +1.885313648037679e-01   -2.750125327759132e-01   -3.816857017697943e-01   +2.890178347955329e-01   +1.903576994716878e-01; +3.986082303951410e-01   -7.502192140060843e-01   +9.392523117164429e-01   +8.539562543550445e-01   +4.189880675198085e-01   +3.945220559592580e-01   +8.534896457265851e-01   -2.239395190580215e-01; -4.435422709603897e-01   -5.422020054670684e-03   +9.153632593995811e-01   -4.102278195920857e-02   -2.687629401928408e-01   +4.009484924745878e-01   -4.516164318842312e-01   +4.874847549749650e-01; -1.187322825739407e-01   -5.968113885411742e-01   +2.575293884879619e-01   +3.255652877912055e-01   -5.158859239656818e-01   -1.879551386196409e-01   +1.338894143128654e-01   -2.437735064700673e-01; -2.245551677885024e-01   -2.831770684733521e-01   +5.926907491316347e-01   +2.146712509332105e-02   +3.059650095389547e-01   -3.042194502076015e-01   +2.243121495468891e-01   -1.145126834127133e-01; +4.984230138963615e-01   +2.776011167648750e-01   -4.128121403178577e-02   +5.632977109508676e-01   +8.433747389208327e-01   +7.961958921328574e-01   -8.897959402822508e-03   +3.477744837456128e-01; -4.469602615189843e-01   +1.617431069041440e-01   -1.094602136508943e-02   +2.537531295879943e-01   -3.396341253476018e-01   +2.918357742499331e-01   +1.087339149060274e-01   -2.338776109553050e-01; -1.981995321091451e-02   +3.397348082745014e-01   -9.755041269713302e-02   -6.934873899480276e-03   -7.503327548202722e-01   +6.957106754320499e-01   +5.321524741779239e-01   +1.178688008753013e-01; -3.918185298251076e-01   -7.289074767648631e-01   +2.071056352707779e-01   -1.588257853765372e-01   +5.468524193261430e-01   +3.235158876353736e-01   +9.580689874908015e-02   -2.124177716884629e-01];
L2I_L3I_iGABA_netcon = [-5.931570535057623e-01   -2.496778460257139e-01   +8.893715384835033e-02   +6.579659411805099e-01   +1.524304282633900e-01   +5.836451549051580e-02   +5.509804028596883e-01   +4.257516803411006e-01; +1.117231757839219e-01   +7.776804668662467e-01   -2.183785857301099e-01   +1.773675111475671e-01   -1.235992137732288e-01   -4.155307158958127e-02   +6.936397028560345e-01   +2.028532304492635e-01; +4.190682208941874e-01   -4.089929117256402e-01   +1.701264822510228e-01   +4.173260762392103e-01   +6.435434221155506e-01   -5.395643571010191e-01   +2.372714678793022e-01   +3.552099446686831e-01; -1.799107203434285e-01   -1.392966104836607e-01   +4.108450794191802e-01   -1.880557401819983e-01   +4.586077227777292e-01   +4.820164480412127e-01   +8.661814832043215e-01   +3.286902116868596e-01; -5.671081654848749e-02   -5.054151447300078e-01   -3.922990627612144e-03   -2.257209634812233e-01   -3.925558158468033e-01   -1.202434868267656e-01   +4.163570732479097e-01   +7.682341896651486e-01; +1.697261782409873e-01   +6.172552793726859e-01   +4.549979600607578e-01   -4.976877557700293e-01   +1.202028860404104e-01   +2.047639576096767e-01   +1.459260966364951e-01   +1.292829706216178e-01; +2.807962085814382e-01   +6.841746077491462e-01   +6.187427824243967e-01   -7.497669473954686e-01   -2.975841092570165e-01   -5.847578991730225e-01   -1.130079908798386e-01   +2.101228598990562e-01; -5.526158575502287e-01   -1.058260070624494e-01   -4.964140542510141e-01   -3.014326207466457e-01   +2.444123417495101e-01   -5.849074699644679e-01   +5.611308974212058e-01   +5.038689644737618e-01; +7.625141410592349e-01   +6.714871484450251e-01   +2.744265714962747e-01   -1.008513833993977e-01   -1.000197692064111e-01   -3.916600792254976e-02   -1.194862156149700e-01   +6.494114164238204e-01; +5.558360501343987e-02   +8.753115958532026e-01   +1.190894323924013e-01   +2.284841967324720e-01   -8.894347466040758e-02   +7.936992992063435e-02   -5.908200322618447e-01   -1.848147126523381e-01; -3.459079399704455e-01   -2.711917951889011e-01   -2.050040173823590e-01   -6.149052973094492e-01   +1.482397969748214e-01   +7.023169478057238e-01   +5.181589370907410e-01   -1.478001152570119e-01; +4.129439522003564e-03   -5.262638616039980e-02   -6.583935547032246e-02   -4.494680272182194e-02   -2.998109975501956e-03   +6.422928991725744e-01   -1.328726028720585e-01   +9.192774688781186e-02];
L3I_L3E_iAMPA_netcon = [+5.047307546551025e-01   +4.058984814054287e-01   -1.356705941798927e-01   +3.046206933563989e-01   -9.137687273221679e-02   +2.067216732791839e-01   +1.027445409564964e-01   +1.471110976311804e-01   -6.890251352555203e-02   +7.978724249033528e-01   +3.179190537224043e-01   -9.133194796054184e-02; +9.550111528787174e-02   -6.319101134860097e-02   +3.951799140234859e-01   -6.291638395320428e-01   +4.902904119272072e-02   -3.088036246328015e-01   +3.771409074818274e-02   -6.328197679510853e-01   +7.288533500439601e-02   +6.942034822885490e-01   -1.488475786284271e-01   -4.751626236620252e-02; -4.350357491344371e-02   -2.211111482707882e-02   +5.244287092869400e-01   +1.522442722789160e-01   -3.775570063908253e-01   +5.218450875659606e-01   +6.179135478159494e-01   +2.060074815261293e-01   +3.721778608536219e-01   -3.696985138521933e-01   -7.804476716061430e-01   +2.077200646963931e-01; +6.076600594099346e-01   -3.553507775674407e-01   +2.842221151964903e-01   +2.781639266754389e-01   +5.481808121052029e-01   -2.621106992108776e-01   -3.586783558806907e-02   +3.533634972690702e-01   +3.274746311178700e-01   -5.531096798596540e-01   -1.852730387870646e-01   +4.168095761894510e-02; +1.839634322460655e-01   +3.160396827224941e-01   -2.409874296211213e-02   -2.946102836599776e-01   +4.783027038138321e-01   -4.809560142450345e-01   -6.017489992505516e-01   -2.423977524846887e-01   +3.025857904240787e-01   -2.948206445824650e-01   -2.582857276542877e-01   +3.088807297599875e-01; -2.034376477837049e-01   -6.258006574958533e-01   +3.225875565893708e-01   +1.855525272075239e-01   +4.200441791809359e-01   +1.553146454173152e-01   -4.274459524431373e-01   -6.947584452483551e-01   +2.251755302818198e-01   +8.702052515446195e-01   -7.389670158765181e-01   +5.587001101861382e-01; +1.999369524154325e-01   +8.213970341753818e-01   +2.753489285519176e-01   -4.578124994848343e-02   +2.042739694569523e-01   +8.702623668764092e-02   +5.379661005887980e-01   +7.250247043386183e-01   -1.330193725154242e-02   +1.676329563420562e-01   +2.525806063856154e-01   -4.030724230276623e-01; +3.137955612983055e-01   +8.973445842938360e-01   -2.625396502892497e-01   -1.041443936089994e-01   -3.050984192738301e-01   -4.284976489117651e-01   -3.552737295715042e-01   +1.761118381541391e-03   +1.767660944766041e-01   +1.190565159538725e-01   +8.880035486130247e-01   -1.185057764426070e-01; +3.047410248235338e-01   +5.233214924581694e-01   +4.157150838586319e-01   +3.280339038337791e-01   +2.207642503995950e-01   -4.992903486990340e-01   -4.571102917765847e-01   +2.714536954113112e-01   +4.016911316488144e-01   -6.452187470822097e-02   +5.583077737872956e-01   +8.594076723821266e-01; +7.035494770669566e-02   -5.316341499428001e-01   +3.424086794873364e-01   -2.849673302236126e-01   -1.900003551117339e-01   +5.567236233322237e-01   +2.935756037039002e-01   +4.936590675983077e-01   -4.080924624143334e-01   -2.957911191704287e-01   -3.354145349807893e-01   +1.000000000000000e+00; -3.864624783205543e-01   +4.176144284620575e-01   -1.854107263203961e-01   +5.273330533133037e-01   +3.106059585237658e-01   +5.452220541951431e-01   -1.439898647740447e-01   +1.074793334675318e-01   +5.265848366387956e-01   +1.539149029641218e-01   +8.629148171196239e-01   +2.605581528081285e-01; -5.405394913942698e-01   +3.045650841644129e-01   +8.581939397881331e-01   +2.380790530696951e-01   +3.138186358749112e-01   +1.614579552548638e-01   -1.536675010496810e-01   -2.396352395598613e-03   -1.829200497960735e-03   +2.211756182070039e-01   +1.892438045150061e-01   -1.542933371363152e-01];
L3E_L3I_iGABA_netcon = [+6.282588702383655e-02   -9.221244664566915e-02   +6.776863269823393e-01   -1.456195578107920e-01   +1.453023644381318e-01   -6.573365079195765e-01   -2.996628133601592e-01   +4.958951049781416e-01   -4.678579584831009e-01   +8.328025565889889e-01   +3.760524466554609e-01   -3.080682298566874e-01; -7.786067708935682e-01   -7.615319687022817e-01   +3.830338545941002e-01   +9.972057477443372e-02   +4.070986410545876e-01   +4.015577955265109e-01   +5.908240365043651e-01   -3.503409975712914e-01   +4.590327246265911e-01   +4.121082287662935e-01   +3.848336282118696e-01   -7.657080060414438e-01; -9.365561818188194e-02   +2.520976364089453e-01   -4.560368094425314e-01   +6.332602413403067e-03   +5.435226674810505e-01   +4.415589620108816e-01   -5.808503659784874e-01   -1.480121653786658e-01   +5.504300821647627e-01   -4.866590517332041e-01   -1.607825719094167e-01   +1.331021130042752e-01; -6.651027209507021e-01   -4.262175658707272e-01   -7.534176642591510e-02   +7.069662428082850e-01   +8.592638327193586e-01   -7.084223104802678e-02   -5.542742926884636e-01   -7.351668280800419e-02   +4.963412853207936e-01   -5.062475615400973e-01   -6.112094287447390e-01   -3.843798470734506e-01; +7.262375512293442e-01   -1.521301248524459e-01   +6.487193735549299e-01   +4.271710542912713e-03   +3.296424508151878e-01   +9.162448269604870e-01   +3.148767260527011e-01   +3.427767217173389e-02   -3.321314785073937e-01   -7.585347512375998e-02   +8.869058444069331e-01   -9.834648808928990e-05; -1.299057558698958e-01   -3.733410215641643e-01   -4.567756944701382e-01   +3.231991998096880e-01   +3.087225617312963e-01   +1.097950564875380e-01   -3.807873620448849e-01   +6.040483623746165e-02   +8.273706518838551e-01   -3.480734614914623e-01   -2.063029664697044e-01   -4.650136967815827e-01; +3.923348515432167e-01   +2.134485054715854e-02   +8.669073282785118e-01   -6.863334371754928e-01   -5.616625202067651e-01   +9.261011530398834e-02   +1.610518740060313e-01   -9.263699583763847e-02   -2.171920115242833e-02   -1.509014084169878e-01   +1.731366030116321e-01   +3.213054836166823e-01; +2.003613848252100e-01   -5.473268019996496e-01   +4.260300214882652e-01   +3.992612805446573e-01   +5.394726215653911e-01   +2.622240256728187e-01   +2.584962409656321e-01   +4.593807233280204e-01   -4.018790872548147e-02   +2.964939957263204e-01   -6.732898347281363e-01   +1.237588741543489e-01; +4.194100205341795e-01   +6.206717519559898e-01   +5.205989980240736e-02   -5.542386598095224e-01   -1.267592089087699e-01   +1.005572439347660e-01   -4.446345364004580e-01   +1.778658586309632e-01   +5.445036523240596e-01   +4.927391772482064e-01   +4.476122017165335e-01   -1.501862829667605e-01; +5.057826993486539e-01   +3.074077263279917e-01   +9.389052305169572e-01   +1.066587435373633e-01   +1.576934543256691e-01   +1.435668552714130e-01   -4.935254227238136e-01   +2.026742873519695e-01   -3.464097033850569e-01   +4.810413607257787e-01   +4.259639244235755e-03   -6.237860339487733e-01; +1.361212642112458e-01   -3.001746327223794e-01   -1.567583055621286e-01   -3.404740425403326e-01   +1.000000000000000e+00   -1.547588102132650e-01   -2.236983809969729e-01   +5.436607093469779e-02   +1.883449717099559e-01   -7.775276474058944e-02   -2.431915192594278e-02   +8.684111496569048e-01; +2.968453002093082e-03   +5.915195531726937e-01   -2.989077222043886e-02   +6.032763341604518e-01   -2.620941875950057e-01   -6.045108232036676e-01   -7.236141444910957e-02   -5.496754491118015e-02   +1.167762553145476e-01   +2.792471156388917e-01   +4.433487979486267e-01   +6.733678236133156e-01];
L2E_Input1_iAMPA_netcon = [+5.858604702227127e-01   -6.342238789975557e-02   -2.851860514118455e-01   +1.107667275253513e-01   -2.220596830325969e-01   +2.001929298302491e-01   +9.903005149728568e-01   +2.196085214477549e-01];
L2I_Input2_iAMPA_netcon = [+1.168805930226832e-01   +2.542227916520601e-01   +4.412825668420163e-01   -6.815055652572359e-01   -7.661844203009872e-01   +2.757989386282668e-01   -3.325673523920080e-01   +7.947614751929711e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
