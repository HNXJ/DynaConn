function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.159621705603825e-01   +9.449703378830709e-01   +6.984116056739291e-01   +1.562177816985577e-01   +9.216302893724877e-01   +2.194583249552268e-01   +7.419722942174728e-01   +3.039470443547063e-01   +5.313794727583648e-01   +8.288421428172178e-01   +9.695700869961538e-01   +9.637329411466872e-01   +6.984187607221826e-01   +3.720459359108355e-01   +2.975815429096920e-01   +3.763404798552184e-01; +3.474517769037848e-01   +1.197118476801915e-02   +1.417930971177999e-01   +1.735839989676846e-01   +7.322082990535128e-02   +8.095930094368873e-01   +7.936022638757158e-01   +7.563524534180855e-01   +7.846694718091241e-01   +1.833830817958316e-01   +4.671523769223097e-01   +6.558370736285903e-01   +3.747871514403698e-01   +2.764292297900847e-01   +6.872877053265125e-01   +9.509368291243022e-01; +2.058771795966226e-01   +4.699163341049612e-01   +8.338672873137394e-02   +7.040166383515872e-01   +3.121655453777730e-01   +3.811441717731326e-01   +6.640562962348887e-01   +9.530938395658213e-01   +5.001728426026476e-02   +9.249033567530934e-01   +8.721964410588662e-01   +2.077140349898966e-01   +5.395845016387784e-01   +7.492810255468735e-02   +7.720854861256399e-01   +8.120709291405129e-01; +2.415869674500042e-02   +4.891821167856180e-01   +4.330801027526022e-01   +8.320727789007925e-01   +6.294283537522815e-01   +8.575524984935076e-01   +4.384795153708744e-01   +7.377753030768218e-03   +4.630364770328211e-01   +4.210193840498144e-01   +9.460711836696349e-01   +8.975331952768489e-01   +5.164980546495221e-01   +1.500889690338774e-01   +7.214227868269907e-01   +8.912549845677055e-01; +7.657263304089762e-01   +5.169840380014700e-01   +8.938859355939522e-01   +8.256002427816549e-02   +9.071437975992060e-01   +3.237553629655679e-01   +5.749353523741061e-01   +4.067048535619395e-01   +9.398495679333105e-01   +2.988406293042930e-01   +2.312454536055396e-01   +4.885194853144418e-01   +7.633843634531829e-01   +3.650484425865793e-01   +2.775532970419303e-01   +6.915043957847673e-02; +5.727444455824402e-01   +2.891695910300311e-01   +7.303944647562763e-01   +8.351771607575048e-01   +7.968751454980739e-01   +3.808428291091224e-01   +5.169500755003517e-01   +1.538147763414429e-01   +4.733111804305370e-01   +3.478074709066217e-01   +9.185084423661077e-01   +6.643497760664584e-01   +8.235101189378778e-02   +7.160127830874825e-01   +1.298306653528125e-02   +9.035410914605927e-01; +5.780573400305399e-01   +5.665259530442434e-01   +6.817724189443221e-01   +5.402452379342094e-01   +6.402271091363509e-01   +6.387364638609211e-01   +7.235778706036832e-01   +8.203459525734774e-01   +7.781138869115422e-01   +9.724734422826281e-01   +6.320453368686680e-01   +5.250053305842082e-01   +2.962848953009001e-03   +5.326609146979958e-01   +1.406548558549369e-02   +6.651383496436193e-01; +3.889409534833860e-01   +5.104918748878444e-01   +2.042334547755837e-01   +9.637984358547146e-01   +4.405112402693990e-01   +3.859074878896613e-01   +2.207386328603440e-01   +2.875261721583698e-01   +1.102028307254305e-01   +5.326610869844606e-01   +2.852760627124745e-01   +7.089636615404460e-01   +4.041653055217589e-01   +2.341583511640326e-01   +9.338896347811069e-01   +3.463506175052726e-01; +5.543261861997184e-01   +6.767203460928218e-01   +5.292299175100328e-01   +6.784465871976928e-01   +7.504388726561311e-01   +6.993336466671982e-02   +1.000000000000000e+00   +9.770800306407098e-01   +5.210992946000054e-01   +7.903034898726526e-01   +8.531824612586183e-01   +7.189028484156124e-01   +6.614385586914553e-01   +4.697795491718580e-01   +9.314984184039803e-01   +8.389443000078166e-01; +1.831692410025006e-01   +6.159228421036245e-01   +8.306586410681603e-01   +3.359238277968793e-01   +8.244491341983847e-01   +1.840007599104123e-02   +6.190861258219681e-01   +6.244255150153156e-01   +6.353631317681631e-01   +7.937259897228249e-01   +1.658508616088947e-01   +2.935119574507674e-01   +3.682232400244009e-01   +7.143987458892536e-01   +3.737877747380033e-01   +1.960084016008406e-01; +1.177052341910495e-01   +5.648095843059407e-01   +1.737509864234319e-01   +2.193737112957118e-01   +3.408886605087167e-01   +8.776097663494482e-01   +9.819442247165769e-01   +7.446104460591090e-01   +5.774377202821419e-01   +1.420803175541333e-01   +8.252148038383551e-01   +1.162460347087988e-01   +3.930029592833939e-01   +5.148054934963159e-01   +1.092961445461374e-01   +8.407137640983795e-01; +5.951843970774037e-02   +5.036744174770595e-01   +5.165419910093634e-01   +5.666750824734881e-01   +1.389932295373181e-01   +1.560098251498891e-01   +4.961599475093083e-01   +8.737311020849633e-01   +8.353116565098845e-01   +4.545965182503358e-01   +2.143576128242518e-01   +3.235053834987914e-01   +1.336334026900453e-01   +5.141472640568979e-01   +7.206004682707773e-01   +4.261708658947487e-01; +9.330333313570786e-01   +6.651362298583909e-01   +3.563796780995674e-01   +2.276087175538478e-03   +5.044110144497859e-01   +9.152747117757929e-01   +5.212101527817087e-01   +3.276820667514989e-01   +1.172003640174913e-01   +4.582983384338304e-01   +2.690260094497650e-01   +4.569821785410748e-01   +3.386330158452182e-01   +3.843831384867784e-01   +4.495882777768563e-01   +5.605297647886193e-01; +7.457174050440339e-01   +6.330599727034155e-01   +6.484955772396062e-01   +5.892890302661212e-01   +4.129132800236618e-01   +5.590244123537058e-01   +8.538621114364118e-01   +9.952825346192593e-02   +5.243609376846328e-02   +9.554950398666868e-01   +9.081092621284231e-02   +7.152852466069475e-01   +1.200812417684042e-01   +4.798778071229702e-01   +1.098477610968761e-02   +4.478207884652364e-01; +2.427771684408987e-01   +1.454956761704283e-01   +2.803363320498091e-01   +8.917510486564167e-01   +1.706633823808589e-01   +9.210019176299664e-01   +2.539094078021236e-01   +4.516628575915567e-01   +5.180858002368016e-01   +5.207181144173985e-02   +9.183611753660214e-01   +4.040256823554709e-01   +3.683300973612167e-01   +7.397268806508026e-01   +1.217644249031546e-01   +7.603338855558154e-01; +2.051017358670028e-01   +1.778408906166227e-01   +4.346860049833586e-01   +2.554975210206828e-01   +4.931658133633622e-01   +5.977042759025827e-01   +5.802850640971428e-01   +2.405973900589100e-01   +6.952232772589152e-01   +3.714124805968536e-02   +7.249558428091571e-01   +2.418143646544192e-01   +2.511583359634849e-01   +7.011696423506719e-01   +6.592982115792942e-01   +9.855163821358603e-02];
L1E_L1I_iGABA_netcon = [+8.423647825187155e-01   +7.518464964881983e-01   +8.736045759831774e-01   +4.371730976646608e-01   +9.189487042699386e-01   +7.766694745468442e-01   +3.234130884988462e-01   +6.434738879102205e-01   +9.380868472568750e-02   +2.481917541055491e-02   +1.300987062148134e-01   +5.198345550147844e-01   +8.716882237741808e-01   +5.749497426491803e-01   +1.677549176734809e-01   +6.291265989838711e-01; +6.210362120827286e-01   +9.945247671660542e-01   +3.104152953235945e-01   +1.489960567023494e-01   +8.829950530483951e-01   +2.738318858722816e-01   +9.618650416052325e-01   +4.314328317901476e-01   +2.933716801161111e-01   +5.149679087510353e-01   +4.245092682095831e-01   +2.023753983737445e-01   +8.046144806299015e-01   +2.886190268421884e-01   +5.363469635125386e-02   +3.374337184001724e-01; +6.708908590041486e-01   +3.727672815961531e-01   +4.326787836666925e-01   +6.522434111190496e-01   +5.842898063363849e-01   +5.269233842613943e-01   +3.535117742161442e-01   +4.813158470563102e-01   +3.255226950405689e-01   +8.635290025563985e-01   +4.817743393791489e-01   +7.744291521699618e-01   +6.446119398693311e-01   +1.340505602065155e-01   +2.113734589103513e-01   +1.565960594702506e-01; +7.838914001038269e-01   +5.023966956038758e-01   +3.825552506150680e-01   +7.235116861142133e-01   +8.354054333253632e-01   +4.028793194673215e-01   +3.212456815055452e-01   +1.021560532947965e-01   +4.811675382972625e-01   +5.834017392546377e-01   +6.723113546631169e-01   +3.924674327904117e-01   +7.342998971161119e-01   +4.944503439389342e-02   +2.017924937569259e-01   +4.011349928749792e-01; +3.104851737473721e-01   +7.572543561319791e-01   +6.556190664008491e-01   +1.631708769574621e-01   +7.760511710130902e-01   +7.816161999664896e-01   +9.072589842081138e-01   +8.070518578102922e-01   +2.408161541706351e-01   +4.218619752205598e-01   +3.578529396407931e-01   +6.833800053141119e-02   +6.661882863815354e-01   +6.220040428574521e-01   +2.177988548894805e-01   +9.138499140409693e-01; +3.288032047032778e-01   +1.288947035470928e-01   +2.390857969332371e-01   +3.416336065184360e-01   +7.872940757054424e-01   +2.625174256842423e-02   +8.861909498091695e-01   +6.419408516026509e-02   +4.532950405196047e-01   +7.146451046902721e-01   +4.974656341800192e-02   +7.589084984877681e-01   +8.809610337694649e-01   +6.060331205485585e-01   +5.805771095271686e-01   +1.494795155496828e-01; +6.348288245165667e-01   +5.178717146579678e-01   +6.861332590725272e-01   +1.058383996951365e-01   +7.001824697671668e-01   +4.110876541681138e-01   +3.524987991730651e-01   +9.532562458862195e-01   +7.568964128956280e-01   +2.320333856985396e-01   +2.883041534263378e-01   +4.553084728751251e-01   +8.538512800214046e-01   +3.705458522942725e-01   +3.399833175644889e-02   +4.658175129369453e-01; +9.018270259569254e-01   +9.062805296970785e-01   +3.268791834542041e-01   +4.238947637283835e-02   +1.854657176678883e-02   +8.252601273516335e-01   +7.486161404753493e-01   +7.723200379980886e-01   +7.162390307714892e-01   +5.981932974170288e-02   +7.945087502350894e-01   +3.185028640484440e-01   +4.052960917651666e-01   +8.322011943461617e-01   +7.956438480365806e-01   +7.462231587381059e-02; +3.702447330885031e-01   +9.770842320857037e-02   +8.794859485819884e-01   +4.776871315336695e-01   +3.276243181747009e-01   +5.928381964726384e-01   +1.269246179101207e-01   +4.437264942283833e-01   +2.351316206818586e-01   +9.761524619798585e-01   +6.510754949062326e-01   +2.779445047964956e-01   +1.060066858000819e-01   +5.183763027871957e-01   +1.333646094106026e-01   +3.394596716022574e-01; +8.832986173490535e-01   +1.794924852932529e-01   +9.992057807288777e-01   +4.786471616006867e-01   +9.462811923829542e-01   +2.129652974407710e-01   +5.987064782823750e-01   +1.663747259451617e-01   +6.990677635955942e-01   +9.703086920113240e-01   +7.106834854723999e-01   +5.815442892802015e-01   +4.037840293253067e-01   +8.029103250946494e-01   +5.824395407176564e-01   +4.944484341026528e-01; +1.257151984381344e-01   +1.731209435755701e-01   +6.838428137547784e-01   +5.464665116327159e-01   +4.009304018860600e-01   +2.940435674747880e-01   +4.357227250050393e-01   +8.071874361718609e-02   +3.064298464959670e-01   +1.372286730203493e-01   +7.653474908934718e-01   +9.116967079274582e-01   +3.408323492556372e-01   +5.724605400119435e-01   +8.599219942955262e-02   +4.896694447780666e-01; +8.903358398597727e-02   +5.322029532356605e-01   +3.471615652133002e-01   +6.507684654252904e-01   +6.322460356248037e-01   +2.682818573535347e-01   +9.610154642172499e-01   +7.418061315406111e-01   +4.674292610697424e-01   -2.377366716046271e-03   +3.853822827878698e-01   +4.520282712004879e-01   +1.142340647810235e-01   +7.148708865527449e-01   +2.273964490656119e-01   +1.299366585392113e-01; +5.465464070845417e-01   +9.791670373508533e-01   +5.602777480829538e-01   +3.464154176165831e-01   +8.568015604308822e-01   +9.272840445868081e-01   +9.659130533452732e-01   +5.419524576691451e-01   +4.436008900027488e-01   +9.352409847585390e-01   +3.613698405533753e-01   +9.786222892221151e-01   +8.506684301917495e-01   +7.317217077418434e-01   +4.511046758923242e-01   +8.256147906261352e-02; +6.105996875655734e-01   +8.431259538068511e-01   +8.923167911155786e-01   +2.548062750980838e-01   +3.746235629815260e-01   +5.526278533271928e-01   +2.413100352872431e-01   +4.842543221365774e-01   +7.355805223607468e-01   +7.391110837924695e-01   +8.131915916798531e-01   +1.082762868937544e-01   +8.914303455017536e-01   +4.530750548766228e-01   +1.811318144289632e-01   +6.728365627786578e-01; +7.277632036633196e-01   +6.723971977559425e-01   +6.482076169870283e-01   +1.778501732346393e-01   +2.034282357692588e-01   +4.315130454037184e-01   +7.690393872436362e-01   +8.930645096525458e-01   +8.765016455382231e-01   +4.319959296664707e-01   +3.868012972007980e-01   +4.166666678296468e-01   +6.880408217658768e-01   +2.810794358781014e-01   +4.162011920596461e-01   +1.212940470753741e-01; +9.920877994686751e-01   +9.723625158758846e-03   +3.771034680436490e-01   +4.789323437559839e-01   +9.106186005514330e-01   +3.293251771500593e-01   +7.128547941720660e-01   +5.840063822725668e-01   +9.131622520086361e-01   +9.430411704462767e-01   +8.732980464402812e-01   +3.868192221540804e-01   +7.430852979940987e-01   +1.539836836721091e-01   +9.646646876274065e-01   +9.885530316455925e-01];
L2I_L1I_iGABA_netcon = [+5.761935833468146e-01   +5.616243436697884e-01   +1.080454749206500e-01   +4.568679213822066e-01   +7.971807220291026e-01   +9.783763951277566e-01   +2.228426080011532e-01   +7.599517428630709e-01; +5.591951353557023e-01   +9.511576784830758e-01   +1.193958577109982e-01   +5.669428899891642e-01   +5.435218371812542e-01   +4.220938583784190e-01   +6.592854101970247e-02   +5.034479359622690e-01; +6.127735436477880e-01   +8.566562124351924e-03   +4.345635552420964e-01   +8.166486816009567e-01   +2.584613970159509e-01   +3.927558147253835e-01   +8.361787248376304e-01   +8.284046617262197e-01; +4.669256195936138e-01   +1.270768804124020e-01   +9.357393703876052e-01   +3.537175606905867e-01   +7.813232913283852e-01   +4.628666730457709e-01   +4.233567640975836e-02   +9.252841840874716e-01; +4.355709513873416e-01   +8.545374702968149e-01   +1.401701118001036e-01   +2.470071384605767e-01   +7.779145736609819e-01   +1.213781446326461e-01   +9.097052371117811e-01   +7.128448835740909e-01; +6.330476258372854e-02   +2.178494104782799e-01   +8.265024545132943e-01   +7.701215608005370e-01   +1.453821035071669e-01   +4.571751527615648e-01   +4.516369953406802e-01   +7.970920653324152e-01; +6.462349548802047e-01   +7.096407346841711e-01   +9.329748519006055e-01   +2.586346812712575e-03   +8.242327266373140e-01   +2.643154839847740e-01   +2.829702626794511e-01   +9.596603644604716e-01; +4.228079665175495e-01   +7.733711928830551e-01   +5.724538235439751e-01   +2.742984827550974e-01   +6.213042154883431e-01   +9.346406028203318e-02   +7.555321915053265e-01   +9.524589040675185e-01; +7.543628061173802e-01   +4.229087890355239e-01   +4.983384393913080e-01   +2.483319350450618e-02   +4.569560596943467e-01   +6.623325153346602e-01   +9.275370245206042e-01   +2.960985690011350e-01; +3.064383220565852e-01   +7.259407564405136e-01   +9.309771929462094e-01   +6.694591029006669e-01   +4.823219685399230e-01   +9.471712107237078e-01   +1.416857425489482e-01   +3.522975871153510e-01; +5.987501320078602e-01   +4.580750384854404e-01   +8.621707965332789e-01   +9.687206594107803e-01   +2.190871218205940e-01   +7.632277634495923e-01   +9.549128336246020e-01   +5.422072304681227e-01; +3.330271704611645e-01   +8.056470666482646e-01   +2.522539599385067e-01   +9.465303079996125e-01   +8.562020861853499e-01   +4.281167358285402e-02   +3.062425244135111e-01   +2.157035220534759e-01; +6.435007643588666e-01   +4.292683922737843e-01   +4.597958107347725e-01   +4.763768611751825e-02   +8.794614465116495e-01   +2.605535389449062e-01   +2.075679919313471e-01   +8.304840226613490e-02; +3.921241278107002e-03   +1.503432088469380e-01   +7.389267604186892e-01   +2.876464509337753e-01   +8.434217076147498e-01   +6.350213695633170e-01   +4.625926111912054e-01   +5.035307471291171e-01; +1.453919172408795e-01   +8.044474756804362e-01   +7.519755946288743e-01   +4.888630402834118e-01   +4.428333720014290e-01   +9.035050618122235e-02   +5.958530234528822e-01   +1.949158496247583e-01; +2.476942570881401e-01   +3.810159878815284e-01   +2.317877275403851e-01   +8.876115372776584e-01   +5.444814353761831e-01   +7.443151521267548e-02   +5.519133930975560e-01   +1.432795737866918e-01];
L1I_L2I_iGABA_netcon = [+6.999095014010833e-01   +8.690550753602982e-01   +6.138756891642099e-01   +5.447645161248297e-02   +1.449066270780020e-01   +2.364797062900606e-01   +8.396099338520194e-01   +3.704738405842334e-01   +7.084149798452913e-01   +3.819289316074817e-01   +2.382138740989011e-01   +6.684494907166012e-01   +1.672219282061042e-01   +5.707817099886966e-01   +4.389667643760162e-02   +4.840040490491175e-02; +5.984595217265406e-01   +7.964028672212337e-01   +6.106205681488841e-01   +5.635879708824419e-02   +7.458080201890904e-01   +5.533542403213052e-01   +1.969464831307942e-01   +5.574735919419858e-01   +1.862104368141758e-01   +7.209925900551475e-01   +5.106090250585290e-01   +3.300259625691745e-01   +1.134180470889780e-01   +8.117260352643697e-01   +4.403103211087950e-01   +9.199662355450648e-01; +1.628089756350268e-01   +6.255235673392480e-01   +3.128745071105713e-01   +5.979209700127441e-01   +9.498930312332609e-01   +1.146823591239534e-01   +6.151218674177111e-01   +8.311871135662328e-01   +2.319718097827291e-01   +6.396510121007721e-01   +7.320029259157668e-01   +5.513498879917546e-01   +7.378324104305032e-01   +6.755162804190945e-01   +9.174757796648796e-01   +1.740625836810819e-01; +4.842383540538747e-01   +4.735889780431093e-01   +1.413848735542123e-01   +6.596289265259780e-01   +2.633694106673658e-01   +8.190379550141246e-01   +1.546315485912745e-01   +7.101849703311673e-01   +9.989484289858830e-01   +9.975199776327597e-02   +7.704002795609483e-01   +5.341705967099516e-01   +2.112426083427935e-01   +4.418562397108103e-01   +8.835799989628197e-01   +7.419928867651852e-01; +2.860820400487563e-01   +1.923657054499528e-02   +6.021642719408395e-01   +4.805138028131112e-01   +9.466422678559873e-02   +6.525118959136881e-01   +5.812449345514592e-01   +1.144766931031935e-01   +9.026454995184713e-01   +4.924218373092769e-01   +6.766190755632918e-01   +9.006196595677465e-01   +4.828054699382214e-01   +8.948673112333883e-01   +9.257579878845806e-02   +4.756255524012571e-01; +4.028548784917870e-01   +1.171160406532431e-01   +8.904413872808741e-01   +9.784796056004891e-01   +2.298133022016733e-01   +2.355482788002826e-01   +5.431191311911824e-01   +7.397962092360294e-01   +8.809743653143822e-03   +5.605081247628441e-01   +8.154141233860581e-01   +2.847152181730797e-01   +5.222381802182612e-02   +7.826096202405526e-01   +6.748503794617046e-01   +2.474632728267594e-01; +4.918080775915775e-01   +7.198253035005031e-01   +5.611158417446955e-01   +8.643880213413310e-01   +8.940475682561814e-01   +3.018858147414623e-01   +6.831497264524913e-01   +9.240221575479960e-01   +8.338401996655985e-01   +5.620445660500832e-02   +4.176505971467526e-01   +1.381092248920824e-01   +5.738385222861085e-01   +5.812573428280317e-01   +6.819219483848510e-03   +6.647840917593634e-01; +8.642033519356638e-01   +6.800467554272956e-01   +6.314720681494509e-01   +9.546252577696803e-01   +1.978370178145906e-01   +3.293129994191360e-01   +6.982027865082893e-01   +9.222413097038826e-01   +2.517434208575934e-01   +8.780820658071993e-02   +4.971594826740697e-01   +9.557648791548730e-01   +4.934776533294816e-01   +6.169769880054576e-01   +1.194701150493093e-01   +6.087457588399062e-01];
L2E_L1E_iAMPA_netcon = [+3.664823391411530e-01   +5.631093494626707e-01   +2.005346218229140e-01   +5.146655966866341e-01   +2.913681820280262e-01   +7.488424041944303e-02   +2.786690269202692e-01   +2.641718743459612e-01; +4.353397306104066e-01   +1.927113441615801e-01   +1.377855075745132e-01   +6.843216644864520e-01   +6.195195641449754e-01   +5.939685741937684e-01   +9.294946417809646e-01   +9.038515377810227e-01; +7.196418431605492e-01   +6.115893390834823e-01   +8.002046391325104e-02   +2.077309439320262e-01   +8.664672647657315e-01   +7.760305358935225e-02   +7.630218987179709e-01   +1.587382279035651e-01; +1.910378967734246e-01   +7.386130674061481e-01   +9.076002949420220e-02   +9.725272925713404e-01   +8.224009737391860e-01   +3.955135803669833e-01   +2.623896551163633e-01   +5.530075587032498e-01; +3.868917047307514e-02   +8.326752190382369e-01   +5.521132135812218e-01   +3.503745214002373e-01   +2.079002920941348e-01   +5.846920175236672e-02   +2.425782485707097e-01   +4.207436749848250e-01; +3.165274698136641e-01   +2.800679840171822e-01   +7.318565651459300e-01   +1.855443840826266e-01   +7.499312879415937e-01   +1.273782635190042e-01   +1.672014948701757e-01   +5.459089973074818e-01; +7.889679112230070e-01   +6.079761069437478e-01   +5.449000430436368e-01   +2.395482849290624e-01   +1.990084789853548e-01   +2.425686469561268e-01   +2.879714070870668e-01   +7.516895429483980e-01; +4.684673781979081e-02   +5.483459320265361e-01   +5.459520628935143e-02   +2.555559559592094e-01   +5.801217875367540e-01   +9.464073337780810e-01   +5.654621421893764e-01   +1.448319395255229e-02; +2.162076778461595e-01   +2.764368647878123e-01   +6.339794750420576e-01   +2.214285663736648e-01   +8.781654458156226e-01   +2.010649699297469e-01   +4.029971394397662e-01   +3.861753900500436e-04; +2.741608544359265e-01   +3.378500145799267e-01   +9.950946036495464e-01   +3.408943302393566e-02   +7.123369577400722e-01   +3.277242084870595e-01   +9.874859499225438e-01   +2.014654168785693e-02; +7.885294785764776e-01   +5.677862077259783e-01   +9.132725002816590e-01   +3.575947128902360e-01   +7.021572107454307e-01   +8.652153642097082e-01   +5.435281482906594e-01   +3.580448779141468e-01; +9.898139248990431e-01   +7.423654877149093e-01   +7.687791710828041e-01   +8.990773653928574e-01   +4.657312967602015e-01   +9.248890712909317e-01   +9.284221242578287e-01   +4.263829303644707e-01; +9.596686551861107e-02   +7.697070983391789e-01   +1.922817895529340e-01   +1.409745655638009e-01   +5.048233107354546e-01   +2.294115014652269e-02   +9.916466212192085e-01   +5.459858840126219e-01; +1.972156553481899e-01   +3.986278628367292e-01   +3.248403160434893e-02   +9.568157027586629e-01   +7.989822656837109e-01   +3.634237604832273e-01   +8.355694987322587e-01   +4.906999743885018e-01; +1.159248451377204e-01   +1.472931819559517e-01   +3.746003667682535e-01   +9.042096676355698e-01   +9.390005786669818e-01   +5.286325594417711e-01   +1.792526621515790e-01   +9.220336952669815e-01; +6.462879216027102e-01   +2.072420275997240e-01   +5.766951159262366e-01   +4.104562526568697e-01   +7.835283472102129e-01   +4.076526559993442e-01   +3.123148370549207e-01   +4.145636614818121e-01];
L1E_L2E_iAMPA_netcon = [+4.970921249416076e-01   +4.480776655331282e-01   +6.150096528371862e-01   +4.896039701079445e-01   +2.296772676201828e-01   +7.210271220586785e-01   +6.925731139001029e-01   +6.346347007727375e-01   +5.225111810310132e-01   +2.410633505555693e-01   +8.797294758976256e-01   +1.723590078085972e-01   +1.376478657065472e-01   +2.443296457010503e-01   +1.850270044530879e-01   +2.246806652076648e-02; +8.392548430981251e-01   +3.678726523325793e-01   +1.039104203656035e-01   +6.612635237967371e-01   +8.390438905916441e-01   +3.830339690415979e-01   +9.780981084884468e-01   +6.248390753910126e-01   +6.731953330780193e-01   +7.295131317302367e-01   +6.576452408048037e-01   +3.021827394508068e-01   +2.852958850493230e-01   +7.488447341006578e-01   +1.484655260192256e-01   +2.487255734146860e-01; +1.859502263533803e-01   +3.007577824697085e-01   +7.532964051175035e-01   +1.793145809198102e-01   +7.339749291478402e-01   +3.829290082432497e-01   +7.512766842786316e-01   +4.086571712389379e-01   +7.764932339762745e-01   +1.360315941155410e-01   +5.372378688790594e-01   +1.080889620981814e-01   +7.972273206682387e-03   +9.364609377965252e-01   +1.324156907253132e-01   +9.878224246700553e-01; +3.349681360910784e-01   +2.330373812231885e-01   +5.378426780129397e-01   +4.780810671375884e-01   +4.905407622611574e-01   +7.122602579298214e-01   +5.532022353529983e-01   +4.258976749131453e-01   +4.622364356508011e-01   +4.211131125479734e-02   +2.505321195901074e-01   +4.510903134544202e-01   +3.078031466141027e-01   +3.071441231407653e-02   +1.726548409847303e-01   +6.293875543540526e-01; +6.954947914465150e-01   +1.364710189812743e-01   +4.444139376820820e-01   +4.987162897721394e-01   +8.516698509450110e-01   +8.378397389794605e-01   +2.970931727650429e-02   +5.098531484221295e-01   +9.073415426935020e-01   +6.497564578814076e-01   +1.047107360805294e-01   +5.858721938339194e-01   +9.052236031370356e-01   +4.367803122070135e-01   +9.216191571738380e-01   +3.566461673311747e-01; +6.944873701322601e-01   +1.009059217409113e-01   +7.437182196029678e-01   +5.987856941504396e-01   +7.162938848587005e-01   +6.669682387762652e-01   +1.951545466715877e-01   +2.578052140593042e-01   +2.468409967986828e-02   +2.009252555729517e-01   +9.736067725250732e-01   +2.237518785984698e-01   +2.945294134799302e-01   +8.324851749940010e-01   +2.615132850889534e-01   +9.466670412036642e-02; +3.682853763905750e-01   +2.270436219735650e-01   +3.870917636608413e-01   +2.419400389066619e-01   +5.228537014478331e-01   +6.476949159933707e-01   +9.408761353423876e-01   +4.225023813722245e-01   +4.792676707464136e-01   +9.725929904157954e-01   +5.972966449826762e-01   +1.106011520131153e-01   +8.313617611882471e-01   +9.975906093975856e-01   +2.067804489626330e-01   +4.085636310210368e-01; +3.097002778648687e-02   +3.468378687795705e-01   +5.256103791234349e-01   +5.178850703534377e-01   +9.405756868742314e-01   +5.638001085394615e-01   +3.949371691835787e-01   +5.224800548614867e-01   +2.719547408969256e-01   +8.189654307029814e-01   +8.169674157729242e-01   +5.593140464477301e-01   +7.428888116958706e-01   +9.192138798121443e-01   +6.117439228906578e-01   +9.309640266826845e-01];
L2I_L2E_iAMPA_netcon = [+6.760753452267106e-01   +6.153769921719484e-01   +4.022369039706167e-02   +7.956981386285210e-01   +5.232120153249239e-01   +8.237110695304776e-01   +6.471632687936268e-01   +3.838715768821823e-01; +2.313630924073830e-02   +9.440570335777996e-01   +5.319374507343372e-02   +9.296350235140066e-01   +5.599241780056616e-02   +1.084592119887853e-01   +4.178911745078461e-02   +1.686631953678834e-01; +7.371113664548541e-01   +9.640025760501907e-01   +4.029639877303955e-01   +9.376588328150263e-01   +2.862006034470943e-01   +2.436182339082351e-02   +5.683398786349081e-01   +4.454237467384595e-01; +2.117717704059363e-01   +3.716303114778676e-01   +9.833794419359463e-01   +1.447888591488525e-01   +7.100687415820366e-01   +1.274749685763603e-02   +3.040304672097854e-01   +8.742989600567014e-01; +8.614652252168918e-01   +7.967535482678775e-01   +7.138981517551478e-01   +3.201422833907420e-01   +8.808950739244666e-01   +3.359991030745414e-01   +2.620368524464339e-01   +4.099694569349215e-01; +1.591228130812775e-01   +7.299767884097079e-01   +9.892887356046763e-01   +4.306309540057440e-01   +3.670313196033108e-01   +6.641358134372863e-01   +7.203442107860736e-01   +1.628878581915846e-01; +6.681600780449102e-01   +9.534663514080002e-01   +6.444233367712190e-01   +7.040795473824069e-01   +5.615327222518951e-01   +5.958178343683436e-01   +3.066056182340359e-01   +6.626480054213590e-01; +9.362626331860793e-01   +1.309814844364876e-02   +5.011260332667912e-01   +6.173115686819287e-01   +8.837740769009549e-01   +8.008570223531418e-02   +8.954897719961121e-01   +9.262281036942569e-01];
L2E_L2I_iGABA_netcon = [+6.315900799593348e-02   +5.178308247015369e-01   +3.553954119992833e-01   +2.594017544826827e-01   +4.304793899322987e-02   +8.936143185847165e-01   +3.413181926937027e-01   +4.518011627564898e-01; +3.539415711112098e-01   +6.832197307505264e-02   +5.579365466295421e-01   +9.844006148240927e-01   +3.617363016125660e-01   +5.426509732344373e-01   +9.342186602868966e-01   +6.722531726302055e-01; +9.328186384142155e-01   +1.856452376239233e-01   +6.919131519158882e-01   +3.488328338329217e-01   +3.659849133677234e-02   +7.157066745932674e-01   +9.160773844109495e-01   +7.680835975546095e-01; +2.385411693164803e-01   +3.149679203642424e-01   -4.394996773915341e-03   +4.014839421413077e-01   +4.874415319737572e-01   +7.102952457401537e-01   +7.268076519307386e-01   +9.261074405332542e-01; +1.044941082827291e-01   +2.463710090715122e-01   +4.652897230297973e-02   +7.517479822558982e-01   +7.247311550515562e-01   +1.688866600200726e-01   +4.446690044222392e-01   +6.590062450321793e-01; +7.149182465025800e-01   +3.241201713065076e-01   +3.065752611654743e-01   +1.016324335943077e-01   +1.427939169101419e-02   +3.529874400876063e-01   +1.543359180047704e-01   +4.999905076096081e-01; +5.987855417049870e-03   +8.788782869354287e-01   +8.682987353560857e-01   +5.912163793876367e-01   +5.154012071343259e-01   +3.813705173604635e-01   +8.340048690131591e-01   +3.445776914844030e-01; +1.834092800904190e-01   +2.988089225223948e-01   +6.272481362978732e-01   +1.238480335111459e-01   +2.407619942765744e-01   +7.573368262114261e-01   +2.561270831138461e-01   +9.473784856883510e-01];
L3E_L2E_iAMPA_netcon = [+8.133707861132305e-02   +1.515143056469516e-02   +3.693860310501889e-01   +4.950233331756620e-01   +1.786018445376503e-02   +9.559140787378616e-01   +3.602882129317207e-01   +1.488320936772347e-02   +2.039357103079268e-01   +6.115941091104916e-02   +2.421861961870457e-01   +1.000000000000000e+00; +9.546458277313629e-01   +9.782140583553807e-01   +1.147450937006337e-01   +6.629120945547080e-02   +8.081756125142820e-01   +3.873238822056830e-01   +2.250333720188586e-01   +1.208804590638074e-01   +3.567031136910910e-01   +7.401508500102570e-01   +5.346833214650929e-01   +3.460032920781166e-01; +6.640068378738344e-01   +7.252976766592973e-01   +5.137723857015547e-01   +8.632222970322310e-01   +7.963608765127501e-01   +6.658783187862845e-01   +7.238776926364849e-01   +6.697815705506153e-01   +8.896534572430526e-01   +9.902275455277196e-01   +3.349678766569958e-01   +8.256243324800587e-01; +1.699972652276973e-01   +8.729524097398166e-01   +5.809818062476061e-03   +9.972904789344033e-01   +4.223665389999588e-01   +5.835653203196511e-01   +7.747280856862968e-01   +5.090716159172056e-01   +8.133509496206626e-01   +7.700666192020575e-01   +6.750323602364581e-01   +1.117340777493968e-01; +1.967296484781624e-01   +8.167647120577186e-01   +8.726671825264484e-01   +1.238440571257901e-01   +6.316110870610082e-01   +5.817938741257198e-02   +3.433052413539798e-01   +7.347755866994547e-02   +3.186448594741170e-01   +8.834904278696922e-01   +8.742118109520546e-01   +7.767915087596826e-01; +9.975106483239595e-01   +3.172453966177054e-02   +9.049672766179097e-01   +9.998107250612338e-02   +5.703178653021705e-01   +7.459624867349979e-02   +5.779366226328940e-01   +5.383581803223726e-01   +5.989077838038696e-01   +3.578304719715877e-02   +9.865468054884196e-01   +1.505344238614200e-01; +9.275367357201757e-01   +9.527868110956941e-02   +1.127985187856258e-01   +1.479219283516778e-01   +8.988858581864718e-01   +2.279627195303063e-01   +6.441326700122860e-01   +6.780235425064352e-01   +6.982143606646692e-01   +7.940263262785728e-01   +1.424374964398243e-01   +7.311993753661360e-01; +9.822857586325634e-01   +8.858864115408613e-02   +4.583789537855567e-02   +1.264583201433257e-01   +7.482199588309091e-01   +4.201057607249032e-01   +3.676189249364577e-01   +5.883872458341598e-01   +1.776201201898251e-01   +7.058878358260935e-01   +8.784932437035403e-01   +1.101594866736912e-01];
L3I_L2I_iGABA_netcon = [+7.671541311215732e-01   +5.370502647310494e-01   +5.986705179402488e-01   +3.067029194557325e-01   +9.656558052302313e-01   +1.157328801883916e-01   +2.981814136969874e-01   +7.946312775734049e-01   +9.157856096348951e-01   +9.940444081900638e-01   +3.100046743026894e-01   +9.961914302644713e-01; +6.395125695524593e-01   +4.517183267775326e-01   +5.635655648333243e-01   +7.617243599961901e-01   +5.441929321712686e-01   +6.840300361447765e-02   +1.689545959388713e-01   +5.311484773794489e-02   +3.883968375398928e-01   +2.878159447011111e-01   +4.438951906572844e-01   +9.135076151522072e-01; +7.967932426224416e-01   +1.133808220174130e-01   +6.981242618120334e-02   +6.486330086211306e-01   +9.793296259977694e-01   +5.098969671065362e-02   +7.241721477247446e-01   +1.798059409645521e-01   +7.505749366030070e-01   +5.179971281033920e-01   +2.106280865032524e-01   +6.897909784362459e-01; +9.630237304149882e-01   +7.214174468636623e-01   +7.685489223741271e-01   +3.336112821662410e-01   +1.244685444563484e-01   +1.291154983576466e-01   +3.011290214342563e-01   +2.446633228937420e-01   +8.817629121305027e-01   +3.584961172627457e-01   +9.404193766627388e-01   +2.200868714449787e-01; +7.170106108155494e-01   +1.866242207096211e-01   +8.653259382430656e-01   +9.731546719420344e-01   +1.658247491379072e-01   +4.905411659782787e-01   +6.757375144422508e-01   +2.600076152021720e-01   +3.930705670086906e-01   +5.188375177008606e-01   +2.893891692840324e-01   +3.137091727177450e-01; +6.416165217232853e-01   +3.235111390266377e-01   +7.086577812379801e-01   +5.343657083212521e-01   +3.347763056158584e-01   +4.671558087702978e-01   +7.453008220389620e-01   +6.496925378320060e-01   +1.670467076082722e-01   +5.019350810858556e-01   +1.236296347235809e-01   +2.360131574777677e-01; +5.115691042649414e-01   +9.666273977191002e-01   +1.065437241845099e-01   +7.528041607205571e-01   +5.320433784344124e-01   +1.587872453326484e-01   +7.457612320240302e-01   +9.607223509215668e-02   +4.377624724422289e-01   +1.868835633962551e-01   +6.988675133275442e-02   +7.068825052539029e-01; +9.507091618325237e-01   +6.990630934415981e-01   +6.653616020413562e-01   +2.680910648099668e-01   +6.922114256266436e-01   +1.361076574146931e-01   +7.819314114827511e-01   +4.683958969442917e-01   +8.578337258303558e-01   +4.808115397615034e-01   +7.302565032861186e-01   +3.751117453209270e-01];
L2E_L3E_iAMPA_netcon = [+6.573067880925980e-01   +3.880041268987925e-01   +2.358159473072721e-01   +4.661685961335306e-01   +9.019895128812906e-01   +9.517898577236491e-01   +7.639662132145332e-01   +3.535323951058502e-01; +3.823747849248171e-01   +2.184654101211691e-02   +9.041162988643862e-01   +2.865762384820327e-01   +6.804711890720962e-01   +2.436377120476065e-02   +9.024287389798384e-01   +6.623841061532157e-01; +3.067693308052277e-01   +3.290594869428494e-01   +4.860350864628324e-01   +2.772058163582085e-01   +8.423225052774637e-01   +4.998411462152775e-01   +7.936881200294290e-01   +5.930750228920766e-01; +1.572062276295644e-01   +4.874655748348616e-01   +5.956357211509923e-01   +1.423759420212996e-01   +9.767846889458870e-02   +3.402381579978211e-01   +9.544468040719734e-01   +5.621018482244250e-02; +7.774899793598237e-01   +2.634823254025572e-01   +9.559180292560633e-01   +1.418954044039668e-01   +7.355531374552646e-01   +6.730068582158160e-01   +5.331833027189209e-01   +2.160663974362497e-01; +7.105960567582857e-01   +5.261993447038533e-01   +8.454444780355767e-02   +2.628917192163432e-01   +5.422347698216817e-01   +1.683309455288592e-01   +1.618665907631280e-01   +6.013635697378271e-01; +1.735939508473980e-01   +4.137191539119154e-01   +2.222855897030097e-01   +6.088342059409334e-01   +2.554639356617812e-01   +2.272389737701941e-01   +1.340062675645401e-01   +2.688367747928360e-01; +4.489293262475110e-01   -2.059938496767511e-03   +1.549632222482296e-01   +1.050720316320582e-01   +7.133006206031777e-01   +1.168920720591723e-01   +3.176939097120256e-02   +1.102964741714501e-01; +8.390739182845037e-01   +8.934222598301611e-01   +3.916483883721131e-01   +4.833212797615740e-01   +3.592758846676957e-01   +9.926088496731312e-01   +6.838745318259907e-01   +2.121377610483639e-01; +7.007534193164225e-01   +2.380058531146690e-01   +1.862487090879831e-01   +8.937315329539330e-01   +8.528259632762081e-01   +1.382238325229475e-01   +5.885643819233989e-01   +8.752211836934377e-01; +7.629577816774024e-01   +7.946339311296402e-01   +7.648390524735117e-01   +1.889607477036876e-01   +8.198037704186443e-01   +7.691153435224002e-01   +2.964154510315151e-01   +4.608941475691386e-01; +9.809894774647018e-01   +5.764664374851844e-01   +2.291187273386250e-01   +5.191142173463950e-02   +6.121847294643554e-01   +6.313322064088976e-01   +7.574406508988198e-02   +7.288210556061190e-01];
L2I_L3I_iGABA_netcon = [+5.895647305059709e-01   +1.462517278867470e-01   +3.463065837804440e-01   +3.713847765522828e-01   +5.973792980595647e-01   +5.056393883042787e-01   +7.727749689990592e-01   +2.641487026313704e-01; +8.447941650442176e-01   +9.881674113664300e-01   +4.535697474403468e-02   +5.350765561191361e-01   +4.768655629061427e-01   +2.376670470846191e-01   +1.785246493831714e-01   +5.861813359108060e-01; +6.038653835059018e-01   +4.793651109585120e-01   +9.430850393318788e-01   +9.727153215425051e-01   +3.780793542530727e-01   +2.729635636646660e-01   +4.547653561123872e-01   +6.803983060151381e-01; +7.448990376175851e-01   +3.489989788099229e-02   +8.662845010227543e-01   +9.983203318437467e-01   +9.802699468780017e-01   +4.071623828608128e-01   +3.040437786053984e-01   +4.167837612156274e-01; +8.492184332468264e-01   +2.700425071655999e-01   +1.354214592872811e-01   +4.148319967604336e-01   +1.379503550226192e-01   +2.597827286954423e-01   +3.873322190767628e-01   +5.104551470419838e-01; +1.440075422519666e-01   +6.748346495687253e-01   +5.920343536449000e-01   +4.482149819737733e-01   +2.713637936161233e-01   +8.552299991021336e-01   +8.013952515627490e-01   +8.133865610217267e-01; +7.434039652025726e-01   +1.465764717525019e-01   +6.353520641371600e-02   +2.520739527504279e-01   +2.262939046166745e-01   +4.789679502565495e-01   +7.776031099658025e-01   +5.430779135088390e-01; +1.530027745963339e-02   +7.723273961634127e-01   +9.487905223760127e-01   +5.980449206427765e-01   +7.945964590894394e-01   +3.426936503591315e-01   +6.478296379224998e-01   +5.905797639705886e-01; +2.276809750996028e-01   +2.684621222642206e-01   +4.985385775387248e-01   +7.612158645922078e-02   +8.179375630391562e-01   +6.383490225675095e-01   +2.419087670480637e-01   +5.362251147652816e-01; +5.367688423879629e-01   +8.804656744754393e-01   +2.822658859555319e-02   +9.115205223708074e-01   +7.945267898433130e-01   +4.156648921030924e-01   +6.068979307558533e-01   +5.389972604039017e-01; +7.208082015732730e-01   +3.702240270774181e-01   +5.852531154089817e-02   +4.747065535427786e-01   +1.120123725804101e-01   +5.463623744754161e-01   +4.193164797860312e-01   +1.504329215986483e-01; +4.333900652635930e-01   +1.090532693627862e-02   +2.998592256145934e-01   +5.082119612782290e-01   +6.322181461564063e-01   +3.398293056931154e-01   +2.964571628400973e-01   +7.038431372994182e-01];
L3I_L3E_iAMPA_netcon = [+6.443811747105663e-02   +7.731376030988421e-01   +5.514840532716290e-01   +5.719479892537831e-01   +9.193602355638456e-01   +8.354606503151549e-01   +8.497142879631905e-01   +8.614361573769408e-01   +5.332199984020090e-01   +9.877601895563096e-01   +4.822341196414197e-01   +3.504289248066231e-01; +9.229898869178303e-01   +8.388198407147356e-01   +8.431570329672265e-01   +9.368006552474806e-01   +5.928340963310151e-01   +3.943942032924016e-01   +6.284952160975312e-01   +8.575504691163847e-01   +5.670163063075990e-01   +6.997332718688143e-01   +7.391045701902601e-01   +4.000539288242177e-01; +1.812220196355175e-01   +5.925064757821482e-01   +9.698271631803305e-01   +7.805467810059624e-01   +5.746735067478057e-01   +6.971927465010656e-02   +4.447508584698637e-01   +9.490424357600701e-01   +9.809000539671181e-01   +8.426576425272794e-01   +5.945849113992248e-01   +9.890819994034186e-01; +5.421595846078765e-01   +7.652083111674065e-01   +4.658218768017324e-01   +5.961821523220366e-01   +6.567815309206314e-01   +3.731945810262624e-01   +2.365699149355554e-01   +6.942806600237316e-01   +9.674669202066621e-01   +7.399642577293725e-01   +2.624828084815061e-01   +2.976560107338847e-01; +3.988881186095041e-01   +6.582162678295425e-01   +7.757786260573865e-01   +5.811337226388084e-02   +4.347957895537976e-01   +8.485993772633300e-01   +5.184514887307586e-02   +3.646453252544757e-01   +5.591225167008681e-01   +9.959378447179987e-01   +6.068309729637134e-01   +2.264769550101370e-01; +9.838643830654461e-03   +5.870248554652490e-01   +2.372903190163555e-02   +5.439391797576711e-01   +9.348210379338553e-01   +2.712806116986379e-02   +7.108750020612610e-01   +3.732996924776006e-01   +5.297492621235756e-01   +5.049597024499667e-01   +2.315061381081086e-01   +3.297209386747082e-01; +1.038133064609117e-01   +2.448495819889405e-02   +6.760076678915956e-01   +8.643482882204898e-01   +1.039937387226132e-01   +4.236452970219250e-01   +8.471685276587517e-01   +8.403271842076407e-01   +4.805722903434920e-01   +1.903955300054055e-01   +1.942818125326451e-01   +1.631857031590939e-01; +8.565204815153377e-01   +6.917125991156775e-01   +8.349131238420774e-01   +3.376725843750092e-01   +4.080073840690938e-01   +2.544556131967583e-01   +4.041317732955915e-01   +3.862069672240126e-01   +9.022154803048331e-01   +9.594479151108006e-01   +3.784295820144688e-03   +3.830280723810103e-01; +3.376486151098135e-01   +3.266956513136719e-01   +6.847421205039164e-01   +1.798625737544209e-01   +8.938147782183188e-01   +7.417797279184309e-02   +2.872606785724339e-01   +7.708907561089650e-01   +4.827195996742212e-01   +4.510402648135010e-01   +6.476784177034854e-01   +5.244728318728924e-01; +1.510209822780844e-01   +7.669413534444769e-02   +8.971587081460684e-01   +8.802567739901536e-01   +7.384169776427847e-01   +9.193687236055231e-01   +2.615732841024100e-01   +7.748783593145986e-01   +4.854842669727475e-01   +6.058118401986478e-01   +3.982012383341454e-01   +5.940692477711051e-01; +8.071740215108715e-01   +7.437043915766074e-01   +9.422084079150045e-02   +8.425542203785998e-01   +9.604844544462017e-01   +2.678613618608400e-01   +5.073077999888690e-01   +4.326440271713022e-01   +3.137423632535772e-01   +6.465465231744989e-01   +2.715603137195896e-01   +1.697105609983524e-01; +6.533690128873926e-01   +9.663214002985381e-01   +7.233252938385025e-02   +8.333417413061900e-01   +9.719953797588713e-01   +1.023819778985866e-01   +1.166965312220470e-01   +4.885451887235392e-01   +8.577668650215510e-01   +7.634965803851398e-01   +3.692157016121848e-03   +7.260549994315822e-02];
L3E_L3I_iGABA_netcon = [+4.397782704624608e-01   +7.011370133794299e-02   +5.144744214766122e-03   +4.935530039514717e-01   +5.442863677009772e-01   +2.530189503509185e-01   +7.174581738043087e-01   +7.634761119758695e-01   +3.773710805857307e-01   +4.472825046680007e-01   +2.023501510741993e-01   +6.495025844200074e-01; +5.879205790880242e-02   +8.085272299777470e-01   +1.308272047553280e-01   +1.942962526608686e-01   +2.118309920980090e-01   +3.342538563333604e-01   +2.217058428818453e-01   +8.875713292384849e-01   +6.091659105538402e-01   +3.949117375758461e-01   +8.282902266101828e-01   +8.973791654572792e-01; +6.251432747958624e-01   +9.094754955722255e-01   +3.102756012192865e-01   +6.424143390719492e-01   +2.722039775371420e-01   +5.924254216161620e-01   +4.982608150484348e-01   +7.311335850071493e-01   +1.695200411177850e-01   +6.701437567265587e-01   +4.461964782133805e-01   +8.365782855609053e-01; +7.985506457796661e-01   +4.269786297341608e-01   +2.377488524359331e-01   +2.547057244667769e-01   +1.330947330442224e-01   +4.838775635362402e-01   +4.731445893523695e-01   +6.952407628359527e-01   +1.043014226155751e-01   +3.212949016338376e-02   +4.282927887466138e-02   +1.691590931856208e-01; +4.011057098001420e-01   +1.863283854044978e-01   +6.492951232593034e-01   +9.492606923221475e-01   +1.661596887624794e-02   +8.983090968701015e-01   +4.309355042718696e-01   +6.457823365143415e-01   +6.244194113699442e-01   +7.877336102621725e-01   +7.669914271547879e-01   +1.614435450474879e-01; +8.824187221770807e-01   +1.817269926103802e-01   +8.050995891132604e-01   +2.894171358116495e-01   +1.468708711031191e-02   +2.946981958268790e-01   +5.555170276841727e-01   +6.178947042364366e-01   +9.530633294988955e-01   +3.766497341357714e-01   +9.927945580604737e-02   +1.346660431002613e-01; +7.231350953485456e-01   +6.703611730440457e-01   +7.397445132676357e-01   +1.478782258337120e-01   +9.801616402865505e-01   +7.820023942468751e-02   +2.061455859258855e-01   +7.957156698314062e-02   +6.657040391487367e-01   +6.485170373452892e-01   +6.511090757419248e-01   +1.581103331296438e-01; +1.982088756563054e-01   +5.249567610016764e-01   +1.226577383043643e-01   +8.694746237369397e-01   +6.450499522955001e-01   +3.917637701101286e-01   +2.753930924528985e-01   +5.471197060324474e-01   +4.729005287723732e-01   +4.956636087910146e-01   +2.720454811863726e-01   +3.959323500920892e-01; +3.736560845632432e-01   +7.764366514897028e-01   +1.715011526656313e-01   +8.854240069140501e-01   +8.150262121938605e-01   +1.974599521892305e-01   +8.132344712390310e-01   +8.828588634465081e-01   +3.413762874799371e-01   +2.152321186847840e-01   +4.383768091448437e-01   +6.659060190017858e-01; +2.113002148218404e-01   +3.006266286196113e-01   +2.718429640346716e-01   +6.669670100661954e-01   +2.767717922763835e-01   +7.228469735728051e-01   +9.582461101526785e-02   +9.852935010033611e-01   +5.923831883970126e-01   +2.151985847030916e-01   +8.468390033982824e-01   +2.232535613015320e-01; +2.606294717744393e-01   +4.747062065450424e-01   +8.134063651825215e-01   +9.999370920265261e-01   +1.161392273213967e-02   +4.199439039605763e-01   +3.061344041933312e-02   +7.272403776816208e-02   +5.454937988931365e-01   +4.505675869288868e-01   +9.016667420252424e-01   +6.432551679766957e-01; +9.911084613790412e-01   +7.088392042277327e-01   +5.898504546744153e-01   +2.666960379628642e-01   +1.012147448026542e-01   +2.658573983018575e-01   +6.535851922338760e-02   +3.208320840318519e-02   +4.144999894420945e-02   +6.302273443480697e-01   +2.829909610055079e-01   +6.112492915089132e-01];
L2E_Input1_iAMPA_netcon = [+9.955121119448650e-01   +9.909707771615032e-01   +9.966201747854901e-01   +9.858634195547620e-01   +9.880494360468092e-01   +9.968450012690363e-01   +9.826612907467569e-01   +9.966838749161978e-01];
L2I_Input2_iAMPA_netcon = [+9.926686806239030e-01   +9.975548078583379e-01   +9.867648591235437e-01   +9.923645490841257e-01   +9.904442013486999e-01   +9.892673977524595e-01   +9.982405578747017e-01   +9.953655483994770e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
