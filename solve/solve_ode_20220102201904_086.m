function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.966087993251992e-02   -4.064439071061369e-01   +5.736503896315056e-01   +3.191806941886950e-01   +1.275841908546214e-01   +2.647521505336620e-01   -6.406251310027666e-01   +1.611437485484868e-01   +4.984515453886521e-01   +7.155809753368741e-01   +5.120159076093710e-02   +5.893423697997106e-01   +2.508696668735401e-01   -1.034824430051306e-01   -3.353229570078055e-01   +9.880762037678059e-02; +3.506503468940982e-01   +2.404040848404460e-01   +1.542510711354730e-01   +1.072456083639069e-01   -1.410627229852539e-01   +5.334027965158057e-01   -6.282355185410459e-01   +1.465172318339431e-01   +7.001549847091767e-01   +2.136426999992366e-01   +1.000000000000000e+00   +6.143352900376716e-01   +2.725220481752852e-01   -2.619358206680195e-01   -5.690832561124865e-02   -3.674423967378312e-02; +5.697328504853441e-01   +2.830796648434164e-01   -2.267454680518338e-01   +2.067389463448516e-01   +2.160548926538215e-01   +1.101549193400315e-01   +3.140296459513593e-01   +1.111103437326475e-01   +3.959287262827631e-01   +2.026897772318456e-01   +4.645326076366268e-01   +1.732983086504817e-01   +2.224466234381515e-01   -3.214821946539643e-01   -1.276333360723250e-01   +2.492201038232798e-01; -1.854052764553901e-02   -1.663595771581080e-01   -1.747667735637999e-01   +3.949802016731557e-01   -2.096619088782531e-01   +2.442967150973612e-01   +5.177756361111188e-01   +6.521795255254255e-01   +6.679295232139885e-01   +3.540061912105433e-02   +5.856532335474958e-01   +3.926902866925933e-01   +1.489389757759522e-01   +4.287440530893864e-01   -1.503323936771322e-02   +7.562344315152685e-01; +4.030957269996870e-01   +1.953942978639498e-01   +4.579962484768381e-01   +7.309711592839654e-01   +5.291949493852958e-02   +1.674137854050639e-01   +1.682474269749874e-01   +2.906411265497195e-01   -4.667709153798823e-02   +3.895160613024527e-01   +5.393306060409468e-01   -2.553644924596153e-01   +1.696607666468992e-01   +1.184906986356966e-01   +4.794703298323726e-01   +2.815750533821773e-01; +7.723019198700623e-02   +4.759832845354698e-01   +1.085297461136901e-01   -3.380077796254388e-02   +7.424977435956051e-01   +3.673548885825096e-02   +4.751318238189660e-01   +3.327222867694065e-01   +3.227160265587332e-01   +4.028081322146357e-01   +1.137868032347374e-01   -2.980002604103451e-01   +1.171478292412524e-01   +2.011911250736033e-01   -3.258152352258410e-01   -1.746833150870906e-02; +3.965484318142389e-01   +3.789233912563670e-01   +4.157944854721751e-01   +2.187526278514882e-01   +1.364164776373446e-01   +3.694005397124407e-01   +3.668362310949297e-01   +2.181401619884859e-01   -8.337750711549859e-02   +1.267494891383200e-01   -1.675493642426530e-01   +2.569829031824800e-01   +3.107159654038023e-01   +1.593128684456590e-01   +3.286479177408198e-01   +4.729000801331345e-01; +3.563079668649074e-01   -1.893747961062388e-02   -1.699008037166114e-01   +6.046583677202798e-01   +2.635822554775738e-02   +1.546314717232911e-01   +1.846601053444259e-02   +6.419430699486222e-01   +4.544894369363510e-01   +2.820830506445762e-01   +2.718753178069095e-01   +2.246040707939549e-01   -1.240010194383256e-01   +2.177020397511563e-01   -1.573505809902132e-01   +2.645096818124221e-01; +1.647234276791300e-01   +3.417976437480368e-01   -2.932487074232021e-01   +4.729394060250594e-01   +3.782032444919463e-01   +4.271354606052302e-01   +1.050182506625542e-01   -5.244162788063885e-01   +2.016275664473439e-01   -5.463684656617021e-02   +6.543549927338220e-01   -2.372586570127670e-01   +3.494807426427928e-01   +4.344222066045914e-01   -1.376867450261273e-01   +2.587542476177407e-01; +6.123912647322215e-02   +5.479710697574183e-01   +4.489411850970725e-01   +2.401181313686948e-01   +9.512710431966688e-02   -8.045793736356481e-02   +5.239873262635053e-01   -1.266933081191089e-01   +1.772696859927272e-01   +2.057437170990841e-02   +3.263971067911639e-01   +7.939984395839794e-02   +5.974976299658141e-01   -2.201373208995447e-01   +9.456989560835309e-02   +3.528591439043621e-01; +9.401319160904473e-02   +5.863015975032433e-01   -7.063738951808816e-03   +1.960547805157253e-01   +5.884219712093577e-01   +2.210948253712019e-01   +5.545708532144245e-01   +3.014023355818473e-02   +2.304259889911008e-02   +3.748770941909708e-01   -3.717775017226033e-01   +3.140830505230572e-01   -3.587858101343817e-01   +5.592683440475140e-01   +5.172925496493984e-01   +4.158818192940487e-01; +3.254960594211877e-01   +2.756927828428525e-01   +1.709237974550639e-01   -1.779576820397379e-01   +2.972201858235427e-01   +2.052884939944846e-01   +2.673329859843905e-01   +3.575754029717117e-01   +7.116760942874590e-01   +9.329445186529516e-02   +3.722387780565973e-01   +3.401977547070460e-01   +5.466796812976825e-01   +1.632266934190425e-01   -3.916376826892464e-01   +2.443327301846306e-01; +1.794391954992628e-01   +3.089154891765626e-01   +5.977986960240083e-01   +1.894553145599850e-01   +4.505096034406411e-01   +4.613305032102620e-01   +1.600403791813642e-01   +4.311735463984533e-01   +6.864097677389395e-01   +1.189262164410727e-01   +8.155434798788026e-02   +4.762459530927227e-01   -7.507275828594498e-02   -2.749372854468960e-02   +1.567862340385014e-01   -6.181045970274187e-03; -7.114862254754925e-02   +1.696311523967630e-01   +2.998893232218390e-01   -6.956255883828379e-01   +5.723742292861462e-04   +6.844596209663775e-01   +5.910914911388073e-02   +3.774726741403909e-01   -2.036575247896386e-01   +1.585691168218658e-02   +4.158333036433510e-01   +9.375316530450145e-02   +4.151053096485681e-01   +4.686287010659517e-01   -7.279525721499909e-02   +3.629031529940616e-02; +4.664247849508358e-01   -3.868189150847321e-01   +4.329608346131902e-01   +3.612482113249313e-01   -4.053943854832245e-01   -8.899692502777624e-03   +3.650693883258208e-01   -7.803217730500792e-02   +1.371645570850145e-01   +1.438150221113835e-01   -1.856511325283751e-01   +2.558662577603510e-01   +2.476474844275493e-01   +8.144211732237799e-02   +1.557544264550807e-01   -2.613274990471285e-01; -3.978268115404854e-01   +5.544130532429654e-01   -3.261902229369344e-02   +4.007492628479098e-01   +9.027999479683553e-01   +8.473813452231649e-01   +5.498452319249029e-02   +7.960874684184371e-01   -2.281881379713869e-01   +4.943266118389069e-01   +2.711412861823452e-01   +4.118000527276687e-01   +4.523545157575881e-01   +5.024364521619052e-01   +7.100690351685999e-01   +3.904986499475071e-02];
L1E_L1I_iGABA_netcon = [+1.025202836608220e-01   +1.943543010438815e-01   -5.483706295393476e-02   -9.402823737600702e-02   +6.189497054178043e-01   -5.574222384567078e-02   +9.970564936545112e-02   +2.396252999311606e-01   -8.529065237176703e-02   -7.304665010157972e-02   +3.478821547274727e-01   +3.706001963332951e-01   +7.253558469712676e-01   -5.292837855562453e-01   -2.636851656868664e-01   +7.900851723061408e-01; -3.508761245360819e-01   -1.093319238716055e-01   +4.751299852436231e-01   -3.214556115498966e-01   +1.246939585462738e-01   -3.695096273403048e-01   +4.000994288335981e-01   +3.742558475127387e-01   +5.342827993905714e-01   +2.035220316301047e-01   +5.695945712581824e-01   +1.015606094674778e-01   +6.896394173800506e-01   +2.840190402184862e-01   +1.940013891212060e-01   -7.063564625097532e-02; +1.451435625460343e-01   +7.146102561359981e-02   -1.213637761018310e-01   +4.901075578842278e-01   +1.272411749341799e-01   -1.990842279957536e-01   +2.706313163239060e-01   +1.225458257538031e-02   -5.120764757970301e-03   +8.833213892044934e-01   -7.021620774840784e-02   +2.961047462813276e-01   +8.405210055296834e-02   -6.195024334746996e-02   +5.346109245561733e-01   +3.465164749809423e-01; +5.149335716905420e-01   -1.279705514275113e-01   -5.797887171939187e-02   +4.021263030979769e-01   +1.160215797094590e-01   +3.816582145158902e-01   +1.392739541911258e-01   -1.090354671802793e-01   +5.662959226342697e-02   +1.309563838789549e-01   +3.357851730695740e-01   +5.316325424007990e-01   +9.374973113943016e-02   +4.022940208296018e-01   -1.308570135590485e-02   -3.751987789467842e-01; +1.542433536470832e-01   -3.276209938149295e-02   -7.426709043169519e-02   +3.784760703353333e-01   +2.029885612030845e-01   -1.366866910628431e-01   +1.147974391723828e-01   -2.723877368997249e-01   -3.020580263838491e-02   +2.376387935002432e-01   -3.012076088935804e-01   +6.305417503230348e-01   +1.213150907343126e-01   +1.255978708996217e-01   +1.108460993472332e-01   +3.864111582567640e-01; +2.376443995751129e-01   +2.381655945024619e-01   +7.950342187722458e-02   -9.213462962246284e-02   -8.000152234928955e-03   +7.316122863995673e-01   +1.270981354971150e-01   -4.445166777015004e-01   -2.015120754759378e-01   +3.150373187065981e-01   -2.262942700055318e-01   +3.509345177601636e-01   +6.537024481149012e-02   -2.101177838865730e-01   +4.374844576863400e-01   +2.304744178374179e-01; +1.185812124183055e-02   +9.388273394199614e-02   -1.708402125148643e-01   -2.302037673592243e-01   +5.888904054237771e-01   +3.466992100659860e-01   +6.092645783332672e-02   -2.091477987198685e-01   +1.208998062153143e-01   +2.991771087916969e-01   +4.901860189881486e-01   +4.573418959297356e-01   +4.390961783689569e-02   +6.494389686496214e-02   +8.988613565894678e-01   -2.969865640905928e-01; +9.213692491386205e-02   +3.035752425642649e-01   +3.432130383752219e-03   +1.488123234593910e-01   +8.551740016114687e-02   -2.972371500718969e-01   +5.035910959138189e-01   -1.307845590715028e-01   +6.551894974199951e-01   +1.561492875364325e-01   +1.193267880392601e-01   -3.907703456912791e-01   +1.755501792436073e-01   +3.144421093131945e-01   +3.441185995983750e-01   +2.500230883279823e-01; +7.378255786765452e-01   +8.501500489518800e-01   +3.609155206513662e-01   -7.141542147629254e-02   -3.339916732484077e-01   +3.054265917925961e-01   +2.082844410214401e-01   -4.704950423097971e-01   +2.555327591556332e-01   -3.829919153385804e-02   +2.710092916514730e-01   -3.318909210328742e-02   +5.251234155988005e-02   -1.504043796301167e-01   +8.038173999500974e-01   -7.067476344662812e-02; +2.866284338181145e-01   +5.141789837788117e-01   -1.404749286257089e-02   -4.042339346881892e-02   -2.685130790879240e-01   +6.936611478530783e-02   +3.115115723613032e-01   +2.216891824495116e-01   +3.323817639741796e-01   +2.450519669678627e-01   -5.528672296737177e-01   -2.451569251148668e-01   +3.564366616643273e-01   +6.129388039532401e-01   +3.489362044108046e-01   +2.562530482897811e-01; +3.094874475441652e-01   +2.886144010668301e-01   +3.706208972578023e-01   +3.772695449841727e-01   +2.309454973478360e-01   -2.028895449886895e-02   +3.915566997200695e-02   -5.206686946368957e-02   +3.695050573142563e-01   +5.916861416585123e-02   +6.878083485317471e-02   +7.164528828481955e-01   +7.887444554007919e-01   +2.008002708827626e-01   -5.202719285186375e-02   -3.568638736475377e-01; +2.664351327858037e-01   +3.581828926905485e-01   -7.758656563901226e-02   -4.186481493563067e-01   -8.821080359235314e-02   +1.674185811029007e-01   +8.985513068014220e-02   +5.367695694662500e-01   -2.533417497129953e-01   -1.813513994583160e-01   +3.397348874886041e-01   +3.009195793842021e-01   -1.909497434335852e-01   +1.070194807496340e-01   +4.366707683519361e-01   +4.601222827622935e-01; +2.839512855846065e-01   +2.537761720773301e-01   +6.376650128836900e-02   +6.258052659201496e-01   -1.660312930978844e-01   +4.205764597256245e-01   +3.447156401515488e-02   +3.377293354131119e-01   +4.097403286366561e-01   -3.052123406711102e-01   +7.363106525560698e-02   +1.958509875087529e-01   +3.209620820642561e-01   +2.911613674904125e-01   +6.028814429883934e-01   +2.897059064560098e-01; +5.804608001007772e-01   +1.337662848531226e-01   -9.694245951087022e-02   +1.987472018639853e-01   +6.310343828681594e-02   -2.457613377574431e-01   +2.193874183346339e-01   +3.763608215245045e-01   +2.799709235136679e-01   -1.044163058991729e-01   +4.335147033332944e-01   -1.249341745256932e-01   +1.676008305111147e-01   -7.739104975440632e-02   +1.564116918654640e-01   -4.536115816858074e-01; +4.546566219700398e-01   +3.698191644568121e-03   +1.265611294481776e-01   +1.103618904816191e-02   +1.489156529004754e-01   +2.027922452557364e-01   +4.556409529384608e-01   -9.896189529448723e-02   +5.224382999006061e-01   +5.212868171619556e-02   +2.385368423650727e-01   +1.437453203442406e-01   +2.188979920157867e-01   -2.608741069103833e-01   +6.163962108727683e-01   +5.685898072785085e-01; -4.483038605517215e-01   +2.066677836468200e-01   +1.070788014807803e-01   +1.805906541663553e-02   +6.485503442966173e-02   +4.721121350398870e-01   +7.497575641732060e-02   +1.154893727365521e-01   -6.120088408200643e-02   +2.864542164754845e-01   +7.241892068010181e-02   +2.206847744605127e-01   +1.692287730933025e-01   +2.237361545847588e-01   -2.798686470087661e-01   +5.595766749939993e-01];
L2I_L1I_iGABA_netcon = [-9.937411397826439e-02   -1.800706249306564e-01   +1.378811996525181e-01   +5.162460011105475e-01   -1.662418392955965e-01   +6.035197746516065e-02   +2.453383770626199e-01   -3.697028524034182e-01; +4.362560600774952e-01   +6.163382276868118e-01   -1.646244048811619e-01   +1.476168905686059e-01   +3.560516824746301e-01   +6.309706748045122e-01   +2.255197723774113e-01   -2.159328710147139e-01; +5.422856291136412e-01   +3.679095030199722e-01   +2.365711577508811e-02   +3.914981029835097e-01   +3.981841959314572e-01   +2.771067025306981e-01   -7.260362788754794e-02   -1.600555300498400e-02; +6.796182554227063e-01   +4.976683864250019e-02   +4.425324871359420e-01   -9.053815237063637e-02   +4.661923500683111e-01   +2.806411868797381e-01   +5.360339427471408e-01   +2.487754027205293e-01; +1.112636399907696e-01   -1.043155955211877e-01   +4.893111449926931e-01   +2.900384312424443e-01   +3.501025315121101e-01   +1.211090871837452e-01   +2.539671965349313e-01   -1.381166687656192e-02; -1.196275561370525e-01   -1.174509856727600e-01   +2.751347264127807e-01   +2.906990475791290e-01   -2.373631496975377e-01   +2.932516088037254e-01   +1.607712959651473e-01   +5.277902402523030e-01; +6.283235700909428e-01   +5.151689661037146e-02   +2.186651288770733e-01   -3.163074937251368e-01   +2.969862432809515e-01   +5.471794154179199e-01   +5.036112210674003e-01   +9.951522562598248e-03; +1.050159542975054e-01   +3.656472076394356e-01   +1.893886959710794e-01   +3.445998396897228e-02   +2.999796539076786e-01   +1.713872755429444e-01   +1.926915788820515e-02   +2.667644679686497e-01; +1.092549424732687e-01   +8.508993060049883e-01   -6.003326410708284e-01   +2.306387182603828e-01   -6.461787825695126e-02   +1.823137571889159e-01   +1.179818902547979e-01   +2.101858556830367e-01; +8.347366866526734e-02   -1.674771715731247e-01   +1.193321537350521e-01   +3.797845939741224e-01   +5.251157301656577e-01   -1.181021861850614e-01   +1.068632283211159e-01   +1.037204440477322e-01; +6.588731481060646e-02   +1.378945763004353e-01   +3.559851379586059e-01   +1.121491715839632e-01   -2.192705062249049e-01   -3.686442491500025e-02   +5.141708054197940e-02   +3.358770464078466e-01; +1.341202567897470e-01   +4.943499107679283e-01   +7.319417368318969e-01   +4.995847578839626e-01   -3.739252379790196e-02   +2.034109476317809e-01   +2.991143198189444e-01   +2.794808708397247e-01; +4.107694573379033e-01   +6.546421739652440e-01   +3.810891741046801e-01   -1.142726034217891e-01   +1.155317960214661e-01   +2.153479180262765e-01   -2.453302298927902e-01   +2.613462969008958e-01; +1.278571383911100e-01   -2.818806330718355e-01   +2.471068944989966e-01   -9.895949645498212e-02   +6.196562326477877e-01   +6.820435963253156e-02   +5.669134146002228e-01   +2.008881287241008e-02; +3.810468728298505e-01   +1.522165578630994e-01   +3.493659750547594e-01   +1.111788016578114e-01   +2.080097953129863e-01   +1.000000000000000e+00   +3.451781882335410e-01   +3.954964600987472e-01; -1.340202351146414e-01   -9.497118192135329e-02   +2.975815268024792e-01   +1.531877216017737e-01   +3.473956495896753e-01   +1.638122234566222e-01   +2.059289620813393e-01   +2.486514286417101e-01];
L1I_L2I_iGABA_netcon = [+3.773444087342315e-01   +1.060312992669356e-02   -1.932817076193127e-01   +4.984188240232846e-01   -1.942072293252839e-01   +1.768414255974996e-01   +1.411429514249413e-03   +4.206622826664134e-01   -3.097365790876830e-01   +6.623069406900634e-01   +3.461933370184736e-02   +1.093723787770437e-01   +2.319694036920627e-01   +3.000339709306514e-01   +1.547723646355711e-01   +5.103727097392936e-01; +5.371067928252744e-01   +1.250168265323677e-01   -2.058857566397104e-01   -1.326951046891635e-01   -2.755340962494874e-01   -4.550427643833854e-02   +4.243200106789512e-01   +4.491630601951252e-01   +3.671816485450279e-01   +6.679807002037118e-01   +9.723012028697021e-02   -2.071886643411156e-01   -1.312242095690568e-01   -5.419455340264724e-01   +3.781854790971850e-01   +5.113050598281520e-01; +1.535711507345388e-01   -1.385485281778720e-01   +4.567459104015746e-01   -1.798018339830464e-01   +2.874343008862018e-01   -1.584329473326412e-01   +6.910073271523841e-01   +6.268372203052368e-01   -3.474038503512364e-01   +2.046930536790419e-01   -1.259551196644368e-01   +3.197412454695782e-01   +5.511572706122563e-01   +4.650158262148243e-01   +8.833026401394110e-01   -2.095212029342994e-01; +3.276175249005685e-01   +5.416702047128689e-01   +2.984338474172663e-01   +1.503374642271108e-01   +6.053722201012559e-01   +4.425057942295374e-01   +7.310272723846396e-01   +3.498250396105001e-01   -4.340852935176033e-01   +5.714767075303655e-01   +5.588357760374030e-01   +1.626672260965818e-01   +3.513568260469005e-01   +2.533527766395588e-02   +3.104355991033667e-01   -9.882608076563863e-02; -1.881594916698858e-01   +2.512166390507081e-02   -2.059969173998153e-01   +2.004881867550522e-01   -1.082832976003330e-01   +7.308881461295254e-01   +6.996368024832560e-01   +2.039346253158870e-01   +6.170634123653596e-01   +5.673197930859845e-01   -3.037078634664065e-01   +2.086380477358994e-01   -4.459520448446932e-01   +3.630911328524646e-01   +1.499823195864337e-01   +5.557822190323590e-01; +8.523346623331737e-02   +3.667405208857651e-01   +3.571953365350284e-02   +5.296980771825280e-01   -1.113303848218071e-01   +2.059398881614123e-01   +4.428984893609947e-01   -1.257582855921275e-01   -9.286613184797313e-02   -5.149491238016515e-02   +2.363035097558725e-01   -1.665662339261533e-01   +5.177045374371239e-01   +9.320007562002016e-01   +3.980096228791425e-01   +6.842424908034599e-01; +5.625041313037679e-01   +4.028303938484215e-01   -1.624916958526485e-01   -3.238315394062484e-02   +4.504700237468051e-01   -2.763393757881945e-01   +4.409515551516097e-01   -4.738016979849069e-02   -5.964902053524401e-03   +2.697916060375188e-01   +4.841511746552244e-01   +4.013491666587847e-01   +2.055696370447813e-01   -2.163296349771581e-01   +1.097590304187006e-01   +4.647528476706583e-01; +4.155017334707299e-01   +2.180520329850778e-01   +8.024822235917070e-02   +1.418651829989115e-01   +1.366615235638873e-01   +3.888273641211506e-01   +2.966361840651968e-01   +1.228943119631503e-01   -1.336595105539634e-01   +3.414924339699691e-01   +5.795035288410577e-01   +4.342786341692292e-01   +2.840199627736977e-01   -2.013612167628464e-01   +4.807951841544255e-01   +3.689437092903962e-01];
L2E_L1E_iAMPA_netcon = [+4.418850220678402e-01   +1.560508370687554e-01   +1.362147348080134e-01   +3.493299237383482e-01   +1.000000000000000e+00   +5.032394852870532e-01   +3.458324640350179e-01   +1.807887039986975e-02; -2.232929753605240e-01   +2.037377029299902e-01   -1.807396420523964e-01   +2.126110251249524e-01   +4.811132941901619e-01   +1.050031451572675e-01   +4.092646126668840e-01   +3.460628277346079e-01; +1.405913616350423e-01   +4.887870939083668e-01   +3.599237699195971e-01   +2.996476972680930e-01   +1.245468342365228e-01   -4.592127102732379e-02   +1.718307746699465e-01   +3.258020527339058e-01; +4.214594181922612e-01   +2.040583223222411e-01   +6.048338052233890e-02   +3.221863901020770e-01   +2.644388804802202e-01   +1.965786850936420e-01   +1.245167061972672e-01   -1.045231834919544e-01; -1.144706172065168e-01   +1.821868787354572e-01   +6.303652414869365e-01   -2.581840104075722e-01   +1.996442693956349e-01   +1.039504321572827e-01   +1.679300692868565e-01   +4.509946566261605e-01; +3.448485575246025e-01   -1.813743055525230e-01   +1.797484324273702e-01   -7.182551933050239e-02   +5.503853389959880e-01   +7.766945740753848e-01   +5.175554293351861e-01   +2.500588045977962e-01; +2.007666177791760e-01   +5.315121300503477e-01   +3.898368170986543e-01   -7.223487963892530e-02   -2.890919579965133e-01   +4.002215631607067e-01   +8.219127271067476e-01   -8.658912793421766e-02; +2.386494606708261e-01   +4.754521157413046e-01   +7.731473604551804e-01   -1.732528927145341e-02   +3.541706903034950e-01   +6.304860048216834e-02   +2.731057132727099e-01   +1.834899178029189e-01; +4.397565231293766e-01   +6.015757403972991e-02   +3.993733448402994e-01   +7.339192892525883e-01   -1.703151484508162e-01   +5.694373415195678e-01   +3.465627705731215e-01   -9.960728775813708e-02; +2.628030443305774e-01   +1.051389842422871e-01   +2.590377117432373e-01   +2.453865665239642e-01   +1.662170094533270e-01   -7.337849327117540e-02   +2.742703792420390e-02   +3.926154581431485e-01; -4.122606354922784e-01   +5.427385763832975e-01   +4.763266646973638e-01   -2.622155651503211e-01   +1.927223603194685e-01   -4.178061715245555e-02   +8.687772592160224e-02   +2.004473759339174e-01; +2.577735315831127e-01   +2.541375295110215e-01   +6.327809311808752e-01   +2.751709911009510e-01   +7.435769083576413e-02   +3.962255329226822e-01   -2.568979799954337e-01   +2.551537276912804e-01; -2.134170214565347e-01   +2.329827014427897e-01   +2.952674885617608e-01   -3.241823126795069e-02   +5.232746630901659e-01   +1.186292489681899e-01   +3.358860120935274e-01   +1.903342024624481e-01; +3.216266495002305e-01   +5.758967854980894e-01   -4.879582921960745e-01   +1.139348259203939e-01   +3.232574904094105e-01   +2.244284623651380e-01   -2.053872045408787e-01   +2.906513890227563e-01; +5.644093860871294e-03   +2.168231982443184e-02   +6.892074181473706e-02   +3.702227852857828e-01   -1.789606041649754e-01   -1.479495169507721e-01   -2.172912494612692e-02   +1.435732961393930e-01; +1.605994422299011e-01   -5.961048734622291e-02   +7.619137260150351e-02   -2.057282474908242e-01   +2.593266410054291e-01   +1.897457617048741e-01   +4.709237475986900e-01   +4.694122143251069e-01];
L1E_L2E_iAMPA_netcon = [+3.487414686279055e-01   +3.172797919047700e-01   +1.474290718164531e-01   +4.857532255177321e-02   +4.173250039311615e-01   +1.876667824485840e-01   +1.824030612452964e-01   +6.932629623337605e-02   +9.514777647785477e-02   -9.313962758171090e-02   +5.846522880163335e-01   +3.126259530210275e-02   +2.141553402739023e-01   -1.529743275392371e-02   -3.022496374295440e-01   +5.226695564979076e-02; +2.147663737921712e-01   -3.657851971279739e-01   +9.202662660141313e-01   +4.346852696643012e-01   +1.249123673674724e-01   +1.822599326348858e-01   +7.310776068187961e-01   +4.159497579023916e-01   -2.124401333178489e-01   +2.306314994165019e-01   +3.818078520760876e-01   +4.278136764719924e-01   +5.894938262599190e-01   +2.851541267393847e-01   +4.166118824410200e-01   -1.905949969894186e-01; +5.848171015503004e-01   +3.629155485069853e-01   +6.277444039905948e-02   +9.341445403688833e-02   +4.210035181118685e-02   +4.885037750895431e-01   +2.198408691714519e-01   +3.150441145924280e-01   +2.051773406327330e-01   -2.355033989311416e-01   +4.326971220449317e-01   +7.943445922519564e-01   +2.785156745103257e-02   +4.482561893633564e-01   -1.143762329723104e-01   -1.747780606175611e-02; +1.685981174846855e-01   +4.118364031985426e-02   +2.076267411908249e-01   -3.108137671267998e-02   +1.886070588279946e-01   +6.534707846877518e-01   +9.518582547100098e-01   +5.865722052543117e-02   -9.126382946796512e-02   +1.815940523291876e-01   +2.062749596938850e-01   -1.984706251244945e-01   -1.834202859436196e-01   +9.253570053597333e-01   +1.798938038926811e-01   +4.835110449458578e-02; -1.648603405651419e-01   -4.736181772601021e-01   +5.306684296227977e-01   +4.048405874071895e-02   +3.237435415497452e-01   +5.957227862837498e-02   +5.266605637527431e-01   +1.618317009628937e-01   +3.936002325223564e-01   +4.261445674196560e-02   -7.774997472852078e-02   -4.392555472677223e-01   +4.674163312270140e-01   +5.232989245258822e-02   +6.884997526207984e-01   -1.825870791164683e-03; -1.017433399496614e-01   +4.792063910564671e-01   -3.144797987035698e-02   +5.988036354957101e-01   +5.019742406383909e-01   +1.614897767464294e-01   +6.013099173954031e-01   +1.722013564740860e-01   +3.337540059288955e-01   +5.335033071375332e-03   +6.094511136261467e-01   +1.653362794364005e-01   -3.388767184400114e-01   -1.415542190980930e-01   -4.556974627072843e-01   +3.254353742996435e-01; +2.434818417955033e-01   +1.776095903963244e-01   -8.799834418947275e-02   +3.350059063373654e-01   +3.916837197027236e-01   +4.735862751914426e-01   +3.513300494865871e-01   -1.566124227657324e-01   -2.545130303698713e-01   +1.880243341153916e-01   -1.414260168190165e-01   -2.755242049634128e-01   -3.354497933003491e-01   +2.240795896295748e-01   +6.079850388550030e-01   +9.107847080534036e-02; +2.242944518571954e-01   +5.176572484029562e-01   +2.501759069437252e-01   +3.904566448021973e-01   +4.427542984703122e-01   +6.296420366427231e-01   +6.452943824358399e-01   +2.078604056108684e-01   +2.922532974289747e-01   +2.940274185946450e-01   +1.149772034909949e-01   +2.190611009928350e-01   -3.836086355121240e-01   -5.337336699175763e-02   +2.806376989816534e-01   -5.577583217329790e-02];
L2I_L2E_iAMPA_netcon = [+6.566760092465129e-02   +5.714366448730448e-01   +4.048877898611722e-01   +8.466391497718848e-02   +4.105854055585607e-02   +4.303689468462240e-01   +2.323417697541629e-01   +6.116009518544996e-01; +7.070533623143045e-01   -9.748864789531961e-02   +9.735587542336213e-01   +6.160426720555883e-01   +5.661713137296309e-01   -1.792639963529250e-01   -8.284254949690798e-03   -1.822481113161361e-01; +1.790398368941554e-01   +4.069740472145089e-01   +1.240978457507010e-01   -1.987798005731749e-01   -1.465621012046870e-01   +4.153772635638545e-02   +4.555902886194752e-01   +1.513066459647079e-01; +2.265027706935396e-01   -9.281687436598705e-02   -4.416076469891334e-01   +5.161116008610755e-01   +3.012055516343457e-01   -3.499053033253499e-01   +3.478728817630628e-01   +2.945875530853456e-01; +1.887654929201481e-01   +1.779826332166261e-01   +1.331114218049634e-01   +4.769016526576337e-01   +3.943770294398096e-01   -1.412593729996973e-01   +4.490535290696483e-01   -5.677932702996261e-02; +3.503850244262185e-01   +3.943464684047306e-01   +6.376459823103382e-02   +4.658588363112184e-01   +3.526498017688136e-02   +3.410157401144579e-01   +3.965155915629138e-01   +2.826746856929362e-01; +2.955497340107018e-01   +1.871288844619601e-02   +4.796039128457116e-01   +7.193597591338177e-01   +2.142306537986957e-01   -3.041483161960459e-01   +8.641425847437790e-01   +2.501343758945587e-02; +1.622064669741319e-02   +1.998105354479028e-01   -4.512229264798656e-01   +2.139645085478542e-02   +4.749658714867643e-02   -1.046900253292773e-01   +2.327697939821726e-02   +5.273846547787493e-01];
L2E_L2I_iGABA_netcon = [-1.810187051430144e-02   +1.919203421229880e-01   +6.161145227206656e-01   -8.242463156696536e-02   -2.681278020962529e-01   -4.641595931689023e-02   -1.492187124142347e-01   +3.646687165836479e-01; +1.284391873337514e-01   +2.010376725212185e-01   +3.638317274408434e-01   +7.270466735419908e-01   +5.527613186564982e-01   +2.498995913897498e-01   -4.792044734927797e-01   +1.547414599663035e-01; +1.510880946867948e-01   +7.551927187733659e-01   -2.814812225846377e-01   -3.284240144224477e-01   +3.855861308438434e-01   +5.151713114861922e-01   +2.735630554216159e-01   +4.091764951630969e-01; -8.588716634997626e-02   +6.155258474719172e-01   -1.246281882502358e-01   +7.503977513345467e-01   +6.345145561331790e-01   -4.055498896647901e-01   -3.418815242551221e-01   -9.380735782988495e-03; -9.734781925928987e-02   -3.275876730638524e-01   -1.155685538273133e-01   +1.849457603340833e-01   +7.547696639211785e-01   +1.406019485450661e-01   -1.964544299368632e-03   +1.174941020277594e-01; +5.768111594026992e-01   +4.226283307812598e-01   +1.598900973795850e-01   +3.858122389758517e-01   +4.625419657384467e-01   -3.924508829383925e-01   +5.273939868095912e-01   -2.897958924721591e-01; +2.627501542706729e-01   +2.524916495992942e-01   -3.508801041293770e-01   -3.343822912359529e-02   -1.811634723459181e-01   -3.753645045951346e-01   +1.292305512453534e-01   +9.418095048054247e-01; -1.575854961859997e-01   +4.704499322416187e-01   +4.795420857443697e-01   -1.935845016482047e-01   +2.080720977398436e-01   +4.989730319314465e-01   +3.617096023625825e-01   +6.367061342368552e-01];
L3E_L2E_iAMPA_netcon = [+3.319480739888701e-01   -4.106181600967835e-01   +1.899069933278159e-01   +1.680911500343005e-02   +4.499644308930829e-01   +2.556470569099850e-01   +2.719103920144483e-01   +3.955999232360871e-01   +3.472665169692978e-01   -2.270377754782024e-01   -1.563623790526675e-02   -7.805761024528259e-02; +3.061869822645741e-01   +5.460531637764469e-01   +2.423183648070074e-01   +3.141086830226809e-01   -4.146059830946905e-02   -3.203662811463949e-01   +2.127443345188748e-02   +8.619620855940530e-02   -1.535802921705542e-01   +1.706649074581612e-01   -3.941433073901046e-02   +3.889546082656118e-01; -4.222802315400748e-01   -1.984904502078387e-01   +3.637595995349392e-01   +3.364208803370622e-01   +6.654190589918816e-01   +1.076278570839352e-01   +3.332575209437632e-01   +2.142747383748276e-01   +7.584779114725249e-01   -2.607307336443569e-01   +6.515038482630131e-01   +5.799168087640910e-01; +1.697215275692808e-01   +3.326204718861405e-01   +3.293610632722506e-01   +2.045295834061040e-01   +6.055101868830919e-01   +1.077190642705438e-01   +9.801239749381141e-02   +5.005798861937387e-01   +5.381496073709255e-02   -1.611604892130938e-02   -1.899794951565332e-01   +5.715230254075031e-01; +2.806626863891151e-02   +9.996010825081303e-02   +2.805105069761326e-01   +6.191914720729422e-01   +4.609896462209944e-01   +2.981280649641996e-01   +7.578637249976611e-02   -2.090326254514324e-02   +1.348032196029770e-01   +4.487788006721747e-01   +5.840955543890920e-01   +4.587580456500741e-01; +3.946287074782590e-01   +9.332314583626194e-02   +2.335963667421120e-01   -2.822672769462691e-01   +3.741364232720336e-01   +5.095251226481019e-01   +5.547260974384355e-02   -2.518413238455428e-01   +1.909278529048979e-01   +3.996798674215299e-01   -5.086351458234346e-02   +1.026329367433832e-01; -8.235940097713695e-03   +3.684311056652378e-01   +6.225422469148829e-01   +6.888149678165936e-03   +4.322002258417657e-01   +3.696728869010052e-01   -1.596444969821224e-01   +8.906195622363877e-02   +4.009888524524774e-02   +4.009510901505895e-01   +5.707662594182331e-03   +3.342354596800980e-01; -2.519110996421108e-01   +9.369012955813985e-01   +3.445066554445524e-01   -5.709671531976693e-01   +3.634569587420242e-01   +3.709886507882952e-02   -1.163864129003791e-01   +1.040107718928473e-01   +3.974978287766759e-01   +3.272888359383292e-01   +5.880529199465054e-02   -2.140605424534078e-01];
L3I_L2I_iGABA_netcon = [+7.696702372166905e-01   +4.704223815234484e-01   +5.934588519819534e-02   +2.622753562063480e-01   -5.454965250517139e-01   -6.640631118979544e-02   +9.956493623939843e-01   +6.473607975995040e-01   +8.440896622294650e-01   +1.174306997800990e-01   +2.053813170912583e-01   +2.241130098686286e-01; +2.182469311126239e-01   +1.495160547363530e-01   +1.734497530575725e-01   -1.085136550684678e-01   +4.074226870302974e-01   +1.359504409596643e-01   +4.225040236136796e-01   +2.318073468612976e-02   +7.357785915066498e-02   -1.068614603580073e-01   +3.551102348002733e-01   -1.129916141497948e-01; +2.142246219850129e-02   +4.672426335549371e-01   +2.661430125315674e-01   -2.350423520748783e-01   -1.362734362344840e-01   +3.271605580501118e-01   +1.999680684164696e-01   +3.114117133999956e-01   +2.453153678043963e-01   -1.900697264212306e-01   -2.436830417506902e-01   +7.814576712470931e-01; +5.180092877255200e-01   +4.604482948423037e-01   +4.230791875836304e-01   -1.371886288612076e-01   +2.526226275135186e-01   -7.045363316831610e-02   +2.262782038963033e-01   -3.377167329922172e-01   +4.619795307960718e-01   +5.445359772796332e-01   +5.850119871412067e-01   +7.095131073741376e-02; +3.185933862649024e-01   +2.844659961548002e-01   -1.935288408519728e-01   -1.741042838452830e-02   +6.272152037990113e-01   +5.294022380858273e-01   -6.320940411238724e-02   +7.752462995696647e-01   +6.801070115853658e-01   -7.222746828207199e-03   +2.961930686617099e-01   +1.598552208186038e-01; -1.963707870039631e-02   +5.600530446305841e-01   +4.286518065219134e-01   +5.342492903636820e-02   +4.867844732660534e-01   +4.549727436685718e-01   +1.624360191374803e-01   -1.829399341061269e-01   +4.249857823309376e-01   +4.691561763289855e-01   -8.351179221886181e-02   +2.076069196186629e-01; +4.852071668830910e-01   -7.547217590685927e-02   +2.714188077370464e-01   +3.954098302137198e-03   +5.188475377743926e-01   +5.523937397596539e-01   +4.886557354795245e-01   +6.944084273930805e-02   -5.182628250462065e-01   +7.046547984711761e-01   +2.348799223156265e-01   -2.272601096874144e-01; +2.598808131537843e-02   +2.862751506139980e-01   +3.087690029025580e-01   +4.206076553254625e-01   +4.015186186335343e-02   +4.670200706973670e-01   +6.617330396496336e-01   +8.021131448506541e-01   +5.262583482151042e-01   +3.332802167248222e-01   +2.758872565151689e-01   +4.398592669944390e-01];
L2E_L3E_iAMPA_netcon = [+7.093596894758809e-01   +2.096144727276464e-01   +5.588930179904888e-01   -5.829571370416421e-01   +2.489118846639728e-01   +3.607976821133811e-01   +5.311981228886353e-01   +5.592190012229549e-01; +3.687115730395027e-02   +1.993237634691689e-01   -1.728049229726297e-02   +2.849671993756393e-01   +5.288437825219729e-01   -1.840208087717573e-01   -2.049175518394408e-01   -3.876904686611358e-01; +1.029840234879203e-01   -2.645484581926676e-01   +2.381163445875692e-01   +4.727143569329092e-01   +3.275503982243400e-01   +1.843968120767290e-01   +6.847071447101287e-02   +2.038820531667025e-01; +2.738764884837348e-01   +3.381971805616861e-01   +8.085862245239339e-01   +8.066348737953905e-01   +1.712452875367863e-01   +7.461499901433215e-01   -3.826303395800586e-02   -2.474767022482815e-01; +2.397013984573407e-01   +1.101183389483972e-01   +3.570534090709716e-02   +4.643866319103074e-01   +2.639822726474211e-01   +2.500473294857193e-01   -4.320416405074018e-02   -1.777814696925759e-01; +4.398730709036033e-02   +7.419992819912490e-01   +6.788658250239942e-01   +7.393615721444420e-01   +2.344998048173986e-01   +2.321896120771554e-01   +2.638969593557053e-01   +8.100281760403658e-02; -1.713322469439921e-03   +7.020791581641590e-01   +7.265775488982605e-01   -1.513944530353747e-01   +1.997549170599232e-02   -2.422654417523896e-02   -1.005498983576805e-01   +4.500388046653664e-01; +4.206676174468879e-01   +2.644756612804173e-01   +5.521762741756811e-02   +2.279051092401925e-01   +2.162190675263678e-02   +2.229022088356849e-01   +2.413035908874567e-01   +7.454216740454287e-01; +2.250862879435823e-01   +7.125140712799092e-01   +5.545876340435701e-01   +3.546326948497549e-01   +1.905774204289713e-01   +1.222428851067421e-01   +7.254787504440949e-01   -2.432608557805429e-01; -6.477406199993976e-02   +2.886069323634660e-01   +2.293547761362586e-01   -6.184533506731813e-02   +2.927089702460879e-02   -3.226433652546092e-01   +1.912275195136666e-01   -4.504071591938871e-02; +5.058046540443351e-01   +5.021357448553725e-02   -3.236667709033820e-01   +9.683989164255782e-01   +5.855282166586670e-02   +4.197182386739223e-01   -5.115144295157318e-02   +2.580105452797994e-01; +6.933194326368383e-02   +7.537053447332439e-01   +4.204144831693459e-01   +5.897641533417599e-01   +1.580246300647069e-02   -4.437578242119421e-02   +8.664680368837610e-02   +2.394766586569457e-01];
L2I_L3I_iGABA_netcon = [-7.308183631692038e-02   +1.830072331469426e-02   -7.064568030696719e-03   +1.965290184064562e-01   +9.137345683801602e-02   +7.380423232791975e-01   +3.537127569253602e-01   -1.732984453625860e-01; -4.103041243405053e-02   +3.888586295634194e-01   -3.006177357328401e-01   -8.020933379213156e-02   +9.887697251213343e-02   -1.381964844994482e-01   +5.565759100256354e-01   +3.010370879544845e-01; +8.227366723034372e-01   +1.000000000000000e+00   +2.925151372187043e-01   +6.621602257496957e-01   -1.602236246685146e-01   +7.946350171627289e-01   +2.225471817423048e-01   +1.425411996408414e-01; -1.251215489668846e-01   +2.629530663669084e-01   +7.148611561186466e-01   -4.756228872338399e-01   -1.110764258817490e-01   +7.070850596484620e-01   +2.288737051962566e-01   +2.661780283554993e-01; +5.804925722335188e-01   +2.264752615577287e-01   +3.180986636530154e-01   +3.148566598168153e-01   -3.056808421823304e-01   +1.462533370976788e-01   +4.303158510034813e-02   -6.330712000394575e-02; -1.288928399270808e-01   +2.648806123600956e-01   +7.500503538456892e-01   -2.284447902949777e-01   +4.312248927161951e-01   +8.461630876337454e-01   -3.636271804531033e-01   +1.666333321082341e-01; +4.159627950946751e-01   +3.666668820752051e-01   +1.939447719165028e-01   +3.507509179931306e-01   +1.459031784491956e-01   +3.986071145456820e-01   +9.446358344902698e-01   +5.422511974785026e-01; -2.881773527560517e-01   +4.099110767049419e-01   +4.165011896244057e-01   -3.553271024273693e-02   +1.134734031485346e-01   +2.375307058423612e-01   +6.276822124741256e-02   +7.323350543950847e-01; -9.491219358504395e-01   +9.082823484826197e-01   +5.819209271751291e-01   +3.626116854263556e-02   +3.382664590062242e-01   +2.625847787948000e-01   +4.454498159562427e-01   +3.345458546879226e-01; +2.215227319881029e-01   -3.564094541852173e-01   +1.793746389729637e-01   -1.335874481713186e-02   +3.773543285909564e-01   +6.255949792553629e-01   +2.261296242619232e-01   +3.799438128916524e-01; +6.452245465329818e-01   +3.516852194563991e-01   -5.341020440704686e-01   +2.702450665148189e-01   +3.696612485127222e-01   -3.032932624878438e-02   +5.292111016979500e-01   +5.539714910168057e-01; -5.569766873054796e-01   +8.600767077613501e-01   -2.219735291029076e-02   +7.862107951650397e-01   +7.274420915530203e-01   +2.541823493819353e-01   +1.566217762003387e-02   -2.284553708988036e-01];
L3I_L3E_iAMPA_netcon = [+3.110884113311424e-01   -5.158944584691381e-02   +1.494661246708746e-01   +3.640587122056641e-01   -2.212538915405632e-01   -1.312121219016753e-01   +1.725592679624716e-01   +3.372963188968045e-01   +1.747065775796866e-02   +4.140409776349310e-01   +4.292593391749429e-02   +2.657816432795152e-01; +5.150183732637478e-02   -1.136306239483262e-01   +4.741608188436498e-02   +6.626570988641937e-01   +1.885373008384031e-01   -1.617638119026507e-01   +6.062778536280521e-01   +3.962433483216470e-01   +3.001764257194355e-01   +1.253091637932839e-01   -2.417144335958847e-01   -5.373498753189708e-02; +8.409598335419123e-02   +4.889293736680730e-01   +5.475281075025994e-01   +8.882422827167000e-02   +7.847116102452769e-01   +2.356647841325686e-01   +6.141272204096360e-01   -7.683009220065619e-02   +4.286776838111171e-01   +4.862050949170442e-01   +1.134230070870770e-01   +4.168745598026388e-01; +4.012926658639092e-01   +3.787033321960777e-01   +4.878785958042867e-01   -5.256530792100829e-02   -6.253208158781787e-02   +5.997550408747674e-01   +1.502993348150551e-01   +2.940822180998787e-01   +1.679143010965971e-01   +3.361769278515797e-01   -6.833787104045438e-02   -8.437130505854082e-02; -1.292359942524370e-02   +1.177668930136683e-02   +8.030106500632720e-01   +3.738735031857820e-01   +2.555204263067504e-01   +2.628376048335327e-01   -1.197871743682165e-01   +3.385475991744092e-01   +2.858508804312043e-01   +3.951506166068688e-01   +3.080637742841851e-01   +3.237279731597836e-02; +1.963827782948954e-01   -1.750838774855426e-01   +1.753674786889448e-01   +4.165174628949977e-02   -1.119491304083552e-01   -3.943814938991207e-02   +2.499444008109735e-01   +9.700324177954606e-02   +3.085567482798853e-01   +8.091509796767182e-02   +1.211728578001966e-01   +7.407055948266590e-01; +7.138200137437326e-02   +3.128570685672902e-02   -1.938210549156248e-01   -8.389004489616844e-02   +1.692591981813905e-01   -1.324158256098016e-01   +5.626759976145589e-01   +1.291156596248543e-01   +1.632386555703495e-01   +3.383117070067701e-02   +4.071257138689328e-01   +8.600405119329887e-02; -1.008136055917194e-01   +2.194113894391189e-01   +2.845685459721536e-02   +1.365816327500191e-01   +1.894918542068478e-01   -2.902741222127445e-02   -3.356371994996275e-02   +1.161769813224468e-01   +1.060590426402309e-01   -3.255044926331877e-01   +3.113653467222269e-03   +1.901091672169219e-01; -2.232386351390303e-01   +5.007560361032999e-01   +4.385909216897983e-02   +1.125861267440629e-01   +7.744170079081969e-02   +5.594861744227329e-01   +2.561145870629408e-01   +4.434248049108859e-01   -1.251414062760671e-01   +7.637800555032145e-02   +5.123882000546288e-01   +7.918934593049387e-01; +6.148239682191202e-01   -6.054517410252098e-01   +6.157042804025444e-01   +2.140539581619750e-01   +1.087156463959748e-01   -4.968882553577972e-01   +4.342014838463396e-01   +3.480272936347076e-01   +1.181329491945336e-01   -8.111513251473279e-02   +9.321684475656316e-01   +8.003541573180267e-02; -4.369728175556968e-01   +4.631745731913303e-01   +6.347503675194162e-01   +4.524945338435356e-01   -1.531647835944728e-01   +3.214915012621189e-02   +2.825466408096983e-01   +2.104019915276545e-02   +4.573612960791766e-01   -1.939750385681549e-01   +1.026824051664071e-03   +2.412004770330495e-01; -1.932035076932989e-01   +1.852632085938625e-01   +2.787756149686882e-01   +4.903268720302874e-01   -2.656881493012903e-01   -4.959174761132716e-02   -2.627486746730660e-01   +1.629469509165561e-01   +4.545855977498267e-01   +9.032432754966062e-02   +1.006903253527759e-01   -4.519377588101328e-02];
L3E_L3I_iGABA_netcon = [+2.915153286652822e-01   +2.358554859873707e-01   +5.360283925651810e-02   +2.075122178537490e-01   +2.089985330358253e-01   -9.966406993534890e-03   -2.876607150841379e-01   +4.352821483338397e-01   -1.450919466983525e-01   +5.666992247554594e-01   +2.037861364708842e-01   -1.715339585221508e-01; +2.880802011920073e-01   +4.858532387270522e-01   +3.367047241974268e-01   +2.041889907463184e-01   +5.180627024237966e-01   +1.623759545011268e-02   -3.450271176210114e-02   +3.587420605149677e-02   -4.343265762155957e-01   +1.238897732060579e-01   -4.871917140157993e-01   +8.235799303203462e-02; +1.539279914375540e-01   +8.834184535487921e-02   -3.112518577803526e-01   +6.727489318717736e-03   +2.610991529851984e-01   +3.304519905733273e-02   +2.681492451714794e-01   +3.699275501615613e-01   +5.940884593511130e-02   +2.185554376784526e-01   -1.742558164941131e-01   +5.098133873005933e-02; +9.668931552599844e-02   +1.473454249853764e-01   -4.473849269540531e-01   +4.397356263414842e-01   +9.858235978778418e-01   +3.963183620212524e-02   -7.904564226322744e-02   +1.831675229954011e-01   +6.547984241026055e-01   +3.185884360864810e-01   -9.825865326940998e-02   -9.826115311694901e-03; +2.522982651536602e-01   +1.336795608411424e-01   +4.629061187595957e-02   +4.820756847309582e-01   +1.678397172778568e-01   +9.246580523977573e-02   -1.906521400729476e-01   +6.733112076637662e-01   -1.302898886446843e-01   +5.878595214769295e-01   +1.755182232731823e-01   +2.073168862192550e-01; +3.356333520014697e-01   -1.574979261505513e-01   -7.181653344067174e-03   -2.103798977172651e-01   -8.244360948718862e-02   +1.517788396554323e-01   +1.125978075967078e-01   +5.044001505822759e-02   +5.795577092853594e-01   +2.891386731874988e-01   -1.759120168912883e-01   +7.658542418557901e-02; -7.355618409240756e-02   +4.735603565717589e-03   +2.662374769035311e-01   +9.760553435576964e-01   -1.007828679452485e-02   +3.947825398138332e-01   +4.331815657817495e-01   +1.939115733355380e-01   -1.426355361888075e-01   +2.584683126442130e-01   +4.257682219704779e-01   +1.769677197459566e-01; +3.058744279432810e-01   +1.938578217922164e-01   +1.855813573762054e-01   +1.062051823974698e-02   +2.379234331442318e-01   -2.912968571901903e-01   -1.728647968421728e-01   +5.708918003778838e-01   -8.259281620031367e-04   -1.849038355099725e-03   +3.897749445447869e-02   +3.421915341681991e-01; +3.032291706834521e-01   -2.204842027926709e-01   +4.462140260725685e-01   -6.699391986144387e-04   +1.688140472191816e-01   +3.457241025548619e-02   -5.470661515268037e-01   -3.197734119621113e-01   +5.372135982193026e-01   +3.595250152841030e-01   +1.550122157266618e-01   +6.616803261078341e-01; +1.861584226307998e-01   -6.905169414083386e-02   +2.858150754692469e-01   -1.914348009131517e-02   -4.866092794050600e-01   +1.319723382994680e-01   -7.884548359756745e-02   +1.861702285723099e-01   -1.087473094348566e-03   +1.746312748225788e-01   +1.494381017439927e-01   +3.460010784074008e-02; +3.580065424133725e-01   -8.415698846543300e-03   +3.547287934798802e-01   -5.244667887422053e-02   +1.497913535383902e-01   -2.731381009110265e-01   +3.003356896093888e-01   +8.351746648068800e-02   -1.633683212425567e-01   -1.391359767462868e-01   +3.038619446125589e-01   +4.986910524738375e-01; -3.714781393751533e-02   +3.430575631640340e-01   -1.601830413068904e-01   -1.655728295302589e-02   +8.051778332298898e-01   +4.853842544027259e-01   +3.391727536062760e-01   +4.462501724547048e-01   +7.440541243234697e-02   -3.189150644689884e-01   +4.382269312707630e-01   -1.192254212474419e-01];
L2E_Input1_iAMPA_netcon = [+7.122627260220690e-01   +7.104062446832092e-01   +5.177842082801229e-01   +8.296678225759823e-01   +1.000000000000000e+00   +3.800357822674703e-01   +4.832407709445876e-01   +6.111785768427505e-01];
L2I_Input2_iAMPA_netcon = [+6.081967211326128e-01   +8.289439106762013e-01   +7.423343415553537e-01   +4.597321948875294e-01   +1.641589338975792e-01   +1.000000000000000e+00   +1.623288880304731e-01   +3.684764754678035e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
