function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.504930025799762e-01   +7.389365508949846e-01   +6.512552809016291e-01   +4.758388794064817e-01   -5.573112030365023e-02   +5.171325386448706e-01   +6.810203968149554e-01   -3.442647236636049e-02   +5.743243285687629e-01   +4.077824428301823e-01   +6.153953941150957e-01   +4.736820628700276e-01   +4.721902322970322e-01   +7.730452045839079e-01   +7.516526048744407e-02   +3.277242882667677e-01; +9.585658880010271e-04   +4.874637679207542e-01   +3.585231786559607e-01   +2.198889064403433e-01   +1.814928913355321e-01   +3.315690632858822e-01   +7.565649554645347e-01   +7.710869782588582e-01   +4.888139324134819e-01   +3.750154385866556e-01   +4.099721354895232e-01   +7.898585425713602e-01   -3.325945219507513e-02   +2.501769410619694e-01   +9.216384388024346e-01   +7.068035766096605e-01; +2.119631723971754e-01   +5.053068692127437e-01   +1.055399018157214e-01   -5.730863132268410e-02   +2.279869670370762e-01   +7.849937121260642e-01   +1.692732023134084e-01   +5.093302586455225e-01   +5.776178095382863e-01   +4.847596104506889e-01   +3.710861125275479e-01   +2.134483458723569e-01   +2.386895033847827e-01   +3.137744350781646e-02   +4.057618389752100e-01   +6.668563448494983e-01; +4.527553960739136e-01   +3.456339031793688e-01   +9.823189910833008e-02   +7.631982616762585e-01   +5.308172638067935e-01   +1.029352183238066e-01   +2.476541225187398e-01   -1.936130624392677e-01   +8.335041266016421e-01   +2.101661255770212e-01   +3.360787085368550e-02   -4.963200899884012e-02   +6.912133010184384e-01   +3.429054807322011e-01   +7.495309076339364e-01   +3.058673769334334e-01; +2.544559400323425e-01   +1.885056572351594e-01   +5.729073972237747e-01   -1.419853773221243e-01   +2.456683651233691e-01   +2.961704868943495e-01   +2.072152520585672e-01   +3.974173504187362e-02   +8.855096480397424e-01   +3.045199760759357e-01   +2.332179948030502e-01   +3.461442771216969e-01   +4.078024168081205e-01   +3.697645524688046e-01   +4.519931092615976e-01   +4.117450767476741e-01; +1.093234255193748e-01   +7.460923723236876e-01   +2.465352438569028e-01   +3.373694725208065e-01   +1.854138452224433e-01   +6.218577027869833e-01   +2.982503810532167e-01   +3.934783962672149e-01   -1.267092286511096e-01   -6.422120224071756e-02   +1.286089839479206e-01   +6.030244265283381e-01   -8.815801686418555e-02   -1.244911780426481e-02   +4.054215707000405e-01   +4.757570424924295e-01; +6.410492268806267e-01   +1.673782170035742e-01   +6.554620999120390e-01   -1.496779061643033e-01   +3.800752488950033e-01   +2.681873001177325e-01   +3.837035234160933e-02   -8.530639068605378e-02   +7.952123585525913e-01   +6.912865795383879e-01   -5.536472468378952e-02   +1.862385330631157e-01   +8.074442162496598e-02   +1.877173283164484e-01   +4.519600786334581e-01   +2.920997691768645e-01; +8.869736093954419e-01   +3.056944915549947e-01   +2.647039075010117e-01   +5.674863504358635e-01   +7.082994501237749e-01   +8.863766086396552e-02   +4.603796579249862e-01   +7.956565473891370e-01   +6.051547681632140e-01   -1.806638712387501e-01   +5.512297359245989e-01   +8.136279208052090e-02   +4.406118145554865e-01   +3.892891722406191e-01   -1.217730589718160e-01   +4.653893091943483e-01; +4.906120698702709e-01   +6.460175930891833e-01   +3.550723398245927e-01   +2.579762664074981e-01   +1.624721784159634e-02   +5.690666716173984e-02   +3.293463190401914e-01   +4.769160880316102e-01   +3.747716025871126e-01   +3.049093293101918e-01   -1.753572240917330e-01   +3.569479470806768e-01   +1.353086613018886e-01   +1.684840914600896e-02   -7.382033049632482e-02   +3.893132780246124e-01; -4.469181238873624e-03   +3.562710453695769e-01   +8.803483562342417e-01   +5.174133562735461e-01   +7.693175640999628e-01   +3.656496204078933e-01   +2.548585964368401e-01   +1.879839357036461e-02   +7.982628708674085e-03   +4.619890985906597e-01   +5.734615934727946e-02   +4.892857748956237e-01   +2.678676243564256e-01   +1.847866679422542e-02   +2.206811481903831e-01   +7.323004092493614e-01; +6.724332293820686e-01   +4.343629091212997e-01   +5.651631719100394e-01   +1.385083999112118e-01   +6.979060988488969e-02   +2.886479980931688e-01   +4.267097382666045e-01   -2.427284693765512e-01   +4.683265883358356e-01   +3.090795613304810e-01   +4.611269588953078e-01   -7.671518884300008e-03   +1.040852447955685e-01   +8.497123569270862e-01   +7.238667241147039e-01   +7.099544214841912e-01; +2.610025184362456e-01   +4.208406151820769e-01   -1.882102297968587e-01   +5.017372434835654e-01   +4.915301058261853e-02   +5.584987055652690e-01   +6.281523674639168e-01   +5.955426686094658e-01   +5.916469025168787e-01   +1.479433480768640e-01   +9.139256886617967e-01   +4.044882120477113e-01   -1.493268341751211e-01   +8.634128723123257e-01   +2.906435761261016e-01   +1.949998388964915e-01; +8.435403463237865e-01   -6.281862839752277e-02   -1.531062394982332e-01   +1.363706737412293e-01   +1.968910519795869e-01   +1.000000000000000e+00   +4.291341411278060e-01   +4.160624780419024e-01   +8.534818914714333e-02   +4.266786964953511e-01   +6.613031742573121e-01   +4.173839153796869e-01   +5.006150926137255e-01   +4.621153710974484e-02   +2.160872568676241e-01   -1.436311482596017e-01; +6.259432659396316e-01   +4.508430127137517e-01   +2.722224067854674e-01   +1.330715635153464e-01   +7.228017506546861e-01   +7.892407465499047e-01   +1.582922451748672e-01   +6.515911752875151e-01   +7.036319524511346e-01   +2.728735561039031e-01   +3.092163803552780e-01   +3.195990000958658e-01   +1.713177980665067e-01   -6.049282410247416e-02   +7.543710086853761e-01   +1.962674427415008e-01; +7.169656560610284e-01   +9.019962479245874e-01   -5.407623989654845e-04   +2.440582371189354e-01   +6.375449883305396e-01   +2.929384886564754e-01   +2.808447418626905e-01   +4.697783148202373e-01   +3.557210652768132e-01   +9.489701153009699e-01   +1.855584693211728e-01   +4.674448762164125e-01   +3.560394774989609e-01   -1.097416133312406e-01   +3.474739934198384e-01   +2.142007448349001e-01; +2.171007804744811e-01   +1.345983893797340e-01   +6.566626849546648e-01   +3.735074313189508e-01   +3.296882122626412e-01   +3.649001191071365e-02   +6.743233112965026e-01   +3.337272135853020e-01   +5.799057447851764e-01   +4.696074995993567e-01   -9.132238194748438e-02   +6.178812265161274e-01   +4.656033472415919e-01   +8.371278013225694e-02   +2.444848025285388e-01   +3.242233411129760e-01];
L1E_L1I_iGABA_netcon = [+7.490794340144576e-01   +1.460956892522395e-01   +6.330453756039125e-01   +2.318141492715257e-01   -8.007428100994984e-02   +2.379040201799860e-01   +5.434855322488611e-01   +7.391842316762676e-01   +1.140761991112088e-01   +5.656788719365800e-01   +6.600032027925383e-02   +6.286653178107814e-01   +4.758201594625939e-01   +2.836288073037171e-01   +4.408388225503995e-01   +4.673872982747285e-01; +2.395913345421331e-01   +2.203432682393386e-01   +4.981254708674299e-01   +5.877585725415853e-01   +4.076205729778858e-01   +1.249717417001241e-01   -7.905646596852778e-02   +2.084184907461545e-01   +2.375806610652930e-01   +3.960638155191568e-01   +2.313259206502364e-01   -2.325028822910118e-01   +5.717535283361682e-01   +1.004937595855147e-01   +1.774310809611751e-01   +1.193727051534408e-01; +8.012587191393092e-01   +2.763630016305397e-02   +9.353719985170289e-03   +1.215717615547215e-01   +3.282277501036204e-01   +6.852196326258435e-02   +8.317021873878762e-01   +3.238603114188677e-01   +1.524451245642876e-01   +4.492429652805021e-01   +5.902873704421847e-01   +2.410366916108188e-01   +2.845140514126080e-01   +7.815053782124881e-01   +5.153780795444896e-01   +2.945113911211167e-01; +6.664939091307933e-01   +3.767961591222265e-01   +1.580558999838659e-01   +5.472982283392026e-01   +7.789192422233243e-01   +2.037977979043305e-01   +3.764474216149648e-01   +9.648305641711459e-02   +3.408196380346307e-01   +5.892738435513376e-02   +2.798910287007664e-01   +6.377371793428390e-01   +2.079140235315894e-01   +3.050992657096901e-01   +4.104717743405545e-01   +4.561746848759043e-01; +3.290673202642752e-01   -1.454320236111594e-01   +7.036467704952077e-01   +6.533750017893427e-01   +1.740068017580837e-01   +5.570357637117593e-01   +3.230485880460114e-01   +1.458453846983323e-01   +5.342526780818545e-01   +4.289280554800095e-01   +7.878658262965039e-01   +5.656205096693036e-01   +1.773686889557049e-01   +3.892586136857261e-01   +6.760999583888326e-01   +1.579299343048665e-01; +2.237853582547873e-01   +5.726690475354163e-01   +6.999339814256154e-01   -2.352074224700379e-01   +4.405814825290677e-01   +5.772358714186060e-01   +1.331217383981882e-01   -1.197202806470665e-01   +2.204347240974607e-01   -1.621262363561096e-01   +4.622408079999311e-01   +7.017449555635111e-01   +5.238354710984563e-01   +2.035158967852340e-01   +4.104104399063407e-01   +3.739849229260627e-01; +3.457826425984283e-01   +3.257440434124404e-01   -2.154362467004789e-01   +2.990165487717671e-01   -3.219809062544973e-02   +3.303978451331044e-01   +5.582557605395400e-01   +7.095122174267465e-02   -2.196967050010241e-01   +3.576777534491080e-01   +1.507875963672351e-01   +2.516381160391953e-01   +5.226736002607740e-01   +6.414612588652208e-01   -2.252718482024822e-02   -1.523448001792483e-01; +3.011029320333976e-01   +2.496356879357079e-01   +2.537832481005519e-01   +6.899176886755238e-01   +3.786069642859204e-01   +3.956858324679323e-01   +3.396043549457045e-01   +9.516826866636694e-01   +6.512837289559088e-01   +5.024462316719109e-01   +7.977477014794634e-01   +4.351410443940364e-01   +2.827913207681038e-01   +3.263733753782950e-01   -1.775150633015290e-01   +2.476911560949451e-01; +6.605435675667602e-01   +4.298176816658650e-01   +1.371774794095398e-01   +5.287912585842797e-01   +5.305693255006859e-01   +3.434244552688651e-01   +1.585992378440871e-01   +5.272680061914270e-01   +7.754960981234613e-01   +8.851694097417635e-01   +6.078813655961138e-02   +2.228106449074043e-01   +3.213011939532629e-01   -9.341810325777494e-02   -6.988858812398284e-02   +5.892245951402347e-01; +1.019289379938983e-01   +2.294956651985640e-01   +1.351998792594727e-01   +2.682686698784810e-01   +2.960252012200035e-01   +8.517735851634997e-01   -3.639100905050010e-02   +3.329863487672873e-01   -4.507109352077261e-02   +8.557359165907932e-01   +4.968089077417358e-01   +1.043622215272954e-01   +2.132337222960362e-01   +2.653331819977294e-01   +7.899418736424956e-01   +7.477589624422283e-01; +1.300439148477295e-01   -2.539969895107170e-02   +1.654479316373590e-01   -1.838020663449905e-01   +3.086697803352043e-01   +4.077647564269779e-02   +9.721936917353139e-01   +7.258471555241613e-01   +3.670829830174462e-01   +3.741288905584185e-01   +6.440839602032075e-01   +2.571160794945614e-01   +5.328012825218525e-01   +1.863254671271259e-01   -2.198038055935851e-01   +5.832659500449737e-01; +6.367624032776174e-01   +1.123552215292219e-01   -9.317042610764509e-02   +1.046899368258499e-01   +2.603051852068427e-01   +7.691483701273224e-01   +5.723640888330782e-01   +4.037520136957291e-01   +6.220836602082347e-01   -1.180608751111836e-01   +5.159249632122728e-01   -2.359632023226529e-02   +8.529957729019615e-02   +5.639846366074932e-01   +2.026506016473107e-01   +5.837620686400763e-01; +2.588244978244715e-01   +5.768099778660406e-02   +7.039874577687231e-01   +8.038201469779455e-01   +4.730499425388515e-01   +5.045986555499187e-01   +1.669523902208674e-01   +2.100365446543094e-01   +1.099927625082111e-01   +7.410095629340225e-01   +7.883506967474996e-01   +2.429308735144432e-01   +3.116190784796844e-01   +4.888389115871898e-01   +3.695342856685846e-01   +3.628006262620152e-01; +2.433296619295859e-01   +2.617265841251479e-01   +3.032870289680694e-01   +1.955861471717646e-01   +7.115548239429075e-01   +2.769760456697266e-01   +6.202219690712449e-01   +1.000000000000000e+00   +5.791647949965442e-01   +4.850846519750400e-01   +2.443025316486099e-01   +5.677159201230606e-01   +5.174257558233730e-01   -1.495806322843226e-01   +3.710147424420419e-01   -1.438879820794285e-01; +2.409940391569061e-01   +6.741698899912772e-01   +5.683765940090646e-01   +6.710010711912500e-01   +3.741189489293549e-01   +1.292640136088007e-01   +9.157312470790745e-02   +2.323428336549499e-01   +3.086999629512233e-01   +3.473827195309976e-01   +2.859593404527017e-01   +1.030389619389169e-01   +4.167647701413517e-01   -1.125347406014953e-01   +2.121488225274434e-01   +4.137133418348539e-01; +3.337588381085745e-01   +1.930308312573061e-01   +7.818837386251123e-02   +2.346739990240465e-01   +6.205949897411789e-01   +4.796484917722137e-01   +8.133471300716736e-01   +8.462627711289014e-02   +7.790746531470101e-01   +5.715949731534534e-01   +3.548677663232815e-02   +5.286343123088522e-01   +9.048499899699006e-01   +2.413107840065270e-01   +3.468563889413134e-01   +2.292449130390621e-01];
L2I_L1I_iGABA_netcon = [+5.385138064963227e-01   +4.557677648580896e-01   +4.060853444475988e-01   +7.616036327932868e-01   +4.255865455893158e-01   +3.163955215051830e-01   +3.229637190200661e-01   +4.391613823086060e-01; +3.182241331197414e-01   +5.591623134372574e-01   +4.098411343920196e-01   +4.382121416824933e-02   +5.389084737034731e-01   +6.078244257612915e-01   +2.227118956805617e-01   +3.674985296493952e-01; +8.109236641501248e-01   +1.067163637356870e-01   +4.003287079348742e-01   +3.537448447388905e-01   +8.735795818933970e-01   +4.520530443261303e-02   -4.118245906151501e-02   +4.696525362605548e-01; -3.107283841191181e-02   +4.995979325441528e-01   +6.704479576849426e-01   -4.346686256818499e-03   +5.707744144715786e-01   +8.217365409423182e-01   +1.329173174393575e-01   +3.471285312618640e-01; +7.184757272014838e-01   +5.533061461951619e-01   +8.585591854496195e-01   -3.104445359272600e-01   +9.901405081244620e-01   +5.947418111538321e-01   +6.265605848119761e-03   +7.801245269045954e-01; +5.693697038721532e-01   +8.976114465528244e-02   +5.937220843087126e-01   +4.822380215501839e-01   +6.213090086838111e-01   +4.103174154092424e-01   -1.867291741649078e-02   +8.151437469777520e-01; +2.612264543161188e-01   +5.916834350972145e-01   +8.521819330104063e-02   +5.266567209263363e-01   +5.939225787512638e-01   +3.132801503602614e-01   +3.065622042371537e-01   +8.489733913400097e-01; -2.565833554744689e-01   +7.544657909501592e-01   +2.207026495470553e-01   +2.010152417729105e-01   +6.715064108170082e-01   -6.833041044368393e-02   +5.498964562201253e-01   +2.211393578777999e-01; +5.759104053424743e-01   +6.488710335908541e-01   -8.399334473732697e-02   +3.394284145920157e-01   -6.847278781466222e-02   +4.822410266252199e-01   +4.733624824598013e-01   +7.601636204030879e-01; +3.532363601075955e-01   +5.507417326735387e-01   +8.245796218280556e-02   +2.957884694999800e-02   -2.131387953095685e-01   +8.117353368556758e-01   +1.106543026333799e-01   +8.529875134839021e-02; +2.940075947532484e-01   +7.192648803792584e-01   +1.000000000000000e+00   +2.963882760732577e-01   -5.148683351418532e-02   +4.730121437434228e-01   +1.290164161731602e-01   +3.555175227834714e-01; +2.497191026893980e-01   -4.038914348142339e-02   +4.483530699057064e-01   +7.040911573749697e-01   +3.724934447338020e-02   +3.731354101080149e-01   -1.639777063734697e-01   +9.845466198573370e-01; +8.716693689640892e-01   +4.634456173980603e-01   +6.197181821098361e-01   +3.119620783310629e-01   +9.023600641849461e-01   +6.722998206631314e-01   +3.925382138026321e-01   +6.540068579086533e-01; +4.624700643940536e-01   +5.299786467520468e-01   +1.598825397702575e-01   +5.302069307901653e-01   +2.831487510316428e-01   +4.185784531303178e-01   +9.283565690898984e-01   -2.720512481572758e-01; +5.941812237119701e-01   +1.599147531337737e-01   +7.262181853439166e-02   +9.120596315895710e-01   +4.111680940436339e-01   +7.219328798903653e-01   +6.720504497045074e-01   +4.449171975676247e-01; +1.884825326489578e-01   +2.932164331517457e-01   +2.392669344258987e-01   +2.337936883323211e-01   +4.070557968341280e-01   +6.286183581481261e-02   +4.558681948925207e-03   +2.442090460020970e-01];
L1I_L2I_iGABA_netcon = [+4.410534613292608e-02   +4.083723278918276e-01   +2.952325830411057e-01   +2.482184107842335e-01   +2.579357993829042e-01   +7.749010777900809e-01   +2.327273847765974e-01   +3.936452189828061e-01   +3.444411607910228e-01   +7.852961481600732e-01   +2.937589569155792e-01   +1.411968666550505e-01   +4.736968684986166e-01   -2.001182826517335e-01   +1.374328502440609e-01   +6.187993215704158e-01; +5.744749827457665e-01   +8.247538638685954e-01   -7.104275307693360e-02   +6.903360194647724e-01   -5.276660141776410e-02   +2.003429668189176e-01   +8.035626729479306e-01   +6.140714451263782e-01   +3.493054913992559e-01   +5.690545533411081e-01   -1.575737472898549e-01   +3.529305625713389e-01   +1.204267952568431e-01   +2.325578175849750e-01   -2.879351995932570e-01   +4.267609229691193e-01; +3.369320779926125e-01   -9.995689160797373e-02   +1.031361778251336e-02   +7.135477703802373e-02   +7.998761583821258e-01   +6.900716339959242e-02   +2.344325080770738e-01   +2.807500598433738e-01   +3.309084004547456e-01   +8.677467834755752e-01   +8.509241980106094e-01   -7.080636155099929e-02   +3.176939776984486e-01   +7.773745568072138e-01   +2.702139626958773e-01   +5.907231378389257e-01; +7.860799943275649e-01   +3.976729827677110e-01   +3.393576097689965e-01   -6.453458254091918e-02   +6.575968621080722e-02   +9.332133778292743e-01   +2.870523043866521e-01   +4.807381765207192e-01   +4.217810691308167e-01   +2.819481846733223e-01   +5.103053285456134e-01   +6.179486916456923e-01   +2.406782466649241e-01   +7.622803924091186e-02   +3.918357847079053e-01   -2.584274396515219e-01; +6.290437159158514e-01   +5.669119978687338e-01   +3.510285466097931e-01   +4.493704640404258e-01   +4.376183004570774e-01   +6.260211165036152e-01   +2.944483633063978e-01   +1.811965270713075e-01   +6.386920232622949e-01   +3.908648275687135e-01   +5.995080021456571e-01   -2.847534518018904e-01   +2.006709155462650e-01   +5.591108413738898e-01   -2.783281973038507e-01   +8.219490703062380e-01; +1.000000000000000e+00   -3.343931655665509e-01   +5.777531137203586e-01   +1.382227590863634e-02   +6.513130928250136e-01   +4.281249726394182e-02   +6.393791285183300e-01   +3.162718759272962e-01   +4.186997409938253e-01   +1.138508075127328e-01   +2.036164913024654e-01   +2.207657414936491e-01   +2.769474831194822e-01   +6.474015684482189e-01   +3.121264167407305e-02   +4.852413450569900e-01; +2.556182439002937e-02   +4.590006544719210e-02   +1.692637090599646e-01   +5.468114233290423e-01   +3.059844911783869e-01   +2.240824655802096e-01   +5.209952445434345e-01   +3.700781367154646e-01   +3.962735004215957e-02   +3.909221360935521e-01   +3.121871017431990e-01   +4.421255359906601e-01   -2.741447341579418e-01   +5.924969214829322e-01   +4.241851912616122e-01   +4.550392974819066e-01; +7.823798412954169e-02   +6.163745055402962e-01   +6.982960323693910e-01   +5.049584597166072e-01   +2.781741781277791e-01   -1.477362301217621e-01   +6.406760739315304e-01   +3.248265030528935e-01   +6.769905857035107e-01   +6.007485899592049e-02   +1.249707890399091e-02   +3.064060618153980e-01   +4.148661008866607e-01   +4.316303183467252e-01   +7.846272138211564e-01   +7.760858279733377e-01];
L2E_L1E_iAMPA_netcon = [+4.471414585280591e-01   -9.580721634025711e-02   +8.559420796262162e-01   +2.827232130344208e-01   +6.893375355203059e-01   +6.839379242356917e-01   +5.738290631788320e-01   +9.145755670812292e-02; +3.934773626327783e-01   +3.828322677584995e-01   +5.386257079508745e-01   +7.566605683646423e-01   +8.713203834620842e-01   +3.623302507424249e-01   +1.924473550855457e-01   +7.619761009696251e-01; +7.501065673584075e-01   +7.102542858801538e-01   +3.928263852116676e-01   +2.645908994743822e-01   +4.105176860370177e-01   +4.430418888120296e-01   +6.168131066157149e-01   +2.690793977016172e-01; +5.161373767590515e-01   +3.065484077163225e-01   +2.116812033852987e-01   +3.776493823837739e-01   +6.250053265053463e-01   +2.606827054734101e-01   -1.552334942367712e-01   +5.637227337522810e-01; -9.998435182202146e-02   +8.410118205434337e-01   +2.012962384803585e-01   +2.504228197955075e-01   +3.052152712041775e-01   +3.627687120625041e-01   +3.751485339316196e-01   +3.393521375658767e-01; +8.127403377064801e-01   +2.012073122764945e-01   +6.228457819466160e-01   +3.212308882508182e-01   +1.183670149551089e-01   +9.051855346667902e-02   +3.532867790060181e-01   +1.000000000000000e+00; +1.474862421052446e-01   -7.867809161447911e-02   +5.571136243430648e-01   +7.007470713918132e-01   +5.502803328695240e-01   +9.056657132673383e-02   +3.971976911010476e-02   +3.592207374567670e-01; +3.166349640984779e-01   +4.418700660583018e-01   +5.427002872865700e-01   -2.116874292708766e-01   -1.917927138021908e-01   +7.813548274532746e-01   +6.252649341871473e-01   -6.396690086391761e-02; +1.467643564655872e-01   -4.435042177753196e-02   +2.398228991050393e-01   +1.205537639931966e-01   +6.309672417570691e-01   +5.366482499623446e-01   +1.306639868358935e-01   +7.019504587293406e-01; -1.679200857917305e-01   -2.855513733357410e-01   +2.552306647859861e-01   +6.414526242968760e-01   +5.883742257476070e-01   +5.676136626853815e-01   -2.546184824307198e-01   +7.439541634005268e-01; +2.896124574583750e-01   +6.356411598140435e-01   +1.931032736307215e-01   +8.104202616944083e-01   +2.501553166413977e-01   +7.274383006138065e-01   +6.044740036778201e-01   +4.823284905042525e-01; +3.376693987822806e-01   +5.557883603796058e-01   +4.094519342218754e-01   +3.196689194316845e-01   +1.446083710456076e-01   +4.746280118518173e-01   +1.422365222495911e-01   +3.408569164405820e-02; -2.904710285643122e-01   +9.128582758777811e-01   +5.321165188340741e-01   +7.305089193724649e-01   +6.279038382888432e-01   +8.668947200959456e-01   +6.208265373928579e-02   +5.350807245978213e-01; +3.521556488388935e-01   +5.697065044581647e-01   +1.545205773168014e-01   +6.957354309813993e-01   +9.383875332810937e-01   +7.704812627505793e-01   +3.163317862095497e-02   +5.233004458601781e-01; +6.589247559635755e-02   +6.179731593026020e-01   +1.161761126929243e-01   +5.119926943708715e-01   -2.704201644833090e-01   +3.582007186605460e-01   -3.088206020955195e-01   -2.330759913877695e-01; +6.415338148938248e-01   +1.972773633907033e-01   +8.980488203285426e-01   -1.228495821307647e-01   +6.510466834617038e-01   +1.950185860095784e-01   +8.413394688130761e-01   +4.532480624985481e-01];
L1E_L2E_iAMPA_netcon = [+3.870297353003012e-01   +5.931877797261941e-01   +8.919365557781376e-01   -8.104947504044234e-02   +7.089971143426539e-01   +4.459771686348885e-01   +6.355118399662693e-01   +8.623817927806182e-01   +5.867231281727078e-02   +2.551992714860705e-01   +6.278942976785830e-01   +8.804504339820928e-01   +2.981569354887239e-01   +1.921545489748138e-01   +4.478721724843853e-01   +5.188257232293912e-01; +9.443021371090164e-01   +6.178302056171601e-01   +6.242038553966708e-01   +4.722091102263525e-02   -2.862031460433530e-01   +2.711251226883569e-01   +1.528202564809275e-01   -3.323877984810687e-02   +2.913190071059266e-01   +8.743217427988821e-01   +3.983686074607707e-01   +9.439966760225030e-01   -1.671491803478683e-01   +6.450035003426527e-01   +4.144938707735282e-01   +1.661189122290342e-01; +5.215276975104595e-01   +9.354191014037158e-01   +2.740639501594433e-01   +1.240552575258696e-01   +2.537186877372499e-02   +3.572205053399031e-01   +4.151942037815639e-01   +1.000000000000000e+00   +3.193105356364507e-01   +9.116180897567566e-01   -3.230348376986585e-01   +4.293580998510956e-01   +1.587426073275069e-01   +8.771051979885727e-02   +7.243036027364884e-01   -3.246994221065135e-02; +5.199104439166101e-01   +2.731568141695597e-01   +3.638332686228258e-01   +3.936789155053524e-02   +4.133912161391268e-02   +4.346176152289328e-01   +6.980055331008731e-01   +3.267603015800977e-01   +3.740903821527964e-01   +8.798096387760185e-01   +3.843543400177197e-01   -1.029328097123029e-01   +3.522042327947278e-01   +5.920018384304880e-01   +6.453539264119125e-02   +5.080621205341827e-02; +2.108236192093512e-01   +2.518634851015414e-01   +6.121588926087914e-01   +1.340926848238711e-03   +5.239117062862835e-01   +3.875342651982798e-01   +6.440617634416135e-01   +2.624851310444656e-01   +4.904026363709302e-02   +8.608295450386354e-01   +4.484444266890601e-01   +1.247664095616567e-01   +4.939880067273619e-01   +8.030263752875430e-02   +5.495694091975918e-01   +5.065168623149674e-01; +2.215666116677771e-01   +3.184245308931025e-01   +5.216496364136251e-01   +3.251516729318789e-01   +5.614440939794157e-01   +1.824032641742561e-01   +8.694129391256573e-02   +3.043377098645706e-01   +6.343593063802602e-02   +1.527908984659747e-01   +7.663136076968424e-01   +5.569883146648540e-01   +5.992664799486519e-01   +4.852015765432426e-01   +9.417431918832477e-01   +4.046280571917246e-01; +3.430796424812268e-01   +6.406891434154520e-01   +5.763768561450467e-02   +2.676117746459857e-01   -1.371529673113476e-01   +2.163205178525288e-01   +4.530728230328693e-01   +1.827293067643765e-02   +7.950193711752769e-01   +4.990725117541399e-01   +5.024663905339117e-01   +1.035131211866431e-01   +5.637328556056641e-02   +6.215275256271062e-01   +2.527663168385597e-01   +1.177126545835614e-02; +1.433754274724258e-01   +8.278049793954882e-01   +1.338137666553574e-01   -2.130688129360876e-02   -8.758205137981843e-02   -7.187041953801268e-02   +6.852707492268106e-01   +3.447485689814162e-02   +2.270418634083640e-01   +5.356530225521706e-01   +9.530835369149848e-01   -2.187029222759839e-02   +2.719677325992720e-01   +4.314447043848972e-01   +9.167326060090081e-01   +5.842326928475685e-01];
L2I_L2E_iAMPA_netcon = [+2.893073095668614e-01   +2.602359448894697e-01   +4.369808976677951e-01   +2.579175445015166e-02   +4.278938823359849e-01   +1.821625239881438e-01   +3.528284300072799e-01   +2.463760132849017e-01; -7.061298009809450e-02   +1.054713087271593e-01   -4.709008029821405e-02   -1.246550952617194e-01   +2.815775950627499e-01   +3.104914410810616e-01   -2.496640393955065e-01   +8.184409853214658e-02; +7.535116946922037e-01   +7.616949448148154e-02   +4.008725743159570e-01   +1.485149044870110e-01   +7.997026143719909e-01   +4.976796294568051e-01   +2.709713693909870e-01   +1.139806026438162e-01; +8.607341097673786e-01   +4.598856868500909e-01   +2.908942011222164e-01   +2.144907192118186e-01   -2.192644017324630e-01   +3.537233799790121e-01   +1.530775620353809e-01   +4.498186685318857e-01; +4.686799354587582e-01   -9.888338485809615e-03   +1.216768052483388e-01   +1.000000000000000e+00   +6.144984111066298e-01   +5.025143407812240e-01   +8.459237600374345e-01   +4.702732847164765e-01; +1.012287970123466e-01   +9.237218377642518e-02   +3.073546533761861e-01   +4.614438656685110e-01   +2.679174604685504e-01   +7.644560331217053e-01   +2.647220445642489e-01   +4.962148895570530e-01; -1.846402917029548e-01   +3.304679237871584e-01   +3.379432879881726e-01   +3.195718494365528e-01   +2.877675853080074e-01   +3.883385060559331e-01   +2.240056345731416e-01   +7.567758540627471e-02; -7.278241449958391e-02   +2.137449261941776e-01   +7.401647856331371e-02   +2.288626699910870e-01   -1.222228026181124e-01   +8.180105362213710e-01   +6.199271084328365e-01   +1.601973113301733e-01];
L2E_L2I_iGABA_netcon = [+2.397179197206290e-01   -1.877750206811282e-01   +6.550002184762929e-01   +5.372141545990731e-01   +1.708088760566107e-01   +2.592506812793374e-01   +3.479667515556151e-01   +6.674699220113360e-01; +5.668432219085622e-01   +3.162028938935795e-01   +4.585023314162679e-01   +8.996397781409905e-01   +4.751368880210404e-01   +5.871278084639571e-01   +3.301459926993874e-01   +4.466220161944501e-02; +7.153599545313539e-01   +3.127972995704497e-02   +5.414973769308857e-01   -2.094762140653470e-01   +7.564774011643137e-01   +3.003877502595585e-01   +7.735199912533587e-01   +2.935154005202660e-01; +4.129808596898432e-01   +1.000000000000000e+00   +3.851020854244223e-01   -1.717339788593537e-01   +1.776546136770857e-01   +7.976598680729281e-01   +3.399009408267024e-01   +3.532627341744305e-01; +4.613394108956645e-01   +7.089980096076824e-01   +6.291284450806252e-01   +5.447769784849923e-01   +3.557942586669641e-01   +6.161017551841773e-01   +2.013424187082772e-01   +3.011649375131378e-01; +7.062910590872891e-01   +5.419724780660936e-01   +5.918516903532766e-01   +5.587800957644271e-01   +5.365431070254305e-01   +2.003074489355529e-01   +2.442760289937943e-01   +4.124442166886244e-01; +5.038751914209589e-01   +5.715383167353780e-01   +7.542173124645296e-02   +3.076513488562634e-01   +5.948038077958675e-01   +2.198705101785924e-02   +3.080308041874497e-02   -3.036296903268635e-01; +1.728049263144655e-01   +4.283453986164455e-01   +6.948521361737720e-01   +3.218723203559787e-02   +2.321128935539403e-01   +1.899363709702184e-01   +5.597777556427315e-01   +2.751368675853332e-01];
L3E_L2E_iAMPA_netcon = [+2.813107307258005e-01   +7.086050798161605e-01   +2.162943435849419e-01   +2.057763949843890e-01   +6.378915053411871e-01   +1.790760698426338e-01   +3.522144080140774e-01   -6.190891536798483e-02   +1.971333575536935e-01   +1.741964888126653e-01   +6.696431406714748e-01   +2.433764966579120e-01; +4.698580522869872e-01   +5.726130440184010e-01   +7.669300730726467e-02   +5.637059230657674e-01   +4.043428861744602e-01   +7.019632254651994e-01   +3.224413084837193e-01   +4.269570120270025e-01   +2.745405571027842e-01   +5.926052012997644e-01   +7.638466989841866e-01   +2.436218009621875e-01; +3.107133661785542e-01   +8.681455975690526e-01   -1.710639510372259e-01   +2.992086494881275e-01   +9.392063276908204e-01   +1.023637664114246e-02   +3.331425453459849e-01   +7.239187055345819e-03   +7.211111257688236e-01   +5.033454814363876e-01   +1.450213420562329e-01   +2.908870338776284e-01; +3.321785643599324e-01   +6.345546104080786e-01   +4.522555847938085e-01   +4.477742446288281e-01   +5.726545779700412e-01   +4.013066559161804e-01   +4.853864245522229e-01   +6.429786578610135e-01   +4.932075932116867e-01   +7.889185835161753e-01   +3.344450622057649e-01   +3.512035431054816e-01; +3.876236803677725e-01   +1.209659751303429e-01   +5.404796712881385e-01   +6.877735601594767e-01   +2.573939888634768e-01   +9.693857504911959e-01   +6.597668791312709e-01   +5.919257307582517e-01   +6.067420702605075e-01   +7.314734825957611e-01   +8.760157709721544e-01   +5.025121724779006e-01; +2.447781580782124e-01   +5.636853480514783e-01   -1.515554698879406e-01   +2.954437628841833e-01   +5.645046885047328e-02   -3.891612437978142e-03   +3.026624370866846e-01   +5.454597444404364e-02   +7.109252352365517e-02   +5.358999854622499e-01   -4.279866809092692e-02   -2.092553712479957e-01; +7.155422978584673e-01   -2.563910257580073e-01   -4.117215291870008e-02   +6.312819465079006e-01   +5.228572313493753e-01   +1.736666702960296e-01   +4.684621834492296e-01   +4.385352184682341e-01   +4.590294971529649e-01   +6.972552987873675e-01   -7.762559691803170e-02   +1.802196576112876e-01; +5.594714854838302e-01   +5.901573780464691e-01   +8.350366715467534e-01   +7.877533985884497e-01   +2.058383032711127e-01   +1.655167603715232e-01   +4.792283840800581e-01   -2.777935859170164e-02   +6.226093376190006e-01   +3.423504447828267e-01   +3.739701823323340e-01   +8.417492517271409e-01];
L3I_L2I_iGABA_netcon = [+4.504085337298667e-01   +3.059046472051256e-01   +9.763443940196141e-01   +2.340025417329350e-01   +3.534392582586693e-01   +4.291818185903560e-01   -3.032309673094100e-01   +3.920907296836988e-01   +6.797511363842058e-01   +6.932358799550620e-01   +4.106452593194094e-01   +1.143898589815159e-01; +4.212216867192791e-01   +3.273722508204158e-01   -2.524761816599580e-03   -1.239125199869719e-02   +8.940298845216585e-01   +4.666000969749979e-01   +7.439143836657779e-01   +3.020072296641698e-01   -6.140325332875841e-02   +2.754051079392554e-01   +3.662956651768638e-01   -6.156273684778371e-02; +7.577224604216535e-01   -1.563883240083744e-01   +2.587875700999893e-01   +7.795484973160562e-01   +2.578837794729313e-02   -1.961365457999540e-01   +5.939704591370036e-01   +1.103340497662862e-01   -1.285555138704766e-02   -2.723649138217328e-01   +3.019075459835948e-01   +9.527480480530491e-01; +3.291663437020092e-01   +6.251023182839742e-01   +1.415801952280351e-01   +3.064500680250755e-01   +2.818171803636980e-01   -2.278238432698582e-01   +5.016570595686474e-01   +7.512523601329819e-01   +4.120681434998596e-01   +3.186489099270031e-01   +4.538292728108018e-01   +6.353118011853557e-01; +2.460589164404597e-01   +7.645137462555844e-01   +7.571669866320005e-01   +1.534976576310746e-01   +4.299768360843789e-01   +1.360388342007208e-01   +7.738323147093376e-01   -2.601230360817278e-02   +2.954575437025722e-01   +1.822515711956082e-01   +5.908897131478394e-01   +7.201275459353504e-01; +7.542270825128546e-01   +7.105444397750535e-01   +4.489602333398385e-01   +4.543330981881338e-03   +7.245659609816587e-01   +3.434117265721643e-01   +6.093069238145242e-01   +2.241401679293623e-01   +6.022086825016059e-01   +9.197762185321263e-01   +5.089127393069723e-01   +8.704810861876120e-01; -1.872038886983850e-01   +4.864898230339263e-01   +5.067695321180045e-01   +2.327796984448281e-01   +7.540203539326726e-01   -7.576941287264635e-02   +6.722645586266689e-01   -2.053117768008558e-01   +9.301224697551700e-01   +3.151832624800966e-01   +6.629652894510235e-01   +5.655513688093556e-01; +2.625687682595779e-01   +4.591036446343805e-01   +3.446751668995315e-01   +4.454819213446560e-01   +9.307591592374911e-02   +4.465679594301682e-01   +4.053639036771089e-02   +3.333276395985242e-01   -4.464652741955999e-02   +7.933518202013229e-02   -1.503394875962985e-01   +3.859252209323497e-01];
L2E_L3E_iAMPA_netcon = [+1.224836637995481e-01   +4.029611943482422e-01   +2.341378146701023e-01   +1.055607822235034e-01   +3.647467801895288e-02   +3.626269243948826e-01   +7.488035856027286e-01   +8.558241618195959e-01; -1.349151950943989e-01   +6.802146470854131e-02   +1.952767172432993e-01   +2.381229131997527e-01   +9.967392976264280e-01   +2.498059204103941e-01   +3.424223371536405e-01   +9.729232592351061e-03; +2.590773545013026e-01   +8.536690640360414e-01   +7.477221581848259e-01   +2.467205482920210e-01   +6.123431385567195e-01   +1.161462535347104e-01   +6.800331224503708e-01   +7.136636956085036e-01; +4.343954363284447e-01   +6.177259648232417e-01   +1.832137504599834e-01   +7.210522177070962e-01   +5.175884579594963e-01   +4.844037962524974e-01   -1.023532472937134e-01   +1.888855088330593e-01; +9.921968806577141e-01   +6.875342336036472e-02   +7.745960358050172e-01   +4.658768623617324e-01   +7.421840262973303e-01   +8.101774587580481e-01   +6.391031843635951e-01   +3.106669162238311e-01; +7.833059317386215e-02   -4.167091020228308e-02   +2.425244368177064e-01   +2.670451140655661e-01   +3.423484787687545e-01   +2.042430543334620e-01   +2.684402959604331e-01   +9.788923354365299e-01; -1.831073244064629e-02   -1.317994552444431e-01   +1.384479824176643e-01   +2.004403309413029e-01   +3.803194409326683e-01   +6.912596796657203e-01   +1.038268547861840e-01   +8.498956438539100e-01; +6.325373812162958e-01   +8.143502228889343e-01   +9.428963703849812e-01   +6.191384335610839e-01   +3.537119565533033e-01   +3.463682264355479e-01   +9.877149989159986e-01   +2.210252350886607e-02; +5.635363169067337e-01   +9.761837000637863e-02   +6.477565665774485e-01   +4.389463769758578e-01   -1.388419232543389e-01   -1.603860247685862e-01   +3.495121926379656e-01   +7.954723804890249e-01; +7.121687258086606e-01   +9.453405506765307e-01   +3.347306315997154e-01   +4.732956116911932e-01   +3.126630793301234e-01   +7.627916017602240e-01   +4.333707847200096e-01   +2.758434787229422e-01; +5.117983868558740e-02   +3.676626816342525e-01   +4.176544699784449e-01   -1.271584217650188e-01   +1.259607428610282e-02   +3.536183299614458e-01   +1.765546634458728e-01   +8.034395074771775e-01; +5.638867596756499e-01   +4.505166253803523e-01   +7.449507536831477e-01   +1.594579311737505e-01   +3.071377546141140e-01   +2.393286250312922e-01   -2.179019512177254e-01   -1.620364934327718e-01];
L2I_L3I_iGABA_netcon = [+9.478969216303569e-01   +5.195821387966643e-01   +6.369551681423615e-01   +2.667678828830674e-01   +6.330021312506324e-01   +5.087927146959471e-01   +8.402698539359760e-01   +1.579817954929173e-01; -1.885855143194315e-02   +2.685545333447351e-01   +7.896443736209914e-01   +5.129551568932494e-01   +4.016182437873415e-01   +3.722629595417579e-01   +6.245142993917085e-01   +1.000000000000000e+00; +3.240293719428681e-01   +2.729546186908904e-01   -8.739335610178536e-02   +5.634779873352710e-01   +3.953432828865041e-01   +3.041721434777224e-02   +4.298232382966857e-01   -2.925332580834338e-01; +4.545862599586125e-01   +1.253608256137015e-01   +3.812178925288585e-01   +5.715227593985715e-02   +3.907979932693241e-01   +9.789972510913482e-02   -1.367905109595468e-02   +4.937289599355930e-01; +4.877251343023015e-01   +4.222595272052953e-01   +3.984110009667844e-01   +3.101396810741985e-01   +3.799764779432028e-03   +2.800893686069562e-01   +4.094455569689170e-01   +1.499834552814659e-01; +2.994295102431148e-01   +6.425289135785435e-01   +1.268663337213440e-01   +5.998130650302070e-02   -8.808017976567302e-02   +7.875032204283661e-01   +6.068414419449409e-01   +4.114005673184190e-01; +2.192069237023290e-01   +4.779943022484021e-01   +5.361305465600342e-01   +8.929506650070809e-02   +1.143938905278300e-01   -2.098911953195733e-01   -2.332687088842659e-02   +5.684253871962449e-01; +1.312765701040835e-01   +7.395925913101588e-01   +8.372106101024802e-01   +1.673751486017907e-01   +6.581432645701280e-01   +2.159603084254693e-01   -2.084131007939189e-02   +6.003739925887177e-01; +1.443222211339281e-01   +5.292081691909212e-01   +5.066107100400170e-01   +2.695380041546531e-01   -4.690592172089986e-02   +3.705455576387708e-01   +7.132364438245167e-01   +4.898619454646739e-01; +1.741017863177180e-01   -1.303645710735276e-01   +1.898865599090503e-01   +8.140197206289080e-01   +2.524372150724708e-01   +6.411434128536446e-01   +5.377271597515840e-01   +4.314975360377253e-01; +1.096091112108255e-01   +6.542260667817731e-01   +4.336158389729619e-01   +4.199026376709007e-03   +9.347508327654769e-01   +2.369896488064811e-01   +5.928881626182985e-01   +7.951590459891942e-01; +2.119415349419223e-02   +7.003498704328466e-01   +5.291132219850069e-01   +5.373928211015048e-01   +2.838981347212360e-01   +2.336011610468963e-01   +7.589269665431718e-01   +3.692470620766567e-01];
L3I_L3E_iAMPA_netcon = [+6.676050847991699e-01   +3.858250061647137e-01   +4.390131503849103e-02   +2.980439228356283e-01   +3.011146159212027e-01   +3.729229535668473e-01   +2.732044562264457e-01   +5.095950613885726e-01   -1.927843522178825e-01   +7.696018518737953e-01   +4.110301228664015e-01   +5.065577689180885e-01; +2.467252905194559e-01   +6.069610885813713e-01   +7.026038667023112e-01   +8.886980899468433e-01   +4.918425216152780e-02   +7.530477749838967e-01   +7.107234687226743e-01   +5.335811977383927e-01   -4.549064267358410e-02   +5.310190948054743e-01   +6.847616244236371e-02   +9.396364079129107e-01; +3.340848147710983e-01   +3.968615245458324e-01   +2.023426120205502e-01   +5.459171076965335e-01   +2.103400631104516e-01   -9.780714993892270e-02   +1.467627491744437e-01   +1.894498494988507e-01   +6.231850960124948e-01   +4.195924322427483e-01   +2.509643212838818e-01   +5.795351590073010e-01; -1.412183424477578e-01   +5.424133869004347e-01   +9.429229656597528e-02   +1.449538156721865e-01   +9.568209082442981e-01   +3.096526705674843e-01   +3.557217420754729e-01   +4.177524989108590e-01   +8.982966448107869e-01   +5.373286975854957e-01   +2.717983411298098e-01   +2.232632467684624e-01; -4.036454589087894e-02   +1.043031880473997e-01   -3.170412743614831e-01   +2.521365494886417e-01   +3.209021563725108e-01   +7.773008909420552e-01   +3.867836722931905e-01   +4.940502216186386e-01   +3.372778669998977e-01   +6.276591249094107e-01   +4.786856242833247e-01   -3.975865593732444e-02; +4.604050980286851e-02   +4.966552265882310e-01   +5.460665210509464e-01   +1.231450274161305e-01   -8.948583243713137e-02   +7.651355328698701e-01   +2.558730464135174e-01   +8.355785923840827e-01   +6.557779447140007e-01   +4.874933098133564e-01   +6.873012154145621e-01   -1.694787572822982e-01; +2.604494238624427e-01   +4.992287129239678e-01   +5.271722583056367e-01   +2.473939921299348e-01   +1.344343134191334e-01   +1.000000000000000e+00   +6.698712268351761e-02   +8.474817380678230e-01   +1.720504216787359e-01   +8.043670394869467e-01   +3.425849191732658e-01   +6.100135157742514e-01; +3.469991494200593e-01   +1.941996556326728e-01   +5.632753680584668e-01   +5.809681083727140e-01   +5.587069921895726e-01   +6.153447824519108e-01   +3.149876121552723e-01   +6.017278310587570e-01   +4.171340391640612e-01   +8.380971570838454e-01   +5.080639714894792e-01   +1.331186149325379e-01; +2.719504214151162e-01   +7.201150964393856e-01   +8.659243274061523e-01   +2.086919192101648e-03   +2.409506648001774e-02   +3.112159016128926e-01   +3.133239603981152e-01   +3.334806691443139e-01   +4.538539321628897e-01   +9.159976778264049e-02   +2.290639751800135e-01   +6.532233902335232e-01; +4.055953299305307e-01   +6.514762859699179e-01   +2.327757161405637e-01   +4.850656683531454e-01   +5.739311750462641e-01   +1.815865835478168e-01   +8.164711987094704e-01   +2.439229084276722e-01   +1.951970616989415e-01   +5.941602409340292e-01   -1.394591466043558e-01   +4.623246865901001e-01; +7.773555576576066e-01   +6.223896083330797e-01   +4.185884837076675e-01   +5.249701380469636e-01   -2.127332178492922e-01   -2.162275360490764e-01   +3.167131870800100e-01   +2.123395539897430e-01   +8.706877211393417e-02   +5.463027558995592e-01   +3.791570193947822e-01   +1.256416551544437e-01; +5.131745653057092e-01   +4.047376168831602e-01   +5.203860635702741e-01   +3.841231496949561e-01   +6.303748421290009e-01   +2.494742712441398e-01   +4.485532347435039e-01   +8.569079630822606e-01   +3.654889244476642e-01   +4.945775373403584e-01   +3.137414761818419e-01   +8.909474432790296e-01];
L3E_L3I_iGABA_netcon = [+5.980643823777049e-01   +1.700675466872682e-02   +3.829571509663848e-01   +7.717196099038015e-01   +7.539847138906154e-01   +4.684054732877945e-01   +1.467099562744422e-01   +4.458827687039705e-01   +2.615956251262927e-01   +1.245055940142182e-01   +1.940127917303927e-01   +8.660848393708259e-02; +3.084368261756076e-01   +6.677297614572614e-01   +7.349775872128951e-01   +7.289514723933335e-01   +2.907480502718903e-01   +4.599213363970419e-01   +6.917389682371506e-01   +2.715956878969072e-01   +9.464373908129058e-02   +4.285842515934954e-01   -1.016719949002670e-01   +5.183196448800775e-01; +2.000169469750024e-01   +6.481605996209522e-01   +4.807966415928177e-01   +3.447149333002864e-01   +6.838903277118183e-01   +1.034797700236629e-01   +2.779639488261531e-01   +3.859243711722388e-01   -8.918424384530713e-02   +2.712506650331991e-01   +1.801051586358721e-01   +3.742162317153898e-01; +1.000000000000000e+00   +5.440830341548444e-01   +3.588717271605522e-01   +7.093930044833870e-01   -8.446832798250849e-02   +6.240101649360229e-01   +4.745962383200663e-01   +4.757514777570125e-01   +1.355949542173678e-01   +5.705924132732394e-01   +2.873337768156602e-01   +1.438384995285157e-01; -4.135048894499304e-02   +7.524103406516776e-01   +6.375770582828156e-01   +6.710322599615007e-01   +2.874082714862476e-01   +5.934495029219703e-01   +2.394108726103689e-01   +3.398584796371366e-01   +1.350910635709948e-01   +3.775114911637176e-01   +1.200868117106113e-01   +3.000255326339814e-01; -8.982646302219302e-03   -1.658539397561156e-01   +5.961102974139556e-01   +5.452770065763070e-01   +6.934496305869976e-01   +2.887873503187866e-01   +2.034765010404428e-01   -8.164971057681783e-02   +9.775291244953788e-02   +2.327637327854043e-02   +1.027922074276815e-01   +4.537331591105640e-01; +7.291701642638362e-02   +3.965463625345779e-01   +2.810305703978554e-02   +3.037032642811195e-01   -1.976504302454942e-02   +5.674395032278645e-02   +4.979160986663388e-01   +1.931647375789647e-01   +5.651119242605455e-01   +7.313083412624570e-01   +3.873778454496791e-01   -2.037417599647335e-01; +8.431988027705535e-01   +9.509090586043295e-02   +2.191414641097762e-01   +4.537084846902597e-01   +5.334723139960846e-01   +8.101845975253437e-01   +2.240292750965384e-01   +5.400908493200250e-01   +5.257674800741415e-01   +1.810550641852967e-02   +5.132295446394319e-01   +2.944918312143036e-01; -8.736275377899133e-02   +5.054432528944038e-01   +4.797100435916792e-01   +7.996669048378731e-01   +3.904905040328360e-01   +4.809079872700953e-01   +2.976165772235413e-01   +1.311075790247740e-01   +1.513788069146950e-01   +8.707088101633648e-01   +2.184505694402668e-01   +1.199507462622920e-01; +3.890248958000624e-01   +3.931679971329055e-01   +8.095114790298032e-01   +3.045272884635259e-01   +1.800380136155462e-01   +3.740185701307905e-01   -5.266288620000328e-02   -2.837245330127980e-02   +8.145482891151801e-01   +5.080215661915887e-01   +1.431922434172044e-01   +3.310414217874682e-02; +4.590281844177276e-01   +7.054312671797123e-01   -1.705005123973371e-01   +6.176213258903783e-01   +7.220225847938605e-02   +2.126597283627880e-01   +3.123077390530922e-01   +6.120365032785864e-01   +1.216558156050916e-01   +7.534184693099760e-01   +2.613493960675076e-01   +5.175806820500769e-01; +1.834015426137186e-01   +4.359241190304246e-01   +1.589223363592114e-01   +2.410127119121478e-01   +5.178398655206066e-01   +3.329897010955228e-01   +6.469557937182302e-02   +4.245027920187391e-01   +5.086068424457101e-02   -4.115152971616345e-02   +2.263044188203298e-01   +1.399635696896745e-01];
L2E_Input1_iAMPA_netcon = [+4.863959342520944e-01   +2.947036585990105e-01   +5.277088367951729e-01   +1.490992058536996e-01   +4.717924363847420e-01   +2.418256152241533e-01   -1.594013953806019e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [-9.786442030022691e-02   +9.616233067511472e-01   +1.499918829125775e-01   +7.255769726155653e-02   +3.364103590363079e-01   +2.171100679778953e-01   +5.669910774260247e-01   +5.277762353456706e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
