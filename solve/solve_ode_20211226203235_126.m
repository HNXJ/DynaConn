function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-9.284247376159814e-03   +1.397893966245931e-01   -8.453746129436276e-02   +6.968490601362461e-02   +2.102941264606385e-01   -7.782495240604784e-02   +2.434473631340113e-01   -2.536207034647796e-01   -2.579245622121573e-01   +2.927361587101021e-01   -1.109424383198204e-02   +3.933744363459081e-01   +1.191253597375326e-01   +4.374056755781671e-01   +1.002650545614124e-01   -7.441766538425139e-02; +1.433016395759430e-02   -2.251711608953767e-01   -1.192310590262674e-02   -3.320469915112224e-01   -1.202761492090758e-01   +1.143315197185852e-01   +1.351636338440773e-01   +8.646903828483669e-02   -1.745921031962259e-01   +2.958045708030441e-02   +6.670169897729508e-02   -1.128849508060433e-01   -1.679795685557096e-01   -2.709689962924149e-02   +1.456423636285510e-01   +1.995758387310199e-01; +7.664987807144126e-02   -4.291566485385002e-02   -1.586465452664497e-02   -8.806404586318264e-02   -1.400616447470811e-01   +1.735624968532000e-01   -1.188380198640772e-01   -1.582133942821989e-01   -1.146682463415604e-01   -1.679589115904696e-01   +3.381115209622758e-01   +4.907208364463453e-02   +2.336572886390412e-02   -6.115465220942275e-02   -1.371461273438883e-01   -2.579845523338955e-01; -1.240578475159346e-01   +2.065582321468302e-01   +2.659683550014185e-02   -3.139297447370475e-01   -2.508347884977376e-02   +1.496278211327173e-02   -3.765005307326597e-03   +7.829134278546347e-03   +2.800068607743310e-01   +6.155661536197644e-02   +9.911047035774757e-03   -7.310289595677896e-02   +1.169259266282631e-01   -1.032390606351138e-01   -3.739406095842805e-01   -4.003532535762261e-01; +2.616182065819882e-01   +6.199678102044183e-02   +2.489369200195024e-01   -1.548604267131095e-02   +2.919333943385390e-01   -1.899565974587806e-01   +1.601868639824344e-01   +2.335688707356944e-01   -2.383370550193969e-04   -4.412610069630338e-02   +6.020876728960144e-02   -3.099778216257613e-02   +9.985062967690103e-02   -1.953261554600763e-01   -3.832079175480448e-01   +8.934021046498428e-02; -2.212001362461365e-01   +2.242201011237288e-01   -4.515259408048269e-03   -1.074540805380869e-01   -3.920678220430109e-02   -2.616633174390944e-01   +3.292274438675728e-02   +2.210691026490222e-01   +1.891399023633931e-01   +1.400656193058191e-02   +2.329606620518894e-01   +4.065321918934293e-02   -7.510565153749493e-03   -2.652598718901554e-02   -2.135952334081888e-01   +1.437683045216999e-01; +1.031935535498853e-01   -7.890064945773013e-02   +1.348404054253969e-01   +4.442081278955977e-02   -3.513247002913752e-02   -8.704945394173995e-02   +1.301385930600481e-02   -2.036595826217739e-01   -3.552232593370414e-02   -6.927881806321057e-02   -3.365979370562001e-01   +5.735238574905321e-02   -2.636785130264881e-01   -6.540500994112997e-02   -6.648984493895994e-02   +2.754798703578633e-01; -3.854081551231023e-01   -1.535631035477058e-02   -2.554283730890650e-02   +6.988189553241761e-02   +1.608565038754004e-01   +1.025142864893695e-02   -1.456095550535117e-01   -9.026490224513850e-02   +1.636634855466417e-01   +8.195813698724221e-02   +3.953721749306193e-02   +1.878528233902297e-01   +2.284245849444375e-01   -4.957594269360697e-01   +7.609644836897940e-02   +1.424055816026550e-01; -7.055438639757822e-02   +2.323043484171274e-01   +1.770030116715586e-01   +1.154702894006292e-01   -8.984424345462978e-02   -2.719015879917913e-01   +3.115591964681590e-01   -1.454193027145344e-01   +6.341538511127270e-02   -2.250507963490986e-01   -8.468516578366200e-02   +3.092409527194502e-02   -2.280190107956960e-01   +9.526570243272513e-02   -1.063617065732257e-01   +7.155129431470680e-02; +1.503317926511139e-01   -1.054054881034316e-01   +2.485733379366718e-01   -8.156874904796808e-02   +2.822999522033565e-01   -3.636842194494711e-02   +1.745482693649172e-01   -2.272889588878820e-01   +1.767910268387899e-01   -3.453578921898243e-02   +1.286413230363894e-01   -7.234007889011503e-02   -3.163688037955042e-01   -1.105659798896359e-01   +4.228347185763901e-02   +2.099378641904353e-01; +1.554011537785353e-01   +1.055919901861955e-01   +2.129566495158810e-01   -1.044600757079292e-01   +9.576941257155198e-03   -4.872811867106257e-02   -1.397793860754241e-01   +3.209041890390520e-02   +4.101466473598613e-01   -2.833373266404915e-02   -2.257642947542949e-01   -3.239314736012887e-02   +8.695891446031463e-02   -9.885298318517699e-02   +3.938347488606054e-01   +1.714691790267285e-01; -7.808512542368118e-02   +3.343252374345435e-02   -4.891870289276653e-02   -9.886594923094141e-03   -9.137801166832087e-02   -9.750672834568627e-02   -6.976939364093906e-02   -3.369009045352464e-02   +2.605230920912971e-01   +1.648909443053762e-01   -1.920409038388481e-01   +1.744746425639213e-02   -1.775889276531434e-01   +7.863843664816095e-02   -1.437864886538179e-01   -2.000925588118058e-01; -4.768286299122687e-01   -1.385887942211916e-01   +2.162052727705434e-01   +1.129138169169812e-01   -9.874602859043155e-02   +5.527827485944456e-02   -2.639479379993604e-01   -7.958051337019111e-02   -2.995275980445577e-02   +3.492977132122845e-01   +7.324768363727856e-03   +1.770528488210062e-02   +2.271008641447407e-01   -1.011072752591211e-01   +1.533143952237106e-01   +1.244194498105441e-01; +6.852177906209567e-02   -8.099030154906470e-02   -2.616710612012958e-02   -4.483101512330324e-03   +6.382348519796184e-02   +1.749549733247275e-01   +1.229900239033936e-01   +3.604082894263238e-01   -2.545127027113594e-01   +1.883840455864772e-01   -3.514346707010349e-01   -1.486964759578310e-01   -8.299249515947316e-02   -5.366999960072322e-02   -1.671371968080890e-01   -9.399361609110657e-02; +1.141985919038717e-01   -1.815302315704929e-01   +1.816369189333099e-01   -2.064981796503156e-01   -3.784599091056419e-02   -3.443002744841372e-01   -3.914772251522029e-01   +1.301724815955984e-03   -2.265114287576958e-03   -1.425863241013393e-01   +1.343020676513282e-01   -1.922962221598387e-01   +2.087722725333906e-01   -2.234425037155836e-01   +2.802519605071585e-01   -1.213381825452855e-03; -1.101107792996382e-01   -2.405133731025930e-01   +5.701923829387055e-02   -1.273524563109217e-01   -1.936164195556532e-01   -1.849560404136538e-01   -2.462850022245885e-02   -2.153352297943795e-01   +1.437297772012158e-02   +3.346292676825966e-02   +8.653300709323783e-03   +1.601931228233037e-01   -8.267375964410112e-02   -1.396442492191670e-01   -2.435854224991139e-02   +3.920917701871766e-02];
L1E_L1I_iGABA_netcon = [-7.080531784973014e-02   -1.541676169552745e-01   -3.161746127386002e-01   -7.988622852969399e-02   -3.834619140006613e-02   -9.518329259433331e-02   +1.605333762334153e-01   +1.582853955271314e-01   -4.583207594386726e-02   +1.042944942393740e-01   -4.413830393736808e-01   +1.961331732824382e-01   -2.214622981286501e-01   -1.008135834481254e-01   +3.744465131402342e-01   +4.592137465075996e-02; -4.707274815780324e-01   -2.761872210054074e-02   +1.663224387132690e-01   +1.000911332577172e-01   -1.029694304630370e-01   -4.700644984935227e-03   +1.612515796428105e-01   +2.631085973600698e-01   -4.642076386760340e-02   +1.357684835832065e-01   -1.764096795267555e-01   -2.433329650019258e-01   +1.612069601348392e-01   -2.311044818977047e-01   -2.255888402682483e-02   -1.993252243871161e-01; +1.100608816078950e-01   +1.310240493440341e-01   +3.203027666012356e-01   +1.896202073710442e-01   +4.046508286681723e-01   -4.416805533616654e-02   +1.957891917166216e-01   -7.598054174629318e-02   +1.794922170406937e-01   -8.887199522309547e-02   -3.238942986685789e-01   -5.239794583277479e-02   +7.158318348208517e-02   -1.145285101077218e-02   -2.229278678101110e-01   -1.421734889775505e-02; -1.925838453860715e-01   +2.929626342834744e-02   -1.776923314939084e-01   -1.638867730873165e-01   +1.373007703118444e-01   +2.423244271149951e-01   +1.233806828149153e-01   -2.005632819257921e-01   -2.956697259739294e-01   -1.801617051973653e-01   +4.996212940908347e-02   -6.978943428026380e-02   +5.552471639481282e-03   -4.354978473823527e-02   -3.532206396448052e-02   +1.735930473873396e-01; +6.546511044072062e-02   -1.889942938503329e-01   +1.294526680685082e-01   +3.398681095655713e-01   +9.218632949612965e-02   +6.194910616104857e-02   -1.387362070619794e-01   +2.744579393017891e-02   +4.345829259575100e-01   +1.384246267447257e-01   -2.672157465507669e-01   -9.993051583333522e-02   +1.091125213369587e-01   +2.210052843272579e-01   +2.805146572303492e-01   -3.490427703053488e-02; -4.822029888344168e-03   +1.321493541416427e-01   -3.179392537636955e-01   -8.719345197013365e-02   -1.194793825671119e-02   +9.578763077304811e-02   -2.489664397144563e-01   -1.463464779428333e-01   -5.993960030232579e-02   -2.166511705871603e-01   -2.293296130260994e-01   -5.588346305959224e-02   -1.477515489249877e-01   +1.338980792893186e-01   -2.684389636729198e-02   -1.213756544090447e-01; +9.132624977936676e-02   -3.952251509360092e-01   -5.994625233004427e-02   +1.541094031583100e-01   -8.426270471394723e-02   +7.943548014808141e-02   +2.448182493339383e-01   -1.119531020227286e-02   +5.092582183747563e-02   -3.566868189615002e-01   +8.771057781997046e-02   -1.411519378479652e-01   +7.234171386627045e-02   +4.035730625509032e-02   -7.685893936403654e-02   +1.057317068485227e-01; +1.436760446108878e-01   +5.585261975661348e-03   -1.648132127703601e-01   +1.876729485383017e-01   +8.056019116661683e-02   +1.347816364056300e-01   -3.502605587377902e-02   +2.270453274020830e-01   -1.871108096328379e-01   +5.289602316812848e-01   -2.008641203798123e-01   +3.990253674215062e-02   +5.772185703144924e-02   -2.279679189330505e-01   -3.328315388115909e-01   -2.041261841902326e-01; +6.458649890823294e-02   -3.804419341011238e-02   -2.097335147789775e-01   -8.000351580488922e-02   +1.243072993805270e-01   +1.790353594146899e-01   -1.002619682079607e-02   -6.503298716706590e-02   +6.579889537710243e-02   -1.605851890917363e-01   +1.300181774652713e-01   +1.078317878621875e-01   -1.699249960090481e-01   -1.190636712894739e-02   +1.404424186054398e-01   -1.734332537690605e-01; -1.697992378617308e-01   +9.159884100246876e-02   +1.117537509141857e-01   -1.062424776963182e-01   -2.796140301188413e-02   +9.814185618971868e-02   -6.802817786914028e-02   +3.771712876959220e-02   -1.624504347288674e-01   -3.596060823584127e-02   +5.408615033653558e-03   -1.713541194053647e-01   -2.202697341914712e-01   -9.119050177357871e-02   -3.801546123475661e-02   +7.212586668480299e-02; -1.819044060982718e-03   -1.481082218358072e-01   -1.480949834748165e-01   -1.086967649372544e-01   +1.634391150083659e-01   -2.361665460806862e-01   +3.058062944114792e-01   +1.607339041187881e-01   +1.496676617485119e-01   +2.083168752500097e-01   +2.015589836006394e-04   -8.371836477361718e-03   -1.520933153621442e-01   -5.279532080302893e-02   +3.559181204039520e-01   +7.068977381185909e-02; +2.635983343133160e-01   -1.202901161196937e-01   +7.270136276951908e-02   +3.757158656742364e-01   -3.340225062596704e-01   -2.301726204082767e-02   -6.620665342681095e-02   -2.127076431907191e-01   +5.791606020912857e-02   +2.080542847725596e-01   +1.929476943539204e-02   -7.178747705690273e-02   +8.007720021005020e-02   +1.176445310478294e-02   -2.622657562462907e-01   +1.232716421952368e-02; -3.235701606110843e-01   -9.939135738370708e-02   -1.201683753742021e-01   +3.006736254540299e-02   +1.512934404906188e-01   +1.386917765578949e-03   +5.614963760964466e-02   +2.057316736442982e-02   +1.137561207905156e-01   -3.496349085910049e-01   +3.255873914304535e-01   -6.821416304230495e-02   +1.492590209965251e-01   -7.129845263653758e-02   +5.056352748604188e-02   -1.119182655081317e-02; +2.515536657172864e-03   -3.228486832819963e-01   +3.235320340460933e-01   -5.039369390778542e-02   -1.253019615552438e-01   -3.064545473073755e-02   +1.157435823662396e-01   +8.073807685592978e-02   -2.494456072527644e-01   +3.151511593370049e-02   -1.414521747938978e-01   -4.038384147459439e-02   -8.662481147637001e-02   +6.612870534123139e-02   -2.068600553611522e-01   -1.993579238208021e-01; -2.888644150436251e-01   +5.909467094974660e-02   -1.088351496834059e-02   +1.853309332762541e-01   -1.506938398426086e-01   +6.313701776187058e-02   -1.779292589649926e-02   -1.562070810951498e-01   -1.609506142955369e-01   +8.289485136844496e-02   +2.030955844270484e-01   -3.505481358220404e-01   -1.412264694149646e-01   +1.239490993883955e-01   +1.158741700155337e-01   -3.550715006529359e-02; -3.340139131510760e-01   +9.189564929827462e-02   +1.244181902020972e-01   +3.910413133631917e-01   +1.775497867925192e-01   -1.214046637648746e-01   +1.103806818225500e-01   +2.655910809739188e-02   +6.489314302190080e-02   +2.244306128189154e-02   +1.856059650509804e-01   +1.188558682349650e-01   +8.526175497099760e-02   -4.531949329217133e-03   +3.946289936365325e-01   +6.143774637108795e-02];
L2I_L1I_iGABA_netcon = [+1.395069111462647e-01   -6.041785487492746e-02   +1.104106513712966e-01   -2.449908227497010e-02   +9.138507476228212e-02   -1.467078550966584e-01   +2.321639488020128e-01   -6.352644328987669e-02; +8.318866322072412e-02   -1.477075813345963e-02   -2.090565867254687e-01   +2.434924435577733e-01   -4.826582051845899e-03   -3.748320237831972e-01   +7.798643609325735e-02   -1.986975034679358e-01; +1.283078321715169e-01   +3.369275964052326e-01   -7.754779501153089e-02   -6.391990780354781e-02   +1.992891543889455e-01   +1.512431621778236e-01   +1.275344693214122e-01   -2.119555672283828e-01; -1.527355588496171e-01   +9.911558468454237e-02   -4.005966524256929e-02   -9.765776888233453e-02   -2.351663316740048e-02   +2.790664964441579e-01   +3.035140059149524e-03   +3.549706058708548e-01; -7.589437956127101e-02   -1.274741578337684e-01   -6.580939207955037e-02   -8.081707944310737e-02   -3.790064433810890e-02   +1.269008338015987e-01   +4.198784658019231e-02   +3.530327594373979e-01; +4.331621974017150e-02   -4.617649315697569e-02   +1.257418411928691e-01   +2.331413179825725e-01   -2.604607949062325e-01   -2.232209641864781e-01   +2.586437421522760e-02   +2.316793088263175e-01; +6.998050901463604e-03   -2.809062604823694e-02   -7.089398607606867e-02   -2.089045639173609e-01   +2.684356118590207e-01   -2.043933408374947e-01   -1.767074986319386e-01   +1.156341569182820e-01; -2.850304380721356e-02   +3.931299560382533e-02   +2.460283166064805e-01   +6.411257269731097e-02   -1.522799310661676e-01   +3.445880521411004e-01   +1.748399135193152e-01   -1.374693835990780e-01; +1.279432263453195e-01   -3.451617033832004e-03   +2.512099136994504e-01   -1.164336776822637e-01   +2.485582683237575e-01   -1.312940413061377e-01   -1.207733882131032e-01   -3.687098751769167e-01; +3.081399094344865e-01   +1.083051125596954e-01   +1.150902869187675e-01   +1.250060600915379e-01   -1.268453468110336e-01   +1.364516767518864e-01   -4.696276467641352e-02   +1.728991134094577e-01; +3.053164431914447e-01   -1.872997559743659e-01   +2.440171004792680e-02   +1.589260918477880e-01   -7.388173888529588e-03   -1.311094224398462e-01   +3.341028667197025e-02   -1.270583914834554e-02; -1.193945128868803e-01   +2.258471712669343e-01   -1.403584309627853e-01   +2.626610841251194e-01   -7.074553762123176e-02   -1.665644530664680e-01   +2.671243478956241e-01   +1.413975496628306e-04; +2.067236750332541e-01   +9.217291447563819e-02   +2.342922718658873e-03   -7.402165441219530e-02   +4.102489574733809e-01   -7.105217604305114e-02   +1.383135863795793e-01   -1.057249563421455e-01; +2.676554521969233e-01   +1.962911560634890e-01   +1.257797326950565e-01   -4.551940610760176e-02   -1.034066417935689e-01   -1.728137427237600e-01   -2.401224661464544e-01   -2.823276890681755e-01; -3.926471942388535e-02   -3.525146418732260e-01   +1.302782608591385e-01   +1.968737114635456e-01   -6.990255574173654e-03   +3.848586859245629e-02   -1.901637654835819e-02   -5.449924903676198e-02; +3.784297647270396e-02   +3.128251168102042e-02   +2.918198935652136e-01   +2.156330512877279e-01   -1.052522427930944e-01   -1.401092176944169e-01   +3.106233532280117e-01   -1.269011181327574e-01];
L1I_L2I_iGABA_netcon = [+8.090086460360899e-03   +1.125909329991247e-02   -1.422496067943836e-01   +9.136929310426471e-02   -1.725634953954462e-01   +4.415413677205419e-02   +1.881928649486682e-01   +9.089951352090894e-02   -3.590790535109902e-01   +4.470256684602277e-02   +3.170611935182610e-01   +1.169480747286875e-01   +5.242182289488412e-02   +1.042875178978141e-01   -8.830272177583229e-02   -1.536639177901247e-01; +2.023677512243044e-01   -1.709356643414233e-01   +7.902823627710324e-02   -6.193644356945487e-02   +1.819977473009998e-01   -2.367045320540910e-01   -1.302059324073974e-01   -7.112379428779575e-02   +1.387290760371485e-02   +1.608390241619348e-01   -7.970475375215447e-02   -2.629245540215241e-01   -1.984039425368812e-01   -3.407756445566937e-01   +7.669617825818505e-03   +3.287945774758343e-01; -2.027270047028287e-01   +5.867234813019166e-02   +1.022145492455459e-01   +3.839426120800687e-02   -1.371675952380071e-01   -2.442386042220488e-01   +1.615228451505654e-01   -1.006939463105608e-01   +1.630853861098015e-01   -1.066180424303089e-01   +1.436129975147856e-01   -3.293435921152694e-01   -1.625830264617427e-01   +1.763609477868250e-01   +2.062398860478132e-01   +8.350777271590697e-02; +9.613327972737984e-02   +6.352490089722003e-02   +1.320274059479841e-01   -2.822903874697383e-01   -1.090391323641611e-01   -3.861363460085691e-02   -9.373775363657101e-02   +1.354777995093230e-01   +1.139118189989854e-01   +6.380061833549183e-02   -1.067912704635993e-01   +4.712444778223224e-01   -2.833138709667177e-01   -1.473512753243182e-01   +1.477240682665258e-02   -1.119865648495571e-01; +3.396060502493935e-01   -9.572114627146888e-02   +1.882128714107881e-01   -2.570849674855499e-02   +1.890649353640219e-01   -1.793650289976036e-01   +5.818611422339767e-02   -3.128790272452823e-01   -2.239184509646493e-01   +2.485788399560271e-02   +5.821423059824742e-03   +5.444959888627295e-02   -2.234931730947426e-01   -5.748054373045142e-02   +4.284379940921670e-02   +1.869759497375336e-01; +5.774280272020507e-02   +3.933989705201630e-02   -2.165759554644971e-02   -1.130632465482256e-01   -2.399661686251544e-01   -1.827149757596498e-02   -1.599976119089559e-02   +2.613796235792853e-01   +1.933979343841766e-02   -5.505076182764247e-02   -1.784150873011037e-01   +2.245601387213738e-01   -3.695754186015208e-01   -3.012695347594990e-01   -6.094857725457577e-02   +8.695321413517913e-02; +1.067296567698283e-01   -2.029299616520264e-01   -5.145516908487269e-02   -8.500423090796672e-03   -1.952773627040267e-01   +2.186385853355080e-01   -1.872144173369851e-01   +1.003348362551884e-01   -4.241799600074143e-02   -5.836465706333478e-02   -2.914248616275518e-01   -1.262085595637332e-01   +8.670208476485615e-02   +1.920846489651645e-01   -8.784480096005028e-02   -7.960994547746306e-02; -3.650520919505484e-01   -5.887457437414371e-02   -1.919107737877842e-01   -1.054193021466107e-01   +2.330845664653647e-01   -4.551591933359200e-02   -1.117324089320441e-01   -3.075587702467328e-01   -2.918719956754241e-02   +2.882104343003429e-01   -1.876278311077866e-01   -9.584843596100873e-04   -1.674933280874372e-01   +2.768440680488921e-01   +1.145100850991000e-01   +2.153653727273183e-01];
L2E_L1E_iAMPA_netcon = [+1.327657793355085e-02   -3.509834302034593e-01   -1.775057599705746e-01   -3.794172033294491e-02   +1.279505274976941e-01   +2.194340373199533e-01   -9.912232413480687e-02   -5.795125449913165e-02; -2.039024271796789e-01   +4.898686827894064e-02   +2.054662636363953e-01   +2.303214983506358e-02   -2.093553999851795e-01   -1.962923368193579e-01   -1.085161011286895e-02   -1.119039467736725e-01; +3.609363851992305e-02   -9.633325963781568e-02   -4.413719064934469e-02   +2.940424981509200e-02   +4.427617503573384e-02   -3.161109945440772e-01   +3.677859750315080e-01   +1.507876976335671e-01; -1.528038093107265e-01   -5.765992178203547e-03   -3.169842492203538e-01   +4.635908204769078e-02   -2.081057687951678e-01   +1.440150748282254e-01   +5.008757225667322e-01   -3.404547643156820e-02; -5.529188776415136e-02   -2.315880212913722e-01   -1.451361518268409e-01   +2.382559683612965e-01   +5.051864070060053e-02   -8.286307724625984e-03   -5.594778501146538e-02   +1.251752583761882e-01; +1.207709479051690e-01   -4.465587542073390e-02   -1.139075165417129e-01   +9.615260787625693e-02   -1.103740480563161e-01   +1.219961363692133e-01   +1.596062298030689e-01   -1.117271537815205e-01; +1.153158311167259e-01   -1.268289211705730e-01   +3.257753707789527e-01   -8.532961409603797e-02   +2.700106533269515e-01   +9.962589898222728e-02   +1.375692400735973e-01   +1.626423378151140e-01; +1.200433545187620e-01   +5.397472116761123e-02   -2.903909828408627e-01   +5.989990163224040e-02   +1.124646621610860e-01   +3.602970402886686e-02   +2.267405250084207e-01   -1.056268805028149e-01; -2.602185310585492e-01   -7.900355759882378e-02   -2.902117640676095e-01   -4.956397466240381e-01   -8.164761463697803e-02   +2.212187801233745e-01   -9.001073485694826e-02   +1.643991627702047e-03; -9.025017849912080e-02   +1.534645533232345e-01   +3.146097733662950e-02   -1.506281719290179e-01   +1.915757035331024e-01   +1.383641060644402e-01   +3.140050091817960e-02   -5.729079281092127e-03; +3.175151164828006e-02   -2.473537656088063e-01   -7.460873353897009e-02   -1.034241846063731e-01   +1.385040738464376e-01   -3.915803361269066e-01   -3.664625040879195e-01   -1.438120341711653e-01; +1.472526685892100e-01   -4.494854323815323e-01   +1.033455725972940e-01   -4.064010775475890e-01   -4.561524605105713e-03   -1.019468127869323e-01   +7.536368499795766e-02   +1.246657481134456e-01; -3.830334878100661e-01   -2.658659664160598e-02   +1.394524370353653e-01   -3.369005011993125e-01   +1.978579279337392e-01   -5.979490660761190e-02   +3.019645795315221e-01   +8.121864612829337e-02; -9.646606549015012e-02   -5.264992854802207e-02   +1.139415277714219e-01   +5.693402452110780e-02   +2.504979240702593e-01   +2.483777484232518e-01   +2.644153550041958e-02   +1.616743662714024e-01; +9.503495693094469e-02   -1.378937710838231e-02   -2.026701796405690e-01   -2.410976903715582e-01   +3.785985068691683e-03   +4.901411536815162e-02   +1.025996951629015e-01   +3.485864331060772e-01; +7.419780956930964e-02   +3.413363233046123e-02   +2.895330100460677e-02   +3.662300051516627e-01   -1.198754480916018e-01   +1.126607611002023e-01   +3.344434660433191e-01   -1.100346784892216e-01];
L1E_L2E_iAMPA_netcon = [-4.892398611339092e-02   +3.195365610260531e-01   -3.190192980743831e-02   -1.557230576051954e-01   +3.550591046319794e-01   -7.155360766890728e-02   +1.439521044776142e-01   +3.559028635919574e-01   +2.671419937056979e-01   +1.262579519072592e-01   -2.256805346246493e-01   -1.715658585698710e-01   +2.437526304769063e-01   +5.291175305024914e-03   +2.309575373639445e-01   -1.339979616910719e-01; +1.881944010639629e-01   +7.017271056977664e-03   -5.673164046753076e-02   +1.964278177845144e-01   -1.615410732578233e-02   +1.918167044621672e-01   -3.007549438765940e-01   +1.135663997253853e-01   +1.676949948374958e-01   +1.650399644252800e-01   -1.132012236935664e-01   -1.128573599373911e-01   +8.493981778576622e-02   +3.633665166777360e-01   +1.480824678366301e-01   -1.327390783536998e-01; -1.232076383650082e-01   -1.165449912992652e-01   +2.012695010057385e-01   -6.834175000758813e-02   -3.389861887775660e-01   +3.090838473588427e-01   -6.400147787428304e-02   +9.730078169707858e-02   +2.274121720301220e-01   +1.025553511892636e-01   -1.296501229079858e-02   +1.112566999056714e-01   -3.492195721491049e-01   -9.961674545049290e-02   +1.118301274180309e-01   +1.073673223111062e-01; +2.573126541170031e-02   -1.872207147616420e-01   -8.374981172842687e-02   -8.190918818793828e-02   +5.971991037774091e-02   +2.440533251739141e-01   -1.874078518378491e-01   -2.528557021080409e-01   +9.216538532515434e-02   -1.980537068839175e-03   -9.427417234732981e-02   -1.643100380746543e-01   -3.161115528195829e-01   -6.399602663068168e-02   +9.444848507697118e-02   -7.179244459844059e-03; -1.513271122319881e-01   +8.006048967693382e-03   -3.598757889467913e-02   +3.988255403522604e-01   -1.536241123893680e-01   -1.407377623776345e-01   -9.701565001677995e-02   +8.314730011261699e-02   +7.592797469338702e-02   +3.144213132315238e-01   -4.289577373715572e-01   -2.415655219726682e-01   +1.018884428857351e-01   -8.557552692960041e-02   +2.989044825916695e-01   +3.429635922381334e-01; +2.086287128077052e-02   -3.173937710276294e-03   -6.577388779637999e-02   +9.694324178306606e-02   +1.705152060054377e-01   -1.639930804552779e-01   -3.383950839559510e-01   -4.728707445978227e-02   -4.962625014740911e-02   -1.000679152539288e-01   -3.255015949231689e-01   +1.501596311767874e-01   +1.040400064362035e-01   -7.868141094931597e-02   -2.791633822044626e-01   +1.271642307546662e-02; -1.123695190873545e-01   +1.054620024666517e-01   -2.526224056095606e-01   +5.080472081508189e-02   +1.941070775269071e-01   +1.315738716096684e-01   -1.973725391464694e-01   +8.949593051975369e-02   +1.888334016324711e-01   +3.123635552856472e-02   +7.203688704843003e-02   -1.838798272340262e-01   +1.752298298412353e-01   -2.009907236562094e-01   -3.424574799513469e-02   -1.841416854075532e-02; -1.647643928049549e-01   -2.126388257345200e-01   -3.846912486232070e-01   +1.161597344724723e-01   -1.894022300899167e-01   -2.244440260984873e-01   -2.502000848879756e-01   -1.536836762303762e-01   +2.724474339246540e-01   -3.162033757475111e-02   -1.386219229386702e-01   -2.493749949943127e-01   -2.259941366256518e-01   -1.473943377281069e-01   -3.612041551077888e-02   -1.531358505167717e-01];
L2I_L2E_iAMPA_netcon = [+6.644254658238592e-02   -2.429406426380318e-02   +1.236852515727054e-01   -1.632051125732091e-01   +3.196057502905664e-02   +2.031793595048026e-01   -1.892011416009499e-01   -1.727062244272518e-01; +9.929218107474773e-02   -1.315250436291159e-01   +7.932607661970794e-03   -5.621798715999844e-02   +9.343410804094270e-02   -5.933903663140992e-02   -1.683006942992026e-01   -3.620321600699904e-01; -5.892140188890738e-02   -2.078261010714725e-01   -2.467203269850845e-01   -1.167437173318673e-01   +3.723854408206051e-03   -1.385128380213534e-01   +2.725119276700353e-01   -1.890510533870762e-01; -1.035989776583157e-01   +3.141673234368113e-01   +2.671800326494447e-02   +6.710849692839041e-02   -1.945094288475270e-01   -1.135609599457655e-01   +1.924037102530700e-01   -3.029904246809325e-02; -2.240072922117914e-01   +2.908974770852057e-01   -1.978340820504418e-02   -1.026464510612324e-01   +2.941390929800925e-01   +2.560574946736421e-03   +3.665924104402634e-01   -2.524403787771030e-01; -2.975669375229144e-01   +1.116520578454625e-01   +1.022006150264985e-01   +2.484825111389142e-02   -3.604066441812546e-02   -9.110507804183846e-02   +6.665291196370449e-02   +1.729030750037648e-01; -5.233402044303496e-02   +2.029207729356029e-02   -1.122957819364780e-01   +2.252328721643349e-01   -1.288191127084786e-01   -2.026698668009167e-01   -1.704835460333453e-02   +8.355173224501296e-02; -3.733113945098005e-01   -2.569203431271365e-01   +4.985112403670292e-02   +2.419239850486233e-01   -1.412660066973009e-01   -1.731035146623071e-01   -8.919709299911428e-02   +2.961274216900489e-01];
L2E_L2I_iGABA_netcon = [+1.095374479728641e-02   +2.596680130980608e-01   +1.073844735270229e-01   -7.853894665596206e-02   -1.081914854828045e-01   -2.646062862858976e-01   -3.374495538353408e-01   +1.422363698384525e-01; -3.678028208989312e-01   -8.605826822739472e-02   +8.623849312617091e-03   +7.376777084892606e-02   +1.407712785281639e-01   -2.334407968425499e-02   +7.349785496116527e-02   +7.309724538455931e-02; +1.359863504873050e-01   +7.025006303650948e-03   +1.144640573661270e-01   +8.174537609007440e-02   +1.835960878706444e-01   -1.091740783797045e-01   -1.491060905476466e-01   +5.453424994330466e-02; +9.069609308336735e-02   -3.370241885565715e-01   -1.543983446600145e-01   +3.377841433121427e-01   -1.255186612188158e-01   -1.298814595479565e-01   -6.372606596403101e-02   -3.400827009677300e-01; +2.435013702002541e-01   -3.357693329887273e-01   +1.764824904843638e-01   +1.723827381473603e-01   -1.895119158300564e-01   +1.977641384164862e-01   +7.867121326789572e-02   +5.493480491154822e-02; +2.888835086270370e-01   +1.629173547594781e-01   -1.570822886388576e-01   -1.472512502260239e-01   -4.541658155873082e-02   -7.643419770863656e-03   +6.113072190292383e-03   +3.605092188046679e-02; -1.082176329682841e-01   +2.388435274927735e-01   +3.180576249164471e-01   -1.171560166810575e-01   +6.460758592499362e-02   -5.415371101177666e-02   -9.771218396979964e-02   +9.757459836938422e-02; -4.940635131850296e-02   -3.501100374780955e-01   +7.351623601841135e-02   -2.464518712767738e-01   -1.362665600322045e-01   -4.912275422684819e-02   -1.843905830245427e-01   +1.114483711884619e-02];
L3E_L2E_iAMPA_netcon = [-2.035018240994499e-01   -2.623603179501195e-01   -1.814991825217252e-01   +9.307051311745883e-02   +2.400167082276775e-01   +6.360480253035707e-02   +2.900737743311019e-02   +5.935451257774709e-02   -1.181677334316616e-02   -2.707229311717901e-01   -3.670134668012680e-01   +8.754819083720668e-02; +2.268080119717505e-01   +1.009714399199157e-01   -5.419444682500245e-02   -7.526616449277423e-02   +1.004045559186360e-01   -3.282883121691261e-01   -4.772803771695541e-02   +1.770259820704836e-01   +6.961940442711474e-02   +1.310475486858697e-01   +1.007345171956813e-01   -1.810075856321575e-01; -7.220012284329981e-02   +7.808477226513116e-02   -2.358797105960922e-01   +4.677272235730619e-03   -2.555511766920274e-01   +4.588453973746434e-02   +1.370573983058361e-01   -1.093771654672796e-01   +2.221359740208319e-01   +1.203913007010646e-01   -2.125075587160554e-01   +1.124696168897271e-02; -3.452085766711955e-01   -2.294459083458340e-01   +1.967411828114877e-01   +6.044099095926673e-02   +1.293715923854075e-01   +1.629068909992457e-01   +1.410007175947423e-01   +1.619414759318455e-01   +5.980302495274738e-02   +4.470803678490670e-02   -3.801187890167796e-02   -1.808302665205944e-01; -2.450589151063130e-01   -1.854726134735196e-01   -7.216494741644836e-02   +1.803867029505498e-01   +7.425308170706936e-02   +5.116105088733561e-02   -3.020646888471125e-02   -1.613547284231598e-01   +7.527905898285332e-02   -1.972279916791586e-01   +5.910686742100020e-02   +1.249656532439243e-01; -3.953436350691415e-02   -2.331838076295675e-02   +2.009657378073619e-01   -4.910068567782516e-02   -1.298395431676278e-01   +1.732453786533875e-01   +1.546519172711741e-01   -3.661717827730209e-01   -2.002468082814242e-02   -7.424317726038514e-03   +7.625486887423336e-02   +2.066282608524795e-02; -1.191581489453310e-01   +4.625001144610297e-02   -7.897315003702794e-03   -2.125828780006730e-01   -1.265605730832624e-02   +1.784608588460388e-03   -1.792440475753700e-01   +2.411736111668197e-01   +8.593972938626317e-03   -1.520172965867819e-01   -1.676578756522286e-01   -3.966227119881021e-02; -3.714674676567297e-01   -4.264123135862861e-02   +3.898386857614721e-01   +1.721996373413056e-01   -2.833706451579038e-01   +3.408592524309501e-02   -3.610244713816254e-01   -3.273942086369245e-01   -2.959686646051023e-01   +2.023313232505914e-03   +6.271588807409827e-02   +2.585042356834097e-01];
L3I_L2I_iGABA_netcon = [-5.116828842750277e-02   +3.530297269919057e-01   +1.774338943672557e-01   -3.498710735469523e-02   -1.284945664270518e-01   +4.793135829998717e-02   +1.295946757484315e-01   +9.615656681066556e-02   +2.706237172112322e-01   -1.365255326721671e-01   +2.981557661212809e-02   +3.599686485404019e-01; -2.026557224534584e-03   +1.871240491754500e-02   -1.387359336565867e-01   +1.312588105030762e-01   -5.443320219478109e-02   +7.528390396510942e-02   +2.986240594229252e-02   +2.842747257050376e-01   +1.853658114918324e-02   +1.626470068314377e-01   +1.437943583166486e-02   -8.552966830679422e-02; +8.788140560320080e-02   +3.390212228795035e-01   +2.139154404794188e-01   -2.155412793473431e-01   +8.584214056209359e-02   +6.341241777113038e-02   +2.108489649131824e-02   -1.715950669249526e-01   -1.772594399823054e-01   +1.286715022695380e-01   -2.719104737945293e-01   +4.119883216746886e-02; +9.722037518041952e-02   -8.240487615937239e-02   +1.346809079587727e-01   +2.089713908722933e-01   -1.217285527334524e-01   +1.631725104644326e-02   -2.162494515553262e-02   -1.179721315268604e-01   +9.219359722592568e-02   +1.978989242662041e-02   -1.167495110997778e-01   -7.113288543258701e-02; -3.105334456752306e-02   +2.471843092207873e-02   -7.184303227016406e-02   -2.620460372198432e-01   +1.867707636727838e-01   +2.162513240147953e-01   -1.129533108500732e-01   +1.084324611333076e-01   +1.721406731175869e-01   -1.152916480878939e-01   -9.416503009132224e-02   +1.695374949899586e-01; +2.636078932892709e-01   +3.432597087089787e-01   -1.623908894322761e-01   -8.566136739881862e-02   -2.039227377352483e-02   +1.478438091321241e-01   +5.960811568959659e-02   -1.876618126020261e-01   +1.081437363572468e-02   -1.269216388485908e-01   -1.205364952018690e-01   +1.467841266759878e-02; +1.884057816107031e-01   -9.291489531521497e-03   -2.008949606897273e-01   -2.308182131781505e-01   -2.557519066576893e-01   +2.431094241520098e-01   +1.223742913209843e-02   -1.801278183258132e-01   -1.292017990588363e-01   +4.858014322112052e-02   +9.408135147661545e-02   +1.374957802461674e-01; -8.029988021058343e-02   -8.564862799343705e-02   +2.558931012509464e-01   -1.511799913755069e-01   +4.244725836450658e-02   +5.049472101784783e-02   -9.041626314508372e-02   -2.380655208859977e-01   +8.776633058124112e-03   +1.118072315397182e-01   -1.271968012072689e-01   +2.516347216605699e-01];
L2E_L3E_iAMPA_netcon = [-4.732334919024909e-02   -2.166826282494308e-01   -2.108672522396540e-02   -6.740609536292417e-03   -2.133409068240001e-01   +2.735331072768838e-01   -2.259757655049333e-02   +3.457776727816777e-02; +2.910211417470854e-02   -4.204583818370788e-02   +2.465077204765351e-01   +1.617730841417082e-01   +1.682349157594429e-01   +1.177755795373064e-02   -4.231634752310234e-01   -1.542751815406187e-01; +1.623623456689454e-01   -1.286385632026772e-01   +1.653740945844798e-02   +6.392162606099901e-02   -2.827416943558222e-01   +1.332583038057784e-01   -1.675402876765776e-01   +3.677256830156064e-02; +4.295718134996086e-02   -8.207422981713880e-02   -5.255254644271239e-02   +1.131902187052773e-01   +1.672071235616698e-01   -6.513531031575043e-02   -3.588324986216312e-01   -1.474541215685003e-01; +1.715968622139120e-01   -1.847284908974793e-01   -1.438967086180538e-01   -1.065718948582986e-01   +8.427500495807685e-02   -1.395594535372323e-02   -1.111441039641542e-01   -1.904803662842766e-01; +2.183962209613460e-02   -1.852169271946139e-01   -1.953360286383049e-01   -4.807479048892220e-01   -7.234998702338676e-02   +3.170988575876558e-01   -2.485730187899611e-01   +2.458344612905836e-02; +4.657836477164458e-02   -1.540494353739397e-02   +2.032872009887001e-01   -3.201397704472567e-01   -1.368364691982467e-01   -3.415628500624805e-01   +3.309892508510073e-01   +2.826062834481889e-01; -8.725286743454429e-02   +1.865502131334396e-01   -3.777764066913298e-02   +8.901350008609811e-02   -4.111923604221203e-01   -1.439764903234826e-01   +9.995391396023366e-03   +8.949794778819867e-03; +2.762393965259891e-01   -1.454209047365888e-01   -1.284902105304203e-01   -1.675202267939396e-01   +6.380144152732906e-02   +2.912452126006230e-01   +1.244055462439046e-01   -2.557926042926812e-01; +1.974648786410792e-01   -9.681383121569334e-02   -7.338957880790659e-02   -1.523171610298279e-01   +1.758453837710534e-01   +5.463738111041504e-02   +2.771304938078939e-01   +3.021982378285850e-02; -1.592782802729389e-01   -1.603160109077752e-01   -1.615624678678516e-01   -1.549760825306358e-01   +1.423123145535719e-01   -2.478655799886378e-01   +1.995880053765276e-01   -2.088092975254351e-01; -1.195752167839328e-01   -1.779052869494503e-02   +2.307964732442400e-01   -8.566640337262246e-02   -2.518752719072725e-01   -1.368241941392695e-01   -1.137811970098605e-01   +5.749863647775280e-02];
L2I_L3I_iGABA_netcon = [-2.755511913819974e-01   -3.883901569775595e-03   +3.089770701477236e-01   -1.725416798256985e-01   -3.365572593221743e-01   +2.305731196381810e-01   +1.322860120608614e-01   +6.724151377846627e-03; -1.212309211658312e-01   -1.176679746759073e-01   +1.105869590735383e-01   -3.881614464899407e-02   +6.993882279935319e-02   -1.195839180328823e-01   +6.468577967630321e-02   -1.268777784400992e-01; +1.049519007737568e-01   +2.690839463303218e-01   -5.716225649354273e-02   +1.128098411213432e-01   -9.142130325564442e-02   +1.883407669946370e-01   +3.424723283006822e-01   -1.002837861384773e-01; -1.028765060685579e-01   -1.719670495879317e-01   +3.464753523324077e-02   +7.262822114623947e-02   -2.100093456912573e-01   +6.134785007718677e-03   +1.724411763277349e-01   +8.738575813204455e-02; -1.144516136647468e-01   +1.383567904379245e-01   +1.945020511160682e-01   +2.609226295463927e-01   +9.045290911754650e-02   -1.879440187455453e-01   +2.226221848680118e-01   -1.162982882748478e-01; +3.052603345960260e-01   -7.797367908276324e-02   -6.615286287030464e-02   +1.386469565845148e-02   +1.225905017759726e-01   -2.873254399102918e-01   +1.161858830476289e-01   +1.949318959869691e-01; +2.226332211080476e-01   +9.934965954237029e-02   +2.297736514433463e-01   +3.755488751991428e-02   +2.097973061626353e-01   +2.111024729123517e-01   +2.317975858353604e-01   -7.748730281458832e-02; +1.481545387422189e-02   +1.318161602774623e-01   +1.632983662270880e-01   +2.297318098556243e-02   +2.196645842918387e-01   -2.130667500432791e-01   -1.355970323835480e-01   +1.154902796108846e-01; -2.167273977582699e-01   +2.269871996672299e-01   -3.835889663877710e-02   +3.526675493766817e-01   +2.461587823425567e-01   +3.400838905912174e-01   +2.125442417139927e-01   +2.047347759071245e-01; +1.914406746343494e-01   +9.832455389857810e-02   +3.712071628852460e-02   -2.148564008607443e-01   -8.720194500878159e-02   -8.341972114979881e-02   -8.059393919735075e-02   -7.352097623070022e-02; +2.404363697273543e-01   -2.007103483198846e-01   +6.054514061626626e-02   -1.588721164722979e-01   -1.396645704844227e-01   -3.045849797896629e-02   +1.356816546450091e-01   +2.194766110077148e-01; -4.805464688934853e-02   +3.760540441577379e-02   +1.632113361826462e-01   +3.157372375170263e-01   -3.034014822543137e-01   -9.617617241399279e-02   -2.820783283115292e-01   -1.053494793063461e-01];
L3I_L3E_iAMPA_netcon = [-2.038563270147911e-01   -1.003242612355823e-01   -1.709495461595095e-01   +3.407110565528549e-01   +9.517384898388261e-02   +1.237694946656735e-01   -1.937246712108650e-01   -2.144970080468836e-01   +1.938599538912444e-01   -4.772099699815068e-01   -5.168932032121100e-02   +1.503196267024346e-01; -1.183099765472302e-01   +5.311852652550485e-02   -1.864704059443506e-01   +1.008033216580370e-01   +3.066891198838225e-01   +5.666712801804720e-02   -1.511769558285822e-01   -3.513988968758847e-01   +1.009608096655893e-01   -7.069071934006599e-02   -2.651916680879824e-01   +1.574544921589651e-01; +5.749338098866933e-02   +1.049138806334483e-01   +2.916000031025665e-01   -1.905555826556920e-01   -1.494497754671594e-01   +9.415128284346061e-02   +6.705811181120007e-02   +1.326113355689679e-01   +4.014392035134111e-01   +1.052228904433376e-01   -1.511547158982321e-01   -1.042948094820640e-02; +3.597656893597173e-03   -2.906452291523173e-02   +1.905327605251466e-01   +2.852461898062308e-01   +3.329848044476026e-01   -3.453130374238372e-01   +3.543721625422622e-01   -2.582595253768722e-02   +6.758122380797220e-02   +2.138593939649774e-01   +2.409413487957092e-01   +1.908093888836471e-01; +1.017010834168187e-01   -2.200183585310882e-02   -2.590467710598702e-01   +3.053686623461283e-01   +6.190062188756737e-02   +2.991571463612629e-02   +5.563997316672983e-02   -6.752222882898298e-03   +9.939774735362877e-02   +1.565951573648813e-02   +9.016641734271716e-02   +5.407454054305463e-02; +1.052314130160779e-01   -6.255095782860910e-02   -3.248626253934271e-01   +2.882657314278754e-01   +2.024380824993420e-01   -2.250739813877862e-01   -5.076660583387903e-02   -8.677543190330769e-02   -1.955730734422168e-01   +3.269348347649604e-01   -2.312623242044902e-01   -3.473157596090430e-01; +9.963684847110187e-02   +2.262782056226835e-02   -1.459005661960159e-01   -3.027604904567500e-02   +1.384191908542197e-01   -9.024504649911003e-02   -1.005249299410922e-01   -2.489406415372751e-01   -1.791188554894660e-01   -4.756350844156559e-02   +3.994091352031932e-01   +3.083933688439047e-01; +2.852740124360841e-02   -8.908640836951157e-02   +1.885899701681003e-02   -3.699034737725117e-02   +5.684739754176941e-02   +3.062684071756693e-01   -2.189427482967160e-01   -2.395050088521854e-02   -7.045077481091891e-02   +1.436925885654245e-02   +2.387309810414437e-01   +1.468361044720867e-01; +2.731305748527343e-01   -3.053722672633616e-02   -1.148408413433480e-01   +2.367249814205568e-01   -6.793947176287120e-02   -1.554374255716588e-01   +1.368873425991933e-01   +2.385776869510868e-01   -3.041448296346461e-01   -5.306000751661513e-02   -9.511873551176331e-02   +1.813897900801228e-01; +7.886411817379600e-02   -1.159089327987722e-01   -3.726865857717874e-02   +2.292773610130517e-01   +1.360109358533755e-01   -1.856082587346843e-01   -1.596581568027359e-01   +2.196868457940116e-01   -2.147433717918522e-01   -3.730560184957771e-01   +1.495853119980158e-01   -2.025927000942304e-03; -2.490211245266672e-01   -1.342516998608032e-02   +1.612886717182464e-01   -1.127139565235026e-01   +3.277410595218689e-01   -2.938126599306647e-01   -2.675917952518932e-03   +1.058560693660451e-01   -7.713811114511013e-02   +1.312987097265809e-01   -1.052551547117992e-02   -5.516758236109223e-03; +1.313282102327188e-01   -2.218841565836794e-01   +3.227641378661114e-01   +2.006689693168598e-01   -1.832479174591193e-01   -8.261582773756002e-02   +1.026894035401637e-01   -1.849194959261652e-01   +1.135350564390245e-01   +2.931426393536024e-01   +1.046797292313912e-01   +3.081076998151865e-02];
L3E_L3I_iGABA_netcon = [-5.415898731159804e-02   +6.058332104135113e-02   +1.634385186379180e-01   +8.292340208610344e-02   +2.306213239016371e-01   -3.281760026380322e-01   +2.222421353150441e-01   -1.447294991573917e-01   +7.340910917474017e-02   +9.810855206390090e-02   -1.236264458596847e-01   +6.134957277805633e-02; -3.575896843084180e-02   +2.824261294789794e-01   +2.514081008314588e-01   -1.513335222089887e-01   -2.036163575037131e-02   -7.211005034330702e-02   +1.457110400267375e-01   +1.221425009384190e-01   +2.096352158797151e-02   -3.355908784456487e-01   -3.917538263488571e-01   -3.862109825005767e-02; -1.813630671480077e-01   -9.240748141904090e-02   -6.608662250396651e-02   -2.667425174040247e-01   -9.071706104328611e-03   -8.481379632344405e-02   +1.095121254965686e-01   +8.762274477054180e-02   +4.345043101799905e-01   +3.937138472527533e-01   +1.497877642180572e-01   +6.486624229682508e-02; +1.932149650247018e-01   +1.648685429268381e-01   -9.761311215166132e-02   +1.544042696088811e-02   +9.701752874348515e-02   -1.015938322588987e-01   -1.673341405952540e-01   -3.682322433640099e-02   -4.300019606536910e-02   -8.790088891774117e-02   +4.423681294873749e-03   -1.297023423777179e-01; -1.290776694941772e-01   +2.448523200192915e-01   -8.234395050031219e-02   -1.091904394956242e-01   -1.052745015670442e-01   +2.468609726550011e-02   +7.447064261137246e-02   -2.463448536107601e-01   -2.293423484464990e-01   -7.820422429911313e-02   +1.766903750809723e-02   -2.178726785868242e-01; +4.100335525067364e-02   -1.279875832271209e-01   -2.316127542025469e-01   +1.288737373657683e-01   +2.155673698849283e-01   -3.710697880874836e-02   +2.512076380704156e-01   +3.384599648812117e-03   -4.091893554963304e-02   -2.704257536013836e-01   +1.712600551005849e-01   -1.530010766931960e-02; -5.143675102804576e-03   -2.352288030657774e-01   +1.773893691643440e-01   -8.857561419150331e-02   -5.033911325772908e-02   +2.717196767436973e-01   +1.155467594757089e-01   +5.777815705663816e-02   -1.650777279999837e-02   +6.105515358344034e-02   +2.587765887607152e-01   -3.413569606347287e-01; -2.980420368969663e-02   -3.334281918355091e-02   +6.195984451079468e-02   +1.009805080291325e-01   -1.397395438550546e-01   -1.459056175708173e-01   +9.517729528261659e-02   +3.090527325287005e-02   +3.457050222952909e-03   -1.857551549526743e-01   -3.621448177945268e-01   -2.485719720425279e-01; +3.136332806131366e-02   -3.516903528516385e-02   -3.380199339142401e-02   +2.829359186118112e-01   +1.304763795447847e-01   +4.200346346661539e-03   -3.091696190127685e-01   +2.956482642250590e-01   -1.260399063498496e-02   -1.706779875510981e-01   -8.752395402518173e-02   -1.237228983721224e-02; +2.489182442154378e-02   -1.759890160224511e-01   +2.178608368935168e-02   +7.302999785675537e-02   -2.016099830796909e-01   -1.777680450716671e-01   -1.619950557141687e-01   -1.759633386990759e-01   -8.141269657137930e-02   +2.196012813035194e-02   +3.622780204622688e-02   +2.752168661149301e-01; +1.791553952880699e-02   +1.964222761533138e-01   -4.382165952758285e-02   +3.543569456503047e-02   -4.513104109964106e-02   +6.999757433754943e-02   -6.275022401313232e-02   -1.348485051234528e-02   -2.772405306740486e-01   -3.371840284909379e-01   -2.078928928732648e-01   +8.051999959086358e-02; -4.320369545616245e-02   -1.803332613339955e-01   +2.083466579909888e-02   +1.133669521976431e-01   +6.312506516004221e-02   -2.996128633965934e-01   +1.856763777952743e-01   -3.402191572821826e-01   +2.212259770147167e-02   +1.503535682790218e-01   -1.195595899144921e-01   -2.350875853060730e-01];
L2E_Input1_iAMPA_netcon = [-8.446398992591937e-03   +1.374316303171812e-01   -8.725435301413487e-02   -2.855815432610848e-01   +1.773900824717432e-01   -9.020706258295208e-02   -1.691644586275605e-01   -5.186526883322786e-02];
L2I_Input2_iAMPA_netcon = [-1.828672961448335e-02   -8.755347699165326e-02   +2.183159648880451e-01   -2.623937013468625e-02   +2.127009886584167e-01   -1.402592602300258e-01   -1.087754545643143e-02   -8.037253952646561e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
