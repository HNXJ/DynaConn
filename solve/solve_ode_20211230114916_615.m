function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.517192107392919e-01   +8.498957864901019e-02   +1.702900709743803e-01   -5.329589990661226e-02   +2.077244780242744e-01   +2.082721424383123e-01   +1.774322487766201e-01   +1.400373865485041e-01   +3.329415470653911e-02   +1.806760214683227e-01   +1.618667918554561e-01   +4.502584831799254e-02   +4.740179759750328e-03   +1.932298121697947e-01   +1.234178194034192e-01   +2.249422192378546e-01; +2.519939087813989e-01   +2.921267073258447e-01   +1.298654864979492e-01   +1.452739761210901e-01   +2.229379119363993e-01   +6.828696310036481e-02   +1.545975165243021e-01   +5.704895033237740e-02   +1.297995634065220e-01   +2.200399745254976e-01   +1.890797736118395e-01   +1.585820861777408e-01   +1.836246091397695e-01   +1.567769655154628e-01   +1.326055350294637e-01   +2.891555696147820e-02; +1.491171895191578e-01   +2.524657702759692e-02   +1.784219806768880e-01   -5.836649673518663e-03   +8.711685005538009e-02   +2.506934385616421e-01   +7.765720564206860e-02   -2.494975749720586e-02   +2.545617836699912e-01   +6.566787416633139e-02   +1.459776177191131e-01   +2.645883301403350e-01   +1.107466151951286e-01   +1.643213224450054e-01   +1.719011657181991e-01   +1.152062237961617e-01; +2.402335889551524e-01   -2.728247774867180e-03   +2.077617749380268e-01   +2.098098095921476e-01   +1.381491274382993e-01   +1.414432755518808e-02   +4.837197030457047e-02   +5.940972203844423e-02   +1.605571045891537e-01   +1.343328726560840e-01   +1.000929646234943e-01   +9.777411528127705e-02   +6.307158350742248e-03   +8.546830375632181e-02   +1.825750395728029e-01   +2.509822529725677e-01; +1.802441933877572e-01   +1.065667922257657e-01   +2.213394456544231e-01   +6.356902252923209e-02   +4.076380133697444e-02   -2.447724866391733e-02   +1.207069244639330e-01   +2.570325917769422e-01   +1.422528693287609e-01   +2.111917112022029e-01   +3.091712371276418e-01   +1.525745700827218e-01   +1.967687209691000e-02   +1.218749180239361e-02   +2.440816875851556e-01   +9.589641995378508e-02; -9.863969413623157e-02   +1.257293000180515e-01   +2.631861539146613e-01   +1.007069461296162e-01   +5.944029065799568e-02   +8.533874231171010e-03   +1.518451308226271e-01   +1.477350056541293e-01   +5.202355137140062e-02   +2.867220896824788e-03   -1.047603595698067e-02   +1.257422524733373e-01   +2.517573973167042e-01   +9.613401140936709e-02   +2.583700853980766e-01   +2.007833637299461e-01; +3.293741883839569e-01   +1.925489717359956e-01   +2.246098374809641e-01   +2.648099748331911e-01   +1.014354240677775e-01   -9.017029242816421e-02   +5.195647511032143e-02   +9.308523142849720e-02   +2.129517650230871e-01   +8.431217606948484e-02   +1.117402048406532e-01   +8.136758006367623e-02   -4.005477573319458e-02   +2.173660097715649e-01   +1.661726172268622e-01   +1.876065348018331e-01; +2.340656366780937e-01   -2.581298589215331e-02   +7.867166502343335e-02   +1.976565562652991e-01   +3.042187170824106e-01   +2.007301540362676e-01   +9.053976832788228e-02   +8.025302936498528e-02   +8.289092247675865e-02   +2.162911226426213e-01   +3.361182958580663e-02   +1.327969310218041e-01   +1.821356870204328e-01   +1.450069843044799e-01   +2.774309521913067e-02   +3.326139367209680e-02; +1.544986352097548e-01   +1.567209159415213e-01   +2.245711196831318e-01   +5.141893791592358e-02   +3.815219258770337e-02   +4.941737066997554e-02   +1.887077588847654e-01   +3.174258498625530e-02   +1.974678292006660e-01   +2.199908975644446e-02   +2.325762102606917e-01   +1.286293402545140e-01   +1.104015713057530e-01   +3.252020483905455e-02   +2.658461821651203e-01   +9.481869992100396e-02; +1.938632374686776e-01   +2.933190995191496e-01   +1.854535056794640e-01   +1.523101992869930e-01   +1.563998328764497e-01   +1.259397258445038e-01   +2.681928480738585e-01   +2.457197103933218e-01   +2.382487545042906e-01   +1.512543349783762e-01   +2.192582370743329e-01   +2.225991841677271e-01   +1.695386374820078e-01   +2.075580165523200e-01   +2.548859415577587e-01   +1.468112977436463e-01; +6.180322419840292e-02   -2.035103778473836e-02   +3.383340611069065e-02   +2.586974714547454e-01   +2.294251811677435e-01   +5.572915992602171e-02   +1.745559232087297e-02   +1.178325923390326e-01   +1.557585971373362e-01   +1.248015116852897e-01   +1.215287389157931e-01   +2.307194204970139e-01   +8.064965884356438e-02   +7.614108517298036e-02   +8.086435426729660e-02   +1.095243225948372e-01; +1.690992380604517e-01   +1.603657362672063e-01   +3.454213709681604e-02   +1.148054752084005e-01   +1.218378577298076e-02   +1.505286713349861e-01   +1.182347471626847e-01   +3.230258372903119e-02   +1.379737803393655e-01   +7.441940337912840e-02   +3.341324485442804e-02   +9.014604082727648e-02   -3.230586761971860e-02   +2.922882489531911e-01   -1.458131260434758e-02   +2.849574471547452e-01; -2.219819446273185e-02   +1.423296604192287e-03   +1.938213365528191e-01   +2.395535935091939e-01   -7.097546154423766e-02   +2.298371680168322e-01   +1.199981840871791e-01   +1.149189287219194e-01   +1.062671917395497e-01   +9.585207388797717e-02   +1.808224097652382e-01   +1.316824254416631e-01   +2.123307232968651e-01   +1.349487425134509e-02   +8.184427816066417e-02   +1.656699795386682e-01; +1.164465111172877e-01   +2.483455024755853e-01   +6.554615429092873e-02   +2.309642943019986e-01   +2.210784669542042e-01   -4.197115442258724e-02   +1.534594613412091e-01   +2.203110797536007e-01   +2.024401834255751e-01   +2.302598241865516e-01   +2.219309436564623e-01   +1.039169388223438e-01   +7.655482516609041e-02   +2.732202583803917e-02   +1.390603353245367e-01   +1.581123289916128e-01; +1.912522454857847e-01   +4.827093724790149e-02   +2.421353494554591e-01   +2.114926918277723e-01   +8.838446304419387e-02   +1.490639071145158e-01   +9.117093189511878e-02   +1.359726339863387e-01   +2.240530546522053e-01   +2.757618176068499e-01   +4.726274470127237e-03   -8.525804433466507e-03   +5.310434695264699e-02   +1.705720724064206e-01   +2.499326730671979e-01   -4.840646091551617e-03; +1.326676819212597e-01   +1.936377649049865e-01   +5.256132539818462e-02   +1.247703679752001e-01   +1.287914112955477e-01   +1.573995199928986e-01   +1.508743569763157e-01   -2.699977920111419e-02   +2.468313074992856e-02   +1.052713754411498e-01   +3.814570114253379e-02   -6.423787947578417e-02   +1.097684010977236e-01   +2.530136222731413e-01   +2.345698469948498e-01   +2.111136520051397e-01];
L1E_L1I_iGABA_netcon = [+1.255369103135449e-01   +1.503763874834915e-01   +2.446459125315641e-02   +4.463140814862463e-02   +1.257076545559770e-01   +8.411206667418096e-02   +1.452941098524412e-01   +6.207909022782186e-02   +2.046138912768378e-01   +8.430331641064559e-02   +6.700264951285720e-02   -1.395096859619368e-02   +6.882249731659537e-02   +6.409120382345919e-02   +3.577758151340535e-02   +6.552958900557479e-02; +1.096424247145946e-01   +8.969010881957837e-02   +2.486578149568422e-01   +3.993411211047915e-02   +1.356404671079240e-01   +3.168834576780331e-04   +5.983450908997849e-03   +6.239613539691923e-02   +1.083283093262138e-01   +1.604577991097155e-01   +2.164764737098261e-01   +1.496429391046195e-01   -2.815395681380286e-02   +1.261246670053277e-01   +2.184493311681853e-02   +2.320848393627341e-01; +1.635471705529983e-01   +1.863554736793859e-01   +1.648438287640546e-01   +2.134985705793461e-01   +2.782844162526193e-01   +2.953773781017370e-01   +1.515573357281170e-02   +1.287814603922267e-01   +1.320545869208399e-01   +3.126923090734802e-01   +1.486962677938430e-01   +2.520151191843124e-01   +8.227622291151987e-02   +2.575788172402532e-01   +2.550367559919930e-01   +1.005530330893456e-01; +1.045377539376546e-01   -1.402901675384852e-02   +4.064431109427886e-02   +2.910744240502001e-02   +1.002021553648789e-01   +1.976817497084311e-01   +1.865291906844158e-01   +1.903090827633313e-01   +1.464359777161779e-02   +5.793261054929869e-02   +4.023768799040094e-02   +1.628085932737375e-01   +2.173933662129523e-01   +6.233692995518891e-02   +1.099787359253071e-01   +8.201786839878542e-02; +3.218680059143229e-02   +2.965026933118368e-01   -1.288265145167117e-02   +1.971551565707996e-01   +1.377652360980922e-01   +2.040383549179526e-01   +9.649016786294790e-03   +2.713723010971109e-02   +2.599624796782014e-01   +2.030594736974406e-01   -9.050018673743571e-02   +2.325442481880235e-01   +4.239454237426899e-02   +4.634418854845257e-03   +1.856383519531949e-01   +1.148758047320323e-01; +2.119907107703206e-01   +1.196101106892115e-01   -3.373511239074491e-02   -1.143719374514170e-02   +7.517873315918373e-02   +1.568056609597931e-01   +1.526349103333330e-01   +1.827623633112727e-01   +1.851400051361018e-01   +1.793290350954350e-01   +1.580184953311282e-01   -2.526893217851529e-02   +1.643360839206898e-02   +2.147088220033511e-01   +2.442979573924836e-01   +1.268274312844075e-01; +2.615184659274725e-02   +2.598980489561127e-01   +1.244220509335961e-01   +3.189555704883442e-01   +2.540295341573748e-01   +1.951181161628909e-01   +3.336908437490418e-01   +1.697691759433777e-01   +3.436509864174823e-02   +5.065411794780982e-02   +2.689742411659544e-01   +1.193292792354930e-01   +7.577941187905089e-02   +7.723987086823420e-02   -5.938138547917807e-02   +2.308256812426902e-01; +1.659312230326893e-01   +9.169859252576816e-02   +2.016449967993906e-01   +1.669069600360564e-01   +7.567434063408397e-02   +1.567394614794343e-01   +1.814833227329109e-01   +1.336620096280617e-01   +1.312157189297017e-01   +8.542602895251752e-02   +7.384426736657675e-02   +1.779310744070385e-01   -4.443010543223600e-02   +3.320420009533834e-01   +1.185893481258631e-01   +2.013189437245090e-01; +4.218112989817741e-02   +2.034906360348314e-01   +2.328420300868880e-01   +2.519866111757718e-01   +2.031433525854411e-01   +1.156869360403449e-01   +1.645200494400727e-02   +1.301326859015562e-01   -4.952348363428560e-03   +4.729762551330712e-03   +2.069068094097150e-01   +2.067620140795259e-01   +1.590616224764082e-01   +1.416572146757452e-01   +8.018057072515447e-02   +3.874313684642936e-02; +6.659722520244228e-02   +2.999552075507503e-01   -4.560082570338537e-03   +2.554051291987051e-01   +1.791256937500314e-01   +1.055334946932833e-01   +7.338676818218609e-02   +6.911731885488227e-02   +5.385827292147835e-02   -2.568456961560988e-02   +1.982576972328305e-02   +6.892411874831013e-02   +8.026682300350703e-02   -5.922680289891125e-02   +9.900701610899766e-02   +1.098060428881710e-01; +2.215413781230989e-01   +2.598985414199048e-01   +2.682850684413747e-01   +1.992903096754065e-02   +2.496896888362999e-01   +3.171688048672596e-02   +2.249090366150093e-01   +7.732457333949841e-02   +5.495234544431830e-02   +4.876882834642019e-02   +2.284381506437992e-01   +2.391017055833526e-01   +2.289008864670701e-01   +1.128074163544927e-01   +1.082056735985131e-01   +1.295192547245178e-01; +1.992949981715800e-01   +6.305506932716767e-02   +1.042699633784855e-01   +1.545034502291589e-01   +1.701328651836537e-01   +1.962511479487724e-01   +2.713563828015036e-01   +3.989810553274877e-02   +1.756213563602928e-01   +7.011763052000812e-02   +2.180941106228860e-01   +2.185011161523447e-01   +2.047639355767373e-01   +1.406411666059887e-01   +2.640725980755540e-02   +2.816074899899870e-01; +6.355088570608912e-02   +3.010357568333707e-02   +2.242324083109860e-02   +5.548613178610862e-02   +2.642813832130859e-02   -7.903591650812508e-03   +8.918291224737407e-02   +3.056597793500627e-01   +1.546241375314447e-02   +1.919332052637680e-01   +1.198188287367074e-01   +1.214019986977757e-01   +5.269769162258699e-02   +1.184333390206382e-01   +1.251967262520791e-01   +1.208258641354738e-01; +7.677342223458594e-02   +1.963057928939428e-01   +2.238664207045192e-01   +7.580468078366470e-02   +2.015206467876173e-01   +7.292646790331027e-02   +2.389756629404695e-01   +5.686239911240927e-02   +9.659202058877328e-02   +1.024142132376860e-01   -3.184165335744137e-03   +3.178860537837979e-01   +5.196792667944190e-02   +1.351803801289954e-02   -2.006546214979935e-04   +4.128050969518238e-02; +2.775898493014122e-01   +2.379725524502010e-01   +8.066284265107243e-02   +2.281056462290774e-02   +9.955750783873080e-02   +1.233820990333062e-01   +1.191085697818065e-02   +1.094847985612597e-01   -7.710342436782387e-03   +2.941472665702507e-02   +1.450247499695932e-01   +1.464267703268459e-01   +2.107889071350422e-01   -7.890504434750197e-03   +4.281540373872224e-02   +2.827166822894896e-02; +2.506787774366653e-01   +1.708125792982230e-01   +2.535036807887021e-01   +2.360335508590540e-02   +2.859335057637854e-04   +2.066338774614009e-02   -1.559003226412094e-02   +2.076618568215832e-01   -5.532783209676225e-03   +1.481850689775514e-01   +1.080125798930157e-01   +2.501971427566901e-01   +6.037266940788798e-02   +1.822836472453941e-01   +2.366760771449947e-01   +2.008335660969556e-02];
L2I_L1I_iGABA_netcon = [+2.437887144607467e-01   +6.706555336089656e-02   +9.660126724613748e-02   +1.848510733666332e-01   +7.570570213137412e-02   +1.339763659136099e-01   +3.630346885444322e-02   +2.753041918883898e-01; +7.044978808582331e-02   -2.091727988018709e-02   +6.565484234098611e-02   +1.262386122036172e-01   +1.419592808781229e-01   -3.165549079803061e-02   +1.413122634702480e-01   +9.234306402357483e-02; +1.072340434116769e-01   +1.582081950728525e-01   +1.284782909019586e-01   +2.697962508420836e-03   +1.671856360648712e-01   +2.538637730454854e-01   +1.543026063857265e-01   +2.128064267670454e-03; +2.416878319870863e-03   +2.514929179298009e-01   +9.405041993800944e-02   +2.613595454890712e-01   +3.522304751505685e-03   +1.586050008659084e-01   +2.213074988852760e-01   -3.376674207159903e-03; +6.695737053773420e-03   +2.194350815293395e-02   +1.724926816381181e-01   -7.761050723563821e-02   +1.684537856645966e-01   +1.544935449555045e-01   +2.261467419055861e-01   +1.141477032659797e-01; +1.264812345150171e-01   +1.758604259452246e-01   +1.871104226182712e-02   +2.598932086140100e-02   +2.091223744160792e-01   +7.724038178540213e-02   +2.899517610691533e-01   +1.071025855511793e-01; +6.914302130310303e-02   +6.661538319381170e-02   +1.215217653622528e-01   -8.931364680019954e-03   +1.312745611685834e-02   +2.250736051312959e-01   +1.548874770011462e-01   +1.887488875884051e-02; +2.611725160184230e-01   +1.029392560548666e-01   +2.636162481112756e-01   +2.075836879321251e-01   +1.468397969165935e-01   +6.886122717136342e-02   +1.879975448782635e-01   +1.068858326927171e-01; +8.278001396887152e-03   +2.297980145406891e-01   +6.609175730980923e-02   +5.297262663856873e-02   +4.120356168483907e-02   +2.054357966195155e-01   +1.624954502992286e-01   +5.283280916812407e-03; +5.087892248978339e-02   +2.470563632754160e-01   +2.435702214889074e-01   -5.716277765593466e-02   +1.802914102011204e-01   +6.531314840503100e-02   +1.067118325406284e-01   +1.807718984770146e-01; +1.908829291055879e-02   +1.907646857012063e-01   +1.660876644833666e-01   -2.198238416058518e-02   +2.046688549402284e-01   +8.433464994498378e-02   +1.051678163914871e-01   +1.542067017257054e-01; +1.957063855326278e-01   +1.035591391256728e-01   +1.447024014999035e-02   -6.190336801642965e-02   +7.794639685978096e-02   +1.093034965733180e-01   +1.728433953870101e-01   +7.630994864445765e-03; +2.629148925559782e-01   +2.434320999480655e-01   +5.251608788721839e-02   +9.442547922352801e-02   +1.432893556172978e-01   +1.689970898213581e-01   +3.710868297485797e-02   -2.596586625072360e-04; +1.563483583389577e-01   +8.490720038151893e-02   +6.963528805463655e-02   +1.426265058178040e-01   +1.774968789086704e-01   +9.021797984319030e-02   +2.397556513617652e-01   +5.433695593883650e-02; +1.824895982432779e-01   +9.017806024341286e-02   +2.368491287408384e-01   +2.507535161464346e-01   +1.965013364328153e-01   +1.607198921189165e-01   +8.553279690672599e-02   +8.823632389030660e-02; -2.897942713888738e-02   +2.310232748561914e-01   +1.569007142358725e-01   +1.552826558189060e-01   +1.291315781861637e-01   +2.416379873349046e-01   +1.708281919732357e-01   +2.083389609530007e-01];
L1I_L2I_iGABA_netcon = [+1.931942238378110e-01   -9.355910466926399e-03   +2.459724373567824e-01   +6.147846456466310e-02   +1.257688622508953e-01   +1.349987333673066e-02   +5.721302238353685e-03   +5.626149718050638e-02   +1.811252252738471e-02   +1.724105511042759e-01   -4.646811197414134e-02   +7.551409000305510e-02   +9.692292140736072e-02   +5.357263596940862e-02   +2.242897514498417e-01   +1.280051268655347e-02; +1.312931492937649e-01   +2.683128554645631e-01   +8.395235078226582e-02   +1.946320578275071e-02   +1.638617847238978e-01   +7.945009622515695e-02   +2.214374761555269e-01   +2.200757252993387e-01   -3.074629910819253e-03   +5.863923395810865e-02   +9.794153443642081e-02   +4.030816435274742e-02   +1.394772271361243e-01   +1.483813181258594e-01   +3.030151509489278e-02   +4.719531970897883e-02; +3.884521743453763e-02   +7.038148863879347e-02   +6.638329748079638e-02   +2.673196024957820e-01   +3.568073636292309e-02   +2.155193830149606e-01   +1.133252786965437e-01   +1.376599393308354e-01   +2.723996304575796e-01   +4.287243612892566e-02   +9.265834374883962e-02   +1.682001630682800e-01   +3.041226741919690e-02   +1.229195165170227e-01   +1.135567731263235e-01   +1.970428121481405e-01; +1.278116493288758e-01   -2.078749587583207e-03   +2.516270222571196e-01   +1.451495068233073e-01   +4.214837506838100e-02   +2.372330391007799e-01   +1.197946185588727e-01   +1.879038359179453e-01   +1.631924863421688e-01   +6.165369233978758e-02   +2.649286313958011e-01   +7.968507044015113e-02   +1.984399351837545e-01   +2.137538739032636e-01   +7.885281106319535e-02   +1.152456349361249e-01; +3.352134231276352e-02   +1.920645037016620e-01   +6.920231891925860e-02   +2.097293794181029e-01   -3.525434319612190e-02   +1.471779019951185e-01   +2.173384070954405e-01   +6.744950704512710e-03   +1.250330178960462e-01   +1.345439393587186e-01   +1.053809713672691e-01   +1.076517583647626e-01   +1.985844936861020e-01   +3.440854271694520e-02   +1.116667033302496e-01   +1.006811149519074e-01; +1.850948296233097e-01   +1.976668874578125e-01   +1.363613946942827e-01   +2.231447225795790e-01   +6.083921633677757e-02   +8.639066399372569e-02   +3.983692859019828e-02   +5.066119167214689e-02   +2.706940144851557e-01   +2.521432751410912e-01   +2.514891717723617e-01   +8.496242804809906e-02   +1.470881343601536e-01   +1.532067278204695e-01   +1.557242695642569e-01   +2.477768960494565e-01; +1.827750160326715e-01   +1.350779459170481e-01   +2.146248948703332e-01   +2.138266495637210e-01   +2.183959997082509e-01   +2.412364831222378e-01   +1.776362177379412e-01   +1.631021562209264e-01   +1.174894779955829e-01   +2.108193654260392e-01   +1.168619697973053e-02   +5.689915729562148e-02   +7.104239030025494e-04   +1.036143608597396e-01   +1.810839477024785e-01   +3.754214262923371e-03; +2.047497564587880e-01   +1.038889796429177e-01   +1.993205049808494e-01   -9.774875646168628e-04   +8.855726010318116e-02   +3.098438744438061e-01   +7.116410685288682e-02   +1.908271878320724e-01   +1.095244917570523e-01   +2.754417299945338e-01   +1.371602305699569e-01   +4.667692268951855e-02   +1.304906281651904e-01   +5.013932177956214e-02   +8.936421420486753e-03   +6.861451752002123e-02];
L2E_L1E_iAMPA_netcon = [+8.360885947130958e-02   +7.755453784697902e-02   +2.957252119872074e-01   +5.468637557242022e-02   +6.543432171707682e-02   +1.178537239586882e-01   +7.116027611436837e-02   +2.256892387978857e-01; +1.636398970484534e-01   +2.152009160288595e-02   +2.539726501930627e-01   +2.132828402770948e-01   +2.282396464965228e-01   +1.410610760410103e-01   +8.954029204605277e-02   +1.028763349645746e-01; +1.675072744798006e-01   -5.933835582303348e-02   +2.953863207249010e-02   +1.516975462673338e-01   +7.582437931372463e-02   +1.841569640699638e-01   +1.167062424410284e-01   +4.814196512006455e-02; +1.905371258111518e-01   +9.968091851035239e-02   -1.031707892820109e-02   +4.461125431286902e-03   +7.155133122118557e-02   +6.338407133090630e-02   +4.588995705110964e-02   +1.812573597432679e-01; +6.211109027156686e-02   -5.809902723382590e-02   +9.817651657607525e-02   +2.077401899782614e-01   +6.474936553032534e-02   +1.137198004785828e-01   +1.861314705880186e-02   +8.828889928455311e-02; +8.479516812850810e-02   +1.742141645799299e-01   +1.003752441052738e-01   +2.796735961729426e-01   +3.139327809103764e-01   +1.555887750226375e-01   +1.991409348581005e-01   +2.342017546570354e-01; +1.753313030977494e-01   +1.363621201150782e-01   +3.902266009870566e-03   +1.981973490512308e-01   +2.904420552432724e-01   +1.156380896275819e-01   +1.497477523904313e-01   +8.523757610881194e-02; +4.928180217610455e-02   +1.059796280334365e-01   +3.544639314935011e-03   +2.693340006525991e-01   +3.044489909508578e-02   +1.833780539491471e-01   +1.179282635081657e-01   +2.349999851441265e-01; +1.429399753170158e-02   +1.145105217494258e-01   +1.626282090072239e-01   +2.590080812728583e-01   -1.400409779155648e-03   +1.931995099344370e-01   +1.454071421233676e-01   +2.550032065675147e-01; +1.328217520178114e-01   +2.222564214752488e-01   +1.211238772408762e-01   +1.104398900799675e-01   +2.843190846862934e-02   +1.942663394665581e-02   +3.479025710994912e-02   +8.581420413646845e-02; +1.093332630764749e-01   +2.990949377345286e-02   -4.165873191477807e-03   +2.464323579682673e-01   +5.781257895131559e-02   -6.862717236003818e-02   +1.928089385193797e-01   +5.513678996493535e-02; +1.446193413898821e-01   +1.731944697243450e-01   +2.280192811975471e-01   +1.910742533497360e-01   +1.147981541603250e-01   +2.015577825423677e-01   +1.757656959952761e-02   +2.434143307700645e-02; +6.230169223698376e-02   +1.724074878445598e-01   +2.738451147751991e-01   +1.576073742145859e-01   +1.690001454710213e-01   +1.112368829367481e-02   +1.363729982824679e-01   +2.684575496789982e-01; +2.441071462206126e-01   +1.687682927539760e-01   +2.191042413795321e-01   +2.494472111588773e-02   +4.189582846780372e-02   +4.401792468564797e-02   +1.694764598344706e-01   +2.260717006703060e-01; +1.777585604701276e-01   +1.191444905533620e-02   +4.833918119484450e-02   +2.107630300194524e-01   +2.334214219185271e-01   +2.258714663602049e-01   +6.478287573371637e-02   +8.056723193504838e-02; +1.110593751388687e-01   +2.244791043829496e-01   +3.368880619326545e-02   +1.809042173414114e-01   +1.609609108543470e-01   +2.394453296284135e-01   +3.698932690478580e-02   +1.562881396706179e-01];
L1E_L2E_iAMPA_netcon = [+1.567851339856311e-01   -4.159392830104024e-02   -7.646874888243399e-03   +1.188117872990621e-01   +1.972875626239725e-01   +1.723023876227292e-02   +3.803032498428971e-02   +2.208786239827105e-01   +3.412359777097524e-01   +1.064091002521433e-01   +2.742114629591185e-01   +2.157837619642056e-01   +4.137538233447719e-02   +7.731902112081786e-02   +1.030028202990756e-01   +6.940114266801239e-02; +2.066319221533822e-01   +1.372463400923452e-01   +7.567995486375524e-02   +6.350109560339026e-02   -2.344896038463316e-02   +8.385203009884394e-02   +2.016746707347487e-02   +2.292611299566834e-01   +2.259189001759770e-01   +2.655975473823497e-01   -6.755567474554909e-02   +1.310916212266231e-02   +1.911212209448711e-01   +1.581700976574113e-01   +8.348211969333762e-03   +1.845266043229176e-02; +2.683805905282763e-01   +2.397015509323675e-01   +1.168049986286884e-01   +1.293491063786883e-01   +1.204824979891713e-01   +1.076694056769811e-02   +8.911151848030442e-02   +9.212822630513275e-02   -2.138201713542103e-02   +1.036569401875161e-01   +1.335215058441143e-01   +2.169335320531658e-01   +4.550712805648684e-02   +2.438570288772671e-01   +1.590395615572718e-01   +2.857763478837131e-01; +1.226861764628680e-01   +1.799232913957942e-01   -6.034055326743463e-03   -1.437592506642507e-02   +1.560148679371122e-01   -4.535971152595746e-02   +1.366322651290803e-01   -2.204859674791469e-02   +1.519222943757400e-01   +2.709743698481511e-01   +2.028391659031504e-01   +1.440607918226484e-01   +9.560069189680689e-02   +2.290052889623819e-01   +1.297965814830962e-01   +1.153368650091268e-01; +1.964213783687527e-02   +9.658087885035452e-02   +2.352669379806893e-01   +2.762009173599532e-02   +8.749177831049652e-02   +3.025504784573387e-01   +3.682153641749265e-02   +2.894801377789371e-01   +1.780648768900861e-01   +1.894264452921168e-01   +7.130087351119606e-02   +1.203837678523847e-01   +2.043911490592679e-01   +1.631239215989202e-01   -2.619518217870267e-02   +5.794734107439662e-02; +6.374947356260631e-02   +2.125966311626632e-01   +1.216842558640182e-01   +2.308486931884471e-01   +7.086023116495423e-02   -2.633399973505201e-03   +2.262101844513300e-01   +3.867564452974399e-02   +1.735938294005951e-01   +1.140776640973645e-01   +1.268128422089689e-01   +1.159011764747541e-01   +3.528310957091753e-02   +2.220892506187848e-01   +1.484276406164610e-01   +5.186982443170241e-02; +2.280490972535367e-01   +2.645651415203136e-01   +1.639175781722822e-01   +1.708221777602390e-01   +2.211281201348596e-01   +2.374134388491542e-01   +1.748129944349525e-02   +1.780759764369658e-01   +1.787411654612416e-02   +2.523647466535656e-01   +8.500468109840473e-02   +3.663584686138898e-01   -1.673613332123146e-03   +9.202623219812410e-02   +1.486441086962868e-01   +1.099451179834635e-01; -3.479233767806453e-02   +6.445912294592068e-02   +1.636499595125594e-01   +1.715599078280534e-01   +9.318731195143290e-02   -4.442999610183348e-03   -7.382845417654336e-02   +6.034226877632513e-02   +1.290405332338258e-01   +2.450522932406655e-01   +3.264480449050022e-02   +1.914365123371675e-01   +1.568900090221664e-01   +1.239764412014670e-01   -1.292440714637859e-02   +2.893897834380972e-02];
L2I_L2E_iAMPA_netcon = [+7.904832815934855e-02   +1.569803244912374e-01   -6.854964061125268e-02   +3.111429600029803e-01   +2.357587046315396e-02   +1.493782134072695e-01   +3.304558809138901e-02   +1.773683997078967e-01; -5.357799129565796e-02   +2.329286601017032e-01   +9.201629227211013e-02   +1.237612901924634e-01   +1.862946353681806e-02   +1.484574487929164e-01   +1.748935335888652e-01   +1.493367860765903e-01; +1.386772468667388e-01   +6.389594420670872e-02   +2.168196792362182e-01   +5.295153888272704e-02   +3.464445972349358e-02   +2.066401496933599e-01   +1.728389295265342e-01   +1.858893779909653e-01; +1.724114745938537e-01   +1.798897931811429e-02   +1.488673480022911e-01   +1.467832256376418e-01   +5.438276313850321e-02   +1.485565946255088e-01   +4.360134175956579e-02   +1.284402952650459e-01; +1.808829352565478e-01   +2.168881121239843e-01   +6.339869792210436e-02   +1.903963998019061e-01   +6.656140035480088e-02   +2.128081585958774e-01   +1.685379933087973e-01   +9.442860780519997e-02; +2.283030115887082e-01   +1.505629414307956e-02   +1.008229686014302e-01   +4.308914389044973e-02   +4.893961043215837e-02   -1.575476604556965e-02   +2.875227025082219e-02   +1.737127328815651e-01; +1.751282369757372e-01   +1.875283944282231e-01   +6.693957287533614e-02   +1.505220108499897e-01   +2.396804594072451e-01   +1.017398642229913e-01   +2.391204851682545e-01   +2.057823332986048e-01; +1.773881585642260e-01   +2.771503596149110e-01   -1.673403740605401e-02   +3.824204987987056e-02   +2.855860949902004e-01   +9.825779180443334e-02   +2.022964033764491e-01   +1.473489412424540e-01];
L2E_L2I_iGABA_netcon = [+2.181406223222474e-01   +1.526710625265167e-01   +1.390638940774420e-01   +2.298337523607079e-01   -1.501016489648892e-03   +2.332348926252301e-01   +2.860791583488269e-01   -1.304857321932709e-02; -2.237974286629724e-02   +4.409201378089981e-02   +1.808073620818162e-01   +1.482591740360839e-01   +2.320960167320050e-02   +9.882332332674354e-02   +2.986480464902305e-01   +2.777570500506693e-01; +1.914392082539611e-01   +2.549194427887926e-02   +1.614097533571072e-01   +1.280635662221256e-01   +1.837603811812010e-01   +8.123522383846790e-02   +1.941802340896555e-01   +8.251296633755487e-02; +1.333960937672442e-01   +2.084533864023528e-01   +2.068024246167989e-02   -8.609241136577368e-03   -1.582500617813865e-02   +1.919358110941725e-01   +1.748605404572735e-01   +7.795369973389882e-02; +1.975945536179535e-01   +1.301202146614927e-01   +6.820242621287673e-02   +6.020550009182313e-02   +2.513323555177876e-01   +1.950425531909908e-01   +1.168489539791753e-01   +1.328479385024112e-01; +3.020818046951599e-01   +1.352452892082680e-01   +8.246460755327928e-02   +1.058826314830893e-01   +2.451696198359022e-01   +1.160003951244728e-01   +7.774858092736490e-02   +2.063166304878453e-01; +6.798917065938442e-02   +1.531664165005923e-01   +2.192123723407227e-01   +2.972021054746769e-02   +2.525273983401732e-01   +9.458834947486711e-02   +2.782611931372828e-02   -6.939612267755050e-03; +1.247713586246041e-01   +5.915514699078737e-02   +3.609645411275794e-01   +1.277670326019791e-01   +2.888438071060445e-01   +2.289764134499900e-01   +1.517472117995709e-01   -1.996441578364703e-03];
L3E_L2E_iAMPA_netcon = [+2.211215629228100e-01   +1.169139814980735e-04   +8.683943192144537e-02   +9.714635425237579e-02   +3.191516045680406e-01   +1.653026335283805e-01   +8.663490947647515e-02   +2.912306501803692e-01   +1.195194973084794e-01   +1.058163363493211e-01   +2.279280645410172e-01   +2.242243983831060e-01; +2.303904716402661e-01   +3.052526788984969e-01   +1.832572474868838e-01   +1.843775501185139e-01   +8.046217647756228e-02   +8.862203774964926e-02   +1.127606336657637e-01   +6.162451294492246e-02   -1.301396720503598e-02   +1.401256148558970e-01   +3.359038883230309e-02   +1.845698283522585e-02; +3.107106304695023e-01   +1.865342643321044e-01   +2.000861676138676e-01   +2.367649030841835e-01   +2.198385830904754e-01   +3.500122338558588e-02   +2.443679514478715e-01   +7.912584426207761e-02   +1.536424970326155e-01   +1.542653076190805e-01   +1.363381972381026e-01   +1.094720957168283e-01; +9.663801029499307e-02   +1.331758136294324e-01   +2.578567112044719e-02   +5.645492394781587e-02   +1.746853880784564e-01   +2.042076152737666e-01   +1.684329458490255e-01   +1.677082924480942e-01   +1.837425759381467e-01   +4.144434137045181e-02   +5.025551919862156e-02   +7.691043008450395e-02; +2.138449547224656e-01   +1.531998362758966e-01   +8.673571781428871e-02   -1.142540693162673e-02   +1.500911466672052e-01   +2.488846103770094e-01   +2.569282800574220e-01   +2.119294503400147e-02   -1.215007820395322e-02   -3.699410787449733e-02   +3.006723338882413e-01   +1.768086075423994e-01; +1.400827616765914e-01   +2.438224555890087e-01   +1.736081912261295e-01   -1.159859984156804e-02   -3.472564604010966e-02   +1.997097573305434e-01   +1.857840839914096e-01   +1.960009389483904e-01   +7.459659853250043e-02   +4.728660968892978e-02   +1.472643712221541e-01   +6.607858102664907e-02; +1.721447786700327e-01   +1.391734398452886e-01   +1.956966241570627e-01   +2.484687947915110e-01   +2.449158455003166e-02   +2.859674091310103e-02   +2.025645849975832e-01   +6.702445740256785e-02   +5.255736298368836e-02   +8.693604994696637e-02   +4.409339898083203e-02   -2.175997830713805e-02; +1.229054312283059e-01   +1.370067733624068e-01   +2.488945009181628e-01   +1.177637388095539e-02   +1.970246610445174e-01   +1.285986731448686e-01   +2.387885660675819e-01   +1.248339795909214e-01   +4.504768128139318e-02   +5.970475668965306e-02   +3.048084710998266e-01   +1.246030062693795e-01];
L3I_L2I_iGABA_netcon = [+2.097334295964479e-01   +2.196721022453107e-01   +1.701569139996073e-01   +1.418686213933983e-01   +1.022834331127735e-01   +1.832674296601666e-01   +1.783470016677560e-01   +1.642271992743749e-01   -1.040167116827436e-02   +1.018617604721152e-01   +9.718144609584807e-02   +1.926323725160794e-01; -1.458193037313986e-02   +1.748638852689339e-01   +1.985351927082876e-01   +1.823932091415833e-01   +2.953962395239939e-01   +2.645657479066629e-01   +4.135388001023699e-02   +2.832618220852192e-01   +1.338389773619004e-01   +1.477989235283984e-01   +5.356104734703131e-02   +3.969694054570169e-02; +1.372813824833118e-01   +2.084851322571101e-01   +2.561153404052153e-01   +2.408378131517906e-01   +1.258403552747022e-01   +1.201260718230522e-01   +1.874591491759749e-01   +4.742349167768302e-02   +2.981618784093681e-01   +1.775390698556589e-01   +4.948500430513581e-03   +2.027458300750386e-03; +1.982386297960282e-01   +1.433211338669562e-01   +1.233101597971610e-01   +9.378798993087943e-02   +2.549283464198734e-01   -4.304761651156157e-03   -4.635977049361774e-02   -8.526542363030324e-03   +2.172776436256351e-01   +2.165871083158355e-01   +1.234000661609179e-01   +8.196753121356187e-02; +1.456181395737729e-01   +8.965457361648883e-02   +2.016406108161251e-01   +8.022130616834028e-02   +1.376957337981155e-01   +5.874587092209080e-02   +1.088686708701260e-01   +1.744515436384935e-02   +2.739995169803842e-01   +6.674361378872813e-02   +2.799719767088286e-01   +3.607314074804770e-02; +2.302698672134387e-01   +9.365706766001768e-02   +1.856831828023192e-01   +7.320851432325001e-02   +1.422574677036371e-01   +9.705588478705773e-02   +3.172612800570275e-01   +1.269793959266236e-01   +1.995569745041008e-01   +5.200750296868795e-02   +3.346977007692217e-02   +6.145369433962106e-02; +8.593838694575570e-02   +1.809616452618646e-01   +8.533409452162589e-02   +4.255312181661801e-02   +2.295733876884088e-01   +2.337131260479287e-01   +1.592739992769043e-01   +1.246338550100698e-02   +1.873625701552059e-01   +1.124593741706452e-01   +5.076508575609837e-02   +6.886451664034324e-02; +1.251804512867365e-01   +1.481145513228160e-01   +1.776671830181226e-01   +1.502616080061888e-01   +1.135831591709671e-01   +9.002951943435081e-02   +3.056015867256613e-02   +1.229104852243748e-01   +1.419379161737619e-01   +8.218234458878143e-02   +4.975091378958404e-02   -1.098740459253559e-02];
L2E_L3E_iAMPA_netcon = [+1.059784554224854e-01   +2.276143025158659e-01   +1.978786124280155e-01   +3.504321496575169e-02   +7.222302627513688e-02   +1.857888964473057e-01   +1.682572080369522e-01   +3.116426098470186e-01; +2.176133050449417e-01   +1.710141883430915e-01   +1.899769768490691e-01   +6.587736496981359e-03   -2.807152096674784e-02   +2.331490346066871e-01   +1.654845441116752e-01   +2.176787694510793e-01; +1.189810343031466e-02   +1.009807390965591e-01   +6.211845684755521e-02   +2.175032254742181e-01   +1.444982231056950e-01   +4.321267639032411e-02   +2.301978775089958e-01   +2.780662972630999e-01; +6.536361829479889e-02   +7.491330812913498e-03   +1.042746314869943e-01   +1.317234506196459e-01   +4.443125626050234e-02   +1.613451870927971e-01   +1.108087250675437e-01   +2.729140516045118e-01; +1.484089636046157e-01   +1.723190879373507e-01   +1.605919015320430e-02   +2.340680266718415e-01   +8.382019381859560e-02   +8.600228177534812e-02   -5.046952629195362e-02   +1.668349785143334e-01; +1.255591227907715e-01   +3.076182660703940e-02   +1.115461854020998e-01   +1.040702462165884e-01   +7.308104419904883e-02   +1.616868423417644e-01   +2.081795527896845e-01   +1.819703727963886e-01; +1.712253796879057e-01   +2.039917717844954e-01   +1.366178434614159e-01   +1.040451371376157e-01   +5.741600146361226e-02   +1.866865830358321e-02   +1.560062616151245e-01   +2.033498356488114e-01; +1.949427113435247e-01   +5.924115265030200e-02   +1.906506747667933e-01   +2.259195515733171e-01   +1.344455158798673e-01   +1.674581510022120e-01   +1.566952670644080e-01   +6.786480408432287e-02; +1.075225614541022e-01   +1.697390044533645e-01   +1.645308073038496e-01   +1.499439648141133e-01   +1.404328868416851e-01   +1.568472391438187e-01   +4.970644674060221e-02   +2.821970876018787e-01; +8.547210621129156e-02   +1.021567005012030e-01   +1.175931106565768e-02   +1.070507221726265e-01   +2.307179416348207e-02   +1.465407112219912e-01   +2.529746737549083e-01   +2.170926693216114e-01; +1.609054120758302e-01   +5.342538420001200e-02   +1.925310755496861e-01   +1.345815820809770e-01   +2.660601256890312e-01   +5.663284727599673e-02   +1.948499642673562e-01   +5.188724344876468e-02; +2.190461487157895e-01   +1.304529930393050e-01   +6.609323425636383e-02   +1.052968237843003e-01   +1.799288323945580e-01   +1.373868046427558e-01   +1.313971435897694e-01   +1.818900104545169e-01];
L2I_L3I_iGABA_netcon = [+9.216669051372997e-02   +2.187670506157747e-01   +3.820142585097967e-03   +1.743846411109778e-01   +3.418536613722471e-01   +2.265347067445804e-01   +1.961283365773330e-01   +2.263278239300338e-01; +2.112526267842683e-01   +2.053145471383962e-01   +6.702250447682108e-02   +1.519248824968346e-01   +1.803430628613967e-01   +2.658628424416763e-02   +1.216865710387338e-01   +2.148194337724162e-01; +2.052476075845296e-01   +1.989519325995514e-01   +2.466654970663932e-01   +1.165214467878015e-01   +1.623604639368160e-02   +1.772440419695568e-01   +1.632771641309803e-01   +2.664671732528189e-01; +1.724055481019107e-01   -4.691716445027935e-02   +1.247889698417835e-01   +4.852793116597919e-03   +9.888154267278187e-02   +1.754059196587816e-01   +6.448892773701607e-04   +1.329472050930505e-01; +5.083815212818235e-02   +1.604979348021237e-01   +5.962710538450772e-02   +1.183406532174482e-01   +1.309555668041596e-01   +1.979536938286413e-01   +1.460640702457696e-01   +1.953804279965231e-01; +1.007496852929796e-02   +8.932410696721985e-02   +1.491954184332659e-01   +1.482971829693741e-01   +4.854984601863773e-02   +2.676840416473697e-02   +2.149848655245311e-01   +2.604203097549591e-02; +7.102744323013206e-02   +1.131699352224357e-01   +2.066049474470413e-01   +4.521758985873427e-02   +1.207627776941601e-01   +7.523332334913416e-02   +2.990235031349001e-01   -5.929242281622978e-02; +4.877369580805833e-02   +2.024621172532470e-01   +2.762977586606373e-02   +1.435226769146440e-01   +7.091841033250590e-03   +5.666482191788871e-02   +1.604529914262606e-01   +1.643484235286515e-01; +1.637695932034831e-01   +7.608808459391565e-02   +9.401975944304390e-02   +2.183223299978332e-01   +1.885107572272831e-01   +2.615923088662401e-01   +5.979547684466765e-02   +1.854588502459171e-02; -3.427632594483304e-02   +4.587027605745540e-02   +4.277030540453461e-02   +1.543986055902612e-01   +1.658500088618482e-01   +6.571504816102584e-02   +3.524228704870029e-02   +6.663447027954823e-02; +1.643714068293982e-01   +1.932678502800068e-01   +1.092715484460757e-01   +2.396449237215293e-01   -6.913402237516836e-02   +2.191751257343990e-01   +3.745713650043251e-02   +2.750869639946207e-01; +2.315392857171416e-01   +9.854436608312818e-02   +1.753612450995950e-01   +7.050753407114778e-02   +2.465827454252751e-01   +2.051006953307858e-01   +8.875885402710247e-03   +1.354497728968733e-01];
L3I_L3E_iAMPA_netcon = [+2.501165477993558e-01   +8.029787116723543e-02   +2.159113521805117e-01   +1.346117369176826e-01   +1.862191755710674e-01   +1.093028053050838e-01   +1.216682126824506e-01   +2.873690145080686e-02   +1.740197648361611e-01   +8.664681391522602e-02   +2.142537810618749e-02   +1.106069066059503e-01; +2.812488738791710e-01   +2.935826822486688e-02   +1.098476263789409e-01   +7.813167161214427e-02   +2.381232559335561e-02   +4.387715700600515e-02   +5.631647206160793e-02   +2.603203565510143e-01   +1.697989816642451e-01   +2.610975400930574e-01   +3.689005903125440e-01   +2.083574579736763e-01; +2.048626617803290e-01   +5.286090356635233e-02   +2.268099634914207e-01   +4.830929359182745e-02   +6.164420667708719e-02   +1.926578102499237e-01   +6.363117147710674e-02   +1.471401624999357e-01   +1.238479287732899e-01   +9.503471782116107e-02   +2.631083805631527e-01   +1.545064337421967e-01; +1.839457377111729e-01   -2.645903036689579e-02   +1.169118672613713e-01   +2.493435266652704e-01   +2.715905446178406e-02   +1.062248105042774e-01   +2.101973554020521e-01   +9.903551494422155e-02   +1.180014667437833e-01   +9.989406937291785e-04   +1.250932112283515e-02   +7.010528970990565e-02; +2.307125831470926e-01   +1.121180551966087e-01   +1.548301642106522e-01   +1.814100966745844e-01   +1.007014853775235e-01   +1.005909691910649e-01   +6.116501501563922e-02   +1.295756910094390e-01   -1.397717882192082e-02   +2.199497883914414e-01   +1.533185848939519e-01   +1.542341837476212e-01; +3.186978092174561e-01   +2.082355045099732e-01   +7.329708778021586e-02   +1.820686155502490e-01   +2.420820332620052e-01   +1.420153871780769e-01   +6.729589472491232e-02   +1.893135134082227e-02   +1.673682602040126e-01   +1.270450643755620e-01   +1.894071551303122e-01   +2.636376955302597e-01; +1.221663343732908e-01   +1.153047181200637e-01   +9.188648851684524e-02   +1.418443246157390e-01   +6.053762452947777e-02   +1.815899646393610e-01   +1.527681458224255e-01   +1.458881290279840e-01   +2.627805521060739e-01   +2.291959516715315e-01   +5.710958392211229e-02   +1.847630044349917e-01; +1.707120480856904e-01   +2.158324189469780e-01   +5.215215085836655e-02   +1.493384326940329e-02   +2.666831794212436e-01   +1.215097702709655e-02   +9.496422824235376e-02   +2.306076656981668e-01   +1.574632119191142e-01   +2.161402131405440e-01   +1.787292664566385e-01   +2.235628648491693e-01; +2.517027160138475e-02   +2.326051475893094e-01   +7.729409972535847e-02   +1.399165280452454e-01   +1.690799595493344e-01   +1.821434097854427e-01   +3.025401470680835e-03   +1.898285299075785e-01   +3.984809646858260e-02   +1.782724606365757e-01   +1.512530947270712e-01   -4.247869768003727e-02; +1.020288168803671e-01   +2.325321761299953e-02   +4.116902270176794e-02   +1.601357187164775e-01   +1.163151686254296e-01   +2.556613780828780e-01   +1.095944066401903e-01   -1.446706066054337e-02   +1.693228210990806e-01   +2.093877184295917e-01   +2.528914101627572e-01   +1.532382399659665e-01; +1.790225590628043e-01   +1.097950513507387e-02   +2.418803001554968e-01   +4.086092082427351e-02   +1.487884824226883e-01   +1.786321578732328e-01   +1.227657234596387e-01   +1.508593622431709e-02   +9.822652097536867e-02   +2.054424007128853e-02   +1.800866970468677e-01   +4.272892566415698e-02; +1.429101644530558e-01   -9.567467287525491e-02   +7.412469339622792e-02   +1.893286399433374e-01   +5.683099244968835e-02   -5.712723355667447e-02   -1.415090059402276e-02   +1.819285274975596e-01   +5.668323675645433e-02   +1.614054524725974e-01   -3.694575750743746e-02   +1.091497914859172e-01];
L3E_L3I_iGABA_netcon = [+2.166528122115413e-01   +4.778783946377738e-02   +1.560191199913158e-01   +2.015358147958540e-01   +1.792312355788257e-01   +2.810896777550119e-01   -3.480401140838865e-02   +1.704094810529597e-01   +2.681306907287806e-01   +1.787883752260000e-01   +2.790270078343177e-01   +1.932748366122664e-01; +1.734804350265454e-01   +1.976789201951965e-01   +7.458570432208383e-02   +1.643191555316826e-01   +4.985971048561278e-02   +2.737724917523416e-01   +2.382379526099967e-02   +1.634339280094903e-01   +1.066926137314053e-01   +9.095581718480637e-02   +1.567724587383935e-01   +1.910423126086169e-01; +1.363154062785395e-02   +1.624964221292626e-01   +1.728046006727641e-01   +1.625084157390315e-02   +1.340546107530173e-01   +7.326773828514468e-02   +1.267574728886602e-02   +4.076069595243768e-02   +2.773472788377891e-01   +1.059277847217329e-01   +9.986570068039059e-02   +1.927174498007536e-02; +1.530456178534802e-01   +2.866429715564972e-02   +1.960291406580503e-01   +1.082860451065909e-01   +2.834329053148339e-01   +4.672543528254136e-02   +6.758156249487660e-02   +1.537208903199305e-01   +2.341581293167396e-01   +2.340233181245117e-01   +1.095875426766217e-01   +1.944000720389560e-01; +2.322665873151569e-01   +2.049065360316349e-01   +2.669630555363990e-01   +2.353491530642330e-01   +2.506335567633251e-01   +1.365527628414890e-01   +1.797532731635929e-01   +1.509908753757969e-01   +1.196720413301833e-01   +2.106249004554868e-01   +3.345270155523132e-02   +1.911742179493435e-01; +1.166645136193338e-01   +2.672631672897030e-01   +1.162015381245335e-01   +2.213239429531057e-02   +1.655500828993261e-01   +1.273520047301741e-01   +1.299718802366835e-01   +2.170639103039100e-01   +9.376844241012720e-02   +1.461217210796663e-01   +9.874000848106745e-02   +2.764543373209071e-01; +2.447785398277658e-01   +7.835514491845202e-02   +7.236414644053236e-02   +6.245035964122211e-02   +5.789487682771520e-02   +1.561609186814758e-01   +1.887288247343171e-01   +1.863213839027973e-01   +2.751214347678310e-01   +1.201456126908718e-01   +1.769446507628062e-02   +5.246556245203467e-02; -1.342805033601561e-02   +4.781637189508156e-02   +1.598669299687708e-01   +1.730662107171309e-01   -4.270865810791449e-02   +1.516669629815684e-01   +9.197916441608715e-02   +1.541846174536037e-01   -1.318610976845621e-02   +1.012431050180213e-01   +1.563579179254073e-01   +6.156480835974151e-02; -2.079090693876239e-02   +4.311222934846726e-02   +2.312686345827513e-01   -4.373411202782313e-02   +2.799906151796338e-02   +2.067686967290384e-01   +3.274744445555430e-01   +6.821825579380292e-02   -5.765947157711178e-02   +1.214616904417219e-01   +1.321411279942589e-01   +5.370771588265356e-02; +3.056365516517378e-01   +4.821346945882710e-03   +1.110022612685257e-01   +1.543956383459404e-01   +1.864940754408577e-01   +1.807212163660714e-01   +1.997115027952022e-01   +1.690538621917433e-01   +5.506466915147283e-02   +1.470781909493825e-02   +1.241168997453831e-01   +8.665692819319178e-02; +2.332423160062216e-01   +1.235871719387495e-01   +9.719917737899736e-02   +3.916429489925877e-02   +1.704934783428102e-01   +6.743684352467529e-02   +2.116020016276507e-01   +2.531914379087398e-01   +1.345443465704713e-01   -1.678222709814093e-03   -4.330658606337294e-03   -1.155718819241438e-02; +4.710980439179641e-02   +1.728444844296808e-01   +2.092951462426332e-02   +2.475161276694696e-01   +2.405812892525863e-01   +5.579000029809968e-02   +1.159456600223437e-01   +2.199673004633010e-01   +1.883800120988201e-01   +6.445952082754085e-02   +1.794115276847374e-01   +4.573603628357843e-02];
L2E_Input1_iAMPA_netcon = [+1.235596900879659e-01   +8.344814302304790e-02   -5.879118384627864e-02   +2.101967496303951e-01   +1.089632129982996e-01   +7.473337616076126e-02   +7.460822961072508e-02   +1.504495058404957e-01];
L2I_Input2_iAMPA_netcon = [+4.821642095982270e-02   +7.995591856131798e-02   +1.245299654736161e-02   +1.003390212998584e-01   +9.799410136758703e-03   +6.194812133378295e-03   +8.011665996663561e-02   +8.505402925196219e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
