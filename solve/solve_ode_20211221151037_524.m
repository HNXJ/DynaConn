function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.599945552979462e-01   -5.732099323536127e-01   -4.697574656521288e-01   +2.270806693374256e-02   -5.573417911225629e-01   -4.576891701170568e-01   +1.179214727707493e-01   +1.998590226264986e-01   -5.736550209492753e-01   -2.332240493886232e-01   +5.379726621727534e-01   +2.270791370452913e-01   +9.290382949846819e-02   +5.776754793951865e-01   -3.765951883579833e-03   -2.988006686356461e-01; +4.615988502181900e-01   -2.166100266452104e-01   -7.018206771417568e-01   -6.752309145503210e-01   +2.179362586862305e-01   -1.259006767193546e-01   -6.439858167393703e-01   -4.357054073656634e-01   +3.490425146661840e-02   -2.704948750272520e-01   -2.516935505982879e-01   -2.651446518633693e-01   +1.962937934936095e-01   -7.716624864320096e-01   -3.701435728463523e-01   +1.949575511360318e-01; -2.062524528683337e-01   +4.271335728947994e-01   +2.026625990094770e-01   -7.032957156337055e-01   -2.393047936190055e-02   +5.658372208354915e-01   -4.303540358219563e-02   +5.869948430428384e-01   -5.542601898940788e-01   -8.869591287658565e-02   +5.485961618373658e-01   +3.064929580666136e-02   +8.188172523331476e-01   +5.005046680787563e-01   -6.146121211889534e-01   -1.992208354757156e-01; -9.782263154531305e-02   -1.205756197529688e-02   +1.839315919323689e-01   -1.742949942936950e-01   -1.667291758952160e-01   +4.202635276873670e-01   -1.233710894554159e-01   -2.898307780385393e-01   -1.017749158960860e-01   -9.565407837034857e-02   -2.384650054809282e-01   -1.346200072838147e-01   -3.369571728304312e-02   -6.381236607809992e-01   -3.341357809018282e-01   -1.009330908179982e-01; +9.120900136288952e-01   +5.122855650261441e-01   -8.489302110723742e-01   +1.812821455920461e-01   -6.948902331653251e-01   +2.022632672578999e-01   +4.824791722329710e-01   +5.336725382907027e-01   +3.353902501963598e-01   -2.222016934878964e-01   +1.756361668270708e-01   -4.957483743519146e-01   -4.502056085615003e-01   +5.579924889595329e-01   +8.909748103775856e-01   -4.899434881754537e-01; -6.394445028000059e-01   +5.572289923098698e-03   -3.094494455864038e-01   +4.680820949788685e-01   -7.015007690096104e-01   -4.045779065139131e-01   +1.056449582454333e-01   -2.123404277264487e-01   -5.921239152547377e-01   +4.938089627436814e-02   -8.086932781418169e-01   +3.044465260159082e-01   +2.937431515893344e-02   +3.785977495052854e-01   +6.701771354538399e-01   -7.777151935587774e-02; -4.770449397184651e-01   -9.656841938353989e-03   +2.247957216488421e-01   +3.245031840047716e-01   +6.912237707941011e-01   -2.338622755021614e-01   -1.044466565572343e-01   -1.262707321522605e-02   -8.077028110992486e-01   -5.393677246392085e-02   -4.368946930748145e-01   -6.569207968853537e-02   +6.390321837070660e-01   +5.515725240178393e-01   +8.628902593575030e-02   +5.642288025189071e-01; -6.667340511988481e-01   -4.848982365354110e-01   -2.408051471779102e-01   +5.440695331811385e-01   -3.347273311141487e-01   -4.403346273320757e-02   +4.943105451010806e-01   -7.593278565207621e-01   -2.717390810802212e-01   -4.585714740463763e-01   +6.652413216883255e-01   -1.681578485067722e-02   +3.546749304200150e-01   -5.492554512661193e-01   +2.646679404577575e-01   +7.953404404815712e-02; +2.241775541623405e-01   +8.693090653551536e-01   -3.895253305622486e-01   +1.046276730076798e-01   +3.694068625180549e-01   -1.873193722227968e-01   -5.417669117667170e-02   -9.020706442892499e-01   +5.605627681550033e-01   +2.788246282296092e-01   +3.888550901850515e-01   +3.531838972525138e-01   -5.321666650009048e-01   -9.245395288070060e-02   +7.249883581934000e-01   +7.487293802046050e-01; -3.964401187801990e-01   +6.694529900458183e-01   +4.939232177587098e-01   +4.988555093868194e-01   +8.338835693465117e-02   +2.292884727609264e-01   -1.664915318715360e-01   +3.087790179846402e-01   -4.093268321970662e-01   -7.695284042603531e-01   +5.888334046579963e-01   +7.190248592001280e-03   +6.637410190377392e-02   -3.473365977992517e-01   -8.150545502664192e-02   +1.507935090248920e-01; -6.712943741028847e-01   -5.210217785933302e-01   -5.398441803845013e-01   +1.837562435579689e-01   +4.182593532856834e-01   +4.080815890631984e-01   +5.367031175222052e-01   +9.073536607635414e-01   -5.105239019292914e-01   +2.728899044471771e-02   +5.219309395286820e-01   +4.296118297811756e-01   -6.303053204085044e-01   +5.315662425961963e-01   -3.302411735700438e-01   -5.137712831881240e-01; -4.829077760343644e-01   +7.048031910913889e-01   +6.960845580411633e-01   +7.969141998926260e-01   +1.000000000000000e+00   -4.394881478655394e-01   +2.307727830383511e-01   +2.465935541904552e-01   +1.843491313660388e-01   +3.169695288115903e-01   +6.044095897288049e-01   +3.170921261648860e-01   +6.234812507746802e-01   -7.918686930592488e-01   +4.250046631337020e-01   -1.110722092706273e-01; -2.420394205324665e-01   -5.308889284052575e-01   -2.476272052979381e-01   -2.407353366501335e-01   -3.182322958160947e-01   -2.068408125390168e-01   -6.069135283796099e-01   +4.611898001856879e-01   +6.134585163297350e-01   +5.652738304224657e-01   +5.620093776186518e-01   -3.142178560089066e-01   -5.885655449074489e-02   +2.034545183472917e-01   +1.289994275302582e-01   -2.352137412043606e-01; +6.232909813739131e-02   +8.635104056192803e-03   +4.427473389885925e-01   +3.336747247566122e-02   +8.319508749994219e-01   +2.183708649647851e-01   +6.715153854014851e-02   -7.363040390886663e-01   +2.384501397672878e-02   +2.163050346658012e-01   +4.381374759113714e-01   -7.814339164404757e-01   +1.385257120309268e-02   -6.479046980321449e-01   +2.792528451154734e-01   -2.927302396075006e-01; +3.075125700548795e-02   -3.456405015429195e-01   -4.206148865298903e-01   +6.464090110754721e-01   +5.277763901530887e-01   +6.328942858969051e-01   -5.606511902384691e-01   -3.706854970008981e-01   +6.845284996706871e-01   -5.772159504355884e-01   +5.597964457775376e-01   -6.287412852027454e-01   +3.903382923402091e-01   -3.196872642078021e-01   -6.743875343109824e-02   +3.034453778089559e-01; +3.362285863562061e-01   -4.494368005301044e-01   -7.881885241126037e-02   +2.277587349650183e-01   -2.926870108872769e-01   -2.482791772838534e-02   +1.080322906586261e-01   -8.618274208731649e-01   -3.527733511546662e-01   +6.425838709604696e-01   +5.305624429825646e-01   -3.333508241772548e-01   +2.930134850964254e-01   +1.093727345140947e-01   +5.376279711700157e-01   -6.317269763047001e-01];
L1E_L1I_iGABA_netcon = [+1.235384555112392e-01   -1.822876761031268e-01   +7.811108644457531e-01   +5.128650416659669e-01   -6.875124767907116e-01   -1.484205672518698e-01   +4.946330827803505e-01   +2.329054492892135e-01   +8.872659525285119e-01   +5.312892124529646e-01   -4.392362892456191e-01   -8.815742830440157e-01   +2.069509057504119e-02   -3.625896302651777e-02   -1.011778710363326e-01   -2.681417292688316e-01; +8.937797793173506e-01   +1.823757795827479e-01   +2.339586095462073e-01   +4.657477712696738e-01   -1.863255666755409e-01   -6.267080570766137e-01   +3.757669232195036e-01   +4.553007319541932e-01   +4.425834965580034e-01   +5.202520413775508e-02   -4.703317185450360e-01   +3.491915294129190e-01   +6.006394493554437e-01   +1.492978458862345e-01   +5.756914997978715e-01   -2.163869814902754e-01; -4.971314920347455e-01   -5.478220007463253e-01   +9.774818481189639e-02   -7.556147885677793e-01   +2.093818426419864e-01   +6.892884833266615e-01   +2.354058833301208e-01   +4.037926144678492e-01   -2.133922688397319e-02   +8.660908568004694e-02   +6.909556226359870e-01   -9.228797301353165e-01   +1.567083299095471e-01   -8.162160691016321e-01   -5.197677148460135e-01   -4.911706391954987e-01; +4.403814126761197e-01   -6.257409034351550e-01   -2.182434707999882e-02   -4.376909535568640e-01   +5.478868455744855e-01   -5.926549593279458e-01   -5.320322174684937e-01   +4.377122221139012e-01   -2.128123188980653e-01   -7.793305709274313e-01   +9.866037682811689e-01   -1.549485884454349e-01   +5.073087907695031e-01   +4.145456024671562e-01   -5.250019652756620e-01   -5.472507138624206e-01; +1.016360838556668e-01   +3.914625403014130e-01   +4.406178817997543e-01   +6.165215552485248e-01   +3.250243163332496e-01   +2.033649479741439e-01   -1.135777345161238e-01   +3.919837870484036e-01   -1.658176627330251e-01   -4.562571383821050e-01   +5.495299952133847e-01   -2.789243470276370e-01   -5.354419620399355e-01   +7.771178595899221e-01   +4.629508927857779e-01   -1.593507093434360e-01; -5.863095628563907e-01   -6.733371281547256e-01   -1.159463330703344e-01   +6.644291825080095e-01   +3.743218529839163e-01   +6.295412956800256e-01   -4.762871453521436e-01   -2.444952638251845e-01   +1.147462202277900e-01   +1.891548316052859e-01   +2.857679272259499e-02   +5.934477248326090e-01   +3.868770600410015e-01   +3.805919883312901e-01   +6.837855947072357e-01   +4.806916357294296e-01; -6.797592804997533e-01   +1.591103678242838e-01   +4.740075848962427e-01   +6.007929182835784e-01   +3.915507487696789e-01   -3.982804937410948e-01   -3.232540206481730e-01   -4.268390761349263e-02   +2.484780731722488e-01   +4.483097714759798e-01   +3.810679956382516e-01   -9.202263530749144e-01   -1.097333364806083e-02   +2.558285787920602e-01   +1.128141881055829e-01   -1.173604087961233e-01; -5.373527599709318e-01   -2.239005097135570e-01   -3.555061202062266e-01   +1.818283351173212e-01   -4.473251925476011e-01   -3.771535720191650e-01   +5.759369854220897e-01   -4.366683343470325e-02   -3.093574923353002e-01   -5.015261013908607e-01   -7.614707755569279e-02   -2.233682078918125e-01   +4.226624484532456e-01   +5.701211576679209e-01   -3.105779522912717e-01   -1.502948890135577e-01; -4.006962500615955e-01   -7.366014509704827e-02   -2.882702726504762e-01   -3.863772845355949e-01   +6.620818096731846e-01   -4.511727343865407e-01   -6.870908494871124e-01   -1.707211882043773e-01   +6.913416954893997e-02   +5.741997671261843e-01   +5.699813292386820e-02   -7.259585924074372e-01   -3.142069138661415e-01   +3.072906561219462e-01   +1.095750692892261e-01   +9.063633111936473e-01; -5.348657421657685e-01   +1.797025462774829e-01   +1.000000000000000e+00   +1.978055988855921e-01   +5.673727868120980e-02   +6.484485371138429e-01   -4.881601906154149e-01   -2.809638820766056e-01   -8.052268232945426e-01   +9.442402134003336e-01   -2.156135816687858e-01   -2.865241876481318e-03   +2.436901827654193e-01   +1.288994452181704e-01   +3.406171582583070e-01   +3.952940412752031e-01; -3.054301059661939e-01   +4.400587822349861e-01   -5.372318158615054e-01   +1.632165513085353e-01   -3.798047484867823e-01   -5.101754958776935e-01   +1.307958847702135e-01   -2.586054979136950e-01   -4.243729379500104e-01   -2.779376691088268e-01   +6.296744444463012e-01   +3.668655214443579e-01   -5.580216346896231e-02   +1.310366830112313e-01   +5.413129188404674e-02   +4.047130022207988e-01; +5.596319645293253e-01   +4.055154903630397e-01   +1.369430568245009e-01   +6.972803607218424e-01   +5.126426247706648e-01   -1.940662177446761e-02   +1.067593167512741e-01   -2.376074580370571e-01   +2.851799083596177e-01   +2.759938522998887e-01   +3.569334265634037e-01   +2.292237021824105e-01   -6.608084659925438e-01   -3.874185571426116e-01   -3.891753611913089e-01   -2.289651226813163e-01; -6.006358304722810e-01   +2.270559004310214e-01   +7.306604010374577e-01   -1.766308202356330e-01   -6.981791853191550e-01   -2.892553539002943e-01   -7.951753103112711e-01   -3.252853011366675e-01   +4.327551784907400e-01   -3.506456405084801e-02   +2.054763833748375e-01   -4.838892028914545e-01   +3.732302219539303e-01   -4.212971387754347e-01   +1.139057905123316e-01   +5.048635540637481e-01; -6.308976154804171e-01   +9.381201814567741e-02   -2.608456579845119e-01   -4.925519416436470e-01   +1.692543055425908e-01   -3.657498842028075e-01   +3.216006674651140e-01   +2.075940509631556e-01   +1.461803598856481e-01   -5.601700617379527e-01   -2.403704673087118e-01   -4.103914138563912e-01   +1.506522657625367e-01   +8.400371186077635e-01   +5.593576309442911e-01   +1.301055309454066e-01; +3.704330691981605e-01   +6.190230045728171e-01   +3.606771619652158e-01   +5.389370929599455e-02   +6.230321662127450e-01   +5.343173267250649e-02   -3.996455230649537e-01   -6.108002059306834e-01   +5.669035790930399e-01   +2.984955499764544e-01   +6.230113287373943e-01   +5.478301206037801e-01   -1.862296597299541e-01   -1.799923406589962e-01   +2.697536494999698e-01   -1.211791020289664e-02; -8.213970269925872e-01   +1.106667526617205e-01   +5.707989940873831e-01   +4.029296391233852e-01   -6.076467055595324e-01   -2.511643494709323e-01   +3.923337574926371e-01   -3.513508479111335e-01   -3.230190734377681e-01   +2.523217228576930e-01   -1.251103546569764e-01   +2.368812088748770e-01   -1.655480984642045e-01   +4.733397827526430e-01   +2.704740767003876e-01   -4.144753065344640e-01];
L2I_L1I_iGABA_netcon = [-4.143963365095733e-01   +5.477875017713392e-01   +2.939148066712721e-01   -2.865874464700701e-01   +7.724500090295754e-02   -4.490958590784459e-02   +4.484387162570837e-02   +3.415841512262807e-01; -2.592714009941767e-01   -4.676656075936663e-01   +6.327279371668969e-01   +9.549890454786207e-02   -5.279290786404944e-01   +1.128242529693016e-01   +6.717886562553369e-01   -2.366094196924454e-01; -6.603264146814556e-01   -6.543375819127972e-02   -1.798019766739077e-02   +9.227656016432062e-01   +7.639469581050083e-01   +6.306095078260846e-01   -6.267020804646866e-01   +1.851400442136395e-02; +8.658517107530170e-01   -3.280388083447883e-01   -3.556953707827837e-01   +6.560160854092968e-01   -4.920937588526677e-01   +9.602966742511085e-01   +1.793538766566474e-01   -1.206268922572298e-01; -7.225324507234152e-01   +4.583110778094995e-01   -1.322240515464963e-01   -1.242646045334866e-01   -4.274068064599284e-01   +9.733992989452543e-03   -6.192551649972033e-01   +2.159157291055433e-01; +1.037968331223178e-01   +6.725642400803804e-01   -1.000000000000000e+00   +5.620192859660024e-02   +8.236144017110331e-01   -1.672708878999168e-01   +9.352729539465734e-01   +7.876551937681894e-02; +1.178986803232432e-01   -3.239433568961770e-01   -2.014460051791330e-01   -9.183074316210198e-01   +2.690726329337677e-01   -6.332146793024981e-01   -5.956139735636385e-01   -2.569937487455817e-01; -2.087817649671361e-01   -1.449967132897276e-01   +9.435552320262436e-02   -1.357227396508665e-01   -4.577904866816084e-01   +3.528993843192147e-01   -1.601189196659263e-01   +5.106779887966766e-01; -3.514678835496743e-01   -1.327170268424019e-01   -2.322440076376157e-01   +1.197579987611205e-01   +3.746320624806275e-01   -9.921220328432108e-02   +2.763976512994769e-01   -9.256182911212795e-01; -3.827792274910291e-01   +5.451154960295376e-01   +5.124587273466041e-01   -5.625343895825979e-01   -3.755571352189385e-01   -2.345948038215669e-01   +1.754975971417793e-02   -1.310230488693661e-02; +5.416867035300543e-01   +7.377288827503522e-01   +7.865667772416017e-02   +2.071743145899479e-01   -6.876864793658656e-01   +2.481011817133315e-01   -2.528820754494313e-01   -1.944621828300107e-01; +5.219780149443913e-01   -1.634060773036167e-01   -6.676068577495009e-02   +2.328693970251335e-01   +3.429757862660139e-01   +6.427792291093652e-02   -6.749079786673753e-01   -3.776396293876333e-01; -4.541048945604963e-02   -1.702505050774745e-01   -1.902467450310210e-01   +4.658541054747925e-01   -3.557594343544091e-01   +1.960936386078291e-01   +4.452087895080738e-01   +4.746241451513750e-01; +3.780919631647844e-01   -1.330794932126372e-01   -2.958421949467804e-01   +5.659984947283229e-01   -3.521022115938162e-01   -7.973084022642507e-02   +2.655907499112548e-01   -2.151421376288000e-01; -7.182539505198139e-01   -6.506787503375079e-01   +7.745373608684321e-02   -5.888709295503486e-01   +2.245435934333781e-02   +7.348595852870331e-01   +3.536668943825841e-01   -8.590861968923530e-02; +3.331987762113728e-01   +5.709703170289977e-01   +1.899159327238889e-01   +1.466757759988214e-01   +8.716329447287138e-01   +3.678075669540002e-01   +2.946968448086872e-02   +2.937263101994840e-01];
L1I_L2I_iGABA_netcon = [+3.322840296563966e-01   +9.601010888808648e-01   -1.851183143020770e-02   +7.578918311694388e-01   +1.582026992636462e-01   +3.541346013500087e-01   +6.685315298145475e-02   +5.970278839413649e-01   -1.803393758874633e-01   -2.961044606767496e-01   +4.723371798480610e-01   +1.257634145980221e-01   +1.009982725357720e-01   +7.592693087967499e-01   +8.647479381592660e-01   +6.148040487412497e-01; -4.006846779445485e-01   +3.600500295460465e-02   -1.089205916141378e-01   +4.410653781007773e-01   +9.306000650801824e-01   -9.457165121286004e-01   +4.944399130129905e-01   -9.941484498262929e-01   -4.290368782913107e-01   +1.903043464469931e-01   +2.279511824994870e-01   +6.452291579418636e-01   -1.000000000000000e+00   +2.444943028936813e-01   -3.601026018099419e-02   -4.928776493151100e-01; +1.541118207888262e-04   +5.316409529663775e-01   +2.988613244426617e-01   -3.723583105938518e-01   -9.842799995220942e-01   -6.052488895288731e-01   +9.865706852652206e-02   +3.398375133220090e-01   -6.845027133021381e-01   -1.254219569859955e-01   +6.128412940690625e-01   -3.164711698944169e-01   +5.500919545710754e-01   -1.425112066165036e-01   +5.091057714708654e-01   -4.355256194304221e-01; -9.709854115039605e-02   +5.678192265890825e-01   -3.922461011017728e-01   -3.792413806529520e-02   -3.508188399814119e-01   +3.865164989197842e-01   -5.048401765398299e-01   +7.682988519488753e-01   -4.211221470030377e-01   -4.505836742808786e-01   +1.322391186723309e-01   -1.555426712912590e-01   -5.729778774633395e-01   -6.212393772134776e-01   +3.040457095200848e-01   +7.199108397742785e-01; -3.064004456793660e-01   -6.641903158847596e-01   +5.870995780598201e-02   +7.902241000240047e-01   -6.942645073205503e-02   -6.866200138397026e-01   -5.649244215763984e-01   -2.564544132279437e-01   +2.442006752004460e-01   -3.303722508525154e-01   +3.611686655821825e-02   +2.640811506810417e-01   -2.755482740868744e-01   -2.205633246765392e-01   +2.224431930155705e-01   -2.079145904730457e-01; +5.943718765054995e-01   -1.221844771511738e-01   +1.473351129252995e-01   -6.187619061848676e-01   -5.862377056964154e-01   -4.295995856305968e-01   +4.086858786058032e-01   -4.234620163345028e-01   +4.260760570128533e-01   -7.094774881340941e-02   -3.848775166917200e-01   -3.353814291523726e-01   -4.207882874102634e-01   -5.174234400204685e-01   -1.765176421906691e-01   -5.592151095118628e-01; +2.774297086723576e-01   +3.340137503035578e-01   -6.595835216693043e-01   +7.410075671182309e-01   +4.740340719206670e-01   +2.175692241792355e-01   +5.709093365653207e-01   -2.753529210776655e-01   -6.136613724285614e-01   +7.939635746502675e-01   -3.133072469865253e-02   -1.343202466513466e-03   -4.778989071817437e-01   +2.576727022832142e-01   -6.439804442290348e-01   +6.967005594514017e-01; +3.444806256334770e-01   +2.900929650988610e-01   +7.438919874179911e-01   -5.261525629940538e-01   -7.824875855675139e-01   -8.210745920331696e-01   -1.652600800832501e-01   -5.915390148696525e-01   +6.467494869564727e-02   -8.375433625119059e-01   +7.249723032487615e-01   +1.073153495303497e-01   -4.942445992251209e-01   -2.310780476334477e-01   -4.503368618495343e-01   -1.609383638229110e-01];
L2E_L1E_iAMPA_netcon = [+6.796684033116983e-02   +4.868840891350229e-01   +6.803144794138895e-01   -2.296339055151304e-01   -4.021233441459541e-01   -5.131403275360542e-01   -5.246967833404458e-01   +1.841078356199770e-01; -9.006147069919024e-02   -4.256790487070344e-01   +5.166225446349848e-01   -5.263477321088598e-01   -3.722314768725852e-01   -9.668227707359005e-02   -5.555702395878609e-01   +5.615536819992577e-01; -6.240148337733687e-01   +5.301734789828961e-01   -4.443879080047354e-01   +3.754381274857485e-01   -3.387435978862612e-01   -7.899316257931335e-01   +2.270520601633966e-02   -4.474311765019180e-02; -1.749250556180387e-01   +7.389356005577871e-01   -2.929193814902408e-01   -3.766982720968913e-02   -3.330334998088605e-01   +2.030778318708624e-01   -3.192609139990930e-02   -4.987136090905677e-01; +1.482841568121651e-01   +1.256866007601076e-01   -1.437551409309635e-02   +3.086956823813547e-02   +8.550864653165632e-01   +7.217290552389174e-01   -1.487566624753585e-01   +4.600534169431916e-01; -5.291342127167261e-01   -1.847595506579733e-01   +5.718016371298771e-02   +2.718906928296955e-01   -6.128212275264256e-01   +3.455387666646393e-01   +3.411247251599751e-01   +1.527252070024870e-01; +4.544488773135675e-01   -2.016453171942563e-01   +3.664505219697432e-01   -3.391951018596592e-02   -1.531395385654739e-01   +8.557460094642599e-01   +4.299754935299678e-01   +2.083257983582167e-01; +5.774779313463484e-01   -3.409685650761168e-01   -3.812562255740690e-01   -2.080607836705897e-01   -2.659466940125910e-01   +3.347223786837233e-01   -2.783573428951251e-01   -2.851280620305303e-01; -3.127558483854650e-01   +2.737000106353321e-02   +3.346921953098417e-01   +2.098182579176955e-01   +4.839839170361834e-01   +7.888077417323794e-01   -5.576388565204455e-03   +2.490518696420767e-01; -1.327458697028524e-02   +3.812604861231781e-01   -1.000000000000000e+00   +1.063471842311049e-01   +4.103539517641819e-01   -1.792014753177101e-01   -3.227532503722629e-01   +1.598209922136773e-01; +3.377493080928832e-01   +8.488965609581494e-01   -1.148034423313058e-01   -6.093495130681578e-01   +2.939005181819510e-01   -2.661216430849136e-01   -2.868713529837374e-02   -5.995623618591248e-01; +2.773765236311353e-01   -7.210661283743741e-02   -2.594075478837857e-01   -4.412029453993156e-01   -3.897457437639117e-01   -8.343260173294768e-01   +1.993894809452509e-01   +2.209643893075341e-01; -9.720928033397805e-01   -3.114647637095782e-01   +7.350949695526063e-01   +6.158292604631171e-01   +7.318317573078956e-02   -3.321238823781026e-01   +5.786372858190139e-01   -1.368018971420528e-01; +3.387686976682089e-03   +9.613594683620962e-01   -3.554443097305278e-01   -5.119324659840412e-01   -9.808319965344306e-02   +5.446950954241740e-01   +5.126135443973361e-01   -3.431756785517221e-01; -3.268822908806968e-01   +2.218694611936422e-01   +4.136756565824174e-01   -5.743366822131334e-01   +2.747984772132191e-01   -3.387380808232198e-01   +3.265721110479691e-02   +7.378339351120000e-02; +5.692002833224413e-01   +6.377616444671306e-01   +1.834502003541974e-01   +5.142312759575620e-01   -6.916171971107129e-01   -1.506879318905486e-01   +2.361139492429220e-01   +3.704904394708745e-01];
L1E_L2E_iAMPA_netcon = [+4.508582386962526e-01   -3.482410226346253e-01   -3.387688744933356e-01   -5.610792724059135e-01   -5.736699696285059e-01   -5.772567838418767e-01   +2.315118653733487e-01   -2.270548369488085e-01   -5.863248017205183e-01   +2.632493933827514e-01   -5.738710284302038e-01   +1.217953647613166e-01   +6.933479929467665e-02   +3.860344536794482e-01   -7.397756217485904e-01   +5.128605233834105e-02; +3.072098326162983e-01   -4.455315495972047e-01   +2.666808944114761e-01   +5.897883613282062e-01   -3.622064508227145e-01   -1.043351987796500e-01   +2.727255033480994e-01   +4.902324287508389e-01   -3.818479315800223e-01   -1.869583870166256e-01   +8.089690719413460e-01   +4.935254341495501e-01   -5.689214034000926e-01   -4.392429675724791e-01   +5.086198325668745e-01   -3.683277758777611e-01; +6.160994527075261e-01   -5.208996212492982e-01   +6.458124907837918e-01   +7.106718704829802e-01   +6.874587242171075e-01   +3.756245855274868e-01   +3.216806154542136e-01   -8.274270931627635e-02   +8.405412061278957e-03   -3.117579270912723e-01   +3.391720857432728e-02   -4.532560210297493e-01   +7.036178320602648e-01   +1.838158489773957e-01   +5.878532276636857e-02   +4.446386341485780e-01; +1.236794624538281e-01   -3.604457928429803e-01   -1.777115503667320e-01   +4.124173664997452e-01   -5.717238225774081e-01   -6.780477591291749e-01   +1.075827084483363e-01   +2.239001144878713e-01   -6.690163719437804e-01   -1.220082217200838e-01   -3.609061041659208e-01   -4.331157120207857e-01   +9.138663089288815e-01   -2.468686602864376e-01   +4.878754029478120e-02   -2.527070733160234e-01; -3.546075969205486e-01   -3.552962458860338e-01   +4.713741836874080e-02   -1.106341312771215e-01   +2.103133422734190e-01   +8.718805478871859e-02   -2.875013971220724e-01   +3.249064188226400e-01   +4.820155294899452e-01   +7.141254425501530e-01   -2.974555725357446e-02   -1.109758878868186e-01   -3.466673149791255e-01   -1.371987067511997e-02   -1.942109100819050e-01   +7.480367556710785e-01; +2.710971014631716e-01   -5.612896501675581e-02   -2.611923700072060e-01   -3.996357613644886e-02   -3.990847719555004e-01   +1.000000000000000e+00   +1.188579767307751e-01   +4.659498762472556e-01   -5.439053374119994e-01   +4.595224838307841e-01   -8.017452899019309e-01   -1.736441112185836e-01   +7.637774960727199e-01   -4.204474783225804e-01   -4.073168416659811e-02   +4.302718047800852e-01; -2.338948220502655e-01   -3.596339939525546e-01   -6.821597125017546e-01   -2.302004409277920e-02   -2.650451327539871e-01   -6.715395530901934e-01   +2.199337037011005e-01   +2.334725812885989e-01   -4.897452388516318e-01   +7.184900065308782e-01   +5.192111672761294e-01   -5.963768658632969e-01   -5.916828146373528e-01   -5.941124373523474e-01   -4.660192054031441e-01   +6.607105092374352e-01; -1.480103332928596e-01   +2.247613109470037e-01   +3.860330547391485e-02   +6.013487801800288e-01   +4.743299147038829e-01   -1.346205978762705e-01   +4.916365933616644e-02   +1.906117745519620e-01   -4.941715777549505e-01   -1.662378249308108e-01   -6.933787355292022e-01   -5.495259552239399e-01   +3.529659770364685e-02   -1.284301769449682e-02   -5.639794448635842e-01   +4.058637225285130e-02];
L2I_L2E_iAMPA_netcon = [-1.897697336672066e-01   -2.712561769118580e-01   +5.339841446713827e-01   +4.037734962643165e-01   +3.050292326879420e-02   -3.974126094365639e-01   -6.623596512230948e-01   +1.138046260324558e-02; -1.990158092038690e-02   +4.342103099135219e-01   -2.876019172884206e-01   -3.688910677251672e-01   -1.808573221314804e-01   -4.172209706606868e-01   +3.155957343021779e-01   +1.977384758762041e-01; -4.090402421009772e-01   +2.799360865888243e-01   -3.028372808732714e-01   +6.402037930116852e-02   +9.483099237882647e-01   -4.787401376604895e-01   +3.500385403451862e-01   +3.588230719488986e-01; -2.248385775350732e-01   +4.512660047747249e-01   +1.758281730432758e-01   -3.176206178583132e-01   +4.372530150653726e-01   +6.636116612679725e-02   -3.030744214315456e-01   +3.696996122073023e-01; +5.037189872150217e-02   +1.754353472036347e-01   -3.577684025315063e-01   +5.690266061704676e-01   -1.000000000000000e+00   +2.149732791122546e-01   +3.894914302845082e-01   -2.628041086320569e-01; +6.991040864394188e-01   +6.043968614610328e-02   -8.151130090332722e-01   +2.817738287898150e-01   +3.101009669822883e-02   +2.136718875540580e-02   -4.460137853086815e-01   -4.055194009456235e-01; +2.283538162725532e-01   +2.629597995250469e-01   -2.050524195584186e-01   +6.844348999272849e-01   -8.929101169625658e-02   -4.245569827390820e-01   -6.969442049092214e-01   -4.165448177229858e-01; -3.665979355175430e-01   -1.561176370943631e-01   -2.604043005907362e-01   +3.343623570885361e-01   -3.655109317843095e-01   -6.505731597360867e-02   +2.749719500509438e-01   -1.838224185963817e-01];
L2E_L2I_iGABA_netcon = [-4.037247992566418e-01   +1.559498770852727e-01   +4.641424259967510e-01   -5.469036091854542e-01   -5.851786961546472e-01   +1.166588999838836e-01   -1.404803939393908e-02   +5.029571173173228e-01; -2.165308377090819e-01   +7.795516776089915e-01   +6.852098937209053e-01   +5.449845007393689e-01   +4.841839471988867e-01   +1.365473204883945e-01   -5.543693367783463e-01   +5.419042010226948e-01; -6.571107641031737e-02   +2.269682825536176e-01   -2.219587761830109e-01   -5.930312385572105e-01   +4.476619047817704e-01   +4.418550923774589e-01   -3.585638205940050e-01   -3.080492983229989e-01; -1.000000000000000e+00   -1.433328381227037e-01   -4.125040143715590e-01   +5.887863922395815e-01   +1.254639446850891e-01   +6.431443573160618e-01   -3.753009394043510e-01   +2.007712445722083e-01; +2.080034211801262e-01   +2.627145214304505e-01   -9.322259423547601e-02   +7.856523178316516e-01   -4.966837320913633e-01   +5.983725025121689e-01   -3.664317300545440e-02   -4.109580626989585e-01; -4.375227420201241e-01   -4.547446965230387e-01   +4.316140217779645e-01   -5.395733299732711e-01   -4.858362610564586e-01   -4.646682006483565e-02   +7.886605861725768e-01   -6.764753555389446e-01; +1.801514180298644e-02   +3.294940155121013e-03   -7.512979936767140e-01   +2.442333001022176e-01   -1.164511714578583e-03   -1.531456505535130e-01   +2.602703183492480e-01   +5.481714781752843e-01; -1.725090442892557e-01   -4.628294650043080e-01   -5.705417324006874e-01   -3.326699315299888e-01   +4.738560941689753e-01   -5.283526095018252e-01   +3.569056728817374e-01   -8.938667518002447e-02];
L3E_L2E_iAMPA_netcon = [+8.008775962707028e-02   +5.162548009151324e-01   +2.268003119562552e-01   -1.938748062866580e-01   -3.270324990492732e-01   -5.288809644988416e-02   -2.735404769011928e-01   -9.121677170620812e-02   -2.531715713061505e-01   +5.448487564476253e-01   -4.540470218317029e-01   -7.648918181638426e-01; +1.231987173080959e-03   +7.535112970993861e-01   -4.856590158332903e-01   +3.049924077371173e-01   +4.142981720629635e-01   +1.255222370749721e-01   +6.079439218884546e-01   +3.522124504789748e-02   +5.579221750360481e-01   +6.464817408208448e-02   +1.769893665679282e-01   +3.846197001312805e-01; -6.346181640809575e-01   -1.607811116520143e-02   -6.952239891598829e-01   +2.412678895697109e-01   -4.970834026687259e-02   +8.177968220428132e-01   +6.034885870796909e-01   -3.784768652292048e-01   +3.487736819003325e-01   +2.516230352443118e-01   +7.416770599896673e-02   -9.067427487702576e-01; +2.941918270934469e-01   -5.812126138915253e-01   +4.128475208745012e-01   -5.590964698570784e-02   -3.911570595468259e-01   -3.660149771567217e-01   +7.670185772882608e-01   +1.574545330359550e-01   +4.676828241038631e-01   -5.408050670869944e-01   +5.667361705301890e-01   +1.495753869945764e-01; +7.333290243471204e-01   +6.213943594454154e-01   +6.825371355308417e-01   -1.261594846837527e-01   +1.000000000000000e+00   -5.078754635544367e-01   -6.215706000303857e-01   +1.126095411000401e-01   -2.125337532961194e-01   -5.499950294185890e-02   +7.248804497905642e-02   -1.393117118493868e-01; +4.204227758818531e-03   -2.879916157495941e-01   -6.049853058767365e-01   +1.673406031775843e-01   +4.136541233376341e-01   -5.368034546217584e-02   -6.200427757552254e-02   +3.360391328279472e-01   -6.818903381405113e-02   -4.236933755031316e-02   +7.483368557140955e-01   -7.132949254895087e-01; -5.181259000463202e-01   +3.589470443554782e-01   -3.291100799265116e-01   -8.353720721124438e-01   -2.119234954243522e-01   +6.277547024001902e-01   -1.134876350062649e-02   +4.876829075712258e-01   -6.946131132431935e-01   -4.397178690574673e-01   -7.024383773020382e-01   +1.694320185552085e-01; -5.090172052360736e-01   +6.852495437723940e-01   -1.750055373596883e-01   -3.520744961171654e-01   -1.155460725404068e-01   -2.524300834469845e-01   -1.690679516253430e-01   -7.204388571643534e-01   -3.528709458978396e-01   +6.549948146134982e-01   -5.903281545103690e-01   -8.805076989871230e-01];
L3I_L2I_iGABA_netcon = [-2.784618461453581e-01   -5.712964988821267e-01   -1.906817001173073e-01   -3.864632438682719e-01   -2.595601165839217e-01   +3.827312212429070e-01   +3.471065294735582e-01   +8.857193173238460e-01   -5.227775271296968e-02   -3.444134194435055e-01   +4.662772413785079e-01   -4.834153962567781e-02; +5.147533401388273e-01   +8.569172006723791e-01   +7.493314181390095e-01   +1.000000000000000e+00   -9.352037633195058e-01   +3.926727569869997e-01   +3.020836435409681e-01   -1.707020406095039e-01   -4.228469922106747e-01   -2.900838969995959e-01   -7.980702922558538e-01   +5.579662525324690e-01; -1.949731165321076e-01   -8.383249788739985e-01   +6.290673310897509e-02   +2.753226673676805e-03   -8.764038775789601e-01   -2.866165162611067e-01   -3.008049776601737e-01   +9.445899453658799e-02   -2.503454354868654e-01   +6.528386672306403e-01   -4.128153045882283e-01   +3.010416649996453e-01; +4.200449593916243e-01   +5.106272088136308e-01   -7.426649949432174e-01   +5.147912809239120e-01   +5.187782561141738e-01   -9.121206992825603e-01   -2.468174886454374e-01   +2.728499924464777e-01   +5.984163658386870e-01   -3.695154721378412e-01   +8.541991630901953e-01   -6.408910499549518e-01; -3.725806158329667e-01   +5.051163910747966e-01   +2.010233450965251e-01   +1.611464590246991e-01   -1.828893415144834e-01   +7.680867275538874e-01   +5.512250692215126e-01   -2.582073139836602e-01   +3.652055574704191e-01   +8.914378907703633e-01   -2.604824381764864e-01   +2.464715503479321e-01; +3.604588279553690e-01   -1.284629451576823e-01   -5.785264294313391e-01   +7.130145732425454e-01   -4.442079881062078e-01   -4.872131645497738e-02   -2.048875010653938e-01   +1.192294508754911e-01   +3.836789909446612e-01   +8.134570874335276e-01   +4.478222771993403e-01   -6.252357878074096e-01; +7.623255894505123e-01   +2.149282797096835e-01   +3.181687196846744e-01   -2.326441898843701e-01   +3.151108532741041e-01   -3.051724972136795e-01   -2.023431142529873e-01   -5.385425766897383e-01   -7.365744941717356e-01   +8.292046740909795e-01   -2.348549614650934e-01   +6.638486698807057e-02; +4.346975718035455e-01   -3.164031629960170e-01   +3.240797619019760e-01   +1.582279195598492e-01   -4.727797560344377e-01   -1.463421249696172e-01   +2.225364286099197e-01   -9.407104884257856e-01   -5.705270281105305e-01   -3.930771806461623e-02   -9.212890765274691e-01   +3.858958450035486e-01];
L2E_L3E_iAMPA_netcon = [-7.866435543293998e-01   -1.525176391731074e-01   -4.723254206242666e-01   -5.462003217688427e-02   +4.208788052444281e-01   -3.691721988130885e-01   +2.842623028355952e-01   +1.430686106738824e-01; +3.410749711770373e-01   +5.219446307872322e-01   +6.268644068510564e-01   -5.389517846567337e-01   +1.402270342013368e-01   -5.999245949046750e-01   -6.721786651377551e-01   -6.014667849684934e-01; +3.049854383055849e-01   -5.003504724686443e-01   +7.411069305542025e-01   -6.878549565992949e-01   -6.020588364055305e-01   -4.031604894973786e-01   +4.626192609557520e-01   +4.954217689025441e-01; +1.044860665906525e-02   +1.486915540772944e-01   +1.124232353947912e-01   +3.717761604404453e-01   -7.483190174945429e-01   -1.129445916434746e-01   +9.772268449306879e-01   +4.628278415464798e-01; -7.341340836755575e-01   -3.669393425427777e-01   +6.887403845203434e-01   -3.914489634436631e-01   +2.438956227266623e-01   -2.791772229275408e-01   +3.352203315285567e-02   -6.096269081308248e-01; +2.748484131915882e-01   +1.283518694430922e-01   -3.860010086083060e-01   +6.866981198905524e-02   -3.487696491506157e-01   +9.099818778360828e-02   +6.658996469887974e-01   +3.196659527645102e-01; -1.608129582280909e-01   +1.351658073122815e-01   -3.197774450601747e-01   -4.842073443214551e-01   +6.657449308498934e-01   +1.116451309283008e-01   -4.624505841752944e-02   -7.132860438269030e-01; +4.898675377918779e-01   +5.672374552790739e-01   -4.054148612394893e-01   -4.367393866144115e-01   -2.287315777197380e-01   +9.829400562677857e-01   -3.462762284672550e-01   +4.953160394601031e-01; -3.413884332256638e-01   -3.429337543439868e-01   -1.167822493254569e-01   +2.122411555575343e-01   +7.602122430530223e-02   +1.777595686043950e-01   +2.988639602792107e-01   +1.428614981531136e-01; +3.012819544006599e-01   -8.260972384678722e-01   -2.102581603029470e-01   +6.348266672577096e-01   -4.779975114458656e-03   -6.448041209971053e-01   +1.249407085948172e-01   -2.531364704721999e-01; +1.542443864217068e-01   +4.715112743951238e-03   -7.207142183750179e-02   -1.812580812132069e-01   +8.074424874501603e-01   -9.367306555657499e-02   +1.103731026848196e-01   +1.722735934256026e-01; -4.806210826049498e-01   +1.298035587542928e-01   -1.000000000000000e+00   -2.356668434240549e-01   +2.153087509362897e-01   -4.322725598670111e-01   +1.632048633314622e-01   +2.045040615279243e-01];
L2I_L3I_iGABA_netcon = [-7.831296493408363e-01   -7.106281625044806e-01   +6.241414679648239e-01   +6.055728299419254e-01   -5.774490759252059e-01   -3.502192977820165e-01   +5.327639859555630e-01   +1.000000000000000e+00; +5.440797158496655e-01   -2.929853376889854e-01   +9.528720384652883e-02   -3.438467532015838e-01   +4.138829635841170e-01   +2.657725688932089e-01   +4.720226783494807e-02   +4.653721630182017e-02; -2.199983926290767e-01   -3.651749272085792e-01   -5.888415566553620e-01   -5.911600873616855e-02   -3.748720108117233e-01   +2.647860168403649e-01   +4.290399251683293e-01   +6.539416736886947e-02; +2.279222471619860e-01   -1.415713538302065e-01   -2.593752045619489e-01   +3.693555015998581e-01   -6.093836044659302e-01   -5.235501013903953e-01   +3.583320349181483e-01   -5.994324858755065e-01; -6.693702344741649e-01   -1.613834455355966e-01   +7.436187061171465e-02   -3.709732766727469e-01   -4.694159523027315e-01   +3.059784493577908e-01   +3.422131151782396e-01   -6.505246476499084e-01; -2.148402717284537e-01   -7.968975465165101e-02   -5.353995633794761e-01   -5.922599051435253e-01   -5.941762747908031e-01   +8.226357102725793e-01   -2.579897280851105e-01   -2.618712034908486e-02; +3.409007482089162e-01   +3.017887355545121e-01   -3.088010283639768e-01   -4.171192399995484e-01   -1.314816255793075e-02   +6.933500149033107e-01   +2.143848708271635e-01   +4.718836536284632e-01; +8.446276987943891e-03   -5.812640536696539e-01   +5.601696022965731e-01   +5.024637255434032e-01   -4.867616049429410e-01   -5.707837488464024e-02   -4.902004107693170e-01   +6.169829098029798e-01; +4.660171244035183e-01   +3.837022968852594e-02   -4.003507922571617e-01   -8.204111891342317e-02   -4.311195661940500e-01   +2.320396794571807e-02   +3.551921935049202e-01   +3.894750264184469e-01; +6.820228455499656e-01   -3.208296342420222e-01   +5.858108386897158e-01   -2.787040129453261e-02   -5.570811741324897e-01   +6.967557177689753e-01   +7.305879821304399e-01   +6.734232305567337e-01; +1.713999084659536e-01   -2.087347674788093e-01   +3.906223676699888e-01   +7.962583999215388e-01   +3.241674248614138e-01   -4.120314109386758e-01   -3.086074875344251e-01   +3.223455906754088e-01; -1.691198252825919e-01   -1.788809406882386e-02   -3.515029343305781e-01   +3.182122695149112e-01   +1.282968473765457e-01   +1.993080778294260e-02   -3.117782634201161e-01   +2.326109354920256e-01];
L3I_L3E_iAMPA_netcon = [+5.300889050253113e-03   +2.872845349141826e-01   -4.021671261527065e-01   -4.964721918778456e-01   +3.975065329480144e-01   -2.206808106545871e-01   +4.365745044057656e-01   +1.557355711628546e-01   +4.929585473748855e-01   -3.922494023605191e-01   -1.930675817632519e-01   +1.745704759475058e-01; -7.457037856306212e-02   +4.113898252487647e-01   -1.757989673744976e-01   +9.484498487029450e-01   -5.022829523716923e-01   -4.536745955245372e-01   -6.237346662881379e-01   -4.641434062428613e-01   +3.872187144061595e-01   +5.645471064583335e-01   -3.003723983539696e-01   +1.654357794783939e-01; +6.681368744894983e-01   -8.277714728261443e-01   -2.636343048736805e-01   -5.332634295866497e-01   -3.128672472071526e-01   -3.964991995908477e-01   +6.255057023390428e-01   -2.408618881443753e-01   +5.193800397246081e-01   -1.313415234864148e-01   -2.556983567433032e-01   -4.655509208446759e-01; -6.981470318634058e-01   +5.806507875399484e-01   +7.209100534585341e-01   +2.473435533838719e-01   +1.260939235844472e-01   -4.858496524099874e-01   +6.859657602330486e-01   +4.131066645938585e-01   -7.734634391559027e-01   -3.129306798568275e-01   -8.848208045505596e-01   +6.512886139468010e-01; +3.414264571070342e-01   +4.478405564080075e-02   +5.152785345651567e-01   +2.820423078375026e-01   -2.725866466450341e-01   -1.000000000000000e+00   +1.592521184903760e-01   -1.239110999122910e-01   -4.382097281868921e-01   +4.083926881735211e-01   -5.345902508874989e-01   -4.818100796721718e-01; -5.927140887476038e-01   +3.241316872775278e-01   -3.196011596913048e-01   -5.063250897429416e-02   -8.983210018160520e-02   -5.059797383162019e-02   -1.921364300921700e-01   -6.019042988797624e-01   -6.418165701208702e-02   +3.134722307103257e-01   -1.929480878278327e-02   -9.063746172868588e-01; -3.357483688142820e-01   -3.094962713061609e-01   -4.304117496572010e-01   -4.155334422822236e-01   -4.643920730256859e-01   -5.128543625504276e-01   +1.819183442539312e-01   -5.591008457286238e-01   +3.959099034107432e-01   +1.931471748114235e-01   +1.344041524121202e-01   -7.135568945639794e-01; -4.770725048875964e-01   -1.038643155195013e-01   +1.507769625295394e-01   -2.912302207892566e-01   +6.715458049508970e-02   +1.415757503121170e-01   -6.291156338997361e-01   +5.121413997924730e-01   +5.092218542401028e-01   +1.090804014322595e-03   -2.367822738701375e-01   -4.503171837256716e-01; +4.778792714634170e-01   +4.127467098461020e-01   +3.424900821334410e-01   +1.427151500492063e-01   -1.832887783368722e-01   +3.305359144302075e-01   -3.701830881238242e-01   -5.885612093730925e-01   -3.237715346572116e-01   -4.085809407454563e-01   +6.659041288346519e-02   +6.632410184567984e-01; -6.219426807612739e-01   -3.854974122166466e-02   +1.435331737854708e-01   -4.457319767284569e-01   -5.947127078325634e-01   -1.985448061204398e-01   +2.899586579966075e-01   +4.037486748450094e-01   +9.248810888314436e-02   -4.597046404956398e-01   -5.595159803545258e-01   -2.984545690134150e-02; +6.777033647663885e-02   +3.039947267671012e-01   -6.922258560019408e-01   -4.155212103290202e-01   +8.170312202066313e-01   +7.350089724379560e-01   +1.324075873622906e-01   -1.682942021968050e-01   +7.423335627402295e-01   -8.187380217608428e-01   -5.175461445874111e-01   -3.190611899696976e-01; +2.503010867232710e-02   -1.281808144973900e-01   +4.989469223342616e-01   +3.178365071364790e-01   -7.332545623647599e-02   -6.423137867153797e-02   +4.220211285685944e-01   -2.287600668767027e-01   -8.433194746581388e-01   +5.130572388693140e-01   -5.227458057473608e-01   -7.319874412356921e-01];
L3E_L3I_iGABA_netcon = [+4.703205680122191e-01   -4.061740131261872e-01   +2.359061384227990e-01   +5.209331052031622e-01   -1.784454027040621e-01   +1.347913258422267e-01   -1.293686209596759e-01   -4.155423671754720e-01   +7.660714790482471e-01   -1.682393508975129e-01   -3.844515196771204e-01   -1.409701774823277e-01; -1.827804917103794e-01   +5.740980775619974e-01   -6.479617556141344e-01   -5.501158638227834e-01   -2.843113453268077e-01   -3.578115465779873e-01   -4.716783312930721e-01   -1.591327641620284e-01   -6.577369510231514e-01   +4.196563042595820e-01   +1.402262342244688e-01   -5.544093430722015e-01; -4.055824155804327e-01   -2.871565302734914e-01   -6.665302196856170e-01   +3.237298381226420e-02   -3.507791876030753e-01   +8.423605782060948e-01   +8.639843290703882e-01   -1.653935731312630e-01   -5.770343175305022e-02   +8.529502187714190e-02   +1.140182342233009e-02   +1.193663586888557e-01; +6.568247542696753e-01   +4.693992255535462e-01   -5.474885408423462e-01   +4.523069850963500e-01   +6.473473187920818e-01   +1.269679890598786e-01   +2.501221895715204e-01   -3.525447857866240e-01   -2.188368337833784e-01   -8.362803265456580e-01   -1.458929943568847e-02   -1.827301180874333e-01; -1.720689832694536e-01   +1.421125422056452e-02   +2.036789488381928e-01   +4.066314564581807e-01   -1.805429943986065e-01   +1.668807116921169e-01   +7.741618026881101e-01   -3.737814725363682e-01   +2.382131285841665e-01   +4.953934300849158e-02   -2.207176397262699e-01   -4.876702277407942e-02; -1.971827151243528e-01   -5.018882073572417e-01   +3.033908050080326e-01   +4.414551667707553e-01   -2.254243350838238e-01   +4.329167041954109e-01   +4.555732658871574e-01   -4.858116753756564e-01   +6.402686532069424e-01   -2.207648388853580e-01   -3.714201935786012e-01   -4.031095773236124e-01; -4.135371889003790e-01   -1.561490249639334e-01   +2.045292405163067e-01   +5.679785369874157e-01   -3.113628169901582e-01   -3.263170901937316e-01   -3.946136676240324e-01   -4.017053730500534e-02   -4.227980831068210e-01   +4.488608753462622e-01   +4.595409442832020e-01   +1.951093850931940e-01; -7.920986420957683e-02   -6.348847580658949e-01   +3.703772848739203e-02   -6.278810154944278e-01   +4.070156556281732e-02   -8.279524462519337e-02   +2.440210329710225e-01   +9.000629620300151e-01   +6.829161144849961e-01   +3.615727991584974e-01   -2.900599374445751e-01   -2.490247538814263e-01; -8.329257449041945e-01   +2.468650377973301e-01   +2.081313065050377e-02   -5.782640331936425e-01   -7.759143991480029e-01   +9.159342432037484e-01   +2.369685573815703e-01   +9.923393909629926e-01   -3.604802080979458e-01   +6.665020763807900e-02   +2.069791397970205e-01   +5.031801927492895e-02; -6.236495823603719e-01   +2.335438000239958e-01   +2.300579280440999e-01   +4.310239114203071e-01   +5.170713633708436e-01   -2.565773073631191e-01   -4.791657386448208e-01   -3.728817486216960e-01   -3.397081320272437e-01   -3.688573893705858e-01   -9.380439101760588e-01   -8.597815621620131e-01; -5.495847297875064e-01   +1.230523324287606e-01   +7.361792976368871e-01   +6.464728318118980e-01   -8.964694709660512e-01   +3.963524436465392e-01   +7.375028023692004e-01   -4.405902174903352e-01   -1.027232338459714e-01   +4.833024589595259e-01   -3.331233681357255e-01   -2.530314688641626e-01; -7.266937898518946e-01   -4.005411499850493e-01   +5.061186046913877e-01   -4.117627650988530e-02   -3.765225644319937e-01   +3.897037316589945e-01   +7.907854436042185e-01   -1.000000000000000e+00   +6.864056762607766e-01   -8.549382528053459e-02   +8.750891054088267e-02   +6.891042285275711e-01];
L2E_Input1_iAMPA_netcon = [-7.452494554900493e-01   -1.044187343256699e-01   -7.191122374959298e-02   -2.697870062239128e-01   -4.317927397726416e-01   +4.023882284247498e-01   +5.623917873835900e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [-4.545395431124988e-02   +7.032233743994504e-01   -3.119296701605038e-01   +6.132503783735705e-01   -9.346333528934576e-01   -2.671187703562816e-02   -8.115831278301998e-02   +1.115773156209231e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
