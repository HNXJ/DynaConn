function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-8.477760618371034e-02   +2.637356488727633e-01   +4.782526679662512e-01   -3.317486035497339e-01   -1.765377861340436e-02   +5.057189467298089e-01   +5.240838580702134e-02   -9.108686381645284e-02   +4.168259689770401e-01   +2.724721875700359e-01   +1.243310516134786e-01   -1.713798001753978e-01   -2.918019442463223e-01   -8.876041942682313e-01   -2.164605488087776e-01   +7.374100231491397e-02; +1.380754134092975e-01   -2.242299236531028e-01   +9.831588436769334e-02   -1.330385814228310e-01   -1.706566953645317e-01   +1.638852960760925e-01   +6.989869209539536e-01   -2.247440432649166e-01   +4.236377640158805e-01   +6.256420421789144e-01   +4.134228471419447e-01   -2.030474378465714e-01   -1.180103993076132e-01   -3.557256342170009e-01   +1.494978021999467e-01   +1.385774627620195e-01; -2.727104229185219e-01   -1.979645321256820e-01   -2.659086145272374e-01   +2.412878054757844e-01   +1.723959321320176e-01   +1.257112112647440e-01   -2.089351290028394e-01   -2.287752046504347e-01   +4.259278035725609e-01   +6.418403541404971e-02   +4.137932052014773e-02   -3.087294020293669e-01   +4.151194207940924e-01   -3.455019481073998e-01   -4.132295423154153e-01   -1.354938414751469e-01; +1.751436102874986e-01   -3.101963686497906e-01   +2.602934447061944e-01   -4.459898601953527e-01   -4.428110825739592e-02   -2.317447621904591e-01   +6.625887994108797e-01   -5.431493149380437e-01   -5.454247619535024e-01   -6.667277080417775e-01   +3.392918103377870e-01   -2.177805678296370e-01   -4.051785048670548e-01   +5.391182376458715e-01   -2.622816296858814e-01   +5.958563320713406e-01; +3.716224187452541e-01   +3.807537414335847e-02   -1.644306030506424e-01   -2.099132287437684e-02   +1.284006122006250e-01   -7.026114392689687e-01   +6.498846263217930e-01   -2.907099811001457e-02   +3.843333196244892e-01   +2.348615275382830e-01   +4.956103517888702e-01   -4.143358512172875e-02   +3.007102672574871e-01   -1.361227324598647e-01   +4.687059500081001e-01   +4.074791369811085e-01; -2.259658513158054e-01   -5.613321580989918e-01   +1.739288091150462e-01   +3.048065592260237e-01   -4.328493438445694e-01   -1.540425029585483e-02   +1.214518796863849e-02   +1.953151146473165e-01   +4.418743750068415e-01   +3.500062335324481e-02   -1.947371274780391e-01   +6.659791623598417e-02   -5.983115834988796e-01   -3.690575380830670e-01   -1.648182189543022e-01   +1.385970283101066e-01; +8.877871729374182e-02   +1.643547164638883e-01   +2.751805121778150e-01   +5.385967353288801e-02   -1.963943266223414e-01   -2.630297160298661e-01   +1.760712085684266e-01   -1.398634219334539e-01   -4.702633761343297e-02   -2.528099517672280e-01   +2.526807275954042e-01   -3.707236619513658e-01   -5.547383195733903e-01   -2.122361064672094e-01   -1.341877173961923e-02   -3.927578185021607e-02; -2.704903253415314e-01   +3.875697379095892e-01   +1.720408971962585e-01   +2.341677826741612e-01   -1.558387361477874e-02   +1.655207995476541e-01   +5.610340802789886e-02   -1.796350546353981e-01   -1.921065801506108e-01   +6.307507229258679e-01   -3.915322029962748e-01   -5.482942431042578e-02   -2.394060037357707e-01   -2.084547701553478e-01   +4.944907574948260e-01   -2.563462901378050e-01; -1.367970184079925e-01   +6.825122055708933e-01   -4.785401886122359e-02   -5.032073388440237e-01   +3.601173965453250e-01   +2.012998002216543e-01   +5.338801190299101e-01   -8.191018106485394e-02   +1.275776997482793e-01   +3.811716113428012e-01   -4.413587611415623e-03   +3.774381006266199e-02   +3.935550646221020e-02   +1.730387491206715e-01   +3.576157488736478e-02   +1.400415469840947e-01; -8.421204184774084e-02   -5.083422149986098e-01   -1.934866509841870e-01   +3.875319263210382e-01   -2.438178733531950e-01   +3.482492176494099e-01   -1.352784440120685e-01   +2.449523131081880e-01   -3.121390951537849e-02   -5.972824800828196e-01   +3.178272774347947e-01   -2.870721046267558e-01   +5.283682873507437e-01   -7.728117339247704e-01   -5.671748311309752e-02   -1.441139339061137e-01; +1.838517845335048e-01   -1.830027155231163e-01   +4.667040685800957e-01   -1.162817788373032e-01   +2.346179259675933e-01   -1.937054324058747e-01   -1.389709660037345e-01   -3.836868320636811e-01   +2.956720329765698e-01   +4.149239445552558e-01   -2.800155408309076e-01   -1.323644268886035e-01   -3.654382388064134e-01   +3.795479317487090e-01   +3.423240680705979e-02   -5.343107967246885e-01; -3.617908736839263e-01   +3.988354012544881e-01   -5.130635703358441e-02   -1.636992270862458e-01   +1.810171708014580e-01   +3.172984120925370e-01   -4.639700811242298e-01   -3.397600948199948e-01   +6.254725065977652e-02   +7.462655279986264e-01   -4.542720700661003e-01   +1.700544776736900e-01   -3.967380307008037e-01   +4.206012414004318e-01   -1.047875818533037e-01   +1.795896561171637e-01; -1.809320934312002e-02   -4.341873035982428e-01   -4.215667637188826e-01   +4.671536552428917e-01   -3.343266348097860e-01   +5.095848235922643e-01   +6.722739773324027e-02   +4.048442870919508e-01   -5.041799190881914e-01   +3.422424912855584e-01   -3.938939946818490e-01   +3.091737449429223e-01   +2.041767382022296e-01   -1.546049846493699e-01   +4.824099823987445e-01   -2.597832906876591e-01; +3.291645971834696e-02   +4.637195382526114e-02   +1.803411176922310e-01   +1.602272280176741e-01   +5.233381417917744e-01   +2.570677830697325e-01   +1.164424749770697e-01   +1.380530476231962e-01   +3.572567612786297e-02   +3.905606614961920e-01   +3.636024937413427e-01   -2.295946756679372e-01   +1.437947458066864e-01   -3.408952621785111e-02   -3.154285139421446e-02   -1.703989871241760e-01; +1.479915752066940e-01   +4.194201501257435e-01   +1.808126390042292e-01   -2.099228057875434e-01   -2.529671442840954e-01   +2.851487335785875e-01   -2.373850740883239e-01   +3.236992237357273e-01   +2.040778114982242e-01   -3.196712139722077e-01   -3.540309705853801e-01   -2.551519299738265e-01   -3.625709546517685e-02   +2.159532697071853e-02   +6.440205242446525e-01   +4.079119667361774e-01; +1.562629760114224e-03   +3.258256097974606e-02   +1.332012990283290e-01   -3.916352103441454e-01   -4.397186499939539e-01   -6.414741265924453e-01   +2.710578607441254e-01   -3.354520387697133e-01   +5.596158343216006e-01   -3.106867865722383e-01   -8.057619742044456e-02   +4.174046953981336e-01   +2.392601306648538e-01   -5.951470532302428e-02   -6.324156175208461e-01   +2.952218577749661e-01];
L1E_L1I_iGABA_netcon = [+2.466846065420759e-01   -5.843946282040667e-02   +8.406233544665853e-03   +2.202967837782066e-02   -4.082567477444512e-02   -5.106337569577203e-01   -1.007820784432427e-01   +2.340149757398467e-02   -5.516981869212191e-01   -7.160225116321843e-01   +3.739158355709921e-01   +1.733347434926074e-01   +2.704795373431611e-02   +5.013963347088678e-01   +3.023316082866300e-01   -1.626192785177526e-01; -3.015690992624100e-01   +3.305977032701464e-01   -7.474159269918344e-02   +1.133833598480678e-01   -2.251284536372871e-01   -3.126520351062168e-01   -2.086308400029576e-01   -2.143668274580958e-01   +3.727514788208312e-01   +5.064260254832618e-01   +3.103343954622461e-01   +5.912305488513989e-01   -4.238409501536488e-01   +2.271780194109125e-01   +1.738204982692826e-01   +4.246651193539544e-01; +3.689501000350852e-01   +6.642221429137209e-01   +2.016138591890334e-01   -2.001618512643186e-01   +2.099819086258341e-01   -7.185132878826787e-02   -3.861625818949463e-02   -2.345259513320766e-01   +2.218835741399681e-01   +4.663821320879891e-01   +1.099843922200817e-01   +6.571205478640058e-02   -3.233435481617526e-01   +3.531087575201431e-01   +5.678458250627274e-02   -2.792161785064347e-01; -2.181907111858100e-01   +2.391025331925301e-01   -1.862367843814083e-01   +2.678854937028685e-01   -1.010955278820952e-01   -7.864096203098522e-02   +1.856648382575999e-01   +2.476082099831377e-01   -8.893027844887839e-02   +1.695630956775711e-01   +5.713609137338201e-01   -7.546748749281096e-02   +4.128035520318168e-01   +1.838285342574296e-01   -2.916107967704939e-02   +6.326176582067969e-02; -5.701138882874790e-01   -3.612642566082000e-03   +4.226457345416484e-02   -9.646525900268936e-02   +1.954913440199639e-01   -1.406083884059930e-02   +6.313439503056394e-01   +4.043772719148543e-01   +3.183618876653600e-01   -2.377243281706645e-01   -5.169477438188854e-01   +2.749553101269577e-01   +3.257491728519937e-02   -4.901630748153324e-01   +2.083830268061818e-01   +3.084058511633829e-01; +8.269557904414152e-02   +4.666877109449873e-01   +4.802077926495616e-01   -4.554424495879142e-01   +3.560827473465909e-01   +3.590733835451837e-01   -3.643799322448052e-01   +1.840687839627558e-01   +6.740814298859397e-02   +6.512115538002169e-01   -5.693804189956617e-01   +5.564658751310005e-01   +3.593293453437649e-01   +7.659441508914872e-01   +1.606928177608586e-01   -4.033437208987107e-01; -1.281245700290221e-01   +4.044483507386957e-01   +1.699939203082431e-01   +2.289002533788554e-01   -1.664229815535101e-01   +1.672690719699986e-01   -1.203413781335283e-02   -3.393005295804512e-01   +4.305823939167064e-01   -2.117358922680039e-01   -3.078579538041074e-01   +4.908807617336715e-01   -1.628690809782369e-02   -3.151765291339379e-01   -1.020651324941207e-01   -3.475035283063724e-01; -6.408891922157160e-02   +1.262289520076237e-01   +2.340515805810658e-01   +4.849431043374684e-01   +3.945821087726841e-01   +1.539170453619514e-01   +2.362816214012622e-02   -6.809690907397079e-01   -3.154338353248044e-02   -1.635268058419182e-01   -1.940971618839230e-01   +3.897027102151019e-01   -2.555648134100633e-01   -7.475633135769593e-01   -2.312678306989617e-01   -2.087746056380360e-01; +8.728121154434895e-02   +1.766680395880925e-01   +2.581149755768694e-01   -1.799717943912449e-01   -1.388504284713196e-01   -1.924776187908627e-01   +6.833321078107285e-02   -3.813884847997828e-01   +2.863366898135591e-01   -2.688605807872947e-01   +3.785449369940658e-02   -5.910162581075157e-01   -1.624033180925432e-01   -2.355026902294747e-01   +6.149396378691748e-01   -5.359712613556195e-02; +1.874801653141427e-01   -1.010006849746366e-01   +6.813632683218435e-02   +2.817941573777672e-01   -4.886803082684089e-01   -1.826602420869329e-01   +4.407849285982691e-02   -3.375068157723596e-01   +2.602127547632598e-01   +9.732673509120759e-02   -6.274604346417931e-02   +3.824960120478271e-01   -5.246630927379808e-01   +3.258406557942453e-01   +1.914868006308542e-01   -1.829571640397572e-01; -5.296802908115767e-01   -3.277419654940537e-01   -4.633678574708374e-01   +8.827289740598029e-02   -5.020257088946724e-01   +4.835119008717488e-01   +3.220408178015138e-01   +6.911960886331900e-01   +1.749295247710232e-01   -1.886790507459534e-01   -4.996346813150933e-01   -1.696417906631089e-01   +3.826604111914533e-02   +1.217025274751143e-01   +3.194326395438169e-01   +3.725173261577133e-01; +4.569486133424153e-01   +1.499457720253136e-01   +9.872569037471100e-02   +5.808737564318091e-02   -7.771975947025157e-02   +1.613851711981643e-02   +2.749896362505073e-01   -4.209244735912901e-02   +2.539683108774544e-02   -5.421647062686848e-01   -1.653149423259113e-01   +5.507605408341418e-01   -2.724915216806074e-01   +3.868764333522458e-01   -5.299054713071676e-02   -1.727496930562218e-01; -1.256022643539034e-01   +4.203248873504916e-01   -1.468728324819940e-01   +3.832688328176421e-01   -2.828877687710855e-01   -1.038814537642866e-01   -1.430252004960810e-01   +1.297376589664329e-01   +1.766600870101666e-01   +4.747234774194542e-01   -2.404753824396388e-01   +2.801293239221813e-01   -2.092601490253987e-01   -8.884381991699228e-02   +1.804919122758606e-01   +5.197245710297511e-01; -2.700251259565191e-01   +1.697406692904357e-01   +4.208847791047000e-01   +2.161153567266269e-01   -2.497539276213485e-02   -4.735486379718729e-01   +1.582433332798617e-01   -6.187095830133264e-02   +3.133132347434665e-02   -1.427109711562589e-01   +6.727303546243704e-02   -2.601306647842824e-01   -2.348585505226896e-01   +2.042745303366451e-01   -2.937503533881396e-01   +2.080504013287312e-01; +2.797074174384740e-01   +2.086385005218915e-02   -1.717669966267054e-01   +6.162206658252643e-02   +7.537559117763726e-02   -1.498613380903849e-01   +2.075359673172093e-01   -1.145935271092438e-02   +3.732006967586121e-02   -3.339826171231287e-01   -1.222218285703237e-01   +3.045369724495031e-01   -3.357026817136672e-01   -6.402358609582965e-01   -5.713997364382967e-01   -6.100325783651939e-01; -1.039554515120674e-01   +6.639511834520185e-01   +2.703807916037938e-01   +7.022718390825161e-04   +4.772162973486551e-01   +2.890231705011348e-01   -8.798639008374921e-02   +8.022499086641864e-02   +1.444859161891748e-01   -4.006491792621332e-01   +3.230771531957910e-02   -2.779961534742489e-02   +1.715796994560049e-01   +4.362471600793966e-01   -1.425662081217685e-02   -1.753898623877715e-01];
L2I_L1I_iGABA_netcon = [-2.625333106198235e-02   -3.301089882548725e-01   +2.128821106644819e-01   -6.246362374361384e-01   -8.689909676350691e-02   +3.583765624617841e-01   -2.622573084166681e-01   -5.472235653271661e-02; +2.899374843839139e-01   +3.080253813658613e-01   -1.334095798792503e-02   -1.215134770512588e-01   +5.545763611269628e-01   +3.587062627682391e-01   +4.152722224909683e-01   +2.988209467547455e-01; +2.269734400411084e-01   -1.077691465495594e-02   +1.013659380631294e-01   +4.850609694039548e-01   +1.222507127900214e-01   -4.825529870180983e-01   -3.317731697450459e-01   +7.917987962084050e-02; -5.329881987115401e-02   +1.385186897165420e-01   +2.174079417939513e-01   +1.048013743037800e-01   +1.668591287636135e-01   +1.433616556194539e-01   +5.215826396998973e-01   -4.917104300380527e-02; -4.859039894153545e-03   +1.182595656351702e-01   +5.203235108176359e-01   -1.312694678511184e-02   +2.308591068272802e-01   +3.245750941317344e-01   +1.079044218959847e-01   +5.597789935010874e-01; -4.546220544214764e-01   +1.087422965109590e-01   -1.180652510683298e-01   -1.778785356701997e-01   -4.421448123301093e-01   +4.758386406680546e-01   +1.315673533195870e-01   -1.534911300583283e-01; -8.502336880210909e-02   +1.786434012745104e-01   +8.578918818987305e-02   +1.255311007578271e-01   +8.156252473524703e-02   -1.721352510548264e-02   +3.586448451789161e-01   -1.494145871265817e-01; -3.373650999634496e-02   +1.044904364133774e-01   +5.181594007526540e-01   -2.562805136191469e-01   +4.714570289696293e-01   -2.121217515745929e-01   +1.580653603791704e-01   -1.512182362793936e-01; -1.618657131790386e-01   +3.106519450977139e-01   +7.482811916875186e-02   -1.154959499396647e-01   +3.595497103625716e-01   +3.780171165190409e-01   +3.943412383523683e-01   -6.541549852569347e-01; -1.665428622554413e-01   +2.200519540944790e-01   -8.481842048845387e-02   -3.787783415955155e-01   +6.199315528900916e-01   +3.044787051376354e-01   -1.998908182003506e-01   +1.758131207226785e-01; +1.257705303031935e-01   -3.147828931689800e-03   +4.534470395141955e-01   +9.750984253813977e-02   -4.037574419254156e-01   +4.892896543904557e-01   -6.778989026255085e-02   -3.008068464122619e-01; +4.364035325673452e-01   -5.049387022555489e-01   -9.246680737549869e-02   +4.253480518301259e-01   -7.034723578339456e-01   -2.650384284305241e-01   -6.146886466471115e-02   +3.110864226208463e-01; -1.017521217986059e-01   -2.952624630478208e-02   -1.305333071121874e-01   -3.295244260958264e-01   +4.069414165407796e-01   -5.940285209632292e-01   -3.287644669314539e-01   +8.585650763810589e-02; -3.155253041366695e-01   -2.844659245780271e-02   -3.647519181492528e-02   +3.740808646046667e-01   +3.464221450907730e-01   +3.749788157669941e-01   +6.328038202584792e-02   -3.828634906197471e-01; +4.258480981237431e-01   +1.020127795392808e-01   +3.395367609805382e-02   -6.142151030507330e-02   -2.682817342521764e-01   -1.290386791313960e-01   -8.333184670953109e-02   +1.160264200265158e-02; +1.909829797191959e-02   +2.681588548688881e-01   +4.370578283389850e-01   -1.785390499527436e-01   +3.105531997564426e-01   -6.445414116806029e-01   -7.844382045964245e-02   -1.981892298817453e-02];
L1I_L2I_iGABA_netcon = [-2.534864832829210e-01   -3.077000903574627e-02   -1.258950317464380e-01   -3.818912304891565e-01   +4.350074891002182e-02   +1.788415304829504e-01   +2.159751520812255e-01   +1.405321644340795e-01   -3.899850541366304e-01   -1.482450891481385e-01   -3.359957765311184e-01   +2.722214460897963e-01   +4.861058192318730e-01   +2.228230975362055e-02   +3.448128134559171e-01   +6.028926716558511e-01; -5.018197641418050e-01   -6.984870870905879e-03   +2.381776553643343e-01   +1.287326117851730e-01   +1.614148040849950e-01   +3.854656424828888e-01   +1.261106052283352e-01   -2.985454569384336e-01   -1.633382026937978e-01   +2.609552085142807e-01   -7.917761623062493e-02   +2.410330914274408e-01   +4.483216046754415e-02   +1.690761450384834e-01   -3.402807492591781e-02   -2.719287598999566e-01; -1.301950600169962e-01   +1.887917123587548e-01   -1.026351779300300e-01   +9.840316063738776e-02   +8.877560216629445e-02   +4.962981308477973e-01   +3.989148632837743e-01   +4.359877173554871e-01   -3.256598101161917e-01   +4.971398312553021e-01   +3.987169932566136e-02   +1.417867130801768e-01   +1.795718149320185e-01   -7.287436106911310e-02   +3.757603397712903e-01   +2.937924841100816e-01; +7.389911566358057e-01   -1.257157601042939e-01   -4.401901569743794e-01   -1.353664933460377e-01   +6.295355767840801e-01   -3.478819866427933e-01   +2.514209240941785e-01   +5.333559684546162e-01   -4.037974027945180e-01   -4.832829880707133e-01   -5.250593259812716e-02   +1.370490757275042e-01   -5.049619155399467e-01   -3.093607628365319e-01   +3.019442227641013e-01   -9.599048173200833e-02; -1.284273942272067e-01   +5.566187409157263e-01   +2.584334052483589e-01   -8.774582918856785e-01   -4.207524846113466e-01   -5.143942966347078e-01   -1.856789659231657e-01   +5.609532717090406e-01   -2.034181293547729e-01   -2.326526963552366e-01   +4.423863982013412e-01   +4.601383097992494e-01   +4.601764407378046e-01   +2.595114893868349e-02   +5.901648150350395e-01   +2.009949872573086e-01; +2.690609054527044e-01   +2.719210895718344e-01   +2.872368393547705e-01   -4.272510866250852e-01   -1.695672099320693e-02   -1.053146769688566e-01   -2.392944795621574e-02   -1.198017126446677e-01   -1.440473080659697e-02   +6.852038982615767e-02   -4.467815371826974e-01   +1.942720335827830e-01   +3.252034378449644e-01   +2.628076639125717e-01   +5.039793629310610e-02   +3.525780686895676e-01; +6.547436027957679e-01   -3.722025236418163e-01   -8.065246568240762e-02   +4.741154988919024e-01   +6.196162311725086e-01   +4.215000943107754e-02   -2.840330582010997e-01   -4.245627547387809e-02   +3.452547595679167e-01   +1.004536165729000e-03   -1.138315188623413e-01   -3.634464142130517e-01   +2.029669063487288e-01   +8.760973813273157e-02   +1.042035568139166e-01   +2.845473447870806e-01; +6.256837124793768e-02   +7.270473179806225e-01   -1.128668315848012e-01   -1.347833825559397e-01   -1.063746196865152e-01   -4.217969655750197e-01   -3.020733765399849e-01   +3.612999121672463e-01   +5.117983361177034e-01   +3.202230850049874e-01   -2.839967325455783e-01   +1.091974140089802e-01   +3.523031702403976e-02   +5.350471024882166e-01   -1.548291551147059e-01   +5.042683604796075e-02];
L2E_L1E_iAMPA_netcon = [+4.456048383424051e-01   +3.537731346431883e-01   +3.094616465624072e-01   -2.986019776310890e-01   -2.449103707156579e-01   +1.020759956645409e-02   -2.772782581195249e-01   +4.897611810506408e-01; +5.773129075746347e-01   +3.155629693500797e-01   +6.258116919646268e-01   -4.447348402477071e-01   -1.703450227084306e-01   -1.745735796665955e-01   -2.927469436954974e-01   -3.208422889171321e-01; +6.656054103340395e-01   -1.779027260978289e-01   -3.146306516237496e-01   +2.077878807830238e-01   +7.326954153899268e-02   +1.451048828096606e-01   -3.411410343974153e-01   +1.029753794030552e-01; -5.792304486327019e-02   +3.089090050246300e-01   +3.132304561642739e-01   +6.579737024179524e-02   +2.181090088591136e-01   +4.407853473562857e-01   -6.301837708087746e-02   +2.389512375142232e-02; -7.643182367360327e-02   -1.975063214227187e-01   -1.258586651574324e-01   +5.876763798236172e-01   -1.255319431567407e-01   -3.636404014297590e-01   +4.258857345574601e-03   -5.532837195857079e-03; -1.453939293135360e-01   +7.229333919766341e-01   +2.392232818949742e-02   -1.974325332702109e-01   +8.116825676869817e-02   +8.842316323891122e-01   -6.068911618146813e-02   +2.755960417838650e-01; -2.914760546665910e-01   -2.880164674321935e-01   -4.870651225348590e-01   +5.158356729808891e-01   -1.817000608647262e-02   +1.434927147141281e-01   +2.696431668654671e-02   +8.953785303910781e-02; +2.733421471705242e-01   -7.205506015404251e-02   -5.941862487100915e-01   +1.816623181699139e-01   +2.984121025765295e-01   -6.594808831128227e-01   -2.523861838764925e-01   +3.145699124793020e-01; -7.337975499301463e-02   +2.262578822294936e-01   +3.038369597395738e-01   -3.927279615282459e-02   +3.208782831272545e-01   +7.609747854220188e-02   -3.209581936984698e-02   +2.471046364084619e-01; -2.258999286361501e-01   -8.307509640056226e-02   +4.013418383358745e-01   -8.185635276543690e-02   +4.130780078596525e-01   -5.528669068054696e-01   -4.519988564751719e-02   +1.400122044879955e-01; +1.776661379919487e-01   -5.817495548669050e-02   -6.420442620383192e-01   -1.253040215994551e-01   -4.876390315194474e-01   -4.925946084967365e-01   -1.701449852532778e-01   +8.256768316225056e-02; -4.084812855659724e-02   +4.120417725942779e-02   -1.822328283974221e-01   -2.818242807534702e-01   -1.545394517638193e-01   +4.364565441244352e-01   -5.368247535427724e-01   -1.293007927093913e-01; -2.052103294746442e-01   -4.837547031183365e-01   +3.241843622417446e-01   +3.887970457791522e-02   +6.965762352422140e-02   -4.246146922097546e-01   -1.033154012827800e-01   +5.047861759216894e-02; -4.211054802390443e-02   +2.303440924386855e-01   -1.250893510135511e-01   +3.846193581120579e-02   +3.594722198212864e-01   -2.778677800495675e-01   -3.674307397445267e-02   -1.493474206278398e-01; +5.896668309187657e-02   +1.450937894015666e-01   +8.677584909732476e-02   +7.582348990472720e-02   +3.162921020075103e-01   -3.978485119452073e-01   +1.948664834322417e-01   -3.378625228098832e-02; +3.034990488383335e-01   +4.698785496497584e-02   +2.901492478763994e-01   +1.106008594172034e-02   +1.793127011226472e-01   +2.627158070235082e-01   -5.525266093012798e-02   +1.859056878397802e-01];
L1E_L2E_iAMPA_netcon = [+6.775265936497783e-02   -3.988306200384453e-02   +1.314582169686208e-01   -6.545618386812663e-01   -3.680178452088932e-01   +5.213904117448717e-01   +5.074392348150193e-01   +1.124899008660670e-01   +1.998602225622046e-01   -6.061136629627351e-01   +3.108556012510929e-01   -9.873187559856528e-02   +1.106407140891631e-01   +2.297539866881615e-01   -6.208916288341575e-01   +1.805718850950008e-01; +4.826179187762962e-01   -4.088200160557082e-02   -7.210906409027541e-02   +1.172614442395408e-01   +3.714635481367121e-01   +2.736398759189969e-01   -4.848321006694672e-01   -4.044381430018788e-01   +3.585473335115978e-01   +1.304668245928172e-03   -3.033277594814855e-01   +2.243834343948738e-01   -3.170253850873261e-02   -5.924613745006767e-02   +6.370311699401413e-01   -1.874407992183363e-02; -8.573376524912506e-01   -1.426825074572660e-01   -9.985262950781781e-02   +1.537786847987425e-01   +4.114086031204259e-01   +4.823990982320248e-01   +1.643018105597601e-01   -1.369927020421931e-01   +5.184483669622182e-01   +4.633451592918355e-01   +1.116003145822187e-01   -5.223605528486840e-01   -4.564327974916672e-01   +5.431600614874987e-01   +5.815909775414065e-02   +2.373409075266162e-01; +6.686667219790542e-01   -3.626439725718544e-01   +3.271879947233938e-01   -1.224706033421418e-01   +3.466922264449261e-01   +3.683395060123106e-01   -1.402150994684586e-01   +2.118608415207432e-01   -4.375742205131997e-01   +5.021140567425563e-01   -1.881856032806765e-01   -2.279307173139003e-01   +3.228698911525514e-01   +1.882228717801692e-01   +4.170211106017263e-01   -1.389556712265665e-02; +3.897346522617617e-01   -8.856953365690230e-02   -3.367294484508311e-01   +4.936207533765377e-02   -5.948690429099211e-02   +4.116977770400244e-01   +2.751209841740366e-01   -8.095644725100563e-01   +2.386703944027221e-01   +1.161264855445403e-01   -5.698777092050651e-01   -6.500944311685776e-02   +1.276056752962813e-01   +4.914085530826057e-01   +2.082198262800030e-01   -3.896768100122461e-01; +8.788454954451809e-02   -3.938815631191943e-01   +8.869110748194312e-03   +2.032891668743880e-01   -1.455907601310152e-01   +9.406873803305006e-02   -2.766195388618529e-01   -4.823654764791896e-01   -1.709319772359192e-01   -1.109117925485623e-01   +2.862032323593948e-01   +1.706086095877357e-01   +3.895115014497659e-01   -8.172049488427189e-01   -1.604912116977455e-02   -2.828177331429482e-03; -5.972262015722103e-01   -9.712282524674444e-02   +1.497299273178987e-01   +2.815638096897437e-01   +1.186100057987460e-01   +4.436676558909831e-01   +3.409682569500989e-01   +2.192103193122766e-01   -5.167846655507979e-01   +5.059331882970058e-02   +9.746748838458245e-02   +2.001963223878875e-02   -1.320447549170492e-01   +1.399328715145471e-01   -1.475466153954884e-01   +9.798373752781726e-02; +5.837215224202101e-01   +2.515390340463118e-01   -5.197077377044080e-01   -1.843193111790401e-01   +9.457826677689300e-02   +1.538115924598304e-01   -5.626859400828029e-01   -1.143404264326670e-01   -5.619352040467945e-01   +1.463391356711238e-01   +2.178481914605541e-02   -2.584505021509638e-01   +2.718062658243555e-01   +5.241326621717329e-02   +5.258799345794403e-01   +1.847056580521891e-01];
L2I_L2E_iAMPA_netcon = [+6.916362481055582e-01   +2.835355236485496e-01   -4.659516993953680e-01   +7.259844421863046e-02   +3.227543382379196e-01   +2.659658433020301e-01   +1.045337663499917e-01   -2.296393306215124e-01; +3.774715566447515e-01   +1.154656597860072e-02   -3.906019073990698e-02   +1.458434717012952e-01   +1.954530891564624e-01   -1.611155112842529e-02   +3.418153633663687e-02   +2.840884086057543e-01; +9.113548060028576e-02   -8.615909803543903e-03   -5.617595313845791e-01   +3.680528128170731e-01   -2.912033954830742e-01   -2.480335218097718e-01   -1.013264325891818e-01   -3.396215860308398e-01; -2.626402556812146e-01   -9.592370785821273e-02   +8.729841846613005e-01   +9.098858833563631e-02   -3.876867415540215e-01   -1.972803100527230e-01   -1.310204553921826e-01   +2.306893616468307e-01; -6.765472902999779e-02   -6.305129293074959e-01   -3.596736348938635e-02   -4.063135908923813e-01   +1.190413226683926e-02   -3.157459392904398e-01   +5.151286214898536e-01   -2.366120470062058e-03; +2.960682601323379e-01   -8.498101520902217e-02   +1.786502891833697e-01   -1.387304042621481e-01   -1.918874128909054e-01   +3.002298550882717e-01   -1.497816464885593e-01   +2.705516938498274e-01; -1.614432068364496e-01   +3.369276401135529e-01   +1.167533774872268e-01   +1.506678211065254e-01   +3.779805651038328e-01   -2.496715798267042e-01   -1.038300285111792e-01   +6.166299127034144e-01; -7.492202090082375e-03   -5.348930938199553e-01   +4.976117106183383e-01   +1.016559589472717e-01   -2.106556031682520e-01   -2.172570040515730e-01   -9.013845622129496e-02   +3.435239163088119e-01];
L2E_L2I_iGABA_netcon = [+3.566847915889844e-02   +2.022682429521545e-01   +4.581286115683998e-01   -5.923861088359099e-01   -4.581204394064370e-01   +7.385950979444884e-01   +2.938253157379859e-01   -7.776596438526134e-02; -1.174622038468353e-01   -2.793314659307859e-01   -2.820662985848485e-01   +3.944149670864935e-01   -3.128053610580172e-01   +4.444891086775206e-01   -5.213815808329729e-01   -1.127927772934122e-02; -3.050855344918985e-01   -4.157458572392332e-01   -2.315903425857937e-03   +1.256632380810030e-01   +4.179021226142400e-01   +1.086107595604562e-01   +2.199264316872850e-01   -4.791219385484463e-01; +8.757036108951201e-01   +2.177656640040791e-01   +2.447433989022992e-01   +9.973956255590319e-02   +8.401628494728434e-01   -4.497931135190220e-01   -4.600647583226242e-01   -2.585802090478039e-01; -3.520659082483390e-01   +3.174286900785611e-02   +2.686394789629714e-01   +1.655828725236448e-01   -2.950152492917126e-01   +1.353030430665811e-01   +1.353148828445124e-02   +2.621576785791079e-01; -4.516531881246175e-01   +3.628397004714461e-01   -3.727901569796110e-01   +4.458127653299921e-01   -5.695124045501754e-01   +4.345983925864780e-01   +1.710151657578874e-01   +5.227342036804155e-01; +2.516542929484283e-01   +3.841275011036735e-01   -6.640310162774270e-01   -5.711593052888291e-02   +6.512692655800525e-01   +1.312650232856258e-01   -5.307818190813843e-02   -2.132542638770015e-01; -2.809843176730161e-01   -9.145558665980411e-02   +4.086780954116197e-02   -6.703024255834307e-01   +8.073428655916688e-02   -1.732172505044141e-01   +7.420917982150947e-01   +8.316885647652271e-02];
L3E_L2E_iAMPA_netcon = [-3.343182683242069e-02   +1.259656334727686e-01   +7.218161340705566e-02   -4.549921214466093e-02   -3.976955720086880e-01   +1.033208898713530e-01   -2.843884909567189e-01   +2.124816621864946e-01   -5.914272568176085e-01   -4.085092634909133e-01   -2.664797137186915e-02   +4.060804507760072e-01; +6.584144091850749e-02   +9.040826378113334e-02   +9.242209317155567e-02   +6.933198113776911e-01   -4.402488988747879e-01   -1.959081272492291e-01   -1.012207203505220e-01   +1.756822584756053e-01   +2.555098173263667e-01   +2.316752541256354e-01   -3.832627448512352e-01   +3.349569722474866e-01; +3.721788211513454e-01   -2.098390193934075e-01   +3.888993579703034e-01   +5.368868522784742e-01   +2.596874977016962e-01   +4.161748520157739e-01   -7.389339842721301e-02   +2.620283465649972e-01   +3.044056641371301e-01   -6.438909661914172e-02   -5.902365956164422e-01   -7.445592379188980e-01; -2.786952822200371e-01   -1.713032564547561e-01   +4.574561083396912e-01   +1.092004409074673e-02   -6.464370938150503e-01   -1.351675839278921e-01   -2.156886958504699e-01   -5.052619634720800e-01   -3.275215565851515e-01   -1.028128242154050e-01   -5.282511591288599e-02   -4.336807398530847e-01; +6.907528514278214e-01   -1.927413898556460e-01   -3.370611369313254e-01   +1.725211553104846e-01   +2.580080202529286e-02   +3.975035751231137e-01   +7.168964506508703e-01   -1.467783977534446e-01   +2.291837040616625e-01   +3.088746302175042e-01   -2.366321208569199e-01   -3.385885481148670e-01; +3.490391460199481e-01   +3.064644959181694e-01   -5.064068496307933e-01   +5.410845798048556e-01   +5.526848816613980e-02   -1.777038215312121e-01   +6.926044423779858e-02   -4.279227029741043e-01   -1.930839347224985e-01   +3.778278423677314e-01   -5.568438532930241e-01   -5.486543119134867e-01; -3.006910213606470e-01   +1.735834809870093e-01   -3.279425714842787e-02   -1.080493140733373e-01   +8.422593271360518e-02   -2.246001329082061e-01   -2.979554015624752e-02   -9.208820757042336e-03   +1.239185831238223e-01   -4.067501073794228e-01   +4.161909649906579e-01   -2.834077390901246e-01; +2.299739710779414e-01   -6.091580661579872e-01   -1.299079487794973e-01   -1.357354676555538e-02   +1.458866893449282e-01   -3.502263745854208e-01   -2.915555811911796e-01   -1.730805635117331e-01   +1.079200370861609e-01   +1.790021593441315e-02   -1.953676964210257e-01   -3.156222755567878e-01];
L3I_L2I_iGABA_netcon = [-7.196604265995038e-02   +1.101109669402927e-02   -5.509210518723546e-01   +1.971810450323618e-01   -6.321716604719191e-02   -3.203812311854294e-02   -3.127815611239353e-01   +1.225464654097952e-01   +1.364348685784785e-01   +3.502231534305543e-01   -6.666395011630996e-02   -4.537536269052823e-01; +3.395617915783468e-02   +7.514948864714530e-01   +1.723978825849904e-01   -1.602450686439538e-01   +2.471392651116491e-01   +7.892479417853986e-02   -1.591799292122957e-01   -1.697189940085307e-01   -2.983788205685325e-01   +1.049866943218008e-01   -4.927893445158635e-02   +4.317498817627105e-01; +4.329821443088186e-01   -1.068870501761231e-01   -6.374496245699564e-01   -8.553543553632725e-02   -1.227262414425091e-01   +8.632595874591395e-02   +1.409961113325096e-01   +6.860334853232262e-02   +1.574400885254414e-01   +2.331907297024202e-01   -5.775460308896643e-01   -5.170485861336591e-02; +1.543021338860362e-02   +6.020820105055311e-01   +5.484846457362138e-01   -7.517755106994199e-04   -1.097842545380215e-01   -4.374116707725292e-01   -4.657164802423173e-02   +4.163836831347597e-02   +6.622353644719460e-01   -1.552747063031837e-01   +5.461602766921488e-01   +7.379893628532459e-02; +5.975130487382336e-01   -1.739134462175145e-02   +2.201998709454684e-01   +2.557190078723234e-02   -5.996597312240191e-02   +4.648188743773261e-01   -2.551089377911005e-01   +6.277943248875254e-01   +3.955614938319394e-01   -8.897102256918028e-02   -1.705813850712236e-01   +4.921006393790068e-01; -3.363513968149405e-01   +6.997217567520775e-02   -6.198064987117354e-01   -3.340329662843777e-01   +6.368326187028948e-01   -6.672828027252761e-02   -1.895712038453365e-01   +3.391450748949463e-01   +2.931265611066058e-01   -5.938147518435511e-01   +1.042239301214527e-01   +5.624448920008567e-01; -5.041056053234501e-01   -4.495919585327371e-01   +5.289701661026170e-01   +1.953787920417988e-01   +6.482322869341223e-03   +5.434097492846865e-01   +3.716306625738126e-01   +1.532910298837918e-01   -4.822817848662933e-01   -2.336724932667642e-01   -8.246770956837637e-03   +2.063371614105272e-01; -5.900923339162262e-02   -1.617129074146891e-01   -6.047291129207141e-03   +4.050828459475995e-01   +2.206759857455204e-01   +4.070370034383921e-02   -2.393892493152642e-01   +3.699759124912267e-01   +7.576126061814598e-02   +2.319508849309435e-01   -3.935016487969918e-02   +1.470966224366972e-01];
L2E_L3E_iAMPA_netcon = [-2.399167550510592e-01   +2.584125475263917e-01   +7.265430185973996e-01   -4.016159172687969e-01   +1.670680431782853e-01   +5.593463957796867e-01   +2.385121136727397e-02   +4.913144363555930e-01; +3.674818398264851e-01   +6.153879221110200e-01   +3.780513897744199e-01   -4.780453778009213e-01   +1.740329108979088e-03   +2.232992102773255e-01   -3.670494595465761e-01   +3.831171450733511e-01; +6.048840628687127e-01   -1.560722384923914e-02   -3.016044781288504e-01   +2.856942543461007e-01   -2.153557425320446e-03   +4.354594464483419e-01   -1.171844356908856e-02   +4.473460105647728e-01; +1.039239313140680e-01   +1.074922946413925e-02   +6.435732072123790e-02   +1.486691899920154e-01   -2.762652976896489e-01   +5.085276114443776e-01   +6.725744733164373e-01   +1.953751007114058e-02; -1.609290895615526e-01   -2.604973044027805e-01   +1.243281063942449e-01   -8.789346254303490e-02   +4.198358904867694e-01   -5.205696127761101e-03   +1.536341419722862e-01   +4.070397329263130e-01; +4.060378699438475e-01   +4.647459613219924e-01   -4.919133428898637e-01   +1.195135454672624e-01   +2.032114830905594e-01   +2.713513665917516e-01   -5.100039370989541e-01   -1.063539223008330e-01; -3.434408329685756e-01   +5.251006553385094e-02   +2.424609533222480e-01   +8.918801060468778e-02   -2.830984432766915e-01   -1.365111955098086e-01   -3.307014586788697e-02   -7.088805035030472e-01; +3.885665114645968e-02   -2.759795570369107e-01   +3.732540610979531e-01   -3.425074070320459e-01   +1.238750895638796e-03   -2.098208248322364e-01   -1.630219999233711e-01   -1.306908044481886e-01; -4.396588537245758e-01   -2.237393579559884e-02   -8.295989746760660e-02   -1.826216749931483e-01   -2.584449114154844e-01   +1.293944884074160e-01   -2.281936713931293e-01   -2.864556021419395e-02; +2.438652237082003e-01   -1.025020342501005e-01   +5.642157702628270e-03   -9.671595680378153e-02   -1.256828934565899e-01   -3.926660559437925e-01   +3.461818332255003e-01   -6.354042389889805e-01; +2.460795571637645e-01   -5.391349027953746e-01   -8.368378871257243e-01   +3.051467094213054e-01   +2.924443365961606e-02   -3.234338078568550e-01   -3.530678383889245e-01   +3.202226092785719e-02; +2.194837787521899e-01   +2.092791058850444e-01   -1.678172355629972e-01   +1.572154202852160e-01   -5.629694252948340e-01   -3.115967371637324e-01   -4.741839013525985e-01   -5.453151444851099e-01];
L2I_L3I_iGABA_netcon = [-3.106689126345810e-01   -7.019673743903634e-03   -2.019856005269464e-01   +1.173825217508928e-01   +2.045251371924288e-01   +1.618120942914060e-01   -1.651952016190429e-01   +3.943493988393679e-01; -1.785769291555408e-01   -3.817242764114586e-01   +2.452805167530449e-01   -3.009037933550878e-01   -2.126439248292478e-01   -1.817881213934949e-01   +1.598726374437497e-01   +2.327739936870609e-01; -2.569258686070670e-01   -1.264662484458331e-01   -4.967285128002661e-01   +3.127139882521542e-01   +2.312927329476880e-01   -1.766984231168011e-01   -1.383491761495863e-01   -2.912186066407013e-01; -3.823107263213641e-01   -6.002957012790920e-01   -1.991642031150177e-01   +1.938923081504360e-01   -2.011424169161523e-01   +2.135780585198110e-02   +1.960704322262760e-01   -7.211050357439469e-02; +1.081643328933089e-01   -7.501470847859842e-02   -2.513167620100745e-01   +2.481521369530355e-02   -3.965427865919265e-01   +2.374295374860239e-01   +2.795889677267376e-01   -1.964375721972500e-01; -2.195518097866808e-01   +1.094908232558541e-01   -3.087774584829092e-01   -9.408732792623771e-02   +4.182799771902264e-01   -1.173662508092348e-02   +6.781090543108007e-02   +2.112623418921842e-01; +9.155313993246406e-02   +3.962529073358523e-01   -2.656169648514941e-01   +8.492057959399463e-02   +8.132043934965468e-01   +4.369394238337037e-01   +2.301493306464270e-01   +6.544339176542134e-01; +2.516405067128425e-01   +1.437161086714261e-01   -4.165771737317115e-01   +4.034636713121451e-01   -1.653392880518951e-01   +3.933567222989982e-01   +4.345877093633965e-01   +2.529573345936888e-01; +5.841059117722858e-01   +4.963859657018692e-01   +6.212074472554723e-01   -4.569302998871478e-01   -6.862086437997709e-01   -9.291348777419911e-03   +1.999495879710111e-01   -2.791104448692218e-01; -1.305715142540544e-02   -5.678639046439918e-01   -1.299573546922370e-01   +1.162063909548119e-01   +3.502669782620514e-01   +4.247058397040109e-01   +1.380980938835893e-01   -2.896702830209808e-01; -4.541478496604581e-01   +5.336442987676558e-02   +1.302478046768436e-01   +1.747171574049144e-01   +1.643569474661847e-01   -4.997914379924253e-01   -7.827424761847651e-01   -3.350768363534777e-01; +2.685291591002619e-02   +3.709222328052212e-03   +1.956237472011997e-01   -7.282332063799248e-01   -8.981213349197147e-02   +1.753028375743988e-01   -5.851353695407449e-01   -2.920439588785210e-01];
L3I_L3E_iAMPA_netcon = [-5.639001061804055e-01   -5.729224993737668e-01   -5.660280781577882e-02   -8.897408048850244e-02   -3.088423047907198e-01   -7.944117866614346e-01   -1.909620429435097e-01   -3.740253419410922e-01   +5.393379762243372e-01   -5.427037521367837e-01   +3.450998783773508e-01   +2.620109567681833e-01; +1.888781191275725e-01   -8.562150474337668e-02   +4.172023779532287e-01   -5.891693822702426e-01   +6.534593962085162e-01   +5.734442629507321e-01   +3.849949743505313e-01   +5.119607053616968e-01   -1.181812217241766e-02   -8.169465606460026e-01   -4.663984665350685e-01   +1.112731909526432e-01; -4.053806690438010e-01   -1.473030646343939e-01   +2.252668233395758e-01   -4.258769343915927e-01   -5.883528284121545e-02   +4.477830884024093e-01   -3.679005812924648e-01   -2.997010040461925e-01   +1.291678427237249e-01   +2.175291064566911e-01   -1.149556062867659e-01   -1.150401939391693e-01; -4.380278132556305e-01   -1.460406757381376e-01   -3.405587306133594e-01   -5.759936280982738e-01   +1.697532132758170e-02   +5.228554356342173e-02   -2.200952853056914e-01   +8.269186482605186e-01   +3.233315397545997e-01   +2.653966217626065e-01   -3.424358265527065e-01   +7.110114761761457e-02; +2.263296107726324e-02   -4.792147418023589e-01   -4.874940433783778e-01   +2.279123407403175e-01   +2.222385663765262e-01   -8.287434087565636e-02   -1.961261297972723e-01   -4.982341885826242e-01   -1.473513966883512e-01   -2.850522496930191e-01   -3.697406715301870e-01   +1.141942283028648e-01; +7.020349230750134e-01   -2.624620718031447e-01   +1.293512174682653e-01   +1.796435792004833e-01   -3.755548294988200e-01   +6.875286129989465e-01   -1.047568159338558e-01   -4.495603078794001e-01   -7.451914837475962e-02   +2.533504868085067e-01   -6.117314210588083e-01   +4.912898585191532e-01; +1.664621417712925e-01   -5.230546374746165e-02   +5.587675970218343e-01   +6.939560583147000e-03   -5.733518166241985e-01   -4.035596191228025e-02   +3.323948942309993e-01   +7.896985226328599e-01   -1.730544226611178e-01   -3.202624791527738e-02   -1.890776163871475e-01   +5.649869582878271e-01; +3.335476122708433e-01   -5.312047436260182e-01   +7.986832794188956e-01   +2.022369415246487e-01   +2.188315778760564e-01   -1.305439256551520e-01   +1.076724589431080e-02   +2.899576400410084e-01   +4.685765506589121e-01   +6.873451537066655e-02   +2.928066278339797e-01   -6.207315826858290e-01; -3.412800529874394e-01   -2.116213017683095e-01   +4.851673547957618e-02   +1.265057631949394e-01   -8.554484196093538e-02   -4.697151520570592e-02   +8.183849861354495e-02   +4.220687865809916e-01   -1.266576333379401e-01   +1.709680673680828e-01   -2.349887047435889e-01   +1.608536855169866e-01; -1.051368361214969e-01   +7.711252711609436e-02   +1.617316366728777e-01   +9.800166459487322e-02   +1.413147002026557e-01   -1.585058270120930e-01   +6.691554405311870e-03   -7.618541742204933e-02   -1.352112998606370e-01   +3.797597284287778e-01   -5.912843650585685e-01   +1.579739968750211e-01; -2.976736267221521e-02   -6.777116981438244e-02   -1.693425597994524e-01   -3.976285679033137e-01   -4.534808705768972e-01   -2.063509277030975e-01   +3.896011422807069e-01   -3.553533602458895e-01   -2.037586324018318e-01   -7.121368128377814e-02   +1.308896489676107e-01   -7.651017404966834e-02; -1.298443251441745e-01   -1.150133250000522e-01   +2.150390111044445e-01   -6.657498298824351e-01   -2.431540137504255e-01   +1.408986418516714e-01   -7.561854475216222e-01   -5.050735942734907e-01   +3.317558701156406e-01   -4.194117529578679e-01   +4.883083691985300e-01   +6.625663862139025e-01];
L3E_L3I_iGABA_netcon = [-2.090352716542687e-01   -2.907465885722497e-01   -2.010292828567492e-01   +8.230378891503058e-02   +1.755211572152489e-02   -8.038763635831635e-02   -4.938302557973075e-02   -1.482660310325368e-02   +2.320003063200309e-01   -1.478674608373289e-01   +2.504619907101079e-01   +1.549146917938598e-01; +6.814239051045615e-02   +1.884592974872246e-01   +1.071339785100804e-01   -4.351964920592352e-02   +3.002885144154151e-01   -5.538896218333068e-03   -8.294073172083841e-02   -1.887804424343652e-01   +4.655187667998577e-01   -4.606330683878306e-01   +1.132651320219575e-01   -3.711293128417011e-01; +1.393693823052615e-01   +1.522730061653439e-01   -3.704626054218924e-01   +1.801283753359155e-01   -6.008500312344451e-01   -1.124502534682963e-01   +1.949651149409813e-01   +1.504545720222578e-01   -3.641873468885767e-01   +4.095329927336484e-01   -4.113552850035855e-02   -3.956600412229501e-01; +1.966187244679264e-01   +5.426084653792345e-01   -2.674280958570107e-01   +3.999322442740443e-01   +1.113682331798384e-01   -5.443934058984956e-02   +4.185573507603981e-01   -9.451951767590168e-02   +4.082939004346690e-01   -1.482277853246602e-01   -1.689769616974640e-02   +2.736502413319144e-01; +3.028640733288304e-01   -3.893565270115970e-01   -3.539705473533273e-01   +1.222070412509609e-01   -5.890855172776772e-01   -2.025695290774467e-01   -5.477985871853962e-01   -2.217841481222873e-01   -1.660923524748306e-01   +2.018797395535372e-01   -5.240973277014913e-01   +1.723789055741835e-01; -4.982790687190407e-02   -1.963682064248063e-02   -3.232030972681794e-01   -1.671636763335111e-01   -1.813444945170766e-01   +6.792251328204592e-02   +1.816121629707045e-01   +3.638006042114665e-01   -3.015430935067061e-01   -2.158110761691068e-01   -3.081163746839856e-01   -3.404301957246489e-01; +1.329197493234137e-02   -3.549891666394090e-01   +3.411320562321758e-02   -4.215409029413477e-01   -2.352962473540069e-01   -5.422263016701443e-03   +4.790494575629847e-02   +3.122665325107759e-01   -5.895064505985410e-01   -1.063495407248117e-01   -5.159516325945387e-01   +1.679630107677523e-01; +2.306688117453747e-01   +2.348451834470175e-01   -5.336719853102022e-02   +5.380531252945327e-02   +1.986762105252215e-01   +4.215238244934555e-03   -3.600383680350256e-01   -4.906264434665341e-01   -3.329413807160520e-01   -1.362127949402162e-01   -7.089238679934535e-01   -7.383069101613801e-02; -2.286769041187094e-01   +1.729185022744803e-01   +2.155993522160773e-01   -2.298836388775231e-01   -6.840721697514898e-02   -5.334427486943527e-01   +4.744639390878914e-01   +2.416540055558973e-01   +1.647029433680648e-01   +5.706419595034908e-01   -2.103771114495896e-01   -6.066268538126210e-01; +3.009821395554825e-01   +3.392341683875385e-01   -1.435622853232263e-01   +5.208575930385957e-01   +2.313824211896837e-01   +2.461740685412664e-01   -3.298280830064017e-01   -4.034426002494506e-02   -5.523608801291158e-01   -3.479464500254535e-01   -3.411415812467469e-01   +1.090868863864887e-01; -5.353827656682348e-01   +2.197800577568373e-01   +4.384540653945707e-02   +3.985114143696276e-01   -4.737172270730888e-01   -3.422205150588188e-01   +3.078715214856026e-01   -4.156938979641896e-02   -9.244011278261249e-02   +3.688277376038358e-02   +4.876197129631336e-01   +4.381537078346462e-01; +7.899591604806105e-03   -3.386794699055398e-01   +6.295183933676097e-01   -4.925832104308214e-01   -2.742246838252154e-02   -2.210560204011419e-01   -2.134340214362116e-01   +2.328257339861943e-01   +1.370986536304727e-01   +6.518699121036402e-01   +1.071842502846280e-02   -3.388898038085237e-01];
L2E_Input1_iAMPA_netcon = [+7.350528096345181e-02   +3.430106309410752e-01   +1.488146757414925e-01   +4.737900727799111e-01   +3.089262706807330e-01   -4.242256769109940e-01   -2.084586621578639e-01   -2.023060543553399e-01];
L2I_Input2_iAMPA_netcon = [+3.263373430923877e-02   -1.580447421530617e-01   +6.008825579373112e-01   -5.704881230373019e-01   +4.744110465520150e-01   -4.012640343912874e-01   -6.839474945848889e-01   -1.309108130161511e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
