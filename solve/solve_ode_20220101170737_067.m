function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.044076416858487e-01   +2.711053739691561e-01   +1.922932832517914e-01   +9.978582288804709e-02   +3.251018989069072e-01   +3.527598181948585e-01   +1.254371899428785e-01   +3.311545434681981e-02   +3.891861854183093e-01   +2.037523031477156e-01   +2.087917415990258e-01   +1.379618733463713e-01   +3.283554304719816e-02   +2.101309737172924e-02   +3.800961635258009e-01   +2.901810875886511e-01; +6.330108601632344e-02   +3.924874304174032e-01   -8.411487732593093e-03   +5.401667741304104e-02   +2.894162672414533e-01   +2.488662532250421e-01   +7.828299046771077e-02   +3.966282838560796e-01   +3.294837099463954e-01   +2.601512681969410e-01   +1.802927925070640e-01   +4.057388081921716e-01   +2.499002918153539e-02   +1.966559719198848e-01   +1.611929984366334e-01   +7.644326422224097e-02; +4.040485168863693e-01   +3.693387880408723e-01   +2.464159919392886e-01   +1.102973925606416e-01   +2.348532300912279e-01   +1.177275605601266e-01   +9.446411091171227e-02   +1.347178952456674e-01   +2.898533276957052e-01   +1.394617579011237e-01   +3.990708369870452e-01   +2.487150090306145e-01   +1.927134173898576e-01   +3.427511283498594e-01   +2.906643972230863e-01   +3.630014324341549e-01; +1.931814656516813e-01   +5.159418699097108e-02   +1.160516461742037e-01   +7.400354967758134e-02   +4.371148531963794e-03   +1.930320327611591e-01   +1.248235045714566e-01   +1.034437639428450e-01   +1.130511277397968e-01   +3.050527943597349e-01   +3.981538937491154e-01   +7.138694103233460e-02   +1.256126662658365e-01   +2.572609833687013e-01   +1.571542546261847e-01   +7.139960761856777e-02; +3.843734540453133e-01   +1.334160780596772e-01   +2.629976070727325e-01   +1.330562843971615e-01   +3.743329803957451e-01   +3.622745836919862e-01   +8.630999958957408e-02   +3.178328312083516e-01   +1.132990254097318e-01   +2.733267686766090e-01   +8.672361259681609e-02   +2.826328777869624e-01   +3.351404734645987e-01   +3.548516252151402e-01   +3.373002905218450e-01   +3.379744161769358e-01; +4.009527664913290e-01   +1.812915820398045e-01   +3.992462643733660e-01   +1.764518560095492e-01   +1.360137795690924e-01   +2.543137940692019e-02   +1.617899323393235e-01   +1.605852742678057e-01   +7.927293715477621e-02   +2.449298929707707e-01   +9.240574295114103e-02   +1.531423586358957e-01   +2.700768747118783e-01   +3.238856669212251e-02   +1.735776076375348e-01   +3.628825751875028e-01; +1.083735257869026e-01   +3.620394554781164e-01   +2.914606542130274e-03   +3.029157574268553e-01   +1.087676112793544e-01   +2.125709163968654e-01   +4.081758024012628e-01   +2.542548110561380e-01   +2.892933417422651e-01   +2.724272183617082e-01   +2.606251134239585e-01   +4.097402480247241e-01   +2.275969610550448e-01   +3.090341425213595e-01   +2.223006410689745e-01   +2.535067183907608e-01; +2.624917513162860e-01   +3.823146357181820e-01   +1.011111743356565e-01   +1.173310993090201e-02   +3.065432771919272e-01   +2.041998258941854e-01   +8.116405615450045e-03   +2.443428776490041e-01   +1.770847818565861e-01   +3.415988824827355e-01   +3.059263363758974e-01   +8.875023647345545e-02   +1.068405971680543e-01   +2.580588402676192e-01   +2.276568206992260e-02   +2.552109744472230e-01; +2.357647240720390e-01   +1.160546244927296e-02   +2.014537643803519e-01   +3.492558582265793e-02   +1.498156500006429e-01   +3.497595796534597e-01   +1.484212047466517e-01   +3.698039072773748e-01   +2.281075242092633e-01   +2.416556360185610e-01   +9.681385254915095e-02   +1.597570727358164e-01   +2.252333357180995e-01   +9.655715285342704e-02   +1.739354483831280e-02   +1.027464002317442e-01; +3.259602771139660e-01   +7.365744053978462e-02   +3.419076177909458e-01   +3.459261471001925e-01   +1.134430656402561e-01   +1.588914293856306e-01   +2.039711132513004e-01   +1.123028101687278e-01   +2.460118668475841e-01   +1.525128103673788e-01   +1.001865331782713e-01   +3.123591927300441e-01   +2.335994593655177e-01   +1.769637579538686e-01   +1.916381376462545e-01   +1.101929677533219e-01; +2.342656423819491e-01   +3.853770580861279e-01   +1.865516554892833e-01   +1.816898916471006e-01   +1.296291760577873e-01   +7.724015997973253e-02   +2.877638241822541e-01   +7.264658540533822e-02   +3.174131199408680e-01   +2.294389084382858e-01   +3.868264040695253e-01   +3.462578096241676e-01   +1.991588810760223e-01   +2.161887940739851e-01   +7.163349376844808e-02   +3.837930306013349e-01; +2.321923220415699e-01   +3.750201319333769e-02   +1.517011971815327e-01   +3.986138136597595e-01   +1.891531212926433e-01   +3.226340467254017e-01   +2.158219728526690e-01   +2.819217477191808e-01   +1.065733928825562e-01   +2.936544625747586e-01   +2.174281187951898e-01   +3.601828742906499e-01   +3.314858707309969e-01   +3.268438896271775e-01   -9.672822878435614e-04   +3.218810819243726e-01; +3.700318104515583e-01   +9.754346761878523e-02   +9.960762351351418e-02   +4.188080671162057e-01   +7.924765812883869e-02   +2.902317426172128e-01   +2.399793464741514e-01   +3.958125802110671e-01   +4.350994379677479e-02   +2.249774154197538e-01   +2.036018585229708e-01   +2.569243694937949e-01   +3.179738725702893e-01   +2.517968728245885e-01   +7.966068788216327e-03   +4.080721898030910e-01; +2.630255649007980e-01   +9.242775532887344e-03   +4.013068597333665e-01   +3.933834009870344e-01   +3.564901929212968e-01   +1.292858385190553e-01   +4.345906148735705e-02   +3.077131712629676e-01   +2.857342138295410e-01   +9.690199397437509e-02   +1.803892126418038e-01   +2.229484147890454e-01   +2.712877458543584e-01   +1.382729909018526e-01   +3.774144662033029e-01   +1.072584867281733e-01; +1.672697451581239e-01   +3.875023556378395e-01   +2.194457082231324e-01   +3.723178788570064e-01   +2.748929313522300e-01   +1.903314979517545e-01   +1.803708959861627e-01   +3.570224385333302e-02   +7.952315011431148e-02   +4.069183183533253e-01   +8.375472761878006e-02   +1.135011681472182e-01   +3.680575713360522e-01   +1.767746673712073e-01   +6.462109962098536e-02   +2.758778681047860e-01; +4.027389669013407e-01   +9.542498458760774e-02   +1.426303008355321e-01   +1.874516093488425e-01   +8.617032402554230e-02   +2.119374047524015e-01   +3.663419627977251e-01   +5.788401034019311e-02   +3.091995278679563e-01   +2.447625438892057e-01   +2.188604309607008e-01   +1.916466211619608e-01   +6.315448221527092e-02   +3.088141720206816e-01   +9.844740116912390e-02   +1.654470992421819e-01];
L1E_L1I_iGABA_netcon = [+3.422226656731982e-01   +3.870423556210600e-01   +7.928348379757273e-02   +9.066976254692806e-02   +4.242429359692775e-03   +3.540870100544623e-01   +2.465193377871061e-01   +3.761822927835575e-01   +5.880092477346722e-02   -3.722713219000467e-03   +7.661017209434515e-02   +2.297210756909213e-01   +2.722861547427289e-02   +9.395877961158007e-02   +9.051499516323874e-02   +1.668604045301323e-01; +2.838414925951892e-01   +2.334179410952071e-01   +4.750183502368948e-02   +2.700773436588388e-01   +2.801630343150263e-01   +3.159486235583726e-01   +1.185693749904749e-01   +3.477220724049017e-02   +4.013818984950908e-01   +4.813720256926919e-02   +3.688949125238301e-01   +1.519788223367177e-01   +1.370625283130379e-02   +3.604408929402578e-01   +3.549194877376817e-01   +1.774664788727939e-01; +4.107564588982740e-01   +2.921009006828608e-01   +3.737664466538727e-01   +3.732869035248293e-01   +3.727127263212465e-01   +9.353325039178284e-02   +1.529634645656142e-01   +9.267691504593470e-02   +2.946388524116401e-01   +3.341960600141222e-01   +6.250173288505013e-02   +2.334096539792254e-02   +3.544063518332393e-01   +2.954269217649608e-01   +1.021229058691297e-02   +2.063984394818935e-01; +2.671774797207945e-01   +2.225220495976811e-01   +3.490730886890938e-02   +2.686551662084742e-01   +1.626355701781066e-01   +3.302868481231310e-01   +8.926938121683357e-03   +1.813974749983087e-01   +2.288305175312192e-01   +1.703253326132775e-01   +2.503453439185072e-02   +3.524876105575743e-01   +6.117939831625174e-02   +2.624681616878097e-01   +2.703263213246340e-01   +2.739240282737325e-01; +2.119761704372585e-01   +2.830693269092848e-01   +3.444854320983645e-01   +3.031940039196004e-01   +5.034725118488978e-02   +2.116247232023214e-02   +4.812326532658315e-02   +3.630055881704622e-01   +3.750700841977974e-01   +3.762147220425507e-01   +2.573994113214140e-01   +1.844170132828171e-01   +2.526836377545558e-01   +2.272854712945388e-01   +2.114906921206207e-01   +2.363906149968668e-01; +2.224805751123845e-01   +2.146782787041583e-01   +5.496514401765559e-02   +1.509058159622400e-02   +3.043201971187726e-01   +2.532973793834924e-01   +1.406005222879046e-01   +4.086588778102364e-01   +4.040688266373728e-01   +2.545636046307992e-01   +7.023600464526414e-02   +1.196656187379217e-01   +3.806622544840270e-01   +3.367340546993035e-01   +1.720887882177986e-02   +1.673175319028292e-01; +3.940402425341658e-01   +3.526578924080767e-01   +1.505388642948685e-01   +3.119470895350395e-01   +2.654222074024098e-01   +4.797377886210899e-02   +2.020423922573625e-02   +3.577100530958197e-01   +3.204413400820922e-01   +4.284435614495469e-02   +3.485218926979642e-01   +9.347073657172046e-02   +6.289198693507385e-02   +1.342212472783716e-01   +3.276221527740296e-01   +3.966652822534536e-01; +1.595519832801166e-01   +3.983787056985068e-01   +2.193714855312552e-01   +2.845040262334518e-01   +3.884925328098190e-01   +1.373383018321668e-01   +1.739986276521283e-01   +1.616233551676093e-01   +2.890221297732412e-01   +7.204314581728556e-02   +9.885302030539081e-02   +4.019106292686743e-01   +8.055746472316581e-03   +3.429974666375057e-01   +9.011920105529840e-03   +1.581404594410842e-01; +3.391252345174893e-01   +2.134122579035722e-02   +3.821813240929332e-01   +8.715310526799437e-02   +4.021631445220564e-02   +6.003260688410304e-02   +3.904595872300006e-01   +2.577360810529640e-01   +3.724205960106509e-01   +3.936692803758277e-01   +1.643535713877970e-01   +3.540433096595629e-01   +2.398328887721923e-01   +1.577958137502501e-01   +2.868063364594269e-01   +1.436820416185263e-01; +7.204788458545458e-02   +2.758879065546035e-02   +2.102790405390703e-01   +3.566589392595302e-01   +2.849242337098075e-01   +3.890703587986506e-01   +2.708603028265905e-01   +3.336539782094178e-01   +1.388848629601161e-01   +3.947338679641283e-01   +1.422120555943203e-02   +1.571171854740524e-01   +7.256039390859273e-02   +1.819079090433225e-01   +3.494844230595650e-01   +2.406918659997285e-01; +9.614668251005787e-02   +7.733206570929703e-02   +4.097673763627380e-01   +3.757051406025001e-01   +1.029342014190722e-01   +2.777882854914970e-01   +2.844819569505931e-01   +3.628121403588292e-01   +1.435046677347976e-01   +1.078319354320034e-01   +3.812144502959330e-01   +1.622782418833222e-01   +3.445461627135537e-01   +3.300183471489747e-01   +1.358475982662288e-01   +4.095852315311360e-01; +3.427931745409756e-01   +6.079393247157348e-02   +3.826238393660141e-01   +1.033135483474119e-01   +1.410886271098865e-01   +3.632807584846687e-01   +3.494555325355803e-01   +1.091991904527765e-01   +2.648420323671302e-01   +4.045613900762245e-01   +1.701564688984272e-01   +2.501680790517696e-01   +2.970054726020603e-01   +2.122748786849830e-01   +1.376096082594425e-01   +5.666462835164258e-02; +1.310646567648817e-01   +2.075917229896364e-02   +1.576924177088213e-01   -2.654040853893318e-03   +3.260456852522273e-02   +2.590159147663653e-01   +1.696857650216771e-01   +9.341233129807151e-02   +2.445662862766843e-01   +2.828964650970438e-01   +4.656645790424023e-02   +3.488766732349591e-01   +1.134208157541218e-01   +1.332318886949608e-01   +1.375310013835658e-01   +2.352671296998562e-01; +3.318731390738323e-01   +2.535556260877566e-01   +3.765869932615586e-01   +1.869626543231088e-01   +4.044237493789268e-01   +2.331732208473995e-01   +2.463784842702950e-02   +2.089524802795231e-01   +1.793840453644861e-01   +4.126415918267728e-01   +1.130932776501840e-01   +9.515106259702544e-02   +8.784699513807583e-02   +1.392032188574547e-01   +1.015594558437233e-01   +2.921191046077630e-01; +3.226094158136331e-01   +1.102022559149125e-01   +2.230021843765302e-01   +1.303761604474132e-01   +2.280790310912632e-01   +7.734001893471711e-02   +3.576296593949072e-01   +2.082650322823399e-01   +1.039427920163420e-01   +5.004229606799120e-02   +2.733445535701995e-02   +3.413205515251624e-01   +8.608716239784966e-02   +3.694538454509197e-01   +2.398086040563732e-01   +4.051195742489452e-01; +6.491283612007136e-02   +1.259386123810147e-02   +2.642264762245666e-01   +1.062332916454787e-01   +1.662836708280081e-02   +2.497837772677497e-01   +1.801388871295962e-02   +7.695020055373918e-02   +1.818378825226388e-01   +2.474261788345383e-01   +1.792360177375500e-01   +5.818475069784007e-02   +2.051428989862237e-01   +2.993986878423139e-01   +2.604892807105225e-01   +2.377201408443554e-01];
L2I_L1I_iGABA_netcon = [+1.900344896032978e-01   +2.654319780050256e-01   +2.544221685952001e-01   +1.270993212345726e-01   +8.435415562231044e-02   +3.831138784821473e-01   +1.701122839439425e-02   +3.734058142745179e-01; +3.559179632634888e-01   +2.025882810465305e-01   +1.716761912088949e-01   +3.385576726109794e-01   +1.190590647115838e-01   +8.809038305682283e-02   +1.439947456031126e-01   +2.956316391259041e-01; +3.813773531704449e-01   +3.277213186322623e-02   +5.079311651854785e-02   +4.385198886393936e-02   +2.388111783162813e-02   +3.865443905067872e-01   +2.513296550970752e-01   +1.418223151180488e-01; +1.845445256534560e-01   +3.513838920278959e-01   +1.788168731825575e-01   +3.301879160465022e-01   +2.277591907613425e-01   +2.941664689157204e-01   +2.235188387670635e-01   +1.224364489426967e-01; +3.618484254128316e-02   +3.722379669384900e-01   +1.916861220259635e-01   +1.154970653700566e-01   +8.151483366318295e-02   +6.125971331835216e-02   +2.367198651659480e-01   +1.832963457225343e-01; +9.059812931657805e-02   +4.710414252781134e-03   +3.327665801629314e-01   +2.472695772883700e-01   +3.035223356476124e-01   +2.047412423512117e-02   +3.673549645710736e-01   +3.359088457130750e-01; +1.120271700886321e-01   +1.855966316064839e-01   +3.062819135877424e-01   +3.475346083099186e-01   +1.883710282356213e-01   +1.929156410969448e-02   +3.410347026549524e-01   +5.992867026032783e-03; +2.537534441994672e-01   +3.630763247958894e-01   +1.189858581047943e-01   +4.753775760887245e-02   +3.616686982016522e-02   +1.588116962942086e-02   +3.452039374595590e-01   +2.544486124014518e-02; +2.078290559739522e-01   +3.569918632272711e-01   +2.637033368266004e-01   +3.585299835171633e-01   +7.447688467647129e-02   +2.308907790359063e-01   +2.297728110894731e-02   +3.488248017233110e-01; +3.416678521721654e-01   +5.863796331470404e-02   +2.377338544962653e-01   +8.461517679003831e-02   +3.097271875323923e-01   +2.877961576022405e-01   +6.126000943120829e-02   +2.439413810756274e-01; +1.305075551751844e-01   +2.489272394922604e-01   +2.588750752096265e-01   +1.974347687692445e-01   +9.924640622787666e-02   +1.841201159030297e-01   +1.936555445324012e-01   +1.289287623675331e-01; +1.956376322953111e-01   +1.876049619163338e-01   +3.591391729287858e-01   +4.005495896126737e-02   +2.603243820374602e-01   +2.483108943677160e-01   +2.533512400999636e-01   +1.221564859359741e-01; +1.998168374655765e-01   +3.671975688523362e-01   +9.549037426196684e-02   +1.121921891751133e-01   +2.555293610854955e-01   +1.409896885710045e-01   +3.296059032784897e-01   +9.819874987159299e-02; +3.176487013865227e-01   +2.222475915984976e-01   +2.280441981391191e-01   +2.464310070341307e-01   +3.068035771192129e-03   +2.138655979221487e-01   +2.857121617863297e-01   +3.761020110526508e-01; +1.199645611353028e-01   +3.984448949037626e-02   +3.184121923962558e-01   +5.018595882009242e-02   +1.389892430480671e-01   +1.003607427978856e-01   +1.551793007416243e-01   +6.177375319008527e-02; +3.996500667956427e-01   +1.603736796972403e-01   +4.750087443640427e-02   +2.852599179803228e-01   +2.281791578910154e-01   +1.823719202649431e-02   +4.011206909007246e-01   +3.852333091500787e-01];
L1I_L2I_iGABA_netcon = [+2.967667311872314e-01   -1.561353691719458e-03   +2.488880718845082e-01   +4.172951840975719e-02   +3.179205140419568e-01   +3.264409831249523e-01   +1.853174267204077e-01   +8.429725272410578e-02   +4.710086507454329e-02   +1.971179277197908e-01   +2.656760786295060e-01   +3.449585319253281e-01   +2.592699421217262e-01   +2.098808253511612e-01   +3.433250153776886e-01   +1.570853658181371e-01; +1.623307113965202e-01   +1.447680066838140e-01   +2.423835140917969e-01   +3.969670187876045e-01   +1.774207247772097e-01   +4.045354028645791e-01   +7.790607550658527e-02   +4.988120715829092e-02   +4.013029245484350e-01   +4.099103102896592e-01   +3.593701083790514e-01   +2.727259038547133e-01   +2.914483957398425e-01   +2.275070952766264e-01   +3.736951795935276e-01   +3.783886941592573e-01; +3.076922622095418e-01   +1.804557059271857e-01   +3.366905300987904e-01   +2.427182548924024e-01   +3.651911686572988e-01   +3.194746104784792e-01   +3.839298490418588e-01   +2.360914907119443e-01   +3.489285213541539e-01   +6.254935922653673e-03   +3.873916476190783e-01   +1.485779715910941e-02   +1.025296136777863e-01   +1.992027996978850e-01   +1.814104057834119e-01   +3.795384108676130e-01; +1.445248474927306e-01   +1.882461300036907e-01   +1.874517973709084e-02   +4.556890135652471e-02   +4.058220344606543e-01   +2.353846968265029e-01   +2.432085829873358e-01   +2.335259882855293e-01   +1.308242459887603e-01   +1.593396603614495e-02   +5.547405589031455e-02   +5.857599810100067e-02   +9.621930364644687e-02   +3.673602178755634e-01   +5.662617764960562e-02   +1.881888747309710e-01; +3.550481666481248e-01   +5.781302466119539e-02   +4.894722042875727e-02   +7.898370635444786e-02   +2.869760851191114e-01   +5.470829733085270e-02   +3.406578875764195e-01   +1.043386660154459e-01   +1.230538396305920e-01   +1.625347769028693e-01   +1.994753442701690e-01   +2.238307841500723e-01   +1.751168057950602e-01   +3.359920536387611e-01   +2.383630899995154e-01   +3.643482247012536e-01; +2.238656778491868e-01   +1.655058409658808e-01   +2.856585541726893e-01   +3.369840297458706e-02   +2.732462605828355e-01   +1.522995976691971e-01   +3.030112127432552e-01   +6.216790216347307e-02   +2.034944974225623e-01   +3.008822732435514e-01   +5.928212829514214e-02   +1.998475760486645e-01   +5.375533044172054e-02   +3.604870519478819e-01   +1.324296685499496e-01   +1.287537070780633e-01; +3.069059529876076e-01   +5.266965049060613e-03   +2.181738939811347e-01   +1.436752102569046e-01   +1.258743954116753e-01   -1.370509747151761e-03   +2.339518540758390e-01   +3.674382000810427e-02   +1.598957862727048e-01   +2.827035192777630e-01   +2.405589689050096e-01   +2.666801005332218e-01   +9.006108736137322e-02   +1.197411713504908e-01   +1.977500079227636e-01   +3.725479373137626e-01; +3.139084028669628e-01   +2.875132198419227e-01   +8.371189585204813e-02   +2.118282335687271e-01   +4.140501797054259e-02   +4.056497602529163e-02   +3.819571308175721e-03   +3.417595934770831e-01   +3.109877120666805e-01   +3.849585098895684e-01   +2.490905900464876e-02   +3.090878933127323e-01   +8.390185895373421e-02   +3.000080008336219e-01   +2.401612747331557e-01   +1.022064882771445e-01];
L2E_L1E_iAMPA_netcon = [+2.933312834458265e-02   +8.915809123061053e-02   +3.310395884523283e-01   +1.778475585889260e-03   +9.751803795632097e-02   +8.278186839379804e-02   +2.903566047541765e-01   +3.886546042197195e-01; +3.996983996011445e-01   +1.302775726454295e-01   +2.068168063900678e-01   +1.955092325657564e-01   +2.844021393177005e-01   +3.681364107467943e-01   +1.854674446547776e-01   +1.501585338443367e-01; +5.994642372078440e-02   +1.731669726968778e-01   +3.633449320212338e-03   +3.505979683016321e-01   +2.355285158264365e-01   +7.000209216836267e-02   +2.750837245914154e-01   +3.333699343996930e-01; +3.463729218804362e-01   +1.949826042217287e-01   +3.445238922699513e-02   +2.330762389227775e-01   +2.326440814623985e-01   +2.370276191403666e-01   +1.763141652732330e-01   +1.527662529859460e-01; +1.807220015190608e-01   +2.327066179133215e-01   +2.233109125022402e-01   +1.931857757296315e-02   +2.504816127850822e-01   +2.943769103243367e-01   +3.917144815011651e-01   +3.471930477044972e-01; +2.972796234770605e-01   +3.138613749325701e-01   +2.136374180397595e-01   +2.453348767788445e-01   +7.627534335809690e-03   +3.316931476828793e-01   +2.002752523582667e-01   +4.002913213447669e-02; +3.677195471403221e-01   +6.375549210449163e-02   +2.502139203601917e-01   +9.827010178859362e-02   +1.476364138710413e-01   +1.649378460129383e-01   +1.946014776357514e-02   +8.374353303470793e-02; +1.851594991511250e-01   +5.027380293025596e-02   +1.050807686684266e-01   +3.373628944492700e-01   +1.753083302806848e-01   +1.391377271036040e-01   +2.513342052521429e-01   +5.104691431145743e-03; +1.728575251375998e-02   +6.076675492381384e-03   +2.016016829064343e-01   +1.188599941742996e-01   +2.803705863307980e-01   +2.005820733960924e-01   +1.566508179990904e-01   +8.245095754323743e-02; +1.163168981739292e-02   +1.408136540928099e-01   +7.411316536450555e-02   +1.909842573997321e-01   +2.850243549647510e-01   +1.768155768720936e-01   +1.692661856202346e-01   +3.515139939004098e-01; +2.339127689199466e-01   +1.883063424959920e-01   +3.101612156618190e-01   +2.648497937239432e-01   +1.999496890696130e-01   +1.239378458853584e-01   +1.101433651669420e-01   +6.703219532065173e-02; +2.281103754288475e-01   +2.680933233993513e-02   +6.177066665374443e-02   +1.019567002323268e-01   +1.800284405057323e-01   +1.251962106846011e-01   +1.555821505863431e-01   +1.502227833390452e-01; +1.697623152245460e-01   +2.463582735073296e-01   +3.898999662703171e-01   +3.891816010484235e-01   +2.753453562010738e-01   +6.971794733977400e-02   +2.966641682804846e-01   +2.220181524501113e-01; +9.099103294857502e-02   +2.039907429183319e-01   +1.446966828501668e-01   +1.499809735398567e-01   +1.385480087651389e-01   +1.316200384702710e-01   +3.584543343451559e-01   +1.523762610443950e-01; +2.337979584395642e-01   +3.490502203952685e-01   +9.932218450388862e-02   +3.889205465036062e-01   +2.009815826085669e-01   +2.650541006674041e-01   +6.583049626680725e-02   +3.408493080215476e-01; +4.720129995956769e-02   +4.091446106138852e-01   +2.254910380460267e-02   +3.678194815815606e-01   +3.024901600361271e-01   +1.655919949059176e-01   +1.104049559042877e-01   +2.316087338880888e-01];
L1E_L2E_iAMPA_netcon = [+7.439164862637557e-02   +3.342046691529506e-02   +1.096288954586649e-01   +2.881693998777471e-01   +6.993194821161842e-02   +3.895128162771382e-01   +3.356681380270478e-01   +9.934320869904369e-02   +3.486230804760566e-01   +2.606639571379624e-01   -1.607459795965585e-03   +3.305397314034212e-01   +4.445428753236302e-02   +3.756790603492645e-01   +1.208928220166784e-01   +3.884330648014398e-01; +1.677586635025378e-01   +8.627612922235492e-02   +5.807552035672373e-02   +2.658048325628820e-02   +7.227284920667716e-02   +3.008049824871585e-01   +2.275555250196371e-01   +1.718955350438386e-01   +3.138861986367356e-01   +1.370629440501807e-01   +5.828632675307338e-03   +2.775401371292649e-01   +2.594594012919376e-02   +1.669737460958529e-01   +1.787824208787148e-01   +1.690159211723778e-01; +2.628977167240558e-01   +2.515111660557100e-01   +1.836687222739806e-01   +1.660721413966340e-01   +2.226010846314858e-01   +1.642361449364976e-01   +3.023901312888156e-01   +4.099469027394949e-01   +3.650886292676088e-03   +3.510222821969711e-02   +1.843061454351032e-01   +3.253843880428138e-01   +6.938538328096835e-02   +1.618401051576815e-02   +2.594708472747158e-01   +1.732154146171615e-01; +1.060217922384985e-01   +1.983377177971827e-01   +3.604276109904976e-01   +2.234547909521724e-01   +2.006314230771051e-01   +2.723903816592158e-01   +3.805293590811638e-01   +8.680351914904286e-02   +1.468694794413164e-01   +1.309279437036304e-02   +3.327080958697069e-01   +1.727878645252403e-01   +1.006238827381940e-02   +2.226042420148019e-01   +4.098114554711596e-01   +4.025807974293391e-01; +2.262029928516786e-01   +3.753994916563005e-01   +2.049586527657372e-01   +8.746553433307437e-02   +1.829278233785669e-01   +3.389879424775112e-01   +1.860893627821180e-01   +2.813543751291558e-02   +3.413383235192290e-01   +1.728706557636824e-01   +8.969354563204267e-02   +3.809037644075267e-02   +3.774085324927829e-01   +2.775181812159053e-01   +3.135497843267456e-01   +1.928272902390603e-01; +2.045751127360876e-01   +3.033327799452596e-01   +1.410137476714838e-01   +2.730945911978421e-01   +2.861563789252121e-01   +6.949622180853891e-02   +9.812167532289408e-02   +1.113736667763132e-01   +1.418271717157586e-01   +3.747523661576410e-01   +2.628710710904043e-02   +3.085632134940088e-01   +3.229241358732061e-01   +1.538907161268153e-01   +3.061952985817779e-01   +1.625824459409112e-01; +1.989241894501245e-01   +1.998161522742343e-01   +2.622782523142364e-01   +1.552860910078565e-01   +2.195959403481838e-01   +5.388292782791478e-03   +2.544637116464186e-01   +3.336023194047023e-02   +1.438646821716358e-02   +1.857634525152432e-01   +3.397346904496921e-01   +1.529680888631665e-01   +2.385590121253378e-01   +5.455250575898345e-02   +9.016647617675283e-02   +3.532491311299013e-01; +2.551164155020560e-01   +7.903818486795869e-02   +2.871927707828320e-01   +2.435876971863140e-01   +1.685632073913690e-01   +1.469156777761526e-01   +3.307092489572464e-01   +3.226698420913966e-01   +9.378184252392051e-02   +3.139463736502252e-02   +3.219307215041416e-01   +9.962919855118399e-02   +3.149012767706210e-01   +3.103434205359320e-01   +3.592517220178044e-01   +9.883595462068180e-02];
L2I_L2E_iAMPA_netcon = [+2.503877413084675e-01   +4.903993972568860e-02   +3.234732349574145e-01   +2.550208299358351e-01   +2.957232354149644e-01   +3.755815906970806e-01   +1.518549670454504e-02   +5.508772107829188e-02; +3.037444974383140e-01   +1.364630705929892e-01   +4.105616938118494e-01   +3.668431563860799e-01   +1.836612574749434e-01   +1.370136549888735e-01   +1.222081994190449e-01   +2.546439174379561e-01; +3.941978431815322e-01   +3.840463849904777e-01   +1.557042018077527e-01   +5.532540104602704e-02   +2.758209869852231e-01   +3.206419482483086e-01   +3.422848661585341e-01   +3.545100048743225e-01; +7.516856698234839e-02   +6.503217053083138e-02   +1.907731830836675e-01   +1.889968071199108e-01   +2.033991611639629e-01   +2.148978998695353e-01   +3.846459095566707e-01   +1.779057640194305e-01; +3.820197502604282e-02   +2.610004799656487e-01   +1.910974772775892e-01   +1.663294578348625e-01   +3.495268243681932e-01   +3.944365951883562e-01   +2.979093711477306e-01   +2.636317011483195e-02; +2.399641668070082e-01   +2.872425720011157e-01   +9.219703304991966e-02   +3.583896913109306e-01   +1.620978385525509e-01   +2.188212218401320e-01   +2.632958714574326e-01   +2.833891748870144e-02; +3.924723648376814e-01   +1.393019617037230e-02   +3.175715215916624e-01   +4.915303042457147e-02   +1.687811274428198e-01   +2.454590546697993e-01   +5.391088261715792e-02   +3.719763667436118e-01; +5.045031861557653e-02   +2.692264210092802e-01   +1.556453678480983e-02   +1.111473106104902e-01   +2.831935922235588e-01   +3.470200561307898e-01   +1.922733065867851e-01   +2.541455474746123e-02];
L2E_L2I_iGABA_netcon = [+3.999841539843897e-01   +2.553701960180741e-01   +2.455728588048367e-01   +2.763166578962898e-01   +4.070267999924969e-02   +3.905902843421761e-01   +6.648465048814048e-02   +2.891620040386559e-01; +2.901570576110524e-01   +1.591279860375704e-01   +2.287734816777593e-01   +1.226663882328923e-01   +1.659428580519205e-01   +2.512943329082410e-01   +2.150253859036726e-01   +3.978089178957430e-01; +2.732394183159880e-01   +4.441217461379592e-02   +2.574162798096832e-01   +4.295429878427649e-02   +1.938232844890997e-01   +4.340347657074540e-02   +3.997561952788612e-01   +2.362371281512689e-02; +3.730005793807452e-01   +7.271262405264371e-02   +2.357814761202711e-01   +3.833965578774317e-01   -4.281653609406623e-03   +3.852250424240681e-01   +3.369082443744658e-02   +1.568398896856951e-01; +3.919540302515562e-01   +2.994588549023184e-01   +2.331251768537566e-01   +1.754894637359958e-01   +2.490933312364811e-01   +3.717834818666411e-01   +1.744019680034997e-01   +1.492450393822431e-01; +1.615778472565683e-01   +2.402775311427595e-01   +2.426902552919993e-01   +3.232572435116795e-01   +1.291299412693598e-02   +3.774519533219328e-01   +7.115519029038257e-02   +3.381927265925172e-01; +3.708611302000582e-01   +2.879941732613947e-01   +2.425624229801251e-01   +1.960353193643303e-01   +3.015710752673827e-01   +2.937599775570974e-01   +1.472112700482980e-01   +1.086179522799733e-01; +3.359468893941514e-01   +1.018282295020483e-02   +3.643063307279930e-01   +1.234049331110127e-01   +3.350113668843376e-01   +2.469174493700451e-01   +3.675691793692563e-01   +1.169483856701492e-01];
L3E_L2E_iAMPA_netcon = [+1.377019155802549e-01   +2.234923113711750e-01   +2.416768399109856e-01   +3.532313292954074e-01   +4.674231929356490e-02   +3.327162963895667e-01   +2.702711568773134e-01   +2.769123682052263e-02   +3.566368583025439e-01   +2.874366471009949e-01   +1.778649645076873e-01   +2.246424390709344e-01; +1.879159994027004e-01   +1.743213501950429e-01   +1.142376278072453e-01   +1.932244113004762e-01   +8.361149654793826e-02   +2.183276788320556e-01   +3.106676172294910e-01   +5.077492960855398e-02   +3.733820920708588e-01   +2.451404078054482e-01   +3.637950893668792e-01   +3.277465882415859e-01; +2.933781530883047e-01   +3.743826899324511e-01   +3.121600236479921e-01   +3.547386491352907e-01   +7.915741427508298e-02   +9.043904033695249e-02   +1.614263212608955e-01   +3.924781111592689e-01   +2.726529597607377e-01   +1.332831906230844e-01   +1.357941783915390e-01   +2.722276378289117e-01; +7.645346168850666e-03   +3.592385894942858e-02   +2.513730623708670e-01   +1.196106446340618e-01   +1.215007784888373e-01   +3.680636387986746e-01   +2.301459125584945e-01   +2.365693225040580e-01   +1.314234777326079e-01   +3.594983402783382e-01   +4.087424552838712e-01   +7.673845639158762e-02; +4.050616613608837e-01   +9.197923070636847e-02   +1.247667541838114e-01   +2.481584758822740e-01   +1.825341625353571e-01   +5.478103337017319e-02   +1.163862923299594e-01   +3.294128872337996e-01   +2.198937263597217e-01   +3.798964420846228e-01   +3.387295378638955e-01   +7.432277017686346e-02; +2.608273581451954e-01   +1.843926932158268e-01   +6.979913273811357e-02   +3.868184349296307e-01   +3.297268192455575e-01   +7.830908335717643e-02   +3.976043059483437e-01   +8.965332602562601e-02   +2.665092799162314e-01   +1.969666843482249e-01   +2.227193250956053e-01   +3.538803113242617e-01; +2.534690785771737e-01   +3.018765030268295e-01   +2.459933134966470e-01   +2.597593681064002e-01   +3.568106677806931e-01   +1.702459656255035e-02   +1.358550697978742e-02   +6.742151025122597e-02   +3.200990386869991e-01   +3.918692440655866e-02   +3.692599063563969e-01   +2.324149526356618e-01; +1.966859990470839e-02   +1.171646250363595e-01   +2.201981534893650e-01   +1.247147251588451e-02   +3.755785606277962e-01   +1.571437882965369e-01   +3.026296382065540e-01   +4.035116651451443e-01   +5.884260112268308e-02   +2.187752772237395e-01   +2.226816976873936e-01   +3.613697849484891e-01];
L3I_L2I_iGABA_netcon = [+3.022567869780620e-01   +1.753625560223904e-02   +7.110474797019784e-03   +2.204025993703787e-01   +1.609153834025937e-01   +8.464230178350955e-02   +2.920892276793556e-01   +3.218827269391331e-01   +3.471075189077421e-01   +3.001102037599667e-01   +2.501454534270388e-01   +9.473323023787757e-02; +1.857120244716351e-01   +3.405971292560920e-02   +2.533689979141860e-01   +1.653989886523897e-01   +1.661933835369328e-01   +1.234260690827651e-01   +1.971473570366972e-01   +2.554483305047872e-01   +2.124590164035121e-01   +3.645002051701711e-01   +9.391684306538241e-02   +3.212443965344366e-01; +3.977315066925818e-01   +8.124972193443988e-02   +2.345068138297662e-01   +2.879875558653125e-02   +2.404842607535678e-01   +2.234464509728976e-01   +2.151234679567907e-01   +5.028267772781421e-02   +2.045006354944907e-01   +6.193944200748184e-02   +2.669018181820250e-01   +1.014285198677550e-01; +8.619712189836237e-02   +1.493577154612478e-01   +1.824207552742170e-01   +3.755143826381359e-02   +1.202376334467954e-01   +3.194215677377966e-01   +1.658925187023760e-01   +3.059015456010069e-01   +3.065970361464261e-01   +2.257774680068416e-01   +1.536310984696015e-01   +2.435751339574386e-01; +3.943346222224738e-01   +4.029192474007037e-01   +3.127798244797289e-01   +7.443837747633697e-02   +2.154438980005225e-01   +2.944936785545428e-01   +2.267564337512429e-01   +3.259537925116653e-01   +4.070629796809941e-01   +1.136016952757237e-01   +9.971049465909076e-02   +6.386064421091536e-02; +3.718211733120659e-01   +4.027127049009981e-01   +7.634988882102514e-02   +2.458671999619253e-01   +8.970306226968894e-02   +1.587529410177095e-01   +3.147976012649863e-01   +2.782151575941870e-01   +6.895594611335811e-03   +1.074841560861409e-01   +6.271299151583408e-02   +1.668689077126417e-01; +3.299181126760171e-01   +1.997234213766453e-02   +3.511573714389813e-02   +4.420893893192379e-02   +4.697384264886661e-02   +5.701095792475783e-02   +3.165175234406123e-01   +3.318275293449616e-01   +2.701450223645879e-02   +2.996470389473760e-01   +1.369901589418412e-01   +2.933059033824699e-01; +1.375484994574521e-01   +3.341951431756180e-01   +2.604156165044110e-01   +2.839684660828286e-01   +2.285792866658423e-01   +1.239182019853972e-01   +3.780931854941909e-02   +3.575242853619211e-01   +3.945593327259322e-01   +2.729071638335864e-01   +7.654801341233140e-02   +4.769792347161249e-03];
L2E_L3E_iAMPA_netcon = [+6.572617242561890e-02   +1.726658684805231e-01   +1.740707276162412e-01   +3.059000960595639e-01   +2.411956955111835e-01   +9.223101480776544e-02   +1.607291784205054e-01   +2.534026736634223e-01; +3.938585154390338e-01   +3.804466211527973e-01   +3.514307847383477e-01   +8.221817854331823e-02   +2.591385334174329e-01   +1.103661688215291e-01   +2.235602838103446e-02   +5.960448244979463e-02; +2.844832584012457e-01   +2.550076200397909e-01   +1.684728443361333e-01   +3.125784307948144e-02   +2.443306749682297e-01   +2.886867788147946e-01   -4.435707592569055e-03   +5.656255864053856e-02; +2.717834006033317e-01   +3.705456876142703e-01   +3.810859491442706e-01   +2.638767943430437e-01   +9.356207423050157e-02   +2.819292746200409e-01   +1.953255009188239e-01   +1.750125923731006e-02; +1.543964001632731e-01   +1.069077108307661e-01   +3.043845273649221e-01   +3.817148736855920e-01   +3.573750088833414e-01   +1.636163721797879e-01   +2.428126154255945e-01   +3.634486119522565e-01; +3.025471567368122e-01   +3.249131374114280e-01   +3.679501108978540e-04   +2.375745621293405e-01   +2.389364320214979e-02   +1.725511565122832e-01   +7.165890877793986e-02   +2.429843523329518e-01; +2.918487760574294e-01   +3.766792880350885e-02   +1.093817041471488e-01   +3.129405140856960e-01   +5.384663681198870e-04   +2.601625930681338e-01   +2.950361716107028e-01   +1.649091219606580e-01; +2.546644669765126e-01   +1.604705243215812e-01   +1.820817306671842e-01   +3.676135774569853e-01   +2.623312107858669e-02   +1.264290129558254e-01   +1.532721534517178e-01   +3.008179569636505e-01; +1.422008794249503e-02   +7.500813200930008e-02   +2.314869616490720e-01   +3.430820571797418e-01   +1.474278347086403e-01   +2.647363503413534e-01   +1.110998561921996e-01   +1.703793496934524e-01; +9.162946696355402e-02   +5.454682723297761e-02   +3.666444786759563e-01   +1.880643862454854e-01   +3.547515018068035e-01   +5.592773980076318e-02   +3.669324681141629e-01   +7.429877025351297e-02; +5.481168893743204e-02   +1.886455691537315e-01   +1.768263721113719e-01   +2.168086223067591e-01   +1.602436457863420e-02   +2.595431774748903e-01   +1.907079666917931e-02   +3.189626030671347e-01; +3.349755165170695e-01   +6.431565834269130e-02   +3.250465026749107e-02   +3.998974909419752e-02   +2.116263480369792e-01   +7.712300265505312e-02   +3.370238980514167e-01   +1.949090930336877e-01];
L2I_L3I_iGABA_netcon = [+1.051095654799348e-01   +1.224341173497038e-01   +1.324767630424361e-01   +8.389527055636596e-02   +3.732970317105251e-01   +2.701785691875634e-01   +3.252346616112553e-02   +1.385481944581694e-01; +2.828926745057699e-01   +1.798257016037434e-02   +9.480347770377259e-02   +2.168810306047698e-01   +3.871210612801703e-01   +2.618842483856600e-01   +2.103054515256856e-01   +3.453544613369280e-01; +3.772399929797861e-02   +2.707322443140732e-01   +3.856835834842898e-01   +1.999909241128379e-01   +3.987446611671585e-01   +9.077994409365173e-02   +7.088012506790864e-02   +2.204223330085999e-01; +2.977209368829306e-01   +2.495569708398671e-01   +1.823837503269177e-01   +1.226342246608014e-01   +4.011043119456149e-01   +3.326226696844974e-01   +1.567481334410944e-01   +2.790959834314727e-01; +2.410678284396321e-01   +3.013067522571269e-01   +2.464497384313036e-01   +6.038883975288272e-02   +2.439045552104816e-01   +2.846339282100488e-01   +3.364493053571113e-01   +2.963967371999942e-01; +1.244419867717845e-01   +9.399479469669605e-02   +1.919933633189309e-02   +3.040876523630753e-01   +8.390669470748582e-02   +3.934314337946226e-01   +2.916842907178531e-01   +4.139729056863487e-01; +2.338680356480986e-02   +8.689784736539743e-02   +9.116040981442054e-02   +3.066803786126175e-01   +3.427759788474735e-02   +1.241144126968188e-01   +1.567118994770255e-01   +4.488479839482148e-02; +2.066182912439971e-01   +1.443505105489883e-01   +3.569909748063433e-01   +1.839807941320878e-01   +1.930798379013571e-01   +7.908532641137314e-02   +3.643544487031958e-01   +3.697592714799575e-01; +3.509919156378759e-01   +3.585160989748839e-01   +3.443825351661217e-01   +2.787544204985931e-01   +2.021383867680761e-02   +3.539702394503005e-01   +1.588246676070331e-01   +2.116423871817674e-01; +3.476261235663040e-01   +1.928767896103760e-01   +4.742791853466422e-03   +1.540728739933572e-01   +3.304941220187899e-01   +3.622311634896372e-01   +2.033234943413232e-01   +3.838754112337502e-01; +2.485217908659047e-01   +4.055672863226502e-01   +3.378992012607913e-01   +3.096953097283844e-01   +6.324819155322887e-02   +3.544325850864394e-01   +1.868932400529929e-01   +3.765769969001035e-01; +2.406293973408254e-01   +3.191163568055275e-01   +1.389397874995074e-01   +3.226967485399705e-01   +3.772860736147243e-01   +7.088345098924183e-02   +1.394706451282710e-01   +5.659510022406188e-02];
L3I_L3E_iAMPA_netcon = [+3.288485140327062e-01   +4.152648575754062e-01   +2.577580380848423e-01   +2.207620141204809e-01   +9.982897478681825e-02   +3.122422964733670e-01   +1.689999601809552e-01   +1.971676145685977e-02   +9.530268844809406e-02   +1.045898096850048e-01   +3.796958005606261e-01   +2.814848272628814e-01; +1.159376203794594e-01   +3.507130521961754e-02   +3.844204058237186e-01   +2.171464887785345e-01   +2.794424854982583e-01   +2.093738949489032e-01   +3.193983026793384e-02   +3.783922146837333e-01   +5.127293136647702e-02   +9.577962449658897e-02   +2.082964510651451e-01   +1.259990335301166e-01; +3.791659680453819e-01   +1.631260187245255e-01   +3.883491513788280e-01   +1.321785910551642e-01   +6.710366487717841e-02   +2.672171303564591e-01   +2.355924865466406e-01   +1.815362352419164e-01   +1.123992519781744e-01   +2.575147382854287e-01   +2.754289804474831e-02   +3.014491354239494e-01; +2.523751719284456e-01   +3.010135756080648e-01   +2.001926733539836e-01   +3.667145831784295e-01   +3.814408502154258e-01   +6.912162732157691e-02   +2.873797290113999e-01   +3.021818657222373e-01   +3.798210603091816e-01   +2.313223099019316e-01   +2.614081082409511e-02   +2.605356585186852e-01; +2.869895179759233e-01   +8.161547519139208e-02   +3.010179785385247e-01   +4.074109833287882e-01   +3.435611776757277e-01   +7.572447957393025e-02   +3.139830579044525e-01   +1.357521322685776e-01   +2.039743869819149e-01   +3.210840778992886e-01   +1.622891497312135e-01   +1.376038082222587e-03; +3.351246533166715e-01   +2.280320362598735e-01   +4.084584949682962e-01   +6.043190689878108e-02   +7.836024328608997e-02   -9.661615149413137e-04   +2.834940008562051e-02   +1.950308392843978e-02   +3.430871321415276e-01   +4.011153248715099e-01   +2.964882860190234e-01   +2.890626979651872e-01; +2.904482116192763e-01   +1.974653776084597e-01   +3.140177996997286e-01   +3.848603274826990e-01   +1.573417549883165e-01   +2.619820854264955e-01   +2.098280930945356e-01   +2.089622331628952e-01   +2.702355039338594e-01   +2.309761596417964e-01   +3.875838438290886e-01   +1.616351157060244e-01; +2.931161584632963e-01   +2.827742079696757e-01   +1.182488305994810e-01   +3.499270492134107e-01   +1.394670422907049e-01   +3.647707626810388e-01   +2.199780595624579e-01   +3.124967599512694e-01   +3.517462291820298e-01   +4.049123054623228e-01   +7.783474356668231e-02   +1.095704696403981e-01; +4.821106406317496e-02   +2.693536171110427e-01   +2.102908471179170e-01   +3.792488996989809e-01   +1.600754923860931e-01   +1.422364426084609e-01   +2.523719112114220e-01   +3.001799000863235e-01   +2.133169439255423e-01   +8.679854745237789e-03   +3.458003231507676e-01   +3.527001040495556e-01; +3.090198051531266e-01   +1.210533273313693e-01   +8.460606614874092e-02   +1.535416899690612e-01   +2.705435978315170e-01   +7.820091487552416e-02   +5.843484381712569e-02   +1.117465145981945e-01   +1.058231284496664e-01   +6.556455447884899e-02   +5.375072324216740e-02   +2.600396830660167e-01; +1.746488845635550e-01   +2.591616707638107e-01   +4.029084649228531e-01   +2.775093811044751e-02   +2.436449930261070e-01   +1.130337415768981e-01   +3.557993287554203e-01   +7.261497976144604e-02   +3.992500799525485e-01   +1.387635740778692e-01   +1.295641178665494e-01   +3.700323188774562e-01; +3.728875099173465e-01   +1.954057607493094e-01   +1.836133789387466e-02   +2.000778263124051e-01   +6.273658036737866e-03   +2.144853643473813e-01   +4.064253099182229e-01   +2.618222181400257e-01   +2.050314049600089e-01   +3.036253618977705e-01   +3.750812013383175e-01   +2.542262571065917e-01];
L3E_L3I_iGABA_netcon = [+1.823181385037417e-01   +1.578973045810430e-01   +3.276725804291687e-01   +9.205193038505859e-02   +5.428208990150248e-03   +3.060589883644008e-01   +3.930478378560885e-01   +3.695623423901678e-01   +3.565437317095085e-01   +2.278095039593581e-01   +1.896599492212291e-01   +2.938057496863190e-01; +3.054711141020320e-02   +8.258108557012042e-02   +9.021497784699455e-02   +1.645985568713314e-01   +2.584819899684855e-01   +2.945134545382914e-01   +3.621480091831228e-01   +3.392689661852179e-01   +7.266073901508459e-02   +3.567602653142258e-01   +3.639610456272380e-02   +3.797288956867722e-01; +1.167377238277871e-02   +1.586048698021907e-01   +2.842685377641719e-01   +2.809073311027166e-01   +2.237013434331873e-01   +1.576715505393264e-01   +3.729022617149295e-02   +5.574047350619944e-02   +1.803557768770073e-02   +4.140565223412717e-02   +6.930039286902406e-02   +1.284207686967918e-01; +3.746795173078171e-01   +2.165415320109803e-01   +3.321585207992917e-01   +4.054114769203154e-01   +6.400126708936478e-03   +2.207874029330235e-01   +1.444905550870167e-01   +3.981822350053267e-01   +7.413382715048028e-02   +2.636502067272014e-02   +3.414424786173217e-01   +3.578140851305383e-01; +9.522638533059774e-02   +4.195150858489771e-02   +6.717078501402909e-02   +5.550834743569763e-02   +2.067190890251018e-01   +6.138352620246442e-02   +2.810617861049134e-01   +1.673162035953666e-01   +3.603994493011063e-01   +3.891388368139784e-01   +3.843946292419885e-02   +1.407667516629925e-01; +2.965164808004962e-02   +2.942611518771499e-01   +2.647280838717374e-01   +3.394050844719034e-01   +2.622493133778584e-01   +3.910115842367480e-01   +3.399124886108447e-01   +9.092292631082172e-02   +3.343183722397793e-01   +6.847105380514762e-02   +1.140418355016253e-02   +2.835890484125443e-01; +1.264107600989531e-01   +1.589702009699416e-01   +3.203261538616376e-01   +1.623620903187765e-01   +3.594906860214899e-01   +2.509620225067715e-01   +2.665197130034948e-01   +2.933078795556407e-01   +3.319362240768244e-01   +1.184794819415355e-01   +3.181538979884604e-01   +1.598527967306635e-01; +3.474514288493973e-01   +1.302577710889216e-01   +1.796121377463205e-01   +1.131898826046572e-01   +3.452061063204108e-03   +3.831845494426019e-01   +2.481879192130178e-01   +2.428474545876604e-01   +2.985084433553267e-01   +9.899566389580802e-02   +3.831724341517602e-01   +1.515030217124296e-01; +7.540007021086118e-02   +8.270553977556327e-02   +3.737451730947675e-01   +1.404782560046287e-02   +2.642569379211863e-01   +2.881830023229258e-01   +1.613446054069042e-01   +3.056947407201805e-01   +3.888085743875825e-01   +3.539309865025091e-02   +2.687576866276568e-01   +1.854003303295260e-01; +2.703696163970788e-01   +9.563320005453886e-02   +3.056197978211104e-01   +2.717779356098361e-01   +1.734802756775661e-01   +1.535212058672716e-01   +2.987849775875664e-01   +3.085095444564441e-02   +3.653621976183442e-02   +2.208600467935767e-01   +2.828274747954526e-01   +3.046031297014940e-01; +1.107578648315250e-01   +2.434351309427359e-01   +3.535579251340736e-01   +1.728278758812176e-01   +3.903236151428682e-01   +3.700445483216975e-01   +2.370872760008219e-01   +3.491931523326590e-01   +1.948064605874112e-01   +4.430645647145535e-02   +3.242725471012274e-01   +2.294687572928414e-01; +3.509056009540671e-01   +2.433617708865875e-01   +1.805944085623903e-01   +6.242180060393059e-02   +2.879839021657917e-01   +7.515399421971712e-02   +3.878957071718595e-01   +6.246383426323787e-02   +2.921407999737452e-01   +1.907680245791207e-01   +6.726989370165946e-02   +3.003438593848103e-01];
L2E_Input1_iAMPA_netcon = [+2.296738700749279e-01   +2.505598262159783e-01   +3.456788075076770e-01   +2.482056337966559e-01   +1.477690820596987e-01   +3.631584946508814e-01   +3.072888883846001e-01   +2.260554746381227e-01];
L2I_Input2_iAMPA_netcon = [+1.541994982210705e-01   +1.411683492309525e-01   +1.301523329436831e-01   +1.954303311522021e-01   +3.181147323159071e-01   +5.412914299555972e-02   +2.198496800640033e-01   +1.144844409634704e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
