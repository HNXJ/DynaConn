function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.019558640271100e-02   -1.076912508987926e-01   -1.794646624381337e-02   +8.195813712264785e-02   +5.885114436149180e-02   -3.459628379450672e-03   +1.201889301768434e-01   -8.540852063878475e-02   -1.391705630023815e-02   -6.064332655537387e-02   -1.599044977149189e-03   +1.348421298063113e-02   -2.545656849555861e-02   +9.672628124789337e-02   +4.512312995728928e-02   +7.199166304480982e-02; -4.065609303398547e-03   -1.731902433952189e-02   -2.154887662547057e-02   +4.786427675666514e-02   +1.681587487002316e-02   -6.563494321375228e-02   +2.508802943763429e-02   +6.616936107797589e-02   +5.158839491007840e-02   -5.286871923785721e-02   +2.188959137101536e-02   +6.178497428409085e-02   -5.073649066275886e-02   +7.998410591957768e-02   +9.319350508701268e-02   +6.355323008905402e-02; +6.747877108805718e-02   +1.126068659297180e-01   +6.279726270773077e-03   +1.736801954921458e-04   +3.185004934954577e-02   -1.299780649425244e-02   +3.042798540352804e-03   -5.233749835747609e-02   -3.666461453636195e-02   +1.344276757549040e-02   +1.852220476594690e-03   -2.145814352588580e-02   +3.716915074472577e-02   +3.555057509380913e-02   +5.067206633101631e-02   -3.697477332440947e-02; -4.687664192454054e-02   -1.146604668059865e-02   +9.552447193206248e-04   +6.346469806238524e-02   -2.734068811070210e-02   +9.783639431169738e-02   +5.403937415791186e-02   -5.677656024441179e-02   +6.939861540499034e-02   +3.872028420431739e-02   +5.527660748740434e-02   +5.054881570268219e-02   -4.336219714273358e-02   +5.905651376817073e-02   +3.944764418856772e-03   +3.497684737471043e-02; -2.474181246366147e-02   +8.979550398246061e-02   -7.270715157129299e-03   -5.738207286940984e-03   -1.242386055722793e-02   -6.427872818853814e-02   -1.758808027808736e-02   -6.348160714538358e-03   -3.364254998716589e-03   -6.176995016032925e-02   +7.343609914609869e-02   -1.920959138897343e-02   -3.906721337277916e-02   -5.276624332952724e-02   +2.576066484117594e-02   +1.094113909860513e-02; +2.749605401662514e-02   -4.558796673414330e-02   +2.167531860671785e-02   +4.908736929385236e-02   +1.151180837087578e-01   +9.150149213004863e-02   -7.025269668696524e-02   +5.670773206948621e-02   -9.059196443170218e-03   -3.353503593852693e-02   +2.161446038502604e-02   +3.295249317555313e-02   -5.223678622644777e-02   -3.513531265287166e-02   -7.838376249285500e-02   +9.410294737545664e-02; +1.533166936738383e-01   -7.491941899334709e-03   +5.307618646233396e-02   -5.276949948962415e-03   -1.239967955450631e-02   +8.178023411103831e-02   +7.466682176298839e-02   -8.248005895317420e-02   +7.092128683713635e-02   +8.340690510126683e-02   +4.819133110144740e-02   +5.987706203596880e-02   +7.541475543788960e-02   -4.226841522622150e-02   +9.413241991301825e-02   -2.989544429374555e-02; +6.352631052973483e-02   +2.791174860802776e-02   +7.462740521780925e-02   +1.768156126313912e-02   +8.874045678677242e-02   +1.682275617695872e-02   +1.897281083539026e-02   +1.145480834692711e-01   +8.170911380233659e-02   +2.288367242411082e-02   -1.120937983443059e-01   +3.850798293998368e-02   -4.203349274721753e-02   +1.052785127595027e-01   -6.463714536683464e-02   -1.519748120352076e-02; +9.705176899320187e-03   +3.915318241129709e-02   +1.192463531801545e-02   +2.731096817863039e-02   +1.306391232289980e-02   +2.049885962348355e-03   +2.596660253472975e-02   +3.033134305531341e-02   +4.790385808619063e-02   +9.964639390810371e-03   +1.150226307090959e-01   +8.636205039097286e-02   +1.453612433510230e-02   +5.321802022151095e-02   -9.371784385977069e-02   +1.046639750328572e-02; -6.442828263440215e-02   -4.114709030178640e-02   +6.723637275057739e-02   -9.380652258194630e-02   -4.578803074005841e-02   -7.011970534864560e-02   -4.760868328202113e-03   +2.884016014241253e-02   -5.560725363975105e-02   +7.977376686583590e-02   +1.154211190366261e-01   +8.101887228937370e-02   -1.109085391042671e-01   +3.384259858821691e-02   +1.177018297718053e-01   +4.115044952628219e-02; +6.472514884639859e-02   +1.033096600578269e-01   -8.327194759039466e-03   -2.774868959787542e-02   +9.939840962893642e-02   +5.392543864291794e-02   +1.489399549089439e-01   +4.767037846393828e-02   +5.987640462277559e-02   -1.694859557070544e-02   +6.484135155697060e-02   +9.773471339272595e-02   +3.995143344098000e-02   +1.374375791908951e-02   -6.110691648043801e-03   +2.089146656320906e-03; +7.677909502205973e-02   +5.324174080712345e-02   -3.159358685896552e-02   +3.246295182593092e-02   -2.583351031720362e-03   +7.864624391703193e-02   +4.890751905259956e-02   +1.493890593865203e-02   -3.884888261078893e-02   +1.087454732799323e-02   -1.588494879101290e-02   -4.631673053876004e-02   -1.451234543510766e-02   +1.900412102016564e-02   +5.131896179263978e-02   +1.235733212848122e-01; +1.034524102938089e-01   +4.358097270361739e-02   -1.194466799072944e-02   -4.841077371575297e-03   -4.216140670231674e-02   -2.932680992573619e-02   +1.156056741953110e-01   +1.511491564451299e-02   +9.232477046141066e-02   +2.630612795742332e-02   -5.564651624864566e-02   -1.344901139003406e-02   +8.502340775393814e-03   -4.061350420754077e-02   +9.728152774884463e-02   +7.980417651384127e-02; +6.792858469748810e-02   -2.175974479526605e-02   -6.598146489376368e-02   -4.439992126496541e-02   +2.649573151974210e-02   +5.845290665197861e-02   +9.384721978450107e-02   +6.505468930532995e-02   -5.013725268542817e-02   +3.442379862404150e-02   +3.865748949661302e-02   -3.092295151055829e-02   -1.188606464519754e-01   -4.851670668452228e-02   +3.078101486662313e-02   +1.251536349850978e-01; +2.021056694918189e-02   +1.848437624857298e-02   +3.414428820473147e-02   +1.214217886197778e-01   +5.928975421304628e-02   +2.280980854246749e-02   +1.965528181205232e-03   +4.878206071081936e-02   -8.717444067854453e-02   +9.944976807730935e-03   +4.751673079118410e-02   +9.259615905606128e-02   -9.179605019787754e-02   +5.282095667790011e-02   +4.060410309150689e-02   +2.477000192958422e-02; +5.948911129615341e-02   +2.756766589064578e-02   +6.988988432746457e-02   +1.271956878874611e-01   +5.601048686826975e-02   +6.813159277589365e-02   +8.850952473685231e-02   -2.430219632277806e-02   -7.712478250646740e-03   -3.775923913743025e-02   -4.896812593999221e-02   +5.337045007732673e-02   -2.679678372457472e-02   -4.626381016874941e-02   +1.190205140384960e-03   +3.931362533761112e-02];
L1E_L1I_iGABA_netcon = [-9.131151939415781e-02   +3.106694332719308e-02   +5.828983550041325e-02   +6.602558268015363e-02   -3.480888186017021e-02   +9.591893050851071e-02   +4.398820930467771e-02   +6.824573303733403e-02   -6.027134547030185e-02   +4.982609408346370e-02   -3.804633974787036e-02   -3.560428708004549e-02   +1.374208473283870e-01   +7.925470573515139e-02   +2.697477211299656e-02   +2.779287645565386e-02; +9.938110991356383e-02   -7.546374695550644e-02   +1.021270395379630e-02   -2.588780704127463e-02   -3.628857358161948e-02   -2.579567991819751e-02   +1.292889878551606e-01   +6.996685149253590e-02   +8.201504236437547e-02   +2.029293135377775e-02   -3.011683012757552e-02   -1.440497516581474e-02   +1.564853513263669e-02   -2.872985078829458e-02   +7.260660386519149e-02   +2.687070645517039e-03; +9.963412752444417e-03   +3.752559444327334e-02   +1.915429229375044e-02   +3.734341124205905e-03   -4.295184019743621e-02   +6.774546835660797e-02   -3.710966670044107e-02   +2.996230583756176e-02   +1.456959810244886e-02   -2.478810261511197e-02   -5.714390386276601e-03   +1.623628342652048e-01   +1.054261602843556e-01   +5.087017257596920e-03   -4.104685020464113e-02   +7.241477963615600e-03; +1.046691970620794e-01   -3.153821498919135e-02   +4.501603527283646e-02   -5.789500418519297e-02   +6.235588781029489e-02   +2.073684623742762e-02   -1.930428049866965e-02   +6.179145700599012e-02   +5.994457837230258e-02   -1.406258597366337e-03   +2.962131794716524e-02   -1.010704991122461e-01   -2.564582182029763e-02   +7.068668662732017e-02   +6.025889273175113e-02   +2.972260764024831e-02; +7.942982076049376e-03   +3.806383455628792e-02   +2.352514697227794e-02   +2.178720876051046e-02   +4.936662664724223e-02   -3.565115605297652e-02   +3.868976492181418e-02   -1.899835198049568e-02   +2.918101616211760e-02   -5.612663369378893e-02   -4.860222074428456e-02   -3.328770381354013e-02   +9.361555750462923e-02   +1.093487479134772e-02   +4.110379775678171e-02   -5.662495167341232e-02; +3.233591253166611e-03   -3.434919792287709e-02   +6.821372829109032e-02   -9.074358810527029e-02   +8.882140527328962e-03   +3.877649674124621e-03   +4.896927091699253e-02   -1.093589314693409e-02   +3.807377675719441e-02   -7.173502215589463e-02   -1.276187621967535e-02   +1.368176273991836e-02   +6.396672242009030e-03   +2.296006089460814e-02   -1.895925112217037e-02   +6.512785364937701e-02; +2.728381887010465e-02   +7.247149600831362e-02   -2.142360378288460e-02   +4.296228149925487e-02   +9.755277027712866e-02   -4.882353139755526e-02   +5.142552640001761e-02   -5.717243385567236e-02   -4.678456225005093e-02   +8.580656092153252e-02   -4.825518725763381e-02   -5.869574074375082e-02   +6.319464665782305e-02   -1.037401729924563e-02   +7.648279305922323e-03   +8.265247629377616e-03; +3.687456394049309e-02   +5.955603227575171e-04   +3.182877834295961e-02   -9.007052053903411e-03   -1.022284385258584e-02   +4.677050146655913e-02   +1.786800512210055e-01   +7.266230878496822e-03   -2.859121108301197e-03   +2.521831992232352e-02   +1.654354763807089e-02   +2.150835012280613e-02   -1.977202031606312e-03   -2.741932644712351e-02   -6.556558682742974e-03   -3.247819877524150e-02; -2.010170819682658e-02   -6.361870350298425e-02   -1.812988640240249e-02   +6.895560480811704e-02   -8.182368612180959e-03   -1.073733407108537e-02   +6.526727109674654e-02   +1.620271417044671e-02   +9.579802250276677e-02   -2.955676934182186e-02   +1.528334839315516e-03   -3.337487913597499e-02   +9.749147152470847e-02   +1.014368618300371e-01   +7.327418390397011e-02   +7.070484925099924e-02; -8.234911258040289e-02   -7.594414417306274e-03   +5.866898892327472e-02   +8.216389583325515e-02   -1.762271978625779e-02   +2.266107395998362e-03   -4.790519320538459e-02   +3.679213137381122e-02   -4.860039259502318e-02   +5.605549327730337e-02   +8.196568322352374e-02   +9.222700354849555e-03   +3.956646657709799e-02   -6.063665092249982e-02   +3.736701765655571e-02   +3.127471486416203e-02; +3.014487968735569e-02   -5.025468190646794e-02   -4.509036608889134e-02   -3.762296000880888e-02   -1.469140086778442e-02   +1.125227514124280e-02   -2.280265120603864e-02   +4.198176821770289e-03   +4.841996364739019e-02   -4.129700212522474e-02   +1.009233258610021e-01   +3.637034049984845e-02   +1.875310976704218e-02   +1.786145168245334e-02   +1.008688747852057e-01   -4.916396665601662e-02; -3.796037993068638e-02   -6.089208247946636e-03   -2.261434860426971e-02   +5.149474918155728e-02   -4.353412588199947e-02   +1.111311790654457e-01   -2.154892028911995e-02   -5.232206543595429e-03   -3.111267681472806e-02   +3.484803046777759e-02   +3.123071842031230e-02   -1.654142022147252e-02   +7.278278871795828e-02   +9.315608929216265e-02   -2.845342165179213e-02   +3.214381803907905e-02; +4.091686533644175e-02   +1.415018871263803e-02   -2.765112354703692e-02   -5.492426528305952e-02   +5.925986786446670e-02   +5.648090353670818e-02   +3.856023619399208e-02   +1.132728834964947e-01   +8.913139309013375e-02   -7.488410458064679e-02   +8.702931793635613e-03   +7.922019036294956e-02   +2.704831245947909e-02   +5.414957517391183e-02   -1.198964395633405e-02   -4.442639587724313e-02; +1.478559461608271e-01   +3.649815477963620e-02   +1.577588958596289e-02   -1.477724527994259e-02   -5.424100382884855e-03   +3.029761903068634e-02   +7.872816388734771e-02   -2.796813782661028e-02   -3.510361942305784e-02   -3.526102591951754e-02   -1.510321090306107e-02   -4.694414018835275e-02   +4.576325230820614e-02   -8.687668036726306e-02   +1.920868186739596e-03   +3.628923917093332e-02; -1.162288709197336e-02   -3.052154619113037e-02   +5.972940967057755e-02   -7.989556561972505e-02   -1.305213341929273e-02   +2.719267413327947e-02   +2.099684395286487e-02   +5.399794446520981e-02   +1.782010386706377e-02   +7.128818370690362e-02   +1.221904749976022e-02   +6.258764021323340e-02   +9.284795620858530e-02   -1.744784080878664e-03   +5.189894536489803e-02   +1.485119711979603e-02; -6.147664575303013e-02   +2.121019033303169e-02   +5.007012625624999e-02   -2.914403926844270e-02   +2.032591890937331e-02   +1.218084119027660e-01   +6.068578405158968e-02   +3.221170730398296e-04   +2.324718176823621e-02   +7.419719993827099e-02   +8.216761279958205e-03   +3.205719426608934e-02   +6.554281796686233e-04   -3.412268831672732e-02   +8.230399603103380e-02   -9.629625706375475e-03];
L2I_L1I_iGABA_netcon = [+8.663437615236655e-02   +6.591838152790848e-02   +1.159351987901207e-01   +6.964226651124329e-02   -7.031406226583706e-02   -6.586270221245219e-02   +2.561534591520925e-02   +1.089452577655923e-01; +9.620953182088696e-02   +2.269636136723182e-02   +6.674422421264992e-02   -1.127118017822649e-01   +9.022048179214644e-02   +8.498854085536960e-02   +4.620853470432749e-02   +6.683774129612520e-02; -3.038162893144170e-02   -1.012860791919393e-02   -4.572120894507774e-02   +5.197982856097391e-02   +1.344082277422012e-03   +2.582445854443127e-02   +4.202825874909318e-02   -1.122929074737053e-02; +1.596866099761807e-02   -3.127654187647855e-02   +3.742116366764415e-02   -3.081967345104426e-02   -2.396222462917503e-02   +8.207932462989066e-02   +5.020341871706736e-02   +1.234512004373768e-01; -3.036921696044130e-02   -4.008488600462809e-03   +8.508092954495282e-02   -3.149903155838814e-02   -9.938360537049268e-02   +1.420372629831256e-02   -1.221600755861828e-02   +3.842248337977713e-02; -2.520761521320800e-02   +1.049842373853418e-02   +6.283634603040938e-02   +6.103580575677461e-02   +6.298792434308172e-02   +5.225913242330651e-02   -3.746178333316943e-02   -1.438372356767848e-02; +8.511384640489092e-02   +1.416285769923046e-02   -1.759809297421561e-03   +6.927558172761538e-03   +1.226190171101394e-01   +6.615441200948460e-02   +4.541408825534725e-02   +3.672592645590994e-03; +7.367966442461514e-02   -2.318912155461596e-03   +5.133809435912381e-02   +1.027575417192881e-01   +7.857389335493642e-02   +4.720894527720025e-02   +9.368348218814146e-02   +4.375929543579994e-02; -4.842250463879932e-02   +6.799504105709953e-03   +4.957274069774791e-02   -4.427185288271997e-02   +5.395219321426961e-02   -4.107895676220056e-02   +4.763047158755549e-02   +1.151583724877599e-01; +6.886081582070722e-02   +2.229367761099302e-02   +3.770481940311193e-03   +8.719731940005705e-02   +4.661318460552118e-02   +2.180641579234203e-02   -1.553144852441674e-02   +4.269324620884320e-02; +3.248566208516435e-02   -3.089232420476900e-02   -1.618496300479113e-02   +7.265282716998689e-02   +2.435623682786116e-02   -5.526795605541809e-02   +4.923556502068303e-02   +8.450482378891498e-02; +7.886018856888921e-02   +8.096392496275731e-02   +3.030226559122377e-04   -1.174833608507958e-02   -2.033345924268463e-02   +7.131461821718796e-03   +5.433409227344886e-03   -2.386386092625079e-03; -6.469626368815072e-02   -1.505645266553048e-02   +8.598096616155426e-02   +8.984800724050879e-02   +1.906622349412913e-02   -1.976906507068724e-02   +5.881362432417678e-02   -4.884294738881743e-02; +4.924652986385852e-02   +1.096948944809310e-01   -9.236227562203114e-02   +2.077447877062967e-03   +1.346074069564576e-02   -9.957041856371467e-03   -5.718961481903265e-02   -3.701542590869304e-02; +3.057187764775683e-03   +2.139058762836660e-02   +8.128114136394402e-02   -3.590822689737904e-03   -4.041727403248840e-02   +5.206544102010045e-02   -3.032600030395454e-02   +3.969697729806215e-02; +6.176484842175051e-02   -4.681543134274552e-02   +2.282310151986564e-02   +1.727851164366270e-02   +1.227817368500360e-01   +5.076998143449425e-02   +5.818933637116382e-02   +1.104722998701271e-01];
L1I_L2I_iGABA_netcon = [-1.098245756688104e-02   +4.556450517961201e-02   -7.543638559176233e-02   -2.986131502830119e-02   +2.635261889170687e-02   -6.599179779884144e-02   -2.421989896623637e-02   +5.293262609855852e-02   +2.735818791275491e-02   +6.840314883742954e-02   +9.725364269819806e-02   +2.534330380917954e-02   -7.777667672842334e-02   +2.352971459529708e-02   -1.468564646726126e-02   +2.188420708851501e-02; -2.179994806821624e-02   +7.577284573586143e-02   +8.789556761740361e-02   +1.398523655861526e-01   +3.144389765084080e-02   -5.200927861175944e-03   +2.176401559635304e-02   +8.146103982020739e-02   +3.116848513880456e-02   +9.478007724692475e-02   -1.496042418091734e-02   -5.424335112885388e-02   +8.502963734643687e-02   +7.989247699028914e-03   +7.864282745690063e-02   +5.188503725811857e-02; +2.642889397922147e-02   +1.685092514473976e-02   +9.174874019222871e-02   +3.515692684950203e-02   +7.520715219869542e-02   -1.049212993872090e-02   +2.151792131607617e-02   +5.953349366527588e-02   -2.463745248036835e-02   -1.304668374225219e-02   +2.454475015646455e-02   +7.206957952786331e-03   -2.668407515054289e-02   +1.950420289727048e-02   -1.972141956383265e-02   -1.336318255251188e-02; -4.397664714004559e-02   -1.366551660862067e-02   -6.265160514272872e-02   +4.829831458557254e-03   +1.131706487913263e-02   +8.301850866791952e-02   +2.202744286692187e-02   +1.970831673949499e-02   +4.778055925879113e-02   +2.165095138729055e-02   +8.869154887353763e-02   +1.356134025628780e-02   +1.434081207479199e-02   -9.726123219829429e-03   +4.753823694207510e-02   +5.408597304281400e-02; -3.266438516476775e-04   -4.862471683846087e-02   +6.074782189375276e-02   -4.384229479115331e-02   -6.719525704117416e-02   -1.079181495028855e-02   -4.427985349299145e-02   +3.433647117063896e-02   +2.123180638193736e-02   -1.909573992966930e-02   +9.130257358503832e-02   -3.533402098263938e-02   +9.511308299008675e-02   +2.560075830448172e-02   +9.701776369981618e-02   +5.749627854014526e-02; +4.997581893191640e-03   -3.376818015012206e-02   -4.917191959101996e-02   +8.422448452992382e-02   +5.791243715597794e-02   -4.139905142098831e-02   +4.151493039709737e-02   +3.553051773864089e-02   -1.273814265780628e-02   +3.657033303052291e-02   -5.424246207986159e-02   +1.360798674121096e-03   +1.209430220300561e-01   +1.081390737159260e-01   -2.754894654987872e-02   +7.182975497035653e-02; +4.036586466347578e-02   -1.215295359312900e-02   +6.247684047943538e-02   -6.272171856418704e-02   +9.409603627291416e-03   -2.216929552444875e-02   -8.551259661880396e-03   +1.000905090468539e-02   -3.416599828379873e-02   -6.813167575634110e-02   +9.401911580524051e-02   -1.343504206574255e-02   +3.071014203668370e-02   +5.992881100874497e-02   +4.287457924449720e-02   -6.088579844219592e-02; -1.564503286102249e-02   +1.057160917144484e-01   -2.394042522605505e-02   +3.741854108332489e-02   +1.211061442824561e-01   -1.654717917607822e-02   +7.831134873827375e-02   +1.236086155666638e-01   +1.398394914491895e-01   +3.589771229885273e-02   +9.075562887130222e-03   +1.155817295947519e-02   +4.826541626774154e-02   +4.329593559832158e-02   +4.960509666421850e-03   +4.899849193079175e-02];
L2E_L1E_iAMPA_netcon = [+1.313822121309212e-03   +4.063023415191312e-02   +4.662732362425434e-02   -2.378044857687946e-02   -4.340695427449864e-02   -4.010090323757539e-02   -4.801637673456368e-03   -9.480919412136629e-02; +5.044406606641563e-02   +1.146161526478173e-01   -7.917160504861090e-02   +4.514349276078376e-02   +2.646126518011423e-02   +4.227612840573711e-03   +5.158804132973581e-02   +1.521450565390493e-02; +4.816752157998058e-02   -7.598107596759299e-02   +1.366164309156184e-01   +9.270065841404052e-02   +4.366010399580623e-02   +5.800202485820624e-02   -3.056895639582302e-02   -5.559460721696664e-02; +7.315536603281429e-02   +7.000799309110475e-03   +9.326697400540251e-02   +9.854889544454910e-03   +1.012331415884060e-01   +2.780988641897120e-02   +8.053289780275406e-02   -2.820305500580542e-02; +1.804304027035060e-01   +5.504157573238139e-02   +5.719377607587784e-02   -2.426922533961851e-02   +1.330459155733665e-02   -3.482956475440423e-02   +9.902893001352024e-04   +5.588494948795265e-02; -2.030074765895724e-02   +1.092840719128957e-01   +3.685958967966613e-02   -1.861302880285413e-02   -2.248179403948217e-02   +9.119755333777546e-02   +8.397835870567699e-02   -4.993755397179818e-02; +1.032267116312780e-01   -1.808081932797539e-02   -1.057006438860139e-01   +3.868259761802188e-02   -3.328525103785900e-02   +2.931493174995554e-02   +1.320471793994163e-01   +1.810005302947944e-02; +5.123420028680135e-02   +8.323509618916860e-03   -7.071297927115558e-02   +2.512269513205126e-02   +8.252781407282882e-02   +4.545273734732207e-02   +1.686573757879833e-02   -5.000089729788502e-02; +1.114783143719666e-01   -4.167964823971501e-02   +1.007765892419680e-01   +3.320515079276819e-02   -1.432463142805698e-02   -9.091356416231681e-03   -3.891568873133306e-02   +1.397005353544700e-01; +4.079565072429599e-02   +6.053585136575011e-02   -1.344332747941042e-02   +8.647079787411772e-02   +1.288231745618776e-01   -4.333855388997954e-02   -6.531972253224161e-02   +4.621171031684399e-02; +3.670841591025106e-02   +4.607146569112099e-02   +4.781634459239269e-02   +1.359613484077170e-03   +1.653100052854715e-01   +2.951583489851393e-02   -2.273802292925193e-02   -3.864667873490990e-02; -5.002277264234294e-03   -2.065717345761000e-02   -3.459031162846304e-02   +7.715447107794515e-02   -6.531841628849995e-02   -7.049869434774581e-02   +6.156011858399570e-02   -6.834309351015661e-03; +6.591407020004014e-02   +3.595715442811015e-02   +1.011316078904783e-02   +2.519661777157916e-03   +5.735850415609552e-02   -9.054030588918488e-02   -4.314077238231335e-02   -8.862927831599733e-03; +8.759328382411272e-02   +5.059112927462961e-02   -6.134607443107232e-02   -3.021340789661860e-02   +9.863685530034677e-02   +5.492078031520069e-02   +2.016567131462122e-02   +2.963954197145822e-02; -8.415034738261425e-02   +1.292760570528527e-01   +7.724440927848256e-04   +5.148518660837905e-02   +5.194210867813767e-02   -3.927018775818851e-03   +1.638490139671121e-03   +4.607361988936863e-02; +1.750847645526930e-03   +5.344267941330770e-02   -2.095973280004710e-02   -3.941702348878762e-02   +3.856882409995714e-02   +8.301698484829609e-02   +6.217615553344601e-02   -1.957257582321503e-02];
L1E_L2E_iAMPA_netcon = [-3.745334301708224e-02   -4.622606457772681e-02   +1.453651386510306e-02   -7.383407857248610e-02   +5.500843539998651e-02   +8.035073743921969e-02   +2.842816333460049e-02   +5.582513846063050e-02   +9.417296047805723e-02   +5.294639355149024e-02   +1.174798896279497e-02   -4.333793371323758e-02   +5.782349718329287e-02   -6.931565835422661e-02   +1.634182191305009e-01   +1.180184140948873e-02; +1.038694004317488e-01   -6.838867045336990e-03   -2.994958446777903e-02   -1.058890301541757e-03   -3.691125374886990e-02   -4.134012499446577e-02   +4.462329809934828e-02   -1.544384406775898e-02   -2.262352101872940e-02   +4.131050570917207e-02   +4.067346284540078e-02   +1.008501276091530e-01   +2.069364892482689e-02   +2.802821747761004e-02   -1.781357147427434e-02   +1.881803477040430e-02; -7.453357637321428e-03   +7.489713238641699e-02   -1.472620160432652e-02   -2.852901958335788e-02   -8.940216402037089e-02   +2.187236550614366e-02   -1.201524928672033e-01   +5.523631550886865e-02   +2.629544219201910e-02   +1.804491941599964e-02   +1.103420828890900e-01   -3.477918113915569e-02   -1.673605481987028e-02   +2.315683551807171e-02   +7.302479816548380e-02   +2.759687156344628e-02; +2.490630584251819e-02   +6.724765370584923e-02   -1.778456642148913e-02   +5.868632201534475e-03   +1.018374364027088e-01   -2.608584823651524e-02   +1.685460404786387e-02   +2.614228317649145e-02   +5.531777530521018e-02   +6.849516946533352e-02   +3.028750086249217e-02   -5.490502149499654e-02   +1.468765315524151e-01   +1.090391082540721e-02   -5.976759522839822e-02   -4.037564152494354e-02; +1.193092482865504e-02   +5.899361329251302e-02   +5.497326843068436e-02   +6.761753896060838e-02   +6.027593957256805e-02   +3.052616495623905e-02   +6.373953311830163e-02   +3.034893960048846e-02   -5.032173947524356e-02   +3.510811709491737e-02   +1.808780868296310e-02   +1.000467501989495e-01   +2.838321302472443e-02   +2.025055568851683e-02   +3.137902918659577e-02   +6.259412259418136e-02; +1.504704562824081e-02   +3.906608015385034e-02   +1.380449791149715e-02   +8.856086338441027e-02   +3.112482788695163e-02   +7.816017069560566e-02   +3.955394151149073e-02   +2.653812219989155e-02   +6.388324791084606e-02   +3.800838291752758e-02   +4.881057625706266e-02   +8.236177293963816e-03   +2.971218772544592e-04   +7.412662821022116e-02   +4.125496849471671e-02   +8.804102700045352e-02; +6.237742284797349e-02   +2.108482490194630e-02   -6.203947811623033e-02   -3.666591794484333e-02   +1.118756952834035e-02   +1.460815067624493e-01   +6.605908572481417e-02   +6.081292238783280e-03   +6.060917645283282e-03   -1.130004518023777e-02   +1.001573529465089e-02   +3.013647117702752e-02   +1.530152287508913e-02   -6.843820039616809e-02   +1.828665612586908e-02   -2.925892346904564e-02; +6.332340777141923e-02   +7.995352967868012e-02   +5.508629932643777e-02   +3.871414764392463e-02   +2.139740031048516e-02   -3.964262701104106e-02   +7.364909566994821e-02   +2.435022724223952e-02   +2.309490668689110e-03   +2.409075501522309e-02   +1.444291836420384e-01   -4.543774154316881e-02   +1.399718862024188e-02   -2.685879856530418e-03   +9.468221306162497e-02   +1.122309385110665e-01];
L2I_L2E_iAMPA_netcon = [+4.280308064987843e-02   +6.233903360360067e-03   +3.607826697889475e-02   +7.630116347399454e-02   +1.560885239057070e-02   -2.259656586915150e-02   +2.939018824779510e-04   +1.019567090396780e-01; +3.832202122611354e-02   +1.275492361883079e-01   +1.104797284550190e-02   -5.317650291808231e-02   +8.951587357809154e-02   +6.034959026279832e-03   +4.208671757074287e-02   +9.496706957440756e-02; +2.864451520158250e-02   +2.873926168250217e-02   +3.624364532884573e-02   -2.784709626402843e-02   +8.307827959922282e-02   +1.731960336223685e-02   +3.831546568200168e-02   +3.432135899563307e-02; +4.080421356425123e-02   +2.157427721892736e-02   -1.863762712333018e-02   +3.672525366305887e-02   +3.831066592249487e-02   -3.239899694426737e-02   -3.637992975525085e-02   +7.385497107832847e-02; +1.484842646947792e-01   +1.173156292700654e-01   +5.292979298709308e-02   +5.772061913485187e-02   +5.616336665905632e-02   +9.429815193906060e-02   +5.071144979413644e-03   +1.055379227763093e-01; +2.983474229288198e-02   +3.606437207703175e-02   +6.185618592699148e-02   +6.621616093475861e-02   +5.666648976668127e-02   +1.043360612243262e-01   -2.758136310930412e-02   +3.006649053384670e-02; +1.271821586270910e-01   +6.236243171361049e-02   +6.691685371766457e-02   +2.606578777094693e-02   -7.157051036948278e-02   +6.406591764483134e-02   +1.317572056194017e-01   +1.398605499788427e-02; +1.441764651762490e-01   +9.278034835386634e-02   +8.306883055919770e-02   -5.343278172160948e-02   +4.149911812752329e-02   -2.180447296131981e-02   +6.566279982693979e-02   +6.510352796961308e-02];
L2E_L2I_iGABA_netcon = [+5.505247955241738e-02   +2.053245967897643e-02   +7.332214753417143e-02   +3.412996562170745e-02   -8.473981718491572e-02   +8.787715024145751e-02   +1.533534172129202e-02   +5.642019170987077e-02; +2.275155856700403e-02   +8.439914921723025e-02   -3.116651898537354e-02   +5.443501768332031e-02   +3.642117493211438e-02   +6.582220684577361e-02   +9.633116572474634e-03   -1.765265211664750e-02; +3.350439008238347e-02   +5.983206994818980e-02   -5.154432805466613e-02   +7.827110498847335e-02   +7.099725186440693e-02   -5.329476291309503e-02   +6.220707975533626e-02   -1.856202597762359e-02; -7.491152155134860e-02   +1.262662223093699e-02   -3.925473442274083e-02   -3.998287130325259e-02   -5.137664413640012e-02   +1.100807314569752e-02   +6.672971048662438e-02   +7.908220402320656e-02; +7.115511024409812e-03   +9.427810631898657e-02   +8.126360659565585e-02   +2.399702944868205e-03   +1.416384614816866e-01   +1.112767706418778e-01   +1.761479576288412e-02   +6.526120753218487e-02; -3.554789559498525e-02   -2.683592292252610e-02   +2.692538057909415e-02   +2.751248519323374e-02   +2.688733421793723e-02   +1.377657732450282e-02   +4.431582661101564e-02   +9.975628194248945e-02; +1.029467376964287e-01   -9.821386079318203e-02   +2.478090122146157e-02   +4.663928223099417e-02   +2.560549501220575e-02   -5.106612150789418e-02   +5.149659318949856e-02   -2.114205666024031e-02; +5.539832269943892e-02   -5.078867831920352e-02   +3.563101008427024e-02   +2.723568782945835e-02   +4.758477737787087e-02   +5.995913579927413e-02   -5.434435081756303e-02   +4.706877412967478e-03];
L3E_L2E_iAMPA_netcon = [+3.571742440060962e-02   +2.800922002762760e-02   +2.137164896896719e-02   +8.332733802441060e-03   +1.105939464280916e-01   +1.247139034616819e-01   +5.597904886982928e-02   +8.615561963084109e-02   -2.514811289820347e-02   +1.057169753218192e-02   +9.011139211128137e-03   +3.664494759596502e-02; -2.154652707484711e-02   +4.567438725233089e-03   -4.834176816957686e-02   -3.873823681786611e-02   +9.610736298126601e-04   -3.899887795333792e-02   +1.132722614198736e-03   +1.081797578613059e-02   +2.484707261401863e-02   -6.176515866269099e-03   +1.496505480412844e-02   -1.005408896668981e-02; +7.093995898178418e-03   +2.721447739979900e-02   +4.970982421440785e-02   -1.890061532227733e-02   -5.200613611727001e-02   -1.429261372634943e-02   +4.435631759418825e-02   -4.810577765200188e-02   +4.680988184352831e-02   +3.440305596146394e-02   +1.035195919414621e-01   +2.460653332582253e-02; +7.051135618916383e-02   +4.124880128248293e-02   -2.580305485699089e-02   +1.138623781943693e-01   +5.323950462541050e-02   -5.290355238916482e-02   +4.722840822366119e-02   +5.401294003571243e-02   +4.347280926528027e-02   +7.130696774616932e-02   -5.915854034071711e-03   -2.026739169304889e-02; +7.884674881398164e-03   +3.178039238283331e-02   +5.024583260023190e-03   +3.982899837597078e-02   -5.743538638832948e-03   +8.832974096889136e-03   -8.751923016045819e-04   -1.053239409437979e-01   +4.238991151905917e-02   -4.078841807340491e-02   +2.322048122202766e-02   +2.880395078924628e-03; +9.951686074084377e-03   +3.654585347956005e-02   -2.668978204038945e-02   +4.992284778619563e-02   +9.617866922580767e-02   -2.593333374211693e-03   +9.967863345208772e-02   -5.314308930125495e-02   +3.238557626940008e-02   +8.135517596681636e-02   +1.066022790508985e-02   -2.330140269725646e-03; +8.895268086343433e-02   +4.164404322017258e-02   -2.692386593245036e-02   -4.205671429492365e-02   -4.100164888268498e-02   +1.566406973220644e-02   -3.362252062174154e-04   +1.170080723356768e-01   +9.228635901273585e-02   -6.373770912204568e-02   +8.787036110848562e-02   +6.716627073873251e-03; +9.068420386907414e-02   -3.554103472279448e-02   +3.531245892692078e-02   +3.166168862852090e-02   -7.564472872827649e-02   +4.289308748144176e-02   +1.180588367952699e-02   +4.358213856536182e-03   +3.637754194375749e-02   +1.807126597848902e-02   -1.192899327496705e-02   +6.460972872276800e-02];
L3I_L2I_iGABA_netcon = [+4.881522436799188e-02   -4.605500516777395e-02   +2.054867287045401e-02   +1.237292545264540e-01   +1.677442855005755e-02   +3.798406952838905e-02   -1.792890032184364e-02   +5.990182201031385e-02   +7.430823761600863e-02   +2.934709030317054e-02   +3.920223608464198e-02   +1.020996862373191e-01; +1.010936828627466e-01   +2.444618616575019e-02   +8.484421612357120e-02   +5.266811264909745e-02   +5.074799890955536e-02   +1.583433774542415e-03   +6.242111641813883e-02   +8.308209828395887e-03   -8.732023587522725e-02   +3.586256282606473e-02   -2.870351671399481e-02   +6.672912136818296e-03; -6.177811203031083e-02   +5.678209517781801e-02   -1.866273586347193e-02   +8.174924112715140e-02   +5.696452297436719e-02   +9.793176739158397e-03   +3.877038374183280e-02   +3.302000817883884e-02   +1.317264013480296e-02   +7.088062906933880e-02   +4.896745125825088e-02   +1.746309074050372e-01; +9.412456499867572e-02   +9.685735485585470e-02   -5.316123104780058e-02   +3.546124332046297e-02   +2.544777621423245e-02   +4.570817249882389e-02   +5.861766734786318e-02   +6.101623904463904e-02   +4.857966783270971e-02   +3.694205100316691e-02   +2.050471075293033e-02   +7.171543383347459e-02; +2.312841809038352e-02   +6.093744370383707e-02   +7.304626948628702e-02   +1.082213651762196e-01   -8.380292888766425e-02   -7.609467197525788e-02   -3.173333291134545e-02   +2.215449565338273e-02   +5.494762991025027e-02   -6.331309714699604e-02   -1.540028542069461e-02   -1.378988147191192e-02; -6.262246143205441e-02   +7.913604618141615e-02   -2.579021598972136e-02   +3.891932176588823e-02   -4.690484279163713e-02   +1.121508219864400e-02   -2.368944288041804e-02   -2.899169306287857e-02   +5.298291228785318e-02   -1.684291955510915e-02   +6.600454864170935e-03   -4.587856691916066e-02; +5.400855016746274e-03   -5.628560131488633e-02   -3.305025169202606e-02   +8.579065288933407e-02   +1.253282671018743e-02   -5.465091518646098e-02   +8.173344900708665e-02   +5.639333007282724e-02   +8.524337037549459e-02   +7.634169054216650e-02   +1.445502351499315e-01   +1.997735692301369e-02; -6.782340609711595e-03   +6.283475750604310e-02   -7.981889219477295e-02   -4.915644324456476e-02   +5.789705916681709e-03   +1.770872188305697e-02   -2.339993800226205e-02   +5.782508551254280e-02   +2.221731912982659e-02   -9.570605262693102e-02   +2.573422961559903e-02   +8.937342483494976e-02];
L2E_L3E_iAMPA_netcon = [+7.067293297945659e-02   +1.810915440223568e-02   +5.249064179613551e-02   -1.926175024468407e-02   -8.519054675856680e-02   +3.954758519942431e-02   -6.316181894003728e-02   -2.376873186707764e-02; +1.718962336780903e-02   +1.099992333823585e-01   +4.983944686327615e-02   +2.725067769394334e-02   +4.082720748526589e-02   +1.718455454852674e-02   +1.296124735284262e-02   +5.790476638925546e-02; -4.947314238161735e-03   +2.309240021717007e-02   -5.586165995188078e-02   +6.071035654122375e-02   +8.834039420445590e-03   -1.189928695341379e-02   -4.841654385005761e-02   +8.015515367599639e-02; +8.618023030870339e-02   +6.828908141741924e-02   +1.828026720836202e-02   -4.990496501801316e-04   -5.603852410497680e-02   -1.177868962465122e-02   +3.487250494270687e-02   +7.064682700403457e-02; -4.610547738700134e-02   +4.853038953830231e-02   +2.353766468951243e-03   +5.689760349900155e-02   -3.626563710297810e-02   -4.659719422402228e-02   +1.744171751114584e-02   +9.393688043816918e-03; +3.866571962219485e-02   +2.766087040248261e-02   -2.294479366168058e-02   +1.499745691971243e-02   -3.644528256295880e-02   -9.024861193741054e-02   +1.398478984598457e-02   -1.248431603841198e-02; -3.568325295231450e-02   +5.228337923819969e-02   +6.290193531761129e-02   +5.109521934496101e-02   -3.605661848250322e-02   +7.027012640365697e-03   +6.504324529719580e-04   +1.319025299858508e-01; -6.777332172068478e-03   +8.630211181428264e-02   -1.081294188557053e-01   +2.484415744585539e-02   -1.960757578267630e-02   +6.102888522577175e-02   +3.631849204069537e-02   +2.571349858651699e-02; +3.759331379663632e-02   -3.835638424061884e-02   +3.945003934358376e-02   +5.450747237781112e-02   -2.678394206862678e-02   +1.774137736828055e-02   +5.006247468791789e-02   -3.466550513603522e-02; -2.767122973774091e-02   -2.602264347588703e-02   -1.937326852527843e-02   -3.283144160332263e-02   +7.443271514901117e-02   +4.261242664967742e-02   +1.505528467846451e-02   +1.452808007230217e-01; +1.480918901493789e-02   +3.206000544680140e-02   +5.234063420721922e-02   -8.734801483709606e-02   -9.420526814404875e-02   +6.501201316536911e-02   +2.174757642592519e-02   +5.901659534150696e-02; +1.017177037925047e-01   +4.197129324913410e-03   -1.083717476640056e-01   -4.029184959719712e-03   -4.496379502188375e-02   +1.052093726732735e-01   -5.162985324453231e-02   -2.202370654444587e-02];
L2I_L3I_iGABA_netcon = [+9.346880171814145e-02   +2.481762578907323e-02   +5.302192194445782e-02   +9.828920519315076e-02   +3.296259771222849e-02   -1.233361888358794e-02   +1.057125540846895e-02   -5.171580148832082e-02; +2.860884088166010e-02   +1.079047431133399e-01   +5.448600463129565e-02   +1.167043838714453e-01   +1.524771527348295e-02   +4.207241478987729e-02   +1.290206695220978e-02   +4.315641754658021e-02; +1.566391411047302e-02   +1.015784079144123e-01   -7.706949779233889e-02   -3.074077493361359e-02   +1.118126504645641e-02   +4.286261659307355e-02   +7.554524780875418e-03   +6.284572874556159e-02; -9.964630987581253e-03   -3.531271153528893e-02   +6.094519986984501e-02   +5.344476956481752e-02   +1.234144983215832e-02   +6.033859682425373e-02   +4.259022589015819e-02   +5.345792278046153e-02; -1.000570187455326e-01   +6.423802632984332e-02   +8.440282706214147e-02   +6.752285637483701e-02   -8.128900256316223e-03   -6.831238289493372e-02   +2.510621598269228e-02   -3.572393865871679e-02; -5.723638141139576e-02   +7.604589418923893e-02   +2.143581180980764e-02   +6.137384693999312e-02   +1.564048897470317e-02   +2.502747879627139e-02   -4.409030629488284e-02   +4.057357779945638e-02; +9.274897451115012e-03   +1.629084606274054e-02   -1.661679617957674e-03   +1.128380065299081e-01   +5.370582907156442e-02   +2.546908143790379e-02   -4.217336751098144e-03   -5.726674013320057e-02; +7.646868257068920e-02   +5.762180918433731e-02   -1.845023183846924e-02   +9.283668522427568e-02   +2.392024099314356e-02   +6.527117524407505e-02   +5.020491539376980e-02   +8.320554825959021e-02; +3.946282693533337e-02   +2.211495478978081e-02   +3.885802538962358e-02   +2.230287944995528e-02   +1.120001916059732e-02   -3.243286321605010e-02   -4.767504323046713e-02   +8.063609024415232e-02; +3.757087631858246e-02   -2.898473616514994e-03   +8.019415603959659e-02   -1.522113991091585e-02   +5.034422061308878e-02   +3.304749019263551e-02   +4.391510100968665e-03   -3.040325228909001e-02; -3.142293920499242e-02   -7.730316378948898e-02   -6.152914091909240e-03   +4.812962027684655e-02   -2.314194370937397e-04   +2.830861821605883e-02   -2.509670131326293e-02   -2.972878456837175e-02; +4.615028831439849e-02   -6.058928118809272e-02   +6.196926331480228e-02   +7.949550504293948e-02   +2.384043572598221e-03   +5.189244391692015e-03   +7.840610043481372e-02   +6.618493736592825e-02];
L3I_L3E_iAMPA_netcon = [-2.026424858375588e-02   +4.694816213279103e-02   -7.570390507248097e-02   +3.654319467878349e-02   -1.167148205110915e-02   +3.410904041341694e-02   +9.214686985891882e-02   +1.119160123958294e-01   +2.238001101631435e-02   -1.920002564848505e-02   -3.012575376882288e-02   -8.226824851984484e-03; +2.639960680533688e-02   -6.787591631528891e-02   -4.314987880394720e-03   -6.290140128676386e-02   +6.405148055175651e-02   +9.572132602562008e-03   -6.094726001569495e-02   +6.760469799559128e-02   +1.105472103981186e-01   +2.168498227222651e-02   +4.645734093994572e-02   +1.591764201784109e-02; +2.089756994158434e-03   +1.566168367363280e-01   +1.138699118157310e-01   -4.247477899437260e-02   +7.563714150025211e-02   +7.884038036627636e-02   +1.147320438867279e-02   +2.584761170110485e-02   +2.583135044680013e-02   -8.325314265640466e-02   +5.081677414203449e-03   -5.628490278295212e-02; +2.135023430522601e-02   -6.350815737474411e-02   +3.670865357252958e-02   -2.462100072869421e-02   -1.118335732825180e-02   +5.197457620815330e-02   +1.183734518541088e-01   -1.180391823057869e-02   -4.474791559419908e-03   +2.936827646300232e-02   +7.084839587404797e-03   -1.001687207804552e-03; +7.863677190564461e-02   -3.575003504328789e-02   +3.049606055739593e-02   +8.147527688384133e-02   +2.506893224406346e-02   -4.790614249903256e-03   +7.272413212309650e-02   -5.044964338404415e-02   +2.456092190889009e-02   -1.134727527747400e-03   +7.660930754137318e-02   +3.228996885763490e-02; +1.225528731346888e-01   -1.901109000514264e-02   +1.073427256637661e-01   +5.966478866584579e-02   +1.056538362961881e-01   -1.100840290344267e-01   +5.282296726639588e-03   +4.585579672896452e-02   +3.342386695657927e-02   +5.000135247290367e-02   +4.659813903186113e-02   +4.689996456463759e-03; -9.220160731508220e-03   +6.713087697525459e-03   +1.856207412049444e-02   -4.922676009144730e-02   +3.964073893088658e-02   -1.751168895377304e-02   -1.858497276015512e-02   +5.500536336730923e-02   -1.900106844407237e-04   -1.828546615456145e-03   +2.859160386186110e-03   -1.806578747785875e-02; -4.768678334394504e-02   -3.681949177381644e-02   -1.719155208656370e-03   -2.490047672643939e-02   +3.796331706205883e-02   +1.181919633715918e-01   -7.062110214024343e-03   -8.460848743579760e-02   +3.869212297925499e-02   +2.916006231643725e-02   -4.591772414155055e-04   -5.441318392702535e-02; +4.901754463348497e-02   -1.181605113479529e-02   -4.194114376967327e-02   +1.392187450391167e-02   +2.202281527500519e-03   -4.284159428048604e-02   -5.642363645870813e-03   +7.062715996302417e-02   -4.521787211272101e-02   +6.860570604114612e-02   -5.161550220401771e-02   +7.168582964042688e-02; +1.806541329947774e-02   -7.804288614169995e-02   +2.345967722361247e-02   -5.502604686613392e-02   -5.851816905875222e-02   +3.184911710405201e-02   -1.389954471459561e-02   -1.436142023479869e-03   -1.052586416012793e-02   -2.310410259323104e-02   -1.649317578260124e-02   +3.257378045529169e-03; +6.202212657100580e-02   +1.295643265035704e-01   -4.660086913702668e-02   +7.094953196016286e-02   +1.421874602970911e-02   +1.068250734367066e-01   +3.419125738463642e-02   +8.620764572479898e-02   +2.371120275947983e-02   -3.196462360664883e-02   -4.842210873588461e-02   +4.987551956111803e-02; -5.164298837694532e-02   -3.891166327684133e-02   -3.084894251674227e-02   +1.073334354264875e-02   -8.695832847070438e-02   +4.637103778616437e-02   +4.914199140116354e-02   -3.261725166869628e-02   +4.123877021492406e-02   +7.396742081205801e-02   +6.232508656534619e-02   -2.117369195734310e-02];
L3E_L3I_iGABA_netcon = [+4.957501954950601e-02   +2.342884924360455e-02   +1.741822180342898e-02   +3.801893182836698e-03   +3.542356046701686e-02   +7.595564832527232e-02   -2.569773002691157e-02   +4.421001826725664e-02   +6.897195458195585e-02   +7.361244676817355e-02   +4.511929931806328e-02   +4.797693866779695e-02; +2.763753064895270e-02   +8.595606868030048e-02   -6.400571448999083e-03   +6.549634078093938e-02   +4.837343656832563e-02   +1.877183342425071e-02   +2.063670769053681e-02   +1.558763693726384e-02   +9.725246326721154e-02   +8.783581681906083e-02   +9.297386605928369e-03   +5.317707912026518e-02; +3.044249893981482e-02   +1.551812508233176e-01   +1.031495714837675e-01   +3.184310645179673e-02   +1.634172084296894e-02   -7.577498018371054e-02   -1.090388695752162e-02   +1.439138386166241e-01   +1.248517632389134e-01   +2.603616294974366e-02   -6.150085648846093e-02   +8.501090438529406e-02; +3.863763978243060e-02   +4.284027257143823e-02   +2.730834258240905e-02   -6.362043949290350e-02   +4.988705088917898e-02   +7.562865222997388e-02   +1.116045544603843e-01   +3.757686752827585e-02   -9.423910724640933e-02   -2.668307009603264e-02   +3.136374484065548e-02   +9.231191672332775e-02; +6.520581422814895e-02   +6.750515639478405e-02   +8.501535974874441e-02   -7.145825853480009e-02   +2.239012879741133e-02   +4.289534003543512e-02   -3.661895958024484e-02   -2.065282713962082e-02   +4.291099829443296e-02   +3.207962026777292e-02   +9.535007957987802e-02   -5.062123792007601e-02; +3.858225881244610e-02   -7.195947546559556e-02   +6.141794032922040e-02   +9.150772230347068e-02   +3.105030433281507e-02   +9.192106872369554e-02   +6.057512144713054e-02   +1.355830455740373e-01   -9.195582577506007e-03   -1.571700618916567e-02   +1.116312228582584e-01   -2.570094756197158e-02; +1.117075445630930e-01   -6.102282797352396e-02   +1.157579407980865e-02   -1.863877518315701e-02   -5.882590262833489e-02   +5.922534093982314e-02   +1.140259699733533e-01   +1.030992511422071e-01   -9.219087474630161e-02   +6.600092476470093e-02   +3.511251650680518e-02   -6.085545625776997e-03; +6.493061197104724e-02   -6.555108917468723e-02   -2.269518404951160e-02   +5.301531022177997e-02   -4.863495724910509e-02   +7.568094094209779e-02   +4.111822606707188e-02   -4.065747871814857e-02   +3.450996344799993e-02   +3.022505503530080e-02   -1.722560762322859e-02   -6.546247241935138e-02; -5.669722069553867e-02   -3.711306013863011e-02   -3.281740291717441e-02   +5.934886939007591e-02   -7.997670954651499e-02   +8.912258328574162e-02   -8.274053435628122e-02   -1.210811458773910e-02   -6.788529390671058e-02   +1.519227209244231e-02   -5.756001189026642e-02   +3.900451972509617e-03; +1.559296120884212e-02   +1.130044310693114e-01   +4.610827611808730e-02   -1.466189385684696e-03   +8.710007281001214e-03   +5.592708510262288e-02   +6.671222854791441e-02   +9.852462356150425e-02   +8.040377683111934e-02   +2.973626144723826e-02   +6.604632998743885e-02   +5.286684141573340e-02; +1.151580136844934e-01   +9.616081845029717e-02   +4.953566954889119e-02   -1.277257048643551e-02   +2.157753150532936e-02   +6.541661345545305e-02   +1.484736333128859e-02   -9.689400287528976e-02   +1.320254720357879e-02   -9.659059596597634e-02   +2.797986004349377e-02   -1.035856314589480e-01; +9.265701102613528e-03   +3.493621088182554e-02   +4.460168531302765e-02   +8.784309035036153e-02   -5.086541997276325e-02   +5.990749810158529e-02   -4.570091423206959e-02   +2.638052616298759e-02   +4.085589649744970e-02   +5.290303633633675e-02   -3.374369700171493e-02   -6.350635690256284e-02];
L2E_Input1_iAMPA_netcon = [+8.399193680565710e-02   +5.920321929557801e-03   +1.122586724839454e-02   -3.181196095387005e-03   +7.969289836956250e-02   -6.549864562526923e-03   +6.754443849043039e-02   -4.798932082007297e-02];
L2I_Input2_iAMPA_netcon = [+1.034081712155950e-01   -3.602182269760539e-02   +1.063809182441643e-01   +1.740870423651529e-02   +1.078441776476531e-01   +2.854445217329415e-02   -3.484099925873432e-02   +8.502507650156997e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
