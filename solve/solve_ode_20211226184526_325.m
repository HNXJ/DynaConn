function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.034027945055719e-01   +4.864607378056296e-02   -6.153245997032041e-01   -3.217493558449813e-01   -5.513170953701733e-01   -1.433353086300617e-01   +2.354619416141234e-01   -2.902067574086077e-01   -1.337374319293491e-01   +4.419316286604161e-01   +3.810525023024355e-01   -4.235838934617012e-02   -2.079721267952618e-01   +1.764886234237695e-01   -3.223331277040791e-01   +4.829578722230767e-01; +4.174988421889316e-01   +3.177131107769334e-01   +3.882405843545573e-01   +5.688334350940034e-01   -2.555487291253864e-01   +4.139419364160373e-01   -7.735992956457891e-01   -6.457364096822746e-01   -2.095438575557167e-01   +3.921543106841054e-01   +5.654605827655593e-01   +7.512225398096095e-01   -1.971261268981053e-02   +5.115494847924367e-01   -2.368786974485770e-01   +1.717579088041594e-01; +8.051375930746815e-01   -1.122488396435687e-01   -8.009409220740688e-02   +2.600195020034125e-02   +4.069860526115351e-01   +1.126426118802861e-01   +5.422392981536808e-01   +6.477982247669378e-03   +1.691740538385791e-01   +3.699398600600995e-01   -7.703245226777355e-01   +6.472242370321211e-02   +1.934649181830768e-01   -3.918120572910513e-02   +2.650207787899657e-01   +2.551253497801034e-01; +3.959396177334230e-01   +3.516216311552403e-01   -4.913533190061117e-01   +2.716468416040972e-01   -1.605551904057535e-01   -6.260633648863543e-01   -4.345016480654779e-01   -2.393044364359511e-01   +3.976923620323461e-01   +3.087248940117665e-01   -5.805881009301259e-02   +9.389232763102662e-03   +1.999775450416084e-01   +1.597709317170166e-01   +3.576902100165289e-01   -8.275583879010909e-02; +9.014792694063085e-01   -4.719272969109140e-02   +4.579169985803334e-01   -1.326024702613745e-01   -9.609371675947781e-02   -7.882786366340719e-01   +1.270867931711048e-01   -3.702853621059481e-01   +1.488253966940322e-01   +5.052097358369760e-01   +5.444369365150368e-01   +7.701716633405901e-01   -2.115437395350566e-01   +1.844056700549023e-01   -4.805600495008152e-01   +5.783728251125916e-01; -4.144510645877075e-02   +4.729731539626919e-01   -8.901518692261218e-02   -2.620492800630846e-01   -2.134418859744252e-01   +9.003176509341337e-02   -3.659307164294773e-01   +6.840210686629383e-02   +4.364112352521529e-01   -4.488552137326014e-02   +1.890545632431938e-01   +5.865172713074422e-01   -5.141166807161719e-01   -5.131244902919869e-01   -3.145798041327010e-01   +3.270153976694183e-01; -6.832656500751982e-01   -2.349853923283675e-01   -3.315538217882052e-02   +3.169196325782839e-01   +5.743688047611754e-02   -8.512221318005337e-01   +3.603207657281037e-01   -1.269103490510939e-01   +3.062361731187827e-01   +2.169372678655671e-02   +9.063323638272394e-01   -4.750802093600562e-01   +5.259588443991348e-02   -3.322654934206122e-01   -1.733826881645960e-01   +6.332662462921002e-01; +4.377955745154753e-01   +1.210390514320532e-01   +3.565532255901728e-01   +6.622373912072133e-01   +8.333772883483209e-02   +3.545241913256129e-01   +7.875786113837646e-02   -4.846003744189284e-01   -6.386714234800562e-01   +7.176915234287571e-01   -3.623391632323555e-02   +9.461789114173841e-02   +2.460338808387418e-01   +3.994102429256375e-01   -1.777031075428415e-02   +1.499990439202025e-01; +6.253678947313451e-01   -6.447935001973488e-01   -1.804396893709455e-01   +8.774332170646514e-01   +3.673002516879356e-02   +3.095458292983266e-02   +6.991888420124599e-01   +9.342261649806666e-02   -9.537541645615993e-01   +1.835107267451605e-01   -8.621451518664991e-02   +2.485985056985246e-01   +2.033268770393094e-01   +6.563601218869810e-01   -7.050264158003603e-01   -2.172262604255767e-01; +2.478064447510573e-01   +2.555532836822862e-02   +3.720935933958786e-02   +5.151854752291161e-01   +3.709665033432427e-01   -1.551077735568751e-01   +3.286519328319719e-01   -1.827678692767923e-01   +3.408892441708652e-02   +4.295048209067029e-02   -3.752693443157724e-01   -1.552816721224198e-01   -7.774753301847546e-01   -2.717256693417430e-02   +2.806173220910736e-01   +6.373685794684031e-02; -2.319019050910568e-01   -1.915471301580025e-01   -2.461726779959552e-01   -4.517056688985904e-01   -7.744665464554767e-01   -8.204791215372986e-02   +2.082676109972214e-01   -4.406526057732592e-01   +4.688086419503222e-02   -3.882865804554519e-03   -6.816908692003184e-01   +9.271315633646169e-01   +7.131535439623495e-01   +1.840567288290269e-01   -2.863401788440710e-01   -3.027061540870175e-01; +3.063426518078606e-01   -1.899705491979645e-02   +5.859749364864966e-01   +1.192091128965453e-02   +3.046821525095468e-01   +3.271930162876384e-01   -2.783092208439231e-02   +4.688130682955032e-01   -5.162071964405752e-01   -2.593473340386770e-01   -3.681525490915474e-02   -8.840080930066441e-02   +2.576729863651038e-01   +4.622592720034955e-01   +7.354726041113629e-01   -3.997061933067785e-02; +7.395311453011663e-02   -9.408146159611199e-01   -4.506670918028736e-01   +2.764185602830013e-01   +5.376480726924132e-01   -8.704297326184309e-01   -1.543520751185656e-01   -1.055646015893923e-01   +7.414996815370271e-01   -4.728639538742825e-02   +2.647651633631329e-02   +6.639208089445695e-01   -9.501505641907464e-01   -1.116995176551775e-01   -3.601352096569052e-01   -3.997895239219583e-01; -1.939754231417098e-01   -5.166764600600215e-01   -6.598747526524672e-01   +3.129166026493143e-01   -8.991646404149254e-01   -3.742149507948442e-01   +6.519762906867435e-01   -6.750358762594784e-01   +8.462057864690924e-01   +5.015273586618514e-02   -4.100882040755091e-02   +3.128340302117281e-01   -5.214857820773630e-01   -5.344217212263228e-02   -5.932687358235252e-01   +5.085481756138372e-01; +8.835785064398485e-02   -7.095923387490961e-01   -2.504520527516363e-01   -4.256984915529601e-01   -5.755227345288774e-01   +1.945206137792543e-01   +9.360011308547578e-03   +3.693649208030723e-02   -7.952849424906983e-01   +3.922655678537973e-01   +3.705291964698036e-01   +1.494196146868736e-01   -9.752749089493362e-02   +4.091589345186731e-01   +9.108930887641851e-02   +4.444925418264674e-01; +4.356491350996237e-01   -7.115111141085365e-01   -3.899198864978892e-02   -1.916518859788159e-01   -3.412665668711654e-02   -5.898358433972135e-01   -7.021678056540606e-01   -5.119154652549820e-01   +3.745446532948448e-01   -7.302033926791101e-01   +4.665462396913800e-01   +2.827891277188293e-01   -3.501440683685357e-01   +1.617976306379703e-01   +1.004062901737159e-01   +2.430212597450418e-01];
L1E_L1I_iGABA_netcon = [+1.611860398215497e-01   -6.466761852289266e-02   -4.859304216522126e-01   +3.094632447985496e-01   +3.864174115956984e-01   +2.853969769736023e-01   +9.200062988998777e-01   +2.356967681646380e-01   -4.051128046996803e-01   -1.589269180235404e-01   +2.004068809626194e-02   +4.573891560281254e-01   -1.317000190856263e-01   +2.150771128870455e-01   +4.395918901864754e-02   +8.337571963573596e-01; -4.623134612778316e-01   +1.357695384145022e-02   -3.923390244277893e-01   +3.870130500021081e-01   +3.843318230242456e-01   +1.797815537826976e-01   +6.236959248269298e-01   -1.939033962587446e-01   -2.043809011313092e-01   +5.043447365332467e-01   +9.457073279462401e-02   -2.346671432400860e-02   -3.654459879644775e-01   -1.317008948626145e-01   -1.092709461261882e-01   -2.268736635742571e-01; +4.365266199456265e-01   -4.631697484035018e-01   +5.909813417558666e-01   -1.379295512513677e-01   -4.171668440011895e-01   -5.890396781530249e-02   +4.322789038325544e-01   -1.801593325022599e-01   -3.997706174484921e-01   +3.173106930620495e-01   -5.890485730882623e-02   +1.102995608335747e-01   -1.302554775027275e-01   -3.728137197604192e-01   -2.146817802342376e-01   -3.075603033880848e-01; +6.621146141002504e-01   +5.641597051474199e-01   -1.873321557227976e-01   +1.455885979936453e-01   -1.830242649611862e-02   -3.549837018522197e-01   +1.285520152408863e-01   +3.564478462272282e-01   +1.166679671816992e-01   +6.167361748858221e-02   -4.870566416296034e-03   +2.728929025631414e-01   +5.244783944973462e-01   +1.487946571561775e-01   +1.715112512946179e-01   +8.055874272985918e-02; +1.290152123241558e-01   +1.475058278221198e-01   -3.773533075206744e-01   +6.274098501401258e-01   -4.811237653261551e-01   +6.703271392013247e-01   -2.436488173146060e-02   -8.035990153837591e-01   -5.152941145065449e-01   +5.334446407394144e-01   -6.269871751063825e-01   -2.201204647749678e-01   +4.433917730190181e-01   -7.097994864949708e-01   -4.899030798232553e-02   -2.064957083594125e-01; -5.680430169557961e-01   +3.430173330299545e-01   -5.301202041057946e-01   +1.379729246821357e-01   -3.656043930853992e-01   -2.547030831150008e-02   +6.699050581365437e-02   -4.710051474645419e-02   +3.893174724645745e-01   +8.129390159509370e-01   -1.525950411499570e-01   +1.192832131165060e-01   -2.223457511540431e-01   +5.994096278412473e-01   +4.494393563205265e-01   +3.793347522396336e-01; +5.276925592512258e-01   +1.401125066411914e-01   +3.366805598274235e-01   -5.213481896703855e-02   +6.760774604620563e-01   +6.227407468566015e-01   +6.335618671908514e-01   -2.494249438780205e-01   +3.026766173044375e-01   +2.291760442330225e-01   +4.830254858004727e-01   +3.801901855812615e-02   -6.741129968713857e-01   +3.580898233827224e-01   -4.827836884444232e-01   -1.509242648304325e-01; -1.360023236695004e-01   -2.395789219744142e-01   +8.439122063626883e-01   +1.261385922625493e-01   +2.282808381334369e-01   +4.746593499394470e-01   -6.640771970248399e-01   +1.757676157542794e-01   -1.789909962944208e-01   +1.319676009738619e-01   +5.816059944911552e-01   +1.891429509294705e-01   -1.976713188002753e-01   -1.094561098215166e-01   -2.825546095130474e-01   -7.595326768592551e-01; -5.395812556879123e-01   -2.354417023550162e-01   +5.219231674170033e-02   -7.899123716877633e-02   -2.472033518910819e-01   -4.305034398951733e-01   -4.764301772545958e-02   +5.955381163775054e-02   -1.919994208274578e-01   -9.323559557768957e-02   -2.111475827344529e-01   +1.520665967306014e-01   +7.399719254472713e-01   -6.744573134566150e-01   +8.687868448697640e-01   -2.790011166275234e-02; -1.524396065784706e-01   +4.134995733827878e-01   -2.343532724506110e-01   +1.400863930308983e-01   -1.297717750140583e-01   +1.033284520484134e-01   -1.834056903778352e-01   -3.526643028043628e-01   -4.143327927304766e-01   -6.096621255792710e-01   +6.517014183287008e-01   -3.189742474108914e-01   -1.550327576490393e-01   -4.056109113444921e-02   +2.776100045486412e-01   +1.376481912206322e-02; -1.352243155691607e-01   -1.986722247121415e-01   +3.478889998547300e-01   +2.844799040775550e-01   -2.135602761891872e-01   -5.301073476027069e-01   -7.360724381579810e-02   +5.405055954648387e-01   +3.456689355773250e-01   +3.740163102863094e-01   +2.661543505877236e-01   -1.965110766443457e-02   +1.358327237094391e-01   -4.773553052121420e-01   +1.457678826207923e-01   +6.596728573565469e-02; +1.708791551330644e-01   -3.573337481320452e-01   -8.302103696313813e-01   +4.390554862535569e-01   -5.266382739000146e-01   -1.325149412342160e-01   -4.958185391653013e-01   +2.943203889200020e-01   +3.177546075189436e-02   +2.443644281572617e-01   +4.247694253507197e-02   +7.495170978723321e-02   +2.622208253054945e-01   -4.118410376562649e-01   -2.217741713106988e-01   -7.567209334814855e-01; -4.627248313493146e-02   +2.657435640757779e-01   -3.217298385495224e-01   +4.804335263409375e-01   -1.220182083766678e-01   -2.387462077825650e-03   +1.727652963476403e-03   +4.771184374173728e-01   +2.366148100702967e-01   -5.235916624142821e-01   -5.060358831887437e-01   +3.355309006099937e-01   +3.214926639998303e-01   -4.521437463065088e-01   -1.155608600185313e-01   +2.956729248440245e-02; +2.528746542900701e-01   +1.148651498114298e-01   +6.565061723634091e-01   -6.459860571964782e-02   +1.558178392800831e-01   +1.395699966608313e-01   +3.019573873074505e-02   +1.889001931794905e-01   -1.664756024149100e-01   -1.511703268347909e-01   +3.040236814794113e-01   +5.807469900444450e-01   -3.515748120719250e-02   +6.832360962081632e-02   +5.706459556948957e-01   -4.010493397565195e-01; +1.308219401032509e-01   +3.559266668942348e-01   +3.844129782022613e-01   -3.013215106712557e-01   -1.080398976084398e-01   +7.199452715546706e-03   -6.415766213657602e-02   -2.729894098615194e-01   -2.549477359890130e-01   +3.314900021575133e-02   +9.734289773972420e-02   -1.895067085388794e-01   -5.634197007454564e-01   -3.986963609327732e-01   +6.204372900799557e-01   -5.718551124852251e-01; +1.302236766442212e-01   -1.788298622419892e-02   -7.933511440576994e-01   +4.624984620419172e-01   -4.036303262770596e-01   -3.138942087854640e-01   -3.857082778521831e-01   -3.432728552383581e-02   -1.408110711359102e-01   -9.817259634406045e-01   +4.180890809093028e-01   +4.968494087643448e-01   -1.000000000000000e+00   -4.959077256868046e-01   -1.161770091758355e-01   -9.095991699698613e-02];
L2I_L1I_iGABA_netcon = [+4.856001831016579e-01   -1.488083892743983e-01   -9.490676377643052e-01   +7.621275001337315e-01   +7.272158213387186e-01   -1.367965459574938e-01   -1.654739022451181e-01   +1.013712724644709e-01; +2.303935932612813e-01   -7.834379216198377e-02   +2.306653807539705e-01   +7.169271257614084e-02   -1.649666925279844e-01   -2.091060596789848e-01   -1.625755666314449e-01   -3.430256212394263e-01; +4.940382999792287e-01   +1.567768167899154e-01   +4.773727493818861e-01   +7.710933299099857e-01   +3.845965689218430e-01   -7.175047233027733e-02   -7.388470333978205e-01   -2.746356449019274e-01; -3.349805678654157e-01   -6.444127464972843e-01   +2.518847155172909e-01   +5.642181722194873e-02   +1.822953997522791e-01   -5.179769803753905e-01   +9.834229217116100e-02   +1.306792165691304e-01; -1.399821087560890e-01   -4.239718455129285e-01   +3.185693868200070e-01   +6.847699773498939e-01   -6.326695723428838e-01   +6.204193841485119e-01   +7.003211623426792e-02   +8.176924372454191e-01; -1.184931757121804e-01   +2.935122522727273e-02   +1.343082159554383e-01   +2.267495888499448e-01   +3.871861383448523e-01   -1.069828241788849e-01   -6.412105771329927e-01   -1.000000000000000e+00; +7.352184705164411e-01   +1.006069148509157e-01   -2.341049727938968e-01   +3.117726274666778e-01   -5.828549581231119e-01   +7.560743646389280e-01   -8.088589992153220e-01   -6.916082772892992e-01; +3.032997703209494e-01   -5.631649260101922e-01   +2.941007402217685e-01   -6.423137294331775e-01   +3.912459965117943e-01   +6.461193613973121e-02   -1.758878629226057e-01   +3.647435327588881e-01; +3.460074360370771e-01   +6.283828239567135e-01   -5.342399244490509e-01   +3.816917230589628e-02   +2.563501199444688e-02   +4.473037676865724e-02   -1.829778161011997e-01   -2.472832540523605e-01; +4.357009752789238e-01   -5.729837858554491e-01   +5.534330328376695e-01   -3.069607501012064e-01   -3.939306498549069e-01   +6.267580790554428e-02   -4.860350791990136e-01   -2.011859140141255e-02; +5.440203169247304e-01   +2.304106236402496e-01   +4.262291140245965e-01   +3.796965072719474e-01   -5.654054925399427e-01   -2.346571956535241e-01   -3.277189634473177e-01   +2.538045582846669e-01; +3.945853586009056e-01   -7.313534357894279e-02   -3.619580334305787e-01   +8.090563595281027e-01   -1.264650135835701e-01   -1.662643647305652e-01   +7.938790710932618e-02   +9.295408756207396e-01; -3.137324528984710e-01   +7.761328547318566e-01   -4.841201262382909e-01   -5.613573341689543e-01   -1.943010634660587e-01   +8.816225320031504e-02   +5.407679220285235e-01   -2.507273647189098e-01; +1.410469789838068e-01   -3.744727200768546e-01   +1.097805153616673e-01   -3.081851562417366e-02   +9.418372665986750e-04   -4.736473072534534e-01   +3.410988131250581e-01   -1.159743482331306e-01; -2.031539787015612e-02   +4.089128528099071e-01   +8.429743363005372e-03   +2.464418643227869e-01   +1.954484629988357e-01   -3.485283157892272e-01   -2.701565453232659e-01   +6.849773633558803e-01; +6.159687080576779e-01   -4.260682711496127e-01   -1.262989469078926e-01   -3.052645928281453e-01   -1.595161849917134e-01   +1.734830745099992e-01   -2.124653699897055e-01   +3.041123827076630e-01];
L1I_L2I_iGABA_netcon = [+1.521565402903959e-01   +6.511582452077348e-01   +4.113164923572448e-01   -5.110938438935266e-01   +2.339655045249588e-01   +2.734350967192645e-01   -7.228976406405063e-01   -4.440524154273824e-02   -2.315967388696165e-01   +3.331593697542544e-01   +2.587909291847733e-02   +6.537244171383426e-02   -9.085347730090518e-02   +3.563281326788987e-01   +6.392076038558189e-01   -3.805268187276228e-01; +2.155983728608462e-01   -5.856745137005039e-01   +2.397737247338098e-01   +3.197922906319012e-02   -1.935370163519682e-01   +3.924317029012682e-01   -5.314610947335378e-01   -5.890954922901252e-02   +3.067513595892490e-01   +1.526372868138638e-01   -4.359921106706591e-01   +2.265493040988877e-01   -2.581301516900572e-01   -1.877507122779219e-01   +4.602318785153032e-02   +8.109278720353302e-01; -1.917828871967403e-01   -5.099157498551925e-01   -2.517668050114143e-01   -3.643809517592501e-01   -1.940551754147453e-01   -3.084867303724457e-01   +3.140513290257325e-01   -1.207953399178853e-01   +3.693003642593603e-01   +2.109831353873374e-01   +5.873248631597513e-01   -1.321279833245365e-01   +3.137334939255327e-01   -5.897617436605650e-01   +2.457978575408098e-01   +2.243953704530187e-01; +2.500679806666485e-01   -3.932135644701468e-01   +2.306878729664283e-01   +7.747499724830985e-02   +2.493673081050114e-01   +2.399860842753251e-01   +1.841334910214238e-01   -3.692717335811547e-01   +1.974567604186295e-01   -1.225237940869846e-01   -3.420438127610322e-01   -3.880018120150303e-01   +5.630740820389980e-01   -2.839682002162415e-01   +2.554976416054441e-01   +1.690904971580287e-01; +1.828530349323335e-02   -3.096455003472087e-01   -1.592945945931488e-01   +4.980210643504133e-01   -4.520802242714183e-01   +6.318607423941797e-02   -9.684870710557573e-02   +8.204712860711696e-01   +5.686755942962396e-01   -3.289123375315774e-01   -4.446703463600779e-01   +1.000000000000000e+00   +6.183791418828226e-01   +2.771099859278695e-01   +1.700809395107870e-02   +5.343675261916635e-01; +5.120645199587950e-01   -4.207867876292178e-01   -7.550285942416890e-01   -5.148529973858760e-01   -1.562420172613470e-02   +4.214025461019760e-02   -4.511741434747827e-01   -5.222340747368246e-01   -2.531889738803031e-01   -4.817010128767047e-01   +3.575499054571541e-01   +1.386874557017927e-01   -8.996820040559316e-01   -7.644389895717758e-01   +8.104051721314756e-02   +6.581054221227479e-01; -4.467626270020809e-02   +2.824104060813515e-01   +1.785588125959266e-01   -1.686867950422571e-01   +4.811854224762566e-01   -4.531776866260536e-01   -2.124795621987064e-01   -3.298424272587579e-02   -3.620450149988222e-01   +6.783461479136799e-01   +3.881730854242995e-01   +3.154933465607515e-01   -4.924915912257495e-01   -3.662469638617300e-02   -2.247313302884555e-01   +1.294461597248087e-01; -2.732452426027838e-01   +2.918691793912579e-01   -2.372379395695675e-01   +4.998308381277789e-01   -7.942558736372150e-02   +4.382063315114163e-01   -2.993653699309319e-01   +1.810351148768050e-01   -5.071274874296919e-01   -2.822334913203438e-01   -4.781744240365673e-01   +3.412446325547945e-02   +5.650599790848457e-01   +1.481572858680502e-01   -1.921299511500608e-01   -5.978783084608433e-02];
L2E_L1E_iAMPA_netcon = [-6.310242305651370e-02   -1.533314515642524e-02   +6.799505580368905e-01   -1.998985101328648e-01   -1.804102395145529e-01   -3.397697604802771e-02   +5.555971458037360e-02   +4.378583991528374e-01; +6.368998135052658e-01   +5.735798479219404e-01   -1.216505823361611e-01   -2.908313591491461e-01   +4.621156637954661e-02   -2.767367477462545e-01   -1.478143843000220e-01   +4.595975059837464e-02; -2.295310650870492e-01   -9.419551259143922e-01   +2.673144303676647e-01   +1.000000000000000e+00   -1.056770544215389e-02   -4.925654982991947e-01   +4.266450257461569e-01   +2.129249219558556e-01; -8.325681706764676e-01   -4.238886006444471e-02   +9.165370554135180e-03   -2.689945669519786e-01   +2.491415166442837e-01   -1.454583018925922e-01   +7.699403311067412e-01   +2.197677684057152e-01; +5.242273855614505e-01   -6.458123512209953e-01   -2.035320554243082e-01   -9.833187110900556e-02   -8.833942767697887e-01   -8.720888341791000e-02   +3.081019586933617e-01   +1.188756918380455e-01; +1.062598949596890e-02   +3.801963629579124e-01   -1.976074846642033e-01   +8.391548143008241e-01   -2.112683803941933e-01   -1.102158294248675e-01   -7.248136840940003e-02   -1.516106147691360e-01; +5.340452509969318e-01   +5.934514450950197e-02   +3.800866776463368e-01   +6.050987460837632e-01   +1.342633336769221e-01   -4.933855772839054e-01   -7.273295490857257e-01   -2.317918867703538e-01; -7.121453910918556e-01   +2.768047323302603e-02   -3.869937460071258e-01   +2.636268507176696e-01   +1.397404177786039e-01   +7.012245165576639e-01   -5.053932002535273e-02   -1.719906636243808e-01; +1.273370050947768e-01   -9.316525414891598e-01   +8.519446576963208e-01   +2.372435892295529e-01   -7.996201932696871e-01   -3.750141058689647e-01   -4.930464409084091e-02   -2.874763363015788e-01; +2.679083393322821e-02   +2.896693141451525e-01   -1.192156500494751e-01   +4.334518413466942e-02   -6.730824289360764e-01   +7.841818649498898e-01   +2.937382040652098e-01   -8.294285471503668e-01; +8.594923831113532e-02   -3.948749894197247e-01   +4.503398057164685e-01   +6.496976084585644e-01   -5.067104159437025e-01   +3.960214613708296e-01   +1.176479431645419e-01   +2.361229381479524e-01; +2.624073420234214e-01   -8.400879377414762e-02   +4.898504208528469e-01   +6.012995239426674e-01   +3.119996499365528e-01   -2.756011674208998e-02   -1.954023913275410e-01   -2.807769941232889e-01; +7.508335772635398e-01   -1.655541373468888e-01   +2.130006891439995e-01   +4.255048567446819e-01   +1.569352822854952e-01   +4.115360511558267e-01   -2.421884806689986e-01   +1.975811437888352e-02; +1.982205914828565e-01   -4.196291783743468e-01   -3.458092894941180e-01   +2.324659114479686e-01   -4.278204446980590e-01   -3.945792459602342e-01   +8.616758147192137e-01   +5.513184387478965e-01; -7.592210404152555e-01   -2.407084522725002e-01   -3.545597408063316e-01   -3.809023959204804e-01   -4.523700964948395e-01   +7.350991940732501e-02   -2.393245714785052e-01   -1.465169930095346e-02; -5.958179140470291e-02   +1.112411720819727e-01   -1.725017946010135e-01   -4.049787954851352e-01   +7.931414436262731e-01   -3.347765681451050e-01   -5.248724689555180e-01   -1.563671975236544e-01];
L1E_L2E_iAMPA_netcon = [-1.282709072146844e-01   -5.051036419205510e-01   +4.112680563920077e-01   -3.997664523147428e-01   +1.443531155395162e-01   -5.999863379716686e-01   +5.042404745978407e-01   -1.596663744838522e-02   -2.339630419857460e-01   +1.689964503092735e-01   +3.682103987027903e-01   +4.721356357747191e-01   -4.851811159192643e-01   -3.195762651956452e-01   +4.484415239022548e-01   -7.358922166379833e-01; +8.727140960096236e-02   -3.423152532735995e-01   -3.737784868535872e-01   -5.248480998578831e-03   +1.399295559343852e-01   -3.303423351511209e-01   -6.058737936160319e-02   +2.473177008881112e-01   -4.363459140668942e-01   -2.847784231828768e-01   -6.279375593393383e-02   +4.380938453568018e-01   -2.452708373666378e-01   +4.413752197158897e-03   +4.056198288648862e-01   -7.309481012405608e-01; -3.038883747581259e-01   +4.580472632109253e-01   -4.056414325363926e-01   -5.794702932605913e-02   +1.929717887380064e-01   +7.097556260425523e-01   +1.562631010502723e-01   -9.762425437056557e-02   -6.966106515074770e-01   -2.837643105106150e-01   -7.916445695606622e-02   -1.373364678132782e-02   -1.935603688853041e-01   +6.498421268257246e-01   -1.644668972686392e-01   -6.805337598724050e-02; -4.701852184627182e-01   -4.991239997605646e-01   -7.406949252129833e-01   +6.675564042886337e-01   -2.295844591114871e-01   +1.222566391536947e-01   -7.572746978031489e-01   -1.945756881078079e-01   -4.689984351217386e-01   +1.143141134089519e-01   -1.167231401171993e-01   -3.887061613641795e-01   -7.104227128446065e-01   +7.889936342582934e-03   +6.344745932101701e-01   +3.194518287370400e-01; +8.854043885089196e-01   +4.553328182352464e-03   -1.232314653377113e-01   -4.017403933902752e-01   -1.492094477796475e-01   +6.090231439301586e-01   +8.664953593028011e-01   +5.461815753576799e-02   -1.168374943511141e-01   -2.122812714169522e-01   -6.345300881152333e-02   -6.582003284658974e-01   -8.643919878143904e-01   +4.273163629442431e-01   -2.110142763372451e-01   -9.064315575409579e-02; -3.705365133669407e-01   -9.304470626391086e-01   -5.741390649710110e-02   -4.395774751484866e-01   -2.401540154004881e-01   +1.738344081779593e-01   -1.155427222459235e-01   -3.907090741174919e-01   +2.045425334825035e-01   +8.044180446000512e-02   +1.144946301840699e-02   +1.963943833342413e-02   +2.111538341078568e-01   +2.743399697567191e-01   +3.783250484472032e-01   -4.577940453476952e-01; +4.466891273690355e-01   +6.392753564484366e-01   -1.272311226315108e-01   +9.354758142404257e-02   +1.795065678873396e-01   +1.417767980504105e-01   -6.494948303257870e-01   +1.339674784991860e-01   -3.139518620035512e-01   +3.964005344457169e-01   -2.655889196929526e-02   -6.657797165062372e-01   +9.386407525698476e-02   -3.408213669909141e-01   +1.839415064591776e-01   -1.853348941307805e-01; +1.998927144779773e-01   -2.713514394172206e-01   -9.110828778946033e-02   -4.725583398813940e-01   +4.293148430114128e-01   +2.750421256299350e-01   +4.715839954975376e-02   +6.211381529907412e-02   +6.681717163251455e-01   -6.100294068979016e-01   +3.079893954492324e-02   -2.111944869038800e-01   -2.247833719156242e-01   +2.552795739263272e-01   -8.561839338125915e-01   -4.336221072797657e-01];
L2I_L2E_iAMPA_netcon = [-2.506730201683649e-02   -3.948325236202542e-01   +4.982725093505763e-01   -9.725370579012867e-02   +2.683938830891242e-01   -2.032220063419667e-01   -2.858295061588638e-01   -6.062073942197351e-01; -7.155800413521342e-01   -9.528319900665422e-02   -3.362999064813535e-01   +3.979716424233686e-01   -1.788612370454613e-01   -2.718320125871329e-01   -3.801101758490942e-02   -1.797606583763388e-01; -2.630078910232652e-01   +4.235265110532128e-01   -1.644312268114628e-02   +1.000000000000000e+00   -1.159966442836892e-01   -2.623546730262800e-01   +1.179394448514968e-01   +3.966354239764570e-01; +6.872493275337627e-01   +2.809202754827489e-01   +2.746844505830746e-01   -4.841358668747573e-02   +2.794602126394333e-01   +2.076369302563107e-01   +5.814515559875294e-01   +6.177832983999696e-01; +6.386886627254785e-01   +7.034656733933959e-01   -4.880908120849393e-01   -5.892558261738818e-01   -4.100091197802651e-01   -5.336109868141573e-01   -5.960567168289336e-03   -5.230864486600515e-01; -1.016681337776019e-01   +2.991980578092628e-01   +1.933524732355431e-01   +9.107923449270817e-02   +6.119558343662606e-01   +4.776719407194021e-01   -3.925077837056081e-03   -7.520781140467524e-03; +3.615068405717554e-01   -9.227866282025881e-01   +4.556219122866810e-01   -1.324303886326738e-01   -1.930635234840431e-01   -8.058413550355014e-01   +2.284851300661863e-01   -2.314915513804433e-02; -3.844916395108872e-01   +5.614879177198376e-01   +7.311184727392634e-01   +3.994908574727800e-01   -2.182981968221981e-02   -3.410003586636544e-01   +9.832845640264688e-02   -2.343944979500612e-01];
L2E_L2I_iGABA_netcon = [+3.593007000643303e-01   +7.933719573184432e-01   +6.937872157108930e-01   +6.130284519766566e-02   -5.898245142237675e-01   +5.904183089716658e-01   -4.399299270776319e-01   +5.004206829158473e-01; +1.259927647401261e-01   -2.806097504868185e-01   -1.536259414660507e-01   +2.299411668132902e-01   +6.982754348846683e-01   +3.013373517354447e-01   -2.443699961554023e-01   +1.234212776341559e-01; -3.058637793855534e-02   -6.223417294342386e-01   +1.776314680495824e-01   -2.641418775817210e-01   -3.613424785208484e-01   +4.741030398841037e-02   +2.594671343258373e-01   -8.922274606607851e-02; -6.943288715367381e-02   +5.474862430644841e-02   +2.782392051568540e-02   -3.261318032806910e-01   +2.257538970477717e-01   -1.079718785580497e-01   -9.380304294297186e-01   -2.503982915539337e-01; -2.636270697193823e-01   -3.086029852153858e-01   +8.480258439725452e-01   +5.159825866567952e-02   -3.481188999448090e-01   -5.189310996914875e-01   -1.103133932620199e-01   +1.454865568955800e-01; +3.458282645824303e-01   -7.042453476226772e-02   -5.752618243158851e-01   -8.872133138801254e-02   -2.160282669464804e-01   +3.884427446964754e-01   -1.740220578455088e-01   -2.247948362493360e-01; +3.556662720025066e-01   +3.123849797274067e-01   +3.707656051914796e-01   -6.909276270379623e-01   -3.226021034262038e-01   -5.211226532463866e-01   -5.410678944720472e-01   +1.340234706067243e-01; -2.460114846906166e-01   +2.989048329132357e-01   +6.081322692584592e-01   -4.457885132697211e-01   -2.778089323263795e-01   +6.548514304817610e-01   +5.436739505203334e-01   -7.037204890576747e-01];
L3E_L2E_iAMPA_netcon = [-2.521287241218896e-02   +2.259352619539245e-01   -1.361476090925567e-01   -6.492804297195683e-01   +3.847563320688683e-01   -3.807205965404122e-01   +9.490069160239246e-02   -7.070837024690354e-01   +3.626414097287837e-01   -2.330611965737759e-01   -2.280438104484855e-01   +1.622457343575028e-01; +1.898980494628796e-01   +8.256525494648292e-02   -7.510268052070304e-01   -7.008605941106592e-02   -9.988523562516367e-01   +1.366629786787026e-01   -5.814749575894189e-02   +5.331909555095061e-02   +4.763412007910059e-01   -6.853643449234682e-02   +2.536957208138899e-01   -5.804378936947971e-01; -1.094570429371576e-01   +3.225480252468932e-01   +3.981777454360528e-01   +3.957980106585532e-01   -4.646217335463192e-01   -2.333707209743149e-02   -4.607448794589448e-01   +6.671208841847253e-01   -4.462110965963617e-01   +1.422999143479482e-01   +2.190454861957015e-01   +2.452686151448703e-01; +2.636819700838669e-01   +9.851508615768173e-01   -5.166087306325367e-01   +5.116869934789156e-01   +4.969754545327025e-01   -1.004305194833525e-01   +2.892791498749092e-01   -4.043975134386630e-02   -4.727966985428789e-01   +4.863859794212509e-01   +9.633535900229711e-01   -3.251102824326773e-01; +3.254825108736789e-01   +3.860125449203350e-01   -3.085565458190317e-01   +1.685587766014394e-01   +5.242758313700053e-01   -1.187928687660583e-01   -4.940881875106479e-02   +3.784842818053334e-01   -2.133561632671260e-01   -6.593694765382098e-02   +9.374131545995426e-01   +3.117287827857853e-01; -4.125923161432783e-01   +5.189321955358157e-01   +2.324930577258639e-01   +5.701729872233287e-01   -4.162578550681616e-01   -4.775693038349415e-01   -3.539601684657659e-01   -2.706455144414641e-01   +4.085016945504333e-01   -5.482017951413994e-01   +2.089058498215039e-01   -3.211705651985815e-01; -1.087122123940016e-01   -5.455676159951846e-01   -6.501620737301427e-01   -2.372181253167599e-01   -2.442544747312254e-01   +2.352877740165006e-01   -8.702061618014439e-03   +3.881916133378068e-01   -5.357218954750195e-01   -7.851714583536035e-01   +8.352459343176115e-01   -4.713946124713498e-01; -9.625631273998753e-02   -5.331733954020375e-01   +5.826468486874622e-01   -2.917223646790801e-01   -7.988513871707078e-01   -1.000000000000000e+00   -5.413780944953218e-01   -7.195087382588231e-01   +8.886772110414800e-01   +6.327682010331439e-01   +4.306369607038629e-01   +8.251859321457040e-01];
L3I_L2I_iGABA_netcon = [-5.372969029484932e-01   +2.165627005454736e-01   -6.086310720610185e-01   +9.551158376892313e-02   +1.002968002074107e-02   -2.597045578478656e-01   +3.428242801363543e-01   +2.279455836377455e-01   +6.942462210076720e-01   +5.683109832463243e-01   -2.057348376565566e-01   +3.945074396332920e-01; -1.798006823245545e-01   -2.185086284415727e-01   -1.025011629284155e-01   -8.582734478529545e-01   -5.498179054808925e-01   +9.899390931589382e-02   -3.961229035400075e-01   -7.739292793888730e-02   +8.307884534248368e-02   +1.913905919368563e-01   -3.049078708591106e-01   +5.279086497620353e-02; -3.567868118095467e-01   -1.146273106727234e-02   +1.557384192479363e-01   +4.446921250645395e-01   -6.465419105787189e-01   -1.666397890015909e-01   -2.854242736834937e-01   -4.223652954307873e-01   +6.124184223514436e-01   -1.144684977789087e-01   +2.260567328118923e-01   +2.071793938389305e-01; +8.173468267310122e-02   -8.639624026773915e-01   +2.784566867201095e-01   +8.314056700140306e-02   +1.394189442180390e-01   +2.284513938334647e-01   +3.376890149299758e-01   +3.457332919315719e-01   -2.862253078936419e-01   -3.762853602848202e-02   +8.056966212400833e-01   -5.998972886694491e-01; -3.852531562420073e-01   -3.769064440842959e-01   +2.796392010956016e-01   +8.032569105385719e-02   -5.645055628020187e-01   -2.391311648686425e-02   -2.967100815068142e-01   -4.859972737877580e-01   +2.246097981948385e-01   +3.230887282316176e-01   +2.862989135981500e-02   +5.584623246565470e-01; -1.176934089439823e-01   -6.748948081790831e-01   -3.805727840550805e-01   -6.633322921011523e-01   +3.457784368978900e-01   -3.899176728450529e-01   +4.782742428803100e-02   -4.000148306129528e-03   -3.795265025506493e-01   -1.527063799217109e-01   -3.467366497503177e-01   +2.841221141051735e-01; -2.692639623644909e-01   +5.126963042424644e-02   -4.737302763525592e-01   +2.130124411862788e-01   -3.490771101846785e-01   -5.492723183940217e-01   +2.029299041015774e-03   -1.177391817527666e-01   -1.804550828717846e-01   -6.886167553632887e-02   +6.503592383478166e-01   +5.533690127004979e-02; -4.685097082795261e-02   -6.370628209686444e-02   -1.592286030952514e-01   -5.455937116956865e-02   -9.884415700936706e-02   +1.000000000000000e+00   -1.287108288110825e-01   +4.300513002856626e-01   -1.588870409677265e-01   -7.703477517137585e-01   +1.236726459151645e-01   -1.597659676543159e-01];
L2E_L3E_iAMPA_netcon = [-3.089450031028851e-01   -7.003287445441424e-02   -3.197042528531632e-01   +4.857045307291757e-02   +4.037076640289213e-01   +7.657786033820801e-02   +4.487284766673743e-01   +2.685578136568501e-02; +3.905420028010312e-01   -7.080698311638844e-02   -1.446038348406378e-01   +2.836707771463033e-01   +1.127576652792833e-01   -4.191006403139746e-02   +1.483563004942813e-01   +4.803116441675254e-01; -2.766520445002986e-01   -4.028586384065786e-01   -5.749592404460316e-01   +1.588214690780446e-01   -1.885562539588763e-01   +7.790135160860696e-02   -1.000000000000000e+00   +4.164868067290894e-01; -6.808279595337912e-01   -1.314690458208362e-01   -3.644887391010259e-01   +2.783592356952600e-01   -6.072555501393906e-01   +6.862542419759478e-01   +8.363436965007794e-02   -1.046706659168921e-03; +2.909557529045675e-01   -2.338607366194226e-01   -5.637985100356685e-01   +2.122208660057570e-01   +6.532468052648829e-02   -4.416337575010060e-01   +2.986380112573758e-01   -2.217787474418374e-01; +1.510401930164314e-02   +5.704213693896916e-01   +5.176933212373608e-01   +4.243075285541329e-01   -6.766626758188082e-01   +1.993440783896949e-02   -2.056008763347776e-01   -4.070159602291363e-02; -4.261121314262068e-01   -8.260083785721460e-02   +6.598655822817479e-01   -9.794002199668499e-01   -2.304134167333234e-02   -6.666452874043872e-02   -1.638218205054917e-01   -3.384862742512948e-01; +2.689214070765312e-01   +2.883227033188152e-01   +4.371707434200799e-01   +1.969500168624014e-01   -6.463149097717035e-01   +3.219486550526979e-01   +3.081713667078197e-02   -2.185935115326727e-01; -8.162494259535423e-01   +7.735842414167392e-01   -7.684799976187430e-01   +6.688192940205462e-01   -2.637922993290269e-01   +1.114427703437189e-01   -2.327717169546225e-01   -4.878573523424396e-01; -5.981554569371138e-02   +1.902435009918609e-01   -7.948714144583066e-01   +2.168194840625467e-01   +3.262447601094318e-02   -2.109466355405947e-01   -3.958898043455779e-01   +2.655714838329957e-01; +3.645410548427802e-01   -2.903619711013115e-01   +1.513814701312605e-01   -4.248620708281884e-01   +7.391999748693033e-02   -1.667293333282030e-01   +3.396986824941698e-01   -2.167887923586911e-01; +6.886266491330256e-01   -2.536338530541614e-01   +5.868399197636512e-01   -4.930658845348432e-01   +9.433368272725146e-01   -4.604568029423924e-02   +5.357744135659408e-01   -2.299896607587580e-01];
L2I_L3I_iGABA_netcon = [+2.272965731429689e-01   +6.721903356172393e-01   +5.838524698665817e-01   +1.205819078451938e-01   +2.456291977945671e-01   +1.857127263367049e-01   -3.045471685137756e-01   +2.370973944335981e-01; -3.908907292317326e-01   +1.000000000000000e+00   -8.784075618353823e-02   +1.122997685469230e-01   +6.454683506075455e-01   +1.203870126141449e-02   -7.390407753230489e-01   -5.099625675577082e-02; +8.665583015416416e-02   -1.990526464563767e-01   +6.129783258280873e-01   -6.647906989487786e-01   -3.467137394900089e-01   -6.439423448762288e-02   +1.643873455997139e-01   -2.429243217033664e-01; +9.185488039032167e-01   +7.039506082500030e-02   +7.067850277917173e-02   -2.032118241305877e-01   -9.368865614374865e-02   -2.418731859818012e-01   +5.517862536972795e-01   +1.375460192642558e-01; -5.889496220756506e-01   +6.076675739319625e-01   +1.428328787202265e-01   +2.043489738729442e-01   -5.171542606198749e-01   -2.626399353082890e-01   -2.044480842174056e-01   +1.335438308871189e-01; -1.063173793651666e-01   +4.627209410611525e-01   +3.999418207140482e-01   -3.203686072642378e-01   +1.985554683012933e-01   -4.398459403802877e-01   +6.253270557443388e-02   -3.584949610741437e-01; +5.114811416610057e-01   -3.952870148670052e-01   -2.240297316393780e-01   -7.454536377970024e-01   +7.969964305414996e-01   -5.459787488895094e-01   -2.559502924740673e-01   -5.213489400674741e-01; -1.662618051264751e-01   +1.271318688594570e-01   -4.869685723174056e-01   +5.081874455129910e-01   +1.649939884071942e-03   -2.372893612757098e-01   +5.831138708700682e-01   +3.405143270196366e-01; -2.080765131050406e-01   -1.419809883459518e-01   +4.035083224838955e-01   +6.738877687283278e-02   +2.403501294370504e-01   -7.255214330686924e-01   -4.880862235517917e-02   -4.778105244835685e-01; -3.498275680577685e-01   +2.976154789092162e-01   +2.103928856732459e-01   +3.006505348863476e-01   +8.437791383530117e-01   +5.197418099130618e-01   -3.566661228321850e-01   -9.190359019055767e-01; +3.535222908467083e-01   -4.617015622099085e-01   -5.334643812500109e-01   +1.282240259743253e-01   -1.724279122009042e-01   -4.855286631171630e-01   +1.637817154058144e-01   +2.074869395796765e-01; +6.831586102410891e-01   -2.418098208037684e-01   -2.292701552122936e-01   +1.903484677906365e-01   +5.992646268042687e-01   +2.800012316020093e-01   -3.948465104844455e-01   -2.556245371709403e-01];
L3I_L3E_iAMPA_netcon = [-3.283615197473881e-01   +5.466947989824947e-01   +5.351979093839768e-01   +3.737979924859347e-02   +4.665765148998834e-01   -1.410407054042541e-01   +5.757068648026926e-01   +1.589182824548280e-01   +5.026773155693910e-01   -4.088201455156720e-01   -1.643023236043557e-01   +2.383650606097124e-01; -1.680435290391170e-01   +7.959642086482954e-01   -8.675675407318661e-01   +1.294272520055198e-02   -1.964711008756471e-01   -6.038878908715425e-01   -4.929359577894086e-01   +3.485787711453419e-01   -3.879586390499020e-01   +1.453414401293236e-01   -4.460446263045113e-01   +4.483915088727786e-02; -9.566184940352113e-01   +1.596522120154724e-01   -2.745833153607921e-01   -8.009201549077973e-01   -2.687454435287420e-01   -1.827654924163150e-01   +1.323124092613566e-01   -4.089212888407953e-01   +1.535783920817352e-01   -2.324029021359350e-02   +3.486982570386858e-01   -3.963688233241605e-01; -1.176273740539282e-01   -4.903251016090078e-01   +6.798426254322276e-01   +7.074898882686249e-01   -3.302255616501043e-01   -7.687923539026482e-01   -3.213201084545876e-01   +1.862991315054562e-01   -5.249630971193572e-01   -1.040376363341627e-01   -8.965073192677547e-01   +2.357674543527593e-01; +4.675252441723699e-01   +8.663297116726389e-01   -6.319880422452282e-01   +5.790209630781451e-01   -1.971208532411756e-01   -2.716409752018140e-02   -4.664129325381006e-02   -2.449308739628124e-01   +5.308275370014000e-01   -3.217400444982635e-01   +7.086430052776498e-01   -1.179691579752734e-01; -2.348705571818189e-01   +6.638609545513896e-02   +2.132952759423039e-01   +1.241688981848446e-02   +1.654905001492927e-01   +1.058719845998412e-01   +7.230785623954944e-01   -2.814357829741471e-01   +6.054237270163778e-01   -4.243301307491538e-01   -1.702878526970162e-01   +2.364736029356601e-01; +3.116884088774676e-01   +1.181719007550710e-01   -5.124433485608433e-01   +3.421837399987269e-01   +1.905690353669032e-01   -3.308333475303419e-01   -3.010619407955414e-01   -2.279856901297392e-01   +6.492988598378832e-01   -4.097135636776337e-01   +2.632386910927831e-01   +3.302761455646291e-02; +2.916222443906292e-01   +4.950835553323033e-01   +4.397698886526079e-01   +7.441142422715799e-02   +3.210927929251057e-01   -6.750639310516074e-02   +5.191981667043717e-01   -6.077150586648530e-01   -7.944571335289220e-01   -5.477866096317400e-01   -4.820230648475504e-02   -9.382080733350051e-01; -7.059239487793885e-01   -2.350712742651057e-01   +1.371247134966148e-01   +4.506078413333401e-01   -5.790364838997770e-01   +1.006474126923271e-01   +5.744464569916993e-01   +2.281087850858109e-01   +6.885211651194916e-01   +6.786199220497882e-01   -1.787423948916971e-01   +4.101102363729525e-01; -4.839739973215708e-01   +2.195862809341055e-01   -9.242289007971123e-01   +2.347998615248021e-01   -5.939242941564682e-02   -2.770121329456074e-01   +3.545360139970335e-01   +1.362726963466112e-01   -3.005636980850864e-01   -2.359901291040489e-01   +6.796520556443192e-02   +4.888263267663362e-01; +4.523706608470197e-01   +5.311552357051310e-01   -5.192071303373520e-01   +4.631106138350681e-01   +3.900954366997723e-01   -4.483285287734295e-01   +1.383992761348691e-01   -5.615330091236339e-01   +2.980377826312002e-01   -5.430207285685995e-02   -3.140624834388064e-01   +6.792054366899812e-01; +4.123341329602324e-01   +8.695334202348240e-02   -3.611810304716573e-02   +2.059363376140376e-01   -8.709183447363444e-02   -1.941094785340397e-01   -5.961382572591341e-01   +3.000284533949347e-01   -3.010625551762529e-01   -1.609614562774759e-01   +3.848234767792283e-01   -2.101684426570147e-01];
L3E_L3I_iGABA_netcon = [-2.011069588659835e-01   -3.281870374361970e-01   -2.482612487986370e-01   -5.883335588829940e-02   -8.706910483004551e-01   -2.739938289805340e-01   +6.798581706691414e-02   +6.822131079812875e-01   +3.632979744214043e-01   +3.287346654432124e-01   -7.240382567036004e-01   -9.005746989007635e-02; +3.841574947723023e-01   +8.052164813608531e-02   +7.403401190645211e-03   -1.740508256626605e-01   -3.114148704685989e-01   +1.960972416298723e-02   +4.157750111474812e-01   -3.670511995585795e-01   -1.892933227426274e-01   -4.767178393247379e-01   +7.578352257245565e-01   +3.922690306429089e-01; +4.161287836601161e-01   +1.880922685579940e-01   -2.129066278489873e-01   +3.667701304833855e-01   -6.814360861119725e-02   -4.924753605342131e-01   -3.255496522771995e-01   -2.531685740071782e-01   -4.512245794078456e-01   -2.076877039962398e-01   -7.413737814629913e-01   -5.698614528659689e-01; +3.210860618493066e-01   +4.624854585083891e-01   -1.850219298181081e-01   -7.944571629056877e-01   +1.289231855753343e-01   +2.200121030286627e-01   -3.894997456585846e-01   +1.101496543693920e-01   +6.589591384158109e-01   +2.589289997097832e-01   -1.780062961518703e-01   -1.219043832204580e-01; -8.667007591903573e-01   -9.499193293650479e-02   -4.857103440461242e-01   +1.009971620569855e-01   -2.562787799631435e-01   -6.600381056790434e-02   +4.673911170633968e-01   -2.541728105791450e-02   -8.364066634490079e-01   +2.333354256211488e-02   +9.820022707274635e-02   +2.896377997412717e-01; -1.553812630351583e-01   +1.652951724874547e-01   +4.665351721909503e-02   +4.020089571099340e-01   +6.943232817426583e-01   -6.210559155780987e-02   -1.213812568906296e-01   +8.662032589338635e-01   +3.276603942758443e-01   -1.659564061042615e-01   -5.456303292566723e-01   -2.677833437710003e-01; +4.280563575625816e-01   -1.432662499716465e-01   -3.115778994420175e-02   +3.536945837441526e-01   -4.826227521453090e-01   -7.917651031703312e-01   +2.047650704438737e-01   -5.528948771917862e-01   -2.339028880640905e-01   -3.272312505416580e-02   -1.257882349536170e-01   -5.076395696092467e-01; +4.177182662663508e-01   -4.984350329842422e-01   +2.939374775796173e-01   +2.658237350177406e-01   +1.855780396219919e-01   +3.576123005427539e-01   -1.000000000000000e+00   +1.589102916708237e-02   +4.100876785462217e-02   -7.423119568636796e-02   -1.902834409904150e-02   -3.209953467828938e-01; -4.648336397374867e-01   +1.451221404349937e-02   -6.737853644360479e-01   +6.534083848323650e-01   -2.299608016050343e-01   -3.234179556451751e-01   -3.148422269037874e-01   +1.072373573718959e-01   -6.466724431229919e-01   -6.431296615849985e-01   +5.975577079834082e-02   -1.949832153921728e-01; -1.335076662339629e-02   +2.225223602063563e-01   +4.693574601759758e-01   -3.336867030710982e-01   +2.094926628333842e-01   -2.499176042667833e-01   +4.470349021196512e-01   -1.070242689329064e-01   +6.367486554353412e-01   -2.478639980195902e-01   +5.316801548091640e-01   +4.335968148584475e-01; +4.011006956899578e-01   -5.084724315260562e-02   +1.339209711095609e-01   -9.371900075971512e-02   -4.659932892100220e-02   -4.286357210251717e-01   +1.922900399891236e-01   -3.436189885579758e-01   +3.251541770031128e-01   +1.714068773552008e-02   +5.716475819728382e-02   -2.557880075129971e-01; +6.805798500849681e-01   +1.559272706821778e-02   -7.766588554105929e-01   -9.360139859318958e-02   +9.655072904778385e-02   -7.044139873656353e-01   -9.541353062943393e-02   -2.527531237367120e-01   +3.789955162571425e-01   -3.592193017903751e-01   -3.854253394032364e-01   +1.692961257242674e-01];
L2E_Input1_iAMPA_netcon = [+3.174443683702893e-01   -4.421981773151938e-01   -5.892874303401241e-01   +2.184897276467298e-02   +4.077462450734161e-01   +8.406098201731508e-01   +3.754445140162532e-01   -1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [-5.881519053534959e-01   -3.885379994048719e-01   +5.696555915505750e-01   +1.129793218754288e-01   -3.139440084999916e-01   +2.596020239443979e-01   +3.242559519743407e-01   -4.579514474707556e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
