function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.308017162910883e-01   -1.843117210539242e-01   +8.307766500095748e-01   +7.417367480908255e-02   +6.255687400734985e-01   +3.552248484428125e-01   -3.860416453023926e-01   +1.000000000000000e+00   -1.871091697663463e-01   +4.424183727778480e-01   +1.023919264641537e-01   +1.777262817913759e-01   +4.862846503766267e-01   -4.896432624115190e-01   +3.723424353285071e-01   +4.822564785415774e-01; +1.470006754580986e-01   +1.801420923254467e-01   +6.836296742875601e-01   +5.885071994175725e-01   +2.475482025520833e-01   -5.608671646120691e-02   +1.168621476460014e-02   -4.393691003254780e-01   +6.664689657869595e-01   -2.562717277135876e-01   +7.794442823795621e-02   +3.226593335866546e-02   +1.577041060158670e-01   +2.538098945594163e-01   +2.626848311966397e-01   +9.368644199005444e-01; -1.706812528999777e-01   +6.396620138430957e-01   +1.927264809908555e-01   +1.698065722541551e-01   +4.360848379885303e-02   +7.739328684390685e-01   +1.070449586685820e-01   +3.755795947750024e-01   +5.039325459520770e-01   +1.769466892416729e-01   +7.791916032048426e-01   +4.569068337960455e-01   +9.263158543333542e-03   -3.951462359455889e-01   +6.272795724535015e-03   -5.963488544413962e-03; +3.548684670617873e-02   -8.707709885274541e-02   +1.115023698718814e-01   +7.501028536093021e-01   +1.654758645817548e-02   +3.541414476248572e-01   -1.580846122080852e-01   +5.875041498265687e-01   -2.081347250000614e-01   +2.709495660283520e-01   +7.181015599437969e-01   +4.364401319146110e-01   +2.087410818129574e-01   -3.413500160220586e-01   +8.272287762871493e-01   +4.828075309558184e-01; +9.875519859169116e-02   +3.523747474952011e-01   +2.310661737471090e-02   +1.654240203691626e-01   +5.228111203565770e-01   +6.153776591444684e-01   -3.864381343967603e-01   -5.014538587545326e-01   -3.411318742345565e-01   +3.346384248620907e-02   +1.020234674509474e-01   +8.400702679183399e-02   -6.993365110063439e-01   -1.568378777218564e-01   +1.293042767835037e-02   +7.546815641233781e-01; +1.001183516075229e-01   +2.139080640150020e-01   +5.635941918054960e-01   +5.640692626685927e-01   +2.458393749469354e-01   +7.775939405106689e-01   -5.197694136126884e-01   -1.908074937223034e-01   -6.649700879680384e-01   +3.612896812783751e-01   +2.887956681047916e-01   -5.318673132230430e-01   -1.304942623821611e-01   -2.101814427105868e-02   +7.953320484784799e-01   -6.642358089679044e-01; +6.624767652529604e-01   -1.983366869157421e-01   +2.999227456401882e-01   +3.370949045860530e-01   -2.981320967131836e-01   +2.984377095661878e-01   +2.038136590112392e-01   +3.708467194185859e-01   +7.506920631239514e-01   -3.465571314889128e-01   -3.425619813250839e-02   -2.473409196833085e-01   +5.828916889485973e-01   -2.712792576289882e-01   -2.287243324848541e-01   +1.228510144316134e-01; -4.058845051115418e-01   -1.352873679429252e-02   -4.614278678072092e-01   +3.258663485614754e-01   -5.164329430340001e-02   +7.463472446538073e-03   -8.914887054364679e-02   -1.560275061562556e-01   +6.206523566269951e-01   +6.117215545803349e-01   -1.544335205080861e-01   +8.186054103940583e-01   +1.156077037469320e-01   +2.055730561429507e-01   +4.137854756743985e-01   +8.052028319357819e-01; +3.411767820423889e-01   +1.592526425104532e-01   +7.650199578979691e-02   -2.842336726576040e-01   +7.341331539722767e-01   +5.727372360686703e-02   -3.465436254698074e-01   -3.465393032626709e-01   +6.978316498281842e-03   -1.261015494436827e-01   +5.639449186278769e-01   -2.948316017275492e-01   +4.235678643885201e-01   -1.096990929211620e-01   +1.275940901478970e-01   +7.047914378077331e-01; +2.136063694125190e-01   +2.218630622792491e-01   -4.053311859410488e-01   -1.832071072065313e-01   +4.342323775646609e-01   +5.090334800672652e-01   -4.852164097098500e-01   +6.583917035141434e-02   +7.166898232231345e-01   +3.043280551294839e-02   -1.694044454403654e-01   -9.563685423527275e-02   +1.826001475654636e-01   -2.513651819449151e-01   +4.960181522939301e-01   +1.346097407537962e-01; -3.429147643879485e-01   -4.502746186462545e-01   -2.169367797728286e-01   -5.323448423765231e-02   -1.544912993459338e-01   +4.365210437058589e-01   +5.221599028295925e-01   +1.088873397707086e-01   -2.443893386800268e-01   +2.780984243296958e-01   +9.757477153030885e-01   -1.130477293427853e-01   +3.128346226633877e-01   +4.761905408377232e-01   -2.441448857105508e-01   +1.332532010391750e-01; +3.633910192796559e-01   -2.855828000686552e-01   +2.293474143362056e-02   +4.650018702330361e-01   -3.214318699188280e-02   -2.162503584689136e-01   +8.907070311003058e-01   +2.459351956022643e-01   -4.432940710120321e-01   +5.397273442924209e-01   +2.095796200920207e-01   -4.422001078379375e-01   +5.468141138582752e-01   +9.194934011371609e-01   -1.044813815600847e-01   -5.168127556767757e-02; +4.143812966481072e-01   +2.888820015089084e-01   -1.757391421444454e-01   +1.229793191974829e-01   -3.248599583659463e-01   +3.017778593849419e-01   +2.778763312934845e-01   +5.473015186035329e-02   -7.436748688574728e-02   -7.716831350633244e-02   +2.167673228864127e-02   +5.626844147601348e-01   +4.258698081724784e-01   +2.774590178058362e-01   +1.994215192183868e-01   +3.463240421912252e-01; -4.162827849041487e-02   -2.787409463315548e-01   -1.356998276704174e-01   +6.518822766616643e-02   +3.461977305655143e-01   +7.231636612304149e-01   +3.033042508558925e-02   -2.724594629197044e-03   +3.906449804305621e-01   +7.224474954661844e-01   +8.174457682853575e-01   +2.366925879068527e-01   +2.488503950840565e-01   +2.062811070843918e-01   +7.376595149080905e-01   -5.451933967687306e-01; +8.304162817301659e-01   +2.162981638915223e-01   +3.379001198418726e-01   +5.091763460906347e-01   +7.754649238143811e-02   +1.217119931811317e-01   -1.246116079443592e-01   +4.422740381235019e-01   +3.661105522910315e-01   +6.295474808045832e-01   -2.215865810092558e-02   +5.639231867143062e-01   -3.793274086174365e-01   +3.387446066172557e-01   +4.804256872093286e-01   -4.116896400418863e-02; +9.317680163322510e-01   -4.006985086533748e-02   -8.261682135554295e-03   +3.527953967732554e-01   -5.351955964285609e-02   -2.716996423069784e-01   -1.223580443405645e-01   +5.112281039081706e-01   +6.336166833053706e-01   +8.131022089397831e-02   +3.113551628320832e-01   -2.237854868369612e-01   -1.472780499768597e-01   +7.129676180291611e-02   +3.892071873672353e-01   +2.646501813461189e-01];
L1E_L1I_iGABA_netcon = [+6.130018265303024e-01   +2.189980815910225e-01   +1.435696931619702e-01   +4.637609170192881e-01   +3.595030019652969e-01   +7.725864282190850e-01   +8.718929753246951e-01   +3.446761957682740e-01   -8.645692219270833e-02   +3.280287878477062e-01   +4.257080269143277e-01   +6.663036910966651e-01   +4.818917256258063e-01   +8.847418428780177e-01   +7.260799528103075e-01   +5.420690705684118e-01; -7.496075293876374e-02   -7.506424183367624e-02   +5.026796157417133e-01   +7.662285667221150e-02   +2.929500990411368e-01   +1.937577950390373e-01   +8.144520131015336e-01   +3.489381813107325e-01   +4.195007419178914e-01   +7.846854106564123e-02   +6.274299318855885e-01   -2.307885932603174e-01   +1.769222481718102e-01   -3.993965601309133e-01   +6.419665207053753e-01   -1.859025753728195e-02; +6.507668345628158e-01   +6.156062954892588e-01   +7.297123887929453e-01   -6.814070073978093e-02   +1.343553109279513e-02   -2.366100169048297e-02   +2.286499318764866e-01   +4.971691265432089e-01   +3.995703412220067e-01   +3.511102129435369e-03   -3.626382910152499e-01   +7.486470380449967e-01   -7.864446360070734e-02   +4.070356006305248e-01   -4.122482015008245e-01   +8.252275672600110e-01; -1.244886924702861e-01   +9.263798371117316e-02   +3.548567117162955e-01   -2.870293076470501e-01   +1.138551703627236e-01   -1.299858844363604e-01   -2.850260810048788e-02   -3.535975659684039e-01   +2.859435950076131e-01   +7.453925983549681e-01   +5.485356701681542e-01   +4.763021595465695e-02   -1.114657596689799e-01   +1.323071589035777e-01   +7.095469302561248e-01   -6.539869947177940e-01; +2.872095174611909e-02   +6.271267300209635e-01   +3.266243033024873e-02   +8.421666500078871e-02   -1.661928748939183e-02   -1.643052225441446e-01   +1.899506174669005e-01   +3.302300164753413e-01   +5.051290127494903e-01   +5.401378521810252e-01   +5.478786284668385e-01   -3.137832445811496e-01   +2.841271730264433e-01   -1.109739304433452e-01   +1.561609697424365e-01   +2.884164611971498e-01; -4.880989321080789e-02   +9.424637897050360e-02   -3.685063333483932e-02   +4.627560751098867e-01   +3.550540128389541e-01   -1.770991351253357e-01   +1.474206545209510e-02   -8.930133127504311e-03   -2.277956968006729e-01   +3.630802041674717e-01   +3.143190872368282e-02   +3.364082181065502e-01   +4.514925867790285e-01   +4.423016044876023e-01   +1.039307488245570e-01   -2.188730136772101e-02; -6.721079189528620e-02   -1.184461302694696e-01   +1.467495045308477e-01   +1.670533339579407e-02   -6.727847477424290e-03   +2.023951808936906e-01   +5.785453598062786e-01   -2.938180619406848e-02   -3.654995770851791e-01   -9.729758255757760e-02   -1.291960721568662e-01   +5.627910986688088e-01   -3.894656640210449e-02   -4.088934012588755e-01   +2.862878643881754e-01   +1.777939759123166e-01; +3.111292401969484e-01   -8.968038545323175e-02   -5.520747780472235e-01   +4.585844931643361e-02   +6.426432548954092e-02   +1.060877833142079e-01   +4.824848653727248e-01   -4.428919855619398e-02   -1.560500322843060e-01   +1.000000000000000e+00   +7.488863968357511e-03   +4.973040090018267e-01   +4.944704941985684e-01   -3.965749263741910e-01   +2.419447218989774e-01   +1.554579316293233e-01; +3.563571616160062e-01   -3.764976721407632e-02   +6.281022024576119e-01   +6.167424837073547e-01   +7.586230167018062e-01   -1.697422142544928e-01   +2.510946730370545e-01   +5.653871114599575e-01   +5.691753914612367e-01   +2.624033314427646e-01   +2.259632763409676e-01   -2.464207296826930e-03   +6.400644418736307e-01   +6.521667287422712e-01   +5.924625770206948e-01   +5.093154122738872e-01; +8.072969251050728e-01   -2.227957563416523e-01   +4.275377788610756e-01   -1.801331642449832e-01   +5.149557503975205e-01   +3.112819761425697e-01   +7.200702441575806e-02   -2.370704454123088e-01   -1.826615602837117e-01   -2.318739842017685e-01   +3.079790225287293e-01   -6.739276747996740e-03   -6.553615911690465e-01   +9.156547725629144e-02   +4.730724713668519e-01   +5.999552594864490e-01; +2.750933134566851e-01   -2.037561450202299e-01   +5.797553052142456e-01   +1.008084566108360e-01   +1.079167021406347e-01   +4.667515479006547e-01   -1.590267460089232e-01   +6.311823562961053e-01   -3.232567388526151e-01   -1.007260652275765e-01   +1.108390269543348e-01   -3.907612326920273e-01   +5.708091337041653e-02   +1.974431471037876e-01   +2.426792445087804e-01   -2.404423885387696e-01; -1.055643750757722e-01   -2.452325299997904e-01   +4.174155973616563e-01   +2.921911379804806e-02   -2.438182108637950e-01   +2.549248810810406e-01   +8.476145247017162e-02   +1.855705556998830e-01   +5.237081574396590e-02   +3.727198395590983e-01   +3.544799412549952e-01   +1.411383138352269e-02   +1.281155078664318e-01   +4.453197541579474e-01   +2.255090619735754e-01   +1.632925658215778e-01; +5.993098856362884e-02   +4.706487893822081e-01   -9.581327387242999e-02   -5.609424753861073e-01   +2.531869930268916e-01   -1.972883913332994e-01   -4.033966999888051e-01   +7.040530018811365e-01   +4.936420224875245e-01   +1.829220847247910e-01   +6.835798687969463e-02   +8.765309225515723e-01   +1.919219472532238e-01   +5.088351622126444e-01   +1.333978228909382e-01   -4.940624300623580e-02; +2.603385575795415e-01   +1.150858370190375e-02   +5.449492554945532e-01   +1.051353623415457e-01   -2.198342254054482e-02   +6.695798990250283e-01   -1.666698334487296e-01   -1.573674931457033e-01   +3.976055881537366e-01   -5.260628015503288e-01   -3.464294103651023e-01   +1.837893222978198e-01   -7.257507493633186e-02   +1.580651824504782e-01   -2.364145667429564e-01   -5.200545036991604e-01; +9.944676936901748e-01   +9.064429046403613e-02   +7.774761982308347e-01   +1.453718868463849e-01   +3.360177128061396e-01   +3.615314427394202e-01   +7.767535172491093e-01   -1.144205681992954e-01   -2.066809347401002e-01   -2.510365069816349e-01   +7.165469827165309e-01   -1.019650286981087e-02   +1.508787783195250e-01   +6.364828415468038e-01   +2.746177410953441e-01   +6.417895316772848e-01; -2.618644607299053e-01   +5.600605320864399e-01   +4.013979612666628e-01   +2.816044243825380e-01   -8.638578242864295e-02   +5.090803248797230e-01   +1.087571172722543e-01   +6.420106214437387e-01   -1.108068661130766e-01   +4.379747532399221e-01   +4.752155309096492e-03   +7.375721128830681e-01   -5.256711558798891e-01   -1.838870704420315e-01   +5.582042927822853e-01   +4.665821107635188e-01];
L2I_L1I_iGABA_netcon = [+1.863295109294760e-01   -1.815169863261110e-02   -4.189619785320678e-01   +2.664041064079293e-01   +1.262610141914698e-01   -2.049953504584413e-01   +7.402300626100228e-01   -1.245770645757596e-01; +7.843071252558931e-01   +4.333714255034662e-02   +1.316622810835471e-01   -2.170742826115064e-01   -8.406117488914515e-02   +5.459941550865108e-02   -1.765907501213149e-01   +3.623366945284698e-01; +3.230984133382535e-01   +2.116825227822414e-01   -3.516358636693218e-01   +1.823913699237830e-01   +5.510493723824058e-01   +3.059747505157906e-01   -3.869626275762590e-01   +1.822358745552370e-01; +9.979656125020817e-02   +1.080734033816039e-01   +2.543526162980052e-01   +8.077642356766780e-01   +6.883187181905961e-02   +9.479831920997356e-01   -4.304719205715492e-02   +3.048617609813759e-01; +1.154553447309373e-01   +6.010555143255190e-02   +2.640026837051269e-01   -4.695612852797460e-02   +4.769390815098073e-02   +4.098806252378284e-02   -2.576443549321467e-01   +5.146991575066565e-01; +8.286750006091560e-01   -8.506408892317213e-02   +2.449407628813857e-02   -2.002042073965939e-01   +9.921813437914438e-01   -3.282696506185167e-01   -6.859448738854137e-01   +8.051470581150663e-01; +3.451401024913768e-01   +7.181744446838801e-01   +2.758524442208179e-01   -1.004673692009975e-02   +1.000000000000000e+00   -3.381044808670228e-01   +3.227705785861627e-01   -2.163802842636941e-01; +1.021838401899726e-01   -1.552152058001571e-01   +1.528945462408181e-02   +3.525248699206801e-01   -3.551643739777461e-01   +3.107630064917543e-01   -9.467237903401893e-02   +6.223677204873785e-01; +6.316513354603846e-02   +6.581978670752162e-01   -5.260829221723455e-01   +3.685526261031699e-01   +3.931272793181992e-01   +5.881769419696485e-01   -4.645310477450301e-01   +1.839343772081528e-01; +5.067774408377659e-01   +1.715567560782040e-01   +2.216946351690302e-01   -6.014445482511950e-01   +7.073356154816901e-01   +3.922023206476015e-01   -5.085372295924980e-01   +1.523895864880730e-01; +4.820896350143414e-01   -1.310777371311671e-02   -2.895296485259165e-01   +6.086963685424611e-01   +2.727211733488241e-02   +3.604181669092329e-01   +2.901962751854228e-01   +7.217869280398815e-01; +2.671726597867768e-01   +1.605640551626169e-01   -4.497508327174538e-01   +5.452369593229819e-01   +8.804304049286468e-01   -1.689930784783438e-01   +3.553569893432836e-01   +2.178206380168278e-01; +4.906234542128298e-01   -2.987996106478887e-01   -7.154855741325271e-01   +2.434772281423698e-01   +7.506748508887601e-01   -3.267727951903258e-01   +1.733343738722871e-01   +3.290998542361073e-01; -2.465561520476157e-01   +3.349570448911310e-01   -2.370128364053388e-01   -1.544885877262139e-02   +2.458210282457688e-01   +2.704345577889097e-01   +3.913433291596791e-02   +2.161253135666905e-01; +3.962778716336117e-01   +3.278288601631913e-01   +2.085083344986779e-01   -3.534900842656773e-01   +3.775238665175586e-01   +1.730611726787935e-02   +7.985982039410470e-01   -3.090978363242882e-01; +7.231758912082629e-01   -4.708273111302877e-01   +3.688355090526424e-01   +1.134547147410399e-01   +7.640560417428846e-01   +7.406698747712345e-02   +2.624381075674146e-01   +6.299799953076392e-01];
L1I_L2I_iGABA_netcon = [+2.080521399749096e-01   -2.697031942516400e-01   +3.528164633494561e-01   +7.410631038624196e-01   +7.095056470611356e-01   +2.605096393612553e-01   -4.560241311986676e-02   +3.875436661204552e-01   -2.120397749418581e-01   +4.146159760234099e-01   +1.502434205244659e-01   +5.563220535736666e-01   +4.547518792576802e-02   +7.599761068398796e-01   +5.130582051226413e-02   +5.353031544472561e-01; +3.763156594270408e-01   +2.179348366568827e-02   +1.166558179231625e-01   -6.640606273146118e-01   +3.756093103071126e-02   +7.707567171957311e-02   +2.900485334384320e-01   +9.675004295537355e-01   +6.592546876266604e-01   +7.192516070887820e-01   +2.529418065099353e-01   -2.628338017191774e-01   -3.497013979572266e-02   -2.827968162252278e-01   +1.620053968252121e-01   +2.367230012857246e-01; +5.022215872422362e-01   +2.494136143482566e-01   +8.636832554628444e-01   -5.993796501350287e-02   +7.763816591456297e-01   -1.280259278481179e-01   +4.203744562348321e-01   +5.471311950949141e-01   -6.765138870843471e-02   +5.505645194278341e-01   -6.068341804317372e-03   +5.405435910997184e-01   +1.833199973848155e-01   -2.455621816306103e-02   -1.961792735915653e-01   -8.419711185164380e-02; +7.731120237271571e-02   +2.742453764334332e-01   -1.011537255221690e-01   +1.459948621506705e-02   +9.542766709710858e-02   +2.724502280939828e-01   +4.125737853876431e-01   +5.010919338359593e-01   +8.258637399593874e-01   +1.000000000000000e+00   +8.164687774950831e-02   +8.785079410305194e-01   -3.509329577083605e-02   +1.658575491332988e-01   -2.545677529104576e-01   +3.729299902455205e-01; -4.061222862335405e-01   -1.434966383199586e-01   +7.157649044865478e-01   +1.587741249228302e-01   +1.848251923090633e-01   +4.552549964349831e-01   +1.435032818546787e-01   +1.871852124623033e-01   +4.082162815004893e-01   -4.271514137653450e-02   +5.733842233155340e-01   +2.824161602942306e-02   +7.504734975140673e-01   +3.329624313253464e-01   +7.079695281982833e-01   +3.688333041011593e-01; +5.481468112741559e-01   +1.874130316669367e-01   +6.239972467584119e-01   +6.337222096219749e-01   -1.779875740753242e-01   +1.382179708110411e-01   -4.359391407977886e-01   -2.792178776203182e-01   -4.201458557396204e-01   +2.986703852571839e-02   -3.145973364911429e-01   +7.817852666435424e-02   -1.349405040970305e-01   +3.846474669386332e-01   +1.389622907117968e-01   +5.346161471787961e-01; -7.040086490758453e-02   -2.190089327685285e-02   +2.293104219371947e-01   +7.634870610832870e-01   -1.412679567154078e-01   +4.828450204069047e-01   +2.765206439974571e-01   -1.934398361850321e-01   +7.731999927875065e-01   +1.440682904358117e-01   -2.534165885458032e-01   +2.328708035930026e-01   +2.352580708428218e-01   +3.830786784763208e-01   +3.138672964649382e-01   +1.060410987820391e-01; -2.831664063471109e-01   +2.567835223212371e-01   +8.128626993677464e-02   +6.500247064792769e-01   +6.385306475027375e-01   +1.587741722253924e-01   -3.486119775931072e-02   +1.085083679067854e-01   -4.515991521869992e-02   -1.151736566178209e-01   -7.915030994670319e-02   -2.961438197957077e-01   +2.163754057374464e-01   +5.759318757514666e-01   +3.027544963302189e-01   +8.170824794039185e-02];
L2E_L1E_iAMPA_netcon = [+3.438425472147318e-01   +5.939617500477392e-01   +1.258161347211175e-01   +3.979343999471630e-01   +3.665847378430369e-03   +9.833596656070732e-03   +5.858999852132136e-01   +1.352556784787070e-01; +5.626490856458828e-01   +6.270076745639605e-02   -4.755304384205128e-01   +1.799821568125435e-01   +1.281172579376178e-01   +4.116009895674573e-01   +1.591227038872738e-01   -2.417802738034295e-01; +2.702212038413488e-01   -5.791979805083040e-02   +4.772927372105761e-01   +6.434234092698651e-01   +2.151301930071581e-02   +4.446383671475818e-01   +2.892266658908180e-01   +4.936411339379830e-01; -4.805694833444953e-02   +5.069653800614226e-02   +3.341358950110107e-01   -1.516067639164614e-01   +1.520750278306851e-01   +1.090093578242487e-01   -1.324223964253330e-01   +7.482464567620855e-01; +3.025729955214882e-02   -8.194628150002572e-02   +2.555020321924206e-01   +3.082932662724773e-01   +1.000000000000000e+00   +4.898084737767863e-01   -1.764066922190172e-01   +6.458108861466947e-01; +8.181195981645012e-01   +1.612484515343249e-01   +6.849841785112091e-01   -3.013177181639943e-01   +5.030247436180849e-01   -1.493521707437825e-01   +6.961308973624093e-02   +2.082023195950756e-01; +4.535150435044135e-01   +6.203152525723818e-01   +5.791052512299125e-01   +7.461355971858993e-01   +1.724210475066364e-01   -6.891517805640816e-02   +3.920257093153433e-01   -4.796323754476785e-02; +2.692008121779549e-01   +5.416745825704432e-02   -2.170669077779317e-01   -1.999981388132592e-01   +2.399352454557846e-01   -7.921302663804754e-02   +1.222346904954522e-01   -3.378390466026181e-01; -1.977120283025509e-02   +5.915071407140378e-01   -1.418022530569975e-01   +2.061919921764218e-01   -3.370945297297117e-01   +1.872881228195109e-01   +1.231423147468914e-01   +6.582131304452843e-01; -1.958626795250046e-01   +1.201952838822189e-02   +3.111277674901436e-01   +1.508166763801938e-01   -5.139044953306679e-02   +2.548736892726247e-01   +5.526481501130244e-01   +5.872135787993398e-01; -7.127243697073511e-02   +2.910993085036181e-01   +1.925609661451774e-01   -2.478391154332622e-01   -7.773083144105120e-02   +1.091939823635778e-01   +1.009717251427899e-01   +3.274378659536998e-01; +3.572787579951971e-01   +3.925421474898113e-02   +6.097579253992834e-01   +5.543554848375162e-02   +9.302168796451619e-02   +3.856253385059403e-01   -2.056493457881069e-01   -1.126548927387541e-01; -5.570542086859950e-02   +7.673868815859105e-01   -3.059527038642280e-01   +7.149546340898177e-02   +2.931806938389807e-01   +8.010350521078410e-01   +3.756931164269471e-01   -3.760141143002648e-02; +3.587838469804250e-01   +3.443429409651592e-02   +1.905881035133510e-01   +5.610972117133174e-01   +5.347881365800207e-01   +3.572003743007955e-01   -4.101704967908096e-03   +2.589658812894004e-02; +2.063998285676471e-01   -1.058930983935317e-02   +1.116378787214221e-01   +4.439907505134009e-01   +8.215143037386990e-03   +4.500494620914715e-01   +1.775435932863460e-01   +6.827128055493920e-01; +4.850534736616430e-02   -2.563107279156116e-01   +3.471492734728643e-01   +5.614316637740887e-01   -5.020137240174226e-02   +8.794604480224580e-01   -8.747494417705415e-02   +6.217900260134476e-01];
L1E_L2E_iAMPA_netcon = [+1.152619606762774e-01   -5.259448333138493e-01   -3.446535809231713e-01   +1.908821723358823e-01   +6.681732382775078e-02   -4.048582154077027e-02   +5.660480947403020e-02   -4.301204786977703e-01   -3.985140763626037e-01   +6.318649035313031e-02   -2.155467450837793e-01   -1.080957218571762e-01   +1.543414325157251e-01   -2.088283121096123e-02   -1.097359486633118e-03   +2.144034600089610e-01; +3.227065828906440e-02   +1.448981929382464e-01   +4.090190155697617e-02   +2.334702464896873e-02   -1.458017108215332e-01   +1.172684206394435e-01   +3.231391489826137e-01   +7.721425405677692e-01   +6.597084515208743e-02   +6.414424683853626e-01   +1.522600612957847e-01   +4.917862797527254e-01   +1.848105079432896e-01   -1.223726867703536e-01   +2.876617887109929e-01   -3.127055255097635e-01; +3.421385833569810e-02   +2.154012205206774e-01   +1.998935106651456e-01   +4.125948658735057e-01   -9.373280815907527e-02   +6.582409391653309e-01   +5.137972433084362e-01   -4.343190689706685e-01   +5.928946545365714e-01   -6.939676488916811e-01   +6.681751089222698e-01   +3.232163210977205e-01   -2.533880745115432e-02   -4.986241919076714e-01   +5.199656524593472e-01   +1.000000000000000e+00; -2.086106119699321e-01   -6.962058617896123e-02   +5.591152362269684e-02   +7.356833185138898e-01   +5.018400315111784e-01   +2.422660504245943e-01   -1.083107531677827e-01   +3.934752483272461e-01   +2.933164739273681e-01   +1.437586910468718e-01   +3.784226108240481e-01   -2.213283427556942e-01   +7.384642005873294e-01   +3.919386629511343e-01   +2.432460693663966e-01   +2.854335315787255e-01; +2.176409746979712e-01   +6.856536574206026e-01   +6.875273138502889e-01   +1.251208546299910e-01   +5.547162550542432e-01   +6.480056121023290e-01   +6.753596375373135e-01   +1.932772238042151e-03   +6.755724324113872e-01   +3.010411314332498e-03   +1.182422120861825e-01   +6.902326323005367e-01   +2.433082603773201e-01   -3.256562591553085e-01   +3.003087061859633e-01   +1.892119886913243e-01; +5.879852306825111e-01   +6.953506676587577e-02   +1.585119362239134e-01   +5.833605850495832e-01   +4.288494326099599e-01   -1.346577594417886e-01   -3.829257489660763e-02   +4.110912825625121e-01   +5.283189639479929e-01   +6.215940731063208e-01   +1.760716593885096e-02   +4.381460339219706e-01   +8.243067785340524e-01   +1.094061660437683e-01   +3.203038609818027e-01   +8.194376712883990e-02; -1.451136769579477e-01   +6.253050730650105e-01   +4.838632476431787e-01   -2.358746174728683e-02   +8.543958453982307e-02   -1.652396677304719e-01   +9.812712204529740e-01   +4.691896181856996e-02   +1.562537691208871e-01   +3.569179410410323e-01   +8.618247350101215e-01   +1.614560907132883e-01   -5.154306661911847e-01   +2.669005367811699e-01   -3.202281157748955e-01   +8.258809929343988e-01; +3.372250351400925e-02   -1.560324997408662e-01   +1.851102026209169e-01   +3.230725263015218e-01   +5.835167299166867e-02   +4.756341157132643e-01   +4.774254789785038e-01   +5.652186090508011e-01   +3.836790087714924e-01   +7.850488243170213e-01   +3.276795411349926e-01   +4.777687844791451e-01   -9.648852107835457e-02   +2.714005620275519e-01   -2.312206457273182e-01   +6.311330966118734e-01];
L2I_L2E_iAMPA_netcon = [+2.022687462752012e-01   +9.399830450705315e-02   -1.121569764391184e-01   +3.028048996225327e-01   -1.075802521799101e-01   +2.483612799137597e-01   +5.097487855136662e-01   -1.774957170752693e-01; +2.621083256880505e-02   +5.565876555991169e-02   +3.809853423011049e-02   +4.580406628068642e-01   +3.716429402801015e-01   +4.637344635421768e-01   +7.574982354546222e-01   +3.805050215960994e-01; +2.483227491765823e-01   -2.134322860826275e-01   +1.000000000000000e+00   +5.164641904633818e-01   +4.799146552207100e-01   +1.420091832852081e-01   +1.016375660161865e-01   +2.014236642426124e-01; -5.397951707568460e-01   -5.051035437772026e-02   -1.254861472041592e-01   -5.867896409268408e-02   +2.147143605711847e-01   -2.107525701735458e-01   +5.130155879178547e-01   -3.043533573862124e-01; +6.142479720703506e-01   +6.382570765755605e-01   -2.440349224661929e-01   +5.831344603341292e-02   -5.536214772381196e-01   -5.984156106639490e-01   +7.033938758287873e-01   +2.240109711910824e-01; +2.716235220160178e-01   +2.937097949519433e-01   +1.924862554691758e-01   +4.875013147053696e-01   +5.896535398007011e-01   +3.001207271378498e-01   +2.948197138831616e-02   +6.356887730430869e-01; -1.052385087164472e-01   +3.931661219666534e-01   +1.389073151341342e-01   +4.961383942376042e-02   +4.313053876248467e-01   +4.170281006817549e-01   -2.908177395373928e-01   -4.175578004058714e-02; +2.973798628129100e-01   +4.132377942951924e-01   +1.193759490220241e-01   +4.931127031188421e-01   +1.420997549142143e-01   -1.099943297602894e-01   +2.110497664629894e-01   -1.109725636301575e-01];
L2E_L2I_iGABA_netcon = [+2.116650697850500e-01   +1.191547549768910e-01   +9.398497787514183e-02   +4.928675067894395e-01   +1.104385146233500e-01   +4.391586965289715e-01   -2.332159351914753e-02   -1.461278342819480e-01; +7.793751176012766e-02   +1.884790413512696e-01   -2.623919015076057e-02   +1.832749704834661e-01   +3.247639358320493e-01   -8.801074967144536e-02   +2.305488520018990e-01   +4.261630126500990e-01; -6.095725104087368e-01   +2.483563217014975e-01   -1.742790856797920e-02   +9.186650079178509e-01   +1.381423319784517e-01   +6.405086831459081e-01   +4.730126461994608e-01   +2.694339378260425e-01; -2.673953784840436e-01   -5.485408012998575e-01   -1.183938716159825e-01   +3.568579242676584e-01   +2.382211557877326e-01   +7.504593373084807e-01   -1.937477256237150e-01   +3.677271005677917e-01; +4.841076727934427e-01   -2.744190480157385e-01   +1.000000000000000e+00   +2.101403560697438e-01   +3.817297647027940e-01   +4.213508939199540e-01   +2.009671775505021e-01   +5.444886685076672e-01; +4.032157038608810e-01   +7.987211191034782e-01   +5.956492615836402e-01   -5.484950271460409e-03   +4.973803308077939e-01   +2.419569503291525e-02   -2.073330618813254e-01   +4.772354539165155e-01; +1.265537851499170e-01   +2.326659701141819e-01   +1.189692531104625e-01   -2.204407877399896e-01   +5.653120061624202e-02   +1.514069084889447e-02   +5.449238251327748e-02   +1.408110176637163e-01; -1.943638793037114e-01   -7.212592720018349e-02   +2.428239207392345e-01   -6.069514399583314e-02   -9.229876909387368e-02   +8.383631942440035e-02   -1.789108391243315e-02   +1.503427134823570e-01];
L3E_L2E_iAMPA_netcon = [+4.339579521345760e-01   +1.353279679817638e-02   -3.312603745035207e-01   +1.686824218929758e-01   +1.000000000000000e+00   -8.239291444026205e-02   +9.617061488150427e-01   -4.797680325222118e-02   +3.546677408851916e-01   -3.355883539274173e-01   +3.932467993948850e-01   -2.660109926558931e-01; -2.243755645750051e-01   -2.624863243365695e-01   -1.736290109012789e-01   +1.337950055422994e-01   -2.729944484727149e-01   -2.426478742610993e-01   +4.348090790963873e-01   -4.166104311884002e-01   -3.984158730140933e-01   +6.016830214107589e-03   -3.990390387116005e-01   +2.753597401675652e-02; +4.586018287189421e-01   +6.706216616950990e-01   +1.319606671596401e-01   +2.479925931104845e-01   -1.612074282365520e-01   +5.963112156788571e-02   +6.659135769374221e-01   -7.711215741747571e-03   -3.227127601799919e-02   -4.707158176433924e-01   -4.618785726837563e-02   +3.539340102894775e-01; +6.217045553435089e-01   -3.226597625685501e-01   +7.037923979708223e-02   +3.424106933084120e-01   -3.058938013455011e-01   +3.423231299029557e-01   -1.082869424030243e-01   +7.389898923199302e-01   -8.859238827610193e-02   -3.095819246885473e-01   +2.637127460021165e-01   +1.187587096931400e-01; -5.538183467723209e-01   +3.133317753449111e-01   -5.100869665088367e-02   +4.856445422416145e-01   -3.426225691271927e-02   -6.484646773187309e-02   +9.027138243837553e-02   +9.226823470418060e-01   +2.427603842031821e-01   +1.946880619082426e-01   +3.030103874578705e-01   +1.740995533896841e-01; +5.428782514002510e-01   +7.509820745681260e-01   +3.267768896484729e-02   -2.557593428460891e-01   +5.848243125674216e-01   -6.789778041655940e-02   +5.112583685335220e-01   +4.558149588991644e-02   +7.784236999514286e-01   +1.165886645216822e-01   +3.179985066309648e-01   +3.297084925081570e-01; -3.965073593741175e-01   -4.357873196482833e-01   +5.676754729711752e-01   -1.436127757939405e-02   +9.795045694444032e-03   +2.676169080262548e-02   +8.936963113443581e-02   -1.401153594822116e-01   +1.995470544055557e-01   +6.320179074909191e-01   +1.778950647748516e-01   +9.106573736779636e-01; +9.058244163340401e-01   -1.821924831235531e-01   -2.090216284793887e-02   +3.394630770028247e-01   +1.792698258482336e-01   -3.771861440327979e-01   -1.433852861953263e-01   +2.776193330892851e-01   +5.409627230921809e-01   +2.455091063707882e-01   +1.477316136647023e-01   +1.508658280142914e-01];
L3I_L2I_iGABA_netcon = [+7.344410274743034e-01   +6.684766466319220e-01   +1.279871026957909e-01   +2.821968184183250e-02   -2.067475838970883e-01   +6.177718349449403e-01   -1.214486974459677e-02   -5.472525105064598e-02   -5.779932874524106e-01   -3.295992829925137e-01   +4.935049476482772e-01   +3.830593372152409e-01; +1.923181252323811e-01   +1.453760822740301e-01   +4.336088170584870e-01   +2.941334426285212e-01   +4.713489730522484e-01   -9.818703076686372e-03   +5.333490290452890e-01   +7.902845064500427e-01   +4.089071410785984e-01   -3.661310076127130e-01   +4.515919277378413e-01   +3.059323472037953e-01; +1.000000000000000e+00   +2.203242463580159e-01   +1.442359451815531e-01   +5.943313819491427e-01   +8.341890842975167e-01   +3.282748015470545e-01   +7.014942229033158e-01   +7.779138453562680e-01   +3.590450011040629e-02   -4.548261751999037e-02   +1.242925433843272e-01   -1.779735624565487e-01; +2.665638258956994e-01   +2.094814202777152e-02   -9.307081331334935e-02   -4.710134965459582e-02   +3.301948733952938e-01   -1.595208951853402e-01   +1.733232497205111e-01   -4.969906530677232e-01   -1.012154307578559e-01   +3.027985750302733e-01   +8.545206513384285e-02   -3.137151601973066e-01; -5.107228309215368e-02   +2.666060352710239e-01   +3.489530461893854e-02   +8.712003826555675e-01   +4.991516658164340e-02   -6.280184808973896e-02   -6.071839226757792e-02   +1.089962489953547e-01   +7.575321089052595e-02   +1.146332447297040e-01   +6.045582643282457e-01   -4.747244539909323e-01; +1.506641531419597e-01   -3.986875822761491e-01   +2.842578382265589e-01   +2.427789800758500e-01   +7.789343059095938e-02   -2.058068620713561e-01   +6.413847644272258e-01   +4.451504485387831e-01   -2.883916220944789e-02   -2.962698205863203e-01   +2.997192891642419e-01   +4.060216126286063e-01; +2.593547966294557e-01   -4.718657609005018e-01   +3.654076221812381e-02   +4.105880344908998e-01   +7.661860093864098e-02   +5.945574519884933e-01   +3.815190600169834e-01   +4.235500084519513e-01   +2.193389361340781e-01   +2.616809074856490e-01   +1.995192608988682e-01   +5.601613189456208e-01; -4.580155107499970e-02   -3.483640335631025e-01   +8.358653172120492e-01   +9.258717373111756e-01   +7.370905973379229e-01   +1.035025198283625e-01   +5.901454750774833e-01   +4.218283369815341e-01   +6.999351548616048e-01   -1.708404446645479e-01   +6.122256202285128e-01   +1.432723417132426e-01];
L2E_L3E_iAMPA_netcon = [-2.358378512094813e-01   -2.658209065990696e-01   +6.877016629712439e-01   +3.686842263360008e-01   +1.513659026334567e-01   -3.430132612642756e-01   +7.012732819617432e-02   +5.315164022546680e-01; +3.753943900981347e-01   -2.741492864927842e-01   -5.955160923594077e-02   +4.565804434567337e-01   +2.032078829677495e-01   +4.724914927345955e-01   +1.594973994905035e-01   +2.589707967313145e-01; +5.727133148478865e-01   +4.710857769898549e-01   +5.415439865045531e-02   -1.104695547511512e-01   +4.384409193205515e-01   +2.224784208623763e-01   -1.482836359198851e-01   +6.021351024624418e-01; +2.239527494078048e-01   +3.526261465968205e-01   +5.074370716787893e-01   +8.254742281964200e-02   +5.952557723846451e-01   -1.930605868701869e-02   +3.486092543332328e-01   +4.615688853154077e-01; +5.911113633361845e-01   +2.040985161528745e-01   +7.773962835826152e-03   +1.181298701039529e-01   -1.204684097641442e-01   +2.830176534997574e-02   +9.742651228202021e-01   +2.247336733010528e-01; +2.888875820654256e-01   +4.803517706558884e-01   +1.135881086889210e-01   +5.823130732607222e-02   -1.165392680043139e-02   -2.688736565659959e-01   -3.389286067540509e-01   -2.176052208782031e-03; -1.161590255962717e-01   +4.102560801278313e-01   +3.029619991293692e-01   +7.050315193649070e-02   +5.448856248460625e-01   +6.974573012024835e-01   +4.191449788457758e-01   -2.403857224286734e-01; +5.655088765090128e-01   +5.098888885726700e-01   -4.777715646837618e-01   +3.810136860238429e-01   +6.340721439100946e-01   -9.481310908803799e-02   +6.385339498776306e-01   -1.241295033061368e-01; +5.597875074535584e-01   -1.189195329558240e-01   -3.237724857385753e-01   +1.828582823443882e-01   +3.462267431065212e-01   +3.764722816931209e-01   -5.659409515516928e-01   +3.299832017092712e-02; +5.059245346269730e-01   +5.770354136270834e-01   +1.055308466356044e-01   +5.844002787745451e-01   +1.685228517655072e-01   +1.000000000000000e+00   -3.306932270798243e-01   +3.766642518719484e-01; -5.486179982234591e-01   +4.807532822934800e-01   -4.258185960579758e-01   +3.355382086882577e-01   -1.614189169995696e-01   -1.422742706536436e-01   -4.458807690101040e-01   -2.162394702231353e-01; +1.133099866904562e-01   +2.620617000152617e-01   -3.296561203723601e-01   +8.174495824461557e-03   -2.830997424102555e-01   +3.104775951733258e-01   +7.858193676290028e-01   +3.402195475172844e-01];
L2I_L3I_iGABA_netcon = [+4.149279052589719e-01   +3.549462894954522e-01   -5.363993056664801e-01   +4.153285053901899e-01   +1.516264484262806e-01   +1.678329291262138e-01   -2.046762164329885e-01   +3.651591041040330e-01; -5.048886842902885e-01   +1.898696356702008e-01   +3.244723955894849e-03   +4.015983505757859e-01   +5.700377413906482e-01   -1.944125839785372e-01   +2.718143589157317e-01   -6.208953573660511e-02; +8.572322719014011e-01   +3.956767784008631e-01   +4.187804082346100e-01   -1.599299404192301e-01   -1.907478673240751e-01   +2.340724015958729e-01   +5.648786028587277e-01   +4.127222203440425e-01; +1.000000000000000e+00   -1.726144886640076e-01   +6.128530466235733e-01   +9.020533628651473e-01   +3.335247058682388e-01   -4.996423155443077e-01   +5.385155183270712e-01   +1.039849490329330e-01; +6.696817815249129e-01   +3.845134748376011e-02   +3.174730081672409e-01   +2.763812986219156e-02   +3.474486151342115e-01   -3.424717494727704e-01   +2.372177402353067e-01   +1.946261887008533e-01; +2.139452219501357e-01   +9.532749697568447e-01   -7.736409544164645e-02   +6.598183788640366e-01   +3.051973894251091e-01   +1.749373960328232e-01   -1.894660247579372e-01   +7.178597163531075e-01; +3.180398419936625e-01   +5.608837915279714e-01   -2.949200629518399e-01   +4.433488409722450e-01   +6.370093327322099e-01   -6.131219333140046e-02   +7.129858751804015e-01   +5.519023365114567e-01; +4.125206049827425e-01   -3.001981280734322e-01   -1.062769305493769e-01   +7.088570116283364e-01   +7.992244951567332e-01   -6.987076429581542e-02   -9.685104431576073e-02   +1.776882498872446e-02; +5.061694049307042e-01   +6.857196399418599e-01   -3.671046562638896e-01   +1.405822876569025e-01   +7.806086209250589e-01   +4.936746199132441e-01   +8.558304217877158e-01   +5.036726408850714e-01; +6.819457452415298e-01   +5.164435550138758e-01   +1.206967529638466e-01   +6.900984287047784e-01   -4.656221267706880e-01   -1.997726505919156e-01   -5.522732757462185e-02   +5.077781969146893e-01; -4.223313653082480e-01   +1.248363932981578e-01   -2.599462372836132e-01   +4.591634088363298e-01   +5.756415529248498e-01   -1.435607869109450e-02   +5.525986972717813e-01   +1.028347382373690e-01; -1.480189343757465e-01   -1.045050486266761e-01   +3.880505274970526e-02   +6.416587602839516e-01   +4.677107891829386e-01   +2.207139537286832e-01   -1.482024579459655e-01   +6.713477316434449e-01];
L3I_L3E_iAMPA_netcon = [-3.476042727474871e-01   +3.681264430903728e-01   +7.217066846913702e-01   -5.550971475592097e-01   +4.929025770424465e-01   -4.895103062861115e-01   -1.217996521107228e-01   +4.665842213431771e-01   -4.414021323139844e-01   +7.102629322323687e-01   +3.210567924268972e-01   +8.724063599174060e-02; +6.207104771620257e-02   -3.699656410249629e-01   +7.198455930334334e-02   +1.676650828558152e-01   +4.052497215214307e-01   +3.759228018377931e-01   +1.513198632510100e-01   -1.189927009644857e-01   +4.165234391364672e-01   +1.091832443215068e-01   +6.056009930575103e-01   -2.070805366480059e-01; +7.160567534553449e-01   +4.549051705680169e-01   -1.585523352792018e-01   -1.541581420139785e-01   +4.186864176099607e-01   +8.293853186871629e-01   -9.784539701043006e-02   +2.993696103619262e-01   +1.498013179190767e-01   +3.953352796422886e-01   +2.021730273181618e-01   +4.379769998579130e-01; +8.117628429250573e-01   -3.054503030261859e-01   +7.498229710238827e-02   -2.824755410561168e-01   +6.151891833690053e-01   +1.986316021582315e-01   +1.105469135579493e-01   +4.135865348019394e-02   -2.889826169358086e-01   +7.980961132553586e-01   +3.696519073195980e-01   -2.227906897034650e-01; +3.771628144500773e-01   +4.473910063737411e-01   -2.669822915602312e-01   +3.997004364505832e-02   -9.835475868092025e-03   -2.644456046665393e-01   +1.892934429075470e-01   +3.268292525235003e-01   +8.832764147700786e-01   +4.179955300112716e-01   +1.593739197278853e-01   -1.082074286195920e-01; -4.859205807126970e-02   +4.895969380386157e-01   +5.810865120191268e-01   +3.228033518283525e-01   +1.389728961414407e-01   +5.371529458319929e-01   -1.856211949236556e-02   +5.659005087417129e-01   +5.643568736799774e-01   +1.942481143312563e-01   +4.626588585282755e-01   +4.290313891887045e-01; +8.615144922323763e-02   +1.307150996067291e-01   +1.807361456015612e-01   +3.904035510300355e-01   -2.933406975609875e-01   -1.477659178068410e-01   +6.449961037790374e-01   -1.074672890805011e-01   +3.034348392989438e-01   -2.698711311919536e-01   +3.697524694724839e-01   +4.835094661972492e-01; +7.230182265422561e-01   -4.726926421353840e-01   +2.694606856793340e-01   +2.097991736380992e-01   +7.970724755405816e-03   +2.505528260063411e-01   +7.294073541031113e-01   +3.144003443230334e-02   -2.903534239815916e-01   -2.607636093308143e-02   -1.142131232301167e-01   +5.485050102294226e-01; +6.401322082063076e-01   +6.810161484989760e-02   +5.109106340208600e-02   +4.689136148809025e-01   +1.766182394380029e-01   +5.397464841300010e-01   -1.769854504715882e-01   +5.482872924413901e-01   +2.645562646259061e-01   -5.116712309532652e-02   +3.168161799512408e-01   +6.579237396225285e-01; +3.528657306286628e-01   +3.677485684884487e-01   +5.130883444225151e-01   +3.931990668002885e-01   +5.909871453386313e-01   +3.278353436925762e-01   +7.866155503221610e-02   +4.991422479433252e-01   +4.136470902632566e-01   +3.211209644281571e-01   +3.480951184688973e-01   +1.692583108598134e-01; +3.628149786120548e-01   +2.434288121049937e-01   -6.115585384105506e-01   -2.196620620234328e-01   +4.648352195797746e-01   +7.953415509812005e-02   +2.826970438099186e-01   -1.131318015849304e-01   +6.910143255665693e-02   +1.459113269869144e-01   +1.000000000000000e+00   +1.274129539612950e-01; +2.307308745133342e-01   +1.940892839094665e-01   +2.690072788847495e-01   +1.817106414514904e-01   +2.481350789817982e-01   +2.451004427379744e-01   +6.305514736694443e-01   +6.989856648817612e-01   +1.832769828703809e-01   +3.597069552833890e-01   +2.393932796390022e-02   +3.434519394825911e-01];
L3E_L3I_iGABA_netcon = [-1.759934536009965e-01   +1.896005634622173e-01   +1.092870778144447e-01   +4.077649948017931e-01   +3.067352896412347e-01   +4.547327085426277e-01   -1.866421688443560e-01   +3.918817897561266e-01   +8.035653463714080e-01   -9.923243111969833e-03   +2.378594127978164e-01   +6.336697676401683e-02; +8.971445275699421e-01   +3.127440665934207e-01   +1.094428189838447e-01   +3.137546119342943e-01   +2.622612110924887e-02   -9.167224718888727e-02   +2.854898130349295e-01   +8.723319930056961e-01   +1.404781860025857e-01   -2.196102994666752e-01   -1.717519487074647e-01   -1.228464330339094e-01; +2.110582929286680e-01   -1.596147017353308e-01   +1.797118257668750e-01   -2.982255212080596e-01   +4.463035020195887e-01   +1.745634634775837e-03   +4.899833073803225e-01   +2.889471639392506e-02   +3.196956965811685e-01   -2.398960614849435e-01   +3.120184605965750e-01   -1.912868143385876e-01; -6.620406614075290e-03   -1.224303356926155e-01   +1.358538172180664e-01   +4.174149399828120e-01   +2.234114516501988e-01   +1.354338134881886e-01   +4.801622091953212e-01   -1.811235331456345e-01   +6.481245431668072e-01   +3.927563329507899e-03   +5.680160240610849e-04   +1.787604781274391e-01; +5.488174659975761e-01   -1.652364990086166e-01   +4.091160306357177e-01   +4.273618063816154e-02   -7.628324535961731e-02   +4.813858278067296e-01   -6.413815622885859e-02   -1.297752210747522e-01   -3.278066612731267e-01   +2.391524101400385e-01   +2.206472765735104e-02   +4.046080153806572e-01; +7.920527968979193e-01   +6.294831142385662e-01   +1.054578114089723e-01   +7.137872051141373e-01   +1.714339784922170e-01   +4.358583358248853e-01   -7.050638964044874e-02   +1.399030286115669e-01   +4.750031031929741e-01   -1.626110482106795e-01   +3.862553295702385e-01   +4.432903387789566e-01; +4.202375449352295e-01   +3.632325208797518e-01   +3.836301936597537e-01   +1.000000000000000e+00   +4.830592702939809e-01   +7.340528386062482e-02   +2.063497123772726e-01   +1.348683612511561e-01   +4.767320679279017e-01   -2.978839457224743e-01   +4.486510226274799e-01   +1.437524459552751e-01; -3.328260930792687e-01   +4.589355330802602e-01   -2.322105176412209e-01   +6.032213932920720e-01   +5.677250618984323e-01   +5.973493165382271e-01   +3.360496662585671e-01   +1.283611725114165e-01   -4.547590412275395e-01   +3.756427536309567e-01   -2.120621178450340e-01   -8.555446543116538e-02; +9.937532893182459e-01   +2.937204156741874e-01   -3.159761949270398e-01   -1.407561827768705e-01   +4.352453388706281e-01   -1.335448652457241e-01   -5.956797040630163e-02   +1.977764888295841e-01   +3.774269040395246e-02   +4.322087107521279e-01   +3.509214253780076e-01   +2.226203453939862e-01; +4.732185593602206e-01   +6.191157771146795e-01   +2.784992101937900e-01   +3.071428200443458e-01   -4.990173727215549e-01   -1.397851000518794e-01   +2.054881482707906e-01   +4.098041506963763e-01   +9.333564817458204e-02   -4.501315949196208e-01   +7.160666548450797e-01   +7.905901632074802e-01; +8.227983410210594e-02   -4.189812578094323e-02   +5.255841197085808e-01   +6.534729939367445e-02   +2.004850680288123e-01   +6.633729613916748e-01   -1.634237068749793e-01   -2.659744549258154e-02   -2.628232232752179e-01   +4.027684162471417e-01   +9.949701499391757e-02   +4.061432122496391e-01; +6.068267003789426e-03   +5.453973171442084e-01   -1.714503027764366e-01   -3.861077833411317e-01   -3.053707683891959e-01   +2.522503105566853e-01   +4.147845390502296e-01   +3.953904032633368e-01   +1.392407586126771e-01   -4.627388883034225e-01   +4.326328192762702e-01   -2.597012848679742e-01];
L2E_Input1_iAMPA_netcon = [-4.362358767269683e-01   +8.358407737057221e-01   +4.611306363624365e-01   +3.916059950127629e-01   -4.235358695327934e-01   +6.024952765412785e-01   +4.669047796312243e-01   -3.948801517884636e-01];
L2I_Input2_iAMPA_netcon = [+3.326072351792103e-01   +4.783994787261054e-01   +4.621015242309547e-01   -4.515969275707948e-01   +6.546919649942928e-01   +5.480342213066555e-01   -2.722553202540394e-01   +3.842805256315061e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
