function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.012479971830650e-01   -2.672695210371687e-01   +2.621018270781905e-01   +2.709792046344220e-01   +4.039391321447005e-02   +8.310341818552983e-02   -2.263553841526943e-01   +3.258166093874421e-02   +4.868934935594166e-01   +4.559747773609504e-01   +1.025105962573393e-01   -9.821195689270414e-02   +4.509829221814073e-01   -1.262858527037222e-01   -3.285038036556239e-01   +1.328861888799713e-01; +4.265085003084182e-01   +2.186383575459701e-01   +1.131987900785023e-01   -8.555610533607025e-02   +1.134259685976617e-01   +5.296233228014925e-01   -4.692258252656101e-01   +5.387846360368447e-02   +3.407338715819652e-01   -8.350912523402622e-02   +3.470312574810996e-01   +2.364458224664982e-01   +2.963836851578685e-01   +1.035517167862777e-01   +1.000179326694374e-01   -1.532779904536175e-01; +4.217349974541816e-01   +2.563999543736720e-01   +1.886405612054091e-01   +1.449618897994985e-01   -1.213986709392723e-01   +3.244422770543339e-01   +4.420446618226063e-01   -1.951981708470665e-01   +4.614687784080293e-01   +1.391840613821772e-01   +6.113315660109671e-01   +5.499646192181180e-02   -3.421468377215783e-02   -4.859012811241094e-01   -6.303753752716414e-02   +2.471056444188396e-01; +9.029898089235668e-02   -1.179592570949886e-01   +2.814455412644177e-02   +4.493374650636208e-01   -1.443319549388644e-02   +5.172186636226604e-01   +7.200506470983884e-01   +8.050017717944058e-01   +1.475928954532957e-01   -2.727366428363522e-01   +4.380628491302180e-01   +3.764121076612222e-01   +1.936997817419919e-02   +3.875607788370952e-01   +4.434566702092256e-02   +7.706324676408310e-01; +2.310617906818808e-02   +2.196455237274966e-01   +6.396782411370755e-01   +7.056281890765455e-01   -6.212690989212752e-03   +2.142853875011214e-01   +1.673285644904923e-01   +1.836780333931315e-01   -1.362876452434135e-01   +7.537586636490050e-01   +8.192509669061950e-01   -3.919495302878865e-02   +2.200573918628521e-01   +1.683747369638184e-01   +2.152345234662517e-01   -5.049780067554711e-02; -2.221410416545270e-01   +9.015274563945451e-01   +3.258958194095838e-01   +4.111007862939393e-02   +3.385442720463794e-01   +3.491580852887315e-01   +5.793281883246532e-01   -1.010743811606659e-01   +1.232116832664411e-01   -1.783484031827270e-02   +4.557399166539950e-01   -3.414543085997752e-01   +2.302038161771519e-01   +1.569058858810914e-01   -1.761175989061310e-01   -6.405721095035953e-01; +2.961264062371067e-01   +2.828979279452935e-01   +5.497932024397918e-01   +5.343438425339266e-01   -3.763260356564291e-01   +3.969045541787063e-01   +2.529998769073946e-01   +1.180138903555628e-01   -7.386952781440910e-01   +3.391816596860763e-01   -1.389667346161004e-01   +1.093668342464745e-01   +5.760428981851720e-01   -1.614755851161122e-01   +3.103027656670371e-01   +7.700566587598193e-01; +2.168331039422694e-01   +5.089276305144806e-01   -7.670719036293108e-02   +2.814205186106353e-01   +2.985668363625078e-01   -3.038362602024208e-01   +4.898545678302604e-01   +4.160251919200028e-01   +4.673279234054518e-01   -1.619303186298562e-02   +4.654324583630517e-01   +1.586047269104459e-01   -4.934645535416732e-02   +1.625820192053839e-01   -2.398877862694263e-01   +2.156631161299448e-01; +4.604803383592903e-01   +7.570268189423089e-01   -1.058127684189727e-01   +4.699557829630392e-02   +2.276018657912683e-01   +5.244462158825541e-01   +6.782459577447521e-02   -3.238558282879666e-01   +3.158352853537381e-01   -1.217848763153449e-01   +3.348237057358354e-01   +4.475415351333556e-02   +3.036479348626409e-01   +2.877674149661660e-01   -1.788780218002017e-01   -2.562666916484446e-01; +4.588320511408793e-01   +7.327481535865591e-01   +8.899042547522448e-02   +2.021262011192636e-01   -1.596630598632504e-01   +3.072986822913342e-01   +5.351520418126768e-01   +1.426695189515012e-02   +2.937941041813592e-01   +2.060486753166076e-03   +9.495562027438033e-01   +5.545762046733623e-03   +3.768995932206889e-01   +2.356362735218972e-01   +2.020299392633614e-01   +3.182301486578569e-01; +3.014104677009333e-01   +1.000000000000000e+00   -3.255088396661331e-02   +2.460853127272858e-01   +4.902753746370250e-01   +1.141725119558655e-01   -1.072829251297052e-01   -5.445837517401519e-02   +5.947670084465490e-02   +4.756345904029035e-01   -1.240954349360893e-01   +1.247808434973576e-01   -6.839311192747132e-01   +5.283306666328309e-02   +2.801302324353415e-01   +1.385658388119407e-01; +4.045408761718068e-01   +2.578590146858119e-01   +1.481134877453374e-01   -4.819868574136737e-02   +7.359547181431507e-04   +2.512535382999276e-01   +1.792944968044678e-01   -1.779896512357976e-02   +5.293271396729864e-01   -3.000534511289478e-01   +4.842282315324116e-01   +6.244574530074072e-01   +7.030439270617990e-01   +3.595471997492600e-02   -3.138154080468641e-01   -1.116752333187025e-01; -1.840747413757927e-01   +2.636674178111116e-01   +2.573132628609771e-01   +3.949762865677947e-01   +9.236399769100473e-01   +5.547319115656347e-01   -1.849966365076130e-01   -4.879436507052744e-02   +3.247085721379890e-01   +5.024503028296038e-01   +3.049263152110124e-01   +1.549906921001324e-01   -4.520157899281117e-01   -1.340440030217214e-01   +3.521751993199881e-01   +3.910062099436362e-03; -3.252608657796714e-01   +4.756130477205663e-01   +3.477255395527046e-01   -2.358631317922106e-01   +3.436901473324853e-01   +4.561279599203414e-01   -8.104381005037219e-02   +3.362922710179837e-01   -3.232852014049219e-01   +4.144542475081279e-02   +6.102024937292952e-01   -1.541419461796760e-01   -1.882661572564908e-01   +6.672993817563899e-01   -2.350662190173143e-01   -3.026624948589160e-01; +4.219611954408021e-01   -2.803812326583126e-01   +5.445276841358095e-01   +3.576528554177557e-01   -2.384136195232008e-01   +5.829958418200705e-02   +4.278207266811548e-01   -4.664243503670711e-02   +1.206986712986034e-01   -2.047178625059779e-01   +1.226772475907997e-01   +1.224736012211434e-02   +5.374786701888076e-01   +1.098205923485890e-01   +2.099022906752187e-01   -2.042861103211751e-01; -6.829768208425463e-01   +1.610664801813931e-01   -2.573736927297370e-01   +4.026030221064644e-01   +8.796908934696727e-01   +4.979726240098389e-01   +1.207938558848482e-02   +7.726129098528733e-01   +3.061095541280649e-02   +2.206997476521688e-01   +3.143175798619196e-01   +1.620173591481597e-01   +4.063055712709054e-02   +3.129652731098242e-01   +9.536023354315515e-02   +2.437480851364711e-01];
L1E_L1I_iGABA_netcon = [+2.150774539795247e-01   +6.946059427476007e-01   -4.129696300105969e-01   -2.309550756283156e-01   +7.154520525362164e-01   +1.049396415857387e-01   +5.559709485132673e-01   +3.890068939956451e-01   -1.630495912310869e-01   -3.511652938306588e-01   -1.276035951296830e-01   +3.532054182062574e-01   +6.433661346953946e-01   -2.357993658204215e-01   +5.927993862292225e-01   +7.558046743128924e-01; -3.136140504837973e-01   -2.264092611408202e-01   +9.075757390316238e-01   -3.509027393824375e-01   +3.797827286493587e-01   -4.156807863774399e-01   +5.583436322428775e-01   +5.558222797012649e-01   +2.740553840633367e-01   +2.122187115369552e-02   +3.972367104905763e-01   -4.690099882146673e-02   +4.786482654889431e-01   +3.496722074017008e-01   +6.414296722851045e-01   +1.357295789886815e-01; -2.035328427393019e-02   +3.434294828522487e-01   -3.939099732784413e-01   +6.591601123766736e-01   -1.537868203112847e-01   -1.244750066079063e-01   -1.521356231535585e-02   -1.516916214103059e-01   +3.264349787083512e-02   +1.672784784526642e-01   +7.044198773443891e-02   +4.645057224934948e-01   +5.759986236096424e-02   -3.857102498326579e-01   +7.112011955869405e-01   -1.161584279755088e-01; +3.171978410709652e-01   -2.689780182968752e-01   -4.948684030373177e-01   -1.536610941519977e-02   +9.876023510176468e-03   +3.550226531975821e-01   -5.811656497510270e-02   -9.434991616974937e-02   +1.195090964323827e-01   +2.216664156754702e-01   +4.506841871542149e-01   +3.485054162860282e-01   -9.723145402260695e-02   +3.702664421426812e-01   +2.043231213487382e-01   -6.994611863920921e-02; +5.426402236199010e-02   +2.103274260030492e-01   +4.030899170516080e-01   +1.161001585256843e-01   +5.765614533778778e-01   -2.955674959858366e-03   +9.031137330490502e-02   -3.594951227092488e-01   -7.939768472650802e-02   +3.073507073020786e-01   -4.061153623498288e-02   +5.925170608533104e-01   +7.424366669115221e-01   +5.830355802027155e-01   -1.443199107734268e-01   +2.655075894233270e-01; +3.082612298758889e-01   -4.014095710002143e-02   -5.119821938009759e-02   -4.469551831758745e-01   -2.763941676274928e-01   +6.689519882692849e-01   -1.107249919351511e-01   -3.767800298438336e-01   +6.733436047599333e-03   -1.083207252373731e-01   -3.585038380141368e-01   +6.970709686915229e-01   +1.079995314973586e-01   -2.121401403098157e-01   +2.840575780703835e-01   +4.417084396318650e-02; -4.535745330334979e-01   -3.053068181339806e-01   -3.278694943814126e-01   -4.847500827413598e-01   +4.912434455256086e-01   +4.112404209407752e-02   -1.089482445871318e-01   -2.896871586349657e-01   +3.965841128142459e-01   +3.901636215337351e-01   +7.119162904115701e-01   +7.997934995178854e-04   +7.858255782643640e-02   +2.980978892164050e-01   +8.380499508304272e-01   -1.064047355002138e-01; +3.252125850203242e-01   +3.359113242423184e-01   -1.878211684858321e-01   +2.932266384458038e-04   +1.419208497230671e-01   -3.396384635226931e-01   +7.902015525652730e-01   +2.981571788420407e-02   +4.774707959905461e-01   +2.764077037561171e-01   +1.461539279908840e-01   -2.344880207316344e-01   +7.222246645487354e-01   +5.427231994174215e-01   +2.349286280418788e-01   +6.352247185915731e-01; +3.934488581080549e-01   +8.316167068211862e-01   +2.925817657133279e-01   -2.042420705344313e-01   -4.930471481129047e-01   +7.420575396331844e-01   +8.535070559634589e-02   +6.884071317309481e-02   +3.699291059489760e-01   -3.264694853181975e-01   +3.437943207260749e-02   -2.228344343592027e-01   -2.950429794128809e-01   +6.777122577818492e-02   +5.816219691061133e-01   -3.179967301906207e-01; +2.656763256190711e-01   +7.187505948788190e-01   +4.221138003659284e-02   -3.857987444071628e-01   -2.176517675103983e-01   +3.316686329952480e-02   -3.964137065972915e-01   -1.024080418737696e-02   +5.289311025606551e-01   +2.695472087990123e-01   -4.736398971741052e-01   +7.083047539374746e-02   +5.524608267083965e-01   +3.600557237168132e-01   +2.874644635000791e-01   +2.820683681381669e-01; +2.087095192344463e-01   +2.970593042735005e-01   +3.473722221998860e-01   +7.298311422738930e-01   +4.485396848349543e-01   -6.664272357544739e-02   +3.597339845663796e-01   -2.485446262007705e-01   +5.968228874319426e-01   +3.228401209762073e-01   -2.206138686700858e-01   +4.494763134896268e-01   +7.278269053495875e-01   +3.734080015665046e-01   +3.185719658898657e-01   -5.125916942909677e-01; +1.240460781479009e-01   +2.143400284561932e-01   +1.806721387389532e-01   -6.733166166675837e-01   -9.613838375280108e-02   +2.581944394346819e-01   -2.494075496417965e-01   -3.984144691030368e-02   +4.893349825212027e-02   -1.621393479921029e-01   +1.565110336549369e-01   +1.996102889521330e-01   +2.921909813648574e-01   +6.150324673963471e-02   +3.938308889247749e-01   +2.236661437299357e-01; +3.583202253474042e-01   +5.303057341389018e-01   +8.139621805937122e-02   +3.738355263213011e-01   -2.835181318226876e-01   -1.076581117342578e-01   +1.686694983326814e-01   +2.657444143748230e-01   +4.464912333200381e-01   -1.130211407121567e-01   -5.850197070398557e-03   +3.196214053753602e-02   +3.617931700401781e-01   +4.428538694110944e-01   +3.127434843972902e-01   +1.151177904270752e-01; +4.950310745350462e-01   -8.157135386003819e-02   -2.158872600545784e-01   +1.347699682281569e-01   +6.054255691984383e-02   -1.415370194328059e-01   +1.138611937746190e-01   +3.518149341316753e-01   +4.944972629692467e-01   -3.325552005923503e-01   +3.140290502932003e-02   +3.555050888662394e-01   +6.826045231953207e-02   -1.743646556441099e-01   -3.551259758016633e-01   -2.604045580241642e-01; +1.137317415456183e-01   +2.631035716253525e-01   +1.941376950525059e-01   +1.153936243220471e-01   -8.778780116878729e-02   +8.848350271720273e-02   +8.066929463050983e-02   -1.921730631944956e-01   +6.369558814123927e-01   -2.027679062238328e-01   +4.562960688435304e-01   -2.399672777516828e-02   +4.757919863471310e-02   -7.836571734449178e-01   +9.089824462925213e-01   +1.236148326167201e-01; -2.998633864191226e-01   +4.614028212887297e-01   -3.687850192502834e-02   -1.542284642576193e-01   -1.065072870666723e-01   +1.252675046338687e-01   +1.328494424871804e-02   +7.193696872301322e-02   -6.672927219835730e-02   +2.850830045907516e-01   -2.172502704193527e-01   +6.491092366635709e-02   +2.737923520495510e-01   +2.098831479150870e-01   +4.556966824477264e-02   +4.037222871596219e-01];
L2I_L1I_iGABA_netcon = [-2.654225020965286e-01   -2.250766100026410e-01   +2.088769759586227e-01   +2.114921611038309e-01   -3.183776303428461e-01   +1.379651965592614e-01   +1.798430054606771e-01   -3.434279124677485e-01; +2.746738155945284e-01   +5.106157292919852e-01   +2.730673682861477e-03   +2.551962170782248e-01   +5.958397759444887e-01   +4.609280521926269e-01   +2.619908129468973e-02   -1.230025278530083e-01; +5.796782180952893e-01   +8.629939638563494e-02   +3.563185940062109e-02   +2.709780352972722e-01   +8.302103970421462e-02   +1.359174449275312e-01   +1.601155102352371e-01   +1.450957216852826e-01; +2.439974760361273e-01   -7.898136624675433e-03   +7.060733369064628e-01   +1.839249629998869e-01   +1.877892332318668e-01   +3.269925812482184e-01   +2.473183931596371e-01   -3.479810111959666e-02; +2.638003259833741e-01   -2.132174884905944e-01   +5.454008366887885e-01   +3.145798283227791e-01   +4.162747730568214e-01   +3.259009314524564e-01   +1.415859415301586e-01   -2.137753387778379e-02; +1.392369177876081e-01   -1.662749431690349e-01   +3.155412115628630e-01   +2.330420682423493e-01   +2.491017661995465e-02   +2.811380648332325e-01   +2.350576408632831e-01   +3.067160534458045e-01; +3.257177057972362e-01   +1.800439008802413e-01   +3.436328212569890e-01   -8.945367903038071e-03   +2.657958302921187e-01   +6.261977357683993e-01   +4.518676936188015e-01   +4.826002146414420e-01; -1.953171491079410e-01   +4.076310264975100e-01   +2.061372764354311e-01   +8.836720731772048e-02   +2.820153474185992e-01   +1.838217305939327e-02   +1.101425964524949e-01   +5.040930963368475e-02; +2.734278123342712e-01   +1.000000000000000e+00   -2.922523463664971e-01   +5.561114253206991e-01   +2.142043481907970e-01   +2.615650738438903e-01   +1.683629748330507e-01   -2.934533187650580e-01; -2.266532095141232e-01   -8.075339278842213e-02   +2.534959960684877e-01   -5.157012404166476e-02   +3.032319943501020e-01   -3.229216600765459e-02   -3.444607682867105e-01   +2.207359280407098e-01; +9.496865035069930e-02   +3.965468592237818e-02   +3.692273573613574e-01   +1.742291404730034e-01   +1.999364215342304e-01   -6.287159254547058e-02   +1.965462646681041e-01   +3.038579810844698e-01; +2.725003388592913e-01   +3.294911336064314e-01   +2.103809468419238e-01   -2.262071455726009e-02   -6.446678088789889e-02   -1.003168845848354e-02   +6.038699262266850e-01   +4.224668568541224e-01; +3.057331318459228e-01   +1.435179818236964e-01   +1.633431428239746e-01   +2.860248131015512e-01   +5.564745353615391e-01   -7.893383750530686e-02   -7.065249889390318e-02   -5.766426776125510e-02; -7.124997918469379e-02   -1.381092559426946e-01   +1.766222663849272e-01   -5.199623672182543e-01   +2.890339599562239e-01   -3.090679820705564e-01   +2.402750447828678e-01   +3.069247375775453e-01; +2.719095878615952e-01   +1.246635547523757e-01   +3.424748667580258e-01   +1.885156236266264e-01   -7.304081058214119e-02   +7.882356254827758e-01   +5.816779265197131e-01   +4.564510128896613e-01; +1.161150862190804e-01   -9.627755540386913e-02   +2.164242312874431e-01   +3.855553611777324e-01   +2.089426979313369e-01   +2.346795002290103e-01   -4.599311874921480e-02   -1.091269030806028e-03];
L1I_L2I_iGABA_netcon = [+2.208548455759526e-01   -1.838696855057300e-01   -3.095341174808403e-01   +3.047798098951433e-01   +2.571182929301633e-01   +9.768300458399425e-02   -8.671108013799657e-02   +2.180622977568420e-02   -1.042683866769577e-01   +3.986279311994570e-01   -2.580815853625660e-01   +4.184209188385250e-02   -3.230761808061661e-06   -1.349383430297197e-01   -2.232054661186660e-01   +1.926511933296529e-01; +3.373081323058552e-01   -3.643977084474798e-01   -2.502520854520003e-02   -3.081563242956062e-01   -2.181090678173237e-01   -4.954668859111666e-02   +2.338346494496646e-01   +2.049375568219810e-01   +6.448764864354642e-02   +6.366387183014063e-01   +2.449148843587269e-01   -4.548939602937164e-01   +3.737521312856679e-02   -2.042557363795578e-01   +3.920834586285841e-01   +1.318770200167602e-01; +2.624139958461290e-01   -3.030493768683469e-01   +4.043373329483185e-01   -9.382796651431850e-03   +2.258280522041594e-01   -1.623732984978420e-01   +5.209997919518090e-01   +1.706591274979057e-01   -8.538829371262270e-02   -5.597685296454913e-03   -2.903325058758950e-01   +5.716835367947352e-02   +1.301077051710477e-01   +3.718359169114074e-01   +6.667133251843180e-01   -2.990997144545127e-02; +1.059912955357638e-01   +6.999540481003447e-01   +2.311065934780315e-01   -1.300813580203689e-02   +3.105113522313033e-01   +7.397889756132233e-01   +3.504627542813885e-01   +1.465737373985675e-01   +4.329987378961586e-02   +6.208269842353515e-01   +2.804150510339008e-01   +2.842905781503968e-01   +3.461998817636059e-01   +4.218087699102780e-01   +2.869374578522175e-01   +2.175194589008138e-01; -4.963878023474815e-01   +2.171169104825993e-01   +1.284776968603999e-01   +2.977206290442551e-01   +1.255897703106097e-02   +4.967680102674566e-01   +4.264870425098691e-01   +3.864415153357851e-01   +3.933808568245262e-01   +3.236946571373810e-01   +8.641243702016712e-03   -2.240155058982023e-01   -6.010888199570150e-01   +1.556395839149546e-01   +2.348399013760743e-01   +5.862880226655802e-01; +2.686089586119299e-03   +4.695931580988949e-01   -4.367546260294517e-01   +4.814291648404370e-01   -1.064030656829708e-01   +9.484963896708068e-04   +2.949078203236759e-01   -1.421604018328415e-01   +2.035895654778202e-01   +1.002178997565154e-01   +1.601816306292033e-01   -3.528345225129795e-02   +3.877214919998812e-01   +1.000000000000000e+00   +1.388224638859555e-01   +1.000972702679357e-01; +1.842895517369214e-01   +8.937395459885605e-02   -3.257810496424871e-01   +2.692550324115615e-01   +3.949877728789091e-01   -3.605422049977959e-01   +4.770773530514048e-01   -1.418596700390766e-01   -1.187443371934773e-01   -3.980002806131704e-01   +4.752111993051459e-01   +2.678873007760475e-01   +6.124122598955077e-02   -2.622395372340150e-02   +7.190101042724395e-02   +1.946432889085233e-01; +4.098260766961352e-01   +1.539839960309663e-01   -7.842069388856331e-02   +1.419147063917305e-01   +1.796804967787574e-01   +1.472111088354430e-01   -2.098685285264362e-01   +1.069724672041712e-01   +1.546855755109348e-01   +3.003992253764816e-01   +1.890505407090506e-01   +3.534883504801375e-01   +9.789185724949285e-03   +2.124772702488627e-01   +5.347955183596946e-01   +4.694481669531579e-01];
L2E_L1E_iAMPA_netcon = [+3.613864247056374e-01   -4.193011152610739e-01   +1.302683924946788e-01   +4.963016622542237e-01   +8.804675291788397e-01   +5.279591308975896e-01   +6.732989706138057e-01   +1.011565952189263e-02; -1.110155492641546e-01   +2.149277102075412e-01   -1.932274141155633e-01   +1.291999671676849e-01   +2.540029449645123e-01   +3.877073402458962e-01   +3.304826400409590e-01   +1.701186806234975e-01; +4.637047528764421e-01   +1.869901719060121e-01   -2.397357398102380e-03   +3.096028226509525e-01   -2.595076941252409e-01   -1.983591065312221e-02   +1.429264044619086e-01   +5.587551022200365e-01; +5.446677533769443e-01   -5.030321102761667e-02   -2.532721332479662e-01   +5.439685179720396e-01   -2.184032059473481e-01   +1.271955689724380e-01   -3.037617272495454e-01   +3.382802988875476e-02; -9.903515724244707e-02   +3.440173743274444e-02   +4.130804602372952e-01   -1.652934458540102e-01   -1.571001965058196e-02   +9.110056014773449e-02   -8.633047066475098e-02   +3.363435253502312e-01; +6.281757667734778e-01   -3.671008820458762e-01   +5.480793586112062e-02   +4.006439689242768e-01   +3.666505553144648e-01   +6.866514231410952e-01   +7.120186661831636e-01   +3.322359093753472e-01; -3.010759045089831e-01   +6.341877718657454e-01   +2.428251029815110e-01   -3.217854629490584e-01   -1.745860201428241e-01   +2.177006009210800e-01   +6.824908467164622e-01   -3.321955247522601e-01; -1.342075241536274e-01   +4.521974689392980e-01   +9.611230958805907e-01   +4.973371775753536e-02   -2.174396545786116e-01   +3.457127239939634e-01   +2.309725345710429e-01   +1.185793448389030e-02; +4.113479422721295e-01   -5.747492374006256e-03   +5.865704561987806e-01   +4.582375812189818e-01   -3.551702771094805e-01   +4.145876554902618e-01   +5.158578815935442e-01   -3.522962569936158e-02; -1.887242051159488e-01   +1.072374549940932e-01   +3.895985245219651e-01   +2.327045417557420e-01   -1.105595187930639e-02   -2.268341823695262e-01   -1.256362541443647e-01   -1.208247381170742e-01; -1.765141234322923e-01   +4.842396854800780e-01   +7.849706865825971e-01   +1.642791728246384e-01   -3.087321217099756e-02   -6.315872248919358e-02   -6.231828063367838e-02   +1.145831067520573e-01; +7.356848992356356e-02   -5.333981802273066e-02   +3.830402618376871e-01   -2.446683354419737e-01   -2.301820804508907e-01   +1.747656931420700e-01   -3.118084411954402e-01   -1.550579663343760e-01; -1.860765656042385e-01   +4.848724780091002e-01   -8.562869910852176e-02   -8.327205858269571e-02   +7.214674448499756e-01   -2.737908248839178e-01   +1.462084870936090e-01   -1.581886292561039e-01; -8.837088874926731e-02   +9.092568826694322e-01   -8.964439279129152e-02   -1.742642844506149e-02   +3.765730116986293e-01   +1.765043124245060e-01   -1.925491609272209e-01   +2.015735471998411e-01; +3.161226689506398e-02   +2.009920953507646e-01   -1.336113553571290e-01   +3.564144717246740e-01   -6.330988472207830e-02   -1.414149224249685e-01   -2.489215807037249e-01   -9.478101332299915e-02; +2.848790190982533e-01   -2.986359136286378e-01   -5.219873459954906e-01   +1.115650531017594e-01   +2.187342049784092e-01   +2.963395951855010e-01   +5.680083039411244e-01   +5.387689471427463e-02];
L1E_L2E_iAMPA_netcon = [+4.123900262591623e-01   +2.656343016520325e-01   +1.514247538675936e-01   -2.259440309024699e-01   +3.461441191440067e-01   +2.741761903890694e-01   +1.645563522353937e-01   +9.080977175875385e-02   +2.512844623377315e-02   -3.719404606442688e-01   +5.761614227824516e-01   -1.722743745106933e-02   +1.401711293594098e-01   -2.086999340522230e-01   -2.230635289984115e-01   +3.442038732799403e-02; +2.074331496791053e-01   -8.262254139053481e-02   +4.528072667181346e-01   -1.431892733170425e-01   +7.791450968641178e-02   +3.542644573407942e-01   +3.718670266701469e-01   +1.335201289281038e-01   -9.980763245971846e-02   -1.080298678845438e-02   +5.278310821162682e-01   +1.547041560521367e-01   +5.384611769136414e-01   +2.331456867304154e-01   +8.284151262295165e-02   -3.362760008087662e-01; +9.382201390319661e-01   +6.175103625143853e-02   +1.909114152704855e-01   +1.111395933430541e-02   +3.624014738427134e-01   -1.589130773699057e-02   -1.259472937149791e-01   +2.818573295917103e-01   -1.333032853929229e-01   -5.566058314059188e-01   -9.875113949015508e-03   +3.316862952987678e-01   -1.194601419191478e-01   +4.398760158947724e-01   -1.335302762649047e-01   +1.473480523470088e-01; +2.387968682201504e-01   +2.444474129149128e-02   -5.472384591873648e-02   +4.009982421024652e-01   +3.726461833517543e-02   +6.458862753156189e-01   +8.799128944471010e-01   -3.571718254149577e-01   -1.275535377703018e-01   +2.721481849520896e-01   +5.554511970545666e-01   -3.432744512504644e-01   -3.783670087031005e-01   +8.121179343127328e-01   +3.368021585564545e-01   -8.047632666640141e-02; +4.358153423420454e-02   -5.380025303872691e-01   +1.792630975823814e-01   +1.682489965671713e-02   -1.878883717206029e-02   +2.256628564069076e-01   +4.306069556906596e-01   +2.310612324838521e-01   +5.543877831592697e-01   +6.510448183808966e-02   -9.764304297065900e-02   -6.073171206436202e-01   -1.900312931599023e-01   -1.531218172480091e-01   +1.225611533149638e-01   -3.073185199169662e-01; +4.042385103628376e-02   +3.676103366286859e-01   -4.748669764744910e-02   +5.180756386485367e-01   +1.553099852500447e-01   -6.855184238568782e-02   +9.506555879622173e-01   -3.100873415710327e-02   +2.971242624903424e-01   +1.039390020471465e-01   +4.733835412264500e-01   +3.114026823967246e-02   -1.629392495738790e-01   -1.220247900187929e-01   -3.589645771305342e-01   +7.237564470491433e-01; +2.995211579421405e-01   +2.060341847491834e-01   +1.846710961401495e-01   -3.025190957623299e-02   +1.927266186146043e-01   +2.197917996071720e-01   +3.415116663365259e-01   -5.428110095925465e-01   -1.155260231816430e-01   +2.036125044012718e-01   -4.166864149510965e-01   -8.307934273987613e-02   -5.505570892080266e-01   +5.016423630728589e-01   +6.401646048324123e-01   +4.849205722465991e-01; +5.235503718997422e-01   +2.669093485992164e-01   +5.064675802070872e-01   +7.543056185957007e-01   +2.479985000628059e-01   +5.066339392863287e-01   +1.949662433647708e-01   +3.776976308035596e-02   +2.513089340521305e-01   +1.675823074609905e-01   -2.512504492473877e-01   +7.285976718991170e-03   -6.694507746196223e-01   +2.470884728680283e-01   +2.967159787531624e-01   +4.564909036612518e-01];
L2I_L2E_iAMPA_netcon = [+1.274938388834887e-01   +7.780129944917465e-01   +2.654523976457431e-01   -1.989007779913158e-02   +1.858752846452676e-01   +4.466464007047812e-01   -3.113863643089322e-02   +5.409485654294237e-01; +6.025283460208953e-01   +1.075535825001861e-01   +5.214193736041903e-01   +8.388751007351379e-01   +4.864565598102433e-01   +3.645261734151873e-02   +1.882240989982574e-01   +1.538525096033735e-01; -3.337159487704004e-02   +4.003501852335216e-02   -3.892465823401535e-01   +1.461670716992486e-01   -1.315351283374130e-01   -1.753250851904690e-01   +2.632230137404246e-01   -1.032201993527921e-01; +3.990349497107486e-01   +3.964572658507649e-01   -6.526371983587582e-01   +3.400643789775838e-01   +4.514593634399440e-01   -2.289238945450828e-01   +3.803469296440676e-01   +4.126524473330718e-01; +3.122568122698942e-01   +7.656423063010537e-02   -1.214959363028308e-01   +2.003388928777759e-01   +7.380820781499398e-01   -2.364816318111833e-01   +2.525534772588323e-01   -1.714749723334911e-01; +4.451147080698567e-01   +1.391481056833182e-01   -2.687066119726132e-01   +2.817861035316808e-01   -3.720100163233173e-01   +1.658879321733902e-01   +6.520163281796393e-02   -2.262618880323456e-01; +5.079258770419041e-01   -4.661144773835048e-01   +3.952491267086684e-01   +6.184705890292017e-01   +2.171982397640224e-01   -2.876262928771400e-01   +8.844820902180240e-01   -4.300491798935585e-01; +1.261392631858843e-01   -5.152730724917824e-02   -7.985233694229217e-01   +1.654251395279333e-01   -5.787182749113644e-02   -2.623259478213258e-01   +7.907857266313435e-02   +7.491760574951141e-01];
L2E_L2I_iGABA_netcon = [+2.110557520583265e-01   +3.385690216304325e-01   +1.834326029233061e-01   -3.577511583439322e-01   -9.016479395578417e-02   -4.435608364419748e-02   -1.023313317970371e-01   +7.405633085230725e-01; +2.541250507026707e-01   -1.409433915199699e-02   +2.781567333639856e-01   +9.894206711779727e-01   +5.095189725592900e-01   +4.696760306301642e-02   -2.669278096621125e-01   +9.358019906118263e-02; +2.800257344967703e-01   +7.494184751840736e-01   -4.648637136224534e-01   -5.062612395794173e-01   +4.233214814146886e-01   +6.215476164707052e-01   +1.706372086608199e-01   +1.926227109663483e-01; +2.917480497804202e-01   +4.337106825244085e-01   +7.466357309771582e-02   +4.790555246187175e-01   +6.435704939690803e-01   -3.339189169578080e-01   -2.593622171628298e-01   -6.116261161921636e-02; -2.216237935204678e-01   -1.909985706050561e-01   -1.607874089766436e-01   +3.452555354909932e-01   +7.039532377228662e-01   +1.728432978433465e-01   +2.360317448206926e-01   +9.815221043720332e-02; +7.349702309964327e-01   +4.444758398991879e-01   +4.888226788662835e-01   +3.505743516745827e-01   +2.321611330351533e-01   -1.698255746652102e-01   +3.795624423186642e-01   -5.079044830135984e-01; -2.623259699683838e-03   +6.266191644058876e-02   -4.643068812433222e-01   +5.751739496878176e-02   +5.204667659639067e-02   -2.624918727506169e-01   +8.542558340437156e-03   +7.011940906868245e-01; +5.018775216643667e-02   +3.139443659769159e-01   +2.679863232869710e-01   -8.541385106052381e-02   +5.315666024110314e-01   +2.421410825402921e-01   +3.615903371636530e-01   +3.967557886524027e-01];
L3E_L2E_iAMPA_netcon = [+3.030264029636838e-01   -2.412262965552691e-01   -2.911350319104419e-01   +2.152736686479579e-01   +5.220739060178774e-01   +2.363825986780617e-01   -3.870556643133353e-01   +9.668092122538933e-01   +3.922305043723916e-01   +1.539380500623338e-01   +3.244789875949683e-01   -6.529031552519501e-01; -1.543614845943423e-01   +2.646719371870502e-01   -5.830451761092399e-02   -3.907433948322141e-01   -2.356855099081833e-01   -3.566774185702384e-01   -5.008092751919605e-01   +1.035892946153063e-01   +1.219526550418665e-01   +4.145032274932795e-01   -6.648892741956694e-02   +6.020415875159153e-01; -5.028264334616245e-01   -2.403022210179691e-01   +5.749633942482042e-01   +2.495946101917512e-01   +1.139235938706777e-01   -1.272647478818036e-01   +1.273935699959562e-01   +1.314923622186025e-01   +6.730089120068313e-01   -4.898426294742348e-01   +8.103569513918275e-01   +3.677029573793738e-01; +4.516593231859201e-01   +3.731044640906517e-01   -6.429548452190526e-02   +1.210758973181521e-01   +6.061187703230342e-01   +2.468845425037658e-01   +8.479493183780508e-02   +5.923292054644619e-01   -1.653668738120046e-01   -4.518259127988173e-01   -2.525447830552443e-01   +1.168451263875954e-01; +4.893095403939649e-02   +5.802900602648946e-01   +5.454517345285765e-01   +1.374709117281678e-01   +2.612327601582166e-01   +5.699221487377413e-01   -4.884514667547628e-02   -2.086125806373922e-01   -2.042724943308369e-01   +7.082404260523077e-01   +2.429604574160887e-01   +5.838665099407733e-01; +2.604253276250906e-01   -1.270736887965035e-01   +4.249490027199574e-01   +2.552330376699239e-01   +6.092518416720590e-01   +5.216749347945921e-01   -2.353253774848921e-01   -2.263283924547617e-01   -5.675370919442896e-02   +1.655285554769985e-01   -1.677633427374931e-01   -2.510933755008190e-01; +5.258628374805110e-01   +3.050203800596446e-01   +1.852001469338665e-01   -1.116308808091363e-01   +3.217775141822517e-01   +4.992578641646605e-01   +4.593214792762747e-02   +2.166925802393081e-01   +2.749003760088452e-02   +1.349352233169233e-01   +1.466849998951057e-01   +1.487157127198108e-01; -2.507704157036159e-01   +9.339280269482673e-01   +2.626648897221949e-01   -6.848854402529999e-01   +3.142040286276178e-01   -3.302494643201273e-01   -3.573452339519543e-01   -5.167841243744704e-02   +2.019504413224298e-01   +9.522829941280017e-02   +2.913249664547629e-01   +1.339769061602339e-01];
L3I_L2I_iGABA_netcon = [+8.197647288105172e-01   +8.457431774508486e-01   -1.576829146914176e-01   +4.863919157581739e-01   -4.238215972908757e-01   -4.029441065896523e-02   +9.587258945010504e-01   +6.740507130349775e-01   +2.370736862549961e-01   +3.466582602707362e-01   +2.192662112906433e-01   -2.061768111607177e-02; -5.570979395338369e-02   +9.511188237924020e-02   +1.793957203706712e-01   -2.205318558358043e-01   +2.652380635787392e-01   +2.151608889208061e-01   -6.942418045291190e-02   +1.580515783583899e-02   +2.487545888300608e-02   -3.662964121541387e-01   +1.178034723739402e-01   -7.034257548985293e-02; +1.105019332963647e-02   -5.338145686347587e-02   -2.277142268528918e-01   -7.555074912903581e-02   -3.625684462720124e-01   +4.264034623672217e-01   +2.936571946488343e-01   +3.653328723228681e-02   +1.983344474768030e-01   -4.035095692762225e-02   -2.194463570381632e-01   +8.806405172714313e-01; +6.745971590448694e-01   +2.869944150430976e-01   +5.451698764203172e-01   -2.162086736105336e-02   +1.054923860499138e-01   +7.778333846595092e-02   -6.075113839016030e-02   -1.234299343629441e-01   +3.094552398875705e-01   +6.338879813666858e-01   +6.293627406188385e-01   -2.144289731587419e-01; +1.665770902164629e-01   +3.358597131122494e-01   -6.027540166764379e-02   -1.168123950260357e-03   +3.391558480627879e-01   +5.814237402445748e-01   +1.809905664430336e-01   +4.671098231169329e-01   +2.268426565651855e-01   +2.480944423143407e-01   +3.762571175798995e-01   +1.611383712106942e-01; -9.750588867067501e-02   +3.527388363818844e-01   +4.804350349543101e-01   +7.807111019086525e-02   +3.647507552540597e-01   -3.665180121884346e-02   +1.054837812396360e-01   -8.008604023640432e-02   +2.892629010419357e-01   +3.345474972531468e-02   -9.049825946170296e-01   -3.193677630880056e-01; +2.143858720683361e-01   +1.793699913572162e-01   +3.598766169767699e-01   +3.754265147286209e-01   +4.862956086532348e-01   +6.977510333528721e-01   +3.742570199428827e-01   +1.959163627619493e-01   -7.742431639226381e-01   +5.833566005557499e-01   +1.856363184511487e-01   -5.942114387310361e-01; +1.941699606111154e-01   -1.923458004932817e-01   +5.770814729536254e-01   +2.338208492118783e-01   +1.066101795934403e-01   +2.746792060397347e-01   +6.155171099829758e-01   +5.688859126459836e-01   +4.988175903929842e-01   +5.137574374143702e-02   +1.409696763869762e-01   +1.290898721484284e-01];
L2E_L3E_iAMPA_netcon = [+4.840077531019709e-01   +3.038080849872128e-01   +5.541600393332339e-01   -7.191200737241915e-01   -1.893795630823324e-02   +4.704384810700038e-01   +7.571127027338108e-01   +4.629308983750655e-01; +3.916036197978688e-01   -1.939574973316737e-01   -1.069766296081185e-01   +2.300785967970349e-01   +8.128938185684125e-01   -4.848569016256460e-01   -6.698838136328858e-01   -4.216142576765738e-01; +1.346987821191876e-01   -4.796013724352347e-02   +9.623455701485681e-02   +2.389084398007599e-01   +1.322425918252413e-02   +2.090755386763641e-01   +1.713251376545845e-01   -1.731665989498173e-01; +2.559818484229729e-01   +4.572351986340477e-01   +7.536295488842377e-01   +8.623118036589612e-01   +2.893879820373385e-01   +4.330852495842092e-01   +1.697867573769468e-01   -5.460607064872229e-01; +8.406542179848941e-02   +1.707219970093231e-01   +2.192497865890647e-01   +3.492992452840132e-01   +1.498407857101159e-01   +3.436627708462910e-02   +6.895221133923476e-02   -5.322375480029287e-01; +1.296703626053426e-01   +5.509431318217829e-01   +4.955797923601067e-01   +6.283208680925700e-01   +1.010855102322491e-01   +6.926976682788531e-02   -1.711314779566552e-01   +1.798063581205670e-01; +1.946000729057287e-01   +7.785602234745537e-01   +4.883829545516936e-01   -2.547450057311146e-01   +4.411949574070740e-01   +7.726035943183064e-02   +4.380179351316963e-01   -4.691142336419643e-02; +2.743335219337672e-01   +3.200859334590641e-01   +6.473040457680077e-02   +2.721182678695260e-01   -4.522034901992310e-01   -7.949372104146514e-02   -7.003417525860594e-03   +5.013346436026919e-01; +7.333509257713616e-03   +5.772612851078163e-01   +5.994814087877455e-01   +8.329354648407959e-01   +1.583828901588452e-02   -1.303580739892737e-01   +6.452034152056962e-01   -9.428799608368285e-02; -2.219218900228444e-01   +9.724355175144885e-02   +3.261353280276044e-01   +1.843809129044529e-01   -2.402851724140515e-02   -2.921098535245580e-01   +3.228961321101443e-01   +4.615796833382352e-02; +6.854457226341014e-01   +3.952319333621109e-01   -3.991951819578594e-02   +4.885197416425711e-01   +4.059266735433901e-01   +9.131909871886673e-01   -6.365542297178632e-01   +2.433739778146307e-01; -3.468205501623247e-01   +4.858170696413336e-01   +4.611444218951809e-01   -6.828078324355516e-03   -1.027732654419047e-02   +8.950082275141699e-02   -9.476984469242561e-02   +5.447895978518830e-02];
L2I_L3I_iGABA_netcon = [-2.724858368270296e-01   -9.625559870647904e-02   +2.396292736491975e-01   +2.684268864356483e-01   +2.982480863837333e-01   +7.224588836899820e-01   +3.620738282830417e-01   +2.716006245117717e-01; -3.979587382877135e-01   +2.555560430871677e-01   +1.512370045894392e-01   +8.625033918369628e-04   -3.630764963184610e-02   -8.468177400154359e-02   +2.177399306448403e-01   +1.105063289831353e-01; +2.027360628475045e-01   +9.823165648096682e-01   +2.834120474984790e-01   +8.826171182929876e-02   +2.715418348788200e-01   +5.863579794039273e-01   -1.923409705023236e-01   +1.222658429281902e-02; -3.210620001217319e-02   -7.094613995795188e-02   +8.064296650326985e-01   -1.063164780390806e-01   -1.022439922884224e-01   +3.889083419134609e-01   +4.585247360590062e-01   +4.105755517530130e-01; +1.054413918320304e-01   +9.732063413090408e-02   +3.238937718543535e-01   +3.460125839180371e-01   +1.338698543881426e-01   +4.131764653531213e-01   +4.565462737465759e-01   +1.359658547951984e-02; +8.738319810026948e-02   +4.652099364895732e-01   +1.696504608783446e-01   +1.154832262848220e-01   +5.206320022502778e-01   +1.126889956477330e-01   -2.843327536745188e-01   -1.174428658274624e-02; -1.982351684838769e-01   +6.943705918185602e-01   +4.339975987798256e-01   +3.032951783563481e-01   -2.267640132874657e-01   +1.654185954826418e-01   +9.014678655689196e-01   +3.434014375047476e-01; -2.943721439062648e-01   +5.066559462623055e-01   +2.421538152883067e-01   +6.643540796089877e-02   +2.946490620888394e-02   +5.479873101625344e-01   +2.368425494018884e-01   +5.912233366968611e-01; -5.321307725567481e-01   +8.213437343578822e-01   +5.697989790503089e-01   -6.422091674977118e-02   +2.849923165203799e-01   +1.015619742835771e-01   +2.481735157396831e-01   +1.188251021448086e-01; -1.178106199403931e-01   -2.030426348936322e-01   +2.207070129193395e-01   +2.440104122850297e-01   +3.156064802515931e-01   +2.348404185897008e-01   +1.081214445673506e-01   +1.820981942545030e-01; +4.365387202385452e-01   +1.520364499838053e-01   -6.022404816733395e-01   +3.547437470896792e-01   +1.763449462636074e-01   -1.710065342388080e-01   +1.781519738670960e-01   +3.061616979427791e-01; -1.148939786294104e-01   +3.815583335670804e-01   +1.444540939921135e-01   +1.678836865800265e-01   +4.150586355767183e-01   +3.602191133949616e-01   +2.232743909640388e-01   -1.400301737851452e-01];
L3I_L3E_iAMPA_netcon = [+1.417937071968113e-01   -5.352376153270101e-01   +2.376314883368327e-01   +8.266295584544843e-02   +2.714900051147632e-01   +1.882766750822893e-02   +1.311295561478709e-01   +6.807092329866898e-01   +5.666979644411579e-01   +3.023649809707211e-01   +8.073527085464377e-02   +6.359515528867289e-01; +1.465050086525821e-01   +1.560895460159478e-01   +2.213614981061810e-01   +6.397855223954507e-01   +5.317797593123934e-01   +2.058380145095168e-01   +3.976916507504727e-01   +6.595515561437393e-01   +5.388583209071126e-01   +4.808431111441658e-01   -5.975088409476192e-02   -1.047348816752537e-01; +2.687814061894278e-01   +5.738116652630341e-01   +1.338597643551653e-01   -1.333655509788284e-01   +8.153975888483824e-01   +5.145168775122115e-01   +5.654448006062605e-01   -2.154004702848419e-01   +3.388923663104639e-01   +1.694787860692331e-01   -2.587937160229635e-02   -1.788845065568326e-01; +1.308856232178719e-01   +1.161996538680312e-01   +4.659470820317301e-02   -1.192442996978512e-01   +3.450973479555521e-01   +1.423346396674905e-01   +2.126725853742319e-01   +5.034685690029855e-01   -1.781023906775347e-01   +2.666160957051705e-01   -2.887442102175349e-01   +1.635075893224701e-01; -1.227892432873675e-01   +4.393581055855590e-01   +9.908498637065167e-01   +4.340747490843095e-01   +1.318365704269608e-01   -1.058952330227264e-01   -9.010259907095362e-02   +3.452245292044323e-01   +4.558977938978146e-01   +4.288109008701407e-02   +1.878851133914209e-01   -2.005591536520157e-02; +3.037813878613144e-01   -2.426459166382494e-01   -1.962039818818540e-01   +4.115686555250361e-02   -1.467586858812669e-01   -1.292694575945170e-02   +6.404591401040942e-01   -1.159699239793801e-01   +3.489034401551033e-02   +2.304308881369568e-01   +1.568691649902909e-01   +8.161879937236602e-01; +3.457716354898358e-01   +1.379828733240830e-01   -2.813174078138241e-01   -6.658815882047886e-02   +2.324041733189659e-01   +1.394785880227265e-01   +2.024672172058467e-01   +1.465549703376464e-01   +4.055479084218704e-01   +6.334540209207090e-02   +1.813277058562588e-01   -1.928507244208265e-01; -4.601093264295508e-02   +3.427907013454438e-01   -3.861249729726109e-01   -2.968844570981425e-01   +2.676746780988406e-01   +2.280946846531804e-01   +6.472467046992388e-02   -3.246069650163445e-02   -2.486929647451513e-01   -4.257032319325683e-01   -3.893282797876801e-01   +1.528968069516741e-01; -4.731226850759681e-01   +7.578516031549916e-01   +2.698196448641056e-01   +6.386796753742632e-01   -1.562519553497173e-01   +4.478588357253238e-01   +3.716998895850399e-01   +6.441524555089322e-01   +2.206970804827553e-01   +3.034047717383560e-01   +3.210899514522544e-01   +5.753027486064428e-01; +8.363543185925190e-01   -7.533538900548058e-01   +6.772368271997130e-01   -1.583172754985063e-01   +6.508983581302592e-02   -1.503472085068972e-01   +1.136137036556117e-01   +2.936812233926132e-01   -1.296813531398779e-01   -6.967941219911343e-02   +4.667857352955022e-01   -3.307744942502409e-01; -2.968318838903846e-01   +5.391284241370669e-01   +5.077491172036585e-01   +3.240194608605733e-01   -2.592099407831291e-02   +1.126628464322948e-01   +3.977213209603735e-01   +2.708323151996700e-01   +5.799895981076444e-01   +1.389843983252789e-01   +1.069068290838077e-02   +4.075825708745019e-01; +2.872965982031395e-01   +1.437150312068479e-01   +7.409837920943953e-02   +4.677230256064562e-01   +1.211578037525033e-03   -2.245557961935351e-01   -4.879057440712553e-01   +2.915384760726689e-01   +1.338843789726078e-02   -2.963645128531625e-01   +2.123332268801485e-01   -1.294062931045088e-01];
L3E_L3I_iGABA_netcon = [-9.217091272087672e-03   -2.466744954349759e-01   +4.433057881403450e-01   +1.489765299681679e-01   +3.492711949481036e-01   -1.105377635007573e-01   -4.300578380170357e-01   +1.177867993253245e-01   -1.759749071362170e-01   +5.692192792815234e-01   +3.607101169391084e-01   +3.699046796837551e-01; +2.643731297575609e-01   -1.852461024391138e-01   +2.862624423211869e-01   +1.171303496779188e-01   +5.192087215733086e-01   -4.650006904445491e-02   +1.600960210902433e-01   -3.139336694535357e-02   -4.864595097309408e-01   +2.693470130927800e-01   -7.195810238378353e-01   -1.168409881544556e-01; +5.368001105973018e-02   -3.319501346708592e-01   -4.760266898638688e-01   -1.869318275991157e-03   -1.702838536768013e-01   +2.469274372248048e-01   +5.615413782565635e-01   +3.190190948916755e-02   -1.294192252471764e-01   -1.299139487182777e-01   -3.696998311864865e-01   +2.409104618245737e-01; +4.495471585475360e-01   +1.461413543130630e-02   -2.966079350116390e-01   +7.616230680045009e-01   +7.877737572200260e-01   -2.593704340947995e-01   +2.081807883184384e-02   +1.793852532361803e-01   +7.629859344771776e-01   +4.819885225464184e-01   +3.274378193981729e-01   -3.259386224159744e-01; +2.207098984167598e-01   +2.379139297696831e-01   -2.879506135155230e-01   +1.175644131455959e-01   -8.845483563366477e-02   -2.981770353026031e-01   +2.394141273645034e-01   +5.533223037899228e-01   -1.842034494569133e-01   +9.344002294421500e-01   +4.630176662266692e-01   -2.958922219428697e-01; +3.620834385543183e-01   -1.598959343296351e-01   -1.391566070070814e-01   -2.390613849309490e-02   -8.503978170195237e-02   +1.079701127397274e-01   +3.890104374234832e-01   +2.991586271395955e-02   +3.157781712733065e-01   +4.459513954152447e-02   -2.110083794580335e-01   +1.064257951553863e-01; -2.592646652744462e-01   +7.819587450189951e-02   +3.428868781997909e-01   +7.761306119959751e-01   +9.144042188125617e-03   +6.457613915710521e-01   +4.972721746410451e-01   +5.465662841289187e-01   -1.318550042300097e-02   +2.722747365972754e-01   +2.118210653682570e-01   +2.369021551652391e-01; +2.191883715176920e-01   +4.234699900077131e-01   +7.531446291303537e-01   -1.899524506203198e-01   +3.499197012139479e-01   -4.674238899962518e-01   -6.865690282453408e-01   +7.058638259307901e-01   -2.165279827011603e-01   -5.101205096933681e-01   +7.363900260779936e-01   +2.785337196892630e-01; +4.515923614410099e-01   -5.402791764944521e-03   +5.433280728633734e-01   -1.467798286275125e-01   +3.684718949572775e-01   -1.574730632327720e-01   -6.604626616370949e-01   -1.330360271381568e-01   +3.965737552764318e-01   +1.840086336829458e-01   -9.631248815118151e-02   +5.953164425342113e-01; +3.572129278954053e-01   -2.432722601728033e-01   +3.393284342154137e-01   +3.548166321142303e-02   -6.072237775933892e-01   -5.536396546209422e-02   -2.563778120963565e-01   +2.803974811581728e-01   -1.579245021044360e-01   -4.328075821325848e-02   +3.044420585106402e-01   +3.734745716067958e-01; -8.697072565795413e-02   -1.438033293021105e-01   +1.736480921804832e-01   -7.859410249114371e-02   -4.158982367742717e-04   -1.911355845637050e-02   +3.700808080811434e-01   -4.519573761169624e-02   -2.499670157756082e-01   -4.666344225635219e-01   +1.286170369486186e-01   +2.253380661681321e-01; +1.781443797176678e-02   -1.892848340367046e-01   -5.557696439076062e-01   -1.344129184938484e-01   +8.006734997390458e-01   +2.602471827971509e-01   +3.408234618241432e-01   +4.823415627171009e-01   -7.119208196917522e-02   -3.899950803358737e-01   +5.680958905998679e-02   -6.075462071697427e-01];
L2E_Input1_iAMPA_netcon = [+8.390720501685023e-01   +9.752555202453870e-01   +7.460201513352260e-01   +2.049142524550348e-01   +2.560792844424044e-01   +4.083462894950742e-01   +9.035728825554572e-01   +4.706211039247348e-01];
L2I_Input2_iAMPA_netcon = [+6.276347273101344e-01   +7.390835462418044e-01   +4.627303178574458e-01   +1.652717440702101e-01   +6.463029258906569e-02   +7.323971034080178e-01   -1.907351520164548e-01   +5.531536939756568e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
