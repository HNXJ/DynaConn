function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.862893368948786e-01   -5.116118690867379e-01   +1.597234614293606e-02   +1.119807412233079e-01   +5.654874864266670e-02   +1.242406979592312e-01   -5.200965516079371e-01   -6.945057532117765e-02   +4.640858282842803e-01   +7.400387567597715e-01   +1.699900813095568e-01   -1.074418832988677e-01   +4.932655488668139e-01   -1.001597522942129e-02   -3.183172527360879e-01   -1.903985358516549e-01; +3.080374010744139e-01   +4.219791601944167e-01   +2.487338354627364e-01   +2.513927543417257e-01   +1.101490651524877e-01   +6.570811814181254e-01   -3.575889027732582e-01   -1.024028739660755e-01   +1.675170070072437e-01   -4.422445892307361e-02   +2.051034717816529e-01   +2.556798272314589e-01   +3.702625013106495e-01   -1.278482733120680e-01   -1.321567703434561e-01   -1.115874347261469e-01; +3.088688569350118e-01   +4.480467125298084e-02   -2.499112693132698e-01   +1.170905796649876e-01   -1.754508969457462e-01   +4.242594319665763e-01   +6.011272647404692e-01   -2.395180639824431e-01   +4.136042779755902e-01   +3.073405820083401e-01   +1.581838795610607e-01   -3.308875552647517e-02   -1.898722403452609e-01   -5.413148026345880e-01   +2.383122338186930e-01   +5.761246487641331e-01; +4.205981221082044e-01   -2.603696579995152e-01   -4.158386679873327e-02   +4.891397007883155e-01   +2.967168715245024e-01   +6.497856232382677e-01   +5.447343062420290e-01   +2.347936911550001e-01   +1.603942971212024e-01   -1.334399420873513e-01   +3.525567122397277e-01   +6.182877323260839e-02   -2.420152864323029e-01   +4.858400406032061e-01   +1.750759999878690e-01   +7.847792534326722e-01; +4.131915535560801e-01   +1.133216448043146e-01   +6.487270437774395e-01   +3.789611731716341e-01   -4.335133362197156e-02   +3.095219547982494e-01   +6.896114911497739e-02   -7.348954809615140e-03   +5.735118788879955e-02   +2.363894402618984e-01   +5.148046797446251e-01   +5.297568603254650e-02   +2.629864768706939e-01   -1.121198331191148e-01   -1.142934300854560e-02   +2.377019523002646e-01; -1.890564188631048e-01   +6.921985056957289e-01   +4.732399579095523e-01   +9.590380225219053e-03   +4.028704895648815e-01   +1.830754762695760e-01   +2.492987889507488e-01   +2.389876169184451e-01   +1.143087558132261e-01   -5.361391665905119e-02   +2.519515694828952e-02   -2.532013160499735e-01   +1.320950838804051e-01   +2.732537688000873e-01   -2.277534824870211e-01   -2.939161754224690e-02; +3.113304189699870e-01   +4.497230703998087e-01   +5.884503584040109e-01   +3.768060279299333e-01   -3.512183443597647e-01   +1.002597775743050e-01   +8.882466070159917e-02   -7.829725035637675e-02   -6.989001179928331e-01   +2.445872356015020e-01   +4.846932080318575e-02   -9.264904868270517e-02   +3.261935994409287e-01   -9.029779225112097e-02   +5.287990597841431e-01   +3.519282038696637e-01; +4.992826700934151e-02   +5.403845840332164e-01   -1.883138892206125e-01   +8.220291108790609e-02   +3.314217799593548e-01   -3.319682176914626e-02   +5.011029397108715e-01   +3.048958771533972e-01   +2.007510565431867e-01   -2.740343113459184e-01   +7.143407944531743e-02   -2.853290027897332e-02   +1.296377097328172e-01   -1.121210030864887e-01   -9.686146057668836e-02   +6.950693465978681e-02; +2.216539316458729e-01   +5.534737381793624e-01   -1.147583821807171e-01   -1.040147789224558e-01   +2.304709778271408e-01   +3.982146599200579e-01   -2.073422554748660e-01   -4.034681115979291e-01   +5.059068460132865e-01   -1.163087287063236e-01   +3.864716434640795e-01   -1.144428357913808e-01   +1.738119989281430e-01   +4.137727056433417e-01   -1.856758323953825e-01   -3.873439150842867e-02; +2.871705216013177e-01   +1.833517637815162e-01   +1.944327193920597e-01   +3.739689882047315e-01   -1.897572599648287e-01   -4.382963612002028e-02   +2.118654804751014e-01   -2.678801400804302e-01   -1.659832275272629e-01   -3.114081391423365e-01   +8.094136934897895e-01   +2.494305469162081e-01   +3.652630950730413e-01   +4.244410151490263e-01   +4.172561946165083e-02   -5.155979640996093e-02; +5.085005158867286e-01   +6.285083689418092e-01   +1.118307780354333e-02   -3.001801067735630e-01   +2.352359836668690e-01   +1.994383231114840e-02   -1.874486792977164e-01   -3.489300482407269e-01   +3.392926846755005e-01   +6.497202744049936e-01   +9.677829682479415e-02   +1.812754785392033e-01   -6.048121642598843e-01   -1.003695187505896e-01   +2.275392420974040e-01   -1.804345606759888e-02; +4.126690318193487e-01   +2.524161918595204e-01   -7.307686297264189e-02   -2.299743806540664e-01   -1.852910738675869e-01   +2.479880347622571e-01   +2.108299993433074e-01   -3.508080589206951e-02   +1.351648272996146e-01   -7.279890500146020e-01   +2.365830365506544e-01   +3.003430298857079e-01   +6.235639081892481e-01   +4.982404509380364e-02   -3.161007411648292e-01   +6.818268573534276e-03; -4.619133637007569e-01   +3.405978862705483e-01   +6.561630512890029e-02   +1.511070242601180e-01   +4.195114159257318e-01   +6.961391813866024e-01   -2.245757369928128e-01   +6.998775525866592e-02   +3.450030002193075e-01   +4.623122412182875e-01   -2.347526582475628e-02   +2.439871808244371e-01   -9.263278031051364e-02   +1.547764830919589e-01   -3.948545279923075e-03   +8.905111114640699e-02; -5.872331977780163e-01   +3.571698786992754e-01   +2.741597227765570e-01   -6.745749760877828e-01   +2.258647661526523e-01   +7.658952678614939e-02   -1.593641572141563e-01   -4.544002274044618e-02   -3.402672117351446e-01   +2.690695485754545e-01   +5.438093197361984e-01   -1.172023545043141e-01   +7.109955830009883e-02   +4.717461734403076e-01   -4.500323492075871e-02   -3.478224616653142e-01; +2.272770371803306e-01   -1.450192419652963e-02   +3.329892607082250e-01   +2.798137491233682e-01   +5.778489551205912e-02   -5.181180110775072e-02   -1.409550355748039e-01   +6.341858732812374e-02   +1.044380745008997e-02   -1.234073716648049e-01   +2.401535850353984e-01   +1.889640319852832e-01   +6.089254962501915e-01   -2.995451601944529e-02   +2.187679100441891e-01   +5.396443010341690e-02; -9.903382215609173e-01   +5.603062260676770e-01   -3.979168757143142e-01   +4.069345266404885e-01   +7.078806437917307e-01   +4.528361640455187e-01   -2.542713673963793e-01   +6.080204882705039e-01   -4.311575948042218e-01   +2.322735551067068e-01   +2.239360730760434e-01   +1.063418921406003e-01   +1.052103793417499e-01   +2.580791032408383e-01   +7.620922525496895e-02   +2.631399647934347e-01];
L1E_L1I_iGABA_netcon = [-6.684379129504209e-02   +6.881597796108101e-01   -4.498084783050343e-01   -3.689269946539719e-01   +5.678642418278933e-01   +1.122438848382782e-01   +6.109258906775280e-01   +2.159193559237420e-01   -3.993219036793983e-01   -7.705511565950354e-02   -2.466475772539145e-01   +6.322714341336165e-01   +8.024244523185021e-01   -4.128893975821037e-01   +5.619514507904485e-01   +4.769825077707974e-01; -1.813484764949021e-01   +2.016557039359611e-01   +1.000000000000000e+00   -3.793289432652246e-01   +4.682985988344494e-01   -3.572300998465852e-01   +4.705749346742004e-01   +4.634624554504589e-01   +2.990261444829098e-01   +4.081963831966797e-01   +1.183576334261226e-01   -2.833080939943187e-01   +4.111288026321035e-01   +6.080791182765858e-01   +6.330467113654928e-01   +2.064102120360658e-02; +2.562942021392904e-01   +4.732604131509643e-01   -4.157783600680012e-01   +4.796203439200695e-01   -3.084802960858395e-01   -3.793747178912455e-01   -3.254514644702200e-01   -2.367466979355053e-01   +2.758253930815794e-01   +1.410225516893446e-01   -3.564058686037054e-01   +4.944733980307114e-01   -1.214801191079104e-01   -3.872055578076244e-01   +6.529011147551920e-01   -5.132209782274875e-02; +4.195439430049197e-01   -3.094146345701022e-01   -4.988675332883722e-01   +5.850681161527500e-02   +2.292788528825254e-01   +7.402530925909469e-02   +1.746105000951504e-02   -2.166170534559939e-01   +4.542960924727277e-02   +3.288959807473035e-01   +2.340979422638571e-01   +2.185989425698643e-01   -4.819846359449621e-02   +3.832749645816240e-01   +3.638491629074635e-01   -2.265469819595670e-01; -1.399554901207628e-01   +2.824579805282075e-01   +6.238246346008145e-01   -4.481733322074122e-02   +4.366121718405900e-01   -3.783456148987503e-01   -2.800046432231202e-01   -5.809667299924859e-01   +3.698931975890921e-02   +3.702070722277197e-01   -8.299809456740785e-02   +7.909317269078540e-01   +6.259015559217297e-01   +9.458415124786797e-02   -4.167799553042598e-01   +2.697698030595552e-01; +3.493669440294818e-01   -1.352698582277532e-01   +3.446768918500930e-02   -3.478787872843815e-01   -7.271202852209693e-02   +3.391589869519552e-01   -2.579565150883112e-01   -4.214149951227755e-01   +6.806368669773927e-02   -9.833861829137572e-03   -1.465165594167833e-01   +3.916738845564252e-01   +3.065645299530034e-01   -2.402000947647911e-01   +3.170289978863389e-01   -2.549873090260610e-01; -8.603313311221733e-01   -3.375235667295781e-01   -1.837481804798073e-01   -6.083359067547187e-01   +4.150827485265868e-01   -2.020336728894531e-01   -1.645532861055853e-01   -2.517084424514701e-01   +6.834401787475013e-01   +4.161601064843292e-01   +4.394341682581592e-01   +1.733877759230950e-01   -2.276225197513662e-01   +3.889917124300818e-01   +6.470436078541927e-01   +1.451696473160639e-01; +5.267491913205061e-01   +4.155128656581686e-01   -4.067352099546982e-01   +1.216444360557634e-02   -3.721323173554734e-02   -2.781612748792646e-01   +8.680683350715538e-01   +7.220135615425657e-02   +4.762032517249345e-01   +1.521308965271839e-01   +4.471575407021737e-03   -2.371965729889123e-01   +8.562656435190060e-01   +3.521093682978344e-01   +3.569996776376265e-01   +7.397214947560158e-01; +2.132954260762587e-01   +6.279580362034863e-01   +2.178003951396792e-01   -1.947256025738367e-01   -4.711321026014507e-01   +4.539116599232934e-01   -2.472300292298955e-01   +1.312979337171370e-01   +1.520786382919809e-01   -5.043078688701350e-01   +9.047277863639303e-02   -3.781474570993308e-01   -1.261064876258176e-01   +6.308361229165599e-02   +5.430311875502024e-01   +1.480133467544753e-01; +3.665581898110491e-01   +5.687497830718472e-01   +7.275562422396666e-02   -3.413647618504723e-01   +2.186568856757479e-02   +4.127337790837546e-01   -1.450023648491232e-01   +4.637709287014334e-02   +5.288652951048793e-01   +6.298372831342795e-02   -7.069132264294588e-01   +1.006468699983609e-01   +6.295486208393146e-01   +1.076853520429307e-01   -1.263574512497865e-01   +1.629920627754153e-01; +3.597887083865732e-01   -2.188900290732124e-02   +2.715355917771153e-01   +4.240912107329009e-01   +6.742781841465527e-02   -2.214600528873343e-01   +1.533357130165243e-01   -2.799492729678935e-01   +6.725122045715290e-01   +3.847022688823493e-01   -4.903794837265645e-01   +5.173259694536629e-01   +4.865307860257477e-01   +1.458402949819562e-01   +2.512082273899600e-01   -6.261514163597139e-01; -1.051354147082849e-03   +1.889225045528350e-01   +7.439594526280051e-02   -5.354472096852858e-01   +3.579004795661501e-01   -6.464398082856193e-02   -1.823327741307377e-01   +1.619003885173996e-01   +2.558811807848765e-01   -1.535531328734264e-01   +2.397739309036751e-01   -1.658936794693621e-01   +5.015601721248050e-01   +6.397896812382714e-02   +4.976701385502172e-01   +1.190123501088333e-01; +5.746097694927184e-01   +1.921972232816859e-01   +4.476680983251723e-02   +1.694411483425110e-01   -1.400627337072624e-01   -1.842732270436029e-01   +2.397748201593537e-01   +1.028313773057596e-01   +2.378050334187005e-01   +5.144399820124605e-02   -7.055807730357459e-02   -5.272023592867527e-01   +5.025079050547393e-01   +8.631675646727938e-02   +8.990510490971472e-02   +2.614369753833256e-01; +5.432125814534802e-01   -2.592476485672922e-02   -2.146666635643271e-01   +1.491484103982551e-01   +1.804469783739643e-01   -1.092572063114448e-01   +3.100173475615212e-01   +7.427998105345768e-02   +6.372714190818112e-01   +1.056133902431408e-01   +6.690892763445030e-02   +2.728953646198779e-01   -2.274574057048002e-01   +1.437489603724225e-01   -3.733866017398338e-01   +7.092127673024379e-02; +1.212226061513932e-01   +3.099263171221606e-01   -3.659481819871710e-02   +2.363820391752853e-01   -2.638415962935567e-02   +2.442904780141111e-01   +4.207423184594851e-02   +2.490511368873959e-01   +5.670354427987011e-01   +8.960131172119849e-02   +7.998345159512826e-01   +1.156709808055801e-01   -2.559766738419764e-01   -6.927407426447683e-01   +8.659957949154512e-01   +3.843398754016867e-01; -4.043044008424879e-01   +2.722995567725799e-01   -2.389902648260581e-01   -2.996396256354736e-01   -1.420165528999557e-01   -7.411298809164742e-02   -2.520434619479350e-01   +4.768285694929588e-03   -1.559814479496609e-03   +2.937234578828970e-01   -4.814444961892124e-01   +1.608337985698531e-02   +4.386421381702993e-01   +2.497793609021896e-01   +1.241379255321154e-02   +2.309405320530603e-01];
L2I_L1I_iGABA_netcon = [-1.984334189236948e-01   -3.862544755513208e-01   +3.640488950646753e-02   +7.282370706180460e-01   -2.694143383612845e-01   +5.100899431112017e-01   -1.331365481821535e-01   -1.202734064076016e-01; +2.008956599214400e-03   +7.108206890164669e-01   -2.469823628229778e-01   -7.382981042084610e-02   +4.066143627836045e-01   +5.625389614110562e-01   +1.223861439056180e-01   -4.154942729515773e-01; +4.234755571489449e-01   -6.259493335636807e-02   -1.219237850039657e-01   +3.574403035595158e-01   -2.624834853317734e-01   -2.115260095664172e-01   +7.998883866493492e-02   +4.076715735802971e-01; +4.740920915693325e-02   +8.190944550129965e-02   +5.668312318398079e-01   +2.964918981438427e-01   +1.743035682586701e-01   +3.858927734172386e-01   +3.950931161192813e-01   -1.751846752880447e-01; +2.823982829086266e-01   -1.370537504582366e-01   +5.287168061078107e-01   +5.205340829865840e-01   +8.818411518046012e-01   +3.866300505537495e-01   +2.403425243047736e-01   +2.716527177800174e-01; -3.397632513570341e-01   +1.448659120982949e-01   +5.504855459778500e-01   +4.420950609630193e-01   -2.068104756798591e-01   +5.602796608345235e-01   +6.326679734305504e-01   +7.016199177550259e-01; +3.035542397026076e-02   +3.304501804011321e-02   +2.149562531998259e-01   -9.345521724510239e-02   -8.581751831097861e-02   +6.867862779652553e-01   +5.086047581060071e-01   +2.480120386328517e-02; -9.735317729123491e-02   +5.164737063831979e-01   +2.186343924242675e-01   +2.456547855515295e-01   +6.724923100326302e-01   -1.574696140398059e-01   +5.016378069861935e-01   +2.069368668233629e-01; +1.946108912448712e-03   +9.826880087616617e-01   -7.752744001070564e-01   +4.057124931099492e-01   +3.056191236920586e-01   +6.225243476463651e-01   +2.050501215288861e-01   -9.684242774922261e-02; +1.044621610662895e-01   -3.098086817579893e-01   +5.789586259140873e-01   +8.012009578385315e-02   +3.001157708313227e-01   +3.231804534955663e-01   -6.924899881095431e-01   +6.292343405518053e-02; -2.432281505021305e-01   +3.025108791450636e-01   +1.397568934484840e-01   +2.874215904317268e-01   +9.636213842667439e-02   -5.687070015943513e-02   +1.253981859726147e-01   +2.265239411828052e-01; +1.955254441836725e-01   +4.731975022073546e-01   +2.119386854598180e-01   -1.684987594259501e-01   -3.755874732136664e-02   +7.382941615622998e-02   +7.634951841860445e-01   +3.595679348154946e-01; +4.130726903815517e-01   +2.375863053551872e-01   +2.395649544351562e-02   +1.553707971265570e-01   +2.416707088481350e-01   -6.539385263748571e-01   -3.430702625982801e-01   +8.028237084555977e-02; -2.318323103820507e-01   -4.599083286547280e-01   -9.980827300542400e-02   -3.313148864277100e-01   +4.628270069298738e-01   -3.468223524331820e-01   +5.009611243057318e-01   +4.701880321587522e-01; +5.219405281105367e-01   +2.972740320517252e-01   +3.907242978488057e-01   +2.750169371379734e-01   -5.186677150192375e-01   +7.976812068835869e-01   +8.525582963105491e-01   +2.404027153431416e-01; -4.613414671044404e-02   +2.879389278797536e-01   +4.460462047303512e-01   +5.025242589338277e-01   +4.855864038244988e-01   +2.646238206599975e-01   +2.214500899219296e-01   +4.542659717726526e-02];
L1I_L2I_iGABA_netcon = [+5.255474861370497e-01   -4.041726562138179e-01   +1.412900746576578e-01   +4.686562109101005e-01   +1.603347192208738e-01   +1.596819619040560e-01   -3.661816492748988e-01   -2.385245096094935e-01   -2.552027018322021e-02   +2.861162401522267e-01   -1.543236561925482e-02   -7.386419019447360e-02   -2.770581355122767e-01   +9.658966791114028e-02   -9.048178389964363e-03   +1.316689498067751e-01; +1.953634898283565e-01   -4.028787885714317e-01   -1.239863152757439e-01   +2.037301197939466e-01   -2.688372237830244e-01   +1.713652109743183e-01   +3.211546928940084e-01   +2.363172077309750e-01   +1.340297812120189e-01   +5.959481269407417e-01   +3.319006857548732e-01   -5.140617543087368e-02   +1.176913074245766e-01   -3.618828225906185e-01   +5.488913254921285e-01   +4.068763045817134e-01; +2.825827770895144e-01   +5.624573148087648e-02   +3.701119406686477e-01   +2.976007275795559e-02   +8.629584108089702e-02   -5.781081629990661e-01   +1.266516213985338e-01   -1.125857991624225e-01   -1.985531646321284e-01   +2.429091381064847e-01   -4.309449960040753e-01   -4.458939703175725e-02   +2.086327233042073e-01   +5.461929645354892e-01   +7.387398761000042e-01   +3.266900022295136e-02; +2.926613111959651e-01   +4.620693088898898e-01   +2.984631753739434e-01   -2.654218681245193e-01   +5.187377498097504e-01   +7.390378180817149e-01   +2.975962620194615e-01   -1.477301397764531e-01   +1.717052458813374e-01   +5.237637208322742e-01   +2.639444161912528e-01   +4.657297588783851e-01   +1.699184456105693e-01   +9.229156183361439e-01   +1.302325094721198e-01   +7.714425779022457e-01; -2.192964890515680e-01   +1.213392520558927e-02   +3.247692045016388e-01   +4.025405862370067e-01   +2.080866181629503e-01   +6.232606101566838e-01   +3.807979467083191e-01   +4.932820731910434e-01   +2.658411473711264e-01   +3.172988489922501e-01   -1.080586645703886e-01   +1.769924916432244e-01   -9.149074944141304e-01   +5.645809825669996e-01   +5.043841049520115e-01   +9.875259264792259e-01; -7.977768711915110e-03   +6.768512873696366e-01   -6.471794271379022e-01   +2.401902253984902e-01   -1.445457066624676e-01   -1.558662692124872e-01   +4.434963429272299e-01   +5.565287978265401e-01   +2.428149516306462e-01   +3.712846497722710e-01   +1.271005525665954e-01   -1.282044380996362e-01   +1.753869380471424e-01   +7.903486939021435e-01   +1.852347619223369e-01   +2.042898767213985e-01; +5.543148763884958e-02   +4.582226687515248e-01   -2.202877801034884e-01   +5.148541369527937e-01   +3.518781459564321e-01   -5.010017587859494e-01   +1.806375676258811e-01   -2.560712559878415e-01   -4.671229365856975e-01   -2.710984308687174e-01   +3.915020395048361e-01   +4.280823514337140e-01   -7.216356303847636e-02   +1.824715898140557e-01   +4.222187911308702e-02   +1.989024785557105e-01; +3.345884089025951e-01   +3.064734761267890e-01   +1.962524416512905e-02   -1.311974931310801e-01   -9.804014115741435e-03   +3.359902096194654e-01   -1.902785449611210e-01   -2.901265303154328e-01   +1.534803548797821e-01   +1.978588919176617e-02   +1.427360773281672e-01   +5.417389798980785e-01   -2.273287436236945e-01   +2.006275756502218e-01   +9.774220694019535e-02   +3.908426201021838e-01];
L2E_L1E_iAMPA_netcon = [+4.283218849247786e-02   -6.812756235835766e-01   -1.690928657659299e-01   +5.264417345874175e-01   +2.654475931137150e-01   +1.929452056779233e-01   +4.340589131516013e-01   -1.986082347411208e-01; -8.702214417026928e-02   +2.641648255348406e-01   -6.371502126328902e-01   +4.570517328174625e-01   +2.844231978275777e-01   +4.795121648445845e-01   +1.639163929250919e-01   +2.620625404117821e-01; +4.682110360319161e-01   +6.288836051658264e-02   +1.786642527182677e-01   +2.029286135538573e-01   -8.172539101118301e-03   +3.103531472759268e-02   -7.446463370492805e-02   +2.823755131680445e-01; +2.540864935987439e-01   -1.242686731698642e-01   -3.749467011976161e-01   +3.189623257987871e-01   +1.828943491114245e-01   -2.745941243876154e-01   -2.940644058423479e-01   -1.029990767582102e-01; +5.800596531942566e-02   -4.391098646902874e-02   +3.773749894584678e-01   -4.334092604400301e-01   +5.900505336571238e-02   -2.583274180453127e-01   +1.324019320027818e-01   +2.390454414395797e-01; +6.945930891180452e-01   -1.251768567324504e-01   +8.006197105595086e-02   +5.903453416495322e-01   +3.179017775970586e-01   +6.561010647604799e-01   +4.466541712083579e-01   +5.050893199446452e-01; -3.660385067898628e-01   +8.872593123917111e-01   -1.470715771210685e-01   -3.912268969642353e-01   -1.438217472493409e-01   +4.755514064966739e-01   +8.007708858972388e-01   -3.417937925378808e-01; +3.119656970778423e-01   +3.655965212837644e-01   +7.758053469452207e-01   -1.356226675530113e-01   +2.973259043698486e-01   +1.076486530870200e-01   +6.514496331934155e-01   -5.571336945637530e-02; +1.902912056052014e-01   +1.261806239000298e-02   +8.625710566381892e-01   +6.350858741775572e-01   -7.288158880380541e-01   +5.978610429499479e-01   +7.138588430026260e-01   -3.323939704670500e-01; -3.246759527368890e-01   +3.785398330541693e-01   +9.424366569353107e-02   +2.900350530973048e-01   -1.029741144371277e-01   -3.394049587753701e-01   -2.235018447815252e-01   -2.155637883229928e-01; -9.635436517957996e-02   +6.885998884069361e-01   +8.502633942148810e-01   +2.541664806679005e-01   +1.426900385520554e-01   +2.549560295928109e-01   -2.573137185060743e-01   +1.219969571498288e-01; +2.068399133918596e-01   -2.774351387079123e-01   +5.187204096018547e-01   +2.028263228242426e-01   -4.172404258540034e-01   -6.526788779595248e-04   +9.618173796906307e-02   -4.162993180329946e-01; -2.504987734299024e-01   +3.450030624856470e-01   -8.238244133029046e-02   +1.308269731776571e-01   +4.500171617723491e-01   -5.829537293823591e-01   +1.714419150943441e-01   -1.574901896641682e-01; +3.296068211897967e-01   +9.480075678261882e-01   -2.081549289421682e-02   +5.105253708739387e-03   +4.504558858629580e-01   +1.577645904209636e-01   -3.727368229895376e-01   +3.194373085127535e-01; +7.442830153635040e-02   +3.832277423561745e-01   +1.989184594264803e-01   +1.146700490152662e-02   -6.901235418811572e-02   -1.729127596479748e-01   -2.400530987591106e-01   -3.417942872832991e-01; -2.048225493919322e-01   +1.909190047019320e-01   -8.391276119811495e-01   -3.546160312510191e-02   -3.679462200841691e-02   +1.316038149174409e-01   +7.802925952254853e-01   -2.045675187266409e-01];
L1E_L2E_iAMPA_netcon = [+3.046944470403032e-01   +4.444782342791915e-01   -1.490631568935624e-01   +2.906336676869455e-02   +1.961852249079964e-01   +3.723812164862774e-01   +3.975236724201298e-01   +9.624670092166031e-02   -1.118892926965788e-01   +5.245072423351781e-02   +6.654057213807688e-01   -2.770373105114446e-01   -1.430126029264975e-01   -1.976842161987070e-01   -8.959388864480877e-02   +6.097737121132012e-02; +3.484421894524466e-01   +6.779739467305038e-02   +2.010741536492360e-01   -1.104111917852675e-01   +2.668964718811190e-01   +1.813244442906869e-01   +8.104269393054154e-01   +3.133156079766068e-01   +1.761115491358453e-01   +1.641121035194812e-01   +5.299304313914969e-01   +1.396769327877685e-01   +7.220552237551973e-01   +3.751604660364212e-01   -1.042673366988827e-01   -3.917606391116685e-01; +1.000000000000000e+00   -2.417345737336389e-01   +2.203786778891811e-01   +3.356564348918062e-01   +4.433983316829651e-01   -2.167442402137528e-01   -1.718495560421559e-02   -2.618486478235556e-02   +2.013504459582652e-01   -2.769333146134171e-01   -5.126036193170326e-01   +9.642710581237302e-04   -1.372430236291288e-01   +5.110776690319430e-01   +2.026780302415317e-01   +6.786076352891278e-02; +1.629068520259541e-01   -5.343476502877483e-02   -4.171807043108311e-01   +4.348198851259313e-01   -1.367882628722959e-01   +7.225634350599104e-01   +7.127445322104506e-01   -3.061910818346917e-01   +7.475478289250119e-02   +1.866482765547595e-01   +4.852712319363959e-01   -6.647230755495696e-02   -3.476781067341133e-01   +7.941192302497284e-01   +6.228238609338566e-01   -9.124966153362975e-02; -2.950596388853146e-01   -4.403540349783351e-01   -5.302712269056496e-02   +3.120606836960551e-01   -1.512760783971683e-02   +9.156805128385777e-02   +2.820821980665839e-01   +5.861235521640062e-01   +4.249644984237448e-01   -1.588899421724099e-01   +1.771447906574232e-01   -4.719516769690669e-01   -3.510128582697128e-01   -8.345627597975656e-02   -8.612405588103644e-02   -5.232684736623920e-01; -1.862873294863116e-01   +6.804821752045200e-01   +8.558155954146844e-02   +4.197738994037352e-01   -2.249849525379166e-01   +2.013027676660071e-02   +7.746224386100482e-01   +1.165876971416270e-01   +2.729176003667158e-01   +3.102884529147065e-01   +3.432458965281478e-01   +6.072883358046009e-02   -1.451950052105184e-01   +5.645292721166503e-02   -2.301825365158565e-01   +8.028340236257366e-01; +3.235986319475328e-01   +4.373932701413072e-01   +1.632225347201094e-01   -1.606508119611576e-02   +4.033501347309562e-01   -1.876092774679778e-02   +1.499743745977140e-01   -7.243900453952624e-01   -4.252729484843275e-01   +1.862435069741459e-01   -1.594408562099254e-01   -9.526862606077580e-02   -8.575735518075921e-01   +5.685806058711013e-01   +2.604242057124652e-01   +5.770667280821770e-01; +4.417991264125058e-01   +1.209197730540541e-01   +6.752049672910149e-03   +6.779034832544188e-01   +4.665628273269897e-01   +4.658069804426461e-01   -3.277609225313817e-01   +2.541052710359373e-01   +1.591628372892149e-01   +2.218001971508785e-01   -5.042503014646971e-02   +1.239298627709716e-01   -7.273937568990684e-01   -2.642475815450962e-01   +4.498993767064068e-01   +2.462843103242990e-01];
L2I_L2E_iAMPA_netcon = [-1.043794290594667e-01   +5.382221213977717e-01   +5.015345914338141e-01   -1.582599828637849e-01   +2.671598652080141e-01   +1.220557526167479e-01   +4.065623260612942e-02   +4.206647511562627e-01; +6.493488120048819e-01   +3.832686010556175e-01   +4.120447825899105e-01   +9.069797129854996e-01   +4.213281388101258e-02   +2.324973808389061e-01   +4.200999072228469e-02   +3.892489855056467e-01; +1.937011192916879e-01   +2.456162603482728e-01   -1.730363205126048e-01   +3.830636444840202e-01   -2.582682953622968e-01   +3.515218314887927e-01   +5.765075035075753e-01   -1.183727183350641e-01; +5.632239649654812e-01   +5.210515713401589e-01   -4.275275647892192e-01   +3.510092976432045e-01   +7.408932878071883e-01   +2.569313367056393e-01   +3.103034573773884e-01   +4.488515496462882e-01; +5.344970035451605e-01   +2.619267043152406e-01   -4.205199815191766e-01   +3.986136897851381e-01   +6.927291427624652e-01   -1.032527596898793e-01   +1.441188842602920e-01   -2.559670032575629e-01; +3.711244865923031e-01   +4.055508649659650e-01   -4.325589667167140e-01   +4.379864380985247e-01   -3.497782991304474e-01   +1.233463414247526e-01   +2.416540541601883e-01   -1.335471183600137e-01; +7.376711643655625e-01   -3.217087081999436e-01   +4.086203057604752e-01   +4.680770603240861e-01   +1.557234988027435e-01   -1.795932820943842e-01   +5.571960266719272e-01   -5.892294067924745e-01; +4.458276524423165e-01   +5.603240794094634e-02   -4.974857454840874e-01   +3.328086116961391e-01   -3.063316262688016e-01   -1.916108520027971e-01   +1.293835909213341e-01   +8.208313782430698e-01];
L2E_L2I_iGABA_netcon = [+4.240581266219427e-01   +6.066491222130947e-01   -2.795908736930829e-01   -3.140513555731869e-01   +7.516984256882103e-02   +1.092823365295882e-01   -3.161710467976893e-01   +5.770738325248704e-01; +2.217630859044473e-01   +3.913577315143130e-01   +2.300109053550051e-01   +9.765229944366028e-01   +3.895941236667220e-01   -3.636173653612993e-01   -4.347431304565324e-01   +2.700374027379924e-01; +1.026881354869015e-01   +5.131905562603705e-01   -7.207754274633925e-01   -4.463713608922820e-01   -7.111072927030057e-02   +6.606873966016532e-01   +1.461147792604626e-01   +6.246620015129602e-02; +4.523855090644701e-01   +1.609689013743887e-01   +1.348786414025279e-01   +6.487853183078772e-01   +5.951561271306859e-01   -1.915932606749445e-01   -2.526667859365641e-01   -4.471274875324091e-02; -2.189393824025730e-01   -1.001709639243463e-01   -1.983162338555398e-01   +3.270373235367666e-01   +5.097775628308369e-01   +2.649863273767225e-01   +4.589464628874926e-02   +1.910644681758866e-01; +9.455271480321387e-01   +4.048765959936016e-02   +1.051742166571847e-01   +1.994314755890763e-01   +6.986623141236477e-02   +1.283384201380755e-02   +4.861290181760379e-01   -4.353976067785553e-01; -3.307193364722554e-01   -2.102657495471333e-01   -9.238333824872071e-02   +2.179147992953638e-01   -1.662572881984223e-01   -5.051186587113840e-02   +2.072630991869643e-01   +7.355348910914764e-01; +1.665901627751799e-02   +3.049269118211239e-02   +6.158909602501641e-01   +1.517613200309988e-02   +6.218045711778638e-01   +2.645549321037811e-01   -3.585744925441181e-02   +5.236295252793285e-01];
L3E_L2E_iAMPA_netcon = [-7.713080735897580e-02   -3.481970284331826e-01   -4.549003524189120e-01   +2.474855912030945e-01   +7.944567544892109e-01   -8.716621756194209e-02   -1.314621009227293e-01   +9.944100620367344e-01   +2.845799347478306e-01   +2.047456198364826e-01   +2.829387186690169e-01   -6.064483525310154e-01; -4.172868048716213e-01   +1.891875370674732e-01   -3.071594786661745e-01   -7.654549232845925e-01   -4.926813289382503e-01   -2.706280750043353e-01   -4.010464721159045e-02   -1.177320193185298e-01   -6.479358029091201e-02   +6.144046169121585e-01   -1.663529605209984e-01   +5.535215920262466e-01; -6.663003722491171e-01   -1.422799307741925e-01   +6.877734215674812e-01   -3.616373740694036e-02   +1.942351489343614e-01   -5.669843212421011e-02   -9.002498218029921e-02   -1.644974032758520e-01   +3.617555589632111e-01   -4.966062705574044e-01   +8.982715668100625e-01   +2.222463454608283e-01; +6.051895388706735e-01   +3.174198936261029e-01   -3.229848557742317e-01   +6.532547716979439e-01   +8.293865028451513e-01   +3.014215922670142e-01   +2.526053023162672e-01   +6.557836201297810e-01   -5.454389009257619e-02   -1.996655941143588e-02   -2.618532442921815e-01   +3.469694574308761e-01; +1.149723289528300e-01   +5.887020184646212e-01   +8.489911434711290e-01   +2.919388407259716e-02   +5.589333843103778e-01   +6.492805882090013e-01   -9.881331288297403e-03   -1.113022240794702e-01   -5.287828296262643e-01   +3.339676134313916e-01   -1.177298535437173e-01   -5.827804297072237e-02; +7.843054198657189e-02   +2.938207107730427e-01   +5.535864071772020e-01   +1.007837249108037e-01   +8.976359908707932e-01   +5.310979846297355e-01   -2.907118440190775e-01   +2.679925546268248e-01   -1.460986127645606e-01   +3.427469112762091e-01   -1.195439135792448e-01   -2.265318075359057e-01; +4.810160631691496e-01   +4.271484321229498e-01   -9.618492315739767e-03   +5.838625030173104e-02   +1.473922164439611e-01   +5.411096754053818e-01   -2.648486285487842e-02   +2.295022856043797e-01   -2.031677006563271e-01   -5.602778625175728e-02   -7.347784466181521e-03   +3.697073383819303e-01; -6.027411115913114e-02   +6.193240481861180e-01   +9.675161930168738e-02   -4.120344991789261e-01   +4.740012134640140e-01   -2.979199783149106e-01   +1.801702614860197e-02   -1.192414149073602e-01   +2.838879739957191e-01   -3.310673488409928e-02   +5.591231513651218e-01   +6.021270527190235e-02];
L3I_L2I_iGABA_netcon = [+6.839692007227525e-01   +5.683611619413839e-01   -1.160066989127126e-01   +2.553241529822528e-01   -2.824017364500310e-01   +8.416260660015508e-02   +8.759040177459343e-01   +4.800598013054314e-01   +1.378931640333516e-01   +4.858711775299208e-01   -7.804951463492057e-02   +2.490858095268308e-01; -2.398643545728761e-02   +1.676072950695789e-02   +3.227210806018944e-02   -9.764202278037419e-02   -1.455408186873770e-01   +2.767991340564128e-01   +2.502791412560817e-01   +7.265565440444835e-02   +8.526645192106569e-02   -2.142356182970829e-03   +7.588721203281054e-02   +2.919235247656747e-01; -7.165039333277698e-02   -2.393818510637100e-01   -4.382885467349527e-02   +6.858775952019997e-03   -3.077220586552748e-01   +3.808157912894702e-01   +8.149292341312564e-02   -2.138038130324579e-02   +1.458043282459722e-02   -2.379836934998134e-01   -8.059747503431933e-02   +4.304603214247291e-01; +4.482267609530784e-01   +1.182172939247407e-01   +3.109929954499904e-01   +7.065911445867965e-03   +1.553910271926195e-01   +3.526655674607024e-01   +2.792326431009075e-01   -3.469812844817052e-02   +2.786339042294904e-01   +3.237855241485124e-01   +2.396699923572714e-01   +1.612019349864703e-01; -2.128408653338904e-02   +3.802717721867019e-01   +1.760070785487289e-04   -3.397503092834290e-01   +2.388003341656662e-02   +3.293670447639682e-01   -2.607674178562482e-04   -8.239541377073610e-02   +1.079884114638430e-01   +1.757485212786489e-01   +1.424877726095019e-01   +7.617378671533671e-02; -1.171062197261055e-01   +3.216694487780029e-02   +2.237997612803201e-01   +1.795159509829704e-02   -2.188510978466434e-02   -4.609055193723996e-02   +1.303120820654573e-01   -7.399227859192127e-02   +6.900128412407561e-02   -1.056838027467263e-01   -6.667030960465642e-01   -2.266023746862924e-01; +1.448285572423555e-01   +3.099582074694779e-02   +2.431695321447598e-01   +3.008870567759328e-01   +3.930159302769929e-01   +4.279798870771483e-01   +3.893919046480023e-01   -1.186329491561172e-01   -1.962521020026448e-01   +1.843890745169472e-01   +5.010248319622986e-01   -2.389158956235221e-01; +7.265964859229006e-02   +2.220686473994316e-01   +1.111881947601055e-02   +4.152014477234912e-02   -2.808009187572383e-01   +5.262941115376579e-01   +1.148199906947569e-01   +3.367261628357398e-01   +1.832066452025979e-01   +2.121540605398221e-01   +1.892081303433098e-01   +3.833808158023845e-01];
L2E_L3E_iAMPA_netcon = [+8.426907384829547e-01   +3.611923466408646e-01   +4.022744438923274e-01   -4.558852032745904e-01   +6.993010086614310e-03   +7.893393691019514e-02   +4.511334224418992e-01   +5.432140459888687e-01; +3.664241889619645e-01   -1.955785660521408e-01   -2.920248179288262e-01   -9.551542196528395e-02   +7.773262825518444e-01   -4.978400895816043e-01   -8.228561327330417e-01   -3.797697819024036e-01; -6.871267794339234e-03   +1.224431892025003e-01   +2.071825398469161e-01   +1.867868218561564e-01   -2.267188791097031e-02   +8.766121152112669e-02   -1.211807847354065e-01   -2.939238688198407e-01; +4.465316471280526e-01   +2.500242932855897e-01   +6.874191498194906e-01   +8.517992600639679e-01   +2.087109819937022e-01   +3.579182680508439e-01   -2.156708993780745e-01   -2.844500082025143e-01; -1.203210618818469e-01   -2.024096837998927e-01   +2.935011346424844e-01   +3.378892517476150e-01   -4.489161462700976e-02   -3.184585066527698e-01   -1.525555127750489e-01   -4.922074509988768e-01; +2.101970105803136e-01   +4.444207412607397e-01   +8.729159837897670e-02   +6.824269036551617e-01   -3.113392116653210e-01   -1.081261872534027e-01   +2.587255457842637e-01   +2.173972110931813e-01; +9.949440899303508e-02   +5.075621385533200e-01   +8.965992557171096e-01   -3.178491323612435e-01   +5.137879023559287e-01   +3.222488314673581e-01   +3.661763094910201e-01   -2.001021939050371e-02; +1.589636970580116e-01   +5.003345902701714e-01   -3.108270707188743e-01   +1.206324207432851e-01   -1.558052515152934e-01   +5.886171146457109e-02   +3.867056434267875e-01   +5.207753961455676e-01; -3.496702329114045e-01   +5.434776007146114e-01   +5.960742526961537e-01   +6.103736799373592e-01   -1.054322180395399e-01   -3.331699986653523e-01   +3.766536039887067e-01   -2.320436502585852e-01; -1.925257855225783e-01   +2.950929677256697e-01   +2.624593817683202e-01   +4.047512059564974e-02   +3.315199317789840e-01   -4.052959278332837e-01   +5.540319194610944e-01   -4.795932536545866e-02; +5.730522210317747e-01   +4.257912366068295e-01   +1.474148185677972e-01   +4.204841957383298e-01   +3.275313752110848e-01   +6.913159275600843e-01   -3.148984027935204e-01   +1.747354483438364e-01; -4.603156399975378e-02   +1.366532852198286e-01   +6.183848003957564e-01   -1.312709023342769e-01   -2.330360761444199e-01   -1.202931398426098e-01   +2.077721051543220e-01   +3.353368213030665e-01];
L2I_L3I_iGABA_netcon = [+2.320227844399959e-01   +7.074956868495008e-02   +3.106021977672415e-01   +1.172893165387329e-01   +1.485831696354074e-01   +5.143893842514787e-01   +7.986800788787497e-01   +2.582409172721212e-01; -2.752267701271029e-01   +2.382459719505420e-01   +5.220428112786121e-01   -1.160088962737719e-01   -3.186351789995200e-01   -1.414639696241733e-01   +5.751419313409342e-01   +5.943497370512596e-01; +3.786401151971276e-01   +7.731939290411316e-01   +4.702053056030820e-01   +2.131783762355381e-01   +2.338667872389183e-01   +2.852917252071034e-01   +1.812048365529616e-02   +1.891515497571544e-02; -1.715955969608314e-02   -3.253544602730378e-01   +3.647336996081244e-01   +1.829348464520165e-01   -1.406919334934283e-01   +3.714502424746893e-02   +4.051015740719767e-01   +3.501783113977427e-01; -3.060312426944577e-01   -2.155811913690204e-01   +1.062048453686651e-01   +3.350824741929948e-01   -2.055721257702250e-01   +2.629962758953158e-01   +3.608154840006083e-01   -1.931571317301483e-01; -1.368018128184083e-01   +7.726593481724124e-01   +3.214522122238494e-01   +4.490233353970755e-01   +2.845182813699195e-01   +2.035222158638318e-01   -2.596890686003665e-01   -3.341881724728593e-02; -3.717222089899639e-02   +8.511202023146268e-01   +4.693104020738781e-01   +2.880619569031971e-01   -1.813017565896615e-01   -1.754219758246313e-01   +6.798715833908674e-01   +4.260533761450531e-01; -3.088284589386803e-01   +4.755172259844099e-01   +2.759017043542131e-01   +2.999485008404208e-01   +1.020369395961323e-01   +6.123206978155737e-01   +1.152740462120507e-01   +7.859231719960835e-01; -3.933633670450765e-01   +5.206719565325223e-01   +2.210631922558646e-01   +1.716311105467520e-01   -2.425316030897013e-02   +5.334365664042123e-02   +2.547499565356257e-01   +1.847466863020379e-01; -3.964663261694602e-02   -2.564053551440797e-01   +5.661357691534261e-01   +1.401389028371944e-01   +4.076957882593095e-01   +2.060401844751057e-01   +2.857030293058997e-01   +2.572009271309866e-01; +3.630681608709042e-01   -4.164675584118049e-01   -6.559446855958643e-01   +4.469266885857913e-01   +1.018468144774872e-01   +9.665681616348019e-02   +1.867345221184218e-01   -2.929354975966974e-02; -5.465021343470579e-02   +6.021926846889157e-01   -4.474500006806999e-02   +1.628945357312762e-01   +3.915396323842852e-01   +5.450827332027616e-01   -1.949810747609685e-01   -2.616550024032938e-01];
L3I_L3E_iAMPA_netcon = [+2.104939574767863e-01   -8.539222560574130e-01   +2.932646665715769e-01   -1.095672710894760e-01   +1.245148902013539e-01   +3.881487680561035e-01   +1.620991873159549e-01   +2.635290212501975e-01   +6.816982854054440e-01   -6.323562908694713e-02   +2.472377962517375e-01   +4.181258731566820e-01; -2.121505951925882e-01   +4.233364310313839e-01   +8.843271148404634e-02   +4.023970775128652e-01   +3.480507984482474e-01   +8.422027980475068e-02   +6.424491070520110e-01   +9.478460023747520e-01   +4.886639108697240e-01   -1.722524712016030e-02   -1.482930038893336e-01   -2.890536300772245e-01; +1.697850716973434e-01   +6.416022691111031e-02   +3.835986866525468e-01   -2.083400666283586e-01   +7.158593063475780e-01   +1.499110140119216e-01   +4.390330695844939e-01   -3.566953874574049e-01   +5.378470606960378e-01   +1.715331340691656e-01   -1.353026844756163e-01   -1.481839174815165e-01; -1.007757849750684e-01   -1.014547297298335e-01   +6.463075684272929e-02   -2.260173702550231e-01   +4.441080062224191e-01   +1.507145930245676e-01   +5.011990118614346e-02   +5.983170570619850e-01   -1.447212262992025e-01   +3.333779781058529e-01   +1.058063239322681e-01   +4.368124868554527e-01; -3.868870802410226e-01   +2.268489938816345e-01   +7.380341422807688e-01   +6.134735661289775e-01   -2.112334860970457e-03   +2.733414944638572e-01   +1.766165665110272e-01   +2.824756196333848e-01   +3.251684322877137e-01   -9.729357110078683e-02   +6.732276534593354e-02   +2.786610746343289e-01; +9.787170322821989e-02   -1.671086803215988e-01   -3.714666586821714e-01   +8.699665861977832e-02   +1.055107636184325e-01   -3.545162329987694e-01   +6.809728988326818e-01   +1.276909266900241e-01   +1.163398207507894e-01   +6.503224425410381e-01   -1.750133158319853e-01   +8.816885153013069e-01; +3.702136457439050e-01   +3.137824358109393e-01   -2.475502279006123e-01   +1.501968420435012e-01   +4.380362427449995e-01   +1.346009112341568e-02   +2.876370437908103e-01   -1.012006734308404e-01   +2.673801557040355e-01   -1.993459385984337e-03   +1.039674435849426e-01   -2.302201892518497e-01; +3.593399339704192e-01   +4.164863965422506e-01   -1.504621005044074e-01   -4.956148987743009e-02   +3.888502873785492e-01   +4.029657744428410e-01   -2.941690252428659e-01   +1.573500372581506e-01   -2.088126681959226e-01   -1.712196952978206e-01   -4.357362277602524e-01   +4.150244707999322e-01; -2.177173906457883e-01   +3.907189640727651e-01   +3.890750662711387e-01   +8.079818465117657e-01   -9.445741909975869e-02   +5.892162822499086e-01   +4.085223805025116e-01   +6.659157854143601e-02   +2.480271440291436e-01   +4.080168620447864e-01   +1.830388074996648e-01   +4.673806811047340e-01; +1.000000000000000e+00   -6.052520784423350e-01   +3.381120747664457e-01   -4.152469057913895e-01   +2.606638630180004e-01   -2.733428518162422e-01   -1.516642024572480e-01   +2.948817257185640e-01   -1.819420756552285e-01   -9.449879303462708e-03   +4.640497396917082e-01   -3.057492531431293e-01; -1.641529961128735e-01   +6.314775031821689e-01   +5.572540839271916e-01   +1.220107959342365e-01   +1.771206293957772e-01   +9.084755006889905e-02   +4.968980622994661e-01   +2.837837418563192e-01   +3.801412079885791e-01   +1.266162804040959e-01   -2.782172041307511e-01   +5.888573981619473e-01; -2.261130986912611e-01   +2.322362178469969e-01   +6.619197482506330e-02   +4.790347322645074e-01   -4.538082202342874e-01   -2.151617121879851e-01   -1.839039275953210e-01   +3.216675260014979e-01   +3.329644516265243e-02   -2.098415064259076e-01   -1.886904186398189e-02   -1.379089372042799e-02];
L3E_L3I_iGABA_netcon = [+8.528911049571174e-02   +9.475933872464042e-02   +1.082136136497916e-01   +2.066358768981087e-01   +1.992153351424311e-01   +1.394802958834082e-01   -8.757883541784225e-02   +2.550856958721740e-01   -8.621945608522441e-02   +5.443099680871617e-01   +5.073760706785325e-01   +3.776960610815389e-01; +4.551203967101409e-01   -3.428231842001827e-01   +2.374584411576501e-01   +4.488203912830707e-01   +2.442020852196826e-01   -2.685999099333218e-01   -8.186679647130493e-02   +1.025444905576605e-01   -2.543886818615493e-01   +1.335698872732018e-01   -5.754632290713106e-01   -1.706011943419668e-01; +3.471023379992601e-01   -4.021560823845076e-01   -5.610916851867357e-01   -2.148147636589116e-01   -2.595648878235671e-01   +4.961111317101881e-01   +3.733831872346391e-01   +4.290314376294849e-02   -7.779828156573673e-02   -1.852402733473498e-01   -1.763380648008929e-01   +2.745540127083699e-01; +1.085590524109421e-01   +9.025353097762716e-02   -3.531995048271515e-01   +5.288578741647021e-01   +9.635091661831928e-01   -2.182790689945305e-01   +7.151727943766088e-02   +1.995564814161672e-01   +9.701830822116448e-01   +1.856119113764771e-01   +5.343712689557445e-01   -3.211554230089760e-02; +2.726151076493510e-01   +3.408619031960718e-01   -1.922630404889801e-01   +4.055608337434110e-01   -3.099499089421910e-01   -6.328203683682801e-02   +2.812842108067349e-01   +2.345800942468201e-01   -4.205532439161304e-02   +8.655120444575886e-01   +3.118494978822317e-01   +6.395833841247221e-03; +1.794076585810613e-01   +2.738091867033258e-01   +9.740223248492877e-02   +1.551736607347998e-02   +2.027776962372986e-01   +7.047749474805504e-02   +2.042728706908830e-01   +1.421465441072687e-01   +1.800784238830689e-01   -5.408377115316645e-02   -3.080843808057955e-01   -4.147855163244712e-02; -3.696142822099395e-01   +9.544200098325498e-02   +3.151558942499021e-01   +8.064647782262181e-01   +2.230817462579727e-01   +4.092707164311770e-01   +4.471643660787801e-01   +6.622194368075275e-01   -1.063443249017724e-01   +4.425221908387483e-01   +3.486519512900062e-01   +3.345391941563307e-01; +3.271614982673705e-02   +3.433845166939198e-01   +3.627779379340778e-01   -1.999576409796370e-01   +2.445554614813712e-01   -3.191706414673191e-01   -7.340021882811529e-01   +6.219204035507554e-01   -1.433324857286346e-01   -5.261266592393187e-01   +4.846402568984368e-01   +3.594984536015336e-01; +2.142698253929352e-01   -1.429430686571843e-01   +5.939274253137229e-01   -5.074374845634143e-01   +4.241242526459989e-01   -7.868728177702711e-02   -7.353949457914768e-01   +7.256512800584450e-02   +2.117521855860984e-01   +7.012045978801842e-01   -1.708426414758247e-01   +5.719124482007628e-01; +1.726676899767336e-01   -1.945144183891864e-02   +2.028640506002996e-01   -1.618260739658867e-02   -3.337778158611988e-01   +2.403871133974894e-01   -4.780498549832520e-01   +2.725494473673347e-01   -1.247292084595968e-01   -9.540197692984072e-02   +2.964655638377998e-01   +1.062460744681855e-01; -2.081382133914862e-01   -3.417718351538388e-02   +3.209293827534527e-01   -3.815735420745055e-01   -3.160693424688575e-01   -1.057304256331679e-01   +3.263525903028945e-01   +1.492586691460110e-01   +2.926415213128503e-01   -4.859677110720840e-01   -2.974541237046421e-03   +4.616577971909531e-01; -5.797455529058379e-03   -6.745317774544238e-02   -3.911624251176343e-01   -1.472523150238511e-01   +8.407795820556840e-01   -1.582105861278702e-01   +3.990636495791334e-01   +4.097887543107940e-01   -3.555423965900707e-02   -4.158621490076518e-01   +1.392668115809955e-01   -6.271909216947624e-01];
L2E_Input1_iAMPA_netcon = [+8.869862437879670e-01   +9.231011302804507e-01   +8.482819516404209e-01   +4.983072784712488e-02   +4.244112420636658e-01   +1.655473196573824e-05   +6.389160848730632e-01   +5.303842702297970e-01];
L2I_Input2_iAMPA_netcon = [+4.804711225275993e-01   +7.582865969666698e-01   +7.373887809094269e-02   +1.461134601201093e-01   -3.145780270046197e-02   +5.231654894802500e-01   -3.801568844806932e-01   -9.793512797314724e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
