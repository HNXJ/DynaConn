function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.656617611405259e-01   +3.783693685840228e-01   -4.014436602229220e-01   +2.246824922976416e-01   -6.632197316465468e-01   +2.184915053144759e-01   -1.845959755980461e-01   +5.433637756490022e-01   +1.461339283941259e-01   +2.932658119235231e-01   +4.930436307749277e-01   +5.850746387203796e-01   -4.108619261259025e-01   +7.078319598639292e-01   -4.783655438688300e-01   +1.238398651202222e-01; +7.975489209700686e-01   +3.661620561490059e-01   +2.631050554909651e-01   +6.249024353066556e-01   -6.344028780107053e-02   +1.423715544004984e-01   +5.317136370621223e-01   -6.586413599881774e-03   +1.968296353913979e-01   -7.347435347595908e-01   +7.815118041573605e-01   -4.568826400536047e-01   -3.211176813113037e-01   -3.139875699920168e-01   -2.595722415428965e-02   +8.117042376410821e-02; -5.475881175366483e-01   -2.472244616117261e-01   -3.551212437791544e-01   -3.137137931628778e-01   +6.799674824398534e-01   -4.142108348108240e-01   +5.306053039062411e-01   -4.110246359529275e-01   -7.772914535026813e-01   -7.605168894547134e-01   -4.183292292617488e-02   -1.531122789727502e-01   +1.504057469262828e-01   -3.425713359922892e-01   -1.584781801171797e-02   +4.150776695743522e-01; +6.965805060564286e-01   -6.348736707198243e-01   +5.809699380478119e-01   +3.727537792150609e-01   +1.411970510282952e-01   +6.160895476635887e-01   -4.039978068051787e-01   -1.616080555727327e-01   -5.723856227550490e-01   +1.935106199781825e-01   +4.154428852955656e-01   -6.697103158350647e-01   +2.188018922953734e-01   -1.819065239159461e-02   +1.752621516954795e-01   -7.930845058307262e-01; -2.354257759643387e-01   +5.603773789149000e-01   -2.860397697913517e-01   -1.170433919484461e-01   +2.179912336495684e-01   -1.019526084287820e-01   -5.700804688409313e-01   -8.099369897551325e-01   +4.106708615964502e-01   -3.314463995601469e-01   +3.793519335613522e-01   +4.606336050394362e-01   -1.901814814522433e-01   -1.645804658851344e-01   +4.487693924176683e-01   -1.668957142516510e-01; +1.541175827474144e-01   +6.024998156927985e-02   -9.492302465936817e-01   -4.909053883248909e-01   -4.938822525804548e-01   -4.363748052199707e-01   -4.405011996806017e-01   +2.132912040584925e-02   +2.158360409176942e-02   +2.115744269071839e-01   -2.222000153035657e-01   +2.233370438721476e-01   +7.982218194910793e-01   -2.117650587570886e-01   +7.457561746808873e-01   +4.280417514561178e-01; -5.950331700724054e-01   -1.953871589699347e-01   -9.446749877826848e-01   +3.464644204744749e-01   +9.678288069640019e-02   -7.709023166763598e-01   -3.717958846519277e-01   -6.821325608863429e-02   -7.392195782725256e-01   -2.836670326454695e-01   +5.296285947635005e-01   -1.321336197766456e-01   -3.091091769827477e-01   -4.277509350875706e-01   +7.049980089799164e-01   -6.261284279325127e-02; +6.790739028370897e-01   +5.304829313231744e-01   +4.283692917038373e-01   +2.496459352306944e-01   -6.372373952528534e-01   -5.902792375703431e-01   -5.600147896246370e-02   +5.513657060663556e-01   -4.954096336215029e-01   -2.855993079710932e-01   -5.978046435134304e-02   -3.128091845896126e-02   +4.576338294224562e-01   +4.848579096091664e-01   -3.222507202229121e-01   +4.393060920791109e-01; +1.055374663861806e-01   -3.564431114119407e-01   +3.855101435297827e-02   -7.466181937962677e-01   +2.882682385494065e-01   -2.679643742947431e-01   -1.420937446279317e-01   -1.870979108179831e-01   -1.901429703079319e-01   +4.381345813347117e-01   +2.575911705430645e-01   -4.753504766389895e-01   -3.404856329989291e-01   -3.586441497676950e-01   -5.358465481521516e-01   +1.696447675392209e-01; +4.691906651762144e-01   +4.693621289544599e-03   +1.490197164832683e-01   +1.418598340456763e-01   -6.808193814211742e-01   +3.802982848223290e-01   -9.023320621340681e-01   +3.834349135644100e-02   -2.523009531077285e-01   +2.606617904054840e-02   +4.534140700160985e-01   +5.349960845043591e-01   +2.514277433834143e-01   -2.209378392471293e-01   -3.242530995434071e-01   -7.327107772996475e-02; -1.221292723485053e-01   +7.062046070757710e-01   -2.890311936214936e-01   -5.800138164804413e-01   -8.637841412261874e-01   -3.283014256950511e-01   -5.473486427023103e-02   +6.068630457227546e-01   -4.883339514938551e-01   +5.428280131880895e-01   -5.632380318580742e-02   -4.883274412317001e-01   -1.977170084026904e-01   -6.129535765566848e-01   -7.650420699392430e-01   -1.000000000000000e+00; -4.913152346700366e-01   -4.621501698203785e-01   -9.762700287967400e-02   +2.686788702640032e-01   +5.075730241405384e-01   -1.378567969146212e-01   -5.087556912965971e-01   +4.526560009199264e-01   +7.475390924543689e-01   -1.765148313230544e-01   +1.735252459928421e-01   +5.442791644326465e-01   +2.655860188617876e-01   -1.216590377360139e-01   +5.603691762884487e-01   -1.739449937074765e-01; +8.177046134294746e-01   -2.424116397968307e-01   -4.513539184840753e-01   -8.662411627662585e-01   -2.454379893192469e-01   +3.466164725363842e-01   -6.436905431767753e-01   +2.398815095233902e-01   +5.950716811594850e-03   +7.283714537878349e-01   -4.152947172136847e-01   -3.261664901354146e-01   -4.211709669045352e-01   +2.132324841355719e-01   -2.820722148736726e-01   +6.671692522207933e-01; +3.913871763978001e-01   -3.615041880682138e-01   +4.925511945306976e-01   +1.988592336247574e-02   -3.126714455706508e-01   +3.621330880714403e-01   -2.244570353539730e-01   -3.306910271296729e-01   -2.985244714874888e-01   +3.971800087438698e-01   -2.996156989860567e-01   -2.140049899820539e-01   -1.483293238212242e-02   +5.778017223790949e-01   +5.096865428371252e-01   +6.825992517128313e-02; -1.497764977733878e-01   +6.447902986830675e-01   +3.506621807061479e-01   +6.173176853784403e-01   +6.503412017493101e-01   +5.317186751216700e-01   +2.705773962365704e-01   -6.331889358581090e-01   +2.595907512232597e-01   -2.246922827218092e-01   +8.302447348568826e-03   +2.626521302172678e-01   +2.878034269422356e-02   -4.139526314443961e-01   +1.552923598561940e-01   -1.258502061348051e-01; +6.380191447098572e-02   -2.716176292832512e-01   +7.575017088079262e-01   +3.173518138460057e-01   +5.364424642703418e-01   -3.972888905181879e-01   +3.333734415423648e-01   +1.418196786995449e-01   +6.167984156749554e-01   +5.935437519689246e-01   +8.925941921142999e-01   -7.655531302141050e-02   -1.543624494097077e-02   +5.222693278663517e-01   -3.872143729816661e-01   +3.755869114142463e-01];
L1E_L1I_iGABA_netcon = [+6.984015415218195e-02   +3.866179875780381e-01   +2.136399866758488e-02   -8.696086286481221e-02   -4.385482922513507e-01   -3.658331577974282e-02   -5.861980232137260e-01   -1.733709424686753e-01   -8.294238758172924e-02   +5.945812315176351e-02   -4.329133915673837e-01   -7.125178962360873e-01   +3.085882599973847e-02   -7.627721203766250e-01   +4.959458668082025e-01   -1.538394667389660e-01; +4.586022948401370e-01   +1.804440367465972e-01   -6.867666866197802e-02   +2.959711281591107e-01   +2.534621665358732e-01   -4.078503609758926e-01   +1.036366442618843e-01   -4.437185441451068e-01   -7.049152834726701e-01   -1.680120504135504e-01   +8.627199192942276e-01   -7.205662736813997e-02   -6.781587350898585e-02   -1.046666782777793e-01   -4.741419327992974e-01   +1.993226597426621e-01; -2.217448458081709e-02   +6.214406798093886e-02   -2.079756088981579e-01   -6.666851091894821e-01   +3.691950773701911e-01   +2.915214728285143e-01   +3.141393615217080e-01   +6.374871201471072e-01   +9.545377108635642e-01   +4.143728575790989e-02   +3.043125755238827e-01   -4.702982559290279e-01   -5.634816491968703e-01   +3.096973146575813e-01   -8.922154225438381e-03   -3.261839157977999e-01; +6.535299316419152e-01   -7.741726273608754e-02   -2.484431007675478e-01   -7.745257190172892e-01   +1.044272083461406e-01   +8.649919784439400e-02   +7.565013852891767e-01   +1.591861110841308e-01   -3.458263237375996e-01   -5.849781790203872e-02   +1.585607155231754e-01   +3.824882983226595e-01   -3.441906508460186e-01   +3.639451188022427e-01   -1.645518743960084e-01   +3.872825914574538e-01; -5.767344387873257e-01   -4.445087596906071e-01   -3.430786176918214e-04   +1.383708643950932e-01   +4.308615588584674e-01   +2.092431833151872e-01   +1.499615484765981e-01   +7.129090385579460e-01   +6.823054722573033e-01   -2.487917365873007e-01   +5.226719722869987e-01   -9.103982691058882e-01   -1.468398271856466e-01   -7.106963303112661e-01   +6.548680586995649e-01   +1.246940462295382e-01; +2.887303429963282e-01   +1.482265906469986e-01   -5.158875083852741e-01   -7.768042447756616e-01   -4.406025692794108e-01   +6.194551217827770e-01   +1.308179029199318e-01   -5.779280937435991e-01   +2.618600452768434e-01   -3.168857247573028e-01   +1.063379339094878e-01   +6.651618787763731e-01   -2.783053619582959e-01   -2.305953768495908e-01   +3.833782650047841e-01   +2.066671961500644e-01; -4.589350866174121e-01   +3.266143050716095e-01   -3.986741124216148e-01   +3.020755067267243e-01   -7.149041942346132e-01   +2.558256165672587e-01   +1.460630384314031e-01   -4.261297893999706e-01   -1.698341343957580e-01   -3.645592343434545e-01   -8.204435903670350e-01   +4.476969100939526e-01   -7.894516433249227e-01   -6.235923391304066e-01   +5.059257751356629e-01   +8.240773908752507e-01; +3.367854723011900e-01   +6.985881153351864e-01   -2.309655067781073e-01   -4.500023990440609e-01   +7.055573213923613e-02   +8.427091045218965e-02   -3.653996757566115e-01   +9.099897932785661e-01   -2.824289894165932e-01   -4.366104447119014e-01   -6.162382843277228e-02   -9.401466443463207e-01   +4.643530683515506e-02   -3.183713699682114e-01   -1.067615395949837e-01   +2.876271378944659e-01; -1.621845651692716e-01   -2.448315483205880e-01   -5.092204014630219e-01   +3.330173052378107e-01   -2.775073914323123e-01   -6.811802703029605e-01   -6.362844872069030e-01   -2.872661957031310e-01   -3.029028447444710e-01   -2.482959139155380e-01   +3.850213059229511e-02   +3.387315417422310e-01   +2.590484787608069e-02   +1.373625591261881e-01   -1.815925874226440e-01   -2.729611413956476e-01; -5.177372626232518e-01   -7.981230822519627e-01   +7.199594739556392e-02   -1.295460592115497e-01   +4.617249948966209e-01   +1.761364925555438e-01   +2.498824216285973e-01   -2.212577541154387e-01   -5.446204888092512e-01   +3.416795702502698e-01   +9.686527594910539e-02   +2.797782106813914e-01   -2.709415803950388e-01   -2.988011491113907e-01   +4.885096628092059e-02   -3.649801399371192e-01; -2.120831954854498e-02   -8.235587099597114e-02   +2.718826209578800e-01   +1.120559538616664e-02   +5.496284601446696e-01   +3.929613912970186e-01   -5.078813777232397e-01   +4.769376373729776e-01   +7.406231070373251e-01   -1.063920844618274e-01   -1.139839579611166e-01   -2.213113046102799e-01   -1.292239281406378e-01   +2.218412715729488e-01   -1.962567664529598e-01   -4.632320972874820e-01; +1.051907408046091e-01   +8.380649487042989e-01   +2.284822331288326e-01   -4.327921640022221e-01   -1.632928874034959e-01   -5.497320867795523e-01   -3.441226327455819e-01   +1.186281373846245e-01   -1.063137092337077e-01   +2.977750548925307e-02   -3.570941591527084e-01   +2.184178993734850e-01   -1.813764941722048e-01   -3.026946611135579e-01   -1.761904119742447e-01   -6.119687911848217e-01; -5.450602483686686e-02   -3.950583467575671e-02   +5.451655181212801e-01   +3.813281953453131e-02   +6.707587856005842e-01   +3.323460346934020e-01   -5.097705189729154e-01   +1.388516322593835e-01   +7.340893096376222e-02   +3.936693770766313e-01   +5.740876886806677e-01   +4.132479048085250e-01   -4.030014710439653e-01   +8.108756842761139e-02   +7.924124501454004e-01   +1.121044006522157e-01; -2.306642301822530e-01   +1.576738493122937e-01   -2.143667334703523e-01   +1.008197589811123e-01   -5.370506039754021e-01   -8.332775519575213e-02   +2.153293221874772e-01   +1.152065442325357e-02   -4.734350467898641e-01   +8.489209780273824e-02   -1.396554355386664e-01   -8.171010196323397e-01   -2.879357590160557e-01   +3.257729237585122e-01   -1.147430377626954e-01   -9.659758047097500e-02; +8.956173597194650e-02   +5.591776971771285e-01   -6.760176230261588e-01   +2.428414013475290e-01   -2.174591275038336e-01   +1.495763728712407e-02   -5.619349471111096e-01   -3.520744558210185e-01   +6.373138806323606e-01   +2.798523649943493e-01   -3.620847715239331e-01   +3.604172692969469e-01   +1.670441079685430e-01   -1.271983586196246e-01   -1.249383215746904e-01   -1.128041487988678e-01; +7.506292828272780e-01   +3.459516456529295e-01   +3.287361023381093e-01   +3.245716773331202e-01   +4.762546157693140e-01   -7.592931132158783e-01   -2.886285125563731e-01   +4.212063684208410e-01   -4.344182553655205e-01   +1.775312603360280e-01   -1.558824876637181e-02   +2.453287575403802e-01   +9.698417902792686e-01   -4.601165884762288e-01   -6.348107472830546e-01   -8.076822235612208e-02];
L2I_L1I_iGABA_netcon = [+5.986999563383341e-01   -5.271143204385701e-01   -4.108149385323826e-01   +6.348114458418751e-01   -5.813356033852093e-01   +4.035626201670405e-01   -1.908787784971328e-01   +3.769887834356643e-01; +6.301724778952160e-01   -5.962807058694654e-01   +5.770808373142948e-01   +6.860734733746467e-01   +6.905405488782059e-01   +4.882086590041992e-01   -2.566982156854143e-02   +7.218958385006879e-02; -4.516607517720088e-02   +6.099137165423836e-01   -1.080160448600675e-01   +3.427153973473541e-01   +4.244480763105728e-01   +6.238119608827845e-01   +7.187239327397545e-01   -4.335785225240361e-01; -1.771697065705680e-01   -3.679236105280064e-01   +1.291670461057434e-01   +2.936991378398485e-01   +1.745331597653706e-01   +5.091484245012964e-01   +3.858644762056263e-01   -5.942741157241320e-01; +9.400710346102496e-02   -5.616301208444843e-02   -4.218395221553002e-01   +4.165830490653598e-01   +7.197357756315564e-01   +2.905572829979687e-01   -7.385991093034892e-01   +5.080095336280379e-01; +2.235871423519573e-01   +4.576592481417163e-01   -5.874587037578596e-01   -4.188940432792631e-01   -5.688226056494450e-01   -2.434196740106039e-01   -8.872215030451793e-01   -3.753711726551601e-01; -8.818223711494061e-01   -9.225607490240867e-01   +2.872591676172647e-01   +6.313273943727574e-01   -8.797879223029212e-01   +9.878530884777756e-01   +2.241555602191775e-01   +4.025774204039100e-01; +7.438657815112117e-01   -2.145329919061550e-01   +6.511169648756793e-02   +8.842270466098224e-01   +1.862951217181913e-01   +1.684679625873347e-01   -2.646414253003507e-01   -5.552216262655451e-01; -1.224030286040900e-01   +2.990494220642038e-01   -5.765880521576831e-01   -5.487192021574576e-02   +3.196736617362029e-01   +1.391618744070884e-01   +1.773282743555414e-01   -2.044477581595240e-01; -4.603800104477917e-02   +4.437313089836177e-01   +2.248802107136228e-01   -1.000000000000000e+00   +5.460693535726380e-01   -7.182209362775038e-01   -7.491596471856894e-02   +5.837412551856616e-01; +7.529803146430630e-01   -1.404448039596382e-01   +6.650883922639960e-01   -5.114122982444166e-02   +1.740313678056323e-02   +5.568069499210215e-01   -5.739603121740459e-01   +7.291250847453803e-01; +7.677562878097630e-01   -8.747095432957966e-01   -5.287686821803851e-01   +9.488230780313667e-01   -2.897960599445039e-01   -3.521090859240874e-01   +3.826081963574822e-01   +8.495087177255219e-01; +7.996721278309071e-01   +1.210138609950737e-01   -2.194286242964073e-01   +5.158967012753872e-01   -2.983557276345276e-01   +5.741569054296718e-01   +3.767875598247800e-01   +3.276928616212476e-01; +5.236205572818288e-01   -2.739404171485664e-01   +4.933031160102650e-01   +8.135518230925503e-01   -6.697588180285962e-01   +2.415897357719881e-01   +3.410164860900344e-01   +8.763898950283748e-01; +5.763833840193361e-01   -8.892335249332219e-01   +8.351268968515467e-02   -4.174242632731887e-02   -5.934617448850172e-02   -1.163031259897818e-01   -4.330978311212097e-01   -5.606237875618484e-01; +6.085228510775119e-01   +7.116023063276545e-01   +3.253733727179272e-01   -7.815391870451103e-01   +2.468892827747841e-01   +6.749473727289288e-01   -9.877462143665598e-01   +6.239419063025184e-01];
L1I_L2I_iGABA_netcon = [+3.391540733380480e-01   +1.996454720823174e-01   +4.002821218856101e-01   -4.371709148439258e-01   +1.956672511533193e-01   -2.899934684634271e-01   +1.090276468457848e-01   +3.154298948177846e-01   +1.161173135029954e-01   -2.791243906251661e-01   -3.536826926544887e-01   +5.227746818830242e-01   +6.137077804746191e-02   -2.462393513478372e-01   -6.478869179305768e-02   -5.523851821916414e-02; -3.477492324245914e-01   +7.602990449758497e-02   +2.181331964060490e-02   +2.114489885424865e-01   +1.686415284887263e-01   -4.713371703534139e-01   +8.615433036576489e-02   -2.833412058413345e-01   -5.728459485874154e-01   +4.157614367685218e-01   -6.227992297634714e-01   -6.842530144050947e-02   -7.056367109145624e-02   +6.136914944703524e-01   -5.339545120252148e-02   +4.784529747508982e-01; -2.431233927338140e-01   -7.101293518503801e-02   +1.103400491917939e-01   +4.766901992990890e-01   -7.118869837741625e-02   -1.946070871701387e-02   -3.576096355781597e-01   +4.096378901736033e-01   -2.549256590586984e-01   +1.959072623133072e-01   +2.895786489154720e-01   +3.834584436585962e-01   -9.199834098772772e-01   +5.773135990308042e-02   +5.106477713387498e-02   +2.353872251910374e-01; -6.618237083514783e-01   -2.787697557851977e-01   -4.043740002973096e-01   -6.595831809196908e-01   +1.219059587199226e-01   +6.228513512895177e-01   +5.363122535101809e-01   +6.932683765808249e-02   -3.217913638578201e-01   -9.777401658957920e-01   +1.178156003635075e-01   -6.017118073294587e-01   -5.981248644011185e-01   +3.124708327001299e-02   +4.579768733361825e-02   -7.867572149471844e-01; +1.000000000000000e+00   -3.003866358949845e-01   +3.084802256881268e-01   -2.324759382632950e-01   -7.852992201012209e-01   -8.262942786583313e-02   +4.342107219916771e-01   +1.682241355447037e-01   +2.013918595732902e-01   +9.603544428089547e-02   -4.629720526467811e-02   -3.897796436415533e-01   -6.651213106571519e-01   -3.040735483829380e-01   -4.196797747902528e-01   -2.253764230896710e-01; +2.979480450034888e-01   +1.667513201793274e-02   -7.071652907767225e-01   +3.959273061757773e-01   -4.516367217188689e-01   -2.811787063100779e-01   -4.548209093105073e-01   -3.955845778698202e-01   +3.538723508440909e-01   +4.512621269981232e-01   +4.186775812826502e-01   +1.997551348950172e-01   -8.640621765502945e-02   -2.198297396250753e-01   -3.628193626070276e-02   -3.627167176821275e-01; -3.804957249190496e-01   +3.483707767977241e-01   -1.753803590294522e-02   -2.033840347134477e-01   +3.726562168725314e-01   +2.000321910233694e-01   +8.217375430885240e-02   -1.463874754759389e-01   +6.014555809262061e-01   +3.107517384428923e-01   -3.426257514236912e-01   -2.665791557290019e-01   -2.198786013834502e-01   +2.071323890990044e-01   +1.833739036982876e-02   -3.277032823360431e-01; -5.864448800798212e-01   -3.125109207193690e-01   -6.389939372654538e-01   -6.777177737211024e-02   -1.859580425357929e-01   +9.012675704492816e-01   +8.999532733798502e-03   -7.424706298855671e-02   +6.948429315438325e-01   +2.600212140615235e-01   -6.278406786169858e-01   -4.547939980175307e-01   -5.422109010189066e-02   -4.270228353027627e-01   +1.292856008266932e-01   +3.065054265941761e-01];
L2E_L1E_iAMPA_netcon = [+5.798101477095560e-02   +2.146441868978313e-01   +1.239704662435695e-01   -1.715801271354252e-01   +1.778501818463027e-01   -1.708222271741223e-01   +8.221087290664244e-01   -3.974868006374145e-01; -4.463459851111950e-02   -3.021110144257503e-01   +5.092162198390692e-01   -5.436798624674298e-01   -5.756622625867948e-01   -1.194735586925828e-01   +3.361594523281851e-01   +1.713447414658565e-01; -6.740237950976623e-01   -5.910705364185156e-01   -1.049232488890422e-01   +6.751658689783048e-01   +8.861994942490917e-01   +7.032045277000338e-01   +1.334350433090883e-01   -2.549524903677198e-01; -9.143869108553514e-02   -2.941763578979207e-01   -5.023321888988405e-01   -8.921564936224590e-01   +5.855071886177172e-01   -3.175250206731220e-01   -7.475684352162612e-01   +3.547801849082820e-01; +1.832070827716513e-01   -1.294859899843062e-01   -3.382930482249282e-01   +1.936859250442795e-01   +8.450650200657481e-02   -3.315584047285925e-01   +7.409779885098936e-01   -2.234124003666269e-01; +7.215171534291971e-01   -5.223036260106569e-01   +7.276692168976994e-01   +4.164510247530978e-01   -2.196363481971501e-02   +4.758943297652822e-01   -5.912758706553783e-01   -4.092054601500115e-01; +5.422643285131221e-02   -1.648050244728987e-01   -4.628629818279500e-01   +4.813728861796158e-01   -2.030556204666236e-01   +1.178332571420774e-01   +1.000000000000000e+00   -7.734045952555926e-01; -2.026159774038734e-01   -1.449637585917572e-01   -4.136075495146507e-01   +4.413164261927969e-01   -3.231139935593474e-01   +1.726699867643745e-01   -7.688948620133595e-02   -1.537469778290744e-01; +5.897875191929713e-01   -3.562441415494722e-01   +8.010708569830967e-01   -1.303775148562771e-01   +2.588358920404537e-01   +4.985721335154463e-01   +1.933433985797152e-01   -2.022585078379224e-01; +1.073049302672235e-01   +8.115950717950354e-02   -7.388765357116022e-01   +4.873410237700865e-01   +9.523489423291223e-02   -4.154527862670591e-01   -4.216344028754189e-01   +5.183073835242379e-01; -4.309640466993029e-01   -7.976098284359984e-01   +4.865655505644491e-01   -4.133347245262113e-01   +2.161996960326391e-01   +1.001499003984868e-01   +3.566950277865780e-01   -7.630484410802013e-03; +1.121044676746269e-01   -3.866544094961435e-01   +5.118594673262892e-01   -7.966869204375732e-02   -8.193366834338918e-02   -7.842012326587046e-01   +7.717145726386257e-02   +4.272059487494868e-01; -6.641561283811456e-01   -3.782712568789352e-02   -5.456079685215255e-01   +4.563285328383600e-02   -3.177637651104520e-01   -3.510734631967051e-02   -5.093190266054803e-01   -3.659363675792732e-01; -3.130162935326808e-01   -6.562649467085175e-01   -5.189192552806638e-01   -9.541519961594523e-01   +1.563682535212444e-01   -6.618990947413007e-01   +3.431249824525074e-01   +3.856753105172538e-01; +6.940564425274716e-01   +3.044484817580990e-01   +9.010473000698042e-01   -1.715297043487069e-01   +1.147862574348060e-02   +6.567336234115572e-01   -4.537475409915544e-01   -7.888624589223930e-02; +1.446664856536153e-01   +7.509652749491891e-01   +6.248907648854680e-02   -4.908409848396864e-01   +2.984234699720743e-01   +5.584705898415909e-02   -6.715871523539558e-01   +1.832249851780758e-01];
L1E_L2E_iAMPA_netcon = [+4.550270067622817e-01   +4.104301259241413e-01   +2.255909814215551e-01   +8.551992597144483e-01   +2.746796439680593e-01   -2.183293898178409e-01   +4.965444246248948e-01   -3.598043978795428e-01   +5.815894893408459e-01   +3.937144419330871e-01   -7.654316767508791e-01   +7.506552460661469e-01   -3.326675607770045e-02   +4.846798722622460e-01   -3.207823936927870e-01   -1.619638117824108e-01; -3.836637320903598e-01   -3.436796288823190e-01   -2.880905875908767e-01   -1.256619282753605e-01   -9.084636803177252e-01   -2.626055071010199e-01   +3.745946693007099e-02   -6.146416691356064e-01   +1.503134226237550e-01   +1.519077875703741e-01   -3.465883376621998e-01   -2.954731512402888e-01   +1.943487184955932e-01   +9.064823119850494e-01   +4.430784284144508e-01   -8.881029761928314e-01; +9.939445888753688e-02   +5.614873492040645e-01   -4.050087178538631e-02   -3.414425859292866e-01   -4.320001001943244e-01   +1.792911219549075e-01   -6.271250196487982e-01   +1.881922947712011e-01   +2.226876436681127e-02   +7.583720458464852e-01   -6.684228046880423e-01   +2.335611086250248e-01   +9.534638273983511e-01   +1.803535707178637e-02   +1.474162994273124e-01   +5.756869081203759e-01; -1.036800108266167e-01   +5.086064751015804e-01   -4.385995479433997e-01   +5.715030779678482e-01   -5.535443637261550e-01   +6.248090592943377e-01   +4.199194135222147e-01   +7.161264512984912e-02   -6.757713257812084e-02   -1.241708002218029e-01   -5.943672691297234e-01   +2.291920862495478e-01   +3.040877552803803e-01   -6.140595363891616e-01   +5.692939671337952e-02   -9.010381681714257e-01; +1.274230650363662e-01   +4.972273005529315e-01   -6.291850406624218e-01   +3.103791044489262e-01   +2.951617988303677e-01   +2.867911526065355e-01   +8.749341282293517e-01   +7.673469586952442e-01   +1.017896067573626e-01   +9.077240067475095e-01   +1.346536232942631e-01   -4.875522791659378e-02   -7.973579459478887e-02   -6.620116667235747e-01   +4.590423804123081e-01   +6.262365544882762e-01; -2.408346213431018e-03   -2.277906545935700e-01   +1.220129952936177e-01   -1.448582356983422e-01   -2.333195011675778e-01   +3.796952767163221e-01   -5.783905384751553e-01   -2.092727487436630e-01   -2.858236159760667e-01   +1.595340481544665e-01   +1.475322160764774e-01   +1.021846705975744e-03   +3.070915361671355e-01   -3.365422258213189e-01   -4.637609314939660e-01   +3.759472898702220e-01; -4.637129931491623e-02   +3.166289698858041e-01   -8.889538860680507e-02   -7.287989006789421e-02   +6.604454449990698e-01   -1.402069720283735e-01   -2.653778122002884e-01   +3.650072543737179e-01   -5.829670779855028e-01   -6.338774121876134e-01   +8.063571584293638e-01   +5.888909340977717e-01   -3.454255310701059e-01   +3.761789016498367e-01   +2.560340228898373e-01   -8.326623113337824e-02; -4.040661997996630e-01   -2.030890654326459e-01   -4.211716090802410e-02   +5.555890269072992e-01   +1.185206025728150e-04   +4.185412460035337e-01   +6.809945868989584e-01   +1.121382099350978e-01   +1.007783008313920e-01   +7.088714622602993e-02   +5.147692665197753e-01   -3.696943643346022e-01   -5.498987697661186e-01   +1.441253185915005e-01   -4.661100522979896e-01   -5.591965250330924e-01];
L2I_L2E_iAMPA_netcon = [-1.516061914755782e-01   +7.853743895000743e-01   -8.169573707353678e-01   +4.792260297577209e-01   -2.461996698407549e-02   +1.110851296405898e-01   -2.935025856255764e-01   +1.404807840260777e-01; -2.043590030432698e-01   -9.384730979255616e-01   +4.472347932853628e-01   -3.831817032892659e-01   +4.396541934355225e-01   -2.681315837014504e-01   -3.955530060079977e-01   +3.491630473015968e-01; -3.564129964128838e-01   +6.281992279619558e-01   +4.232825635074693e-03   +1.711599215781394e-01   +6.838913840734382e-01   +4.943292609810158e-01   +3.918936491249657e-01   -5.074230478809177e-01; +2.247073888174732e-01   -5.566137493622341e-01   -1.445473395464757e-01   +2.150569553499402e-01   -2.190552418541614e-01   +3.628189199498061e-02   +4.897868055409447e-01   -2.839787745243282e-02; +1.846597051821490e-01   -8.696053105909796e-02   -7.139794392064649e-01   +3.335741558235777e-01   -1.299726140128295e-01   +1.840180630410787e-01   +4.080567440890410e-01   +4.918238329533866e-01; -2.140860599890954e-01   -3.979601690522016e-01   +2.844197546590420e-01   -8.387595449021137e-02   +3.552405037166417e-01   -2.376306223151200e-01   +9.615963843480594e-01   -2.817275285149319e-01; -2.793647978829583e-01   -4.349382372201402e-03   +1.010746640647036e-01   +2.923566844783458e-01   +1.938866781281664e-01   -2.848162874658138e-01   +4.259713857124652e-01   +2.613732339126052e-01; -2.821230707375491e-01   -8.361366201431963e-01   +6.735855655667192e-01   +1.186321168557169e-01   -2.054437981966263e-01   +3.235215234923705e-01   +5.548143237276416e-01   -3.282766925581058e-01];
L2E_L2I_iGABA_netcon = [+3.854280093319061e-01   -6.161896945084554e-02   -2.870071500648650e-01   +3.874812759464855e-01   -5.995720253555173e-01   -9.271009114851940e-01   -7.445640966038652e-01   +3.096156182839966e-01; +4.648971713690351e-01   -2.961854698470365e-01   -3.719959472006449e-01   +5.434451162970394e-01   +1.330436588528654e-01   +3.027260524100062e-01   +1.320889574005655e-01   -7.429404489196715e-01; +3.431571400914455e-01   -2.038539833793030e-01   +1.373904123764630e-01   -3.953048988334426e-01   +1.091408324250061e-01   -1.162369719930389e-01   +9.713601086873972e-01   -9.055343707249195e-03; -4.742889201983544e-01   +5.314672536592290e-01   +4.328368273193886e-01   -2.731280050681723e-01   +3.697523555723144e-01   -6.832582387589291e-02   -1.829405286211297e-01   -3.184795508987277e-01; +5.129156572408650e-01   +6.992877083135082e-01   +4.890685799540891e-01   +2.469904644596342e-01   +1.384634499053314e-01   +5.121567740180190e-01   -6.674303676642613e-01   -2.894133931006653e-01; +1.528124571640576e-01   +6.646309507564515e-01   -3.255452596528370e-01   -4.434309513084806e-01   +3.572913709972766e-01   -2.376540029908324e-01   -3.692469954278523e-01   -2.495996382166220e-01; -4.773286135351013e-01   -4.674996445047074e-01   +7.367924579014741e-02   +7.799047076448156e-01   +2.404914346848250e-01   -6.932322967193327e-02   -3.744142144673021e-01   +2.143636154302168e-01; -8.317578527400308e-01   +3.128035900531023e-02   +8.648690402743414e-01   +2.847875480006176e-01   +4.400880696741613e-01   +3.605578878800457e-01   +2.372051602076555e-01   -2.645218776262840e-01];
L3E_L2E_iAMPA_netcon = [-4.266865059467392e-01   -1.395297353968616e-01   +4.988809206277335e-01   -7.545382936754746e-01   -2.804300750295867e-02   -8.004519543582214e-02   -2.131605913968420e-01   +4.068942041923040e-01   +6.782779998287040e-02   -2.291493425712423e-01   -4.140753170378399e-01   +4.766049948096472e-01; -6.169339855680218e-01   -1.258448675612046e-01   -6.332965116741996e-01   -2.498810825668314e-01   +2.904741767912392e-01   +9.958274089792203e-01   -7.325086767269198e-01   +5.534931761733992e-02   -1.070326912881432e-02   +2.620105225388564e-01   -6.837527376983328e-01   -2.615135329233706e-01; +1.223290321404049e-01   -2.649213902219720e-01   -8.752222782458956e-01   -7.238996786961220e-01   +2.305038713941668e-01   -4.051579516811975e-01   -3.300700852939848e-01   +6.599899842242107e-01   -7.933273709684284e-02   +6.338452472018188e-01   +5.857690218215912e-02   -8.134678887309740e-01; -3.409355780503602e-01   +7.467312610218738e-02   +4.961638839998773e-01   +2.642605075544902e-01   -2.243724416908087e-03   +5.693139990820737e-01   -4.981364633485805e-01   -6.585465837965144e-01   -7.868057257346774e-01   -2.410111739355898e-01   -1.932504752060214e-02   +6.011217538887497e-01; +4.425039683292595e-01   -5.038716254485702e-01   -5.315852958374397e-01   +2.906847493963398e-01   +1.635113912682826e-01   +2.956083445781442e-01   -8.417504764339008e-01   +4.825645561602296e-01   -3.813960263461257e-01   +5.199381434484808e-01   +2.677951633034454e-01   +5.947675888154234e-01; -2.870309623068515e-01   -2.139058105277628e-01   +5.616627137616772e-01   +9.309231046539609e-02   -6.522740317989487e-02   +5.083548744349139e-01   +4.750887899956847e-01   +5.320751630876895e-01   -5.404286748960042e-01   -7.514613144270179e-01   -8.186630946643701e-02   +8.381338124346581e-01; +4.551734201045009e-02   +1.967680999688564e-01   -7.734990527765604e-01   +7.551180368527408e-01   +1.141310755525744e-02   -4.877057155112302e-01   +4.223365653890490e-01   -7.625013909000530e-01   +3.874931351433927e-02   -1.851827857378362e-02   +9.583625604176617e-01   +2.982428013346129e-01; -2.454121529939962e-02   -3.575014672581345e-01   +2.569083006027620e-01   +9.220432463059713e-02   -1.353100513113315e-01   -4.457054271717852e-02   -3.128437146238111e-01   -2.800612054509337e-01   -6.658471380558791e-01   -4.074504303423753e-01   -5.429755775073295e-01   +7.674791349343929e-01];
L3I_L2I_iGABA_netcon = [-9.497907080353464e-01   -4.039017424685477e-01   -8.143498229712792e-01   -8.110342561641550e-01   -5.756903992705154e-01   -6.861061019494975e-01   +5.428269690463466e-02   +3.436882327514399e-01   -4.292215879895763e-01   +1.039350973703820e-01   +1.223125632803457e-01   -1.590391505180029e-01; -1.387657053933686e-02   -1.526598123914065e-01   +6.845928656696556e-01   +1.259560040480785e-01   -3.873290171836579e-01   +3.944952762815898e-01   -1.075954368657276e-01   -3.111748392899534e-01   -1.526307923065166e-01   +8.029968816047055e-02   -1.867038342730812e-01   -7.689779835666964e-01; -4.131014761336430e-01   +8.795521595000404e-01   +2.328871293245193e-01   -4.029023598531637e-01   +5.877437593160217e-01   -1.942537471259717e-01   -6.426496770403879e-01   -3.083964634899389e-01   +4.293312522442702e-02   +5.622135372146234e-01   +6.581365024485699e-01   +2.891124388628579e-01; -9.797208051100433e-01   +6.393664565493423e-02   -8.641786614257256e-02   -4.801492143227145e-01   +8.284894134873030e-02   -1.651862603457558e-01   -5.003082964466583e-01   +4.515219170642016e-01   -3.112189275253576e-01   -2.519743833546040e-01   -3.624403816784203e-02   +5.745883326168545e-01; -5.703672405841101e-01   -5.316415442529219e-01   -4.214992591733884e-01   +7.309498818458138e-01   -5.860083493227508e-01   -5.631193214455040e-01   -1.289904451327746e-01   +4.274666077568962e-01   -8.946654757142812e-02   -1.643174916340095e-01   +4.897313673204379e-01   -9.503096179722820e-02; -4.959411709252363e-01   +3.191507388374974e-01   -5.599356889518416e-01   +2.328755492805120e-01   -5.115241989019673e-01   +2.285653724428390e-01   +5.703398535040007e-01   +5.115988970377942e-01   +6.738999417104952e-01   +6.231073956684560e-01   -8.771757681974857e-01   +8.284250600172503e-02; -5.174692235071644e-01   +5.359343686439938e-01   -1.664283537091337e-01   +5.027492459289683e-01   -8.237531800802539e-02   -4.017272024226001e-01   -6.266596292033965e-01   +3.250812270984988e-03   +5.346959311296673e-01   +1.719245157075789e-01   -5.457863645601616e-01   +5.013810344075812e-01; +7.459394765226052e-01   +2.044954703374998e-01   +4.294326428733255e-01   -1.593289128290658e-01   +5.343204024846130e-01   +5.855440420771046e-01   +3.927312062531947e-01   +4.799156667988130e-01   -4.937870365728002e-01   -5.043941068970054e-01   +4.899213568081334e-01   -4.409729538445119e-01];
L2E_L3E_iAMPA_netcon = [+6.472957855876048e-01   +4.165924614971597e-01   -3.937284464373589e-01   -4.119179649312464e-01   -1.906862344541979e-01   -3.803587323688585e-01   +3.382152517085022e-01   +3.078295962537768e-01; +5.422999297667067e-02   -2.072782749596763e-01   -3.599683216239601e-01   +4.054929660904324e-02   -7.544052913009009e-01   -3.377309984121387e-01   +4.462889508033114e-01   -4.756539407735286e-01; +3.582439127986198e-02   +3.071262929295511e-01   -3.200268344926622e-01   +1.366988300160673e-01   +1.291498650426623e-02   +2.481869269625538e-02   -5.495476163941839e-01   +1.381991442100585e-01; +7.600272100671470e-04   -2.281095207956089e-01   -7.344866800592134e-01   -2.458884622548431e-01   +1.000000000000000e+00   +3.086710164248750e-01   -3.241237734835887e-01   +5.583642996657682e-02; +6.020414430282492e-01   -2.109022300697444e-01   +2.064673544759315e-01   +1.158880724964467e-01   -2.535087495539834e-01   -4.071032013216391e-01   -1.755172770779824e-01   +2.871129647260249e-01; +1.760166474858733e-01   +6.197009276717229e-01   +7.074560397834447e-01   +6.612432687535137e-01   +4.204033881263418e-01   +1.335563177196301e-01   +3.291461692618786e-01   -2.483949937471386e-01; -3.668998540035802e-02   +4.723251923611992e-01   -1.166949998268980e-01   +9.965008173462725e-02   +6.950422092174398e-02   -9.853430709311246e-02   -4.771298263391043e-01   -3.462360471535759e-02; +3.391549385599062e-01   +4.771896781429671e-01   -5.457926713696657e-01   -1.233164991982107e-01   +4.290393682991966e-02   -5.187844484257457e-01   +1.436531312113953e-01   +4.545281656961447e-01; +2.969663936319838e-01   -8.126391521059680e-01   -7.426516811256139e-01   +2.609247863821259e-02   -6.278644274157765e-01   +6.353568875895967e-01   +4.290443005482013e-02   -3.551610691255085e-01; +5.814747878739134e-01   -4.268686316130710e-02   +3.523974111605311e-01   +8.091240857033033e-02   +4.436146352207820e-02   +5.461414994368883e-01   +2.003518768577247e-01   -4.242483574830858e-01; +1.711707496495139e-01   +2.399611476831475e-01   +4.814263775353299e-02   -2.451276572887464e-01   +1.321019897394448e-01   +3.738843881301551e-01   -2.204979196110737e-01   -7.664670661997178e-01; -3.402232209930723e-01   -5.806479019294064e-01   +2.976513371953240e-02   +1.953003465980475e-01   -4.751655535586229e-01   +2.723994995809470e-01   -4.579822481276440e-01   -8.037482818540445e-02];
L2I_L3I_iGABA_netcon = [-3.390506726208097e-02   -1.309697103678695e-01   +2.271687055999892e-01   -9.669737515023933e-01   +3.009295071334836e-01   -6.695345958255907e-01   -9.631924576676416e-01   +9.123078372741805e-02; -7.911094298662247e-02   +1.533796515776878e-01   +3.839218795314618e-01   +5.335769812205891e-02   -3.280870008964939e-01   +1.296282336742763e-01   -2.603300582267581e-02   +3.755870119788394e-01; +4.866444793704225e-01   -7.094107161823202e-01   +2.204506794799441e-03   +1.121853436534574e-01   +9.851330001951267e-03   +2.755569789754813e-01   +1.757826025650043e-01   +9.095158375503632e-01; +3.334235332113646e-02   -4.739718174961371e-01   +3.080490337576566e-01   -3.600731147270320e-01   +1.997876320558168e-02   +9.088260251075281e-02   +9.607544089963448e-01   -1.319903339388788e-01; +8.119207105552506e-01   +5.186205884773760e-01   +6.361477247619610e-02   +2.842696242810645e-01   +7.653748272454634e-01   -8.086148032369515e-01   -1.734959229296738e-01   -2.792038373934282e-01; -3.444290250947403e-01   +5.118117356840681e-01   +7.516550800031098e-01   -5.086631945286993e-01   -6.641509415896945e-01   -1.271957425175521e-01   +4.145283933888841e-01   -1.985223195880438e-01; -5.387961966422824e-01   +3.822812740169013e-01   -1.910143230118629e-01   +1.610407855381260e-01   +6.861875818242797e-01   -6.451851804553824e-02   -4.234990537676036e-01   -3.150800983788423e-01; -8.173901186720792e-02   +2.254831432286423e-01   +8.411856811335801e-01   +3.973903789852286e-01   +5.780021475424778e-01   -5.989296991727513e-01   -2.815551920537410e-01   -5.337658423448115e-01; -9.057285391493658e-01   +4.992347149410296e-01   -8.002855153313394e-01   +1.394596497578043e-01   +2.709729884607492e-01   +2.975506282858737e-01   -1.483589225210028e-01   -3.920038672911923e-01; +4.518800868351067e-01   -4.483930147651966e-01   -2.402211084386820e-01   -2.146380941114716e-01   +1.998621234971847e-01   -9.113015822473282e-01   -8.708965447381780e-01   +5.041236162279547e-01; +8.417635622742915e-01   -2.838835644862568e-01   +1.619285512603781e-01   -1.486142460010059e-01   +1.943761545203246e-01   -5.466419215182865e-01   -6.533567397206154e-01   +4.507307497854012e-01; +4.491918994668638e-01   -1.565229891924745e-01   -6.992696999812540e-01   +2.187570575793913e-01   -1.247795703363862e-01   -3.938789486686723e-01   -2.567752199151462e-01   +2.697914244109660e-01];
L3I_L3E_iAMPA_netcon = [-3.663329784472431e-01   +1.135574196210494e-01   +9.928293710089142e-01   -2.094852901370992e-01   +4.121581604376995e-01   +7.454637980940836e-01   +4.469369066335819e-02   +4.295681393315507e-02   -1.206704955187804e-01   +4.585999349034001e-01   +2.522598462238045e-01   -2.614473720915045e-01; +7.058535364183159e-01   +5.719333944083036e-01   -5.848196734248397e-02   -8.380660112737944e-01   +2.837204318788651e-01   -1.066809715841507e-01   +2.463390415844653e-01   +3.022133806572203e-01   -9.881814754249328e-01   +1.313179912017385e-01   -5.508230516273096e-01   -7.539095094038462e-01; +5.017096625301938e-01   -3.233505621582055e-01   +1.459542142129657e-02   +5.650219580283369e-01   -5.397185683764626e-01   -9.375600581651814e-01   +1.571751744093375e-03   +1.726999777526154e-01   +1.866058164747407e-01   -6.116685667957289e-01   -6.658980993242374e-01   +4.297648049879579e-01; +4.303485559849600e-04   +3.272300434245421e-01   -1.174168569046877e-01   -7.885420219375794e-01   -6.165786012681467e-01   -5.494150773020221e-01   +2.961025431347963e-01   +3.090111167504861e-01   +2.506725241712738e-01   +4.794403407660093e-01   -7.697741114370207e-01   +6.506717212619142e-01; +5.280613098119474e-01   -7.982201819564222e-01   -2.481535302784868e-02   -3.207525724855499e-01   +6.215815547074355e-01   +6.914778863609706e-01   +2.841358401366116e-01   +1.799768906154581e-01   +7.813824877963818e-01   +6.100926432167894e-01   -3.187478630045993e-01   +1.899749283435668e-01; -7.533197959189948e-01   -7.651130519208413e-01   +3.186521974306517e-02   +1.922765331840745e-02   -3.281675999970712e-01   -1.269127651359258e-01   +4.951092729173089e-01   -1.268939189582671e-01   +1.496613570591152e-02   +1.018196975057605e-01   -4.396262314612145e-01   -4.718919113015373e-02; -3.053038448951581e-01   -4.437975857609579e-02   -1.906418033855413e-01   +1.197705905699380e-01   -3.297956205545140e-01   +1.920967189771289e-01   +7.527162578781716e-01   +4.139145942803044e-01   -7.509126818866095e-01   -2.947859337738508e-01   +3.181767639891948e-01   -2.184527086729377e-01; +3.210928014664970e-01   +1.513534705424345e-01   -6.507741646940840e-01   +3.546188736066980e-01   -6.310764758469573e-01   -3.063874763545678e-01   +7.833175304072181e-01   +4.271066162549429e-01   +6.645002157782938e-01   -4.713824817154972e-01   +8.187058808055998e-01   -2.450859985770326e-01; +3.785296232698696e-02   +3.759279179251858e-01   +3.888077101141063e-01   +3.193301137371433e-01   -2.777284244842774e-01   +6.677917231474818e-01   +4.927868445013938e-01   -9.073711270995261e-01   -5.641186202439764e-01   +3.132375455790499e-01   -1.020160347911331e-01   +7.561371336028220e-01; -2.998920732930538e-01   -6.210400220924034e-01   +3.947802095997952e-01   +5.506840580706271e-01   +1.377621497279614e-01   +5.391945733126524e-01   +4.895599966809957e-02   -1.147867402139203e-01   -4.993988623912376e-01   -3.554490160956723e-01   +5.698960266914685e-01   +2.031250072507975e-02; -5.519658109762220e-01   -6.006178437470790e-01   -1.169977288572207e-01   +1.967750966882661e-01   +2.033039059162867e-01   -3.234770996483138e-01   +3.431638267555437e-01   -2.973654310108809e-01   +2.097728022654697e-01   +1.242129893446592e-01   +5.540157638624385e-02   -8.497320008594211e-02; +2.322555445147385e-01   +7.239051991004379e-01   +5.126668224227920e-01   +6.885181382079273e-01   +2.015424597268454e-01   +4.094591425243875e-01   +4.920063646892411e-01   -3.354053389795114e-01   -6.939582389985635e-01   +3.954453463876906e-02   -4.847400523315958e-01   +7.594777074156187e-01];
L3E_L3I_iGABA_netcon = [+9.281032792118403e-01   -8.457945654017000e-03   +3.839216800920126e-02   -5.892616853934851e-01   -1.289042768404874e-01   +2.652196288786764e-01   +7.834133988889562e-01   +9.250698004121309e-01   -6.604841671846714e-01   -4.274220465266485e-01   -3.370871772281657e-01   -5.890589890068303e-02; -4.547780155331693e-01   -1.155867900275483e-01   +7.223605535944427e-01   +6.117171610172690e-01   -5.329583061510059e-01   +6.106774958051594e-01   -1.411109019920861e-01   -7.574680550923196e-02   -2.959182601373801e-01   +6.146685791497356e-01   +7.335799781981102e-02   -5.104715487284398e-01; -5.054279223419004e-01   +3.385778617886961e-01   +6.593495181125618e-01   +1.847656060117145e-01   -5.517917672158489e-02   +4.629645905789979e-01   +6.513908857507736e-01   -1.509472449655440e-01   +1.355415737867135e-01   +5.698047882847681e-01   -3.079940994146138e-01   -3.723438886001032e-03; -1.000000000000000e+00   +9.853227628200327e-01   +5.676983108646128e-01   +4.646497242731519e-01   -3.050537163998134e-01   +3.043934058112571e-02   -8.092208313141547e-01   -5.973292988478909e-01   +7.069812445128086e-02   -2.122213635396644e-02   -5.039958910688366e-01   -2.121565915786336e-01; -5.305298222838880e-03   +2.745443213252508e-01   -6.481362526549496e-01   +3.976364296712952e-01   -2.726822605266650e-01   -2.834134144083332e-01   -1.955943682690313e-02   -2.634919327737691e-01   -3.483298012305636e-01   -2.266810710421101e-01   +7.504040417104578e-01   -3.291327031896780e-01; +3.217888856694346e-01   +7.745500619323956e-01   -1.831160746267181e-01   -5.578516953526741e-01   +2.489039724708896e-01   +3.197592224332841e-01   +1.947385519472364e-01   +2.874669235016492e-01   +1.813964195914473e-01   +3.590553533183378e-01   -6.662748293976489e-01   +1.394581937866859e-01; +4.988792785098860e-01   -4.525066841175987e-02   +1.379214739887045e-01   -6.114291967670835e-01   +5.481351282968980e-02   -4.417036582397462e-01   -6.185554138066185e-01   +9.659209212705826e-01   -9.025959864097209e-03   +5.934277335436846e-01   +4.532520143449280e-01   +2.907359011252713e-01; +3.973866726412953e-01   -7.426580137248368e-01   -1.367943474266953e-01   +3.428385610368926e-01   +6.186715185382731e-01   +2.580844066115950e-02   +5.246459193688857e-01   -1.496751190688381e-01   -1.502786757220251e-01   +6.042689605297710e-01   -2.638185087858634e-01   +8.509751331460425e-01; -2.969064029918815e-01   -2.335505064683448e-01   +2.151081181335390e-01   +7.816143707612933e-01   -9.365320826046804e-02   -5.625984956253012e-01   +4.955319636644593e-01   +4.316573863987148e-01   -3.440328670947193e-01   -4.209133153817378e-01   -3.757353430042967e-01   -6.036340683596554e-01; +4.152952924352226e-01   +5.168959584444152e-01   +6.316661368289668e-01   +7.661760789285864e-01   +6.202545209203998e-01   +2.286881085181346e-01   -6.215562254356526e-01   -2.952939781948109e-01   +6.468486805399331e-01   -1.476913751130052e-03   -6.795837366330083e-01   -5.466675665314343e-01; -1.051949325031330e-01   +1.596364150401953e-01   +2.081434172755812e-01   -7.002948731298218e-02   -7.990463658386323e-01   +3.521024235184790e-01   +3.333302568728680e-01   +8.150691819829669e-01   -4.523931364474945e-01   +1.243710301539599e-01   +1.843894855392959e-01   -9.390967554360166e-01; +1.072372074385907e-01   +4.256691698291874e-01   -6.086081433208004e-01   -6.872120508163305e-02   -2.673620789394252e-01   -3.317119300106118e-01   +9.037024576902875e-01   -3.088602224159759e-01   +4.813651174770827e-01   -2.354271385662895e-01   +2.587235315577645e-02   -5.017623726723055e-02];
L2E_Input1_iAMPA_netcon = [-2.657368066755942e-01   -3.415349441158591e-01   +4.729740557577920e-01   -3.868777624995075e-01   -7.360369326858601e-01   +7.770618674896101e-01   +6.198425325916997e-01   +8.098157348042665e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   -4.286491341991487e-01   +7.716466147094947e-01   -1.671393544316983e-01   +5.205987119771532e-01   -8.087045148006296e-02   -1.195946402417317e-01   -8.105676230179327e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
