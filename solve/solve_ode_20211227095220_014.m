function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.540027866501226e-01   -1.569213578956290e-01   -9.514664688811639e-02   +1.373653842183480e-01   +6.492893384955147e-02   -1.939457042110796e-02   -3.497570260267484e-01   -2.778533571073647e-01   -4.027728136822610e-01   -9.588362240996504e-03   -4.123751298504960e-02   -1.133495075734577e-01   +1.389678876109193e-02   -1.983384008257722e-01   +3.796760850647027e-02   -2.469316207491918e-01; +3.081965013814831e-01   +7.576488290921012e-02   +3.605239504755257e-01   -1.677926339901206e-01   +7.238213831064205e-02   -2.254672863021744e-01   +2.857392019113632e-02   +3.373360854922677e-01   +1.572826565783964e-01   +8.753458537337726e-02   +2.448741847225872e-02   -1.371581710098816e-01   +1.346088213881356e-01   -1.446544040650377e-01   +2.485477706533090e-01   +2.442735455001196e-01; +1.307634715151056e-01   -1.683913395509346e-01   +1.242967169380641e-01   +6.777070959372614e-02   +8.449294600325337e-02   +2.978946330444958e-01   +9.789387530100627e-03   -4.902027826385028e-02   +7.144554633052333e-02   -1.027537735319595e-01   -1.451019678720683e-01   -9.482032834707101e-02   +2.623460678895975e-02   +1.671482904071899e-01   +8.559944186244410e-02   -1.060799901850635e-01; -2.778060181773732e-02   -7.135848901568339e-03   +1.247825964839672e-01   -8.978159292537444e-02   -1.190530074880194e-01   +2.101609341028297e-01   +4.283089850238231e-01   +9.617962368424215e-02   -2.547535038243922e-01   +2.858158290120684e-01   -2.204970285925767e-01   -2.582172706915625e-01   +7.417893407910808e-02   +2.322434143657590e-01   +9.604666587091724e-02   +1.453061886739909e-01; -4.305188778138250e-02   +1.744155817663216e-02   +3.532720725639325e-01   +3.496692490673551e-01   -2.169220858452247e-01   +1.562524352380320e-01   +5.692959848511110e-03   -4.170813349236650e-02   +3.414301457223269e-01   -9.319855636600489e-03   -1.293183000010281e-01   +3.032316614413898e-03   +1.302512180969047e-01   +7.874745783475334e-02   -2.518056171598306e-02   -1.684468770275309e-01; +9.733285080706115e-03   +2.233923449856297e-01   -1.393213172701206e-01   -2.032187296670704e-01   +3.102919743849531e-02   +2.245159933425528e-01   -1.848600664766719e-01   -1.953004105222929e-01   +1.482517711074345e-01   -2.894355339622917e-02   +5.723362341189774e-02   +1.973759628044564e-01   -1.834791699125977e-01   +2.903147105191899e-02   +2.411260649334574e-01   +1.252303528480725e-02; -4.059098283304619e-02   -6.650337697240850e-02   -7.110836905472762e-03   +2.112842998771167e-02   -3.195145712370177e-02   +1.507738359264401e-01   +6.755610726187838e-02   +9.180347201749832e-02   -2.471796054791408e-01   +1.046563609219957e-01   -1.952006352459953e-01   -1.744391591142609e-01   +3.672074922621514e-02   +2.973765511448958e-02   -2.658180647833375e-01   -8.629849495100897e-02; +2.276409011160319e-02   +8.802428034051119e-02   +3.046718511232019e-01   +1.328759130956844e-01   +1.087263122781080e-01   -5.120204763779954e-02   +6.461581229909788e-02   +1.510116661200220e-01   +1.498456299857372e-02   +6.002676246389844e-02   -2.475982049949060e-01   +2.123344148719586e-01   +1.808795315832354e-01   -1.072642897377341e-01   +1.694854251526862e-01   +3.594364110774754e-01; +1.956266317828924e-01   +2.534265988846999e-01   +4.906878653652604e-02   -2.898671855091555e-03   +1.653761661038124e-01   -9.916812319838204e-02   -2.134015978326773e-01   +1.626512688522626e-01   -7.117577382174178e-02   -1.764551972682246e-01   -7.331831595559163e-02   -3.432632883890958e-01   +1.603542057433217e-01   -1.606127157546210e-01   -3.719904134320995e-02   +7.183487386362324e-02; +3.687064885825231e-02   -1.852153738337330e-02   -3.295036900017312e-02   +1.671610401835047e-01   -2.524816612640725e-01   -2.699952127852135e-01   -1.283853937285112e-02   -1.880719045791452e-01   +4.869051164658179e-03   -3.503995261818444e-01   +1.114217206014668e-01   -2.816495733172898e-01   +2.164201320917769e-01   +1.543294130384366e-01   +8.037618227871225e-02   -2.440763726623175e-01; -3.091863943487132e-01   +1.265116197131841e-01   -1.566487291795185e-01   +7.429725508978491e-02   +7.688421018774534e-02   -1.128970552034759e-01   -1.336153776769456e-01   +3.203028856108354e-01   -1.042886205756712e-01   +6.763121300519091e-02   +2.402836163346319e-01   -3.001224606294192e-01   +3.637815649244692e-02   +1.501691472319577e-01   +1.491090212050287e-01   -2.082262074453692e-01; +1.198671572287313e-01   -4.563531133467225e-02   +8.768672474473105e-02   -1.490120097755078e-01   -1.660057575245804e-02   -8.834238214598580e-02   +6.418050334300130e-03   -2.387844106238381e-01   +1.012134792978088e-01   +3.857106407532228e-02   +1.061010449383448e-01   -1.707347887095626e-01   +7.180206549898629e-02   -2.443990956380196e-01   -3.604577184604410e-02   +6.690260207007739e-02; +1.811912716519777e-01   -1.706998059442306e-01   +5.335619884167514e-01   +3.308227472967956e-02   -6.369157711304901e-02   +3.403282544381594e-01   -3.106973307136007e-03   -1.158507770127846e-01   -3.028601394309832e-01   -3.567640793799041e-01   -3.677103417715976e-01   +4.041883862052095e-01   -1.414154534986700e-01   +8.105071052531926e-02   +8.193028845397915e-02   +5.329962029081967e-02; -1.359374014764630e-01   +1.963754975175540e-01   -2.300477601091810e-01   -6.664201060993953e-02   +1.574796481662129e-01   -1.369970201630595e-01   -6.165000002481270e-02   -1.182027819353342e-02   +2.129056233391735e-01   +1.207546314842068e-01   +6.411447887345656e-02   +3.380286837010027e-02   -1.920053299514798e-01   +1.021830800478491e-01   -1.174120984678155e-01   +1.728863504834273e-01; +1.676082040131991e-01   +1.096645034991726e-01   +1.762867813539923e-01   +5.220742227784834e-02   +2.397673591252078e-01   +2.378494990171739e-01   +8.111391259358057e-02   -6.818654592197645e-03   -2.899405113951291e-01   -3.454479319806741e-02   +3.493368669133658e-02   -4.501693849597734e-02   -1.572370503387714e-01   +1.884846523558296e-03   -1.132628656099703e-01   +2.114349339650391e-01; -1.315344662428579e-01   -7.725353245459125e-02   +5.162295672699513e-02   -1.550470359474940e-01   -2.942210530854007e-01   +9.013363160011174e-02   -1.133977289069270e-01   -2.348893224673932e-02   -3.400939015689283e-02   +2.201125035020534e-01   -4.531514057035251e-02   +9.141024772384267e-02   -9.509428905652230e-02   -2.532553440990005e-01   +1.941525148674395e-01   +2.473392409149735e-01];
L1E_L1I_iGABA_netcon = [-2.195054854661808e-01   -7.799474686100767e-03   -7.486760693835234e-02   -1.557610524332285e-01   +1.871405072442905e-01   -1.089200359076838e-01   -1.056168653463916e-01   -1.170929587742836e-01   +1.321915954124717e-01   +1.099197193070240e-01   -9.732793467774063e-03   +4.464822601524175e-02   +7.263498414347527e-02   -1.203747330826236e-01   +4.731877023024147e-03   +1.982342037640649e-01; -1.094654202926667e-02   +2.141576648090726e-01   +1.861373130690673e-01   -4.222443101069493e-01   -2.606536355296400e-01   -1.027457342619517e-02   +3.074558492478546e-01   +3.319572200174129e-01   +7.488344724026558e-02   +1.874729252285087e-01   +6.097159837450365e-02   -1.418368753975666e-01   -2.716608350095210e-01   -8.031545907664628e-02   -6.365238059300518e-02   -2.559676524503620e-01; +1.903658257332715e-02   +6.772404875458020e-02   +1.262425785102469e-01   +9.253107239629976e-02   -1.040551914271933e-01   -9.156741292670845e-02   +1.259916339737706e-01   +8.187785172001186e-02   +2.369167378901884e-01   +2.043998954989855e-01   +1.184999503437159e-01   +1.168337755567186e-01   +1.522250277616643e-01   -1.740174877914130e-01   -1.853752749084176e-01   -2.810597348785723e-02; +3.929654171331779e-01   -9.290556772219086e-04   -1.149023254600308e-02   +3.374392131903442e-02   -2.419608638797719e-02   -1.023374067319525e-01   +4.388844787891421e-01   -1.558844266722373e-01   +6.875932886157619e-02   +7.150692890859062e-02   +2.136019903912842e-01   -3.126673144639018e-01   -5.791457239144729e-02   +2.334443856464576e-02   +1.234311758895492e-02   -1.315316730113522e-02; -7.840935313285081e-02   -1.633068107401099e-01   +8.642368049877334e-02   +1.377228409069609e-01   -8.120742930594391e-02   -6.996256346671449e-02   +6.830418757630843e-02   +1.405954690601993e-01   -9.624841340162278e-02   -2.726008849579037e-01   -1.072218309044094e-01   +5.630166138439072e-02   -3.617344694560569e-01   +1.823778098374982e-01   -6.938394879195627e-02   -8.000383631242357e-02; +4.607942290409275e-02   -1.080582894079189e-01   -4.132235140353717e-01   -3.486045486554210e-02   -1.268755528281056e-01   -1.107088306224059e-01   -9.403813991858581e-02   +1.447032490705830e-01   +1.854671908555370e-01   -1.921847767580152e-01   +1.597235549812417e-01   +3.103239580770761e-01   +1.268107596798665e-01   -6.487627711692015e-02   +4.774115017659786e-02   +8.086091895041396e-02; +9.683023612244937e-02   +1.861635511235474e-01   +2.821863065029668e-01   +1.151203267229985e-01   +4.348524930575468e-02   +6.601826177360987e-02   +1.826003593156434e-01   -3.953281002840601e-02   -1.416686882091517e-01   +2.577884451783083e-01   -1.150993866506879e-01   -2.506035853855793e-01   +1.262886620231772e-01   +3.833308433816898e-02   -1.535003700993246e-01   -1.972786045670988e-02; +1.190859110692517e-01   -2.290151921647663e-01   +2.543027215912280e-01   +4.894490915942910e-02   -1.329516736200306e-01   +6.367680729641544e-02   -1.763041541797014e-01   -3.151180818024238e-02   -2.291546343006768e-01   +3.866942472618493e-01   +1.184903279517496e-01   -7.763988479639568e-02   -1.891013990701378e-01   +2.491254187519056e-01   -4.752641358928608e-02   +4.890125398068928e-02; +2.723098966129973e-01   -2.397507211774369e-01   -2.703957573016102e-01   +1.023407813622231e-02   +8.399192227424251e-02   -2.719301247330738e-01   -3.505576550578272e-02   +2.300427697702028e-01   +4.219720727955469e-02   +2.510801589783029e-02   +1.251482739048806e-01   -6.775060925224869e-03   -9.683630305390115e-02   -8.323456223738271e-02   +3.906313372889541e-02   +1.164582610842438e-01; -6.080433507588914e-02   -6.248457144834287e-02   -1.621871353268036e-01   +3.200652494945928e-01   +1.061655734973982e-01   +1.920166973369704e-01   -1.185318061744183e-01   -9.425633984764514e-02   +1.895561658351664e-01   +8.871980972360509e-02   +3.622417798671420e-02   -9.569011532036831e-02   +2.484696005918213e-01   -2.527027943784143e-01   -1.046339805693584e-01   -1.078260366883829e-02; -1.690007210009689e-01   -2.363727533340971e-01   +6.299944707033715e-02   +2.170330609975259e-01   +2.236622049229506e-01   -3.939649717856085e-02   +6.773570811416471e-02   +4.252511531101134e-02   -1.172574392315937e-01   -4.233209066832154e-01   +2.111386901667394e-01   -2.836725972497564e-01   +2.305712078158736e-02   +5.134226788947709e-02   -4.718150598507711e-02   +1.300499787709809e-01; +2.597095287392404e-01   -5.479839549954039e-02   -1.193136729681167e-01   +1.154110828620638e-01   -2.837169873597077e-01   +1.054772291272389e-01   -1.683162832425510e-01   +2.229909876946600e-01   +2.516220611701410e-01   +5.554033490866461e-02   -1.575882756119686e-01   -1.970199848918032e-01   +2.442540816388878e-01   +1.152658494296746e-01   -1.476660712636718e-01   -5.606047794678550e-02; -1.651052145646582e-01   +5.975514149203734e-02   +9.545012146716644e-02   +1.499903300088841e-01   -9.791351628395117e-02   -2.995185687456265e-01   -1.969982345562708e-02   -3.737522461936814e-02   +1.660875478557498e-01   +9.243493742027120e-02   -5.287245210365386e-02   -2.020574200519552e-02   -8.912303403795712e-03   -2.746118195929796e-01   -1.979654751809854e-01   +2.759331764608298e-01; -2.449854826621611e-01   +4.018799011946667e-02   +3.720869663091189e-02   -2.401906266693984e-01   +2.265304638539170e-01   +4.710954106649233e-02   -4.984340637187949e-04   +1.576334024938103e-02   -2.874850442222292e-01   -3.296556762939403e-01   +3.326832168445686e-02   -6.594980153936546e-02   +1.497311777106020e-01   +5.449971924653948e-02   -1.704157230356720e-01   +1.536986818575654e-01; -1.296556499783621e-01   +1.058773049927937e-01   +3.242136056462037e-01   +2.071213577689165e-01   +2.340311733041820e-01   +1.299664611721750e-01   -1.602686440027037e-01   -1.410034753387445e-01   +7.063322863725852e-02   +1.838013004568000e-01   -9.620363790304123e-02   -5.309853713895422e-02   +1.327612897468009e-02   +4.726618480771278e-02   -1.238877365646523e-01   -2.360863728840021e-01; -1.334738918474496e-01   +4.662058284000729e-02   -3.329565526621948e-01   +6.793172586525487e-02   +2.391339435380688e-01   -6.818039380169291e-02   +1.691019149767761e-01   -6.128551348245923e-02   -1.828696338429967e-01   +9.318846340196456e-02   -1.319455567586179e-01   +2.011867769876213e-01   +7.033906647865516e-02   +2.069149690913506e-02   +4.293138136683933e-02   -9.428581657345916e-02];
L2I_L1I_iGABA_netcon = [+3.608598413602811e-02   -1.210433317197254e-01   +3.499262418200640e-01   +1.929584537534608e-01   -1.690643725728440e-01   +1.945049532956558e-04   +7.945068800309577e-02   -4.003773540355532e-01; -3.849360068634451e-02   +1.850961226278434e-02   -4.443035542072240e-02   +1.690367447877079e-01   -2.760988661543057e-01   +1.002667060606030e-01   -1.485583775138323e-01   +3.863486086605282e-02; +4.450363464665579e-02   -1.709527017564726e-01   +2.953749985602487e-01   -1.141287924102823e-01   +1.648166356871670e-01   -6.863283596521527e-02   -2.234393458457862e-02   -4.503610132119057e-02; +2.103984981674049e-01   +3.517956927466611e-01   +1.229457247958150e-01   +1.448216067671196e-02   +1.249020995767823e-01   -2.775250368578439e-02   -7.490986599702681e-03   -2.015754829587282e-01; +1.368981740352730e-01   -1.819996794092381e-01   -6.411659979644474e-02   +1.559594233612884e-01   +2.864676201244166e-01   -7.223426615764984e-02   -1.627692553570831e-01   -2.073825915076687e-01; +2.382136641652337e-01   +1.041181463506507e-01   -5.624684114439819e-02   -1.693129354664329e-01   +1.064934482983259e-02   +4.274526920856923e-02   +1.089936970521757e-01   -1.808669604572944e-01; -9.627734173328004e-02   -1.169074363969169e-01   -7.451460716861383e-02   +2.162156822433705e-02   -3.113835148993838e-02   -3.644231598181125e-01   -1.514852685948570e-01   +8.964994508681913e-03; +1.293375451410052e-01   +6.544551585432681e-02   -1.295394709911888e-01   -4.834248536064693e-02   +9.845962999032135e-03   +2.580725528473267e-02   +8.470145857067687e-02   +2.277513657063963e-01; +1.588834708919372e-02   -1.314275500285790e-01   +5.301547807108311e-02   -2.037765981377283e-01   +1.625563213583228e-01   -1.265712116288540e-01   +1.839904400225053e-01   +1.687246271426812e-01; -2.894140285096137e-02   -1.463513066020815e-01   -1.581811072319692e-01   -9.150394226537506e-02   -6.727657579171403e-02   +2.768460622133715e-02   +8.651721085740378e-03   -1.023588172780100e-01; +4.675001922577281e-02   +1.535759128411427e-01   +9.914699515033150e-02   +4.222994525787584e-02   -1.508572029408525e-01   -2.855836243910849e-01   -7.874829273969573e-02   +3.396539425788560e-02; -9.961751945284260e-02   +8.585869029883537e-02   +3.126534747256151e-01   -1.051888282942226e-01   +1.581422853978426e-01   -2.214806080737957e-01   +1.461678075928629e-01   +2.704853541438538e-01; -1.969109287148329e-01   -1.710898151034519e-01   +2.175685178009791e-01   -3.109562575357127e-01   -1.045817052693795e-01   +4.508662496308086e-02   -5.636759554831479e-02   -1.515127469697691e-02; +2.523929596674676e-02   -2.158591594057322e-01   -1.639409339299561e-01   +2.273575581624165e-01   -6.932731774378035e-03   +2.506152925609975e-02   -1.950864469594882e-01   -5.412809058536901e-02; +2.798805652771239e-02   +1.121680608298386e-01   +3.929243403144221e-02   +1.397678414639423e-01   +2.298061889119576e-01   -3.375603804829050e-02   -5.493224121474646e-02   -5.403383714645443e-02; +1.196370603060296e-01   -6.164216781687582e-02   +3.659579011491181e-01   -2.158668674724839e-01   -5.273812923598074e-02   +6.775587930030320e-02   +1.802420521690062e-01   +1.274188308065144e-01];
L1I_L2I_iGABA_netcon = [+5.702052133029877e-02   +3.761290724671452e-03   -9.440517262369831e-02   -1.055375670415756e-02   +2.126624035153669e-01   +3.414943251750592e-01   -2.336109372448511e-01   +1.875729552884722e-01   +5.257002143323761e-02   +1.766705629580603e-01   +8.449364883389854e-02   +9.225360923919104e-02   -1.632727661607008e-01   -1.055319085219754e-01   +3.513261121809111e-02   -1.589655319722412e-01; -9.961301863803258e-02   +2.273276847863333e-01   -7.177445363267719e-02   -8.716709987216126e-02   +4.602103783941153e-02   -2.045701634710010e-01   -1.527898590926372e-01   +3.150832278676918e-02   -1.449101014105104e-01   -3.282798204458667e-01   +7.462384321993776e-02   -3.057494181864801e-02   -3.191934580393586e-02   +1.657736694472874e-01   -1.756827663385869e-01   +7.263638500254629e-02; -4.511975861094037e-02   +8.787470375181344e-02   -1.545368725447661e-01   +3.506067601464508e-01   +3.495293941060088e-01   -5.949325086752235e-02   +1.038046016210258e-01   -2.589891310749186e-01   +2.227616285318824e-02   +6.945101274119399e-02   -3.373522409261324e-01   -8.009180596973434e-02   +1.023458433952135e-01   -3.690508022745928e-01   +1.581689531963080e-01   -1.184287073642284e-01; +1.034356974733282e-01   +3.257302001959599e-02   +5.884366287274276e-02   -1.457580059311719e-01   +6.978877988405938e-02   -4.024085089091516e-01   -1.243909088396073e-01   -2.768158001824485e-02   +1.209543529807349e-01   -1.500554264872752e-01   +2.140700156160939e-01   +1.445456095561208e-01   +3.591344367866679e-02   -2.351051813035372e-01   -2.144549004082916e-02   +2.668630268596001e-02; +1.062302594002912e-01   +8.336297309586016e-02   +3.548729849171566e-01   -1.516625325769754e-02   +3.405916739833499e-01   +2.208082842904864e-01   +5.465151612830554e-02   +1.503489981799140e-01   +1.232770866012574e-02   +2.793435099887145e-01   -2.345979162068802e-01   +2.560705791023487e-01   +1.108514081285119e-01   +2.131607797291428e-01   +1.499332481317143e-02   -5.653320240194867e-03; +1.818417506687230e-01   -5.731689749280108e-03   +3.940238863079660e-02   -8.173997152196734e-02   +1.070280963121852e-01   +2.032556578034581e-01   -1.420917797934098e-01   -1.086381812385702e-01   -1.033950463488707e-01   +1.133451323242021e-01   -1.335142350631172e-01   +3.088878297784866e-02   +3.352108094203405e-01   +4.352831852595002e-02   -3.679391657361844e-01   -8.080688387719598e-02; +4.026388973817280e-02   +4.953082083285110e-02   -3.498194952509966e-02   -3.640767044925540e-01   -1.019176270107207e-01   +1.453227257518182e-02   -3.404395960698904e-01   -1.276214079693418e-01   -7.382847201277055e-02   -5.649583251006659e-02   +7.921477478873989e-02   +3.885327101085318e-03   -3.923808405691070e-02   +3.537688444103761e-02   +2.089969326706859e-01   +2.081053635703719e-01; -2.573230804663506e-01   -1.196538701866156e-01   +3.748567617708198e-01   +1.117009994488813e-01   +3.638680063585362e-02   -3.060385490475908e-01   -1.085042548069510e-01   +2.220480301880141e-02   -1.713088203396735e-01   -2.358167469132267e-01   -2.603159833015294e-01   +1.418719163318850e-01   -1.635840204773399e-01   -1.249959740758666e-01   +1.224281834064747e-03   -1.758003965580822e-01];
L2E_L1E_iAMPA_netcon = [-9.521949042233518e-02   +9.504223157064387e-02   +1.158929557870885e-02   -1.046869298029491e-01   -6.201633069223463e-02   +1.234116036468495e-01   -2.313177884413731e-01   -1.802402752765110e-01; +1.223836855280643e-01   -1.181433905979474e-01   -1.382535034809315e-01   +4.467356530475067e-01   -1.354282392913848e-01   -6.266809264636236e-02   -1.267601277709716e-01   -9.585288380832019e-02; +4.591095542863907e-02   -7.634285324868191e-02   -6.748545229549228e-03   +5.060829460062416e-02   -1.584945548417883e-01   -9.391811734776084e-02   +2.620677305614483e-01   -1.270302318848557e-01; +1.333736084488933e-01   -5.522653653176777e-02   -1.211574730498707e-01   +4.297984842049007e-02   -4.016676105006529e-02   +6.086032460734481e-02   +3.215122024704107e-01   -7.309597300907883e-02; -1.834683582240783e-01   +6.619375862959984e-02   -2.622288630898179e-01   -7.454623357800622e-02   +5.927684622358299e-04   +2.203716247066508e-01   +3.846819509248720e-01   -2.292184126317046e-01; +3.826526872222631e-02   -2.482206024845394e-01   -3.116784338462725e-02   +1.507748335661317e-01   -1.220726700118156e-01   +4.273059821371969e-01   -4.561875365085211e-01   +9.460006483031058e-02; +6.650377830322263e-02   -1.385497234235173e-02   +2.032988774988076e-01   +1.422100335378894e-01   +6.678689734086912e-02   -9.929387366947592e-02   +2.430325113546910e-03   +8.006623430828178e-02; -2.895664664596737e-01   -2.007928930634523e-01   +5.561199083354862e-02   +8.306461514692048e-02   +3.503979430428270e-01   -2.477970582968162e-01   +1.929633784928790e-02   -2.492153927195202e-01; -1.891074402411210e-02   +7.788518286466958e-02   +4.541176939587203e-02   +7.185596415273843e-02   +3.508359640013270e-01   +3.982977133813157e-01   +8.720484447414360e-02   -4.939632823304003e-02; +3.312904297444985e-01   -1.307570916856107e-02   +2.713252066840797e-01   +2.769541697006134e-01   -1.098367631789038e-01   +2.686097265215902e-01   -2.710248328462583e-02   +2.169509535681843e-01; -1.662914358930646e-01   +7.216798523157779e-03   +2.734940910413252e-01   -1.440466391573782e-01   -3.744387906982003e-01   +2.182883869672895e-01   +6.220314447277171e-02   +3.556146940877719e-02; -1.283267056675775e-01   +2.656505225244096e-01   -3.363027095805727e-01   -2.871705521760070e-02   -3.124539317268573e-01   -8.408491598302664e-02   +2.113635998243319e-01   -2.150044629134017e-02; -7.028528249674676e-02   -3.707341465207948e-01   +7.143589059013331e-02   -4.688766053872830e-02   +2.097659587227932e-01   -1.902419115031466e-01   -1.772859616983140e-01   -1.247092091316441e-01; -1.123893801667657e-01   +6.783439194598725e-02   -1.999055576612709e-01   +5.202497982902531e-02   +6.856452723465831e-02   -1.816732756109044e-02   +8.233961238023371e-02   -4.073222538813549e-02; -1.732662734861120e-01   +1.681392982512088e-01   +3.011664115395124e-01   +8.470559215069290e-02   +1.149386994962872e-01   +7.822396908338158e-02   -3.477824905171508e-03   +9.604002796091606e-02; -6.910528286071826e-02   -8.191373600166295e-02   +4.698619101219156e-02   -2.317738187410218e-01   -9.884366806253658e-02   +2.560650020338952e-01   -9.734438151301041e-02   -6.570836198749055e-02];
L1E_L2E_iAMPA_netcon = [+1.495027961866113e-02   +2.208146586884774e-01   +1.675477116353111e-01   -2.703507247296142e-01   +2.759179817908095e-01   +1.784863436658145e-01   -1.347617969938550e-01   -7.740414551401927e-02   +1.010539089726136e-01   -1.016369468616291e-01   -1.310825302882594e-01   +3.344532259188693e-02   +6.708592113501331e-02   -1.632390055179459e-02   +1.382223347273687e-01   +1.875964362282072e-01; +7.904421839084705e-02   -2.724401511392959e-01   +2.511340331529263e-01   +2.933770139190479e-01   -3.097406375440192e-02   -1.569906316634455e-01   -1.250587392947145e-01   +1.056804689716653e-03   -3.852282794081215e-02   -2.544352161371179e-01   -1.817364792263945e-01   -1.624695538461921e-01   +1.863145185385836e-01   -1.500195733933087e-01   +1.527706803484504e-01   -1.127952312549218e-02; +1.727608843570150e-01   -2.042200311203421e-01   -2.675055711593223e-02   -7.577636183898301e-02   -4.133501802707708e-01   +1.827728368521225e-01   -3.176778247416912e-01   -1.484794405233930e-01   -1.599815233748514e-01   +9.590254761316476e-02   +6.227229782250894e-02   -3.987607229330937e-03   +1.779709414778175e-02   +2.935798383505013e-02   -4.374087147267261e-02   +1.821910687065700e-01; -1.804713460571833e-01   -4.062315518771167e-01   +2.377836753826213e-01   -1.586550978401615e-02   -2.128877543811815e-01   -1.901237051767949e-01   -1.508027113969250e-01   -1.125789073857140e-01   -2.217312179426621e-01   +2.259134567149734e-01   +3.257220264145674e-02   -1.543089991029880e-01   +3.339633384380834e-02   -3.445335716732274e-02   -1.127374181851437e-01   +1.151812989858860e-01; -4.009785200096927e-02   +4.089486198949520e-02   +5.520640574757295e-02   -8.586129184610360e-02   +1.839406080045409e-01   +3.791706354777464e-01   -1.468953836940796e-01   -3.719153270834689e-01   +4.170491853642485e-01   -1.095599965384477e-01   -1.255940661495429e-01   +1.017550452605668e-01   +2.704778201945729e-01   +2.557356340117143e-02   -7.050051069245358e-02   +4.851379306201674e-02; +1.251716930675705e-01   +1.178554201485789e-01   -1.922274771313826e-01   +6.309756159253271e-02   +5.828173088771357e-02   -2.419680215775283e-02   +2.996126756756048e-01   -2.689764649075789e-01   -2.543012423630637e-01   +8.755616520564397e-02   -2.162960183730804e-02   +1.942144894109104e-02   +2.317691413168475e-01   +1.705381427407060e-01   +2.157276734694767e-01   +2.948877427117943e-01; +3.285967452602332e-01   +7.681828648100893e-02   -1.447578591400172e-01   +2.404791004546834e-01   -1.654987890079125e-01   -3.646134877527003e-01   -3.373758325152687e-01   -1.734906419420077e-01   +1.314581935335629e-01   +5.919394008947575e-02   +1.987221531999709e-01   +7.026748997270489e-02   -2.270284643964004e-01   +1.516663067863307e-03   +1.568099315229020e-01   +2.337087988029386e-01; +6.306926122730207e-02   +2.105621469215300e-01   -8.035231813659152e-02   +1.673066127155074e-01   -1.509120752796942e-01   -2.710423620215204e-01   +2.311496215712499e-01   +1.382822357110812e-01   +1.673024336121250e-01   +9.415551270886599e-02   +2.267211685644990e-01   -3.512741196036584e-01   +5.328322667795954e-03   +2.381470623186985e-01   +7.705743950242896e-02   +1.125987846439641e-01];
L2I_L2E_iAMPA_netcon = [+2.580027214392512e-01   +2.239408361838952e-01   -8.412586812349999e-02   -3.524437746046858e-03   +3.231801037203668e-02   +4.918209803317446e-01   +1.641039562465067e-01   -1.545446885111202e-01; -1.833033330863165e-01   +2.218821410684685e-01   -2.108118022060899e-01   +1.838959570111511e-03   -5.682369655299439e-02   +1.336886253554870e-01   +4.091913362965804e-02   +5.875584096080595e-02; -2.820443011576153e-01   -3.530796741188905e-02   -1.857815000170877e-01   -1.383371142293548e-01   -1.572768634362351e-01   +4.538445958662999e-02   -2.294381741250421e-01   +1.364982626738978e-01; +5.720720460759254e-02   -2.967842299246745e-01   -1.489655008803656e-01   -9.519298556135680e-02   +1.105330534994907e-01   +7.939297050707973e-02   -8.059623385631361e-02   -1.398156172633320e-02; -2.510559948625766e-01   +1.009383189942343e-02   -1.533186276476954e-01   +1.487805903896578e-01   +1.599581862807747e-01   +1.683548806971079e-01   -3.481684046368525e-02   -1.063137191116057e-01; +6.609890613760235e-02   -6.567851912729403e-02   -1.663059259413147e-01   -1.879941147496133e-01   +1.014336765762915e-01   +2.030872641852180e-02   +1.008304438832447e-01   +2.176687454583711e-01; -1.722066120727100e-01   +2.648236179809540e-02   +1.972868547684190e-02   +2.198866797295357e-01   -1.460616700545262e-01   -1.903977619593515e-01   +1.630001169704254e-02   +4.310576660528727e-02; +8.332883201597072e-02   +2.277944879273247e-01   -1.522076144010807e-01   -2.226597153717957e-01   +1.554468801629694e-01   -3.010621182253280e-01   +1.222218296463476e-01   -3.272284520273051e-01];
L2E_L2I_iGABA_netcon = [+7.352203858875458e-02   +5.247641036935322e-02   +6.054312422732610e-02   -1.042078732073434e-01   -1.126476293139859e-01   -9.874204200540089e-02   -2.611261640549207e-03   -2.277635529030079e-01; +1.055192125739237e-01   -2.048844572605532e-01   -1.475880873023542e-01   +1.996257909455445e-01   -1.807605217083421e-01   +8.400519283890748e-02   -9.290316614746175e-02   -1.629457528054180e-01; +1.474821166989670e-01   -2.261904041880427e-02   -2.267978875756012e-01   -1.611673702091958e-01   -1.020129153997703e-01   +8.271596297190958e-02   +1.707116102346921e-01   +7.963370027203458e-02; +3.008567607281177e-01   -2.455812871314173e-01   +1.530606738083305e-01   +9.283303903826312e-03   +9.322887221019524e-02   -2.555569263076164e-01   +1.077692804450310e-01   -5.481672300534716e-02; -1.742431832641479e-01   +8.785404661457859e-03   -1.503168422429555e-01   -6.293071912117984e-02   +6.013406708509485e-02   -7.228317060812565e-02   +2.703134589428915e-01   +1.949149213836126e-01; +1.600707357629958e-01   +8.525678591910714e-02   +5.779024256845258e-02   -9.267118193138660e-02   +2.659704882714442e-01   -1.231985806797924e-02   -2.247461292569815e-02   -2.351740825821932e-01; -3.245725866177487e-01   -2.396571362258165e-01   -3.978439682121859e-03   -2.951983260960891e-01   -1.659862385228951e-01   +2.966677876667930e-02   +9.338914071609800e-02   -1.188329429643088e-01; -1.479338386627850e-02   +5.947810864142162e-03   -2.448086639045354e-01   -1.340522522620331e-02   +2.132610582237634e-01   +1.956300966514083e-01   +1.495643853044346e-01   +3.504913627100573e-01];
L3E_L2E_iAMPA_netcon = [-1.254155079824518e-01   -7.102413770602013e-02   +3.055858679906363e-02   -1.200739806904665e-01   -5.762583417496317e-02   +1.826766090094063e-02   -9.811341079545825e-02   -1.787669423948579e-01   -1.073887524091873e-01   -1.771393598084467e-01   -2.185388283021513e-01   -1.335920182482557e-01; +1.511211447648780e-01   -1.015007814312375e-01   -2.232371807344270e-01   +1.110847710872286e-01   +1.858517833695486e-01   +8.193613437948319e-02   +4.750016294402480e-01   -1.879958905655311e-01   +2.231587244770979e-02   -4.879695567722585e-01   -2.303473704130779e-01   +1.110136419426844e-01; +1.737114603266515e-01   -8.216089452085247e-03   +3.217858727037259e-01   -3.105319114303506e-02   -2.423115127672904e-01   +2.455939665624828e-01   -9.436327935117128e-02   +2.014794849068426e-01   -1.207556917646643e-01   -1.180637491440965e-01   -1.838135263026089e-01   -8.043429550245709e-02; +2.960649743192029e-01   -9.146373610840706e-02   -1.388534060587835e-01   +1.543241350302310e-01   +3.889984570597217e-02   -6.806347365268027e-02   -7.582745406484225e-02   -1.082236450314513e-01   +8.839242403138328e-02   -3.024134230153932e-03   +1.863510407303370e-01   +1.109856667755115e-01; -2.130886931148065e-01   -1.354832078037970e-01   -4.341379229691891e-01   +8.528172996362193e-02   -7.845709794101638e-02   -1.706048934831200e-03   -1.031683159166162e-01   -2.689567315386480e-01   -2.404437483501456e-01   +1.485091928344659e-01   +7.896164032702140e-03   +5.790334716504544e-02; -2.690098711498308e-01   +2.387669835390342e-02   -4.929491227843307e-02   +3.097472007398224e-01   -1.638636197740911e-01   +1.270246350537543e-01   -1.151170021640696e-02   +2.877490455254249e-01   -2.367298441908047e-02   -2.288944911590708e-01   -1.577270460229098e-02   -1.034473951164081e-02; -6.370082917827134e-02   -9.604798990822287e-02   -1.056298082144626e-01   -2.260823297690633e-01   +1.260704124776571e-01   -2.638019505720289e-02   -1.715480450769332e-01   -3.109918567648461e-01   +8.839360034898037e-03   -2.376161522788481e-01   -8.250570686911930e-02   -1.019184247386934e-01; -1.148324649165174e-01   +1.324596834305611e-01   -2.624175160366386e-01   -6.351217760298541e-02   +3.581081173284053e-02   -1.430159207737985e-02   +3.163888450117883e-02   +1.353202303970685e-01   -1.259481136751762e-01   +6.782693683076525e-02   -8.181056202995943e-02   -1.198976791226573e-01];
L3I_L2I_iGABA_netcon = [+1.577215180442016e-01   -2.231458669057789e-01   +3.692083910222858e-02   +9.148321608849069e-02   -1.586064428187381e-01   -1.137469830652828e-01   -2.188600044250650e-01   +2.436413505311330e-02   +2.127562157126782e-01   -3.086328137299754e-01   -2.783892937281869e-01   -1.103677314550325e-01; -3.852006155621337e-03   -3.709690037723962e-02   -1.550272257043650e-01   +5.834099110826971e-02   -3.810135501899235e-02   +2.141232817239909e-01   -1.533528060740715e-01   +3.363004916149070e-01   -2.739762410671255e-01   +9.948840428273742e-02   +2.442078404351730e-01   -4.484275817494756e-02; -2.700039809410958e-01   -1.521995303649816e-01   -2.068474096343157e-01   -4.208992734238819e-02   -2.637882572588342e-02   +1.445381467319861e-01   +7.020880954078663e-02   +2.791114814076277e-02   +1.259638366241653e-01   -1.474179371867505e-01   +2.756126606668172e-01   +1.455234678531985e-01; -1.302436049633793e-01   +2.187860745755708e-02   +1.708974462610058e-01   -7.817619568648054e-02   -3.995082709289082e-01   -1.359406681181087e-01   +2.892812304782405e-01   +5.601713639270295e-02   -2.887791305677682e-01   -1.301065454759553e-01   +5.325460998207922e-02   -9.904676534251566e-02; +1.056671175623490e-01   +1.517050287853684e-02   -2.477705792234220e-01   -9.008363068173526e-02   -2.306128487412070e-01   -7.284498394257852e-02   +2.670227441414491e-01   +1.090856547300531e-02   +2.951662033609208e-01   -2.158123554759776e-01   -2.057639972746440e-02   +3.929507109644313e-03; +1.849281377416624e-01   +3.596931717937096e-02   -4.437849239463135e-02   -8.191725766425637e-02   +9.095641304011148e-02   -1.289465977481916e-01   +1.748570086925901e-01   -1.178800593678564e-01   +9.257521617373116e-02   +4.132203720348890e-02   -2.656931686131412e-02   -1.552374424717376e-01; -3.012863757977438e-01   -5.985846803901766e-02   -1.660965097957281e-02   +1.445681469856162e-01   -1.483525815967116e-01   -4.010090708679766e-02   +1.691252136904254e-01   +1.000834244188569e-01   -6.412890102646449e-02   +1.100886858526117e-01   +1.437458993303344e-02   -6.946332484359127e-02; +3.571636262481910e-01   +2.043314156878172e-02   -2.964506913586097e-01   -1.789279943450361e-01   -1.417148358526246e-01   -1.717260785683478e-01   -2.519638487842461e-01   -2.746490340786921e-02   -2.203886795696626e-01   +7.107242338742796e-02   +3.247318358862709e-02   -4.002656441621885e-01];
L2E_L3E_iAMPA_netcon = [-7.951446808968346e-02   +4.251813470713786e-02   +4.480327782592222e-02   -7.666741885459051e-03   -1.353982432263137e-01   -1.450594793925271e-02   -6.842741628811666e-02   +1.585065953047997e-02; -1.100065493170420e-01   +1.385909741515104e-01   -1.706776004249085e-01   +9.860610912474378e-02   +1.714417846066371e-01   -1.757748723678187e-01   -2.948751848654534e-01   -1.265482758718795e-01; +4.640061029604509e-02   -3.422779760135383e-01   -6.613911741816750e-02   -7.641943432309123e-02   +1.215261855243001e-01   +3.424040120161211e-02   -1.120724772894510e-01   -2.669855048183944e-01; +1.872771819364185e-01   -4.237337429744786e-02   -1.777854048275898e-01   -1.729460112220969e-01   +1.152055712828189e-01   +4.576805624370600e-01   +1.432697180894124e-02   -3.979087022333587e-02; +7.671305040220323e-02   -1.151349116394047e-01   +3.123151050330990e-01   +6.510330702237695e-02   +1.679229461915095e-01   -3.746921129361867e-02   +6.094469034535084e-02   -1.247476622417374e-01; -9.351586725375936e-02   -2.624887892349559e-01   -2.541438878339470e-01   +1.566167921608461e-01   -1.437259491464506e-01   -1.164210902838315e-01   -9.490359916271934e-02   +1.276092730677335e-02; +6.165277144690447e-02   -3.826068646095164e-01   +1.429127951794127e-01   +2.002835257639098e-01   -7.055905884729949e-02   -1.867316815579197e-02   -1.608199400407261e-01   +1.870693168676359e-01; -1.233849958339987e-01   +1.225367931426308e-02   -1.722409110192046e-01   +4.947275511474912e-02   +7.161382788566331e-02   -1.803052683335978e-02   +3.173460147681262e-01   +1.362742896912633e-01; +4.167813952403528e-02   +2.689485745640676e-01   +2.457376508214228e-01   -2.548770279446199e-02   -1.384540944467847e-01   +2.054788928950226e-01   -3.376653106041767e-02   -1.018576215278820e-01; -2.684604079182773e-01   -1.827990459102279e-02   -3.216791608155286e-01   -3.993798635968062e-02   +3.470968889815990e-02   -1.623616959335069e-01   -3.470622600655102e-02   -7.483371122661987e-02; +2.680691331192560e-01   +4.826648743755801e-03   -1.416146739868691e-01   +9.078713609798164e-02   -6.544530992589491e-02   -8.185767386688199e-02   -5.435407783553977e-03   +7.364249773589306e-02; +5.334711068332798e-02   +2.925604558441995e-01   -1.767044675327847e-01   -1.118639288741990e-01   -3.475367903044476e-01   -5.619564556425945e-04   -2.362748648230085e-02   -1.640974980610510e-02];
L2I_L3I_iGABA_netcon = [+4.293666804373307e-02   -2.346004922673017e-01   +7.837287247627646e-02   +3.913826984946830e-01   -8.165494513216656e-02   +3.767273362561036e-01   +9.535047092981998e-02   -2.355453797627201e-01; +1.115188454775570e-01   +5.993850017659394e-02   +2.234008581833264e-01   -7.701127346431492e-02   -3.151435871350879e-01   +2.051387110533910e-01   -8.680337707722245e-04   +6.623416014795695e-02; +3.457457553504993e-02   +2.651676009424440e-01   -1.646462792102157e-01   +5.605613694677714e-02   +9.682082909228032e-02   +6.255023382144446e-02   +2.088303210752000e-01   -7.180554167807410e-02; -1.926821484218611e-01   +1.485705477098545e-03   +4.714986425755021e-02   -5.036297203710817e-03   -2.198287043302455e-02   +2.985020679209488e-01   -7.066701433413405e-02   +6.957159137568099e-02; +1.433233313542277e-01   +1.616516608854291e-01   -9.486941799936480e-02   +3.213883208379523e-05   -2.360612744059179e-01   +2.490455655762523e-01   -3.748280110373371e-02   +1.449156965163975e-01; +2.731514591335915e-01   -2.945163999836737e-01   -1.713479120835604e-02   -1.084414017526270e-01   -1.538201048175085e-01   +1.840628124390429e-01   +6.237655296049627e-02   -1.223168260022614e-01; -7.784798350587535e-02   -5.458489234798520e-02   +2.834445821208080e-02   +7.138211828950074e-02   +2.557556359383731e-01   -1.822752475832611e-01   +5.076649599820673e-02   +8.713748941144447e-03; +2.368277658421403e-02   -1.493530201136586e-01   -7.873959723992005e-02   -2.967072265233047e-01   +2.031393633062590e-01   +3.859670865204608e-03   +3.915114898541443e-01   -1.723972193848394e-01; +1.292533706233457e-03   +2.813415035033103e-01   -3.386456966436354e-01   -7.684700305059683e-02   -1.416349862266236e-01   -1.718666703644091e-01   -2.151880055474461e-01   +1.094296356483710e-01; +1.450321558516944e-01   -2.297094555446808e-01   -3.162278665960726e-01   -2.281987682596336e-01   +4.901031598447091e-04   +7.112717191527415e-02   -2.398536207479358e-01   +2.522698059913892e-01; -3.501005603067416e-01   -4.177260125924259e-02   +6.836807829063876e-02   +4.530826183043402e-02   -3.666582473598522e-02   +2.152131914011065e-01   -1.353619421942012e-01   -2.618448040427699e-01; +2.034591976064322e-01   +1.691431272972303e-01   -2.197560393660740e-01   -3.819296768426443e-01   -3.824455686653834e-01   +1.052786295330443e-01   +1.791529396338171e-01   +2.891409383013482e-02];
L3I_L3E_iAMPA_netcon = [-1.392575475797298e-01   +2.491467766630974e-01   -9.089775351393196e-02   -4.442910259903644e-02   +1.658748806843724e-01   +3.330668769425186e-02   +2.519679419379999e-02   -4.919894726972339e-02   -3.209642710376539e-01   +9.029889672455284e-02   -1.033801216925724e-02   -1.874273532070362e-01; -1.220002436568653e-01   +7.617169314442937e-02   -1.527748885021472e-01   +1.236789985675335e-01   -1.083710922340997e-01   +3.001464725027583e-02   -2.161882533347469e-01   +1.343726145732091e-01   -7.707751807690395e-02   -1.597647904908732e-01   +2.699674434640799e-02   -3.667800284081496e-01; -6.864083102102701e-03   -1.341073702384832e-01   -5.780675915572943e-03   +6.830714252559440e-02   +1.445035080480298e-01   +1.212803952149769e-01   -3.886024774477122e-01   +2.539309801527254e-02   +2.618881194495358e-01   -3.256233427372859e-02   +9.710187487658406e-02   +2.171596114023358e-01; +5.024780683011903e-02   +1.297061386335517e-01   -8.488618455664174e-02   +3.792063258400837e-01   +1.268517513881755e-01   -2.671210106888360e-01   -3.496194418899756e-01   -1.573729736820154e-01   -5.264907043650180e-03   -7.205271620284814e-02   +4.511686723893122e-01   +1.656781660348854e-01; -1.198364764543689e-01   +1.259005027570255e-01   +2.307406972884679e-02   -9.722911560131788e-02   -7.568494431812435e-02   +1.301793497050442e-01   +7.629038365703267e-02   +1.030420425858805e-01   -7.266369627778974e-02   +1.226033424210082e-01   +5.239511193404844e-02   +1.343296351842614e-02; +9.131253178040644e-03   +1.283829527412195e-01   +4.264511681348740e-02   -2.227026592400375e-01   -1.609400483006436e-01   -1.005074415721535e-01   -9.547637207039478e-02   -7.663862152878256e-02   -1.782202067373212e-01   +3.124533839778997e-01   +6.755011370378122e-02   -6.998930215982223e-02; -1.214516683505869e-01   -1.426573135795933e-01   -2.264690758466797e-02   +2.861174525760328e-02   -1.136020267150021e-01   -1.318445596072441e-01   +5.922415768371486e-02   -2.235171648510534e-01   +1.028072632754556e-01   -4.990390490208664e-01   +2.269205325951210e-01   -2.652351280980417e-04; -6.006704221302878e-02   +8.930581798638655e-02   +1.755746163454082e-01   +4.425783823241859e-03   +4.130671461692383e-02   +8.391772444150102e-02   +9.375418595511108e-02   -1.829018405776303e-01   +1.443246057969390e-01   -1.115948323715152e-01   -4.877013446616162e-02   -1.546661688122433e-01; -1.294617022712431e-01   +1.781832577107176e-01   -1.886088442370705e-01   -2.242274578768979e-02   +9.074660956496891e-02   +7.750668735349736e-02   +1.670466973021963e-01   +1.158446923528732e-01   -5.044078460758616e-02   -2.055655195446097e-01   -1.505808016245804e-01   +1.676465563183586e-01; +1.199936899761544e-01   +2.022438143186768e-02   +1.603072626708107e-01   +2.493838944662519e-01   +1.374458071694814e-01   -5.722570513403812e-02   +1.270744142553188e-01   -7.549515922276728e-02   +3.144067592788796e-02   -1.926229903651899e-01   +1.145786939494274e-01   +1.089127756127897e-01; +2.254078967247802e-01   +2.555042424603818e-04   -1.688107522205682e-01   -2.921354885630392e-01   -1.420961041898774e-01   +1.325968913246537e-01   +5.495169863217228e-03   +7.707112119458120e-02   +1.897382161282886e-01   +4.187834380606126e-02   +2.549825257399931e-02   +1.738157048646753e-01; +1.414367544810831e-01   +1.104679597237870e-01   -1.242157711169294e-01   -3.909208700896578e-02   -1.594042137168711e-01   +4.672546680825403e-03   +4.561927564665945e-02   +7.169749897920802e-02   +7.717653431780459e-02   -2.615388971105742e-02   -1.604209088538713e-01   +2.140471373628308e-01];
L3E_L3I_iGABA_netcon = [+9.763716143693024e-02   -9.439517788520774e-02   +1.243587081062560e-01   +7.907835560448057e-02   +2.167721849493672e-01   +9.170190289963948e-02   +1.022802932506813e-01   -1.177351913954661e-01   -1.784329519842832e-02   +1.006912180420453e-01   -1.643411217236525e-02   -4.327844672097327e-01; +8.825610102311890e-02   +2.105499877468333e-01   +1.379315360703177e-01   -3.013065373641792e-01   +1.518420839434714e-01   +7.437627311877365e-02   +1.806745522607228e-01   -9.906111875570164e-02   +1.076581868843468e-01   -1.193185130608096e-01   +1.812710629985462e-01   -2.221538263003521e-01; -1.654887570188663e-01   -1.568448093044657e-02   -6.363808777899603e-02   -1.451711965222841e-01   +6.670162299546264e-02   +1.787684953895982e-01   +1.229498104606895e-02   -3.167178152435528e-01   -2.320390086742100e-01   -1.891429386041498e-02   -1.526135631366771e-01   +6.187920181861174e-02; +2.913927476938759e-01   -3.387837541422970e-01   +8.914611220366755e-02   +2.573558760754773e-02   +7.144216757438308e-02   -1.181301325063278e-01   -3.849160207634952e-02   -4.235653356896733e-01   -6.274134092497329e-02   +1.300709474664048e-01   +2.255861292002602e-02   +9.568237701370676e-02; +1.379044622918851e-01   -1.393628877274837e-01   +3.387324448781959e-01   -4.589349756982631e-02   +2.366396151331256e-01   +3.113821133907472e-01   +1.937733751186385e-01   +5.946600876669152e-02   +4.206821945050772e-02   -2.165978244594609e-01   -2.708270400435707e-01   -2.687186023482651e-01; +1.919471111520596e-01   -8.764718744568564e-02   -4.061814753437918e-01   +2.022233452660321e-01   +3.388437670060844e-02   +1.905596063515889e-01   -1.875273114278042e-01   +2.162626614645435e-01   +8.649238398308083e-02   -7.562255511313970e-02   -1.497184035985927e-01   +7.155651030138679e-02; +8.210971268667111e-02   +5.020495476822268e-02   -1.303192404814923e-01   -2.985404231005048e-02   +5.697658336718269e-03   -8.902520245807331e-02   -6.518369543984179e-02   -5.205895778919910e-02   +2.197202190638803e-01   +8.125801431666052e-02   -1.910878804779342e-01   +1.033598766192221e-01; -1.190132550134499e-01   +2.685965232828640e-01   -1.514103693436494e-01   -6.392400711669532e-02   +1.984385029947215e-02   -6.804591392369547e-02   -1.780979734286069e-01   +4.110804132397765e-01   -2.073659546958367e-01   -5.167947569505753e-02   -5.157520109494237e-02   +1.562431442737454e-01; +1.500142754818872e-01   -1.003804354737339e-01   -6.493419505419964e-02   -1.704203079715689e-01   -1.789152842943683e-01   +6.932740235968646e-02   -1.144457229773571e-01   +3.392632487085726e-02   +1.975706879381803e-02   +2.606160293702532e-01   +1.772135675017172e-01   -3.550524475384161e-01; +8.215200247358623e-02   -1.297337138898162e-01   -1.074788187527082e-01   -2.678241725377598e-01   +1.786478123524353e-01   +1.052908382096754e-01   +1.602058294547938e-01   -1.574455879038160e-02   +2.400924468422771e-01   +4.532442841774311e-02   +5.645459029886567e-02   -4.529013291285181e-02; +4.173127308001387e-01   -2.238508124548287e-01   -3.649443320503454e-02   +9.975403582225185e-02   +3.354609509844292e-02   -6.532006101420870e-02   +1.358084592099381e-01   +1.435859062616936e-01   +4.427299345279590e-02   -6.778833461321186e-03   -2.249028284394369e-02   +1.157802312881244e-01; +7.800436007486866e-03   +4.553848501686505e-02   +3.099176820646539e-01   -1.779679714197684e-01   -1.234197257339092e-01   -2.130184993710578e-01   -1.032063136400548e-01   +2.591779610596863e-01   -5.600551364574051e-02   -6.316863830394713e-02   +2.848770035217476e-01   +1.226555184985377e-01];
L2E_Input1_iAMPA_netcon = [-3.103824702613363e-02   -1.388228836697993e-01   -8.209137335470484e-02   +2.852506768216765e-01   +1.542686648789328e-01   +1.936281880517105e-01   +1.772926149802195e-01   +2.414303758231445e-01];
L2I_Input2_iAMPA_netcon = [+1.909776095775058e-01   -2.528503960288145e-01   -2.417832080868482e-02   +2.926715548632107e-01   -1.855690327895109e-01   +1.533208905329119e-01   +1.051265930454667e-01   -3.356340748885828e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
