function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.495366633213788e-02   +1.296222103981939e-02   +1.867940922356307e-01   +2.314208471235173e-02   -6.244265446134394e-02   -2.669924635774178e-01   +6.117782667721716e-02   -1.486612167641285e-01   +1.124626150120482e-01   -6.750381975379301e-02   +2.088897485158948e-01   +2.542422963524785e-01   +7.494773480853106e-02   -5.023273517313077e-02   -3.838554279424791e-02   +2.347710078420107e-02; -1.344473566882098e-01   +7.864216902088590e-02   -4.905294530579604e-02   +1.590595482101164e-01   -9.911522586850223e-02   +7.666403948454986e-02   +2.969711918516600e-02   -2.565138861958985e-02   -1.992727737270794e-01   -7.973878831508412e-02   -4.119527715851721e-02   +9.059479820406019e-02   +8.674229758421054e-02   +3.489782581231284e-02   -5.579328183869080e-02   +1.571033889313672e-01; +2.463089136574500e-02   -1.332381723607499e-01   +8.602428900672658e-02   +1.373434574252458e-01   -8.147443777902896e-02   -1.012157281964698e-01   -2.192589989522003e-01   -2.421424078254251e-01   -2.085998225161823e-01   +9.996890455017140e-03   +1.817589947133605e-01   -6.357171845227733e-02   +2.318518174171794e-01   -2.017459198932615e-01   +2.426482570918454e-01   +1.464995744024434e-01; +8.731834914388523e-02   -5.239253803053022e-02   -1.839855408642124e-02   -1.754156044044264e-02   -1.065086335750650e-02   -4.832600146033907e-04   +2.204145795052116e-02   +7.659452713571949e-02   -2.425432560006533e-01   -1.149622080834128e-01   +2.086814992416308e-02   +1.835697379590094e-01   +2.181223736483203e-01   +1.007353303352807e-01   +1.702500925860990e-01   +4.853731641080132e-02; +2.427800087836936e-02   -1.682552209994252e-02   -2.075296738714408e-01   +5.960292277475221e-02   -1.937281514760857e-01   +3.066281043344048e-02   +1.594840741235715e-01   +1.973763855462314e-01   +1.808325432562387e-01   -2.371810459333765e-01   +1.093190271114571e-01   +1.373689466151793e-01   -1.538009594136380e-02   +1.225213721850562e-01   -8.396206438359292e-02   -1.766018044513103e-03; -2.960850218272082e-01   +2.222362191311377e-01   +2.175872005952852e-01   -1.211043900948984e-01   +1.742316209958929e-01   +1.272946314351057e-01   -6.332759500760770e-03   -9.563555624059736e-02   -2.109111465910617e-02   -1.615285056458461e-01   -8.193402397197352e-02   -9.452656930094092e-02   +1.789167574075126e-01   -1.619908041455017e-01   -1.957032851997178e-01   +1.871921456086006e-01; +4.722244738342590e-02   +2.309565034938281e-01   -2.675758800656695e-01   -1.895362136085077e-01   -2.225713362530790e-01   -1.190319984803928e-01   +5.614988806887888e-02   -8.049595865650748e-02   +1.186593781743950e-01   +2.187469697963976e-02   +8.076002788961245e-02   +1.238922121002570e-01   +8.666029804346584e-02   -1.255479978990069e-01   +2.214070923234900e-01   +1.005084285704262e-01; +1.919958311935335e-02   +2.604819457413750e-01   +2.233266515872208e-01   -1.533235726656383e-01   -4.326242968576137e-02   -6.671202465640083e-02   +1.876374948762310e-01   +1.655959402164416e-01   -9.902614016904124e-02   +6.164338660698174e-02   +8.275083634317923e-02   -1.304974140010430e-01   +1.483450154529258e-01   +1.455812837998442e-01   +8.645251589444372e-02   +1.648457770714008e-01; -1.277385315705554e-01   -1.519610271105924e-01   +2.943540419345321e-01   +1.941759905450797e-01   -7.136444507389311e-02   -9.565199347068334e-02   +2.411293181560495e-01   -1.635569481125209e-01   -2.412022973159366e-01   +2.233087809751698e-02   -2.799838749454160e-02   -9.551520290036550e-02   +3.222411499856477e-01   +2.306159506320158e-01   +2.235405670459842e-02   +5.057870924730482e-02; +2.205613239330819e-02   -1.463654153391417e-01   -1.343715981662528e-01   +2.745484733126187e-01   +3.153844028806550e-01   -1.294310125639818e-01   -9.987474186016616e-02   -1.627018752358093e-01   +7.649470142750828e-02   -3.334491141252002e-03   -1.318404936707140e-01   +4.078946470528834e-02   +1.939360098977982e-01   +2.965856434754394e-01   -1.330640095632242e-01   -2.867142845740974e-01; +3.026724592536724e-01   -1.585579197903520e-02   -4.974016379589326e-02   +1.678313670117837e-01   -1.046159855506261e-04   +2.900990197668588e-01   -9.636062551168216e-02   -2.778167738743830e-01   +1.531767328120553e-01   -9.751266104474265e-02   +4.879562768564506e-02   -9.171633358838760e-02   -2.293713877062976e-01   -1.400383275268411e-01   -2.629745029511794e-01   +1.529559955641297e-02; -5.494358390203321e-02   -3.075963186378193e-01   +9.514330756784295e-03   -1.255055631712735e-01   -1.096804879572965e-01   -8.422303667552383e-02   +1.292147681370581e-01   +1.479298845567222e-01   -1.829479576270310e-01   +1.138979419582892e-01   +6.741170316412162e-02   +1.170694410507148e-01   -1.742914057583897e-01   -7.849956383274612e-02   +1.500438134067811e-01   +1.304145374456441e-01; +4.672369637102830e-02   -3.279455336814287e-02   +1.821975812131546e-02   +5.260443468881979e-02   -2.221492506023602e-02   -2.094313139726289e-01   +1.418830829381860e-01   -2.080258059845936e-01   +2.808294328284524e-02   -2.803737111158175e-01   +7.818141228563960e-02   -2.220245594531155e-02   +9.047488028612699e-02   +1.827820081341089e-01   -9.828668106509371e-02   -3.600205486741435e-02; -8.630152655988473e-02   -6.615290589562958e-02   +1.183519633838030e-02   +5.909159635155790e-02   +2.779924245848052e-01   -1.677200311033306e-01   +2.302100235187039e-01   +1.033354754861562e-01   +1.363605597299073e-01   -3.926646901452121e-02   -2.746255546725957e-02   -1.495011412415245e-01   -5.067611400616726e-02   -1.843199007584964e-01   +2.887453108974029e-01   -8.999223627250685e-02; +1.149206671298835e-01   -4.505538708666330e-02   +3.874665146794336e-02   +7.530321933152627e-02   +3.004832052114800e-01   -1.932797489601580e-01   +1.778030331734680e-01   +1.980778602934878e-01   -1.595812214423044e-03   +4.642529731490534e-02   +9.239325042893735e-02   +1.111555397411665e-01   +1.335665931232526e-01   -2.930560842003497e-01   -3.629853685332152e-01   -3.285670827670867e-01; -1.771701999197239e-01   +4.915820339272402e-02   -1.990862415034000e-02   -2.619741555202465e-01   -2.200390166964357e-01   -3.205715712495208e-02   -1.653167254308126e-01   -2.617236718969115e-01   -1.410432042994307e-01   -5.480497674766567e-02   -2.264998207449831e-01   +1.577788490362202e-01   -1.248412453959821e-01   -7.433109542311003e-02   -1.338339918074772e-01   +1.378195213379931e-01];
L1E_L1I_iGABA_netcon = [-1.196428470016434e-01   +4.884931312662555e-02   -6.900083201678278e-02   +3.134405702408222e-01   -6.605202317933724e-02   -1.278398825413440e-01   -2.281130690622245e-01   -2.465641048614443e-02   +1.015303048328614e-01   -1.163327449098501e-01   -1.434173728461563e-01   -1.744177647696282e-01   +2.485070745168286e-02   -1.761943938007755e-01   -9.953584026685634e-04   -1.704699822501230e-01; -4.922688575315692e-02   +4.175669098430779e-02   -6.565679510757637e-02   +7.449607941360287e-02   +3.735407867189825e-01   -1.893657674370988e-01   -8.932123310578205e-02   -5.005633526412728e-02   +1.086869337588012e-01   -8.449323673879924e-02   -1.272080898021620e-01   +6.448693592468181e-02   +9.349711049569030e-02   +6.983770143771507e-02   -7.558850478696902e-02   -7.471260557495672e-02; -7.833814302754011e-03   +3.657771478501569e-01   -7.426302674239679e-02   +1.182572783673929e-01   -1.094941992234493e-01   +2.073984141741874e-01   -1.028879923723713e-01   +1.829706366588617e-01   -2.397959839655387e-01   -1.022028261496985e-01   +1.498181325371990e-01   -4.124414867402296e-01   +7.632186990224465e-02   -1.608232083298025e-02   +1.448014249103949e-01   +3.581698508387658e-02; +1.605876613657192e-02   -3.054042640156126e-02   +3.888958202791561e-02   -4.844810443923554e-02   -3.329421354948953e-02   -9.786516814770625e-02   +6.069125286392692e-02   +1.503041866248107e-01   -1.133990016093590e-01   -1.378445623889597e-01   +2.999464028615429e-01   -1.422152802662862e-02   -3.024104316793290e-01   -7.107599407622876e-02   -1.810732939085219e-02   -1.544204347250886e-01; -3.300710782718782e-01   -7.041644975149813e-02   -2.818912596049762e-01   -1.253502611159229e-01   +6.423463278136611e-02   +9.367265123783275e-02   +2.044168232000942e-01   +3.315943119577983e-01   +1.892346093998140e-01   +9.763420384000034e-02   -1.882976497313467e-01   -1.843833013961375e-02   +1.508295693928664e-01   +1.602643615413272e-01   -3.062738755319921e-02   -1.303634626650945e-02; +2.181467760112704e-01   +1.850170210324620e-01   +1.630043855736934e-01   +6.150914019210396e-02   +3.723235321766627e-02   +3.009059715634813e-03   +2.451051693712147e-02   -5.941421693544012e-02   -6.804071152615797e-02   -2.740352492165026e-01   -3.480796021235255e-02   -1.134557206548860e-01   +3.854388575873874e-02   -9.081408835919904e-03   +1.209111011839709e-01   +8.729393122127141e-02; +5.109765266463054e-02   +7.407325499859641e-02   -1.697228811354460e-01   +1.786502670080692e-01   -2.745345962078087e-01   +3.019528027666141e-01   -1.450231839353818e-01   +8.244660846914632e-02   -1.156109372294868e-01   +1.010997088874928e-01   -7.546395592707211e-02   +7.542168170479369e-02   -1.417930357293877e-01   -1.036253007731634e-01   -4.760899309383679e-02   +1.837478210326868e-01; +1.409185558940118e-01   -9.259225772401110e-02   -2.126850698446446e-01   -1.658345494666577e-01   -1.552209446865585e-01   -6.971944074044642e-02   +1.212889330482305e-01   -9.683408062271120e-03   -1.328901959718947e-02   +2.133155784266745e-02   -4.342796239038245e-02   +2.026934726324452e-02   -7.535559289240647e-02   +7.679506444239265e-02   +3.652972921262787e-02   +2.585616762982519e-01; -1.915869834678948e-01   +9.256260991094679e-03   +2.027502836993905e-01   +9.506981413044388e-02   +1.262563445743437e-01   -8.698031407018321e-02   +1.571199095294768e-01   +1.812207457384058e-01   -2.033094322580761e-01   -2.697714679078239e-01   -1.756061556550391e-01   +1.149496613019988e-01   +1.194113118963466e-01   +1.893655961358032e-01   +2.570249834035688e-01   +3.380619796002381e-02; -1.242153902113874e-01   -1.728464362231815e-01   -1.802207546999119e-01   +3.850809951702215e-01   -1.463339811226972e-01   +2.664051180580997e-01   -1.124738334414421e-01   -6.529218521278228e-02   -1.327531933408869e-01   -1.630420192322831e-01   -1.869016357645761e-01   -8.983185980535445e-02   -3.216911410221646e-02   +1.669386167263683e-01   -9.347460431421101e-02   -1.752046712194390e-01; -2.823558958549803e-01   -2.659734921241833e-01   -2.980747900235144e-02   -1.891569320925239e-01   -1.474245784158049e-01   -3.388866646616756e-01   -2.891005121890617e-02   -1.248790929766515e-01   -4.195473520499291e-02   -1.245841606934168e-01   -6.085607944172841e-02   -1.565939981598800e-01   -4.344204350377045e-02   +7.827130317183403e-02   -4.930078516679305e-02   -1.273774464537504e-02; -1.893782435153566e-01   +3.132087793590991e-01   -1.109113384287637e-01   -1.498900796306911e-01   +1.773394769631046e-01   -3.981041507107460e-02   -1.178658252130065e-01   -1.588991178284150e-01   +2.243189732747438e-01   -1.751606643516821e-02   -2.196893372237436e-01   -1.562692278937184e-01   +8.077913892598071e-02   -7.508136849681547e-02   +3.158666146434969e-02   +1.356185008107822e-01; -1.043271779901521e-01   -8.243591532413268e-03   +5.166268913411028e-02   +1.465229460322681e-01   +1.032501056966991e-01   +2.199250496904832e-01   -3.015910342264830e-01   -1.331662830436994e-01   -1.597763221692224e-01   -2.529326186600325e-02   +5.364670421031920e-02   -3.057878820930664e-02   -2.569662115263078e-01   -1.896784207937434e-01   -2.026643322924988e-01   -7.790073789055070e-02; -3.077576831757796e-02   -1.881009077165606e-01   +6.661284814762390e-02   +9.700145343248628e-02   -2.387869750919498e-01   -1.558977235927300e-01   +2.833767121822074e-03   -1.183195414105704e-01   +1.613158555488013e-01   -9.748675346934871e-02   -1.446206848756731e-01   +7.518218603371830e-02   +1.173763108412081e-01   -1.231450811317709e-02   -2.941560655732021e-02   +1.214633379346530e-01; -1.156294624094078e-01   -1.519668010873395e-01   +6.075447254945875e-02   +1.331293061890389e-01   +5.985302381266611e-02   +9.344941457163007e-02   +1.732511676007201e-01   -1.140705469523433e-01   +1.696924887492066e-01   +1.000249109023615e-01   -5.759056537902692e-02   +5.479983814240372e-02   +2.525627569597863e-01   -3.149043599195233e-01   -2.406868065682031e-02   -2.419703722954089e-01; +1.334822106295217e-01   +2.262121180324902e-01   +3.144107155098161e-01   -2.639342440625163e-01   +1.159139883457538e-01   -2.449731633174250e-01   -2.351986586517118e-02   -6.851066609536982e-02   -6.060737750473107e-02   -1.505790910419558e-01   +7.439687864536065e-03   -1.102132654013900e-01   +2.390724059441956e-03   -1.383744443276086e-01   +5.857600712780217e-02   -1.064095437610868e-01];
L2I_L1I_iGABA_netcon = [-1.382934015984232e-02   -1.160820673100734e-01   -2.350757486710510e-01   -1.694230641754007e-01   -1.120286191563060e-01   -7.455298853391516e-02   +1.596536768960656e-01   -1.716729834798367e-01; -1.280379847069785e-01   -1.281755956207823e-01   -1.509684351789443e-01   -5.823738887639947e-02   +5.347044575790424e-03   -1.842963005317637e-02   -3.523508002092206e-03   -1.070041062479273e-01; -1.896692877852537e-01   +6.777380052387695e-02   -1.202411481432352e-01   -1.420755585701549e-01   +2.927752412131280e-01   -6.743208788186285e-02   -1.846468536524597e-01   -2.364559478740458e-01; -3.437612086490482e-01   +1.160979068456015e-01   -3.716673353317508e-01   +4.768287915435886e-03   -7.328016487898495e-02   +2.376510732333116e-02   -2.649526075169583e-02   -1.554331212664329e-01; -1.288161571832472e-01   -9.801169238741927e-02   -1.270684654286115e-01   +2.445048600736967e-01   +3.068684901517801e-02   +1.564610110260954e-01   -6.048949324395111e-02   +1.863874285224682e-01; +1.962929722023761e-01   +6.351940695532566e-03   +1.453955177548774e-01   -1.402245851460409e-02   +2.414415828055810e-01   +1.446129261428084e-01   -2.092228660043072e-01   -3.565310888151364e-02; -2.139815113848808e-01   +1.349325433625007e-01   -2.284555419115746e-01   -7.082463119453833e-03   -1.112574536899174e-01   +3.436274747100118e-02   +1.592977288415297e-01   +6.473552020740951e-02; +8.463479586172640e-02   -1.111946434828406e-01   -2.088006102603272e-01   -6.183535470866301e-03   +8.607399683415470e-02   +5.497844715604334e-02   -1.790889670366428e-01   +1.330911571092854e-01; -2.863572468014314e-01   -1.555614970792946e-01   +1.263897784774303e-01   +1.926076046020258e-01   -1.140018245260770e-02   -1.974328390122633e-05   +1.847723126582499e-01   +2.180931617882200e-01; -1.551880887786525e-01   -4.945645123368286e-02   +3.008482320360325e-02   -6.637491670735488e-02   -1.495958272005609e-01   +3.388671837252500e-01   +1.262327641233185e-01   -1.741763752192513e-01; -2.402581778914582e-01   +8.845459856045780e-02   +4.962747824247306e-02   +4.550347626177218e-01   -2.130249572169041e-01   -2.016993956769353e-01   +4.031765165882044e-02   +1.595491800884993e-01; +1.248425858452781e-01   +1.171735435523232e-01   +4.229687361341881e-03   -1.138914051066030e-01   -1.302746073895764e-01   +2.407465066727030e-01   -6.008649096653114e-02   +5.962768532287950e-02; -3.652627686389264e-02   +6.251572211448676e-02   -9.348390711008644e-02   +5.779345177652084e-02   +1.143770565692086e-02   +3.169223427073898e-01   -2.969178867690034e-02   -1.287831645897639e-01; +2.913717207341110e-01   -1.441727040028706e-01   +7.490381222183307e-02   +1.853703190143976e-01   -2.293129916692605e-01   +9.702447526197196e-02   -2.167314630908148e-01   +1.841460267890375e-01; -4.054126301408759e-02   -2.277073062243322e-01   +1.429787212134149e-01   -1.696794341418198e-01   +3.254552269112517e-02   +2.598205298353331e-01   -1.100104534478259e-01   +1.144532074806833e-02; -2.941359821367254e-01   +3.534994120314779e-02   -7.124566858508076e-02   -1.197673084700857e-01   -4.545207995457055e-02   +1.970830572155753e-02   +3.765680988169830e-02   +5.417315187164921e-03];
L1I_L2I_iGABA_netcon = [-6.378855937223990e-02   -1.241008492712692e-01   +6.386025519102687e-02   -1.334762218639743e-01   -2.109005163539222e-01   -2.287999977926133e-02   -5.718596131201557e-02   +3.301219017353796e-01   +2.069707301850264e-01   +3.589738660525182e-02   +5.765117721217027e-02   +1.644067662782972e-01   -8.778613105288532e-02   +1.103771458364569e-01   -1.615170370865025e-01   +4.445125700108098e-03; -2.702032447663252e-01   +1.133900680681838e-01   -1.490959032197210e-01   -3.963836009785082e-02   -2.084437088496205e-01   -2.571273848041631e-01   -8.857023176102385e-02   +2.533716342184654e-01   -1.333854454087144e-01   +1.131178783705002e-01   -2.665294391684133e-01   -2.991593535264815e-01   +2.144897528053175e-02   +2.061708944486582e-02   +1.190692909217495e-03   +9.108599020322246e-02; -8.840483241529531e-02   +8.846375763607328e-02   -1.600594447643176e-02   -1.512473320418670e-01   +2.298274017695711e-01   +9.650814033088662e-02   -3.991994256455531e-02   +4.746828908398543e-02   +7.133672726565903e-02   -1.219893062706572e-01   -1.464345331273847e-02   +1.303083039438276e-01   -2.590900084849405e-03   +2.070729394090261e-01   -5.193611705201026e-02   -6.274863267181707e-02; -1.135342000386155e-01   -1.799048349747287e-01   -4.318874578452155e-03   +1.278476316797558e-01   -3.464453293336314e-01   +2.929680251080292e-02   -1.396310909710502e-01   -2.874021410232262e-02   +1.360122516240942e-01   -2.607667833141760e-01   -2.435216137145359e-02   +1.413092778332870e-01   -1.405943849847622e-01   -1.517531121896645e-02   +1.506335042313327e-01   -3.510344201032420e-01; +1.478676349990480e-01   -1.006928568451105e-01   +9.255338066754414e-02   +9.146439480064966e-03   +5.381013615894661e-02   +1.184018617270068e-01   -2.098350928774311e-02   -1.952439339554512e-01   -1.356096092433565e-01   +5.590782094438920e-02   -3.101343004341924e-02   -2.645429064195812e-02   +1.089747369169393e-01   +1.023464959072195e-01   -7.268447845491890e-02   -2.661728151241521e-02; -2.977328993444897e-01   -1.366025664919071e-01   -5.576050147446580e-02   +6.692823656523755e-02   -7.344686541437399e-02   +1.544197573544428e-01   +9.691215750548601e-02   +2.470905460794420e-01   -1.478687211145341e-01   +8.176510722001644e-02   +4.908706520544152e-02   -5.659361526100376e-02   +8.358116360305148e-02   +1.988534340777398e-01   -1.229231197378560e-01   -3.216744809490055e-01; -2.504759371720544e-01   +7.636581171824981e-02   -8.184098410570957e-02   -1.010444921298392e-01   +3.145340250893933e-01   +2.132702071739335e-01   +7.801516378790360e-02   +3.161339494996016e-01   -1.590809535288767e-01   -2.758576838835218e-01   -1.165520519062175e-01   +1.954185931355498e-01   +1.224063895174163e-01   -1.729706771706976e-02   +1.736936818327574e-01   -9.538656964610532e-04; +5.356330399417436e-02   -1.799842552241740e-01   -1.488009118746862e-02   +4.886978662850494e-02   -1.369307791723222e-01   -1.693182311795121e-02   +1.203350029537978e-01   -6.716023845472217e-02   +1.202538702687659e-02   +1.562760591290120e-01   -4.169303499301987e-02   -2.647342089089313e-02   -9.726737933134605e-02   -8.245406300276042e-02   +2.247849046776881e-02   -1.993004260969159e-01];
L2E_L1E_iAMPA_netcon = [-2.904535026925703e-01   +1.779197184691597e-01   -8.709824270742167e-02   +2.476623997700056e-01   +6.118256032489909e-02   -3.249865207790794e-01   +4.481105949528442e-02   +5.943779499513685e-02; +3.176921367160016e-02   -1.122472273610107e-01   -6.900103909028002e-02   +2.826021598844801e-02   -6.901444485190991e-02   -1.396302428309691e-01   +1.537786990456382e-01   +4.581198281633879e-02; +2.818861618964990e-01   -2.175657446796856e-01   -2.035568771248894e-01   +3.576378055715718e-02   -1.638149854253919e-01   -1.288368402726414e-01   +2.008173734190025e-01   +5.245053317068672e-04; +9.904562500868851e-02   +2.410899928508405e-01   +6.571270357916545e-02   -5.371296248941135e-02   -9.798857626906587e-02   +2.441927631934094e-01   +1.876341839748245e-02   +5.133262257138339e-02; +1.239883679600231e-01   +1.190203922961527e-01   +5.456091542236882e-02   -9.226924983248808e-02   -1.920515700540860e-01   -6.461903138647028e-02   +2.694549802577710e-01   -5.334664616273042e-02; +1.500448769968101e-01   -2.347824603762792e-01   +5.137071994697519e-02   -1.562966794059726e-01   -1.331675292773293e-01   -6.267615121874577e-03   -7.670615658466040e-02   +2.623044816159261e-01; -1.344838967287120e-02   -7.205177828484864e-02   -7.930879662833207e-02   -9.056741855883352e-02   -3.469051342966618e-03   -1.689068369381698e-01   -9.102973560798985e-02   +2.843685152281670e-01; +2.748683578211109e-01   -3.769093752434248e-04   +1.385686694209246e-01   +2.970337138966134e-02   +2.402057602551015e-01   -1.717397437294435e-01   +2.107634566285635e-01   +4.840407849999756e-03; +2.241913823954553e-02   -4.190125737521594e-01   -9.871696610563786e-02   +9.862879640514689e-02   +1.453775473463915e-01   -1.584542039278660e-02   +1.581180440863488e-01   -2.957474940382959e-01; +1.502240448396113e-01   -2.074238506806809e-01   -1.230120416164452e-02   +3.736507176514663e-02   +1.314275120252553e-01   -1.309938582807267e-01   +1.057095234771717e-02   -9.664818235022705e-02; +1.701915811734389e-01   +6.463065661363906e-02   -6.369756661347309e-02   -9.343349025239639e-02   +2.861269016228413e-01   -2.178250178220012e-01   +2.336944652546477e-04   +4.065188030060485e-02; -5.463532253904128e-02   +4.365702711806208e-02   +2.986137038588794e-02   -1.735804863634295e-01   -3.239572927786920e-01   +8.645889657673626e-02   -1.357451873110642e-02   -1.897661417452276e-01; +1.415043976681631e-01   +2.453657453491193e-02   -3.928865400167150e-02   -2.486429612964975e-01   -1.130425896403261e-01   -6.385265860543900e-02   -7.294240501834037e-02   +2.746549630788519e-01; -2.180402477683397e-01   +1.624445571052866e-01   -1.394611823580265e-01   -1.691727093055796e-01   +1.330855417760771e-01   -1.548381870581002e-01   -3.926579444426436e-02   -1.240549700773132e-01; +5.565672896755899e-04   +1.007926547932222e-01   +1.667272508592017e-01   +1.898048785690349e-01   +7.909016693017336e-02   -2.140474855490774e-01   -3.944491894792430e-02   -6.106904650869912e-02; -2.045012623377520e-01   +3.027898200689809e-02   -7.763353348095116e-02   +2.426207974333144e-02   +4.885009519067212e-02   +3.131710252732403e-01   +5.205310548673819e-02   -1.511222801956296e-01];
L1E_L2E_iAMPA_netcon = [-1.142562387692550e-01   +1.563042885127905e-01   -1.795828146611168e-01   -4.031629098207944e-02   +7.438688742576532e-02   +1.968059701555487e-01   -1.638907252797484e-01   -8.814610240754532e-02   -1.312400881488029e-01   +5.228011926812820e-02   +3.212935631650204e-01   -1.536766669371538e-01   +4.604361946459678e-03   -7.381874044133838e-02   +1.216389515144407e-01   -2.606316638949889e-01; -3.396680665490094e-02   -2.397683029104529e-03   -1.327920971508280e-01   +9.550689627175372e-02   +2.505903781898053e-01   +3.202799788950043e-02   +4.123156115358448e-03   +2.374341093717595e-01   +1.849483129446498e-01   -1.353009670583558e-01   +1.716356133943163e-02   +7.772968609582068e-02   +2.259229757473306e-02   -1.544670120173777e-01   -1.368603122797822e-01   -2.411024450762259e-01; -1.094207001995465e-01   +3.747860103053591e-02   +1.135832615794299e-01   +8.132532769874257e-02   -1.124653440753757e-01   +6.636968344989171e-02   -9.626499924101585e-02   -8.664006856296289e-02   -2.237213570304940e-01   -1.111080271812819e-01   +1.369779904508182e-01   -1.049232944370259e-01   -5.115358126956374e-02   +3.186950494418689e-01   +1.187925609319962e-02   -2.637944227930319e-01; +1.782588638600366e-01   -9.358495349324990e-02   -1.065236017909819e-01   +1.847674978167735e-01   -9.415522322725228e-02   -4.225211090396417e-02   +4.270190405251809e-02   -3.683459493315265e-01   +4.590550006204405e-02   -1.874386555348558e-01   -1.010724192388435e-01   +1.330397396364586e-01   +3.806980186180273e-02   +8.442358944131134e-02   -2.590712122466671e-01   +5.586915099950710e-02; +3.063987091980718e-01   -2.205056683241998e-01   -2.980237881676611e-02   -8.991345287313851e-02   -3.150143125384658e-02   -4.467739749818701e-02   -1.648311422973527e-01   +2.679070169624552e-02   -1.646017846994388e-02   -2.789095693445469e-02   +1.396979100024600e-01   -1.618948084255675e-01   +9.190278140057521e-03   +8.271958276754715e-02   +1.868435925561663e-01   -1.787870315043917e-01; +2.053791387738174e-01   -2.341666415932355e-03   +5.598578366753580e-02   +2.141346417190748e-01   -4.604011596455257e-02   +2.598338507816488e-01   +7.194744856510961e-02   -1.296686924755158e-01   -3.735748189404765e-01   -1.217158799853466e-01   -3.484551719783288e-01   +1.322003630568312e-01   +1.539687013887669e-01   -3.095803847157148e-02   +1.582091507419035e-01   +3.513996896181146e-02; -2.507014073841516e-01   +1.330594167196138e-01   +1.722721737665896e-01   -4.822897105746908e-02   -9.589778433693701e-02   +7.823757660499436e-02   -1.699724591068089e-01   -1.602233386360659e-01   -1.094946336075173e-01   -1.521010289018617e-01   +1.698510983297068e-01   -4.475097371793035e-02   +1.865849490388253e-02   +1.772236880658366e-01   -5.005449719685724e-02   -5.757591266391474e-02; -1.363400698096891e-01   -1.528023741265142e-01   +3.528087115285754e-02   -4.161325008137239e-02   -9.678989943387308e-03   -9.975016871664444e-02   -2.358237344577980e-03   -4.889087320598760e-04   -7.154229061075747e-02   +1.102097750277087e-01   +1.853004945128413e-01   +1.670731067142581e-01   +1.259587250741175e-01   -2.337992186881547e-01   -4.936396628943802e-02   +2.343378202153955e-01];
L2I_L2E_iAMPA_netcon = [+3.531770374251409e-01   -2.185836879855068e-01   -1.610614191762788e-02   -2.091158904930285e-01   +1.023626014029637e-01   +9.164959390323724e-02   +2.589445455776450e-02   -1.125142861700622e-01; +2.046030632505423e-02   -1.924307009836785e-02   -9.831984340438948e-02   +1.570319670092844e-01   -2.097414243065089e-01   +1.078970462642001e-02   +2.629916644270534e-02   -2.505080502870935e-02; -5.583850188485208e-02   +7.976714838164128e-02   -6.382673761947465e-02   -6.219175281897009e-02   -2.506074689688831e-01   +1.649377476577478e-01   +8.659242775304853e-02   -2.969815866388817e-02; +1.359338299099559e-01   -1.375805742506726e-01   +2.453173497187919e-02   +7.253570312533028e-02   -9.326742222529463e-02   +1.499207153654688e-01   +9.410795758007916e-03   -1.251197990771930e-01; -1.569432376887550e-01   +1.932568944618709e-01   +6.853542348007514e-02   -1.830567301445838e-02   -1.700135379494427e-03   +1.301447100684633e-01   +3.733691175308593e-01   +3.208236357306438e-01; +5.782290274629460e-02   -1.450387962721441e-01   -1.156228384736572e-01   +3.020624262143285e-01   +1.127664028389661e-01   -2.524601225373820e-01   -9.454989926561615e-02   -4.575768489398939e-02; -1.902427924900500e-01   +9.757941168171620e-02   +1.082890758947895e-01   -1.469654591969015e-02   -1.550146162167125e-01   +1.037019869856028e-01   -9.432367341896059e-02   +9.033054997525611e-02; -1.647003821301972e-01   -9.535138750425898e-02   +1.928746256735173e-01   +9.330209187737096e-03   +1.457418097087254e-01   -7.428671747675863e-02   -1.095072279808289e-01   -3.928804225092216e-02];
L2E_L2I_iGABA_netcon = [-4.580050830981100e-02   -1.150707049626249e-01   +1.520611573582629e-02   +1.740429592899620e-01   -4.982249995323765e-02   -4.147704685932085e-02   +1.586355492711601e-01   -2.196859688591242e-02; +1.972450460935760e-01   -2.911436860352298e-01   +1.847245222748073e-01   -8.968838906292975e-03   +1.466850731473457e-01   -8.564399695081511e-02   -5.075034670647886e-02   +2.930763221550546e-01; -3.243183189409908e-01   +3.541414118401071e-01   -6.873789324529767e-02   +6.782710600176096e-02   +2.089298073258342e-01   -1.465242336785733e-01   +1.713851794349577e-01   -5.141773861674168e-02; +1.915374545613677e-01   +2.875816722904411e-02   +1.397817308299469e-01   -2.659836364446591e-01   -7.931475073046689e-03   -1.592056026948437e-01   +5.382914578832690e-02   -8.890499503062244e-02; -1.342791313871999e-01   -2.415369216168679e-01   -2.268042256213461e-01   +3.636310239770518e-02   +3.199296273534166e-02   -2.518675666488370e-02   -1.117846209776140e-02   +7.201087511140532e-02; -3.379776297346242e-02   -2.820068591198638e-01   +1.543570690590029e-01   +6.423152675161614e-02   -5.572543012566688e-02   +7.598687918966660e-02   -7.642174857838890e-02   -3.777614497430806e-02; +7.972784426204250e-02   +2.853864645081836e-03   +2.160815487700791e-01   +1.641035406317105e-01   +1.624166081894416e-01   +2.279513791306150e-01   +1.171126912422237e-01   +7.020675084978042e-02; -1.581614654163010e-01   +2.516122664078184e-01   +3.882259487189396e-02   +9.977181199815877e-02   -1.177551431342674e-01   -9.240608139283604e-02   -9.956989503730998e-02   -5.346752076209110e-02];
L3E_L2E_iAMPA_netcon = [-1.792490494673749e-01   -2.890838825591758e-02   +6.800874289266054e-02   -1.279039442317297e-01   +2.636454999146604e-01   +4.877613371110274e-03   -4.982013752105457e-02   -1.039668808047259e-01   -2.279805413800133e-01   -2.204538085816024e-02   +1.736071040602168e-01   +1.130768581169797e-01; +1.222643103096656e-01   -7.850412121586134e-02   +1.379419844443433e-01   +4.645529731246538e-04   +2.278362118700458e-01   -1.817072215310676e-01   +5.572412559510489e-03   -2.218486205335955e-02   +1.751685024249926e-01   +1.849277751544792e-02   -1.870571606683894e-01   -1.560454013136622e-01; +1.479283025184950e-01   +7.404585826728780e-02   -1.358177512084503e-01   -5.339194758941797e-02   +1.889535921403120e-01   +7.698695339353377e-02   -1.259930318699411e-01   -9.076472909993871e-02   -1.783817108968066e-01   -1.555585455996267e-01   -1.872536380255148e-01   -1.131864411236354e-01; +1.157310439484920e-01   -6.180439307485819e-02   +1.374006220260941e-01   -1.318025996429170e-01   +1.084080028878489e-02   +2.693550081188579e-01   -5.481673990657757e-04   +2.325658342442694e-01   +2.854735391045024e-02   +2.411892662488297e-01   -1.799544305497457e-02   -7.973956217907884e-03; +2.347851210866064e-01   +2.261632794301453e-02   -2.522381444878231e-01   -2.263901547479006e-01   -3.470379167503434e-03   -7.690576338222690e-04   -3.962060951739511e-02   -2.264414558357384e-01   +1.524177720808136e-01   -4.060225746269371e-02   +5.256339628646437e-02   -1.732637940670497e-02; -3.165293146742446e-01   +2.891587932285791e-01   -1.036507687847014e-01   +7.027123142424195e-02   +1.718906733564922e-01   +1.379817831187803e-01   +1.253614831579694e-04   -5.052222075430457e-02   +5.265678137432097e-02   +8.006380191099019e-02   +2.132485797176029e-01   -1.596896599616724e-01; -9.467863470465561e-02   -1.603411768023648e-01   +6.292016003961762e-02   -2.183425274875890e-01   +3.229650101155970e-01   -1.807945175203353e-01   +1.593128610634469e-01   -8.881631663123569e-02   -6.666222751834741e-02   +1.107490378131217e-01   +7.221376760857545e-03   +2.437394758884591e-03; -2.884465330087557e-01   -1.859143400154530e-01   +7.595605878541339e-02   -6.142139708148218e-03   +7.563005993570684e-02   -4.286730900050911e-02   +1.397375087110434e-01   +2.067609472141134e-01   -2.380536468305153e-02   +2.174841791449728e-02   +1.491409351638959e-02   -3.224508790012916e-01];
L3I_L2I_iGABA_netcon = [+1.612304628533943e-01   -9.990126591681127e-02   -7.878916705160346e-02   +3.011301229964031e-02   -1.751164282126678e-01   +1.220595014944564e-01   +8.225715356247500e-02   -3.561208769759451e-02   +1.164053569864025e-01   -1.514239555183629e-01   +1.206412226676817e-01   +7.919400355306096e-02; +2.447496171807278e-01   +1.678001882127279e-01   +3.622319469994219e-02   -1.301540822306831e-01   -6.198547649935302e-03   -8.824025403740726e-02   +7.288774940482839e-02   +2.144701416655055e-01   +1.334296644115904e-01   +5.079202981796161e-02   +1.592175573760461e-01   +7.550022811915511e-03; -1.883435902894392e-01   -2.350327575984776e-01   +6.070741213794185e-02   +2.251433009831833e-01   +1.301657516565508e-01   -2.976023147688411e-02   +2.338685861106651e-01   -1.312622003456563e-01   +1.050629627453905e-01   -2.197174440781443e-01   +1.475842262032006e-01   +1.164925632487370e-01; -9.467281690489943e-02   +1.875797661752093e-01   +5.540491697280706e-02   -1.280719947989805e-02   +1.042594143715969e-01   -1.018214568800413e-01   +2.607575971610251e-01   +1.299701467796267e-01   +1.357156355941417e-01   -1.676828228645163e-01   -1.749531332124118e-04   +5.701883589405647e-02; +1.214990288439664e-01   +4.664462978729591e-02   +2.089038184832523e-01   -1.533400227875787e-02   -3.889572661209535e-02   +2.875275785387395e-01   -1.872316870538022e-01   -1.594515617196058e-02   -1.928014185035546e-01   +1.711353861668780e-01   +3.821166037719441e-02   +9.364545320703839e-02; +8.774029359949226e-02   -2.469173870501808e-01   -2.824484969699934e-01   +7.407950505625510e-02   -2.054637330452524e-01   -1.610243908966607e-01   -1.035309266655279e-01   +6.141162346549514e-02   -2.396166625583264e-01   -1.658698507330245e-01   +2.619728478130767e-02   +2.057208215250038e-01; -3.027072956273183e-02   +1.499652584216385e-01   -1.361912482796538e-01   +2.833050242122964e-04   -1.967645778408449e-01   -2.131591734066865e-02   -2.389579098415034e-01   -1.024295084028036e-01   +2.986440051035790e-03   -1.856601354837500e-01   -2.918258620590208e-01   +7.814041099267670e-02; -4.156779203209969e-02   +6.524072166564748e-02   -3.619561911453498e-02   -9.535080976769306e-02   -5.653325655325283e-03   +1.043082460889247e-01   +3.899436790565585e-02   +1.943589540580470e-01   -2.130243656639152e-01   -1.578447381596561e-01   +2.804702788316140e-01   -5.873383533400908e-02];
L2E_L3E_iAMPA_netcon = [+1.499576598193871e-01   -1.046637523802147e-01   -2.841432972038690e-01   +1.629917007807198e-01   +2.530990126725229e-02   -9.238668702242869e-02   -2.445617196792532e-01   +7.411825923378228e-02; +7.592127987642130e-02   -2.723593007742352e-01   -1.546031356613081e-01   -2.386507116868567e-01   -4.975398570899438e-03   -1.361063920989037e-02   -8.987718920323212e-02   +2.721010492007487e-01; -1.949332572144107e-01   +2.843259018541982e-01   +3.044969688339284e-02   -1.018048632288020e-01   +9.208831110292415e-02   +2.192361967644874e-02   +6.885009824189607e-02   +5.841264792397707e-02; +3.611596718184363e-01   +3.437860617608262e-01   -6.933393431220937e-02   -5.652523815697116e-02   +1.121881202555225e-01   -6.141804255094875e-02   +6.503650441517181e-02   +2.243661038832895e-01; -3.439866199337595e-02   +1.740973316504543e-01   -2.413860763107552e-02   +1.613088945436132e-01   +2.216799129584204e-02   -6.735545526083035e-02   -1.675511381792420e-01   +6.263751232257159e-02; -6.228386607705873e-02   -1.586223947143200e-01   +1.885123423031017e-01   +1.175692972301495e-01   +5.616677974550314e-02   +3.473271676811551e-02   +7.713616352389690e-04   +1.759468653834064e-01; -1.262443255774590e-01   -1.843916765489760e-01   +2.285241485280796e-01   +6.269524617570263e-02   -2.073446823193391e-02   -9.932834255458418e-03   -1.548106579095460e-01   +1.029745626295738e-01; -1.213819551751541e-01   +1.422104852624745e-01   -1.056210207843578e-01   -7.367687428380064e-02   +7.619487330551114e-02   -1.473029846239525e-01   +4.982482939282470e-02   +1.645427003340638e-01; +1.060052323137768e-01   -1.207477611268672e-01   +2.238595710383540e-01   +1.293399118846050e-01   +1.288521987679902e-01   +3.639670897441650e-02   +1.879699521390561e-01   -7.802423611382259e-02; -2.190798095005380e-01   -1.217545408627992e-01   +1.284905043856200e-02   -1.693966912413176e-02   -1.115504576190064e-02   -1.111730425976094e-01   +3.657631786030761e-02   +5.455037796292870e-02; +1.220446212993833e-02   -6.996546574513696e-03   -1.350147861602845e-01   -5.141639273543344e-02   -5.167074195953646e-02   +9.184972101755090e-02   -1.127436379394309e-01   -9.492613313810128e-02; -8.874805555501801e-02   -4.316481314414954e-02   +5.219455122191442e-02   +1.651915866630223e-01   -5.992899552079743e-02   -1.958503380839956e-01   -7.755116947463964e-02   -1.568832901768492e-01];
L2I_L3I_iGABA_netcon = [-1.235959087528685e-01   +4.027362722175500e-02   +1.716461159602423e-01   -1.186085655880603e-01   -2.111509860895431e-02   -3.481417454485675e-02   +9.791527463625782e-02   -5.299587383263789e-02; -1.280558507442063e-01   +3.200673596531504e-02   -6.271542840528450e-02   +3.693262450920701e-02   -1.375629377678382e-01   +2.430468656167618e-02   +3.477749577953974e-01   +2.131322421305501e-02; +1.681649429300654e-01   -1.564276318660983e-02   -2.288308782324928e-02   -2.303809565965358e-01   -1.151925984247402e-02   +2.552503556240595e-03   +5.431717981959758e-02   +1.548864563887870e-01; +6.748235134547712e-02   +2.198942465598996e-01   +5.174775186123134e-02   -4.051442464489734e-02   +1.246199125105987e-01   -1.073725523928691e-01   +2.429736764962555e-01   -2.083308700865240e-01; -1.079046111735255e-01   -2.882314490425078e-02   -1.983579893408312e-01   -1.150022846858138e-01   +1.040736758960108e-01   +1.611209282298398e-01   -5.091338832918710e-02   +5.022983489561732e-02; -1.773212763761062e-02   -4.135747511996028e-03   +3.860519890138889e-03   +3.969689236061839e-03   +9.022480150248033e-02   +1.704093877687981e-01   +8.959784985926954e-02   +1.272375585372461e-01; +1.032228407953666e-01   +9.207806117595816e-03   +1.160595491800226e-01   -1.203766787081696e-01   -3.723044268650451e-02   -5.571074674016954e-02   -2.316600582965150e-03   -2.679317167598537e-02; -4.652953570247455e-02   +2.126622295357381e-01   +1.234675356926370e-01   -1.735457351990981e-02   -1.448014883669372e-01   -5.873853284023269e-03   -2.660273867166530e-01   -1.471008201082362e-01; +3.132506586295937e-01   +1.874184946418084e-01   +4.764865089366039e-02   +2.070105313808181e-01   +6.659429999067192e-02   -8.434346402888715e-02   +3.215329964877982e-01   -2.029181202880880e-01; -1.251378444497817e-02   -1.070251898939261e-01   -1.280193874647083e-01   +1.326529684851535e-01   -9.091132042744660e-02   -2.840255904479336e-01   -2.227695323804828e-02   +2.529215726111915e-02; -1.736339050150893e-01   +2.557379877165224e-03   +1.537026694708958e-02   -4.652381611031393e-03   +1.914794068611387e-01   +1.239510831940970e-01   -8.077812547376406e-02   -2.215637903316472e-02; -5.597117771020966e-02   +1.994396683028165e-01   +4.174349131079223e-02   +1.351348490366590e-01   -5.533480792441307e-02   -1.767687629043507e-02   +7.685921625649754e-02   -1.278351767709138e-01];
L3I_L3E_iAMPA_netcon = [+1.480311611789043e-01   -5.726917980964163e-02   +3.547477495093089e-01   +2.170221267745061e-02   +4.022139971752343e-02   +1.399250185016933e-01   -2.838125040094224e-01   -1.872075562260745e-01   -2.422952916545597e-02   +9.266740757660059e-03   -1.245886092340163e-01   +4.311261256933582e-02; -3.322765448975920e-02   -2.792549921314087e-02   +3.380270906316119e-01   +1.091098075658951e-01   +5.016600489135193e-03   -3.795152075057803e-01   +1.944730860699460e-02   +2.882881415176984e-01   +2.361361836935572e-01   -1.212687541685293e-01   -6.909144923859019e-02   +9.119952488213021e-02; -3.484229689876898e-02   -2.045474948556184e-01   -2.247137883997233e-01   +3.269470567817993e-02   +1.500274912465110e-01   +2.840105676306557e-02   -1.164113844455508e-02   +1.476789043544554e-01   +6.623132027981804e-02   -5.838313414710617e-02   -7.042046612355946e-02   +1.652965628115045e-01; +5.002351748864445e-02   -5.068652480211513e-02   +3.410319757109181e-01   -3.459147192727750e-02   -2.353542623488617e-01   +1.148146424921574e-01   -2.476431412036028e-01   +1.292055393281925e-01   +5.987479895866241e-02   -5.773468358371903e-02   -1.950123569138323e-02   +2.786555827926999e-01; -8.143871285883407e-02   -2.962194687232429e-01   -1.534532783256311e-01   -2.443812210199983e-01   -2.692369327181174e-02   -2.234036740637968e-01   +2.109997642138030e-01   -3.246958727691984e-02   -1.352817937769193e-01   -2.775661227920389e-01   -1.562839998098857e-01   -1.694758557428581e-01; +1.956808821573424e-01   +1.555892669168565e-01   +1.261747628663934e-01   -3.074337285309875e-01   -2.908382865423873e-01   +9.553866218245714e-02   +3.222420012197005e-02   -3.820862164585132e-02   -5.191052509069014e-02   +1.707335067475803e-01   +7.739915813504648e-02   -1.530598248674449e-02; +2.770741431350737e-02   -2.170490424920783e-01   -8.629410814325050e-02   +1.569533236129840e-01   +1.430851758524961e-01   -1.625736883794626e-01   +1.253465933249593e-01   +2.636721861653596e-02   -4.263930622547103e-03   -9.384555016995727e-03   +8.289469400367674e-02   +1.289292366906370e-01; +4.254775752345707e-02   -5.043164707684928e-02   +1.157639615105155e-01   +5.884868940760732e-02   +3.327635870574048e-01   +1.415224404953424e-01   +8.354979361629362e-02   +1.173234555056741e-02   -1.299396862309704e-02   -4.281983882690020e-02   +3.643982559755513e-02   +1.406159073955640e-01; +2.573218796429569e-01   -1.897375028379284e-01   +1.527459430274820e-01   -1.749233264154806e-01   +1.346948023483820e-01   +2.751444171639372e-01   +1.804275128982846e-01   +1.034057846327963e-01   -1.390240275757897e-01   +8.790884885744349e-02   +6.738042561679035e-02   -3.607199761577333e-01; +1.457112866897544e-01   +9.775376741369600e-03   -1.880615829360365e-01   +1.621557132606511e-02   +4.437495808312086e-02   -6.559606480638705e-02   -1.187693664931979e-01   -7.145415999701771e-02   -1.205721003106392e-02   -1.329306128963400e-02   +1.797864961721517e-01   -7.973032432616084e-02; +7.549053933468999e-02   +4.929262770153748e-02   -2.629620691785424e-01   -1.734010186797628e-01   +1.947395342510785e-01   -2.441180302118739e-01   +1.511503149265590e-03   +2.057486271541833e-01   +1.490683478118711e-01   -5.693624858048164e-02   +2.112165814563476e-01   +9.067335241128349e-02; -1.327274140441322e-01   +1.975813565399640e-01   -5.619657400350569e-02   +2.847814169353337e-02   +1.898624231009653e-01   -1.748922640991971e-01   +8.672424749521862e-02   -2.062828705277347e-01   -1.181600598919723e-01   +2.141296606004802e-01   +2.305998754511054e-01   +1.861635066834250e-01];
L3E_L3I_iGABA_netcon = [-5.883235515760041e-02   +9.562340907301719e-03   +9.883606710482454e-02   -6.580714571279205e-02   -1.524875853744141e-01   -2.078276088157407e-01   +1.402394479967368e-01   -1.841422915759532e-01   -5.677411386675225e-02   +5.026187683949859e-02   -1.533162183487486e-02   +1.423859106050402e-01; -9.754541798618874e-02   -6.880869628280503e-02   -1.267336121943430e-01   -2.030134040106580e-01   +3.089162672045295e-01   -9.028507158803943e-02   -3.385956953068958e-02   +7.914289354524447e-02   -9.638363632503946e-02   -1.625958542085821e-01   +3.661257739309218e-01   +1.097192000434001e-01; -1.107645757876276e-01   +1.222860629920483e-02   +1.135254466932789e-01   +1.130948633276739e-01   +6.309916161745162e-02   +1.082048821491186e-01   -8.624761910132497e-03   -9.735867668446550e-03   -8.030317096976948e-02   -1.703631049106148e-01   -9.265093348020551e-02   -4.928535109975710e-02; -9.186433287085534e-02   -7.218487802379191e-02   -6.171777734795468e-02   -5.818163018842948e-02   -1.449636599116208e-01   +3.197466781927808e-01   +5.880816133412513e-02   -8.659162362723077e-02   +4.765181603677451e-02   -2.254319171656436e-02   -2.491173266129613e-01   +1.959729422256866e-02; +1.618062909543852e-02   +6.328452028658934e-03   -2.517091962822275e-02   +1.162581585304231e-01   +3.554008536336023e-02   -1.052130398912960e-02   -5.030625899510056e-02   -3.058071442927086e-01   -4.438093098703991e-02   +6.685895453740653e-02   -2.777972968780668e-01   +2.863830786048857e-01; -7.283673050003611e-02   -1.220388694707605e-01   +2.038338405555786e-01   +2.115858486678713e-02   -2.440822487287922e-02   +5.657626957479465e-02   -1.148240911359531e-03   -1.093413712442387e-01   -1.790826142397375e-01   -8.817186488554385e-02   -8.197958606674381e-02   -4.738868771298936e-02; -1.906443984976122e-01   +3.798544288695068e-02   +1.046265859861123e-01   -1.637553357109375e-01   -1.859795176927509e-01   -2.110861314891981e-01   -9.970788739135306e-02   +3.884372842392001e-02   +5.699047644889760e-02   +3.276411631375121e-01   +1.560131580992737e-02   -7.938606052856971e-02; +7.346691278563788e-02   +1.170746399223777e-01   -1.564538975652848e-01   -1.292499202045278e-01   +6.045204083787789e-02   +2.751969428565630e-02   +1.684956626527605e-03   +8.665327726540435e-02   +9.557386024833095e-02   +1.616826507762767e-01   -6.291537239522567e-02   -9.507029850734769e-02; -1.310557716480998e-01   +2.395008133170880e-01   +9.843941899121557e-02   -2.133452017389569e-01   -3.224411250401912e-01   -2.880350533535921e-01   -2.016948572197079e-01   +1.171932730933080e-01   +1.415839610050610e-01   +2.135263861964996e-01   -4.005648358004729e-02   +2.151286376982727e-02; -9.757835443069660e-02   -2.537929320860645e-03   -3.764854522136477e-02   +1.088723969471008e-01   +2.056453040594675e-01   -1.504543731778576e-01   +1.381617210233008e-02   -9.454874688295600e-02   +5.193825064942983e-02   -1.282091621476666e-01   -7.017309820617144e-02   -1.274903543665735e-01; +1.438138557536949e-01   +1.245318308134081e-02   -3.520691369158849e-03   +2.157339354918302e-02   -5.531563044511867e-02   +2.727637260237581e-01   -3.162042248343495e-04   -2.118815012697244e-02   +9.790160157811072e-02   +1.277674541415436e-01   -2.129031308630256e-01   -1.285104367929697e-02; +8.082926929844164e-03   +1.649876510826216e-01   +2.581760104314024e-01   +9.752646773433224e-02   +2.861012775873018e-01   +9.647845534885739e-03   -5.914220327853993e-02   +1.169381369754340e-01   +4.479304132334645e-02   +2.764217006229558e-01   +2.369751461325476e-01   -6.298062276106919e-02];
L2E_Input1_iAMPA_netcon = [+1.549125691569215e-02   -1.768217420784174e-01   +2.514578381168635e-01   -8.693059534771450e-02   +1.514283787800072e-01   -2.913805073192492e-02   +7.156575982091176e-02   +1.325961894151147e-01];
L2I_Input2_iAMPA_netcon = [-1.107539097376163e-01   -3.254443734373051e-02   -1.712663515144807e-01   -3.531274121405366e-01   +1.354322515136827e-01   -9.002288897037326e-02   +3.053469485239423e-01   -2.235508596732748e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
