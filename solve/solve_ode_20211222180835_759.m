function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.314970449988303e-01   +1.155621639236862e-01   +4.774143953343664e-01   -3.593508399802460e-01   -1.643536915122539e-01   +9.495206776797431e-01   -8.459739964555905e-02   +1.440011973863752e-01   +8.389510961279195e-01   -1.087423671544042e-01   +2.927333143561884e-01   -6.304979941676013e-01   -7.712391168627547e-01   -9.491129444182694e-01   +8.980465230603683e-02   -2.099366124760522e-01; +1.015455078831886e-01   -1.876457203096204e-01   +2.639665817548952e-01   -5.091714166100808e-01   -3.779620079160693e-01   +1.430188394049789e-01   +6.639665148067975e-01   -6.916518055575638e-01   +5.454411384661683e-01   +5.230656157350863e-01   +6.745025104746796e-01   -1.523163603744079e-01   -8.228008501390474e-02   -4.455108216311028e-01   +5.357833978279051e-01   -2.008191303835329e-01; -3.219851223347097e-01   -2.283979992488950e-01   -2.614293604040285e-01   -4.804696450612148e-02   +4.527073966879582e-01   +1.113154636689816e-01   -2.742399356979758e-01   -6.837563779508323e-01   +4.835577889436470e-01   +5.247973657807128e-01   -8.100508154158134e-02   -6.115655289274586e-01   +5.019772014000061e-01   -2.362817361381815e-01   -2.558471156921048e-01   +2.149978949139385e-01; +3.782912211681826e-01   -2.034135674072639e-01   +6.396375788977727e-01   -4.878300922344794e-01   +1.303741534025189e-01   -5.308549030983060e-02   +7.928919236276215e-01   -6.742696697014454e-01   -3.254889463236568e-01   -6.480261983861115e-01   +6.385573858918476e-01   -4.797912303892627e-01   -3.829978211336487e-01   +6.478691305806527e-01   +1.566115468533167e-02   +5.721893572433185e-01; +2.428826519628235e-01   +3.275122805296236e-01   -4.421978116405585e-01   +1.799758887373313e-01   -1.955672125850432e-01   -6.832978400980402e-01   +7.180727666783325e-01   -1.189365049311253e-01   +2.233667365467583e-01   +1.558958169652567e-01   +4.955230497754974e-01   +1.062378066289996e-03   -1.037880605578558e-01   +2.274512036042214e-01   +4.114867807236366e-01   +1.746737313856825e-01; -4.670080748734174e-01   -6.068353791071535e-01   -6.492506990632903e-02   +3.633721615531360e-01   -9.058086587274971e-01   +1.169064566970679e-01   -3.157512598743041e-01   -9.229404423028023e-02   +3.447282342070521e-01   +1.455379850289396e-01   +1.921818773894494e-01   +4.170999568196186e-01   -6.459077401762562e-01   -6.854539776560740e-01   -5.130842100026931e-01   +1.606818671487449e-01; +3.647266375100922e-01   +2.130017549555034e-01   +2.604027834500137e-02   +8.968219084415736e-03   -2.628681110235425e-01   -3.045826134785527e-01   -3.282555431095514e-02   +8.195370757460238e-02   -4.430764705300863e-01   -2.843931486182652e-01   -2.444822397671951e-02   -4.745268425655871e-01   -7.759387737727631e-01   +5.060670242341926e-03   -2.000986064013137e-01   -1.659501415448632e-01; -5.088032489883506e-02   +2.254180495705637e-01   +4.852361872492422e-01   +7.034322097960831e-02   -3.466378440789892e-01   +8.178338939982495e-01   -3.141169798649537e-01   -3.924469541680403e-01   -1.894663222034298e-01   +1.000000000000000e+00   -4.222220503871007e-01   -3.151492010351743e-01   -5.989745493750555e-01   +7.108474931027879e-02   +3.238260183039140e-01   -2.663559380654842e-01; -1.280759314623370e-01   +7.144828390971840e-01   +3.712695332542108e-02   -5.581818927616964e-01   +4.379790883240131e-01   +1.597104729333636e-01   +8.271386161157969e-01   -3.972987696008364e-01   +5.351920645212532e-01   +4.437868998328261e-01   +8.515698552323542e-02   -2.555686281585371e-01   +3.299155318214865e-01   +1.805561105591345e-01   +1.708045404954931e-01   +1.811523869211862e-01; +1.739176600662280e-01   -3.915624819742692e-01   -4.578734029663313e-01   +4.761130019455685e-01   -6.959078964971543e-01   +3.311082083012833e-01   -8.478791613500650e-01   +2.302813413029362e-01   +4.531462740099380e-01   -6.654857531132423e-01   +3.947260048573610e-01   -9.337075180793791e-02   +7.182072916272124e-01   -6.614362953049945e-01   -2.286733196303044e-01   -6.572247995861950e-02; +2.085673331466026e-01   -1.676238953633105e-01   +3.251170768028954e-01   -1.596827191603292e-01   +2.575313523244526e-01   -2.201302944815821e-01   +2.590233711556067e-01   -7.580650862360983e-01   +3.131000276517860e-01   +3.595357819152681e-01   -4.666545924560122e-01   -4.061403208007789e-01   -2.305169507024682e-01   +2.344148537695840e-01   +1.261880320856966e-01   -6.825653012347709e-01; -1.492104501010714e-01   +8.701950092498135e-01   -2.745607080708081e-01   -2.199644566057236e-01   +5.968925388901630e-01   +4.769114347389170e-02   -5.074834077731329e-01   -1.802159892785110e-01   +4.811238702385236e-02   +8.708413976612740e-01   -4.804863450783415e-01   +1.482837610370642e-02   -4.943540979252823e-01   +6.281834928515145e-01   -6.198109576030840e-01   +1.715357732300934e-01; -3.019450814112652e-01   -4.070265760469774e-01   -4.209020425677160e-01   +4.263437804853822e-01   -7.834618691735834e-01   +5.556874122806014e-01   +2.499565212127943e-01   +3.137590345874008e-01   -2.560876105694014e-01   +4.651036815742279e-01   -3.001365938871672e-01   +5.072122399885195e-01   +4.075448880456709e-02   +3.689714801818178e-01   +2.251889426929699e-01   +1.682810756197336e-01; -1.685460680375447e-01   +5.151770360246040e-01   +2.841477206274450e-01   +6.032491969476180e-01   +4.933894925327138e-01   +7.325212260116085e-01   +2.863201581906987e-01   -6.451679497227131e-02   -3.101909302210010e-01   +7.971973994647886e-01   +8.758663578195680e-01   -2.074474708181739e-02   +3.195486383484180e-01   -5.634785498460270e-01   -2.505766457658651e-01   +1.794629987265331e-01; +4.540765132874159e-01   +7.581045647604684e-01   +2.784820626290317e-01   -2.776628303212680e-01   -9.225227694686455e-02   +9.347335534001756e-02   -7.985334579902797e-01   +1.420704368680511e-01   +5.357422863147856e-01   -8.924752063450546e-01   +8.079695450840862e-03   -5.116171812048941e-01   +4.196251842974300e-01   -1.822217411516320e-01   +5.257131032990056e-01   +2.487848730424795e-01; +2.641151739015261e-01   -2.203863842723129e-01   +1.923055619794797e-01   -4.551981628841856e-01   -7.429106053900038e-02   -6.596813066242591e-01   +5.254645033593943e-01   -8.592809761730695e-01   +6.301526801524417e-01   -2.862357689176450e-01   -5.676184054430019e-01   +8.767479090364313e-02   +3.085458485436541e-01   +2.304096398465845e-01   -5.864085998127545e-01   +5.001715947355005e-01];
L1E_L1I_iGABA_netcon = [+6.499722427828020e-01   +3.805970621380987e-01   -3.036048573370933e-01   +2.400621575945569e-01   -2.547011647133173e-01   -6.514463903388855e-01   -4.800032064659096e-01   -3.523752948511376e-01   -6.261856197528759e-01   -5.828712677551401e-01   +2.190601611483037e-01   +1.961792556201372e-01   -7.985229790369142e-02   +6.902174144761846e-01   +4.042680335139539e-01   -1.690786279497852e-01; -4.224927055868294e-01   +4.766430662849173e-01   +2.427922659822383e-01   +3.356306667523874e-01   -4.055212644307811e-01   -4.527882225530899e-01   -1.061468753765548e-01   +9.188423638469861e-02   +3.866751025573993e-01   +8.039213106128686e-01   +3.246611634586529e-01   +5.624341933142409e-01   -2.353769162822279e-01   +6.308496298413406e-01   +4.634033050526681e-02   +3.984326566260017e-01; +7.633893109495886e-01   +6.333978004406228e-01   +3.008373672007351e-01   -2.441462139388066e-01   +4.638079923740477e-03   -4.618729250553765e-01   -4.460140581142081e-01   -1.137285026752674e-02   +4.685011360108189e-01   +6.423530834337484e-01   +6.102330856239880e-01   +3.519471432317215e-01   -2.775741120807224e-01   +4.359067758170063e-02   +2.766030432292144e-01   -1.738105027669427e-01; -2.758544841413672e-01   +1.481078031799124e-01   -8.424003780333220e-02   +8.668740665421961e-01   +1.002933452009789e-01   -1.337759663190700e-01   +4.842284119893022e-01   +9.572381016260567e-02   -1.175887969115265e-02   +2.481251122812547e-01   +6.301845725805297e-01   -3.221106420927529e-01   +5.161558628093986e-01   +6.489893239688052e-01   -3.468484088139007e-01   +4.789950453975327e-03; -6.042084956741851e-01   +1.250785451102441e-01   -1.252442956825284e-01   -2.601050974673589e-01   +3.659642398294465e-01   -3.000079348911436e-01   +6.085039175044760e-01   +4.253414649969568e-01   +5.210620877018409e-01   -4.035642676147246e-01   -3.975252480912601e-01   +2.485705760114455e-01   -7.487567196210787e-02   -7.709101452996735e-01   +6.516247869883501e-01   +2.187151131182003e-01; +3.411492069707938e-01   +2.057262114806131e-01   +3.103809612995348e-01   -5.424523340776638e-01   +2.244953031795201e-01   +2.203233221718313e-01   -2.499238283591948e-01   +1.388036017382088e-01   +3.021336421681458e-01   +4.644146574550456e-01   -5.641409816272606e-01   +8.178679790656321e-01   +8.699028068356132e-01   +1.000000000000000e+00   +2.592742925705466e-01   -3.297460428261237e-01; -2.884777860995267e-01   +3.963050577508005e-01   +1.862206592816664e-01   +6.142817714533922e-01   -6.100504408043215e-01   +1.623444268772600e-01   -5.999598462850089e-01   -4.594352487876039e-01   +4.361565699873946e-01   -1.919669355029468e-01   -3.243379169820607e-01   +3.414689065092485e-01   -4.760530540527101e-01   -3.812146423522815e-01   -4.331918646438411e-01   -4.111444255711846e-01; -1.783008485237379e-01   +5.453153262573306e-01   +5.686026932765477e-01   +5.367618506075340e-01   +5.368628651972428e-01   -9.666505149640481e-02   +5.581705289508351e-01   -6.466192544893213e-01   +2.438543429264715e-01   +1.518664637848180e-01   -5.470946453841463e-01   +6.547661085677943e-01   -7.711538566729070e-02   -6.092718485965084e-01   -4.020730586783657e-01   -4.502890014912514e-01; +3.531729804569569e-01   -1.243787415600593e-01   +4.359742993367444e-01   -3.323665674125497e-01   -4.975030954102497e-01   -1.483144169856794e-01   +3.295835475393472e-01   -5.089370428549863e-01   +3.140149709759809e-01   -5.179897916171056e-01   +4.755338272266311e-01   -8.946546706637389e-01   +1.642815366515199e-01   -2.700635803740078e-01   +6.855160247602557e-01   +1.661626210395181e-01; +3.178492503824674e-01   -1.607495840514605e-01   -2.063593104909474e-01   +3.476422767456152e-01   -5.755210657692030e-01   -3.194313420988607e-01   -2.256803451439440e-01   -4.997881152713897e-01   +1.197334898587663e-01   +4.325095526641430e-01   +2.046332351332962e-01   +2.670356446013782e-01   -4.689669727221595e-01   +5.631949697687405e-01   +4.120049319308776e-01   +1.498457909079825e-01; -4.619059830250635e-01   -1.940873141322518e-01   -6.359387295126023e-01   +4.338537971824720e-01   -6.343644614767296e-01   +9.539327702970469e-01   -7.576991053495359e-02   +9.626828042800265e-01   -7.376519026429984e-02   -6.405214875579525e-02   -3.145123909200959e-01   +2.714677708584355e-02   +1.142759971437225e-01   +8.587473911590017e-02   +9.286519931477816e-02   +1.501622534153006e-02; +3.093198991534694e-01   -8.258060473428420e-02   -1.289588196913662e-03   +1.451349567102284e-01   +4.567335812114802e-01   +1.749422104317680e-02   +1.964272689646825e-01   -3.425509815731531e-01   +9.581220821234634e-02   -6.021380567078886e-01   -1.527971139427216e-01   +7.189191547264385e-01   -4.707188101747029e-01   +5.474133209613952e-01   -3.104540256310460e-01   -2.993211141683031e-01; -4.398870475879625e-01   +2.957140881479384e-01   -1.908086991552361e-01   +8.712230726799307e-01   -1.464607493601376e-01   -3.210655787551349e-01   -4.838481008157212e-01   +4.378597172452259e-01   +6.462837628883057e-01   +7.392979554912636e-01   -3.393744881917774e-01   +3.624517644731628e-01   -3.978226515942593e-01   +6.066182364349494e-02   +4.528049874329295e-01   +4.105861050101363e-01; -2.671238653579491e-01   +2.259689801885633e-01   +3.118175524138502e-01   +4.908126266893855e-01   -2.238946437257245e-01   -3.525859883669709e-01   +2.433853151381908e-01   -7.033876462707885e-02   -2.533427725366829e-01   +5.219046311469586e-02   +1.334887603600117e-01   -5.490849667271944e-01   -5.049303918569444e-01   +6.731825305989257e-02   -1.116056508501216e-01   -1.093123473316600e-01; -2.268330854890761e-02   +7.673292457165304e-03   +3.325392758595026e-01   -1.913731732075082e-01   +6.007656655534798e-01   -6.606053031809385e-02   +4.548699125673271e-01   -5.466509282823452e-01   +5.020191294469604e-01   -3.734657886000829e-01   -6.115814826583029e-02   +2.544656097992361e-01   -4.295738593260170e-01   -5.092943750357071e-01   -5.483912076035079e-01   -3.618490152072135e-01; -1.270919368474543e-01   +6.560523361860788e-01   +4.981305485618656e-01   +3.464886209277266e-01   +7.031891584173590e-01   +2.066142493419771e-01   -1.746222393663345e-01   +4.449420883139010e-01   +5.681843233936829e-01   -3.808479349872362e-01   -7.429552427143166e-02   +3.918273429520067e-01   +2.720503601377064e-01   +4.151759637953624e-01   +2.882480192441862e-03   +2.900135417148777e-01];
L2I_L1I_iGABA_netcon = [+5.324358902028407e-01   -2.177690686736053e-01   +1.676832938305239e-01   -8.484886830311181e-01   +1.840682735475132e-01   +5.867591812825161e-02   -2.618291612951204e-01   -2.968121871108629e-01; +1.152238490006735e-01   +3.970854996034900e-01   -3.583719802549565e-01   +1.051442991911265e-01   +8.008035465644190e-01   +3.438775271176630e-01   +2.053405392256339e-01   +1.106976203886317e-01; +3.884838892409205e-02   +1.568837437862878e-01   +2.506103134905309e-01   +3.535490104732209e-01   +6.179970576676973e-01   -8.317098351268386e-01   -5.417333936806302e-01   +3.267608764400525e-01; -2.127653607705394e-01   +6.173387552592011e-01   +9.748189032193585e-02   -1.058707881014313e-01   -4.179677834336598e-04   +1.205398275334954e-01   +6.341945509726233e-01   +1.071347620016541e-01; +3.275396054107323e-01   -1.658604474030967e-02   +4.254291053861184e-01   +2.379045497806489e-01   +7.691964063107158e-02   -6.960913514068104e-02   +7.572002117978617e-03   +1.000000000000000e+00; -3.816801004623799e-01   +5.963059869738414e-01   -2.633267461880281e-02   -5.196511914038777e-01   -4.717945266416109e-01   +4.142241951436316e-01   +2.225000643459533e-01   -3.335216707380041e-01; -1.449859781005221e-01   +2.351367665287489e-01   +1.692987414412849e-01   +3.038277385157016e-01   +2.306860916700961e-01   +4.544925943169200e-01   +4.486910742149854e-01   -5.931182166874636e-01; -3.790206472558165e-01   -3.039646756499834e-02   +7.737356616775010e-01   -3.259154008714590e-01   +3.414748060740476e-01   +1.829891886202291e-01   -4.245239858763832e-02   +2.954655747427226e-01; +4.319238625355246e-02   +3.934428797851744e-01   -1.295998481223149e-01   -2.022504193804147e-01   +3.338643314086206e-01   +1.315927666597012e-01   +6.837194126151133e-01   -5.774210067038112e-01; -9.736981851804585e-02   -9.643885889087586e-02   +4.803707894014880e-01   -7.298447959040927e-01   +6.317015561734024e-01   +5.116501290610547e-01   -3.970015253679548e-01   +6.237894738972705e-02; -1.309756064125452e-01   +3.111000471601112e-01   +3.130243650778289e-01   -1.652919950543413e-01   -3.737472226628547e-01   +2.634511829483639e-01   +9.772905030056467e-02   -2.629403892367022e-03; +2.157529845718008e-01   -1.967821082525053e-01   +2.815414922635124e-01   +6.900429033707383e-01   -5.304871385167558e-01   -6.505656883942207e-01   +2.850012063218307e-01   +2.315839406931291e-01; -6.082491529513416e-01   +2.941588461963167e-01   -4.602270484818867e-01   -4.387437685255473e-02   +8.396148942831034e-01   -6.258704601937382e-01   -9.424469726912067e-02   -4.902971494223241e-01; +7.540129540010686e-02   +1.104217250367290e-01   +4.549535841713545e-01   +3.637259571221360e-01   +8.376884701515176e-01   +4.018052547919115e-01   +1.695701172896983e-01   -3.818853357550152e-01; +3.422227253389711e-01   +5.017204254654737e-02   -4.088004132190032e-01   -1.000647665411231e-01   -4.204794019139973e-01   +9.709698577371235e-02   -1.212172822651112e-01   +5.568859100039547e-01; -5.162913686151449e-01   +5.319115432236619e-01   +3.689643090441383e-01   -1.399277470675817e-02   +3.773928040937026e-03   -5.370982853301153e-01   +1.612942214520013e-01   +4.947836427182185e-01];
L1I_L2I_iGABA_netcon = [-3.363701650605407e-01   -6.662181789876324e-02   -5.839196930250574e-01   -3.841224295137782e-01   +3.671848352305221e-01   +6.546046874018379e-01   +1.610200081920700e-01   +5.183298787983305e-01   -5.068458209529797e-01   -2.904357203996847e-01   -3.912532778321881e-01   +2.577570766198906e-01   +3.674107897355999e-01   -4.267667090421523e-01   +2.137611425416628e-01   +6.336490256880247e-01; -9.521855834025691e-01   +6.811229039983020e-02   -1.479492922884701e-01   -2.113350108748764e-01   +1.006589140014384e-01   +3.041615872662797e-01   -1.173585161931661e-01   -1.421860525938385e-01   -4.171878288560904e-02   +9.664593763937198e-01   -2.406610464459155e-01   -5.361693960890398e-02   -2.422383520616987e-02   -1.399061317398258e-02   +2.985809459240855e-01   -5.983392379785826e-01; -3.412593480397035e-01   -1.300914372544782e-01   +1.864294627751943e-02   +5.874693613451794e-02   -2.889872536896268e-02   +5.579630549214613e-01   +6.217653647232267e-01   +5.802690103337642e-01   -8.670544719901200e-01   +7.635409570251118e-01   -1.484740431156336e-01   +1.130530931688476e-02   +9.377349053423366e-02   +1.881752808219138e-01   +5.712716697085649e-01   +3.661692851018427e-01; +9.560526702346773e-01   +2.096309214857504e-01   -7.945280509314349e-01   +4.003798326747974e-01   +9.449856326618263e-01   -4.807106721977377e-01   +4.051227315846814e-01   +6.827398409297866e-01   -3.302128953752692e-01   -7.290530781555883e-01   -1.138080391496045e-01   +6.040712001425106e-02   -2.488882475843004e-01   -1.817461412418262e-01   +8.706055541027314e-01   -5.612478134657031e-02; -3.638094313339636e-01   +7.797599870106739e-01   +7.025223348705517e-01   -9.776483056378952e-01   -2.232114162530927e-01   -5.440779643040482e-01   +1.680992450545622e-03   +4.038904990585873e-01   -8.872090947193634e-01   -2.601795889601081e-01   +4.590145848768931e-01   +4.689025891595468e-01   +2.700895620201506e-01   -1.296413303811197e-01   +6.142331856547981e-01   +1.856485803387078e-01; +1.615474663798317e-01   +2.478363786795158e-01   +8.785883195368888e-02   -7.715124877454228e-01   +4.853402261040203e-01   -4.106007207381711e-01   +4.163603621635279e-01   -4.025172138399927e-02   -2.252300242349860e-01   +3.591469709434295e-01   -7.069283407691130e-01   +3.974365904202932e-02   +8.335614147771122e-01   +3.322290044303040e-01   +3.768614333874569e-01   +4.007027678482866e-01; +7.002407028038613e-01   -5.349492578876874e-01   -2.330222730787567e-01   +6.393556769703271e-01   +8.441257039236589e-01   +1.807694003521199e-01   -9.556709942868352e-02   +1.383568360998421e-01   +5.172292056387400e-01   +1.987105512827627e-01   -3.871569145584960e-01   -8.057649658631583e-02   +2.988563834219783e-01   +3.247646761764604e-01   +3.549292112107015e-02   +8.157418384769496e-01; +3.866495136451491e-01   +7.596789449637685e-01   -7.712070111128748e-01   +2.319698921915068e-02   +1.717661349425652e-01   -3.886132748727568e-01   -7.028189579648689e-01   +4.232327260601019e-01   +1.000000000000000e+00   +8.013308253726258e-01   -5.474653762093147e-01   +2.304569759636627e-01   +4.716791154917275e-01   +5.002453842588243e-01   -3.270020404738688e-01   +6.281550014785756e-01];
L2E_L1E_iAMPA_netcon = [+5.269371455833233e-01   +4.244368089709144e-01   +3.411158872010627e-01   -1.000000000000000e+00   -1.600557888399711e-01   -1.297380787869714e-01   -2.513732335787480e-01   +5.761466416911429e-01; +6.408726331492782e-01   +9.837851377308328e-02   +4.002888902616873e-01   -3.814044864138675e-01   -1.979243458976079e-01   +2.521185639284548e-02   -2.957444126476390e-01   -2.722442488139259e-01; +4.669066250450830e-01   -3.481291633820875e-01   -6.659650991379353e-01   +6.745449244648095e-02   +1.989245913361474e-01   -1.261393575096212e-02   -3.888343371371240e-01   +1.498236088749761e-01; -2.586922194817205e-02   +2.523540146410670e-01   +4.367596634060732e-01   +2.072330304768535e-01   +4.429139898442562e-01   +3.633054765339613e-01   +3.938274296782113e-01   -1.923224276322175e-01; +2.598418808112118e-01   +7.487154026517966e-02   -1.007341704178051e-01   +5.599944916226970e-01   +2.528680364964806e-02   -2.548516262036873e-01   -1.896903409558566e-02   +1.730801007729726e-01; -4.734963754715426e-01   +6.869995144165110e-01   -1.638975753247530e-01   +9.125948255278146e-02   +7.412765700348507e-02   +8.210019829113712e-01   +1.077346324851594e-01   +4.265183332470522e-01; -5.538241782580074e-01   -5.778439365072600e-01   -3.077420640842691e-01   +4.182662146056163e-01   -2.266394534078300e-01   +2.579307552692443e-01   -2.250138743579484e-02   +8.035717851619018e-02; +3.171316693769077e-02   -2.987270391939925e-01   -8.558750413729329e-01   +5.950987165454720e-01   +3.363815066360972e-01   -4.555327501863207e-01   -8.264913975082901e-02   +3.719449779329244e-01; -8.952098078712009e-02   +1.940752411519354e-01   +2.667274880270881e-01   -4.842953777017522e-01   +1.370993155072758e-01   -1.627249268367645e-01   -1.954518829745068e-01   +8.642989533589697e-02; -3.440593573740240e-01   +1.665489461501526e-01   +3.493216948739610e-01   -2.507401832976916e-01   +2.690844355818999e-01   -5.699587642155742e-01   +9.863040617128606e-02   -1.293932954996933e-01; +6.873205541599146e-02   -1.967890481893416e-01   -8.255577471020499e-01   -2.676841575373500e-01   -6.608579863554822e-01   -7.888707707856618e-01   -4.348417708484508e-01   +3.215682432759605e-01; +2.242056688894819e-01   -7.315416266956258e-02   -6.152149764914655e-01   -9.143078725450272e-02   -5.656491215225595e-02   +5.269974472667411e-01   -5.697372036909066e-01   -1.108606906118318e-01; -2.238547581176913e-01   -6.793997387430489e-01   +1.508143675030564e-01   -4.544662396850607e-02   +1.529635886563975e-01   -2.923896943027531e-01   -1.372241283924937e-01   +2.997818052237189e-01; +4.239969597960511e-02   +8.972335033519095e-02   -1.322455183856246e-01   +8.798247135323738e-02   +1.516125195705701e-01   +2.868835121679253e-02   -1.410327525489235e-01   -7.442209411262260e-02; +7.624975351172963e-02   +1.834468058966560e-01   -1.436758631510064e-01   -1.801083589033658e-01   +7.653257162602005e-01   -6.065244023151990e-01   +4.195367168735487e-01   +7.678760793774254e-02; +5.380610208057164e-01   +3.349010292506072e-01   +2.519074706281806e-01   +3.443051975015749e-01   -1.618034237966539e-01   +4.226926865767115e-01   +1.426060457194749e-01   -1.849559309747928e-01];
L1E_L2E_iAMPA_netcon = [+2.892827939664228e-01   +3.126730634557554e-01   +4.447025476388495e-01   -5.774788590598681e-01   -6.114170200724033e-01   +7.142607303917067e-01   +8.403891673701517e-01   -1.833478581166390e-01   +4.323351011255595e-01   -4.701042923266892e-01   +1.323120192344960e-01   +3.463956186417516e-01   +1.780639928976017e-01   +4.849043136510675e-01   -5.294872070721814e-01   +8.133582447044466e-02; +8.006084147969341e-01   -1.315145722069508e-01   -2.791038606682009e-01   -6.337000478892961e-02   +7.570362453295784e-01   +5.528753532668904e-01   -5.215073149498636e-01   -7.668127271199271e-01   +2.615345673403306e-01   +3.174575169494950e-02   -4.600834442234811e-01   +3.509080089130504e-01   +2.230787977826059e-01   -2.064664685960220e-01   +9.434023759948015e-01   +2.562002277596689e-02; -1.000000000000000e+00   -3.895871894765566e-01   -3.418942891550943e-01   +5.436612818256846e-01   +6.800899844030041e-01   +8.859091273371829e-01   +5.269442564620582e-01   -1.715669254617963e-01   +6.336662186806837e-01   +5.301773389672557e-01   +3.260628678696988e-01   -5.782008529078735e-01   -2.635894088809443e-01   +5.715726656804717e-01   +2.525573535344637e-01   +6.103819098668958e-01; +6.381792022307440e-01   -1.905653590546432e-01   +3.521171696611870e-01   -4.009880828939765e-01   +2.455662568651324e-01   +2.105934084090264e-01   -4.998485639539587e-01   +6.013015001017076e-01   -9.114735869250650e-01   +4.241448919330613e-01   -6.073367510478025e-01   -2.107162150637305e-01   +3.695468649133385e-01   +3.306910383667838e-01   +3.025637643745842e-01   -4.147211671522553e-01; +4.465130703544493e-01   -2.045127373657784e-01   -5.805601107594945e-02   +4.504260170296773e-02   +1.272197048736528e-01   +7.193140362424857e-01   +3.104440640132416e-01   -8.895648804989467e-01   +4.223450361439826e-01   +2.772395686956864e-01   -3.346998642177603e-01   -7.771287136544107e-02   +4.031146897132744e-01   +3.199919700308834e-01   +2.111126871076695e-01   -2.416941193256978e-01; +3.289702526153518e-01   -5.204053426809835e-01   -4.661925992552805e-01   +6.020503204374993e-01   +6.844036185788456e-02   +3.740328367588389e-01   -1.586210977443122e-01   -7.012779973150447e-01   -2.139325268043392e-01   -1.318787618681868e-01   +5.122144982390193e-01   +4.323445401218606e-01   +4.364131413688086e-01   -7.451851338767018e-01   -3.323891905355900e-01   -3.784646591581297e-01; -8.043169835060232e-01   +2.997571998221065e-01   -6.167448319799758e-03   +2.882774510388898e-01   -3.178039503450565e-01   +3.880988449406627e-01   +3.601134107563431e-01   +6.554127490458611e-01   -6.850338600304661e-01   +3.550744208309956e-01   +3.640783096724269e-01   -3.857050339628576e-01   -1.506845546440927e-01   -1.123373078861162e-01   +8.196636686446307e-02   -5.069598476407239e-02; +5.603283489007066e-01   +1.268862447304528e-01   -5.002977373046038e-01   -2.638676485546695e-01   +3.103699991935579e-01   +5.767076078955267e-01   -7.744252466674905e-01   -2.074559435852180e-01   -4.906883756139493e-01   +7.390462717047170e-01   -2.590444434948477e-01   -1.468395468753665e-01   +6.310785699394833e-01   -4.705644475335178e-03   +5.664135187447780e-01   +4.596993804982356e-01];
L2I_L2E_iAMPA_netcon = [+1.000000000000000e+00   +5.087905685779266e-02   -4.503290731194306e-01   +5.383034319784981e-01   +7.558255285803869e-01   +2.671634644203582e-01   -4.403282353744518e-02   -6.461963149164450e-01; +6.888170232081566e-01   +1.129565829409992e-01   +8.583218255222128e-03   +4.553618993880746e-02   +3.958091060901157e-01   -5.397075345295256e-01   -4.061827475339627e-01   +5.337445268975523e-02; +3.720712080311853e-01   -5.299004502385813e-01   -6.605472285411657e-01   +1.298534137658270e-01   +1.219088115656873e-01   -2.501136002275492e-01   +9.914635071219947e-02   -2.972019232862496e-01; -2.265343635529498e-01   -2.405851080404762e-01   +8.785693422246817e-01   -2.694855100441533e-01   -2.893923939127957e-01   +2.043841624300075e-03   +4.099964016376434e-01   +3.492794921776523e-01; +1.274212312898569e-01   -4.755778487357488e-01   +7.853227951650836e-02   -3.165322041396839e-01   -1.910086314149954e-01   -3.785719698452123e-01   +8.385184189458474e-01   -4.242624315431607e-01; +5.400349700622838e-01   -3.644810669448976e-01   +2.267586830510754e-01   -1.801355137857487e-01   -5.179384678937972e-01   +5.716277846632876e-01   -3.405029847038368e-01   +3.458796914900355e-01; -2.647547854412786e-01   +6.798002135586882e-01   -2.965358823980789e-01   +3.177473343621817e-01   +1.888193999635222e-01   -3.977667283636194e-01   -4.294149432656770e-01   +4.527817293336943e-01; -1.348238143276116e-01   -6.011774193355033e-01   +4.815367206803524e-01   +2.006876738833518e-01   +5.389821297111475e-02   -7.512539422209041e-01   -4.471458099607330e-01   +7.245063526747238e-03];
L2E_L2I_iGABA_netcon = [-1.097888155582793e-01   +3.663894251089437e-01   +5.112949656166258e-01   -6.302189350807167e-01   -5.570102283360910e-01   +5.609726735252998e-01   +4.242970811939378e-01   -1.318964031981936e-01; -7.274219706209301e-01   -8.254583051162395e-02   +5.164449891448267e-02   +5.540097514686990e-01   -1.032137300298802e-01   +6.335733053256579e-01   -5.836319659191688e-01   -2.029288381033119e-01; -4.481638339688783e-01   -6.267119834173797e-01   -2.872531176995943e-01   +3.532172393193073e-01   +5.107098123973645e-01   -2.465442776787665e-01   +3.988315949032984e-01   -2.693506065673790e-01; +9.866255016599453e-01   +2.526383240706228e-01   +7.799546405922326e-01   +2.632810318975036e-01   +8.828299170920767e-01   -3.534799406087025e-01   -2.205171239982628e-01   -1.350199020034611e-01; -6.112966067510830e-01   +6.471442643189683e-02   +1.292511852955655e-01   -1.075260964459270e-01   -4.874693971561317e-01   -5.889737480608599e-02   -3.622963624585923e-01   +1.472633641022371e-02; -2.665650615481356e-01   +6.238278578014437e-01   -7.637389635771117e-01   +3.920025191059631e-01   -5.279150109806314e-01   +7.446670871381227e-01   +1.372923074416247e-01   +7.759285380534356e-01; +6.211431732743280e-01   +1.164948676576305e-01   -7.466781258723737e-01   -4.024133570873005e-01   +5.650821222144732e-01   +5.763394032649996e-02   +2.597778510798688e-01   +2.144204891271636e-01; -2.047818811604672e-01   +2.274678247894280e-01   +5.167340512808091e-01   -5.505406356597363e-01   +1.947268474562077e-01   -2.491772932342905e-01   +1.000000000000000e+00   +2.796904117799413e-01];
L3E_L2E_iAMPA_netcon = [+4.662216714332748e-01   +7.504424850849012e-01   +2.830570258246622e-01   +2.010069720815016e-01   -2.061251272575703e-01   -2.375951982853766e-01   -2.301993829108554e-01   +2.380151729178371e-01   -4.893875915347263e-01   -4.202051756718921e-01   +1.234903506129301e-01   +4.307383147615937e-01; -2.288992130803379e-01   -2.674966810586446e-01   -1.678579436028702e-01   +9.302005917613362e-01   -5.060935618159574e-01   +1.171575372291237e-02   -5.900257595140528e-02   +1.206336437508277e-01   +3.225273062839263e-01   +3.353556185832702e-01   -2.131305498351933e-01   +2.748231489555011e-01; +4.723195588961568e-01   -1.389244397365493e-01   +2.951212199692749e-01   +6.182994888896884e-01   +4.613734765613300e-01   +7.085285910557174e-01   -2.631869292588734e-01   +7.288386393609347e-01   +3.532225901049150e-01   -2.263466281383339e-01   -6.727451198660545e-01   -7.519335115817004e-01; -4.922159427768888e-01   -3.607947908499662e-01   +5.976228077675657e-01   +5.356429674619273e-01   -5.371549647807301e-01   -2.415020506244412e-01   -8.079433109846546e-02   -4.670915263226055e-01   +1.349104947373193e-02   -5.181751123424834e-01   +2.228455946014969e-01   -7.543496206956252e-01; +7.222487664281485e-01   -2.842989905720976e-01   -6.001700367402732e-01   +2.139581409451836e-01   -8.171049222194703e-02   +1.593064534621751e-01   +1.000000000000000e+00   +2.263286613009772e-01   +2.193381669627128e-01   +3.537958465931612e-01   -3.957474068216096e-01   -3.179675452001156e-01; +7.016447048879551e-01   +3.117916770801201e-01   -4.623427099901631e-01   +7.991330857647423e-01   +7.276364868810922e-02   -4.304275017827740e-01   +2.699305332203252e-01   -3.735837905966332e-01   -6.347658473369034e-01   +5.274246270049526e-01   -6.646622991156681e-01   -3.171378117279959e-01; +8.236097633854406e-02   +4.147496445232506e-01   -6.489222723450473e-01   +1.604053845191767e-01   +3.905736832501215e-02   -3.209719274555997e-01   +2.066630263350436e-01   -1.110940551558958e-01   +2.191442330655551e-01   -3.964883230291439e-01   +2.635746597160503e-01   -5.004902213985559e-01; +1.394688387425201e-01   -7.674924439105256e-01   -2.857194403309168e-01   +2.632830130504072e-01   +5.206286968291047e-02   -1.205894723023618e-01   -5.668716240946264e-01   -6.148115608917860e-01   +4.254957229332369e-01   -4.355260121946648e-01   -5.329978033450417e-02   -6.705670902906603e-01];
L3I_L2I_iGABA_netcon = [+2.303897143264796e-01   -1.381249737404041e-01   -7.750666795792338e-01   +4.635914326310902e-03   -4.123393961748451e-01   +3.895918079465994e-01   -6.897292907105770e-01   -1.899196194105836e-01   -4.160312070223754e-02   +7.744662077004514e-01   -5.023839755610986e-01   -5.239993789369330e-01; +1.219443698831789e-01   +5.337781006429313e-01   +4.766922090965620e-01   -6.682104691260166e-01   +1.343977969787792e-01   +1.269491016896621e-01   -2.137799010682552e-03   -7.990405892312784e-01   -2.307960986186935e-01   +1.465409890546759e-01   -2.890164609429892e-01   +1.997263235127061e-01; +3.915575562965824e-01   -7.552581356461191e-02   -5.760106241467493e-01   -4.020929368955318e-01   -1.969508640728731e-01   +2.194999552023292e-01   +4.330324261031491e-01   -1.266388903860073e-01   +3.603961363731730e-01   +6.733794470225407e-01   -7.665824669171292e-01   -5.219196252739566e-02; +4.412794752994150e-02   +9.407036818555605e-01   +1.000000000000000e+00   -1.300933369568534e-01   -5.185224790979539e-01   -2.736942359815312e-01   -4.020919252052240e-01   +2.223868751085107e-01   +6.036340445803650e-01   -2.525158871141299e-01   +5.952319167075940e-01   +3.758277970528419e-01; +4.826468739122240e-01   +1.739070229230272e-02   +1.170287974094972e-01   -5.334229816769027e-01   -4.122159535399038e-01   +7.084718670277944e-01   -6.100567793901222e-02   +4.766540415230978e-01   +9.596621609774424e-01   -3.862226580767482e-01   +1.692594448946681e-01   +7.592797302125132e-01; -7.594020220060745e-01   +7.215002888131976e-01   -6.947309776815001e-01   -5.870990791682847e-01   +6.362035922740766e-01   +8.606696081475532e-02   -7.900755552567518e-01   +3.221514547778854e-01   +2.424107443437175e-01   -3.146119185263012e-01   -1.537635645151848e-01   +5.352402377754818e-01; -2.176640779048980e-01   -4.472278852030984e-01   +4.054275110280695e-01   +3.227656384649531e-01   +1.904716274244807e-01   +3.776261947194628e-01   +8.042649384282926e-01   +6.865698549229248e-01   -4.857937689501475e-01   +1.639339367934382e-02   +1.655697655068703e-01   -1.177449426750246e-01; -2.836994327538613e-01   -2.263813385811971e-01   -5.456845237999081e-02   +5.404742334828173e-01   +2.637186500153381e-01   +1.074036588356491e-01   -5.090591464905724e-01   +4.637916477113511e-01   +3.735336278359085e-01   +4.336104073450037e-01   -1.495703755700258e-01   +3.992274326560155e-01];
L2E_L3E_iAMPA_netcon = [-3.450354440108691e-01   +3.162709729605697e-02   +8.141240333951987e-01   -2.745815316494687e-01   +4.383816506199739e-01   +4.996091060240569e-01   -1.315090790713589e-01   +7.590377373104430e-01; +5.730839607072896e-01   +5.395685580885603e-01   +1.107983551011827e-01   -8.474647521095016e-01   +6.022503325261755e-01   +4.907608449821950e-01   -6.936004872639497e-01   +4.273171030397958e-01; +7.539280533986009e-01   -4.175358310931995e-01   -6.807429305389988e-01   +8.503890739802701e-01   -2.528927621086138e-01   +4.650241767073519e-01   +2.253513020792806e-01   +4.676762627715693e-01; +4.253903327931728e-01   -3.363191600016254e-01   +3.416501781268577e-01   +2.552064146302492e-01   -1.708981786194559e-01   +5.072275155979818e-01   +5.477894201559647e-01   +3.349939297442298e-01; -1.612534188741389e-01   -2.057774771837285e-01   -2.606413971291923e-01   -1.522431523610949e-01   +1.000000000000000e+00   -1.406056139798235e-02   +3.943779652665179e-01   +1.898960405755291e-01; +6.355794019456157e-01   +6.362763604739254e-01   -8.344294840070161e-01   +3.240718086047671e-01   +2.718067581049968e-01   +4.761235133507932e-01   -6.765247815566950e-01   +1.495139760831669e-01; -4.961425180988090e-01   +3.317665858181479e-01   +8.234582355280451e-02   -2.554061517209683e-01   -7.541349792575536e-01   +1.070596327246375e-01   -1.546159079711519e-01   -8.352006701981000e-01; -4.687316848140994e-01   -2.181877899231695e-01   +4.219111403632682e-01   -2.856023575796902e-01   -4.519949588207940e-02   -2.227575019582364e-01   -4.263165329209258e-01   +8.001018248584757e-02; -1.062732110389889e-01   +4.035861694586791e-01   -2.779338679348375e-01   -8.870010133230828e-01   -4.250295697364623e-01   +2.766367886139843e-01   -1.347415331850770e-01   +4.811892069387665e-01; +7.370253626448598e-01   -3.402245103020951e-01   +6.148444451833615e-02   +3.784344668204702e-01   -2.860687210110943e-01   -2.905861328827119e-01   +6.690181150160461e-01   -6.355822785625819e-01; -8.196828662740267e-02   -5.776609106947590e-01   -8.840052794910399e-01   +1.292393306877086e-01   -2.459345709388882e-01   -4.659372373609478e-01   -6.357700921812105e-01   +2.593299998972273e-02; +7.009124133109896e-01   +1.657481891116568e-01   +2.174981142134347e-01   -1.970687051147002e-02   -4.494725748720146e-01   -3.054890107033503e-01   -6.594019270351483e-01   -4.502118171759896e-01];
L2I_L3I_iGABA_netcon = [-1.370621735559888e-01   +4.823324757798693e-01   -6.684108129030797e-01   +8.951788387937461e-02   +3.991266657383294e-02   +2.353552936446645e-01   +8.635004933061700e-02   +8.608793270307816e-01; +1.817636645967773e-01   -3.309420132409726e-01   +6.730582613253266e-01   -2.776781535051355e-01   -5.068919612045717e-01   +8.517603807033083e-02   +1.807710624058407e-01   -1.046927336482446e-01; -1.818622450716986e-01   -1.849206259032889e-01   -3.068303120472241e-01   +4.291317853103343e-01   +1.329663522378209e-01   +1.056427440292423e-01   +2.727611463919820e-01   -3.486469436470559e-01; -6.031774402215933e-01   -6.664399764849677e-01   +2.017446161697573e-01   +5.488607101688031e-01   +7.880829466227328e-02   +3.450199578466095e-01   +2.666514900010655e-01   +8.412481177555882e-02; +3.403003284923068e-01   +3.480596364971678e-01   -3.040511386208237e-01   -6.652893147545927e-02   -8.697635706346740e-02   +4.688149385539456e-01   +8.501616022049076e-02   -5.552675406345853e-01; -2.978376811452862e-01   -1.578307175617963e-01   -6.986764469490068e-01   -2.049595410278744e-01   +2.496310327765525e-01   +4.536717618223780e-02   +2.472223422757809e-01   +1.342870965265185e-01; +8.904638385085613e-02   +5.941163069628985e-01   -8.909491791310245e-02   -4.983016743139108e-01   +1.000000000000000e+00   +2.924625644948758e-01   -2.574653606127646e-01   +5.507905195140830e-01; +6.589983668873184e-01   -9.733550547803939e-02   -6.506020001333485e-01   +4.349216606446956e-01   -5.508116107048330e-01   +6.287193421762892e-01   +4.199624099942948e-01   +2.963037816914360e-01; +6.703281869840881e-01   +7.603280180380387e-01   +6.990512571974540e-01   -3.223823764645063e-01   -9.122363165525181e-01   -3.006796209997708e-01   +2.567018984242257e-01   -1.738419981934144e-01; +2.834422609304742e-01   -8.278958427571406e-01   -4.673613982569947e-01   +1.337545666239597e-01   +2.826355200485031e-01   +7.050752883347827e-01   +1.515483708978265e-01   -1.755968172465922e-01; -3.623616661968547e-01   -4.567966686274847e-01   -2.064349716055629e-01   +6.547751607452320e-01   +6.668753688992805e-02   -5.054777645069048e-01   -6.633385311893767e-01   -2.065162367815502e-01; -2.361790626236197e-01   -2.004985634666988e-01   +5.282916919949259e-01   -6.548336564042098e-01   -5.573614074662592e-01   +3.080123068344340e-01   -3.210573933957989e-01   -7.972842246429672e-01];
L3I_L3E_iAMPA_netcon = [-6.195599577927772e-01   -3.014289141845386e-01   -1.764150804337770e-01   -6.454285307884373e-02   -4.171565747821759e-01   -7.942240839666519e-01   -1.418985509239546e-01   -7.129479483532911e-02   +5.854304970101614e-01   -7.959286731883264e-01   +7.603340869695915e-01   +5.967015624365015e-01; +1.313217436552378e-01   +2.773878746793856e-01   +6.200554548668792e-01   -6.408828561518986e-01   +8.011864829612605e-01   +8.164169695410560e-01   +2.392910719427715e-01   +6.948154871438220e-01   +7.437195841909590e-02   -6.954299700871553e-01   -8.399214965222119e-01   -1.920136935143479e-01; -5.011053476266578e-01   -4.377478695550543e-01   +2.038062104430557e-01   -5.355720804308783e-01   -1.482507016858884e-01   +7.928520786660158e-01   -6.772057902363867e-01   -6.811318762768297e-01   +3.109164595306766e-01   +5.986995961770017e-01   -4.867985757539615e-01   -2.145215502984009e-01; -2.158674928301738e-01   +1.075280179287280e-01   -3.566409278142535e-01   -7.236330832999819e-01   +3.012944527202905e-01   +1.481014471024732e-01   -4.389680331222534e-02   +9.613533730125083e-01   +1.242401715548292e-01   +2.023041807954985e-01   -5.068675668819256e-01   +3.080501527917219e-01; +3.503923782326105e-01   -9.913111929141982e-01   -3.910654574104714e-01   +1.593534259452153e-01   -6.740895728053162e-02   +6.584641436007077e-02   -4.310458121862226e-01   -8.699768839909036e-01   -5.870319080587371e-01   -3.891510334840766e-01   -6.747992374024792e-01   -6.777634025251186e-02; +7.462773088649219e-01   -2.064235417965827e-01   +5.617540007804971e-02   -2.403650922860915e-01   -4.815421149741984e-01   +8.520757662940678e-01   -3.518068630714656e-01   -5.085979832918168e-01   -3.599813390698013e-01   +1.728776336126997e-01   -4.321133573554812e-01   +3.649291746743148e-01; +3.089067676114581e-01   -3.286547389102291e-01   +4.704684156775434e-01   -2.276050071585791e-02   -1.000000000000000e+00   -7.587891890342298e-02   +5.994435550558044e-01   +7.304385998015718e-01   -3.233416235501343e-01   -2.427429791716304e-01   -1.033001627442219e-02   +6.062250307038467e-01; +8.990502974115538e-01   -8.039787844226669e-01   +7.856083128591430e-01   +8.631300544557886e-01   +7.615478515995072e-01   -8.834274147563471e-02   +2.487004200388753e-01   +1.580691669866978e-01   +3.192541955353108e-01   +4.882470564594982e-01   +7.045269943661603e-01   -7.634713651177015e-01; -5.701297535611776e-01   +2.832454066647226e-02   -4.310254740572965e-01   -2.354074876264557e-02   +1.776586861941351e-01   -2.944292767981157e-01   +9.424973904968692e-02   +4.010772375589604e-01   -3.427296079948355e-01   +7.132788995258975e-01   -3.139641367141427e-01   +4.765874186978736e-03; -5.248407481765249e-01   +6.184138573619898e-01   -7.809533092442755e-02   +3.366043469595023e-01   +6.383936429156592e-02   -1.430732511777048e-02   -1.027813210022925e-01   -9.992455314051170e-02   -1.417554399237216e-01   +6.663346778473046e-01   -6.888829011085159e-01   -1.291260136877224e-01; -1.489985553256509e-01   +4.231556889071436e-01   +2.297975526393524e-01   -6.119809868107069e-01   -4.481519090940762e-01   -7.860090508922889e-02   +7.824877443907834e-01   -1.807044679162394e-01   -1.188037364896192e-01   +1.426179261962856e-01   +2.945995672885918e-01   -1.551569514315960e-02; +3.125390901210353e-01   +3.488222197834405e-01   +1.898865930872468e-01   -6.974629520214727e-01   -7.569658370259523e-02   +3.239167487626094e-03   -7.427921928704460e-01   -4.058780167499890e-01   -1.194278258288180e-02   -2.985424171672770e-01   +7.190400123350984e-01   +7.735822438662493e-01];
L3E_L3I_iGABA_netcon = [-2.138819373375954e-01   -1.828333570250064e-01   +1.212189723596697e-01   +4.848274981668862e-01   +1.012256941874428e-02   -7.061361497016949e-01   -1.498891031067474e-01   -1.673569168220109e-01   +4.910325537380535e-01   -2.979994406648265e-01   +4.639208491655331e-01   +3.617848270265649e-01; +9.584739877190125e-02   -2.233320143012900e-01   -2.268320241140953e-01   +3.375619893674336e-02   +5.128090515176605e-01   -1.978891424152234e-01   -2.673654388797662e-01   -5.124738158812889e-02   +5.828930815765976e-01   -3.688607555247154e-01   +7.644984785123157e-02   -6.031321348364505e-01; -1.319353494788387e-01   +1.450824721151107e-02   -2.873646449524876e-01   +1.341220970499097e-01   -5.744845038214881e-01   -2.122622676932927e-01   +2.904266562250591e-01   +4.207269618870906e-01   -5.934768072294642e-01   +4.081505211287573e-01   -1.255354405473746e-02   -5.911213777098865e-01; +5.491965694055332e-01   +5.954735132126133e-01   -8.095711950693861e-01   +4.690645038340328e-01   +1.527518113815615e-01   -2.370126123038338e-01   +1.872625973478119e-01   -5.259629115666787e-01   +3.331416994151585e-01   -2.655353415138283e-01   -7.355532249020839e-02   +9.261297039028041e-02; -7.287555358524814e-02   -2.061740901243712e-01   -7.749018260438668e-01   +4.921179958198191e-01   -6.065059061178975e-01   -5.344813131398303e-01   -6.808102344062849e-01   -3.429325758256576e-01   -5.631443217291053e-01   +3.417690409599231e-01   -6.974544296891988e-01   -4.727658221646486e-02; +2.022858291316185e-01   +2.604964074440843e-01   -3.813394312102465e-01   +7.200845784983591e-02   +4.106776551174662e-02   +3.668630427078124e-01   +3.020457088637834e-01   +1.155037953434341e-01   -4.827891955624092e-01   -2.433983561659583e-01   -5.353384263863205e-01   -3.022014023725215e-01; -3.148545465982982e-02   -3.038456052898783e-01   -2.028297715462485e-01   -5.373168567872091e-01   -3.477565461447452e-01   -1.091805792598902e-01   -4.674654902652976e-01   +2.284059088290407e-01   -8.558298894847353e-01   +3.375701342582429e-02   -5.571715450840274e-01   -2.287181593090157e-01; +1.893881925993749e-01   +2.083418583382391e-01   -1.486781306520430e-01   +2.186153078885676e-01   +3.766819267692934e-01   +3.158539670472955e-01   -2.796789181327383e-01   -3.905025841395183e-01   -4.258574554015571e-01   -2.490819419120714e-01   -1.000000000000000e+00   -2.944743529494037e-01; -3.675593404764163e-01   +3.758267708886555e-01   +1.809063501382499e-01   +2.636830393125361e-02   -2.045251565662974e-01   -6.782438771898747e-01   +4.131940890038001e-01   +3.792105662199421e-01   +4.111652404962456e-02   +5.648523809743284e-01   +1.384316661196084e-01   -6.992055083897417e-01; +1.072805558734756e-01   +1.283457792364827e-01   +8.615793049810697e-02   +3.481934339390589e-01   +1.963098397432366e-01   -1.259742798904447e-01   -1.422912184918011e-01   -4.176267907558813e-02   -5.366133192886731e-01   -2.247475762622945e-01   +5.079244921863029e-02   +3.088146331549559e-02; -5.560241487291812e-01   +9.077047232591849e-02   -2.192060711242033e-03   +2.768290872448780e-01   -1.149734841116036e-01   -2.099641816770994e-01   +2.189848390050596e-01   -5.385954226424520e-02   +1.800550066755687e-01   -3.252817226385857e-01   +3.865858294246923e-01   +2.839624584792324e-01; +4.797644294368511e-01   -1.948804198960397e-01   +6.527017210983632e-01   -2.441290683598030e-01   +2.753838611512848e-01   -2.333390469318882e-01   +1.176885574600502e-01   +3.413105819456619e-01   +4.619096336985940e-02   +7.353935784537231e-01   +3.183839693003445e-01   -3.219794668536612e-01];
L2E_Input1_iAMPA_netcon = [-8.895116509474933e-02   +1.558692843627769e-01   -2.793005035983689e-02   +7.895866051931687e-01   +1.000000000000000e+00   -1.452913506058933e-01   -4.536956183135248e-01   -3.148878313879395e-02];
L2I_Input2_iAMPA_netcon = [-2.200924188081990e-01   +2.663502105123041e-02   +7.228947824517294e-01   -9.124013389384998e-01   +5.571496611160659e-01   -4.285022098902819e-01   -1.000000000000000e+00   +4.820879025811258e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
