function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.178658110782457e-01   +5.768243818516355e-01   -1.045079399978521e-01   +1.061504825775211e-01   +2.256053006746619e-01   -3.443078656525156e-01   +6.294653189960484e-02   +2.103881786726252e-01   -2.536952606151284e-01   -5.272136308251294e-01   +1.618516253422788e-01   -4.622205418676707e-01   -2.277517214407173e-01   -5.541281729938230e-03   -7.328378699541480e-02   -8.995592004905639e-02; +4.922711524969219e-01   +6.698135900409463e-03   +1.560733157793842e-01   +6.757197079541229e-02   +1.503552736793036e-01   -1.378560962841058e-01   +5.020000504839497e-01   -9.130332685384843e-02   +1.130569309158347e-01   +2.181389272556167e-02   -3.001135629181906e-01   +9.811224413011316e-02   -3.117233463757610e-01   +4.333223757597488e-02   +1.876287771840145e-02   +1.896880348542213e-01; -1.122232532997869e-01   -3.493140127383808e-01   -1.488864511861150e-01   +1.458792991745738e-01   +1.574339740795374e-01   -5.885292729477830e-02   -1.263026303297526e-03   +1.492764873180353e-01   +6.117553846320676e-01   +7.039899756244472e-03   +1.445821950818854e-02   -2.100636193981487e-01   +3.104400406934003e-01   +1.196081443395387e-01   +4.016780507001824e-01   +5.448379054542226e-01; +1.882015883422775e-01   +4.087369814018233e-01   +2.589750361906117e-01   -3.376047299442452e-01   +1.418252313738467e-01   -1.583086379596524e-01   -1.426933845245691e-01   +1.041293081078995e-01   +7.818242299039656e-02   +1.924879034808077e-01   +3.570711670293852e-02   -8.396148079144630e-02   +1.656368974362960e-01   -2.702430815022819e-01   +2.245916639376238e-01   +5.453512919846983e-02; +1.364238219156876e-01   -9.944704728642828e-02   -2.569177198128242e-01   +3.027745403878728e-01   +4.745903296506784e-01   +1.627437012319913e-01   -3.353592178568355e-01   -2.496791146094531e-01   +1.827054675171168e-01   +6.705186105187394e-02   -6.600019889501071e-02   +2.194973726588345e-01   +2.521926498239641e-01   -2.266909516528801e-01   +6.609871400649503e-01   -3.531009131701024e-01; +1.953721626670528e-01   -7.173390127152435e-02   +4.613811731059807e-01   -4.407431040399080e-01   -4.450589816195764e-01   +3.922775396661492e-02   +3.284033686209500e-01   +3.007926102244384e-01   +5.387203353637373e-01   -2.852131253658160e-01   +4.306227685334282e-01   -3.118696378491511e-01   +2.541484473839202e-01   -2.271108722056946e-01   +4.018980048841800e-01   +7.951573731826941e-02; -1.255897126490813e-01   +5.677869700662665e-01   -1.338752156911927e-04   -3.169742916185475e-02   -1.636679569152596e-02   +2.321207758600094e-01   +3.997186486378868e-03   -4.144387685711236e-01   +1.026161673289171e-02   +7.532455503057983e-02   -5.028267934686527e-01   -1.027894810411024e-01   +2.874885597560367e-01   +4.827535721286836e-01   -1.429008989013613e-03   +3.639599704293052e-01; -8.769517238841076e-02   +2.252693104746817e-01   -9.692769172569347e-02   -6.240219417682188e-02   +4.658971587322512e-01   +4.538705157685615e-01   -3.223029670963080e-01   +3.662510609253041e-01   +5.442893705277891e-01   -2.622558918576463e-01   +3.776150555381413e-02   -2.011986218300308e-01   -1.175794010906255e-01   +9.570083858351319e-02   +1.839079949442346e-01   +3.588397540874976e-01; -1.980244129311432e-01   +7.330583979815142e-01   +2.161258625776887e-01   +4.641205719436976e-01   +5.087201872087907e-02   +6.473065624759240e-01   -8.653929335540567e-02   +2.886823515777743e-01   +8.763269287771923e-02   +3.560881804284742e-01   +5.562292250090410e-02   +1.175038310177487e-01   +2.474979688201245e-01   +1.029336485863830e-01   +6.857245939264481e-02   +4.300693554660270e-01; -1.632732952635007e-01   +6.303286050163491e-02   -1.497692060508211e-01   +4.437871219196032e-01   +2.396695381183290e-01   +6.276297059192781e-02   +7.043985935117363e-01   -2.724889882148049e-01   +2.954199011603963e-01   -2.762920037525528e-01   +5.108133551969252e-01   +2.331914330372456e-01   +2.242913675529426e-01   +2.500641129109333e-01   +2.785178979270458e-02   -1.245129159849400e-01; +2.812130753170033e-01   +4.950517396534293e-02   +9.504325218919650e-02   -1.872437326816591e-01   +8.492370248415901e-02   -3.598805873927969e-01   +3.106728559153203e-01   -2.906765433238565e-01   +1.859647927080926e-01   +6.760615331572101e-02   +5.559583150368979e-01   -3.164906270650540e-01   -1.895739338657527e-01   +1.190695361789815e-01   +4.479286895269646e-02   +3.102501199570073e-01; +1.887658148054717e-01   +3.460911741868214e-01   -5.293294284847377e-01   +5.085592941519119e-01   +8.517467973789550e-02   -4.971943504316138e-02   +3.697772055891286e-01   +2.098435285300840e-01   +9.679644648956195e-03   +9.585557638094126e-02   +3.834723153567954e-02   +4.487349105176888e-02   +2.749444282853938e-02   -4.730920737037447e-01   +1.167971171730730e-01   +4.741586327372193e-01; -7.501125070239262e-02   +2.866726282835156e-01   -2.619288475431045e-01   -1.170606329127239e-01   +3.653561271358515e-01   +1.504170442234237e-01   +2.008819303896243e-01   -3.105554286263553e-01   -3.025008280355977e-01   +1.835576159303957e-01   +5.914338515718470e-01   -1.836678400683665e-01   +1.048971368545360e-01   -2.062276348018626e-01   +5.992261287956512e-03   -1.244023736296966e-01; +3.590995362075298e-01   +3.540444523674427e-02   +4.496228283962341e-01   +4.129033658925390e-01   +5.778673861423558e-01   +2.011278011528714e-01   +5.840913784384361e-01   +1.847293167971037e-01   +7.885219434569769e-02   +4.377270196852258e-01   +5.573673568933107e-02   +5.938973495383471e-02   +4.992221995825860e-01   -1.682553266897590e-01   +5.721255896769055e-01   -2.296114471482338e-01; +2.123729287176590e-01   -1.289962177488945e-01   +8.624720336757180e-03   +1.366986804681579e-01   -1.344760259130877e-01   +2.014289634725019e-02   +2.662711966189734e-01   +3.858042655182111e-01   +3.320715956204566e-01   -9.589984249858863e-02   -9.687894255939106e-02   -1.045894274610226e-01   +2.678781361432435e-01   +2.034826070931081e-01   -4.526567404305660e-01   -1.972547862570184e-01; +5.053768713298000e-02   +1.922163609354035e-01   +1.899768679709337e-01   -1.837618241055463e-01   -1.728679883945359e-01   -3.527126389271286e-01   +6.631303442142659e-01   -2.034254851273575e-01   +2.838483697239259e-01   -1.332262682303429e-01   +4.887902759939300e-01   +2.374727713616177e-01   +3.140077834584057e-01   -3.086849709071259e-01   +2.136400799191973e-01   +3.129020646553832e-01];
L1E_L1I_iGABA_netcon = [-3.846717458744070e-03   -9.063884263160729e-02   +2.048477504064810e-01   -1.173620394789589e-01   +1.906145781126456e-01   -2.643053840340972e-01   -1.694294791754491e-01   -2.106697644005270e-01   +5.116437021104272e-01   +1.119935040980014e-01   -2.278771206505892e-02   +4.788046765813024e-01   -4.229742111706403e-01   -3.669896187733324e-02   +1.379051567911961e-01   +3.552375030126898e-01; -1.655274359470034e-01   +4.626719672412809e-01   -8.689492038899353e-02   +1.042406065748895e-01   +1.156462681969154e-01   +3.461029544508806e-01   -4.114032643794645e-02   -5.094773702920568e-01   +3.475677833335692e-01   -2.929880620291266e-01   -3.191274181746147e-01   -2.003448102731597e-01   +2.143531717144602e-01   -3.964009713609844e-01   -1.354250234111169e-01   -2.953803314686090e-02; +4.869441166465099e-01   +3.000310878517050e-01   +2.480481575865618e-01   -2.475182858727372e-01   +3.123486675646439e-01   +5.050592202421633e-02   -1.702245481277625e-01   +6.992542886148634e-01   +5.068372283874714e-02   -3.501375457740770e-01   +5.812167088485435e-01   -2.306939333455186e-01   +2.245491068349419e-01   +4.361286614891293e-01   -1.976495111731667e-01   -2.853552804328981e-01; +4.802561311846085e-01   -3.918082287497796e-01   -1.433563325837726e-02   +6.095698646897794e-01   -7.675554741731910e-02   +2.864532207471966e-01   -1.685587480396117e-02   +8.219036706083083e-02   -2.997974357512462e-01   +1.488792758955815e-01   +4.556908621816074e-01   -8.985704804204817e-02   +2.327829540500766e-01   -1.510271814340881e-01   -1.977731670809662e-02   +2.044044820915764e-01; -2.084151942146512e-02   -2.777836050750606e-01   -4.251083333215294e-02   -1.115891728095159e-02   +1.438685446642694e-01   +9.634542917206390e-03   -1.781701691889828e-02   +3.522293220148738e-01   +1.198036219947646e-02   -1.806437008562108e-01   +9.499014896329000e-02   +4.090417378423739e-01   +2.825485645163111e-01   +4.596458377053501e-01   -3.884591988982364e-01   +1.747591336681820e-01; -8.787633045246487e-02   +3.965004753500270e-01   +3.706064618566738e-01   -1.331993395460566e-01   +3.189783007407711e-01   -2.488419489425137e-01   +2.946340775268670e-01   -4.353912470599703e-01   +4.855834093336655e-01   -6.073799067739354e-01   -3.342600868758378e-01   +2.063930071023165e-01   -1.149608134470196e-01   -1.398159180731250e-01   +4.685191929966306e-01   -6.051489512421737e-02; +4.190247845888790e-01   -1.991131511474053e-01   +3.385120764986139e-04   +4.959927459786004e-01   -2.995451597108467e-02   -3.461231765434268e-01   +2.686250805307407e-01   -6.308966921179318e-01   +1.577800033985897e-01   -1.161835811724130e-01   +1.953943801730796e-01   +8.204625135560042e-02   -1.324057118153531e-01   -8.965001748051490e-02   +1.075591082306284e-01   +3.207118553898064e-01; +7.803790071280789e-02   +5.252051783390816e-01   -1.107201598062456e-01   +3.771940647942155e-01   -4.905667122555181e-01   -3.515658119408268e-02   +2.361139376135148e-01   -2.177659593221846e-01   +4.587672530619766e-01   +2.036745162141537e-01   +3.162061179777079e-01   -7.913062776810093e-02   +2.303818861540142e-01   -2.215163068710547e-01   -1.639129076908691e-05   -2.140307085938899e-02; +2.323265636705882e-01   +1.224704230237502e-01   -2.016310647069909e-02   +3.642435382631223e-01   +4.940132107565069e-01   +6.644329200636963e-01   +1.128408869156558e-01   +3.630217602145932e-01   +5.522726406103117e-01   +3.649855364971660e-02   -3.105736439116866e-01   -1.896096906801865e-02   +1.194085568563482e-01   -1.861114286313965e-01   +1.674587847557225e-01   +5.888606780609595e-02; -4.974470515295464e-02   +4.316675630011345e-01   -3.178337202787619e-01   +3.565920259538642e-01   +5.322999639293413e-02   +2.712401489442904e-01   -5.046032217819445e-02   +4.001639031011349e-01   -2.238796722887375e-01   +2.205828055422220e-01   -1.663085771840895e-01   +5.132405531750028e-01   +7.070258002851926e-02   -2.314620786625755e-01   +1.939859785485970e-01   -6.662924120700209e-02; -2.087412328686681e-01   +2.652159155702888e-02   +6.166156308705797e-02   -5.534245783249688e-01   +4.530079848198194e-01   -4.161262602085636e-01   +7.437033509829960e-01   +2.829206426970084e-01   -3.598598680061904e-01   +4.146638562936028e-01   +2.605852828863492e-01   +4.638531917322753e-01   +4.283945639259163e-01   -1.740087579437033e-02   -5.597187925466429e-01   -4.217809298219661e-01; +4.860126613841630e-01   +2.064343945488704e-01   -1.634714720508634e-01   +2.504545138146134e-01   -3.180647703913945e-01   +8.270882402619253e-01   -1.314378658935154e-01   +1.052321415043848e-01   +5.001970628520819e-01   -1.900448298008877e-01   -1.956921725983870e-01   -4.225952165852469e-02   +4.542394090530353e-01   -9.639552931873714e-02   +1.995295550416340e-01   +4.907959010641035e-02; +2.470908273508929e-01   -1.339166114819665e-02   +2.766851821689227e-01   -1.284770470155621e-01   -8.023984783439912e-02   +7.240425825416044e-01   +3.720943932447980e-01   +1.202074682127398e-01   +2.029476260720912e-01   +5.452433930603957e-01   +7.212807022897796e-01   +6.476437049140590e-01   +3.372423501261538e-01   -1.084688797669126e-01   +2.387433662388161e-01   -2.996424213648872e-01; +6.079081823119947e-01   +1.316248205925826e-01   -2.745115622030088e-01   -9.403380630383150e-02   +1.540280197483382e-01   -2.241834949267514e-01   +1.677834364047153e-01   -1.096991819602454e-02   +5.993260064465622e-01   +2.082443859892109e-01   -1.087201528198751e-01   +3.672338548523422e-01   +4.145758904596550e-01   +3.070376999341050e-01   +3.319402761536938e-02   +3.676340642127969e-01; -2.221911577915353e-01   -6.339690961505370e-03   +3.462175090915459e-02   -2.466565407030432e-01   +7.825244179012394e-02   +1.101620514710123e-01   -5.548486256977796e-01   +2.073861589792066e-02   +8.277003567460661e-02   -1.231107368894992e-01   +2.472960652383559e-01   +1.626819688363862e-01   -1.295913026822376e-01   -1.638427842563875e-01   +2.634189630086285e-01   -1.002028499551906e-01; +6.805118095228799e-02   -7.891006580460090e-02   +3.876482756189150e-01   +2.318450479346549e-01   +1.729091189627812e-01   -1.278301682665468e-01   +4.092070480047488e-02   +1.891487247371684e-01   +1.903773963302135e-02   -3.122491575797159e-01   -3.773448066068164e-01   +4.021972227018297e-02   +4.524188747782907e-01   -2.644621873645331e-01   -2.360735284806046e-01   -4.074413115338432e-01];
L2I_L1I_iGABA_netcon = [+4.501155984276428e-01   +3.525101256900848e-01   -2.136946939879353e-01   +5.407601542503712e-01   -1.635920500472581e-01   -1.842294581755847e-02   +5.189308912299787e-02   +3.826797708688700e-01; -3.613283034323179e-01   +3.641238826099055e-01   -8.595652846914284e-02   -3.607285463250485e-01   +2.753825731389934e-01   +5.311513391641350e-01   -2.266267061445956e-02   +6.601530324505485e-01; +3.388992644640699e-01   -4.868511154146649e-02   -4.634962212846849e-02   +1.735317676147073e-01   +7.617949521653747e-01   +2.472203247032140e-02   +1.503790447271862e-01   +6.690949829097242e-01; +4.168500615604231e-01   +1.568772677072814e-01   +3.795870053203013e-01   +1.862135256542106e-01   +2.559886298496116e-01   -3.730105482620268e-02   +3.604405913894604e-02   -3.006943754733419e-01; -3.874365452821216e-01   +2.463996200434743e-02   +3.533798501809666e-01   +4.249652731872447e-02   +1.883569618746001e-01   +1.212489912055145e-01   -3.106825431927456e-01   +6.080147823886908e-01; +2.230543925207559e-01   +1.232551457726560e-01   +2.575055146380334e-01   -2.957851121795324e-01   -1.971193254797759e-01   -1.868040780877030e-01   -2.245973570478610e-02   -5.398020756168426e-02; +3.513487279071213e-01   +1.576725185072506e-01   -2.923727310875147e-01   +2.849674705384496e-01   -1.748897421314912e-01   +1.387978893235450e-01   +1.182011954409523e-01   +5.118096284110789e-01; -3.950781914099729e-01   +3.397235305190185e-01   -1.859773047149735e-01   -1.436257635879308e-02   -1.315141613239957e-01   +2.826506205894233e-01   +1.609339573190721e-01   +1.612458404863391e-01; +1.655772386658508e-01   +4.804862797194274e-01   -2.304542011659518e-02   -2.833860937331092e-01   -1.879231975726390e-01   -3.471986149796978e-01   -2.455108192507575e-01   -2.143242420976540e-02; +1.959499164162426e-01   +5.935581255566705e-01   +2.609495858241926e-01   -5.636846600901639e-01   +2.046362620522487e-01   -9.194863148068688e-02   -2.058211720033845e-01   -1.059489540766492e-01; +8.778533010138229e-02   -6.854271376513707e-02   +4.756939590148990e-01   -2.290913448711733e-01   -2.650892155838184e-01   +1.179294196441435e-01   +3.556647012670886e-01   +3.291564155103798e-01; +2.538012903885229e-02   -2.610886721480221e-01   +4.988372704573446e-02   +2.010284589023624e-01   +8.494744687432407e-02   -1.858041214734295e-01   -4.715076247020658e-01   -2.413849614882147e-01; +3.080335194358128e-01   -4.868407979643299e-02   +3.252796201425497e-01   +2.429729767525566e-01   -1.741586141709817e-01   +1.074770460248090e-01   -1.104754683729244e-01   +3.726909143734916e-01; +6.054699396641305e-01   +7.633544643880384e-02   -3.248005110460424e-01   +3.709202170710830e-01   -4.984143628799378e-01   -7.207170506990671e-02   -1.376575281079559e-01   +4.156757213703527e-02; +1.278467598006635e-01   -9.903325368364702e-02   +4.155380625562048e-01   -1.072513883928556e-01   +3.343826063680476e-01   +3.351519587993638e-01   +5.052510504754638e-01   +7.220958889145634e-02; +3.832572760573164e-01   +4.894877103603783e-01   +2.158571655643978e-01   -2.490814865879476e-02   +6.521939096647855e-02   +3.462285882601864e-01   +5.258482921485479e-01   -3.814085769582508e-01];
L1I_L2I_iGABA_netcon = [+3.964836670311835e-01   -6.801262765978228e-03   +4.614713652564873e-01   +8.195248488261098e-02   -1.881028508269523e-01   +8.543150633345443e-01   +1.403291751112122e-01   -5.312421993685265e-01   +4.910410480981764e-02   +6.064500596077453e-01   -1.161844310409245e-01   +8.826465184717536e-02   -1.081735374678066e-01   -3.718631756983041e-02   +6.141625394509091e-02   +4.265875805733908e-01; +1.639681342885090e-01   +1.321833492547030e-01   +3.705728342233881e-01   +2.781873516581251e-01   -2.563487501065564e-01   +1.842556979386153e-01   -1.037089444990668e-01   +2.801031641094327e-01   +2.969846763719130e-02   +1.538497501141641e-01   +2.671339074625940e-01   -6.862356989245894e-02   +2.027121620060676e-01   -3.560215007741606e-01   -5.562347304778550e-02   -1.435882954287194e-01; +7.206019811889429e-01   -2.650390542364100e-01   +2.208831946616963e-01   -8.374802467400817e-02   -2.803955750401069e-01   -2.830424154494112e-01   +4.461676520550968e-01   -3.981021709756207e-01   +7.935219979075894e-02   -3.663754088329330e-02   -3.385300440461486e-02   +2.932762894521204e-01   +2.949417530695254e-01   +1.034767592900982e-01   -3.066946195737119e-01   -2.471680494103289e-01; +4.815944018377472e-01   +6.307965061447021e-01   -2.730965735515060e-01   -1.345768595145488e-01   +1.688729936833887e-01   +5.763165304340738e-01   -2.985809075970189e-01   +4.017486306564289e-01   -1.548316411708977e-01   -8.915109024537818e-02   +3.745255492943272e-01   +7.259779318279156e-01   +2.611269035416368e-01   +2.409021237165198e-01   -4.446858785268495e-02   +1.360539698018803e-02; +6.816090893513493e-01   +1.299476605392475e-01   +3.828485095611824e-01   +3.364516629633472e-01   +2.012993424007881e-01   +4.184808994653056e-01   -2.989559285301984e-01   -2.069896568172813e-01   +5.741722249262707e-02   -2.710513871930358e-01   +3.774603935990295e-01   -4.789344635854383e-01   +1.855119476357565e-01   +3.002420827697886e-02   +3.362026412245752e-01   +2.809402558361544e-01; +1.214297340370090e-01   +5.141083524166578e-02   +1.592448458897742e-01   -8.111047445440647e-02   -4.425460516024815e-02   +4.553729222537464e-01   -1.454542302182238e-01   -2.804492685571860e-01   +3.402438269608506e-01   -1.682243105592296e-01   -6.205047469658415e-03   +5.393007692394490e-01   +3.929107236532851e-01   +4.854743397235436e-01   -3.093828165326029e-01   -1.044283170056934e-01; +2.026683367115032e-01   +3.163266920559071e-01   +1.870335714824779e-01   +2.800482275315522e-01   +3.410278809380883e-01   -9.173367596255270e-02   +3.898928888523299e-01   -3.917667157924820e-01   +8.770151873854048e-02   +1.302310969393268e-01   +1.992673351167434e-01   -5.063046393741425e-01   -7.548667931856481e-02   +1.057093604881947e-01   +3.750248728931337e-01   +1.416869562716632e-01; -1.148225848792882e-01   +2.648607176435611e-01   -1.272218954760517e-01   -1.297770303622973e-01   +4.159932533585100e-01   -4.374537570418467e-01   +1.227659597814444e-01   -2.327167732385810e-01   +3.276569467624013e-01   +2.148939803901329e-01   -4.793750053477652e-02   +2.254186924340734e-01   +1.885652790505604e-02   -1.109007103058926e-01   +1.748534072672100e-01   +2.335763308565945e-01];
L2E_L1E_iAMPA_netcon = [+7.577198198649980e-01   -3.867276414733605e-01   +2.980024390841867e-01   -4.479935938236715e-01   -1.011926432512995e-01   +7.037189949814082e-02   +1.336016647517430e-01   -3.376798589255730e-01; +4.888878600881855e-01   +3.754708065327431e-01   -2.910159234977039e-01   -2.094531004859750e-01   +4.933886994219404e-01   -2.443699735033716e-01   +1.525745941439097e-01   -1.587063834559185e-01; +4.075651438613312e-01   +5.031599009645976e-01   -3.299940656383014e-02   -1.968099005093084e-01   -2.686334636529683e-01   +6.698435880471431e-01   -1.512082272797123e-01   -1.137085004985631e-01; +8.596247079513647e-02   -9.183406805456040e-03   +3.624606390888643e-01   -1.353074222660122e-01   +4.497657224143405e-01   +3.876416923377279e-01   -3.445037923454487e-01   +7.501364814074921e-02; +2.793626569252033e-01   +4.040058219687284e-01   +4.585930634605005e-01   -1.006312477710684e-01   +1.788190135172063e-01   -1.387474330637894e-02   -1.001449948003217e-01   +1.274475423294781e-01; +3.370974172859550e-01   +6.017246325650973e-02   +6.790941144324238e-01   +5.933367475665452e-02   -2.226954962952887e-03   +9.350064099113480e-02   +4.480542462307007e-01   +7.185884275795668e-01; +2.345468676739237e-03   -8.637575267672620e-02   +5.122659032634598e-01   +1.027351382026744e-01   +5.980476192792136e-01   -3.923334201543509e-01   -7.020965989079753e-03   -1.087376507284017e-01; -2.794471445888777e-03   +3.680974596170607e-01   +2.154998513537952e-01   -4.352262672503618e-01   +4.733235105354976e-01   +8.840823510591291e-02   +5.069157635160587e-02   -4.621600990813490e-01; +6.933311836909190e-02   +3.597588279403746e-02   +1.600954779420031e-01   -1.572761417651914e-01   +2.234440991764370e-01   -8.829917886840941e-02   +2.270637985044923e-01   +5.493574400718130e-01; +5.752904453729227e-02   -3.247714827027548e-01   +2.894326746641815e-01   +2.995106027046146e-01   +1.908749506902441e-01   +1.148343496933923e-02   -8.989336076789843e-02   +2.958650280363617e-01; +4.190944176483866e-01   +6.040865035408484e-01   +8.629643151262695e-02   -3.447301155740555e-02   -4.372669321258901e-01   +3.651151705073462e-02   -4.296601902717362e-02   +5.473460908370035e-01; +1.701396701725946e-01   -2.697297984767957e-01   -3.387892875553229e-01   +5.169172912074229e-01   +3.038674953017615e-01   +2.266308139906892e-02   +1.869042165631356e-01   -1.526239152132197e-01; -1.830531473372366e-01   +6.328860595814528e-01   -8.692355201716684e-03   +4.992495349410979e-01   -1.783681742717563e-01   +1.017944627290344e-01   -1.177791927896320e-02   -2.127088825163148e-01; +4.118030632390902e-01   +2.329364315666108e-01   +1.788902655944926e-01   -1.118955687174074e-01   -3.870416620219015e-01   -1.282201117122203e-01   +3.030105627425739e-01   +4.079130164562818e-01; -4.515922536857896e-01   +3.242653816979451e-01   -1.731877380260585e-02   +3.529166389271141e-01   +1.313271488001434e-02   -4.153391101122149e-02   +4.209706307447991e-02   -3.325275114819290e-01; +4.942322147924740e-01   +5.977510954412754e-02   +3.585754878088244e-01   -2.740875627850971e-02   +1.699564196788544e-01   +4.324779528059397e-02   -1.066721646507443e-01   -1.660410013254475e-01];
L1E_L2E_iAMPA_netcon = [+5.168830435078189e-01   +3.802304472627166e-02   +8.360538556347782e-02   -3.421737934887051e-01   +7.074976059883284e-02   +2.690884392482135e-01   +1.351716517711691e-01   +1.277547254772798e-01   -3.788258026439760e-02   -2.993038622827940e-01   -3.554682211166099e-01   +8.042203416636737e-02   +1.853273925626126e-01   +1.208554770514150e-01   +2.088470328163194e-01   -3.838554886960983e-01; -2.991416093167436e-01   +9.419821865560336e-01   +3.071086861488420e-02   +4.199286792800551e-02   +2.593848999366277e-01   +4.485718856935387e-02   -5.453134495096109e-02   +3.594293696725727e-01   +3.593194587806157e-01   +3.158659353798070e-01   +4.954633431084742e-01   +5.594081897551019e-01   -9.293151457053975e-02   +2.266555885637532e-01   +4.752450638959574e-01   +3.152481900241988e-01; -2.930604614391162e-01   +4.546460954560317e-01   +1.909367587356651e-01   -1.339718176740907e-01   +2.898625612382171e-02   -8.054400433928111e-02   -8.127466262641907e-02   +4.749767961544057e-01   +3.375824834183176e-02   -1.329142601588253e-01   -1.214770628898134e-01   +1.832656829283107e-01   -7.048134897800706e-03   +1.551227369113398e-01   +6.427659464336222e-02   +2.082546844478843e-01; +2.063391561915859e-02   +3.421219930569763e-01   +2.804816295787728e-01   -1.208587981253410e-01   -1.073989877513493e-01   -2.693785222291945e-02   +1.639211849951109e-01   +1.149396646901429e-01   +3.111266051721175e-01   +4.246014657939853e-01   -9.011220276620840e-02   -1.683193312475037e-01   +1.862596878496916e-01   +5.190880829493645e-01   -8.993686784520324e-02   +1.318797270882299e-01; -2.321953004273415e-01   -9.103916926570504e-02   +6.279975856209985e-01   -1.816090669956616e-01   -2.140085353358838e-02   -1.731457996055634e-01   +1.347041822846698e-01   +2.341532827624387e-02   +9.690230127566518e-02   +3.227569864445817e-01   +1.349130597799695e-01   -3.222177852825788e-01   -5.199815686014971e-01   -3.941982074905358e-01   +2.671849287188147e-01   -1.994669440670460e-01; +2.832369209261218e-02   -2.022066782207018e-01   +4.564268066857929e-01   +8.565574998022554e-02   +3.705003915355070e-01   +2.631008920300364e-01   -2.000115571087723e-01   +3.274679691027279e-01   -5.426118305222512e-02   -2.817691944923184e-02   -2.031974199386483e-01   -2.738490591466231e-01   +2.024812161106973e-01   -1.549788115238129e-01   +4.856229634715198e-01   +6.368439612223173e-02; -3.243553245456127e-01   +3.183268863712769e-01   -5.664169078664411e-02   +6.019428323323244e-01   -4.580950268667613e-01   -4.019214578457143e-01   +2.261704728324678e-01   +5.091178157203478e-01   +7.042275372091710e-01   +2.998575231554396e-01   +9.444277152627620e-02   +1.273277133489502e-01   -9.027160089797814e-02   +1.968008257470789e-01   -1.316012489176368e-01   -2.624340582938819e-01; +1.679498384673619e-02   +2.976524844428488e-01   -3.929555613831126e-02   -4.402172755410316e-01   -1.726355058752394e-01   +6.364101474457560e-01   +2.801627104281852e-01   +2.798909074416087e-02   +4.476581310557278e-02   +2.189364122623779e-01   +4.315979757409830e-01   +3.362589872324105e-01   -2.697373294893734e-01   +1.236169700055792e-02   +5.636203346058095e-02   -1.939781380242183e-01];
L2I_L2E_iAMPA_netcon = [-1.327227621013452e-01   -2.943698934097406e-01   +3.662648302348649e-01   -2.852993365048018e-01   -1.555267009751536e-01   +3.720224263925128e-01   +1.168843940933388e-01   -7.811767782556185e-02; -2.266802655195241e-01   -7.335298190725500e-02   +2.971035186762567e-02   +2.671628206986112e-01   -6.144987874655889e-02   +4.494257530422470e-01   -4.226570673880712e-02   +2.347754113702739e-01; +8.792815785225147e-02   -5.389892606944909e-02   +4.110917027019733e-01   +1.008201214012261e-01   +8.457869043310164e-02   +1.877391475977417e-01   -5.440916144923869e-01   +5.460302426419998e-01; +4.956085052876001e-01   +5.620734811714342e-02   +4.683213414147868e-01   +1.816931590501760e-01   +3.943591807794609e-01   +1.402119681541142e-01   +4.618980120858373e-01   +1.358620359570311e-01; -1.665618587059927e-01   -2.172150288564859e-02   -3.499203185738115e-01   +3.853027259183437e-01   +1.224431689648950e-02   -1.859578385846122e-01   +9.747468059785103e-02   +2.582829655199137e-02; -4.712103396517639e-01   -3.938963596759346e-01   -1.692964856388326e-01   +9.691671054426587e-02   +8.511300180992443e-03   +3.121142222012070e-01   +6.187298366301754e-02   +7.365389123294208e-03; +8.378821305322845e-02   +5.177678246039543e-01   -1.791595233141823e-01   -1.242162096417749e-01   +1.755891577317572e-01   -1.928162189602217e-01   -9.955121921875877e-02   +5.221920240275575e-01; -1.186666144980980e-01   +5.851899197941492e-02   -6.420390642639184e-02   +2.804714664598373e-01   -4.186467334902672e-02   +5.398120393637196e-01   +5.855419802736338e-01   +1.227252238018034e-01];
L2E_L2I_iGABA_netcon = [+6.132560726098302e-03   -5.131333384789578e-01   +2.900371710656188e-01   +4.830155900371697e-02   +1.058971989820334e-01   +3.082424517265915e-01   +2.317559195322842e-01   +5.022444542678803e-01; +3.890748367603520e-01   -3.023053519081456e-01   -1.214570808089718e-01   +3.676842212988651e-01   +1.302465486157100e-01   -2.296575059713925e-01   +1.584595957110523e-01   -2.102594529705086e-01; +7.413013301115043e-01   -2.722349703616064e-01   +3.529425980096385e-01   -3.068530612779528e-01   -1.005324385216170e-01   +6.710414153931236e-01   +1.233596624749378e-01   +2.177437030463232e-01; +1.098893545672406e-01   +5.777343684510610e-01   +4.213313079873385e-01   +1.371172050099325e-01   +3.998242871280712e-01   +2.812331751304739e-01   +5.686464674153044e-02   +1.487104893466128e-01; +6.649522075887870e-03   +4.755381359299582e-01   +2.994006795699991e-01   -1.707429880078480e-01   +3.716213728098237e-01   +1.517288164748518e-01   -3.000802085475816e-01   -3.374525017358023e-01; -2.422555958902149e-01   -3.539661224362874e-01   +2.360113837483714e-01   +9.203915967309403e-02   -1.528548212044314e-01   -3.671490165600106e-03   +3.610960770206854e-01   -2.201657391790512e-03; +6.416089836230738e-01   +2.460275572822508e-01   +2.863000664783943e-02   +3.719069514285868e-01   +2.630865603194834e-01   +4.660933971106668e-02   -1.670918253456424e-01   -2.856672384664847e-01; +1.948979359888976e-01   +4.849836097702946e-01   +2.532829723889263e-01   -2.610686537164207e-01   +1.685413095792281e-01   +1.036844257853334e-02   +3.045701690793701e-01   +1.484517747490657e-01];
L3E_L2E_iAMPA_netcon = [+2.883632491131732e-01   +2.824468730404230e-01   +9.972643717386798e-02   +6.431249376442343e-02   +2.165713115288117e-01   +8.084505113708096e-01   +2.746387284298901e-01   +2.318774632171335e-01   +4.476259875629791e-01   -4.367218211969627e-02   +1.128247148134537e-01   +1.663986708486832e-01; +1.824254678111550e-01   -6.177987755254161e-02   +1.951848622920032e-01   +3.601231769729259e-01   +3.337974737957043e-01   +1.381393871692873e-01   +1.852701220146597e-01   -2.086843770257754e-01   +4.626193435251203e-02   +3.445348035772491e-01   +2.686708378842744e-01   +3.077877747400944e-01; -1.212869694449403e-01   +6.072145268858913e-01   +3.397946233849685e-01   +1.096915164754879e-01   +4.624658648212523e-01   +2.811613053597994e-02   -5.874118875768942e-01   +3.377070304002001e-01   -1.874879629912709e-01   +4.438596560133361e-01   +9.666664271684175e-02   +1.382849742654222e-01; -1.848980926404795e-01   -9.385538743329037e-02   +6.471551601302290e-02   +4.978303215082946e-02   +5.413983588753563e-01   +2.626788301490252e-01   +3.391538835947924e-01   -1.432809255801889e-01   +7.368818916201214e-01   -1.942020208899829e-01   +4.453497035024194e-01   +3.243645397806626e-01; -1.930541132606901e-01   +4.072889452871188e-01   -3.595957676153150e-01   +4.771636826756899e-01   -1.207890723982174e-01   +2.047077949754039e-01   +1.167603201570049e-01   -6.514169198650901e-02   +6.620431664599475e-01   +3.024686038121489e-01   +4.600135065516751e-01   +5.858595217436378e-01; +2.492699600839156e-01   -9.505025550876649e-02   -2.748995779290649e-01   +2.194286244583822e-01   +2.159711918800638e-01   -6.774235796843014e-02   +3.097742196059035e-01   -1.475651379274250e-01   -2.074465811640135e-01   +2.421198918264319e-01   -5.384337349076922e-02   +1.837932722464469e-01; +6.241190662344906e-01   +8.073868459950098e-02   -4.414252429554926e-01   +1.836178177964251e-01   +1.146315581719178e-01   +1.222969484232448e-01   +4.436008140603913e-01   -2.158624113351851e-01   -1.249239367864112e-01   -9.599230330961848e-02   -4.732311006664738e-01   -2.161173033657191e-01; -1.326864066639976e-01   +4.654809500715754e-02   +4.398431244028688e-01   +6.276361715726748e-01   +5.840511861801132e-01   +4.168552583865059e-02   +1.093126002452955e-01   -3.510671828795625e-01   +4.100081085191480e-01   -6.084105785358135e-02   +3.660479924715045e-01   -2.314892355928329e-01];
L3I_L2I_iGABA_netcon = [+1.136707342662577e-01   -2.282353979154667e-01   +2.189595107434383e-03   +3.436426563511972e-01   -3.756077163180855e-01   +5.278462597172878e-02   +3.441404738143543e-01   -2.715459315440542e-02   +3.766334158857594e-01   +2.209054838852765e-01   +8.933287073669607e-02   +1.141386956685728e-01; +3.444718760588358e-01   -1.477365762806261e-01   +3.481864796561962e-01   +2.634021783210223e-01   +4.195051442652670e-01   -7.603451413990391e-02   +1.010183658981992e-01   +1.592868499354649e-01   +2.615693715175488e-01   -3.783332104424281e-02   +2.295778606544694e-01   +8.643048199239126e-02; +5.878021693781746e-01   -9.210408787251624e-02   -2.709606322727590e-01   +4.504094469294859e-01   -1.788842408606086e-01   -3.521714439212394e-01   -2.955251794006192e-02   +5.004609399921895e-01   +4.030473332989742e-01   -3.105994635071723e-01   +1.520609764502277e-01   +4.110021378747793e-01; -1.896126642775539e-01   +7.269326275853474e-02   -1.603119693082231e-01   -2.254188945603029e-02   +1.597132800526127e-01   -7.625338316034705e-02   +3.563775150193110e-02   +5.856672171664171e-02   +3.562058151442059e-01   -3.759528034905822e-01   +1.948213456929926e-01   +4.759598957741977e-01; +1.876135173474691e-01   +2.574173674506995e-01   +3.099282926863878e-01   +2.254367736761300e-01   +5.267695939584198e-01   -1.389447163985790e-01   +2.488384846860855e-01   -1.014386980584206e-01   +2.866229684282053e-01   +4.425074855299901e-03   +7.298149954098244e-02   +2.718938786202731e-01; +4.854423585120644e-01   +2.985795375078962e-01   +2.930754031518927e-01   -3.238453017043184e-01   +4.226493405926045e-01   +4.087736618966385e-01   +4.413385345483004e-01   -2.426829109192322e-01   +3.447731279314051e-01   +1.860437377675375e-02   +1.978476568317298e-02   -1.211935781166610e-01; +3.195683821188702e-01   +2.847903956641876e-01   -1.564571985337771e-01   +2.412186517811452e-01   +1.430217823060114e-01   -7.185693487119769e-02   +6.437548015226546e-01   +2.032990431488254e-01   +7.909990884763767e-01   -1.263549597460126e-01   +2.739529865736332e-01   +1.669438158005296e-01; -5.712105811517582e-02   -2.100468451771947e-01   +5.749058585356669e-01   -3.001540489568544e-02   +2.906988267989511e-01   +1.508522470989518e-02   -2.899363442309325e-01   -3.569161016078810e-01   +4.441237233411677e-01   +2.960650017436157e-01   -4.538324522429648e-01   -2.680282734013374e-01];
L2E_L3E_iAMPA_netcon = [+3.072045893424925e-01   +4.152290956399715e-01   +4.095136280368642e-01   -1.207725764150164e-01   +9.314103686235048e-02   -5.068894620825730e-01   +2.108489331214509e-01   +6.326859582011197e-01; -4.477382211764074e-02   +2.456421957642869e-01   +3.383973787269462e-01   +1.583557666468910e-01   +4.521747383789053e-01   +6.101258184082878e-02   +3.127922169116422e-02   -3.597937994628466e-01; -2.064432255127880e-01   +5.389288132610973e-01   -4.859813015111356e-02   -6.004727850133740e-01   -5.423730116750181e-03   -5.869112959249158e-02   -1.766962813964177e-01   +4.573934747445030e-01; +1.437195204191451e-01   -7.242746542179546e-02   -1.421560785255265e-01   +1.314079226795974e-01   -2.711787716077191e-01   +5.136521203244468e-01   -2.509423233788732e-01   +2.545296846326802e-01; +4.138097195879682e-01   +4.886841393346328e-02   +2.104757966739874e-01   +1.562748942548996e-01   +5.356348418500684e-01   -1.618997403397428e-01   +4.060434627884629e-01   +3.558657292834458e-01; -4.357971176887758e-02   -4.306228251380338e-02   +4.289187415666523e-01   +3.072855410755242e-01   +2.826998398618979e-01   +1.822202887033287e-01   +2.142690659325076e-01   +6.524510960465146e-01; -2.339743825828945e-01   -4.118734431475957e-01   -2.100774763742237e-01   -3.979537610184139e-02   +3.178448566181399e-02   +2.906658592163574e-01   -4.491541374598591e-02   +7.016155031466242e-02; +1.842476559450697e-01   +3.013863548074805e-01   +2.420635762984680e-01   +5.656170084700264e-01   -3.131149075399315e-01   +1.518993178805308e-01   +4.398559950489039e-01   -3.183958586841431e-01; +2.846380567801105e-01   +1.734904724376812e-01   -3.341316081461357e-02   +1.986865664948030e-01   -3.176275862095962e-01   +3.114564530409908e-01   -2.556470647200597e-01   +1.419243957252040e-01; +8.268595066314122e-02   +5.810120339596523e-01   -3.597857987990306e-01   -1.845136742231313e-01   -2.250971938135274e-01   -1.772914231209774e-02   +1.118890872156930e-02   -1.306261015829788e-01; -8.037920850506913e-02   -4.684151812406221e-01   -1.848818853237425e-01   -6.987139545730489e-02   +1.157536971631255e-01   +2.082529024318907e-01   +3.391556111513993e-01   +7.115402542129494e-01; +4.252349573384065e-01   +6.034462139814473e-01   +4.855176776444202e-01   -3.204553541643309e-01   -1.879014620571252e-01   -1.857608256503377e-01   +1.252527256218164e-01   +5.135634869051755e-01];
L2I_L3I_iGABA_netcon = [+4.648527447002782e-03   +5.280620357508736e-01   +1.727480720345367e-01   -2.883227949367643e-01   +1.024080042143733e-01   +2.166394353373689e-01   -3.187770457295768e-01   +1.379649981037756e-01; -3.325860576109894e-01   +3.430246964381656e-02   +3.375506135281796e-01   +2.267524611701968e-01   +2.481176565206953e-01   +4.037164586391800e-01   -1.621757067268034e-02   +2.411829101539767e-01; -4.505407616986967e-02   -2.552511859538065e-02   -6.235813580437716e-02   +3.725065965866838e-02   +1.691332168554019e-01   -6.307369733113402e-02   +2.094016071485231e-01   +3.642595770574410e-01; -1.715824801612726e-01   -1.016497935166357e-01   -2.915421872555748e-02   +1.594412734561064e-02   +4.448634965137973e-01   +7.707210976706837e-02   +2.087339651378941e-01   +1.377448807467075e-01; -1.265654353432444e-01   +2.435107286754226e-01   +3.490361305660433e-01   +3.088372374342156e-01   +4.506231675552449e-01   +1.134994977275656e-01   +1.735624994873948e-01   -5.664642195362981e-01; -2.395493128383788e-02   +2.102587726520320e-01   +4.562229473122323e-02   -5.218149489644004e-01   +4.516116488548429e-02   +7.181919472715301e-02   -1.547541007927405e-01   +3.414790654747708e-01; +1.442546818443996e-01   +1.591330161573142e-01   -3.088777719551793e-01   +2.619230462996968e-01   +2.393131561789505e-01   +3.196729846385010e-01   +3.187542692467544e-01   -2.735454614905750e-01; +2.549122173811165e-01   -3.567677563645643e-01   +5.524903661045317e-01   -2.499903193201360e-01   +2.355810249921150e-01   +5.748680318298943e-01   +1.972090125842610e-01   -2.374516708377634e-01; -4.240525030591391e-02   -7.778326704191973e-02   +4.800082206650209e-01   -2.966533253108883e-01   +4.846260442147290e-01   +7.829919478513523e-01   +5.439529212516230e-01   +4.468433385294824e-01; +7.139789184205579e-02   -7.771553021209474e-02   +1.319296941962892e-01   +3.701169648135796e-01   -1.745158345974174e-02   +6.025637720798670e-01   -5.517956691384823e-02   +1.916722575806916e-01; +7.183881802963585e-01   +8.055125479374943e-02   +1.506894796112806e-01   +5.231311711611575e-02   -1.107833084261467e-02   -3.300953860820461e-01   +2.453837252755771e-01   +7.082172806575984e-01; +5.258482011241392e-01   +7.992482484290081e-02   +2.633125930684306e-01   -5.439839221895454e-02   -1.439524528102885e-01   -3.165183055878384e-01   -7.064760198837058e-02   +4.921992444521848e-01];
L3I_L3E_iAMPA_netcon = [+1.420977647146089e-01   +4.750786446901590e-01   +4.563895681244016e-02   -3.015101588662761e-02   +2.059875614137687e-01   -3.008568122302852e-02   +1.589506138334869e-01   -2.234316978829853e-01   -3.011961206551615e-01   +3.647111421229753e-01   -1.290817790942192e-01   -4.363134744416006e-02; -2.796860229067540e-01   -1.578302370659876e-02   +5.282679331032514e-01   +4.308245630524863e-01   -5.115907610047293e-01   +7.980680933175778e-01   +9.088493839859553e-02   +2.839473689443665e-01   +1.698714667843005e-01   +1.104612440587408e-01   +2.043223837447853e-01   +2.076402120337527e-01; +5.987316472706607e-01   -2.633383077986526e-01   +6.772588663037440e-03   -1.015278304869374e-01   +3.665290165085573e-02   +2.575344574218870e-02   -1.149474995058969e-01   +1.100003284901694e-02   -1.289947282938197e-02   +7.840068952547186e-02   +1.762469917068516e-01   -1.124880022081661e-01; +3.756373619103828e-01   +2.774124839563893e-01   -2.816476650730338e-01   +1.911012703112466e-01   +5.345618048951728e-01   +1.655413566215136e-01   +8.614137654863677e-02   +4.392668508006696e-01   +3.224187473801746e-01   +1.946609029233000e-01   +1.833250680498502e-01   +1.129042851516604e-02; -5.677108791425420e-01   +5.137092506571398e-01   -1.063863687725608e-01   +7.555733543851617e-02   +1.424642916029704e-01   +5.651395030883640e-01   +2.126494698118599e-01   -2.133967576403340e-01   +1.518184011974844e-01   +5.917030179996536e-01   -2.129755423369775e-01   +2.118869617488996e-01; -2.625847955172211e-01   +2.720714738145744e-02   -2.802708911639568e-01   +2.467820022326602e-01   +8.809036001242923e-02   +1.314709104038601e-01   +4.588085183231158e-01   +4.279830346468151e-01   +1.842295012285826e-01   -6.573074632092818e-02   +4.884982082512715e-02   +5.104700344383262e-04; +1.522666418390508e-01   -1.475707067731166e-01   +5.866261184411130e-01   +3.468756890243060e-01   +4.550070981691303e-01   +2.698677201541651e-01   +9.633099779558639e-02   -3.287384773256816e-02   +4.947012716374644e-01   +2.235410530198532e-01   +4.754145223505443e-02   +3.688648668016408e-01; +2.567751986697425e-01   -1.683896811586457e-01   -1.285382954485777e-01   -3.359230600263385e-03   -6.150745790598145e-02   +1.692760912387518e-01   +2.677831770107646e-01   +2.740526888253874e-01   +3.187071739620470e-01   +1.134444920110037e-02   +2.884198439138522e-01   +8.870510995918468e-02; +4.040305392063447e-01   +3.463310239878938e-01   +5.651337809383321e-01   -1.300970882976629e-01   +9.499489818140726e-02   +7.592423096444367e-02   +1.665187319406373e-01   -2.136993813122346e-01   +2.031145732772406e-01   -8.732000054320881e-02   +3.206406007480426e-01   +1.698966269420391e-01; -1.535606077943874e-02   -3.160912986901612e-02   +3.812383494784624e-01   -1.898725431643848e-01   +2.355414708032177e-01   -2.922836040300716e-01   +2.725316441362753e-02   +2.472052767679024e-01   +1.749877345025909e-02   +3.852186059936016e-01   +5.492388674733162e-01   +4.611860496758654e-01; -1.204653657031479e-02   -7.358856125517996e-02   -1.172562933590853e-01   +6.879326627725609e-01   +5.879912163143632e-01   +7.147203580405112e-02   +3.428691164787641e-01   +3.284772203889789e-01   -3.337412685030497e-01   +2.214845923263418e-01   +5.472583686525191e-01   -2.722504283485844e-01; -1.227373675312858e-02   +5.962020377389998e-01   +1.068885668793162e-01   -3.452188942155262e-01   +4.940168670714663e-01   +3.966977193426786e-01   -2.174615523078302e-01   +3.320206686241104e-01   +3.990941953939408e-01   +2.361339429220692e-01   +4.017954003204723e-01   +7.980981181520165e-01];
L3E_L3I_iGABA_netcon = [+4.805122798303449e-01   +4.118992670912501e-01   +2.388528210096410e-01   -1.306867664458977e-01   -3.630386962060131e-01   +3.062068042515391e-01   -9.368833538620919e-03   -1.444700074277574e-01   +2.060664666856277e-02   +4.681569285218039e-01   -3.296642617160070e-01   -5.534861391908236e-02; +3.141810057144780e-01   +1.588031857086627e-01   +3.562401252893252e-01   +5.084667692065845e-01   +1.542023842154893e-01   +5.372505889664315e-01   +7.679728169821131e-01   +1.482887887513977e-02   +1.019629063966044e-01   +4.139390687806975e-01   +3.010043154122515e-01   +2.728180357543750e-01; -6.929221940200235e-02   +4.460193315884958e-01   +2.315315496789717e-01   -2.452974733534489e-01   +5.725883441239582e-02   -2.285148843532901e-01   +2.354598871423725e-01   +2.466899565331740e-02   +2.718576386630854e-01   +9.478693027975943e-02   +2.880556663784737e-01   +3.072356650328650e-01; +2.591982648886549e-01   -1.218102520138367e-01   +1.868173691769229e-01   -3.771466243179416e-01   +2.008088953178686e-01   +9.808154258674834e-02   -2.361861261564072e-01   +1.412753917428726e-01   -3.538944054856535e-02   -1.681859449797001e-02   -3.390684212520625e-01   -3.941872391058004e-01; -2.265896416798557e-01   +3.851592208723841e-01   +3.255951511700617e-02   -1.756361622925287e-01   +4.828626148769557e-01   +8.116821248751732e-02   -1.351314851495186e-01   +2.200294980963683e-01   -5.609176300827468e-03   +3.379310491599258e-03   -5.356790266356190e-02   +4.308076295854412e-01; +2.324496883776734e-01   -2.400526564618104e-01   -8.632347060304596e-02   -2.013748259484601e-01   -1.566997219705855e-03   +1.984346511471885e-02   +4.491422144493046e-01   -2.503489299055556e-01   +3.780499036894454e-01   -4.100105716518812e-01   +3.525463877423399e-01   +6.613481033249041e-02; +4.492961416164160e-01   +4.761709207926318e-02   +3.776305217133027e-01   +7.368561947581165e-01   +1.422977710225770e-01   -3.378827643541009e-01   -4.262233118537466e-01   -3.807588703687849e-01   +4.340032157048345e-01   +3.237356379156320e-01   -4.202193802142016e-01   -3.752364086283764e-01; +3.205426132448224e-01   +5.494199625569196e-02   +1.490787954115512e-01   +6.324710015054927e-02   -1.453362820428378e-03   +3.295505136394292e-02   +2.449153312286185e-01   -1.696800516222807e-01   -5.691418060409915e-01   -4.452861599174490e-03   -1.022325833320245e-01   +8.249313155317498e-02; +4.985803313439183e-02   +6.767513838694645e-01   +5.787496619729258e-01   +8.890996198491888e-02   +1.645272288872009e-01   +1.147928805761471e-01   +1.689575182925787e-01   +3.617950946799595e-01   +6.517295473486127e-02   +4.673968198810630e-01   +1.793733819630477e-01   -1.095891454330529e-01; +3.631049356632632e-01   +1.188437448120225e-01   +4.693673416689922e-01   +2.014381795829134e-01   +1.865290535307476e-01   +1.172031436125018e-01   +1.522320517502583e-01   +1.070454257133301e-01   -9.790701673005484e-02   -6.061668584415888e-02   +4.257661878632339e-01   +1.519173402461135e-01; +1.338653551931360e-01   +1.338220563861670e-02   +1.049786308504788e-01   +1.244425018925771e-01   -3.590032808518907e-01   -1.246553656660234e-01   +1.934954724404770e-01   -5.905092323563921e-01   -2.357203687951339e-01   -3.932543762360841e-02   -6.130427338635699e-02   -2.182838774486856e-03; -2.478510234860890e-01   +1.048832167908857e-01   +4.482172975267679e-03   -8.905952089904748e-02   +7.194084174061990e-02   +5.272318094047462e-01   -5.230980039098583e-02   -2.202383875290473e-01   -2.082846983232232e-01   -1.704977777467883e-01   +3.932151844005963e-01   -1.877468906786359e-01];
L2E_Input1_iAMPA_netcon = [-6.712969984272704e-03   +1.268393332614390e-01   +2.780974840335251e-01   +7.430019970400695e-02   +9.877419752497435e-02   -1.100370359774609e-01   +1.282292084628640e-01   +3.429019240820825e-01];
L2I_Input2_iAMPA_netcon = [-2.986813800888308e-01   +1.547417791529042e-01   -2.438774616398939e-01   +2.670157423640394e-02   +2.422537166273350e-01   -2.951601638274223e-01   +4.839481496005701e-01   +1.829472024346753e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
