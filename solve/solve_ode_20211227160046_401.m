function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.852623278898323e-02   +4.462874022890351e-02   +4.199902356234283e-02   +2.025499507656294e-02   +4.614548278017428e-02   -1.385668388883080e-02   +3.521708761788987e-02   +2.395921627130041e-02   -1.888566347628659e-02   +2.876187695790270e-03   +4.757946636881100e-02   +8.024733007279000e-02   +2.473681301130660e-02   +3.768487006615296e-04   +4.054655210497100e-02   +4.475453199373340e-02; +4.389990467173616e-02   -1.767834551954364e-02   -5.473827743622584e-03   +5.740315441364546e-02   +8.370760567303656e-02   +8.493851821273071e-02   +2.480912279151175e-02   -1.547990680859781e-02   +3.263083431989632e-02   +9.879115857664503e-04   +2.557768763440333e-02   +1.621290254208187e-02   +4.287048863548484e-02   +1.384873846856645e-02   -1.401571555774554e-02   +1.074508454511448e-02; +7.302712293655306e-02   +6.480304140801012e-02   +8.886103283264814e-03   -3.265489765107010e-02   -3.019691785450281e-02   +1.986342795755647e-02   -1.714155682456605e-02   +3.244427809531444e-03   -4.403513619766215e-03   +6.134758877499781e-02   -8.603144035365473e-02   +3.166253904928780e-02   -1.919130894147149e-02   +1.829100335302138e-02   +5.631182269196439e-02   -1.407912120693177e-02; +3.372542586405444e-02   +1.116348769804720e-01   +4.877614358162745e-02   +2.868511118046438e-02   +2.264039389605372e-02   +6.971922630180909e-02   +2.227233730446766e-02   +5.495763645340602e-02   +7.207875769351996e-02   -1.221043000804861e-04   -6.109426748013784e-02   -1.226264197986005e-02   +2.110123214465317e-02   -3.079513543768894e-02   +3.255947509548691e-02   +1.043703647221848e-01; +5.061271850382246e-02   +2.202766873532827e-02   +7.063628421570393e-02   +6.864309286790836e-02   +4.287089016190762e-02   +1.648136788198699e-02   +6.793990712847703e-02   +8.025663385168644e-02   -6.648460424086265e-02   -2.404443537325580e-02   -4.208193645776313e-04   -4.791984818004035e-02   -3.054242070776862e-03   +1.604684107313618e-02   +3.126391716107560e-02   +1.138883418236190e-01; +3.508043663034816e-02   +6.368526638712492e-02   -3.028285291365168e-02   +4.638472656875576e-02   +4.289987926221839e-02   -4.012962610329575e-02   +8.953830692041996e-02   -1.988061359901874e-02   +3.606962839869381e-02   +4.686297435693035e-02   +1.162887559156556e-01   +9.175718362438613e-02   -7.253844812605369e-02   +1.182536110104041e-03   +6.556428636901193e-02   -2.570596611285431e-02; -1.886412086003744e-02   -4.592256139681796e-02   +4.599192675802993e-02   +7.573424095435809e-02   +9.873678366057959e-03   -5.136136342013514e-02   +7.794033773581711e-02   +1.387404306992707e-03   +8.568880169225156e-02   +4.048941999950059e-02   +1.332242021788010e-02   +4.672522517340195e-02   +3.602131311090708e-02   +6.877627282400202e-02   +5.385966533207192e-03   +7.824248142015322e-02; +1.743993912657130e-02   +8.276650918777406e-02   +3.909682091978540e-02   -2.246975122619525e-02   +1.357890462162840e-02   +3.211606052177800e-02   +9.642861278351414e-02   -5.028205398572861e-02   -4.860086738833837e-02   -1.385629218777839e-02   +8.712859243196137e-02   +2.189355692125780e-02   -5.490752897274818e-03   -1.910920247195847e-02   -5.260128714483600e-03   -1.873503472124528e-02; +6.831857387928249e-02   +3.323736895519225e-02   +2.410113670918183e-02   +4.403543215388029e-02   +2.787561234892369e-02   -4.103820106707270e-02   +8.346528949229104e-03   -3.316904791199633e-03   +6.271209900854134e-03   -3.513270447119583e-04   +1.039902103714147e-01   +6.238244173634797e-02   +5.881974812143901e-02   +4.683368422866084e-02   -2.834073706217868e-03   +9.818249589218025e-02; +5.324855795147394e-02   +1.216850767797504e-01   +4.663131096473538e-02   +2.262370851316152e-02   +4.762560752202232e-02   +7.638650561226765e-02   -3.506887294873579e-02   +2.334191194110914e-02   -1.600236994344107e-02   +4.004400064771639e-02   +7.394704892154591e-02   +6.830469239140831e-02   +7.561674650119049e-02   +1.566472058212069e-02   +4.462970158778540e-02   +5.655069493681927e-03; +4.207470629392472e-02   -1.341274037449745e-03   +4.969884854431286e-02   -1.072031777333971e-02   +6.161261897002342e-02   +1.382881251147481e-01   +4.977361081897898e-02   -3.355123368441497e-02   +6.037151885083936e-02   +6.084014609476615e-03   +1.384821520248877e-02   -3.859482787778921e-02   +3.573731282545625e-02   -3.160700815871716e-02   +2.150715103393526e-02   +4.246373620826484e-02; +1.005470830014994e-02   +2.180726203384613e-02   +2.924704299742627e-02   +2.744997569979456e-02   -4.037828698338892e-03   -5.339692494793374e-02   +8.144677306598840e-02   +5.695514407066676e-02   +5.413290115924625e-02   -2.660504932511909e-02   +8.637667835451458e-02   -2.286216267375019e-02   +3.885998449590777e-02   +3.246108821598122e-02   +8.150149518311994e-02   +1.133004415290448e-01; +5.844310942462179e-02   +6.457337305081057e-02   +2.113524692678185e-02   -2.055189714854581e-02   +5.442908632283788e-02   -4.313644288385512e-03   +4.890623933922779e-02   +1.681704238643861e-02   +3.319636158932227e-02   +8.269872200301506e-02   +6.086739488428697e-02   +9.935054521092571e-03   +4.233498609707199e-02   -2.193041907333422e-02   +3.482078408419510e-02   -8.703517503843576e-02; +5.444737907053372e-02   -2.873000299054483e-02   +3.070724970939740e-02   +1.006746299458618e-01   +6.125571062126495e-02   +7.333394616536326e-02   +2.857832140389296e-02   -2.879799202709866e-02   +9.315639817475128e-02   +4.704681374037319e-02   +3.402568486056859e-02   +3.914519337302069e-02   +6.504887908061227e-02   +2.343981207071205e-02   +8.049038492568142e-02   +9.184142284120719e-02; -1.179237476360095e-02   +9.028407942100913e-03   +1.264223075255860e-02   +3.263234428793237e-02   +2.574313342474036e-02   +5.326319303065832e-03   -4.118412979351146e-02   +3.189489273326021e-02   +4.440094344996327e-02   +2.064904317823860e-02   +6.804904166560333e-02   -3.906028335834959e-02   +6.760716152388095e-02   +7.154238989486467e-02   +5.284830975517267e-02   +3.133250840133769e-03; +2.655522569489055e-02   +3.376629124717416e-02   -3.749839656014957e-02   -4.130025596356796e-02   +9.973782564198108e-02   +1.679506760480550e-02   +2.320246024967274e-02   +1.266818814381583e-02   +1.355683912747727e-02   +2.324447795366470e-02   +3.550744697210038e-02   +1.334016436732066e-02   +8.752028407250120e-02   +2.336026834786694e-02   +7.383834784375018e-02   +9.694892739054489e-02];
L1E_L1I_iGABA_netcon = [+8.925502800291713e-03   +7.477489296908608e-02   +3.513840249342705e-02   +7.323170642587495e-02   +2.504597654314573e-02   +3.335600653150538e-02   +2.662782644555729e-02   -2.898020280956140e-02   +8.298786975994926e-02   +4.600835455974410e-03   +6.631083942696826e-03   +9.057990754877303e-03   +4.996335376661427e-02   -1.974742659450813e-02   +1.370823450055325e-03   +7.935493481966339e-02; +4.035628715609383e-02   -5.302473121217754e-02   +9.952689829538029e-02   -2.122688870474711e-03   -6.581579349458229e-02   +3.799266667174329e-02   -1.955627233040683e-02   +5.035112790185206e-02   -3.037656015702557e-02   -3.905214833697523e-02   -4.481519061136655e-03   +7.545492623694328e-02   +2.587499652980213e-02   +1.575694221748144e-02   +4.567596208106483e-02   +6.959855263593878e-02; -7.677175400748953e-02   +5.506051346158573e-02   -5.550616885462316e-02   -4.490334245276142e-02   -6.360304232310217e-03   -4.292782507838189e-02   +1.637565950555041e-02   +4.009968071044336e-02   +2.018498601184638e-02   +2.162792498227320e-02   +7.399398063190023e-02   +2.075529360782920e-02   +5.967206089164769e-02   -4.911258404590770e-02   +4.596749387913921e-02   -1.903333205047913e-02; +3.796192104173159e-02   +5.993029187782237e-02   +5.952229465559782e-02   -3.041865457751135e-02   +6.371801290239668e-02   +8.884803959404058e-02   +3.458033346703108e-02   +1.179660508668198e-02   +7.576631957358977e-03   +9.263497485755065e-02   +3.844100463186152e-02   +2.979069193105422e-02   +1.337968560281766e-02   -1.255867864923558e-02   +6.259783956289748e-02   +1.611569787970712e-02; +7.365119443893753e-02   +3.576992791307039e-02   +8.536255774584502e-02   +3.250587815330022e-02   +1.650671292380500e-02   +8.970559058821745e-02   +1.750577785501699e-02   +5.051487075223084e-02   +8.013189504018384e-02   +2.780283592829513e-02   +8.492681940543390e-02   +3.311238320938141e-03   -1.002104795230756e-02   -2.099402434602615e-03   +1.291032102171105e-02   +7.267919849042401e-02; +3.435666913128788e-02   -1.791566204695939e-04   -3.564713420342102e-03   +4.819356108714216e-02   +6.796173055333810e-02   -7.308688484894403e-03   +8.574358322619838e-03   -2.580182563907307e-02   +1.306592533419970e-01   +2.235439436726524e-02   +8.413848817279632e-02   -2.737436432128632e-02   +9.721434449173773e-02   -3.097638290613773e-02   -8.149295227432227e-04   +6.448604106444880e-02; -4.295338015219152e-02   +2.144699163658152e-02   +6.441706396357816e-02   +5.559317804534232e-03   +6.581547643356522e-02   +8.587292888233213e-03   +5.924942297301591e-02   +8.708537414054885e-03   -2.038790144615736e-02   +3.194457180690415e-02   -6.166478354608287e-04   +3.338102561051323e-02   +1.751011837150804e-02   -4.689133818097298e-02   +1.896531372041371e-02   +6.610639375450308e-02; +5.545689798763813e-02   +7.487046252845433e-02   +4.064937374409143e-02   +2.150513666693760e-02   +9.071341507568102e-03   +1.933634577993629e-02   -1.448124593546166e-02   -7.082203786624486e-02   +6.402883704963235e-03   +1.006450905973010e-02   +6.633141143240712e-02   -4.646802211823417e-02   -2.264198244833934e-02   +7.707689904279387e-02   -4.994009793491645e-02   +1.381305778311082e-01; -1.902340538851655e-02   +8.077051983641748e-02   +6.845085248987787e-02   -1.855559707015675e-03   +6.979649565491461e-02   -1.961262989386157e-02   -6.870050886321430e-02   +2.015693072106202e-04   +5.012864233711493e-02   -3.527075041304673e-03   +6.136611400508615e-02   +1.515346824011472e-02   +5.755328803780177e-02   +8.141228584221329e-02   +6.023658604853792e-02   +1.099416714251905e-01; +6.772510775804107e-03   +8.275180421666338e-02   -2.379806023690343e-03   +5.196511069530016e-02   +1.082276973431265e-02   +7.306647726386825e-02   +9.360789808171761e-02   +1.926569874147879e-03   +9.116921941816514e-02   +5.940762267588952e-02   +5.817247180580775e-02   +6.183815312243957e-02   +4.103379718767733e-02   +8.348852170471399e-02   +1.011964482828127e-01   -2.107897937474021e-03; +2.508333315618953e-02   +3.885947479186758e-02   +1.225999054801598e-02   +8.223579259696308e-03   +1.444316829512976e-02   +1.057003214853650e-01   -3.553748735531345e-03   +5.068567510466037e-02   +1.324932095472924e-02   +1.069911237943613e-01   +1.268966948530434e-02   +7.563546085759068e-02   +1.544539874654186e-02   +6.624679537866550e-02   -2.019525489793514e-02   +7.403423794030578e-02; +1.413830868342820e-02   -3.679999818400418e-03   +5.182608166898710e-02   +6.415318982431686e-02   +2.745667334031816e-03   -8.583141688274004e-03   +7.942650017544722e-03   +4.972719918538958e-02   -3.633612796093492e-02   +6.598306204881647e-02   -5.212201213303055e-03   +6.352789514907080e-03   +7.055684946209849e-02   +9.130391517899161e-02   +4.603445969319654e-02   +1.066683798422852e-01; -1.120710647154644e-02   +5.848478537142320e-02   +9.449744669767846e-02   +8.704779243899924e-03   -7.619023245868944e-03   -1.020175001709696e-02   +3.283151273472853e-02   -8.265396644564387e-03   +6.727240726522576e-02   +4.326626569230540e-02   +6.045676098643505e-02   -2.094549626937835e-02   +7.130015753310708e-02   +4.533269048097077e-02   +5.981074857180069e-02   +7.513033245172660e-04; +3.589801218100500e-02   +2.624125335253015e-02   +4.560865039848638e-02   -1.413345416209828e-02   +1.961791245131711e-03   -3.276169130520826e-02   -8.697116237512048e-03   +4.410904445421452e-02   +1.775752690209293e-02   +3.140088341591294e-02   -5.013692633873925e-02   -2.848341413808471e-03   +2.951197958580622e-02   +5.308870521827925e-02   -4.323341181920301e-02   -3.016879771178573e-02; +2.255028042075286e-02   -3.466384149553284e-02   +1.867068564060305e-03   +5.895626053492042e-02   -5.692474047078624e-02   +7.064546392231125e-02   +1.185885405120895e-02   -1.372420471059309e-02   +1.058843835197673e-01   +5.546540709592325e-02   -1.124214123419401e-02   +6.966651099560227e-02   -1.291114064538371e-02   -4.037579116012399e-02   +4.786490628583764e-02   +7.314193151129389e-02; -7.021721909521678e-03   +1.153017598376802e-02   +4.489073407220665e-02   -2.680389031134689e-02   -2.681658469211777e-03   +9.499812129277105e-02   -4.025671808783617e-02   -4.067974323365078e-02   +1.186285806167046e-01   +5.705935844217960e-02   +9.234923144963691e-02   +4.730950452909796e-02   -2.476287142226819e-02   +9.845803942382941e-02   +6.644604063754497e-02   +8.393622242915923e-03];
L2I_L1I_iGABA_netcon = [+2.717273436587780e-02   +5.403348748043500e-02   +1.516676227939483e-02   +1.951214637598887e-02   +8.981658306955135e-03   +1.193425262424466e-03   +1.589243152857473e-02   -7.918681711372888e-03; +4.345783999113689e-02   +3.189700815995142e-03   +6.040632202388676e-03   +3.054335532929047e-02   -2.211670023138555e-02   +3.552463172035188e-02   +6.402803939030821e-02   +1.163549039708018e-02; -1.367756757580474e-02   +5.708140609395696e-04   +1.260428870415704e-01   -1.234827301546666e-02   +7.348079210116445e-03   +2.001288838585899e-02   +1.052660760998608e-01   +2.093873407796026e-02; +1.173771440983292e-01   +3.644250295348619e-02   +7.137048993709950e-02   -1.998560046978280e-02   +6.479125296131368e-02   +4.362899924341471e-02   -9.959203567244262e-03   +1.193285225705357e-01; +5.547990623885869e-02   +3.894856728721938e-02   -3.097786579793335e-02   +9.142716438516149e-03   -1.308131045431651e-02   +2.096716875316747e-02   -1.758523026970960e-02   -3.240307749925749e-02; +1.390787065606251e-02   +4.840519280202237e-02   +1.052485240275196e-01   +1.940516614136557e-02   +6.639458163295904e-02   +6.321992199688367e-02   +5.268025778109861e-02   -2.552827131264297e-02; +7.683920922651509e-02   +3.334950675007659e-02   -7.820127185827104e-02   +6.394252628950169e-03   -3.907294302737823e-03   -5.003370689694825e-02   +2.263061278054715e-02   +7.542275973109461e-02; -6.661044959088393e-03   +6.093533610741547e-02   -4.394847638088190e-02   +1.307964386463297e-01   -5.957189586021417e-03   -3.007137294538982e-02   +5.139023511103789e-02   +2.008657369021678e-03; +1.703291211134340e-02   +9.538077530396753e-02   -1.644364641924720e-02   +2.609843383199882e-02   +2.230774325935964e-02   +1.175468030777799e-02   +6.915219230957859e-02   +5.030485687825062e-02; -3.955150235388359e-02   +6.146309137021309e-02   -1.164990351023786e-02   +7.635144565885843e-02   +3.553103180250505e-02   -1.877481931862578e-02   +4.269168028363025e-04   -4.242916836881871e-02; +3.877720823407584e-02   +2.920894670359038e-02   +8.538736488222209e-02   +4.731975526480875e-02   +1.931243424135801e-02   -2.967488732117304e-02   +1.164869509740283e-01   +9.404745130739764e-02; -9.275421165868611e-03   +1.475845880653112e-02   -2.341568013560606e-02   +1.027323896293589e-02   +1.061299151326395e-01   +5.595773144122512e-02   +5.178985630300281e-02   +5.296749355200900e-02; -4.124389007890100e-02   -3.946565280670064e-02   -2.099245312406434e-02   +1.331402543161745e-01   +4.037863374307420e-02   +6.513499548027613e-02   -3.080288857149732e-02   -3.163439739444809e-02; -7.130724550730294e-03   -6.134118092734139e-02   +5.851602228884151e-02   -4.429919608536569e-02   +4.678577009521970e-02   -1.040853761698593e-02   +1.663062945935655e-02   +1.098724134017488e-02; +1.518883441196302e-02   -1.056773263127547e-02   +1.510220212660939e-03   +7.152679138156204e-02   +2.809128755254862e-02   +4.778139240888957e-02   +6.724443959919083e-02   +4.631953211084204e-02; +1.318654795429992e-03   +6.757559076872960e-02   +3.103500285187476e-02   +5.045752103312536e-02   +4.985232399358164e-03   +4.862937098186735e-02   +2.638750044939275e-02   -6.822644683011812e-03];
L1I_L2I_iGABA_netcon = [-1.418345876575068e-02   +4.580808859508378e-02   +2.099003644471696e-02   -4.355034671152989e-02   +7.694441211901884e-02   +8.978537437810258e-02   +4.105276018174224e-02   +4.978188711614812e-02   +3.561467143299334e-02   +5.484024211093341e-02   +7.036298302221836e-02   +5.444203421294425e-02   +3.926588140087880e-03   +3.831598640933098e-02   +3.534379288926280e-02   -3.563580981112826e-02; +2.942466503544378e-02   +1.061255442009598e-02   +1.585128499037360e-03   +4.105149441153353e-02   +5.184861908445122e-02   +7.759533483665453e-03   +6.179328877618536e-02   +4.450382312957244e-02   +2.525777493908613e-02   +8.988970670030386e-02   -5.334574284304967e-03   -6.578670173004852e-02   +8.283404192727059e-02   +2.659329483640507e-02   -2.521872592254873e-02   +4.570501851610410e-02; +4.161571122947063e-02   +1.367986608097491e-02   +8.147814019219562e-02   -3.358003187461377e-02   +1.048334515325015e-01   -5.932207223909297e-02   +4.085300285884590e-02   +9.387150123115738e-03   +3.207408098987837e-03   +3.268764798890905e-02   +8.687059048612876e-02   +5.183782776357854e-02   +5.660039715445156e-02   -7.122004496307971e-02   -4.947494533790858e-02   -1.261127320900063e-03; +5.934466606743512e-02   +6.553240491890427e-02   +7.210434229460803e-02   -2.263676502286550e-02   +4.217945409971085e-02   +2.101733336431372e-02   +9.819279528801466e-03   +2.925887428240413e-02   +2.631174735711487e-02   +5.662503128960718e-02   +2.519768661438088e-02   -5.640327170418433e-02   +4.489955389987386e-03   +4.150698002376377e-02   -2.536818234264617e-02   +4.722009498225740e-02; +2.367964772161123e-02   +3.520234133220123e-03   +3.401123639305144e-02   +5.399433856260286e-02   +1.093242844885208e-01   +8.555295153606886e-02   -3.206352691514501e-02   -4.311301511528577e-02   +1.004050019625202e-01   +1.277151252334569e-02   +1.584375459877376e-02   +7.371132133680861e-02   -3.037279438093295e-03   +3.142104805501375e-02   +3.775722393968665e-02   +7.207059407674353e-02; +2.379681119755031e-02   +3.606436394825444e-02   -5.108586424754917e-02   +4.481042098157796e-02   +1.087006494938207e-01   +7.007687053644907e-02   -5.623786703388626e-02   -2.128003137549469e-02   +3.819411579979055e-02   +1.347894049861305e-02   +4.338137696207119e-02   +5.088869112290596e-02   -5.496913211417043e-02   +6.407722017372808e-02   +5.773671941102071e-02   +4.925815563851910e-02; +4.522250499472072e-02   -1.613931254684647e-03   +3.714486197953427e-02   +2.360724015533456e-02   -1.142250283743387e-02   +8.554220217069491e-02   +3.564250992650136e-02   +3.354121169931062e-02   +6.851568750493692e-02   +2.534795811616105e-02   +3.883462291450560e-02   +3.156634488990671e-02   +4.524934248314914e-02   +2.861121519213328e-02   +6.513069333798055e-02   -7.825401372374030e-03; +2.359396288494650e-02   +4.232096508329835e-02   +7.721981742812448e-02   +5.139707560399992e-02   +5.739287239317811e-02   +3.160941017508451e-02   +7.033185681016345e-02   +4.039440423378299e-03   +6.543067011959952e-02   +3.961822765521450e-02   +4.065548885351531e-02   -2.427788894640378e-03   +2.224542907066016e-02   -7.847166325510640e-04   +2.762111519502161e-03   -5.247067738599046e-02];
L2E_L1E_iAMPA_netcon = [-2.021763940671777e-02   +6.995617333627667e-02   +2.291576614903110e-02   +1.014704873294521e-01   -3.079424159677786e-02   -7.135096240604991e-03   +7.593645884597866e-02   -1.657052353128709e-02; -4.466379800786204e-02   -3.136327842650898e-02   +5.725851664984604e-03   -5.022884897398761e-02   +2.564996920961384e-02   +1.596411318541541e-02   +4.499092057230251e-02   -2.976437362297787e-02; +1.283369790623940e-02   -1.612411939031275e-02   +8.875804596157416e-02   +3.637207935075547e-02   +6.722018589867436e-04   +4.880385622730930e-02   +5.038080130029302e-02   +3.085852653145591e-03; +1.058983174312158e-01   -2.493004530461926e-02   -5.716254373013688e-02   +1.281135914268061e-02   +3.358561531060394e-02   +5.768904007917063e-02   +4.569066341242623e-02   -5.283702065913736e-02; +9.457843924525261e-02   +1.191631487865288e-01   +3.062333517890276e-02   +9.079562269713157e-03   +7.530730477038855e-02   +1.016582353816679e-02   +2.014676326911227e-02   -5.432135912365055e-02; +6.969478650936058e-02   -8.851420665115139e-03   +3.232623569949314e-02   +2.915298971089333e-02   -1.998259829222394e-02   +2.432031777805499e-02   +8.119056860690868e-02   +1.845920455149183e-03; +1.478193161445727e-02   +4.588771106222633e-02   +4.502856050179305e-03   -2.183904386541446e-02   -3.442594252049736e-03   +7.062382348235127e-02   +3.011323260773321e-02   +6.293300626802328e-02; +4.850753995910970e-02   +1.096775801969458e-01   +6.687122152261718e-02   +5.212868699167808e-02   +7.802281675945472e-02   +5.107282837836464e-02   +4.643846810053646e-02   +5.756495087008167e-02; +4.666681275039720e-02   -2.219537632867219e-02   -7.884064793115469e-03   -5.504497246783464e-03   +1.132519352013917e-01   +6.434246231958481e-02   +6.414845495093080e-02   +1.107630916546624e-01; +4.471678158962054e-03   +6.085787491671808e-02   -5.581681009949439e-03   +2.747726623902427e-02   +8.233140506324574e-02   +4.680174501766197e-02   -5.871355731239590e-02   +2.915834445549578e-02; +8.034885984535332e-02   +2.561678146706419e-02   +1.857627822246083e-02   +1.839465080924530e-02   +1.297614830183846e-02   +4.441975175658913e-02   +5.443027088098804e-02   -7.946658362052472e-03; -1.381929004567452e-02   +1.135998029030751e-02   -2.130229111046820e-02   +3.758481015171500e-02   -7.694713247772114e-03   +3.829253949434366e-02   +2.726732990522682e-02   +7.825125018317899e-02; -1.945701008115712e-02   +5.035029461738113e-02   +7.164225608919914e-02   +3.684664343572037e-02   +8.998020774408419e-02   -3.755329292479228e-02   +5.635432481362431e-02   +5.692940573160611e-02; +2.276841948966621e-02   +2.179788427410865e-02   +7.739556625011186e-02   +8.841214179102780e-02   +5.444809874618140e-03   +2.710962458208924e-02   -7.350591132885061e-03   -5.797967669373447e-03; +3.315544336849619e-02   +1.360291902721062e-02   -9.612662075367151e-03   -9.902434957320296e-03   +1.581501857301345e-02   +3.234737314275038e-03   -4.025209309532433e-03   +3.759686249149064e-03; +4.052770842595790e-02   +2.394751324122754e-02   +5.654512719893547e-02   -1.238493249541871e-02   +5.119431882284475e-04   -3.147183252616160e-02   +5.887031073831175e-02   +7.668077032824582e-03];
L1E_L2E_iAMPA_netcon = [+5.487717480723336e-03   +4.374994817905242e-02   +4.963064965970135e-02   +6.231391546534315e-02   +4.406951902806005e-02   +4.336727740920768e-02   +6.738930693245429e-03   +2.227930889582465e-02   +1.326075712151870e-01   -4.822800532988135e-03   +6.045530359714242e-02   -1.686389701265404e-02   +2.616098825125985e-02   -1.704681537651937e-02   -1.589893074895243e-02   +3.364845932265047e-02; +6.619042682818701e-03   +4.154456659201455e-02   +2.209511507010843e-02   +6.912301423811149e-04   +3.477032050564084e-02   -3.436529360429861e-02   +1.150726541511411e-02   -1.234052817278429e-02   -5.373998066105867e-02   -9.446260201226624e-02   -3.126136023401917e-02   -3.699219956396135e-02   +5.379170352545964e-02   -3.362806632652401e-02   -1.353782313802894e-02   +3.977192909331372e-02; -2.123089218880804e-02   +2.662267037826521e-02   +8.360926952951545e-02   +6.038556109126846e-02   +8.155482453357564e-02   +2.064050407007317e-02   +7.516961988878431e-04   +7.007168550365998e-02   +5.966695924111989e-02   +2.230630488650330e-02   -6.160478888101126e-02   +4.086522230171009e-02   -3.091740193270035e-02   +3.287577099120920e-03   +1.237331585806850e-02   +6.799865708572464e-02; +3.904765114828494e-02   -1.092794069531571e-02   -1.750472654718937e-02   +6.156653838933543e-02   -3.659697027342629e-02   +4.345204923034098e-02   -6.911450481235024e-04   -6.013442265841714e-03   +7.302113613523958e-02   +1.234705247819432e-01   +6.710943291659313e-02   -1.904019830382244e-02   +6.201970288665430e-02   -1.491457832757844e-02   +5.304276908691185e-03   +4.870777119712279e-02; +3.716144122156906e-02   +1.943782380816177e-02   -3.500817827128474e-02   +9.150402026172885e-03   +1.267605970258042e-01   +1.115402333694418e-01   +4.453245321736230e-02   +4.506333457043654e-02   +2.157985345851160e-02   +4.230696357091605e-02   +8.630886740122343e-02   +3.812487363862604e-02   -3.427324583680771e-02   +4.285082380730060e-02   +4.776817508180831e-02   +4.641389428634492e-03; +1.207983199639449e-02   +2.557173802626371e-02   +1.096245983791599e-02   -2.513715940954671e-02   +4.158450630206260e-03   +7.822252480621947e-02   -2.170374399867585e-02   +2.649093968018390e-02   +1.061356024072873e-01   +3.142983327109292e-02   +2.505817204094588e-02   +1.191811586138123e-02   +3.829011049064909e-02   +1.059479921178672e-02   +5.374913780732501e-02   -8.517639018029967e-03; +2.592159864329310e-02   -1.333784006415369e-02   +6.009751030007227e-04   -3.244237973117837e-03   +6.245297723027815e-02   -3.850454431594731e-02   +2.189770153705492e-02   +3.962830091280296e-02   +2.371512373654720e-02   +4.375973318376566e-02   -2.502233696967142e-02   -2.329080870676182e-02   +3.798462256316026e-02   +1.906000711081848e-03   +9.996540327322276e-02   +1.343398561782654e-02; -4.133127799586389e-02   -3.447080960249711e-02   +6.823887934120093e-02   +4.983417781988109e-02   +3.367545554237068e-02   +5.526253053255883e-02   +2.612967628263208e-02   -3.057812055321173e-02   -1.417789434954452e-02   +1.136250638747704e-01   +8.913446483353095e-02   +9.512258554051106e-03   +6.075786854560468e-02   -2.434414414565593e-03   +8.872832754250455e-02   +7.527901127637718e-02];
L2I_L2E_iAMPA_netcon = [+2.243883928584752e-02   +5.616513715572138e-02   -1.604400251662769e-02   -3.486250020113489e-02   +6.737119002053613e-02   +1.390743559026291e-02   -3.594362444390063e-02   +9.130637422703684e-02; -5.117097300443756e-02   +3.048400204547875e-02   +2.730671054687824e-02   -3.598135114350914e-02   -1.819193094243971e-02   +6.347682092449575e-02   -3.261734392815765e-02   +4.750260112028430e-02; +7.442620182236407e-03   +1.418522593880716e-02   -3.247634556751012e-02   -3.196390261834941e-02   +1.859438117580912e-02   +1.193124635230913e-01   +5.035470293028965e-02   +1.960642040999737e-02; +1.970258604610194e-02   +4.110777711713005e-02   +1.783094834721169e-02   +3.172125149312532e-02   +2.002643052878804e-03   +2.096178158996367e-02   +1.459258981929171e-02   +1.714251337993897e-02; +2.640003162503973e-02   +3.005883984956784e-02   -1.463902176989066e-02   +3.741583457796217e-02   -1.692474905325670e-02   +6.223599873594635e-02   +2.125296071793881e-02   +6.245845249416973e-02; -6.692598103236257e-03   +5.263801504765988e-03   +5.973327329860445e-02   +1.836488478127640e-02   +9.037970777913520e-02   +4.097799367443744e-02   +1.939359067985812e-02   +3.739332033218046e-03; -1.184876604982802e-02   +1.203043878170899e-02   +3.638902826589324e-03   +5.789955904765454e-02   -8.971475642219466e-02   +5.262561619157621e-02   -4.869716380279369e-02   +8.226632373506970e-02; -2.983803495956234e-02   +5.474972405091715e-02   +1.164520929019795e-01   +7.801568032030574e-02   +4.975438105685744e-02   +3.208678838591657e-02   -2.833576983060120e-02   -5.070950603255457e-03];
L2E_L2I_iGABA_netcon = [+4.891804849317027e-02   +5.004310129736372e-02   +3.528738637135162e-02   -5.383419570501927e-02   +4.691014200749324e-02   +2.588396853606448e-02   +2.832069762395022e-02   -3.596613297654752e-02; +9.652601553632856e-02   +5.972749493482381e-02   +1.088402965045729e-02   +3.132019771737211e-02   +3.338188332595481e-02   +3.125660328774905e-02   +2.573683223462652e-02   +4.854450756614481e-02; +2.903976942482775e-02   +3.827531442719345e-02   +3.505912897668195e-02   +2.863799081762570e-02   +2.582118448965983e-02   +5.464210840112549e-02   +4.046218343051877e-02   +6.978212880275756e-03; +3.088644629108267e-02   -9.029882392915991e-03   +5.164077390856375e-02   +6.310764932755130e-03   +2.042302579306140e-02   +1.173669468698867e-01   +5.338160691841704e-02   -4.610356166251963e-03; +4.892921591321106e-02   +2.720282551240246e-02   +4.412599025640127e-02   +2.701719264989733e-02   +4.100423088784482e-02   +3.553969329034391e-03   +5.332571941600787e-02   -9.755459685205234e-03; +2.530199979045238e-02   +6.811774034639979e-02   +6.212327014499114e-02   -1.545777332828863e-03   +2.302722419477572e-02   +7.774551902338545e-02   +1.766460575977674e-02   -4.911297124957874e-02; +8.794172580138970e-02   +1.299632481662779e-02   +1.495389603358974e-02   +5.300481782688164e-03   +5.178457906108967e-02   +3.579674466916514e-03   -3.472936852465756e-02   -4.921669787326817e-02; +1.150165165312165e-02   -2.239607289308471e-03   +6.430054958326806e-03   +3.522278055150656e-02   +1.579559354236058e-02   +1.224580462676083e-02   +1.329904765628771e-02   +4.132790669210340e-02];
L3E_L2E_iAMPA_netcon = [-4.322539809206292e-02   +2.826478998943129e-02   +4.811894564742248e-02   -1.594202810291193e-02   +4.704228936410623e-02   +4.090635704467240e-02   +2.678321562451983e-02   +4.573603198816156e-02   -3.595323510494569e-02   +9.336137527743785e-02   +2.297850614859522e-02   +4.612782703541554e-03; +2.164899099775372e-03   +7.622258701822855e-02   +4.963153243291459e-02   +6.273256436469590e-02   +1.142722558748749e-02   +6.826807321665636e-02   +7.541327290275346e-03   +3.240651932785064e-02   +8.449096892261324e-02   -1.246331741950740e-02   +4.722788503857615e-02   +4.563627349467003e-03; +4.983558411721105e-02   +1.216809465979047e-01   +6.494353945689640e-02   +4.028448047080323e-02   +2.665120973751810e-02   -1.128772149909698e-02   +4.297815414859173e-02   -2.951088854755346e-02   +4.708243724681057e-02   +4.630647279773985e-02   +4.674469951322744e-02   -3.519193640656552e-03; +2.004405045617291e-02   +7.299420690565471e-02   +7.936869652533565e-02   -3.735378842871399e-03   -2.663711042042476e-02   +4.277074753937755e-02   -1.351514096398817e-02   +7.435442485579416e-02   -3.888588623982243e-02   +5.284527404521146e-02   +3.826682226785593e-02   +2.353286471136412e-03; +1.150032841127794e-02   +7.677235056252549e-02   +1.376527439526064e-01   +7.792082206176565e-02   -2.041512218352080e-02   +6.134247061711950e-02   +4.534166793024612e-02   +5.416537587079651e-02   +5.230475157914009e-02   +3.112393348210134e-02   +8.607595811984617e-02   -5.235490450333991e-03; +3.513880533459388e-02   -1.182464482654207e-02   -3.542280505026708e-02   +9.000739498894510e-02   +8.361443447002199e-02   -2.608066987682767e-02   +7.778475479133340e-02   +8.487973595164561e-02   +6.055854437965595e-02   +2.931999746336665e-02   -3.553317619814936e-02   -4.636725013937446e-02; +8.083989099237858e-02   +1.632989704801006e-02   +1.790423582778594e-02   +3.369179803750051e-02   +2.463436625327928e-03   +2.824612980799736e-02   +3.293670617876963e-03   +2.902479500292116e-02   +4.636327356741594e-02   +5.134669504557497e-02   +9.285788430257670e-02   +5.771269856687965e-02; -2.741400613683637e-03   +1.791295750646547e-02   +5.121373291102976e-02   +5.488297020834711e-02   +5.354787136255702e-02   +2.580467786490868e-02   -2.125982041135498e-02   -4.345421161675390e-03   +4.239461732797625e-02   -2.516169573885385e-02   -3.078395227435590e-02   +3.545457295014647e-02];
L3I_L2I_iGABA_netcon = [+1.073982510181644e-01   +9.406066351652262e-02   -3.411714912535452e-02   +3.051790180865490e-02   +1.661783537376408e-02   +2.128489684862647e-02   +5.371338154003064e-03   +7.438383343517196e-02   +2.957966067679440e-02   +2.021674363280045e-02   +8.288787783235371e-02   -1.228276551872365e-02; +5.502038516401304e-02   -3.536550531278556e-02   +4.940937478218190e-02   +7.276777316975241e-02   -2.173823972501929e-02   +3.924435046315656e-02   +6.882254123710034e-02   +1.452883172806070e-02   +3.999323946982665e-02   +5.205846572771237e-02   +7.914194417468623e-02   -7.309345080731305e-02; +1.780846747600167e-02   +1.048677192084961e-01   -2.274866802250883e-02   +6.700471097180560e-02   +9.932188770436924e-02   -8.335531979809900e-04   +5.401032749087353e-02   +5.115715296803439e-02   +6.877355436136072e-02   -6.352513470282770e-02   +6.450633766943832e-02   +5.784534791078882e-02; -5.462709127403709e-03   +7.569095190421790e-02   +9.164133246689005e-02   -2.332291368042569e-03   +1.016736201070035e-01   +4.273826692335019e-02   -7.092795788576785e-02   +7.558982362796944e-02   +7.456644632071142e-02   +2.304081068184258e-02   -2.240788543974766e-02   +1.306463390103077e-01; +1.043849295573722e-02   +6.019055029859721e-03   +7.811626031495458e-02   +3.769087953739767e-02   +1.499981436874590e-01   +3.495667532054574e-02   -2.577312686120228e-03   +9.722145473760738e-02   +2.596588837142133e-02   +2.034462985777154e-02   +3.066140723752001e-02   +3.702492466434570e-02; +6.011100477504427e-02   +7.996933473527022e-02   +7.582005568225331e-02   +1.650503129141096e-02   +7.287435452583063e-02   +1.961844995079251e-02   +4.120838752303521e-03   +3.339688274215952e-03   -3.734198453597640e-03   +1.411065044331278e-02   +5.240394172555428e-02   +1.967851399742443e-02; +3.058042317052974e-02   +6.273535731527619e-02   +3.125037583592836e-02   +6.443175564039086e-02   +3.135333368780929e-02   +7.937902165551983e-02   -2.108440327189377e-02   +1.304774388270981e-02   -6.403317280031262e-02   +7.434342661794416e-02   +4.625153270104818e-02   +2.559088821670889e-02; +2.782056336666034e-02   -4.088633708574334e-02   +4.522075044387197e-02   -2.779284653642190e-02   +5.704122470497035e-02   +5.667734042242073e-02   +5.538126035653373e-02   +9.646737963583385e-02   -6.918241198500806e-03   +1.087302746074545e-01   -2.611342277209118e-02   +3.899616520131718e-02];
L2E_L3E_iAMPA_netcon = [+8.918798448017339e-02   +3.457208834997706e-02   +5.263098380034879e-03   +1.886751420338591e-02   +1.738831344974158e-02   +3.579704197951662e-02   -3.374371990088569e-02   -1.993605906101582e-02; +4.437322027164503e-02   +5.914231704435799e-02   +5.556026870754865e-02   -2.743407290569009e-02   +9.068195016882900e-02   +3.116038221911913e-02   -2.845235465169176e-03   +6.386109074341391e-02; -2.823340497470611e-02   +3.878092574206506e-02   -9.521811787488703e-03   +4.247957262963883e-02   -3.819786459397822e-03   +8.111475320510261e-02   +8.294530214546401e-02   -2.848396802018962e-02; -2.649386807998094e-02   +6.845577551339348e-03   +1.983219312984910e-02   +1.187192429177122e-01   +1.555286451245982e-02   +9.863842158341103e-02   +2.396411794999830e-02   +3.413064192944170e-02; +7.439754504705220e-02   +9.231817497340651e-02   +7.923127298538757e-02   +3.721766086105756e-02   +6.771619402704074e-02   -2.617229434137387e-02   +2.637766287392048e-02   -3.697921122068288e-02; +3.788325463206606e-02   +5.914008478151658e-02   +8.517654620523313e-03   -3.169587615534315e-02   +8.462825805811588e-02   +7.243118911027854e-02   +3.107400265754844e-02   +6.074002962330914e-02; -2.446452317350440e-02   +2.361055536174302e-02   -3.856072799027077e-03   -5.837145284675622e-03   +7.754988260002407e-02   -1.447638806583046e-02   -7.000723239344624e-03   +2.735654177676989e-02; +1.183508278485627e-02   -6.970598513705838e-02   +6.726092856907737e-03   -1.442597043130756e-02   +6.068493444055828e-02   -6.004218511946976e-02   +3.868888899560467e-02   +2.738790517761197e-02; +8.162442454648725e-02   +1.486482387580019e-02   +2.150408425343298e-02   +6.821608818979166e-02   +2.822590999747934e-02   -2.621565961524397e-02   +3.722848620188867e-02   +2.838129712950492e-02; -5.847616336293373e-03   -1.843645458783542e-03   -8.923247249386538e-03   +8.429051654379797e-03   -2.224042219692443e-02   -1.508395797599851e-02   -4.060789230920962e-02   -1.620080746786540e-02; +1.679312996442893e-02   +3.915523164294419e-02   +6.637221531921331e-02   +3.943619420747314e-02   -7.382053761441099e-02   +4.751584634327428e-02   -1.192631226331728e-02   +3.680457314552410e-03; +1.786919852044917e-02   +3.374460883526465e-02   +4.527835642138110e-02   +1.268856614289643e-02   +5.323005159073082e-03   +5.440228927120231e-02   +7.027247984947788e-02   +6.443567978386296e-02];
L2I_L3I_iGABA_netcon = [+3.982203232041301e-03   +3.568160108647725e-02   -3.637352248309902e-03   +3.815183915524736e-02   -4.433516624638416e-03   +1.476374515898250e-03   +1.762774921840304e-03   +1.243911177055788e-02; -3.691835797663567e-02   +4.333412743149939e-02   +1.260103372662271e-02   +3.345803822006277e-02   -5.199226692317058e-02   +6.674788509096627e-03   +3.862661846090958e-02   +9.659264631399544e-03; -9.490629216196884e-03   +4.976628498523710e-02   +4.960533882708781e-02   +1.560316699676037e-02   -3.574744072789983e-02   +1.009237779998728e-02   +6.997420677561444e-02   +9.295110300654791e-02; +3.284243929005476e-02   +3.468407707389112e-02   +3.090410966126200e-02   +1.007450316421268e-01   -1.094097541326440e-02   -1.945358784028708e-02   +2.147239469756058e-02   +6.494288877524447e-02; +7.835313928348338e-02   +4.636914441953589e-02   +4.248566244614121e-02   -1.036046357122701e-02   +1.691968698960685e-02   +8.094923292722203e-02   +6.589749045248833e-02   +8.427697299476104e-02; +5.152754432278949e-02   +3.459418036612079e-02   -9.647083557342773e-03   +1.978488713471577e-02   +7.262549051097959e-02   +3.511213049155101e-02   +1.605464710739932e-02   -1.997720730255673e-03; +3.805707127038083e-02   +2.350291354509621e-02   +1.738454539644744e-02   +6.847706178968116e-02   +1.982896882457603e-02   -3.074215570295941e-02   -3.586776549645427e-02   +2.294834787352068e-03; -2.639659739879484e-03   -3.861941195500555e-02   +7.826874824764866e-02   +6.122851342846335e-02   +6.198528873993518e-02   -5.018960011559875e-02   +4.328142999018580e-02   +6.500994198242399e-03; +2.554314169550616e-02   -2.964522432757120e-02   +6.366960727369865e-02   +3.891668686277439e-02   +1.860098928738700e-02   +3.593535275994749e-02   +4.919153888583819e-02   +5.641149659742696e-02; -3.650737831146784e-02   +4.345236009975671e-02   +1.463970000998225e-02   +2.657847942586746e-02   +1.141748894611277e-01   -1.090620919870652e-02   +5.984522379825687e-02   +8.836132931906485e-02; -4.065928602395125e-02   +5.542587843965352e-02   -2.647427133185245e-03   +5.650304855393659e-02   +5.775434409128676e-02   +4.958063383342944e-02   +8.210387962601970e-03   +1.754080791081412e-02; +3.912936216111395e-03   -1.502945055441211e-02   +2.784132625888424e-02   -1.879312460925175e-02   +3.985240894981713e-02   +2.990436918503969e-02   -1.003733138527428e-02   -2.535659697331147e-02];
L3I_L3E_iAMPA_netcon = [-1.416830183104527e-02   -3.847371068990026e-02   +9.853832271792158e-03   +6.189109414714004e-03   -6.941000286724035e-02   +2.079972767430449e-02   +3.252321895449224e-02   -4.161787639418492e-02   -5.151733134977680e-02   -3.910535605539070e-03   +3.618404286215730e-02   -2.600949793768589e-02; -4.257080251478945e-05   -8.059730829200393e-02   +1.017114786177819e-02   +1.499527284395376e-02   +2.684659547476754e-02   +6.443721846685393e-02   +8.282878090804506e-02   +1.833421143352392e-02   +6.877868780073752e-02   -3.310058746864446e-02   +6.676042925275130e-02   +1.061496172825157e-01; -2.037158174952843e-02   +3.579759667906543e-02   +5.322916562502236e-03   +3.642421215735332e-04   +3.821175542835112e-02   +6.496753713260267e-02   -4.108685603676908e-03   +2.071963987213335e-02   +8.072491397076701e-03   +2.877209191575518e-02   +2.540512785341571e-02   +6.717230808809609e-02; -1.657013569514102e-02   +3.472648744584522e-02   -5.627455765953174e-02   +3.949818790670079e-02   -5.002032361734733e-02   -7.075920268228921e-03   +3.355944523830420e-03   +1.067201201604923e-02   +6.889229039658683e-02   -1.029971440174531e-02   -2.159561852340668e-02   +3.436733601562952e-02; +1.320035290290753e-02   +4.294425760530386e-02   -1.255004990237726e-02   -3.997717616207678e-02   +3.154726594677441e-02   +8.606073206782427e-03   -2.980938303836361e-02   +8.312767683853525e-03   +1.639500106173249e-02   +6.913628054207295e-03   -2.057453476484638e-02   +6.676412186554230e-02; +1.478946596820755e-02   +2.605689826154267e-02   +4.637925629981662e-02   +1.049021460332043e-01   -1.164630369322963e-02   +6.114610802279387e-02   +3.078962868299638e-02   +5.512785002182807e-02   +5.181009993524167e-02   -1.400576655059130e-02   +6.851291861939045e-02   +6.674382739756407e-02; -1.211130468828125e-02   +6.528744163653276e-02   +8.939982842074293e-02   +1.798124964416135e-03   +4.954887906608147e-02   +3.539423058365612e-02   +6.444019766984652e-02   +5.564495439769675e-02   +6.680915973687908e-02   +9.002356515162006e-03   -1.587376121959044e-02   +1.256498209246904e-02; +3.843635049098811e-02   +4.585399166486404e-02   -3.924144834829987e-04   +8.132472211082856e-02   +6.628655305927256e-02   +1.646846566122969e-02   -5.885577309747800e-02   +9.041316279740946e-02   -3.612182756348020e-02   +5.708147847165568e-02   +8.605208937811647e-03   -4.997787198998013e-03; -5.382457921317209e-02   -4.912140618718019e-02   -1.118697595642271e-02   +3.045885701614445e-03   +2.236948797465267e-02   -1.243720129346755e-02   +4.925318399958954e-02   -3.351989724340471e-02   -1.984975814762022e-02   +1.530791111011621e-02   +3.657513444932545e-02   +3.956798398608770e-02; +6.468758124077725e-02   +1.944086103647405e-02   +1.351886613615992e-02   +3.972615773608024e-02   +2.945457617453216e-02   +3.086702771053922e-03   +2.038488387872383e-02   +1.437455205479974e-01   +1.027798243841041e-01   -3.859041160708530e-03   -3.905516498992483e-02   +8.500123458846634e-02; +7.100073546244873e-02   +1.691818555354520e-02   +2.734055241989952e-02   +1.816166936891697e-03   -2.487582468305494e-03   -8.869035791389455e-03   +2.342376184732158e-02   +2.865054750730547e-02   -1.511181000149784e-02   -3.176119571099696e-02   -2.105167528218821e-02   +5.519148519354282e-02; +3.449295012996598e-02   -3.737664361332029e-02   +4.533582815315692e-02   +6.153832570946596e-02   -1.604289731404754e-02   +5.274328689021598e-02   +1.090225897785952e-01   -1.533734710651774e-02   -5.118371514897528e-02   +2.423600648364843e-02   +2.070478486428561e-02   +7.869228827339515e-02];
L3E_L3I_iGABA_netcon = [+3.264253729772483e-02   +4.764076388945736e-02   +4.434975648803771e-02   +1.172075028922744e-01   +3.057760345639919e-02   +3.731823707678239e-02   -2.370061243597599e-02   +4.815789739641646e-03   -5.382701650099388e-03   +4.441097619671269e-02   +3.907195810383095e-02   +2.220681571008003e-02; -2.916173644517747e-02   +1.060643806439767e-02   +7.493530476094404e-02   +5.932232194717817e-02   +1.860247345615955e-03   +4.613635477407309e-02   +5.189070574382489e-02   +7.163114022198866e-03   -6.672772062125257e-02   +5.259756087972189e-02   +7.150765846469624e-02   +3.969646264677855e-02; +5.646202407950239e-02   -2.377216893704227e-02   +1.854757708129100e-02   +5.829851643815798e-02   +1.858605873756868e-02   +5.164799142356225e-02   +6.515559312307939e-02   +5.433986034240176e-02   -9.970498383664301e-03   +7.462829548218231e-02   +1.021418228449365e-02   -5.253337858742943e-02; -8.765987039627591e-03   +3.678834570892951e-02   +1.428490041440531e-02   -2.146032550008509e-02   -3.390976085628668e-02   +6.370264073838841e-02   -8.907065531223383e-03   -9.204432319935970e-03   -1.734746470014779e-02   -3.892727918034099e-02   +8.970382593587337e-02   -3.468939903405027e-02; +4.184096581149784e-02   +4.739515127573132e-02   +4.253896637645142e-02   +1.304508137369769e-02   -3.181654637020958e-02   +3.478392501015266e-02   +3.678643330401507e-02   +1.410462479261268e-02   -8.278197040625273e-03   +6.322607005185382e-02   +4.443480109574535e-02   -1.460353327681345e-03; -1.278719549863334e-03   +7.560586160226378e-05   -5.179568211053632e-03   +4.513005774859619e-02   +9.037782978495440e-02   +5.447600416686652e-02   -1.601700599910883e-02   +2.103296437863592e-02   +1.536141779441373e-02   -5.631451062951470e-03   +1.770093452913002e-02   -2.410063459606657e-02; +3.655442489832060e-02   +5.084602974232970e-02   -3.428456886006929e-02   -7.089505306340500e-02   +8.359889173742141e-02   +6.517590123461220e-02   +3.455591191621410e-02   +2.218206848318810e-02   -1.575104698223264e-02   +3.120177672792280e-02   +3.024460490863689e-02   +2.162619037405016e-03; +2.774935624592413e-02   -1.300128996473560e-02   -9.906298593305028e-03   +8.489769050675780e-02   +4.470792131305720e-02   -3.040659521424554e-02   -1.875463622038545e-02   +8.253375890529117e-02   +2.785858610150453e-02   +2.171518377624294e-02   +4.830572148117243e-02   -1.475301825387861e-02; +1.208199760010927e-02   +4.552742648250006e-02   -3.182794392846226e-02   +1.406942288049000e-02   +1.293248003789486e-01   +8.898977666180315e-02   +3.462400946897849e-03   -4.346997524254572e-02   -2.856818974565735e-02   +7.002264618441882e-02   +5.797884861453947e-02   +3.096219003066378e-02; -3.090053731290246e-02   +5.868720249586980e-02   +3.336011841670444e-02   -1.945244246160917e-02   +1.982441294261550e-02   +9.621293457649640e-03   +7.190603541962196e-02   +1.163936811527855e-02   -1.394428047869370e-02   +5.408623976363083e-02   +8.957407301626100e-02   -2.743948347144844e-02; +5.006003502677549e-02   +1.048662468850375e-02   -3.082974061447231e-03   +9.242618907740537e-03   +5.938377498844759e-02   -3.354296395451613e-02   -3.407723485256994e-02   +6.539606769644758e-03   +8.413837829376131e-03   -6.488282744976144e-02   +1.292183400234311e-01   +2.717645217727695e-02; +3.410453329886638e-02   +2.580377182932335e-02   +1.648383687229627e-03   +2.798968232515026e-02   +3.493246911585972e-02   -3.185890443384740e-02   +6.144709504453206e-02   -3.562892836160659e-02   -3.799762746637412e-03   +7.752323982799518e-03   +2.287444296993957e-02   +3.926857827745653e-02];
L2E_Input1_iAMPA_netcon = [+2.202048174573558e-02   +4.429199231533477e-02   -1.252872693307350e-02   +1.238368075280648e-02   -6.052506693470308e-03   +3.333350762216942e-02   +5.963731364390250e-02   +9.067614974927332e-02];
L2I_Input2_iAMPA_netcon = [+8.767542002991159e-02   +2.197899286551692e-02   +5.686013254766063e-02   +5.261634203616693e-02   +2.827879072647754e-03   +7.884100068442715e-03   +9.432403590273947e-02   +1.159234520896647e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
