function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.412042482760025e-02   +3.457695844215072e-02   -6.093532428159794e-02   +1.712908695834718e-01   +1.154413600655165e-01   +1.600274269645305e-01   -3.332017047007699e-01   +1.977921532343916e-01   -1.784514500836239e-01   -3.235435938162433e-01   -2.982360986324879e-02   -1.650903071642859e-01   -9.560286639339174e-02   -2.914336200207027e-01   +1.693088029859436e-01   +7.716918888356247e-02; -3.742667227729006e-01   -2.262045513783935e-01   -7.104867601016521e-02   +1.426203307110176e-01   +5.521161070557924e-02   -2.449690977402971e-01   +8.574951378308383e-02   +3.660522025251010e-01   -6.377749188072848e-02   +1.980851617631003e-01   +1.263534354516912e-01   +1.641131109086520e-01   +1.775174227704624e-01   +3.359455422093386e-01   +2.700592590529344e-01   +3.780982870752431e-01; +2.304150454718339e-01   +3.056490909506885e-01   +3.893365106733088e-02   -8.572206005490034e-02   -2.988765829208636e-03   -1.186278873627869e-02   +2.002152567891041e-01   +4.457769280357414e-01   +1.934451619999028e-03   +5.577398881169574e-02   -9.210707316285242e-02   -3.055802413797737e-01   -1.358984549932915e-01   -1.142838847417716e-01   +4.191331586688556e-01   -1.471217045843284e-01; +2.428352373623921e-01   +1.308100393635378e-02   +1.156538237937072e-01   -3.680584443768106e-02   +2.419841666244420e-01   -2.245277740695240e-01   -1.691606700742268e-02   -1.773303728627883e-01   +2.092155883357905e-01   -1.093674714358049e-01   +3.103851870142497e-01   -2.485002766003889e-01   -3.625025360241576e-01   -4.715807939490072e-02   +1.181750316732498e-01   +2.392468301880669e-01; -3.757228244042964e-02   +2.651929624856000e-01   +9.005946120668082e-02   -2.140890156838535e-01   +1.885368741391502e-03   +1.302186609494045e-01   -1.260337425159051e-01   +1.596849951294474e-01   +2.330794694474093e-01   +3.195547994941152e-01   +2.870699783432067e-01   +2.914087456599242e-01   +3.743524443389541e-01   +4.095707822638852e-01   +3.965066800372940e-01   +2.243280588219157e-01; +1.258563849444801e-01   +2.532222975070830e-01   -1.717524454275384e-01   +3.174034643247937e-01   +1.829161764729637e-01   +2.310515504870573e-01   -1.833470040823202e-01   +4.337403398283004e-01   -4.989931085256336e-01   +7.933280522137451e-02   +2.294478086672853e-01   -1.508062595591231e-01   -7.051093462989873e-02   -2.016608467827773e-01   +2.536043139820376e-01   -1.855602945861071e-01; -6.742642135056945e-02   +6.433882624614493e-02   -2.571274325021239e-01   -4.197688472479133e-02   +2.355527734952068e-01   +4.099176315286764e-01   -1.003822623004108e-01   -2.624255316888679e-01   -1.022432895891547e-01   -6.497744280927062e-02   +2.533012918199656e-01   -2.747695949399419e-01   +1.204998719295358e-02   -5.864727959502047e-03   +5.612534293825223e-02   -2.559747957031795e-01; -2.361445171154172e-01   +2.254003883965775e-01   +2.656035999532538e-01   +3.905661145102279e-01   +2.454234228869541e-02   +4.896887205624019e-02   +1.745120964748003e-01   +9.661050944758620e-02   -2.798749021228492e-02   -1.257866974040102e-01   -2.374229038501017e-01   +2.526757904886875e-01   -1.870271697918419e-02   -2.926114096878477e-01   +1.185542747009019e-01   +2.454915343603446e-01; -1.795729728483725e-01   +7.987722764417088e-03   +1.173638599005952e-01   +3.790233047405528e-01   +1.811090885351379e-01   +2.819962541302181e-01   +2.038597472136940e-01   -3.158782493088933e-01   -2.505272429101453e-01   -1.980221760400637e-01   +1.653261528070911e-01   -9.837907393179993e-02   -5.157026114894769e-04   +3.508719645026787e-02   +3.029301795200490e-01   -5.166722003464014e-01; +2.504375595441731e-01   +2.877627119476705e-01   -1.001019045056231e-01   +1.364178382503864e-02   -1.981462937677555e-01   -3.323565924522009e-01   -2.441876759990881e-01   +2.792126039773386e-01   +1.671851369437237e-01   -1.305128029228629e-01   +1.442303464868588e-01   -8.048170824209171e-02   -9.864997634386094e-02   +2.366967300685096e-01   +7.499856434341859e-02   -6.107331664718210e-02; -1.317187475615116e-01   +9.668133077485529e-02   -2.729662624034437e-01   -3.076968764481475e-02   +1.255321047823144e-01   +7.030385548568163e-02   +1.066366870519236e-01   -1.731963520708302e-02   +4.697688355100922e-01   +4.638721741757196e-03   -3.050033321260686e-01   -3.981628307028583e-02   -1.162111760064627e-01   -7.378540335729766e-03   +1.640745903569336e-01   +1.227628307857083e-01; -6.944272587029900e-02   +1.331103514139254e-01   -1.381596523793656e-01   -6.747057563060838e-02   -3.166700696933553e-01   -1.794675914530082e-01   +1.829088683740638e-01   -3.374729928244275e-01   -3.096481865966405e-01   +2.480758858000587e-04   -1.110176541898308e-01   +9.894478899129693e-02   -3.041035576666299e-01   -9.393816490733707e-02   +2.006458596260742e-01   +3.503981291855873e-01; -1.556779105456567e-01   +4.255174313305916e-01   +2.697379738572864e-01   +6.577972702442639e-02   -3.274077458194117e-01   -6.776968493773693e-02   -1.415189867589061e-01   +3.552627191735999e-01   -5.897845641713666e-01   +1.294069520602258e-01   -5.069294615745627e-02   -2.437056244794553e-01   +3.251783171114744e-01   -1.631035277260215e-01   -1.429606462746466e-01   +8.921009317313779e-02; +1.329458002157075e-01   +1.405246555560295e-01   -1.761057855665147e-01   +8.666300949419695e-02   -1.978881248630783e-01   -1.080921934293248e-01   -2.867073209157960e-01   +1.784796919092113e-01   -7.029366144239141e-02   +5.534448209994115e-02   +2.520676193286644e-02   -2.234726815867915e-01   +2.530059509031645e-01   +3.062763219450909e-01   -1.297186186800861e-01   -8.866241279781398e-02; +5.740427221514662e-02   -3.144783921340684e-02   -2.209396166176057e-01   +1.630701902958879e-01   +2.199398713674652e-01   +1.896074372788966e-01   -5.650899447975262e-01   -6.521800771805954e-02   -2.871841265021516e-01   +3.807363029747202e-02   +2.083549864151397e-01   +1.888132684641365e-01   -3.026622769509543e-01   -3.206547670468014e-02   +3.296883935374048e-01   -8.539235924174790e-02; -1.048768453857254e-01   -2.507072183958786e-02   -2.397117839700793e-01   -2.654923073567503e-02   +1.130286616913177e-01   +4.510666107265870e-02   -2.787091250439933e-01   -3.234834145305275e-01   +8.655060034415267e-02   -1.690132933169698e-01   +3.389559562504582e-01   +1.832403718807236e-01   +1.245461924282636e-01   -1.904224904314452e-01   +2.082427378408535e-01   -8.152646149795981e-03];
L1E_L1I_iGABA_netcon = [+2.365540705797265e-01   -3.929185353829090e-01   +1.251370551282587e-01   +1.666553572937539e-01   +1.028484708480958e-01   +1.100843951093477e-01   -7.613351568998747e-02   +2.748237209371445e-01   +3.105542361925079e-02   +3.748346435968153e-01   +2.124550692663024e-02   -4.379147293788933e-03   -1.604777359522657e-01   +4.257683825615137e-02   +4.588946423660051e-02   +3.483717310824331e-01; -6.128717823136337e-02   +2.429504772897995e-01   +2.828282961560454e-01   +1.085778860724317e-01   +4.049428304008222e-02   -3.218419051679630e-02   +1.635124253743382e-01   +2.098375630511226e-01   +3.889308757954350e-01   -1.680089125851730e-01   +2.366374327868845e-01   +1.643810454274086e-01   -2.241764761266453e-01   +9.480724403468735e-02   -1.726710361159668e-01   +2.961218868441796e-01; +4.409267695017496e-01   +3.791611352701407e-01   -5.093233723636001e-02   -1.322658135675814e-01   -2.051497633742277e-01   +3.486663068217155e-02   -3.413101540226993e-01   +1.003131784190334e-01   -2.635893546512232e-01   +4.722378097920443e-02   -9.178357597180162e-02   -7.814080886608862e-02   +1.926253995056021e-01   -4.625914377650861e-02   -2.215921146204068e-01   +4.745159076776585e-01; -2.175700603034604e-01   +1.558490003999588e-01   -2.809764038556580e-01   +1.524233783525428e-01   -1.184296026399507e-01   +2.348359953179658e-01   -2.678877237934741e-01   -2.141226699610965e-02   -1.882423560407363e-01   -5.342624783951715e-01   -1.262929404077024e-01   +3.761493794330030e-01   -8.195732874443484e-02   +1.983099048865534e-01   -1.410996228200523e-01   -4.089151798318014e-02; +8.707768924547701e-02   -2.924105593896160e-01   +2.806845721043834e-01   +2.289648265170644e-01   +1.150010516908795e-01   +5.536634792700126e-02   -2.396957352389953e-01   +3.673242470510613e-01   +2.464943229686330e-01   +6.263577906985307e-02   -5.081897870218385e-02   +6.111156186411252e-02   +1.657848969177338e-01   +4.476251415213535e-01   +2.311822398807803e-01   +3.350753601665503e-02; -2.864383048274777e-02   -2.053428747247327e-02   +1.234038527183453e-01   +1.924922243401341e-01   -5.647907070581965e-03   -7.308787570505249e-02   -5.241278191410655e-02   +3.009383990359860e-01   +9.844790271724413e-02   +1.532260364192221e-01   +1.713531545544845e-01   +3.251966342268900e-01   +2.336497254012667e-02   -3.042354259637772e-02   -5.570747531638900e-01   +1.694769294794716e-01; +2.771270147376773e-01   +1.975105550363612e-01   +7.005909667358130e-01   +4.202555505800840e-01   -2.093215891141367e-01   -1.113060560013666e-02   +7.493566089518007e-02   -1.061934835176416e-01   +3.710778540988378e-02   -1.501086202907827e-01   +1.966292665936081e-01   -1.483485072317623e-01   +3.298080127347499e-02   -2.390861292469701e-01   -3.704812034810775e-02   -7.923041691987265e-03; -4.897550897789695e-01   -2.602388617194388e-01   +3.699740226239182e-01   +4.213906110830570e-01   +3.746271519545661e-02   -3.138935734099871e-01   +1.628718583909200e-01   -2.887050082397850e-01   +1.275375823164837e-05   +7.673182085251196e-02   -6.259552133500126e-02   -1.219984523456530e-01   -2.734554924124503e-01   +1.139543114053055e-01   +3.954472990621012e-01   -9.609634697612887e-02; +2.129203320177966e-01   -4.786082171319561e-02   +6.864333812579659e-02   -2.151668872582575e-01   +3.593450689014192e-01   +4.266259383121010e-02   +2.556905821869610e-02   +3.024455390418965e-02   -2.406704097856643e-01   +2.311087742169202e-02   -3.779255021057439e-02   +7.104273813524414e-02   +2.017722785969913e-01   -4.071281373461207e-02   +3.345020134152532e-01   +2.821207262468924e-01; -2.066455490797099e-01   -2.363670211023671e-01   -1.986476998658537e-01   -1.429685371594574e-02   +4.530998472638434e-01   +9.146935796586850e-02   +2.006858850084519e-01   -3.864029184201135e-01   +5.315472152512808e-02   -9.137293683654364e-02   -1.936570165189631e-01   +3.452794693256230e-01   -3.602886517385901e-01   +6.571187233786024e-03   +5.167644202105536e-02   -1.353719510428504e-01; +1.631856232051818e-01   +1.321576411331788e-01   +9.012905426989423e-02   +3.426822697296000e-01   -6.433431795006957e-02   -1.976626726227773e-01   -7.729670111540969e-02   +1.620689423759393e-01   -9.460299386303338e-02   +1.880657476148336e-01   +7.068175682073613e-02   +1.219727964219592e-01   +1.808879420623449e-02   -6.332891729083498e-02   -7.550842871153129e-02   +1.781806330356517e-01; +2.726665354087630e-01   -1.130708298411962e-01   -1.363686882832096e-01   +4.839906345578060e-02   +2.755675966178306e-01   +1.529996344627390e-01   +4.664557091326507e-02   +2.934972032445026e-01   +1.899846677184008e-01   -1.122496591857874e-02   +3.506989020987264e-02   -1.400965939417227e-01   -8.913126638412899e-02   +2.910232100692264e-02   -2.990701869446060e-01   +4.409143217358648e-02; +3.728064762734877e-01   -1.057467883853639e-01   -4.789195785166986e-02   +1.388061867022532e-01   +7.084199489487825e-04   +9.880046465136426e-02   -5.849695691797644e-02   -2.908210358579376e-01   -4.165892338834011e-01   -6.960616188120676e-02   -9.499018333581769e-02   +1.530857607946570e-01   +3.732005720962485e-01   +1.773552169763328e-01   -9.330952266890569e-03   +4.445830270391710e-02; +1.129281482659251e-01   +1.242351105350876e-01   -2.757507520450800e-01   +5.680530270103214e-02   +1.139691352445779e-01   -2.698742883151745e-01   -1.134132547437101e-01   +4.334117363664704e-01   +1.346619054132771e-01   +4.439170351945744e-01   -1.462973598626859e-01   +2.618671179407552e-01   -2.731179097639537e-01   -3.979375618199373e-01   +5.686536770488727e-02   -2.413284393138803e-01; -3.019676096113068e-01   +1.164117274582803e-01   +8.054010320682164e-02   +5.949933298698783e-02   +2.020845979628456e-01   +1.151936631738748e-01   +2.972924723119214e-01   -3.490185697496484e-01   +6.571252095480604e-02   -1.938616260165372e-01   -3.454660834897451e-01   -1.161213114042618e-01   +8.954021839072254e-02   +3.453614144165846e-01   -2.890188973837016e-02   +1.723192198175482e-01; -2.016858711993086e-01   +4.600398887976913e-02   -1.458478608826748e-01   -4.455419820122420e-02   -5.426523350387651e-02   -2.769483842676638e-01   -6.267660603642375e-02   +3.101318474082129e-01   +1.838182617169747e-01   +1.440825080777462e-01   +1.347891046327106e-01   -2.727680749335741e-01   -3.086001101902970e-01   -1.835041538651765e-01   +9.461691364555803e-02   -2.037130793668374e-01];
L2I_L1I_iGABA_netcon = [+2.614624429927924e-01   -2.185710442109348e-02   +2.501209928406398e-01   +3.032330344667895e-01   -3.097916377804875e-02   -1.510655907335004e-01   +3.812349673521165e-02   -8.965013852248904e-02; -1.115542976026458e-01   +1.118609346337541e-01   -8.528246982727339e-02   +1.612671726104704e-01   +3.228662432313261e-01   +4.723970547164377e-01   -1.350710122187562e-02   +2.135589814177853e-01; -2.027348031628297e-01   +2.233855790290722e-01   +1.418146623265570e-01   -1.867473740946073e-01   -1.967414921331192e-01   +6.694635174342459e-01   -4.459405522457199e-01   +3.101832610673449e-02; +3.975511343591268e-02   +3.736035732530922e-02   -1.416679214384475e-01   -1.491003302510806e-02   -1.746398358640695e-02   -4.310958054975889e-01   -1.059955006809018e-01   -1.400660770522221e-01; -7.134962375798168e-02   +6.162070643227613e-02   +6.767280801992084e-03   -4.504116825932275e-02   -7.760560674709802e-02   -2.460111330692450e-01   +1.261952173876563e-01   -2.887305620042191e-03; +2.248656827536432e-01   -3.664377140932873e-01   -1.711936146192236e-01   +2.134079177190908e-01   +4.057818968045048e-01   -1.015560239348242e-01   -3.560058460904567e-02   +3.482026555143791e-02; -5.200112285675049e-02   -5.690647558834920e-02   -1.294332653356581e-01   -3.738555083051315e-01   -2.299054951460941e-01   +1.574287472901680e-01   +2.503789038988001e-02   +1.855252488895032e-02; -2.721607011247978e-01   -9.125352731256212e-02   +6.406001015049116e-02   +9.562056777555654e-02   -1.508388021717995e-01   +9.045611801164789e-02   -9.286747679993118e-02   -1.491936518870226e-01; -1.804639101092636e-01   -7.496633105709571e-02   +2.309890402054542e-01   -2.210103818715675e-02   +2.650324639971323e-01   -7.157057846357341e-02   +1.223941512498558e-01   +2.395715932365900e-01; -8.789853599883232e-02   -9.972906554241527e-02   -1.562542820563034e-01   -4.344138542840306e-01   +1.426390307142127e-01   -5.729420297114662e-02   -4.941479285929739e-01   -2.467135863108092e-01; -2.556016601617936e-01   -2.083547119189115e-01   +9.762637480915560e-03   +1.583316110386429e-01   +3.370178207193090e-01   -1.798777624357661e-01   -1.984576154354368e-01   -1.702620827338032e-01; +1.963736626364611e-01   +3.522992541698814e-02   -1.017006400216147e-01   -7.831506020017448e-02   +7.119669686298460e-02   +1.373562539479234e-01   -2.916680921778038e-01   -4.749380437574862e-01; -3.013512229519736e-01   +1.347113783934636e-01   +2.270947001557733e-01   +2.214152641507061e-01   -2.700855608825605e-01   +1.473946427583255e-01   -2.605829201033468e-01   +3.344865616536590e-01; +3.588651010079788e-01   +2.955170526005069e-01   -2.767925759633448e-02   -9.957232224865664e-02   -3.373779813135082e-01   -4.304026153353516e-01   -1.204141983036762e-01   +2.188458769526353e-01; +1.567387802813890e-01   -3.676264198094388e-01   +4.596851220576659e-01   +1.058684219711908e-01   +2.785982171369348e-01   +1.614560155180344e-01   +4.057783754461952e-01   +2.495202937820807e-01; -5.222786037375331e-01   -8.562510787878615e-02   -2.304191158203497e-01   -2.740542770941100e-01   -6.746403353861813e-03   +2.672708272320087e-01   +4.829334418768032e-01   -1.154611851561115e-01];
L1I_L2I_iGABA_netcon = [-1.058735627653413e-01   -2.008037437638376e-02   -6.306344632032694e-02   +1.515432271599410e-01   +7.964081306670277e-02   -1.390391152217978e-01   +4.593064936142820e-01   -2.435406699541506e-02   +9.312873984462194e-02   +2.903469310344375e-01   +7.785642426067069e-02   -2.176147541267475e-01   +1.525762870991196e-01   +6.276983314161054e-02   -3.780282614461868e-01   +2.140680595390035e-01; +9.004182874534671e-02   +7.574026277576126e-02   -4.047129047879747e-01   +8.524869266228724e-02   +3.688223385059521e-02   -3.778721249337431e-01   +1.230327399991998e-01   +1.869161124185982e-01   +2.165729785638159e-01   -2.313104988919019e-01   -3.026784054768858e-01   -1.304089500982911e-01   -1.268557100147013e-01   +2.172018339030865e-01   -9.335195814806696e-02   +4.013112885295819e-02; -2.688362872066540e-01   +4.181836700262851e-01   +1.689612031791220e-01   +7.424632345735326e-02   +3.251819032412558e-02   +3.165183040275032e-01   -1.508477882612188e-01   +1.916117449397688e-01   +1.335424920255854e-01   -9.990730913269202e-02   -1.823529452634714e-01   -3.652467871020018e-02   -2.209675393544173e-01   -3.307006102110857e-01   -1.357396817377166e-01   -1.917929055677750e-01; -1.659730618868147e-01   -3.198284477334794e-02   +1.938172642592826e-01   +5.343649887529950e-02   +1.874438574359449e-02   +1.489893711889748e-01   -1.944565461616994e-01   -1.287719327029053e-01   +8.204355403016284e-03   +1.583034493540240e-01   -4.716427652576916e-01   +6.762500146854736e-02   -1.430010391765358e-01   +2.781669571041437e-01   -1.755349941114414e-01   -3.967683892024241e-01; -1.967690714389077e-01   -1.915062454836392e-01   +7.489616175354555e-02   +2.451953326768267e-01   -1.416550967584018e-01   -3.886634786377085e-02   -4.994858918876827e-01   -9.940437858311971e-02   -3.757477826361630e-02   -3.980993522776691e-01   +4.832919518326678e-03   -3.106467458524430e-01   -5.795818873305691e-02   -8.724526273986387e-02   +4.229032094530328e-01   -1.875560331320260e-01; -2.707490082336066e-01   -6.063361875884665e-02   +7.767421025448997e-03   +3.036989065076306e-01   +2.772283815953024e-01   -2.817143398026371e-01   +1.002597438361701e-01   +1.415257297058327e-01   +2.973672681054190e-01   -1.741517443327621e-01   +4.683448995809950e-01   +9.452431858971792e-02   +1.619020525310153e-01   +3.517278021717249e-02   +2.861175131912237e-02   -7.024672170231905e-02; +7.820470850465092e-02   +2.842693764784688e-01   -2.580100905823699e-02   +9.170433036131619e-02   +2.167224339501451e-01   +1.561499294934770e-01   +5.408851515416579e-02   -1.421027719021078e-01   +4.158788971927413e-01   +3.592581548060083e-01   +4.514922486798320e-01   -4.137441617202468e-02   +1.782079079111034e-01   +2.583732067331900e-01   +7.447737405600491e-02   +3.597939503599688e-01; -2.210236509718385e-01   -1.415520774849000e-01   +2.661777230230886e-01   +2.004560260316334e-01   +2.915581443463798e-01   -7.843034594342024e-02   +3.894074189089873e-01   -7.832851338537866e-02   -1.274515570299593e-01   +5.579005347211921e-02   -6.647772893000756e-02   +3.014521428149568e-01   -1.944179889437583e-01   +3.919105614003340e-01   -2.613850526283400e-02   -3.261124708288693e-01];
L2E_L1E_iAMPA_netcon = [-1.408628420759095e-01   -1.421301965443361e-01   -3.601328417077925e-01   -3.841099268163053e-01   -6.997409550758012e-02   +2.598160800607416e-01   -4.712065935979475e-01   +3.885318642272447e-01; -1.895101575356534e-01   +6.828561039050510e-02   +3.504250376885425e-01   -1.252983577393468e-02   +2.937649284019320e-01   -2.748992129490999e-01   -1.369676163177644e-01   -3.179926238133716e-01; +8.881668938830991e-03   -5.141185338621994e-02   +3.891530651645145e-02   +4.599693871052629e-02   -4.212901660286070e-01   +3.034717862939766e-01   +3.766340802220082e-01   -3.068868742965828e-01; -1.226752608719918e-01   -6.002137174420344e-03   -1.444969939386641e-02   -4.018078722713551e-01   -2.786325032787965e-02   +9.993787082347685e-02   -1.057503731172914e-01   -1.058383362088581e-01; +3.086990573418206e-01   -2.378349092379738e-01   +6.655539660795601e-03   +6.837859671021725e-02   +5.419660666607554e-03   -2.518205445596967e-01   -1.550261681838683e-01   +9.949397824256455e-02; +1.856776392136078e-02   -1.762601533817004e-01   -1.493376740290465e-01   +2.354483155091242e-02   -6.119823298016125e-02   -2.113254136166720e-01   -2.318258867875527e-01   +1.344596554192733e-01; +2.406361369545807e-01   +1.934792706614097e-01   -2.506987765532945e-01   +1.427588836626010e-01   +6.017958769223647e-03   +9.339285390611070e-02   -2.396068084847922e-02   +2.945127070167794e-01; -5.407408329677194e-02   -3.768166098124200e-02   +7.930005980329329e-02   +2.227037784966670e-02   +1.227119646352102e-01   +1.620101000405283e-01   -2.920357036751186e-01   -1.529632243288677e-01; +4.208539786047147e-01   -9.049905077893688e-02   +4.744209668395827e-01   +7.794087935437002e-02   -4.368738943105607e-02   -2.146469251526620e-01   -2.404143634413417e-02   -3.314752597906380e-01; +5.625958351384193e-03   -2.248938716905600e-01   +1.311052888621576e-01   +2.142252969665349e-01   +1.155718616528064e-01   +1.585443128067503e-01   -2.023952721972558e-01   -1.897421024065113e-01; +1.010360117000095e-02   +3.026588513574577e-01   -9.284785267540208e-02   -5.066509397661116e-01   -6.275962502410315e-02   +1.809503601423241e-01   +1.605249999363260e-01   +1.232408578381572e-01; -5.966537115586229e-02   +1.251665083450855e-01   -1.463109089816770e-01   -5.514751333824251e-02   -2.163163206011477e-01   +1.775638564588731e-01   +9.425396115835333e-02   -5.609449810605804e-02; +3.194067125848225e-01   +1.821759544353991e-01   +4.275467260547467e-01   +4.507206031777504e-03   -1.635237450296853e-01   +1.473223953311698e-01   +6.422050360466554e-02   -2.756561272562677e-01; -2.096442462408593e-01   -1.251050685278513e-01   -1.293464911662370e-01   -1.185895860015019e-01   -2.676400551773128e-01   +2.847107555926219e-01   -1.305783386719893e-01   -8.500654344519731e-02; -3.311825085236064e-01   +2.792407371508384e-01   +9.004616874556279e-02   +1.573054997008488e-01   +1.003342923476588e-01   +1.801521791043243e-01   -2.418867594501898e-01   -2.122721713359110e-01; -2.802022144432301e-02   -7.549443827823527e-02   +2.716560206764530e-01   -2.029969067176705e-01   -1.965861196952363e-01   +3.214397290199451e-02   +2.894894202010687e-01   +3.880661041151029e-02];
L1E_L2E_iAMPA_netcon = [-5.646564532929292e-02   -1.083988362785687e-01   -1.274542872124751e-01   +3.199547532213188e-01   +3.373258671964734e-02   -9.748813759506181e-02   +6.020865391794680e-03   +1.608138226127153e-01   -1.506537400288618e-01   -2.688729852832011e-01   +1.807832950752837e-01   +1.429181824461759e-01   +4.187432272894388e-01   -2.175112811218121e-01   +1.844505962583305e-01   -1.196175912573270e-01; -5.267554695782908e-02   +2.204869777505785e-01   +4.101811226710612e-01   -2.407281049651546e-01   -3.037125516284755e-01   +1.612077908670237e-01   -3.780836683055890e-02   -4.072691416666317e-01   -1.141261121257475e-01   +3.587899582389328e-01   -3.234458005095185e-01   -8.377088259250155e-02   +4.879664673340973e-01   -3.731507619972094e-01   +8.936384432057426e-02   +4.984456316081803e-02; -1.806848538510626e-01   -1.358764780204538e-02   -1.155415373295134e-01   +1.261092598094264e-01   -9.378094787432262e-02   +2.371698692560568e-01   -2.874589388582272e-01   +4.162709916644620e-02   +3.272695648028401e-03   -1.225576878394226e-01   -1.089278318496412e-01   +1.564353580789254e-01   -1.277764922261163e-01   -3.564783483711843e-01   -4.456511728428923e-02   -1.497789006836373e-01; -1.152570780536034e-01   +1.349652584018255e-01   +4.727502166638012e-01   -1.685571288786242e-01   +1.270463744039579e-01   +5.154550411026082e-03   +5.820155598173524e-02   +1.937985190231196e-02   -1.953218823482696e-01   -1.721597722581022e-01   -1.786298297425558e-01   +1.000321775471498e-03   -1.085016265695117e-01   -2.112293116409704e-01   -6.041465825760946e-02   -2.840259316331704e-01; -2.840648204901875e-01   +3.667507259524657e-01   +3.779194243413404e-01   -3.178118515347992e-01   -1.250218926761060e-01   -8.985943899848872e-02   -1.120582378568954e-01   +1.583143030173932e-01   +1.415799107257351e-02   -5.886505139004229e-02   -7.368945840035915e-02   +2.753552635032154e-01   +3.967349367746398e-05   +2.281288579882892e-02   +2.282792267319864e-01   +3.731639349693107e-01; +1.438236726727196e-01   +5.872046900270475e-02   +7.913866414068794e-02   -2.491413368068494e-01   +2.020355238892227e-01   -2.069722632891487e-02   +2.600455454820535e-01   -4.083892933643937e-01   -3.647178576163257e-02   +2.034817007499974e-01   -2.009076264306681e-02   -5.025689396059571e-02   +1.039806491211972e-01   -2.841148547213610e-01   +2.004161103598896e-02   -3.983920071626433e-01; +1.410424470507644e-01   +1.142337915009356e-02   +2.335930467396606e-01   -1.961198760100664e-01   +5.539430954603825e-02   +2.155164977077520e-01   +2.413507380479937e-01   -1.586198979325956e-02   +2.125938275555784e-02   +1.609326417857566e-01   +9.906730934444612e-02   +2.106650599357384e-01   -1.434489746787941e-01   -9.143791733902227e-03   +8.856964845535710e-02   -1.699167217073078e-01; +1.184522467283667e-01   +2.171791666906845e-01   -6.810699365685123e-02   -1.694348636170005e-01   +5.148935094674741e-02   -2.417812221705335e-01   -2.817393631401588e-01   -2.655530151208489e-01   +7.445667590127159e-04   -4.839341683576769e-03   +2.247217334335687e-01   -1.704125383765782e-01   -2.547621449970663e-01   +1.736047220333217e-02   +3.102739078854010e-01   +1.873039208345900e-01];
L2I_L2E_iAMPA_netcon = [+1.254157347334472e-01   -7.990742876935016e-02   +1.203840173983555e-01   -1.389890857951440e-01   +1.072847409413710e-01   +4.367852030453058e-02   -1.911728605172636e-01   -1.969745414619941e-01; +6.586982918647220e-02   +2.514026995763535e-01   +3.302016073864024e-01   -2.766361840170761e-01   +1.132317033565476e-01   +2.995210571406847e-01   +2.763622172451651e-01   -3.279665246556002e-01; -2.387518472575026e-01   +1.412142855631351e-02   -3.216066736341436e-01   -9.600999569100935e-02   +2.552612936360787e-02   -3.471502180737721e-02   -2.724924855148374e-01   +1.194362114808009e-01; +2.742368511370820e-01   +1.614854691823131e-02   -1.168817165985673e-01   +2.088641673568218e-01   +6.410372901853911e-02   +2.184783990703663e-01   +2.921601129454164e-01   -5.294641063596682e-02; +3.542343988821322e-01   +2.284749187578385e-01   -5.998961353919349e-02   +4.436164939293139e-01   +1.548945604826268e-01   -1.736029703235290e-01   -2.629032107775650e-01   -1.411684073660810e-01; +1.235953264438858e-01   +4.604862604626610e-02   +2.162804365526973e-01   +1.080199580012636e-01   +5.913089232204029e-02   -1.885311902931799e-01   +5.244899066105413e-02   +5.804731772765720e-03; +2.523345803073506e-01   -9.207380627767493e-02   -1.582401377479272e-01   -1.163467644940602e-03   -1.672143519653592e-01   -4.455138526929456e-01   +5.701847115716676e-02   -2.368360855761548e-01; +2.085437482501871e-01   -8.703531467879690e-02   +2.712893693503991e-02   +3.882022305380176e-01   -2.700715606465967e-01   -3.847808687845295e-02   +3.223766462366410e-01   -4.307728221181649e-01];
L2E_L2I_iGABA_netcon = [-2.117608347043446e-01   -8.069169191210718e-02   +6.452211519132722e-02   -9.248426040103569e-02   -6.904835463744805e-02   +5.411885898503319e-02   +4.466396967391227e-01   -3.246048745999736e-01; +3.455566486188894e-01   +6.428946549286572e-02   +1.784009741780817e-01   -1.098110093523277e-02   +4.881266999229543e-02   -8.920193936294898e-02   +2.169336159797939e-01   -1.206183153945010e-01; -5.738213896251340e-02   +5.405944584998504e-02   +1.261736011612072e-01   +1.293008220168906e-01   +9.471791602047699e-02   +2.730484343270557e-01   +6.656348939085011e-04   -8.751405683854878e-02; +4.557109304854461e-01   -1.529567366403146e-01   -9.617661981037598e-03   +1.358870094867656e-01   +4.421003178772393e-01   -1.572285699395879e-01   -8.889502456846243e-02   +6.180982610198402e-02; +4.290861033813119e-01   +1.143657707523978e-01   -2.987075004245954e-01   +3.267325094420643e-01   -2.529893733922566e-01   -2.154753558926151e-01   +3.107250958708476e-01   +2.423947791191150e-02; -7.441426908643374e-02   -9.025684856024851e-02   -1.218685529733403e-01   -2.617665170445101e-02   +1.508431046048313e-02   -1.331665548769040e-02   -1.931191945357919e-01   -9.347698470063742e-02; -2.986218174433693e-02   -1.401534467757637e-01   +5.673397152644193e-01   +1.346301995316771e-01   -4.107927822674666e-01   +7.051372645868793e-02   -1.847748526169096e-01   +7.794005079964139e-02; +9.505223964496251e-02   +3.320355481169640e-02   +1.784158325868520e-01   -7.903208899046132e-02   -1.133453778701317e-01   -5.771869425528880e-02   +1.377213980008318e-01   +4.233326062694974e-01];
L3E_L2E_iAMPA_netcon = [-3.538525286718444e-01   -1.347386699051319e-01   +1.514678553169965e-01   -2.473682084671847e-01   -1.056890280800420e-01   -4.972682977519664e-02   +9.524726982255832e-02   +3.794483799523574e-01   +2.765058778598262e-02   +3.603265594535651e-01   +1.261150309995418e-01   +4.397608433680015e-02; -2.528298424669055e-01   -2.130198669793748e-01   +4.264527504283702e-01   -1.662038753588178e-01   -2.518944442274607e-01   -9.372211072452941e-02   -3.410401087742563e-01   +1.743188606081558e-01   -3.101541606429079e-02   -1.738003963168699e-01   +4.493970202240584e-02   +1.779687819244287e-01; -2.728475431356416e-01   -2.435275762490086e-01   +4.645511946565297e-01   +1.000429608927343e-01   -2.188025197425623e-01   -2.333004911485529e-01   +1.155587164366634e-01   +2.305154524943372e-01   +8.768378188526293e-02   +4.929413789507441e-02   -2.962041041572061e-02   +8.225076861022296e-02; +6.271009560869137e-02   -1.377131428889231e-01   -3.023602012397500e-02   +4.753774200020627e-02   -4.606405970743882e-02   +9.209679894112421e-02   +1.025692191635012e-01   +1.040586837367663e-01   -4.812774181881204e-01   -1.913815156349426e-01   -4.309389082984530e-01   +1.275907784663142e-01; +5.665236819444856e-02   +5.877731906653721e-03   -2.077105133207197e-01   +1.145046922913361e-01   -2.503653509868025e-01   +8.742522166958774e-02   +1.294043414643489e-02   +9.842700035523697e-02   -2.630453212713404e-01   -6.674685609704648e-02   +4.303791459140764e-02   -2.364502423482211e-01; -3.922577543702233e-01   +9.561755555807377e-02   +4.160976396979164e-02   -2.973598757933415e-01   +3.645404407414088e-01   +3.658446141900016e-01   +3.318162109587627e-01   -1.696060264230839e-02   +1.547387441500005e-01   -3.111671542204319e-01   +2.276300812416825e-01   -1.718150021620304e-01; -1.839741993788487e-01   -1.831973082395127e-01   +1.178379300604562e-01   +7.464405798043830e-02   +1.551913939768706e-02   -1.196736733752935e-01   -2.188944420600868e-01   +9.757144253590269e-02   +4.853750490554894e-01   -1.984574538501273e-02   -2.002328030071308e-01   -1.163075153328001e-01; -1.448326594053236e-02   +3.166324847437220e-01   +1.519474643424830e-01   -2.870839827385670e-01   -1.523178468331529e-01   -5.730784216334813e-02   -3.633057214503119e-01   -1.303820194147236e-01   +5.947674180750510e-02   +7.551941116706776e-03   -1.860296900164689e-01   +1.515645707297807e-01];
L3I_L2I_iGABA_netcon = [-2.021898540521515e-01   +3.559027260381551e-01   -6.954838092095934e-02   +7.435089160703645e-02   +1.584030493237135e-01   -1.348349566820182e-01   -1.091713565199585e-02   +2.109125440657560e-01   -3.813323525786252e-01   +8.967822270602768e-02   -1.570421880409467e-01   +3.599005511421763e-02; -1.972375700557202e-01   -8.828640471894654e-02   +3.902961832025587e-01   +2.341543554382234e-01   +1.181264703806784e-01   -1.188509959546886e-01   +2.486214815379142e-01   -2.777482679998949e-02   +1.759539612924731e-01   -7.232427371504375e-02   +2.455553940610951e-01   -1.579416170833443e-01; +2.640504975711172e-01   -1.390427639056654e-01   -2.125243297720208e-01   -2.433644857447748e-01   -2.483034678581416e-01   -1.454788636533583e-01   +2.801278699489880e-02   +2.160815460995637e-01   -3.323128969584296e-01   -3.141824493837871e-01   -4.744511235950644e-01   +1.600874239706006e-01; +3.960286084514359e-01   -1.629429979961834e-01   -6.294138488315104e-02   -3.081939084630261e-01   +2.036955645021419e-01   -1.517553425316498e-02   -1.738245823202109e-01   +1.851245742997342e-01   +2.496615802307049e-01   -2.146820977042224e-01   +2.484456514224579e-01   +2.371617371882158e-01; +3.250496401093569e-01   +2.035863490063547e-02   -1.902131558431294e-01   -6.265577884424067e-02   +1.060063354657822e-01   +1.285913176974857e-01   +1.657141361455188e-01   -4.736204120606501e-01   -2.937529271294254e-01   -1.068431258764099e-01   +4.147617990905342e-01   +1.563951808927912e-01; -9.248126446613561e-02   +3.524007708177371e-01   +1.850024827563614e-01   -1.899941023437613e-01   +2.833887777271138e-01   +2.102540946242012e-01   -5.099603422177358e-01   -1.520862719286313e-01   -3.374203733875646e-01   -9.062286367765704e-02   -1.628110160289653e-01   -1.632762022753821e-01; +3.021353396465891e-01   +2.497185664037662e-01   +3.346692624614246e-01   -3.218874046243368e-01   -1.872290954249370e-01   +2.274314517170742e-01   +2.803654061291284e-02   -1.354896509280254e-01   -1.242733089995068e-01   -2.568270209732634e-01   +2.921725869966949e-01   +3.811179996581905e-01; +5.128033065063331e-01   +1.552131212337053e-01   -7.525505908853737e-02   +2.850173434630925e-02   -1.415303208474172e-01   -1.779852654086281e-02   +3.934713082451020e-01   -5.861682605403788e-02   -1.642291542821513e-01   -3.575452645895777e-02   +1.633982554876597e-01   -1.744510834898613e-01];
L2E_L3E_iAMPA_netcon = [-1.441643694650325e-01   +8.488142923125058e-02   -1.573055341209517e-01   +5.698093112068270e-01   +1.707930420978269e-01   +3.783889316654301e-01   -2.974098098771785e-02   -1.632263863891631e-01; +9.233247068495014e-02   +1.649048589743921e-02   +2.786464522769629e-01   -3.688229050853163e-01   +1.655798169535637e-01   -3.523532955478769e-02   -3.066407283884393e-01   -3.923610800264443e-02; -1.228527857592479e-01   +6.247156456867838e-02   -2.670229391352698e-01   -1.917341686962665e-01   +2.611651704280886e-01   -3.257646585001092e-03   -1.342578031997329e-01   -1.615965568240848e-01; -1.070726378471858e-01   +5.068438969214878e-02   +6.240464181604272e-02   +1.403547732446901e-01   -1.755403138294289e-01   +1.806868290045542e-01   +3.954153966716219e-02   +2.473122367538900e-02; -1.421427733947403e-01   -1.014665488582174e-01   -2.198635757517351e-01   -3.369644029060913e-01   -2.173804656311879e-01   -4.722544034580381e-02   +1.255252733725472e-01   +1.504668965020566e-01; -1.573288219876851e-01   -3.325917738784392e-01   +2.052079798953522e-01   +1.617959823306833e-01   +3.039752679037893e-01   -1.707109916643698e-01   -2.020957202944296e-01   +3.695565347171920e-02; -1.174194839486816e-02   -2.218523504281113e-01   +5.805728238886346e-02   -1.752135488522452e-02   +2.616181405707800e-01   -2.944808716558676e-01   -1.982934548162320e-01   -1.405732493783159e-01; -8.916667134660830e-02   +5.374667628306636e-01   -3.103540725616641e-02   +1.621394501055731e-01   +4.743666885420858e-02   +1.114413479267417e-02   -3.178720088781296e-01   -3.499708816248724e-01; +1.560107617116177e-01   -5.689645813836794e-02   -2.229478165143800e-02   -1.334397480474557e-01   +8.752054010952354e-02   -1.258727987466992e-01   -3.916703341416709e-01   -2.514499627879507e-01; -2.214984899578952e-02   -2.912703657092305e-02   +5.035744159156502e-02   +2.010510940380773e-01   -2.361563263986886e-01   +1.960602962418167e-01   -2.321864137435610e-01   +5.096948555603430e-01; +2.275161587214732e-01   -1.877171430588637e-01   -1.719442608616037e-01   -1.872684097577033e-01   -1.156461371494328e-01   -7.712777945109744e-03   +4.332156146199683e-01   -1.407626855344339e-01; -7.039054643417313e-02   -3.556350994880636e-03   -2.731328440013480e-01   +2.957410144612239e-01   +2.228947555736501e-01   -3.472235575067830e-01   +2.021220357559579e-01   -3.256313949978650e-01];
L2I_L3I_iGABA_netcon = [+1.722679282759748e-01   -1.221129278499206e-01   -4.032625503465518e-01   -1.138479099120100e-01   -2.134411323989739e-01   -2.944994135651738e-01   +2.608448494018351e-02   -5.530331955389267e-02; +4.761284255539298e-01   -1.456162398342258e-01   -3.390450479599687e-01   -5.702920653432491e-01   +1.694827874107515e-01   -2.995430238685690e-02   +4.419610954743469e-01   +1.261996440058606e-01; -1.621998714082129e-01   +3.979382780446871e-01   +2.960279148162327e-01   +5.223997438314549e-01   -2.447658241840316e-01   -2.509864702007645e-01   -7.861515873775962e-02   -1.048797879587914e-01; -2.068371569261557e-01   -3.068217949795232e-02   -2.628008648199313e-02   +3.377776482188469e-02   -2.852415228908668e-01   +2.410832893029962e-01   +2.003373876683696e-01   -7.519135478701834e-02; +1.312512097777893e-01   +6.134659502522621e-02   -9.747399532805454e-02   +4.943004394422537e-02   -1.209992946680993e-01   -1.227945491615334e-01   -2.284270620476492e-01   +4.740130243117861e-01; +1.134220700233248e-01   -3.273338105583092e-01   -7.518120413374194e-02   +1.424534020682723e-01   -3.141987642036798e-01   +2.632706120206085e-01   +3.889042570085217e-01   -3.224727687120322e-01; -1.474198945917204e-01   -1.235516387897357e-01   +1.264065042494059e-02   +2.056134936949451e-01   -1.766257977923372e-01   +2.648405487339897e-01   +2.440764965391520e-01   -2.831949204218023e-01; -2.755042988700838e-01   +1.170078655974300e-01   -3.285701096805683e-01   +1.569722336983910e-01   -6.646515496098500e-02   -2.179443506502767e-01   -1.700189913702881e-01   -1.943624483047001e-01; -2.325343799012915e-01   +1.514187466775799e-01   +6.843017874841051e-02   -2.408422892437142e-01   -2.678281985550947e-01   +3.083184287166673e-01   +7.743750066277788e-02   -2.783949897447288e-01; -2.217707853554639e-03   +1.486341811828751e-01   -1.701529828648560e-01   -2.557779856277134e-02   -2.646393734927097e-02   +7.046394185921023e-02   -2.103177875712425e-01   -2.462468655858798e-01; +3.450822494401410e-01   +1.366177451146992e-01   +3.627042771630483e-02   +2.211455801678318e-01   -2.051891435753322e-01   +1.934649269251114e-01   +1.412992978789507e-01   +1.634896484614902e-01; +1.095762389800779e-02   -3.529300843450547e-02   +9.099813131767998e-02   +3.012671086179943e-02   -8.643089911469147e-02   +3.622370972006170e-01   -2.305903086573309e-01   +1.983386919852965e-01];
L3I_L3E_iAMPA_netcon = [+4.867616118072450e-01   -1.929897066656983e-01   -4.687394328982400e-02   +3.724563211219905e-02   +3.177899055128424e-01   +2.947574480407808e-02   +3.468949000351815e-01   +1.553817605111469e-01   +1.138500547131979e-02   +5.462034078391549e-02   +2.589660017070353e-02   -1.207132266350441e-01; +2.715804401903617e-01   -6.093702881319250e-02   -2.289159784851535e-02   -1.217867803932629e-01   -3.210140335132841e-01   -1.672112363939796e-01   +2.786095411969061e-01   +5.201455127874802e-01   -2.945997150214238e-01   -4.110884836124518e-02   -9.670041319027867e-02   +2.412221051197304e-01; -3.018817623144074e-02   -2.731062705715610e-01   +2.755127570872486e-01   +4.237159025925012e-02   +1.401455792117002e-02   +3.029072689764758e-02   +1.867361038129327e-01   -5.156070197901454e-02   -3.336398082010386e-01   +3.743142352179019e-02   -1.894587075348092e-02   +1.524173281507489e-01; +1.070486792401223e-01   +8.939937687418908e-02   -2.132224775456885e-01   -1.523687470547831e-02   +4.026425174773973e-01   -1.002941980296839e-01   +2.457692584653309e-01   +2.111968911884101e-01   +1.116049699523574e-01   +9.635902122275648e-04   +2.930206596378374e-01   +2.993919522955349e-01; -1.210342687055417e-01   -9.512994277804541e-02   -1.986145669108703e-01   +3.015275924650470e-01   +1.721748071559875e-01   +5.652633382749540e-02   +3.512461062650587e-01   +2.178201609759219e-01   +9.410754949997102e-02   +5.925432102245010e-02   -6.105028968553057e-01   +2.659784413405969e-01; +1.676203279983141e-02   -2.279571045254994e-01   +4.603817658080230e-01   +3.347004192817010e-01   -1.258742716716011e-01   +1.045480652554226e-01   -2.160444188695033e-01   -4.720005408738660e-02   -2.916419757389487e-01   +1.699896555611815e-01   -2.812216016621684e-01   -2.700450947097669e-01; +1.654436802137307e-01   +1.221935143847815e-01   -9.588505085288959e-02   +1.116576594756242e-01   +1.212044365825228e-01   -1.092663990901878e-01   -1.674891740935997e-01   +2.420911560253204e-01   -2.200584058435831e-01   +2.030820996708205e-01   -1.204474022869373e-01   -8.811147919339199e-02; +3.232067401442799e-01   -3.611529888421805e-01   -4.244318524187184e-02   -4.626084579957658e-02   +9.050026718934873e-02   +3.865610378333618e-01   -3.461943929113429e-01   +1.638634675519728e-01   +1.974234245965605e-01   +1.816152177874754e-01   +1.926544236720044e-01   +8.239930766739137e-02; +2.656185572800518e-01   +2.474804339789036e-01   -8.764122093810252e-02   +1.130135872578161e-02   +1.139829437277381e-01   -5.608125067946493e-02   +1.553259843474586e-01   +8.515627513659578e-02   -3.092281446778179e-01   -6.772029256711248e-04   +3.549430377935121e-01   -2.355177753477161e-02; +6.517793751590967e-02   -2.105183492991669e-01   -8.421234313027563e-02   -2.048370904597508e-01   +2.823675985332598e-01   +1.733155529406245e-01   +3.400695597220675e-01   -3.323726326108639e-01   +9.182716111104122e-02   +7.363021957991729e-02   -5.307350119853493e-02   +3.344816496978046e-01; +1.544009826007992e-01   -1.240386804218749e-02   -1.256042145584643e-01   -2.791146670563468e-01   -2.213525954546746e-01   -3.167745572127634e-01   -2.808817369551853e-01   -2.346556863308042e-01   +1.062283738565733e-01   +3.931878991454799e-02   +1.725392277754729e-01   +4.314199040662345e-01; -1.149832810685970e-02   -3.017696832963753e-01   +2.740641229383237e-02   -1.236124192459296e-01   -2.532738487982386e-01   +7.988431293559103e-02   +2.302040646009439e-01   -2.705273584029225e-01   -1.591973909682453e-01   +6.942787057400110e-02   -3.152636954178781e-01   +2.266810996980241e-01];
L3E_L3I_iGABA_netcon = [+1.829731988392238e-01   -2.330881444738468e-02   -1.447650651786282e-01   -2.463709591494416e-01   +4.422054911056028e-01   -6.004454283414973e-02   +1.953030632139934e-01   +1.718937246117891e-01   +3.636717912638002e-01   +4.521678791810555e-01   +2.605643410811413e-01   +3.883247253915777e-01; +1.430644374341151e-01   -3.785928251645926e-01   +1.312577557892373e-01   +2.090247628261527e-01   +1.666445836028965e-01   -5.742409255131464e-01   +3.949533416541835e-01   +1.444997783127052e-01   -2.432836096318655e-01   +5.679050915556172e-02   +3.259518487362590e-01   -2.079337633188050e-01; +1.643164771631958e-01   -1.408727805446401e-01   -3.596081211513341e-01   -2.204502790633984e-01   -9.048708303393806e-02   -2.361290586920247e-01   -4.009608582838392e-01   -5.735632266573995e-02   -1.207559495784341e-02   +4.492553733220127e-01   -2.529510267970354e-02   -2.919066955092227e-01; -8.283095409700210e-02   -2.564701730402220e-01   +3.656143776773427e-02   -3.149946788602689e-01   +1.328845289622583e-01   +6.288334335777657e-02   -1.483780462841228e-02   +1.462377470918106e-01   -4.964464662176303e-02   -2.204339418891389e-02   +4.483041149319487e-01   -1.947976064610918e-02; +3.184939858450279e-01   -2.748171839781318e-01   -3.722815174710490e-01   -3.368997985978845e-01   +1.796695573254420e-02   -4.199239409784011e-01   +2.798904004774634e-01   -1.787249577475007e-01   -2.263316281839374e-01   -5.747693343804900e-02   -8.755266134452758e-02   +1.247173912697290e-01; +2.076419507116762e-01   -7.557032900928407e-02   -3.526541229381511e-01   -2.698403806094387e-01   +7.769059807533642e-02   +1.172062980969335e-01   -2.602300018372447e-01   -1.611102475557905e-01   -4.819447990391225e-02   +1.433376877825498e-01   -1.968659831570043e-01   -2.610467215900335e-01; +8.052504304175860e-03   +2.036244280852885e-02   -5.956558582030947e-02   +3.146649606953686e-01   +1.516228838628729e-01   +1.378181463089521e-01   -1.492730726903461e-01   -3.240718247460994e-02   -2.124282321813900e-01   +6.528712442782204e-01   +2.241157157869328e-01   +1.329313746695949e-01; +3.074736626666286e-01   +9.992295771279303e-03   -2.394418649734292e-01   +3.080978067203806e-02   +2.722908377642018e-01   +2.674873532862123e-01   -2.097611720479600e-01   -3.232993057113032e-02   +3.164576408207162e-02   -2.453124655728773e-01   -1.111256109504839e-01   +7.738602706196976e-02; -1.481537948317099e-01   -1.523281838209166e-01   +2.677367788220701e-02   -4.549983845147609e-01   +1.335651705352734e-01   +2.379756229414787e-02   +8.056886405749511e-02   +4.732447353449054e-02   -6.724446502849482e-02   -5.225073359851922e-01   -1.220656884658650e-02   +2.653051317271521e-01; +1.449774388823109e-01   -1.556532051033259e-01   +3.757403420849411e-01   +1.432068718937017e-01   +1.989221525988797e-01   +1.244789821722623e-01   -3.782746408140039e-01   -4.390928765696930e-02   +8.219448509723706e-02   +1.484960983301860e-01   +5.382200830859193e-01   +2.262506588107990e-01; +1.908333077203263e-01   -2.377111591583176e-01   -8.541478795951801e-02   -5.999551347099594e-02   +1.963454587666927e-01   +4.824553588040350e-01   -1.240613187995211e-01   -2.926297828911428e-01   +1.552797604642325e-02   +9.464993072762891e-02   +9.557081245077798e-02   +1.879660360975321e-01; -1.256083134623137e-01   +8.510285956970171e-02   -3.694283051966162e-01   -3.904422368975060e-01   +3.568224246125566e-02   +4.110339994042149e-01   -2.185842759850533e-01   -4.198635886764909e-02   +6.683341857116082e-02   +4.599593514370030e-02   +1.431530601355648e-02   +1.494444043887667e-01];
L2E_Input1_iAMPA_netcon = [-1.194719157177088e-01   -4.377504631625950e-01   +4.078805522449510e-02   -1.310158411527805e-01   +3.942145127777717e-02   -1.904419263000509e-01   -8.003444041899083e-02   +2.867868244871717e-01];
L2I_Input2_iAMPA_netcon = [-3.949321576327908e-03   -2.215942150298879e-01   -1.872397690180651e-01   -2.432156439284194e-01   +3.790765821145958e-01   +8.881332504386594e-02   -4.906262973544540e-01   +2.458173780701816e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
