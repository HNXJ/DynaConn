function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.568050733157926e-01   +3.257447221706342e-01   +1.262415362604440e-01   +1.144411347874516e-01   +5.084216402258541e-01   +8.472877101365196e-02   +3.928166428317647e-01   +2.353589310803651e-01   +1.482503353718968e-01   +6.461171543210795e-01   +6.130951180092269e-02   +1.002619319759458e-01   +1.247295382930299e-01   -2.430767684042009e-02   -5.294002481407009e-02   +4.938455436575238e-01; +1.888196934971713e-01   +3.318388585927153e-01   +2.375838169121456e-01   +8.727803542892400e-02   +2.508886859638972e-02   +5.781381413413690e-01   -2.204897411749739e-01   +1.808212764174319e-01   +4.093443090536721e-01   +6.612926606226491e-02   +1.045476405670470e-01   +5.369780382473811e-01   +6.187418300137030e-01   +9.292660625166786e-02   +1.072510260839598e-01   -2.318921544510759e-01; +3.844128515769227e-02   +2.124436006159204e-01   +5.697566351776713e-01   -5.748367196931319e-02   +2.932020172835584e-02   -2.075525618644332e-01   +2.593378759489812e-01   +4.627743839334175e-01   -2.205923182165860e-01   +1.587868897258722e-01   -3.625778594343914e-01   +3.397155092986640e-01   +1.870250212139236e-01   +5.512236252140112e-01   +1.565363198007629e-01   +4.659117756861539e-02; +1.852465110398968e-01   +5.357116960721688e-01   +3.747069614362056e-01   -1.299641863061269e-01   +1.226236154549141e-01   +1.251478818582594e-02   -1.260920810650128e-01   -3.473568868348749e-01   +1.135542751195680e-01   +1.679128331454086e-01   +1.563367934059605e-01   +4.745977553162447e-01   -4.395986033114303e-02   +1.066991981487590e-01   +5.444915164390928e-01   +5.977277160002520e-02; +1.801530996750259e-01   +3.208749237885562e-01   +2.509860699416340e-01   +3.710116396367619e-02   -3.949696974674273e-01   +1.912978447505376e-01   +2.666445363901457e-02   +2.418587898416220e-01   -5.151030852917696e-02   +1.862751049286960e-01   +1.687914874516115e-01   -2.541704882060991e-01   +2.318963048660461e-01   +5.528048901991313e-01   +1.607922259264652e-01   +6.154430116792027e-01; +3.248046513346661e-01   +2.997331326676733e-02   +4.077570947988505e-01   -2.667731459454882e-01   +2.427605823486146e-02   -4.685855787018891e-01   -1.790451666696975e-01   +1.859897274796173e-01   +4.397939183818190e-01   +3.993748302520685e-01   +2.239420021214816e-01   -3.076389672215571e-02   +4.374023375405506e-02   +2.179209036359112e-01   -1.490173967814474e-01   -1.412322373342645e-01; +2.206587723737669e-01   +3.687747118110550e-01   +7.844181084275648e-03   -1.572059470527692e-01   +3.122611132127145e-02   -1.217982108892755e-01   +6.344027805945993e-02   +3.634042216077772e-01   +3.319548697164085e-01   +1.223905897015658e-01   -4.869584577250824e-02   +1.866748790960509e-02   +2.969297735175018e-01   +1.595794814182503e-01   +4.514120674710712e-01   +5.146478033976072e-01; +5.417979191286548e-02   +2.307531072581457e-01   +5.027944811908427e-01   +9.615964689529682e-02   +8.750421946496136e-02   +6.286027490153907e-02   -1.413482214199929e-01   +1.026414048800607e-01   +3.139233677404978e-01   +4.785203032736204e-01   +4.649346861841179e-01   +3.691449115150963e-02   +3.995012619626152e-01   +5.225919757807262e-01   +7.127439844696331e-01   +7.693011699353917e-02; +6.680853004305131e-01   +8.402832134481136e-02   +4.098483715515684e-02   -1.276462148947379e-01   +1.162660031900667e-02   -2.743289998030612e-01   +4.167055998796614e-01   +1.826792642459548e-01   -2.460012007039014e-01   +5.977619040351495e-01   +2.721061602071791e-01   +4.201676105403541e-01   +2.539782854284568e-01   +2.549686319623368e-01   +1.635913117157297e-01   +2.229427999623461e-02; -3.940084654529237e-01   -2.658749114341457e-01   +2.434387103218796e-01   +6.205005636378035e-01   +6.456627805225265e-01   -1.088276637927402e-02   +2.019592011225807e-01   +1.693117423637890e-01   +1.760829821072798e-01   -1.291411059511621e-01   -1.741355242703445e-01   +6.744478452646497e-01   +5.421047916899790e-02   +2.901559701258462e-01   -1.534905987591326e-02   +2.301392256011767e-01; +5.182045828449851e-01   +5.533367881618410e-01   +3.201077003020103e-01   +1.792581119251468e-01   +5.910887028051034e-01   -2.839923226247738e-01   +2.721867514770784e-01   +4.149732362479241e-01   +1.413110004167244e-01   -4.860759201050530e-01   -9.245244371760587e-02   -2.573910020887119e-01   +1.330457647411843e-01   +3.962705786562274e-01   +1.180855335198387e-01   +2.634088529292671e-01; +3.193446388956323e-01   +4.526099911724564e-02   +3.079857057300239e-01   +3.858438396723446e-02   -9.396807865058895e-02   +2.983437035580177e-02   +5.142090483053636e-02   -1.788437988486452e-01   +3.943695073663824e-02   +1.742113313434018e-01   +3.329469913786734e-02   +3.178190998940200e-01   +3.109201600883443e-01   -4.970408602030918e-01   +1.198289017871956e-01   +2.956970589858686e-01; -1.083841957918410e-01   -8.049801356255548e-03   +8.416515455407361e-02   +3.152497788886073e-01   +6.981085210277546e-02   +1.034603345169922e-01   +1.905192130476972e-01   +4.305641510886417e-01   +6.282642350248815e-02   +5.771871514949910e-01   +3.291203718257583e-01   +2.091907223261441e-01   +1.826786783274173e-01   +1.573636174467656e-01   +5.503436787753923e-01   +4.885162279882663e-01; +8.935129867021924e-02   +1.230305158748131e-01   -1.663828452556862e-01   +9.736728440297526e-02   +6.793554860450038e-02   +4.777339597589113e-01   +6.956990199916961e-03   +4.503754984028508e-01   -6.931984888682829e-02   +2.869744733805404e-02   +1.613489915646636e-01   -3.987586079206820e-02   +4.902099358361672e-01   -8.672783389129829e-03   -4.319332417338315e-01   +4.063983452653942e-01; +3.131117293756140e-01   +3.236740532640762e-01   +4.609850419666974e-01   -1.308606900190335e-01   +7.245693398609075e-02   -4.141446244817082e-01   +4.766147107174690e-01   -2.865443060732830e-01   +1.981875195370577e-01   -5.124537379870814e-02   -4.837780385889145e-01   -9.711947512338021e-02   +7.031906478448704e-01   +2.578129801236225e-01   -3.705334716375662e-02   +3.344519221719318e-01; +8.874463541746338e-01   +2.196930870669708e-01   +1.768529724428091e-01   -2.683760990946342e-01   +3.701084769809813e-01   +1.651753828133999e-01   +1.907074122364805e-01   -1.128276102904099e-01   +2.519679581926568e-01   +9.970894642571695e-02   -1.045632368452428e-01   +3.064915421193565e-01   +4.589755494606218e-01   -3.788754952472304e-02   +4.097368090280692e-01   -9.298171198329069e-03];
L1E_L1I_iGABA_netcon = [+1.559029150648474e-01   -9.128939641985596e-02   +2.198470967459883e-01   +2.931193115371057e-01   +4.849284154409985e-01   +1.862343893589661e-01   +2.595104371598487e-01   +4.924390295075829e-01   -1.196205289665806e-01   -7.091244912930073e-02   +1.061624960005552e-01   -9.386159132135308e-02   +2.000459054426206e-01   -1.082033544659401e-01   +3.774860392777762e-02   +1.967868745908967e-01; +1.308661756233092e-01   +3.244798999657219e-01   +2.003872535065969e-01   +2.222008054621418e-01   -3.204073749358292e-01   +1.151669132688617e-01   +5.735887357009603e-02   +5.896348840363953e-01   +4.538224203140527e-01   -7.746445447612457e-02   +1.403399990032156e-01   +1.557871990879321e-01   +3.546183497982960e-01   +2.838261160717909e-01   -3.544147811823992e-02   -1.181412476707822e-01; -2.844938109728228e-01   -1.176665994564577e-02   -3.187542792829530e-02   +5.566326483307114e-01   +2.072096502995115e-01   -3.196656128894819e-01   +9.325901146986573e-02   +2.056709119062651e-01   +3.990830690713723e-01   -1.921532538165233e-01   -7.338030424060926e-02   +2.463744245537501e-01   +4.835125889838144e-01   +4.369761862247703e-01   +1.255804836043117e-02   -2.024761789218031e-01; -1.556458679965178e-03   -3.152336916731478e-01   +1.812473112821707e-01   +3.189321989360385e-01   +3.910173356255880e-01   +7.791595874104534e-02   +1.825248781854034e-01   +6.556192375518524e-01   +4.254336282371652e-01   -9.273813275251178e-02   +1.555328617650701e-01   -3.258602034916241e-01   +3.430662966252823e-01   -1.989328442957062e-01   -1.481438130596460e-01   +8.121275471193731e-02; -2.445914404855235e-01   +7.991527674843539e-02   -1.753428263084589e-01   +3.409754663766337e-02   +2.059218130876462e-01   +1.916101170715843e-01   -5.183762386826202e-02   +3.672750258515439e-01   -3.073529148538732e-01   +1.431201128652763e-01   +3.735122196543429e-01   +4.781634702926448e-01   +1.995602211943601e-01   +2.558241425764345e-01   +1.690270513411772e-01   +4.799054796903252e-01; +3.841457891128091e-01   -2.398595674740907e-02   +5.221816822227571e-01   +5.347918422455185e-02   -2.906541003272890e-02   +2.742610630988133e-01   +4.751208203611368e-01   +1.707762961347816e-01   +1.741469616696157e-01   +1.493998879160843e-01   +2.540050003833929e-01   -1.424671363912888e-01   -1.972697271554836e-01   -4.252823035439135e-01   +3.727306253943303e-01   +3.878593544010261e-02; +2.397455967825349e-01   +2.714609374976445e-01   -6.975477364319560e-02   +1.289388171937820e-01   +1.888252286933697e-01   -2.043388249915872e-01   -5.781404339364282e-02   +6.137736399867441e-02   +5.945416060738073e-02   -9.903610664983578e-02   +2.276513786630727e-01   +2.354495187675298e-01   +2.039164634658833e-01   +1.974436863464004e-01   -4.353907770491273e-02   -3.220450303610932e-01; +6.727118075207764e-01   -1.548170104540632e-01   +5.105737115920009e-01   +1.683718133345676e-01   +1.127043440571831e-01   +2.279676145442080e-01   +4.259154829773333e-01   -1.746407538716509e-01   +1.389936620267061e-01   +1.023393324888133e-01   +4.916590135656202e-01   +2.338139292513242e-01   +5.677654219722708e-01   -1.321768740613737e-01   -7.541987470192735e-02   -4.831197928943233e-01; +1.569874940543403e-01   +2.586526545611271e-01   +4.924796549080956e-03   +1.242886840335357e-01   +2.071970274928454e-01   +1.074595202807242e-01   +3.273907688892142e-01   +4.036232231636045e-01   +5.919825059215865e-01   +5.427306117558091e-01   +4.798465754379222e-01   +9.880188292806195e-02   +6.977984034124036e-01   +3.430186939216027e-01   +2.255404620448300e-02   -1.921385714718545e-01; +4.023244628987653e-01   +1.427691139892511e-01   +4.003977007490555e-01   +1.801067300533335e-01   +2.462746224889673e-02   -2.662406464046084e-01   -6.248532369739401e-02   +5.590406002349141e-01   +2.200891244724751e-01   +1.328597071779339e-02   +4.381106906774483e-01   +4.926004008764354e-01   +3.340316426759600e-01   +1.636486407840914e-02   -1.089599221634485e-01   -8.667751571672744e-02; -2.226005511931259e-02   +2.463815724193122e-01   +3.461626337165938e-01   +7.909305435717173e-02   +4.985284497296480e-01   +1.987887385785097e-01   +4.030965927368253e-01   +6.807418382376637e-01   +2.602529316120261e-01   +2.792719376281250e-01   -8.539931388971836e-02   -2.436220427066246e-02   +7.304827816747017e-02   +3.757356755134081e-01   +8.235659276102300e-04   +5.604240679136449e-01; -1.359104271728152e-01   +1.642344014101565e-01   -1.265897890656243e-01   +1.567759366416027e-02   -6.824310195216218e-02   +3.218151941660882e-01   -1.264044304938717e-01   +3.686562766322941e-01   +1.837151257351875e-01   +6.578588433111425e-01   +5.321102668229243e-01   +2.769894997338806e-01   -2.013336648117232e-01   +4.955850789899712e-01   -4.717510623333320e-03   +3.693261447564592e-01; +2.053598549289637e-01   +2.816334444234445e-01   +8.763193097092664e-02   +5.893006185886096e-01   +4.442192183485037e-01   +3.079543351838520e-01   +5.115193453662845e-01   +3.768816939041245e-01   -1.569181652721617e-01   +2.107877540865517e-01   +2.409481934340773e-01   +3.917913900635389e-01   +3.535426378113860e-02   +2.258116771494939e-02   +1.757575727248625e-01   -1.644180089037312e-01; +3.319685315116394e-01   +4.879204423989346e-01   +3.543314804662471e-01   +2.650438808139749e-01   +2.106951372727474e-01   +2.305363481179407e-03   +4.004105380660058e-01   +3.278147571751615e-01   -8.139408408688015e-03   +5.315812455266911e-01   +6.497727404604725e-01   +8.323307185583954e-02   +1.194610338287479e-01   +2.710558586698526e-02   -2.752802018610075e-01   +3.473190535026613e-01; +3.481018748028555e-01   +1.014677952835101e-03   -2.703198460079759e-01   -1.112042419890898e-01   +2.571344584154501e-01   +4.580676069759982e-01   +1.875435883534802e-01   +8.078142175121347e-02   +2.942344355357980e-01   -1.216980474405989e-01   -3.373702045776306e-01   +5.745981564993158e-01   +2.692916736530762e-01   +1.334861271265237e-01   +4.293701809169609e-01   -4.589137965655779e-02; +3.941756123949841e-01   -8.325014311545635e-03   +1.404342777290290e-01   -8.478193387464691e-02   +2.453534783186302e-01   +4.618866622022572e-01   +4.190259501825278e-02   -4.511554123417963e-01   +1.944734432235776e-01   +7.880876043940564e-02   +1.913362833759756e-01   +4.551575342710067e-01   +4.181522522118884e-01   +3.004332844068304e-01   +3.579994658420356e-01   -1.371411768526973e-01];
L2I_L1I_iGABA_netcon = [+1.446025320747387e-01   +1.073030078144553e-01   +2.811194268798912e-01   +2.210489599813946e-01   -2.809975046803568e-01   +1.216979169898361e-01   -2.315112434322779e-01   +6.925504883460384e-02; -1.500841187734886e-03   +2.974808520709797e-01   +1.407971747040312e-02   +2.240648823369085e-01   -1.624198706715336e-01   +4.384725722123686e-01   -4.951861065229290e-01   +7.650521733974397e-02; -5.263166443325435e-01   +4.964554407777381e-01   -4.670551552680572e-01   +2.462636556121866e-01   +1.997266260114907e-01   -8.846317080978772e-03   +3.302820908777391e-01   +6.034277837124230e-02; +4.163127906320680e-01   -3.034861292052319e-01   -4.604102992908071e-02   +2.805279430583507e-03   +2.419214924127286e-01   +2.597525319230615e-02   +5.579845754626245e-01   +1.020454863985173e-01; -6.296558994745206e-02   +4.528779376431449e-02   -2.866969739256370e-01   +1.262578280122154e-02   +3.870350532211281e-01   +8.562931958942306e-02   +5.620931137000128e-01   +6.277921142574049e-02; -3.502927672160598e-01   -7.399771822606635e-02   +1.781670699059817e-01   +3.901908211467444e-01   +6.555704736962331e-02   -2.016917127332744e-01   -4.144478660103544e-01   +6.438869408590178e-01; -1.376657645688705e-01   +5.760663219003552e-02   +4.357364301432769e-01   +2.653346994750633e-01   +1.223415194657178e-01   +1.017341130890570e-01   +2.957354585584690e-01   +3.049780307898249e-01; -1.305446056684473e-01   -4.100442022008637e-01   +2.998780977065765e-02   +6.300255837417389e-01   +1.890538179079044e-01   +7.206354471589421e-02   +2.031467604817211e-01   -1.025717423790030e-01; +3.606318246065829e-01   +5.201440421315597e-01   +3.167406638463421e-01   -3.386166333615698e-01   +4.445054622568037e-02   +2.579454214088084e-01   -5.035916689671927e-01   +5.428781917962217e-01; +5.694024039409245e-01   +2.387503226409291e-01   +8.624252944950642e-02   -1.431680150823320e-01   +2.051090406410027e-01   +3.222411032396428e-01   -7.895081239557664e-03   +1.945868077117052e-02; +2.165851324077638e-01   -1.687646022647029e-01   +3.498293152685062e-01   +3.031338946993125e-01   +1.987302245635808e-01   +2.830299354879408e-01   -6.188588863863672e-02   +4.959614997894466e-01; +3.927704328698920e-01   +5.715297485216243e-01   +1.653818079605723e-01   +5.711223740544044e-03   +1.916928780261601e-01   +1.055464342961087e-01   +1.471524304124381e-01   +7.190099222790691e-01; +1.034828841075500e-01   +7.043982412975182e-01   +8.336325880722403e-02   +3.095945671888091e-01   +1.225094623837859e-01   -1.704075991777746e-01   +1.286140186452446e-01   -1.550861683815737e-01; -3.462915120087293e-01   -1.508796379597542e-01   +4.480644636288239e-01   -1.756070019316974e-01   +1.697142460073125e-01   +2.535536399521908e-01   +7.914706166982514e-02   +2.234629759377982e-01; +3.545705620849920e-01   +4.684035814823612e-01   +9.258478263720804e-02   -3.372530141012561e-03   -1.881683104960782e-01   +7.757838097303235e-02   -4.382576361450036e-03   +3.270056266253450e-01; +3.846531753642521e-01   -9.196136580685360e-02   -8.342163868890562e-02   -2.273485001852955e-01   -2.639894564698885e-01   +3.894827990301757e-01   +8.188384052632586e-02   -4.241344499257457e-01];
L1I_L2I_iGABA_netcon = [+4.091751114562638e-01   -1.266778437607334e-01   -7.097406590587071e-02   +2.154394194855741e-02   +8.247936762169656e-01   +2.443541311067735e-01   +8.593650335437711e-02   +2.459218317144651e-01   +9.154719009635211e-03   -6.346440249350108e-02   +5.555636947671730e-02   +3.177163256310668e-01   +5.603185702781841e-01   -2.293668648583995e-01   +2.262761343442620e-01   +1.771952591024331e-01; +4.038180823652386e-01   +4.856503252625204e-01   -7.879902261749655e-02   +1.548809220225156e-01   +2.121156536104325e-01   +7.757547842329454e-02   +3.065240767266133e-01   -8.560975391562066e-02   +4.003892658981135e-01   +5.200140809238943e-01   -1.393614706237349e-02   +3.286413930049842e-01   +3.018952281447775e-01   +2.150774855694546e-01   +3.495271845313630e-01   -3.710415192288106e-01; -2.942073794367632e-01   +2.676080630727419e-01   +3.121491354662391e-01   +4.024821781490436e-01   +4.394016071775501e-01   +1.902875184764609e-01   +1.452178427009350e-01   +7.126793624089047e-01   +7.014298576290881e-02   +4.683725509285088e-01   +1.274819692228732e-01   +3.085650308558102e-01   -2.369246333030489e-01   +1.828369872658444e-01   -2.097664365053519e-01   +3.611055225226051e-01; +4.630374654520996e-01   -1.112466014801547e-02   -9.602952043765883e-02   +5.553609196970628e-02   +9.560647955709119e-02   +3.290812902630521e-01   +1.088728679805453e-01   +5.984414572226837e-01   -1.204968042047457e-01   +2.543024041927507e-01   +9.801081608678774e-02   -5.512259477553572e-03   +6.575395248212285e-02   +3.743417338402729e-01   -2.529313012378727e-02   +2.288312487872992e-01; +4.749211273252378e-01   -1.094232442830917e-02   +3.743466402357178e-01   +6.363569403463570e-01   +1.533912033742925e-01   -2.932575857784812e-01   +4.972167937875145e-01   -4.186560275402745e-01   +3.376027058008726e-01   -3.573994972880378e-01   +5.829219260902490e-01   +4.124306194271991e-01   +3.470222133580846e-01   +6.442786748376925e-01   -1.474598842585131e-01   +3.257115034113046e-01; +2.146913816587215e-01   +1.191589755954136e-01   -7.768429353344014e-03   -3.306357102334652e-01   +2.655665051241900e-01   -5.032547795106049e-02   -2.314261513271945e-01   +7.021960679400927e-01   -2.358252754808550e-02   +2.024092824815764e-01   +5.932442140261699e-02   -1.316798040388292e-01   +3.620493920178469e-01   +4.432312808944017e-01   +2.376359476931341e-01   +1.342499909404766e-01; -2.801028625545918e-02   -7.484689339439728e-02   -3.774705115706073e-02   +5.312601533767137e-01   +2.949718919076755e-01   +4.984212924577434e-01   +1.855452970620547e-01   -1.502552773059345e-01   +5.631946999942332e-02   -3.054352953787006e-01   +1.643089820650568e-01   +3.481014252213669e-01   +2.208234539268735e-01   +4.164886373044349e-02   +3.978417908356151e-01   +3.043788103926817e-01; +1.591678416086557e-01   +2.506870253700451e-01   +2.603624588208020e-01   +5.359010870668485e-02   -9.825215326812620e-02   -2.879800115468101e-01   -1.325831011155587e-01   -1.389509651871036e-01   +2.036463016964805e-01   +3.665765746751172e-01   +2.118858792597908e-01   -1.779689328656942e-01   -5.820659202106699e-02   +2.788789135070462e-01   -2.031016364030830e-03   +3.497691707477373e-01];
L2E_L1E_iAMPA_netcon = [+3.861762608400459e-01   +1.687136020290040e-01   -3.684430262904004e-01   +7.145180919063610e-02   +1.660085257141457e-01   +5.740222232926897e-01   -3.754223018011867e-01   -1.961994861149180e-01; -2.242338923848169e-01   -2.318266846820757e-02   +8.372322871390037e-02   +1.370108164294858e-01   +1.696982895327877e-01   +2.015197699453868e-01   +5.849919690218894e-02   +3.858271850797194e-01; -4.436165696165613e-01   +4.829356730230250e-01   +3.051844560373781e-01   +3.756003869147711e-01   -8.714976504749034e-03   +4.712224353867863e-01   +3.548547175346752e-01   +3.392097118045746e-01; +4.821933989070981e-01   +8.904510173193991e-03   -5.081542111778486e-02   +4.420789301226370e-01   -8.101735761944145e-03   +7.368314793134850e-03   -1.602889484795403e-01   +9.240341101932256e-02; +6.004011460355914e-01   +3.637430348214353e-01   +1.700589232620640e-01   -2.753034550131976e-01   +8.232522511605161e-02   +4.708112025049361e-01   -3.389842405320898e-02   +4.975090830771239e-02; +1.825871198086955e-01   +9.515716164563481e-03   +4.717087067131156e-01   +3.578173702987109e-02   +1.456573335186194e-02   -8.752565471502995e-02   +1.996990772279880e-01   -2.628255322338878e-01; -1.621512403894456e-01   +2.695021408901673e-01   +1.507417137080677e-01   +4.914644398641935e-01   -4.728953698440016e-01   -1.741962302662836e-01   +5.452199433036852e-01   +8.359951403500226e-01; -1.380058834055231e-03   +3.593867800301207e-01   +9.253947385299735e-02   +3.976147208144346e-01   -1.698514334050480e-02   +4.744626201542733e-01   +3.050880623472285e-01   +3.633578688345347e-01; -2.635298792469124e-01   +2.640589030108557e-02   +3.309379085653222e-03   -9.294195153252272e-02   -3.657025245489727e-01   +4.380768199896359e-01   +9.350756893090301e-02   +3.436542493301024e-01; +3.099122336026729e-01   +3.570993345766181e-01   -5.900093196676548e-02   +3.649547638682499e-01   +1.727528376611401e-01   +8.309335961871546e-02   +2.686107977956835e-01   +5.230615931668228e-01; +1.017424551255637e-01   +1.932103419144028e-01   -5.900860286017544e-02   +9.157705551075270e-01   +3.776584476714409e-01   +1.377759262103514e-01   -2.143485523584956e-02   +1.586088985155067e-01; -2.715450804076529e-01   +1.147005707500801e-01   -8.564688709464680e-02   +4.707082404530061e-01   +4.003080842980336e-01   +4.388473408740359e-01   +2.327779525933134e-01   +5.247881403312679e-01; +2.429967231781674e-02   +6.171588937996876e-01   +1.418496471072452e-01   +1.021250440606406e-01   +5.503343504925493e-01   +2.483669933900313e-01   -1.873937498769719e-01   +4.791439173307331e-01; +7.686509891116075e-02   -2.556294137754054e-01   +3.271307726809362e-01   +3.583951503998394e-02   +2.432017362259699e-01   -6.369864162295186e-02   +3.861974750169596e-01   +5.986629011580583e-01; +6.830912198869175e-01   +2.513788449502140e-01   -1.507784214191697e-02   +1.674624772082778e-01   +8.455488202772313e-02   +2.613900184499875e-01   +3.323364103503108e-01   +2.259570729222612e-01; +1.146605617983651e-01   -1.366008034038106e-01   +4.672704313941394e-01   +1.829310333480145e-01   +2.023427903627990e-01   -4.482159244159871e-02   +1.490840789062573e-01   -2.587991392131476e-02];
L1E_L2E_iAMPA_netcon = [-1.310057878124758e-02   +1.567963609142083e-02   +1.501598133335230e-01   +1.325813065490133e-02   -4.861384131696057e-02   +1.000000000000000e+00   +6.070201716056360e-01   +1.860625606892067e-01   +1.686226146945478e-01   +2.306756422853145e-01   +2.523503596321192e-01   -4.667556865926415e-02   -6.282218731740052e-02   +3.483541203588619e-01   -2.056781094738005e-01   +4.038760242110035e-01; -3.250956450425292e-01   +6.304446552870163e-01   +6.599425166944846e-02   +4.906077812507613e-01   +5.970430148051987e-01   -2.724904191966659e-01   -1.803520210978291e-01   -8.275855617487110e-02   +2.557536674903778e-01   +9.482085710155315e-02   -1.014259748341140e-01   +5.779282916908842e-02   -6.327961634961389e-02   -2.303339967994233e-01   +3.046849422864046e-01   +2.225837706650865e-01; -1.544124201727380e-01   +6.004631301874677e-02   -3.570458897825913e-01   -4.833369042100590e-02   +2.302848075587141e-01   +1.168000342653776e-02   +3.808062367897424e-01   +5.633459144397193e-01   +3.889090758507439e-01   +2.317010138977944e-01   +2.450148595157501e-01   +5.734654256257175e-02   +2.511822289221557e-01   -1.710688177494574e-01   -1.463719633538424e-01   +3.702400253879327e-01; +9.141633288169541e-02   +2.787101334611504e-01   +2.986957240463353e-01   -6.054680550731879e-02   +4.003130952539556e-01   -3.059045215610708e-01   -1.647808520000815e-01   -2.057764361417923e-02   -8.777905715484095e-02   +4.080757889544916e-01   +3.719523652403351e-01   -3.137516194901264e-01   +2.803478806005253e-01   +7.838571865676127e-01   +2.619832537731732e-01   +4.489096024144744e-01; +4.558514013201641e-01   +2.074529123768436e-01   -4.903795293091774e-02   +4.555015394842650e-01   +2.221750830204141e-01   +6.123838086192013e-03   +4.089393828578174e-01   +2.137024303150460e-01   -1.101635089896388e-01   +3.196281955312755e-01   +2.927468489870313e-01   +3.482782246843635e-01   +3.612355185899265e-03   -1.429095654416068e-01   -1.579165188961543e-01   +6.157070279055161e-01; -4.363330176979610e-02   +1.265675801779117e-01   -2.350684368196681e-01   +4.604854777103405e-01   -4.367031921298166e-02   -1.758442098390326e-01   +5.204625251401011e-01   +7.763836089781163e-02   +2.127339718845476e-01   -3.226038671328314e-01   -1.140209994542403e-01   +3.184306633251385e-02   +2.908223477476888e-02   +8.438631119768089e-02   +2.447734167969795e-01   +4.163967514737498e-01; +1.166521409361047e-01   +4.894922710294822e-01   +4.419310978546014e-01   +1.641211688621044e-01   -4.823546480598320e-01   +1.887228232872817e-01   +5.511866190876862e-02   +1.004667247308329e-01   +2.788703990050190e-01   -9.086782246538644e-02   -1.420072518954150e-01   +8.076064456410860e-02   +5.541322183373040e-01   +3.906926094150852e-02   +2.855413214465491e-01   +2.287031111649553e-01; +5.745171314410668e-01   +1.977744558134897e-01   +2.039177286031328e-01   +1.766681187188638e-01   +6.917093237667405e-01   +7.023486610217866e-02   +8.513581955542510e-02   +3.645385540198384e-02   -1.474263629499906e-01   -6.168609873675591e-02   -1.651747538085963e-01   -5.491147572038921e-02   +2.492761982950877e-01   -4.027269910653411e-02   -1.674025461259054e-01   +1.485841720279268e-01];
L2I_L2E_iAMPA_netcon = [+1.561450418295264e-01   +4.432901322785292e-01   -3.817742439804850e-01   -1.968496416925149e-01   +1.179065283749623e-01   -3.126708632663467e-01   -2.862810938183752e-02   +3.859269634591509e-01; -1.712895040629037e-01   +4.936183350159307e-01   +2.153361460063777e-01   +1.701956185899030e-01   -2.027102439055227e-01   +3.842458112918734e-01   +3.277082718235284e-01   -7.312491053172128e-02; -6.324558416789114e-02   +2.777021872064663e-01   +5.095381170085865e-01   -9.574613019592049e-02   +4.909713550363966e-01   -1.192471214895167e-01   +4.483862910742098e-01   +1.371809301861622e-01; +1.414651625257881e-01   +4.549248428153014e-01   -6.578934045783483e-02   +1.578575796582599e-01   -1.354846201612907e-01   +2.767818215439600e-01   +2.250553713057276e-01   +3.200993226484639e-01; +1.553016175326813e-01   -4.859615395776941e-01   -1.900104622079154e-01   +3.875772643827914e-01   +6.258730944006634e-01   +5.974286199072815e-02   -3.672282647433958e-01   +5.798600649561131e-01; +5.966983473705125e-01   +5.616068271805501e-01   +2.540889995565818e-01   -3.745190908990578e-02   -2.558507827771005e-01   -4.244854554078208e-02   -3.112330494950721e-02   +7.829259514666862e-01; +1.780196717488575e-02   -1.690385802421676e-01   +6.441714324857105e-01   +1.677623018486493e-01   +1.991326245768665e-01   +4.375643169337796e-01   +3.324501304045451e-01   -1.884020812702716e-01; +1.259599063161374e-01   +9.753811181936839e-02   +2.419077419669853e-01   +5.024606953717980e-01   +6.616130817822996e-02   -4.323289756873291e-02   +6.381404457561477e-01   +3.554946742420180e-01];
L2E_L2I_iGABA_netcon = [+6.513438584738795e-01   +1.378859109518810e-01   -2.509734803611651e-01   +1.949507947797544e-02   -3.512062728632770e-02   -2.663437587142773e-01   +2.520033822826248e-01   +1.622459640707519e-01; +4.877465664428401e-01   +2.686156530367065e-02   -9.990056659048815e-02   +2.017918112623552e-01   +1.569003693094618e-01   -2.541349789598468e-01   +6.674176855048495e-01   +9.698318014200358e-02; +4.470054332155061e-01   +4.202623139650623e-01   +8.645357351467606e-02   -7.432790326065841e-02   +5.625032992985743e-01   +1.852190567226740e-01   -3.870329626701695e-02   +2.482054532301743e-01; +1.212364996183597e-01   +8.993876430531988e-02   -1.994940857908436e-01   +9.208368364175921e-02   +6.929319597930845e-01   +8.069161929457391e-01   +5.511561717609190e-01   +5.135656603994394e-01; +1.161786368973763e-01   +5.639274365620606e-02   -4.249549387433443e-01   +3.144168954977251e-01   +1.546364428728364e-02   -1.373095412642058e-01   +2.632597526377176e-02   +7.694215822431822e-01; +2.709276093006439e-01   -3.777606795022449e-01   +5.922094867453203e-01   -1.840585170241958e-01   +3.659087294243600e-02   -1.936538241594362e-01   +3.182683985564931e-01   +2.211061612382048e-01; +2.588190305087074e-01   +1.520935139588483e-01   +2.854232448702905e-01   +5.211692802302669e-01   +3.564049268715835e-01   +3.366179177741333e-01   +2.515564936640612e-01   -6.304145944096920e-02; -7.677763245501526e-02   +3.675209355270870e-01   +4.010929252032098e-01   +3.047018305546954e-01   -4.452263120183752e-02   +5.477040119508243e-01   +1.926528129855224e-01   +3.035834014884035e-01];
L3E_L2E_iAMPA_netcon = [+2.627937062516973e-01   +2.361506471745358e-01   +6.104429394042854e-01   +1.774306492232280e-01   -4.434141473023620e-01   +3.921173509716525e-02   -2.365917805452480e-02   +5.466121696117785e-01   +1.595453531406737e-01   -7.171344612311220e-02   -2.611332727071624e-01   +6.727899542274338e-01; +6.749673643922961e-01   +3.164629986421800e-01   +1.709021452096510e-01   +5.154997106929102e-01   +3.890053857943621e-01   -4.715164162083703e-01   +3.726744919349962e-01   -1.102806827471592e-01   +3.725086562369109e-01   +1.737007643017879e-01   +8.562975186219096e-03   -1.943807434746099e-01; +1.976278971373081e-01   -8.603205909006872e-02   -3.414910656189675e-01   +2.334465345341916e-01   -3.072679313221950e-01   +5.789439692814757e-01   +1.490131884630527e-01   -2.502818157804279e-01   +1.577423013562351e-01   +2.438539554569509e-01   +3.184414370591903e-01   +3.656796696995200e-01; -4.706475871030344e-01   +1.100682843331048e-01   +3.030569179869983e-01   +7.828562782946807e-01   +5.516868272856665e-01   -2.037608262177742e-01   +4.192401916514895e-01   +3.781482328175967e-02   +3.150820344705954e-01   +4.329046088805555e-01   +4.179368776872803e-01   +1.964977832762080e-01; +2.790232011282847e-01   +5.156954943206719e-01   -1.878239009002769e-01   +5.894449881407597e-01   +3.923853856698292e-01   +3.722416601926914e-01   +5.075932837573821e-01   +7.845211408101661e-02   +3.023374005545807e-01   +4.179652846591298e-01   -1.186141225265568e-01   +9.040729107255294e-02; +7.178615188331570e-01   +4.087821572268067e-01   -1.216944567449231e-01   +3.256116573425690e-01   +3.561599931449835e-01   +6.318386907534242e-01   +4.681929088260709e-01   -1.446672778214333e-01   +3.006523255395808e-01   -1.305769551315572e-02   +3.555438372862155e-01   +1.781874764173757e-01; -1.970723198467969e-01   -3.475950404462730e-01   +2.113148108474826e-01   +3.298645179674836e-01   +5.027424677364722e-01   +3.206587788109452e-01   +4.639500521791472e-01   +2.048432495261573e-01   +3.496441456712263e-01   -3.533789184946010e-02   +2.155028285586225e-01   +2.879390232030879e-01; +2.767394238739715e-01   +3.142210252312597e-01   +8.958511053831155e-01   +4.210895406075919e-01   -1.374210539823764e-01   +3.943752591695063e-01   -3.975204097822690e-02   +2.483913101109069e-01   +5.625165578398943e-01   -1.772856635238208e-01   +1.848191661104353e-01   +1.389531515445724e-01];
L3I_L2I_iGABA_netcon = [-4.669870830293594e-01   +5.207197567316888e-01   -6.984664935934098e-02   +1.866128718333578e-01   -3.962343256459486e-02   -7.837815624661869e-02   +3.257298388603279e-01   -1.120828914436443e-01   +8.165825748579486e-02   -1.845538066677331e-01   +3.052990766937582e-01   -2.572911029241400e-01; +4.843915482548626e-01   -3.783664139322579e-01   -1.206412043550084e-01   +7.317153553628785e-01   -9.925245863335240e-02   +2.604472573644611e-01   +2.426858522304755e-01   +2.168283440324306e-01   -1.724797624932169e-01   -1.179068786385306e-01   +8.042925035488629e-02   +2.469275699727274e-01; +5.126934382975914e-01   +1.622591795492917e-02   -1.044722631980915e-01   +3.392214505094121e-01   +5.524656500787439e-01   +3.031574318217469e-01   -7.688215929192696e-02   +2.518992849103460e-01   +1.067683144842810e-01   +5.272075307904608e-01   +7.608819605980971e-01   +6.669281566018278e-01; -1.188059681031231e-01   +3.212789974882247e-01   -9.216779858149732e-02   -1.787907363693365e-01   +3.778712157768149e-01   +2.705218728641787e-01   +3.325962071263395e-01   +1.886775234914032e-01   +3.818777935569362e-01   +1.165123694204869e-01   +3.301700959865174e-01   -2.489525686867954e-01; +4.004035346594822e-01   +2.959230576029334e-02   +1.338356136781657e-01   -5.218586592816782e-01   +3.274906572602653e-01   +3.700356506131537e-01   +1.467033562055617e-01   -2.956744785201619e-01   +3.591786759430311e-01   +2.974320845433827e-01   +8.794269015773487e-01   +1.799103659945489e-02; +4.466080382444223e-01   +2.208155289955455e-01   -1.358048048079088e-01   +3.956084982407002e-01   +2.028969811897408e-01   +6.220700546369052e-01   -2.787674838116758e-01   +3.921058509226540e-01   +2.776521054916241e-01   -5.127823487929453e-01   -1.047515223611939e-01   +1.375562364138676e-01; +1.808969034250925e-01   -3.207693547563056e-01   +6.959675787108273e-02   +1.891116177230182e-02   +2.641625771362058e-01   +2.165802438125233e-01   +2.590965738045675e-01   +3.208074457898327e-01   -2.790130653366747e-01   +1.280092648344597e-01   +5.145917811553483e-01   -1.040536509470379e-01; +5.164159436679724e-02   +2.724949244185856e-01   +2.907732355112554e-01   -3.170604928528503e-02   +1.030384281434960e-01   -1.086730054634606e-01   -1.837049963008516e-02   -9.820995165850067e-02   +2.026537353994229e-01   +4.457327792096304e-01   +4.602883849356219e-01   +1.311555311495347e-02];
L2E_L3E_iAMPA_netcon = [+1.005549630418623e-01   +4.247380534486672e-02   -1.569011467140288e-02   -2.139888959298652e-01   -1.313008124863503e-01   +4.302954160546430e-01   +6.323683100672345e-02   +5.810974526772150e-02; -5.626752932613580e-02   -2.440159705216448e-02   +1.760359538592941e-01   +1.796321009577489e-01   +3.043440783712433e-01   +1.715417269538413e-01   +7.286697834254466e-01   +1.052259353603474e-01; +1.084732588094236e-01   +1.760750837702360e-01   +1.471937436016785e-03   +2.073426161305108e-01   +1.895669284329534e-01   +1.993681658340994e-01   +1.156355214661743e-01   -3.336837347084270e-03; +5.825431890189864e-02   +5.465688181941740e-01   +1.560349616132147e-01   +3.547513058722059e-01   +6.207298731827422e-01   +3.257158836723305e-01   +1.504254190841190e-01   +1.936256476693232e-02; +2.233000567080524e-01   +1.448980880859310e-01   +5.946340547815119e-01   -1.545953004744059e-02   -3.997972689793957e-01   -3.289065798152291e-02   +1.947962506533124e-02   -9.755866019260188e-02; -2.113867698298547e-01   +5.434132991561242e-01   +3.984742805027323e-01   +4.674790760204506e-01   +2.902718889511420e-01   +5.207469041144561e-01   +4.856394799177143e-02   -3.540727452806646e-01; +5.074544057971170e-02   -3.418371765296322e-01   +5.065041875174077e-01   +5.368403823713155e-01   -1.963379065929436e-01   -7.180454783771535e-02   -2.086961180001244e-01   -8.397679552178612e-02; +5.859727955090814e-01   -6.941337805145520e-02   +4.058904987436225e-01   -1.242156092107433e-01   +3.247387407629170e-02   +1.904594944351147e-01   +3.573425550149831e-01   +3.276382019631241e-01; +3.074309498327615e-01   +1.502801726213760e-01   +2.153273933314646e-01   +4.674290663826811e-01   +7.392839219830169e-02   -2.167064676132868e-01   +5.269629854106239e-01   +2.370673258597583e-01; +3.230095592231404e-01   +7.732282282520665e-01   +2.922780202125506e-01   -1.779742600800937e-01   +5.488741537380857e-01   +1.784141032842880e-01   +6.457238397876887e-01   -1.038899934573174e-02; -8.106706309689196e-02   +2.456608750875570e-01   -8.877216707417752e-02   -1.798670826524283e-02   -9.905127308732241e-02   +1.056368187617830e-01   -7.926493684412031e-02   +2.836871361261989e-01; +3.817601882606091e-01   -1.440219762740718e-01   +4.704304766488982e-01   -1.174312256905059e-01   +7.730694257767221e-02   +3.317190881853598e-01   -1.212236038566016e-01   +3.573836175189718e-01];
L2I_L3I_iGABA_netcon = [+2.999212596478010e-01   +4.235618141248794e-01   +3.659186983650599e-01   +5.470384341408663e-01   -2.155327476232780e-01   +6.109933965651955e-02   +1.725224083499068e-01   -1.146604386302137e-01; +2.319855638424349e-01   +2.631427270516132e-02   -2.913789256247884e-01   +5.165251744480831e-01   +1.273257192184820e-01   +3.806932078679377e-01   -2.495543651450947e-01   +5.811349055862319e-01; +3.209909870240832e-01   +2.572820698257393e-01   +7.986790439755698e-02   +3.078906844416771e-01   +3.829833618242656e-01   -1.413804721057257e-01   +5.360056684350917e-01   -4.176265109744445e-02; +3.304520089286485e-01   -6.538602279186646e-02   -2.038851788360955e-01   +1.891503847242884e-01   +3.104658508063293e-01   -1.625301285690179e-01   +4.400393516269729e-01   +2.905487813239672e-01; +5.668748794688410e-01   +5.589048151157390e-02   +2.639838853650466e-01   -1.588686561779580e-01   +6.790446391753822e-01   -4.684108020303463e-02   +5.617367681165543e-01   -1.963643284214360e-01; +2.310774383151423e-01   -4.285404247423599e-01   +2.179090503436430e-01   +4.291599644938610e-03   +2.673787486889648e-01   +1.449123876369298e-01   +9.761763880790447e-02   +6.665390390097388e-01; +3.837904281111950e-01   +4.376371526496418e-01   +2.774915241362024e-01   +3.158786316091946e-01   +4.077407699011382e-03   +2.680867438130474e-01   -5.632680428518202e-02   +9.824366208524017e-02; +3.209790808945517e-01   +7.338461855159184e-01   +3.051379397901399e-03   -2.090553350855124e-01   +6.569304540494548e-01   +6.478924031969543e-02   +3.061381801279898e-01   +1.243267154708559e-01; +2.528550092851015e-01   -3.121915464243146e-01   -4.204320706518526e-02   +5.299838962090984e-01   +4.846398489672327e-02   +3.546732539351903e-01   +5.420286774229527e-02   +2.413191081656873e-01; +2.420870447069702e-01   +2.146891083106477e-01   +8.635196459800899e-01   +2.220160492309415e-01   +3.012542670956007e-01   +2.782401304819951e-02   +1.335094522150824e-01   +6.480336382629367e-01; +3.623115948917482e-03   +4.616057437155012e-01   +2.299247123083148e-01   +3.249818812915137e-01   +1.000220260497545e-01   +3.261388344286013e-01   +3.260444875934344e-01   +1.588352315759363e-01; +4.499938586531891e-01   +1.141414304520153e-01   -2.034404332096263e-01   -1.782947879139675e-01   -4.116377583600445e-01   +5.766380275884702e-01   -9.000274673786585e-02   -3.917571449198935e-02];
L3I_L3E_iAMPA_netcon = [-1.295019765144079e-01   +5.550165661377016e-01   +5.553247905046408e-01   +6.683583160284684e-02   -1.916717283413720e-01   +2.931857804180532e-01   -1.760398928827647e-01   +2.581837274017769e-01   +1.748464999210758e-01   +5.523664037386382e-01   +3.527068597489091e-01   -2.163096907192318e-01; +6.144654053548387e-02   -5.028675615652473e-01   +1.058745554425479e-01   +3.910035203440506e-01   +9.180658684813020e-02   +5.617235561311356e-01   +4.007187350238539e-01   +1.814530898119553e-01   +1.111526325166135e-01   +1.809032799243982e-01   +1.096662275640708e-01   +1.577955500659911e-02; +5.699943938853447e-01   +4.123763521567278e-01   -1.625200335727127e-01   +4.575626047584991e-02   +1.680723650357734e-01   +7.075941938746442e-01   -8.529066931865674e-02   +3.516944458396948e-01   +2.941177818573222e-01   -1.452498489193761e-01   +5.417266382767452e-02   +1.047026862396873e-01; +1.804270808730797e-01   +3.540020502917148e-01   +4.746865234528698e-01   -4.018206677344555e-02   +2.901451229751910e-01   +3.451990537563885e-01   +4.945202615192684e-01   -1.900186498560429e-01   +7.485954774876439e-01   -2.234299244128535e-01   +2.378643775342025e-01   +7.806883185179070e-02; +3.160707210271766e-01   +1.250967652042225e-01   -6.492820225501053e-02   +5.212657022087825e-01   -2.612948922189767e-02   +5.575683752964620e-01   -2.580426674219868e-01   -5.489186224345503e-02   +4.322524229880252e-01   +3.091656135902733e-01   +3.735887942377155e-01   +4.282896277884759e-01; +1.432144282359418e-01   -1.717150641045663e-01   +6.520100838802428e-01   +3.150566045273850e-01   +4.703934721759225e-01   +2.186378939977092e-01   -1.176424395125503e-02   +3.970211090782687e-02   -1.491071307457433e-01   +3.816912287959785e-02   +3.310793833992970e-01   +2.592255179442812e-02; -1.825767566451370e-01   +1.085702776220287e-01   +4.935199811349270e-02   +1.939728867760738e-01   -1.897547138985436e-01   +5.359563978043919e-01   +1.259285101578227e-01   +4.961246724448896e-01   -7.059534526692371e-02   +4.938304691270165e-02   +3.779541022748004e-01   +1.079148630713816e-01; +5.973067960317512e-02   -4.609019825415595e-02   +3.033341074962660e-01   -1.645388658703361e-01   +3.071241756814016e-01   +4.999925348790500e-01   +1.160864015315481e-01   +4.223447525294151e-01   -1.863787019449764e-01   +4.335862056627238e-01   +2.612841259458654e-01   +3.751033208250522e-01; +5.867413862119193e-02   -5.047262955650139e-02   +3.767409847750970e-01   +6.575090976042197e-02   -1.947923166143660e-01   -1.764664390569116e-01   +5.816740946467768e-01   +1.270285064216656e-01   -4.005977661263082e-01   -1.373062443742497e-01   +4.342545479056472e-01   +3.256654324159778e-01; -2.572437063949479e-02   -7.308241813039382e-02   +8.055971259256547e-02   -5.027779928529671e-02   -4.113039449378200e-02   -1.109115258191359e-01   +1.629800676440770e-01   -3.809142627032274e-02   -4.364450450609609e-01   +2.918317367173648e-01   -1.678689896917546e-01   -1.157296660119869e-01; +2.920633797623172e-01   +6.019735611761436e-01   -2.323690456801353e-01   +1.672103639637938e-02   +4.652544095217392e-01   +2.112338314638597e-01   +1.489867593102916e-01   +6.531399879867271e-01   +1.502402306716718e-01   +2.650389004929604e-01   -1.858378843975987e-01   +2.151396024425629e-01; -7.271126293662317e-02   +1.128523799412614e-01   -1.569742567589908e-01   +5.827577203924044e-01   -3.457397268790564e-01   +4.799226457404699e-01   +3.066715063334383e-01   -1.069553923304019e-01   +7.281740831430014e-02   -5.338289413151506e-02   -2.394599037607925e-01   +4.919808564940457e-01];
L3E_L3I_iGABA_netcon = [+5.298674306096876e-01   +2.894496931826086e-02   +2.349896719374004e-01   -2.494182527914368e-01   +2.499071316350139e-01   -1.439557152553008e-01   +8.171612424243960e-01   +4.103688144863803e-03   +3.623657395270271e-01   -1.480673505449143e-03   +3.054627185396163e-01   +2.859219283045232e-02; +6.585966038868117e-01   +3.599537221140769e-01   +3.245213156439614e-01   +8.262426000210838e-03   -6.513327810195310e-02   +1.028862357987964e-01   +3.421035610527731e-01   +3.741133121947559e-02   +3.329130003968336e-02   +5.378277396615483e-02   +2.860543942120947e-01   +5.275141626770147e-03; -7.356630915398792e-02   +4.190712677667821e-01   +1.896318470499669e-01   +2.641867033420854e-01   +3.098065624416789e-01   +3.976196718902680e-01   +7.134975585081629e-01   +2.957884108864535e-01   +3.924240150305157e-01   -4.043291682352166e-01   +3.457418055739414e-01   +3.418070283592125e-01; +2.571701166115042e-02   +1.168063139151533e-01   -2.678204541112715e-01   +1.881048461361170e-01   -1.812624649735226e-01   -3.350776268208936e-01   -6.531406964293940e-02   +1.596158295568976e-01   +8.321534091032503e-01   +1.050591035754729e-01   -2.441075520494711e-01   +3.810500846666269e-01; +5.497390059519940e-01   +1.364516157469606e-01   +7.052758454211883e-03   -1.214703298603476e-01   +2.936821146481629e-01   +2.797631088595149e-01   +2.429731404106915e-01   +2.193978177331166e-01   +5.897842804430732e-02   +2.506159397985591e-02   -2.893428424114706e-01   +4.641702738713436e-01; -1.129864992705625e-01   -4.053363136006355e-01   +2.888076925075055e-01   +6.067594754333835e-02   -1.841052571825980e-01   +2.198560100541116e-01   +8.780454406117705e-02   +2.147955001367335e-01   +2.715211492504488e-01   +6.554804063259669e-01   -5.915930923873568e-01   +3.653370600767303e-01; +6.275148468866736e-01   +4.580589396003672e-02   +5.246762512702975e-01   -1.071474025880651e-01   +2.493428835753356e-01   -3.224733165808413e-01   +3.000616063255926e-01   +3.587294213856943e-01   +1.200393747932993e-01   +7.088519556921029e-01   -7.312918464170887e-02   +1.848665480978975e-01; -3.889594941252192e-01   +1.840239778958388e-01   +1.677536885019114e-01   +6.765166864506597e-01   +6.797798621254103e-02   +1.982243024090053e-01   +4.839991851172620e-01   +1.897011017587144e-01   -2.184185401518612e-01   +2.262980509745635e-01   +2.036212414758855e-01   -1.712194852566995e-01; +8.783487986124140e-01   +6.612634397060042e-02   +5.510583260248818e-01   +2.319262960048009e-01   +3.293093667591493e-02   +6.106188339312479e-03   +9.642370198701536e-02   +7.752276609329880e-01   +1.296437022477471e-01   +1.727640493429072e-01   +1.527491705951228e-02   +3.605801769495133e-01; -4.003394608948462e-01   -3.822987421883925e-01   +2.770948298467585e-01   +8.794442377690420e-03   +2.060669524019856e-01   +2.618051520437560e-01   -2.721981137810549e-02   +1.550789223490811e-01   -2.934621904730002e-01   +2.359804040545336e-01   +2.372487682189220e-02   +1.126297144936850e-01; +5.531822215957813e-01   +5.754281775903514e-01   +1.147581912036965e-01   +2.813333654302549e-01   +3.706492765878688e-01   +3.177125188791541e-03   +3.167822765605963e-01   +1.871196387783226e-02   +4.733143449371731e-01   -2.509187469986720e-01   -8.046555745821080e-02   +3.097990326067379e-01; +3.038975954742166e-01   +3.023298108885383e-01   +6.805375151060467e-02   -5.776142523490595e-03   +9.448287996841384e-02   +1.588726708420034e-01   +2.314968191729054e-02   +3.262403514849511e-02   +3.026186069291172e-01   +3.254180953119427e-01   +3.040299160618551e-01   +8.239003005573960e-02];
L2E_Input1_iAMPA_netcon = [-1.485289305562761e-01   -2.913741213891823e-01   +6.571569850768813e-01   -1.605385134201973e-01   +6.756984649065351e-01   +3.816549981759078e-01   +2.648086151772740e-01   -7.369304049118892e-02];
L2I_Input2_iAMPA_netcon = [+1.128516435436480e-01   +7.678767841826940e-01   +3.592287038809382e-01   +4.477651196953821e-01   +5.831171621581969e-01   +1.809486817932623e-01   -9.616289687447699e-02   +2.305390409994074e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  33.63 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
