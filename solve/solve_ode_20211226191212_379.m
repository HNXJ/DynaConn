function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.107219700889933e-01   -1.391518087607337e-01   +1.694110425041994e-01   +1.746499421475811e-01   -1.882259595012275e-01   -8.055800576692367e-02   +2.359076336025099e-01   -5.318093495468394e-02   -3.295510251869129e-01   -2.223546234088107e-01   -9.339834152106076e-02   -2.754231069152639e-01   +3.291333477765743e-01   +1.991081570301591e-02   +7.179182556851543e-03   +8.185180086191986e-02; +1.014113512241963e-01   +2.566825067145870e-01   +1.087740456021521e-01   +3.310762288252189e-02   -3.835664566953907e-01   +1.978215474366223e-02   -6.337295756940041e-02   +1.094907616958886e-01   -2.431080218943756e-01   +3.396536209373761e-01   -7.823779675849929e-02   +4.240914686588695e-02   +1.297092396551257e-01   -7.971832171589116e-02   +2.260565939929158e-01   +6.692655622843126e-02; +2.202593445165623e-01   -1.340372779454553e-01   +1.032571582387084e-02   +2.699619029152801e-01   +2.244478670784534e-02   -1.050014047222970e-01   -2.786029555218750e-01   +2.979103713062892e-02   -1.227518956049841e-01   -6.464769912826387e-02   -1.445395064845602e-01   -2.093013851872398e-01   -1.675694948129299e-01   +1.850412942797752e-01   +1.097748203340457e-01   +2.136082745852440e-01; +2.937885869088741e-01   -2.891346805668813e-01   +1.979555129452562e-02   +3.804938804768565e-03   +2.746217008527967e-02   +3.848626455211477e-01   -1.602925617170156e-01   -2.287716776214338e-01   +2.214365138726738e-01   +1.363982950480033e-01   -1.689007655782926e-01   -3.211039296732051e-01   +2.951275260696034e-01   -1.129744253801780e-01   -1.609225517704842e-01   +2.188220685343844e-01; -2.317972877915424e-01   +6.039581900429711e-02   +5.970766204983588e-02   -2.072976121807214e-01   +6.379760933605505e-02   -2.704740606972281e-01   +2.098979038624815e-01   +5.345997295336118e-02   +1.417004931342736e-02   -2.180918410983432e-01   +2.488750659623491e-01   +1.577661070742859e-02   +2.581690074461012e-01   +1.096279010856175e-01   +2.194577422169143e-01   +1.585706274057502e-02; +3.953305629863777e-01   +2.228007600628504e-02   -6.853397230928177e-02   +9.333925249017219e-02   -2.494699447033425e-01   -4.235575990669904e-01   -2.332250234702227e-01   +1.824387409674562e-01   +4.147250454967940e-01   -3.475222889496296e-01   +1.776767284073356e-01   -2.756605273366751e-01   +2.575384580370383e-01   -3.008881593220606e-01   +2.610170128192633e-01   -1.024802720930025e-01; +5.013695675949033e-02   -2.049592123859807e-02   -1.429563075023314e-01   +1.622363355899347e-01   -2.208679861103037e-01   +1.149930310422512e-01   +1.407652681165719e-01   +7.351532287633401e-02   -4.187818110893114e-01   -1.285708577486151e-01   -1.727478637636652e-02   +6.940461161465829e-02   -1.006099532305878e-01   +3.292550239536878e-01   -4.515856811106106e-02   +4.636157662128752e-02; +1.878364345320723e-01   -6.414203544723796e-02   +3.854314037463953e-01   -3.920490330806974e-02   -3.477995329764015e-02   -1.036212292470977e-01   +8.210516051159092e-02   +9.555084807648041e-02   -4.591270773285874e-03   +1.408461777214987e-01   +1.452652881594203e-01   -1.892437832349073e-01   +2.133170467471437e-01   -1.270944846573548e-01   -1.530008359010381e-01   -5.680041387607756e-02; +7.092588754457849e-02   -4.773946959844399e-02   -1.862815853014414e-02   +5.760370765326665e-02   -1.239452146155415e-01   -1.166723941954660e-01   +1.698931069189799e-01   +2.238607148594862e-02   -4.334369944825386e-02   +1.323278151038654e-01   +3.684256160231367e-02   +2.017968889160155e-01   -6.063243219880464e-02   -2.893598227062887e-01   +2.330168420355027e-01   +3.393327631092101e-01; -2.124048039712115e-01   +2.221921783964535e-01   +3.960461275722357e-02   +2.042166672625679e-01   +1.649098135649486e-01   +3.217845961183247e-01   +4.956880176489158e-02   -1.049828431156428e-01   -2.542046917780743e-01   +2.551595334063997e-01   -1.007957040597704e-01   -8.184603764685670e-02   -1.985558910429742e-01   +1.004238615585684e-02   -9.344655506293317e-02   -6.326421264648602e-02; +9.206706929189867e-02   -1.699134756919938e-01   -2.617676766495781e-01   -3.962825862435339e-01   +3.143573538457214e-01   +1.791353076077396e-01   -1.140768036345194e-01   +3.623906910730990e-02   -2.356075755197485e-01   -7.276480989055689e-02   +1.264324680714260e-01   +1.893898091350216e-02   +7.629688647377450e-02   -7.266111018568586e-02   +4.196573402896682e-02   -3.150142133519890e-02; -2.402443131993828e-01   +2.669270392460760e-02   +3.157958789875243e-01   -1.762624361063961e-01   +2.396234083772165e-01   -3.292964355100799e-01   +1.588777301681827e-01   -2.839162573808778e-01   -1.200753447471737e-01   +3.029799458697083e-01   +2.378574888182073e-01   -1.911019131063844e-01   -9.405145051127858e-02   +1.277837069910043e-01   +1.003143730146655e-02   +1.938527797220876e-01; +3.741876127078835e-01   -2.617713233069612e-01   +1.547030528242573e-01   -1.829499767367978e-01   +3.580429321223708e-02   +1.093785055059831e-01   +1.476261381628233e-01   +2.180196117101629e-03   -3.349831290625187e-01   -1.843886907887230e-01   +4.214009182384493e-01   -1.550028527304582e-01   +1.134079292970648e-01   -8.498533187865757e-02   +3.575989715438141e-01   +2.372459890025841e-01; +2.758347188993874e-02   -2.178419171393331e-04   +6.872170859995168e-02   +1.179297760859337e-01   +2.154126120769088e-02   +9.853965989775575e-02   -1.549684977537575e-01   +2.809480178692756e-02   -1.719561697703686e-02   -8.808957731733497e-02   +1.004481646152937e-01   +3.146828203302346e-02   -2.850035368702938e-01   +1.650852245157173e-01   -9.110782796898953e-02   -8.441314363723136e-02; -2.817644176577122e-01   +5.347372994978126e-02   +1.432766000085821e-01   -1.633374486084161e-01   +1.400600715026404e-01   -1.243363050663063e-01   +6.756819049466693e-02   +2.597073580653107e-01   +8.273890029389636e-02   +5.512739036603601e-02   -1.072185107667413e-01   -1.898079225194705e-01   +3.328599222985058e-02   +2.973246291607956e-01   -2.483242433217694e-01   +1.440616441948743e-01; +3.267440972433557e-01   +3.199983447017741e-01   +4.239470960211685e-02   +1.893763373799003e-01   -1.566336547043427e-01   +8.972096885664407e-02   -1.048080688227128e-01   +1.102727061564178e-01   -3.770815493904367e-01   -4.531452682251358e-02   +2.504012398951705e-03   +2.146033745047308e-01   +1.709384704819421e-01   -2.074583306656631e-01   -6.812549963583044e-02   +2.190734337070654e-01];
L1E_L1I_iGABA_netcon = [-3.287004527091090e-01   -1.818357211110534e-01   +1.946123619053209e-01   +1.109891836656282e-01   -4.854756502222957e-02   +2.602811101492559e-01   +1.547204980721699e-01   +1.957178608681189e-01   -6.121163259699748e-02   +4.596362068422372e-02   -2.009641691981193e-01   +2.398667260373786e-01   -1.275001697380858e-01   +3.207793920667980e-01   +5.703282085167240e-02   -1.647731179008727e-01; -1.414193425535513e-02   +1.268519768783705e-01   -2.292522055199799e-01   -5.466933309514022e-02   +3.406766323997092e-01   +7.730555739642438e-03   -3.854845517756281e-01   +6.931868313975292e-02   -1.856161106118723e-01   -2.934610535400271e-01   -1.473398817753192e-01   +3.659591284110502e-01   +2.656253962253574e-02   +1.416887569334969e-01   +1.001837114078313e-02   -1.203895461971528e-01; -2.452442579940237e-01   -1.971138100613546e-01   +2.737845169058237e-01   +2.296024669304889e-01   -7.246619705530324e-02   -8.364829539766022e-02   +9.935340123405562e-02   -1.273794434858421e-01   -9.385796961232390e-02   -2.434587540932148e-01   +7.702252462380557e-03   +8.913901653615711e-02   -1.495321425246449e-01   -1.378542344404553e-01   -1.667033578629945e-01   +2.683481455860947e-01; +1.900370582564331e-01   -1.436260262795926e-01   -7.945479902999472e-02   +1.003497860603532e-01   +1.408417818387342e-01   -4.138046640608438e-01   +1.737808005234258e-02   -1.970363608137895e-01   -2.296742944553055e-01   +4.293657863644657e-02   -2.552066405427014e-01   +1.922228768584037e-01   -9.565560062079652e-02   -1.966132511949149e-01   +5.996294855868641e-02   +1.236959820901954e-01; -7.167043792057093e-02   +2.589830651968212e-01   -6.358086990006745e-02   +2.824736513765566e-01   +1.019914312137095e-01   +9.473021386652120e-02   -3.929917052412086e-01   +1.664372716631978e-01   +5.017383242416878e-02   -1.499480840386008e-02   +3.780602815111229e-02   -3.321203376454952e-01   -1.775822653027683e-01   -2.451079734452483e-01   -2.358237156911913e-01   +2.584743881883334e-01; +1.275896695120085e-01   -1.939705971020875e-03   +6.089663823803795e-02   -6.322074976684003e-02   +1.947017037197873e-01   +9.912731209133455e-03   +8.251327000851175e-02   -2.136724035772506e-01   -1.671617340716725e-02   +1.913188935747625e-01   -4.620521036018096e-01   -2.327063531001189e-02   +2.720938279166078e-01   +2.057807698295816e-02   -2.799339357244413e-03   -1.529252152865773e-01; -2.236532733229433e-01   +1.701305756952026e-01   +1.083131518087251e-01   -3.935528226954987e-01   -7.147389007525283e-02   +2.747823016315701e-01   -2.631457325510883e-01   +6.667163404819074e-02   +1.571746639145926e-01   -2.334351261669564e-01   +4.211333338365256e-01   +3.338907267495196e-02   -1.481984613067224e-01   +1.857502424292205e-01   -1.556940192637768e-01   -1.981469801830969e-02; +5.527351098279176e-03   +1.831924111903516e-02   +1.079919308400946e-01   +2.050162564051601e-01   -9.469533654056732e-02   +3.037562810021408e-01   -9.975362263667401e-02   -1.422070992908367e-01   -2.841986003287036e-02   +1.431674036516542e-01   +2.750633475351078e-01   +1.034060737784705e-01   -6.774355087591660e-02   +1.171714567854222e-01   -4.103391689389204e-01   +2.003636356484546e-01; -2.891094579247331e-01   +4.092151286535389e-01   +7.123704459438143e-02   +4.248952255069275e-01   -2.026305998500021e-01   -3.163527330609639e-01   -7.958485234745766e-02   -2.708687316167206e-01   +2.303021543863429e-01   -2.580820348505548e-01   -1.191832679781922e-01   +3.029435520491716e-01   +1.991381927568037e-01   +3.206239164242601e-01   +5.453779751677434e-02   +3.521274410021106e-02; -1.430135379319478e-03   +2.112893976486125e-01   -4.833593454446208e-01   +9.492204242324243e-02   -3.393525495220527e-01   +3.465285200770752e-01   -2.768088706305145e-01   +1.699788673764249e-01   -2.650993180658906e-01   +1.487761346103522e-01   -4.181669256048204e-01   +5.777673527797869e-02   -6.687959505649452e-02   -3.891582664913132e-02   +1.092164713509946e-01   +3.423813954926941e-03; -4.245842355197113e-01   +1.421903293900353e-01   -6.662780762886215e-02   -1.743417505530332e-01   -1.405458375383060e-01   -1.924495301035970e-01   -1.111436843859799e-01   +1.384971244157531e-01   -1.588307616287878e-01   +1.943223099476993e-01   -1.213266858932825e-01   +6.640903611606376e-02   +4.026554765813209e-02   -1.294921922726232e-01   +1.569575711251515e-01   -1.369453765066498e-01; +1.038916000980941e-02   -6.830788583091574e-02   +4.872374022922183e-02   -1.541265996740657e-01   -9.673490328842752e-02   +2.644726537319435e-02   +8.579369085971406e-02   -3.034455418137902e-01   -1.210926365871314e-01   +1.335149568011999e-01   +3.196626120748418e-01   +1.324049212736770e-01   -1.955993361905229e-01   +1.313178623049165e-01   -3.160724272784414e-01   +3.393568468188615e-02; +3.047455081411025e-01   +1.098119875856955e-01   +3.792284609436030e-01   +2.956459204155931e-01   +6.297803413696369e-02   +8.512255223097046e-02   +2.573859641341339e-01   +8.197481408859045e-02   +8.114227207749691e-02   -1.291239426048215e-01   -1.331758885377035e-01   +6.906878441118097e-02   -2.442826850190943e-02   -3.554075715906889e-01   -1.050654301657080e-01   -7.533865552597169e-02; +1.843715479706558e-01   -3.371974970627454e-01   +1.306957317988578e-01   +1.933989198226325e-01   -9.645784528474767e-02   +4.406891554385597e-01   +3.271660617168813e-01   +9.629498752495254e-02   -7.994366418173791e-02   +1.460844409982039e-01   -1.883414733759353e-01   +1.423462799377308e-01   +8.883749992912468e-02   +1.917542828849226e-01   +8.475633026703344e-03   +3.616134084125775e-01; -3.657030185556049e-01   +2.795288482972371e-01   +3.654331533450842e-01   +1.328934825472277e-01   -3.927262978128384e-01   -1.199110120531788e-01   +2.500548923131161e-01   -2.516034826125082e-01   +3.082475262597723e-01   +1.446128735286983e-01   -2.593099090311715e-01   -3.976468916197939e-01   -1.351787613066969e-01   +2.785527815365404e-01   +1.151382215846761e-02   +6.827996806947839e-02; +1.557958545717817e-01   +1.358567252524954e-01   +3.013601204787744e-01   -1.275113197051073e-01   +2.499536280255404e-01   -4.315407162519228e-02   +2.966777239003001e-01   -2.128030976162001e-01   +1.058882037124037e-01   +1.177270304442742e-01   -1.247592194181325e-02   -2.271509835084330e-01   +2.721139840580332e-01   -1.587850670850003e-01   +2.992208760526123e-01   -8.322096414227460e-02];
L2I_L1I_iGABA_netcon = [-6.274300669833963e-02   +3.224499182146916e-01   +3.585176876237621e-01   +8.522535026316791e-02   +9.684702751284925e-02   -3.763361597328180e-03   -2.189468010674416e-01   -9.731309770322114e-02; -8.202934402827902e-02   -8.039969536543470e-02   -1.978645881021996e-01   +2.894894879045958e-01   -2.458136273584882e-01   +1.098621236001212e-01   +2.097505770888432e-01   -1.090950917749441e-01; -1.556312057717536e-01   -5.689922444340118e-02   +1.016396570057753e-02   -1.862889380656784e-01   +5.364263924527981e-01   +1.062465685343168e-01   +3.023730848524879e-01   +2.952886160544611e-01; +2.459761810901914e-02   +2.841706150783225e-01   -2.200604225158335e-02   -1.599666683058128e-01   +8.501735046972893e-02   -2.129220240963237e-01   -1.309642780172193e-01   -2.830669860634829e-01; -1.858319740992744e-01   -2.356813715582559e-01   -1.256580559299150e-01   -7.116680833451582e-02   +1.298532111132313e-01   +1.631200429217940e-01   +9.456133110402175e-02   -1.960209851329663e-01; +3.070646547009977e-02   -8.523110374575121e-03   +1.147159370745827e-02   +1.230045438288825e-01   +2.641481036622683e-01   +3.994494441189614e-01   -3.208469468425731e-01   +3.388633809823892e-01; +1.853572109694462e-02   -2.454323832291022e-01   +7.485609668773131e-02   +9.013767443017259e-02   -3.264179098937899e-01   -9.012421191965760e-02   +3.984756333301123e-02   +2.203237706622335e-02; +1.278365245792471e-01   +4.537227726524609e-03   -2.746249461645602e-02   +1.447202063932016e-01   +3.048660013545732e-01   +2.236820795267085e-01   +1.057748721145138e-01   +7.386956922847410e-02; -2.820508538599939e-02   -3.017554145771605e-01   -5.165124601773907e-02   +1.459533848625238e-01   +1.079199065991214e-01   +2.343093587752291e-01   +2.253656809392371e-02   +1.362843347511096e-01; +7.056994829805914e-02   +3.236080880012241e-01   -1.362963344808637e-02   +2.848871645149229e-01   -1.458274722038402e-01   +1.808176656917709e-03   -3.352254529234622e-01   -2.025681575222163e-01; +3.769654710974003e-01   -4.486811541833987e-01   -9.781871163932881e-02   -1.805385003550674e-01   -2.007643306514337e-01   -1.932651105391304e-01   -7.033827518462375e-02   -3.594256867434974e-02; +2.003204905700774e-01   +2.726826960343337e-01   +2.371989706100158e-02   +3.350033291746549e-01   +1.559676229202932e-01   -1.531930449793497e-01   -6.441436052191933e-02   +2.398118752322209e-02; +3.603131238340761e-02   +3.642654335267240e-02   -1.007894465947091e-01   +2.459251880200687e-01   +2.790669279867958e-01   -2.613263525286331e-01   +2.405709505641527e-01   -2.085739051382213e-01; -2.935772948673639e-01   +2.237931050749006e-01   -2.297290720379056e-01   -6.878640227102321e-02   +9.970367339485708e-02   +1.423003816116734e-01   -2.129229065719802e-01   -8.901235944791536e-02; -3.693378259054996e-02   +5.740828105756934e-03   +6.247552805960510e-03   -1.212864090690169e-01   -2.626399697221160e-01   +1.856681426794965e-01   -3.334125897007143e-01   -8.180356498703055e-02; +4.186496311034034e-01   +1.193397622995190e-01   +8.606139427920462e-03   -2.404740785849408e-01   +7.941865183647802e-02   +3.884888723526642e-02   -1.993136762213220e-02   -1.279828689769819e-01];
L1I_L2I_iGABA_netcon = [+2.483572993202646e-02   -1.777448651292219e-01   +1.132053210951999e-01   -1.824363064760051e-01   -1.596998902693046e-01   -2.560316864259051e-01   -1.662447643739227e-01   +2.226047101074498e-01   +3.613535549338441e-01   +5.754339820943557e-02   +2.895896380926622e-01   +2.799677556377065e-01   +4.134828139526345e-01   +1.841445180856320e-01   +1.544558068372064e-01   -4.422130550463303e-02; +3.326797585634212e-01   -2.955037647754836e-01   -1.590277073775750e-01   -1.480057835053603e-01   +2.925456923193677e-01   +1.451790451960120e-01   -4.462100281501576e-02   +1.503918126948270e-01   +2.866346827834311e-02   -1.436247059858620e-01   -9.917361180884007e-02   +4.292633467547977e-03   +2.493899863357123e-01   +1.364526331162784e-02   -3.761451201363378e-02   +1.586999004230283e-01; +2.933257305371398e-02   -2.174728919337443e-01   -2.652914415770968e-01   +1.535744025709883e-01   +2.530888600828723e-01   +1.951652752957717e-01   -3.216813681638840e-01   +8.674003876500133e-02   +2.748885010962440e-01   -9.227406378632269e-02   -2.094038368497605e-01   +1.803495344944928e-01   -1.186459740103658e-01   -1.307398143472392e-01   +2.080716721290770e-01   +1.940380032797621e-01; -1.977742179992770e-01   +3.301679555946014e-01   -1.041777417262360e-01   +3.253603193324367e-01   +1.982290352529334e-01   -5.253713582703599e-02   +1.660708117833537e-01   +3.144092428941615e-01   +1.239824660331956e-03   +5.080414163266285e-02   +1.613172109819492e-01   -1.888330679461292e-01   +1.443165062259418e-01   +6.134515786430557e-02   -4.278425107043262e-02   -6.470011493085845e-02; -2.028304591331791e-01   -8.185827101607490e-02   -1.362157433696490e-01   -3.521711780400090e-01   -3.326373751964032e-01   +1.166900252713135e-02   -1.198440548464995e-01   +2.840368884044913e-01   -1.220238262325111e-01   +1.813836968118458e-02   -3.429285242924686e-01   +2.383697830033766e-01   -2.448716698391959e-01   -6.101219439651834e-03   +1.496879831230531e-01   +5.082812287620388e-02; +1.007847388531717e-01   +2.326829152529301e-01   +9.398913122308804e-02   +7.673584957259387e-02   +2.260212119357485e-01   -2.388503370166536e-01   +8.453202528957177e-02   +3.208320832219821e-01   +2.338774352838810e-01   -4.145228510925684e-01   -2.065382213897011e-01   +1.426732582051822e-01   -3.028993357620369e-01   +4.989910578579414e-02   +4.277052014970863e-02   -1.529190951251954e-01; +2.180833454716831e-01   -3.114566288327892e-01   +1.018258989065537e-01   +2.709136645653029e-01   -1.746048341583945e-02   +3.351831303281715e-01   -3.499043311064987e-02   -3.109734432921561e-02   -1.656609839811679e-01   +1.915944410446863e-01   +2.406284716097508e-01   +3.298816897285033e-01   -2.786872048506144e-02   +2.492311261028292e-01   +4.874213583152875e-03   -1.032538026007343e-01; +3.073733179157023e-01   -3.100453551026863e-01   +1.268440549749735e-01   -2.217688416366055e-01   -3.732790424163661e-02   -1.923431861386441e-01   +1.909131981779416e-01   -1.057868204285239e-01   -1.658617786453127e-01   +1.392212069335017e-01   -3.835035666542880e-02   +1.308701969918339e-01   +1.359818448662858e-01   -1.751895769725019e-01   -2.303202204720213e-01   +2.908527777678066e-02];
L2E_L1E_iAMPA_netcon = [-2.618897279979499e-02   -4.659292245822672e-02   -1.229346910845644e-01   -2.470846032405214e-01   -2.320008193826621e-01   +1.223661041836415e-01   +7.171328088041234e-02   -2.623561033180083e-02; +1.293892719648784e-01   +5.365379368688730e-02   -2.162555155455451e-02   -6.938335719489097e-03   -1.417169809883774e-01   +1.150317806428686e-01   -2.299013073153065e-01   -7.726697476931713e-02; +2.171553747387429e-01   +3.658000996609287e-01   -3.593853519544952e-01   +4.698796821563142e-02   -4.700512861933476e-02   -1.825539238633273e-01   -4.307540534751346e-01   -1.471994744488794e-01; +2.609416908473325e-01   +1.110381622413917e-01   +1.871613092264041e-01   -1.285795395723747e-01   -4.732199151903487e-02   -1.402035670864448e-01   -2.766536280021982e-01   +4.504738795992727e-01; +3.688325939697077e-01   -2.216022278956042e-02   -1.874738854774061e-01   -7.917661478352794e-02   +1.684246684109379e-01   -1.393478493581063e-01   -1.494312723758700e-01   +1.918800101395408e-01; -1.365854630576037e-01   -1.898294934042387e-01   +1.933729026576833e-01   -1.585251918281310e-01   +6.010840164415656e-02   +2.806818546228598e-01   +3.229733816700409e-01   -8.866164455156614e-02; +1.662327944683091e-01   -7.820362467989538e-02   -1.262410075179994e-01   -9.301103210422611e-02   +5.321854218569190e-01   +4.461158463505629e-01   -1.882725990915694e-01   -3.032819538730727e-01; +3.231385558544269e-01   +3.494931861644011e-02   +3.356168752266706e-01   -1.949429499531599e-01   +1.060856183222097e-01   +1.804391727555710e-01   -2.064326855370030e-01   -2.467611562597266e-01; +1.592892522701818e-01   -1.361034943397568e-01   +6.985515538781517e-03   -2.565366736065092e-02   +2.361045708358845e-01   +2.598655701423180e-02   -5.344505926714260e-03   +2.116684152569878e-01; +9.501901918681843e-02   +2.329069486596667e-01   -2.062452039058341e-02   +1.524769477710488e-01   -2.273692906003487e-01   -3.790265521358943e-02   -4.532601320238752e-02   +9.864355745819861e-02; +9.883875849840940e-02   +2.474671405833089e-01   -4.002043734057313e-01   -2.597737216128920e-01   +4.951808056333350e-02   +2.993209140842031e-01   -4.741179205411511e-02   +2.646875314474437e-01; +8.198790172348605e-02   +1.169011833587943e-01   +8.084578040413438e-02   -2.147681093666431e-01   +2.704308339130826e-01   +3.379871561892712e-01   +1.337320451969488e-01   +4.668663995982644e-02; +2.065499645610244e-01   +1.587438719314762e-01   -1.674324771688701e-01   +6.806643227304875e-02   +4.683141404607020e-01   -2.917690461321680e-01   -1.798240844014620e-02   +3.483583691452728e-02; +3.013903292448682e-02   -3.893108338206420e-01   -2.042063888628719e-01   -2.279991760116604e-01   -3.095134489367251e-01   +1.643826281125419e-01   -2.309515032391250e-01   -1.110977776753026e-01; -2.010797810421064e-01   +7.484599543102227e-02   -7.687356576958596e-02   -2.775394414072941e-01   +3.853600501441701e-02   -2.817869765967784e-02   +2.024160659402613e-01   -1.488411209793805e-01; -3.859107224955877e-01   +2.332203192358731e-02   +8.304953521483838e-02   -2.879867639962524e-01   -3.200328727842425e-01   +4.824393159310544e-02   +1.287394284877635e-01   -1.044283858870634e-01];
L1E_L2E_iAMPA_netcon = [-2.341296690738698e-02   +2.239736377777980e-01   -2.152642561602180e-01   -1.420314076782410e-01   -2.045339717803400e-01   -1.745733970191408e-02   +1.059415250553488e-01   +1.918470681833222e-02   +6.902389379012652e-02   +1.974576502130672e-01   -3.973204256691260e-03   +1.181767702894404e-01   +2.991211382879948e-01   +1.708947861996435e-01   +3.503906077378570e-02   +4.021727735936580e-02; -5.198463808046880e-03   +1.922822412875327e-02   -1.803474844275745e-01   +3.022786411439601e-01   +1.877073421924617e-01   -1.473291488122361e-02   -1.324182435504308e-01   -3.678501198833327e-01   +9.051000912413418e-02   +1.305786553812159e-01   +1.059032133686511e-01   +2.649140060796671e-01   +2.099775651567969e-01   -1.220736948198998e-01   +1.173769255159622e-02   +1.557374267606524e-01; -1.572776480242106e-01   -5.695652371690032e-02   +4.698759993378020e-02   +9.476734438548878e-03   -8.199472480466902e-02   -2.664812845964368e-01   -1.272001505828929e-01   -1.013181703218725e-01   -2.553893113595930e-01   +3.380529724337235e-02   -1.646884863638627e-01   +6.746252693577953e-02   -1.293949245116447e-01   +1.697655966434781e-01   +3.366945373528163e-01   -2.235963374470987e-01; -1.058447638806340e-01   -8.438502046797636e-02   +1.622922588273769e-01   -2.194098730845838e-01   -1.420131735666937e-01   +1.141783620429466e-01   +3.097886560897508e-01   -2.703562605550462e-02   -1.379875291294858e-01   +7.433218070679537e-02   -2.411809056912191e-01   +3.170638800840625e-01   +6.306109009559219e-03   +2.076726579536191e-01   +2.387562117825675e-02   -2.119131995191268e-01; +2.661135328752222e-01   -4.079013837106420e-02   +1.200219460765818e-01   +7.449409141423974e-02   +1.634601657631881e-01   +4.243597044195829e-02   +3.586132060228971e-02   +2.378005907938389e-01   -2.414046085195783e-01   +8.966549317101460e-02   +1.983362278714196e-01   +2.291750940268052e-01   -2.479042084357243e-02   +2.220781030970243e-02   +4.409529959938494e-02   +3.794024282306941e-01; -2.377199393978680e-01   -9.283663537281106e-03   +3.092853992456135e-02   -2.680883846592576e-01   -2.177624163009022e-01   -1.377335639297451e-01   +1.988437510635127e-01   +5.508984601152087e-02   -1.863808701928059e-01   +3.345365460156252e-01   +2.863855135643095e-01   +1.729229836845519e-01   +1.525198087932988e-01   -5.370176442550752e-02   +1.795662752777526e-01   +9.146841238218437e-02; -4.945985831211611e-02   -3.982019995700482e-01   -1.768293299884738e-01   -2.278984186014251e-01   +3.325446612676457e-01   -1.333425103179729e-01   +1.435518545265920e-01   -3.429927032103189e-02   -7.207010453320291e-02   -1.085375895807313e-01   +1.572808002117964e-01   -2.906312275216308e-02   +1.068730784672937e-01   +7.554998905947581e-02   -2.364606424489908e-01   +1.387535903295874e-02; -5.055304732950924e-02   -1.191835921244155e-01   +9.511424365287774e-02   +6.034244789170581e-02   +1.978194037338905e-02   +1.123775664248216e-01   -2.796506385298275e-01   +2.506935314519440e-01   +1.798901607469287e-01   +3.491785679525101e-01   +3.377453618194622e-01   +3.575280565469957e-02   -4.319325363875348e-02   -2.392665780629829e-01   +4.335571848132147e-02   -4.003180930888823e-01];
L2I_L2E_iAMPA_netcon = [+3.524699672888489e-01   -1.514953077356290e-01   +2.501153849874899e-01   +7.146281827071363e-02   +2.354893294291999e-01   -7.153795034003443e-02   -1.624305667049450e-01   -1.541101480378699e-01; -2.300813417045073e-01   +2.761123474220774e-01   +1.687301601055571e-01   -6.309318208241080e-02   +7.523629653240055e-03   +1.525059825151207e-01   +1.338058781752101e-01   +1.790930662000631e-01; +3.944609692883150e-01   +1.919942189396231e-01   -4.051046012825902e-01   -8.943565469138043e-02   +6.172754857663441e-02   +2.288426667643589e-02   -1.918594009114616e-02   -1.612495788408141e-01; +7.895928436108215e-03   +1.599991325900348e-01   -2.182426774748268e-01   -5.696504137527342e-02   -1.976511816943246e-01   +1.142170582428879e-01   -1.661899157876199e-01   +2.274696679970402e-01; -3.601096041112632e-01   -3.557679418912706e-01   -3.758674281342078e-03   +2.828962065532548e-01   +3.380298461173541e-01   -2.560069352490212e-01   -9.390091613771098e-02   -2.573908190271527e-01; -3.220484139913508e-01   +4.166352685587606e-02   +1.705801369385010e-01   +3.710172022639735e-02   +1.918542482112109e-01   +3.651504558231786e-02   +3.203580830531704e-01   -4.340771542919700e-01; -3.444710331329525e-01   -2.349524345210496e-01   -1.036032963953453e-01   -1.507274551906727e-01   +1.142396294981207e-01   -1.079588013109097e-01   -2.163583706990806e-01   -4.880915486472069e-02; -1.026268863056165e-01   -2.714863333240132e-01   -1.604783260284541e-01   +2.729302618102538e-01   +1.669693060584595e-01   -2.906736971255280e-02   -2.787206808911528e-01   +2.114748708209873e-01];
L2E_L2I_iGABA_netcon = [-8.991062413294781e-02   -1.953948617021840e-01   -6.730998560032712e-02   +3.060789776970000e-01   +2.039533157289898e-01   -1.249254428833428e-01   +2.150778547342114e-01   -1.161705361134513e-01; +1.228103482484807e-01   +2.185141697024434e-01   -1.297349231137370e-01   -5.194599522441467e-02   +3.276722314605952e-02   +1.579964594927472e-01   -2.629789903667804e-02   -1.385720168939304e-01; +3.951214014672508e-02   -2.459631890532496e-02   +3.830944508204885e-02   +1.175624068009231e-01   +1.097652542074027e-01   -4.374720160043390e-02   -3.003780126833045e-01   -1.137301542032210e-01; -1.659710129042739e-01   +1.763345172654063e-02   -1.646833653310898e-01   -1.618335651053832e-01   -1.886855649477886e-01   +1.573382304988969e-01   -3.948089688636712e-01   +2.204262171096521e-01; -4.754328282192685e-02   +5.604978507285265e-02   +1.238502131462664e-01   -1.583109338984430e-01   +1.710555646664590e-01   +6.288698203008061e-02   -6.480838624952086e-03   +1.431275722986088e-01; -4.856098537273054e-02   -1.924179107700081e-01   +2.858500023506572e-01   -1.297853432935165e-01   +2.545483084804644e-01   +2.345709693110479e-01   -1.342603785985425e-01   -1.480459708191982e-01; -1.341281820916163e-01   +1.230190186541471e-01   +2.385002767652851e-01   -1.441449540608741e-01   +2.794500911717733e-01   -2.094429749001884e-01   -2.353803426536977e-02   -2.687546661417375e-01; +1.699595070652899e-01   +4.729355227465209e-02   +3.476206541713643e-01   +2.595221544578935e-01   +1.277341086887562e-02   +1.247616105302529e-01   -1.252028638985290e-01   -2.438503027833516e-02];
L3E_L2E_iAMPA_netcon = [+1.875859403524907e-01   -2.532226780793922e-01   +3.532285552711172e-01   +2.662463323191618e-01   -1.248379172809516e-01   -1.511809545409433e-01   -1.703060962872045e-01   +2.285555635582507e-01   +1.675211779464468e-01   -8.746104256920308e-02   +3.812203939884218e-01   -7.976938205450598e-02; +9.498103662934305e-02   -2.827650771668465e-01   +1.827420013100369e-01   +2.930798756796020e-03   -1.108176271564646e-01   +3.759511574182366e-01   -3.139652809969311e-01   -1.341839260762210e-01   -2.142851347978481e-01   -7.975419291146332e-02   +5.413969457390110e-04   +1.853661365153801e-01; -1.636359090933828e-01   -1.437800296801185e-02   +2.535277781476091e-01   +2.440342353611538e-01   +1.790635856429225e-01   +2.036043846325597e-01   +3.106025696516302e-01   -1.189818064240281e-01   -2.947916275441446e-01   +5.129246115125810e-02   +1.802077701049065e-01   +7.306646234588818e-02; +2.895720639865988e-01   -1.400155850752008e-01   -2.509531796634991e-01   +4.237951884972304e-02   -6.613704310013614e-02   -3.996333454149666e-02   -9.864192853548932e-02   +9.183600537956166e-03   +8.398645125330538e-02   -1.757961730922285e-02   -2.667610229577929e-01   +1.716323920116825e-01; -1.197057473992014e-01   +4.772140045278895e-01   -1.746597543728641e-01   +2.004774612225687e-01   +6.587406448543062e-02   -8.511481637110944e-02   +1.371443584822165e-01   +1.046556010645409e-01   +2.139653357503316e-01   +3.378727537569154e-01   +3.045045895132967e-01   +1.052660974767985e-01; -9.408653902152661e-02   -1.117163972722119e-01   +1.109332541786950e-01   +1.543126697160225e-01   +4.054895469145325e-01   +1.907465489152287e-01   +8.055052245110447e-02   -4.591778582132858e-02   +5.748943361051798e-02   -1.840156451446453e-02   +1.078720920004173e-01   +3.591159595696267e-03; +2.943933730028911e-01   -1.521761128527024e-01   +1.006459757792409e-01   -7.572552558937531e-02   -5.090171002616040e-02   +7.418719195716832e-02   -2.304076228066376e-01   -6.448009613014327e-02   -1.135893992707794e-01   -7.112418049407204e-02   -6.882826225421525e-02   +1.712529638780926e-01; -1.028034645338060e-01   +1.510301242178601e-02   +3.604278519864412e-02   -3.371096576072322e-01   +8.416248598733118e-02   -4.751002256844549e-01   +1.880618326375980e-01   +2.002406462230237e-01   -1.978841390373451e-02   +1.882376498248702e-01   -1.250188645602341e-01   -9.274576981573973e-02];
L3I_L2I_iGABA_netcon = [+2.930820213823243e-01   -2.599647418366043e-01   +2.741721845516981e-01   -1.647128994708574e-01   +1.005652891177003e-01   +1.620912068375004e-01   +4.168052753277329e-01   +2.348398973699841e-02   -7.742551372126719e-02   +1.295100080002133e-01   +4.677421433463491e-01   +6.754422192700671e-02; +3.164043643954350e-01   -4.563968133132099e-01   +9.198616721083491e-02   +8.325684962046614e-02   +3.069162021427013e-03   -6.892797435113160e-03   +2.023389369999722e-01   -1.616029341816856e-01   +1.724119187865507e-01   -2.236812118564655e-01   -4.985762971983351e-02   +2.063733206168662e-01; +1.913646547302425e-01   -3.040960166936997e-01   +2.691711242279259e-01   +5.778612842406115e-02   +1.052314752769008e-01   +7.522022277246414e-02   -2.697207606989363e-02   +2.451962192915219e-02   +4.098488717823318e-01   -3.213602849929667e-01   +6.414833269881223e-02   +6.262067248450932e-02; -9.901932644709564e-02   -2.928004865777844e-02   +8.604378153614556e-02   -3.889689176355927e-01   +3.773933687063818e-01   +1.507041750657120e-01   -2.980862574826623e-01   +2.876678432719601e-01   -1.045075782008791e-01   +1.221273959266082e-01   -2.669020887790765e-01   -2.711735308159834e-01; +3.704819883367567e-02   -1.782921924601878e-01   -2.291832527712795e-01   -2.246976954550079e-01   -1.983010377222238e-01   +1.680022918513569e-02   +3.835327294394770e-01   +1.635096974802645e-02   -8.402319038216349e-02   -1.165902336692907e-01   -5.053152483336204e-02   -9.037254965739856e-02; -3.083239276764267e-01   -1.943352933649804e-01   -8.566326889159281e-02   +1.357746996619786e-01   -2.548280310734981e-01   -2.562648799693383e-01   +1.273348259292170e-01   +3.476533412430746e-01   -1.834689109527086e-01   +1.205252189045249e-01   +5.786874428977345e-02   +6.509879895690888e-02; +1.775162154598915e-01   +2.412200241221507e-02   +1.650117991400843e-01   +8.362140186888112e-02   +2.264187667950547e-01   +4.466319606690985e-02   -5.267539226734085e-02   -2.056773118056068e-01   +1.443279430768295e-01   +2.952416193302846e-01   -1.840909832403191e-01   -2.756569076563426e-01; -3.164329190658247e-01   +6.036293279290100e-02   -1.054704164903400e-03   -1.431399299050156e-01   -1.284171873815996e-01   -1.796038415502049e-01   -1.149251084561897e-01   -1.328589374595836e-01   +1.526145573355049e-01   +4.031361593591035e-02   +3.651039407454741e-02   +1.865312987514698e-01];
L2E_L3E_iAMPA_netcon = [-1.156022447473533e-01   -2.682545641388842e-01   -3.320892141781989e-01   +3.599091681827817e-01   +1.850484321685242e-01   +2.102693610628032e-01   -9.167651505224719e-02   -8.004500573357068e-02; -1.438189390850658e-01   +2.591193468389935e-02   -1.879421211008785e-01   -7.213095275241824e-02   +1.079833332874313e-01   -2.574347774573671e-01   -6.716800045336169e-02   -5.404856345496124e-02; +3.174358995755454e-01   -5.014527611411035e-02   -1.508982217089692e-01   -5.119883156007946e-02   +3.172085450627337e-01   -3.119095808318770e-01   -1.928394343723344e-01   +1.097121033993737e-01; -1.788342548465046e-01   +1.404890515618018e-01   +1.021676281740683e-01   +1.604964942264684e-01   +1.237135986704850e-01   -2.656688618729617e-01   +2.531202093942517e-02   +3.203003278724104e-01; +8.486903822288981e-02   -9.063042641487541e-02   +2.814349555885236e-01   +2.183325515987904e-01   -1.487186795984367e-01   -1.801672853515517e-01   +1.790462259500528e-01   +3.157955272009112e-01; -3.091248429289805e-01   +1.862157287680050e-01   -3.509011349302493e-03   -3.204211549083843e-01   +2.202760430484337e-01   -3.482445458106473e-02   +8.075034560938919e-02   +6.758201919055723e-02; +4.215434095327206e-02   +1.051170792075850e-01   -2.098659591153105e-01   +1.019240178051452e-01   +8.981833304704086e-02   +1.866808585349632e-01   -8.167589184565785e-02   -3.058549099523686e-01; +7.625912335308985e-02   -4.033688174156620e-01   +6.148325171865258e-02   -2.109715674944546e-01   -8.333778818329944e-02   -1.203796682712029e-01   +6.372696497670252e-02   -1.205958638213640e-02; -1.877273698245435e-02   -5.501302073983283e-02   +2.738423625152042e-02   +1.803795603898338e-01   +4.669395538463526e-01   +1.050673007820101e-01   +2.577934855667870e-01   +1.464117209146925e-01; -2.783718685101331e-01   -9.881072330621066e-02   +1.543032183340756e-01   +3.809503908920712e-01   +3.560932964242466e-01   +1.254342432576085e-01   +2.071825394255453e-01   +1.350227401783148e-01; -1.844927878880233e-01   -3.312917493375588e-01   -2.050794278992653e-01   +1.027121135699059e-01   -9.824853733033942e-02   +1.832632544694573e-01   +2.029851712636431e-02   -1.361698178913129e-02; -2.610059864941592e-02   +2.381406017550382e-01   +2.375477080870453e-02   -1.801488815788275e-01   +2.426559763256425e-02   -1.127135925002681e-01   -1.455461299042143e-01   +2.222027214428230e-01];
L2I_L3I_iGABA_netcon = [-1.871091396542391e-01   -2.999021681398109e-02   +1.788840496138254e-01   +3.367820807929277e-02   +1.496041620252679e-01   -6.877858332360501e-02   -2.964137536776361e-02   -2.597339649473716e-01; -3.668255400122419e-01   -1.088012908475926e-01   +8.674423411479898e-02   -4.691276692831568e-02   +3.324985494149521e-02   +2.097643473266986e-01   -1.688900479955449e-01   +1.807323806806427e-04; +2.535617325833828e-01   +9.089743894933761e-02   -2.171169085695402e-01   +1.511809250053823e-01   -4.557959891747954e-03   +3.814419431119821e-02   +1.220154748293770e-01   +9.814570302320111e-02; +9.159871415531280e-03   -1.616549525772131e-01   +1.866084586972153e-01   -2.528775211337198e-01   +1.116362475081809e-01   -8.546504446334027e-02   -3.476172066434458e-01   +1.862928687244756e-01; +1.861991648534458e-02   -1.229943422487447e-01   +3.396644726334639e-01   -2.992138016294874e-01   +1.249504097854495e-01   +3.064816016521562e-01   +5.301786794379117e-02   -1.327920517341985e-02; -4.401335571077736e-02   -1.911195208343142e-02   -1.582682366115925e-01   -4.209159368669337e-02   -2.665412776605310e-02   -1.614976248430427e-01   -3.157905039922981e-01   -2.918255003095597e-01; -1.064775616707367e-01   +2.333694827011114e-02   -1.437425424292885e-01   +1.393650705459573e-01   +1.084467690750956e-01   +2.880461399287180e-01   -1.336883627043861e-01   +1.617965800555008e-01; -4.817343869644121e-02   +2.406394725380432e-01   +7.772890812976380e-02   +1.249984721504932e-01   -3.050953643676197e-01   +2.838610560294577e-01   +2.374964069434866e-01   +1.646222047457483e-01; -3.419660404303088e-02   -2.563215237192012e-01   -6.698278106691227e-03   +3.633869569453427e-01   +6.027227015061383e-02   +7.997303388583513e-02   +5.057483777540185e-02   +2.498322137180536e-01; +1.704390964064684e-01   -2.166917458567598e-01   +3.638070745281661e-01   +1.407405858947712e-01   -1.225585288987109e-02   -2.032508910709120e-01   -1.018566321880962e-01   -4.188050922159474e-02; -2.205824584822998e-01   +4.040049632227580e-03   -5.025076441756318e-02   -3.286095822384034e-02   +1.018742406873086e-01   +2.303068904467086e-01   +3.476066807250322e-01   +4.172736017943511e-01; +1.792472361812879e-02   +1.220056417043319e-01   -1.756029430629376e-02   -1.422450429970800e-01   +3.439605337494473e-02   -1.061989946308798e-01   +3.760503222299399e-01   -3.689220608650887e-01];
L3I_L3E_iAMPA_netcon = [+2.232076373383970e-01   -5.930115961923446e-02   +3.205063160086943e-01   +1.685699798099605e-01   -3.428916163402231e-01   -1.276508792381928e-01   -3.053798078753033e-01   +2.356208766345075e-01   -3.074747900261169e-01   -2.329794112834312e-01   +2.474336434176976e-01   -1.033203805903952e-01; +9.553966939414871e-02   -2.046758012596400e-02   -2.596749362853523e-01   -2.475424237962113e-01   +8.080181161932405e-02   -8.706505258728656e-02   -2.509087802958489e-02   +2.105278938905345e-01   +6.823831358084768e-02   -5.543708243512704e-03   +5.312164370032044e-01   +3.445693333277640e-01; -3.107144308895911e-01   -2.525156768563902e-01   +2.320503367982628e-01   +2.323210591685444e-01   +3.741170689175490e-03   -2.278091694644180e-01   +8.877845033618574e-02   +1.680329424920932e-01   +1.769406664698227e-01   +7.941289857653171e-02   +5.564855495968753e-02   -1.378864606960040e-01; -1.124126530220667e-01   -1.803489257006573e-01   -2.372247401833189e-01   -2.146495680273469e-01   -3.235823705018745e-01   -2.121541767163366e-01   -1.585855980659540e-01   +2.965389726773023e-02   -1.838990877701234e-02   -7.038143081917941e-02   +1.535669518463192e-02   +1.798369564130142e-01; -1.272687111118889e-01   +1.707933061275291e-01   +1.162391951759273e-01   +1.928232157660279e-01   +2.419923564496159e-01   -3.545991484398395e-01   +3.953596744085382e-02   -9.021495736433302e-02   +2.531081191896777e-01   +7.898992305511821e-02   -2.457262883034372e-01   +1.123361963089493e-01; +1.561446371929110e-01   +3.457106959591191e-02   -3.596114325586197e-01   +1.375657225793002e-01   -2.739706029185613e-01   +1.340142282444359e-01   -9.442986621791219e-02   +4.717503413122152e-02   -5.423664954215450e-03   -1.526946102156264e-01   -1.280679173011263e-01   +1.952144404416244e-01; -5.920696967290717e-02   +2.935773871397320e-01   +2.009680754531346e-01   -1.013323862134406e-01   -1.159778575715524e-01   -1.203496169235957e-02   -4.484467016654849e-02   +1.057062835485379e-01   +1.416677567677226e-01   -1.159746880979522e-01   +7.484541748048182e-02   -5.250977193247941e-01; +4.180785980949552e-02   -6.209716462421855e-02   +7.259978173791699e-02   -6.939628927701993e-02   -1.892536613229577e-01   -3.390151920237819e-02   -2.982395432685594e-01   -2.622947461329527e-01   -1.561057165386954e-01   -1.051103721039316e-01   +6.824086188085270e-03   +5.149438106850832e-02; -1.984648635961454e-01   -9.112120802060841e-02   +8.336514914010804e-02   +4.338806681704974e-02   -3.282007854402292e-01   +8.132520093549588e-02   +1.585933464127616e-01   -2.450202059111183e-01   +1.627831199731792e-01   -2.372360226932114e-01   -2.006190865691946e-01   -6.561427721637306e-02; +4.634231123670496e-02   -3.716576965504728e-02   -1.364475300881782e-02   +3.170282337324737e-01   -1.400869300222858e-01   -1.337054790334082e-01   -1.810146494281475e-01   +1.293105423846773e-01   +4.488325096676013e-02   +2.315031019138480e-01   -4.388025041411452e-02   +8.997112929984319e-02; +1.223460552748822e-01   -1.961118498946677e-01   -1.767180855539755e-01   -7.525028228695418e-02   +1.833601606843557e-01   -3.243341657940167e-02   -3.441375443220918e-02   +7.160582630552648e-02   -1.910244451116941e-03   +1.672366452452617e-01   +1.712612621589639e-01   -1.377657808048696e-01; -3.191582726009794e-02   -1.022522573524175e-01   -2.798027239063160e-01   +3.536765849381970e-01   -6.381581915681248e-02   +6.116817736001189e-02   +1.249727230918149e-02   -2.672680925601408e-01   -1.695941650832609e-01   -2.777812928675720e-01   +1.887316194754076e-01   -2.305173314970382e-01];
L3E_L3I_iGABA_netcon = [+2.977289707501535e-01   -2.058078269421157e-01   +2.612103368039360e-01   -5.245238193685055e-02   -3.194829757455439e-01   -3.292125443483858e-01   -1.034025908020811e-01   +1.932831666463153e-02   +2.182519938828841e-01   -2.288812532249650e-02   +2.296846959080648e-01   +1.867808387298254e-01; -2.376062425720760e-01   -2.785908356458707e-01   +1.180668391981466e-01   -2.889320911760808e-02   -2.267682140822835e-01   +1.768503715608295e-01   +1.077911830420814e-01   +2.198427297520585e-01   -1.377122967977796e-01   -3.853437718754610e-01   +8.628959431632643e-02   -8.311883947568134e-03; +2.020136963498628e-01   -1.318252978173083e-01   +6.521645659998891e-02   -1.560145712566542e-01   -1.562634600713934e-01   +3.794942774503604e-01   -1.460583572666495e-02   -1.613184703136956e-01   -1.435063818869200e-02   +7.356100196279229e-02   +1.279031037458792e-01   -1.790935537137701e-01; +4.280385644435428e-02   +1.628034734269641e-01   +2.618200918378522e-01   +1.525727236388812e-01   -2.116633481385689e-02   -3.517254049036833e-01   +3.448263056418918e-01   +2.886789363873749e-01   +3.535610508148793e-02   -1.658391015181875e-01   +2.479992150966859e-01   +5.002785335956300e-02; +6.468281310189286e-02   +7.992750034591431e-02   -2.386277020909155e-01   -2.249050957381786e-01   -2.577502548588613e-01   +2.659852490941182e-01   -2.468588921429323e-01   -2.205431100463323e-02   +3.602147750428373e-01   +8.497770873140936e-02   +1.222302685060537e-01   -6.665283533316013e-02; -9.411432861734387e-02   +1.934071604253175e-01   +1.645110914965073e-01   +2.490544444037562e-01   +2.196097805099874e-01   +2.053592537036675e-01   -9.485776054472275e-03   +1.148040789842205e-01   -1.045021879418517e-01   +3.102716534024007e-01   +9.398892270870672e-03   +3.399013321601169e-01; +3.223880698733683e-01   -2.638826929598780e-01   +2.958018483893357e-01   -2.605799428127532e-01   -1.099765357754367e-01   -8.169436605669816e-02   +2.539194406669103e-01   -2.525653596611471e-01   +1.339545457264374e-02   -1.325768295983112e-02   -2.765047039093679e-01   -8.797787265683160e-02; -7.994378451024514e-02   -9.603696037110632e-02   -2.964119220143216e-01   +1.259630032417648e-01   -3.185971861224938e-01   +1.469453968420556e-01   +2.314180560033401e-01   +2.100089566917647e-01   -1.189259056985214e-01   -1.365955955963373e-01   -1.388421282250600e-01   +1.099263326607535e-01; -1.359559062391615e-01   -3.017363575081207e-01   -2.745146023751852e-02   +1.189673848157908e-01   +3.359066179725177e-02   +1.381365790417040e-01   -2.322056377001758e-02   +1.749876285859972e-01   -1.983050169472877e-01   +3.358008616698772e-01   +8.473739316109707e-02   -4.694990367515028e-04; -2.366893033396309e-01   +3.559166883183956e-02   +2.180216107982261e-01   +1.540358861290214e-01   -1.915580775724524e-01   -3.340572712676509e-01   -1.031373866199417e-01   +1.064599389164416e-01   -7.425024682564453e-02   -1.862547662910496e-01   -2.683849586235388e-01   +1.322490690563807e-02; -1.490936582948585e-01   -2.613974752544627e-01   +1.391314319653688e-01   +1.674286149666402e-01   -1.146989985536817e-01   -3.465948454925737e-01   +1.387354851120137e-01   -2.036909928967931e-01   -1.771473461882574e-01   +1.371756937753098e-01   -1.178150794938556e-01   -5.617336388572911e-02; +1.541786665427309e-01   -5.733265368603205e-02   -1.323710368521610e-01   +3.830174435999459e-02   -3.215126943497965e-01   +3.243176568609317e-01   -1.305594524696273e-01   -1.659554287071872e-01   +7.887127267848014e-02   -1.690121394616481e-01   -1.655997233038043e-01   +1.209329459052283e-01];
L2E_Input1_iAMPA_netcon = [+1.391780967339597e-01   +1.653536215602116e-01   -4.309721799249398e-02   -1.261568982036396e-01   -3.274472635375564e-01   -1.064672200905584e-02   +2.183521416000747e-01   -2.991191807835200e-02];
L2I_Input2_iAMPA_netcon = [+1.976847802480189e-01   +1.666010709472929e-03   +1.589896372963936e-02   -1.874268807676694e-01   +1.900365757943855e-01   +1.316181204311784e-01   -3.698444367315344e-01   +4.340220493678635e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
