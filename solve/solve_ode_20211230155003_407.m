function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.343277290138305e-01   +9.059265029979396e-03   +9.678035608573981e-03   +2.787290014938597e-01   +1.015012855962090e-02   +4.586938809474610e-02   +1.915342949759724e-01   +2.404745276674576e-01   +1.167467334127242e-01   +7.966471525537222e-02   +2.674302098347573e-02   +6.080240912400169e-02   +2.081270925131763e-01   -1.676221013403043e-02   +1.452401513250960e-01   +1.312399030888191e-01; +2.015173567661684e-02   +1.257714590797204e-01   +2.492540880609410e-01   +2.830815202314128e-01   +1.069706354385804e-01   +3.698289651365799e-02   +1.565717330454816e-01   +1.509456442252026e-01   +3.660534724403902e-02   +3.763842528944267e-02   +2.664889791555047e-01   +2.290219780394944e-01   -6.128089300281398e-02   +6.166490543213593e-02   +1.396159749789912e-01   +3.099235511052961e-02; +2.073708142622648e-01   +4.021875002923630e-02   +2.256163558684064e-02   +1.669659840280537e-01   +1.098344295991203e-01   +6.678722115996208e-02   +1.827988986114408e-01   +2.818160354123441e-01   +6.971748017271261e-03   +2.150108545416992e-01   +2.760410553997875e-02   -9.324994941899931e-02   +7.976823378788220e-02   +2.657173672050441e-01   +7.792928303176037e-02   +2.032779343537760e-02; +1.612385829032588e-01   +2.239671315478045e-01   +5.574979232314876e-02   -7.450066329075888e-02   +4.796142965804828e-02   +1.576831486629671e-01   +1.658834662123692e-01   +2.194608532651616e-01   +1.623807248150619e-01   +2.202364132591471e-01   +2.385022002911909e-02   +8.722374141576089e-02   +2.318049523419159e-03   +2.418698631670341e-02   +2.098941191101338e-01   -1.348541771355079e-03; -4.681376727558900e-02   -1.861628171442360e-02   +1.984348221034075e-01   +1.938867787799094e-01   +1.876398840232637e-01   +5.956945063033130e-02   +1.366789826649493e-01   +5.029849710167989e-02   +7.266731544180462e-02   +2.180224976793456e-01   +9.017453277820131e-02   +1.068460996586505e-01   +1.337616785916170e-01   +1.090877262475698e-01   +1.537049229674131e-01   +7.600525081269055e-02; +6.385570904035608e-02   +2.716861750276047e-01   +1.782434654164990e-01   +7.522227389661516e-02   +2.818290159503481e-01   +4.396410899752758e-02   +6.231436139561229e-02   +1.829450031711267e-01   +2.142264219478730e-01   +2.433142502011672e-01   +2.082850590113140e-01   +1.402911505134584e-01   +2.320990704361715e-01   +8.639555380483872e-02   +2.546351453611647e-01   +2.432031330947665e-01; +2.381014187047009e-01   +8.846255421840364e-02   +6.675750227263882e-02   -3.969225775227270e-02   +2.708888246371249e-01   +9.630968043493017e-04   +7.084503353890731e-02   +1.417111604545664e-01   +5.087733636811867e-02   +1.799992751680911e-01   +9.159243247230764e-02   +1.490133288487704e-01   -1.279957336053372e-03   +2.775842753175167e-01   +7.142144038439850e-02   +3.006081882055435e-01; +1.736704436681231e-01   +1.512861477132771e-01   +2.028847737712318e-01   +1.786572450476991e-01   +1.862140233380334e-01   +1.038555056547447e-01   +2.377969308050619e-01   +3.380850251166510e-02   +1.091127816774400e-01   +1.042951115064345e-01   -7.853126261658563e-02   +4.181994701305140e-02   +1.113649770756902e-01   +6.454923650846707e-02   +1.095080065190671e-01   +1.200185212763596e-01; +2.375168514812991e-01   +2.079840664536541e-01   +7.142087634253798e-02   +2.317514129749418e-01   +8.199689019872422e-02   +9.771250467592250e-02   +2.617151637810645e-01   +1.577216296409572e-01   +2.795038952703100e-01   +2.779396164147719e-01   +1.688332655699941e-01   +1.619148090237208e-01   +2.956702172687846e-01   +1.674634607405240e-01   +2.117868570610741e-01   +2.513439126398456e-01; +2.178488507905455e-01   +2.413878533916516e-05   -3.450430251910799e-02   +9.263229361526600e-02   +9.199928851633982e-02   +1.619611130522758e-01   +2.546891025622545e-02   +8.142180534976308e-02   +1.855596066287951e-01   +2.466703882033285e-01   -1.715234427552556e-02   +1.567396468052397e-01   +1.588699074110533e-01   -1.777473506484835e-02   +3.407047581337952e-02   +9.822766381157901e-02; +1.057100746229863e-01   +7.212654362947531e-02   +8.169303839608652e-02   +1.364199683448249e-01   +2.576847980322804e-01   +1.800198787888963e-01   -1.487160053436854e-02   +7.510851462503298e-02   +9.096959712747968e-02   +2.786801567455400e-01   +1.797288492176735e-01   +9.672893389433471e-02   +1.386822802243156e-01   +2.362680679375939e-01   +2.113752834572288e-01   +1.530323184041351e-01; +1.474339387380075e-01   +1.253149123372611e-01   +4.772805333160962e-02   +3.286850252402412e-01   +7.162629667136139e-02   +1.296663929313265e-01   +1.782302850221722e-01   +2.233755779791387e-01   +4.164509300544273e-02   +8.724155782461522e-02   -4.075730114133789e-02   +8.588776521011421e-02   +2.630502787072569e-01   +2.143359414012447e-01   +2.730469245081637e-02   +5.396219920757596e-02; +3.473501271624357e-02   +1.760415230452405e-01   +7.684299152440045e-02   +6.047600043626510e-02   +1.285831087662309e-01   +1.544597661922546e-01   +2.454013615418295e-01   +1.443177040338976e-01   +9.825820106806642e-02   +1.118631637922377e-01   +2.625167949322236e-01   +1.325161186316019e-01   +1.470606849011778e-01   +2.259088052348006e-01   +1.449345909284271e-01   +7.150812875561427e-02; +8.102548188421284e-02   -4.073963239788315e-02   +2.871809777189438e-02   +6.383209465209898e-02   +1.654134905829260e-01   +2.791669459752374e-01   +2.328626941497833e-01   +1.643177639586519e-01   +1.216516948254734e-02   +1.639164597401422e-01   +5.853177671109673e-02   +2.448863566438851e-01   +1.215082636585306e-01   -7.631448682813726e-03   +1.240471697098448e-01   -2.445572326596560e-03; +2.532758033848858e-01   +7.753046981628804e-02   +2.272010447756486e-01   +5.809412186412709e-02   +2.069102778713671e-01   +1.269090518637458e-01   +1.199469550120863e-02   +1.892667036709030e-01   +3.256642495108497e-01   +1.681755572552379e-01   +2.221931836984268e-01   +1.897043545345071e-01   +4.326966606945431e-02   +2.095198599352892e-01   +2.677210655975986e-01   +1.036197925826557e-01; +1.821262673467621e-01   +2.615058399071069e-02   +2.457036340526606e-01   +1.328021618033177e-01   +8.017253150606150e-02   +6.601514205507615e-02   +2.122287590371684e-01   +5.748847935857308e-02   +4.993345614410809e-02   -1.395988057680532e-02   -4.972518190178081e-02   -1.167795042230779e-02   +2.561143347722360e-01   +9.287398925782109e-02   +1.865277322532193e-01   +1.941455711719509e-01];
L1E_L1I_iGABA_netcon = [+1.139157619949735e-01   +1.752418435987128e-01   +2.472699620029393e-01   +1.015382334934064e-01   +9.658799146439401e-03   +1.084008974532305e-01   +2.366887637250429e-01   +2.892086592339301e-01   +1.918552907351406e-01   +6.166799953211882e-02   +2.643002341128696e-01   +1.579111217344160e-01   +5.916583927986635e-02   +1.214884490925363e-01   -3.955300292940311e-03   +1.573701335967391e-01; +1.538133017615936e-01   +3.085852741352335e-01   +1.096915651562084e-01   +7.771559959847697e-02   +1.940476745604846e-01   +1.192120590543782e-01   +2.794562851525069e-01   +2.035089393545905e-01   +2.018546516968154e-01   +1.288618310433901e-02   +3.269552120728962e-02   +4.195402613272103e-02   +1.343098547400466e-01   +1.806007947466030e-01   +1.021338845470312e-01   +9.436511021966418e-02; +1.264153566019823e-01   +1.256392542420103e-02   +9.719194142780743e-02   +2.149164715492272e-01   -2.886812452564104e-02   -1.923679017512159e-02   +7.210461301777979e-02   +4.299811201228311e-02   +4.689753776950681e-02   +1.615878956691309e-01   +1.642084079522585e-01   +1.232017819573455e-01   -1.402732961992192e-02   +1.262644525886232e-01   +9.461608983691044e-02   +1.264136015753148e-01; +8.492026848134158e-02   +5.517067220753838e-02   +1.948425544939790e-01   +2.013953735177461e-01   +4.335097640056302e-02   +1.730270637353319e-01   +2.439235905571339e-01   +3.058200561190665e-01   +5.340200211031410e-02   +1.444730113963621e-01   +2.072055285511264e-01   +3.015289793131060e-01   +3.499634780009436e-02   +1.746314579013064e-01   +1.736091372895866e-01   +1.688213169432004e-01; +2.878381902759994e-02   +4.873860111840520e-02   +2.625197690260281e-01   +1.668177048538805e-01   +3.167044602332136e-02   +1.517694063250018e-01   +2.747424137622255e-01   -3.066367655350441e-04   +1.424987588970884e-01   +1.466244337720566e-01   +4.455717343420765e-02   +1.217553209757660e-01   +1.592955400879045e-01   +1.463522816904745e-01   +1.332465586329753e-01   +2.739975512031079e-01; +2.168732079835426e-01   +1.794555938714523e-01   +2.375612545686040e-01   +1.428627222978236e-01   +5.597127951363023e-02   +2.546079828389514e-01   +1.583028559366833e-01   -3.119099612098046e-02   +1.679917149367755e-01   +1.967135972307975e-01   -2.070144158808317e-04   +4.781002363668527e-02   +1.535128222249164e-01   +1.863970323464770e-01   +9.854279163455293e-02   -9.734702597304946e-03; -2.946032087604640e-02   +9.532963660001222e-02   -3.780678264594717e-02   +1.569055731720075e-01   +1.964939260842827e-01   +1.729533648662874e-01   +1.527433674814821e-01   +2.445906513129324e-01   +1.135125109395941e-01   +2.314359478559474e-01   +1.376547202930833e-01   +2.432074368112525e-01   +2.062610286348398e-01   +1.644724116555755e-01   +1.220563612774578e-01   +8.503285010641945e-02; +1.835885350081645e-01   +3.887940543932208e-02   +6.199122632395732e-02   +1.079171187646844e-01   +2.190091141376425e-02   +7.584371184944014e-02   +1.640604007466049e-01   +1.103426708846592e-01   +2.290027387866452e-01   +2.641057498787623e-01   +1.749552228967245e-01   +5.916664426493989e-02   +1.065490414790664e-01   +1.455613737744169e-01   +1.281223871061243e-01   +9.021291025822019e-02; +6.199818497634648e-02   +1.574315883951778e-02   +1.844492823365957e-01   +6.426329501346986e-02   +1.360533232132710e-01   +8.628219409695267e-02   +1.382929439735657e-01   +1.657079498698943e-01   +1.945621781478632e-01   +1.197548183307352e-01   +2.117960838650229e-01   +1.536860575193464e-01   +5.266561455672854e-02   +2.637602827251399e-02   +1.278642865478129e-01   +6.320763930021188e-02; +2.169814691004526e-01   +2.913384187066950e-01   +1.840483013239252e-01   +2.418916423028359e-01   +1.050697710502446e-01   +2.041294504145029e-01   +7.811200204447573e-02   +1.852545930553902e-01   +2.561016447457146e-01   +1.213805049020005e-01   +1.117962122691327e-01   +5.764339519244801e-02   +1.632907982382911e-02   +2.747340810074859e-01   +1.620091777430988e-01   +7.702967129251369e-02; +2.509876857358184e-01   +2.718817945572961e-01   +2.205440682319509e-01   +1.061818706405874e-01   +2.733494856771240e-01   +5.306297249569389e-02   +6.220892706422987e-02   +2.385419828149171e-01   +5.680462491355388e-03   +1.144104318776255e-01   +1.167776187562506e-01   -2.315498530776726e-02   +1.531424974066970e-01   +1.817827881202722e-01   +1.939747661538630e-01   +8.700378712123219e-02; +2.333139366164373e-01   +7.440673842531603e-02   +1.998723206872971e-01   +2.044820615262076e-01   +1.290552089293008e-01   -2.489651385196842e-02   -2.033757741094633e-03   +2.322547146067070e-01   +1.646731162179736e-01   +2.166043359454624e-01   +2.317281581073648e-01   +1.882344889238161e-01   +2.843350855984089e-02   +2.491171982039488e-01   +2.252538308720190e-01   +7.392144358207291e-02; +1.215561414627209e-01   +1.097477536418823e-01   +1.588230704686856e-01   +2.715045495540895e-01   +2.573064989769370e-01   +1.452734343326620e-01   +2.025375042619076e-01   -4.902488265062358e-03   +3.046722410663354e-01   +1.266134888431754e-01   +1.825370183140390e-01   +2.945833887753492e-01   +8.027207574351493e-03   -5.661552667592940e-03   +3.045826995180472e-02   +2.262235724886446e-01; +9.329712916384504e-02   -3.129190185717932e-02   +2.451942169620030e-02   +4.933084521568846e-02   +1.271205159351984e-01   -1.860891191216282e-02   +1.520713392251515e-01   +1.962311103121092e-01   +2.264321548582558e-01   +2.569190198717827e-02   +1.350522987329842e-01   +1.111944020373939e-01   +2.674587088885176e-01   +2.039993802989063e-01   +1.989032433035393e-01   -6.473642390483840e-03; +2.337003247043994e-01   +2.283180907432239e-01   +3.445340966321151e-01   +1.460272836259686e-01   +1.774515436110451e-01   +1.403463545424355e-01   +2.164433348438543e-01   +1.524806448558682e-01   +1.327867130306071e-01   +1.986828486103140e-01   +4.123805338809244e-02   +3.880730535647126e-04   +1.652956987532631e-02   +3.604482845114679e-02   +1.243476981820637e-01   +1.284367076405431e-01; -1.207020429341846e-02   +3.420320935150590e-02   +1.747562442443346e-01   +1.243501679148671e-01   +2.092939812029418e-01   +2.216461418739482e-01   +2.907052183063070e-01   +8.762857431138041e-02   +2.585697128221801e-01   +5.268588291486210e-02   +2.226940363913306e-01   +2.426681486667137e-01   +5.297496912769467e-02   +2.249038329354184e-01   +6.300554369463236e-02   +1.325451358199895e-01];
L2I_L1I_iGABA_netcon = [+4.933536918645588e-02   +1.943583479343914e-01   +6.559137324612942e-02   +3.606663797434943e-02   +6.741822557985123e-02   +1.705375802501645e-01   +5.453271145231385e-02   +1.961802411182652e-01; +1.587353838015879e-01   +7.073338625943756e-02   +2.454799066641940e-01   +7.180401919348615e-02   +7.190840028659690e-02   +1.453633790725117e-01   +1.622705763669138e-01   +6.099773579415591e-02; +2.224616414448029e-02   +5.989106655079668e-02   +2.168569553338187e-01   +2.550870989148820e-01   +5.859793987993885e-02   +1.379274486288636e-02   +1.656339024901602e-01   -2.635245883869585e-02; +1.828064856547005e-01   -2.063394399536582e-02   +7.796517290407036e-02   +2.530352567999318e-01   +1.172757937167378e-01   +2.231142786985657e-02   +5.959636540722030e-02   +1.787795706292017e-01; +2.458275384470797e-01   +1.044480915335326e-01   +9.928044285687103e-02   +1.206880165490872e-01   +3.077045863769918e-01   +2.686812879912666e-01   +2.426036132904030e-01   +2.224134778985323e-01; +2.613504812758149e-01   -3.153988668652161e-02   +3.319265146281518e-02   -2.361355149516322e-02   +2.901534726019683e-01   +1.086827103090916e-01   +1.142260305836904e-01   +1.578033165875416e-01; +1.544905820822214e-01   +2.390351282411412e-02   +2.782283733459565e-01   +1.018818836749913e-01   +9.333016227006551e-02   +1.388612088451820e-01   +1.508336591591098e-01   +1.174117373895209e-01; +1.314079839925522e-01   +3.646144164889336e-02   +2.653344568746456e-01   +2.564119151325209e-02   +6.926853804931349e-02   +1.672213974678222e-02   +1.487879259115185e-01   +8.786486462926194e-02; +2.466029387838085e-01   +1.487166986696751e-01   +1.578023595204265e-01   +1.668443893336660e-02   +1.230037327059453e-01   +2.814680039668218e-01   +2.015450367671826e-01   +6.342341408118071e-02; +8.912845472768374e-03   +8.523989834479874e-02   +1.814053901968705e-01   +9.138609549227036e-02   +1.488019188063974e-01   +1.002890687978306e-01   +1.493485610678915e-01   -9.971206840339675e-02; +2.005704585198157e-01   +2.950120024128791e-01   +2.427781612917312e-02   +2.011212321065934e-01   -1.804299893419101e-02   +1.279688632668555e-01   +2.321820022305071e-01   +2.552044661836680e-01; +2.379243745993243e-01   +2.751652829420093e-01   +5.040585945136501e-02   +1.900543556233394e-01   +2.154509252711387e-01   +8.657467229599781e-02   +9.994564459940442e-02   +1.866252554426936e-01; +1.982342610429021e-01   +2.256895918649426e-01   +1.780350410559672e-01   +2.867124965770238e-01   +9.237242732692208e-02   +1.396688064742654e-01   +8.396814074578899e-03   +1.365366887869458e-01; +1.530115139770806e-01   +2.750756573236763e-01   +2.825082381740795e-01   +1.802462573721276e-01   +2.224827678185771e-01   +2.826789155221579e-01   +2.205297394610815e-02   +8.299885662433323e-02; +1.396831337732370e-01   +1.962011382029148e-01   +1.854758345521791e-01   +1.447033136557683e-01   +7.274149450761233e-03   +7.311529210969818e-02   +9.316192914789465e-02   +1.267913290657400e-01; +2.590148723626656e-02   +2.391043266214840e-01   +9.856041766421061e-02   +2.530534408572365e-01   +2.237995217880321e-01   +4.473768885803616e-02   +2.243740722840927e-01   +5.578467365674433e-02];
L1I_L2I_iGABA_netcon = [-8.428066798303862e-03   +2.712299788431965e-01   -1.114303588410084e-02   +1.870602258961962e-01   +2.852283470561730e-01   +2.054952968997021e-02   +1.602891670588690e-01   +1.208150765562986e-01   +6.816882429522977e-02   -3.808561456156632e-02   +9.396318008617559e-02   +9.371129216174626e-02   +2.031906331923008e-01   +1.535107994875117e-01   +1.943662079470417e-01   +8.366483258895392e-02; +1.027804293135414e-01   +3.160806690051605e-01   +1.142448804445591e-01   +5.797658221002187e-03   +2.656816622615079e-01   +1.255078650376029e-01   +1.784905414911217e-01   +2.387731364138952e-01   +8.861653052469748e-02   +1.165575095823520e-02   +2.148195521927545e-01   +1.873508786669351e-01   +1.351938088562133e-01   +5.969231324950686e-02   +1.782774419819955e-01   +2.529653267325533e-01; +1.671227894018314e-01   +7.622872631760000e-02   +2.255327465864368e-01   +1.722648634433786e-01   +7.262150191588326e-02   +6.069541100631624e-02   -1.414328481123099e-02   +5.825258349264889e-02   +1.724764241295052e-01   +4.439832587646265e-02   +2.138835747904265e-01   +1.070278086089469e-01   +1.102774215969501e-01   +4.216522225545341e-02   +1.545492041563775e-01   +2.240443027874352e-01; +1.731701385941774e-01   +2.326602622735890e-01   +1.061937067389889e-01   +1.166806229080625e-01   +2.252112048617243e-02   +1.460288724181376e-01   +8.589546249995485e-02   +2.374980684319966e-01   +9.858712462955328e-02   +1.841508757654801e-01   +4.184325438879064e-02   +1.801945413879369e-01   +3.840934146152453e-02   +2.171983197144028e-01   +1.451172893427198e-01   +1.429650801937994e-01; +1.044921981003299e-01   +9.362737949410707e-03   +3.309038904544250e-01   +7.542912754725919e-03   +1.977567863513807e-01   +2.098221263665574e-01   +2.299031126378262e-02   +1.431595994355142e-01   +1.514514330665580e-01   +2.175265861149427e-02   +1.460533734389547e-01   +2.968305207811192e-02   +1.980789396744808e-01   +6.593426229272760e-02   +1.428896922389105e-01   +8.777231691130527e-02; +2.097388853072261e-02   +1.576322673853174e-01   +2.085582437559465e-02   +2.121745355058489e-01   -4.332652801556178e-02   +3.056441603417846e-01   +2.550649414555579e-01   +8.931254536535424e-02   +1.271640917909224e-01   +6.850308605565466e-03   +2.730619229142596e-01   +1.545825781195704e-01   +1.525065450194905e-01   +1.531776674314015e-01   +1.245363477435794e-01   +2.155008892360840e-01; +1.808891390972790e-02   +9.841410987578590e-03   +2.123958489082997e-01   -3.529395303743815e-02   +1.341044776477976e-01   +5.523888558951284e-02   +2.321868988185750e-01   +1.906667827491061e-01   +2.171197276659519e-01   +2.076417710461560e-01   +9.998588824235974e-02   +1.984348284285768e-01   +1.329299398500983e-01   +5.589034502384269e-02   +2.951117113694001e-01   +2.325036490331858e-01; +1.299316925316676e-01   +1.618465346667366e-01   +2.656647232172999e-01   +1.135479996452008e-01   +6.887238422291948e-02   +1.460432011658476e-01   +4.914301234630392e-02   +2.876032226177857e-01   +3.487178558045960e-01   +7.066611866929030e-02   +1.479829595484095e-01   +3.952052531230339e-02   +1.609008469847230e-01   +1.515773014875121e-01   +2.439319862846679e-01   +1.737322993720530e-01];
L2E_L1E_iAMPA_netcon = [+2.002755674137101e-01   +1.313446274995231e-01   +4.782609624750277e-02   +1.664032883581068e-01   +2.823921367045400e-02   +5.940057908025673e-02   +1.599950359407769e-01   +1.037665396824383e-01; +2.330586608259852e-01   +7.552383754464213e-02   +2.387434611808276e-01   +1.183263149818104e-01   +2.381502716862358e-02   +1.129916868457774e-01   +7.794845435195982e-02   +2.411535099508609e-02; +1.198287113978526e-01   +1.941230581855020e-01   +1.523233477283928e-01   +1.122323396763954e-01   +3.065104804692816e-01   +9.998401353999754e-02   +1.112358578610345e-01   +8.634630903263170e-02; +1.474142843539660e-01   +2.165778651167826e-01   +1.980635362060141e-01   +2.870689108840897e-02   +1.626887089411514e-02   +3.218446819575648e-01   +4.020408692402075e-02   +6.099665538224694e-02; +5.901619824175205e-02   +1.065691446741483e-01   +1.191060930033445e-01   +3.010430563372687e-01   +1.908884890605317e-01   +2.326760282159075e-01   +8.705313656615654e-02   +4.345273393985356e-02; +8.984059991331071e-02   +1.065731630107614e-01   +2.615748013810187e-01   +1.172216158830638e-01   +1.079276122744598e-01   +1.357864970016783e-01   +4.058575014272237e-02   +7.916436235923081e-02; -4.842507232732673e-03   +2.141885711711230e-01   +1.931193958282121e-01   +3.242909480682241e-01   +9.707130428225186e-02   +6.031833956655665e-02   -1.152385954595108e-02   +1.562503850473716e-01; -5.667138599476146e-03   +1.287178237675258e-01   +1.998008063440139e-01   -9.076463230819445e-03   +1.333346741943635e-01   +1.333675545334226e-01   +2.423850348761396e-03   +1.307734720095571e-02; +2.436006816069697e-01   +2.007669507265950e-01   +1.994126396528895e-01   +2.338109183707050e-01   +2.115295647765106e-01   +3.387471923194790e-02   -1.858201334698364e-02   +2.644074403823876e-01; +1.496632536955596e-01   +5.891373703829487e-02   +9.165180004230448e-02   +6.874599550253549e-02   -3.475922182752434e-03   +2.451286355442755e-01   +1.464303625990346e-01   +1.295748790163368e-01; +4.810552467282663e-02   +5.554615345909448e-02   +6.716562876525786e-02   -1.074438138553987e-02   +2.394937950656420e-01   +9.340863149311368e-02   +7.689492177909751e-02   +9.617459239670394e-02; +1.372321277660740e-01   +8.451893646744447e-02   +8.109132692585366e-02   +5.790078012676771e-02   +1.228524706159656e-01   +2.871415226031862e-01   +1.952250827678020e-01   +3.894161369625800e-02; +2.258223636067715e-01   +2.563287035458702e-01   +1.374266213187827e-02   +5.295286155458284e-02   +8.783710436549158e-02   +2.374081487948558e-01   +1.426332923256618e-01   +3.259664287590286e-01; +1.092842661211340e-01   +1.143594922003054e-01   +2.528938547531969e-01   +1.112326796181533e-02   -9.914595064902115e-03   +3.940882009992187e-02   +1.996958022108127e-01   -2.223097348246433e-02; +2.036941957778061e-01   +2.721372059179500e-01   +8.076521753542416e-02   +5.324531360130728e-02   +6.008155000015061e-02   +4.453565568694866e-02   -1.497474463469723e-02   +2.475199093423755e-01; +2.064434245919009e-01   -6.884532299898861e-02   +9.120059138898473e-02   +1.615366937019556e-01   +1.959906517459843e-01   +1.809420161044748e-01   +7.879402446402066e-02   +2.921946190005933e-01];
L1E_L2E_iAMPA_netcon = [+9.069616459815981e-02   +1.460088699932109e-01   +1.045538970376375e-01   +3.171000445067778e-02   +4.997163435750523e-02   +1.163316700811385e-01   +8.124333047581769e-02   -5.568779582504818e-02   +1.909821626466633e-02   +2.821149959938758e-01   +2.248197450418677e-01   +2.274533310816390e-01   +1.824893846720828e-01   +2.432412348193032e-01   +7.445702555526385e-03   +6.966287808044200e-02; +2.361825243078164e-01   +2.105902002450347e-02   +2.957359939670417e-02   +1.456386918041743e-01   +1.117137791515347e-01   +4.623890678979853e-02   +1.130661864454488e-01   +1.081587222735065e-01   +2.414520349916431e-01   +1.907672527377197e-01   +7.398414123870968e-02   +2.415464133117485e-01   +9.117165544400718e-02   +1.927269335491327e-01   +7.911644723745416e-02   +9.868610568589649e-02; +1.532142755922429e-01   +9.257928743163196e-02   +7.703721664968304e-02   +8.097859788193694e-02   +2.118575160710834e-01   +1.116732773244030e-01   +1.930637419838785e-01   +1.323322532387504e-01   +1.071522963370221e-01   +1.997125651881720e-01   +2.140609384368685e-01   +9.668536539218041e-02   +7.000092853946376e-02   +1.193045621644584e-01   +1.103905391309133e-01   +1.579231077112035e-01; +2.778290543244353e-01   +2.756295828867730e-01   +1.374842736030507e-02   +1.278218645135021e-01   +1.049441824187492e-01   +1.169676978147605e-01   +1.939655924071359e-01   +5.305777242235459e-02   +8.911608803593243e-02   +1.758011144091701e-01   +1.679601336143555e-01   +1.981516835280716e-01   +1.642351588870385e-01   +2.349067004822590e-01   -5.751936344440858e-02   +6.685547350537553e-02; +6.358962995040965e-02   +7.216560743090467e-02   +1.953380905187407e-02   +1.629556716991236e-01   +1.510296144971671e-01   +2.582165241161263e-01   +1.971148355115008e-01   +9.826040732696474e-02   +8.103470484893664e-02   +2.273145416220272e-01   +2.608153274121283e-01   +1.345716118348808e-01   +1.421068720742701e-01   +1.343761648104454e-01   -8.084246195829489e-02   +1.707626784762910e-01; +1.280262638185309e-01   +2.166226000140101e-01   +2.217901757227603e-01   +1.543670106416475e-01   +1.908995854092072e-01   +6.240898137649600e-02   +1.788787517058859e-01   +1.700543682407226e-02   +1.875166968829326e-01   +1.740920789146657e-01   +1.410640714558150e-01   +1.370802558495870e-01   +2.340534614142240e-01   +9.308396516246803e-02   +7.327895963918538e-02   +2.174380215953714e-01; +1.839990879439019e-01   +1.813515833681585e-01   +2.216473400795506e-01   +1.331945306222816e-01   +1.026357614634949e-01   +1.195661627990201e-01   +7.349100263545498e-02   +6.733671285435711e-02   -3.868637341832067e-03   +1.245443742155699e-01   -4.724888061315063e-02   +2.313274693561121e-01   +1.383419025810608e-01   +2.973392313898002e-01   +3.453502930795127e-02   +1.839273772154804e-02; +1.289997168722760e-01   +2.271938190941364e-01   +2.143743948710729e-01   +1.145765534431091e-01   +8.173746716214132e-02   -7.592385550829955e-03   +2.047503005420310e-01   +1.381154005510581e-03   +1.462476209267239e-01   +2.358046043349465e-01   +1.664451320178646e-01   +8.635398120707978e-02   +2.614248240441409e-01   +1.796874859129357e-02   +1.379417052273030e-01   +1.750353216071236e-01];
L2I_L2E_iAMPA_netcon = [+9.704014627221379e-02   +2.044132419689541e-01   +3.883614015757814e-02   +1.201540836905067e-01   +1.280158258807939e-01   +7.282035786381583e-02   +6.902395545548001e-03   +1.461823532679714e-01; +2.475958944621650e-01   +3.380140856185153e-01   +4.838822740836470e-02   +2.363080174499096e-01   +9.936595423809111e-02   +1.571043447019000e-01   +2.291581689007124e-01   +1.697774337863745e-01; +4.494655752156144e-02   +2.077331357003279e-01   +8.557165908475348e-02   +1.436265771127720e-01   +8.713276127927332e-02   +2.836896034603820e-03   +5.399535534992220e-02   +1.556897176177084e-01; +2.615855330867669e-01   -3.016704927851617e-02   +1.825176699796539e-01   +1.697516109240468e-01   +2.038317816667652e-01   +3.535093947915075e-02   +1.728002394584474e-02   +2.806616696337896e-01; +4.955832419512528e-02   +2.756074351519706e-01   +2.625811128426422e-02   +2.164637612940662e-01   +3.280790594201086e-02   +1.387846530668781e-01   +1.413946436422688e-01   +2.608143713554541e-01; +1.212378880251788e-01   +1.188759667692681e-01   +1.833952347526738e-01   +1.669391753737031e-01   +2.308039603663424e-01   +2.624450038427542e-01   +2.279706076270310e-01   +9.789327923828831e-02; +1.836493557362678e-01   +1.774267779021941e-01   +2.277119563032103e-01   +1.347546576210115e-02   +1.030719034717527e-01   +1.555488745477156e-01   +9.193516943325196e-02   +2.641438042728005e-01; +1.105048585861757e-01   +3.518857590606536e-02   +2.507408772002485e-01   +1.876313344263184e-01   +6.202419971660798e-02   +1.961099344925329e-01   +6.722717100332451e-02   +4.514020908348362e-02];
L2E_L2I_iGABA_netcon = [+2.979900867884865e-02   +2.805155560363392e-01   +2.103251974652556e-01   +1.132159201406069e-01   +3.971119413646361e-02   +1.840541156378619e-01   +1.332097445623620e-01   +1.245621625018201e-01; -2.917630324002009e-02   +5.799771586913072e-02   +1.888718583631550e-01   -1.875302448370999e-02   +1.234081413395597e-02   +1.797232975377585e-01   +1.728829679228198e-01   +9.315290802097968e-02; +1.607213164846252e-01   +1.247116720325705e-01   +2.691427582665797e-01   +1.650295816890371e-01   +3.046283948037217e-02   +2.726759281522181e-02   +2.172132327618179e-01   +1.251751857211986e-01; +2.477356961635283e-01   +1.967739330465469e-01   +5.752764667693532e-02   +2.463644586167756e-01   +1.111959662237446e-01   +6.614952864669037e-02   +1.609238705244131e-02   +1.414067792378694e-01; +1.611373716741008e-01   +2.190867127271217e-01   +1.416103103149259e-01   +4.365387229960407e-02   +3.527625999488878e-02   +1.197958102802789e-01   +2.911166784912524e-01   +2.172976376069592e-01; +1.132925092413329e-01   +1.285091556487144e-01   +2.814621473296565e-01   +3.313629199231255e-02   +4.838601088620201e-02   +1.511948664077791e-01   +1.267658701745064e-01   +8.335736962734795e-02; +6.280989222997359e-02   +7.436995923274700e-02   +2.407136210393859e-01   +2.719397308586313e-01   +2.900180602899693e-02   +2.519146505787048e-01   +1.566069303290220e-01   +2.344988624828079e-01; +2.161311205588141e-01   +2.652723867598404e-01   +7.043119246592472e-02   +2.663057697127271e-01   +1.012797844683181e-01   -2.748114771911014e-02   +2.274565248975197e-02   -3.278804815179586e-02];
L3E_L2E_iAMPA_netcon = [+1.301957353493384e-01   +6.586901721559174e-02   +6.642591391810157e-02   +8.881414352632030e-02   +9.731209771336641e-03   -4.294223093571516e-02   +5.012992562097258e-02   +6.528511570216178e-02   +3.751084943778863e-02   +6.122979161776243e-02   +2.309319925228348e-01   +1.316624125819534e-01; +4.303756443845998e-02   +4.512342383917354e-02   +1.622985754644062e-01   +1.179358518540593e-01   +9.116478357927239e-02   +2.765409978922321e-01   +1.530740552914364e-01   +8.335550220968070e-02   +2.244158460930439e-01   +1.368201920277634e-01   +6.289597771460365e-02   -9.712685748543533e-03; +2.151646518762888e-01   +6.510823002423484e-02   +1.003958957774168e-01   +2.603466531701534e-01   +2.420545948362667e-01   +7.568512012175636e-02   +2.128152901007503e-01   +1.661502996288855e-01   +1.673060724354546e-01   +4.059117357841242e-02   +1.826662007551456e-01   +4.959241317230574e-02; +2.407773049256640e-01   +1.915743244638438e-02   +7.786698133696432e-02   +2.583940421949085e-01   +1.420524184678653e-01   -3.932177205196442e-02   +2.840303675204393e-01   +1.042510260145063e-01   +6.001563382280121e-02   +7.217563602538468e-02   +1.050209074764358e-01   +1.716927939176140e-01; +1.526853026371324e-01   +3.038796537283931e-02   +2.183849233727700e-01   +4.348843396168932e-02   +1.041834767355012e-01   +1.471390841261004e-01   +2.166369466804260e-01   +1.841757265845513e-01   +2.829213642787091e-01   +4.456514922696326e-02   +1.494259414517714e-01   +2.919246733037336e-01; +1.072964867986376e-01   +4.653427744254703e-02   +8.951861566473433e-02   +3.197739586838323e-02   +1.635853042096250e-02   +1.622061906307337e-01   +2.016537294800350e-01   +6.857709155180308e-02   +1.838717818841296e-01   +2.119848026814248e-01   +2.295290102838079e-01   -4.935713150340969e-02; +3.292057214661119e-01   +2.264311419445681e-01   +1.370774680043699e-01   +1.626282113610614e-02   +3.338115653337140e-01   +8.156468313770864e-02   +9.072120542252353e-02   +9.658262804057940e-02   +4.405617046764381e-03   +7.810158798912613e-02   +7.649724655507492e-02   +2.430252238021860e-01; +5.509272260155103e-02   +1.670263541598884e-01   +1.154202447810658e-01   +7.993429267832829e-02   +1.641648169785504e-01   +3.992737077782844e-02   +1.935923131688040e-01   +1.409387472897851e-01   +8.786356921035110e-02   +8.585010505910746e-02   +3.065132353632575e-02   +2.717832436339666e-01];
L3I_L2I_iGABA_netcon = [+1.567388277124020e-01   +8.050276148016428e-02   +2.321806473690338e-01   +1.144073200718611e-01   +1.866622591573758e-01   +2.603119089928481e-01   +1.102058994788508e-01   +1.906129356928018e-01   +7.135854536924556e-02   +5.249542400912411e-02   +7.883069281177918e-02   +1.900496812226339e-01; +2.710372694968002e-01   -5.332492600973864e-03   +1.085706714693458e-01   +1.561624488315042e-01   +2.536607898520752e-01   +1.549488580714341e-01   +6.476982699529245e-02   +1.810420938420781e-01   +3.165814734326025e-01   +1.583276664986032e-01   +2.295465201113611e-01   +2.338778196891603e-01; +1.007072923019930e-01   +9.036701139223402e-02   +1.669055469577525e-01   +2.406723661659770e-01   +2.315995880008778e-01   +1.986660972802882e-01   +2.076576216156555e-01   +8.638621908616315e-02   +2.507489872862180e-01   +2.405279200166775e-01   +9.870638940002206e-02   +3.306932353451071e-01; +2.314633314832013e-01   +1.303993472195289e-02   +1.742733204896549e-01   +1.716289623560235e-01   +2.027965201601905e-01   +2.844819187455547e-02   +3.948075509513634e-02   +2.043539834496189e-02   +7.913462266819750e-02   +1.134107523973141e-01   +4.297137494984333e-02   +1.075819754386096e-01; +1.628392051807237e-01   +2.809143829955965e-01   +4.029123140497692e-02   +1.917490127848339e-01   +2.060609488394926e-01   +1.400568693580672e-01   +3.702359688364041e-02   +1.021102203388413e-01   +1.175338890194318e-01   +1.993791197875724e-01   +6.976394395968867e-02   +1.425576324598658e-01; +2.100703264309023e-01   +2.793212231013654e-01   +1.387603234057134e-01   +1.927533860086086e-01   -5.764274677641610e-02   +1.466648769915325e-01   +1.510910709010144e-01   +1.364822049668822e-01   +1.037665861681188e-01   +6.011265007924067e-02   -5.488717182315701e-02   +2.650076324339621e-01; +6.653075576056258e-02   +1.405723678913291e-01   +1.004234679449428e-01   +2.599203189286085e-01   +1.835215710818883e-01   -2.189646733919616e-03   +2.177820517673118e-01   +1.927481751638860e-01   +2.398615429378598e-01   +1.223547029418065e-01   +7.741393746368666e-02   +3.435337773552453e-02; +7.771312321847816e-02   +1.110735136436157e-01   +7.313727906075766e-02   +8.916792548534365e-02   +2.339400154116611e-01   +3.136185661097373e-01   +1.849293170081611e-01   +3.875361334324599e-02   +1.059908486231194e-01   +1.165120167330327e-01   +8.907133495534343e-02   +2.277661276401757e-01];
L2E_L3E_iAMPA_netcon = [+1.732452049796026e-01   +1.276611578596377e-01   -1.210478345718301e-02   +2.291308064093165e-01   +1.375935406615768e-01   -2.865715002802921e-02   +1.293392486963404e-01   +4.948873564981206e-02; +2.909592959183868e-01   +2.109211571993016e-01   +9.758368790588073e-02   +8.537972934165567e-03   +1.996246857837301e-01   +1.633798766739173e-01   +8.733689264136485e-02   +7.504156614354220e-02; +9.067040648033646e-02   +2.549594665531333e-02   +2.983150557231241e-02   +1.924692215584890e-01   +2.353950740901823e-01   +1.947626284878298e-01   -6.661142217785224e-03   +2.019059749758229e-01; +1.420071175945290e-01   +1.500535230519919e-01   +1.020219400138777e-01   +7.092450212789390e-02   +4.810195037524338e-02   +1.109536402209755e-01   +1.005725725213999e-01   +1.800042818344387e-01; +1.587062089494463e-01   +1.938567723463177e-01   -5.633915235498960e-03   +2.477567385254239e-01   +9.765503545231935e-02   -3.400892373617045e-02   +2.630557749425462e-01   +2.824704575824524e-01; +1.573103746848775e-01   +1.824048119301770e-01   +1.707528363545932e-01   +6.705049723301415e-02   +2.713250167362053e-01   +1.440700978890325e-01   +1.328954069495722e-01   +2.292228029733993e-01; +1.263737087944891e-01   +2.528642511738990e-01   +1.563583729145286e-01   +5.339224147890959e-02   +3.715187605358766e-02   +1.452819290063705e-01   +7.007826564081195e-02   +2.368056140086629e-01; +1.134239746733009e-01   +1.213919658702667e-01   +2.548489774234997e-01   +8.647053448448472e-02   +7.923450365069684e-02   +1.176661225879652e-01   +1.171539216323376e-01   +2.245573093309572e-01; +1.770473733841510e-01   +7.023064265540549e-02   +1.660647856941277e-01   +7.050889998798637e-02   -6.107953666958236e-03   +8.848202568135775e-02   -7.030914539800917e-02   +7.567745056230402e-02; +1.810757818055481e-01   +1.525205925146537e-01   +2.355175984197609e-01   +2.676393369325041e-02   +2.623699653232027e-02   +9.429701325788066e-02   +2.307758127558385e-01   +6.359125782502993e-02; +1.366872596308973e-01   +2.037547182706113e-01   +8.184841290961782e-02   +1.129243108558664e-01   -7.117271240176479e-02   +1.717929819440820e-01   +2.928738652551480e-01   +2.382130334178604e-01; +5.230020893123267e-02   +2.990200155830355e-02   +2.009732947237823e-01   +1.223384226516952e-01   +2.680733060771233e-01   +2.551123568691486e-01   -3.020232568327060e-02   +1.244173306428945e-01];
L2I_L3I_iGABA_netcon = [+1.481444553576715e-01   +1.858303106522284e-01   +1.458038457675389e-01   +1.555975587574032e-01   +2.017265335180574e-01   +1.320749257834770e-01   +1.980914204330882e-01   +9.163048785192575e-02; +1.309314781566470e-01   +6.872977162213331e-02   +6.885791729267544e-02   +8.279049369037565e-02   +4.270190086196101e-02   +1.487125275104007e-01   +2.278500580756369e-01   +2.827446586193721e-01; -1.586922806911345e-02   +2.835042080685309e-01   +2.334610641409450e-01   +6.973023429105431e-02   +1.677496869797278e-01   +7.194637604284132e-02   +2.963040204143113e-01   +2.926320991787165e-01; +1.890266611438559e-01   -1.253667059343220e-02   +1.764047099670409e-01   +8.616689070358470e-02   +9.517199284416722e-02   +1.859339057474095e-01   -5.433541356241052e-02   +8.037228166501034e-02; +2.650704317396086e-01   +1.269424381090856e-01   +8.870386734025440e-02   +1.068941855565712e-01   +8.769543566389326e-02   +2.495272116119610e-01   +1.200948927070637e-01   +3.218799049797435e-01; +1.712569522742267e-01   +1.922638863145456e-01   -7.214996797702806e-02   +2.061760013394794e-01   +2.258838321197340e-01   +1.204617873881390e-01   +1.186743210844771e-01   -6.462569803056777e-02; +1.375802175591620e-01   +6.560836103332823e-02   +2.335847967195621e-01   +2.383954578278734e-01   +3.943089005661295e-02   -1.097534601062263e-02   +7.336486486358712e-02   +5.685074972888895e-02; +2.442591757136152e-01   +2.121670915751086e-01   +1.683774594460983e-01   +6.419799768514048e-02   -3.498482616992667e-02   +1.330410656052530e-01   +1.612353734895036e-01   +1.768351998162118e-01; +2.279713755096928e-01   +1.835105820275662e-01   +1.636571042336293e-02   +2.172411199045446e-01   +2.261044575689543e-01   +1.544991515119701e-01   +1.944628817004334e-01   +1.188603365476969e-01; +1.857810059179852e-01   +2.476189438432824e-01   +4.633740056419051e-02   +1.888096716741833e-01   +1.613177964240546e-01   +1.341983607154607e-01   +2.977745262344444e-02   +2.366548510251027e-01; +2.507743218299429e-01   +1.170094136745093e-01   +2.156394278847139e-01   +2.017134032238009e-01   +2.030792111023847e-01   +7.631842019349039e-02   +2.172885101868389e-01   +5.062530402672975e-02; +1.617341631527848e-01   +2.337097431757101e-01   +2.380294952223269e-01   +2.727086942587673e-01   +1.866638435220095e-01   +1.862177024107947e-01   +8.957107800127653e-02   +1.910074661510870e-01];
L3I_L3E_iAMPA_netcon = [+1.758559925683960e-01   +1.422411562224666e-01   -8.754815215644304e-03   -3.977769805922272e-02   +1.036682418005137e-01   +1.830116180563564e-01   +2.174931580014930e-01   +2.177292919741895e-01   +4.331574024269415e-02   +1.797989598955316e-01   +2.383098220786924e-01   +1.823920970200426e-01; +1.376618154868073e-01   +5.776441498862297e-02   +2.606032224524136e-01   +7.882120006069140e-02   +6.492275528641332e-02   +2.307671354061762e-01   +2.390229179713817e-02   -6.379742001143845e-02   +9.395581370870769e-02   +1.409885855910386e-01   +1.371913813402884e-01   +1.635003025944458e-01; +1.821538064740246e-01   +1.300979457454974e-01   +2.237456146842286e-01   +1.437405622334164e-01   +1.875214525368249e-01   +2.380721399465784e-01   +1.398656919033393e-01   +1.330853601628400e-01   +1.590323222661626e-01   +1.936812065909545e-01   +2.421254828222886e-01   -3.222015837301529e-02; +1.809888202615567e-01   +2.173356449871418e-01   +1.089970713712614e-01   +3.048804613930768e-02   +1.540601097272928e-01   +6.471682234202311e-02   +1.887342142582482e-01   +2.518590318735549e-01   +1.628252645170790e-01   +1.390277140521537e-01   +1.429809542823386e-01   +2.762925654211876e-01; +1.715714095455924e-01   +1.941344864018588e-01   +1.112427902090665e-01   +2.403912738575097e-01   +2.762334269782069e-01   +1.424528667580063e-01   +1.226448642054224e-01   +2.581556168881175e-01   +9.191820838633122e-02   -4.437528473994632e-02   -7.423656777167936e-02   +1.459600616829190e-01; +2.221885387842351e-01   +2.360627299615194e-01   +1.482989500038308e-01   +2.650124293711059e-01   +7.384813324567369e-02   -6.399033317644355e-02   +2.378492203093938e-01   +1.785378287465682e-01   +1.907161455850005e-01   +1.793253030258494e-02   -4.164929888690674e-02   +1.078027458828475e-01; +1.150480483833859e-01   +7.015389739069938e-02   +1.759253158038213e-02   +1.776106844647192e-01   +1.922780223834227e-01   +8.669628207083470e-02   +1.918986546055024e-02   +1.742458891066446e-01   +7.181515781349887e-02   +2.707283803564173e-01   +1.351249323261110e-01   +4.722294082566319e-03; +1.891770827776974e-01   +3.032123595340718e-02   +2.502115636504599e-01   +1.063343239792479e-01   +2.014456072464066e-01   +6.143705551914863e-02   +2.554063711977202e-01   +1.714528169273125e-01   +2.860037285159271e-01   -1.359948679973232e-02   +7.871996609718068e-02   +3.478649812863990e-02; +1.371717584588720e-01   +1.888413134203858e-01   +7.195182233260775e-02   +1.991050433559999e-01   +3.225539459733857e-01   +1.744794074131400e-01   +3.486002261033629e-02   +2.351929078350821e-01   +1.149675830465662e-01   +2.187029603184404e-01   +6.834696873861552e-02   +2.581469146083858e-02; +1.609026177461040e-01   +1.951281460884255e-01   +2.541170032351064e-01   +1.341128766136556e-01   +5.784011809368696e-02   +4.116158761612355e-02   +1.443749893608754e-01   +2.502751514800670e-01   +6.573348692471162e-02   +1.950576906067392e-01   +2.654063938234977e-01   +1.580421696226487e-01; +2.337465639151488e-01   +1.091854112518150e-01   +7.407563232753760e-02   +4.855671779293477e-02   +2.353142295769909e-01   +4.106010847765757e-02   +9.361014472807092e-02   +1.708603806979535e-01   +2.668940757950941e-01   +1.018167625149461e-01   +1.683258934286291e-01   +1.953505882615477e-01; +1.346508484037233e-01   +1.886607636191654e-01   +8.084074385941279e-03   +1.211890959503769e-01   +2.282288007068707e-01   +2.446512963699872e-01   +1.951286660277416e-01   +1.793872755602512e-01   +1.243621483529842e-01   +2.654951653760186e-01   +2.592371365261525e-01   -2.610457273152480e-02];
L3E_L3I_iGABA_netcon = [+1.438903549114521e-01   +2.276506300748109e-01   +2.080631882941413e-01   +1.319791869749103e-01   +2.901353933969913e-01   +1.626397390217574e-01   +1.556905016003081e-01   +2.608672621648117e-01   +2.260747912065412e-01   +1.370171164651516e-01   +1.743966764660059e-01   +1.981232586166524e-01; +1.619195165737561e-01   +1.198637991421584e-01   +6.464573540705776e-02   +2.215863400979875e-01   +1.222763501231342e-01   +8.787705349847935e-02   +1.667926660190946e-01   +4.366976085758421e-02   +5.351787819178208e-02   +2.699857640572207e-01   +2.807632140459208e-02   +9.714284938542968e-02; +1.238902248977230e-01   +2.318782851063847e-01   +2.296475582190846e-01   +5.257294890397562e-02   +1.008178586499356e-01   +2.391516651698679e-01   +4.667368545529287e-02   +1.878417570923460e-01   +1.845105030221177e-01   +1.489504025453514e-01   +5.342473731952713e-02   +6.927320513284005e-02; +2.813733653146933e-02   +9.285779864148488e-03   -2.106326535196453e-02   +9.466646867808552e-02   +2.076940681588118e-01   +1.307195491346845e-01   +1.047600523208867e-01   +1.822830661344419e-01   +1.234292889014243e-01   +1.924456113329386e-01   +6.341347088505615e-02   +4.476504640273075e-02; +1.014198256567320e-01   +1.344840628978122e-01   +5.845042582959497e-02   +2.739795008507499e-02   -3.662217638385152e-02   +2.704797183561576e-02   +4.073899058720279e-02   +2.509643042969759e-01   +7.960786002704121e-02   +1.076117961774450e-01   +2.705671181198700e-02   +2.747466902870203e-01; +4.121214302136129e-02   +3.153450518835137e-01   +1.746775718713509e-01   +6.677541759023016e-02   +6.490971163681979e-02   +2.113903407704955e-01   +1.508987559656040e-01   +4.555631645627548e-02   +1.404236964379105e-01   +2.421451194849445e-01   +1.974999653864833e-01   +2.154303089882552e-01; -1.867068761216349e-02   +4.588610198657250e-02   +5.857586776779816e-02   +2.058495898304398e-01   +5.329986347813258e-02   +1.129605505930489e-01   +1.922205778566146e-01   +1.693433008077417e-01   +1.985601299088359e-01   +1.657960807250657e-01   +1.676144193752262e-01   -4.052331439496289e-02; +1.645987599924144e-01   +1.949308498406188e-01   +5.889026097939350e-02   +1.761365375333263e-01   +1.748351924474331e-01   +1.611522614900459e-01   +2.071430916620700e-01   +6.183397959911895e-02   +1.244554261088225e-01   +1.312932814216205e-01   +1.470820554621023e-01   +5.425061282115042e-02; +1.567946167048304e-01   +9.692077816187078e-02   +3.128204463216645e-02   +1.623207152210199e-01   +1.036276559160238e-01   +6.309184280960047e-02   +2.114945618182248e-01   +9.570778533003245e-02   +2.475152022441758e-01   +2.494719733755560e-01   +9.394852494474974e-02   +2.018299760605517e-01; +9.741831195482185e-02   +1.965992083949403e-02   +1.716397596834105e-01   -3.632775470308024e-02   +1.435265496858792e-01   +9.097465800645949e-02   +6.704042082632097e-02   +1.388796235999787e-01   +1.225375101383975e-01   +1.307468456501595e-01   +2.014882147529839e-01   +1.206713182926164e-01; +1.389604422710656e-01   +2.557531297852817e-01   +2.079898922270062e-01   +2.202490279553957e-01   +2.224570510889659e-01   +9.458877523401270e-02   +1.972766573410444e-01   +1.693757746122495e-02   +1.675885507095039e-01   +1.428680468951464e-02   +2.496138357582133e-01   +2.284033877822871e-01; +1.568868573977870e-01   +1.541164235906554e-01   +1.236362815603025e-01   +3.218373237698140e-02   +2.229857981698405e-01   +1.155465956507822e-01   +1.841956294952118e-01   +1.946075221920832e-01   +1.627625800600548e-01   +1.982808003485685e-01   +9.729965330332503e-02   +1.231019551758389e-01];
L2E_Input1_iAMPA_netcon = [+6.086372259292262e-02   +1.022932540793970e-01   +8.892028223360066e-02   +1.947170306417818e-01   +2.083826471072330e-01   +2.384004239022472e-02   +2.101600955214159e-01   +5.168165092229120e-02];
L2I_Input2_iAMPA_netcon = [+1.637545225866574e-01   +1.982609046936901e-01   +9.304142931531589e-04   +3.098271540100219e-01   +4.475638563814181e-02   +2.777606613631128e-01   +1.584555662919042e-01   +2.839352636994822e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
