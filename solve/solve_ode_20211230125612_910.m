function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.991266545942172e-01   -7.038656328393329e-02   +5.548457200143557e-01   +3.677097492526967e-01   +2.817071855449297e-01   +7.044871977807626e-02   +5.289211936519382e-01   +3.223961818280505e-01   +1.831328436695579e-01   +3.717440726964694e-01   +4.357338848259002e-01   +1.267689301536897e-01   +3.497009622416752e-01   +2.807012180932946e-01   +1.453196950627124e-01   +5.433615077554911e-01; +4.032216693457907e-01   +2.385856045208340e-01   +5.278426297451161e-01   +2.793577588232761e-01   +4.198383481700602e-01   +1.294283387423319e-01   +1.672252440239120e-01   +2.089957180961075e-01   +4.630528403766550e-01   +5.689358501690156e-02   +2.668616848640089e-01   +6.573027768299654e-01   +3.057151051123825e-01   +2.544841986157917e-01   +7.147662981441861e-01   +4.669554496687364e-01; +6.709776711931770e-01   +4.351242193695191e-02   +4.464810241019299e-01   +1.096150152883874e-01   +3.354532120872531e-01   +9.049969702627371e-02   +9.951106542572735e-02   +4.653409207705647e-01   +1.237639374724082e-01   +1.923378634993683e-01   +4.133832191228433e-01   +1.416940374706517e-01   +3.485781676106709e-01   +3.819211390546895e-01   +3.030423387562218e-01   +1.802317961773628e-01; +4.734528850486062e-01   +6.104211950079114e-01   +4.874623349538897e-01   +3.160811777974578e-01   +7.213679143904148e-02   +5.408364137466785e-01   +6.022667971844973e-01   +7.326423028698154e-02   +2.455145216919509e-01   +1.886918471269144e-01   +2.111409072722180e-01   +1.391647957505466e-01   +3.180787829930163e-01   +1.050631093148377e-01   +5.007676475966424e-01   +3.245964259904247e-01; +4.557084388071145e-01   +3.054102124265461e-02   +5.516694303897024e-01   +8.291927703270954e-02   +1.498285151703434e-01   +4.745044507979386e-01   +3.054614108357090e-01   +5.555765115532664e-01   +5.102595647749069e-01   +5.806373526152609e-01   +5.903870250985694e-01   +1.920540641068070e-01   +4.559688391324171e-01   +5.105464927979232e-01   +1.049589231479640e-01   +5.054771332209320e-01; +4.706541184210430e-01   +2.464019528025377e-01   +4.591247209631193e-01   +1.569131362887335e-01   +2.918370931861662e-01   +4.126614250045862e-01   +5.476202945494707e-01   +6.104952416362790e-02   +5.080679585104866e-01   +6.538538846185973e-01   +5.209443161761537e-01   -1.862284058488278e-02   +3.673854711489454e-01   +2.591801748754882e-01   +2.934157301395435e-01   +6.364952449840000e-02; +3.963256955684753e-01   +1.969153963789056e-01   +1.019630775393644e-01   +4.299742240241630e-02   +2.784670799192687e-01   +4.841793657748048e-02   +6.148743375493364e-01   +5.804697062702361e-01   +2.332418335456348e-01   +6.354488227239877e-02   +4.134073909966205e-01   +4.416234807999515e-02   +4.813121533264168e-01   +5.395332836181341e-01   +2.031437323642747e-01   +1.845044208341612e-01; +3.422226984897935e-01   +1.921128886612190e-01   +4.353707870873072e-01   +5.450419047866929e-01   +5.235630656896642e-01   +3.029699511358626e-01   +4.025255287774098e-01   +2.413469820559254e-01   +1.394426429570763e-01   +2.020979128417543e-01   +3.974167375851602e-01   +3.958578518551008e-01   +3.242493682827789e-01   +2.815324161819256e-01   +3.165916255511746e-01   +3.665445411549530e-02; +2.533138218583102e-02   +4.219239311057252e-01   +1.027237861491027e-01   +1.109814193677922e-01   +4.248126650564570e-01   +1.409920157548574e-01   +2.188085019868179e-01   +5.719865356238244e-01   +3.099860745064524e-01   +1.807010323764790e-01   +9.927997261362896e-02   +3.167148199201920e-01   +1.476416153904783e-01   +6.408911057758518e-02   +3.609266574797875e-02   +3.908858309881836e-01; +2.640868091894394e-01   +3.845214202479428e-01   +6.370520032590717e-02   +4.843186080107745e-01   +2.077671823894180e-01   +4.277785605814109e-01   +5.087310179837852e-01   +1.800228655412486e-01   +7.909853700341890e-02   +2.117902413982655e-01   +5.696641316697481e-01   +3.135875240631263e-02   +3.101345584225799e-01   +2.701055384131339e-01   +1.030033340667981e-01   +5.364914172397295e-01; -6.970966370149602e-03   +1.922902946782767e-01   +6.291203384191597e-01   +1.556570857304750e-01   +2.356284702894088e-01   +1.084975891799512e-01   +5.836808619721038e-01   +1.099190338462037e-01   +2.743706828667069e-02   -1.694008815838824e-03   +7.025800937127426e-02   +4.086545226431075e-01   +3.242441369022558e-01   +6.186844996890482e-01   +3.951746687814848e-01   +6.072492071663525e-02; +4.097159072020566e-01   +5.428265856885651e-01   +5.728242891237054e-01   +6.176151800309425e-01   +3.844012327613120e-01   -1.891916297164490e-02   +1.536139037372118e-01   +6.223157685147800e-01   +5.663757615744145e-01   +5.462154599365881e-02   +8.538826244566299e-02   +5.413502633779168e-01   +4.798580489278241e-01   +4.131224318607439e-01   +2.163185614283457e-01   +5.522704167585033e-01; +3.943784795805529e-01   +1.904467106300775e-01   +5.389466126995659e-01   +4.353508777134550e-01   +1.974168195512251e-01   +3.027696658153648e-01   +2.535664045954872e-01   +1.597550204973420e-01   +6.562440755986361e-02   +4.360627766452275e-01   +5.602282278527447e-01   +4.198160815794302e-01   +1.385107300001410e-01   +2.083138874563763e-01   +6.121123063556276e-01   +3.048346626964182e-01; +1.528706723574575e-01   -5.832789398452388e-02   +3.550487771655069e-01   +1.641762063069722e-01   +3.009730908147094e-01   +1.585063435136265e-01   +1.668398262711021e-01   +5.363358167255123e-01   +4.931147806183586e-01   +5.681677131080451e-01   +5.729793984545792e-01   +3.332161373304210e-01   +3.721889358393341e-01   +1.617046519006893e-01   +4.847797479382792e-01   +1.439295691539918e-01; +6.327778198355958e-01   +4.955982099469852e-01   +4.666110747227256e-01   +1.040045190145052e-02   +2.587260813455960e-01   +4.500778999079942e-01   +3.130147258158023e-02   +5.658655018555722e-01   +4.669015146676074e-01   +3.153081486598282e-01   +2.078461034617394e-01   +6.607018782794083e-01   +1.127796190736771e-01   +4.254852456878430e-01   +9.649764429328077e-02   +5.858568528198909e-01; +8.656186472115841e-02   +4.049202692185274e-01   +6.087819708704632e-01   +4.045795440670196e-01   +4.592758310025991e-01   +1.891362238727264e-01   +3.979459867896925e-01   +1.969737270858535e-01   +1.856125811620569e-03   +1.118537217856294e-01   -3.595875894824839e-02   +5.068617341645826e-01   +4.680497296962555e-01   +6.299904749623564e-02   +4.903453703757358e-01   +8.464483818932203e-02];
L1E_L1I_iGABA_netcon = [+8.403336729105612e-02   +5.169038505847929e-01   +4.073772464382945e-01   +2.493469694847054e-01   +2.453640910509858e-01   +4.362617837875839e-01   +1.127187781476174e-01   +3.772876566440673e-01   +5.521932938003506e-01   +5.950975686681732e-01   +4.154801676720475e-01   +2.417235527326752e-01   +4.467865086929818e-01   +2.407626427867418e-02   +1.392213535290824e-01   +5.412545876909004e-02; -2.434585915077484e-02   +2.643648646310512e-01   +2.647931283935291e-01   +6.323001579752660e-01   +8.004679502175165e-02   +5.476975837178708e-01   +2.280404809167457e-01   +3.685907032794520e-01   +1.292058182185956e-01   +4.070047619291754e-01   +6.889623886106354e-01   +1.316039231797415e-02   +6.043203489042619e-01   +3.402851520448691e-01   +1.119074273171350e-01   +4.002602082828993e-01; +3.565767360781586e-01   +3.776614138369230e-01   +1.445223317002507e-01   +4.685168717052736e-01   +3.838841634439673e-01   +5.393155311452789e-01   +2.822196824488479e-01   +6.005150097088465e-01   +1.741444920500063e-01   +2.482890723412593e-01   +6.048408609977337e-01   +4.157503665356037e-01   +1.325616502278390e-01   +3.902686454424611e-01   +3.872012143898261e-01   +5.631727328463015e-01; +6.036948365486756e-01   +1.223828210022846e-01   +4.662637712415973e-01   +6.201848124489544e-01   +3.749788603834069e-01   +6.020993464498878e-01   +4.809557181711143e-01   +6.558101722746643e-01   +2.047699072494106e-02   +6.878614433523517e-01   +5.306733914506304e-01   +7.957254369674226e-02   +1.610609336570863e-01   +2.663981317796063e-01   +3.360931499927953e-01   +3.057643220627537e-01; +5.664706121259583e-01   +3.807661053601037e-01   +1.460981653981468e-01   +1.555959467447888e-01   +9.844557759272969e-02   +4.304628198337183e-01   +5.396356757535744e-01   +2.035133249690937e-01   +5.410518929139332e-01   +2.549233442098155e-01   +1.805677911793594e-01   +2.822322387812531e-02   +4.541195196542352e-01   +6.894988789280965e-01   +2.774939560184637e-01   +1.808743630756795e-02; +2.924211239522602e-01   +2.291879829235067e-01   +6.530371735390259e-02   +5.762346581047735e-01   +2.175059879445583e-01   +3.050369045469226e-01   +5.597067032976852e-01   +5.748037047113610e-01   +2.886295439257664e-01   +4.335721888948347e-01   +5.604583206317626e-01   +9.417889226014479e-02   +4.000415109593036e-01   +1.411191765468567e-01   +3.810928470988730e-01   +1.941044042101533e-01; -4.370605308703573e-03   +3.650848238608723e-01   +2.606274082467869e-01   +1.497313944750436e-01   +3.747357574238309e-01   +5.885935625082946e-01   +5.862446632233939e-02   +5.493396356777001e-01   +3.422498054539759e-01   +5.995893668965384e-01   +7.038960324018999e-02   +6.247323393479226e-01   +6.458291729876693e-02   +1.910238645717753e-01   +2.258067901111335e-01   +3.680896679577806e-01; +4.368748904885504e-01   +3.558309964763110e-01   +5.671100876196466e-02   +9.320835559294212e-02   +8.908174898739674e-02   +1.908072231436657e-01   +4.265748215140461e-01   +2.467685762568601e-01   +2.151102534950677e-01   +9.141932704566511e-02   +7.099044149630559e-01   +4.504029345672226e-01   +3.783019133385598e-01   +3.007399505765354e-01   +1.088950551923233e-01   +1.739794268060599e-01; +5.624764940814180e-02   +5.244371286312681e-01   +8.785928996624887e-02   +5.466016441325329e-01   +3.600527188388034e-01   +5.329845874667970e-01   +2.158374192991125e-01   +5.101097202876661e-01   +1.928161187829066e-01   +5.353214469206633e-01   +4.748942553226495e-01   +3.666920129563742e-01   +1.267905734605069e-01   +4.267849544291920e-01   +3.748045879972101e-01   +5.400943573843361e-01; +1.975613686352017e-01   +6.212629499641604e-01   +3.423465977212631e-01   +1.747223554299020e-01   +5.457953583160564e-01   +3.528184797727166e-01   +3.687088833559855e-01   +2.175569015077257e-01   +4.022789793335623e-01   +6.273322590653585e-01   +3.584464563620299e-01   -3.454071622508244e-03   +7.087119042029633e-03   +3.070150890811934e-01   +1.968865673374448e-01   +4.200170481824191e-01; +6.454272060570450e-01   +1.842678911053606e-01   +5.455872574027347e-01   +6.186429307850184e-01   +4.340897656193186e-01   +1.626085323183376e-01   +5.528681491395281e-01   +3.385442067386896e-01   +5.111126726474394e-01   +5.547016258446688e-01   +3.336676280298124e-01   +2.637642710474098e-01   +2.585923265970271e-01   +4.418759676517388e-01   +5.279032171406995e-01   +3.215498058060134e-01; +1.232334747623824e-01   +1.494899278310040e-01   +9.779749812695161e-02   +3.273004435938668e-01   +1.522345346816829e-01   +1.110496594350671e-01   +3.415908252427935e-01   +3.729715863669359e-01   +4.144826712627226e-01   +3.712236116750382e-01   +4.719941807988614e-01   +5.584355068543742e-01   +3.088493234842916e-01   +4.972356828231904e-01   +4.681662879960173e-01   +7.748338806192864e-02; +5.289105970405507e-02   +9.519682734966090e-02   +2.335284300678127e-01   +5.564011721130309e-01   +8.457001070467797e-02   +2.758981826613909e-01   +4.391507616250147e-01   -7.201302508800869e-03   +3.304978956013256e-01   +2.380062685607908e-01   +5.906345561396753e-02   +3.792940691304935e-01   +4.534658699799502e-02   +2.422018176820499e-01   +3.550729912690351e-01   +5.595327887502594e-01; +3.607702511315181e-01   +4.469983016348468e-01   +3.227936669297818e-01   +4.702936928257237e-01   +3.782975014825486e-01   +1.593540957019567e-01   +2.212422222222228e-01   +4.014256569328541e-01   +2.442732235008838e-01   +6.279497938692781e-01   +2.415250202040994e-02   +4.866139851281849e-01   +2.990535102533412e-01   +5.584761941101318e-01   +5.577189913226555e-01   +3.835774597248131e-01; +4.056736449800611e-01   +5.679561189575161e-01   +2.535712952300529e-01   +2.107943382657676e-01   +4.514825475265321e-01   +3.884819104829794e-01   +4.483378729325205e-01   +3.640822458699963e-01   +4.831691439331258e-01   +5.697399752208517e-01   +5.643253571899891e-01   +2.024430969500564e-01   +3.263408226606602e-01   +1.151497117293670e-01   +2.585696550071208e-01   +5.410404123737932e-01; +6.225219863390115e-01   +9.038566971112431e-02   +1.207544270591097e-02   +1.416825299844880e-01   +2.779175956720584e-02   +6.090576559979015e-01   +3.978496255550962e-01   +5.124656093125498e-01   +4.810522134819292e-01   +1.653816571474827e-01   +5.292550530113381e-01   +9.767251580170001e-02   +2.483898551481102e-01   +3.088526910737589e-01   +3.727584794024487e-01   +2.184639959444564e-01];
L2I_L1I_iGABA_netcon = [+2.741249349506593e-01   +5.468860206784252e-01   +2.650601973550062e-01   +4.588216574650942e-01   +3.335333359286509e-01   +5.203810692581010e-01   +4.775725440355122e-01   +1.058584097813617e-01; +6.646103070821108e-02   +4.003995247118143e-01   +4.942738935026512e-01   +4.908409353567807e-01   +3.383076500555175e-01   +2.133007391166293e-01   +2.601829006968760e-01   +4.545975287002178e-02; +2.940439756143603e-01   +5.232381399670479e-01   +4.281107990969944e-01   +2.762503012638260e-01   +5.972758357713819e-01   +6.787955394997359e-01   +3.374693905932439e-01   +3.720799863025582e-01; +1.742844975393177e-01   +1.137976749848690e-01   +5.958825572020056e-01   +5.421959532071239e-01   +3.106771080883433e-01   +5.648408607545401e-02   +2.873329869254209e-01   +2.342969402298359e-01; +1.760539149776024e-01   +1.189180662554395e-01   +4.573066121029667e-01   +6.667916110644491e-01   +6.299588023500444e-01   +3.365946345541326e-01   +5.179504328406579e-01   +8.123130989756817e-02; +3.986929365741224e-01   +5.608775822153725e-01   +1.151620133851799e-01   +7.707026139837322e-02   +6.286593827607279e-01   +3.745016318856403e-01   +3.537093601714771e-01   +2.743312123656756e-02; +2.548758409398570e-01   +5.322123113811107e-02   +5.174895838527404e-01   +3.574924876813237e-01   +2.421307275301687e-01   +4.595190878068466e-01   +4.545508478059365e-01   +5.116004035956447e-02; +4.602244995878942e-02   +4.833678275751557e-01   +3.670301466955607e-01   +4.039309773883054e-01   +3.557463095108186e-01   +6.221190027485534e-01   +7.229830409527889e-02   +2.618405798065614e-01; +2.902652410734700e-01   +1.737358662570158e-01   +5.984326839021621e-01   +1.394293348347861e-01   +2.609238604532114e-01   +1.517703330095451e-01   +5.795788000431852e-01   +1.358126663988121e-01; +1.718954434918047e-01   +1.826405280693787e-02   +2.689366789000788e-01   +4.923331005073412e-01   +4.378116445343393e-02   -6.986138990411722e-02   +2.445333366005182e-01   +1.347252598799027e-01; +1.583999309200794e-02   +9.593078886919029e-03   +3.884147000953754e-01   +2.276695504542044e-01   +2.658023897548314e-01   +6.789872872933669e-01   +8.660981379604586e-02   +3.541424874346292e-01; +2.902528372894103e-01   +4.301335886867532e-01   +5.563966224114431e-01   +1.294045431003160e-01   -2.907548509319257e-02   +6.661788780794102e-01   +1.447284252251281e-01   +2.992192219378398e-01; +4.089560386683603e-01   +1.315860350681305e-01   +2.135346239791349e-01   +2.394272596058124e-01   +1.038964618413907e-01   +4.042979161156656e-01   +1.511765469353460e-02   +2.061415714009102e-01; +1.599696900990008e-01   +1.626452798739629e-01   +4.622397153333291e-01   +5.698925787815697e-01   +5.679525864157741e-01   +4.011115212562366e-01   +3.385085916259659e-01   +3.016653931568869e-02; +2.984727890948177e-01   +5.406988467287642e-01   +6.910319944405544e-01   +3.921542901855812e-01   +5.109805403549129e-01   +1.225299257734253e-01   +4.905319217877308e-03   +6.157645886384192e-01; +6.010573566891294e-01   +3.543850282086732e-01   +6.621679276318105e-01   +5.719355055369241e-01   +1.546754166528586e-01   +6.137229099296267e-01   +4.054436834256018e-01   +3.402501690302941e-01];
L1I_L2I_iGABA_netcon = [+4.939124462095844e-01   +5.235016545431319e-01   +1.562207274377864e-03   +6.972392968688010e-02   +9.510386380511179e-02   +2.024323874889689e-02   +2.236144432916239e-02   +2.426664610987888e-01   +2.574698897341037e-01   +2.961441375174005e-01   +5.796792809927666e-01   +6.788589089232958e-02   +3.583106140093000e-01   +3.555505651282000e-01   +4.460468720571621e-01   +6.200249814442412e-01; +3.162703261191383e-01   -3.321886112413144e-03   +6.478833111497151e-01   +3.109550643940395e-01   +4.829055975023085e-01   +1.976801418587747e-01   +6.408831293202197e-01   +5.220773094680448e-01   +3.591288584358968e-01   +2.081198319775090e-01   +6.717641213469598e-01   +4.940325070582139e-01   +2.267348490126659e-02   +2.375350508216369e-01   +4.941657937994622e-01   +3.823590320980864e-01; +6.215581356568592e-01   +3.730123681446493e-01   +2.539159439712397e-01   +6.249638092761549e-01   +1.356224166422823e-01   +3.097952330151403e-01   +4.244000514185635e-01   +3.186784325381784e-01   +3.355945850471525e-01   +5.152015613620449e-01   +4.487725567455090e-02   +4.219872429024080e-01   +4.431506215456771e-01   +5.020595949478983e-01   +1.214634088781305e-01   +2.799424623327549e-01; +8.214849122924853e-02   +1.816701599167796e-01   +1.054709633651429e-01   +3.135076619359364e-01   +1.004704719512290e-01   +2.024131693688648e-01   +5.024571338399366e-01   +5.269695362271446e-01   +1.438965142382705e-01   +3.490373339167687e-01   +6.031342657264119e-01   +4.042616843328711e-01   +2.037408616676634e-02   +5.630361880608196e-01   +4.390341896789335e-01   +5.863030158794684e-01; +5.577533021932792e-01   +9.152840774392354e-02   +3.525882466553505e-01   +1.843525402154410e-02   +5.019132089909262e-01   -6.289642167442680e-02   +3.992267240219056e-01   +2.981913843228235e-01   +4.843077291335304e-01   +1.360135792067944e-02   +5.120653008646403e-01   +5.593778523433505e-01   +1.329106688799146e-01   +2.019541193747197e-01   +1.686702387419350e-01   +2.620730719389814e-01; +3.804736662293106e-01   +1.867685805998919e-01   +4.096056305896723e-02   +4.085585395863880e-01   +4.246953568606217e-01   +3.684758062197484e-01   +3.404010997043364e-01   +5.390444717454129e-02   +1.330202682090547e-01   +5.243905105801638e-02   +2.916545575190439e-01   +4.523168261398551e-01   +1.629529437891180e-01   +5.089941785711407e-01   +3.651156414063141e-01   +2.018878925109499e-01; +5.612680255538208e-02   +6.182077910661937e-01   +1.162306527091188e-01   +4.201479871306583e-01   +3.161535144393036e-01   +6.856081388262014e-01   +5.416428345605225e-01   +1.997390514696609e-01   +4.035498752525737e-01   +5.485915671355537e-01   +3.151346705054269e-01   +8.780578611642403e-02   +1.714844327696961e-01   +6.115504471844464e-01   +2.205722406670056e-01   +6.600900372345431e-01; +6.265723660369361e-01   +4.410032123349619e-02   +2.519084942113298e-01   +1.950301064679282e-01   +1.036250342258067e-01   +5.655224731242104e-01   +1.330677652317864e-01   +3.350222537030915e-01   +2.306255949318504e-01   +1.126815410693174e-01   +1.897197161234487e-01   +3.870183330468626e-01   +4.022419632196148e-01   +9.561020794717912e-02   +1.203588393033959e-01   +1.380520480718610e-01];
L2E_L1E_iAMPA_netcon = [+1.408912720598869e-01   +3.797286730875857e-01   +2.090663135611093e-01   +3.772464447536120e-01   +5.253363004093549e-01   +2.625092771731172e-01   +1.574340406429973e-01   +4.352719015883765e-01; +6.102098502401322e-01   +4.707826805952166e-01   +2.274391950923318e-01   +5.387479053269052e-01   +5.736458604481213e-01   +2.889360841784828e-01   +1.429777855234048e-01   +2.481978234363025e-01; +4.414062982489404e-01   +5.198001083464058e-01   +5.134625734512936e-01   +5.853984990790557e-01   +5.370874806612471e-01   +1.765708794147665e-01   +4.418375229403135e-01   +1.753433033532370e-01; +8.286434472955759e-02   +1.399500793130211e-01   +4.595561873095708e-01   +4.145144107822975e-01   +1.266903285244088e-01   +1.140931434444224e-01   +2.080098367186751e-01   +2.863233759658408e-01; +2.426029421612954e-01   +7.782218368544047e-02   +5.201840102436327e-01   +5.464629385677512e-01   +5.755343236383140e-01   +4.239977686855042e-01   +5.822280009070492e-01   +3.735369245473702e-01; +6.709887364304601e-02   +6.918380471173623e-01   +1.149375458439472e-01   +2.574892147618590e-01   +5.774729220759571e-01   +4.213835090715666e-01   +1.551149376251879e-02   +4.683656304830195e-01; +5.972265413741102e-01   +5.169739910108280e-01   +4.144307383506917e-01   +3.008963878027813e-01   +5.753999647404381e-01   +2.239973528549677e-01   +3.445226067259788e-01   +5.936302117616676e-01; +5.134609443653773e-01   +4.864362749810681e-02   +2.528999466062795e-01   +3.922365185652185e-01   +3.601224157124538e-01   +1.654820595528228e-01   +4.754975984306771e-01   +4.722401757241853e-01; +4.853745775251291e-02   +1.626054624462150e-01   +3.699937163910677e-01   +1.204982820678727e-01   +4.212933699482420e-01   +2.780543983683814e-02   +5.135532660618529e-02   +3.848014080672718e-01; +2.287978258713896e-01   +2.320903454937701e-01   +3.461924502876345e-01   +6.420670192472467e-01   +1.384878178865300e-01   +4.948310336974516e-01   +3.483484850280722e-01   +2.309437242393502e-01; +4.824955461171473e-01   +3.488569003605874e-02   +3.538011719955012e-01   +7.167238741967190e-01   +4.429979113988478e-01   +3.235669991127191e-01   +1.168153610306233e-01   +5.755668695822471e-01; +7.420669169595810e-02   +2.423018214944586e-01   +6.714282896843912e-02   +3.076962087901142e-01   +5.011818726494492e-01   +6.370794066280869e-01   +2.280762248808183e-01   +3.847263371243703e-02; +4.032201484346922e-01   +2.689096559845360e-01   +2.160836076771727e-01   +5.691491231978545e-01   +3.441730081715440e-01   +3.605968452288161e-01   +1.954129732035979e-01   +2.803036017220129e-01; +6.187821530103378e-01   +2.000767889838553e-01   +2.630371058989366e-01   +4.329363915172298e-01   +3.345550969577519e-01   +1.354255734259593e-01   +3.068060614117682e-01   +1.058247402889175e-01; +2.984555046018865e-01   +2.407556064672322e-01   +2.230417598172011e-01   -7.072139325393009e-04   +3.305900209016265e-02   -5.774077465582381e-03   +6.896181610446067e-01   +2.815917730800327e-01; +5.495006146139103e-01   +6.158790512765827e-01   +5.751282323417269e-01   +4.805952336683132e-01   +6.369349745017516e-02   +9.410529658086671e-02   +1.925551949491656e-01   +5.882259821493840e-01];
L1E_L2E_iAMPA_netcon = [+6.076975679302927e-01   +3.796414450664249e-01   +2.429071358888479e-01   +1.944333963287795e-01   +2.784389996652084e-01   +2.934042342982421e-01   +2.221765998779892e-01   +4.349045496589077e-01   +2.529450217112532e-01   +5.584904538322077e-01   +6.676482049388593e-01   +4.659510721528298e-01   +1.283525947305467e-01   +8.388647081383153e-02   +1.599770497383758e-01   +5.320990630745612e-01; +6.414662035382278e-01   +5.823532635800914e-01   +5.436797937513960e-01   +2.169761472917014e-01   +3.644635759486384e-01   -7.252150793055612e-02   +1.421924256821208e-01   +4.604860105540914e-01   +1.251919966607973e-01   +4.195969702077260e-01   +5.371846650905860e-01   +3.753049728318578e-01   +4.715905306277192e-01   +5.938251045091053e-01   +5.547010597372156e-01   +1.722103320690263e-01; +6.201923018253517e-01   +5.247436710413245e-01   +1.395376290673836e-01   +3.192232209122755e-01   +5.511907903585825e-01   +3.910246958793500e-01   +5.813150898076083e-02   +3.669719578463336e-01   -1.413270877754973e-02   +6.132177282200040e-02   +4.858458900983085e-02   +5.489967570012854e-01   +5.223822412423444e-01   +2.273575333796757e-01   +5.565918242826600e-01   +9.265976995000058e-02; +1.693502769397950e-01   +3.440757321811916e-01   +4.326965434931412e-03   +5.477435995993170e-01   +2.765984953067182e-01   +5.843707208071299e-01   +3.233341477615147e-01   +5.806228814996409e-01   +5.962510874713287e-01   +9.046263441853045e-02   +2.921714945553213e-01   +1.206689372639890e-01   +3.077217952705135e-02   +1.367282244910045e-01   +6.006681501792100e-01   +4.941039579004155e-01; +5.905637935634384e-01   +5.231428985079649e-01   +5.799968888930983e-01   +5.211763517167139e-01   +2.992262316435600e-01   +1.831951691392281e-01   +1.920239881015396e-01   +2.470606414933363e-01   +3.174642491850618e-01   +4.001878665948418e-01   +3.760301452623349e-01   +3.670544330796076e-01   +2.152196731264347e-01   +2.962843937886381e-01   +5.702372930689139e-01   +2.548207719081652e-02; +2.531595728130553e-01   +4.370119927225804e-01   +6.210790562743963e-01   +3.817773033822563e-01   +8.218332489362859e-02   +7.168608480299746e-02   +1.411745270764176e-02   +7.902060112240697e-02   +1.121642779849397e-02   +5.536921619160689e-02   +8.820545377830441e-02   +1.169314892210686e-01   +5.437854055180283e-01   +5.957745377089002e-01   +4.601751695274836e-01   +2.397168893731630e-01; +3.406083993548185e-01   +1.123103508337164e-01   +2.497576594167502e-01   +6.524582506028957e-02   +5.908652138880146e-01   +5.795014570307218e-01   +4.612793946610978e-01   +5.405637909909874e-01   +3.241431752669383e-01   +3.395502150066277e-01   +2.918757557422188e-01   +1.525786850470204e-01   +1.313517350397707e-01   +2.101835867074374e-01   +2.031770722914882e-01   +2.349668613623543e-01; +5.341481349762968e-01   +2.339228250361487e-01   +2.719238294705270e-01   +4.303490790228137e-01   +5.751735018335857e-01   +6.017692427406737e-01   +2.484454521605678e-01   +2.877271420849672e-01   +4.834129972303927e-01   +4.579140202763821e-02   +2.025423443660508e-01   +4.257430352000163e-01   +1.213727044495744e-01   +4.259644445621290e-01   +3.848652772164895e-01   +3.660024648749605e-01];
L2I_L2E_iAMPA_netcon = [+5.777620158158546e-01   +3.016154370811733e-01   +5.279466392249875e-01   +2.735931726546057e-01   +1.692426042067947e-01   +6.762929768175321e-02   +4.600721850789287e-02   +3.327330580774228e-01; +5.383508880974934e-01   +3.672613973191047e-01   +5.774535567169837e-01   +1.805152779188979e-01   +3.502542208816960e-01   +6.740577570678923e-01   +4.494729972657006e-01   +1.921548103458082e-01; +4.961992127170794e-01   +3.028736677261163e-01   +3.804776730847955e-01   +4.743440754149264e-02   +4.058710467595711e-01   +2.648867735732716e-01   -1.696537293071640e-02   -6.370220574292415e-02; -2.012751439329530e-02   +2.370021648082536e-01   +8.646557936865787e-02   +6.112260046599323e-01   +4.209469426875448e-01   +3.748153443121152e-01   +1.999944782611057e-01   +8.800957482218830e-02; +2.974511590127403e-01   +3.241178769852198e-01   +4.599981022656561e-01   +6.451780663358788e-01   +2.069973291192939e-01   +2.043529543177770e-01   +4.732496449270273e-01   +3.364697163714238e-01; +1.136770007266882e-01   +3.833760759261743e-01   +2.704043535408968e-01   +2.584115672572981e-01   +1.740961380307506e-01   +3.305514191540703e-01   +2.993785035679621e-01   +4.391606767375082e-01; +6.181910138634347e-01   +1.989289668368219e-01   +7.097006608158171e-02   +4.730307026914031e-01   +1.519148065016138e-01   +1.204081414975963e-01   +3.551329616472668e-01   +1.250143672480940e-01; +2.681454705577974e-01   +3.174706614983350e-01   +5.437025972186333e-01   +5.141048888505881e-01   +4.089742071818372e-02   +5.006373572497846e-02   +2.936067081757940e-01   +6.164428478897910e-01];
L2E_L2I_iGABA_netcon = [+6.188888520226635e-01   +3.167732727892743e-01   +4.604936439144360e-01   +3.902732996399100e-02   +2.753464069505305e-01   +6.138576314109555e-01   +4.310272704826066e-01   +4.036530556356963e-02; +2.064622205525699e-01   +5.612564882999752e-01   -5.269886259631793e-02   +2.422185731514263e-01   +4.351483717366685e-01   +3.124086901914009e-02   +4.237353440918009e-01   +1.126803584979588e-01; +5.143501982234817e-01   +1.887158650621257e-01   +7.982613299521531e-02   +6.440449087463761e-01   +2.021814682881349e-01   +3.042763816869420e-01   +5.554508380366466e-01   +9.130004158226507e-02; +4.975951253623731e-01   +4.624514406523377e-01   +4.826105227149014e-01   +7.139834786838242e-02   +1.013986835670590e-01   +2.309750410263692e-01   +5.532458503255034e-01   +4.895265996131401e-01; +3.023869140709974e-01   +5.392891966328850e-02   +5.072469114586825e-01   +3.439491353907121e-01   +2.670169228162832e-01   +6.050867925803121e-01   +2.351622714064108e-01   +2.938194568925318e-01; +3.964021184263910e-01   +3.152443002596809e-01   +1.620665625358192e-01   +4.318757326239525e-01   +5.584064157043038e-03   +6.402269076823842e-01   +3.149799820662482e-01   +2.535916625277773e-01; +4.043614916765456e-01   +4.818767984734454e-01   +6.556800494710022e-02   +1.623265846085359e-01   +3.277169594318097e-01   +5.131971048034100e-01   +1.400492259707342e-01   +4.602436043193695e-01; +1.191926769613598e-01   +3.883715408216775e-01   +1.383726813982401e-01   +1.117370185498509e-01   +9.474286440554529e-02   +5.125472932039142e-01   +3.083823985366348e-01   +3.475323673314948e-01];
L3E_L2E_iAMPA_netcon = [+3.082336369216957e-01   +8.319744101261337e-02   +3.717321706810739e-02   +6.799078807957449e-01   +5.029802514670082e-01   +6.535179590851614e-01   +3.834290983872212e-01   +1.308370262152844e-01   +5.790019505727160e-01   +2.209144157336868e-01   +5.849072097076687e-01   +1.616524084778957e-01; +2.301508836541788e-01   +5.898596679431518e-01   +5.900366761381094e-01   +4.109547222681824e-01   +3.326950221876460e-01   +1.861873355005834e-01   +4.391755216576667e-01   +7.225117325367188e-03   -1.359586718044900e-02   +4.519464030233776e-01   +3.436218762269442e-01   +2.865657146381304e-02; +2.271367656407089e-01   +4.129736120847466e-01   +3.601936809589488e-01   +1.504955737020976e-02   +3.029849643541124e-01   +5.512115319651258e-01   +2.007789681695967e-01   +3.292289368491383e-01   +4.596266501490804e-01   +5.361499227954069e-01   +4.691120091921215e-01   +6.921250813881741e-02; +3.515990788909289e-01   +2.079004777580015e-01   +5.786099893163462e-01   +1.062926148720882e-01   +1.972208715647103e-01   +3.039302806630595e-01   +6.050542364026553e-01   +6.348607254408789e-02   +2.175165126812577e-01   +4.902463073361450e-01   +2.956130481118392e-01   +3.123551163742582e-01; +1.769148656612217e-01   +4.483571281389553e-01   +6.977715138797359e-02   +5.926280071132923e-01   +4.117450729174187e-01   +4.470914709627888e-01   +6.068361447257670e-01   +7.342353935017778e-01   +1.536538237656928e-01   -1.181710768482432e-02   +4.018609562544643e-01   +2.472188136712251e-01; +2.689484532034833e-01   +4.589036788826487e-01   +1.207942556361426e-01   +5.926025947314062e-01   -1.038992520546598e-02   +4.831961032705505e-01   +3.854766552430105e-01   +5.792604036009139e-01   +6.320187606426195e-01   +3.160402950550490e-01   +1.364217708471692e-01   +3.566207631124340e-01; +5.862799992793866e-01   +4.698322772094790e-01   +5.262992599327668e-01   +2.419033841233689e-01   +5.185532301413933e-01   +3.116922909117953e-01   +6.030099759349572e-01   +5.031653286228912e-01   +8.638542699270467e-02   +3.964130890598270e-01   +4.574312139421098e-01   +3.313509875785169e-01; +2.750479272082361e-01   +7.963963274517265e-02   +3.194951203521549e-01   +1.665306489929148e-01   +3.553319319028534e-01   +2.153639074002986e-01   +2.906237838587153e-01   +3.035609540598142e-01   +4.570537494907434e-01   +2.440175712543126e-02   +3.858361142098152e-01   +3.672803243103213e-01];
L3I_L2I_iGABA_netcon = [+1.878975182970656e-01   +3.044411441079978e-01   +4.313230775094073e-03   +6.565260763355373e-01   +3.645324834427337e-01   +1.691592568718132e-01   +4.941932702953504e-01   +3.137500099442834e-01   +3.094240513261131e-01   +6.349856840738574e-02   +2.998567183357352e-01   +4.350398378525278e-01; +1.331619212724884e-01   +4.847146888095933e-01   +7.073350237543339e-01   +6.318556352809256e-01   +2.985447033952011e-01   +3.003109568673547e-01   +4.198634136357185e-01   +4.905792341110084e-01   -5.699278597754427e-02   +4.932053382922417e-01   +6.597808766959817e-01   +2.187686482593884e-01; +2.404898251292029e-01   +3.424266236327492e-01   +4.292769752105762e-01   +1.576294416115850e-02   +1.498082969260319e-01   +5.071667799074882e-01   +4.222914115729332e-01   +5.857883609512772e-01   +3.880978725431517e-01   +5.581812549992564e-02   +1.586092012750782e-01   +4.310516444481695e-01; +3.174696443059403e-01   +2.960448492352721e-01   +1.729443895646139e-01   +4.017060406287373e-01   +1.683783549557717e-02   +1.700202261516896e-01   +4.149358381901849e-01   +6.313572147526253e-01   +3.877377265558538e-01   +6.855046971080764e-01   +4.470691543900619e-01   +1.164055227006096e-01; +2.720009041207589e-01   +4.239857316779946e-01   +3.727408613751352e-01   +4.945423147872735e-01   +9.709272422778926e-02   +5.864281602052089e-01   +3.997257986653421e-02   +4.474225600744226e-01   +2.878558693305464e-01   +3.222233594958093e-01   +4.979775687651332e-01   +5.187399756720162e-01; +5.241088138127057e-01   +5.970041574219591e-01   +3.865530717036963e-04   +3.440861370391800e-01   +6.384716176145648e-01   +1.106784708621315e-01   +5.239077323257296e-01   +7.970175457634869e-02   +3.298902942005724e-01   +2.540841176249537e-01   +1.628750853664899e-01   +2.161521581584747e-01; +3.221055766053619e-01   +1.641612588465255e-01   +4.200765907143411e-01   +5.980413784773865e-01   +1.166996293768267e-01   +3.438300791306265e-01   +3.301421302125968e-01   +6.390501074895723e-02   +5.834009890869957e-01   +3.490080954181610e-01   +1.636049262356799e-01   +4.603776272059177e-02; +3.725566290377769e-01   +2.333027214043704e-01   +1.479809347648122e-01   +3.210323631304648e-01   +4.448148604923660e-01   +4.678853826527118e-01   +5.484607176162349e-01   +3.747940522893083e-02   +5.019038087226001e-02   +5.277649438623755e-01   +2.363121932860096e-01   -2.700775184587863e-02];
L2E_L3E_iAMPA_netcon = [+3.473707298120212e-01   +3.070594110212500e-01   +2.539405327790855e-01   +1.027082786351468e-02   +2.329498266460616e-01   +7.040700318578305e-01   +2.116875826537159e-02   +1.481995905949970e-01; +6.287821667826540e-01   +1.895431381471301e-01   +7.985306531269566e-02   +2.098122982671245e-01   +4.783692963058109e-01   +2.762400023855079e-01   +7.674440054379222e-02   +3.943550159003801e-01; +2.403029264776768e-01   +5.430123891614638e-01   +3.123174922818103e-01   +2.486872719152229e-01   +6.916592377997056e-01   +5.403330443090733e-01   +4.077433915236623e-01   +4.801748952163402e-01; +4.340114182791355e-01   +3.771578626228570e-01   +3.165573329011836e-01   +5.330847269714027e-01   +5.660977097105179e-01   +5.369079986067862e-01   +4.822506983829435e-01   +4.819770767308361e-01; +1.950677582361790e-01   +4.555958254154587e-01   +3.230725709972840e-01   +4.300683981068396e-01   +1.937691416290145e-01   +5.184576724672761e-01   +2.068503700615397e-01   +1.862913493200682e-01; +5.072438340985223e-01   +1.876399533331404e-01   +5.787223209872593e-01   +5.853964475420186e-01   +1.726699276166935e-01   +3.832312373796503e-01   -5.425950383400394e-03   +1.398510133960262e-01; +4.320681626141747e-01   +4.283299611979012e-02   +2.860537899107041e-01   +2.048353338174332e-01   +2.916797054978449e-01   +3.239520847537797e-01   +1.851544020713513e-01   +2.640889578960724e-01; +2.168495632185994e-01   +4.675731089845926e-01   +1.744740148135686e-03   +2.984118428842094e-01   +8.710440509546208e-02   +3.403955185270837e-01   +3.245317122217061e-01   +3.778842736088307e-01; +1.330533294260509e-01   +3.084837584158818e-01   +4.825410401400625e-01   +2.531719265417792e-01   +2.688918015773949e-01   +4.493906115532197e-01   +3.740985202228285e-02   +3.087210749054309e-01; +3.402065289198300e-01   +4.635169157138351e-01   +6.428842498690855e-02   +4.136174292910956e-01   +5.144306216800767e-02   +2.472631809305865e-01   +1.872367968107924e-01   +1.835798891813685e-02; +2.465454527145835e-01   +6.300253760072247e-02   +4.794222657926041e-01   +1.682036099822915e-02   +1.712292573207860e-01   +8.070335534191433e-02   +3.261720512059174e-01   +3.630926240913979e-01; +5.864087343872439e-01   +5.132001131821764e-01   +3.055801699191752e-01   +5.237704624489302e-01   +5.100728732106673e-01   +5.611247645421200e-01   +3.390050201458152e-01   +5.062198034985881e-01];
L2I_L3I_iGABA_netcon = [+5.660422252595134e-01   +3.369689673717005e-01   +3.768564635960966e-01   -2.376892951208038e-03   +1.231302421880130e-01   +6.894484846826723e-01   +5.469204790629641e-01   +4.597454626569175e-02; +1.723399914604031e-01   +8.658792281311199e-02   +3.054087014253707e-01   +6.012757672457550e-01   +4.276747512724453e-01   +5.401010350911234e-01   +3.769565931223570e-01   -8.232103625434009e-03; +4.344285108835412e-01   +1.320094033141656e-01   +2.522946694273255e-01   +2.731806325637882e-01   +5.671848563831059e-01   +4.468858773302786e-01   +1.458988853101962e-01   +9.606929488509292e-02; +2.064785542514518e-01   +3.574223660360289e-01   +4.485989805391907e-02   +1.235880570449017e-01   +4.509030350438057e-01   +6.620958143497452e-01   +3.361124564777980e-01   +2.004626021262325e-01; +3.352808039996859e-01   +3.227123243824182e-01   +1.487635962393262e-01   +3.707405249031023e-01   +1.161362613570122e-01   +2.935933995509920e-01   +1.243847879174867e-01   +3.354918774666820e-01; +3.942889270045074e-01   +3.963465038376077e-01   +5.420257397654249e-01   +4.841050639573329e-01   +2.274088250259828e-01   +3.508209502940668e-01   +6.083024538719952e-01   +2.184528606602908e-01; +1.932030995463029e-01   +1.629668737478108e-01   +3.136080215150892e-01   +4.636498088788288e-01   +4.022153588285999e-01   +2.283596815751880e-01   +2.963954360456152e-01   +4.364597826653656e-01; +4.078177352788042e-01   +5.192849417238254e-01   +5.802456234944062e-01   +6.293118377991948e-01   +4.906386843177706e-01   +7.610123498125258e-02   +3.342769260721210e-01   +4.824676954837686e-01; +4.959682423996798e-01   +4.161818753367181e-01   +1.972716935313223e-01   +6.043240912195303e-01   -1.202441442650147e-02   +1.746376216159427e-01   +2.129871185974114e-01   +4.797870329733529e-02; +7.721468933616417e-02   +2.466709995310463e-01   +4.259328214088678e-01   +6.493859981009667e-03   +3.246422368170234e-01   +5.119940044560199e-01   +6.281592674011929e-01   +6.269794231639051e-01; +5.087345644526876e-01   +1.916268385210527e-01   +4.920582194849568e-01   +3.422397030203056e-01   +5.626951370813251e-01   +1.765795228361758e-02   +3.218028090559351e-01   +2.211685184652109e-01; +7.935680071491023e-02   +3.999717448875708e-01   +5.633060283993860e-01   +4.637995492631367e-01   +6.398161062877862e-01   +2.712847573013789e-01   +5.614057115067949e-01   +5.891082045145114e-01];
L3I_L3E_iAMPA_netcon = [+2.004397011740531e-01   +8.253832369524898e-02   +4.420550771363686e-01   +4.017925853041384e-01   +3.030365714081198e-01   +1.955551521127743e-01   +3.308572458614829e-01   +2.351246185094685e-01   +5.170482284668699e-01   +5.769883892696593e-01   +2.339703979958966e-01   +4.793168661818438e-01; +3.109116407352279e-01   +6.356256898742718e-01   +2.019251394337885e-01   +4.256809867674919e-01   +5.235505090913507e-01   +1.011587849442588e-01   +3.077858755740688e-01   +1.171430436997176e-01   +4.964568869145653e-02   -3.365499531014803e-03   +3.894838918860664e-01   +2.748823249827805e-01; +1.227646965102854e-01   +2.571500193557871e-01   +9.489881059324813e-02   +3.072066589254396e-01   +5.352098499995090e-02   +4.490682372620515e-01   +5.585735131994399e-01   +5.401103781073940e-01   +2.566763765427509e-01   +4.423121046707409e-01   +3.112837463252844e-01   +3.085299578225767e-01; +5.511084037394696e-01   +4.674951254860412e-01   +6.172656241817425e-01   +3.727858537337478e-01   +4.840152336576540e-01   +3.995161950717753e-01   +1.480779942360701e-01   +7.486300445167945e-02   +5.434561975593729e-01   +4.460242686436806e-01   +4.038283659319708e-01   +6.524622710833686e-01; +6.335632578836341e-01   +5.203052626621663e-01   +5.591413276962776e-02   +5.023794585994030e-01   +5.323907192571704e-01   +2.103857174042111e-01   +3.337116480205471e-01   +3.127186862744714e-01   +5.406886859375212e-01   +6.976267687495631e-01   +5.357213924826011e-01   +4.114367039006714e-01; +9.089897822153072e-02   +5.430192342852560e-01   +3.009363381398474e-02   +2.416046510399715e-01   +5.179673087148330e-01   +2.181683324397194e-01   +2.989739820472479e-01   -3.200093056325909e-03   +5.777391868642099e-01   +3.233166287133506e-01   +7.438572818340801e-02   +4.924830915231722e-01; +2.757381323881545e-01   +1.251593262423697e-01   +8.924007160982575e-02   +5.192329064547930e-01   +9.590968066292896e-02   +2.349358476292524e-01   +5.582681142375908e-01   +5.642495607547829e-01   +4.828145876468281e-01   +1.414785502701312e-01   +4.836057681298137e-01   +4.640020150837661e-01; +2.560004541252360e-01   +4.867965747678526e-01   +1.849592473308967e-01   +4.293890718331470e-01   +6.897560551569557e-01   +6.673338396439751e-01   +2.542908376485253e-01   +6.567126482976162e-01   +3.991798133647229e-01   +2.726688779316740e-01   +3.578932421869222e-01   +1.964639281023440e-01; +1.527182551830631e-01   +5.642871763397148e-01   +1.831125128451923e-01   +6.415712120200591e-01   +5.135314259338326e-01   +4.646260195841782e-01   +9.451666047111530e-02   +1.065140038193603e-01   +5.287797385078191e-01   +3.016899112176519e-01   +4.237390227185930e-01   +2.427661233759411e-01; +5.622268896950576e-01   +4.066139739161224e-01   +3.688491354056239e-01   +4.019671448631189e-01   +4.376199400500567e-01   +2.322598260995329e-01   +3.135611726976947e-01   +5.312472583552014e-01   +3.483733613495043e-01   +5.925459700902388e-01   +2.071002773448973e-01   +2.955332876916382e-01; +4.396329363601016e-01   -8.660227205767417e-04   +2.409208213647949e-01   +2.241365231728293e-01   +3.423529199499368e-01   +5.206881253062184e-02   +3.437950334116183e-01   +5.956554060782379e-01   -3.728209901289028e-02   +1.406269114659561e-01   +1.414558631972894e-01   +2.556700944495521e-01; +3.790965924834144e-01   +2.800852000449233e-01   +5.836497270416475e-01   +1.552964544991211e-01   +3.074094999102652e-01   +4.275921636217944e-01   +1.242561789541172e-01   +3.707829834519147e-01   +1.317627518897272e-01   +4.603749657631208e-01   +2.840510679431649e-01   +1.679816969808692e-01];
L3E_L3I_iGABA_netcon = [+2.764377675509517e-01   +5.637434780730242e-01   +5.258328434673374e-01   +1.771903669217441e-01   +1.942087663730541e-01   +5.976559112569466e-01   +5.929635446239573e-01   +4.894394496534535e-01   +3.200017852122320e-01   +3.239023353660123e-01   +7.157427227296700e-02   +2.997968329978289e-01; +2.890110249223961e-02   +4.036891796431979e-01   +1.156013464828915e-01   +1.103263854641778e-01   +2.364249321180879e-01   +5.226622215510222e-01   +4.721513024415973e-01   +3.023438532553260e-01   +5.089282695844686e-01   +3.721829013751574e-01   +3.545426621062464e-01   +4.904166130467373e-01; +3.476961947682832e-01   +5.649859829509268e-01   +5.660082642544726e-01   +5.441082095550676e-01   +4.452499056197187e-01   +1.001501587018207e-01   +2.753855267321738e-01   +3.520000745178744e-01   +4.016295238371274e-01   +5.430839046309979e-01   +4.194118942535970e-01   +6.114421611341980e-01; +5.298427972541163e-01   +4.691998163728050e-01   +3.031586005399696e-01   +2.579208936534284e-01   +3.035528333504068e-01   +2.293711003493318e-01   +2.941059039611372e-01   +5.719043885204205e-01   +1.906121241273367e-02   +3.134038575371851e-01   +3.953984357234754e-01   +6.883327890263591e-02; +7.079509304108807e-02   +3.193446956071353e-01   +6.924074141081007e-01   +1.553217151964466e-02   +4.207779867568141e-01   +1.878482259091078e-01   +1.621081345678327e-01   +5.002607526040257e-01   +6.485012383209056e-01   +5.863346525001498e-01   +1.467048370516245e-01   +4.542410962111540e-01; +5.292545760971590e-01   -2.929752544021079e-02   +5.590834142986921e-01   +2.831880533348728e-01   +1.123848311359990e-01   +1.279228533815218e-01   +3.050839478069442e-01   +3.285865367889341e-01   +6.073575779542153e-01   +2.660163957639930e-01   +3.845968200818329e-01   +5.942379084808378e-01; +4.502412320191987e-01   +3.746488695311655e-02   +3.967986090613194e-01   +3.359054760936189e-01   +6.909976734436379e-01   +2.410913629006575e-01   +8.145874139376787e-02   +3.303453539011102e-01   +5.168939960785721e-02   +1.276852415166721e-01   +4.134909971981681e-01   -1.127536963631437e-02; +5.759716829346855e-01   +3.475587593638928e-02   +4.559440131509188e-01   +7.661733859699620e-02   +4.649207679301779e-01   +5.166554877885200e-01   +3.241022978104526e-01   +4.901483140324037e-01   +2.678334588373456e-01   -3.120424013910946e-02   +4.501698646728295e-01   +2.756909502933418e-01; +3.663223612167242e-01   -2.872268848701127e-02   -5.512905473264464e-02   +2.483807059994740e-01   +1.932921035511165e-01   +5.268943143603811e-01   +5.622108681675011e-01   +3.209368388949655e-01   +3.365422482138796e-01   +5.673354716429725e-01   +2.147997111424782e-01   +6.045707729373436e-01; +1.101218797741651e-01   -2.581051502574679e-02   +3.379853090461214e-01   +4.806772187504176e-02   +2.897432767471735e-01   +2.765137213080263e-01   +4.855227493670860e-01   +1.489935519522070e-01   +3.641738390650401e-01   +1.788968573214670e-01   +2.381360429178548e-01   +5.535905478144210e-01; +2.677186821481370e-01   +5.156923701930490e-01   +2.627200717026680e-01   +5.587436997238431e-02   +6.828970125263060e-01   +2.143761775371869e-01   +1.799025470660220e-01   +2.790317774512053e-01   +3.499302719558651e-01   +3.342097593946189e-02   +3.228630451710855e-01   +2.729789107871899e-01; +8.365646277486294e-02   +2.789392632442225e-02   +2.574187067316850e-01   +8.922718373411020e-02   +5.288197321427145e-01   +2.859747187999466e-01   +2.399071234864982e-01   +7.112500777278103e-01   +4.165712649897991e-01   +3.574998076054904e-01   +8.447720316289252e-02   +4.791799612665069e-02];
L2E_Input1_iAMPA_netcon = [+2.249045508931236e-01   +2.791944003697852e-01   +2.533630780240337e-01   +6.381582855709375e-01   +6.210414564045721e-01   +3.219116780588966e-01   +3.067571566428836e-01   +4.466953133532197e-01];
L2I_Input2_iAMPA_netcon = [+2.360959033370781e-01   +1.237663615227601e-01   -2.353983912796256e-03   +2.587602800353155e-01   +4.872793049570832e-01   +2.010368700132606e-01   +2.498740550510459e-01   +5.365444972031548e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
