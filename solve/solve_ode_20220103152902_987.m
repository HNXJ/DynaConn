function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.823082710466145e-01   +2.850368097746056e-01   +5.995426394701422e-01   +1.298455601532418e-01   +2.397544515580728e-01   +6.452901484440879e-01   +4.991771134837856e-01   -4.909386929864074e-02   -6.005129119304904e-02   +2.057985230896160e-01   +5.041799231331434e-01   +4.345012687149747e-01   +4.195162624419033e-01   +3.669761849955278e-01   +6.077351567666894e-01   +3.533141165951613e-01; +3.385796417208262e-01   +8.074093040829199e-02   +2.582850179839875e-01   +3.426598105309410e-01   +4.700646939913282e-01   +2.303159523414242e-01   +2.380861702149443e-01   +3.925430283722368e-01   -6.399369372171024e-02   +6.396921270981540e-01   +4.119010955689940e-01   +5.503986388966937e-01   +5.968260387557968e-01   +2.584573644540941e-01   +4.536856129132372e-01   +4.100115677163975e-01; +4.827994895214811e-02   +2.317072204024976e-01   +4.434801425462444e-01   +7.815940489581645e-01   +6.623749548232264e-01   +3.659624084167118e-01   +2.642472098874372e-01   +4.254535161997712e-01   +3.930879423146205e-02   -1.194594060243856e-02   +4.187012382406613e-01   +6.950032049547131e-01   -2.007782959861785e-01   +1.995698657855614e-01   +5.431879148611825e-01   +1.854223040767566e-01; +3.435011382330134e-01   +5.375449647323229e-01   +6.022867099594783e-01   +8.090127983413978e-01   +1.331634219826518e-01   +4.803887702012147e-01   +8.095009721954535e-01   +4.585262795320971e-01   +6.786425812167308e-01   +3.859508361210375e-01   -1.314674599342841e-01   +3.414116299044689e-01   +5.403527221467268e-01   +4.559629866280547e-01   -7.981836658217643e-02   +2.389386268883140e-01; +1.910230439306571e-01   +4.460417451412286e-01   +1.788951039828852e-01   +4.135689697419177e-01   +2.528702069587543e-01   +1.253704841635495e-01   +4.122493054001324e-01   +4.103583883275339e-01   +7.268447055457979e-01   +1.138352084754930e-01   +5.275525733789039e-01   +4.345557302436664e-01   -3.461901209860310e-02   +5.133453648825701e-01   +2.948951056435521e-01   +1.471667621382340e-01; +7.474776112689320e-01   +6.454196397369949e-01   +4.720977568819063e-01   +1.854502256499417e-01   +8.928255183641740e-02   +5.827028209388136e-01   +5.801982261954848e-01   +2.884496932387997e-01   +1.205932179980350e-01   +4.807181892482900e-01   +3.388537083138352e-01   +6.494963724944558e-01   +5.292572220855059e-01   +3.964676506728863e-01   +7.421285136188928e-01   +2.342070137611146e-02; +6.433991050440526e-01   +6.033676488373643e-01   +5.723207218396734e-01   +2.088173449829470e-01   +4.422287667908838e-01   +3.140356969152782e-01   +4.222500420886313e-01   +1.233681461049354e-01   +1.580402049374910e-01   +9.764541736433520e-02   +2.633307347166920e-01   +4.905544078807183e-01   +5.377653047158583e-01   +3.793024258344943e-01   +5.646830315490267e-01   +2.328969770569119e-02; +4.113489262315699e-01   +4.573405762338096e-01   +6.126782287401088e-02   +6.646600458501887e-03   +4.018854177838635e-01   +2.275152165541759e-01   +4.089449899478340e-01   +4.620279015883383e-01   +2.138858955394074e-01   +2.670450781792202e-01   +2.836119699282311e-01   +1.134688212726553e-01   +1.596571075538970e-03   +5.518536892835989e-01   +6.272014929240068e-02   -9.087207392011151e-03; +6.059173445443548e-01   +2.006270026106350e-01   +6.912369253925918e-01   +6.664277700624288e-02   +6.148253990562441e-01   +4.654375726004153e-01   +1.331645255435109e-01   +4.860295694737224e-02   +4.636533028209699e-01   +1.828773664811705e-01   +4.222087089858804e-01   +4.291628677202972e-01   +4.943605145216272e-01   +5.128347710395352e-01   +2.605608138075698e-01   +3.960620156203559e-01; +7.654199573384184e-02   +6.058607950817966e-01   +3.281385754662246e-01   +2.935824445048102e-01   +3.950216530146069e-01   +8.443421484061143e-01   +5.461255879351955e-01   +3.736849377114744e-01   +3.701444329895697e-01   +9.455973956013008e-02   +3.279017358393476e-01   +4.248689195581115e-01   +2.389731218935784e-01   +8.818081362761045e-03   +2.438209393815392e-01   +2.413094297438075e-01; +5.102456671490448e-02   -1.627442226687466e-02   +4.772209748252871e-01   +5.638495875229411e-01   +3.689166573395619e-01   +4.976589339650122e-01   +7.863592220057638e-01   +2.058955557143660e-01   +9.370626148661312e-01   +2.285351015695078e-01   +4.267570886244293e-01   +3.521862162079171e-01   +1.002698055712013e-01   +1.842131453014170e-02   +6.520397342103346e-01   +1.518960649769429e-01; +1.780101375752541e-01   -1.143842158504590e-01   +1.515483138066915e-01   +3.487042750411458e-01   +1.602744877856756e-01   +5.390136859738144e-01   +2.640237197421985e-01   +7.018072268373613e-01   +5.299334390612130e-01   +5.429627213141692e-01   +3.078810514883153e-01   +5.221899345727919e-01   +3.685209589598421e-01   +1.695037004095906e-01   +5.367487661933046e-01   +7.515242322811980e-01; -8.523494733154603e-03   +1.594589612068367e-01   +4.548436348612567e-01   +2.139634023390213e-01   -7.832288454209001e-02   +4.583682306716743e-01   +4.675530910739653e-01   +4.503460037640226e-01   +7.728776478683532e-01   +7.836926753459307e-01   +3.016117302354528e-01   +5.881681373035218e-01   +6.052353780323926e-01   +4.795498305986126e-01   +1.000000000000000e+00   +2.618937669098632e-01; +1.610570085252069e-02   +7.608483484371186e-01   +6.043653933355551e-01   +1.508939891386180e-01   +1.401331281901483e-01   +5.405480606170473e-01   +4.128938904110011e-01   +5.248483109729930e-01   +2.364520523703310e-01   +6.419554597369944e-01   +6.221177955189774e-01   +3.561402674789842e-01   +6.139710397018485e-01   +3.546017192846563e-01   -8.624536155860188e-03   +4.991188870896519e-01; -2.128701727115964e-02   +4.241771924431809e-01   +6.442751726131065e-01   -5.606303537575482e-03   +1.029166054153930e-01   +1.108224532365494e-01   +5.970334035462012e-01   +6.622357767755789e-01   +1.002928271853664e-01   +6.708637073961128e-01   +1.955698771343156e-01   +1.223089978859747e-01   +2.672574033331111e-01   -3.542103052087091e-02   +4.020623951303590e-01   +2.479202067652691e-01; +3.351667007586496e-01   +4.249207827363028e-01   +6.345993726101673e-01   +5.995837081439920e-01   +5.758521334469532e-01   +3.293526480371265e-01   +2.172876811753508e-01   +4.080412857708684e-01   +3.292336031113371e-01   +5.141337286130204e-01   +3.011387712843698e-02   +3.119737619317199e-01   +4.211327643286318e-01   +6.063726706670719e-01   +6.399446796684609e-01   +6.510801863751663e-01];
L1E_L1I_iGABA_netcon = [+4.589735736676456e-01   +1.529996702306889e-01   +2.969382447606707e-01   +5.036596595095445e-01   +3.971313329655028e-01   +4.217017879795797e-01   -1.452065290645779e-02   +5.268290560481385e-01   +5.489700295924262e-01   +2.002351553519303e-01   +7.104962043337323e-01   +4.979866769225673e-01   +1.297048814619427e-01   +6.852929605966671e-01   +5.477474182230826e-01   +2.669140577743527e-01; +4.335839236060551e-01   +1.904920815541441e-01   +7.943354025461916e-01   +6.341980552904167e-01   +2.658082718515563e-01   +5.090235269310125e-02   +4.607896919309051e-01   +3.723632480799107e-01   +1.619747101554496e-01   +3.125818273374689e-01   +1.895050620041798e-01   +4.431076652298531e-01   +3.182992375229740e-02   -1.682789243447034e-02   +6.030615039661638e-01   +1.992809715778020e-01; +5.134882886793015e-01   +7.635484976403319e-02   +3.226374804926560e-01   +5.349742219030175e-01   +4.490657575688814e-01   +3.943163258518824e-01   +3.581447448671988e-01   +4.993280155451282e-01   +3.006241316797197e-01   +3.493136875358375e-01   +2.408599852897970e-01   +4.353602871439418e-01   +8.517457546584373e-01   +5.398911897574494e-01   -7.720919193991171e-02   +6.940057529872740e-01; -1.072724783729482e-01   +6.170030482007874e-01   +5.734782750054318e-01   +2.350133051278455e-01   +5.343190885874947e-01   +6.963712558459316e-01   +8.709562072955588e-03   +5.395269113258930e-01   +9.881678913491919e-02   +1.441148401592405e-01   +1.211980847883203e-01   +2.348870705135131e-01   -7.626205992326412e-02   +5.001324474090502e-01   +1.995354450995815e-01   +4.452556031962721e-01; +2.476273450629614e-01   +2.234160738733380e-02   +1.536677263742597e-01   +4.238698874703398e-01   +1.531349556046206e-01   +5.436010432629201e-01   -2.958483649807457e-02   -1.071675698407879e-01   +1.081258199391577e-01   +2.338292445388068e-01   +2.816746828336676e-01   +7.485286313743346e-01   +2.869665348564115e-01   -1.009693698601466e-01   +5.514161467977028e-01   +1.000000000000000e+00; +5.599725345296425e-01   +8.471671255288257e-02   +1.722060194425706e-01   +4.154542027298762e-01   +3.991121109727352e-02   +3.956171946817301e-01   +1.405223350425456e-01   +8.520177638716371e-01   +4.354015096792711e-01   +7.668974682432411e-01   +6.674094645702292e-01   +6.826264862601170e-01   +5.206595482696945e-01   +3.824971360418959e-01   +1.330989151315961e-01   +2.954202960056359e-01; +5.058558882558883e-01   +1.167975530286542e-01   -6.980167751601155e-02   -2.808891686468256e-03   +6.726447864420501e-01   +5.101419068565022e-01   +7.796426136449137e-01   +4.323509177338110e-02   +4.518224652812780e-01   +7.975349846847257e-01   -1.607611114349627e-02   +6.458815711257025e-01   +2.652474054012353e-01   +5.439332758075506e-01   +1.051654080622352e-01   +8.781574405634378e-02; +4.136692859970043e-01   +8.038882751672624e-02   +7.749657579995608e-01   +9.521953831172774e-01   +1.061517048609261e-01   +5.543604953702790e-01   +1.745459429177658e-01   +7.320250487871297e-01   +2.378147772881667e-01   +1.421540392261336e-01   +6.778523376796333e-02   +7.867637583696091e-01   +5.919866666735504e-01   +5.177386303352058e-02   -2.641810745463353e-01   +4.695069179971055e-01; +1.785436760642803e-02   +7.124635951487137e-01   +3.102167099911205e-01   -4.511802972147234e-02   +7.037142987775862e-01   +3.622908749861177e-01   +4.287527543663591e-01   +2.281327814665713e-01   +1.031046165297635e-01   +6.695721214230445e-01   -5.778683427875796e-02   +6.121692278904322e-01   +7.078921658862378e-02   +3.724802848167607e-01   -6.851388745380498e-02   +2.636775371181060e-01; +3.472512556482290e-01   +3.496492897402945e-01   -4.346868626569748e-02   -6.595214383319402e-03   +7.388815160150908e-01   -2.915617186857001e-01   +3.724481569790863e-01   +9.650489349740295e-01   +7.218603495403970e-02   +5.932921823007229e-01   +1.718301346090194e-01   +6.260352536506798e-01   +2.681039025939507e-01   +2.310242110825797e-01   +4.977627889714715e-01   +7.469855205198983e-01; +8.559412087816580e-01   +4.312591118729275e-01   +5.816574913587351e-01   +6.575125223368461e-01   +4.872644748400973e-01   +3.030301950223830e-01   +4.003606488031383e-02   +1.995676690011465e-02   +5.799297917435539e-01   -1.920543618174925e-03   +4.875610665968310e-01   +6.168838164199707e-01   -8.495140517952687e-02   +8.641984115734591e-01   +1.301335854163284e-02   +3.720516338672960e-01; +8.390315544486372e-02   +4.905368145576626e-01   +1.700519639068576e-01   +8.549599386216284e-01   -2.083964654785361e-01   +2.332076064084375e-01   +1.888435183928349e-01   +3.640380415395831e-01   +8.784099667779379e-01   +3.956830263458559e-01   +6.694126607461435e-01   +8.450065506290785e-01   +2.110637635217762e-01   +6.318198604572435e-01   +4.300354182192522e-01   +2.405905138991439e-01; +3.173497850499995e-03   +7.314303636349470e-01   -3.555690622363700e-02   +7.061332367559703e-01   +1.112927360127026e-01   +4.941190669430851e-01   +3.599628546582713e-01   +5.002567853522348e-01   +2.994940690475028e-01   +7.576129352193028e-01   +2.588907735264847e-01   +3.814474841834357e-02   +2.495705012341463e-01   +2.181466836563273e-01   +1.947560939705725e-01   +5.819175827788694e-01; +7.747336546901974e-01   +1.571986576802058e-02   +5.263888404942361e-01   +5.543051024253927e-01   +4.370910599154536e-01   +2.860091190694925e-02   +4.612066577512834e-01   +1.183223403119785e-01   +7.623024472566096e-01   +2.411711142039444e-03   +4.963401630905597e-01   +7.305023552663814e-01   +4.903811239121725e-01   +5.504581980624208e-01   -5.709559158183443e-02   +3.487432180177976e-01; +1.312102325412033e-01   +3.005176536442277e-01   +1.714667416308237e-01   +1.203624400718531e-01   +4.877127647342293e-01   +3.072054944874192e-01   +6.423510392119260e-01   +7.385570711385223e-01   +7.513380111064161e-01   +4.600367511127358e-01   +6.597771532204320e-01   +4.539955486792354e-01   +2.558003067594362e-01   -7.788783642982836e-02   +2.663881797297155e-01   +2.349872292553311e-01; +5.018553671982938e-01   +1.301237359917096e-01   +6.452152547907576e-01   +5.647718088134555e-02   +4.535003333016615e-01   +6.510457573185502e-01   +3.562011258026928e-01   +2.642899086657702e-01   +6.811370331558207e-01   +7.917651756174205e-01   +7.362279108506505e-01   +3.639695729593524e-01   +4.647080047234586e-01   +1.496177150185551e-01   +6.991289023579622e-02   +3.118154506278974e-02];
L2I_L1I_iGABA_netcon = [+1.541044576880189e-01   +4.985082873788361e-01   +6.709511977063387e-01   +4.202593022946936e-02   +5.779504633035383e-01   +2.408790726237647e-01   +4.165767341745070e-01   +5.159673485467813e-01; +2.018426883422108e-01   +2.928748907912914e-01   +2.903013215960860e-01   +1.838835212659762e-01   +7.436514900292279e-01   +3.328056427517024e-02   +4.600676509322783e-01   +7.314287789834533e-01; +2.962290035534269e-01   +4.325337399962699e-01   +5.396155447768093e-01   +6.627155060771944e-01   +4.594023557186366e-01   +4.294190550948971e-01   +2.394895655043767e-01   +1.015045510054653e-01; +3.354071441977648e-01   +3.091858267718831e-01   +5.257848720185034e-01   +7.196283136732231e-01   +1.604468742729441e-01   +1.473540828202933e-02   +4.251585614912650e-01   +6.169688666717212e-02; +9.409038153272622e-01   +2.200579492987114e-01   +2.272949933393031e-01   -1.081716673472598e-01   +5.667176627505104e-01   +1.196332775667520e-01   +1.000000000000000e+00   +3.761141788709258e-02; +5.515743279509967e-01   +5.032669538182609e-01   +7.480993639605718e-01   +7.661248984245876e-01   +6.904297603208808e-01   +6.067378301409838e-01   +5.113668455692281e-01   +6.381555998541864e-01; +8.289360162580243e-01   +3.262745876528531e-01   +3.420908673273395e-01   +1.194790393416737e-01   +8.200157042010735e-01   +4.068817636730986e-01   -9.584239836583960e-02   +4.421645433637901e-01; +5.649948794977865e-01   +4.114972812909589e-01   -2.035618019365736e-02   +6.642847264873275e-01   +5.199249290683725e-01   +7.360155022364970e-01   +5.021213143022171e-01   +1.852154931559250e-01; -8.104922052747524e-02   +4.828607922096345e-01   +1.279757489968234e-01   +3.431847926419151e-01   +3.946555970649959e-01   +6.873429011252528e-01   +4.286750803356558e-01   +3.171483800689327e-01; +6.632617949002100e-01   +8.820185837848338e-01   +5.421456654706419e-01   +4.916635295079532e-01   +3.315620327067566e-01   +1.313734902045114e-01   +4.069804780535474e-01   +1.537627797725176e-01; +3.327804461651734e-01   +6.994805323296099e-02   +6.409691343124807e-01   +5.576631102465837e-01   -1.833034965531702e-01   +2.912949253700560e-01   +4.204963978150202e-01   +1.208614888894865e-01; +3.083616127249458e-01   +1.188692886283180e-01   +3.266433695381296e-01   +6.195861932460952e-01   +2.492097180246313e-02   +4.829754993321084e-01   +6.357960010497209e-02   -6.815074116185579e-02; +7.402961500401664e-01   +8.761959031621513e-01   +2.532363613149547e-01   +4.599607060649148e-01   +2.629766412194751e-01   +8.401615501789648e-02   +4.755827746892050e-02   +6.557114651446050e-01; +2.615012873512836e-01   +7.369372718820426e-01   +4.988698479365467e-02   +6.391521695238275e-02   +6.282699793541203e-01   +5.734961687540325e-01   +5.646350929534844e-01   +4.567972340510018e-01; +1.919228769620711e-01   +4.543239414332896e-01   +3.120069937313093e-01   +2.729030489675877e-01   +5.115490163782900e-01   +1.962940852577518e-01   -1.309775858705427e-01   +5.821898034860294e-01; -1.374707797073613e-01   +1.911897033255907e-01   +5.998066398896766e-02   +6.512872127267197e-02   +3.888290042891231e-01   +6.512216859614048e-01   +3.115824039522665e-01   +4.519681944032022e-01];
L1I_L2I_iGABA_netcon = [+1.886555927941760e-01   +7.373190076136027e-01   +3.145418705221479e-01   +2.193312467123328e-01   +8.316643516033946e-01   +8.911329796671633e-01   -1.366162557598287e-01   +4.044402703030394e-02   +2.218577290958683e-01   +5.292426775507432e-01   +5.473276907383693e-01   +4.010728670955461e-01   -2.220281091267427e-01   +4.333390899363208e-01   +2.246149914758017e-01   +6.569469694334110e-01; +6.449754281642542e-01   +5.978424062229490e-01   +4.693602140006405e-01   +2.776529169982425e-02   -1.932917065901314e-02   +2.509683196620910e-01   +4.268636392175830e-01   -4.982678913623388e-02   +2.007435844128655e-01   +9.373302037966949e-02   +2.656860030868597e-01   +2.957496462508641e-01   +7.685789648039481e-01   +4.024787094948596e-01   +9.818591695798869e-01   +5.112710935498616e-02; +3.339824071177513e-01   +4.234477046810570e-01   +7.186451798458826e-01   +1.772394380670299e-01   +1.112049079134618e-01   +1.085878042024176e-01   +6.883114215269613e-01   +4.523124527143240e-01   -1.423105630870591e-01   +8.213855843078501e-01   +1.648803852489009e-01   +3.823129187669572e-01   +4.704231898018649e-01   +5.284119275241960e-01   +1.675719392780346e-01   +2.056699542561660e-01; +6.058484236115412e-01   +4.345892153417767e-01   +4.832665748537041e-01   +3.833291615518369e-01   +7.432079746466311e-01   +4.246982138866627e-01   +3.128035952744219e-01   +1.543995625680431e-01   +4.397433773524278e-01   +3.185681875513967e-01   +1.512149073553703e-01   +2.270849610238905e-01   +2.931447950063891e-01   -2.311217304058656e-01   -1.053254839571337e-01   +3.067795513512631e-01; +5.860450677914784e-01   +6.180636421034919e-01   -1.652713235951663e-01   +7.740855700707874e-01   +4.623018104272617e-01   +3.392728413023959e-01   +3.172686516544694e-01   +1.102567486975984e-01   +8.453765519875910e-01   +6.202314852732024e-01   +7.540129379669215e-01   +7.848460323924612e-01   +6.684247539740176e-01   -6.062124187769935e-02   +5.150658010677509e-01   +5.890376099462125e-01; +3.944285500681581e-01   +1.554015776730460e-01   +6.097768740754432e-01   +1.574642713136060e-01   +4.449337108878151e-02   +3.343119224997259e-01   +4.700389536789019e-01   +5.404401355978597e-01   +5.764899899913540e-01   +5.774973146302680e-01   +6.642598844403537e-01   +4.657598399518364e-01   +5.859979199926227e-01   +9.773330074741036e-02   +4.057797935750653e-01   +5.793654873805907e-01; +2.317231984286481e-01   +1.215341933745480e-01   +3.790492606632915e-01   +5.451166699246384e-01   +5.775460450842697e-01   +4.055342779987096e-01   +2.441849953979111e-01   +1.753795739765811e-01   +1.258014931204598e-01   +2.149625336885131e-01   +2.074013332164175e-01   +9.430525093674691e-02   +3.841803856208793e-01   +3.358033342441284e-01   +6.693977254405903e-01   +3.830397935493614e-02; +3.611110103314611e-01   +7.488504789362695e-01   +4.870995158125988e-01   +2.380318885733945e-01   +6.330165753906523e-01   +2.381446812031187e-01   +5.585948545806069e-02   +3.828692482615802e-01   +4.945425436916423e-01   +1.585261479600484e-01   +2.626796185839429e-01   +8.016752107305986e-01   +6.051574576768333e-01   +5.928364286775146e-01   +3.611510626522383e-01   +5.114239929833180e-01];
L2E_L1E_iAMPA_netcon = [+3.537045931589048e-01   +3.880734595798800e-01   +5.398358890321869e-01   +2.772966804047032e-01   +4.311486332155011e-01   +7.130146831719713e-01   +4.233949449437880e-01   -1.000912943284553e-01; +2.699974138258052e-01   +2.048783270879178e-01   +2.534068712386324e-01   -1.421649546416388e-02   +2.142434083231633e-01   +2.031481409748107e-01   +5.102991575633360e-01   +1.341721711713920e-01; +5.118252410512809e-02   +4.484391583039062e-02   +7.618831686901437e-01   +5.235936980203569e-01   +3.131665540615112e-01   +5.461749418158420e-01   -5.698065758890337e-02   +5.751643091614649e-01; -7.296724416533536e-02   +3.548084951394485e-01   +7.743563798877322e-01   +1.178287438538403e-01   +3.168728820934690e-01   +4.732554517497773e-01   +1.004394481531955e-01   +4.072559363167907e-02; +6.956682100273218e-01   +2.106297619418729e-01   +4.334070646234063e-01   +6.566776508934821e-01   +6.779569999162099e-02   +6.396824045341661e-01   +6.873362507529477e-01   +7.539725764360413e-01; +8.510940394450036e-01   +7.980800235482351e-02   +5.150601325015917e-01   +5.744591674772730e-01   +4.422647064122344e-01   +7.286443047587089e-01   +6.723546860903521e-01   +6.993518573913894e-01; +5.653977249382909e-01   +5.470980177941390e-01   +6.906389587223324e-01   +1.799767566166310e-01   +6.165172477275654e-03   -2.503159626006438e-01   +4.142852807078841e-01   +7.944520266808716e-01; +5.414182760445421e-01   +8.864379443597343e-01   +5.117628001114021e-01   +3.738699578716172e-01   +4.524580225143623e-01   +6.783523638932778e-01   +6.031297312204501e-01   +5.358082803619623e-01; +9.951938598726505e-02   +4.063094680416225e-01   +5.603078445553342e-01   +5.075562229606146e-01   -5.654988691437934e-02   +4.353767267922519e-01   +6.104347052900285e-01   +7.768898242491612e-01; +1.390674352799537e-01   +7.897994293599367e-02   +2.798680700941135e-01   +2.718016047209567e-01   +4.683674093550958e-01   +4.086368671023447e-01   +3.569255659623641e-01   +4.921595056535493e-01; +3.177064956327277e-01   +8.436879818817028e-01   +4.087870375713077e-01   -2.197085242818798e-02   +5.274684094204187e-01   +7.077353899901728e-01   -8.390264777490061e-02   -3.156539782482357e-02; +1.930552748952324e-02   +3.575470411869421e-01   +7.028483731575368e-01   +1.753124755335903e-01   +1.278120957553814e-01   -9.459845293812914e-02   +4.908376041210587e-01   +3.083351250553339e-01; +1.438939716829730e-01   +4.454390206539879e-01   +1.000000000000000e+00   -1.532796300935573e-01   +3.826181066625509e-01   +2.319367899574863e-01   -1.909370012885428e-01   +6.904358472990766e-01; -3.462119993762037e-03   -1.509145226756718e-01   +2.558672209512402e-01   +3.952243423251629e-01   +5.162697690199467e-01   +8.677315838968630e-01   +5.701011694177358e-02   +2.712864309020919e-02; +4.402072863028617e-01   +5.603202386435038e-01   +2.144458746592711e-01   +4.501527468594470e-01   +4.124956303329783e-01   +2.368239105956986e-01   +4.559122782898579e-01   +5.825383871164185e-01; +4.844216124922847e-01   +5.199847316061564e-01   +2.509621243227396e-01   +3.298761731412082e-01   +6.323447924666406e-02   +4.448814898195692e-01   +2.644684888374488e-01   +3.545198459730425e-01];
L1E_L2E_iAMPA_netcon = [+4.944238108004064e-01   +3.819567757453096e-01   +1.900682203546161e-01   +7.477208633722846e-01   +8.119318743324789e-01   +5.404015078257234e-03   +2.841204102299479e-01   +7.078336071753742e-01   +1.735485443060683e-01   +2.897294406928622e-01   +4.644295632341108e-01   +9.024546444591626e-01   +1.021757396392923e-02   +3.784949331080398e-02   +8.157442971219840e-01   +2.094235664046829e-01; +1.068979371097569e-01   +8.104669994006074e-03   +6.088090597507180e-01   +4.516797307564728e-01   +3.393017777267760e-01   +9.707407643506995e-02   +2.236005299352740e-01   +1.761825640591528e-01   +5.622050921149742e-01   +9.587935034288840e-01   +5.821756356056752e-01   +1.774629217898242e-01   +9.742775823432279e-01   +8.782969370107723e-01   +2.996344202163841e-01   +5.007455060523481e-01; +2.767808348262235e-01   +7.822810254204468e-01   +3.789017214090429e-01   +3.030881809154211e-02   +6.298054815712216e-01   -9.144774299719616e-02   +7.110611366778953e-01   +5.922143572199289e-01   +6.242567417572281e-01   +2.764757749101823e-01   +6.359129171695630e-01   +3.128614003034002e-01   +4.999835022822686e-01   +4.357236869044530e-01   +1.166202375665998e-01   +4.142472999762266e-01; +8.244192706386635e-01   +1.349156635833877e-01   +3.270802331136246e-01   +1.363007147720643e-01   +2.704085900881564e-01   +3.900379963227383e-01   -1.084838323600474e-01   -5.469616240100117e-03   +8.914103158688023e-01   +3.667311219416126e-01   +4.738271913165796e-01   +1.261714004141203e-01   +3.790752441376037e-01   +7.322910118781515e-01   +6.450536675978724e-01   +3.642643027282194e-01; +5.224009103305425e-01   +1.519284845493758e-01   +3.105924533212145e-01   +2.904635646328663e-01   +3.186685396062803e-01   +6.861872820078470e-01   +1.612606834804945e-01   +3.845277396999519e-01   +4.396572395942115e-01   +3.333636774209758e-01   +2.685473870250910e-01   -3.334912656652474e-02   +4.109850436589302e-02   +6.263779011700843e-01   -2.751411318806832e-01   +7.083207986662334e-01; +9.285345972344107e-01   +9.584651776546928e-02   +3.372042208658989e-01   +6.326452657853920e-01   -5.900180972777591e-02   +6.924269103784411e-02   +4.640237438940847e-01   +2.073664850136214e-01   +5.728089169429896e-01   +2.265517920904873e-01   +2.269751604291561e-01   +6.754436512538485e-01   -1.353125378050786e-01   +7.135189462121735e-02   +2.134904871432454e-01   +6.674438999091068e-01; +2.483738288717635e-01   +3.869559610514245e-02   +4.534376532958724e-01   +2.966821760972745e-01   +9.065870410920492e-01   +4.544904526150806e-01   +6.457166716998737e-02   +6.180282955733465e-01   +3.991961085451710e-01   +8.162411520495978e-01   +5.803474519092434e-01   +2.700934717775502e-01   +1.185203335724379e-01   +2.415064708174491e-01   +5.709513863292296e-01   +2.796683006326902e-01; +4.033223669322888e-01   +2.975716480843358e-01   +8.284101981374059e-01   -6.172908631372837e-02   +8.610913593225452e-01   +1.751255193166788e-01   +2.311520029992738e-01   +1.301459915943068e-01   +1.549030060336723e-01   +7.903640111890121e-01   +4.508784884529122e-01   +7.191397348573544e-02   +8.745671952353151e-01   +7.191282825540538e-01   +2.335904648050286e-01   +3.839025658620310e-01];
L2I_L2E_iAMPA_netcon = [+4.952649951502536e-01   +8.995703397485444e-01   +2.788127152659997e-01   +5.785414762729189e-01   +7.575596095748643e-01   +8.042648756355366e-01   +6.921628521674180e-01   +3.531660526507687e-01; +9.920581637528649e-01   +1.335805819286313e-02   +2.664256903159108e-01   +1.754466649170460e-01   +6.678808505173371e-01   +2.398780330805562e-01   +1.598079021815613e-01   +7.292643202604984e-01; +9.486960433030256e-01   +3.192648558058965e-01   +6.717217236942696e-01   +4.587594368035087e-01   +3.436558788249038e-01   +5.070322609627329e-01   +9.116391482954017e-02   +7.638513917672854e-01; +4.223351178281913e-01   +7.892164272921858e-01   +3.933589260052260e-01   +1.795527020833367e-01   +4.111383141139716e-01   +4.252518273647091e-02   +5.831607625390895e-02   +4.442395285897975e-01; +4.523450499378998e-01   +2.993281629530185e-01   +6.471736788771795e-01   -8.846549412501908e-02   +6.955615280509962e-01   -2.313460069751593e-02   +6.820281145717427e-02   +4.777242217632319e-01; +1.171086131677601e-01   +1.870429677066432e-01   +5.493952548463663e-01   -8.042048614012157e-02   +4.584367208335293e-01   +5.552856758883101e-01   -4.430083683201592e-02   +2.872423768917560e-01; +4.319618032153011e-01   +1.067028133421259e-01   +5.026636695370286e-01   +6.866003328456572e-01   -5.189338871748939e-02   -1.655547777248821e-01   +3.840847094689642e-01   +5.792233677161368e-01; +5.159043705308933e-01   +4.398457165608036e-01   +9.658113401337043e-02   +6.990249302772809e-01   +1.667862881398915e-01   +8.271081725751448e-01   +3.457110511693528e-01   +7.147492665956373e-01];
L2E_L2I_iGABA_netcon = [+1.448262874917046e-01   +3.498820958760414e-01   -2.756794835737455e-01   +8.951176998425937e-01   +4.187266875369339e-01   +9.065758090745022e-01   +5.429681021381726e-01   +1.223614071782362e-01; +4.971981650978518e-01   +6.761980790328160e-01   +2.747687252643759e-01   +3.823145357701485e-01   +6.140420727099246e-01   +4.492434849873699e-01   +8.143902485189913e-02   +7.800586920219735e-01; +3.319286390362474e-01   -1.925910249349036e-02   +4.934270671603840e-01   +3.773772311420823e-01   +1.885928986134624e-01   +2.442452780086480e-01   +1.899767216916119e-01   +5.456572380864703e-01; -8.631869880610851e-02   +6.117772781685369e-01   -4.354389294194635e-02   +8.077006000095955e-01   +3.161443683367000e-01   +4.733686642533908e-01   +7.746791307984336e-01   +8.694608392090324e-01; +3.832791236626130e-01   +4.986199633469943e-01   +2.206488338760641e-01   +2.299784928541390e-01   -1.672872914779100e-02   +3.981958333740730e-01   +1.374737863910456e-01   -1.236251768683297e-01; +6.527725536856109e-01   +8.809143782546280e-01   +9.361572314813627e-01   +9.500117377378138e-01   +7.133850216302262e-01   +4.616667801347104e-01   +2.619239078928314e-01   +5.215822498722630e-01; +1.758002276252956e-01   +3.680676315232211e-01   +1.577169362951928e-01   -1.364617040954399e-01   +3.969125134281702e-01   -1.251976176273141e-01   +2.122543706773024e-01   +6.695396233530954e-01; -6.059896729062284e-02   +7.039075472112920e-01   +3.434275163333128e-01   +8.142291473562517e-02   +5.457829816136809e-01   +2.316232404241940e-01   +5.908841040531499e-01   +8.052932471132723e-01];
L3E_L2E_iAMPA_netcon = [+4.986602820565841e-01   +3.985538421449543e-01   +6.476815064158751e-01   +7.850014867234051e-02   -8.190422647637934e-03   +8.610372959847508e-01   +6.960312137862953e-01   +5.965260209988605e-01   +4.744146442228966e-01   +3.265664063403099e-02   +3.349730955758834e-01   +1.347243131645191e-01; -5.390282535983788e-02   +6.451095911031548e-01   -5.910054941484508e-02   +9.193042390138964e-02   +3.968551985359339e-01   -1.833088035302634e-01   +4.864445854826257e-01   +2.187034432117231e-01   +3.319088988327474e-01   +2.555075718789249e-01   -1.172904367416259e-01   +2.289774127481510e-01; +3.058456790125231e-01   +1.359835558874555e-01   +1.081178639907886e-01   +5.406275921117145e-01   +3.526226401343970e-01   +6.791826980589227e-01   +6.893649855007692e-01   +7.007058838086406e-01   -6.781072107576942e-02   +6.698416667672333e-01   +3.715655468807353e-01   +7.819990369722365e-01; +7.120152257587374e-01   +5.455817180681981e-01   +6.905704453348166e-01   +4.801522413776285e-01   +4.586878865630539e-01   +9.753686686749076e-01   +2.227294260406610e-01   +2.357148307290583e-01   +5.495305076431449e-01   -4.331446214039375e-01   +2.426541726697504e-01   +7.304900395188451e-01; +5.195593308731808e-01   +4.011447612437057e-01   +3.782698947771446e-01   +3.424385902171134e-01   +1.028544962244016e-01   +4.810698071929772e-01   +3.550366626748989e-01   +6.441456042547498e-01   +8.096501490131326e-01   +4.475416483394188e-01   +6.603724586078716e-01   +1.871856997815824e-01; +2.696199238570242e-01   +1.578936328418038e-01   +4.485870585398467e-01   -1.682767095561372e-01   +6.339589520781141e-02   +5.213888842196663e-01   +4.157051611703946e-01   +6.118217048091399e-01   +4.494407227882704e-01   +5.289650065012611e-01   +3.326441750164293e-01   -1.542448500598630e-01; -2.229641944564052e-02   +1.441756354264172e-01   +2.631673149664403e-01   +3.856495018595308e-01   +1.000000000000000e+00   +7.354367843447128e-01   +5.908257241458791e-01   +4.857464965608184e-01   +5.672788754221626e-01   +2.396785627770000e-01   +1.414475422424573e-01   +5.452917894900610e-01; +3.146052272539833e-01   -7.979563568726983e-02   +4.671690354060333e-01   +7.258722452978366e-01   +3.632399269417535e-01   +5.753430394881289e-01   +6.013062102859510e-01   +2.266177267887335e-01   +5.578636588156118e-01   +2.959891656394613e-01   +3.876639633658542e-02   +6.775141226843413e-02];
L3I_L2I_iGABA_netcon = [+6.885194236653734e-01   +6.317267907963178e-02   +3.072686600789133e-01   +5.866008193826607e-01   +3.240158236573465e-01   -4.077238015994794e-02   +1.831320695280755e-01   +3.209297719996840e-01   +2.787357521434394e-01   -1.384510561320487e-02   +8.741859778856992e-02   +8.369348871904633e-01; +7.294700753723381e-01   -2.156733577943560e-01   +9.260960730653975e-02   +4.410809006301900e-01   +7.764634486772440e-01   +3.298893694132123e-01   +4.597537319174583e-01   +5.643620976007617e-01   +2.503289705031823e-01   +3.812492374697240e-01   +1.241944328039360e-01   +4.490973295539556e-01; +5.458092564269158e-01   +2.602928529545741e-02   +5.975861878749906e-01   -1.099299279945658e-01   +6.055523701555573e-01   +1.768019188643813e-01   +5.089549713960365e-01   +1.187903122055305e-01   +2.657233530430731e-01   +4.413173527166573e-01   +2.261390061368803e-01   +9.345097351585586e-01; +3.998840053026863e-01   +2.194018979350393e-01   +7.256030447064158e-01   +8.764545266725745e-01   +3.590130928773705e-01   +7.542660930285180e-02   +5.745346586892530e-01   +1.971052544475755e-01   +7.449707638164939e-01   +1.304508634503083e-01   +1.371222334148383e-01   +5.143244368133841e-01; +2.895493170899026e-01   +3.050993765256864e-01   +4.878486514180821e-01   +7.431247831739081e-02   +4.811198130447304e-01   +5.546381529453400e-01   +3.613058564941684e-01   +2.081239606571587e-01   +1.715283933423256e-01   +1.510434502069889e-01   +8.552886802396684e-01   +1.462020817425246e-01; +5.957739959611954e-01   +4.858684848619509e-02   +6.486804635064762e-01   +7.256660364154749e-01   +6.098830319663091e-01   +8.805684884426786e-02   +1.811194860736929e-01   -1.022457154511000e-02   +2.746933775707500e-01   +1.083405464687710e-01   +2.613391235781061e-01   +3.599130749691779e-01; +3.691133484493244e-01   +6.633698261345015e-01   +7.553479512104599e-01   +1.141636461115558e-01   +1.746386534313341e-01   +5.347041462787400e-01   +4.070135227468248e-01   +6.445171311093346e-01   +2.176402088010657e-01   +8.485036018782374e-01   +3.692474209515552e-01   +6.857619861854630e-01; +5.845378766522781e-02   +1.704954771720193e-01   +5.245712314509782e-01   +4.585152792980669e-01   -4.920312357556739e-02   +1.476706377079470e-01   +1.366546384260656e-01   -1.162763294591430e-01   +5.281403717394453e-01   +3.049390967780825e-01   +3.234281070356620e-01   +2.437793349220793e-01];
L2E_L3E_iAMPA_netcon = [+1.574872186993096e-01   +8.980335708357297e-01   +4.841400210947121e-01   +8.048264847043252e-01   +3.391882076733655e-01   -8.593143266583133e-03   +3.721763243886912e-02   +3.410619583012115e-01; +3.842021482763195e-01   +6.361631192432745e-01   +3.962233169821221e-01   +3.394327790977903e-01   -4.073573707415128e-02   +6.007108212443847e-02   +4.745915887590793e-01   +4.488683329050325e-01; -1.264764896748690e-02   +1.936023083308259e-02   +9.642778169139241e-01   +9.262172916581980e-01   +6.460018952733225e-01   +3.339623850079664e-01   +3.272564640430338e-01   +5.127347762630905e-01; +2.064027669411245e-01   +3.636027733155777e-01   +1.175593346748822e-01   +6.832848688957497e-01   +4.272522285959565e-01   +6.488451170729450e-01   +5.107934798538741e-01   +2.398174418655258e-01; +4.190823665639503e-01   +7.502050670897661e-01   +6.646718228013998e-01   +1.000000000000000e+00   +6.007144759984919e-01   +5.937643386069010e-02   +1.603151462582305e-01   +9.595374338778085e-01; +8.949105216432629e-01   +6.858804829918573e-01   +2.386021446850008e-01   +8.420918357946720e-02   +5.054679156145581e-01   +6.065343437872335e-01   +4.533239865873455e-01   +7.568748906456638e-01; -9.272897993464961e-02   +4.368563912001677e-01   +5.049354640680412e-02   -8.771987222004610e-02   +1.018381588675970e-01   +3.453463394469913e-01   +2.078881670384471e-01   +9.208115735519058e-02; +6.423084556540013e-01   +6.165049349132173e-03   +8.106092806593912e-01   +1.451246714674414e-01   +8.506215601826002e-02   +2.845036175789359e-01   +3.758701898356480e-01   -2.032285730688617e-01; +3.002823332772823e-01   +5.792489393871290e-01   +4.811106208981530e-01   +2.805648389334371e-02   +4.482545092145612e-01   +1.730069748055486e-01   +4.413271976567680e-01   +7.437674136267192e-01; +3.340897999577245e-01   +4.006049239054323e-01   +2.539716387334865e-01   +3.903447020482162e-01   +5.140639053541155e-01   +4.894492295901595e-01   +8.300512611835659e-01   +4.007682927482762e-01; +4.991263578612033e-01   +4.481140190499188e-01   +6.590937821311467e-01   +3.073360537490618e-01   +5.205886635334045e-02   +1.174994810650871e-01   +7.272860966525574e-01   +3.756879196914118e-01; +7.560607358688080e-01   +4.422629156949782e-01   +5.735436514596459e-01   +6.403541889468886e-01   +2.593650435840167e-01   +6.376543379399757e-01   +3.522745766644949e-01   +4.963107338284599e-01];
L2I_L3I_iGABA_netcon = [+4.335454955523189e-01   +1.853673243914479e-01   +6.917427796448349e-01   +2.826842737832875e-01   +2.437100853349861e-01   +4.695038243214517e-01   +1.135826473972264e-02   +4.417980953452554e-01; +4.894754643290465e-02   -1.419130471763544e-02   +6.809489049855696e-01   +6.042153865519320e-01   +5.296696315437417e-01   +4.288411535099178e-01   +8.121776680819178e-01   +4.596581372493243e-01; +2.009532735944960e-01   +6.788727710232755e-01   +1.467910536909303e-01   +2.087415967866628e-01   -1.220954535879039e-01   +7.060343840874879e-01   +2.248219491863160e-01   +5.688889663710281e-01; +4.632904859795938e-01   +4.865526522127295e-01   -1.266673299457552e-01   +3.173349211844024e-01   +6.349880989814547e-01   +1.101608825636086e-01   +2.908808692382021e-01   +2.416591842535045e-01; +6.247296642533140e-01   +2.123373850419887e-01   +4.553806955999732e-01   +5.950838348273612e-01   +2.995368676292590e-01   +4.385112107018334e-01   -1.120971695682513e-01   +2.582622524598207e-01; -2.841670915798463e-01   +1.770000048823183e-01   +3.339825875635049e-01   +5.627444731723560e-01   +6.809158242587793e-01   +6.424279864395327e-01   +5.744991390577435e-01   +6.376945870907540e-02; +1.654790017406869e-01   +3.202686030437689e-01   +2.341030910202801e-01   +4.559327075829051e-01   +8.242611731708863e-02   +7.439213442377113e-01   +7.220229798857619e-01   +9.942758083526483e-01; +2.923763477421661e-01   +5.108573328041154e-01   +1.093925153335477e-01   +2.691755624340301e-01   -2.229304562403717e-01   +1.733566802595644e-01   +1.853099411689343e-01   +1.768851473850733e-01; +3.386904860423165e-01   +1.869882407223137e-01   -6.997330010375140e-02   -1.943921161173781e-01   +4.842221308750264e-01   +2.101848745302010e-01   +1.595653832674856e-01   +2.303705686576983e-01; +7.200510702344588e-02   -1.848503850126995e-01   +5.271016347723639e-01   +4.914420616966440e-01   +6.568288530829164e-01   +6.850572832168728e-01   +5.189273756223142e-01   +1.764597461543284e-01; +4.100699590286426e-01   +3.042640176527228e-01   +8.632172138280719e-01   -1.436828205482773e-02   +5.597837215516623e-01   +4.089130325239450e-01   +5.290106530448421e-01   +2.298375874264280e-01; +6.430669936650267e-01   +8.998021185232184e-02   +2.844694877024149e-01   +8.280050262425665e-03   +3.794464625220456e-01   +8.470293009576048e-01   +2.267577376348191e-01   -3.174377283942841e-03];
L3I_L3E_iAMPA_netcon = [+2.794533857423545e-01   +6.270586538909553e-02   +3.333091785927064e-01   +7.738423031050117e-01   +6.909452658302943e-01   +2.196484219714976e-01   +3.919839556313320e-01   +5.550210292561419e-02   -1.309573056887155e-01   +2.833079146615861e-02   +4.629124022984120e-01   -2.447510226104408e-01; +2.026831343328265e-01   +4.871497030088432e-01   +4.151148482483277e-01   +3.200964909848091e-01   +8.932296257040845e-02   +2.519569561253411e-01   +3.196409278329994e-01   +1.400957846463503e-02   +3.395444292610668e-01   +2.707972516794032e-01   +3.588794840349689e-01   +6.963701033335530e-01; -5.872677413738029e-02   +7.485295962137992e-01   +5.135540302999937e-01   +2.684867634346366e-01   +2.814302814403696e-01   +2.161568832070788e-01   +3.177425516275056e-01   +2.824344038484884e-01   +1.996968893625738e-01   -1.896995906594694e-01   +6.951322195412256e-01   +3.358468017858346e-01; +3.638642769726527e-01   -4.524533005777572e-02   +5.144658004019830e-01   +9.556686164110050e-02   +7.883683164011408e-01   +1.149770708424432e-01   +7.358877347771582e-02   +3.004774749830352e-01   +4.920986294036559e-01   +3.008929071563193e-01   +3.741844379433087e-01   +1.258530062238111e-01; -4.528546948971971e-02   +7.615515930526751e-01   +4.117429183072688e-02   +2.583606235178869e-01   +6.202918939689158e-01   +2.919986055218149e-01   +1.703382623613175e-01   +1.857038219619224e-01   +7.281212418926980e-01   +5.290589891164122e-02   +3.619850616277727e-01   -1.126345954475780e-01; +1.496901979028220e-01   +3.775454809331992e-01   +7.403542141348038e-01   +3.631941392414025e-02   +3.446769262505057e-01   +3.914618246380838e-01   +2.855124935626844e-01   +3.955323148568597e-02   +6.344337191032283e-01   -1.629477083108227e-01   +1.999479308942192e-01   +7.929288016575906e-01; -1.347844658860696e-01   +8.954649207536503e-01   -3.801587965345231e-02   +5.263178853868081e-01   +3.474761292328274e-01   +3.969370783838898e-01   +3.730902352754076e-01   +9.775938834101473e-02   +7.216684745141669e-01   +7.965766965741733e-01   +2.006736861906915e-01   +6.624965156084207e-01; +2.311671870133856e-02   +6.612995066577648e-01   +5.884761800544169e-01   +5.383685251399080e-01   +8.620683442410283e-01   -9.977870738010088e-02   +8.725948212725971e-01   +1.174862078009373e-01   +7.965087841206572e-01   +6.355955126145049e-01   +6.674359922195917e-01   +3.843933424726863e-01; +5.246043309891688e-01   -7.900605785539605e-02   +6.385745673513393e-02   +5.589238001960987e-01   +7.780743201501340e-01   -1.146781179169243e-01   -5.243723986759741e-02   +4.342477985643683e-01   +5.027983496577387e-01   +1.000000000000000e+00   +5.084726061184727e-01   +3.101396854875154e-01; +5.955879946445235e-01   +5.159348571669198e-01   +3.888818603152008e-01   +5.344123332804110e-01   +2.735564043851417e-01   +1.641599820916257e-01   +7.696724041796631e-01   +6.126599157148171e-01   +2.932076535019482e-01   +1.186151434425638e-01   +9.914433271481289e-02   +4.495452459091937e-01; +2.226892878150017e-01   +5.952379495869041e-01   +8.829997374835985e-02   +5.164075184713748e-01   +6.930828057922364e-01   +8.366654693527227e-02   +4.958826198522915e-01   +7.796900908430128e-01   +1.186375715052246e-01   +4.504950555480499e-01   -5.260176715977611e-03   +8.943635170403005e-01; +3.697550359232205e-01   -8.644932029876788e-02   +5.044073943688897e-01   +7.807387902026600e-01   +7.533258343477310e-01   +3.432812808604083e-01   +1.422385130544482e-01   +3.005612530082459e-01   +7.244534701849463e-01   +5.203825500472825e-01   +3.378082425860375e-01   +3.402942406586172e-01];
L3E_L3I_iGABA_netcon = [+8.523786024612652e-02   +4.586904912307270e-01   +4.512178249988634e-01   +4.420769816046463e-01   +6.835128890831184e-01   +4.362798742128595e-01   +5.601192688137834e-01   +7.883790966822246e-01   +8.324416632121532e-01   +2.329033576211162e-01   +1.247789491535608e-01   +4.108759197839544e-01; +7.103205265229625e-01   +6.520583532904107e-01   +5.562924280536530e-01   +6.660610535822533e-01   +3.314050959078032e-01   +1.702046686767754e-01   +7.543823386893224e-01   +5.336059884059520e-01   +5.700985493573493e-01   +5.380736593977862e-01   +2.406175923572653e-01   +4.953007839373449e-01; +2.699433572883273e-01   +9.242742673830706e-01   +2.265346835872935e-01   +6.172322259791938e-01   +2.447939310971607e-01   +3.940492299714181e-01   -6.432267794718956e-02   +2.991536130120920e-01   +2.137348393474630e-01   +1.021391096951648e-01   +9.564780324583548e-02   +8.196279827234124e-02; +1.796521055701265e-01   +1.309484730994048e-01   +7.036556762644193e-01   -3.746758390319370e-02   +9.178254786881902e-02   -1.002609673955157e-02   +6.284097956084997e-01   +2.659914415920218e-01   +5.597108088043590e-01   +3.350898785140231e-01   +2.142221407216732e-01   +9.202763461471160e-02; +7.633795721354674e-01   +6.016049078884828e-01   +7.399022996660317e-01   +2.933674782459990e-01   +4.747754513495094e-01   +5.991697491933974e-01   +6.651728825969334e-01   +9.213365936630183e-01   +1.919473809678179e-01   +7.669686721458251e-01   +5.631354437952758e-01   +3.581351430779997e-01; +7.600051747097560e-01   +5.692906366718165e-01   +3.178738129253616e-01   +5.675156639155094e-01   +2.905532982958231e-01   +7.882978369918068e-01   +3.536924401034487e-01   +9.153390343566202e-01   +3.407971278343536e-01   +5.683584053448820e-01   -4.359048292398021e-02   +1.354355060319386e-01; +6.242712473961473e-01   +6.008743128474273e-01   +1.300662834783297e-01   +9.249628819518535e-01   +2.569261612594900e-01   +3.897241438265945e-01   +4.726798930540113e-01   +2.300609398004316e-01   +1.261857616379270e-01   +2.467454084622361e-01   +9.155633425074354e-01   +3.875551094241795e-01; +7.757935095247728e-01   +1.663115087701047e-01   +3.561143436303019e-01   +4.173224726009613e-01   +8.107039322428440e-01   +1.807809565328372e-01   +1.248144762800044e-01   +4.706386627154583e-01   +4.636267092864032e-01   +8.067809358876945e-01   +1.715933657935206e-03   +3.333675308526962e-01; +4.266352748661324e-01   +3.504849924741896e-01   +6.235509397945536e-01   +4.221843181577914e-01   +9.017282230023609e-02   +4.739340144851110e-01   -1.138455901041006e-01   +6.116438609952972e-01   +1.418914213301139e-01   +3.571836952461624e-02   +9.228393272320565e-01   -5.603705094671391e-02; +1.621175532590111e-01   +5.139749980335963e-01   +3.856920282199694e-01   +3.471100057804790e-01   -5.130786070396066e-02   +4.251690313279651e-01   -1.114319264011014e-01   +5.785252637627285e-01   +1.408088284094955e-01   +3.575301612533412e-01   -2.147010272737957e-01   +7.858931783480252e-02; +7.492479402511689e-01   +2.681490463056846e-01   +8.165893288046742e-01   +1.149563170355532e-01   +5.519295781158590e-03   +3.394856068618992e-01   +5.153648955373062e-01   +1.933082377757305e-01   +1.929101975696427e-01   +1.238861913619144e-01   +3.696918785300665e-01   +4.982581826283759e-01; -9.967656139596279e-02   +1.936792065674660e-01   +5.867779417153657e-01   -1.210951938341119e-02   +1.708502458063487e-01   +4.817096154416378e-01   +6.888534684027939e-01   +6.793305051960725e-01   +9.619729388003387e-02   +5.152726969232511e-02   +1.559622312635259e-01   +3.322150368780649e-01];
L2E_Input1_iAMPA_netcon = [+1.000000000000000e+00   +6.116791023120065e-01   +6.833083659776309e-01   +9.125342996966784e-01   +8.771578814232164e-01   +9.368389288364227e-01   +8.455968639295655e-01   +7.860526544622551e-01];
L2I_Input2_iAMPA_netcon = [+9.441794471574522e-01   +7.523328870036143e-01   +8.731497893680888e-01   +6.969709272705912e-01   +8.568451943248517e-01   +6.243620635566879e-01   +8.404440623781715e-01   +8.671157035653827e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
