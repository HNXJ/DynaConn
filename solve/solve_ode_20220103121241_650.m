function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.524016069429619e-01   +2.386622505062325e-01   +5.146734317491296e-01   +1.544021705909774e-02   +3.386853878827920e-02   +4.777269026069848e-01   +1.335642028843578e-01   +2.622903234258278e-01   +1.586110658279784e-01   +5.158988015511493e-01   +2.072494934599180e-01   +2.044740093638667e-01   +2.660343136959181e-01   +2.562599135038918e-01   +2.829947246429912e-01   -9.438386043157959e-02; +4.658117614701305e-01   +2.652294015191239e-02   -3.383009488778618e-01   -8.611214957101526e-02   +4.260898256125077e-01   +4.113668783017488e-01   -1.142401286718837e-01   +3.686077348730162e-01   +3.431921647485847e-01   +2.497816590751626e-01   +2.738099049595993e-01   +4.253845519251469e-01   +1.873930629423270e-01   +4.573644036082872e-01   -2.713430973662248e-01   +2.118757469485569e-01; +3.299657965657823e-01   +4.818595322028844e-01   -2.819508828654834e-01   +1.968566519946977e-01   +5.131053043615339e-01   +2.127402982388693e-01   +3.442087138255348e-02   +3.924540844479121e-01   +9.912523604025456e-02   +5.426398814001705e-01   +1.146347796059694e-02   +2.233959637787188e-02   +3.142560064277898e-01   +3.574845037852294e-01   -6.636591147907273e-02   +3.685967986832961e-01; +5.980402586861329e-01   +6.267415021602436e-02   +4.779689217478820e-01   +7.929648272492890e-01   +5.663991707717658e-01   +4.410250956756497e-01   +7.582078616216489e-01   +9.304467213650490e-01   +8.544022189638508e-01   +3.536640664901619e-01   +3.332372837364481e-01   +2.296360989403696e-01   +2.679766171812745e-01   +3.498382469045985e-01   +1.999840278761240e-01   +5.094750771371485e-01; +5.191607521125036e-01   +5.386234605022532e-01   +3.691326558091234e-01   +9.336077882538981e-01   +5.170866628610814e-02   -1.170368410435483e-01   +8.141514907250501e-02   +8.781355747489734e-01   +5.318905648239940e-01   +2.217414439546378e-01   +8.336360990773991e-01   +1.485008325207524e-01   +9.018703383489703e-01   +6.617939989504366e-02   +7.178697556922684e-02   +5.354877948744372e-01; +9.941135466112930e-02   +5.623092752970180e-01   +6.417240721511094e-01   +3.886364489403736e-02   +6.420185137421902e-02   +6.351998673154470e-01   +2.745568319976854e-01   +4.900204873585209e-01   +2.003071193726060e-01   +3.811510026136687e-01   -1.558266345599138e-01   +5.491777762181133e-01   +2.712260290644859e-02   +4.581304329805405e-01   +2.423198708797847e-01   +7.561329127320667e-01; +2.754496961343789e-01   +6.087448040614416e-01   +1.033580875521526e-01   +1.002849606983271e-02   +2.307412943383189e-01   +6.047244671531651e-01   +3.638439286980627e-01   -3.665000156818327e-02   +2.309128375495249e-01   +1.053157168028729e-01   +5.380303237303239e-01   +5.293825036286830e-01   +5.109236311439100e-01   +4.303114915354714e-01   +9.753303304032880e-03   +8.124952660334675e-02; +5.142645416369583e-01   +5.578643028679968e-01   +6.053083400084556e-01   -3.340217726689981e-01   +4.764751449433804e-01   -2.036049759623876e-01   +4.763517867551807e-01   +1.517204772474794e-01   +3.404626284323454e-01   +5.199787666795683e-01   +2.556207880856828e-01   +4.748500607583284e-01   +3.169843639490354e-01   +2.634855190560829e-01   -8.310430256121792e-02   +3.869789392240774e-01; +2.030050199754154e-01   +5.026180690802029e-01   +7.536673038836636e-02   +8.997686028336901e-02   +7.693981474769648e-01   -3.102433196688362e-02   +4.098327703373691e-01   +3.696848979135866e-01   +8.576626820257523e-02   +3.339610665756887e-01   +4.285662147316682e-01   -8.164615474857757e-02   +2.109565537267734e-01   +3.432644095295783e-01   +2.645248288288340e-01   -9.593044380855856e-02; +3.417987488351287e-01   +7.158535842420110e-01   +3.576697698892445e-01   +4.016480636375845e-01   +2.594570917116475e-01   +4.721547247276001e-01   +6.796775813255561e-01   +1.282928934983419e-01   -3.045615571443651e-01   +2.871263772530049e-01   +2.527837364573958e-01   +2.948536741521122e-01   +7.257602864772417e-01   +5.736286444065287e-01   +4.332234016547309e-01   +2.938211281068386e-01; +1.458477271660201e-01   +1.448022476577019e-01   +3.146520322844817e-01   +5.162955593284476e-01   +5.283181445482636e-01   +2.393819146929561e-01   +3.445497721413118e-01   +5.335477902675611e-01   +3.778738911266691e-01   -1.974523831078218e-01   -2.656185302760327e-01   +5.324937153574074e-01   +3.890001568928040e-01   +2.260627816588174e-01   +2.783302034796121e-01   -3.022485529080586e-02; +4.433735162496358e-01   +6.127397977722782e-02   +2.822123266108595e-01   +4.002133811405604e-01   +2.599775636059021e-01   +3.736471452489765e-02   +2.699126076437915e-01   -2.298017194388662e-01   -9.870478907265416e-02   +5.466034332854095e-01   +1.536528849810339e-01   -2.840908773317687e-01   +4.234653511764212e-01   +4.618332276817352e-01   +5.978222853828064e-02   +1.817321838139752e-01; -8.012077839686810e-02   +2.112501736168300e-01   +6.868045670621716e-01   +5.515461334063464e-01   +4.930483988080824e-01   +7.470400149702685e-01   +2.267455487085894e-01   +4.974223871001000e-01   -7.968272826482531e-02   +9.834270064725352e-02   +4.532910813258395e-01   +5.186070353810551e-01   +6.803846982822453e-01   +4.267783212544755e-01   +2.507431642233394e-01   +3.083365763820809e-01; +4.295005075656538e-01   +4.811063211018627e-01   +4.976161072581737e-01   +6.155299314028555e-01   +6.341444653164965e-01   +5.613202695016901e-01   +1.928663910824732e-01   +2.010889724712392e-01   +5.277376884466058e-01   -3.316762032498804e-01   +4.751585788785723e-01   +1.412808260925656e-01   +5.034057441312328e-03   +5.532053119825120e-02   -2.308625883317013e-01   +1.411883639090947e-01; -7.490277516736821e-02   +4.522910985531792e-01   +1.301936354744883e-01   +4.553848200212184e-01   +2.860583332634932e-01   +8.625688960413077e-01   -7.524826198173562e-02   +5.157594967979056e-02   -9.034776321560366e-02   +3.046147259723524e-01   +5.916022733964631e-01   +5.239246855005233e-01   +3.966647318066001e-01   +6.621554704630008e-01   +4.158209691787475e-01   +2.751474620113499e-01; +2.122391254909172e-01   +2.883889156823851e-01   -1.881519509645895e-01   +4.709622424127787e-02   +5.460820615032396e-01   +1.530203135949241e-01   -8.170363040073027e-02   +1.161140574811471e-01   +2.324320074370257e-01   +2.027385225642663e-01   +2.762149821908656e-01   +1.725258480826464e-01   +4.623775014824798e-01   -9.754412941286822e-02   +6.437956528447822e-01   +1.586690046056209e-01];
L1E_L1I_iGABA_netcon = [+3.363289516761305e-01   +4.834271969610202e-01   +5.612179968301525e-01   -3.562161835057399e-02   +1.445927199531681e-01   -1.266590640186898e-02   +3.336656367554899e-01   -4.020947953048889e-02   +5.897206092855481e-01   +6.655410912465640e-01   +6.290037217179379e-01   +6.120208240708539e-01   +7.063367043159318e-01   +3.723901523211963e-01   +2.772707699492459e-01   +1.090078752807081e-01; -2.068586555849998e-02   +1.222982742800271e-01   +1.197384731599100e-01   +2.573187857002089e-01   +1.502242983224293e-01   +3.248663524714107e-01   +1.628332663261033e-01   -3.325300418148179e-01   +9.120560203404322e-01   +4.813931595342300e-01   +4.158633311048561e-01   +2.535058219241026e-02   +4.515799611030094e-01   +1.405447421719976e-01   +4.417307431964648e-01   +2.835361537803008e-01; +6.480373769279358e-01   +1.585513322600178e-01   +4.771629655273849e-01   -6.791853347510930e-03   +4.832473247494864e-01   +6.845831002356036e-01   +2.590811357687831e-01   +2.269630534809913e-01   +2.493104439816792e-01   +9.806642524273743e-02   +7.024761302935512e-01   +5.690551047986698e-01   +5.129099707578169e-01   +2.936143377657343e-02   +5.740331408051913e-01   +8.647157269252959e-01; +8.674408021909386e-02   +7.504713020696084e-02   +2.080222522872100e-02   +5.202892709114519e-01   +2.030980811036307e-01   +1.728467811563118e-01   +7.165306083111284e-01   +1.388831721298477e-01   +4.865729946688144e-01   +6.887972385519807e-01   -1.159407536137292e-01   +1.508881847624876e-01   +6.603947217497502e-01   +1.097963589919033e-02   +4.104337167761644e-01   +6.120598413977920e-01; -2.158391092859810e-02   +9.304819904765954e-02   -2.340910569473148e-01   +7.453081811194105e-02   +2.346641829257527e-01   +6.192823074355054e-01   +4.669893027584070e-01   +4.408975774228124e-01   +3.702821556954091e-01   +5.501508608958466e-01   +1.768692741501221e-01   +6.035422149048549e-01   +1.624518937554260e-01   +4.296234321815735e-01   +3.012708602461287e-01   +1.112103290211141e-01; +4.990124306919878e-01   +1.708269546078061e-01   +4.297970530559909e-01   +1.143526033272772e-01   +2.600475096462027e-01   -5.076928492182040e-03   +4.817676897457229e-01   +2.983028670432756e-01   +7.455203683321432e-02   +5.339767421627619e-01   +2.925969240287604e-01   +4.004490344239668e-01   +1.896987499467214e-01   +4.042026513638824e-01   +3.458917141255612e-01   +5.029423204682660e-01; +8.733700061990578e-02   +5.547092146810392e-01   +2.163323360539690e-02   +1.642630750102000e-01   +9.366846088812016e-02   -3.656781439380590e-01   +6.811107781223023e-01   +5.181244785397341e-01   +1.753767876679652e-01   -1.531074484507546e-01   -7.965784650213886e-02   -6.098031113667329e-02   +1.177700126716996e-01   +5.052120188975294e-01   +4.137985489369124e-01   +1.804341414749414e-01; +2.356267513118279e-01   +7.456491143594683e-01   +7.023662065555012e-01   +1.403666629340536e-01   +4.224784234198006e-01   +4.879382613046757e-01   -6.283154672746419e-02   -1.875455301039671e-01   +1.088572042230836e-01   +1.421452798762260e-01   +6.531747725594553e-01   -8.786027727996372e-02   +2.605067831694364e-01   +6.500022390858622e-01   +2.197347536198873e-01   -1.145198060981855e-01; -1.528161121061726e-01   +1.245883831083626e-02   +4.007512487192297e-01   +3.534847912330107e-01   +5.658099753018342e-01   +5.333364763449651e-02   +4.048742470920951e-01   +3.787079937480587e-01   +5.135160402057221e-01   +1.690073686384994e-01   -1.658818796878339e-01   +3.789480799816005e-01   +1.495693868179505e-01   +6.417495103037559e-01   +2.637336400595304e-01   +1.869580227949091e-01; +1.732943477632197e-01   +9.760945243411384e-01   +5.865147761822759e-01   +2.126068953853648e-01   +1.543125402743405e-01   +6.494359039369355e-01   +2.326359352433735e-02   -2.996480391267785e-02   +1.559041596505570e-01   +4.187806048219221e-01   +3.381334817774340e-01   +5.530421010202929e-01   +2.829719848225533e-01   +3.406321276434865e-01   +4.181745449536833e-01   +2.984293756808321e-02; +4.448123482648142e-03   +8.210785914801223e-01   +5.622078796379553e-01   +6.149379447537984e-01   +2.450015286516792e-01   -5.110053663815695e-02   +1.476400971924688e-01   +5.292549322282754e-01   +5.377585019004160e-01   +2.843907049384659e-01   +5.910602292786500e-01   +3.332517195936299e-01   -1.509791629764570e-02   +5.156236251243584e-01   +1.859133098958787e-01   +4.552027784497773e-01; +6.271675881913116e-01   +8.045927087263427e-02   +1.709187286315056e-03   +3.380750433249133e-01   +6.894188319968991e-01   +1.337253997982427e-01   +1.363031352270316e-01   +3.584085718737365e-01   +1.696363716644363e-02   +2.186279680963353e-01   +4.228955749156417e-01   +4.455310466523741e-01   -2.567993452971385e-01   +1.703692446512753e-01   +2.556491530243001e-01   +6.833992902996574e-01; +7.170634512197779e-01   +7.092498014082613e-01   +6.072780154246894e-01   +2.245793215919899e-01   +2.558819977707907e-01   +8.804540639796398e-01   +1.227792502323066e-01   +1.372720155084290e-01   +5.554369558309565e-01   +3.347953039004352e-01   +7.603827695444649e-01   -4.052048338578220e-02   +4.690364262803203e-01   +2.357625164626588e-01   +1.036884325324616e-01   +3.814427251563248e-01; +3.177327531569061e-01   +9.618916284728692e-02   +6.318698770909839e-01   +5.798553786739339e-01   +7.920312997839458e-01   +6.216742049767841e-01   +8.170252169964130e-01   +7.328230375762794e-04   -1.495111300883560e-01   +2.653511037752135e-01   -6.388151433886366e-03   +6.241178741014259e-01   +3.700791277425132e-01   +3.374949764406858e-01   +6.160786208127004e-01   +2.910257010832212e-01; +5.069718156982759e-01   +8.738180349357775e-01   +2.065619228018109e-01   -1.551030439861852e-01   +3.835550540174784e-01   +2.232497983954431e-01   +2.185216350840586e-01   -1.107933992241201e-01   +5.192970992839834e-01   -3.533246665832099e-02   +3.845799370281092e-01   +4.217483983614199e-01   +6.389055282944098e-01   -1.733874544183975e-01   +2.310530921451363e-01   -4.731006187070267e-01; -2.064409189321049e-01   +3.777474965331227e-01   +6.382526202454329e-01   +1.567570883166085e-01   +1.472405399275163e-01   +3.604260594848011e-01   +1.319749814818856e-01   +6.772445990929070e-01   +3.750577179869028e-01   +6.336877823750808e-02   +1.938777628711824e-01   +7.043845589857760e-01   -3.247371924182381e-02   +5.526528316503507e-02   +1.985145309518552e-02   +4.909299155618066e-03];
L2I_L1I_iGABA_netcon = [+1.618562681382104e-01   +1.574124281389301e-01   +6.304950465934928e-01   +1.734658849789781e-01   +4.987948115571637e-01   +5.392771198322259e-01   +6.199187804005165e-01   +7.982686262909522e-01; +7.819475337738842e-02   +2.869619039350889e-03   +1.572347488060633e-01   +4.109850999483183e-01   +4.987747385061149e-01   -1.088290508627294e-01   +3.816460242225125e-01   +6.334167428248827e-02; +3.821529707449225e-01   +4.631977240565884e-01   -3.156933517742822e-02   +4.055505965194829e-01   +4.765526162786812e-01   -7.373102135463458e-02   +3.988235593220076e-01   +3.371897951604872e-01; +3.408954323895749e-01   +2.829556047351728e-01   +4.276804692469862e-02   +4.413967151311508e-01   +1.448405316632821e-01   -2.672044765445060e-01   +1.473669785633747e-01   -4.036125679148261e-03; +1.567859960275964e-01   +4.336877180226133e-01   +1.735845243018843e-01   +3.498346413451996e-02   +3.837430024198569e-01   +2.918471675543277e-01   +3.665875149618588e-01   +5.607013964600043e-01; +4.934472432591702e-01   +3.885922716434105e-01   +4.584975298616232e-01   +4.853223894841933e-01   +3.463406301916896e-01   +1.833024736848523e-01   +4.624929168733920e-01   -8.480094894706260e-02; +1.438046839924506e-01   +5.771000436544829e-01   +4.205503413130312e-01   +6.971716365053988e-01   +1.064296582307784e-01   +5.174981767612979e-02   +6.117285780024286e-02   +2.526671166964652e-01; +4.984391553906975e-01   +3.505039599253038e-01   -8.606551019541769e-02   +3.504927482520131e-01   +1.567342337721713e-01   +3.104770563429799e-01   +3.426217080662455e-01   -3.473598736969656e-02; +4.129164734217930e-01   +2.813022616181264e-01   +4.609076673831528e-01   +2.221201222751594e-01   +2.346883993604893e-01   +9.995903373425040e-01   +1.176167906104284e-01   +7.721875520163242e-01; +6.641466898823413e-01   +3.387500896541514e-01   -4.728499504986182e-02   +1.739124872342298e-01   +4.255141636771067e-01   -1.438672607994311e-01   +1.467569661059098e-01   +4.031130969302457e-01; +1.502051482617151e-01   +6.587263946709325e-01   +3.622019632034740e-01   +5.639047919356054e-01   +2.755530731357800e-01   +4.312684090545369e-02   +8.283629006025844e-01   +5.600144250253402e-01; +6.783673459034459e-01   +1.000000000000000e+00   -1.488219681361584e-01   +1.540208087096567e-02   +1.336846480741480e-01   +2.537582032520908e-01   +2.692419185852926e-01   +1.318447652608797e-01; +8.953488863877566e-01   +2.488536846912172e-01   +6.659847978944657e-01   +2.937571943268455e-02   +3.604569814629685e-01   +1.758092197428331e-01   +8.163090244574930e-01   +1.105541468527058e-01; +6.190957962326503e-01   +2.387984582723258e-01   +3.081979619970157e-01   +1.186952598086820e-01   +2.906726601563363e-01   +3.050843513802113e-01   -1.491997985749464e-01   +1.628510789417316e-01; -8.671160246375827e-02   +9.034466264926529e-01   +4.621022681080202e-01   +1.579095200748032e-01   +3.391885746890627e-01   +5.125611959107432e-01   +1.305502540850027e-01   +2.590604354243849e-01; +5.143451147733941e-02   +5.452435153980350e-01   +8.410154597671761e-02   +3.318875956924641e-01   +9.137072440772247e-02   +3.721990283627432e-01   +1.179072524987734e-01   -7.949792189618504e-02];
L1I_L2I_iGABA_netcon = [+2.239317039043029e-01   +4.305284152265948e-01   -4.818077703247902e-02   +2.822645106009243e-01   +9.026000623179901e-01   -1.732471120822518e-01   +4.994960850002150e-01   +1.879965835551461e-01   +2.833713429472056e-03   +3.481737979747828e-01   +4.903682397541384e-01   +4.031183725485402e-01   +4.798309778950534e-01   +1.171697948000628e-01   -1.387704961674179e-01   +4.082638900243652e-01; +8.088076212934703e-01   +3.713441945267397e-01   +6.465840573346012e-01   +7.152170218684859e-01   +3.808453874453185e-01   +9.808901529145734e-01   +3.446661401242506e-01   +1.557495053977395e-01   +4.393439741397483e-01   -1.616413972088254e-01   +6.069837894655306e-02   +8.843084643366202e-01   +5.862078456790843e-01   +1.721229277734199e-01   +3.885000612846403e-01   +6.689764630280075e-01; +2.797769618276284e-01   -2.013229327393065e-01   +7.556691217149045e-01   +4.746924467407740e-01   +4.986057777248037e-01   +3.453711111874753e-01   +3.703576672471720e-01   +6.894007545569314e-01   +4.090104142228992e-01   +3.931504189749461e-01   -3.007378668236012e-02   +2.479492448986540e-01   +7.416066707929036e-03   +6.214292795255009e-01   +2.962647057736627e-01   +1.606292894496230e-01; -1.409193895520724e-01   +4.821008941889156e-01   +2.555661917235788e-01   +9.276310357339040e-03   +2.616869504990839e-01   +4.082671767298803e-01   +9.348558877061899e-01   +3.308453227819945e-01   +8.047656430827898e-01   +2.133377080016734e-01   +3.251131838788399e-01   +7.375195692532941e-01   +4.091328659639855e-01   +3.066205498786835e-01   +7.086422717575778e-01   +3.985581668820211e-01; +4.849426497742058e-01   +7.878048751964508e-01   +1.743680719651574e-01   +2.882683786856515e-01   +1.637892206548990e-01   +6.043525682584584e-02   +6.036788209427423e-01   +1.527333561796608e-01   -2.581361972420765e-01   +2.041111125060344e-01   +3.631033875265433e-01   +7.188114306174384e-01   +1.651773878529141e-01   -7.078095678519829e-02   +5.298369743617968e-01   +6.179119295355553e-01; +6.674904063731020e-01   +4.258220884039783e-01   +5.965813168731874e-01   -1.010757627432231e-01   +4.113801627580758e-01   +1.066604440840287e-02   +8.888166926746118e-01   +9.471455014431017e-02   +4.604776290348285e-01   +6.751001833931137e-01   +9.573059080254013e-01   +2.292594892605248e-01   +3.567786995047300e-01   +2.773194890450619e-01   +3.171859032667210e-01   +2.298557181698124e-01; +2.168144915638209e-01   +6.874098944162390e-01   +5.957116939520409e-01   +3.529282116567575e-01   +3.958641638504296e-01   +1.000000000000000e+00   +7.620638463429038e-01   +2.259862418287474e-01   +1.156640962150145e-01   -1.463764642116979e-01   +7.113016126299722e-01   +1.996106231873541e-01   +6.819118610829904e-01   +7.192130182246574e-01   +1.080393402387540e-01   +4.567758866928606e-01; +2.887981714492987e-01   +8.375816780152617e-01   +3.174872078671117e-01   +7.099429195243711e-01   +5.066320413840526e-01   +2.890570056726175e-01   +3.629738713238887e-01   -3.648724687719446e-01   +1.070941422668773e-01   +2.235626258271010e-01   +1.583853256080873e-01   +6.210224816262533e-01   +1.273901918961654e-01   +7.880011596294475e-01   +3.251028467254744e-01   +2.750653045221634e-01];
L2E_L1E_iAMPA_netcon = [+2.088536389317192e-01   +2.952060952142764e-01   +4.653093778512233e-01   +5.506737636347984e-01   +3.767670820624484e-01   +1.448207809947215e-01   +3.791091519564274e-01   +5.247167787414333e-01; +3.793817369475422e-01   +6.661109989658527e-02   -9.180754718411999e-02   +9.435453426170688e-02   +3.200086361916618e-01   +2.079300196226513e-01   +4.185369233215630e-02   +5.298597813139837e-01; +1.708126672832034e-01   +2.358471149063074e-01   +3.634186177858063e-01   +1.000000000000000e+00   +3.079500195430344e-02   +3.276569900836188e-01   +6.036324335288282e-02   +6.155660805496863e-01; +2.353203248300655e-01   -3.622751032851436e-02   +2.004910632176582e-01   +4.486052418533216e-01   +5.845270546930624e-01   +3.844056622040955e-02   +5.562818603676964e-01   +2.641504640914056e-01; +6.527474731264664e-01   +6.467764397409147e-01   +2.595503514178149e-01   -2.789412524862759e-02   +1.221580547911288e-01   +2.586505855464514e-01   +1.323163898184799e-01   +2.064640719782477e-02; +6.016343784972509e-01   +3.261278735102500e-01   +4.969058541058419e-01   +5.090842610629033e-01   +6.987553281224494e-01   +3.649871069483395e-01   +3.640099483114015e-01   +6.161813499472820e-01; +7.807381902511433e-01   +1.506053206110798e-01   +1.753851052424210e-01   -5.005994346148254e-02   +2.172731136009928e-01   +4.414970145170538e-01   +3.759660706118230e-01   +7.498829345361048e-01; +6.533807873648814e-01   +3.314691778887824e-01   +2.326383784447668e-01   +4.947214081196671e-01   +2.533622694479554e-02   -8.025564747981508e-02   +3.486266688669984e-01   +9.215953388999287e-01; +1.291585700394222e-01   +1.092031084155300e-01   +3.965223314978381e-01   +1.576658611235917e-01   +4.971741762481405e-01   +5.520109524220514e-01   +4.199028686387491e-01   +1.784112941727526e-02; +3.343100294554564e-01   +5.595423588297934e-01   +3.361286496118147e-01   +5.830826840378592e-01   +4.356286114286331e-01   -3.395945363545924e-01   +6.381644651876526e-01   +2.933035776628490e-01; +1.021242473103300e-01   +2.574111999319115e-01   +5.169313728421830e-01   +5.318384268016043e-01   +6.664924503893606e-02   +2.245615895990273e-01   +5.767357873021206e-01   +4.267604169317292e-01; +4.756994300317040e-01   -1.686283299838185e-01   -2.863779577944024e-01   +7.312911514715900e-01   +5.072118937262436e-01   -4.486687319380175e-02   +2.854205489472340e-01   +2.523596657685896e-01; -3.042592408996054e-02   +3.698991984403308e-01   +2.562335488952684e-01   +8.031681359250939e-04   +2.666098485535754e-01   +7.552731416379473e-02   +1.048054965483030e-01   +2.764051377691375e-01; -5.300462094501112e-03   +5.452112723486005e-01   +6.149248947427343e-01   +4.930966993005186e-01   +1.654444739820591e-01   +3.993950586311961e-01   +1.234808988329078e-01   +4.552834628158396e-01; +1.794856083088919e-01   +1.336256678552018e-01   +1.107507380005281e-01   +5.153693358681526e-01   +4.412158499544008e-01   +3.626980428188576e-01   +2.547693448476664e-01   +6.945937290485200e-01; +2.593793447996121e-01   +7.669209095681870e-02   +2.101763223729719e-01   +1.698455511817092e-01   +4.720368379100054e-01   +2.032078736310711e-01   -6.160045473198206e-02   +1.054616298076129e-01];
L1E_L2E_iAMPA_netcon = [+5.162809363724253e-01   +7.489320570353630e-01   +1.225007217721589e-02   +3.324165283025903e-01   -3.376914896629066e-01   +2.371684080450191e-01   +1.008301550489844e-01   +7.525127270990658e-01   +7.968805047534012e-01   +3.081184358109889e-01   +5.350637251506164e-01   +6.442670920661583e-01   +4.864026534852189e-01   +9.612563546019436e-02   +1.734228606692800e-01   +6.548856036752085e-01; +4.342812676849475e-01   +4.906648290170887e-01   +7.142873966579630e-01   +4.880261967977477e-01   +2.645866196719351e-01   +3.148201368218667e-01   +4.314602886957332e-01   -2.722671668401810e-01   +1.834834932453865e-01   +5.643726484305581e-01   +4.617262591485563e-01   -1.124929926976769e-01   +5.972804986421911e-01   -2.593065877569145e-02   +6.700890435827724e-02   +1.807811726569464e-01; +1.231948034185316e-01   +4.200196544237413e-01   +4.890595242089395e-01   +5.745525310448333e-01   -1.959763011438579e-01   +2.111792608462234e-01   -8.368251311743909e-02   +2.581393620440837e-02   +3.710183090461879e-01   +4.024831170584055e-02   +6.112230633014755e-01   +4.318376529958982e-01   +1.492317686416516e-01   +6.272459339186378e-01   +5.823308692538497e-01   +4.951858008516493e-01; +2.835208070449830e-03   +4.163583238124082e-01   +2.681464147564706e-01   +4.633007490741944e-01   +2.260519062418025e-01   +5.758500701925684e-01   -3.048499213797206e-02   -1.590390892389270e-01   +1.988885120219638e-01   +2.411865554367538e-01   +4.939035677275416e-01   +1.751328231076353e-01   +1.660873800198179e-01   +1.883174805024096e-01   +6.086041244514499e-02   +7.390313299748898e-02; +2.662065620016080e-01   +6.868491342126739e-01   +6.498518151033639e-01   +9.291360616426471e-02   +3.067211577850218e-01   +8.412374843529868e-01   +3.547730168194427e-01   +1.231836743110014e-01   +5.462390631226831e-01   +4.588189410386223e-01   +1.000000000000000e+00   +1.032869769586541e-01   +5.449229676250070e-01   +6.825759117070463e-01   +3.836741784796102e-01   +2.577296969689434e-01; +3.785371357847422e-01   +1.040576866026059e-01   +4.882110662813368e-01   +6.370936865937504e-01   +2.961277924874897e-01   +4.983006078555201e-01   +6.777418449235917e-01   +3.155932209009346e-01   +1.027384763511566e-01   +5.617255410031068e-01   -9.016373808422265e-02   +4.010378794800079e-01   +4.594579533433164e-01   +2.492810868393201e-01   +6.227217404395760e-01   +7.359415049936906e-01; +5.647700354185138e-01   +8.004042695030994e-02   +3.083210849038552e-01   +4.389266469968052e-01   +3.656304705623399e-01   +5.340658809214541e-02   +8.403775849760832e-01   +8.211267136000489e-01   +3.251915493305342e-01   +3.314208015731092e-01   +5.954881147369180e-01   +4.175333109804320e-01   +2.805678401423169e-01   +4.571992926240976e-01   +3.239117361041429e-01   +2.695142316570951e-01; +4.573471705114406e-01   +5.611435815796810e-01   +5.074814907992231e-01   +4.109286463962502e-02   +8.217457391282013e-01   +2.752634526719530e-01   +2.456868405805871e-01   +5.554186106335312e-01   +4.493517700047207e-01   +3.061944562474146e-01   +2.644811113716957e-01   +1.256600864620495e-01   +9.892070199582836e-03   -2.293846963840147e-01   +2.791698196629799e-01   +3.187673314176456e-01];
L2I_L2E_iAMPA_netcon = [+3.379287771265896e-01   +8.786120495384915e-01   +4.948201609819375e-01   +7.057554696996495e-01   +4.332882061811186e-01   -1.620762730085879e-01   +7.075577320963992e-01   +7.248776691837330e-01; +7.888248684993534e-01   +8.412235981089927e-01   +2.035695152342514e-01   -4.494042716325745e-02   +4.571123228667056e-01   -1.263562764793655e-01   +3.716838786995550e-01   +1.160537836726830e-01; +3.594720293698490e-01   +7.231201632379705e-01   +5.497155571605389e-01   +4.635958986272232e-02   +2.804862354734045e-01   +6.681886060609495e-01   +4.324742482448436e-02   +2.096700009504934e-01; +6.152091970736454e-01   +7.786801708252417e-01   +4.383221290631885e-01   +2.380344240832202e-01   +7.305439588472742e-01   +9.581394167596906e-01   +8.386646377485090e-01   +8.387963030127961e-01; +1.000000000000000e+00   +1.032563277586677e-01   +2.301313647738724e-01   -2.251079821792190e-02   +1.251501328298967e-01   +6.670899078887973e-01   +5.466526604399323e-01   +3.548030632201997e-01; -7.131531167572584e-02   +2.052055866758300e-01   +2.463924418993938e-02   +2.459294327823369e-01   +1.284867725666599e-01   +6.752570636436306e-01   +5.701163330209719e-01   +3.363660930970224e-02; +8.036311394798185e-01   +3.808797357131640e-02   +3.460535364475376e-01   +1.487165923186778e-01   +2.807424884046025e-01   +3.564877569053265e-01   +4.834980306893558e-01   +3.802704558678434e-01; +4.610106317257187e-02   +1.474858106726178e-01   +3.165785789765129e-01   +9.231629362268244e-02   +6.849202965344811e-01   +5.354720839560465e-01   +3.900311504882021e-01   +4.501475870873908e-02];
L2E_L2I_iGABA_netcon = [+8.889944383709817e-01   +5.884188827236085e-01   +6.299972041701447e-01   +6.961600150188965e-01   +2.174588834844067e-01   +2.173934466846061e-01   +3.205550713857072e-01   +3.662757015456436e-02; +2.843791608325533e-01   +7.524288429040089e-01   +9.606204410070134e-01   +8.793754366667178e-01   +2.834127526507571e-01   +4.074134101725206e-01   +6.925608401819253e-02   +6.241259790943442e-01; -2.554303534275562e-03   +5.990329251967753e-01   +8.501095468527313e-01   +5.802850321507674e-01   +4.609305448488199e-01   -4.649889504201417e-02   +4.334470426404972e-01   +4.929481616267489e-02; +4.331146232042270e-01   +1.721728176381075e-01   +7.120348628208433e-01   +1.716581025894826e-01   +4.444313937855449e-01   +1.849915862795492e-01   +1.880343199357292e-01   -3.067926413239777e-01; +5.365630194367876e-01   +6.248085591633485e-01   +4.702971363743489e-01   +4.052195857026029e-01   +2.457810795504484e-01   +7.906138539365280e-02   +7.659733491808295e-01   -1.023404873704906e-01; +5.290445756022560e-02   +6.762372585121593e-02   -2.145387937539892e-01   +2.358911039213044e-01   +6.989452637153671e-01   +4.289378179185886e-01   +2.401715973446012e-01   -9.316229175271809e-02; +4.076407486530372e-01   +3.489150798182497e-01   -1.664472683455065e-02   +4.344809121597704e-01   +5.126237879296542e-01   +7.094007310950649e-01   +5.333977190307848e-01   +5.972684630723735e-01; +4.362850607497482e-01   +8.943089444185473e-02   +4.316352423727748e-01   +5.186944844007650e-01   +3.385486135114900e-01   +4.297078175146465e-02   +3.540240739458876e-02   -2.627834355699746e-02];
L3E_L2E_iAMPA_netcon = [+9.265810860678428e-02   +7.067611768467895e-02   +5.601317528689285e-01   +1.899859631748413e-01   +5.168500856240612e-01   +4.119773932339598e-01   +4.761349987252466e-01   +5.183937585159286e-01   +3.682655270318348e-01   +6.688920854546343e-01   +6.527940249923567e-01   +4.032725970729713e-01; +3.550100215107988e-01   +2.299924436053485e-01   +4.601032579548737e-01   +3.374646501459670e-01   +2.223261941727213e-02   +3.105528800299639e-01   +8.394910166134587e-02   +7.111158274092264e-01   +3.639578376111863e-01   +3.526607392533397e-01   +3.841200963026130e-01   -2.541755372759161e-01; -1.693263721963734e-01   +2.626817301718709e-01   +5.589505609928389e-02   +3.341260346832407e-01   -2.464782570081465e-01   +9.099271684923652e-02   +5.884029029318790e-02   +1.019316657398984e-01   -1.871544710425793e-01   +1.027681847099852e-01   +1.044143986945299e-01   +2.818393667233308e-01; +3.675618404925620e-01   +9.919617760045714e-02   +4.255012575886710e-02   +1.662560344165119e-01   +3.422824853452602e-01   +2.250569235869230e-01   +5.766750295773346e-02   +1.120023305508305e-01   +3.812645752506622e-01   +1.265825984126349e-01   +3.039676384984566e-01   +7.139065828515810e-01; +6.173110707614274e-01   +2.694988176331730e-02   +4.642144143190249e-01   +2.732237742418969e-01   +3.012240261950867e-01   +7.440971428220574e-01   +5.353627894147799e-01   +6.658978883278324e-01   +7.264574252368670e-02   +4.406222489083385e-01   +3.233157138959749e-01   +2.698280020353730e-01; +6.000511676206656e-01   +1.970102885237666e-01   -1.738393455369693e-01   +5.841486542992512e-01   -8.280513534962881e-03   +6.235817267533295e-01   +7.693039200199836e-01   +1.131695678436890e-01   +1.119855197967295e-01   +6.842685606100148e-01   +2.404176569864596e-01   +5.069079833332834e-01; +3.436977801599114e-02   +4.722144411052376e-01   +1.399641093227924e-01   -1.671414349912432e-01   +1.000000000000000e+00   -1.291599037629783e-01   +2.427715850756550e-01   +5.183876058689197e-01   +8.467776084311152e-02   +4.689969137399296e-01   +3.632924777565366e-01   +7.984328771398267e-01; +2.571763372618844e-01   +1.476156880744022e-01   +1.520025654470822e-01   +4.100172680719767e-02   +6.344301026748671e-01   -3.484917074114243e-01   +5.047467172724869e-01   +9.909143072810785e-02   +5.853885966516644e-02   +4.323791378264081e-01   +6.086831472569397e-01   +4.210705619277643e-02];
L3I_L2I_iGABA_netcon = [+4.541581456611409e-01   +4.430500262339045e-01   +5.870676304037978e-01   +2.385071603285720e-01   +1.259656870254093e-01   +4.873472949990295e-01   +4.088651137649982e-01   -1.127005057786039e-01   -1.624144629323685e-03   +4.440803573682603e-01   +4.199758016951217e-01   +6.609753769583421e-01; +2.118437294116097e-01   -1.873415708705383e-01   -2.618883748542591e-01   +6.107611518893740e-01   +1.391940264963645e-01   +5.732737127786586e-01   +3.290967181189755e-01   +2.891890634655050e-01   +8.915343304621214e-01   +8.912222404925442e-02   +8.681125143937463e-01   +3.528086756638623e-01; +9.650708370829418e-02   +7.096939757289463e-01   +7.019331670390845e-01   +4.388744376589117e-01   -7.260992963622499e-02   +4.272700892705400e-01   +4.630926637473712e-02   +6.702331352967472e-01   +5.247335689016538e-01   +4.621521597164145e-01   +6.016769333247353e-01   +5.292937745070837e-01; -2.536585535944801e-01   +3.877493120914725e-02   +7.727791117518559e-01   +4.751754206934475e-01   +3.916584813954360e-01   +6.275584438264823e-01   +1.864513909223825e-02   +3.210508181788933e-01   -2.127391836451293e-01   +2.805798975471823e-01   +1.941287099402430e-01   +9.548568070882056e-02; +8.700743393920468e-02   +2.107341468268290e-01   +2.659801317761451e-02   +4.213583879379080e-02   +2.383290203525036e-01   +4.891951576734113e-01   +9.905879118801423e-03   +2.623652497233759e-01   +1.894010004379698e-01   +5.873655114446643e-01   +6.417720808710786e-01   +4.214726960384650e-01; -1.454974657243613e-02   +5.814145261424121e-01   +2.164433191993127e-02   +5.890145295469503e-01   +3.649247121110169e-02   +3.125238255213984e-01   -2.417964053735163e-01   +1.719121899739445e-01   -2.737227486061553e-01   +8.025173096939198e-01   +6.886101578808899e-01   +4.423711929326686e-01; +6.014454073092049e-01   +4.764831874914448e-01   +6.942514161955926e-01   +5.615880086122288e-01   +4.112228788051636e-01   +3.785499394274346e-01   +4.797525597233770e-01   +1.324187409875863e-01   +2.602535435632550e-01   +7.599202244835491e-01   -9.840385621249280e-02   +2.730265243132126e-01; +4.549147548791763e-01   +6.180088483503213e-01   +3.611211379084625e-01   +1.604734878190297e-01   +4.390014555905165e-01   -3.776882566041072e-01   +1.000000000000000e+00   +5.269391693436848e-01   +7.495101589922990e-01   +4.954006972679632e-01   +2.309876451336538e-01   +5.090941988070077e-01];
L2E_L3E_iAMPA_netcon = [-4.837071842120773e-02   +3.257652265046152e-01   +5.996044528775459e-02   +6.364627732021798e-01   +3.520135085717753e-01   +1.889335578994872e-01   -6.888211189003493e-02   -2.056621595686305e-02; +3.874711631071507e-01   +4.821579675824704e-01   +8.651864820633257e-02   +5.708475610660084e-01   +1.128614788738018e-01   +4.162193395568468e-01   +1.574678489598518e-01   +6.069148539478559e-01; +5.803368812562228e-01   +3.227577427624813e-01   +8.665686768374695e-02   +6.149157614294053e-02   +5.254776080207457e-01   +1.311371949989340e-01   +1.567880623822104e-01   +3.183512830432287e-01; +2.790834965795347e-01   +6.419085132865864e-01   +3.685380617684959e-01   +2.182470580786320e-01   +7.517134440073845e-01   +4.340975078330607e-01   -1.476163606368958e-03   +3.766664319068251e-01; +2.082728354212838e-01   +1.041088067624006e-01   +4.983843251577414e-01   +4.300659604654612e-01   +3.389201959897370e-01   -1.147699726652599e-03   +5.444517604989494e-01   +1.354800639768025e-01; +4.575422571902140e-01   +6.413895416784942e-01   +1.506980035923597e-01   +7.089703649992903e-01   +1.895911036960722e-01   +2.202074571977957e-01   +3.416699228541110e-01   +5.726306052073102e-01; -3.874489362810507e-02   +3.109665402379904e-01   +4.778281205869751e-01   +4.766435980515210e-01   -1.102352690972026e-01   -9.104351025134549e-02   +7.778194788125609e-01   +2.669664705790982e-01; -1.485253229741568e-02   +7.637636124863030e-01   +2.656564234405829e-01   +4.025408752403101e-01   +2.249564120586781e-01   +5.059480723487092e-01   +4.453075071702814e-01   +9.901732389925672e-03; +7.609273138640543e-01   +6.181448526759076e-01   +2.684847062216718e-01   +7.197136061005054e-01   +1.003123547121745e-01   +2.882061399531324e-01   +3.680476555002858e-01   +9.418921344162341e-01; +3.066993104942609e-01   -8.498012052022572e-02   +2.437207007759897e-01   +6.213115596368985e-01   +4.099628331807896e-01   +1.014519025282645e-01   +5.885943724366265e-01   -4.043676818865292e-01; +1.245359703357860e-01   +2.959929149815436e-01   -4.801042167840457e-02   -1.467881410411981e-01   +2.205363487777969e-01   +2.681396848671967e-02   +2.426735771703466e-01   +7.907855697088915e-01; +3.070311032653363e-01   +6.234245855069928e-02   +5.597066414665689e-01   +3.664700610576280e-01   +5.801983261002116e-01   +1.301926397893946e-01   +3.209170205458109e-02   +3.623827639053743e-01];
L2I_L3I_iGABA_netcon = [+1.501451501064722e-01   +2.640702972669617e-01   -2.924034142806989e-02   +9.698482454816116e-01   +1.548381629118464e-01   -2.830188214779442e-02   +3.752646848049319e-01   +3.349198071606623e-01; +4.102480799656120e-01   +1.449523824408630e-01   +1.193823669709997e-01   +1.428775493856365e-01   +1.980667797066098e-01   +3.954115683551421e-01   +1.000000000000000e+00   +2.022070157090543e-01; +1.125052151436251e-04   +3.477615991144618e-01   -2.399738397756859e-01   +5.603075033649657e-01   +1.980625622913331e-01   +1.176252402861809e-02   +1.504254854073914e-01   +3.548142779851394e-01; +6.706480073616082e-02   -4.082685314230990e-01   +3.897364847025631e-01   +4.585028414242689e-01   +5.613223879932870e-01   +2.744431035673032e-01   +4.882545403785286e-01   +1.705649373422048e-01; +1.240447701229121e-01   +5.011141130388036e-01   +3.211324961586385e-01   +1.500957484288828e-01   +3.378350039953956e-01   +3.759652114904313e-01   +2.620667824955215e-01   +4.210117314704023e-01; +2.157490842122403e-03   +3.189471174652646e-01   -5.634300033633126e-02   +5.130667807718542e-01   +2.916604708861031e-01   +6.186466109956674e-01   +7.716106744074860e-02   +4.311691502471709e-01; +4.647459528278872e-01   +3.610102603642201e-01   +1.470513845443450e-01   +5.457629662373972e-01   +5.516781595648574e-01   -4.366659506902044e-02   -1.485313536915006e-02   +2.378194672964042e-01; +4.437012787315687e-01   +5.855768950181922e-01   +7.268653554936034e-01   +3.268971633754977e-01   +3.065881124219454e-02   +5.770019717819346e-01   +6.562872363293244e-02   -7.965794034341089e-02; -6.541149670298528e-02   +1.736745765475221e-01   +2.364006457202190e-01   +1.888589534522174e-01   +4.980753282879736e-01   +5.080565879841377e-01   +4.662112959348511e-01   +2.665556107219416e-01; +4.812817507809383e-01   +3.715670432943052e-02   +3.558362059193108e-01   +4.462441945335216e-01   +5.091525912114144e-01   -2.108110620687781e-03   +3.845669520170537e-03   +1.154378853748678e-01; +2.412097136972657e-01   +6.819939841616802e-01   +3.340348455211571e-01   +3.772008457536386e-01   +1.054161076323527e-01   +1.312203380903745e-01   +4.284143278526032e-01   +1.678323463597986e-01; +7.899587891621011e-02   +1.172148804429936e-01   +7.377040660620712e-02   +1.372412102682402e-01   +6.331556103520540e-01   +4.233474050533672e-01   +6.220131314613587e-01   +1.048772012976037e-01];
L3I_L3E_iAMPA_netcon = [+2.193803709394052e-01   +6.655977662592035e-01   -3.218615250532099e-01   +5.690891473282809e-01   +9.864928656122096e-01   +9.984325846273828e-02   +3.289946397127663e-01   +5.310584676608163e-01   +2.721737989354762e-01   +5.938985740887960e-02   +2.822648767148499e-01   +4.405662273661239e-01; +6.582110255525000e-01   +9.096999446814894e-01   +3.271010842496248e-01   +3.205012140658188e-01   -1.480700346048113e-01   +5.760045539424175e-01   +5.284655965125113e-01   +8.988698513583057e-01   -1.600360459178548e-02   +8.950309054517164e-01   +4.004086713824631e-01   +5.291451319514715e-01; +2.913800555222668e-01   +5.250651620501613e-01   +2.295407225737258e-01   -3.113934326900747e-01   +8.847540509586901e-01   +5.423677094939038e-01   +2.386672608412526e-01   +8.298136939426438e-01   +3.423346084693681e-01   +2.521820236621536e-01   +7.290807497820724e-01   +5.058253784071044e-01; +8.079451704531444e-01   +3.592049551975596e-01   +4.854439776272912e-01   +1.000000000000000e+00   +8.594223971883880e-01   +8.070642390763501e-01   +7.050578124328645e-01   +5.526888700833520e-01   +1.230409159835203e-01   +5.713828190603426e-01   +3.647527090851392e-01   +6.808609508929920e-01; +2.360058131943304e-01   +3.252916521796199e-01   +4.530047940851332e-01   -1.396618120978965e-01   +5.735746858599600e-01   +8.399429421707848e-01   +5.580259811929963e-02   +8.561815780934431e-01   +9.734003654860790e-01   +2.366055831979155e-01   +8.216570691716635e-01   -2.662912793777008e-01; +1.108535925949674e-02   +6.634640639232953e-01   +4.112695725678548e-01   +2.898926619757768e-01   +2.553873857791784e-01   -8.856094937363092e-02   +5.180842739405443e-01   -8.215258271894124e-02   +3.238039467669636e-01   +3.410909524437264e-01   +4.385474443744714e-01   +1.892667971487546e-01; +1.244796102910049e-02   +1.294101322687393e-01   +1.658717249860335e-01   +2.198336835073676e-01   +7.911186387928103e-01   +3.502024319872808e-01   +4.680263322473917e-01   +4.929875613121074e-01   +8.535141321457307e-02   +5.415806114961220e-01   +1.231403382686655e-01   +2.558286355194621e-01; +3.287547913809117e-01   -1.060065118126161e-01   +3.250988702748039e-01   +9.802874813964876e-02   +2.990588623381090e-01   -7.077124973112124e-02   +1.813196653243764e-01   +2.333450320465008e-01   +1.391210465764123e-02   +7.813404371710386e-01   +4.932725753608715e-01   +2.557615648382738e-01; +1.490992123094564e-01   +4.112717304777748e-01   +3.927780405693285e-01   +1.216597694531740e-01   +3.158092243868303e-01   +1.168574441281204e-01   +3.260176452917565e-01   +2.282116801903956e-01   +6.404826407072205e-01   -1.452896816218081e-01   +4.830656849833280e-01   +3.204087831873401e-01; +5.984156891819312e-01   +7.644715003514440e-01   +4.151475790914334e-01   +5.361821935201085e-01   -2.206650108588190e-02   +4.746645776107163e-01   +6.000625503321816e-01   +6.603675347064204e-01   +6.638298079065990e-01   -2.154558099413629e-01   +6.945374748277890e-01   +2.922831292570190e-01; -1.153663733449514e-01   +1.579855304665736e-01   +2.956228553857800e-01   +4.683437355345134e-01   +2.111470055155371e-02   +2.402910321106615e-01   +7.029556422387578e-02   +6.243078859308272e-01   +9.310726379998958e-01   +5.615753149768887e-01   +2.986059969198076e-01   +5.326617343067466e-01; -1.851453749437127e-02   +6.423355554245136e-01   +1.456796978081066e-01   +6.354371025268095e-01   +9.608238678113210e-01   +1.831947335921833e-01   +1.933524602197946e-01   +5.820774435361314e-01   +5.254761070184074e-01   +1.082066430021213e-01   +2.071854465526992e-01   +1.376196534093239e-01];
L3E_L3I_iGABA_netcon = [+7.092864210421425e-01   +6.693623554711196e-02   +1.272715851766345e-01   +5.176045796552275e-01   +5.696196836623285e-01   +8.174178397413049e-01   +6.061991768094898e-01   +8.718311086167116e-01   +5.007684636572260e-01   +2.152012393203077e-01   +3.927036372908917e-01   +4.281853393622314e-01; +3.744250669180921e-01   +2.505393123532662e-01   +7.432799919771628e-01   +4.872533783282272e-02   +4.809847572480598e-01   +7.001700002112282e-01   +9.259123978538246e-01   +1.643789265101212e-01   +1.599831650785810e-01   +2.212862032872081e-01   +7.822060088756960e-02   +5.833899362046104e-01; -9.158093055103560e-03   -1.198218183467819e-01   -4.118274773577761e-01   +6.602225659123688e-01   -1.028245783576911e-01   +5.878898136689720e-01   +3.032619196978649e-01   +6.513701884397504e-01   +4.991791321780192e-01   +6.037323918618138e-01   +4.029712018551731e-01   +3.259293962442126e-01; +2.939219095524878e-01   +6.002292170976099e-01   +5.083248033128839e-01   +2.561788856369082e-01   +6.145646036804303e-01   +3.568710438815052e-02   +4.558131102210788e-01   +2.918125107710083e-01   +5.225524377159878e-01   +6.077851710633252e-02   +6.779989503843025e-01   +1.662963650418309e-01; +3.850159823713905e-02   -2.374181693449450e-01   +5.145423697657684e-01   +5.053842289016256e-01   +1.286734169146888e-01   +1.078422412484489e-01   +5.457068679215704e-01   +4.532043113951850e-01   +2.096875850262032e-01   +1.243579668036015e-01   +4.237716829655244e-01   +5.603408142372884e-02; -2.632185930147219e-01   -8.656737353998125e-03   +6.369490708027762e-01   +5.923838268295126e-01   +4.994521134857271e-01   +4.640445009207388e-02   +9.124432301561734e-03   +1.587666483840657e-01   +5.060654624522457e-01   +3.289643190928755e-01   +4.136581905345165e-01   -2.483531133179638e-01; +7.295320065924192e-01   +3.289490403121831e-01   +4.317644888721750e-01   +3.811241190616608e-02   +5.566726567360569e-01   +2.442469375993796e-01   -1.581356697532442e-01   +6.446276096903581e-01   +4.508314231999209e-01   +4.016524257723336e-01   +4.735433307144745e-01   +2.617742283208258e-01; +2.076808964611279e-01   -1.886205997293880e-02   +9.066293599833827e-02   +5.115226075917709e-01   +6.020147260888331e-01   +2.490212857853697e-01   +2.684249706857959e-01   +4.199558146295533e-02   +5.180293807421752e-01   +2.441838169649635e-01   +4.793069807196900e-01   +7.292637559841005e-01; +1.670588556206037e-01   +1.688548707938228e-01   +4.042579194287095e-01   +7.582608384944080e-01   +4.468609126035553e-01   -3.587572030386382e-01   +5.672354399334657e-01   +3.485162387275524e-01   +1.694107778024428e-01   +1.060031910584493e-01   +5.861706578304755e-01   +7.588268253615054e-01; +2.697834402776623e-01   +7.834636396319770e-01   +7.916896913430239e-01   +1.000000000000000e+00   +4.255428264150843e-01   +3.769778438640883e-01   +7.246971094553254e-01   -2.251890647396023e-01   +7.446301160081262e-01   +4.334146098945635e-01   +1.945556828566005e-01   +1.772474912052133e-01; +3.096012983443039e-01   +4.936238969587496e-01   +1.959342865800494e-01   +7.123290038015039e-01   +4.976243009746014e-01   +2.603879931563945e-01   +5.623398277213665e-01   +6.210936569827814e-01   +7.046037903910088e-01   +5.096342481593615e-02   +2.625874134311470e-01   +7.435098667335727e-01; +6.521690690689529e-01   +2.103852596344409e-01   +3.822326824214309e-01   +4.405477536318876e-01   +2.878003316489022e-01   +3.972439379543181e-01   +3.267884234005938e-01   +1.886396852872718e-01   +2.941891046626199e-01   +3.345616687577131e-01   -2.879150499858377e-01   +4.344836483995508e-01];
L2E_Input1_iAMPA_netcon = [+3.675715605048119e-01   +6.847236289364401e-01   +5.909902884193373e-01   +7.615522318490607e-01   +9.568375604127921e-01   +6.052573462285872e-01   +9.065697220805702e-01   +5.507020597339652e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +4.782278169774792e-01   +5.495906030400411e-01   +4.473837061630953e-01   +5.518668124465265e-01   +9.047109423805444e-01   +9.460081935055670e-02   +5.084267767998678e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
