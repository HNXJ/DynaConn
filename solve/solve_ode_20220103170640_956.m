function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.899680219907999e-01   +2.679853626251018e-02   +2.416522341198484e-01   +5.130335531473897e-01   +3.785869963198437e-01   -4.420398839168882e-02   +5.325917374624225e-01   -4.459678055135307e-02   +5.296533182816106e-01   +4.096494034539385e-01   +1.692281783791706e-01   +8.315961051351748e-01   +4.371224430007640e-01   +6.890527471328914e-02   +5.781030461847655e-02   +7.791539097038160e-01; +2.396690197176462e-01   +5.519194375497379e-01   +6.111131148888138e-02   +4.111021678534518e-01   +3.853674417149509e-01   +8.103421661987033e-01   +6.579787568681412e-01   +6.789102789525499e-01   +4.652092851949751e-01   -1.037956111708012e-02   +1.587844417227705e-01   +8.009027032099274e-01   +2.259635754689704e-01   +4.067597680106136e-01   +6.034873784884358e-01   +3.781519538615389e-01; +2.758948108278914e-01   +2.193730570309025e-01   +5.475935543987507e-01   +8.828613985623701e-01   +7.228873501630686e-01   +3.482301805727724e-01   +2.042544865992489e-01   +7.219676637852760e-01   +3.228896524148068e-01   +9.386219826127514e-01   +5.549625724454361e-01   +5.108388080611286e-01   +2.830077668934061e-01   +9.327643539235643e-01   +2.591017219298726e-01   +2.479479570869755e-01; +7.533027592615722e-01   +3.833974315041458e-01   +2.940251028940587e-01   +7.305552920012347e-02   +4.739301247887642e-01   +1.847884234193800e-01   +2.760997422062266e-01   +5.631664957170981e-01   +7.292414921055810e-01   +2.482671051205877e-01   +2.263529219058145e-01   +1.473106065573166e-01   +1.458394740167335e-01   +2.915508102891966e-01   +6.620499604994857e-01   +7.547799087574549e-01; +1.595516840303606e-01   +5.323264472164076e-01   +5.202463575685194e-01   -4.373598311662707e-03   +6.066861142316291e-01   +1.814553973281463e-01   -1.110433774227819e-02   +2.957261775842621e-01   +1.785566875314299e-01   +6.317488875396213e-01   +5.704461706609673e-01   +6.822738913186458e-01   +4.500981275190391e-01   +1.424203504726856e-01   +3.663318385861625e-01   +1.647042581237752e-01; +7.016926917706150e-01   +4.898939325168150e-01   +6.116454705779761e-01   +9.122450704931813e-01   +2.419572624338845e-02   +6.856029503719551e-01   +3.402673889718000e-01   +7.097256185468830e-01   +4.253268498900524e-01   +1.389049645653992e-01   +3.790914554972180e-01   +2.673072110809928e-01   +6.428922109152256e-01   +6.385823784795054e-01   +2.392151662224595e-01   +4.207539721170863e-01; -6.929303480246261e-03   +2.422811316475132e-01   +4.067873546407971e-01   +6.828448318419955e-01   +2.136108043990842e-01   +7.608100721168622e-01   +3.640686776312768e-01   +1.182274983710303e-01   +6.298723379513928e-02   -3.667145066859078e-02   +1.200510811955413e-01   +3.461658356903216e-01   +4.701636576780551e-01   +2.495429837601882e-01   +4.187616152001970e-01   +6.860306041533965e-01; +1.081643649725052e-01   +9.978626986049620e-02   +3.683472455749630e-01   +7.249419820461442e-01   +8.336539749790917e-02   +6.433525032905689e-01   +1.154768130610086e-01   +7.376036801215508e-01   +6.272103253838094e-01   +4.646769944001440e-01   +3.853811122511764e-01   +3.419139625909359e-01   +5.082348228131450e-01   +1.751298420444690e-01   +2.089162715731572e-01   +3.209740087235792e-01; +1.518088779737924e-01   +5.748126945499670e-01   +3.429721390603991e-01   +3.639381705191488e-01   +6.821522089695885e-01   +2.710947981775055e-01   +3.883959122329290e-01   +7.080867925981476e-01   +2.807720815511568e-01   +7.197474892340094e-01   +6.791475681894362e-01   +1.062713443293838e-01   +9.300579684649056e-01   +4.744172918775801e-01   +9.231073174477175e-01   +3.518175283186542e-01; +8.095343934028753e-01   +5.955163008883946e-01   +6.645736611965903e-01   +7.246432806636370e-01   +3.920099187292674e-01   +7.617204865772909e-01   +9.543799868108513e-01   +3.612201391345828e-01   +8.291420994164574e-01   +5.726276299433144e-01   +4.579676184890419e-02   +5.282263984199278e-01   +1.376955176380740e-01   +7.268504539249311e-01   +8.650348351444410e-01   +6.181467703006417e-01; +5.223730382311574e-01   +5.540537565596653e-01   +7.111964104277250e-01   +2.750014489073279e-01   +2.581971540069383e-01   +1.961954026981636e-01   +3.668633974084867e-01   +6.736680435448696e-01   +6.708920526928495e-01   +4.674465995759885e-01   +5.178591043576051e-01   +3.591575538685260e-01   +5.026435781688807e-01   +6.533121557110290e-01   +2.297437318376793e-01   +5.438167149112154e-01; +2.010940832872829e-02   +1.260822427634768e-01   +6.369685799297169e-01   +4.876461206425772e-01   +6.120389302972719e-01   +4.873400297142686e-01   +1.362957332659109e-01   +4.112232875638234e-01   +7.220147774423901e-01   +7.101757153477352e-01   +6.065741686390653e-01   +8.029521289166183e-01   +7.573085937383002e-01   +3.058265964473560e-02   +5.396159536439441e-01   +1.317836834559475e-01; +1.605369637600405e-01   +6.047709971938935e-01   +8.729728533331566e-01   +7.249488768023099e-02   +1.293301591977518e-01   -8.064826378412097e-02   +2.159645012588521e-01   +1.255275801277943e-01   +3.814779197741461e-01   +5.723528885773717e-01   +1.063946078705273e-01   -2.382750871454993e-02   +4.153844583982105e-01   +7.187390157700906e-01   +3.510806920409629e-01   +3.930480380050909e-01; -1.164408970230314e-01   +1.397022867792367e-01   +6.710530789798764e-01   +9.293952533632716e-01   +1.991306271728138e-01   +4.061744346273430e-01   +6.682573386080710e-02   +3.246261096964286e-01   +3.106251302550982e-01   +5.500438207429422e-02   +3.160112095997496e-01   +2.398560039897605e-01   +2.728861947760445e-01   +8.840975554783409e-01   +1.957822108573011e-01   +8.956995121418760e-01; +5.966721465436660e-01   +2.376238623197691e-01   +6.382201993536966e-01   +7.809240399978042e-01   +2.049384312235683e-01   +2.237529614716861e-01   +6.630402538189465e-01   +5.026909444054184e-01   +9.317196882977377e-01   +3.262623081233118e-01   +3.339818833458502e-01   +8.296609419344791e-02   +7.203656805508970e-01   +8.057243143073080e-01   +7.923763115594227e-01   +1.550288605122947e-01; +2.710111294787562e-02   +3.644317602247701e-01   +5.395156593134577e-01   +7.497640499984901e-01   +7.467549543264210e-01   +5.840519782253911e-01   +5.761443765452507e-01   -4.553297448744116e-02   +6.726025018029642e-01   +3.763182391780673e-01   +5.024405136426273e-01   +3.440633617610632e-01   +1.000000000000000e+00   +1.943083863984304e-01   +4.123293114139607e-01   +5.945542850412319e-03];
L1E_L1I_iGABA_netcon = [+1.055310552207217e-01   +7.445870822907563e-01   +2.260067440329382e-01   +2.028585860081507e-01   +2.780404930188015e-01   +6.243587105492043e-02   +7.818294617484985e-01   +3.003464546912608e-01   +1.268161722041989e-01   +5.192959876151001e-01   +5.324368738397574e-01   +3.221868598114611e-01   +3.787916977029410e-01   +2.773930284893417e-01   +2.969821195389448e-01   +7.109074385231786e-01; +2.421563889271149e-01   +2.540029893965249e-01   +7.655299697023338e-01   +2.571507323780191e-01   +5.272708936185692e-01   +2.422408352710276e-01   +4.788782142089743e-01   +2.017608462028374e-01   +2.288842386410428e-01   -9.851725344377459e-02   +6.621627221563392e-01   +3.808162449792695e-01   +9.788993374047135e-01   +2.734376694623005e-01   +1.072404781400581e-01   +2.028483499162316e-01; +2.597669792853364e-01   +2.746216276403536e-01   +9.702369486492415e-02   +2.530266171190161e-01   +2.531477404807291e-01   +6.497520786293364e-01   -4.803112556517414e-02   +1.931074587422184e-01   +7.056679725902423e-01   +3.707791125060524e-01   +1.313777242300524e-01   -1.557626897502755e-01   +4.026489280549170e-01   +7.294875387122620e-01   +1.201899844151739e-01   +4.964817238651466e-01; +7.230681189005398e-01   +1.824098378168378e-01   +5.294891904330257e-01   +3.749941274675692e-01   +7.348489898280047e-01   +7.233807886152668e-02   +6.425726996925797e-01   +4.528350745525812e-01   +7.190620183909177e-01   -3.558392126892023e-03   -8.946951815279043e-02   +6.605142205056084e-01   +2.743419338673467e-01   +5.747068818252197e-01   +4.238210354077439e-01   +2.513594987949327e-01; +1.257666231350411e-01   +2.226703059706443e-01   +3.414368866027405e-01   +7.766205127122281e-01   +6.428041920637927e-01   +4.272220448857952e-01   +7.215166654618167e-02   +6.192924065415716e-02   +8.242880240221816e-01   +3.394217785490932e-01   +7.394010149298315e-01   +8.682733920683439e-02   +1.708699772983032e-01   +4.554870843106401e-01   +5.165738239279593e-01   +2.462761781078644e-01; +6.072428479633304e-02   +8.784775843768622e-02   -4.766191468926624e-02   +5.828071610349701e-01   +2.637716613217897e-01   +8.603263430879060e-01   +5.060628135319636e-02   +8.185154195212675e-01   -2.425781020978535e-02   +3.916512075209111e-01   +6.699516408871914e-01   +4.742724116507780e-01   +4.108689710014115e-01   +5.587205274007813e-02   +6.497530833483692e-01   +3.499679019051016e-01; +8.346871020476547e-01   +2.217311424674305e-01   +8.538926111583441e-02   +3.738140197632451e-01   +8.021455686685565e-01   +4.433269619708359e-01   +3.078777938610071e-01   -8.752573049002565e-02   +6.134699659555145e-01   +3.335763794236097e-01   +3.643234255367938e-01   +6.857410437798424e-01   +2.631551559967288e-01   +1.037746967496577e-01   +4.540475613235047e-01   +2.513027388578931e-01; +3.130927275760614e-01   +4.887034591480337e-02   +2.524856313572520e-01   +3.430174886733171e-01   +1.522460366960964e-01   +7.477111017502425e-01   +2.180670166771074e-01   +1.487379594057960e-01   +4.758618088163499e-01   +7.067626410587894e-01   +6.448816712497742e-01   +4.434021435799099e-01   +7.259386351258690e-01   +8.416988393658079e-01   +4.977126535911267e-01   +3.716821724725575e-01; +4.585135973544766e-01   +9.003744350005051e-01   +4.593715885866526e-01   +6.343371112423595e-01   +4.227446018781191e-01   +3.002664897603080e-01   +4.286534344906492e-01   +3.465065232744888e-01   +7.985131360354378e-01   +5.637966909967861e-01   +7.968624470668823e-02   +5.304917483798011e-01   +6.978677698063929e-01   +2.617933117991129e-01   +2.478678253609439e-01   +2.540839075657401e-01; +4.435383726970055e-01   +2.578675303314703e-01   +4.714442218428226e-01   +3.867846505415610e-01   +5.494866290762965e-01   +7.393515485837783e-01   +7.247677346204023e-01   +1.000000000000000e+00   +3.743312540928227e-01   +5.378888924268853e-01   +2.938132307004382e-01   +6.446423424946993e-01   +3.305969642066955e-01   +8.218012756691385e-01   +7.701828340756890e-01   -6.027130081430006e-02; +6.333077839769656e-01   +7.695884991898623e-01   +5.399608094006113e-01   +5.752416185340640e-01   +7.547446708434918e-01   +5.659528181363769e-01   +4.407773439875824e-01   +7.381900207176215e-01   +2.826948906309227e-01   +6.193628400350009e-01   +2.161006650552495e-02   +5.099844454303676e-01   +1.862067132467017e-01   +8.169610486010247e-01   +7.707570307546675e-01   +4.087647808705879e-01; +1.013119652901986e-01   +5.079115820419727e-01   +5.369450839225169e-01   +5.866762298773607e-01   +4.200583071911268e-01   +9.366165215205787e-01   +3.962355259310419e-01   +6.327063723533384e-01   +2.388643914435325e-01   +5.825749758100263e-01   +8.165126814940443e-01   +8.171701213666764e-01   +5.907586945609226e-01   +9.060851739881547e-01   +6.810201824666552e-01   +3.561145886198794e-01; -4.496220757498896e-02   +7.982519698391779e-01   +3.289217770180106e-01   +2.656340847717130e-01   +7.859799407670878e-01   +6.353430486403123e-01   +7.109167176152041e-01   +5.674851730727507e-01   -3.179424865264775e-02   +2.032139792253148e-01   +3.947948135114800e-01   +6.675369498278881e-01   +1.482505499689532e-01   +5.397597578019864e-01   +1.407298324798445e-01   +5.303487814239120e-01; +2.352459687947913e-01   +4.860070072500825e-01   +7.195231997276814e-01   +7.953792293421961e-01   +8.399908827776017e-01   +2.759092230752959e-01   +6.823995181894391e-01   +5.778294097554022e-02   +3.152069040194414e-01   +1.191974315236992e-01   +4.886147748924000e-01   +3.301770258153642e-01   +7.073828834772820e-01   +2.941540439646330e-02   +4.718616381122103e-01   +1.419553483406554e-01; +7.788658536265447e-01   +7.384444508053806e-01   +7.297911478464730e-02   +6.598271295238065e-01   +2.168208276942321e-01   +4.951593796355944e-01   +1.492262064223749e-01   +8.106690635738686e-01   +4.516214624555273e-01   +1.090887533335914e-01   +3.587165442487348e-01   +9.096888006312037e-01   +2.372799753463802e-01   +1.589620119866319e-01   +3.569247349700791e-01   +2.907774261650724e-01; +7.250119242249788e-01   +3.566806704271405e-01   +4.302743851050871e-01   +7.020728005179826e-01   +4.901612364771494e-01   +3.657432427843605e-01   +2.875446837082204e-01   +7.213328869671631e-01   -1.282884672720737e-01   +3.250737275420337e-01   +2.632913742392175e-01   +7.844518346115247e-02   +5.562999252260904e-02   +3.875609156960744e-01   +4.479013210073912e-01   +2.817401649018234e-01];
L2I_L1I_iGABA_netcon = [+6.519967883503124e-01   +6.672814218339924e-01   +8.122258644407451e-01   -6.848466652533647e-02   +3.253832981065770e-01   +2.892328479201481e-01   +1.000000000000000e+00   +1.290038292791365e-01; +4.217474260638355e-01   +3.166988931161882e-01   +2.386963767945843e-01   +6.205738791758824e-01   +8.060063695147931e-01   +4.895044858315279e-01   +8.010120659225830e-01   +6.070816342206004e-01; +7.414576026303357e-01   -9.757280816475331e-02   +8.014568228264652e-01   +2.394474081214798e-01   +2.873108139183359e-01   +3.262564757289229e-01   +5.764521610283752e-01   +7.477066369084662e-01; +1.175872322148532e-01   +5.862055865270707e-01   +4.227803697326635e-01   +1.956754130388193e-01   +8.379291458384740e-01   +2.915138389560114e-01   +3.971521011503394e-01   +5.418361403782951e-01; +4.635752505663501e-01   +7.363339541350399e-01   +1.337933423423824e-01   +2.420426919954176e-03   +9.136082045376926e-01   +4.428454522485933e-01   +3.020983165409027e-01   +6.415086767724478e-01; +7.346634023923058e-01   +6.522425950479716e-01   +6.406153818273208e-01   +7.952303806049993e-01   +9.080245754055211e-01   -6.817997486759995e-03   +1.950043158001148e-01   +3.707886548949934e-01; -6.053160744883233e-02   +3.573446659492874e-01   +2.049589257566756e-01   +7.533264415892321e-01   +2.451818898646397e-01   +3.084274462593841e-01   -1.000912887389614e-01   +3.343444546757856e-01; +4.299490776292998e-01   +1.536311287115641e-01   +8.517422807293847e-01   +4.975859357245888e-01   +3.336718619811699e-01   +2.371371029911385e-01   +1.457162572047846e-01   +7.465166126070316e-01; +1.315667511983609e-01   +1.595677749582521e-01   +3.600779373032150e-01   +5.483728248864226e-01   +1.030015172596740e-01   +4.166326906394488e-01   +5.583441049620231e-01   +3.458638927208351e-01; +2.131948178978827e-01   +6.197383149722633e-01   +3.727275921830959e-01   -4.912301817466128e-02   +5.674917263575666e-01   -4.099732868605013e-03   +2.312813761142737e-02   +8.387254998061076e-02; +1.309899951861025e-01   +1.390199068088897e-01   +1.164490418059055e-01   +8.982986670048195e-01   +5.357043937140912e-01   +4.595841738966920e-01   +1.496905519509930e-01   +5.761174861398202e-01; +2.364888260409292e-01   +1.250691345531602e-01   +1.923180377173921e-01   +2.979384107540111e-01   +1.021357437616314e-01   -7.308485939893432e-02   +9.000474816367905e-01   +4.011593280334367e-01; +6.619620179940353e-01   +3.135146466918335e-01   +6.372368216405824e-01   +6.216314485048849e-01   +3.004422677376210e-01   +3.480332476568740e-01   +5.636894987121442e-01   +3.160438047052531e-01; +4.343766658432037e-01   +1.723011626153828e-01   +2.410546141673647e-01   +8.992039427258062e-01   -3.059917083856015e-02   +6.483848368485615e-01   +6.105298312208327e-01   +1.382748051625007e-01; +6.481320642211621e-01   +7.703856819172374e-01   +7.657007048118893e-01   +6.261128525880773e-01   -5.829135646475319e-02   +6.116521030348631e-01   +6.623411796601567e-01   +9.424164119788708e-01; +7.091647902996134e-01   +6.120647005220011e-01   +9.106687682583167e-01   +7.057827861396544e-01   +3.265180948169703e-01   +2.229854009526239e-01   +9.272059139845903e-01   +6.806126190373362e-01];
L1I_L2I_iGABA_netcon = [+7.961926492085790e-02   +1.713057180423432e-01   +3.684428109280964e-01   +5.273579943542496e-01   +5.364787499192456e-01   +7.997929371972159e-01   +6.171061752043990e-01   +3.924325039045791e-01   +7.136786986223086e-01   +1.508831127190904e-01   +3.401232265785248e-01   -4.153618945393121e-02   +8.912872218012220e-01   +2.865635000183601e-01   +3.960105272986745e-01   +5.755469906128774e-01; +9.762686990733338e-01   +7.304637974565561e-01   -2.598260170856439e-02   +1.970113244753957e-01   +5.765774028771354e-01   +7.432717113823023e-01   +4.955466837750087e-01   +2.040161779522915e-01   +8.812642235529573e-01   +9.286853292032228e-01   +1.648444464318581e-01   +7.520246532506433e-01   +6.987904510350578e-01   -1.971343995645619e-03   +6.832797752021064e-01   +4.160650726214938e-01; +3.039519421862140e-01   +8.614258169496390e-02   +4.117011056812493e-01   -8.147775772585703e-02   -1.191996780656328e-01   +3.343894447860086e-01   +1.464516587399943e-01   +7.697067793998326e-01   +1.710088356656404e-02   +5.711915068285579e-01   +7.559595547340650e-01   +3.469922304435170e-01   +2.825638352053559e-01   +4.222517175711958e-01   +5.930058681559596e-01   +2.882921636987160e-01; +8.011739307262040e-02   +6.555506823736482e-01   +2.803182528420956e-01   +1.465181470725773e-01   +3.679090792627162e-01   +4.657020274916470e-01   +7.359756037265313e-01   +8.056700945246397e-01   +3.632908811549287e-01   +1.557316813626115e-01   +3.989847848222924e-02   +1.000000000000000e+00   +1.040692488183489e-01   +3.690158414647947e-01   +6.955125481521394e-01   +3.434172416641635e-01; +7.710272062697542e-01   +8.874691583868450e-01   -7.161643408294226e-02   +7.998408721078205e-01   +6.126702976522069e-01   +7.371301570837279e-01   +7.030044805267334e-01   +3.628700624687710e-01   +9.736649494279968e-01   +5.129414477349633e-01   +6.564509535189810e-01   +5.471274178131682e-01   +6.056206586213251e-01   +5.643195531819925e-01   +3.076829238944127e-01   +5.902868066618587e-02; +3.291274071969918e-01   +4.001271515932420e-01   +6.914879238430197e-01   +3.863805524401406e-01   +4.150899009278145e-01   +8.855648173779543e-02   +6.933259521662916e-01   +4.144988734834319e-01   +5.261441873341195e-01   +3.422367900450143e-01   +2.710316194896509e-01   +1.726695083239541e-01   +7.112814469997997e-01   +7.367492014319948e-01   +8.327268147773172e-01   +2.831040477938533e-02; +8.674752104139435e-01   +2.897905849594813e-01   +2.376811850535860e-01   +9.108430326582047e-01   +4.176342006099537e-01   +5.197943753539189e-01   +9.473895233023872e-01   +6.113515163424530e-01   +1.713113119161112e-01   +4.196815000917820e-01   +6.056022220180033e-01   +2.865169410450720e-02   +3.943242895334276e-01   +4.837261562711893e-01   +7.111463347832273e-01   +2.479261384214276e-01; +4.712808554133967e-01   +6.940987768278054e-01   +6.808743839441048e-01   +5.814660340387131e-02   +8.490007317782698e-01   +5.650758530011569e-01   +2.937999192559292e-01   +5.878738092003343e-01   +1.725817829510900e-01   +3.960616908641692e-01   +6.680748348138629e-01   +4.438748744190560e-01   +7.116375739818416e-01   +4.657012668496081e-01   +1.688365230741284e-01   +4.164441892725565e-01];
L2E_L1E_iAMPA_netcon = [+5.022442206927463e-01   +4.249672412927830e-01   +3.775128483709527e-01   +3.049659622942683e-01   +5.411681212451209e-01   +4.053555107729611e-01   +2.332242637835238e-01   +7.347972280697141e-01; +8.396464431247121e-01   +6.235934039494614e-01   +4.772788293397069e-01   +1.733311459987259e-01   +4.975527884900852e-01   +8.508296321424006e-01   +7.172117132994089e-01   +5.342813781118017e-02; +5.973260502490616e-01   +9.504330877056190e-02   +6.714124348194838e-01   +4.764397651237272e-01   +7.220213833660887e-01   +4.679483378699930e-02   +4.338637799006283e-01   +2.742819826444905e-01; +6.047862807482519e-01   +8.920012047301870e-01   +8.902413787284735e-01   +3.650494702968226e-01   +1.519023604155926e-01   +5.617778168776048e-01   +7.133015917026058e-01   +2.249903953653407e-01; +6.741907209192132e-01   +6.078576248751568e-01   +5.942290960724741e-01   +3.484312887871363e-01   +4.216169180649417e-01   +1.468764103191299e-01   +3.014413267566700e-01   +7.881317283184582e-01; +3.931820851129241e-01   +4.954063728998229e-01   +7.543519542154367e-01   +6.692012967260608e-01   +2.395483029324759e-01   +8.664508360648697e-01   +2.245406289344810e-01   +3.498978773091332e-01; +2.620669209648920e-01   +6.660307521214645e-01   +2.846153349745406e-01   +6.675467191778197e-01   +7.442911456244934e-01   +7.073398033836544e-01   +8.606027295800406e-01   +1.156805897700501e-01; +3.092898758941122e-01   +5.145244679243681e-01   +4.084797355184705e-01   +3.939043676855047e-01   +5.118635769240389e-01   +1.161056631012058e-01   +1.023495604019089e-01   +3.953615374936967e-01; +6.720693331863450e-01   +4.290748232785981e-01   +7.545907864599051e-01   +3.748369888973287e-01   +4.852455387722694e-01   +8.664935226006123e-01   +7.364875330628875e-01   -3.745454567593269e-03; +4.283465647227384e-02   +6.448244976151345e-01   +2.787071217573979e-02   +4.256125457114780e-01   +5.687510300855165e-01   +1.760235260642600e-01   +7.281104169852635e-01   +6.462401030625189e-01; +2.314351469269444e-01   +3.915308498267435e-01   +7.192748762282605e-01   +5.383360211148941e-01   +1.466103909996255e-01   +7.519994611826318e-01   +9.341260612670066e-02   +1.181545535958512e-01; +6.955627448136397e-01   +8.689095899439021e-01   -1.203015572057780e-01   +6.212594075734695e-01   +8.947755967765100e-01   +6.446143790418870e-01   +5.339560858437519e-01   +3.561684593378611e-01; +5.238324883255442e-01   +1.763580331291763e-01   +5.770521452493089e-01   +1.225463597268050e-01   +6.316148271315569e-02   +5.742891625731924e-01   +3.836170952021550e-01   +6.312187893274281e-01; +6.324265232112964e-01   +2.957680213453527e-01   +4.375206602157395e-01   +5.973924094241891e-01   +7.756640583733007e-01   +1.000000000000000e+00   +2.178259040930653e-01   +4.157435225495197e-01; +4.664412592160085e-02   +7.451565038391376e-01   +5.600184591945396e-01   +5.284289677766564e-01   +2.525644360496775e-01   +5.918310172309222e-01   +3.153005532409604e-01   +2.002172803110272e-01; +4.742390054592184e-01   +1.143873609171996e-01   +4.912742295990311e-01   -7.811024640006255e-02   +4.245959421479301e-01   +7.399705712800299e-01   +9.920185046943787e-01   +2.709716601740987e-01];
L1E_L2E_iAMPA_netcon = [-7.218007520174395e-02   +4.060203481504178e-01   +3.963109444263712e-02   +6.039784840351766e-01   +1.289838248430700e-01   +1.813249273849983e-01   +3.270170538318355e-01   +3.136246574491816e-01   +8.326717798593880e-01   +5.595063352831282e-01   +1.527442125802461e-01   +2.881301057094193e-01   +3.860987910094922e-01   +4.352510751283648e-01   +1.016992332501169e-01   +5.403468135474955e-01; +4.107480269879442e-01   +5.952970258221887e-01   +3.797153899030236e-01   +3.163300726799496e-01   +7.199889849593641e-02   +6.898641038915614e-01   +1.609883553154278e-01   +3.307847329155430e-01   +3.325374222272806e-01   -6.307049330006098e-02   +8.178334707400989e-01   +3.224794255507843e-01   +3.839709292674906e-01   +5.361727083104547e-01   +6.008166395820802e-01   +2.882020254636798e-01; +4.183453405545451e-01   +6.142279203028133e-01   +3.228378365975789e-01   +5.852331056637164e-01   +6.640169771084933e-01   +5.209906997585293e-01   +6.397050019298234e-01   +6.819252986439325e-01   +1.990679959243271e-01   +7.667887230269468e-01   +4.242294875341635e-01   +3.418840642576316e-01   +1.837878474645044e-01   +7.061414479406363e-01   +1.918401915951221e-02   +2.492148279299577e-01; +3.108034713769781e-01   +3.082774628586584e-01   +4.745012921434691e-01   +7.079238772161077e-01   +3.358337686485652e-01   +9.310078792389436e-01   +6.383500254015246e-01   +5.147760851639951e-01   +2.803426361943792e-01   +3.929585399639354e-02   +1.991896109020592e-02   +7.758635154273604e-01   +5.326342034876975e-02   +3.790604905065874e-01   +4.375210982045938e-01   +6.880817055201432e-01; +5.362057692646770e-01   +9.118097859312175e-01   +6.285298697323576e-01   +2.519685350484567e-01   +3.304026873453122e-01   +4.249561577388550e-01   -9.364797444994508e-02   +2.585044564613092e-01   +3.351791605395902e-01   +2.872533445872472e-02   -8.988386277122594e-02   +2.228145562072994e-01   +4.941346610794020e-01   +9.770877988596370e-01   +2.859267629240995e-01   +2.430897808484743e-01; +2.172359209883623e-01   +4.590087827010851e-01   +7.231053594303491e-01   +1.017936776194098e-02   +3.422179211451973e-01   +7.602140655958534e-01   +5.212075414380097e-01   +4.849747587010445e-01   +1.062794244336994e-01   -3.601957565326779e-02   +5.693546180733189e-01   +4.535073128516079e-01   +4.514360839976759e-01   +6.581743774832589e-01   +1.607664567961286e-01   +3.985201982080683e-01; +7.862010043362236e-01   +1.469229753699276e-01   +7.399002197590345e-01   +3.731174031265719e-01   +4.245622333095402e-01   +7.579877614886830e-02   +5.471509232434343e-01   +7.185598445057473e-01   -6.498254645403817e-04   +2.789132962734088e-01   +1.000000000000000e+00   +2.611892019687346e-01   +5.826367182434189e-01   +4.893560636915378e-01   +8.612227161649141e-01   +9.297004696527358e-01; +3.695544240826540e-01   +3.680588067589666e-01   +4.985021739071975e-01   +6.464979937755895e-01   +4.966401715172489e-01   +3.384479374942813e-01   -1.354587472644587e-01   +5.861679784624013e-02   +1.359773082399222e-01   +6.650217348614104e-01   +1.175872901117124e-01   +4.725083523042987e-01   +9.457412171695051e-01   +2.172506412568544e-01   +4.377655277080704e-01   +8.578305424420536e-01];
L2I_L2E_iAMPA_netcon = [+2.010235174727327e-01   +6.988365790716458e-01   +6.031858587990531e-01   +8.691823144548767e-01   +3.315759028114172e-01   +5.264545939797099e-02   +5.575449362827164e-01   +5.718505534753860e-01; +6.112866073260799e-01   +3.146070627460321e-01   +2.735009165393918e-01   +7.968997216451247e-01   +3.969657745490656e-01   +1.294495063186270e-01   +1.000000000000000e+00   +6.789443348239752e-01; +7.164015597011070e-01   +7.823177129688933e-01   +5.477729792038947e-01   +3.332703568312282e-01   +7.730169906875962e-02   +5.089222367757382e-01   +7.553595476643333e-03   +8.764399831968172e-01; +6.141921386161782e-01   +3.121018014148166e-02   +5.054383640501017e-01   +5.874150098881197e-01   +6.915704419295285e-01   +7.258786100788882e-01   +7.331469832619769e-01   -1.416102974804227e-01; +8.402529951457741e-01   +5.666950964268922e-01   +7.744103608769002e-01   +6.795120245108175e-01   +8.689517360172649e-01   +3.641836221072596e-01   +2.278959623409171e-01   +6.572740931956417e-01; +6.202650188482340e-01   +7.758070417105785e-01   +1.334405472446998e-01   +2.102872861908350e-01   +4.002332910090640e-01   +7.367159570290117e-02   +2.515353320539450e-01   +4.822852750531689e-01; +7.636215644797484e-01   +2.917773850405937e-01   +3.960173408297787e-01   +3.967871214719922e-01   +8.286020061613428e-01   +8.399062814119054e-01   +3.198173376194595e-01   +3.842009272644735e-01; +1.415524642337830e-02   +3.372383030992299e-01   +8.632730708274484e-02   +2.674842129363905e-01   +8.343869179718085e-01   +4.828174534780748e-01   +4.916667561187256e-01   +4.575673998687463e-01];
L2E_L2I_iGABA_netcon = [+6.400382377361152e-01   -3.354374718264038e-02   +6.864716583859052e-01   +4.757145385770937e-01   +1.465835099670409e-02   +1.217002715754754e-01   +8.794307245201934e-01   +4.373331527031224e-01; +4.431530491405301e-02   +4.593569866915719e-01   +3.790061875340145e-01   +4.952034323243912e-01   +9.310440465052984e-01   +6.446268981587919e-01   +8.107387500569757e-02   +8.651229940030787e-01; +5.355076818347058e-01   +8.065962611747260e-01   +1.709864414107873e-01   +4.105826624576001e-01   +2.910323082682496e-01   +2.647977542737304e-01   -1.262925479169293e-01   +3.379570573682518e-01; +4.282327485060363e-02   +1.535131173248195e-02   +3.034513591551381e-01   +5.594269548091568e-01   +9.186151619321924e-01   -2.141073041260264e-02   +5.184445165878522e-01   +1.725140818548360e-01; +5.423367929885857e-01   +6.995770120881609e-01   +1.691618219037919e-01   +4.514157204435508e-01   +2.549026246844699e-01   +2.614768998748696e-01   +1.937225761762981e-01   +7.872718724334986e-01; +2.340907780686787e-01   +3.065590613174227e-01   +4.536062432767566e-01   +9.780162528018700e-02   +1.000000000000000e+00   +1.880808092218452e-01   +3.686287064241441e-01   +3.356714571347579e-01; +2.649390611708501e-02   +7.170882310545502e-02   +4.249350439710793e-01   +6.271903966809941e-01   +2.950900133066958e-01   +9.405369068128367e-01   +4.284527922660931e-01   +9.547237149759118e-01; -8.898224941479004e-02   +1.374196376009633e-01   +4.511218515472225e-01   +4.483174784149825e-01   +5.765018473684668e-01   +6.037782314140439e-01   +2.976698447357504e-01   -1.272472448730428e-01];
L3E_L2E_iAMPA_netcon = [+2.179913961069693e-01   +5.608505177396249e-01   +5.938836937614911e-01   +2.510683489336927e-01   +6.318292432050588e-01   -6.623114022191690e-02   +6.817412514588855e-01   +8.319549733109969e-01   +7.085949966373432e-01   +2.260915237159682e-01   +6.287449477111713e-02   +6.839309413513556e-03; +6.249896228676577e-01   +7.801205325540026e-01   +3.116281842849495e-01   +3.596336706391050e-02   +2.073511202626623e-01   +7.469258750056562e-01   +2.945800390476050e-01   +3.705261216526641e-01   +4.570297955891724e-02   +2.002141024662533e-02   +2.384964621520940e-01   +2.624440151832650e-02; +5.316833068195586e-01   +1.627424189432100e-01   +8.729577865309569e-01   +7.342719460123137e-01   +2.464909753388486e-01   +1.000000000000000e+00   +5.404534288433810e-01   +8.875525293729523e-01   +4.661247124619194e-01   +9.387450534414471e-02   +2.132456903978535e-01   +4.799955589860174e-01; +2.835996363835451e-02   +5.809018894573200e-01   +1.457487894018804e-01   +1.426156124719189e-01   +5.752783214405575e-01   +7.474880020245966e-01   +4.769531500664072e-01   +2.222147322271026e-01   +5.584354401454151e-01   +1.439640632873743e-01   +2.389956203739820e-01   +2.652018724598688e-01; +3.429821605285424e-01   +9.657115823415526e-01   +7.214721255501639e-01   +1.661412879005979e-01   +7.876441726522673e-01   +3.095678594746546e-01   +4.671362804621467e-01   +8.854900307687672e-01   -3.571795702740107e-02   +2.832064277455792e-01   +2.039375020884699e-01   +6.739601731824212e-01; +2.429435778809840e-01   +8.327038787331453e-01   +2.840140356854408e-01   +5.478026725746238e-01   +4.279537130894329e-01   +2.958199678792235e-01   +3.390746214091657e-01   +5.232976860901383e-01   +2.697533173116736e-01   +5.439212216797567e-01   +1.327407450799651e-01   +4.670833842582637e-01; -8.515322176222080e-02   +3.276330570478305e-01   +4.488692290281263e-01   +1.888046230580472e-01   +3.381070075764107e-02   +2.354413659438330e-01   +7.115598014143748e-01   +6.289272339172202e-01   +7.191698119874410e-01   +4.430079847009716e-01   +3.030175218229578e-01   +6.139133392988290e-01; +3.652993765300393e-01   +1.185395413691744e-01   +5.655290361888780e-01   +5.105216266769331e-01   +7.579308114580890e-01   +6.336401384571828e-01   +3.348195412200322e-01   +6.267400259414856e-01   +8.295599494099949e-01   +4.085923403818722e-02   +7.707552676739635e-01   +1.787233772005018e-01];
L3I_L2I_iGABA_netcon = [+2.165808664304590e-01   +5.805212171411362e-01   +3.726526201610501e-01   +6.174394328917243e-01   +1.501174937573578e-01   +7.062724623445006e-01   +2.787355227324751e-01   -3.275117607720011e-02   +2.292555950621949e-01   +2.549584885186849e-01   +8.103004946016699e-01   +9.752768502765249e-01; +1.442300429433362e-01   +3.484759712526126e-01   +2.323466655554795e-01   +6.880860680279203e-01   +1.181926447973226e-01   +8.310146060197912e-01   +7.561015092337375e-01   +1.263765569972316e-01   +7.937528786639129e-01   +3.887637635523655e-01   +5.326599655864820e-01   +4.169726433012179e-01; +1.649749672766372e-02   +4.819554229727943e-01   +6.463682139058401e-01   +4.585051464946122e-01   +6.007590420013839e-01   +2.457050163659412e-01   -2.884053923129108e-03   +9.148876804087769e-01   +9.098539080093196e-02   +4.084854114383645e-01   -4.725727894543928e-02   +9.547477949629115e-01; +9.379883124803212e-01   +7.843620243552819e-01   +2.964701558699678e-01   +4.965828466253717e-01   +4.945885532930213e-01   +2.251068412448511e-02   +5.414008817242489e-01   +5.197228168635218e-01   +7.177631453730506e-01   +3.220915232214077e-01   +4.891748035488037e-01   +2.605350650471340e-01; +2.503526030245676e-01   +7.534873012969338e-01   +4.696550934457496e-01   +5.781927604954403e-01   +8.413581957851242e-01   -8.464540020584592e-02   +2.491006651646669e-01   +3.527106685746836e-01   +7.337051889091124e-01   +9.182703027468602e-01   +7.323978139522578e-01   +3.842635029277009e-01; +2.053248659809308e-01   +1.819453903390832e-02   -1.727434480349681e-01   +9.607075566801070e-01   +8.951754583339786e-01   +7.420630220674838e-01   +2.775899350314075e-01   +6.860651068164634e-01   +2.428269928280367e-01   +6.896912642489174e-01   +6.107217449668045e-01   +6.921373220103784e-01; +6.104200982150353e-01   +6.471483301621515e-01   +8.098915153338464e-01   +6.101602129968031e-01   +1.000000000000000e+00   +2.930934176974452e-01   -3.954441898852738e-02   +6.413152037769322e-01   +3.857185136956011e-01   +5.640317432828857e-01   -5.478688696622695e-02   +7.028760327877390e-01; -9.451884946772082e-02   +7.920556018990574e-01   +6.183466808723714e-01   +6.958536553242337e-01   +3.715058632594527e-01   +3.103126276353873e-01   +1.700698001994506e-01   +9.544408344283305e-02   +1.273695202553428e-01   +1.101335427187794e-01   +2.336894755647264e-01   +5.539812957136937e-01];
L2E_L3E_iAMPA_netcon = [+6.032122610166085e-01   +6.364380144845735e-01   +7.050734058870805e-01   +3.377999441049774e-01   +9.663476933835918e-01   +7.085094528836323e-01   +5.484559980534234e-01   +2.868270844119044e-01; +5.300416448087013e-01   +6.163497359665174e-01   +1.249281933503276e-01   +9.369718846678313e-02   +4.839961403855330e-01   +1.130101618736945e-01   +2.012319541544568e-02   -1.171555697311881e-01; +5.980609772501462e-01   +2.937181377707296e-01   +2.179761507100540e-01   +5.344132965475247e-01   +9.110201040990309e-01   -4.615998464477187e-02   +6.714325331603156e-01   +6.419865180669431e-01; +4.466191792606130e-01   +9.498168284467222e-01   +6.417961399832373e-01   -1.708796717312762e-01   +2.676073969656826e-01   +8.130731611255638e-01   -7.208525407049576e-02   +6.430635904084326e-01; +3.083702057670480e-01   +5.335505477185538e-01   +4.143244289513218e-01   -6.641416906856758e-03   +6.955926719977803e-01   +6.132262537644597e-01   +8.543836570692926e-01   +7.319251586676424e-01; +6.518214478262520e-02   +1.075052069114253e-01   +4.168263839306337e-02   +8.456645410853471e-01   +2.460802867446347e-01   +4.488718264731331e-01   +4.488071958139048e-01   +8.368360615266317e-01; +2.927151983441565e-01   +3.447221491915833e-01   +3.547096303122508e-01   +8.176928366890009e-01   +7.635743287386141e-01   +5.715070418063116e-01   +4.865061847021713e-01   +4.248401843172975e-01; +2.148420517537643e-02   +5.190923970321800e-01   +2.897806095216829e-01   +6.412990904390646e-01   +2.310775994909444e-02   +2.747495493087314e-01   +9.219262760239070e-01   +5.583042881858482e-01; +1.468539783591351e-01   +6.657506925599197e-01   +2.672985356903311e-01   +4.207453697930303e-01   +3.200116913672433e-01   -7.214971066896668e-03   +6.206133362045794e-01   +1.064379091086297e-01; +3.233501846205237e-01   +7.872680660724678e-02   +3.572112596576135e-01   +2.555175121998910e-03   +5.794042282708858e-01   +3.759562460500783e-01   +6.005365461882982e-01   +5.015190214694122e-01; +3.023767211409868e-01   +2.606315057388998e-01   +2.797098176849027e-01   +8.567991167889738e-01   +6.533226133732542e-04   +1.386554779922999e-01   +3.406098086867484e-01   +8.669302794275752e-01; +6.903001668282664e-01   +1.582330999998022e-01   +1.897808650892677e-01   +1.761871109122926e-01   +1.846977412666542e-01   +1.000000000000000e+00   +4.076981117409160e-01   +4.841732153010906e-01];
L2I_L3I_iGABA_netcon = [+7.543095358054707e-01   +8.532926230912231e-02   +8.226467040991259e-01   +1.000000000000000e+00   +4.981149275543190e-01   +2.612933840454890e-01   +6.276169040575571e-01   +7.050817924789484e-01; +8.188603234496158e-01   -7.790736694610825e-02   +6.838231437951240e-01   +3.563244263899946e-01   +7.290284963047966e-01   +1.365752020420427e-01   +5.607966466363028e-01   +7.972091695498449e-01; +2.351414227904786e-01   +3.938697995735736e-01   +7.408050044963043e-01   +5.801051042142727e-01   +3.907685371301080e-01   +5.177002926476433e-01   +8.779777229778535e-02   +7.230740060695621e-01; +7.242571530790716e-01   +6.410084673856731e-01   +1.290858739836486e-01   -3.549733256065857e-03   +2.146808790270928e-01   +1.715785553644399e-01   +8.385656190082400e-01   +6.435199176934571e-01; +2.714139651528675e-02   +2.189129430072231e-01   +3.243595867322754e-01   +1.364461254731205e-03   +9.060350006957362e-01   +5.854548101783277e-01   +7.977214377188475e-01   +5.400976077722609e-01; +8.325645821918931e-01   +5.500380090565281e-01   +2.942914906091624e-01   +7.852167515639393e-01   +6.476477256426594e-01   +5.858542331213068e-01   +3.500578878443246e-01   +2.819381619142329e-01; +7.947550551047519e-01   +3.272843097526629e-01   +1.367904340400817e-02   +7.637612531080056e-01   +3.168696451347345e-02   +3.017724951164464e-02   +6.711200122737399e-01   +5.677773252349130e-02; +8.180659635280150e-01   +5.966571463289014e-01   +7.076527814796800e-02   -7.654505097061684e-03   +4.891559310962075e-01   +2.278053212229891e-01   +8.501033727173309e-01   +3.749648010101123e-01; +3.266312597454810e-01   +6.296909982368162e-01   +2.207730412528506e-01   +2.231730114497802e-01   +5.268811177628036e-01   +8.864291553454319e-01   +4.298131520865124e-01   +4.891319578156381e-01; +4.166897030374438e-01   +5.869401668201359e-01   +1.768851315507869e-01   +2.392893249421380e-01   +3.725375298797938e-01   +8.993770866420259e-02   +7.137970118652051e-01   +3.229163205014660e-01; +7.111944190194278e-02   +8.388764112974135e-01   -1.499512254079035e-02   +2.382157160363497e-01   +2.959088124810848e-01   +6.705904781255262e-01   +4.189669703092549e-02   +2.914039536373215e-01; +6.782229575154254e-01   +1.676561077585742e-01   +6.380100940308890e-01   +3.559766376614750e-01   +6.869312767439598e-02   +2.307631501618432e-01   +8.150802404767626e-01   +2.651291948482043e-01];
L3I_L3E_iAMPA_netcon = [+3.098006808701168e-01   +6.331105134601328e-01   +2.862978345760759e-01   +7.353029165822238e-01   +6.022698398219716e-01   +6.076326745919866e-01   +1.080332960399631e-01   +6.037304524201611e-03   +8.060225965663501e-01   +3.988703073407527e-01   +8.675618490592346e-02   +5.605537820515153e-01; +9.680861725031755e-01   +3.303968055093079e-01   +6.245505149951214e-02   +7.734877835112456e-01   +1.490313581211946e-01   +7.526146372215169e-01   +5.053175236192581e-01   +4.448143883027088e-01   +2.259123373521621e-01   +4.523609233822281e-01   +6.552095124969222e-01   +5.587747465364493e-01; +5.112017775545444e-01   +7.382411256532674e-01   +7.823049384976531e-01   +1.777607965116048e-01   +3.709784953008134e-02   +4.479745568348234e-01   -6.770298082640579e-02   +3.921947028866485e-01   +4.008506767553641e-01   +3.766278620533773e-01   +2.220145747268108e-01   +2.424657514421501e-01; +3.327475485272433e-01   +2.641133733810482e-01   +4.235061182813745e-01   +4.337202179675507e-01   +7.546937765133905e-01   -6.078863668228827e-02   +6.276286182466755e-01   +3.151867360983976e-01   -7.950109097207653e-02   +1.637247900978165e-02   +4.408410416686384e-01   +7.314314468429665e-01; +2.923820427322463e-01   +6.124840256221187e-01   +2.828121919361317e-01   +6.994649415597165e-01   +6.450191107449036e-01   +5.489083404337717e-01   +2.290900856372134e-01   +1.435318828343794e-01   +5.626907821070050e-01   +4.800723693090141e-01   +8.970926245863942e-01   +5.329393902723663e-01; +9.292688887863311e-01   +3.981982838364029e-01   +2.469856435550417e-01   +7.225661908971405e-01   +3.357709416279117e-01   +5.294518739389079e-01   +2.895255306544403e-01   +1.493059462536232e-01   +8.577805806822024e-01   +3.223952003218536e-01   +7.076951791027621e-01   +3.606248271769901e-01; +6.776642031353621e-01   +9.080607852767534e-01   +7.136161735557967e-02   +3.928512208596321e-01   +7.170635795082624e-01   +4.220649431380804e-01   +7.082293906810283e-01   +7.816652669905741e-01   +7.231533159168468e-02   +4.511252385948450e-01   +3.759683193013909e-01   +7.042716540972668e-01; +2.089730950752469e-01   +7.388973979087672e-01   +6.986169511769507e-01   +6.293003507544709e-01   +2.735838773803199e-01   +6.566316846063783e-01   +7.542802124453787e-01   +6.220368399734838e-01   +1.685176056743318e-01   +1.163792413386060e-01   -7.294248461697085e-02   +4.313517373558270e-01; +2.254046337897789e-01   +5.875865374738103e-01   +2.198670726542367e-01   +3.070475257261676e-01   +1.302192140017600e-01   +6.419173514174679e-01   +2.067578440053641e-01   +9.630781681162185e-01   +2.260330551133163e-01   +2.373621371366718e-01   +4.300076764819617e-01   +4.693987877052404e-01; +4.563248037016176e-01   +2.469745753276215e-01   +5.105351391046438e-01   +6.841545079139004e-01   +6.017193860983948e-01   +3.464097247824054e-01   -3.595405599905852e-02   +1.928553816082217e-01   +6.526769164696529e-01   +7.866094764030757e-01   +7.046525651892968e-01   +8.467283422743465e-01; +3.195327677440917e-01   +1.000000000000000e+00   +3.126669040617710e-02   +2.395502828486764e-01   +5.812558433643652e-01   +1.689513462021459e-01   +5.346059823614563e-01   +5.436914052284991e-01   +4.836856817390540e-01   +6.158085709172522e-01   +4.171656537742616e-01   +7.751263628561110e-01; +8.163682456117931e-01   +4.754212861039940e-01   +5.395428191509830e-01   +1.061972194540617e-01   +1.140349233850740e-01   +6.037449026963075e-01   +6.466731216443136e-01   +6.565283287329560e-01   +7.808288502537372e-01   +4.204134492712706e-01   +4.104750512480976e-01   +4.021522689349461e-01];
L3E_L3I_iGABA_netcon = [+9.736518754077068e-01   +2.850588673722290e-01   +2.842001008214644e-01   +2.949602252570805e-01   +4.913507178877627e-01   +1.324805523841066e-01   +6.697689789422405e-01   +4.339914279436157e-01   +6.177892870003041e-01   +9.294884663066703e-01   +7.147242660158130e-01   +7.332507777239056e-01; +6.976364838234671e-01   +4.758464712659168e-01   +4.604679270235022e-01   +7.842705601057052e-01   +6.591044033139046e-01   +3.606731705417140e-01   -8.461873085594854e-02   +7.155844094598078e-02   +4.139777309217751e-01   +1.254419729563304e-01   +6.442233821192237e-01   +6.227511545934813e-01; +5.864650323604857e-01   +6.133999972661827e-01   +5.485504127521154e-01   +8.868895461836256e-01   +9.099735071682064e-02   +5.459827167754576e-01   +6.602812038161352e-01   +4.758107413591653e-01   +1.294375916306315e-02   +2.455516756914498e-01   +4.742804774376531e-01   +4.498950676422468e-01; +7.903697091744875e-01   +4.880045845896632e-01   +7.801467779000058e-01   +8.215843928833062e-01   +1.164460834104531e-01   +3.118773736288560e-01   +3.212663532024450e-01   +8.191680812049593e-01   +6.988526162568374e-01   +3.338952430459637e-01   +7.030580488194224e-01   +6.081703679413596e-01; +3.446151478468377e-01   +3.397303468149796e-02   +5.539413168696892e-01   +6.422046156623167e-01   +2.845615154773422e-01   +7.834525236126008e-01   +4.429015028467026e-01   +2.920180462823913e-01   +7.930480327180217e-01   +7.989440210269428e-01   +9.049001415073529e-01   +3.808650566593313e-01; +8.482715748452375e-01   -1.014527745668328e-02   +2.623802337785217e-02   +9.852042768931867e-01   +8.833846555770127e-02   +6.406540534565157e-01   +4.563095813750722e-01   -1.673725172174022e-02   +8.080847962300971e-01   +1.431050334083546e-01   +6.072496119696317e-01   +8.256990670664477e-01; +1.362987995021060e-01   +3.150293617892837e-01   +4.435370078153181e-01   +1.565273380921868e-01   +3.202421752992541e-01   +1.572217644085827e-02   +7.096661229259303e-01   +1.697846110560729e-01   +5.841887226388819e-01   +6.799751127581428e-01   +1.201538894703608e-03   +5.715919768405805e-01; +5.451173112939751e-01   +3.544781023321758e-02   +3.899888096221338e-01   +4.975969903133090e-01   +6.790086014469450e-01   +5.886492075923239e-01   +5.256123805659698e-01   +5.592363349280851e-01   +9.470972440073575e-01   +5.499275276988503e-01   +9.595338923813830e-01   +6.621601172913936e-01; +8.080670239263877e-01   +2.694713996805276e-01   +8.003191089113434e-01   +1.978438159927202e-01   +8.460962907826662e-01   +7.583335574435693e-02   +3.553535300408183e-01   +6.815197692024388e-01   +6.478539270430410e-01   +1.923513242566043e-01   +7.670181215886444e-01   +7.034430884441905e-01; +3.354798998464255e-01   +5.356185999164514e-01   +7.226814848625246e-02   +4.412172621588939e-01   +2.114605994259812e-01   +3.939103999263316e-01   +8.912627813710703e-01   +2.527878229104479e-02   +5.598908104352788e-01   +6.566784859391120e-01   +6.889592636847719e-01   +1.110683843768235e-01; +9.672036782169163e-01   +2.712061416545293e-01   +4.993389111547729e-01   +8.725428844751379e-01   +3.875770595158785e-01   +5.086699822587447e-01   +1.331832856977632e-01   +8.324608236726130e-02   +3.471920384761215e-01   +5.970557570071702e-01   +9.172182516912598e-01   +8.053622084111798e-01; +7.269708841041860e-01   +1.480411541245223e-01   +2.759031295636327e-01   +6.909993368328688e-01   +1.360464274645955e-01   +3.682390414617071e-01   +6.803169638997428e-01   +6.638894436905259e-01   +1.000000000000000e+00   +3.493059066829726e-01   +5.182269073657104e-01   +9.989503212537979e-01];
L2E_Input1_iAMPA_netcon = [+8.480178282010846e-01   +7.286006899765385e-01   +8.051956184693960e-01   +8.009125603190724e-01   +7.772093822366668e-01   +9.360686206590274e-01   +1.000000000000000e+00   +7.437929741005108e-01];
L2I_Input2_iAMPA_netcon = [+7.969087556790450e-01   +9.135879309906465e-01   +7.266681948098489e-01   +8.809572246409458e-01   +7.219526193744478e-01   +1.000000000000000e+00   +7.728686370573652e-01   +9.176465665985443e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
