function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.173272617552973e-03   +7.508335094283877e-02   +1.337021555800269e-01   +1.056341345554472e-01   +9.300031031159749e-02   +1.492387858284151e-01   +7.311236992072079e-02   +2.896157543130669e-02   +3.303199454161997e-02   +6.466839565843388e-02   +9.056599425756566e-02   +3.640810996432977e-02   +6.353014514724729e-02   +1.001147137521430e-01   +7.014299098487489e-02   +1.387631561178241e-02; +5.556415085895010e-02   +7.049757551391649e-03   +7.845974871653368e-02   +9.480423545660215e-02   +4.045469773124384e-02   +4.632659605427705e-02   +1.380883572783924e-01   +1.468158800995961e-01   +1.010951531193229e-01   +3.130785941784244e-02   +1.550255909012186e-01   +3.322073223166935e-02   +3.046564922168781e-02   -3.648616713704434e-04   +8.460312427323267e-02   +4.569418867533645e-03; +1.011559304034311e-01   +1.036586836337939e-01   +1.337159637314984e-01   +7.233970981178388e-02   +1.306680777125645e-02   +1.275278939521712e-01   +1.324362182479901e-01   +6.714708797650405e-02   +6.564522493412724e-02   +5.791275136518505e-02   +7.055399487698299e-02   +2.663991014867232e-02   +9.198411427249002e-03   +2.838834511255026e-02   +1.306621513258991e-01   +8.962013407097921e-02; -2.878979267474502e-03   +4.652273880826058e-03   +7.205473527485834e-02   +9.696558821009500e-02   +3.027907505315221e-02   +1.139063387218104e-01   +7.069014202996855e-02   +1.451267113244644e-01   +6.790103634825896e-02   +4.300205969610773e-02   +1.314088626826078e-01   +1.343560879170650e-01   +1.952493689970341e-02   +1.411715983130784e-01   +3.447619891345746e-02   +5.049951262255506e-02; +7.460612364353317e-02   +9.637369378789919e-02   +9.433581568554095e-02   +1.072657902297994e-01   +6.051251652586136e-02   +1.291120475718122e-01   +7.464646230540072e-02   +3.938592921480535e-02   +8.002761785778863e-02   +1.271242002254794e-01   +5.326887769350479e-02   +1.022938406911134e-01   +3.967737008339038e-02   +4.372430588725667e-02   +1.404462150616990e-01   +2.197914750355624e-02; +7.694944261374893e-02   +2.207524050185686e-02   +1.261829098057713e-01   +2.671350526264992e-02   +9.202678619771494e-02   +4.701072933772184e-02   +6.342874584849539e-02   +2.821457630507889e-02   +7.352405907377788e-02   +6.885979186412163e-02   +1.040029771241957e-01   +3.778966560617748e-02   +7.104702543370879e-02   +8.104483257417008e-02   +7.105995639234239e-02   +1.069489653196264e-01; +4.874296415079570e-02   +1.023400890623934e-01   +1.393670519398536e-01   +9.880391624454879e-02   +5.967289527444176e-02   +9.261491559808172e-02   +5.990928062371293e-02   +1.266989829492030e-01   +1.445678751106198e-01   +5.613358749602770e-02   +2.417310947628234e-02   +2.747458587753291e-02   +6.678664505347040e-02   +1.407739324286587e-01   +1.010433586389111e-02   +3.377229794812923e-02; +8.162174461000343e-02   +5.356227915521219e-02   +1.109312930342705e-01   +9.786600988802939e-02   +9.041080116342454e-02   +2.495046205133556e-02   +5.162600798451151e-03   +6.857913625309991e-02   +1.140498070203252e-01   +9.678902458996000e-02   +4.214526829022427e-02   +1.119001812615177e-01   +3.964490762202013e-02   +1.557064072208910e-02   +1.053337151431246e-01   +9.652047087655045e-02; +2.316945260839180e-03   +9.775562189944068e-02   +1.000832011120806e-01   +1.004493103195779e-01   +1.281781863689919e-02   +1.311510451329805e-01   +6.343268649508241e-02   +6.884646423294472e-02   +7.446325411560439e-02   +7.465998984679457e-02   +2.927574077421427e-02   +1.352207820432667e-01   -4.809770724970233e-03   +1.098690905956673e-01   +5.443118419023521e-02   +7.352740899401483e-02; +1.081995295333911e-01   +2.101391654366554e-02   +1.343732640897797e-01   +1.191921128232468e-01   +9.418701845905761e-02   +2.989189317185378e-02   +1.223460349505458e-02   +6.600653890206972e-03   +1.097386308425045e-01   +6.232620983644497e-02   +1.698174845518540e-02   +8.323728633180708e-02   +1.261946430329119e-01   +3.546501059406312e-02   +1.313780181608759e-01   +9.503846367067385e-02; +6.023473851232938e-02   +7.528848877537163e-02   +7.723908036812842e-02   +1.148878750879213e-01   +1.339420536850860e-01   +3.005400531371717e-02   +9.197306019929995e-02   +8.736708811723284e-02   +3.993363138663528e-02   +4.314439639841213e-02   +1.072544255208996e-01   +1.432986686179208e-01   +2.081131250872695e-02   +1.068929361409027e-01   +1.172746755694226e-01   +3.060594264432319e-02; +8.047191364315937e-02   +4.323843307419963e-02   +1.280244418321817e-02   +2.674744313994678e-03   +1.418535636095610e-01   +1.355475570677012e-01   +1.034981186512173e-02   +1.069266233716179e-01   +1.057302768828890e-01   +4.863829120753823e-02   +2.000717875565063e-02   -4.675789673454622e-04   +1.354819960623015e-01   +1.426987617566394e-02   +7.779668330566322e-02   +6.464543914785595e-02; +1.002241924305617e-01   +1.117625282908980e-01   +1.282374243336186e-01   +2.369154709671559e-02   +9.983955958125743e-02   +1.054163474256637e-01   +1.064704989480027e-01   +9.640735090417940e-02   +1.336058181435222e-01   +6.778755718707798e-02   +5.719606737611906e-02   +1.388294066141630e-01   +1.259334764545216e-01   +1.037388386748404e-01   +7.569465714802098e-02   +1.351303736819349e-01; +1.296771540241817e-01   +1.011668044533229e-01   +4.372016642715014e-02   +9.002569704412344e-02   +1.786487699505219e-02   +4.129090478673955e-02   +1.432072368386216e-02   +3.838393790494717e-02   +5.141239596459050e-02   +1.044657135017039e-01   +3.221492858372901e-02   +1.229323687236968e-01   +8.667857478686412e-02   +9.860271705526011e-02   +5.804209798018968e-02   +5.103748224968685e-02; +3.501706279336930e-03   +8.555976778413794e-02   +1.298312408825738e-01   +8.273872233556724e-02   +4.207570874767162e-02   +2.661770435717851e-02   +4.203411781144559e-02   +5.836329459250304e-02   +3.525073260665964e-02   +1.485208823135261e-01   +4.810547426877353e-02   +1.286428015430737e-02   +2.477274214383517e-02   +1.100156971254320e-01   +6.626946802179830e-03   +1.026463221508255e-01; +1.148135249263905e-01   +5.395671218031732e-02   +2.813000363160633e-02   +1.423990478175513e-01   +1.662365619669839e-02   +2.125096227459202e-02   +1.321061001320689e-01   +2.663002831063885e-02   +8.627147901785814e-02   +1.184055275047262e-01   +9.974255923767998e-02   +2.763059564495091e-02   +1.120915492299319e-01   +1.168336869746864e-01   +1.394649154740562e-01   +1.298164825872450e-01];
L1E_L1I_iGABA_netcon = [+7.462020705487968e-02   +9.284603818745152e-02   +7.909350528126361e-03   +4.504508084952063e-02   +1.267671638801690e-01   +6.173673535882356e-02   +5.520732556006042e-02   +3.455729917675217e-02   +1.781909333862046e-02   +5.433011689464751e-02   +5.153877249772131e-02   +8.772890833849503e-02   +4.372335405152378e-02   +1.333862967988683e-01   +3.121435175534679e-02   +7.074287825165557e-02; +1.291367849837325e-02   +1.361285525818688e-01   +7.667182085495101e-02   +1.274782728876907e-01   +7.006769451256969e-02   +6.400200742804363e-02   +2.766399486380760e-02   +7.560590602049472e-02   +7.534191528146876e-02   +2.254637842689534e-02   +2.859614380270224e-02   +1.089245496145056e-01   +6.640812332439575e-02   +1.061209679253241e-01   +7.403815245715173e-02   +1.052665625664324e-01; +9.632634092135552e-02   +1.499796443948455e-01   +1.192788648024262e-01   +9.955991088332757e-02   +1.598743878793042e-02   +8.483474789719264e-02   +1.020700513464648e-01   +1.320913542211647e-01   +1.306057159721791e-01   +1.487760230238444e-01   +1.005201712639436e-01   +8.002573203943644e-02   +1.416467102558512e-01   +1.250516674901150e-01   +6.866990596547783e-02   +8.855354632297088e-02; +1.046097181653629e-02   +2.434461225700251e-02   +1.317332097200794e-01   +1.045894234652091e-02   +2.815054790975835e-02   +1.052689914610092e-01   +1.095502477237479e-01   +8.048106569713562e-02   +7.711842860233988e-02   +1.465388688438138e-01   +9.568826796340671e-02   +1.330108602087117e-02   +5.784427712087961e-02   +3.019950242625162e-02   +1.010286890369940e-02   +1.505686469338112e-01; -1.342042539770443e-04   +1.295782987734581e-01   +7.037554082004555e-02   +1.618564892496774e-02   +5.858011069563416e-02   +1.291884972476615e-01   +1.075618441413345e-01   +6.374102846474811e-02   -4.649751151408483e-04   +2.632627823807288e-02   +1.038296080221801e-01   +2.123329441812205e-02   +1.261990809413697e-01   +6.661006170772592e-02   +9.720548433800580e-02   +7.643539150458373e-02; +1.220686620632623e-01   +1.382534856191671e-01   +2.251571726110338e-02   +1.056015065461973e-01   +5.441165076929676e-02   -6.970117524447688e-03   +1.033363946601558e-01   +4.315111659215115e-02   +1.292950935092860e-01   +2.459257759010081e-02   +1.371196121949093e-01   +2.334998187682610e-02   +5.573717807883410e-02   +1.643975930337611e-02   +8.485262360592800e-02   +1.680270874961447e-02; +7.426648082233868e-02   +3.105134226291023e-02   +2.104505398260068e-02   +3.813414986303906e-02   +2.609219122315121e-02   +5.654191540628064e-02   +4.629170988259640e-02   +7.750431252943650e-02   +1.343615224859055e-01   +2.324041907562996e-02   +1.131544994048987e-01   +1.535697114985095e-01   +1.489568990931103e-01   +7.174178388877450e-02   +8.021332289104986e-02   +4.871507227003016e-02; +4.350724004796355e-02   +3.300783716447186e-02   +3.052103813506016e-03   +2.195811001431073e-02   +1.038281293072573e-01   +7.808557201052277e-02   +7.647078810663709e-02   +9.350083622541866e-02   +3.050103356066631e-02   +6.485713618222484e-02   +1.300173310080781e-01   +1.448615127611686e-01   +7.830109291216390e-02   +6.904497624884109e-02   +2.165045938749353e-02   +1.090009219236451e-01; +4.866650784597359e-02   +9.358190936959584e-02   +4.140191034281716e-02   -6.687836672445740e-04   +2.198716927976444e-02   +1.018549029297451e-01   +1.189285746029709e-01   +1.299475475537770e-01   +4.919054351904538e-02   +1.878557767986395e-02   +1.099655396666991e-01   +5.926600844495994e-02   +1.301388032522501e-01   +1.443616403306043e-01   +8.760775900968923e-02   +1.235029572169973e-02; +7.043516142106781e-03   +6.333623913156679e-02   +2.682995853965231e-02   +8.293979943552750e-02   +5.625981815296807e-02   +1.225959285613952e-01   +4.656573970877338e-02   +3.598401935884438e-02   +1.382457736556495e-01   +1.161374213268340e-01   +3.378506009816262e-02   +9.112757283773777e-02   +1.123766381346198e-01   +2.898714980091639e-02   +1.112751003419603e-01   +3.045847368849193e-02; +1.317436283732769e-01   +1.569278012889584e-02   +5.075120382605212e-02   +5.908846577554139e-02   +8.583825013900696e-02   +1.003366224575923e-01   +6.331126386290083e-02   +1.499977937709852e-01   +5.218819711511890e-02   +5.511483847092925e-02   +8.532232321656423e-02   +7.455310259957854e-02   +3.159024435228457e-02   +1.442606382787306e-01   +1.271414485335251e-01   +4.923980191699349e-02; +2.405336596407983e-02   +1.351656414957192e-01   +8.041429083684051e-02   +1.376432265248148e-01   +1.450672960869484e-01   +1.008031326440303e-01   +7.800441402692301e-02   +2.282934426930211e-02   +1.066436627482344e-01   +7.371586637117400e-02   +5.231083604484708e-02   +1.225555198132785e-01   +1.081236592797783e-01   +7.388579663074278e-02   +1.186844013675166e-01   +3.499950643475082e-02; +1.012781535501000e-01   +1.267371325173617e-02   +8.490055226224898e-02   +1.806753322445675e-02   +8.214451139261700e-02   +8.538816309249936e-02   +8.850263415232770e-02   +3.592336160280173e-02   +1.130449696637034e-01   +1.275972740144186e-01   +3.350731678987040e-02   +1.179264294394648e-01   +1.454374742271874e-01   +9.299167468715017e-02   +5.305402930784040e-02   +1.386834051480000e-02; +3.972063564652996e-02   +4.235588400023292e-02   +4.094074115513872e-02   +1.369357913054535e-02   +3.575920801126262e-02   +1.287728223678873e-01   +1.449833998402052e-01   +1.079132967077368e-01   +6.968823400961464e-02   +9.071585307225040e-02   +1.487301754610608e-01   +1.116311156605509e-01   +9.680704878449470e-02   +1.267913574538600e-01   +9.685569796980818e-02   +1.128229751410960e-01; +6.658782684676007e-02   +3.094607045629786e-02   +6.628341155909934e-02   +1.243290722363351e-01   +8.883841663992488e-02   +7.851381367732055e-02   +1.896638856990743e-02   +5.189667567341216e-02   +2.104957251453530e-02   +8.180066027856205e-02   +4.095782268388706e-02   +6.610321199818035e-02   +5.248773805311905e-02   +3.499315126198685e-02   +1.957468958744440e-02   +4.160575238407965e-02; +6.443575703166336e-02   +5.692814555383082e-03   +2.668279475043379e-02   +1.391916950362362e-01   +1.451318633890361e-01   +1.369072777882066e-02   +2.914663597678261e-02   +1.261072847659868e-01   +1.226786724059464e-01   +2.026706932862477e-02   +4.621962628972272e-03   +9.693198414581040e-02   +9.746859943534010e-02   +7.727824883120889e-02   +5.921128367122150e-02   +7.137590608881265e-02];
L2I_L1I_iGABA_netcon = [+1.497313560612367e-01   +7.198156466437236e-02   +4.524530320069668e-02   +1.282493341639670e-01   +1.428755598131978e-01   +1.396756508205902e-01   +5.318645017612979e-02   +1.123671312368524e-01; +1.239203508519663e-01   +1.225871751559593e-01   +1.091785302056067e-01   +4.232415735977026e-02   +6.235197264552138e-02   +9.749430052799740e-02   +1.350215792547370e-01   +3.890253630138379e-02; +2.949117920565762e-02   +3.476591005310227e-02   +3.939974265938839e-02   +3.099457365443553e-03   +1.165925924328222e-01   +1.466325497236690e-01   +1.468131540155927e-02   +9.193035503058951e-02; +5.748950638435164e-02   +1.176041913246023e-01   +1.063215137036891e-01   +9.666721150003753e-02   +9.202594642214811e-02   +9.129262969332716e-02   +7.562518130467559e-02   +1.216475664720331e-01; +5.102310716907762e-02   +2.094763526728860e-02   +9.589134245010505e-02   +8.734858275151811e-02   +6.968145104805328e-02   +1.108807053448505e-01   +7.423983490008003e-02   +8.524020737978243e-02; +1.185065640471133e-01   +1.041829500522159e-01   +1.381393762771331e-01   +7.103325724320143e-02   +4.017425095488596e-02   +1.030668168881988e-01   +4.539015226746611e-03   +1.079759215944711e-01; +1.757504533047567e-02   +6.029380174762725e-02   +5.930552045346661e-02   +3.788373717067463e-02   +1.085411295631250e-01   +4.091510534117412e-02   +3.444586156879111e-02   +1.029354781103477e-01; +9.041618720461099e-02   +5.113196648844362e-02   +1.226273906135366e-01   +6.571122159564700e-02   +4.706399579034889e-02   +1.097005988785673e-01   +6.932450144964769e-02   +5.201865190912307e-02; +6.498021531304671e-02   +9.828724749183500e-02   +2.899841673293437e-02   +3.156882558940028e-02   +4.302912197823534e-02   +2.328484514877248e-02   +6.352978738742680e-02   +1.458058619968092e-01; +8.438876068831376e-02   +1.010969007025368e-01   +3.310828355387221e-02   +7.633300821211111e-02   +1.021667941340824e-02   +1.032069335210056e-01   +1.319889982292637e-01   +1.023110298997565e-01; +8.065819347704152e-02   +1.145760942152175e-01   +1.261141089311805e-01   +4.969192755931186e-02   +1.046841147740282e-01   +1.409909484230448e-01   +2.848684058029582e-02   +3.781598637790004e-02; +1.212908513007794e-01   +7.354812823199822e-02   +9.178402223123462e-02   +6.355181030994310e-02   +1.429049259149605e-01   +3.770162575542358e-02   +9.206713700357627e-02   +5.637244347904889e-02; +4.890789237228756e-02   +1.477558102537519e-01   +1.360372599314039e-01   +2.650481916723716e-02   +8.352341588534419e-02   +5.166869976157268e-02   +4.910170989302503e-02   +8.151553186266779e-02; +1.114660121026845e-01   +3.653849720401602e-02   +1.473251382189324e-01   +7.565257747568725e-02   +1.243516167344351e-01   +2.849902600095965e-02   +1.461559116395314e-01   +4.040571707299665e-02; +1.480683446038868e-01   +2.832245077129190e-02   +4.281441856834702e-02   +1.358633891684616e-01   +1.019007060799730e-01   +1.765029057116281e-02   +5.758297801479823e-02   +1.024210431273442e-01; +2.916785858924731e-02   +1.050261634489360e-01   +1.027348787995583e-01   +9.816370180891411e-02   +1.268745691147281e-01   +1.965323136787604e-02   +1.502243212652850e-01   +4.789470959067832e-02];
L1I_L2I_iGABA_netcon = [+8.914504297718573e-02   +1.008265252145186e-01   +3.947573233449705e-02   +1.363958769647444e-02   +8.013289119905324e-02   +5.271437319220029e-02   +1.432880845674987e-01   +1.048537213534274e-01   +6.041528171601106e-02   +1.156845256964921e-01   +2.411476822714247e-02   +4.377418579154552e-02   +1.593290454729266e-02   +1.352384222535879e-03   +3.110337862501047e-02   +1.197520281544823e-01; +1.199752059532992e-01   +9.563981819423144e-02   +6.257406320586635e-02   +7.414682164584158e-02   +1.431004254603538e-01   +7.056054615142413e-02   +9.599242841598200e-02   +1.409796384826127e-01   +7.237242964796912e-02   +1.446905960203542e-01   +9.763205384713010e-02   +5.680241215036860e-02   +7.639542053241696e-02   +1.089075268429584e-02   -7.953406060421873e-04   +1.340991739824387e-01; +1.328274831634033e-01   +8.394939577721702e-02   +2.911599222023895e-02   +1.187549384758671e-01   +4.890738577135118e-02   +1.285683474284657e-01   +1.095136218788549e-01   +1.033609425062893e-01   +5.628493261393751e-02   +5.496507613140539e-02   +9.918607529532450e-02   +6.387542620882050e-02   +5.343568447417637e-02   +2.342998918051018e-02   +8.614138584757566e-02   +1.980744335812380e-02; +6.179953796145632e-02   +6.168399295045639e-03   +8.918870597814686e-02   +1.270870118639331e-01   +1.811617462078737e-02   +6.254607358161745e-04   +5.688683363625661e-02   +4.695903916045480e-02   +1.194660069240074e-02   +1.012172510701859e-01   +8.355536720558637e-02   +7.216029747669114e-02   +3.746885210654467e-02   +7.709571660241943e-03   +1.184189504638045e-01   +8.300585897009703e-02; +1.284753137781576e-02   +1.256515833532721e-01   +1.178469464086661e-01   +9.838334357470173e-02   +9.117349007731138e-02   +7.613179181418749e-02   +9.161198808733323e-02   +1.277333999139666e-01   +8.797819976349032e-02   +8.402481091925568e-03   +4.869312347981589e-02   +2.881561182868407e-03   +3.943601279213902e-02   +1.286621571458051e-01   +2.791225173023427e-02   +7.452963818297273e-02; +9.482708297816461e-02   +1.085412794919058e-01   +1.733765419126540e-02   +1.365501851066160e-01   +8.999126781463329e-02   +1.394964000511574e-01   +1.057468270470353e-01   +1.243599189812000e-01   +8.360603051191699e-02   +8.411559933982934e-02   +1.522636427324834e-01   +1.186283968247495e-01   +2.486286966541928e-02   +1.337338254096360e-01   +1.067552658357247e-01   +1.391720556020218e-01; +1.141766256575538e-01   +1.495492332318148e-02   +1.323803317806971e-01   +1.524215262980791e-01   +5.998904166845524e-02   +1.481793077312620e-01   +7.538814799989196e-02   +7.649524913822588e-02   +4.371304413087821e-03   +8.978449218968204e-02   +4.844196469624654e-02   +5.183921302595802e-02   +1.153027960124029e-01   +5.946846822345622e-02   +1.252007522924528e-01   +8.824475731772541e-02; +1.051640125516629e-01   +1.024667192738206e-02   +1.330260286443362e-01   +1.052102647473142e-01   +1.206109514175640e-02   +1.187193498765719e-01   +8.856543720611459e-02   +1.163960944218714e-01   +5.234586468889102e-02   +1.323371525222253e-01   +3.841180098638207e-02   +7.479777256490047e-02   +7.423482488848843e-02   +7.565908345012836e-03   +1.339794856115730e-01   -1.284773111169963e-03];
L2E_L1E_iAMPA_netcon = [+1.233981323022508e-01   +4.161494570822402e-02   +1.769217900401925e-02   +1.495224509109575e-01   +1.553416819902175e-03   +6.931938725238271e-02   +9.847858236847239e-02   +1.265661304961573e-02; +1.418095099350722e-01   +1.303827117953839e-01   +8.525576478157634e-02   +6.110923425209193e-02   +7.494003347641902e-02   +2.848692750939424e-02   +1.396839218091396e-01   +6.442352769153460e-02; +1.281308160862192e-02   +2.347803187278842e-02   +4.590919260047316e-02   +2.290846496078280e-02   +9.219620769819317e-02   +1.230438127706004e-01   +5.170380819471170e-02   +5.000283209899840e-02; +4.033336995011817e-02   +1.125494295178472e-01   +2.551785705553824e-02   +1.006827533661419e-01   +1.180982032885085e-01   +4.725184673711447e-02   +1.344631588380887e-01   +1.285806807993687e-01; +2.553466669053878e-02   +1.521938951410411e-01   +2.140002269913063e-02   +6.449187487504981e-03   +1.370717080298907e-01   +1.422603967296857e-01   +1.016062691531388e-01   +6.121635228232769e-02; +1.063989553322779e-01   +7.746267961101336e-02   +1.362769101429024e-01   +1.137824147624529e-01   +9.879690948698085e-02   +3.697044057592790e-02   +1.190915361775481e-01   +1.019343462433718e-01; +1.160201092382656e-02   +4.638920821494939e-02   +3.390057198651186e-02   +6.321183315718984e-02   +1.356184058578500e-01   +6.957384817477477e-02   +2.307134866218128e-02   +5.091246053468829e-02; +7.457884562603849e-03   +2.023749808229969e-02   +7.906613027573092e-02   +1.031657942500225e-01   +5.191595526218386e-02   +1.379050487124929e-01   +1.396220504138662e-01   +1.435656849539041e-01; +5.300549123249337e-02   +1.334891667982060e-01   +4.451067639010443e-03   +4.048957231570905e-02   +2.539961097077313e-02   +1.501445662996050e-01   +8.868333742880435e-02   +9.587124387266718e-03; +4.192776969501653e-02   +4.330228134364081e-02   +1.260880423953037e-01   +6.183613527882606e-02   +1.242895395235338e-01   +1.151928443528362e-02   +1.921736188334304e-02   +1.409645113113566e-01; +8.402789857049696e-02   +6.690678288272038e-02   +2.367730621330372e-02   +8.908299518388416e-02   +6.004385135612698e-02   +6.040141956309595e-02   +8.788975077041274e-02   +1.306921008101484e-01; +3.681732878695210e-02   +6.967443996427429e-02   +1.215879749707725e-01   +1.098107753608980e-01   +1.006141385663559e-01   +2.802322879504085e-02   +1.498565171052465e-01   +4.011549474154186e-02; +8.356085952482654e-02   +1.288150694596058e-01   +3.724820168463865e-02   +1.212133980398075e-02   +1.432897402549094e-01   +1.045777226317425e-01   +6.344041653539778e-02   +1.246900096320965e-01; +5.822019154266353e-02   +5.405439493783994e-03   +1.657968638669917e-02   +1.030233814927990e-01   +8.460865397234459e-03   +4.357891145101474e-02   +1.278659476581002e-02   +1.156308156605557e-01; +4.107908845107276e-02   +2.643760409416413e-02   +1.320852121919421e-02   +1.198149928475528e-01   +1.460467805209692e-02   +9.576040977409364e-03   +6.340149978526033e-02   +3.090439468087210e-02; +1.896198421406279e-02   +6.575684437795759e-02   +1.289693094482766e-02   +7.869591796252071e-02   +3.340049972530439e-02   +8.370144246220237e-02   +1.663980127003142e-02   +1.244558188235953e-01];
L1E_L2E_iAMPA_netcon = [+5.238821787675435e-02   +2.692590943951500e-02   +1.449899382291144e-01   +1.397097361342514e-01   +4.242861854628516e-02   +1.450307939307422e-01   +7.349879572766795e-02   +1.444019753724341e-01   +2.469611043546410e-02   +9.725101068619732e-02   +9.094358501647921e-02   +1.109130332901237e-01   +5.593981561791884e-02   +9.843143287339420e-02   +8.063738719003805e-02   +7.270843958937469e-02; +5.510673702867164e-02   +8.057677001814403e-02   +2.830846711017610e-02   +1.132554811827804e-02   +1.156242815346619e-02   +9.916565744647382e-02   +6.616670939591540e-03   +4.681360236064686e-02   +3.616997394763136e-02   +4.811016428636842e-02   +3.509324853448263e-02   +1.444510164519159e-01   +1.935720434586976e-02   +3.497739099761973e-02   +8.820134724534623e-02   +4.181925614989447e-02; +5.370797229820268e-02   +8.697935690357921e-02   +1.331954272469362e-01   +1.341532807753607e-01   +1.370991290531280e-01   +2.078249304613780e-02   +4.425334677614068e-02   +9.450926289602687e-03   +6.620485730043661e-02   +9.283130674117911e-02   +4.886130898822662e-02   +1.210235252604738e-02   +1.047388968156273e-01   +9.023397527442686e-02   +1.266922909010931e-01   +1.184123053953687e-02; +1.096368326874734e-01   +3.199280128129321e-03   +2.866678316491122e-02   +3.157319590266389e-02   +1.043239538745271e-01   +4.825362394613948e-02   +1.425247394783037e-01   +1.338242184261296e-01   +1.131431041986710e-01   +1.130290756142932e-01   +6.963394597140046e-02   +8.372938034509980e-02   +1.403439813975220e-01   +4.976126138097872e-02   +1.337869285873824e-01   +1.427067777789586e-01; +2.689242650938046e-02   +1.357850563908609e-01   +1.291977897276353e-01   +8.760636318599514e-03   +2.985599670239721e-02   +1.175677099848011e-01   +1.316229454997954e-01   +2.096468405947247e-02   +8.809050172662605e-02   +6.175815803237936e-02   +8.546446920077241e-02   +1.137474864134105e-01   +3.664219294657954e-02   +8.317986911570734e-02   +1.519842609010346e-01   +5.208273195923538e-03; +1.082369928333994e-02   +1.334181953199029e-01   +4.561496294774122e-02   +1.229609390793957e-01   +1.524271405512777e-01   +1.300264034582079e-01   +7.715473709902380e-02   +1.367570051378880e-01   +5.075374984984852e-02   +6.489187694657535e-02   +1.307636462973850e-01   +1.373863081164719e-01   +1.222056718892884e-01   +8.949712540197417e-02   +2.820826556029761e-02   +8.570009641007852e-02; +4.696003482988444e-02   +2.920747729561671e-02   +8.525621004830798e-02   +4.124265031276952e-03   +5.756239646085553e-02   +7.740147734988521e-02   +1.151352735464805e-01   +8.804711584122106e-02   +8.445786236566871e-02   +1.223764684313758e-01   +9.978206034345179e-02   +2.178870309802212e-02   +5.938648558700006e-02   +8.752347473346474e-02   +3.292165588150945e-02   +4.663750918745070e-02; +1.163163882812247e-02   +8.068147413631184e-02   +6.984418739737838e-02   +5.972450275624991e-02   +1.112541957404851e-01   +1.444532594546177e-01   +1.463276863696880e-01   +9.936649599973253e-02   +1.334570693455422e-01   +6.202094914982449e-02   +5.092392322629999e-02   +1.446486127438912e-01   +1.012032309160371e-01   +1.356383888384741e-01   +4.624186207082396e-02   +1.287055922937217e-02];
L2I_L2E_iAMPA_netcon = [+9.951770530273392e-02   +3.978154181709429e-02   +1.303993849335822e-01   +6.840238086871518e-02   +1.148727495653857e-01   +7.526494481534888e-03   +4.452027564834294e-03   +1.353108176211701e-01; +2.623340734274436e-02   +2.104363458868086e-02   +2.543714497859376e-02   +1.233194177764766e-01   +1.209863333297538e-01   +5.449258015163974e-02   +1.067884603464614e-01   +7.323157849053948e-02; +1.256812416803612e-01   +1.160407881042048e-01   +1.252909990201466e-01   +1.085040508255340e-01   +8.084030221373865e-02   +7.940254915134114e-02   +7.495314827579201e-02   +1.087481908049160e-01; +5.511256947319024e-02   +2.539781824626682e-02   +1.350321643226383e-01   +6.928703230101516e-02   +1.476622618885080e-01   +2.677365492265496e-02   +7.051670161352669e-02   +1.260796920821762e-01; +1.013407071561783e-01   +1.254331829359399e-01   +9.248028411806281e-02   +9.194618419957962e-02   +1.372374062762004e-01   +1.127370499271913e-01   +6.662692032651840e-02   +1.102511219911254e-01; +9.113666616084733e-02   +5.855622816937532e-03   +1.273802546585200e-01   +1.125717580019772e-01   +8.474797840073479e-02   +3.050593928490119e-02   +1.617623822924544e-02   +1.095681021919585e-01; +1.460345615188401e-01   +7.518203683225545e-02   +2.508957664252285e-02   +4.117896926645326e-03   +2.049619273250278e-02   +3.368566072931028e-02   +2.895070260905311e-02   +3.072439428123800e-02; +1.422104000818059e-01   +4.564031353979791e-02   +8.657577636076672e-02   +6.984697914249073e-02   +1.275612123311321e-01   +3.863677517763873e-02   +1.932853067677457e-02   +7.915046214159619e-03];
L2E_L2I_iGABA_netcon = [+1.378066144112205e-01   +3.061350528059063e-02   +3.138509207720310e-02   +2.478235003380860e-02   +9.829160840898594e-02   +5.529787331522056e-02   +1.247654148724392e-01   +1.425653543527599e-01; +3.675246681645403e-02   +5.878054300982109e-02   +2.180108202660993e-02   +2.451602498357168e-03   +1.529509441358808e-01   +1.030504798251624e-01   +1.139969830278648e-01   +1.485639536262792e-02; +9.535626350169285e-02   +5.617681071269730e-02   +8.207675074415972e-02   +1.189991149939400e-02   +5.960250338242779e-02   +1.387217255991526e-02   +1.413297527505541e-01   +1.276256420495052e-01; +1.231847905615299e-01   +8.515956539948310e-03   +4.070212049907222e-02   +1.068462346203164e-01   +1.334889025121809e-01   +9.785716790661959e-02   +6.625482238648575e-02   +9.556663850078503e-02; +2.230583000182318e-02   +1.341856605304579e-01   +5.010245178919219e-03   +1.197678690884192e-01   +4.813519304270818e-02   +5.243973211038871e-02   +7.286571601248036e-03   +3.961197003936972e-02; +1.136814352233115e-01   +4.672258306328926e-03   +8.097138944060578e-02   +1.167152930955728e-01   +1.296548686165151e-01   +3.834016213968083e-02   +1.376397633914401e-01   +1.092166272729579e-01; +2.415278043292221e-02   +1.502290544397652e-01   +3.968529715582553e-02   +3.004000971757183e-03   +1.118753175818207e-01   +7.886169145233261e-02   +8.973147673552644e-02   +9.245727982050357e-02; +1.287102017283012e-01   +4.905282676051896e-02   +7.286077654553023e-02   +3.617803180475907e-02   +6.936082270275316e-02   +1.165925163370316e-01   +1.433427515471252e-01   +9.364719351715564e-02];
L3E_L2E_iAMPA_netcon = [+4.751785048261554e-02   +1.019914731099510e-01   +1.796270904197525e-02   +1.192214687689332e-02   -1.835768837802052e-04   +1.478105681077883e-01   +6.321363571040174e-02   +1.316919728760749e-01   +1.704117901998392e-02   +3.939588288275382e-02   +4.235777830359350e-02   +1.265683299383257e-02; +4.124662315837387e-02   +1.368540186536239e-01   +4.261517647189055e-02   +5.292742603774302e-02   +7.405283770062242e-02   +7.752688689561107e-02   +1.340713713947386e-01   +1.450229160702038e-01   +8.734910263356566e-02   +1.412120405459280e-01   +4.758893348034217e-02   +3.853300897070887e-02; +1.093498933918264e-02   +1.189099947134680e-01   +1.587803997339714e-02   +1.115232644113998e-01   -1.220879187408025e-04   +2.166675163870307e-03   +7.860136290090289e-02   +1.466611636671770e-01   +9.131368671518296e-02   +8.985962415669684e-02   +3.794162404944433e-02   +1.008317393295024e-01; +1.159284388019795e-02   +2.627948200537842e-02   +1.237460496806630e-01   +3.774594827976917e-02   +4.246445597565118e-02   -5.656010120734698e-03   +5.103437170884820e-02   +1.434083900949586e-02   +2.939213819513716e-02   +5.316676800119594e-02   +2.687001359631924e-02   +4.633716319105224e-02; +1.355185763913075e-01   +5.506961064823128e-02   +5.177220755264501e-02   +1.423235448932740e-01   +1.052318925359697e-01   +5.762202524700243e-02   +1.494731035702625e-01   +2.745676193768499e-02   +1.255058394210717e-01   +7.176550192321256e-02   +1.045160426304239e-01   +5.321983526142202e-02; +1.315438439569922e-01   +8.831305068842403e-02   +1.441023629315430e-02   +6.897582483989963e-02   +9.040615634808001e-02   +1.476777262474112e-01   +1.389654101601164e-01   +5.093851826635162e-02   +7.539753515664806e-02   -4.048538499249763e-03   +1.013272866280493e-01   +3.717684987403497e-02; +9.574242951458661e-02   +7.500094044261467e-02   +9.929865133482955e-02   +3.829611405322939e-02   +6.215828142476395e-03   +5.580314043629541e-02   +7.264494887834600e-04   +5.051993571801477e-02   +5.073127761677097e-02   +1.988192925126378e-02   +2.989850546545273e-04   +6.922954188171559e-02; +1.255818198451643e-01   +1.595144338641565e-02   -5.867776511998357e-03   +3.886255826158853e-02   +7.955505124230661e-02   +1.903623868830051e-02   +4.409386333159885e-03   +6.552067034515684e-02   +7.436121748364433e-02   +1.249379337428715e-01   +1.538309590739327e-02   +8.806872169643483e-02];
L3I_L2I_iGABA_netcon = [+1.436675951317875e-01   +7.616791720987531e-02   +9.544895715332499e-02   +4.444423082238499e-02   +1.434486375308435e-01   +6.365918086877023e-02   +9.973662015599528e-03   +4.087375419521486e-03   +1.307936835766634e-01   +7.097722102981674e-02   +1.387584683725715e-02   +1.131907637610231e-01; +1.360141964721068e-01   +1.452673557268842e-01   +1.312599871138434e-01   +2.387844282505163e-02   +7.086857309707682e-02   +1.224426286075401e-01   +8.019244789944244e-03   +2.848028851974526e-02   +7.016449371066658e-02   +1.047318494810845e-01   +1.853555921661762e-02   +9.763058271565717e-02; +1.361103003261849e-02   +1.279129014243422e-01   +1.394956024263266e-01   +6.082611859142072e-03   +1.023731333856982e-01   +2.565110174605270e-03   +9.359437584083351e-02   +1.432789126982538e-01   +1.039646892957340e-01   +2.990486952867286e-03   +9.851236361342412e-02   +2.183598298435232e-02; +1.457716090749839e-01   +1.269290808819857e-03   +7.518895373198845e-03   +9.823385735164382e-02   +1.290413750622261e-01   +8.278635620226935e-02   +2.681771262937213e-03   +7.373031239440287e-03   +1.345613871298305e-01   +1.213184896025063e-01   +1.498096513926795e-01   +7.593092636633808e-02; +3.011908784407082e-02   +1.479427871346261e-01   +6.320818619881947e-02   +6.247204581714670e-02   +8.660522288714666e-02   +1.383389345184601e-01   +5.797061800049510e-02   +2.127618229892228e-02   +1.473353585507519e-01   +7.779810032687687e-02   +3.091485147930958e-02   +2.703252653063179e-02; +4.084697919177755e-03   +1.017753954846239e-01   +3.011304505975478e-02   -1.592033120966316e-03   +2.230101826039445e-02   +9.789598847634567e-02   +1.070542500957691e-01   +3.545366400794171e-02   +7.131399678020098e-03   +1.132035126619199e-01   +1.317183070825458e-01   +5.854586183598182e-03; +9.307792419653479e-02   +1.362195485357545e-01   +8.390242995039218e-02   +1.008982591469627e-01   +6.705024480445274e-02   +3.931334881936686e-02   +1.014951469496654e-01   +7.406442277440715e-03   +1.292761965972371e-01   +5.556393363057652e-02   +7.551967368918382e-02   +1.097408468286223e-01; +7.612733461291608e-02   +2.765147154836056e-02   +5.249511085633056e-02   +9.227176673666812e-02   +5.225552246956133e-02   +1.669588090453733e-02   +3.877190149980185e-02   +3.681374856616121e-02   +8.680367725454323e-02   +1.430075453667242e-01   +4.273717826693366e-02   +4.109094661127249e-02];
L2E_L3E_iAMPA_netcon = [+9.685869398206708e-02   +1.016589447629760e-01   +3.569543361557047e-02   +1.216161320318563e-01   +1.260764419548458e-02   +7.558242833595147e-02   +1.058251385333829e-01   +1.440667856393999e-01; +8.488147062267284e-02   +1.091649527615282e-01   +1.157896621170619e-01   +1.182260330304966e-01   +6.017046058661220e-03   +8.222483100427015e-02   +1.251693481114440e-01   +1.023229726710405e-01; +1.184440295481857e-01   +1.322701286112250e-01   +1.273001909152975e-01   +1.370832043763989e-01   +8.397252017166859e-02   +9.742138145049727e-02   +1.323292309844693e-01   +8.808551836848284e-02; +5.456511296345951e-02   +1.465696629260619e-01   +1.245521422706261e-01   +9.406861700920768e-02   +7.162482510193391e-02   +8.052076959413576e-02   +3.897119439126743e-02   +2.238168957890294e-02; +1.662379269701428e-02   +7.938091761005256e-02   +4.116633407687534e-02   +1.093129869484593e-02   +2.482086235771366e-02   +7.763416684231196e-02   +1.315964808021555e-01   +1.142255214044211e-01; +7.046044009811016e-02   +1.491416900186095e-01   +1.360312656530216e-01   +8.234487631147584e-02   +7.771746455665419e-02   +1.441322371461665e-01   +1.108105005493190e-01   +1.444606593189954e-01; +7.594351565306803e-02   +1.121705096519331e-02   +7.566279973933429e-02   +3.634863351770645e-03   +5.331824421390385e-02   +1.213599829432394e-01   +5.029742347064867e-02   +1.154334899327557e-01; +1.398863896991378e-01   +1.030635948152473e-01   +7.076804986724483e-02   +1.158295882821721e-01   +5.329316290453968e-02   +1.127771092257118e-01   +7.444184608846481e-02   +5.737192638391051e-02; +7.441522701681093e-02   +8.049575730655102e-02   +1.366565257857574e-01   +9.116111891285240e-02   +8.811186802646143e-02   +5.140013608093662e-02   +8.614135523289523e-02   +1.018118020267198e-01; +3.715093268552035e-02   +2.128830759039674e-02   +1.182621544605070e-01   +1.295147215142329e-01   +1.386334299489612e-01   +9.865888579568207e-04   +1.946067783779539e-02   +9.461121736278906e-02; +9.068132002279024e-02   +4.553449606588623e-02   +1.111702042634603e-01   +1.214942801477117e-01   +1.386788248305434e-01   +1.511470988039098e-01   +3.830626963200186e-02   +5.144137385655766e-02; +1.748684258460209e-02   +8.714151105724030e-02   +6.645830002254878e-02   +1.348581366199202e-01   +6.972508172285220e-02   +3.333195964229940e-02   +9.251126964915524e-02   +1.283862108522631e-01];
L2I_L3I_iGABA_netcon = [+1.394380075611698e-01   +6.376125438706379e-02   +4.100079907301672e-02   +1.023368394229974e-01   +1.132271954153616e-01   +1.245474706648281e-01   +3.535240615908607e-03   +7.344359205487283e-02; +8.376228536908764e-02   +6.909914561936732e-02   +1.041236730603048e-01   +2.630567051262932e-02   +1.343515900990851e-01   +1.263207959350957e-01   +6.717008039709899e-02   +4.165760303925563e-02; +1.173440659580166e-01   +1.114896165155959e-01   +1.444071708902560e-01   +8.815036852107767e-02   +5.352903211546255e-02   +9.244123281758562e-02   +6.548226654905001e-02   +2.097318338862740e-02; +3.121050871212372e-02   +1.232270586723343e-01   +2.924347880682380e-02   +7.192729684600598e-02   +7.923538377511785e-03   +5.101430945878271e-02   +6.356591525589843e-02   +1.499149421132175e-01; +4.749776565217231e-02   +5.702751654339824e-02   +7.599927028577516e-02   +6.822640709506612e-02   +5.651808954303801e-02   +9.621393988875984e-02   +1.365123656884735e-02   +2.387343701778767e-02; +1.557526381961123e-03   +3.968366665333473e-02   +5.724740119846282e-02   +2.439769933273706e-02   +5.064524042030252e-02   +5.821222063191318e-02   +8.135124616031669e-02   +1.084567351160917e-01; +5.248826283597988e-02   +7.283710378849879e-02   +1.443707542742595e-01   +9.774564843393622e-02   +1.118145146178107e-01   +4.542090427254841e-02   +4.909626538021099e-02   +4.969712908451954e-02; +3.729746595228444e-03   +1.534540954106296e-01   +4.794124846612541e-02   +1.347157225964392e-01   -2.852797417110823e-03   +1.143659519494262e-01   +8.320683800410605e-02   +1.198095817205189e-01; +1.286098703468400e-01   +4.736512416738015e-02   +1.275033832333057e-01   +9.375230471624269e-03   +7.731701692500184e-02   +4.508212033365706e-02   +6.539072862884454e-02   +6.438234182594833e-02; +1.095687812262868e-01   +8.056002081700153e-02   +3.417319800493869e-02   +7.674214594358668e-02   +9.049230014353869e-02   +5.205496079218857e-02   +2.697475033669796e-02   +4.995624384942720e-02; +1.096936220734211e-01   +1.436019361903846e-01   +8.394129173002318e-02   +1.000113081973107e-01   +4.855187137075547e-02   +5.827572145952803e-02   +1.351851978520212e-01   +1.918911633968271e-02; +1.122711597153175e-01   -1.513770661632343e-03   +5.486184405338449e-02   +2.204968443178849e-02   +2.141349830815727e-02   +1.484089030807476e-01   +7.604377600251068e-02   +8.290030339775936e-02];
L3I_L3E_iAMPA_netcon = [+6.911738493324975e-02   +1.471896293490467e-01   +3.694533370956551e-02   +9.254003184811348e-02   +1.140765349448086e-01   +4.872577272463927e-02   +4.620463262938969e-02   +3.733700638656047e-02   +5.151304397824456e-02   +4.441314366035328e-02   +3.816159641457966e-02   +6.931587020524002e-03; +5.841484711460468e-02   +1.282103647429044e-01   +3.377245249221086e-02   +1.904617133975526e-02   +1.462620767389826e-02   +8.691946785130909e-02   +8.191362776021129e-02   +8.017311271695036e-02   +2.755229292967482e-02   +7.023988840804145e-02   +1.088855297322632e-01   +8.173332167107483e-02; +5.177137777515963e-03   +8.690539496092228e-02   +7.216234821480212e-02   +8.793509441229384e-02   +7.745496096439856e-02   +6.515732311030827e-02   +7.896265170947282e-02   +7.184170957634366e-02   +5.854860065600992e-02   +8.496905327640915e-02   +6.644406732926086e-02   +7.955297180119823e-02; +5.998421319494544e-02   +1.099785047432548e-01   +9.724942836751857e-02   +7.028397452982123e-02   +6.532150441424567e-02   +1.342202647859715e-01   +1.137107473048644e-01   +2.120175942861431e-02   +1.418171817399880e-01   +1.328980116459398e-01   +2.602944419599985e-02   +1.104247938330689e-01; +1.902757502092777e-02   +5.523866779686412e-02   +6.469767715384104e-03   +1.249621772214680e-01   +1.135721445810927e-01   +8.464163558084845e-02   +1.453242222082013e-01   +5.814705860359343e-03   +1.425238100000626e-01   +8.580135828168836e-02   +5.322834495611904e-02   +1.718480540622588e-02; +5.524621285367448e-02   +9.134392181527091e-02   +1.244714527183599e-01   +6.338993013760458e-02   +1.456969358080960e-01   +2.053386356513763e-03   +1.284939839936254e-01   +4.386340444015031e-02   +1.006301539688690e-01   +4.259214969472801e-03   +5.276020209457192e-02   +2.613236020740810e-02; +1.184500992664754e-01   +5.813457951145448e-02   +5.852056325910956e-02   +4.135923890993583e-02   +1.005871359273219e-01   +2.741086597834421e-02   +8.254190135122430e-02   +1.372939747352966e-01   +1.198974908818503e-01   +1.457422100373694e-01   +8.165902323712829e-02   +1.046278570280870e-01; +1.107592484103221e-01   +2.822482333354446e-02   +1.080843630691639e-01   +9.610255582068143e-02   +1.521274094141161e-01   +8.748841256343506e-02   +1.310169721316308e-02   +7.357836999747473e-02   +6.872763076032123e-02   +4.800244725077148e-02   +3.117427667912218e-02   +1.400736518029236e-01; +1.724096126273536e-02   +1.296048750340758e-01   +1.074950639547617e-01   +1.188463634420479e-01   +5.577241503842696e-02   +1.144482259739365e-01   +2.334479166346102e-02   +1.159943819800138e-01   +1.260271330571939e-01   +6.765261682377147e-02   +3.182391279071323e-02   +2.723528853067241e-02; +1.353626652462724e-01   +1.247147750162950e-01   +6.335983364436569e-02   +2.951121941718477e-02   +8.309217287719221e-02   +1.179062599772306e-01   +7.975566467942040e-02   +1.336303071548019e-01   +1.048405097650046e-01   +5.411758405902595e-02   +1.285166700263518e-01   +3.233238303798719e-02; +6.315911559843727e-02   +5.252320896048077e-02   +1.510611526055661e-01   +1.421010039820901e-01   +4.024545869155116e-03   +8.920970470593514e-02   +8.928092555684011e-03   +3.601098155987061e-02   +1.139765916423008e-02   +1.452199292688397e-01   +1.116285241774454e-01   +5.941958732390924e-02; +1.053525343341705e-02   +2.522892322470034e-02   +6.890941968307498e-03   +6.470016606746175e-02   +7.010350107638166e-02   +3.612424321797320e-02   +1.210014033434315e-01   +2.762094315419292e-02   +4.754130806850371e-02   +3.620922474928352e-02   +1.160214883109130e-01   +4.534642296220398e-02];
L3E_L3I_iGABA_netcon = [+2.644735647392739e-02   +6.528466537193682e-02   +4.901771069878677e-02   +1.383525082398787e-01   +1.207996333096959e-01   +8.085070565029388e-02   +5.326337698366031e-02   +1.166826938048756e-01   +9.051763499292598e-02   +1.078139671951363e-01   +9.255604327070541e-02   +4.311907382841803e-02; +1.197383181904261e-01   +9.555617843080921e-02   +4.709874179086581e-02   +4.395144211141387e-03   +5.580231372611637e-02   +1.107264904621051e-01   +1.008183455425632e-01   +1.472403915988360e-01   +1.236490969692110e-01   +6.389984283090762e-02   +2.421830253590477e-02   +9.598705475818970e-05; +9.030715165915169e-02   +1.475812572603273e-01   +1.429990459540656e-01   +1.202586190442750e-01   +5.209490683042311e-03   +1.127572466970913e-01   +9.237171924639610e-02   +1.053062512039098e-01   +6.224942886700897e-02   +6.226367897670475e-02   +3.723280524251047e-02   +2.122779849581621e-02; +6.517870246199142e-02   -6.780791443955591e-04   +2.888906266333334e-02   +1.055917401531928e-01   +1.040659212181484e-01   +4.408763173905075e-02   +6.346147501085278e-02   +5.576355907496015e-02   +1.477007501169878e-01   +7.191255361490449e-02   +5.791222685354369e-03   +9.600560634976317e-02; +6.313238129008240e-02   +6.516889219676043e-02   +1.563202844363094e-01   +3.286225961823606e-02   +7.541662246664987e-02   +1.152697628470809e-01   +1.475251051515488e-01   +1.451183245476618e-01   +4.230637671520852e-02   +9.040833881824364e-02   +1.282590956542272e-01   +4.654668877350039e-03; +9.875958924062345e-02   +7.364395934758512e-02   +1.290907025945439e-01   +9.182176837144770e-03   +7.903281769185531e-03   +1.472141921644675e-01   +1.090772042952595e-02   +3.635200273013847e-03   +1.202575880962750e-01   +8.996559467495983e-02   +3.573446433202773e-02   +3.337562406602573e-02; +8.297344718527817e-02   +5.383407815441419e-02   +7.678017422344519e-02   +8.329962253712217e-02   +1.013865521494327e-01   +7.309201014220519e-02   +4.974892163916143e-02   +2.195621936490695e-03   +5.602923096635915e-02   +2.301044562385253e-02   +4.653289961644294e-02   +1.048605067986226e-01; +4.406910004054497e-02   +1.978766979564542e-02   +2.008379425334881e-02   +1.393476777755653e-01   +6.926390865340404e-02   +1.184987392275133e-01   +7.506406080179850e-02   +1.177750601879988e-01   +1.186882503926037e-01   +1.269375127741917e-01   +2.476577927574976e-02   +9.072903863950378e-02; +3.921314822021416e-02   +2.372636113233668e-02   +1.179524833132604e-01   +4.671262579174437e-03   +1.459490448563842e-01   +1.373235295317657e-01   +2.485298765754548e-02   +1.147946103760634e-01   +3.193159349286986e-02   +5.286165677034819e-02   +6.596800497966938e-02   +8.764198983713356e-02; +1.180027315783449e-01   +5.028149225754234e-02   +1.279812559348581e-01   +4.870618529551366e-02   +6.087043254976965e-02   +1.449664621907943e-01   +1.116169410229444e-01   +8.926293799907370e-02   +1.403128746611810e-01   +1.446898726065241e-01   +2.482781926978380e-02   +6.931740820451615e-03; +8.130266575006176e-02   +1.938620346305821e-02   +2.662111536000714e-02   +3.317955344196384e-02   +1.138712389956306e-01   +8.109308650789027e-02   +1.350562664140718e-01   +9.462433012648906e-02   +8.476585844446911e-02   +3.101143237474706e-02   +1.395007978240912e-02   +1.192124683048504e-01; +9.758844869052079e-02   +7.800385994312460e-02   +1.463949650904541e-01   +1.042671199031779e-01   +4.443351759473054e-03   +7.035771268964786e-02   +1.444762010560896e-01   +8.474038724881609e-03   +1.105907506496488e-01   +5.676908938601034e-02   +7.458503802390364e-02   +6.051868901016728e-02];
L2E_Input1_iAMPA_netcon = [+1.468613223737522e-01   +1.492010138331470e-01   +1.518128622238046e-01   +1.503921464010197e-01   +1.504877820767456e-01   +1.590086279211889e-01   +1.545985132988113e-01   +1.515903755970427e-01];
L2I_Input2_iAMPA_netcon = [+1.520730032122503e-01   +1.571063442356599e-01   +1.511365583739148e-01   +1.469868431613121e-01   +1.472689286659339e-01   +1.492711040372741e-01   +1.500531642641732e-01   +1.482988491602874e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
