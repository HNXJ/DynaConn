function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.496206755987416e-01   +3.681260652819634e-01   +1.745607711893329e-01   +2.247894191596717e-01   +7.415519811524207e-01   +4.943117122958419e-02   +3.520653392292502e-01   +3.456690645788020e-01   +1.555486253993096e-01   +5.004550978319812e-01   +7.394581283644013e-01   +6.924638036446925e-01   +2.230314101371454e-01   +5.372221580779454e-01   +6.450743215462830e-01   +2.422794156287436e-02; +2.269640512118412e-01   +2.747495135982838e-01   +2.315898646199199e-01   +6.074927479336859e-01   +1.853970699185681e-01   +4.774762482910065e-01   +2.614484489571184e-01   +2.111121725192243e-01   +2.731241615297473e-01   +2.268349736490062e-01   +2.778055025863912e-01   +7.587323305233691e-02   +6.427109205115470e-01   +2.275278945405381e-01   +3.466848553813239e-01   +4.334441661382586e-01; +4.676098327543279e-01   +3.344959808338837e-01   +3.605966093374117e-01   +1.586764890725304e-01   +3.038725055365322e-01   +1.826174268667309e-01   +5.712309896119236e-01   +2.872532459712311e-01   +1.695527008159812e-01   +7.086435367271483e-01   +5.497608765884977e-02   +7.065415013088494e-01   -1.145579062154717e-02   +5.449434027466901e-01   +2.759436709213380e-01   +6.084038321963734e-01; +6.435447322159271e-01   +6.583222659589827e-01   +7.164782757622333e-01   +6.443928151246995e-01   +5.852973124248599e-01   +4.177201175369314e-01   +3.225403126100190e-01   +6.558372131246153e-01   +1.573488109276993e-01   +4.959591889327014e-01   +1.425139306203380e-01   +3.832992006410470e-02   +4.010451048874902e-01   +1.118973224766809e-01   +5.946564013143654e-01   -7.478280238111193e-03; +3.139382522902344e-01   +5.504654289015846e-01   +6.275151128714614e-01   +4.457337345181478e-01   +7.067302324798047e-02   +1.768750028564105e-01   +6.856864038459003e-01   +3.896623854110463e-01   +1.588560213464323e-01   +8.882907949494298e-02   +1.437613091648769e-01   +3.150467376741184e-01   +6.063218678197579e-01   +3.791926339047512e-01   +5.934574597816268e-01   +7.022608786169453e-01; +3.658868505438007e-01   +3.453579163890849e-01   +3.980003996930521e-01   +6.867804615945970e-01   +2.325779365096922e-01   +3.650454149267414e-02   +3.695663359030024e-01   +4.795413304726746e-01   +6.028004806901716e-01   +3.852845634907805e-01   +7.005631544271514e-01   +5.524597206221776e-01   +2.550310176926471e-01   +3.858652417651798e-01   +3.627407217410403e-01   +2.855493122206489e-01; +6.285701005480154e-02   +2.015827590290058e-01   +4.446717062683065e-01   +5.793769270850837e-01   +2.185064406363232e-01   +1.234760541763669e-01   +4.324649259241989e-01   +2.492342463884690e-03   +6.713644790763184e-01   +3.051482230190724e-01   +5.941601580012457e-02   +3.625991770847536e-01   +2.866511910161257e-01   +3.370507505591594e-01   +5.736289055925107e-01   +5.015136037755328e-01; +5.760339028731207e-01   +7.475979029166276e-03   +1.978430675112755e-01   +1.382191245097981e-01   +1.848742383964757e-01   +7.649939887000518e-01   +2.094426695884589e-01   +2.807816360740516e-01   +3.123845893441627e-02   +1.546271172752348e-01   +3.119399967524962e-01   +3.647358824054223e-01   +3.463395911942351e-01   +5.668566289073381e-01   +1.370380820043325e-01   +2.072833096663946e-01; +4.955005827361417e-01   +2.063224967513862e-01   +1.515544743967558e-01   +4.536012019882204e-01   +4.940145057535473e-01   +2.184989394380790e-01   +3.728393419363936e-01   +8.240082992452977e-02   +3.728550216443705e-01   +5.051809795795541e-02   +4.996286746944575e-01   +1.130303002746755e-01   +2.109376966020906e-01   +4.277472924249772e-01   +5.466300625211565e-01   +3.421379057188710e-01; +4.773644972037923e-01   +3.350871657168751e-01   +3.711246156971050e-01   +3.496000050927206e-01   +6.086513106150857e-01   +7.110896976925393e-01   +1.423280227406051e-01   +3.348859438080613e-02   +2.616757196792738e-01   +5.628696550396795e-01   +4.846482491401321e-01   +1.897753982036910e-01   +6.315588611639572e-01   +4.922208895495215e-01   +5.016851751312547e-01   +1.246470278603771e-01; +2.427703349465154e-01   +1.258107809108032e-01   +5.698863432068849e-01   +1.048715977936325e-01   +2.118137357900817e-01   +7.313931705180002e-01   +5.301618465306438e-01   +1.765432059709921e-01   +3.115660392413462e-01   +1.641277244530808e-01   +8.501069669819825e-02   +4.740631038211072e-01   +2.111087351737823e-01   +1.494339562797267e-01   +4.554875042638110e-01   +3.073763228447596e-01; +1.059725907051600e-01   +2.862581935852242e-01   +3.871407297276610e-02   +4.797806914853071e-01   +3.195470321633153e-01   +3.068835783710873e-02   +7.102534648723974e-01   +6.098098996819453e-01   +3.462022277383791e-01   +4.310450149336499e-01   +3.382453037744816e-01   +5.118976374140677e-01   +5.013763540079910e-01   +4.660146693560248e-01   +7.253547256012579e-01   +6.480526874305612e-01; +6.068232440982763e-01   +7.094650079355180e-01   +6.729445767958214e-02   +1.183599835768114e-01   +5.670030612556971e-01   +4.200399540074534e-01   +6.591579777449745e-01   +3.571999061334433e-02   +6.933701192426136e-01   +6.571852090756518e-01   +5.464168842513748e-01   -2.976771373933961e-02   +3.699436105366751e-01   +3.368520218715008e-01   +3.825287573906929e-01   +1.571796918044878e-01; +6.138635330543609e-01   +1.836414114406545e-01   +5.211721646749046e-01   +6.224504371030779e-01   +6.078990024742699e-01   +1.249671112442566e-01   +2.699443729444092e-01   +2.430609571068275e-01   +4.350731460400427e-01   +5.285163014677051e-01   +5.470621090684644e-01   +6.846467301636471e-01   +3.817606840155082e-01   +4.450654312722552e-01   +7.316160454473948e-01   +4.026621328216219e-01; +5.813193729423890e-01   +1.902055991250823e-01   +6.562856894111959e-01   +5.712981665688498e-01   +3.915880740564621e-01   +7.541937213122239e-02   +6.343107314238208e-01   +3.526596219551474e-01   +4.577315093968732e-01   +4.913867965023011e-01   +5.774287911027703e-02   +1.101911013821085e-01   +6.913511173266546e-01   +4.385999141504782e-02   +3.297825194002235e-01   +7.339385314671285e-01; +6.647954156687187e-01   +3.550193269746937e-01   +5.148806982164880e-01   +1.781141921699795e-01   +6.009408251784263e-01   +4.384964751272044e-01   +5.122363691949334e-01   +3.720627700484763e-01   +3.420664920507376e-01   +2.993418676602182e-01   +1.544853173359601e-01   +1.477349048214796e-01   +1.412333513404403e-01   +6.574779639472429e-02   +4.159259192498981e-01   +4.511357936593914e-01];
L1E_L1I_iGABA_netcon = [+3.905092009972619e-02   +6.358174510521630e-01   +6.987202787690993e-01   +5.552141951044560e-01   +4.695546372293894e-01   +5.055518662567026e-01   +7.315247067452481e-01   +6.147176083976646e-02   +6.222105765285363e-01   +1.313197558559783e-02   +5.715204126204044e-01   +2.792049829201173e-01   +2.139482200703512e-01   +7.177137667233481e-01   +2.729523746933761e-01   +4.443671104266441e-01; +5.204268117127573e-01   +4.800811601487927e-01   +4.519187728508358e-01   +2.552142286775312e-01   +4.969418825128061e-02   +5.586947200648258e-01   +4.904951737772480e-01   +5.169289066263876e-01   +1.065270175694314e-01   +4.223791094133290e-02   +7.043759720497498e-01   +1.872027158612836e-01   +4.146832100000788e-01   +4.383095847816570e-01   +7.498763094060057e-02   +3.304722373247123e-01; +5.598716821454280e-02   +5.012061158339310e-01   +2.870828793596643e-01   +2.772333528174242e-01   +2.045367608163093e-01   +8.564177672132450e-02   +2.473569465210222e-01   +4.125915623255278e-01   +1.823743553027563e-01   +1.197338998913418e-01   +5.084533124415164e-01   +4.868647942214664e-01   +4.058972351919616e-01   -5.848507032023970e-04   +3.157327329822571e-01   +3.503078340885704e-01; +2.716223764551309e-01   +5.431316604590020e-01   +5.281722203069263e-01   +4.623948352922836e-01   +3.979619606176567e-01   +6.842096622816608e-01   +6.172632809641057e-01   +3.960184750009355e-02   +5.359969312013891e-01   +6.831587524788270e-01   +4.091145819392140e-01   +5.711854149683571e-01   +2.233035460819223e-01   +4.408014795551664e-01   +6.892286933004775e-02   +8.036914503056009e-02; +3.720033711625226e-01   +6.887371824719410e-01   +6.554564790636586e-01   +7.190159969690543e-01   +2.084030423419720e-01   +1.630940948118268e-01   +4.861899597247461e-01   +3.607882528976463e-01   +5.372629602220611e-01   +5.569852237382162e-01   +6.499551871297691e-01   +5.303761466756591e-01   +1.687428208371342e-01   +1.114469931222524e-01   +2.948932589461123e-01   +7.012192100157947e-01; +5.165635461431701e-01   +5.472746052289142e-01   +5.177346106462465e-01   +5.971109413910477e-01   +3.926913643833370e-01   +1.386937889799393e-01   +2.534148460824905e-02   +2.238679709856938e-01   +6.792786123094842e-01   +3.454317311245571e-01   +6.309892203787743e-01   -4.599826810294471e-03   +2.990243269319726e-01   +3.449158946734344e-02   +1.823940874586852e-01   +4.225642309472568e-01; +1.834503278385008e-01   +5.268935581994153e-01   +5.504498024372392e-01   +2.324597901857963e-01   +4.570313500982079e-01   +1.531555977307244e-01   +6.151333516216753e-01   +5.085476085912463e-01   +9.610727880126721e-03   +4.966866236576375e-01   +1.269429028584489e-01   +5.195586150303979e-01   +4.921810995859295e-01   +5.305359181548236e-01   +1.697904684736410e-01   +5.353421760707894e-02; +9.024794077393852e-02   +3.530876207318741e-01   +2.090441623846922e-01   +9.827312043262601e-02   +4.579765766705026e-01   +4.449147680026937e-02   +1.754637713783185e-01   +2.933967875711244e-01   +5.773356367133765e-01   +2.894985423056445e-01   +2.312618050129098e-01   +2.744204465020544e-01   +3.455046922453897e-01   +1.052446955764372e-01   +3.745806769400482e-02   +6.967296940170971e-01; +3.074451640614628e-01   +5.480309860321069e-01   +6.801190112600364e-01   +4.436296277723787e-01   +3.292136896117954e-01   +3.675064797370936e-02   +7.805734742519713e-02   +3.238895879680926e-02   +4.667608693013112e-01   +1.738966471892086e-02   +2.380991220900510e-01   +6.093003429968973e-01   +4.495724641071214e-01   +3.126705359426810e-01   +6.686872562144234e-01   +7.368744889152873e-01; +3.007036278275395e-01   +6.203870012963206e-01   +2.003283730035886e-01   +1.605519095004478e-01   +7.751804633773929e-02   +3.584590152805362e-01   +2.067528682643680e-01   +1.117958014915656e-01   +5.868544333966930e-01   +1.622985994872351e-01   +2.799905295048377e-01   +3.161260112768113e-01   +5.835869020647899e-01   +6.159518013348758e-01   +5.318017187482573e-01   +2.363404481545435e-01; +4.638927633176074e-01   +3.591591806614453e-01   +3.713312798748726e-01   +1.961379035817515e-01   +4.426758762409292e-01   +6.613530586256438e-01   +5.841151782854032e-01   +5.855318680795407e-01   +4.183062577228960e-01   +3.458146756577405e-01   +8.857924809646504e-02   +6.483120473313531e-01   +1.263186050670825e-01   +2.577148037852769e-01   +3.450517368922672e-01   +3.111441961003664e-01; +5.762337465067511e-01   +1.416337181395134e-01   +1.836156493879923e-01   +3.738871193738605e-01   +5.880345193773533e-01   +1.975742081672780e-02   +4.583090275393278e-01   +4.197191530224385e-01   +8.465823074357609e-02   +3.832279861321189e-01   +3.158112484265898e-01   +3.093604072381801e-01   +1.830169690025418e-01   +4.950043948326363e-01   +6.124675184393915e-01   +5.659498527452065e-01; +2.601237755676675e-01   +3.516874904147316e-01   +3.731923562083501e-01   +6.094124349323333e-01   +3.622465594020518e-01   +2.399118410871371e-01   +5.292295053139073e-01   +4.728222650953616e-01   +5.193194977307780e-01   +6.743306219544193e-01   +7.678286347911591e-02   +1.953232757343090e-01   +2.760369193476711e-01   +4.149623129205905e-01   +3.431826807139771e-01   +4.804162131472194e-01; +1.974166222042308e-01   +3.152545537201218e-01   +4.477628558558989e-01   +4.027633034050739e-01   +5.083652332580600e-01   +1.274572785948390e-01   +3.428693262522005e-01   +2.308882751030274e-01   +2.552502876417183e-01   +3.511174839021062e-01   +3.474699108682086e-01   +2.508330409152986e-01   +6.541753374769648e-01   +7.051788342000523e-01   +2.536256445260714e-01   -1.761008082988322e-03; +2.518640191023230e-01   +1.867154150699646e-01   +3.245001745699710e-01   +4.360435554403466e-01   +3.464748158757001e-01   +3.408629315257570e-01   +2.322977783830869e-01   +2.490895216392320e-01   +4.638352810531461e-01   +5.321117444383442e-01   +2.775865487403167e-01   +2.398726449034674e-01   +1.209928368639322e-01   +2.644280677785908e-01   +5.904497492906825e-01   +5.667986519717532e-01; +2.406571245336650e-01   +3.831852220881083e-01   +3.521550789358975e-01   +1.710002476164915e-01   +3.499997753144167e-01   +6.517703138574358e-01   +8.431624467690546e-02   +5.660688634197482e-01   +1.448429754934559e-01   +5.653571409046970e-01   +3.557508312671305e-01   +5.147144412822591e-01   +3.541641520673964e-01   +6.981705553566778e-01   +1.828695147207060e-01   +5.605247781235180e-01];
L2I_L1I_iGABA_netcon = [+5.360536298566281e-01   +6.604715275085111e-01   +5.022684330085881e-01   +2.724801561568186e-01   +1.523173157032690e-01   +4.534192038693640e-01   +2.666088062039381e-01   +6.832350364571657e-01; +6.358738441111704e-02   +3.187200315968230e-01   +1.728861037985646e-01   +5.457035489889314e-01   +4.232807226894897e-01   +5.786029528720370e-01   +4.897192417132697e-01   +5.621098270723439e-02; +1.355196226221635e-01   +2.712936012324145e-01   +5.162336265790749e-01   +4.085142479304708e-01   +5.671397582510129e-01   -4.649959522320292e-03   +4.310418842596780e-01   +6.449105576235706e-01; +1.824040850882150e-01   +6.264419797901591e-01   +2.930075358027289e-01   +3.790592779063303e-01   +1.926804551387490e-01   +5.181466006240784e-01   +3.350918434232607e-01   +6.224363826939117e-01; +6.073775560500974e-01   +2.788501733252970e-01   +3.067221917520889e-01   +2.283957949877362e-01   +6.157453468778427e-01   +6.709592263358196e-01   +2.909638039135266e-01   +4.411779159261203e-01; +4.815173570082411e-01   +4.122586354878158e-01   +6.690185125433337e-01   +3.880449501866722e-01   +6.042765852425701e-01   +3.547603372373134e-01   +2.482096378092404e-01   +5.092965893377172e-01; +7.225725254789248e-01   +2.635372721733355e-02   -6.552940921461975e-03   +6.051599062898168e-01   +8.652582443876376e-02   +1.815426940460140e-01   +3.171417923142197e-01   +2.075321749201610e-01; +4.432004750579021e-01   +2.460507046820726e-01   +2.010208183134084e-01   +6.661235758941840e-01   +2.181989526532420e-01   +4.421278219296585e-01   +2.548384655012563e-01   +1.743314866592226e-01; +4.744143592136980e-01   +4.064014603193595e-01   +1.162754508235133e-01   +2.340245533148336e-01   +3.773457525682993e-01   +4.790772311021574e-01   +6.141497328376747e-01   +2.033007838519949e-01; +4.058248036320801e-01   +5.461925853660222e-01   +3.584579928007249e-01   +6.725374850439688e-01   +6.167840733768665e-01   +1.109822572794434e-01   +1.959953395292618e-01   +1.206526650241927e-01; +5.717796303663197e-01   +3.066367249712529e-02   +3.939685387084038e-01   +3.349991150535408e-01   +5.073830584548168e-01   +6.565687914248715e-02   +4.930170928259329e-01   -1.366460559656838e-02; +3.950783631860354e-01   +7.139801349502762e-01   +2.710258077542920e-01   +5.118035943575385e-01   +6.716714670865344e-01   +2.707427129545287e-01   +3.379079066205078e-01   +3.285501018394241e-01; +2.842779588863440e-01   +4.583200452005140e-02   +9.425461680333024e-02   +6.310096364062509e-01   +1.989491914135111e-01   +7.217918757570402e-01   +4.055034445729042e-01   +4.322220573091029e-01; +5.114217974858510e-02   +5.993883534556043e-01   +9.226884560887039e-02   +1.518164749621069e-01   +2.040502316362080e-01   +2.672885255286134e-01   +6.836557638998946e-01   +1.651720807956259e-01; +4.338850332229766e-02   +1.556072884001964e-02   +4.063941889882228e-01   +3.865196306871790e-01   +3.415558310359277e-01   +5.190345110883842e-01   +5.619573209582952e-01   +2.013585063368005e-01; +1.880871385595859e-01   +5.751571854638290e-01   +1.486667255052256e-01   +6.614779798590427e-01   +2.627059440781364e-01   +4.204197288143425e-01   +2.691346881431129e-01   +2.216205033636534e-01];
L1I_L2I_iGABA_netcon = [+4.754764465223400e-02   +2.633025773494673e-01   +1.202148377881393e-01   +6.516117808709698e-02   +6.936067813319314e-01   +3.529505658612945e-01   +8.807137928167154e-02   +4.024061427115394e-01   +3.095302453324107e-01   +1.118913817267932e-01   +2.256030054390053e-01   +6.065123043105889e-01   +2.016255500273148e-01   +7.341601957503443e-01   +1.027593417266315e-01   +2.735479044749423e-01; +6.179257255183981e-01   +6.460683100849748e-02   +3.061182506750254e-01   +5.031871985745967e-01   +1.394850558935430e-01   +4.215107520791076e-01   +4.494424019597658e-01   +3.640268097151297e-01   +6.728140589720166e-01   +6.999582234679754e-01   +1.660747720749520e-01   +1.887759788709136e-01   +3.423822952306558e-01   +3.500364119400815e-01   +2.158227224284637e-01   +3.666918057901330e-01; +3.908387967189914e-01   +4.257734464562362e-01   +3.886534899648083e-01   +3.037935801775616e-02   +4.191236958304450e-01   +8.483604147299696e-02   +2.101608379116541e-01   +1.877472674012431e-01   +4.193886047267545e-01   +7.149928889599857e-01   +6.364728561166531e-01   +3.290387736728643e-01   +4.921446225219466e-01   +2.803528168323682e-01   +1.081567768268990e-01   +2.596679799301272e-01; +4.156426673357705e-01   +3.476116576463844e-01   +5.516272630218279e-01   +5.370344402260211e-03   +3.633839430189398e-01   +4.016045327353212e-02   +2.746125133848606e-01   +5.139115820739868e-01   +4.744351874244647e-01   +5.879520098590650e-01   +6.693932215649131e-01   +3.449713614407084e-01   +5.658718983728709e-01   +9.846335582035734e-02   +3.199805190142750e-02   +6.092978166679305e-01; +3.122430560835868e-01   +5.139896765660027e-01   +5.212776220604860e-01   +2.143273353592778e-01   +4.528079538982369e-01   +6.988767665818856e-01   +2.803774522273820e-01   +2.379880159173722e-01   +3.554510801729834e-01   +5.464494134031560e-01   +5.274414456914459e-01   +5.076166420686141e-01   +4.732942990674148e-01   +1.388796713670938e-01   +5.304230843310501e-01   +7.012739108648292e-01; +2.376864353497251e-01   +2.955704875755755e-01   +4.669644202341719e-01   +5.757983707027559e-01   +7.058098904309884e-01   +4.034113585994997e-02   +3.146204278260031e-02   +5.212278702377774e-01   +6.079988482595973e-01   +6.264231187585553e-01   +5.388425537211793e-01   +2.775070846291103e-01   +4.065619217823334e-01   +4.251985626283557e-01   +5.900060676484070e-01   +5.577670891564199e-01; +6.407691387410728e-01   +3.370965914914708e-01   +6.285306795878310e-01   +7.179708847151155e-01   -2.864739301782956e-02   +6.339343356248385e-01   +4.783470472753394e-01   +2.016535802794502e-03   +1.410195556033851e-01   +5.982844676229864e-01   +6.699654350806509e-01   +7.009626860431049e-01   +4.041044114963412e-01   +3.176813692628363e-02   +4.317240651077582e-01   +2.117176157293293e-01; +1.950323932458274e-01   +1.232634057291312e-01   +4.662465539235914e-01   +3.889733695808190e-01   +1.096321162210602e-01   +6.719803457408499e-01   +5.293548234150238e-01   +1.991478512339170e-01   +5.956155518047155e-01   +4.875396844541059e-01   +5.316431971087214e-01   +5.064385800548901e-01   +5.361046801131493e-01   +4.234553874480003e-01   +3.854375914187779e-01   +7.693705571527756e-02];
L2E_L1E_iAMPA_netcon = [+3.345693459226975e-01   +4.054648803314220e-01   +6.258210540249500e-01   +2.539126447911677e-01   +9.502574018883369e-03   +4.445645505949263e-01   +5.019410684189764e-02   +3.801015298653541e-01; +2.894044607698995e-01   +1.145668048429214e-01   +3.832668781103755e-01   +3.929033968514484e-01   +2.423464277397120e-01   +7.489225371877564e-02   +5.846165459626229e-01   +9.070330518132323e-02; +4.267508809945352e-01   +1.344943363636848e-01   +3.872418807636900e-01   +6.281674649950598e-01   +5.381641351851524e-01   +6.361340819809177e-01   +6.326998214576650e-01   +5.070361558615660e-02; +5.084516222650873e-01   +2.213788139478363e-01   +5.114634195964816e-02   +1.490657801152471e-01   +2.807228470013244e-02   +6.711201864025045e-01   +2.902831007635783e-01   +8.187490646840372e-02; +3.322045858335315e-01   +5.585763698790613e-01   +6.271645680392058e-01   +5.121481024096415e-01   +3.605596578865078e-01   +4.763290944115715e-01   +4.587133778691246e-02   -3.131764802513214e-03; +6.220961519328598e-01   +7.452867883808431e-01   +2.498784158531422e-02   +6.694505881498140e-01   +2.156511182476158e-02   +5.267014657294729e-01   +3.215932806567487e-01   +5.824472237147232e-01; +1.114240514300233e-01   +5.559963154868850e-01   +2.958160517811173e-01   +1.257052569848447e-02   -8.054584323450870e-03   +6.516920755491799e-01   +4.103992452429927e-01   +5.868355478069515e-01; +3.047225968708496e-01   +7.127704907670940e-01   +3.269663389666361e-01   +5.872623909065495e-01   +4.643544594155101e-01   +4.212080696020459e-01   +6.468668626353644e-01   +3.354920200847126e-01; +2.468106421567145e-01   +9.744771847983281e-02   +3.799778943063383e-01   +2.165063571804395e-01   +6.823326488314602e-01   +5.969522354452290e-01   +1.713059033451432e-01   +4.805740426563524e-01; +2.515339357270150e-01   +6.436432688098752e-01   +5.973054264880352e-01   +6.305303862756084e-01   +7.158358816676976e-01   +1.973042000774043e-01   +3.431759280881415e-01   +1.718385880292410e-01; +5.607336660403289e-01   +4.646640955350666e-01   +6.852407135574035e-02   +6.045642995683538e-02   +2.770350973007128e-01   +5.099968322071038e-01   +4.633243792308542e-01   +1.051122576292783e-01; +7.077909940433527e-01   +3.102538477184964e-01   +2.090209669913403e-01   +4.402463739363059e-01   +6.323022787435592e-01   +7.242357830118094e-01   +4.482192633084386e-01   +5.983911155272180e-01; +3.279603585915072e-01   +5.954913718456741e-01   +5.997276123562801e-01   +2.857615701196852e-01   +6.514801167121066e-01   +5.832466557289936e-02   +4.888729433234190e-01   +6.687094463481520e-01; +3.531197074163820e-01   +2.849761995742898e-01   +5.293014617054004e-01   +2.781603977711379e-01   +1.331159549788245e-01   +6.211229483505121e-01   +6.982833514354003e-01   +1.947153863759806e-01; +5.129243525875061e-01   +5.924057884145341e-01   +5.913593830564067e-02   +1.846239561234149e-01   +3.198126988080262e-01   +7.306829113078347e-01   +4.162007140975044e-01   +1.316268572670309e-01; +4.796614864448942e-01   +4.967465634595862e-01   +3.734546782446894e-01   +7.218515802865247e-02   +3.784434499563827e-01   +2.109782386638772e-01   +4.886698231386996e-01   +8.408400793890450e-02];
L1E_L2E_iAMPA_netcon = [+1.831137062835307e-01   +3.298694920622465e-01   +7.472096722072084e-01   +4.482085756558730e-01   +4.401856904448849e-01   +8.492960097281060e-02   +3.775066342339203e-01   +6.041566643799636e-01   +4.540009205166455e-01   +3.327504979088622e-01   +5.199415576662570e-01   +2.194845035058796e-02   +3.665543150919734e-01   +3.027446197628790e-01   +5.311211501488413e-01   +6.979916180630205e-01; +5.115527186251001e-01   +6.796597523660253e-01   +5.039652973178290e-01   +2.381137880099414e-01   +3.855385822712702e-01   +4.548645255325324e-01   +6.094488380800448e-01   +1.038106806638417e-01   +1.672493353835601e-01   +1.551485399009923e-02   +1.314623458850700e-01   +2.957567990558559e-01   +1.184303560945518e-01   +2.118663885734994e-01   +1.276978524021159e-01   +2.850020019262710e-01; +3.319084038373183e-01   +6.315358540535546e-01   +7.246655084331693e-01   +6.626188370627573e-01   +2.424784364941398e-01   +6.340754174409654e-01   +1.949580879146934e-02   +5.796257804497399e-01   +3.900562535027207e-01   +2.568769123965687e-01   +8.586354428960036e-02   +6.686165939016767e-01   +8.949419609379448e-02   +3.500449962625191e-02   +3.215209028576019e-01   +4.557638132482442e-01; +3.474425427599377e-01   +3.051761249940804e-01   +4.379157114428474e-01   +7.412955566280873e-01   +5.789229009187139e-02   +4.879846656400212e-02   +6.606555731641678e-02   +4.951782067120497e-01   +6.594432183809209e-01   +5.230758258116256e-01   +4.546488892927629e-01   +1.035816687273939e-02   +4.024493573999376e-01   +9.135704093556557e-02   +1.940364057138471e-01   +4.120672491248636e-01; +6.187243676651925e-01   +2.099558901406282e-01   +9.871428634973088e-02   +1.323466299238822e-02   +7.081084666476100e-01   +6.522769334155258e-01   +6.925023303034499e-01   +2.783988200191025e-01   +2.310804708570478e-01   +3.162975456675035e-01   +5.301350295012001e-01   +2.965517272037440e-02   +5.201735941419197e-01   +4.993691112483081e-01   +2.629392909811864e-01   +1.904859006863137e-01; +9.497525517629379e-02   +4.099340006699441e-01   +9.346663200311227e-02   +4.019986429747655e-02   +5.335283144993466e-01   +3.639984875503375e-01   +4.103780494147908e-01   +6.090819963965703e-01   +6.342431075220725e-01   +5.378806807934545e-01   +1.392493507725878e-01   +5.815852056435344e-01   +5.370781923789908e-01   +3.473187687012516e-01   +8.292439594491402e-02   +2.864676566799510e-01; +2.090662428964397e-01   +3.126454286360198e-01   +1.629706416016799e-01   +1.477599263275914e-01   +2.597027618419537e-01   -2.060848011132285e-02   +1.320412858661181e-02   +8.811091462062036e-02   +3.291369820961562e-01   +4.132743319237863e-01   +1.362900576007642e-01   +2.044257336740491e-01   +6.929490577249658e-01   +3.789266268654587e-01   +6.397803043501807e-01   +3.199813733560403e-01; +1.735464008408032e-01   +2.854442892629013e-01   +6.606419840240758e-01   +6.064155151236396e-01   +7.009315078470442e-01   +4.158771150467829e-01   +7.217957193865502e-01   +1.422482150146025e-01   +3.107312625482364e-01   +6.548864782716111e-01   +6.579399692422098e-01   +1.531850231651888e-01   +3.477529189029426e-01   +2.376487169514603e-01   +6.096325039020292e-01   +3.153917270169702e-01];
L2I_L2E_iAMPA_netcon = [+4.566192832430357e-01   +1.730775483945495e-01   +5.414244522486461e-02   +3.639142771938733e-01   +5.858539382019220e-01   +4.910770328778615e-01   +7.515888699209154e-02   +3.888007770972158e-01; +1.126734084915160e-01   +2.053024645057218e-01   +6.827316649591711e-01   +3.791401392558474e-02   +4.709159522124747e-01   +2.158014807526285e-01   +1.302010446776057e-01   +4.344820927926969e-01; +1.790412488385365e-03   +6.195677500202099e-01   +2.143601134300566e-01   +2.690473261107751e-01   +6.195101152694211e-01   +7.174528425583929e-01   +5.830642939900046e-01   +2.202108661972104e-01; +5.888293314879857e-01   +6.856557398668999e-01   +7.086682205129812e-01   +5.957073173186972e-01   +6.397756459468571e-01   +4.240491444752462e-01   +3.650904900485008e-02   +3.364721086215870e-01; +5.954812924618549e-01   +6.295446429196819e-01   +1.921142221339081e-01   +8.404388353766715e-02   +2.689409388997050e-01   +6.907319517293370e-01   +1.986413710745005e-01   +6.597283421131654e-01; +4.390685996349479e-01   +2.356659318420745e-01   +5.901965272855056e-01   +4.901352545167841e-01   +1.477988419441180e-01   +2.180374694442601e-01   +1.336445794150462e-01   +5.327903316823275e-01; +1.059896047828229e-01   +2.886784472404271e-01   +6.335997989987820e-01   +6.786597597119690e-02   +2.857239224789586e-03   +2.361200773356296e-01   +3.413929717344664e-01   +7.088331517684916e-01; +8.832108072486793e-03   +3.585122011531741e-01   +3.661824213893481e-01   +7.067999517884946e-01   +5.283458067978825e-01   +4.597068451989926e-01   +7.046830520687218e-01   +2.400880637213072e-01];
L2E_L2I_iGABA_netcon = [+6.374840926902986e-01   +3.319038764258676e-01   +3.429493604726494e-01   +2.261097623887477e-01   +8.810934500999917e-02   +7.076965047259307e-01   +6.624951081877564e-01   +5.039199730465973e-01; +7.207773030083235e-01   +2.651526349689906e-01   +2.052754085398314e-01   +6.974070228451688e-01   +6.403991312939492e-01   +5.112072374775170e-02   +2.953341963906737e-02   +4.305769227438015e-01; +2.798746191375887e-01   +4.614102804181732e-01   +5.353622974734253e-01   +2.750647782978546e-01   +1.798033821744196e-01   +6.491093387283905e-01   +2.771083164859436e-02   +3.184206180242370e-01; +7.153830150994623e-01   +6.907249774567881e-02   +2.233303460882756e-01   +5.417974556993721e-02   +6.504220028309380e-01   +7.163005901845686e-01   +6.819818291849226e-01   +3.605172780933762e-01; +3.767952246217090e-01   +3.862573194659372e-01   +7.497680057626314e-01   +2.360117438591554e-01   +5.294181338481367e-02   +1.104511145976000e-01   +6.677573954551530e-01   +3.175911709448211e-01; +4.777435417681953e-01   +2.690991679902242e-01   +2.407298952449399e-01   +3.748275584734854e-01   +2.146918636871721e-01   +4.577769043876072e-01   +4.130925230055005e-01   +7.367545847121680e-02; +6.433812791472701e-01   +4.472563630016761e-01   +5.331616169157348e-01   +1.527338956449346e-01   +2.037804109377888e-01   +5.905686365760511e-02   +5.024017052979095e-01   +2.011500032793273e-03; +1.428515590933106e-01   +2.688138567524919e-01   +4.122283168241535e-01   +3.438432297784290e-01   +6.616444021056631e-01   +4.697698635213826e-01   +2.357263535845334e-01   +1.782281344853240e-01];
L3E_L2E_iAMPA_netcon = [+3.641128831702458e-01   +4.539852761966430e-01   +1.839153927795773e-01   +1.849601480260462e-02   +4.082900946977756e-01   +4.051335198940612e-02   +6.746942771775578e-01   +4.527588909600690e-01   +5.313032751250667e-01   +4.991212475549873e-01   +1.452159574840229e-01   +3.888811704765153e-01; +2.152111321374425e-01   +4.117383099963089e-01   +4.953731397424943e-01   +1.017346717465912e-01   +5.627115803252386e-01   +6.151346434903765e-01   +5.189978286772439e-01   +2.677644947464103e-01   +6.216964074276821e-01   +2.203267035281693e-01   +4.975307316891763e-01   +5.758022831861986e-01; +4.834454235689362e-01   +3.181431675293678e-01   +6.438368081506340e-01   +6.269541763604730e-01   +4.853038620803611e-03   +1.739409661488605e-01   +3.923921305617478e-01   +4.844402489330070e-02   +4.095563432769034e-01   +5.060544920655773e-01   +3.720346500577095e-01   -4.047859855265550e-03; +4.891354271477058e-01   +3.742599728046927e-01   +1.144703915021279e-02   +7.264605784950505e-02   +5.550890517628279e-01   +2.521614767120033e-01   +5.235516715398352e-02   +4.073715724958785e-01   +2.090815147868327e-01   +2.351580652440978e-01   +4.353100896764054e-01   +1.283425710452399e-01; +5.042383601798429e-01   +7.401572478209482e-01   +6.163148306513063e-01   +6.568441436642291e-01   +5.856622983322248e-01   +6.400506712401285e-01   +4.645127108490288e-01   +1.076313491922257e-01   +9.221684611890961e-02   +1.632051358910724e-01   +5.201979152524655e-01   +4.598841526430363e-01; +1.738394203179303e-01   +1.320879666137172e-01   +1.147779754464499e-01   +2.770952842346412e-01   +5.507707094171755e-01   +5.157235995829726e-01   +7.043935776327551e-01   +6.668363236082876e-01   +6.982534707356615e-01   +2.802571216250717e-01   +6.685008735122351e-01   +5.188499199063472e-02; +5.377381679780876e-01   +8.499227886298841e-02   +7.146256033884485e-02   +4.522492927753575e-02   +5.203833616863818e-02   +3.595064101976760e-01   +5.396433997984385e-01   +2.365638913897927e-01   +2.567337490186415e-01   +2.234830415576529e-01   +6.285074430739783e-01   +7.174429506649883e-01; +6.340543042006932e-01   +5.873290660033963e-01   +4.406129700225597e-01   +6.551544116914658e-01   +5.612519870836085e-01   +2.088522110722980e-01   +2.683272326754964e-02   +2.314637342241427e-01   +1.235771958744549e-01   +6.310038989351265e-02   +3.439966093905514e-01   +1.265042556767966e-01];
L3I_L2I_iGABA_netcon = [+4.320544856695036e-01   +6.874265726232257e-01   +9.700053439355832e-02   +4.226844583417536e-01   +4.245868566149615e-01   +5.083450246869672e-01   +4.875870874500957e-01   +6.652047195800032e-02   +7.062315080426505e-02   +1.307581169912662e-01   +5.885314277651479e-01   +1.649977709383158e-01; +4.416204810467024e-01   +5.087006271119857e-01   +4.448735665659246e-01   +4.652015777484763e-01   +5.553531739173738e-01   +2.592381213102191e-01   +6.738154876724963e-01   +3.784378527379260e-02   +2.658187528227393e-01   +2.594052060064302e-01   +4.355654798313006e-01   +7.512224478526110e-02; +3.372451606569798e-01   +5.367028271042267e-01   +3.782444192017796e-01   +3.365193474377932e-01   +4.281063471017971e-01   +3.356477044345336e-01   +3.762403628193015e-01   +5.026068786645280e-01   +4.535872767042796e-01   +3.970031858331192e-02   +4.803385488321461e-01   +5.478882042652615e-01; +4.957489176972191e-01   +6.470298303464416e-01   +7.177760221682128e-01   +1.678090410563017e-01   +4.413035283999430e-01   +7.179414902203224e-01   +2.464220656938699e-02   +1.070900116481679e-01   +4.450957749070964e-01   +6.069239727032185e-01   +1.201104364542440e-01   +5.483748701314012e-01; +3.113463086955943e-01   +5.680954122245143e-01   +6.134781761638070e-01   +5.781295047069639e-01   +6.319323121924519e-01   +2.036722614346758e-01   +3.275795439679327e-01   +5.406179578904559e-01   +3.658786695437531e-01   +1.150048218861822e-01   +2.765479448047054e-01   +2.736425404611205e-01; +4.716154217246494e-01   +1.711667067419433e-01   +4.696034244881576e-01   +2.640823687723889e-01   +5.968264526253096e-01   +4.532429570157411e-01   +3.106541482463295e-01   +4.295132443270255e-01   +2.287403198471559e-01   +2.377700093598995e-01   +4.428346129414029e-01   +4.724480238041690e-01; +3.032890930445619e-01   +9.422307027976656e-02   +6.142881357079825e-01   +4.834079550592748e-01   +2.517648463849697e-01   +6.507103156412913e-01   +3.029316575548301e-01   +1.872625510530104e-01   +4.973418166366143e-02   +6.133103909172646e-01   +6.361741133834080e-01   +1.194419502546359e-01; +3.445936475233863e-01   +1.568228867048315e-01   +6.866260750924588e-01   +9.054647159058231e-02   +5.949889121707824e-01   +6.502018679408585e-01   +5.418274154455573e-01   +4.095656291331672e-01   +3.393112372335488e-01   +5.629552180958702e-01   +1.765866892520884e-01   +5.966462060934893e-01];
L2E_L3E_iAMPA_netcon = [+4.141225861343800e-01   +1.673404120910751e-01   +6.188736700584775e-01   +4.550114868160838e-01   +4.223292272036858e-01   +3.349483022855593e-01   +3.683483356460347e-01   +2.414707396338849e-01; +3.852683637526165e-01   +4.184684356370311e-01   +5.153808858352392e-01   +3.039220666633407e-01   +6.717723338117509e-01   +2.534493428808459e-01   +4.544049732567304e-01   +6.671433597424768e-01; +1.707696987276910e-01   +1.687533413111764e-01   +4.831388215488251e-01   +5.028104040152314e-01   +4.427933756884478e-01   +6.231429139309927e-01   +3.957135316923412e-01   +8.241058466157143e-02; +1.237761130017195e-01   +1.619502398676894e-01   +3.234471459733726e-01   +6.876305012424205e-01   +2.682557619190333e-01   +5.578402429937043e-01   +4.279256664841822e-01   +2.055500684796606e-01; +1.208253915581453e-01   +4.762096464148589e-01   +6.817610992889063e-01   +1.805832871437717e-02   +5.165006794044994e-01   +5.240240536470346e-01   +5.286082062102163e-01   +3.729464901969244e-02; +1.146360928339762e-01   +7.030206505547714e-01   +4.970585909884391e-01   -1.167160653754160e-02   +7.045507043058945e-01   +2.560367407741554e-01   +2.351311139060235e-01   +5.763396711843913e-01; +2.139040895846071e-01   +1.600779269936326e-01   +4.326380813575452e-01   +9.138193535007361e-02   +1.973906489315747e-01   +4.975594062809747e-01   +4.179674300981409e-01   +3.908176846105119e-01; +4.171027484220596e-01   +5.187096902026806e-02   +4.025082870255677e-02   +4.092886636919490e-02   +6.169419357473921e-01   +3.927620239367697e-01   +1.660589309086801e-01   +6.696933247347809e-01; +6.841631200844872e-01   +5.035425676641127e-01   +2.484332115840193e-01   +5.924586904059896e-01   +5.672650707667428e-02   +2.981793533707700e-01   +4.440321188711969e-01   +3.088112294405430e-01; +7.393000338040492e-02   +1.549703022304423e-01   +5.943241359162938e-01   +8.127630893791211e-02   +1.933944643830265e-01   +1.906024676143339e-01   +6.857790260964755e-01   +6.630636235507484e-01; +5.026418224104063e-01   +5.831470031090480e-01   +3.782165943300002e-01   +4.340155473969495e-01   +3.139658443548575e-01   +2.153939098028669e-02   +1.328966241591728e-02   +5.970456815150955e-01; +5.615396422783872e-01   -2.139667919766417e-02   +6.744143209487587e-01   +6.336962245983521e-01   +3.969555556467078e-01   +9.443720971368641e-02   +1.917599926509522e-01   +2.058170680220046e-02];
L2I_L3I_iGABA_netcon = [+2.481408027710394e-01   +3.152264834370597e-01   +2.600225072020445e-01   +4.464254652733172e-01   +3.244466116977526e-01   +3.357956021403862e-01   +3.830294853256775e-01   +4.278611197452674e-01; +2.678302958601775e-01   +5.775389803495687e-01   +1.503444922726740e-01   +6.807489634045903e-01   -2.860448057285290e-02   +4.252341465610931e-01   +3.079312156218581e-01   +2.983414561712701e-01; +1.955529213916243e-01   +4.766641450454240e-01   +5.859805702114550e-01   +4.434222306554684e-01   +2.792212084847203e-01   +3.423167700961198e-01   +4.968075371097614e-01   +6.775665102166687e-01; +5.285642040670512e-01   +2.045594676229802e-02   +6.222464388515621e-01   +1.804810410259124e-01   +4.090391990453591e-01   +4.113566089925634e-01   +6.336635558059708e-01   +1.210523830531935e-01; +3.942980461426744e-01   +7.610981249001669e-01   +5.227909984241307e-01   +3.658493101610921e-01   +2.706237368453556e-01   +5.994329952285710e-01   +6.482469406877583e-01   +4.735986741125255e-02; +5.596410433927074e-01   +4.281640499882381e-01   +1.378761396732029e-01   +6.251914988846278e-01   +2.359075309819158e-01   +1.875174888509053e-01   +2.726416855707287e-01   +6.663646818601522e-01; +2.334887255748788e-01   +5.646484732359129e-01   +2.168346256543275e-01   +5.710966331718037e-01   +2.596048543075487e-01   +1.262526910502166e-02   +3.646661665655521e-01   +4.749484855221257e-01; +1.467550790833636e-02   +1.710481399499950e-01   +4.303220498198530e-01   +7.811545359626870e-02   +4.785762871281010e-01   +4.927398704110571e-01   +1.255048037778505e-01   +8.177926416777753e-02; +3.402560867199474e-01   +4.175419763236876e-02   +6.122389672031374e-01   +6.831279546089254e-01   +4.831340655642734e-01   +8.340887530668846e-02   +2.145928058218950e-01   +6.010495577971448e-01; +2.894451966389567e-01   +1.019451608350866e-01   +6.176118828689330e-02   +4.280908103283884e-01   +6.453661386090792e-01   +3.758400184056138e-01   +6.261756749961643e-01   +3.636298496226827e-01; +4.175296531358477e-02   +3.438461586534938e-01   +1.328580803703955e-01   +3.541276636299285e-01   +1.548659540913674e-02   +4.049669048911496e-01   +5.358595903615658e-02   +1.474320306809419e-01; +4.815208446458137e-02   +2.895316350552560e-01   +6.934613634299026e-02   +2.087626297706274e-01   +4.277972303384486e-01   +6.612709883759610e-01   +2.907618731261920e-01   +1.948090873842881e-01];
L3I_L3E_iAMPA_netcon = [+3.066567499013040e-01   +3.218071881211231e-01   +4.517495604928230e-01   +6.969890693230547e-01   +1.981036240255572e-01   +4.752969587518260e-01   +2.408038110011677e-01   +1.827206774573991e-01   +3.045076383905442e-02   +5.791124739961679e-02   +4.759473390972702e-01   +4.964527979793676e-01; +5.796447539593402e-01   +2.580128449642541e-01   +2.611239671010195e-01   +6.500886858647514e-01   +6.126654379418792e-01   +3.316066009522023e-01   +6.479440311084211e-01   +7.222561060896762e-01   +3.502457427610414e-01   +1.679777570070248e-01   +4.613521149317006e-01   +6.218614413717696e-01; +2.232201151649897e-01   +5.332120739751390e-01   +1.999467879803899e-01   +2.249881316068421e-01   +5.404871670182498e-01   +5.910992579886167e-01   +5.601325350718898e-01   +5.679459894311034e-01   +1.247490275904684e-01   +5.489437387572976e-01   +2.424248332376677e-01   +6.226336201379135e-01; +7.084650100627404e-01   +4.237832361319194e-01   +4.081623999280511e-01   +5.718553107883205e-01   +2.318063536069723e-01   +2.973320206362538e-01   +3.279587736122530e-01   +5.720586415495651e-01   +5.892326429399599e-01   +6.827839015071343e-01   +3.065094074741133e-01   +5.536121239047231e-01; +8.518588840165320e-02   +5.670828083019411e-01   +3.032802838818701e-01   +6.752227648591445e-02   +1.766939759611881e-01   +1.374674898158445e-01   +1.077852190552772e-01   +2.740711494504431e-01   +3.954272988686047e-01   +1.458401994802587e-01   +6.761275963202000e-01   +5.286543619243942e-01; +2.861821937101994e-01   +5.599445397353338e-01   +2.939308358806708e-01   +6.617468527331984e-01   +1.284799904705216e-01   +7.888775927658825e-02   +1.984692937398737e-01   +1.981371975570240e-02   +1.162442234414233e-01   +7.515996221834931e-01   +5.539596453115521e-01   +7.755670829560542e-02; +4.692382431007130e-01   +5.637050275224605e-01   +5.677781016124972e-01   +4.569149570401542e-01   +4.156918084298419e-01   +2.976222567406387e-01   +2.695415890864185e-01   +6.829066913634873e-01   +5.011089699735275e-01   +1.559163683541191e-03   +1.090287481553715e-01   -2.504417684277650e-03; +6.757840826983131e-01   +6.403011487436705e-01   +4.023205993048135e-01   +4.845386143199289e-01   +5.528049223806140e-02   +2.124559398624618e-01   +4.352975975156668e-01   +7.029052412593313e-01   +4.558018888342414e-01   +6.344956182716741e-01   +7.631583383065250e-03   +4.154088762418183e-02; +1.476850982224082e-01   +2.468439858849817e-01   +2.506145927550891e-01   +3.583893257462507e-01   +2.180006603179162e-01   +3.085794002022177e-01   +6.129632814035553e-01   +1.250748785790168e-01   +4.568022563120370e-01   +6.150335831694955e-01   +4.946876055602383e-01   +6.454881458555619e-01; +4.735302915109341e-01   +2.667915909247046e-01   +3.709333224136434e-01   +3.293375604037508e-01   +1.148981701305882e-01   +3.894942350203902e-01   +3.818660823731772e-01   +7.348002154031731e-01   +5.924813233570991e-01   +2.520500109839386e-01   +2.383963500503807e-01   +1.024280276074151e-02; +4.723587936656872e-01   +5.114016596507983e-01   -6.312760518751173e-03   +6.887998420897441e-02   +1.511369819878330e-01   +5.408944101325963e-01   +1.915914765536155e-01   +4.395136719423174e-01   +1.012281044314810e-01   +1.578647053055399e-01   +3.481668084258501e-01   +4.901172802831196e-01; +2.627080775180765e-01   +1.097503390565214e-01   +3.379851268960777e-01   +6.943077815129747e-01   +8.456347971901904e-02   +9.793554243415438e-02   +3.635408429643564e-01   +4.858621511062849e-01   +3.768403806113509e-02   +1.634517795968063e-01   +2.554787894141356e-01   +6.526076887094843e-01];
L3E_L3I_iGABA_netcon = [+7.385729183270279e-02   +5.789579821738658e-01   +3.325516348844162e-01   +5.729908588688049e-01   +5.268261221209138e-01   +4.434002707647078e-01   +4.282376165827138e-02   +3.089493871900741e-01   +4.453497786835022e-01   +6.287912658095095e-01   +6.996506886633553e-01   +3.212413714290158e-01; +1.134511690599980e-01   +1.403892614129787e-01   +6.614465200224484e-01   +3.459443409803000e-01   +2.025269324892681e-01   +3.953660761882535e-01   +5.577943641946456e-01   +4.260195759208666e-01   +9.582313208971616e-04   +7.073617794115531e-01   +5.184956701246159e-01   +6.081157135403746e-01; +4.726664584313195e-01   +4.884897615870547e-01   +6.253450641263265e-01   +5.756894849341608e-01   +1.303857230049380e-01   +6.345430142680782e-01   +2.510416426301359e-01   +2.218140263892207e-01   +4.266404150587657e-01   +4.914905762752858e-01   -1.710398041545122e-02   +5.870760268602169e-02; +5.334672078087598e-01   +5.248639649824588e-01   +1.769230568788301e-01   +1.696039925950220e-01   +2.457600054423111e-01   +6.704301848512659e-01   +2.469727255305774e-01   +3.172876015368706e-01   +2.494272272126286e-02   +3.242015147086810e-02   +5.711915010469617e-01   +1.468557844238056e-01; +4.788431343561620e-01   +6.119966827539612e-01   +7.410748896985297e-01   +3.156437116073258e-01   +5.225393157571558e-01   +2.718906081764911e-02   +5.816804825993294e-01   +1.960023844177044e-01   +4.231438968566465e-02   +6.749467511639451e-01   +3.302975406413256e-01   +3.194236830896661e-01; +1.638707742776879e-01   +1.171740455828941e-02   +1.072257949142852e-01   +8.442320218215220e-02   +5.605161635598792e-02   +6.121862434263526e-01   +2.349605574731695e-01   +5.924426068737778e-01   +6.556492660154307e-01   +6.546869259434801e-01   +6.036840894833692e-01   +7.704164083138493e-02; +6.215133149193467e-01   +6.937922531849237e-01   +3.362272562696167e-01   +6.498116469510401e-02   +4.266871484687333e-01   +5.427348417984027e-01   +6.278672330181304e-01   +6.138419979519839e-01   +5.040054107898021e-01   +6.558750867620426e-01   +4.698813602627124e-01   +9.841610971262127e-02; +3.449181825050754e-01   +4.080659097342831e-01   +4.394082361869336e-01   +6.539006971527761e-01   +4.196272090887725e-01   +1.488886277490832e-01   +2.072610014037065e-01   +3.886456253139302e-01   +2.732742730334832e-01   +3.737747698493448e-01   +4.163383729111894e-01   +4.471997093619482e-01; +6.690907501421799e-01   +1.945978933868090e-01   +6.612545060794111e-01   +3.603866728597281e-01   +5.446439531057209e-01   +2.277029029472784e-01   +3.939663216644852e-01   +3.454686665429370e-01   +3.683433568706157e-01   +6.246788406685084e-01   +5.095127145631011e-01   +7.113379562968476e-01; +4.192757062147446e-01   +3.573963184625081e-01   +5.171807546442441e-01   +1.570117098800575e-01   +5.243809726000560e-02   +3.805939051682893e-01   +3.259929474710010e-01   +1.178621519696186e-01   +3.733159452993134e-01   +2.865004068937160e-01   +3.032944701674109e-01   +2.244655941827886e-01; +3.647214263492581e-01   +5.331918771313626e-01   +2.697079219857960e-01   +6.647427653146202e-01   +2.001622255941932e-01   +5.021193079037181e-02   +2.087935327084756e-01   +6.909803344924798e-02   +5.888048886004266e-02   +5.574941658263379e-03   +6.654168223237872e-01   +5.172679926617026e-01; +1.176713467333552e-01   +2.860211968063256e-01   +2.818218000306426e-01   +2.553605074254879e-01   +4.726670029192872e-01   +1.382301615911105e-01   +4.433332151637240e-01   +2.954576595800704e-01   +2.669211128648382e-01   +7.702245129273580e-02   +7.902340241892115e-02   +7.145334619767992e-02];
L2E_Input1_iAMPA_netcon = [+1.816628124565671e-01   +1.236002516113671e-01   +3.644116768945760e-01   +3.231847344101588e-01   +4.324240758639014e-01   +5.099282174686410e-01   +3.060597258096717e-02   +4.176347633005931e-01];
L2I_Input2_iAMPA_netcon = [+3.506515047115624e-01   +2.301120346800539e-01   +6.483856011714904e-01   +6.718093896859915e-01   +3.857216626760940e-01   +3.581314893547948e-01   +4.901622821461973e-01   +5.903524082947679e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
