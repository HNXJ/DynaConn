function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.270425519357793e-02   +3.905946724979825e-01   +6.713810725565200e-01   +5.078882379105434e-01   +4.575037928531421e-01   +7.051173692513035e-01   +3.664329805409857e-01   +1.253206762905875e-01   +1.443728253522096e-01   +3.230248275258978e-01   +4.231762366639182e-01   +1.433711827344847e-01   +2.844425332948957e-01   +4.849041907216382e-01   +3.242671774743824e-01   +5.677746157376941e-02; +2.731984866397347e-01   +1.020160390946782e-02   +3.786180551742322e-01   +4.561292303276263e-01   +2.053673800447836e-01   +2.354342684192658e-01   +6.624120670163380e-01   +7.282657727203380e-01   +5.001651786049719e-01   +1.497721790552486e-01   +7.239611219886869e-01   +1.549810378351692e-01   +1.434820692875809e-01   +2.412874396812000e-02   +3.902564886956418e-01   +2.522974282076749e-02; +4.888905665974089e-01   +5.180401274346986e-01   +6.157986833598370e-01   +3.486802857592159e-01   +8.473049505761010e-02   +6.204692612987752e-01   +6.444881606168678e-01   +3.133741716800232e-01   +3.442581518780698e-01   +3.097632399066705e-01   +3.322208008348899e-01   +1.066254671151350e-01   +4.993100459635691e-02   +1.024799297777614e-01   +6.069359866432270e-01   +4.308245720970864e-01; +5.213043237910095e-03   +1.494922093962461e-02   +3.379188809907397e-01   +4.553990859489727e-01   +1.494274030986661e-01   +5.866185548695265e-01   +3.360343658201627e-01   +7.049997499848447e-01   +3.561370548256187e-01   +2.207080658747327e-01   +6.568700389131255e-01   +6.603499419281738e-01   +9.320082266311440e-02   +6.713524123884522e-01   +1.658544359966863e-01   +2.309127974226394e-01; +3.500643199598433e-01   +4.659166297651471e-01   +4.612065139894272e-01   +5.059289983152022e-01   +2.842016629526978e-01   +6.113217424497127e-01   +3.672305264011482e-01   +1.943503803416110e-01   +4.056760556505108e-01   +6.124915177193100e-01   +2.686337046333823e-01   +4.992603691049932e-01   +1.772496048132090e-01   +2.398231306132361e-01   +6.528489721336160e-01   +1.174557359009224e-01; +3.511621909711813e-01   +1.112760523994007e-01   +6.112375361871649e-01   +1.204574623515248e-01   +4.669748767033826e-01   +2.209245880239717e-01   +3.332531989163644e-01   +1.380104298518447e-01   +3.655538234993079e-01   +3.480477739961537e-01   +5.550688299021141e-01   +1.773503577094847e-01   +3.562560988448826e-01   +3.907955061008905e-01   +3.522834068714872e-01   +5.143441306451970e-01; +2.348367436494532e-01   +4.898966525116172e-01   +6.818978470845867e-01   +4.788125670231547e-01   +2.742867304677037e-01   +4.547070230649243e-01   +2.701055527371204e-01   +6.078844390178642e-01   +7.064689421246642e-01   +2.887986517691289e-01   +1.077528940996403e-01   +1.241958649044003e-01   +3.098297732188953e-01   +6.762405287595274e-01   +4.049776358178137e-02   +1.774585689172890e-01; +4.162095439212444e-01   +2.576785278977207e-01   +5.647272335704838e-01   +4.469658730929280e-01   +4.251409402335402e-01   +1.154424171031328e-01   +6.015973518398829e-02   +3.149187108357102e-01   +5.587091951617562e-01   +5.005540134383851e-01   +2.131953618216864e-01   +5.513293291720646e-01   +2.273726451688704e-01   +7.903815676749969e-02   +5.244405663359625e-01   +4.449600259362703e-01; +1.226390192927494e-02   +4.909938236965188e-01   +4.891184179614126e-01   +5.060766823280712e-01   +5.873550599475154e-02   +6.680694979086008e-01   +3.263011857664349e-01   +3.189571886018082e-01   +3.638359458247895e-01   +3.539197032519377e-01   +1.230913179566865e-01   +6.484373748351848e-01   +5.478801553285221e-03   +5.612844145251026e-01   +2.690860820644129e-01   +3.526418443392799e-01; +5.201793467263566e-01   +8.485908282405083e-02   +6.488233543132776e-01   +5.999083696442185e-01   +4.678170525301190e-01   +1.335184046965948e-01   +5.480166921271413e-02   +8.784383995537640e-03   +5.494715973828277e-01   +2.882612618964568e-01   +7.655729991606229e-02   +4.024668737502433e-01   +6.085992004199193e-01   +1.864088229141530e-01   +6.243988102481548e-01   +4.784810754399801e-01; +2.820435957734050e-01   +3.542407480905213e-01   +3.792293615601103e-01   +5.745697919114566e-01   +6.547671907674352e-01   +1.355775800840894e-01   +4.547278199743428e-01   +4.433119208180801e-01   +1.847352555064951e-01   +2.173722819984814e-01   +5.276179567767230e-01   +6.977055207158822e-01   +9.006912139299472e-02   +5.159888945215073e-01   +5.571808116787366e-01   +1.374782436161200e-01; +3.848288299916665e-01   +2.184939987335316e-01   +6.910708176660796e-02   -2.797451441209952e-04   +7.125143731288104e-01   +6.720457882439481e-01   +3.856861538204363e-02   +5.080494674383345e-01   +5.093356551257394e-01   +2.108627611868175e-01   +8.270680085196520e-02   +1.772584626913897e-02   +6.693837415277777e-01   +5.050831666109713e-02   +3.937044855490205e-01   +2.980176362854375e-01; +4.832564380468452e-01   +5.394628690680269e-01   +6.379802184125338e-01   +1.118098594717836e-01   +4.844430623452393e-01   +5.150094661159788e-01   +5.155200136447623e-01   +4.656702175312978e-01   +6.539907797697346e-01   +3.231286057603255e-01   +2.980792736659199e-01   +6.425023011591308e-01   +6.116360709639903e-01   +5.307097139606162e-01   +3.250250213857155e-01   +6.577817006468653e-01; +6.133949160778147e-01   +4.863139765248145e-01   +2.224711077512027e-01   +4.531623266396755e-01   +9.719530973352551e-02   +1.751320836354539e-01   +4.525501223280783e-02   +1.703737503834138e-01   +2.525536568704884e-01   +5.018469292881522e-01   +1.447028059629181e-01   +5.723503174876847e-01   +4.065505171402463e-01   +4.568992398786950e-01   +2.910235494886706e-01   +2.348577487755816e-01; +2.571823380831087e-02   +3.833722803124093e-01   +6.082185640269552e-01   +3.872680382783256e-01   +1.971072618133751e-01   +1.301785166052128e-01   +1.983064131780709e-01   +2.827349807748185e-01   +1.750679682861720e-01   +7.256467970367921e-01   +2.624861333526308e-01   +4.370239716745056e-02   +1.377393847412802e-01   +5.357576181376177e-01   +2.187693178410018e-02   +5.012435246890943e-01; +5.761142598509039e-01   +2.659920868666452e-01   +1.521600139787421e-01   +7.086469779452056e-01   +7.805511401429069e-02   +1.027945988849968e-01   +6.500938638357087e-01   +1.093851509492190e-01   +4.427547976059480e-01   +5.513173273310874e-01   +4.806415824217372e-01   +1.198273051236683e-01   +5.451738403155687e-01   +5.873862397019585e-01   +6.967048913224930e-01   +6.584600698194641e-01];
L1E_L1I_iGABA_netcon = [+3.887505263935364e-01   +4.725669687543524e-01   +4.904625249815054e-02   +2.401523988527118e-01   +6.030032007307427e-01   +2.885326505830447e-01   +2.662884852223826e-01   +1.722210616485228e-01   +6.175575209045901e-02   +2.788909380315838e-01   +2.737733419562544e-01   +4.287383334340583e-01   +2.368195272858840e-01   +6.548404263760225e-01   +1.519055757222126e-01   +3.843396439376979e-01; +1.072066548807821e-01   +6.695162982228327e-01   +3.755995966332115e-01   +6.411186773550785e-01   +3.304168877545511e-01   +3.098336142299292e-01   +1.025217391696261e-01   +3.741176525966145e-01   +3.482726018299532e-01   +1.117069292044168e-01   +1.560498243398926e-01   +5.093468411631633e-01   +3.484024720797598e-01   +5.303308661649923e-01   +3.609890394359307e-01   +5.270469684753095e-01; +4.542259787947481e-01   +7.188316131172254e-01   +5.680731120676457e-01   +4.629919385130071e-01   +8.688327713364347e-02   +4.303527357486317e-01   +4.708672209454297e-01   +6.297073696825680e-01   +6.371425278560681e-01   +6.899544108861863e-01   +4.787526047991176e-01   +3.536858096030698e-01   +7.069522042651855e-01   +6.124178519843193e-01   +3.188979273896668e-01   +4.039340541221767e-01; +3.740484423021876e-02   +1.041430527986798e-01   +6.655739762158187e-01   +3.200877028480124e-02   +1.369605072628730e-01   +5.264480827968865e-01   +5.272284985992571e-01   +4.101795811628605e-01   +3.666370831872447e-01   +7.029980211949213e-01   +4.681121338932826e-01   +6.008009478080534e-02   +2.607043415737539e-01   +1.352341275653842e-01   +7.654515392571427e-02   +7.129865509557216e-01; +1.254591168298139e-02   +6.395228833294160e-01   +3.787619156584295e-01   +6.644431683041864e-02   +3.057323996037471e-01   +6.231902837102953e-01   +5.142640243587943e-01   +2.812640159934633e-01   +6.165875232799238e-05   +1.157693700178254e-01   +5.271222883991408e-01   +8.973845737715472e-02   +5.972646171193245e-01   +3.423454262623089e-01   +4.864651148525446e-01   +3.997738839634266e-01; +5.712952704146792e-01   +6.833639123514959e-01   +1.138700452106694e-01   +4.953666669196573e-01   +2.621827889637283e-01   +1.321593654063007e-03   +5.056447043626344e-01   +2.155897391928339e-01   +5.962941784782906e-01   +1.253037320909993e-01   +6.888711295646016e-01   +9.804216302106081e-02   +2.784831981858648e-01   +9.876586246737946e-02   +3.847762521246446e-01   +1.054348261978220e-01; +3.639263603330856e-01   +1.662999528051018e-01   +9.520420379039513e-02   +1.897275637836534e-01   +1.382614647349886e-01   +2.779759554092346e-01   +2.141839182547828e-01   +3.914111951421296e-01   +6.435564163150409e-01   +1.122370670197684e-01   +5.479722829928594e-01   +7.269494658414605e-01   +7.273655876573980e-01   +3.803302384701808e-01   +3.763785500962943e-01   +2.224122812647480e-01; +2.096191406793844e-01   +1.566046274927909e-01   +1.236541156274562e-02   +1.176889918576198e-01   +5.279750373542628e-01   +3.816421205204808e-01   +3.593468189383266e-01   +4.571031180318968e-01   +1.441604072780845e-01   +3.034776604420158e-01   +5.965191681900516e-01   +6.935791518313575e-01   +3.817926996188444e-01   +3.309874959808431e-01   +1.277353381206081e-01   +5.090614972779040e-01; +2.126938902091117e-01   +4.417221970218758e-01   +2.189326883735910e-01   +1.406089406954278e-02   +1.292746168330536e-01   +5.133697180841120e-01   +5.836577505759475e-01   +6.588575447767749e-01   +2.741164682169093e-01   +7.702814841085005e-02   +5.552776800078417e-01   +2.559445107497089e-01   +6.474630332511763e-01   +6.762222458222654e-01   +4.410233141732843e-01   +5.068420178331200e-02; +3.599003385995531e-02   +2.979717884298736e-01   +1.071982115630824e-01   +4.216105299018809e-01   +2.966939275820830e-01   +6.038197069583213e-01   +2.273041435795397e-01   +1.649000931091332e-01   +6.813399252578435e-01   +5.622302049743438e-01   +1.673997570989197e-01   +4.498984066952218e-01   +5.623861036579628e-01   +1.359151286181894e-01   +5.611625598334424e-01   +1.624270150549027e-01; +6.328254317259779e-01   +6.230237699282478e-02   +2.188847818532183e-01   +2.911676457791850e-01   +3.825984296395770e-01   +4.791028696152133e-01   +3.307773953302762e-01   +6.966806567822352e-01   +2.342592939536679e-01   +3.003961245772753e-01   +4.216287431067298e-01   +3.462416736229787e-01   +1.881071857595785e-01   +7.130044178010314e-01   +6.451479968554138e-01   +2.466086453366411e-01; +1.363191215312942e-01   +6.610528221061703e-01   +4.069299326244915e-01   +6.711274896216430e-01   +7.242120322906433e-01   +4.928182298183751e-01   +3.365570500197413e-01   +1.080224120718693e-01   +5.311801113557175e-01   +3.318624038073215e-01   +2.556180615816794e-01   +6.042589931713152e-01   +4.922225522363472e-01   +3.623054983152647e-01   +5.795828456153440e-01   +1.813920540220759e-01; +5.321271792779257e-01   +6.485762994977008e-02   +3.830695732545635e-01   +8.726807932613805e-02   +3.931973017301359e-01   +4.135394605836575e-01   +4.301834668054251e-01   +1.533495662545020e-01   +5.468540175328745e-01   +6.452831751473720e-01   +1.273906841942948e-01   +5.646507412721848e-01   +7.027817855918250e-01   +4.517844928813268e-01   +2.683914126251839e-01   +9.737271858599239e-02; +1.854087566111852e-01   +1.867727047939632e-01   +1.686107442978216e-01   +6.912625366475596e-02   +1.339976207347298e-01   +6.318423584147324e-01   +6.739437220393268e-01   +5.517707113104120e-01   +3.121060239303234e-01   +4.771962540115851e-01   +7.159455828362279e-01   +5.347874454309266e-01   +4.559614932645892e-01   +6.374311241600665e-01   +4.690768488460239e-01   +5.365949465034101e-01; +3.189672758801292e-01   +1.201167468467513e-01   +3.213361937010064e-01   +6.427650411118593e-01   +4.660756557165554e-01   +3.706409076569127e-01   +8.053437989558562e-02   +2.525899952432278e-01   +1.210047952463692e-01   +3.703269263927045e-01   +1.926435849527429e-01   +3.225663078050214e-01   +2.804318696284414e-01   +1.695408624808710e-01   +1.286344103774883e-01   +2.251425120705762e-01; +3.208108237574799e-01   +5.595611222766339e-02   +1.376048260239165e-01   +6.793070256839505e-01   +6.820755652648274e-01   +5.315057269096041e-02   +1.425380607912025e-01   +5.907597239238966e-01   +5.833099536425346e-01   +1.015467303004086e-01   +3.886647578253979e-02   +4.548567353336335e-01   +4.780283988621198e-01   +3.810102388039453e-01   +2.936137176215519e-01   +3.309117911018674e-01];
L2I_L1I_iGABA_netcon = [+7.139155676973941e-01   +3.523086849959248e-01   +2.094935456750311e-01   +6.373841473892472e-01   +6.798148103157742e-01   +6.775447556732671e-01   +2.633760160031166e-01   +5.755145157438843e-01; +5.756503308622914e-01   +6.320587348014290e-01   +5.174555011900011e-01   +2.054354095579611e-01   +3.117655656329006e-01   +4.904387659094277e-01   +6.586160089241621e-01   +1.595919991595157e-01; +1.525069184431867e-01   +1.764498632639302e-01   +1.963112224829071e-01   +2.273788406227648e-02   +5.764026935364454e-01   +7.003720153053644e-01   +7.967852128339258e-02   +4.474714107468554e-01; +2.801506058138064e-01   +5.740579578953900e-01   +4.883557749711929e-01   +4.515518446125978e-01   +4.361820936364904e-01   +4.435420179707648e-01   +3.564955966552324e-01   +5.853091017244951e-01; +2.274554208231321e-01   +1.351687169036282e-01   +4.349704018171151e-01   +4.102088269814095e-01   +3.204134302296792e-01   +5.657063262610617e-01   +3.646897509136622e-01   +4.355499054730834e-01; +5.727751107451501e-01   +5.225765373612714e-01   +6.596706715417441e-01   +2.985521831025996e-01   +2.109654681964480e-01   +5.142291477878811e-01   +9.435975976917220e-03   +4.955322504877246e-01; +1.074826139241374e-01   +2.663128575838892e-01   +2.805851439450593e-01   +1.705320846446818e-01   +5.040153560890122e-01   +2.000447492031865e-01   +1.658864438137848e-01   +4.889583425945435e-01; +4.264069976129694e-01   +2.478576444957202e-01   +5.709878158575218e-01   +2.840495950423835e-01   +1.988374447236123e-01   +5.024096991699317e-01   +3.279096305778926e-01   +2.202375642063761e-01; +2.964468930727024e-01   +5.185580207837246e-01   +1.459112689680721e-01   +1.707335929537770e-01   +2.337806392990341e-01   +1.193434963902709e-01   +3.013618066207091e-01   +6.967201673271312e-01; +3.870475241531854e-01   +4.990854364412681e-01   +1.504521626949050e-01   +3.994812000062016e-01   +1.363381248568051e-02   +5.088866509596111e-01   +6.552060626994521e-01   +5.076369170130702e-01; +3.708530067084418e-01   +5.706271206806344e-01   +6.119880587705683e-01   +2.654399793429046e-01   +5.199510144658924e-01   +7.151110530467614e-01   +1.345829569529645e-01   +2.023959465394717e-01; +5.745440363742768e-01   +3.834284782540128e-01   +4.494693910765604e-01   +3.063547462202528e-01   +7.049024555738379e-01   +1.959669720084743e-01   +4.591282639955747e-01   +2.341926487913309e-01; +2.238548167364054e-01   +6.957536101491207e-01   +6.659545333330225e-01   +1.484085691680158e-01   +4.108192329787801e-01   +2.152019976575396e-01   +2.274930609932939e-01   +3.618737874179347e-01; +5.071152291811643e-01   +1.833292445998059e-01   +7.194975133740983e-01   +3.772484477106667e-01   +6.029807572656318e-01   +1.361317405330596e-01   +7.038786700450171e-01   +1.589450242168164e-01; +6.967274968109405e-01   +1.574258525957836e-01   +1.973145321033434e-01   +6.564617211807132e-01   +4.761312849084747e-01   +1.033231353250766e-01   +2.858338889141921e-01   +5.039973816455707e-01; +1.337228619949509e-01   +5.022809330909208e-01   +5.249321647362892e-01   +4.473623926734613e-01   +6.000262617747290e-01   +9.024564338203918e-02   +7.104936416665488e-01   +2.225201375514611e-01];
L1I_L2I_iGABA_netcon = [+4.108914174728429e-01   +4.987386376234482e-01   +2.252037509123420e-01   +5.173254359870885e-02   +3.679369168371347e-01   +2.885903508444838e-01   +7.149172245620744e-01   +4.977469006497408e-01   +2.954629456527819e-01   +5.676274218976974e-01   +1.062665157352834e-01   +2.242829738569406e-01   +9.119306427606608e-02   +3.725955093474405e-03   +1.492222523052804e-01   +5.718720716547618e-01; +5.795761506671360e-01   +4.303566833445504e-01   +2.718566093743405e-01   +3.354217919988523e-01   +6.720913039627426e-01   +3.313637428141613e-01   +4.895683028320969e-01   +6.991937102765122e-01   +3.136520179583609e-01   +7.192429539355586e-01   +4.812649523026400e-01   +2.553345676432020e-01   +3.576173867385660e-01   +4.524130882029930e-02   +2.751321665297222e-02   +6.398286255308064e-01; +6.176555871336492e-01   +4.243314843477847e-01   +1.570465406641627e-01   +5.936039397020660e-01   +2.409492264443671e-01   +6.334477477601056e-01   +5.509555090415321e-01   +4.807630797942715e-01   +2.753518461794913e-01   +2.619950493645172e-01   +4.940909596664533e-01   +2.895949422619077e-01   +2.431635621236085e-01   +1.176981300717445e-01   +4.456461210909469e-01   +9.191739017031558e-02; +3.076374095752294e-01   +3.878700849460936e-02   +4.345978874732846e-01   +6.326139441138021e-01   +7.706426073413483e-02   +3.945409399647595e-04   +2.553217281839192e-01   +2.455273780653211e-01   +4.238991989081155e-02   +4.671957914253529e-01   +4.049427532443746e-01   +3.407948006172633e-01   +1.807288908341681e-01   +3.657783013539904e-02   +5.790102507197838e-01   +3.805127083350630e-01; +5.959699817742416e-02   +5.901274473485809e-01   +5.735895300015582e-01   +4.881158373585665e-01   +4.559570188528834e-01   +3.573975943427206e-01   +4.620000867691875e-01   +6.039984156992941e-01   +4.486284655125503e-01   +1.443777704453843e-02   +2.259644506334930e-01   +1.682824269553305e-02   +1.817155107241774e-01   +6.342504804161379e-01   +1.478205589204764e-01   +3.436194633906923e-01; +4.623984140335490e-01   +5.137148810189515e-01   +9.438350488385583e-02   +6.490483700929556e-01   +4.055054234981920e-01   +7.003808526067142e-01   +5.307341368142804e-01   +5.972540568301520e-01   +4.003967703497676e-01   +4.217461876822594e-01   +7.240006713667799e-01   +5.978038383721362e-01   +9.701931996844565e-02   +6.609736323459335e-01   +5.168115922175447e-01   +6.607484160698565e-01; +5.594591443577472e-01   +1.104327757495587e-01   +6.256571364358696e-01   +7.175496124496282e-01   +2.773674623305649e-01   +7.106955464069322e-01   +3.678879950125356e-01   +3.428587007285437e-01   +1.099925624050315e-02   +4.275900113505273e-01   +2.241169724480746e-01   +2.558194076647609e-01   +5.655421287430417e-01   +3.052655483017990e-01   +6.150923096064188e-01   +4.143775446832590e-01; +5.398855232584225e-01   +8.049852717117326e-02   +6.521964308154604e-01   +5.183312821051658e-01   +8.544988950940154e-02   +5.765012264341531e-01   +4.275348418197942e-01   +5.601778599797717e-01   +2.660758000865895e-01   +6.171297302215414e-01   +1.888177804849789e-01   +3.583013496854571e-01   +3.612475367109981e-01   +5.285856963273792e-02   +6.734536873691072e-01   +3.480955199681184e-03];
L2E_L1E_iAMPA_netcon = [+5.661701043592688e-01   +2.067957337342640e-01   +1.067742355269771e-01   +7.132790231298961e-01   +6.710196017256858e-03   +3.539760414013127e-01   +4.805062260057615e-01   +5.964763982872055e-02; +6.704170494155661e-01   +6.334141950483260e-01   +3.873382280671911e-01   +2.690671621490758e-01   +3.662502656290758e-01   +1.304108540436822e-01   +6.637178086751166e-01   +2.896299387121196e-01; +6.157184916801806e-02   +9.511503249690720e-02   +2.401920140829636e-01   +1.137793303110896e-01   +4.533245059952311e-01   +6.172157895382783e-01   +2.431937090667395e-01   +2.296986646805654e-01; +1.885843076660216e-01   +5.275482932865525e-01   +1.559736758282378e-01   +4.746311076465356e-01   +5.491867396660886e-01   +2.295439277571615e-01   +6.417165905038144e-01   +6.036423282107821e-01; +1.442071237004899e-01   +7.178192463338525e-01   +1.018547202132359e-01   +2.222093043012843e-02   +6.873723342141946e-01   +6.923496361441949e-01   +4.952791464158657e-01   +3.407489124994983e-01; +5.085708284518927e-01   +3.753219545922603e-01   +6.945567463561507e-01   +5.649583626252670e-01   +5.102793675284616e-01   +1.608518216131814e-01   +5.809229217972471e-01   +5.032856497291263e-01; +7.932369445951962e-02   +2.418862048206836e-01   +2.132899612578289e-01   +3.338535894159709e-01   +6.720856316485645e-01   +3.380915643636112e-01   +1.135360031249595e-01   +2.505839345456800e-01; +4.896364242094450e-02   +9.095619079266887e-02   +3.842557875095934e-01   +4.921892080890387e-01   +2.906560503351727e-01   +6.595331819387602e-01   +7.082320840964654e-01   +6.662840688076384e-01; +2.576207777559226e-01   +6.429686687929158e-01   +3.112961465587815e-02   +1.973672268206201e-01   +1.190513046196685e-01   +7.013403590118231e-01   +3.822398783865770e-01   +5.069260964770030e-02; +2.170686556310298e-01   +2.031162620593092e-01   +6.267156127160086e-01   +2.985925913926620e-01   +5.968670771891132e-01   +6.438308031598748e-02   +9.191768996890530e-02   +7.007050886880029e-01; +4.142834265376673e-01   +3.422047062099234e-01   +1.326594393366008e-01   +4.426773498701753e-01   +2.977521444165487e-01   +3.019474374581061e-01   +4.262105271552066e-01   +6.530710236501731e-01; +1.939105291832349e-01   +3.299946067759846e-01   +5.961308305870763e-01   +5.346728398951844e-01   +4.690571279693832e-01   +1.403952316784092e-01   +7.245026123676648e-01   +1.704560741286410e-01; +4.371003962170646e-01   +6.035984989516994e-01   +1.763028830152015e-01   +4.204186289465611e-02   +7.124294978889549e-01   +4.875493959050646e-01   +3.353281865557408e-01   +5.889836440105582e-01; +3.072824330285325e-01   +3.906233536027891e-02   +8.337584215141372e-02   +4.852713151230817e-01   +6.762363794260264e-02   +2.176932648594917e-01   +5.748614365747063e-02   +5.362864938344079e-01; +2.060189813560329e-01   +1.531421887386104e-01   +4.914448064141230e-02   +5.533695820297245e-01   +8.532691041996815e-02   +6.724620995472333e-02   +3.011921811672272e-01   +1.742019218196560e-01; +1.068942305664109e-01   +3.199192652455812e-01   +1.037954249886296e-01   +3.949057904256836e-01   +1.830915296454082e-01   +3.991140823973298e-01   +7.795174198446331e-02   +5.968124766883770e-01];
L1E_L2E_iAMPA_netcon = [+2.695149338728873e-01   +1.126237010662579e-01   +6.793507689127721e-01   +7.061054033176150e-01   +2.418178048863888e-01   +6.890300731397810e-01   +3.681571405654345e-01   +7.215471064939658e-01   +9.957037086027999e-02   +4.743154838567430e-01   +4.684073328781911e-01   +5.553056964214093e-01   +2.730981186141757e-01   +4.969847816686660e-01   +4.098495645467076e-01   +3.609188462888920e-01; +2.858770180026580e-01   +3.789603216643505e-01   +1.571850600997994e-01   +6.503347974760734e-02   +4.920464657835964e-02   +5.001665810690004e-01   +6.354635275816201e-02   +2.293454636498654e-01   +1.502074409979970e-01   +2.297728264269197e-01   +1.996441494398931e-01   +6.921505118149197e-01   +1.024050960773735e-01   +2.076665535677721e-01   +4.287518575460165e-01   +1.787911673840943e-01; +2.380530679246321e-01   +4.363775051694307e-01   +6.585216636550150e-01   +6.763428087352703e-01   +6.914512824407801e-01   +7.947626155809481e-02   +2.124149080242739e-01   +3.970219895037296e-02   +3.221337703417065e-01   +4.209118290984052e-01   +2.468989858065852e-01   +7.853847794701953e-02   +5.488132071974477e-01   +4.362561110149669e-01   +6.495464372655363e-01   +5.463985654114278e-02; +5.759647576723353e-01   +2.145727985625078e-02   +1.645558274227990e-01   +1.587331447394023e-01   +5.339798315595057e-01   +2.333455590713792e-01   +6.612930150659079e-01   +6.541146434972110e-01   +5.677741197610546e-01   +5.550682026448881e-01   +3.425873509119628e-01   +4.087309843722521e-01   +6.835057319604052e-01   +2.443053748941595e-01   +6.658694243993689e-01   +7.076922420937884e-01; +9.425426046553932e-02   +6.257846983109189e-01   +6.327171119170493e-01   +2.233768133637758e-02   +1.152076506451019e-01   +5.873331586801112e-01   +6.813112888620113e-01   +1.337981110011157e-01   +4.146437745124708e-01   +3.023132136551921e-01   +4.028093769640624e-01   +5.637902852526542e-01   +1.724593524108709e-01   +3.796860857417597e-01   +7.213488992568851e-01   +3.257817194470649e-02; +2.602447854379882e-02   +6.154088413491557e-01   +1.925714238835419e-01   +5.889790763503581e-01   +7.026329153984652e-01   +6.176746132674159e-01   +3.797363294699332e-01   +6.790742284013678e-01   +2.365054945884268e-01   +2.939714512889385e-01   +6.144052100991799e-01   +6.682700848268888e-01   +6.201904945501361e-01   +4.554678415989593e-01   +1.396468845353070e-01   +4.211647442656835e-01; +2.297268656945149e-01   +1.632331663068297e-01   +4.284263171551552e-01   +1.233504891294962e-03   +2.815735319982439e-01   +3.821178266175518e-01   +5.447491018919596e-01   +4.302953123103551e-01   +4.232382429076853e-01   +5.716000800254530e-01   +4.607717571023202e-01   +7.487198339690970e-02   +2.638637666055180e-01   +3.989031473962759e-01   +1.754943013547932e-01   +2.522153522254976e-01; +6.354801244680890e-02   +3.985594711977086e-01   +3.599154343107595e-01   +2.870677804211765e-01   +5.281934281906667e-01   +7.016413272010983e-01   +7.195709792889731e-01   +4.613349524924926e-01   +6.391612662404125e-01   +2.906947460737445e-01   +2.520548824380963e-01   +7.195786051221258e-01   +4.873174900275101e-01   +6.575897633233343e-01   +2.451677302178466e-01   +7.654533495957290e-02];
L2I_L2E_iAMPA_netcon = [+4.540703772610584e-01   +1.718412516146147e-01   +6.564556886143714e-01   +3.459166560048719e-01   +5.698368445346441e-01   +3.359323711472426e-02   +6.626335357366855e-03   +6.559937326539236e-01; +1.141904445738514e-01   +9.213622768174673e-02   +1.160205532262346e-01   +6.238886071924753e-01   +5.531146607347309e-01   +2.910026858223257e-01   +5.125721975729221e-01   +3.502331107553543e-01; +6.139866803386361e-01   +5.487613157161138e-01   +6.105996839676695e-01   +5.398883158879761e-01   +3.795914800921718e-01   +3.765135798090458e-01   +3.695116523038841e-01   +5.152354805768572e-01; +2.886073244510751e-01   +1.276670411054789e-01   +6.458488636552669e-01   +3.120495281604069e-01   +6.986490185822104e-01   +1.124102602113232e-01   +3.380459869308265e-01   +6.275836458512386e-01; +5.149946308399476e-01   +6.279728744091145e-01   +4.652432095098173e-01   +4.454683444852344e-01   +6.739562953154742e-01   +5.416062381622652e-01   +3.069747575306281e-01   +5.457577076911714e-01; +4.404824694840055e-01   +2.863442992071513e-02   +6.506721501018150e-01   +5.422429203703779e-01   +3.927827533004911e-01   +1.320029393793258e-01   +7.850256606894540e-02   +5.364030470288357e-01; +6.960114439398812e-01   +3.340932440223238e-01   +1.215442148258410e-01   +3.555763396736178e-02   +1.016398225511942e-01   +1.606677174161531e-01   +1.075790933290004e-01   +1.295689638801128e-01; +6.635781314282094e-01   +2.537050010179789e-01   +4.022999137612676e-01   +3.571701029494084e-01   +6.360563713837508e-01   +1.752097565729878e-01   +9.165364689651283e-02   +1.683405942558237e-02];
L2E_L2I_iGABA_netcon = [+6.761664122119257e-01   +1.747849389771967e-01   +1.487862444882796e-01   +1.392417493199965e-01   +4.877445040640992e-01   +2.722129433603706e-01   +6.011456623017483e-01   +6.895861631296596e-01; +1.846334947301385e-01   +3.123737147264650e-01   +9.138408279767832e-02   +9.376505790575322e-03   +7.214424799617724e-01   +5.070236301896162e-01   +5.596976015041062e-01   +5.181094517678624e-02; +4.757992859216562e-01   +2.624095678264567e-01   +4.003771354880971e-01   +3.325504513545923e-02   +2.822939847524558e-01   +5.837802765893759e-02   +7.213384201356612e-01   +6.073229901320826e-01; +6.295516431837761e-01   +4.918716453635093e-02   +1.847289150629721e-01   +5.406064846059646e-01   +6.699375591177967e-01   +4.725114505000455e-01   +3.141694425150705e-01   +4.855910641442554e-01; +1.165075969793945e-01   +6.605448570946453e-01   +4.533556135911718e-02   +6.155573887198096e-01   +2.237966823567851e-01   +2.680006706659655e-01   +2.815439040479088e-02   +1.969627840957919e-01; +5.491369267804771e-01   +1.114966878825573e-02   +3.987313017107250e-01   +5.787940749765819e-01   +6.474263327407936e-01   +1.940170678743742e-01   +6.965256160820790e-01   +5.712457159762714e-01; +1.171361136971015e-01   +7.120765965225325e-01   +2.109583699180479e-01   +2.167076016445419e-02   +5.252071866907992e-01   +3.828719829442443e-01   +4.415073336467201e-01   +4.497891632420511e-01; +6.337316914392924e-01   +2.254439452426063e-01   +3.626314459502900e-01   +1.519226850603134e-01   +3.420588024543586e-01   +5.719222896943407e-01   +6.911407314944744e-01   +4.431072883181645e-01];
L3E_L2E_iAMPA_netcon = [+2.581577505543265e-01   +4.631944292845689e-01   +1.123393855506224e-01   +6.063283517193718e-02   +6.739992829960594e-03   +7.147353066529619e-01   +2.872593434749226e-01   +6.305720922969771e-01   +8.563003333241498e-02   +2.153699271595081e-01   +2.139974373392866e-01   +3.494960643246888e-02; +1.914821086529252e-01   +6.484847578781852e-01   +2.129285216236544e-01   +2.725725961488366e-01   +3.364368131257305e-01   +4.091098510133540e-01   +6.696214772783660e-01   +7.196900663954575e-01   +4.072131688526258e-01   +7.043541242416478e-01   +2.599190153750937e-01   +1.870285452567349e-01; +7.273780071225219e-02   +5.401682270963629e-01   +7.786732954223824e-02   +5.354079120198566e-01   +2.394002053462027e-04   +2.907244441692642e-04   +3.928904922624841e-01   +7.165215369520934e-01   +4.316962578840879e-01   +4.452893883985391e-01   +1.816000610438091e-01   +5.173595930272622e-01; +2.292069531548898e-02   +1.467951633502159e-01   +5.922572401014178e-01   +1.886864140924769e-01   +2.001134459086694e-01   +1.046109305342240e-02   +2.449485781667254e-01   +4.945250988923540e-02   +1.572360670645485e-01   +2.284278415135813e-01   +1.440824402151052e-01   +2.416098371783366e-01; +6.580991995643062e-01   +2.703107573871380e-01   +2.496951567824632e-01   +7.235359003890349e-01   +4.929485934936676e-01   +2.707172642970472e-01   +7.115800904229385e-01   +1.202030141151400e-01   +6.134349693360756e-01   +3.542129414071751e-01   +4.974978977433223e-01   +2.944393850189697e-01; +6.432121806187386e-01   +4.322874447559684e-01   +7.865040736464787e-02   +3.606666401419489e-01   +4.633219944196113e-01   +6.592720823342985e-01   +6.478258684293265e-01   +2.785056099698002e-01   +3.369022673468983e-01   +1.353783501389736e-02   +4.606698273728126e-01   +1.847725548527396e-01; +4.537431075160303e-01   +3.727153616046857e-01   +4.576030892672771e-01   +1.506338563646369e-01   +4.462089920970466e-02   +2.629341758492243e-01   +7.818842095733032e-03   +2.518377518768127e-01   +2.053209551254015e-01   +7.837548372426417e-02   +5.563523186631942e-03   +3.391253513858600e-01; +6.144686713389805e-01   +7.077723004426385e-02   +5.387356037250168e-03   +1.920554656701633e-01   +4.044668649362392e-01   +6.507033841770375e-02   +2.235283570467377e-02   +3.550376359292165e-01   +3.605234589418660e-01   +6.250930127374659e-01   +6.159257341207217e-02   +4.470143186990905e-01];
L3I_L2I_iGABA_netcon = [+7.107954335292934e-01   +3.668228343508798e-01   +4.725472376537303e-01   +2.004615816339684e-01   +6.923817823837795e-01   +3.253414300223844e-01   +3.537398529418982e-02   +1.621803505489519e-02   +6.373416539674370e-01   +3.296072827370801e-01   +6.330953520324274e-02   +5.412454697696952e-01; +6.538380901802847e-01   +7.038005259350246e-01   +6.526708691238037e-01   +1.209269493563063e-01   +3.753553040906048e-01   +6.099594059281166e-01   +4.285759849425200e-02   +1.524793074837812e-01   +3.607108956585259e-01   +4.814905601625831e-01   +8.773961168934462e-02   +4.719370778995255e-01; +7.531566532946352e-02   +6.254261904493703e-01   +6.548415120762074e-01   +6.221446214310610e-03   +5.178265122824345e-01   +1.788797721373820e-03   +4.512012720952497e-01   +6.746945128677598e-01   +5.290490566021914e-01   +1.667161536170278e-02   +4.282576775443444e-01   +8.406507729411351e-02; +6.998020708150162e-01   +1.783575278518514e-02   +2.473382628569446e-02   +4.725469663782241e-01   +6.522463191960768e-01   +4.048613416189459e-01   +2.518324453700220e-02   +1.335208510133761e-02   +6.298220436407420e-01   +6.017749404386199e-01   +7.231306445269586e-01   +4.000148825686541e-01; +1.131933479031913e-01   +7.015574243316517e-01   +3.015575469251437e-01   +3.105266360163721e-01   +4.143118217157553e-01   +6.718559614761723e-01   +2.816009436844108e-01   +1.263221131857714e-01   +7.281851653769759e-01   +3.628522537025785e-01   +1.635097058776789e-01   +1.252828358029543e-01; +2.674206821541746e-02   +5.003011238346045e-01   +1.535073763024543e-01   +9.053091727034102e-03   +1.231159629186665e-01   +4.711537707821174e-01   +5.048782337482239e-01   +1.738937418676769e-01   +3.819360419653145e-02   +5.565318764882897e-01   +6.289777184810854e-01   +5.902788469421893e-02; +4.585881262572195e-01   +6.404605454285737e-01   +4.243555885258290e-01   +4.717880687858946e-01   +3.291162661585248e-01   +2.239995922556178e-01   +5.132499281535753e-01   +5.940735262166218e-03   +6.067712545402503e-01   +2.776612866395156e-01   +3.683563573601369e-01   +5.256357309216020e-01; +3.573256257531904e-01   +1.507668008399796e-01   +2.234299616040982e-01   +4.225773580646034e-01   +2.571236180350756e-01   +1.044246701420725e-01   +1.654105875597662e-01   +1.973424344651297e-01   +3.998633899719794e-01   +7.150336707985951e-01   +2.017740748169102e-01   +2.140305455756157e-01];
L2E_L3E_iAMPA_netcon = [+4.910161620114389e-01   +4.825371453370130e-01   +1.675675887624680e-01   +6.360372942605281e-01   +3.446575862502424e-02   +3.758668301030151e-01   +4.923342389528173e-01   +6.818883916968479e-01; +3.906448944236643e-01   +5.325842644190232e-01   +5.386574751008945e-01   +5.855298011341159e-01   +7.839316030945880e-02   +3.635286415713933e-01   +6.254913593958950e-01   +5.017034789051621e-01; +6.212842228939395e-01   +6.423876146974502e-01   +6.179827454615155e-01   +6.625195672244915e-01   +4.270442064903334e-01   +4.758425293862910e-01   +6.314508743310628e-01   +4.208792645775483e-01; +2.992079898313930e-01   +6.988477816801989e-01   +6.230712698987786e-01   +4.472201614299194e-01   +3.784682935571085e-01   +3.624433560572023e-01   +2.070444882244947e-01   +1.347833853066186e-01; +1.061750862080574e-01   +3.992185384054902e-01   +1.794245009998503e-01   +6.079601080818176e-02   +1.308643930788767e-01   +3.978127388093208e-01   +6.467943298934984e-01   +5.557832088213229e-01; +3.638605559228851e-01   +7.144580601384614e-01   +6.490842660050883e-01   +3.918555581883176e-01   +3.758583356777534e-01   +7.164088091164597e-01   +5.209962872950927e-01   +7.158846264321422e-01; +3.509299221498764e-01   +7.320617525111327e-02   +3.920533438370782e-01   +1.979886285643836e-02   +2.606892463646232e-01   +5.946358977190772e-01   +2.524873642670428e-01   +5.646574866591081e-01; +6.822105862818729e-01   +5.064203718085479e-01   +3.111254230637151e-01   +5.662961991590433e-01   +2.543155441226389e-01   +5.619664013859227e-01   +3.770217186136205e-01   +3.172380126672120e-01; +3.409291093326112e-01   +4.007627336267933e-01   +6.437072785395975e-01   +4.607122139746790e-01   +4.178286380702579e-01   +2.511969113895443e-01   +4.430059501291023e-01   +4.797556964108109e-01; +2.047895382605064e-01   +1.159633454609462e-01   +5.709789053339183e-01   +6.378307649568873e-01   +6.563256337838024e-01   +1.771841456591173e-02   +9.505283956692023e-02   +4.766513918261724e-01; +4.203645148496525e-01   +2.331707215735619e-01   +5.369155000863703e-01   +5.921325695976440e-01   +6.812448712790294e-01   +6.976059607630903e-01   +1.947439155886037e-01   +2.714305029791416e-01; +6.553567899104278e-02   +4.237291649514585e-01   +3.035576699486457e-01   +6.296000601075423e-01   +3.593318787465418e-01   +1.479793693318513e-01   +4.827624056820246e-01   +6.220946650320557e-01];
L2I_L3I_iGABA_netcon = [+6.891490844778471e-01   +2.885730194349084e-01   +2.061785012257380e-01   +5.147564619933723e-01   +5.367215605484636e-01   +6.116935026815613e-01   +2.903243671669233e-02   +3.759731797830600e-01; +4.046684839402074e-01   +3.471735591424005e-01   +5.152150100918333e-01   +1.224405336271856e-01   +6.439902574349459e-01   +5.998814808037808e-01   +3.420943040367341e-01   +1.857437378417876e-01; +5.718197047698022e-01   +5.349892951566360e-01   +6.842010797711886e-01   +4.611003377087532e-01   +2.620863039258742e-01   +4.451463896244150e-01   +2.949438033467697e-01   +1.238342272401271e-01; +1.568921456805868e-01   +6.118033768213407e-01   +1.563117954594156e-01   +3.636690341610221e-01   +2.399778063090971e-02   +2.665067247621319e-01   +2.700412585739719e-01   +7.133189086533870e-01; +2.257818029040816e-01   +2.833103318786890e-01   +3.847990807515541e-01   +3.492392388403563e-01   +2.621256540440821e-01   +4.753217323181690e-01   +7.042640876429657e-02   +9.494202276570501e-02; +6.015840807042944e-03   +1.818936133189659e-01   +3.186943689146050e-01   +1.305935854801206e-01   +2.659031179924299e-01   +2.890394518567349e-01   +3.843314705768181e-01   +5.127175003529956e-01; +2.607040286021664e-01   +3.477884461483419e-01   +6.825397235060047e-01   +4.671702434928493e-01   +5.327391875863725e-01   +2.218156690656866e-01   +2.323290974857610e-01   +2.206439741627524e-01; +2.721639141114127e-02   +7.212445672962784e-01   +2.268505150597107e-01   +6.432337834255046e-01   +4.533265368695033e-03   +5.501868912947877e-01   +4.144992317773679e-01   +5.527431503666054e-01; +6.458071839568373e-01   +2.144380253050036e-01   +6.104640574583017e-01   +4.865573151113112e-02   +3.604275752168599e-01   +1.926088144875219e-01   +3.003509427997784e-01   +3.282423144507191e-01; +5.653696612199343e-01   +3.600204815961690e-01   +1.777586452895946e-01   +3.636057262478122e-01   +4.565683075013838e-01   +2.509910424936682e-01   +1.553319533980750e-01   +2.234613744669091e-01; +5.264852073739512e-01   +7.037887055130557e-01   +3.928972257517425e-01   +4.995386570564500e-01   +2.117975756620973e-01   +2.551083576886969e-01   +6.901223947985415e-01   +9.057166121946322e-02; +5.576647668756599e-01   +4.548736710783757e-03   +2.467767656749242e-01   +1.086568312512759e-01   +1.059084393356826e-01   +7.052548004456731e-01   +3.570887503530948e-01   +4.028205744081313e-01];
L3I_L3E_iAMPA_netcon = [+3.275088168548838e-01   +7.257313615268091e-01   +2.033091716917886e-01   +4.482874115058124e-01   +5.672924614773637e-01   +2.322192678843507e-01   +2.110272850993945e-01   +1.660930203995661e-01   +2.427411821362672e-01   +2.074516937664965e-01   +1.963714818533140e-01   +3.320028868240330e-02; +2.954836219413171e-01   +6.260248879287672e-01   +1.636604817758507e-01   +9.759477034775639e-02   +5.908333603122787e-02   +3.912574448159540e-01   +4.068985931540264e-01   +4.025201565135282e-01   +1.657751338760264e-01   +3.550263476479810e-01   +5.498340064372542e-01   +4.122203030655274e-01; +2.403806812445608e-02   +4.547650698675934e-01   +3.298507325894159e-01   +4.317836296225916e-01   +3.571710578341714e-01   +3.334910991398056e-01   +3.644706191749852e-01   +3.374211874942313e-01   +2.490566393387528e-01   +4.195861879215487e-01   +3.369050116893208e-01   +4.069870500025198e-01; +2.882434488442228e-01   +5.402609974593897e-01   +4.552839857825161e-01   +3.084227115280124e-01   +3.258344368152870e-01   +6.542967061157542e-01   +5.605597250613794e-01   +8.665877975690831e-02   +6.698692773238490e-01   +6.625805202953329e-01   +1.237395059205888e-01   +5.386190898946669e-01; +7.703747093509089e-02   +2.381221355437894e-01   +2.443636691463572e-02   +6.326331778845373e-01   +5.563439779948297e-01   +4.019787421876422e-01   +6.926018489160745e-01   +3.645963609286986e-02   +6.444717750768564e-01   +4.152679949356674e-01   +2.753439263674818e-01   +7.913650919664142e-02; +2.432087920047169e-01   +4.827061704084840e-01   +6.055152668566148e-01   +3.139544169974159e-01   +7.173601124998176e-01   +2.251231800972365e-02   +6.592636473683710e-01   +1.806098994590346e-01   +4.944751500085521e-01   +1.840582513887350e-02   +2.520744766943027e-01   +1.082903208895105e-01; +5.987505779651138e-01   +2.724016366915665e-01   +2.880994921802221e-01   +2.070737348560489e-01   +4.864814680804838e-01   +1.405928985039118e-01   +4.147849992073582e-01   +6.730439807945915e-01   +6.117771574307684e-01   +7.153094292908564e-01   +3.821231660768804e-01   +5.184475352956575e-01; +5.307816099966282e-01   +1.549419029097897e-01   +5.295075955978985e-01   +4.315217060621773e-01   +7.175173311799549e-01   +4.307838196419345e-01   +7.053540119004478e-02   +3.529134892451897e-01   +3.108494093660291e-01   +2.120395485772203e-01   +1.787646304265900e-01   +6.991287044515493e-01; +6.843980283273575e-02   +6.163129100234654e-01   +5.382310259435600e-01   +5.890514354783809e-01   +2.731139562197666e-01   +5.260857385603235e-01   +1.326412972657073e-01   +5.677492068410065e-01   +6.082988998271454e-01   +3.346281114518557e-01   +1.553912597494004e-01   +1.752207842886315e-01; +6.713936410025234e-01   +5.662768646618350e-01   +2.949190573701180e-01   +1.745658210523528e-01   +4.142151734877381e-01   +5.645775000616450e-01   +3.651852273983863e-01   +6.371141059162897e-01   +4.830069379675617e-01   +2.523232622186368e-01   +6.457121815395219e-01   +1.566510350712318e-01; +3.276363448382559e-01   +2.525334493206375e-01   +7.157512181050349e-01   +6.891153128794633e-01   +7.876650340390463e-03   +4.522438007514948e-01   +5.965625233039221e-02   +1.859899059709129e-01   +2.739553555218615e-02   +6.979790042798517e-01   +5.631317412258042e-01   +2.607095566011817e-01; +8.008568219997922e-02   +1.300501859678525e-01   +1.906485574580912e-02   +3.323831953898888e-01   +3.178682485253986e-01   +1.738031575007739e-01   +5.726807069345032e-01   +1.495857579736361e-01   +2.350102674301654e-01   +1.812900901489371e-01   +5.696255995124971e-01   +1.955729884064354e-01];
L3E_L3I_iGABA_netcon = [+1.447139433106253e-01   +3.284943929742640e-01   +2.420707646203257e-01   +6.717132682181133e-01   +5.985276434404960e-01   +4.030153800270290e-01   +2.241357972212396e-01   +5.553306606212556e-01   +4.694291001194194e-01   +5.405660658202476e-01   +4.323085968706047e-01   +1.673179091155327e-01; +5.687842606628460e-01   +4.594974883873353e-01   +2.158981688103301e-01   +1.806380926865820e-02   +2.720725652270347e-01   +5.124480756697737e-01   +4.862013111664891e-01   +7.110192196256492e-01   +6.243031273436049e-01   +3.250008053248562e-01   +8.881466971497487e-02   +1.990866623838031e-03; +4.314413078978332e-01   +7.046252240224452e-01   +6.911669716771732e-01   +6.130668592396427e-01   +1.928426210981267e-03   +5.459187635775243e-01   +4.283114592478358e-01   +5.070755988112448e-01   +3.084873245086079e-01   +3.040083321177093e-01   +2.093439714728000e-01   +1.074491328660560e-01; +2.978837031868982e-01   +1.702162652675543e-03   +9.904273975067551e-02   +5.286483226659850e-01   +5.296076682489306e-01   +1.915928952760730e-01   +3.055982333992350e-01   +2.693140544827322e-01   +7.243321313047703e-01   +3.475111812619379e-01   +3.442473707270911e-02   +4.378282176797230e-01; +3.058976338515218e-01   +2.846947194332115e-01   +7.267771454721305e-01   +1.985504430657237e-01   +3.943201490744773e-01   +5.612698550260465e-01   +7.039210406702897e-01   +6.747377362133117e-01   +1.899918691726304e-01   +4.101047877939957e-01   +6.077749704738202e-01   +4.072269707332210e-02; +4.979106408312814e-01   +3.475533964326370e-01   +6.120202165949443e-01   +6.200579644446674e-02   +3.190275489798705e-02   +7.170352780710696e-01   +6.605319595992686e-02   +4.431284636634367e-02   +5.998856319999868e-01   +4.408457063862126e-01   +2.057219191752586e-01   +1.588237926995254e-01; +4.294903106874230e-01   +2.625486134583517e-01   +3.478074665797112e-01   +4.418499837499121e-01   +5.004537309890975e-01   +3.487934121859506e-01   +2.531287620880673e-01   +1.344367650076844e-02   +2.368211614810667e-01   +1.190455950220304e-01   +2.209864107143221e-01   +5.321670236484967e-01; +2.181074561321403e-01   +1.281462874741097e-01   +8.998861571102165e-02   +6.676812411234723e-01   +3.082189673668163e-01   +5.430624854632821e-01   +3.786801759286585e-01   +5.579135143793297e-01   +5.615639638085527e-01   +6.256593474098017e-01   +1.145810225578774e-01   +4.320108107472987e-01; +2.041909237408124e-01   +1.348583468538460e-01   +5.672832718324224e-01   +3.641572415759925e-02   +6.839706355889956e-01   +6.623613820025922e-01   +1.369917580709775e-01   +5.243742380617493e-01   +1.734143349577090e-01   +3.035627368035625e-01   +3.149755544041169e-01   +4.556836811159953e-01; +6.006906931792199e-01   +2.309380874987809e-01   +6.203623379498415e-01   +2.398586861992282e-01   +2.592910400779567e-01   +7.090400962018498e-01   +5.497138236414036e-01   +4.123532775340062e-01   +6.853860220158771e-01   +7.117033703157301e-01   +1.195006953294900e-01   +2.907834367315878e-02; +4.031985774443463e-01   +9.393225982345157e-02   +1.587920050456730e-01   +1.391433053770545e-01   +5.729936230622330e-01   +3.638193747503685e-01   +6.175182340110315e-01   +4.489014056622446e-01   +4.098032461488715e-01   +1.226166558977574e-01   +6.830020744606734e-02   +5.901325975061186e-01; +4.682249374450794e-01   +3.788764042628430e-01   +7.261861739633466e-01   +5.331228179940550e-01   +1.647503033717304e-02   +3.807432600760192e-01   +7.163474068603546e-01   +4.623834087357930e-02   +5.767248424319222e-01   +2.947429070251056e-01   +3.372015826059462e-01   +3.220137554517537e-01];
L2E_Input1_iAMPA_netcon = [+7.249034542498036e-01   +7.262949155875483e-01   +7.274856616937310e-01   +7.316687865803968e-01   +7.295909028490124e-01   +7.297101759966901e-01   +7.295358348354776e-01   +7.286583031675231e-01];
L2I_Input2_iAMPA_netcon = [+7.273430682201903e-01   +7.291269992540654e-01   +7.274751574527200e-01   +7.272712206981263e-01   +7.297208502211969e-01   +7.306297651826672e-01   +7.276998081745886e-01   +7.274665055485395e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
