function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.979387395250597e-01   -2.709171892525659e-01   +3.654646504997031e-01   +3.483669696629516e-01   -6.048287802860076e-04   +1.991022690432325e-02   -6.582635661337237e-01   +2.611276082818077e-01   +6.135844134059024e-01   +6.264336977151577e-01   +3.677442190987705e-01   +4.648584969118417e-01   +2.581345149780235e-01   -1.578695043185372e-01   -3.223741462284661e-01   +1.415437111136870e-01; +4.393867899365027e-01   +1.644849182716648e-01   +6.943266254082631e-02   +5.872883642532250e-02   -2.127102317699051e-01   +6.096131401070135e-01   -5.692544389638055e-01   +2.888057193694259e-02   +5.851765005769711e-01   +4.749918008536018e-02   +9.522836957346433e-01   +5.247303529070035e-01   +4.261049045366622e-01   -6.191972189454340e-02   +1.455631917246435e-01   +2.381649241599840e-02; +3.579647910028693e-01   +3.538472003007739e-01   -9.650817481589970e-02   +2.345928036889819e-01   +1.867941732244580e-01   +4.068628342956180e-03   +5.388890609631440e-01   +5.454014113905728e-02   +2.486943056460511e-01   +3.714130224745521e-01   +4.381874184090469e-01   +3.130285839847782e-01   +1.199226676266921e-01   -5.119616665063910e-01   -8.352088371823026e-02   +6.061924362307468e-02; +1.155037121817627e-01   -2.930510626305577e-01   -1.415092653068010e-01   +5.322034445870372e-01   -7.869059006900292e-02   +2.773100725216429e-01   +5.812252308978803e-01   +8.557752924065528e-01   +4.465880805001937e-01   +1.187517096471869e-01   +4.519206913887799e-01   +4.119001575872784e-01   +8.650058493756721e-02   +4.209170730356423e-01   +1.209712580839131e-01   +7.691130416978933e-01; +2.758464897178902e-01   +4.658183383074627e-01   +4.328292105332823e-01   +6.427422544809093e-01   -9.445458625285226e-02   +3.606868213328827e-01   +6.463428284948539e-02   +2.308166452255880e-01   -9.991608394004207e-03   +3.679881170501624e-01   +6.041382662286651e-01   -1.800040433004801e-01   +4.456811834608067e-01   +1.443278046945468e-01   +3.600825906869526e-01   +1.915419650264693e-01; +1.899642447768365e-01   +6.199955325908822e-01   +8.471812111522163e-02   -6.407609149260454e-02   +4.620844676871422e-01   +1.991583723215435e-01   +5.248680056286384e-01   +4.714441369447726e-02   +3.094884996337414e-01   +3.230353610986119e-01   +2.087473618471405e-01   -2.690112176070302e-01   +2.713133539800433e-01   +3.323553416497396e-01   -2.826698913010799e-01   -3.989888771353458e-01; +4.341590007443157e-01   +2.849228742938271e-01   +5.212480866331489e-01   +7.837716707388699e-02   +6.349287588572430e-02   +4.252119546940839e-01   +3.822359829641947e-01   +3.379963850799051e-01   -3.719744157621525e-01   +6.577449905586311e-02   -6.125543348756264e-02   +2.571411124094081e-01   +3.636720969660387e-01   -5.428528406777064e-02   +4.442471379525838e-01   +5.884131843483426e-01; +5.591453341417062e-01   +1.096501705240995e-01   -1.372335023637637e-01   +3.079896085751694e-01   +1.673118672502113e-01   +1.591660503689190e-03   +1.203472362895757e-01   +5.743955127557744e-01   +2.604391284723628e-01   +1.932068454663144e-01   +2.951745907020943e-01   +3.394742013755783e-01   -1.314770001311961e-03   +2.818878372618557e-01   -3.332933620788940e-01   +3.767462036653904e-01; +7.858098558791646e-02   +5.064020083295097e-01   -2.956555870558786e-01   +3.943416842275508e-01   +2.520156054738417e-01   +4.600624052598623e-01   -1.229888167400268e-02   -3.616529741837877e-01   +3.391665228407928e-01   -6.823241699759972e-02   +5.035512408086055e-01   -1.151923129917779e-01   +2.911170726100475e-01   +5.101880307423419e-01   -5.271825102526729e-02   +2.596209938295295e-02; +2.384905826183199e-01   +5.618349123094268e-01   +4.630858823099416e-01   +3.243000616343978e-01   -3.866663950180340e-02   +7.136273554508968e-02   +3.833643564119263e-01   -1.662739220332068e-01   +1.662142420307978e-01   +1.070436354055403e-01   +5.406993803370591e-01   +2.609808414472828e-01   +5.254415317820011e-01   -1.451958350019686e-01   +7.517380959263363e-02   +2.844377578930623e-01; +2.043818501801639e-01   +4.996800221332689e-01   -1.043275545259714e-01   +1.229401855886926e-01   +6.045135825683027e-01   +2.886973273459753e-02   +3.369865655324153e-01   +7.361644235747664e-02   +8.421262041183263e-02   +6.447960405554405e-01   -5.468436883380563e-01   +1.848844922224649e-01   -4.946420943652498e-01   +3.673380434665602e-01   +3.015423042584541e-01   +1.938108515700770e-01; +3.214890473037670e-01   +3.600771758966915e-01   +4.770198592167833e-02   -1.409262962309838e-01   -9.148582491895610e-03   +2.859780254290676e-01   +3.463114039189000e-01   +2.264163924693346e-01   +5.369202256892187e-01   -5.660243071590484e-02   +2.833474008132964e-01   +6.608562591501752e-01   +7.640965053238817e-01   +1.513389412266477e-01   -3.248270991700190e-01   +1.105123648912447e-01; +1.703424753846085e-01   +1.682475071821606e-01   +6.062097650223742e-01   +2.282832140110435e-01   +7.267547689767543e-01   +4.792266324388831e-01   +3.803682948498113e-02   +1.445628166162715e-01   +7.673174802992730e-01   +4.235848349950366e-02   +3.229243287525757e-01   +4.160749572745327e-01   -2.449073833576709e-01   -7.954857926445458e-05   +1.923298318694319e-01   -2.463108099599098e-01; +1.189421471817769e-01   +2.057624088006247e-01   +3.037864185029688e-01   -7.071069842587382e-01   +1.222287325029305e-01   +7.301518287209461e-01   +4.691249214703135e-02   +3.045166297285384e-01   -2.166278384455115e-01   +5.687005262690592e-02   +5.041498541987391e-01   -1.016881016878222e-01   +2.605482990654509e-01   +4.843744737201017e-01   +2.116429146947214e-02   -1.973789860009367e-01; +3.443532111478605e-01   -3.675528102706771e-01   +6.368458896213548e-01   +3.830448838142926e-01   -2.051659427419667e-01   -1.140272727571524e-01   +3.914836729454357e-01   +1.846851555305928e-02   +1.962583286806970e-01   -8.588150805176516e-02   -2.331406371818878e-01   +3.214472372265802e-01   +4.488165089752073e-01   +2.018152596118428e-01   +5.466273257149930e-02   -4.618013144611114e-01; -5.613805061052418e-01   +5.937379641296442e-01   +7.772831688696143e-02   +4.903413112359150e-01   +6.757354661181800e-01   +5.399511016573920e-01   +1.096135158477638e-01   +8.434157902696613e-01   -1.065175601852608e-01   +4.415289450717259e-01   +3.803380155035971e-01   +4.761208241035979e-01   +3.892273525374323e-01   +3.534176020806003e-01   +4.428354971460363e-01   +2.666256071565819e-01];
L1E_L1I_iGABA_netcon = [+1.246859202948560e-02   +3.225570206716644e-01   -2.235139502795322e-01   -1.334751461864894e-01   +6.700707938844847e-01   -2.464160868398362e-01   +2.235760974738761e-01   +1.813174737149981e-01   -1.812891815585058e-01   +6.686266157092317e-02   +2.803849160025856e-01   +2.358052596576652e-01   +9.410875396054020e-01   -5.735249047751291e-01   +5.168214644040665e-02   +7.597228142161484e-01; -4.292520649825213e-01   -1.938153247898342e-01   +5.480143685817086e-01   -2.765150993378512e-01   +1.681226079921593e-01   -1.653855309484988e-01   +4.609274028989094e-01   +3.303283294698670e-01   +3.434671059311943e-01   +1.622111037008407e-01   +4.803494480929808e-01   +1.009308274889056e-01   +6.570729413626454e-01   +1.242313058993963e-01   +2.654874648201855e-01   -2.316010627728753e-01; +5.360975386545190e-02   +6.711361076090087e-02   -1.299545075752781e-01   +5.695326412423274e-01   -1.395954578029507e-01   -2.211029371824182e-01   +3.371871040636343e-02   -5.254663204808825e-02   -7.238356041894696e-02   +5.836475971265894e-01   -1.384697252249815e-01   +2.569598033843642e-01   -1.572204420037502e-02   -1.951455422003170e-02   +6.661424399048964e-01   +2.455638219756436e-01; +4.557870180364802e-01   -2.575823716359998e-01   +3.103209307558796e-02   +2.545162341571209e-01   +4.332341099328009e-02   +5.344761584724808e-01   +6.258952389624073e-03   -2.124253113605977e-01   +1.951811444287740e-01   +2.142709862712258e-01   +2.537890991740906e-01   +6.659024270762161e-01   -3.560959100555052e-03   +2.730126071432887e-01   +8.162259151886163e-02   -2.397538256119380e-01; -1.180934524202234e-01   -2.327042753652539e-02   +1.288480616127383e-01   +3.624452881856612e-01   +2.958831483621818e-01   -1.756405477410140e-01   +1.870359402151989e-01   -3.630916929862743e-01   -1.176562697729365e-02   +5.516015311948314e-02   -4.295040686031337e-01   +7.335426817225952e-01   +2.496521385066680e-01   +2.995572658396127e-01   +5.800101969786578e-02   +2.610208364029306e-02; +1.489947356816235e-01   +2.134977260338427e-01   +1.261973026825310e-01   -2.800206103394946e-01   -2.006469835880914e-01   +6.700183248333146e-01   +1.216250060860844e-01   -4.924735950041574e-01   -3.967843370445812e-02   +2.711013861729859e-02   -4.644365042259222e-01   +3.020391093885875e-01   +2.746636054961686e-02   -4.362842265282625e-01   +5.343530529591053e-01   +1.574708237933100e-01; +5.895264894893238e-02   -1.630648005142540e-02   -1.433202896417073e-01   -3.168412426007621e-01   +3.908323388334450e-01   +9.423386282594587e-02   +3.321688449854020e-01   -2.437262936337314e-01   +9.394199170385645e-03   +3.899094912598167e-01   +5.275401514435822e-01   +3.025298275369027e-01   +4.431191959467733e-02   +1.801463196490636e-02   +1.000000000000000e+00   -3.069024890312941e-01; +8.925545071497956e-02   +1.977032571867161e-01   +6.467822703144691e-02   +1.109770246399854e-01   +2.875481295616179e-02   -2.097514927450785e-01   +5.961066766297856e-01   +1.262131969066284e-01   +5.661010904441977e-01   +3.843565603720548e-01   +1.344336241824996e-01   -1.366086732496492e-01   +3.897380697987641e-01   +2.636606059059927e-01   +4.608531263427352e-01   +4.653802781379967e-01; +5.942946897948018e-01   +7.229229291123641e-01   +1.823723373283010e-01   -1.655007947768607e-01   -5.732047233554936e-01   +3.332778022587181e-01   +1.049109208453926e-01   -3.453602527947957e-01   +1.799470945899599e-01   -3.186333558933273e-02   +1.398682253252538e-01   -2.016804631011643e-01   -9.691956593556326e-02   +8.100230750621268e-02   +7.314005982192182e-01   +3.828104607110185e-04; +2.415783515990943e-01   +4.928638342034350e-01   -3.249477140232292e-02   -2.086285176967431e-01   -2.130065165497855e-01   +1.117698563883720e-01   +2.416771300913007e-01   +5.960845351474395e-02   +4.670129967013167e-01   +1.701453535162530e-01   -4.137244885784858e-01   -1.942964572339525e-01   +5.306956489992470e-01   +3.870628936605418e-01   +2.717701799500496e-01   +3.191852971460027e-01; +3.550590777912025e-01   +1.734062700215930e-01   +8.777887130343177e-02   +5.649978127121483e-01   +1.425707519959613e-01   -1.033380503965297e-01   +1.530955351516487e-01   -2.449093740873358e-01   +4.217277459818551e-01   +2.068997917730708e-01   +8.326559879114445e-02   +7.881672308699593e-01   +7.146116564361392e-01   +2.098708399892908e-01   +9.356108845615438e-02   -2.608630530400576e-01; +1.538071599612927e-01   +3.517832261732250e-01   -4.076809240632741e-02   -5.135298177467433e-01   -3.601276590921153e-01   +1.662260710656339e-01   +6.119456053233552e-02   +4.976743502109832e-01   -1.462901919909405e-01   -2.610723034029139e-01   +2.019113528533849e-01   +4.427031306088035e-01   -8.468428245716607e-02   +5.710005716480274e-02   +2.825283069712567e-01   +2.742768832234324e-01; +4.363375110226104e-01   +4.614847134182267e-01   +2.412560952492510e-01   +5.303257929637087e-01   -8.851596483732953e-02   +3.147898592612393e-01   -2.040360093519592e-02   +3.059330471446827e-01   +5.910474728873752e-01   -2.325817189180219e-01   +1.365794216919959e-01   +3.923653149230209e-01   +1.552774373747528e-01   +9.921524315884653e-02   +4.949304272115762e-01   +3.178590507633797e-01; +5.480663572075718e-01   -3.683780723942293e-02   -2.962774583039522e-01   -9.108166034894800e-02   +7.556116347490871e-02   -2.861099787030962e-01   +5.987385750588646e-02   +2.444748969437769e-01   +5.553290455689572e-01   -2.596431684193821e-01   +3.673942057679377e-01   +2.516759802235405e-02   +1.841667086579732e-01   -1.154196370870818e-01   +4.824589264967304e-02   -2.850572096716426e-01; +4.262242850661416e-01   +2.248375771570144e-01   -1.776494912987455e-02   +5.200269571375984e-02   +1.582885340863217e-01   +2.172852597054139e-02   +4.541791406035425e-01   -2.490365930317317e-02   +5.528487597932672e-01   +9.762375762277452e-02   +2.526428391155697e-01   +2.216487290389178e-01   +8.801766768366079e-02   -2.660673863295424e-01   +6.236804276837637e-01   +6.319417045734225e-01; -3.316253943949857e-01   +1.918655311202189e-01   +5.353876346729110e-02   +5.826652066042915e-02   -2.868302001173473e-02   +3.181089631553671e-01   -4.915320168377162e-02   +1.260545180328795e-01   +6.381254034240590e-02   +2.909900392835141e-01   -6.683612883764949e-02   +2.084361632372872e-01   +9.195973933013507e-02   +2.075539701427711e-01   +4.015603827948214e-02   +6.615793156246030e-01];
L2I_L1I_iGABA_netcon = [-2.701688007149660e-01   -3.071673690712903e-01   +1.954991631591859e-01   +4.353619421233588e-01   -2.497888010285138e-01   +1.818955160051359e-01   +5.167023290935843e-01   -3.703903579030426e-01; +3.422730354522490e-01   +7.767294880203510e-01   -1.936981602563527e-01   +4.997706987393816e-02   +5.309458115173277e-01   +6.038710635772527e-01   +2.430882325431178e-01   -2.499560297324805e-02; +6.669409959428485e-01   +4.595537744797704e-01   +1.737870351780006e-01   +3.058507973364753e-01   +5.291819826998877e-01   +1.338233892220511e-01   +1.287914633628796e-01   -4.685855419331919e-02; +5.538999317685720e-01   +2.483846857690671e-01   +7.391643668998097e-01   +1.078931586366301e-02   +3.597360427694439e-01   +3.073036160045141e-01   +6.641145920643038e-01   +1.697317932416826e-01; +9.375535691407788e-02   +6.301937685001233e-02   +5.317128228218430e-01   +4.611434962843566e-01   +4.494898771435307e-01   +3.336086924579608e-02   +1.302741056699791e-01   -1.220785427454857e-01; +9.883829366505642e-02   -2.020237178776975e-01   +1.211733212486562e-01   +1.366832973835221e-01   -3.320638640449684e-01   +2.445662751678658e-01   +3.814875807491553e-01   +6.165602861687804e-01; +6.340640632764686e-01   -5.134046827139446e-02   +2.181897989832940e-01   +5.372593733091436e-02   +2.511195959473237e-01   +7.126167742330927e-01   +3.900514781518071e-01   +1.575190875107579e-01; +1.241972584819916e-01   +4.721559625884694e-01   +3.297646425125660e-01   +1.120081241484049e-01   +1.188412795950295e-01   +1.103327567025846e-01   +7.220592717310295e-02   +1.108966500088784e-01; +3.134706677074796e-01   +9.492211822052050e-01   -6.144372507662590e-01   +3.201016618672329e-01   -2.242920871718614e-01   +1.774906824231841e-01   +3.540353600157126e-01   +8.587105538463125e-02; -3.196147741774982e-02   -3.896305880681687e-02   +1.652602919368821e-01   +4.142626297743962e-01   +5.942513688770129e-01   -9.920430204056287e-02   -1.719676103715133e-01   +3.054150201031439e-01; +1.185680246573834e-01   +2.062165795931975e-02   +5.218971865536448e-01   +2.867216385654630e-01   +5.036737915183640e-03   -2.290747462782180e-01   +2.650220125489363e-01   +3.287135958774149e-01; +3.079430275772344e-01   +4.223755998556453e-01   +5.627164785329204e-01   +4.006699800970434e-01   -7.909156813953205e-02   +1.227321102060485e-01   +4.211951433860104e-01   +4.284487816341531e-01; +3.327075318082890e-01   +4.779996851894708e-01   +4.331630119920745e-01   -4.646971609043379e-02   +2.573717798499449e-01   +8.876076526779275e-02   -6.990984552901096e-02   +1.088035514614185e-01; +1.355510407156401e-01   -1.609384323922717e-01   +1.563851986947646e-01   -2.556604364996628e-01   +5.230850002153031e-01   -1.828392172303995e-01   +4.272200133959757e-01   +2.754295575261866e-01; +3.794911096638914e-01   +1.306703276295747e-01   +3.753916861020629e-01   +4.572301920438866e-02   +7.736851804654987e-02   +9.117624080943063e-01   +3.672951697613385e-01   +5.153862781311123e-01; -1.922379113329404e-02   -2.489474277446242e-02   +1.809280606332328e-01   +3.644957563903293e-01   +3.048580877448257e-01   +1.062128533867657e-01   +2.919799747175356e-01   -4.629112147970343e-02];
L1I_L2I_iGABA_netcon = [+5.773752662932995e-01   -1.840953568773173e-01   -2.746841913878710e-01   +4.237090391530864e-01   -5.660006695950712e-02   -1.558433461410354e-02   +6.715265267674098e-02   +3.197282636142941e-01   -3.078425012285492e-02   +3.944687042077326e-01   -1.072178984685400e-01   +2.645143574093247e-01   +2.358738848172756e-01   +2.423150249530507e-01   -4.334321387434625e-02   +4.069032735590009e-01; +3.234828538731346e-01   -1.366137447378221e-03   +9.861068967461729e-02   -2.629225500155520e-01   -1.023859194160679e-01   +5.578392204795632e-02   +5.361096385553251e-01   +2.720009572062665e-01   +4.229712837821666e-01   +7.603578982771543e-01   +2.180893106360141e-01   -1.130149751876306e-01   -1.149590947332533e-01   -4.360872972742498e-01   +3.778328782626622e-01   +4.363376755555720e-01; +1.917679396856141e-01   -3.418297363043956e-01   +3.272014743041089e-01   -1.246124719487098e-01   +2.550642383662414e-01   -2.279308675483597e-01   +6.447992494600255e-01   +4.953474112378756e-01   -3.190087041469621e-01   -7.858973644341735e-02   -5.947320198475689e-02   +3.662103995210907e-01   +6.422820339436310e-01   +5.680039437061912e-01   +9.477994247759943e-01   +1.157614716681869e-02; +3.422038474332134e-01   +7.807555488757478e-01   +4.360740194812054e-01   +3.692388139438366e-01   +5.481386518576914e-01   +5.363000390217768e-01   +7.058761870809511e-01   +6.144735567827329e-01   -2.313094414264664e-01   +8.177836041743820e-01   +5.857465637186426e-01   +3.140944712186775e-01   +2.325804707947470e-01   +8.500617676244357e-02   +3.762681176360534e-01   +1.010765433120985e-01; -2.722640004506811e-01   +3.456801208912770e-03   -2.466891863843145e-01   +3.101685640158846e-01   -1.050563798470356e-01   +8.110981401038940e-01   +7.599197986491922e-01   +3.748616058928277e-01   +5.174693781235831e-01   +5.303811562175643e-01   -1.834297789889308e-01   +2.533907530775746e-01   -3.909538454874775e-01   +2.223503218878401e-01   +3.275478210138757e-01   +4.340479441183162e-01; +5.098382373285271e-02   +3.866412797065348e-01   -9.513011379980194e-02   +7.150516973980537e-01   -8.035749539208768e-02   +1.353221914193473e-01   +3.965212621641909e-01   -4.857274655622305e-02   +1.061593466013620e-01   +5.933988224254664e-02   +1.520894339952300e-01   -9.963747781518827e-02   +5.801365663967525e-01   +1.000000000000000e+00   +2.902243828324531e-01   +5.153601693309121e-01; +5.882052694419926e-01   +4.603470808177802e-01   -4.275225029969202e-01   +1.278030772769509e-01   +4.986491312112661e-01   -3.957160779229552e-01   +4.641155672078722e-01   -1.276880106347071e-01   -2.433012905161453e-01   +1.115722912901211e-01   +4.128190245776934e-01   +3.522771643338493e-01   +2.391788364362505e-01   -2.863857020628196e-01   +1.907557723907240e-01   +3.564499604018450e-01; +5.146320387021948e-01   -5.891106334780999e-02   -6.609534504720688e-02   +5.554843412863701e-02   +1.197515225267917e-01   +4.817651572444208e-01   +1.508859793927303e-01   +9.615607642498655e-02   -1.890851759717733e-01   +4.139814269557376e-01   +4.174307186086114e-01   +4.059069691713424e-01   +2.091131408923070e-01   -1.209320446502561e-01   +3.307259228770631e-01   +4.595636445225941e-01];
L2E_L1E_iAMPA_netcon = [+3.606109391168671e-01   +1.333973968645034e-01   +2.166839453210632e-01   +3.025858076883363e-01   +1.000000000000000e+00   +6.387377077539819e-01   +4.686279134610189e-01   +1.301005583770106e-01; -2.324898227448127e-01   +3.647631994602107e-01   -2.357636883541084e-01   +1.068321722977888e-02   +5.138810571666340e-01   +1.253218258386231e-01   +5.272385340750224e-01   +1.148800032291660e-01; +1.828855180800920e-01   +6.020250381267829e-01   +3.655287643739618e-01   -5.074696117362350e-02   +1.353396751874235e-01   -1.769044601161879e-01   +1.752421681481280e-01   +4.106694343436740e-01; +4.809073475065002e-01   +5.617018518306422e-02   -7.286677934638028e-02   +4.542354060532818e-01   +6.041245296182881e-03   +2.193725873016950e-01   -1.489889057096562e-02   +5.169913972027216e-02; -1.131352135558773e-02   +1.075613456214254e-01   +6.005305605406881e-01   -1.611921316890952e-01   -1.833806564025045e-02   -8.042804577805467e-02   +7.652819038201714e-02   +2.145707632268576e-01; +3.483162747268451e-01   -1.147726722519263e-01   +1.069341807080920e-01   -1.241448127472632e-01   +2.415439360289367e-01   +4.754944987568943e-01   +4.573972803852605e-01   +3.267266200433974e-01; +1.077924239352062e-01   +5.815095707417574e-01   +2.101875191851386e-01   -1.096928506369702e-01   -1.354597839220116e-01   +3.382930310716173e-01   +7.017184850087036e-01   -1.916875239181849e-01; +1.719048501153131e-01   +3.810371752000254e-01   +8.123384173189346e-01   +8.688577081535381e-02   +1.767842668661628e-01   +3.865812599720036e-01   +4.200169159523750e-01   +2.749467747792051e-01; +5.426872771296144e-01   -8.037420177721370e-02   +3.124953189725233e-01   +7.381909990173164e-01   -2.556908693337105e-01   +3.695707900803872e-01   +4.526201131177787e-01   -1.205225038004834e-01; +1.250385782054542e-01   +2.692703187331201e-02   +1.714565651142628e-01   +1.352827032309662e-01   +2.023441271800268e-01   -2.787240563372991e-02   -9.799625752026735e-02   +4.127217129698945e-01; -2.969723889298816e-01   +5.413206627047921e-01   +5.514401469882922e-01   -2.988065239344064e-01   +2.228166645319387e-01   +5.426202606562242e-02   +1.867923134597459e-01   +1.785677563715608e-01; +1.538766535721539e-01   +2.213000713952545e-01   +5.055586192774519e-01   +1.466814986578918e-01   -8.407789457149741e-02   +4.489823571347445e-01   -2.321113772757661e-01   +2.261942590930230e-01; -7.623462393563822e-02   +2.533133640613148e-01   +6.505883766012927e-02   -1.727565135408491e-01   +5.544840787122313e-01   -2.798843727221568e-02   +3.614170180560342e-01   +1.172086002115609e-01; +6.429364357286588e-02   +7.155852021931192e-01   -4.610130149587046e-01   +1.140265503258282e-01   +3.146286024694213e-01   +2.338955125375641e-01   -4.259533043786975e-01   +2.504138499332990e-01; -5.086369556520038e-02   +1.635531760727676e-02   -7.070319135198386e-02   +3.103982913013698e-01   -6.217022006089993e-02   -2.051554164070606e-01   -7.777141635629528e-02   +2.499837343976636e-01; -1.302974659048780e-02   +2.209817697190432e-02   -1.760730603318031e-01   -5.129064792412105e-02   +2.778735966086258e-01   +4.342101306444330e-01   +4.105904189924709e-01   +4.344254379816603e-01];
L1E_L2E_iAMPA_netcon = [+1.675770318742478e-01   +2.454205403162652e-01   +1.628736923926011e-01   +1.522735745709876e-01   +5.064329018658221e-01   +1.524395666574849e-01   +1.894410070327782e-01   +7.371633653335768e-02   +3.357242513603312e-02   -1.951330003230296e-01   +3.354877993798240e-01   +1.104905716436356e-01   +2.936021917678611e-01   +1.717538520685947e-02   -1.501567590040054e-01   +6.430309091244302e-02; +2.968990277148589e-01   -3.028142242430054e-01   +7.322911352288547e-01   +2.876327768856575e-01   +2.663421590200470e-01   +1.762456551772472e-01   +6.234412654654664e-01   +2.033806700650116e-01   -1.502317796729940e-01   +2.716232826760713e-02   +2.899936768107946e-01   +4.464999288060671e-01   +5.197888566739599e-01   +2.707468275123581e-01   +1.422114597833093e-01   -9.515506510376212e-02; +6.143977013037273e-01   +6.512767253012196e-02   +3.298405499352781e-02   +3.497264652197828e-02   +1.369839692868003e-01   +2.853756080002618e-01   +1.647811654471601e-01   +3.307455815594059e-01   +1.157507270335153e-01   -2.222976102168835e-01   +2.793877149839785e-01   +5.541212974609112e-01   -5.818189375741263e-02   +3.600288052076596e-01   +5.062657012601982e-02   -4.876890577610676e-02; +7.893286733087927e-02   +2.614776218694005e-02   +3.697558087353996e-02   +1.017718110097976e-01   -8.741120232494836e-03   +4.766591808625783e-01   +1.000000000000000e+00   -9.846837257609242e-02   -1.057643009394246e-01   +3.152676461950017e-01   +4.128268505974916e-01   -2.612635958104682e-01   -7.462982601279280e-02   +8.106317704340911e-01   +2.091355199446955e-01   -2.763067885266726e-01; -1.426861165018657e-01   -4.020845260512368e-01   +2.811383771260483e-01   +4.075996817679575e-02   +1.922970647615961e-01   +4.021058944362301e-02   +3.784977105436350e-01   +3.048864511730686e-01   +2.654507027790515e-01   -1.488793946268034e-01   +1.526572909145099e-01   -2.336140241408728e-01   +4.853752636014799e-01   +2.636228859546633e-01   +4.407989381437462e-01   -1.022971020122389e-01; +2.447123756320499e-02   +3.827410365925833e-01   +1.773987207335860e-01   +5.398005415587401e-01   +2.709570232640404e-01   +1.123560250265349e-01   +6.632732606204259e-01   -5.694574934031599e-02   +2.661959896253823e-01   +1.413337007403155e-02   +7.233682934497694e-01   -2.325560320028229e-02   -1.366477651660863e-01   -1.762331733722269e-01   -2.823271388365591e-01   +4.216557443472105e-01; +1.569943213433813e-01   +1.633495206416541e-01   -1.036088856891271e-01   +3.071363707435467e-01   +4.081206063551737e-01   +3.302216232208906e-01   +5.144842485387494e-01   -8.318413444413812e-02   -4.285289061035102e-01   +1.091339936219786e-01   +9.259892501500354e-02   -3.118900369113716e-01   -2.330614399037315e-01   +3.351316276035751e-01   +5.313032818423907e-01   +1.556168178622762e-01; +2.970758268894951e-01   +2.688093383365263e-01   +2.921363885688297e-01   +3.582910681408287e-01   +4.062097479297751e-01   +6.065437481952575e-01   +6.404719504691821e-01   +3.168937526104398e-01   +3.324759833056531e-01   -1.469198966115177e-02   +5.863158101562047e-02   -1.134257513684523e-03   -5.001585247726411e-01   +1.922838669083073e-01   +1.653335276837148e-01   +1.259988976858548e-01];
L2I_L2E_iAMPA_netcon = [+1.302325054773973e-01   +6.397509598049732e-01   +4.918802774224640e-01   +4.224578610642254e-02   +3.975462470399579e-03   +3.709586406703458e-01   +2.135341169482717e-01   +6.810445730779443e-01; +7.116099804948197e-01   +1.464080937092958e-01   +8.639022345836135e-01   +6.435497108532852e-01   +3.519089084584641e-01   +3.956244037208312e-02   +1.033039833212719e-02   -3.040277652647840e-02; +3.609195698204130e-02   +3.694013269561846e-01   +5.019318659661591e-03   +4.258379365736057e-03   -1.586932459380201e-01   -5.436313648655154e-02   +3.835987599737014e-01   +1.944691949098030e-01; +3.501931367347835e-01   -3.864975282631145e-02   -3.206562645925413e-01   +2.438435439728994e-01   +4.553264097193268e-01   -3.315607899162744e-01   +5.501817249944887e-01   +1.029838808543969e-01; +3.939405103941248e-01   +1.486093673462862e-01   +1.675583232784501e-02   +5.452069656528046e-01   +5.760739311629953e-01   -1.084846717500386e-02   +5.837960844797633e-01   +4.088195949287294e-02; +3.164624789861149e-01   +3.924053110851569e-01   -5.990922106220516e-02   +6.820056148814713e-01   -7.689150443195611e-03   +2.141501253073479e-01   +2.080169384072214e-01   +1.405316958135513e-01; +3.420669403774719e-01   -3.473344561455902e-01   +5.764222843404818e-01   +7.284880526468477e-01   +5.660683314914469e-03   -3.646908921911534e-01   +6.420898300075537e-01   -1.036537328077162e-01; +1.746100604302515e-01   +1.683464191413989e-01   -4.437430922723467e-01   +2.193145007289285e-01   -7.808502254621426e-02   -1.701176089734647e-01   -1.118280497881803e-01   +6.055191449138526e-01];
L2E_L2I_iGABA_netcon = [+1.778710761712390e-02   +5.490215008925028e-01   +4.534677190644226e-01   -2.713169523066589e-01   -2.381073446079449e-01   -1.734994064860524e-01   -1.250551304623164e-01   +5.646312771369817e-01; +2.280693936830051e-01   +2.306118176974623e-01   +1.995145384883726e-01   +9.315351180826323e-01   +5.308073744559773e-01   +1.463399823816982e-01   -4.314789269695267e-01   +2.094899064155047e-01; +1.513365005760924e-01   +8.478135633853220e-01   -3.200360610665243e-01   -3.386169180121461e-01   +2.678109126163283e-01   +6.440257302987341e-01   +2.914373060263614e-01   +2.601479845242271e-01; +2.164505853820414e-02   +6.145560596527982e-01   +1.117232703223291e-01   +7.308632962428555e-01   +6.929025686175040e-01   -3.020712338963574e-01   -3.013788343449000e-01   -1.943777279664962e-01; -1.722126240977966e-01   -3.466671613261992e-01   -1.581961987199228e-01   +2.855575695539496e-01   +7.835788007947162e-01   +2.094010568913282e-01   +7.343906716749721e-02   +3.758746594318961e-02; +8.507837408819282e-01   +5.346029785146038e-01   +2.566237619980147e-01   +5.821463831284917e-01   +4.136857817739929e-01   -5.293525652303110e-01   +5.455846616204960e-01   -2.983864387710428e-01; +2.493402726518370e-01   +1.819774744831348e-01   -4.119454478601485e-01   +7.852023631231331e-02   +2.773649389314461e-02   -4.912532499792931e-01   +1.134983135834521e-01   +7.621965119735276e-01; +5.723373275714157e-02   +4.568593361626118e-01   +4.992034233213952e-01   -4.617488842609353e-02   +1.416251573602974e-01   +3.275053828877383e-01   +2.722504006348890e-01   +6.412207202026370e-01];
L3E_L2E_iAMPA_netcon = [+3.538659211805562e-01   -3.907413086539246e-01   +6.469348906851297e-02   +2.824587582431753e-01   +4.363524399995434e-01   +3.187920671830464e-01   -2.147187111056863e-02   +6.611340125761171e-01   +3.199749793262081e-01   +9.166265865408714e-02   -4.148519610822574e-02   -3.782078182727933e-01; +2.473542027999488e-01   +5.021688584695598e-01   +1.626885904356797e-01   +1.040752616365251e-01   +6.887016765899552e-02   -2.710938149995551e-01   -1.138315621951435e-01   +1.787924092233334e-01   -3.504036493273296e-02   +2.764164413916154e-01   -2.148922494756027e-02   +6.288940781666192e-01; -3.939335216361655e-01   -2.807537560316821e-01   +5.670146236527428e-01   +4.943039883207926e-01   +4.893938900910211e-01   +1.921432951045376e-01   +3.573604602575997e-01   +3.890354487390693e-01   +8.045663047154558e-01   -3.731880328254480e-01   +6.690435297657191e-01   +4.642601383688112e-01; +3.248531714870873e-01   +3.117349970935349e-01   +4.154779157498986e-01   +8.953006489229201e-02   +5.318316959154059e-01   +1.651396848773008e-01   +1.980617561000245e-01   +3.750870293879000e-01   +2.204133194368750e-02   -1.621510249618354e-01   -2.804603267079268e-01   +7.048420902606244e-01; +3.027509329753699e-01   +2.969004165493823e-01   +1.713504153672547e-01   +6.076047082921295e-01   +5.982843693271978e-01   +4.123164891263720e-01   +2.729227822429036e-02   +1.011307596822431e-02   -1.712665704110355e-02   +6.292861958495202e-01   +5.407709228408609e-01   +6.993881972684671e-01; +3.763518249167694e-01   +1.497871522840569e-02   +8.448389837665463e-02   -7.266761329219065e-02   +3.404255097129690e-01   +4.540651086438842e-01   -2.178828239238431e-01   -2.946099687488863e-01   +2.464052703817041e-01   +3.831198713980383e-01   -1.107141628862462e-01   -1.577973662999594e-01; +2.935003848205584e-01   +2.656842815208854e-01   +5.617159765464572e-01   +1.108800202109428e-02   +3.190224877380903e-01   +2.248027630343687e-01   -1.297766488903807e-01   +1.182482152834140e-01   +2.505150594009217e-01   +5.506685838823698e-01   -1.904454148295107e-01   +3.204674892955220e-01; -2.128547636543312e-01   +8.908822990769054e-01   +3.450377534865838e-01   -7.746667765775086e-01   +4.948632167778926e-01   -5.481759464464962e-02   -3.816366089925244e-01   +3.305119330768871e-02   +2.589312659958983e-01   +2.369956043171646e-01   -4.135890670753065e-02   +9.236519121293627e-04];
L3I_L2I_iGABA_netcon = [+7.791597099437736e-01   +6.290914682913560e-01   +1.912637137481625e-01   +2.758296632859612e-01   -4.538052358833494e-01   -1.037627969662331e-01   +9.514456611497520e-01   +5.778174527026413e-01   +6.932546554837963e-01   +1.600875313936376e-01   +1.061032365022134e-01   +1.104850141717748e-01; +1.642628778165765e-01   -4.469376791334565e-02   +5.163284565108642e-02   -3.842430031488512e-01   +6.070616105978068e-01   +1.227561648927936e-01   +2.607074558851426e-01   -2.910712692404967e-02   -3.986191093761913e-02   -3.438133887254142e-01   +2.669204925659842e-01   +1.163554825534748e-01; -1.165094419238157e-01   +3.401723758343891e-01   +2.464635655285687e-01   -1.950279021922162e-01   +1.519467049348884e-02   +2.822314570312514e-01   +3.692612897595372e-01   +2.276319860933377e-01   +2.863485798302219e-01   -4.821741815385019e-02   +3.213533429606468e-02   +8.491821719403200e-01; +6.584591064630280e-01   +3.791059480652887e-01   +8.073572346522259e-01   -2.843550539029845e-02   +2.447779928496638e-01   -3.108870367258037e-01   +1.959139474610918e-01   -2.675351329567482e-01   +3.122918368050256e-01   +6.266818217768331e-01   +5.798404279115444e-01   +4.856417488754526e-02; +4.593611161955846e-01   +2.572250530995103e-01   -9.603979793797507e-02   -2.456650646135130e-02   +5.863688609793215e-01   +4.066267684436301e-01   -2.883493293788031e-01   +8.821352334961405e-01   +6.074012936275190e-01   -4.850521827451434e-03   +3.342691571878421e-01   +2.370364563801082e-01; +7.542323426774604e-02   +4.710986844128590e-01   +6.790597541318875e-01   -3.001938765221177e-02   +4.756471969815741e-01   +3.989134882187678e-01   +2.510433878261956e-03   -3.009015241494088e-01   +6.192226247777888e-01   +4.539502072666411e-01   -3.021492880358315e-01   +2.385077454308569e-01; +7.206300836474399e-01   -1.351968293072879e-01   +4.677058878782768e-01   +4.448899414601618e-02   +7.113185750574968e-01   +6.033084576819576e-01   +5.586934125406683e-01   +2.811067080007451e-01   -4.808787521375119e-01   +7.955914304379611e-01   +7.577078929223816e-02   -2.305686134402506e-01; +1.280716699951595e-01   +3.356366115610863e-01   +4.713378998150775e-01   +3.911960745976039e-01   +1.156642983139353e-01   +4.219807360208661e-01   +8.670649119646144e-01   +8.362323156894812e-01   +5.596421055881903e-01   +1.982268670163013e-01   +1.746134437886808e-01   +4.324047911271391e-01];
L2E_L3E_iAMPA_netcon = [+5.622931081187833e-01   +3.038278029134597e-01   +7.186520021116620e-01   -6.924631243844290e-01   +8.277403440726670e-02   +3.914306547415665e-01   +5.685847003056215e-01   +6.120153452077436e-01; -7.521060328786539e-02   -5.330016360881681e-02   +2.381798614894213e-01   +5.252636472352955e-01   +6.620162629189550e-01   -2.720277005214719e-01   -2.063478906424994e-01   -6.125851750802476e-01; +7.453614786542645e-02   -2.627980783626981e-01   +1.567118330092062e-01   +3.877315337149441e-01   +3.680596810734477e-01   +9.139016465118463e-02   +8.277877946208449e-02   -2.032793574428676e-02; +1.976399612177762e-01   +2.346011358634819e-01   +7.441993217648877e-01   +8.510161899430333e-01   +9.445529910780213e-02   +8.101107564323078e-01   -2.026500413280139e-01   -3.268124570842881e-01; +3.342835556396578e-02   +1.667259620833674e-01   +1.703966383965660e-01   +5.377164616201644e-01   +2.430663013811910e-01   +1.520954789991499e-01   -5.895613222355945e-02   -1.669531037100850e-01; +9.100497641334433e-02   +5.437160791576483e-01   +3.751738936437243e-01   +8.481533263000189e-01   +1.216601981468527e-01   +1.823618958243110e-02   +1.248537774532754e-01   +1.171323538804864e-02; +2.500889188399362e-01   +7.511022466914226e-01   +6.492676907194473e-01   -2.587960794388953e-01   -1.003515282635331e-02   +4.659507901059207e-02   -1.262975031583250e-01   +1.969430626482065e-01; +5.375900218680959e-01   +3.868886700906641e-01   +2.280948804469405e-01   +2.514246530404067e-01   -1.879457236936724e-01   +1.086872533972002e-01   +1.270913470548113e-02   +6.625807458680386e-01; +4.136433356558492e-02   +6.361281101338784e-01   +4.991300547547294e-01   +3.755421680099898e-01   +2.980799752088803e-01   -1.153334797576269e-02   +7.568319463041269e-01   -2.057211563014126e-01; -5.859254984076695e-02   +1.005467435335019e-01   +2.795021178733216e-01   -4.899765058145540e-02   -6.820474502005312e-02   -3.583612918188315e-01   +2.993914311740211e-01   +1.175710596283983e-02; +3.717239856402958e-01   +3.034751857071057e-01   -1.924955949663286e-01   +9.645917719108563e-01   +2.395734624990431e-02   +5.346309532205290e-01   -1.418662843566383e-01   +1.796946060367153e-01; -3.455684759665723e-02   +8.307709962793625e-01   +3.177734721192804e-01   +5.538110136582128e-01   -3.460637158608658e-02   +6.932373865294703e-03   +7.620638293649039e-02   +1.900047199172481e-01];
L2I_L3I_iGABA_netcon = [-5.353401442305751e-02   +2.162693726420471e-01   +1.800477825424756e-01   +1.302784141954483e-01   +8.836461543024146e-02   +7.356561082972461e-01   +3.130571395189927e-01   -1.309588784661936e-01; -2.241775681117911e-01   +1.944716101391562e-01   -1.511902659044090e-01   +1.724759206781520e-02   -1.810249846736836e-02   -3.019163316225689e-01   +5.431106846393441e-01   +3.503751980543190e-01; +6.560635139137947e-01   +9.968000170103885e-01   -6.770528290655017e-02   +5.429156975082972e-01   +1.074122912260222e-03   +6.973501830840230e-01   +1.054908523788056e-01   +2.564547076885355e-02; -2.546172565631664e-01   +1.899584030330870e-01   +8.214225720417148e-01   -2.212583988493024e-01   -2.706128582568808e-02   +6.842877973253876e-01   +3.786853721682996e-01   +3.023533029268858e-01; +4.497008947332463e-01   +1.059292110896572e-01   +3.209038949077382e-01   +3.227883931525849e-01   -5.608496718550625e-02   +3.342746995680502e-01   +3.567760887360751e-01   -5.471825177102202e-02; +7.899037034562531e-03   +3.513415548127432e-01   +6.311169252593246e-01   -9.122323384111453e-02   +3.870751163623625e-01   +6.502559850424544e-01   -2.120108276824667e-01   -4.815876049599378e-02; +1.438153936764590e-01   +4.418390150334465e-01   +1.113293599796153e-01   +4.473064070037086e-01   +1.759584680203304e-01   +1.883118737874655e-01   +9.716519835549415e-01   +6.673420625627025e-01; -4.396448395935947e-01   +2.699003449554878e-01   +5.751839078272151e-01   -6.245458389577247e-02   -1.319674981890516e-02   +5.286140692007635e-01   +4.794979869971431e-02   +6.955738244467969e-01; -5.169977617816078e-01   +5.284062535534193e-01   +6.259836965889956e-01   +1.508660129966266e-02   +2.851862293332636e-01   +1.764459989192371e-01   +4.262825493176891e-01   +3.427360093129793e-01; +9.913570712693809e-02   -1.286640401024807e-01   +1.366298424688000e-01   -1.517393550418801e-02   +2.089713307710282e-01   +5.969434298056318e-01   +1.317409990238790e-01   +2.535603737105213e-01; +4.219609047058632e-01   +1.078208227724959e-01   -4.276596684252267e-01   +3.162390384906705e-01   +1.191475418249594e-01   -1.931541581013883e-01   +5.277590668059624e-01   +4.803814494054648e-01; -4.395053820139866e-01   +6.908727478946992e-01   -3.985715442887387e-03   +5.504465536139258e-01   +4.655172026494996e-01   +2.866286188884369e-01   -1.704361614232180e-02   -2.711698658282191e-01];
L3I_L3E_iAMPA_netcon = [+1.661882407296914e-01   -9.613949831421287e-02   +4.126399560325418e-01   +3.213811002204603e-01   -3.578993535505329e-01   -9.822986272622679e-02   +1.952078921002011e-01   +3.635477951808747e-01   +3.812600712184936e-01   +5.198793764393945e-01   +5.550089929409814e-02   +4.648327499840350e-01; +2.512359533954646e-01   +8.533491392618393e-02   +2.445548305977323e-01   +7.894610263722562e-01   +3.011749977750686e-01   -1.420214094605431e-01   +2.737953156184365e-01   +4.738440091199825e-01   +5.337150197980777e-01   +3.489022156015881e-01   -3.115511319392259e-01   -2.858053189927198e-01; +4.432178698810482e-02   +5.856904501734571e-01   +4.042447112684018e-01   -5.931336019768174e-02   +8.460453522071661e-01   +3.417123846364060e-01   +6.314769245866758e-01   -1.652263648324170e-01   +1.998777130639250e-01   +4.327467168363750e-01   +5.140468083512324e-02   +3.920027153769214e-01; +4.460573208315629e-01   +3.488327465272907e-01   +4.364771619031801e-01   -5.568754223785320e-02   -1.637628206711552e-01   +2.541857356407578e-01   +7.065498087469069e-02   +3.079562414014618e-01   +1.294336232169434e-01   +2.082557415458429e-01   -1.740899158388247e-01   -3.067477938513302e-02; +3.183604663470287e-02   +1.657354066577996e-01   +8.897530323784250e-01   +4.797610242833820e-01   +3.532263372882125e-02   +1.812800902738498e-01   -7.811737246945916e-02   +3.396639028549462e-01   +2.316423262165147e-01   +2.784651158998928e-01   +2.991988355673348e-01   +5.274978205392400e-02; +3.013810076688062e-01   -8.544783923126931e-02   +5.439991371867620e-02   +2.241986717917741e-01   -2.941003951991230e-02   -1.974068220795772e-01   +2.728196938674788e-01   +1.327295949191947e-01   +5.216162732558715e-01   +2.896986307762335e-01   +2.275063224549945e-01   +7.177837398838001e-01; +5.158097029540792e-02   -4.118470188087782e-02   -2.948376510008149e-01   -7.447999402361441e-02   +3.990562034469364e-01   -1.768138989907818e-01   +6.558316362146026e-01   +2.623280306681310e-02   +3.077555686916783e-01   +4.169980461294695e-02   +3.515794435703222e-01   +1.092542492910784e-01; -1.423393647782482e-01   +2.575284539461811e-01   -8.626824786762992e-02   +5.437665201552193e-02   +3.672772756099143e-01   +1.614316740220983e-01   -3.013087623876315e-01   +8.446119423822121e-02   -1.760654224572424e-01   -4.514671866091395e-01   -2.673267091203727e-01   +3.085412561390581e-01; -2.438380934170937e-01   +6.358093064614994e-01   -7.796551068143477e-02   +3.082542683254370e-01   +7.492565227412820e-02   +4.097800237890412e-01   +2.906781790642055e-01   +4.902974374928314e-01   -4.742011261721112e-02   +4.091789829758050e-02   +3.199856767082975e-01   +7.605547553770935e-01; +7.343173847942226e-01   -5.501623137983198e-01   +6.424280001305898e-01   +2.736993908120666e-01   +5.246553999993879e-02   -3.176169974455456e-01   +3.452865099244374e-01   +3.310455919190189e-01   -4.247515488983061e-02   -1.492299731602737e-01   +8.116489280450409e-01   -1.145203889665099e-01; -3.243177390028909e-01   +3.912503439855745e-01   +6.817113804637682e-01   +2.464709065507910e-01   -3.378206519201852e-02   +3.570738595582228e-02   +3.339058317626729e-01   -2.052537748416697e-03   +6.320474231127370e-01   +6.468614215532123e-02   -5.240427081920372e-02   +5.173256967325888e-01; -5.773807163073583e-02   +1.507361827062494e-01   +9.865254566405660e-02   +5.494287394337442e-01   -1.874623786411021e-01   -1.119418146575620e-01   -3.527193656940409e-01   +2.908446302306562e-01   +2.403921914718094e-01   +1.152757500042152e-01   +3.604870857304572e-01   -5.657787599340167e-02];
L3E_L3I_iGABA_netcon = [+1.361817787653361e-01   +3.464708670186292e-01   +4.062730837167527e-02   +2.888575588865393e-01   +2.322651945984252e-01   +1.402902796261884e-02   -1.416817261077485e-01   +2.137781677995668e-01   -1.607732405424002e-01   +5.819878996058684e-01   +1.150533110044588e-01   -7.750149588641607e-02; +1.812681075665707e-01   +4.880304673623080e-01   +4.602741544706718e-01   +1.973455293342803e-01   +6.581818448345305e-01   -7.680760247462877e-03   -6.019182418623398e-02   +8.315779902509368e-02   -5.548053757852049e-01   +9.842050374591772e-02   -6.079862429089677e-01   +1.007390514740380e-01; +2.326588796111841e-02   +6.716595694081152e-02   -4.778874465354694e-01   +5.235986925031241e-02   +2.275047488512893e-01   +5.909435607275647e-02   +4.171689089628657e-01   +1.887024875802333e-01   -1.435570001816864e-01   +2.587394984455532e-01   -1.133002107253425e-01   +4.008381309792658e-02; +1.988048927353639e-02   +2.961501872493140e-01   -5.984460980407144e-01   +4.382421004151511e-01   +9.258385467286501e-01   +1.601155860484107e-02   -7.765510336608919e-02   -6.492858453857372e-02   +8.242624692915281e-01   +4.787250745658533e-01   +1.028006417196102e-01   -7.011641353361919e-02; +2.640357295078943e-01   +1.349659406968355e-01   -1.848156759581987e-02   +3.983141804117524e-01   -2.346849021611163e-02   +5.112513917428089e-03   -4.641648284694140e-02   +7.173095571344398e-01   -3.324091139131213e-01   +5.303516415710166e-01   +2.933657710478362e-01   -2.274607494644417e-02; +6.076392347979741e-02   -2.953585800459896e-01   +3.456300918328430e-02   -2.153700246727988e-01   +2.461794259717969e-02   +3.086632364171413e-01   +1.791539659949356e-01   +5.151131376021038e-02   +6.029018390209756e-01   +3.975309234185571e-01   -3.170734459607367e-01   -6.307551787610689e-02; -1.075195648637468e-01   +1.709677680734283e-01   +1.383536415797432e-01   +8.934695148205212e-01   +1.080851444188774e-01   +4.109297120060955e-01   +4.573774016605708e-01   +4.787299011912981e-01   -8.652588024763626e-02   +3.205114077779418e-01   +3.994805359014230e-01   +3.081093484655597e-01; +1.745396700132052e-01   +2.229426785800502e-01   +2.787214511573796e-01   +8.545746299181711e-02   +2.909719427943409e-01   -3.638311845603430e-01   -1.995039253037935e-01   +5.550754149268834e-01   -1.825807563015971e-01   -1.527403498284716e-01   +1.352447713099262e-01   +3.598070207151464e-01; +3.059766263577021e-01   -1.647421301021013e-01   +3.429349655359165e-01   -7.645924490165715e-02   +3.828521693834542e-01   -9.856986547411010e-03   -5.645518253922456e-01   -6.661996304654065e-02   +5.310928315193308e-01   +4.747138207762415e-01   +1.396474200662852e-01   +5.701807721323201e-01; +1.544474372063220e-01   +6.982033040906349e-02   +2.522520656491779e-01   -3.539810606732405e-02   -6.510333828435844e-01   +8.742462125533451e-02   -1.770992256762363e-01   +2.386399599182460e-01   -6.007372547227918e-02   +1.977782197087022e-01   +1.847549894975778e-01   +8.397434705043091e-02; +1.916936204710500e-01   -2.035752169113156e-01   +4.236511972222809e-01   -1.145342507362780e-01   +1.030491459507943e-01   +3.252505891616105e-02   +4.084987815516535e-01   -4.736515472643374e-02   -1.299904097249348e-01   +1.482649849008438e-02   +2.937059449284892e-01   +2.544392858278636e-01; -2.477201314526814e-02   -3.124972555041728e-02   -1.998832962835546e-01   -5.495509876263788e-02   +1.000000000000000e+00   +4.415265157888708e-01   +4.963721097181448e-01   +4.876500989194117e-01   +7.547927784653230e-02   -2.613734538717090e-01   +3.546633948416190e-01   -2.571206405448059e-01];
L2E_Input1_iAMPA_netcon = [+7.986996257283464e-01   +8.643890164935454e-01   +5.838998063141619e-01   +6.857418025645854e-01   +8.912397534554845e-01   +2.935399559089723e-01   +6.133494740634242e-01   +5.786725727312750e-01];
L2I_Input2_iAMPA_netcon = [+5.468115085131530e-01   +6.470078342708403e-01   +6.242270720721573e-01   +4.884075961901371e-01   +1.050813339064239e-01   +9.956616015034966e-01   -1.087861933356554e-01   +1.315851394654468e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
