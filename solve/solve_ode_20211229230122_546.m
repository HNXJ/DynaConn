function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.958068814444606e-01   -1.123358052128717e-01   +1.737850845763784e-01   +6.646760567332477e-02   +3.518958406012265e-02   +1.833552915808657e-01   +7.487863587811228e-02   +3.535523033341607e-01   +4.941068824581583e-02   +1.024763166406550e-01   +2.074247625391062e-01   +2.612123620621642e-02   +1.013671797632951e-01   +1.128036533780548e-01   +1.402849827650311e-02   +3.066673082360286e-01; +6.654472607426129e-02   +8.663398696369512e-02   +2.477631221456870e-01   -4.223823764957709e-02   +1.865080143828929e-01   +7.650769531904253e-02   +2.488287659472781e-01   +1.835522291099745e-01   +3.053719976900525e-02   +5.112806997452474e-02   +1.008569252888269e-01   +9.541897739963730e-03   +7.553197873919254e-02   +8.587832378151843e-02   +1.417388862586838e-01   +1.064593952368360e-01; +2.037704673911898e-01   +9.430945554512712e-02   +1.509418276792511e-01   +1.680038803497510e-01   +2.130835741229160e-01   +1.389125230981150e-01   +3.321855608405468e-01   +2.002441896484312e-01   +5.740391175016843e-02   +9.929897174675972e-02   +5.796993109906502e-02   +3.914719020388783e-02   +3.097981938088218e-01   +1.167229582328054e-01   +1.120716518367651e-01   +2.694236223774827e-01; +1.430288561503848e-01   +2.628918181827848e-01   +5.693185725539111e-02   +2.156216927231298e-01   -5.773783900044629e-02   -4.863440540908794e-03   +1.274734630030342e-01   +2.077174533131026e-02   +3.534998470924821e-01   +2.493108073070707e-01   +1.144714333843353e-01   +1.318375044541649e-01   +3.750300965314722e-02   -1.665937191428631e-02   +1.116532309441838e-01   -3.690301841866622e-02; +4.354325117498298e-03   +8.016590331178713e-02   -2.265789256790899e-02   +2.845621409385882e-01   -7.504722636663902e-02   +5.349794892962955e-02   -1.368282501773404e-01   +1.280704864184588e-01   -5.256729258977418e-02   +2.384866705026457e-01   +2.979364401483811e-01   +9.515049101129212e-02   +2.838848750027581e-01   +1.056953744503668e-01   +2.892856415295064e-01   +3.262859873340727e-02; +2.136937815755959e-01   +1.079514787882069e-01   +1.186852687985996e-01   +2.184416639208590e-01   +6.889318149765057e-02   +2.915602299611591e-01   +2.663650528849785e-01   +9.715457742601082e-03   +2.265094482661721e-01   +1.071922998431178e-01   +2.441721292021721e-01   -1.523293871554198e-01   +4.705505209694115e-02   +1.159878436156143e-01   +1.825152455808575e-01   +2.255215150366317e-01; +2.482261031720673e-01   -2.437743224275360e-02   -1.906835123142890e-02   +7.416250250781617e-02   +4.005012574121121e-02   +1.405705528499343e-01   +2.041156143440293e-01   +2.527121659038751e-01   -3.502678860680655e-02   -1.075054240985886e-01   +6.867808692138350e-03   +2.810547944609124e-01   +2.358302733407409e-01   -4.456133763779419e-02   -4.119172648505043e-02   +7.197530610068401e-02; +1.613587600099722e-01   +2.983843933883210e-01   +6.420970919298652e-02   +1.870992278815271e-01   +1.791909717866574e-01   +7.389470314511856e-02   +1.679824448042666e-01   +1.595475179304827e-01   -5.040462656667804e-02   +2.600536265150236e-01   +2.800190743274555e-01   +2.035194992176819e-01   +2.055511546182307e-01   +1.979297095281131e-01   +1.119515078631967e-01   +3.487347695478398e-01; +1.570112742855038e-01   +3.743979129261190e-01   +1.212980300508374e-01   +8.029993382117274e-02   +2.576115020474442e-01   +2.558483229637983e-01   +3.766894399435844e-01   +2.578476488604127e-01   +5.260154076707502e-02   +1.861825838880550e-01   +2.079399188604364e-01   +2.794164617737082e-01   +2.602330238255187e-01   -2.993649059368310e-03   +1.138027526629419e-01   +1.193745462570303e-01; -4.031219310660626e-02   -1.719483001963988e-02   -6.932954426315566e-02   -5.745176859092475e-02   +8.877138363544350e-02   +1.301907584675620e-01   -7.836162827721703e-02   -4.048641205784970e-02   +2.983578134187591e-01   +2.372636540233838e-01   +2.490169997339163e-01   +1.741127685312674e-01   +3.365915207633842e-01   +1.209981736119377e-01   +2.521824433298720e-03   +1.957187929556109e-01; +2.738213097275746e-01   +1.518001950744227e-01   -9.811584896731042e-03   +4.092802101857284e-01   +2.148997705647064e-01   +3.600923125974682e-02   -4.132985593537061e-02   +1.743182744496354e-01   +2.036146247351189e-01   +1.253388491850333e-02   +2.140158035270356e-01   -1.099211440801342e-01   -9.309230369949149e-02   -1.262015844384015e-01   -7.201356014809028e-03   +9.718310858633714e-02; -3.763133464171015e-02   +5.801832236178710e-02   -2.533752591978312e-02   +1.584143258282980e-01   +2.879621063217122e-01   +9.257800954861656e-02   -8.555824344751239e-02   +1.707889195051512e-01   +8.986398910024995e-02   -1.669961982155251e-02   +2.418273650389799e-01   +1.540395198677495e-01   +2.792982961284475e-01   +5.029586258175016e-02   -4.790652292373352e-02   +7.559842098422184e-02; +2.397112553433264e-02   +1.222761366999175e-01   -3.073926467199108e-02   -1.348002880908117e-01   +3.692314327468632e-03   +1.084502166611648e-01   +4.426821912303547e-02   +2.611380327307499e-01   +1.644270924078587e-01   -4.745585816173403e-02   +5.291794386698883e-02   -1.937934793334398e-02   +2.152442292762738e-01   +1.922602212294040e-01   -1.099892102962128e-01   +1.895727853707598e-02; -1.468534021198786e-02   +4.568583380505337e-01   +2.296518997640730e-01   +7.863800831267678e-02   +1.181992458690026e-01   +1.637877793869593e-01   +1.945477754715690e-01   +1.790167726820575e-01   +2.251655826928835e-01   +2.503236199209203e-01   +1.708014352821086e-01   +1.784716748086053e-01   +1.967128762689462e-01   -5.547341251102483e-02   +6.306087022236655e-02   +2.960691304247715e-02; +3.266680277595579e-01   +2.897735946042099e-01   -4.279720064908165e-02   +1.760223937794651e-01   +2.672852139958360e-01   +9.264973697085810e-02   +2.007494065528165e-01   +2.646599416781847e-02   -2.416309028746670e-02   +2.959006350949869e-01   +1.514610878370324e-01   +2.491113044432596e-02   +8.270680366268802e-02   +2.544053635508102e-01   +6.825626778289490e-02   +1.136887780481941e-01; -9.027406425134488e-02   +2.594548932828309e-01   -2.580604473355584e-03   -4.814248306988395e-02   -1.564222069921051e-02   +2.780297338763325e-01   -1.483147617088796e-02   +2.265156978220799e-01   -6.770826986430081e-02   +2.281565896121076e-01   +9.182526538476345e-02   +1.682364782260972e-01   +1.089038339322027e-01   +2.260250005442538e-01   +3.876567435114774e-02   +1.919822138955777e-01];
L1E_L1I_iGABA_netcon = [+2.040616965619799e-01   -2.256814957330872e-02   +1.004700144888480e-01   +2.738020133570062e-01   +1.254596316347606e-01   +9.203673515409330e-02   +1.584202603967710e-01   +3.887033306314920e-02   +7.927042920869076e-02   +2.581076253750137e-01   +1.629307319936578e-01   +2.114553343677168e-03   +1.187985703213564e-01   +3.133506826151240e-01   +2.858571270997212e-01   +1.688400460069365e-01; +9.325398079196240e-02   +2.104583729644147e-01   +5.466205448506685e-03   +1.208181414879550e-01   -4.256780006267312e-02   +3.096524393783386e-02   +1.707152562997975e-01   -2.420179950628806e-03   +2.314922038007709e-01   +1.691863193111169e-01   +1.594564649065695e-01   +1.145748328848536e-01   -8.429606788260227e-03   +1.084382316015682e-01   +1.202091977123838e-01   +2.369622931360105e-01; +1.555960999607456e-01   +1.541075581995021e-01   +2.196335817187494e-01   -5.284102690220090e-02   +8.441501733421222e-02   +4.103545684674095e-03   +3.621704911992856e-03   +1.495333703769132e-01   +6.980858119751543e-02   +8.695979766440221e-02   +3.162122717170526e-02   -6.308691102388536e-02   +1.908640853727150e-01   +1.283496106350717e-02   +8.484136738039595e-02   +4.854488052886511e-02; +3.671349545491056e-01   +2.528808080464311e-01   +1.374927864108237e-01   +2.673242985831020e-01   +1.055487219393349e-01   +3.623751412367353e-02   +1.053162769548911e-01   +2.958997106881919e-02   +2.417121246357521e-02   -5.198965648462603e-02   -3.939178994382914e-02   +5.265104342451494e-02   +1.866630634994485e-01   +1.654599722425266e-01   +1.465689594943634e-01   +1.689242066456024e-01; -1.791880793938927e-01   +4.375593250811887e-01   +1.039825727962260e-01   -8.117344263080754e-03   +2.246595125835593e-02   +3.117936990361145e-01   +2.454211506775995e-01   +2.544673566171792e-01   +1.029351646457004e-01   +2.411272210105519e-01   +2.887035189180905e-01   +2.837772681574074e-01   -1.085701079913790e-02   +1.041184558174065e-01   +5.081431239652239e-02   +1.471890785690996e-01; +1.667101623530637e-01   +1.599362498514245e-01   +1.888807512883412e-01   -7.315093692761716e-02   -1.036849721975804e-01   +1.399810729942087e-01   +8.759344852608296e-02   +1.031014071874635e-01   +1.112113732861362e-01   +2.197725037400098e-01   -2.729991944529895e-02   +3.529355282600963e-01   +2.761417725304010e-01   +3.176612091985933e-01   +1.192777949856667e-01   +2.752546495940432e-01; +2.115649761413571e-01   +5.558353438891081e-02   +2.962125289603337e-01   +3.047845630458695e-02   +2.636278643008227e-01   +1.627707479357489e-01   -5.228650737456417e-03   +6.286426012572366e-02   +8.049829576519989e-02   +1.035993608248819e-01   -2.382325021923249e-02   +3.994794609833156e-02   +2.071088410362079e-01   +2.567608990821475e-01   -1.026005984529513e-01   +1.820829666357532e-01; +1.565514836981278e-01   +7.804547314007551e-02   -2.987227505600047e-02   +1.843281793388749e-01   +3.607879260391054e-01   +1.834532829226599e-01   +1.312548211771870e-01   +2.527751702908538e-01   +1.832110899084837e-01   +1.221014578332769e-01   +8.646760886287566e-02   -4.812942087628367e-03   -4.820903836828729e-02   -5.941432484839219e-02   -3.449869759845961e-02   +2.958799513865850e-01; +2.193262184869673e-01   +2.002992873449871e-01   +1.929567965837565e-01   +1.260183955176749e-01   -4.254455507689155e-02   +2.264421608430772e-02   +2.960468422985467e-01   +6.320355391378081e-02   +2.028064872547401e-01   +2.253062789755154e-01   +1.058170070534247e-01   +8.275269110570647e-02   +2.055573882017802e-01   -9.564430141126037e-03   +8.358108693527710e-02   +9.238417524675129e-02; +3.259743609996600e-02   +1.729313050577970e-01   +2.571058137112563e-01   +2.697413883402324e-02   +2.459779991636832e-01   +2.170719236409767e-01   +2.134666697990733e-01   +1.998631577207578e-01   +2.191483483233459e-01   -9.307597398919877e-03   +3.279593450913115e-01   +1.961057563949465e-01   +1.241092164719072e-01   +1.468502065369470e-01   -2.717725639310840e-02   +2.165282993969559e-01; +2.273200143448153e-01   +2.760225799714088e-01   +1.951952067410372e-01   -2.815655121740124e-02   +8.797662743580932e-02   +2.567420090839332e-01   -5.956798524334086e-02   +1.100590655579880e-01   +2.017914689374621e-01   +1.465979937512695e-01   +2.250470493891599e-01   +6.563216615911920e-02   +1.747939483172606e-01   -7.776441307493115e-02   +3.228832291165445e-01   +8.168637930959338e-02; -2.456237495615269e-02   +1.168320597732031e-01   +1.728003358474327e-01   +3.540163628178633e-02   +2.757658520746464e-01   +1.072652909005357e-01   +1.245568451026576e-01   +1.062939342073232e-02   +1.826017008184763e-01   +3.985530766075665e-02   +3.307229529727788e-01   -2.219262263044385e-02   +6.322142938218651e-05   +2.178834150184021e-01   +4.525386519272939e-02   +3.373938405209860e-03; +1.747725811227179e-02   +1.689769187678355e-01   +1.078295842648450e-02   +1.423289304416442e-01   +7.029968423591046e-02   -1.219590044509392e-02   +1.086698424851608e-01   +2.332265278119805e-01   +1.130998729774740e-01   +2.373500072370635e-01   +1.880832422227452e-01   +2.335417683312754e-01   +1.564970144196720e-01   +1.484029179723476e-01   +2.560976899841927e-01   -1.777952969040921e-02; +1.674622272395871e-02   +7.763115656445355e-02   +2.309025060758247e-01   +1.098278458725341e-01   +2.505440677331238e-01   +1.999641102048400e-01   -1.467807420753914e-01   -5.920768514344166e-02   -1.103290162033470e-01   +1.302864040878637e-01   +3.306780676916529e-02   +1.171720368841645e-01   +1.524899557536104e-02   +2.127858407068830e-01   +2.666168107129446e-01   +2.357907874882462e-01; -1.114969912080558e-03   +5.137382983594702e-02   +2.944162273766023e-02   +1.618954829985165e-01   +2.286976600102404e-01   +1.082125644086312e-01   +1.487427487843268e-01   +2.418042655404122e-02   +1.937986037958246e-01   -2.959238259821335e-02   +1.309545937736114e-01   +3.288907698210581e-02   -1.935726703515205e-02   +1.157403643033389e-01   +1.051840642226697e-01   +1.065918070866034e-01; +2.246672380995693e-01   +1.357763616889284e-01   +5.871605540602568e-02   +1.740686132889762e-01   +1.077914490446314e-01   +1.371028899827144e-01   -1.349792613102424e-01   +1.273287885449041e-01   +1.281128107421567e-01   +1.097701158747156e-01   +6.150020110953462e-02   +5.769882409077221e-02   +8.935969547302389e-02   +3.456995383620070e-01   +1.699830883590780e-01   +2.186025086126402e-01];
L2I_L1I_iGABA_netcon = [+3.643402858411641e-01   +2.118538535808874e-01   +9.624518899171400e-02   +3.430295402427667e-01   +5.333929471223310e-02   +2.634606299623386e-02   +7.514365558342465e-02   +1.768032685842791e-01; +2.409491081827427e-01   +2.153801327601672e-01   +2.844554711432420e-02   +1.780232778523483e-01   +1.213410967850945e-01   -2.556371560445431e-02   +5.350870984145430e-02   +2.450488839308268e-01; -8.097150416235377e-02   +2.265092979695126e-01   +1.560355539073759e-01   +2.384366121823782e-01   -2.202109578010328e-03   -6.049700974077508e-02   +1.635714200588617e-01   +1.858298938798014e-01; -1.896150686098669e-02   +7.607779034273081e-02   +2.715976096048387e-01   +1.499915563316270e-01   +9.048962825079308e-02   +3.664409111463904e-01   +7.940079078819404e-02   +8.839376404934082e-02; +3.057410605903761e-01   +2.514285268518970e-01   +6.464809533135231e-02   +1.554737550059674e-01   +7.154184959055307e-02   +2.773401964241682e-01   +1.613796632424521e-01   +1.784472728777248e-01; +2.243865623963425e-01   +1.425258364141891e-01   +2.069276128266121e-01   +2.530784058240060e-02   +7.768172876811280e-02   +9.871787191029807e-02   +1.616628832314038e-01   +9.849326863384432e-02; +4.605357481499807e-02   -5.178107908141779e-02   +7.931619058757680e-02   -1.109434691305070e-01   +7.186227064231146e-02   +2.215937756969423e-01   +1.767100845402601e-01   -9.005648100356872e-02; +4.902493658549424e-03   +2.532182358256172e-02   +2.786042727598009e-01   +1.690087908270081e-01   +3.042308174094367e-01   +3.222260814343082e-02   +1.150983930865108e-03   +4.934720296945978e-02; -1.925752595698765e-02   +1.293709996061740e-01   +1.319854750671964e-01   +1.291928538001391e-01   +1.076950328141967e-01   +3.658203189862117e-01   -4.383893307009705e-02   +5.579224844240308e-02; +7.622319471512717e-02   +1.522157764483117e-01   +2.164022475879725e-01   +3.258084401566497e-01   +1.226467879038205e-01   +3.996290227652069e-01   +3.324551395029480e-01   +2.578803133502761e-01; -2.333394758412758e-02   -5.933989711813650e-02   +2.439935042896756e-01   +3.045083716979234e-01   +1.628847196618636e-01   +1.747976943997938e-01   +2.138934536926718e-01   -4.781150954162110e-02; +7.469205568076051e-02   +1.300656980404797e-01   +3.268614219136615e-01   +4.026523639190441e-02   +2.467555047006591e-01   +2.259241235151287e-01   +5.477447997901976e-02   +1.002590080152231e-01; +1.203761772765915e-01   +1.712950526534547e-01   +2.332964068541285e-01   +2.404561481638989e-01   +1.667089232655691e-01   -5.238969616190661e-02   +1.408035594260274e-01   +1.674296104763682e-01; +3.367350635843528e-02   +3.076775036693713e-02   +2.724428860779229e-01   -7.070245886930790e-02   +1.290521903451791e-01   +2.223489969410113e-01   +1.779865807354839e-01   +1.583776483103020e-01; +3.080572924264799e-01   +3.394715550563960e-01   +1.814653150154587e-01   +3.961287157016286e-02   +6.740787823330867e-03   +4.986588015654207e-02   +2.996840068656741e-01   +9.353924491350965e-02; +3.108580413497065e-01   +1.098637173445689e-01   +4.115359796895701e-02   +5.137722527125102e-02   +2.704923315019857e-01   +7.856686685931033e-02   +6.000037978622464e-02   +9.615739965537368e-02];
L1I_L2I_iGABA_netcon = [+2.195795891290721e-01   +1.348616279623594e-01   +1.530147642064957e-01   +2.534642380455270e-01   +2.729607142862844e-01   +1.480681507264069e-01   +1.423969188360405e-01   +7.305361879206869e-02   +1.879817138467669e-01   -1.609432484824323e-01   +1.795851819033281e-01   +2.302933381071930e-01   +4.735494073392155e-01   +9.490808184322272e-02   +3.472429360375687e-03   +1.763031123492314e-01; +2.991478600528917e-01   +2.073700306349835e-01   +2.937816973720663e-02   +3.077839172776271e-01   +2.440825611025220e-01   +1.384586929652241e-01   -5.870829793638964e-02   +5.466889088978373e-02   +3.399213999548111e-01   +3.117728716414813e-02   +1.582728617182007e-01   +1.217818244728574e-01   +5.062030592678548e-02   +1.043606313243215e-01   -2.206701380551814e-02   +2.021491421802883e-01; +2.183471050928324e-01   -8.778270123929793e-02   +2.504218684727284e-01   +1.086047168910053e-01   +3.119240619391749e-01   +2.762108282377470e-01   +3.421686573179591e-01   +9.039979976489139e-02   +1.981484971999596e-01   +2.004385958848046e-01   -9.968147486668232e-02   +2.936762094690146e-01   +2.194231252760632e-01   +8.741528774578533e-02   +1.475739347028552e-01   +2.932772453449201e-01; +3.733265506834423e-02   +1.165911145606867e-01   -5.510354826179301e-02   +2.157283956138902e-01   +1.586254147825514e-01   +2.031238037279504e-01   +2.141408268855184e-01   +2.120030152973396e-01   -6.062863193406605e-03   +2.154344084101036e-01   +1.111150670982941e-01   +4.111453569247545e-02   +4.277928337844419e-02   -1.124368416756811e-01   +1.151789127573730e-01   -9.780400930732474e-03; +1.076210997125463e-01   +3.449357949925321e-01   +4.019255347936447e-02   +1.432487993749386e-01   +5.539452395177766e-02   +2.098375633403728e-01   +1.568087449561724e-01   +1.933419511636985e-01   +8.372173286130037e-02   +4.838118149314407e-02   +1.267244596122568e-01   +1.287096474732019e-01   +5.732573404077887e-02   +1.071438193406365e-01   +3.419681859314099e-01   +1.391572659905575e-02; +1.377732182940806e-01   +2.420308538511415e-01   +1.182900004992685e-01   +2.043616366672666e-01   +2.074799828605017e-01   +4.885607233436620e-02   +5.833484796009705e-02   -3.472798396869281e-03   +2.674646614428051e-01   +3.116902876202197e-01   -4.278971834294401e-03   +1.171562014377753e-02   +9.116731424022871e-02   +1.853905910132297e-01   -3.113087512236346e-02   -4.992073652119133e-02; +2.537740883438676e-01   +2.592058228421660e-01   +8.295986889008358e-02   +3.093554900679406e-01   +2.069719022072796e-01   +1.358404052546219e-01   +2.630498455864103e-01   +1.561777617576744e-01   -2.981389201682951e-02   +1.579608462933317e-01   +1.516089598839727e-01   +1.566036603782283e-01   -8.189277913347051e-02   +1.799284308419306e-01   +2.222090213950728e-01   -8.145259101125785e-02; +8.791631548246542e-02   +2.383676125943856e-02   -4.678213198413583e-02   +3.167814861352996e-01   +2.322392735412782e-01   +6.049955883721067e-02   +9.678451434920179e-02   -2.994760250581608e-02   +1.568003967810124e-01   +8.373812883478804e-02   +1.953947809482339e-01   +1.841630893388956e-02   +1.564289738581667e-01   +1.773417241207807e-01   +7.214271641874734e-02   +1.156356766200276e-01];
L2E_L1E_iAMPA_netcon = [+2.174906100384075e-01   +2.375501045924089e-01   +2.764659444574850e-01   +1.190644304281228e-01   -3.504129969607769e-02   +1.108860516681105e-01   +1.314221936570303e-01   +2.921823801700522e-02; +1.355608881322083e-01   +2.325165419300765e-01   +4.274463903406728e-02   +1.657451029370826e-01   +2.153320165902526e-01   +2.433944518543692e-01   +3.492672151344308e-01   +2.687740012128683e-01; +2.928927642923104e-01   +2.151281388312554e-01   +8.136226721604800e-02   +1.624974603073235e-01   -5.710041012518761e-02   +3.432822256515439e-03   +2.286683763503379e-01   +3.016219706525944e-01; +3.385762201082518e-02   +3.574151929795737e-01   +2.377839216977603e-01   +1.658913284330851e-01   +3.155090342542639e-01   -1.149371781542541e-01   +1.259415937899677e-01   +1.676832518641021e-01; +6.729713406524490e-02   -4.451835402656769e-02   +2.064006401235746e-02   +2.018904752494027e-01   +2.350320886048851e-01   +2.215303664173216e-01   -3.103874942032478e-02   +2.773165434888853e-01; +2.102670608194937e-01   -6.050895590630556e-02   +1.250737554124149e-01   +5.379597288425864e-02   +3.084234747679453e-01   +2.840189789971466e-01   +2.260341615478972e-02   -4.042377761435582e-02; -9.582700463235250e-02   +2.283962334206520e-01   +3.997228819780718e-02   +1.960085610607018e-02   +1.089735011630702e-01   +1.086191739089412e-01   +1.607818008064507e-01   -8.678754744960616e-03; +3.287681766708430e-03   +2.738441269319466e-01   +6.981106353798645e-02   +1.472153753775045e-01   +1.923695537493584e-01   +2.273374271656094e-01   +2.879656468456359e-01   +2.567508355355956e-01; -4.203025751557356e-02   +2.820026044725250e-01   -1.168900072560788e-01   +1.574720917075975e-01   -1.051556076982948e-02   +6.072992161825176e-02   +2.748551449818303e-01   +5.526814625252183e-02; +2.453013449997781e-01   +2.535943949544278e-01   +1.638735014227911e-01   +2.568458283138765e-01   +1.021239391298883e-01   +2.269017504943662e-01   +2.476540003194938e-01   -9.317978966842055e-02; +1.937900619433079e-01   +1.914273865671155e-01   +1.342446426914932e-01   +1.785945986105598e-01   +1.045810564121901e-01   -1.642106744573099e-02   +1.957990174960019e-01   +4.425305806202130e-02; +1.775653003257287e-01   +2.771906805226632e-01   +6.273706361512540e-02   +1.943114868138283e-01   +1.563579206516951e-01   -3.993039001021793e-02   +1.730098804711055e-01   +1.715594366920183e-01; +4.791401810253881e-02   +1.478195216304349e-01   -3.124976862886372e-03   +4.664145939613977e-02   +9.606415805243013e-02   +1.527934892137575e-01   +1.710354708802942e-01   +1.096383805094535e-01; +1.521032074060996e-01   +6.536520477759003e-02   +1.569322381578200e-01   +8.859676900349620e-02   -1.047443108391496e-03   +1.280735160700295e-01   +1.116752074962505e-01   +2.390643343613627e-01; +2.987153791796569e-02   +1.333889688564862e-01   -7.442884331970516e-02   +1.103011812623091e-01   -1.933486599441832e-01   +5.222874657568906e-02   +1.290862555139191e-01   +4.894982302020308e-02; +6.008315611788068e-02   -1.552488959932079e-02   +2.590074303287758e-02   +4.767159677897519e-02   -3.740049317419750e-02   -1.126782458302698e-01   -1.668139534770639e-02   +7.632612071227196e-02];
L1E_L2E_iAMPA_netcon = [-1.079860430126215e-01   +1.030063827328384e-01   +7.767416680315005e-02   +9.089571526962437e-02   +2.361806659751910e-01   +2.981932075145133e-01   +3.662412772222113e-02   +1.928662098673611e-01   +8.432053477590894e-02   +1.486800213986719e-01   +2.594759882185089e-01   +2.695283498310344e-01   +2.539791061259701e-01   +4.933571358510686e-02   +6.232286791128003e-02   +1.387326748461365e-01; +3.160166943726731e-01   +1.138112253149807e-01   +2.437438786297942e-01   +2.322198387068214e-01   +2.246274751472964e-01   +3.272844095826469e-01   +2.679729684361997e-01   +1.633377774227269e-01   +8.343034440898653e-02   +1.111658504031514e-01   -4.571124519785184e-02   +2.072666875169573e-01   +2.622182413377619e-01   +2.698997808132949e-01   +3.595300448461290e-01   +2.054567143294901e-01; +5.071711885455876e-02   +9.255748701841904e-02   +3.496171472722471e-01   +3.138394065800799e-01   +3.815689003176018e-01   -8.794776193608747e-02   -5.340505239715179e-02   +1.359057075672528e-01   +1.488562062446950e-01   +2.123893347754325e-01   +3.080884891433321e-02   +1.016161382896217e-01   +2.059448495497281e-01   +1.427756511267037e-01   +5.864434530736213e-02   +2.193665150754763e-01; +1.942164864281516e-01   +1.194230225126017e-01   +2.168460011022288e-01   +2.397377095248014e-01   +1.346622275313724e-01   +1.102645807328805e-02   +3.684727166920833e-01   +2.579841279798624e-01   +1.122269385349138e-01   -5.147173255252482e-02   +1.330172229908608e-01   +1.861686060028599e-01   +1.689812532283621e-01   +7.523010479193169e-02   +3.059354177873022e-01   +2.227171920023095e-01; +2.240092057838379e-01   +4.035610419195956e-01   -1.843590728258877e-02   -9.427150838333972e-03   +2.177573424090061e-01   -5.176789799416157e-02   +9.677412281566256e-02   +2.070052939145166e-01   +2.436731758120865e-01   +7.381782304020404e-02   +1.604617205221960e-01   +7.606333580272941e-02   +1.782057038310288e-01   +7.457011898037876e-02   +3.210984712407230e-01   +2.498515216241040e-01; +1.203943892614276e-01   +2.504944034334681e-01   +1.163534510945631e-01   +9.096266464261626e-02   -9.940562865566765e-02   +9.787830156200762e-02   +4.075155136228708e-01   +3.117248404931813e-01   +1.893881570771960e-01   +2.547176351225462e-01   -2.072792974191286e-02   +1.084382893989870e-01   +6.461024878704480e-03   +1.287675792108439e-02   -1.907974127946375e-03   +7.516854551925017e-02; +3.041001581055878e-01   +1.869552532133696e-01   +1.828030063714195e-01   +1.375147315448016e-01   +4.492565485117508e-01   +2.522564439446729e-01   +6.756352581399912e-02   +5.088556340875743e-02   -1.509288818410059e-03   +5.665989117530591e-02   -4.151958152677750e-02   -9.277755630870158e-02   +2.624631499063774e-01   -3.779233849766374e-02   +1.504548274804173e-01   +4.863648413848012e-02; +2.437165315764568e-01   +1.604314222965934e-01   +8.663810962099641e-02   -1.278896284767358e-01   +5.647398004252916e-02   +9.354894091321121e-02   +2.309121926772844e-01   -6.102788923260851e-02   +3.166053849551192e-01   -1.481469189843335e-02   +2.315407278331895e-01   +1.133764646512243e-01   +4.525258466774120e-02   +1.151163244781073e-01   +1.874899878980194e-01   +2.899845502539145e-01];
L2I_L2E_iAMPA_netcon = [+4.162957339551948e-01   -7.148874346875281e-02   +8.266614242821706e-02   +2.722187156792726e-01   +5.065321316410602e-02   +2.648997159354886e-01   +1.150025702782408e-01   +1.360562091913298e-01; -5.110564286578298e-02   +3.518456322092069e-02   +1.983157265788451e-01   +2.106427436356467e-01   +1.323987847842675e-01   +3.218655479464577e-02   +2.994977646154551e-01   +7.557284946422882e-03; +8.490120465261233e-02   +7.783821498675916e-02   +1.924967052873115e-01   -6.979168939952624e-02   +3.589792037253081e-02   +3.405742039238821e-02   +2.310012898709160e-01   +2.279462020741918e-01; +6.898076395302419e-02   +1.897549767973293e-01   +1.126595912432099e-01   +1.352799858129760e-01   +2.710827536824090e-01   -2.080664053727491e-02   +4.559041005374770e-02   +2.469990400804369e-02; +2.037040097004696e-01   +2.475916708006405e-01   +3.349690596545279e-01   +1.820519787337494e-01   +2.392787931771060e-02   +2.197091364592964e-01   +1.264438091401332e-01   +3.593113854882059e-02; +2.935693914792326e-01   +2.312143450082651e-02   +2.297443658618763e-01   -5.561026099605380e-02   +7.706548744382761e-03   +4.267087171374700e-02   +1.035834724124401e-01   +7.397835147987428e-02; +1.187725283101526e-01   +1.354145136252093e-01   +2.485076681350938e-01   +3.181754213068467e-01   +1.000684090952544e-01   +2.273385323033419e-01   +2.208416147658553e-01   +1.128178349281386e-01; +1.794364692660735e-01   +2.806391320885904e-01   +2.116638117374123e-01   +1.945013607863883e-01   +2.434862948083104e-01   +3.118977854902136e-01   +2.729103386433639e-02   +1.171823223862514e-03];
L2E_L2I_iGABA_netcon = [+2.133996699299706e-01   +7.975232934043509e-02   +1.021486447622281e-01   +8.139818002144830e-02   +9.698226892012322e-02   -7.989259702299981e-03   +2.256859569732662e-01   +1.153468999585127e-01; -1.065030481724693e-01   +1.765460166882060e-01   +8.358320250450831e-02   +1.385897381868089e-01   +2.036504991494033e-02   +5.975571588448570e-02   +2.479758661689752e-02   +2.727341965200322e-01; +4.325331882048198e-01   +8.096048473701090e-02   +1.530310433978943e-01   +2.792994950757509e-01   +1.400563505728128e-01   -2.183425658519384e-02   +1.744792009194761e-01   +1.793180117971624e-01; +1.820327835987908e-01   +2.731500595833427e-01   +3.164755526845414e-01   +1.736068713380755e-01   +1.395471558965947e-01   +2.578573195454511e-01   -1.036725496450255e-01   +2.406101755969382e-02; +1.856332655888894e-01   +1.765930757328740e-01   +3.436080685992761e-01   +3.146497437162071e-01   +2.777842434836719e-01   -5.886526909424535e-02   +1.303035080496079e-01   +1.432609926300388e-01; +2.880428905769725e-01   +3.304507838397935e-02   +1.475474047124083e-01   +2.272702247146885e-01   -1.872859687971553e-02   +3.053848019834911e-01   +6.957042018922226e-02   +2.522325659071429e-01; +1.836383101419783e-01   +1.155165284694168e-01   +1.541141968613932e-01   -2.078985842769557e-02   +1.923555508594395e-01   +1.054229765248686e-02   +3.069030484679339e-01   +2.371035048287756e-01; +7.587219716019070e-02   +7.540728287143106e-02   +1.293503050514802e-01   +1.854509319625635e-01   +6.948493348926464e-03   +5.466328175876097e-02   -1.243634051996684e-02   +2.315617747133745e-01];
L3E_L2E_iAMPA_netcon = [+1.491161720270295e-01   +2.144128753132842e-01   +8.014312740775609e-02   +5.857297858627910e-02   +2.785460427005573e-01   +7.620449498184817e-02   -5.606087882845900e-02   +1.275105093407037e-01   +6.227551432220174e-02   +2.364774821384468e-01   +1.419835266933614e-02   +4.702062271303573e-02; +1.625050631009474e-01   +1.649810442189925e-01   +2.506961407149891e-01   +1.400520844881565e-01   +1.459835356993573e-01   +2.479164056602051e-01   +1.020827077803217e-01   +1.155024083586627e-01   +1.857963700672696e-01   -1.447490285413116e-02   +4.318254154825017e-02   +3.118325220725996e-01; +1.330967777018791e-01   +2.092297810285921e-01   +2.929714538734112e-02   +8.026197910763946e-02   -4.189587252396913e-02   +1.525096440497513e-01   +1.512841195624475e-01   +2.138165367825234e-01   +1.397080606592459e-01   +1.183598209511778e-01   +3.186123592144124e-01   +5.509495054886087e-02; +1.755874850127284e-01   +6.320636699570308e-03   -1.278923480394070e-02   -3.669758683576466e-02   -8.288724652651516e-02   +3.785207008680845e-01   +2.293893614243852e-01   +3.270666709075302e-02   +1.362035933497892e-01   +2.532826981117888e-01   -8.591030290812093e-03   +1.928878058495927e-01; +7.494341041212925e-02   +1.797450007233496e-01   +2.417022190306383e-01   +1.015539566966147e-01   +1.444345434885276e-01   -5.663386444605407e-02   +1.572967682799908e-01   +9.077265295556422e-02   +2.100254375767375e-01   +8.461266674849227e-02   +3.394054430606323e-02   -1.837627749619439e-02; +4.910006074658796e-02   +3.026697407147717e-01   +4.717389955885493e-02   +1.499121386211683e-01   -8.301018418693608e-02   +3.507279532661760e-01   +8.513130381401067e-02   +1.549946050648069e-01   +1.263913835123505e-01   +1.506521467545136e-01   +7.776350310780382e-03   +1.766911317484008e-01; +2.588733235309721e-01   +1.361492944462824e-01   -8.793158139303797e-02   +3.807622069157651e-02   +3.176757414696932e-01   +1.457056682054027e-01   +1.611159088557952e-01   +9.223685304646292e-02   +4.057404819075080e-01   +1.808753892720907e-01   +2.293293170687503e-01   -3.265823965987183e-02; +2.376242761147680e-01   +3.104125676591142e-01   +3.674505137012224e-01   +9.025272215014082e-02   +7.551038771368702e-02   +8.886852983000600e-02   -5.994960112810525e-03   +1.076827612990557e-01   +2.173866689296796e-01   -6.010309020644170e-02   +2.185875779841975e-01   +9.033454861316779e-02];
L3I_L2I_iGABA_netcon = [+7.911609971178332e-02   +4.729142789471536e-02   +2.488416876065973e-01   +1.328618871815265e-01   +2.067097965040957e-01   +1.885301439840374e-01   +1.892402601458034e-02   +2.254840459226536e-01   +2.837369437764249e-01   +1.217090939256154e-01   -5.889815984479571e-02   +9.288705547171530e-02; -1.221065430294354e-01   +3.916567025291506e-01   +2.522260887634283e-01   +1.582017488504661e-01   +1.382203907035321e-01   +2.753699815752833e-01   +1.763547896532341e-02   +1.301972978647156e-01   +2.130546751192267e-01   +1.267849768718081e-01   +1.525817632936037e-01   +1.444116171619934e-01; -4.979262960502065e-02   +1.585839741865104e-01   +2.374217608972116e-01   +2.656851578388372e-01   +2.116542252816131e-01   +1.668266634914314e-01   +2.655986030480688e-01   +2.907739038114974e-01   +1.300520395476036e-01   -4.616817318760497e-02   +1.901646502090513e-01   +5.407713223875880e-02; +2.894240528050097e-01   +3.767390373224684e-02   +3.327706379075636e-01   -9.218881516957006e-02   +2.904450694718239e-01   +1.791402875205392e-01   +2.738553962894413e-01   +2.622364236090017e-01   +5.291677027744277e-02   +5.559861561529866e-02   +2.683262010002171e-01   +1.126677940010101e-01; +6.542709549626660e-02   +6.255573595711578e-02   -4.765781323570417e-02   +6.237380679601177e-02   +3.729252108267546e-02   +5.180076794227108e-02   +6.082751680548105e-02   +2.218714699759268e-02   +6.865150909670112e-02   -2.980755014263949e-02   +1.209687640780553e-01   -4.528712621878955e-02; +4.372624684335380e-02   -4.407170688087561e-02   +1.825309600069877e-01   +9.549111748395916e-02   +9.790643988592165e-02   +9.066336056732809e-02   +8.929699024923615e-02   +1.718184702411668e-01   +1.246388277133685e-01   +3.685427475297358e-01   +1.558462081779435e-01   +2.492964325765589e-01; +3.034276281568817e-01   +1.572454561218448e-01   +1.010563425807430e-01   +3.152974367867869e-01   +8.462780456978532e-02   +1.862644794865432e-01   +2.879287306495574e-02   +5.529344498722671e-02   +1.238414521997253e-01   +1.454878655732370e-02   +2.868441901630034e-02   +2.806532022511283e-01; +1.545302389623875e-01   +3.965470814214594e-02   -7.754352980101772e-02   +6.382514978684728e-02   -8.182700147960262e-02   +1.130644904432900e-01   +1.811392624441195e-01   +9.329928025991757e-02   +1.711966450981870e-01   +3.795568454840667e-01   +2.574732694778012e-01   +5.495995453845989e-02];
L2E_L3E_iAMPA_netcon = [+5.297508666250511e-02   +4.935986321375102e-02   +2.120835343910055e-01   +3.262027381578486e-01   -1.441743881421053e-01   +2.230448917689912e-01   +1.376492548957743e-01   +1.333580624454112e-01; -1.267089501090887e-01   +1.097240993904518e-01   +1.537633193899151e-01   +1.477015485104193e-01   +3.680758155231724e-01   +1.683143204361057e-01   +2.514353442138073e-02   +2.051338831071559e-01; +1.176786705756865e-01   +3.674848566465475e-02   +2.513838259134085e-01   +1.530285949054086e-01   +1.782045158976152e-01   -9.619464612978473e-02   +2.549845041306523e-01   -2.304158335343937e-02; -5.052449613411843e-02   +9.443931394467350e-02   +3.883972557497507e-02   -8.164073675888318e-02   +1.699724703512699e-01   +3.333410683386435e-02   +3.446861099702879e-01   +2.117062965764380e-01; +1.635103543286990e-01   +2.300704232268041e-01   -2.743466764064196e-02   +1.637877825998437e-01   +2.325986042719849e-01   +6.095440050578151e-02   +1.695900463244345e-01   -1.898662323521309e-02; +9.390715309519526e-02   +1.380913023390954e-01   -2.657188344994716e-02   -1.180010579468746e-01   +5.945216719085534e-02   +2.649296173073859e-01   +1.651585183479486e-01   +9.442351708058339e-02; +9.884979990729753e-02   +1.275698662343721e-01   +1.969502031522823e-01   +5.862785754838462e-02   -1.782931207849308e-02   +1.724546880274038e-01   +4.291817910022105e-02   +6.265898722849149e-02; +2.848032962490236e-01   -4.793704246780781e-02   +8.741553703683788e-02   +1.111662750710607e-01   -6.439943543523095e-02   +1.336084083707219e-01   +6.999168120247011e-02   +1.335205921320825e-01; +1.154495712675846e-01   +1.157919967383737e-01   +1.677735904426978e-01   +2.248521865808052e-01   +1.875545567626293e-01   -7.735457584618043e-02   +2.631864352074608e-01   +1.331592733931025e-01; +8.857129457238698e-02   +1.504787913505519e-01   +8.343240636957876e-02   +3.345908810599466e-01   +3.024026537742424e-01   +5.881976491012694e-02   +3.388682805391464e-01   +2.694600882940387e-01; +1.518713340780400e-01   +1.756357742004088e-02   +1.553313634404704e-01   +1.230991376270086e-01   +5.616953907597388e-03   +6.354897811273844e-02   +8.478552407761067e-02   -2.590558371426088e-02; +2.455813986355237e-01   +1.527550054021576e-01   +7.678185112721249e-02   -6.175403405512620e-02   -8.851803480445838e-02   -1.179778579020938e-01   +2.829656736678018e-01   +5.298364432568660e-02];
L2I_L3I_iGABA_netcon = [+1.321007890131461e-01   +3.248664942044889e-01   +1.223265656408960e-01   +2.124419104484765e-01   -1.388308124818130e-02   -1.226845471002135e-01   +1.410492075070983e-01   +2.357369150741913e-01; +1.006730273765555e-01   +2.717746429536748e-01   +1.196940950460840e-01   +1.616809516166504e-01   +2.992832742597086e-01   +2.152300955831750e-01   +2.059500080052761e-01   +1.517757493826921e-01; +9.723774162995399e-02   +1.867979490628232e-01   +1.436614899118681e-02   +2.883630442492019e-01   +3.010346620945121e-01   +2.040175066851302e-01   +2.542763368043315e-03   +1.092578231952734e-01; -1.596144587950848e-02   +1.527489847548936e-01   -4.195153897452102e-03   +3.956037318770328e-01   +2.127248773838692e-01   +2.518884384052553e-01   +1.677760665776538e-01   +1.918639228684513e-01; -1.489507933681589e-02   +1.254650552411941e-01   +3.742183107598560e-01   +2.056289384042187e-01   +5.632653773277366e-02   +2.687769580224680e-01   +2.116467517092161e-01   +1.357646742335128e-01; -4.034658795680068e-02   +7.187025524594010e-02   -5.876120011901996e-02   +1.608843653258949e-01   +2.663982228663748e-01   +1.444548713866613e-01   +1.829745819041853e-01   +6.670862593593141e-02; +1.119773488238529e-01   +2.627902025265404e-02   +2.271024408979729e-01   +2.748504949636363e-01   -6.245249415343605e-02   -5.114634687173760e-02   +7.006013778870059e-02   +1.701211409191280e-01; +1.134018655601186e-01   +3.911927863527430e-01   +4.229479396037448e-01   +1.165237473887181e-01   +5.162948188434874e-02   +2.342167110110009e-01   +5.744632651133145e-02   +2.557450932770992e-01; +3.113522501858565e-01   +1.825222327948527e-01   +8.153210806617989e-02   +2.667784481805270e-02   +2.026963845426825e-01   +1.378379848819361e-01   +2.814005426433459e-02   +1.520351896337792e-01; -1.544377314899305e-02   +6.975833923043237e-02   +3.530571218208472e-02   +1.999214215902300e-01   +1.059765833062573e-01   +9.512406019232025e-02   +1.252615077884960e-02   +3.111272067344819e-01; +2.474214261155094e-01   -4.124928245998195e-02   +3.263982919963503e-01   +8.506122723832764e-02   +2.687829579273801e-01   -1.443974519606526e-02   +1.070437512475178e-01   +1.355526415813990e-01; +1.394858196275212e-01   +7.047647544968748e-03   +2.000776560940522e-01   +2.859141454232116e-01   +1.817194400370644e-01   +2.222660020765205e-02   +1.388783674831630e-01   +3.065417708265794e-01];
L3I_L3E_iAMPA_netcon = [+2.489668953163743e-01   +1.706121100865499e-01   +6.570428684969314e-02   +1.486167659203033e-01   +9.544921209998913e-02   +6.445842671315652e-02   +1.838435325656297e-01   +1.821407953095326e-01   +1.508347572001499e-01   +4.957674948663152e-02   +7.142775906646096e-02   -2.867721617921348e-02; +1.764549676611796e-01   +1.021912102647377e-02   +1.230369779531938e-01   +3.455587620590175e-01   +4.417533416384008e-02   +5.793337832772544e-02   +5.447599613494235e-02   +8.778830078069753e-02   +2.041725453624642e-01   +7.507629076034605e-02   +6.222040239913291e-02   -3.292289609787034e-03; +2.391015643496947e-01   +3.294039584726893e-01   +2.258394785211698e-01   +9.857408743430622e-02   +2.067161633611195e-01   +6.192119286862901e-02   +2.641243183205241e-01   +1.338729791896532e-01   +9.659714512931360e-02   +4.075851776982561e-02   +1.193478572845125e-01   +1.603948097485236e-01; +2.618305680122375e-01   +1.310345602939376e-01   +6.755753939829773e-02   +1.213869267754943e-01   +1.829913039257483e-01   +2.845309071593168e-01   +5.808699647578495e-02   -4.929283957726868e-02   +3.767014747540580e-01   +2.649971712091219e-02   +3.115929827417017e-02   +1.448833096927840e-01; +1.927280216086746e-01   -9.585505927787677e-02   -2.878654579309405e-02   +3.123453897935692e-01   +1.612956692000690e-01   +2.189269290868267e-01   +3.732245631596752e-01   +2.657121386122333e-01   +1.870303282009622e-01   +6.397601909439682e-02   +1.960386633489342e-01   +1.074469862360911e-01; -1.260520786306298e-01   +1.629711367850095e-01   +3.126365845405028e-02   +1.515294028729994e-01   +2.725898367270751e-01   -2.515126664579592e-02   +1.797079669519192e-01   +1.549205084792345e-01   +1.776625313372473e-01   -8.773282663603610e-04   +1.261640365853180e-01   +4.679396572128982e-02; +1.006936515498622e-01   +2.550418554734944e-01   +1.348173971008048e-01   +1.356637255838468e-01   +1.068616877745235e-01   +3.197861998837845e-03   +1.116007538261328e-01   +2.021293991256597e-02   +9.819744850641818e-02   +1.886629266945762e-01   +2.046342558117395e-01   +5.099037764535101e-02; +2.322238930208683e-01   +1.438493473620644e-01   +1.505864734057131e-01   +5.767688497021306e-02   +1.902973173303498e-01   +2.670365843375194e-01   +1.469141152303821e-01   +2.097750095388859e-01   +2.546742063781847e-01   +6.783491762786817e-02   +1.227969405534760e-01   +1.290384974424133e-01; +1.285322496594428e-01   +9.817626891711206e-02   +2.842029765802961e-01   +1.436657599645882e-01   +9.923186430240395e-02   +8.513885289008175e-02   +3.848368218196132e-01   +1.952130979065956e-01   +4.729468948573689e-02   +1.889682597767517e-01   +9.812818596679565e-02   +9.588165450080231e-02; -5.331432876201542e-02   +1.565066761142695e-01   +2.227858395751072e-01   +9.422996106789706e-02   +1.910266251786782e-01   +8.759102585302544e-02   +2.391077577167601e-01   +1.574552693066982e-01   +7.618833016969663e-02   -8.183429923681922e-02   +9.344482660391180e-03   -1.617987903772412e-01; +9.432485696913301e-02   +2.028815584165871e-01   +5.027281434631132e-02   -1.847119588852424e-02   +4.060989628086167e-02   -9.795431579102974e-02   +2.023119856464672e-01   +1.093937546987092e-01   +3.274308220545173e-02   +1.318914176823742e-01   +3.417688490971463e-02   +3.561897511273418e-01; +2.597385712668646e-01   +5.600474046570537e-02   +9.682352563915454e-02   +2.127738839138089e-02   +3.044535554753012e-01   +1.536729991968218e-01   +2.864741647470743e-02   +4.357515936377374e-02   +3.123352530719185e-02   +9.134098785732708e-02   -2.752664881523165e-03   +1.223508353041572e-01];
L3E_L3I_iGABA_netcon = [+1.621006331602687e-01   -9.307576182736799e-02   -1.089097542761273e-01   +2.338782030758756e-01   -4.805052661633311e-02   +1.538494459031843e-01   +2.165433246340938e-01   +6.787401812093700e-03   -1.814010467928770e-02   +1.543191483817448e-01   +1.143000532260303e-02   +9.332976267228642e-03; +1.034541935852984e-01   +3.208870150646584e-01   +2.544419976607980e-02   +2.654625636306055e-01   +3.222541490129206e-01   +1.164025882430422e-01   +1.637529299484087e-01   -6.003216913375876e-02   +3.133213062878838e-01   +6.822495689430021e-02   +1.406400450430598e-01   +1.318174566727506e-01; +1.889699427326439e-01   +2.209095825061381e-01   +7.094582906737003e-02   +8.194299783914559e-02   +6.252669019785245e-02   -2.251087072573585e-03   +1.847921261799119e-01   +1.956093256669217e-01   +2.733163676371580e-01   +1.065265502765810e-01   +4.550167233251579e-02   +8.688691231534557e-03; +2.362824391828170e-01   +9.199912073484580e-02   +2.176548125272073e-01   -5.438224200033114e-02   +1.070756922643940e-01   +1.081514416167578e-01   +1.053251393084642e-01   +6.889284639321767e-02   +3.002169524193707e-01   +5.513605031547155e-02   -1.153289463069354e-01   +7.991997705366770e-02; +1.105858303240393e-01   +3.819686805767282e-01   -6.243331322524329e-02   +1.837783700999951e-01   -1.038640550617721e-02   +7.291754156115181e-02   +1.303361124317202e-01   -6.237284834554910e-02   +6.890782669568385e-02   +4.425231350799503e-02   +7.709173013122639e-02   +6.507246535084027e-02; +2.158697406424975e-01   -6.796428819972545e-03   +1.038488754511966e-01   +2.121844535431958e-01   -3.331887214173514e-02   +1.721834479518152e-01   +2.130670855300275e-01   +1.792793907128661e-01   +3.394558617965034e-01   +1.964356948179604e-01   +3.340891642078552e-01   +2.189646987625746e-01; +1.856700987879224e-01   -3.666875668770493e-02   +1.746604534970817e-01   -4.850931182929624e-02   +8.245841795632723e-02   +8.849118367825426e-02   +2.901982251531524e-01   +3.295692494337764e-02   +7.128820096202812e-02   +1.013097507061981e-02   +1.718891424627771e-01   +1.817378534779356e-01; +7.239782317578250e-02   +5.379594277156376e-02   +1.893089435917223e-01   +2.747321007242073e-01   +1.086500369341879e-01   +2.629591442042354e-01   +1.215338138656126e-01   +3.904784530969489e-01   +1.848609631883366e-01   -1.330088772630017e-01   +2.137312836906173e-01   +2.085639768376262e-01; +1.126009018024514e-01   +1.432491180865175e-01   +1.957958489536986e-01   +2.319575666690484e-01   +2.771314865784366e-02   +2.125818141089260e-01   -1.955277593611061e-02   +6.331413686022014e-02   +1.003214335347723e-02   +2.086233137479159e-01   -8.947071099205858e-02   +6.935824733390943e-02; +1.773948277516098e-01   +8.588491379643902e-02   +2.159687200977566e-01   +7.060499173489113e-02   +1.225291935615155e-01   -5.741427560789806e-03   +7.091685003460326e-03   +1.055840883141084e-01   -9.063999505472906e-02   +1.152215000977500e-01   +1.325276991952793e-01   +1.131417323219062e-01; +2.846876517942374e-01   +9.785412643039029e-02   +7.055987467189477e-02   +1.950552643687404e-01   +1.583319620659234e-01   -2.677922018415416e-02   +2.089691628626580e-01   +1.229397329118839e-01   -4.944292864136783e-02   +4.388401032056406e-02   +4.892869071362561e-02   +1.132740463179817e-01; +1.968629627865196e-01   +3.222100942415881e-01   +1.967227143734177e-01   +1.935716619248484e-01   +1.388332474588983e-01   -1.207714350315135e-01   +2.055965354523284e-01   +6.764303276871481e-02   +2.734915308914927e-01   +8.908201138899519e-02   -2.056280976956278e-02   +2.686887422555564e-01];
L2E_Input1_iAMPA_netcon = [+2.223912267906786e-01   +1.226364696311365e-01   +1.141914127554708e-01   +1.198853087064409e-01   +9.354845956230477e-02   +3.071856879019284e-01   +1.727475130111392e-01   +1.450398623534187e-01];
L2I_Input2_iAMPA_netcon = [+1.291051007007344e-01   +2.199292721476929e-01   +5.308192473670239e-02   +9.784286415096194e-02   +1.850211567814219e-01   +2.876119626781812e-01   +5.130725478466811e-02   -3.236642862798676e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
