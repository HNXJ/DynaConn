function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.147392735547785e-02   +7.570772894810111e-02   +2.208116201511443e-02   +1.654318210878975e-01   +2.691133292714756e-01   -1.429056025462185e-01   +7.400482810417391e-02   +3.762114600775965e-02   +1.650053581210249e-01   +1.105930872485607e-01   +1.375033061426749e-01   +1.628082667691964e-01   -9.483587213867355e-02   +8.561791660991330e-04   -1.744609534990186e-01   +1.934730760542109e-01; +2.637502471739804e-01   +6.884077013432692e-02   +9.259418526067639e-02   +4.920593772907232e-02   +9.375803142373097e-02   +5.789018431431260e-02   +2.832752766872831e-02   +5.209171086582728e-02   +1.282203377958419e-01   -5.414551010524814e-02   +7.507679155283906e-02   +1.217871320644773e-01   -7.346425067471637e-02   +8.950508589256631e-02   +3.049836944231392e-02   +2.007731815100085e-01; -1.037441837918658e-02   +4.599547235903698e-02   +1.116815400870633e-01   +1.764549623130834e-02   -3.688343223208464e-02   +1.321388417504132e-01   +4.625834014690525e-02   -2.256115709489245e-02   +1.064470073785736e-01   +1.850309246727173e-01   +7.130092891190892e-02   +1.466787239310666e-01   +1.224718344014707e-01   +1.016539027065324e-01   -7.796456063350124e-02   -9.830568511660430e-02; +1.303277592346948e-01   +2.322984533870227e-01   +6.803152257723388e-02   -3.118877986709873e-02   +7.343897000089708e-02   +1.354096405234596e-01   +5.301225379022700e-02   +7.994729800632872e-02   +3.919880641715133e-02   -1.368192596340070e-01   -8.041749485872926e-02   -1.798656238042610e-02   +2.201479780998615e-01   +7.239851498265436e-02   +1.864284127091327e-01   +1.528039797769100e-01; -1.940893438322334e-02   -1.133235973221987e-01   +3.849191195294623e-02   +6.654230197647176e-02   +4.628218928735255e-02   +3.452741920349611e-02   +1.483539509214910e-02   +5.084358322374398e-02   -1.457924265376859e-03   +2.168871054577113e-01   +8.218814815491814e-02   -2.585251747774352e-02   -8.681812442845600e-02   +3.964302114520223e-02   +1.024198726014129e-01   -3.528942361861978e-03; +3.103852820766722e-01   +4.405951170475725e-02   -1.044668876811202e-01   +2.010224470309164e-01   +4.843983336067771e-02   +3.323730034379117e-01   -8.246078272785651e-02   +9.457879198616617e-02   +4.357055523862759e-02   +2.427900569599904e-01   -3.374607555054917e-02   +9.101453466335965e-02   +1.213989443178379e-01   +7.987199178361475e-02   -1.787212765961130e-02   +8.588371489824781e-02; +5.484760568872774e-02   -5.500597440197635e-02   -2.613587856620345e-03   +2.524650419303467e-01   +1.226534657415962e-01   +3.474836699887741e-01   +1.389844472329296e-01   +1.625196766893846e-01   +4.307434108479431e-02   +4.711594239097837e-03   -9.596791539284696e-02   +6.281424419415632e-02   +3.430084966532710e-01   +3.924172721650650e-02   -5.287771196249284e-02   +1.423769780571031e-01; -5.926311655027057e-02   +1.987787355971654e-01   -6.935763908867465e-02   +1.121631982896258e-01   -3.356052351969518e-02   +2.220975548384833e-01   +1.530236278276235e-02   -4.518831158252620e-03   +7.912412074272471e-03   +1.358621430429509e-01   +9.567846077397565e-02   +7.481845222871492e-02   +4.174636788399423e-02   +9.179532541550073e-02   +3.990261717759749e-03   -9.337188474909525e-02; +9.585336266268971e-02   +1.533805514922232e-02   +4.713121610785200e-02   -1.221390899755735e-01   +1.654487723311412e-01   -2.547213685151824e-02   +2.876088592422314e-01   -5.101718196613148e-03   +6.322703519437395e-03   +1.675378845242909e-01   +7.983647295933401e-02   +2.960543588689894e-02   +2.133771693343396e-01   +1.239311641023887e-01   -9.085721078309869e-02   +1.692495553075059e-01; -8.259657470690018e-03   -3.224342433328373e-02   +8.314599660453910e-02   +5.478417023982704e-02   -5.257887432743021e-02   +1.189717811460924e-01   -4.600061191719541e-02   +1.088560161970607e-01   +9.769356203561338e-02   +7.092555523104981e-02   +7.283058127525109e-02   +1.183737965048135e-01   +3.381475273856820e-02   -4.894159610190516e-02   -3.025228769304887e-02   -1.058379376758617e-01; -1.023867105591753e-01   -1.084526889035250e-01   -5.700226054629851e-02   +1.399341286781573e-01   +1.159570601212899e-01   -4.589505781179087e-02   -6.350342677036279e-02   +1.440073331940563e-01   +1.375523302871907e-01   +1.409980191126728e-01   +4.478179304810644e-02   -9.011622681458108e-02   +7.610507988756585e-02   -4.001202878744245e-02   +6.872706330134823e-02   +1.542103186511770e-02; +1.513165357733496e-01   +1.259886071005763e-01   +9.071313518799470e-02   +1.763545963455733e-01   +2.722342672800215e-01   +1.407833659498998e-02   +1.734259081768644e-01   +1.363594232960522e-01   +3.733651345698530e-03   +1.404978291104406e-01   +1.443243606122823e-01   +9.548478975887306e-02   +1.296691925555971e-01   +1.492992953564915e-01   +1.599249672217709e-01   +1.381897185485184e-01; -1.057018150672741e-01   +2.079987496798219e-01   +8.203895301956271e-02   +2.047314290293626e-01   +1.433073958052471e-01   +1.449243600680973e-01   +9.125396257142711e-02   -3.912521514280796e-02   +1.547737334188594e-01   +2.391418194463397e-01   +2.307744764894095e-01   +9.339609369359986e-04   +2.258813657426867e-01   +1.777317085503189e-01   -1.929839626809708e-01   -2.899355573471345e-02; -4.451994077396162e-03   -1.191166157832477e-01   +1.176382275243271e-01   +1.299132307280489e-01   +1.925284325422300e-02   +6.208461527464219e-02   +7.858724597135314e-02   +8.125244282559639e-02   +1.022898918483938e-01   -3.570587157491589e-03   -4.107291520987240e-02   +2.160849877419769e-01   +7.444654447405526e-02   +2.998604948061393e-01   -6.937421621164788e-02   -1.858730106960447e-02; +1.670944508061712e-01   +1.713487984245425e-01   +1.596999470849568e-01   +1.167179530094000e-01   +3.033139617629658e-01   +9.154697190715656e-02   +1.916166539297685e-01   +1.627016761293990e-01   +2.421181724224700e-02   +1.113136622034241e-01   +1.100073813151155e-02   +1.006910587831034e-03   -1.304194049777365e-01   -4.234052159112440e-02   +6.099395661876373e-02   +3.090328628792441e-01; +6.937954421228773e-02   +1.592077632028699e-01   +1.678358662253646e-01   -3.862213345536528e-02   +8.603569648306418e-02   +3.437807022877266e-02   +1.953496247012415e-01   +6.154558039040542e-02   +2.203356239993494e-01   +6.885270718886524e-02   +3.550918951240517e-02   -1.263944157012989e-01   -2.499492164082709e-02   +1.663913776700228e-01   +1.875183567415791e-01   +1.185085202145797e-01];
L1E_L1I_iGABA_netcon = [+4.247009919420720e-02   +8.230245192424732e-02   +1.074153347101497e-02   -1.668981039582378e-02   +1.483649700771426e-01   -1.309836663123586e-02   +6.170184594477594e-03   +3.067456505367909e-01   +9.510163028699008e-02   +3.272680008637214e-02   +6.858833184936533e-02   +1.787932744583165e-01   +3.955650860260514e-01   +1.303952356298888e-01   -3.160393520082722e-02   +1.306768220584058e-01; +2.661405035112774e-01   +9.198043508961960e-02   -1.572024711727031e-01   +9.922738945281223e-02   -2.132987318398447e-02   +1.644017447962640e-01   +6.979300388485450e-02   -2.216734491338801e-03   +1.277863161356765e-01   +9.960025399834120e-02   +1.458163699665094e-02   +2.338195453662253e-01   +8.883928488264961e-02   +1.210639157350669e-01   +9.288864139792913e-02   -3.385481207753561e-02; +1.299586884259755e-01   +3.200720983334743e-02   -2.465964410965472e-01   -4.583102118880213e-02   +2.028600554779570e-01   +1.659946360794593e-02   +1.719193296038812e-02   +5.850037770094807e-02   +1.119908187060530e-01   -9.001130449831804e-02   -2.007932226523581e-01   +1.114900178478932e-01   +1.121498364076087e-01   +1.703818853083832e-01   -1.496994318884304e-01   +7.195000923996302e-02; +1.603944351992924e-01   -1.391108969111464e-02   -1.078243389511575e-02   +8.711204497616817e-02   -3.016481356042843e-02   +4.368224806955873e-02   +2.109942141240606e-01   +7.154474075461478e-02   +1.528399067304224e-02   +8.430468651213951e-03   +7.381384028786428e-02   -1.372554171348575e-01   -2.775980573173369e-02   -1.038566535384725e-01   -1.559677319184794e-01   +1.782858821046949e-01; +1.772534775407618e-01   +1.373464636917381e-01   +2.786666421035792e-02   -8.939649298406202e-02   +7.402355877798306e-02   +6.149483930166999e-02   +1.347573514561368e-01   -2.934372538218502e-02   +1.461954379352501e-01   +1.769393010246074e-01   +6.817493180047662e-02   +9.198637747058838e-02   -2.663751999633827e-02   +5.241120847763858e-02   +1.769322124795916e-02   -1.826628567093281e-02; -2.162927322955691e-02   +2.015666424173007e-01   +9.254164209669619e-02   -6.391197711608654e-02   +2.606843466477040e-01   +9.041972972494568e-02   +1.865533962168055e-01   -1.151026436923662e-01   +1.814093860803893e-01   +7.830488824521048e-02   -3.811053489517643e-02   +4.659940439860909e-02   -9.745280101749182e-02   -7.685671383253931e-02   +9.738250695239162e-02   +8.635387856069444e-02; +1.689001131802126e-01   +2.395939708539662e-01   +1.937161435491605e-01   +1.603486168327784e-01   +1.634692443926813e-02   +8.211434052783100e-02   +5.253933437027340e-02   -1.207481179059406e-01   +1.890685494897367e-01   -2.006353390094068e-02   -3.763573345361616e-02   +1.938228929657162e-01   -3.617064663985171e-02   -7.539928852142680e-02   -3.359609988601377e-03   +1.007058136623653e-01; +9.729951046481911e-02   -1.015100361337790e-01   +2.214308045907639e-01   +1.101256675662968e-01   -2.032602536037534e-01   -1.299807184690113e-01   +1.554323385708613e-01   +1.806891215267000e-01   +1.384894010081868e-01   +7.421601473160323e-03   -6.221157285307160e-02   +1.413755934896831e-01   -1.005139919732702e-01   +1.398338835380508e-01   +1.265411694810012e-01   -6.842124865826291e-02; +1.223607485832984e-01   +1.622156284104353e-01   +1.320659990710430e-01   +3.692331059644993e-02   +2.499540220410950e-01   +1.106248019245742e-01   +1.483997395720776e-02   +1.268025713831328e-01   +2.343441303739573e-01   +1.495836977571133e-01   +1.445199890049935e-01   +9.273172165420633e-02   -3.081607912501712e-02   +1.632000981348954e-02   +1.111995136148853e-01   +1.596146597493956e-01; -1.583910753054077e-02   +3.809209866800424e-02   +1.716121501070494e-01   -5.139339141323807e-02   -9.939944705882034e-03   +9.047130084300541e-02   +1.311325112647785e-01   +1.511454664562865e-01   +1.091836507282895e-01   -1.575742478853071e-01   +6.883463776760003e-03   +1.802583511085365e-01   +5.084223057242356e-02   -7.755129643721520e-03   -2.575603375001417e-01   -7.960770659874598e-02; +1.284249809174937e-01   +8.506153707441248e-02   -8.332783483218016e-02   +1.269229288300344e-01   +4.234379488505478e-02   -2.338659088798687e-01   +3.143479401317327e-01   +3.411789265405052e-02   +1.302547629987292e-01   -1.133664896511672e-01   +8.695603576322611e-02   +1.036854936252487e-01   +5.169768171937229e-02   +1.304129656379630e-01   +3.707193867010028e-02   +8.564146936758779e-02; -5.202595215548153e-02   +1.708242663641569e-01   +4.302916115115719e-02   +6.794661757850132e-02   +6.650739652036838e-02   +2.066108534703309e-01   +3.093825667970673e-02   +9.515673153173128e-02   +9.536251480159576e-02   -1.039101738871547e-02   +1.464237517618083e-01   -6.395806952484205e-02   +9.016897844398716e-02   -1.004139078698921e-01   -1.941531968660621e-02   +2.688291584579425e-01; -1.686556001846165e-01   +3.028860187210055e-01   -1.011188210692988e-02   +3.038524822586215e-02   +1.445820372280844e-01   -2.890990345953595e-02   +1.128739180456911e-02   +7.338076208628772e-02   -1.819322706193803e-01   +1.869882947006556e-01   +6.955093851656907e-02   +9.170413556260601e-02   +1.876914942261421e-01   +1.575090232669431e-02   +1.371398977476174e-01   -6.396764392369733e-02; -9.921732451683318e-03   +1.628729547272468e-01   -4.111329216840924e-02   +3.244127482670723e-01   -1.388200539878400e-01   -3.765620684496972e-02   -8.227349560839127e-02   +9.706195309322546e-02   +2.850514031681672e-02   -1.177252666194862e-01   -8.184863038456697e-02   +1.717828560293129e-02   -1.036854772977250e-01   +1.074528774940146e-01   +8.508981019588777e-02   -2.011571768438649e-01; +7.624709014869953e-02   +7.893319094284060e-02   +1.438222599423071e-02   -1.723169853816903e-01   +2.534422494892397e-02   +1.661834481742913e-01   +1.412702810471989e-01   +1.085345790313889e-01   +4.628288236075255e-02   -1.870174725084185e-01   +1.047044947564233e-01   -2.702689507257289e-01   +1.704098372776771e-01   -6.610443379175190e-02   +6.636154146170752e-02   +1.485945408441929e-01; +1.914887028740959e-01   +7.598529768175073e-02   +6.367911958092798e-02   -2.001672260157834e-02   +1.046489788731319e-01   +2.186803030640084e-01   +4.520152850857950e-02   +5.745361321749345e-02   -9.706825446295045e-03   +9.812677160980136e-02   +1.553695060586319e-01   +2.620290232455937e-01   +5.652090130204936e-02   +1.998755277369787e-01   -2.805553533689840e-02   +5.987532658457945e-02];
L2I_L1I_iGABA_netcon = [+1.213703715712960e-01   +2.105967351269094e-01   +1.220307135485415e-01   +4.559258653009356e-02   +1.055879716391990e-01   +7.139987664662684e-02   -1.310323909725520e-01   -1.303542507743978e-01; +1.079627382542244e-01   +1.101004873842767e-02   +1.863645019867024e-01   -5.699134940794295e-02   +7.764373807601023e-02   +1.057215818072334e-01   +1.773524518827082e-01   +9.878657279378029e-02; +8.688981529969265e-02   +1.109754226669232e-01   +1.603179037074025e-01   +1.556793371513046e-01   +2.166484141224901e-01   +1.269530094820039e-01   -1.456608038935866e-01   +2.453048018946439e-01; +5.346047318896444e-02   -1.439993775544278e-01   -1.430340759859786e-02   +3.785598552325727e-01   -1.248686938250603e-02   +1.902289085189338e-02   +2.387788433633348e-01   -1.150621542013548e-01; -6.550820751739000e-02   +1.577825000888320e-01   +3.931280721044787e-02   +1.730245264645614e-01   -1.921479222705376e-02   +1.854065570158049e-01   -3.525917251446520e-03   -3.782452963360324e-02; -1.993268576568721e-01   -5.739106060684923e-03   +6.212856829368327e-02   +1.842712338545317e-01   +6.129440670553146e-02   +1.760472406207104e-01   +4.765002594159408e-02   +1.090418547307277e-01; -6.047738658609211e-02   -1.343484306011539e-01   +8.826239368308342e-04   +2.320814996569790e-01   +1.704162806965227e-01   +2.819527183028000e-01   +4.807485170725291e-02   +2.098536668843357e-01; +1.238510774267141e-01   +7.595828516179792e-03   -3.740654351360473e-02   +7.424207044797972e-02   +9.727520760320554e-02   +5.414273342255415e-02   +1.600327358381463e-01   +8.545986427187124e-02; +6.093339660465179e-02   +6.885516821651073e-02   -8.391853003121766e-02   -1.546723381579548e-01   -1.410928247599926e-02   +1.257095064254011e-01   -1.208142261266745e-01   +3.214569278299922e-01; -3.117352155597317e-03   +1.922599110791374e-01   +4.848067864226362e-02   -2.079896925237804e-03   +3.800256186151303e-02   +2.242577208570123e-01   -1.840239879496868e-02   +1.005102629249409e-01; +1.200293403864373e-01   +2.669618369280720e-02   +5.163785388582283e-02   +8.173359903511006e-02   +5.943953611085589e-02   -2.388306262480133e-02   +9.902223414779238e-02   +1.837336904769702e-01; +1.546680494406900e-01   -1.083145277072660e-01   +1.646161215094211e-01   +1.201849453169149e-01   +9.419164177510136e-02   -1.188914363869208e-02   +3.722722066843412e-02   -7.440027910156242e-02; +2.029744056500248e-01   -5.625952511442913e-02   -3.380065569681191e-02   -4.492741888041788e-02   +2.184244018132731e-02   +1.586058929325277e-01   +8.760166374130583e-02   -8.951833210256691e-02; -3.972271838750040e-02   +3.215058696023435e-02   +5.036700003329376e-02   -4.027126814197168e-02   +1.372237048513115e-02   -7.996079095470696e-02   +1.968726544782311e-02   +2.415413128812461e-01; +1.564036738367462e-01   -3.429102523144797e-02   +2.412827428419337e-01   +1.439990629904841e-01   +7.538608030617776e-02   -1.142343344359329e-01   +1.275962397881357e-02   +1.683176286888022e-01; +2.946760319576022e-02   +2.544553035918314e-01   +1.065821785637804e-01   +7.246172149766328e-02   +1.607683155805108e-01   +1.052526423149001e-01   +2.120752868725886e-01   -4.518672201524339e-02];
L1I_L2I_iGABA_netcon = [+2.127469439271108e-01   +5.449590207510806e-02   +1.812216116784196e-01   -3.883636664404194e-02   +7.729555924572565e-02   +1.426216176920242e-01   +4.518941007605401e-04   -9.856326309654785e-02   +4.624141514509869e-02   +1.262982191989521e-01   +2.100136308606929e-01   +9.093113023843316e-02   -3.730839338901667e-03   +1.598413842131793e-01   +3.556101499155877e-01   +8.804034832106247e-02; +8.128306342009675e-02   +3.884367431203610e-02   +1.750198569642389e-01   +1.539904921847360e-01   +1.199305732067575e-02   -6.488866165184780e-02   +6.306968477787409e-02   +1.639255396599005e-01   +2.024863139539376e-01   -9.208742865527858e-02   +1.709829312495519e-01   -4.123104415415143e-03   +6.541190840265708e-02   +7.903682600802378e-02   +1.987478722388898e-01   +2.639999014737325e-02; +1.362327537397038e-01   +2.177231774129593e-02   -1.514426709540643e-01   +1.679289619132300e-01   -1.063293707665227e-01   +2.057575135500739e-01   +9.563379774065042e-02   +1.099219804571524e-01   +8.095173658293645e-02   -1.970483458874990e-01   +5.272009655172402e-02   -1.005850315017343e-01   +1.903032589469954e-01   +6.445972356988863e-02   +1.305143474375369e-01   -2.490743831839915e-02; +1.051594329283504e-01   +2.462601369216655e-01   +2.054923966976312e-03   -4.783862256800752e-02   +2.848142840018030e-01   -1.063307933292334e-01   +3.097528569232729e-02   +2.333809363460407e-01   +6.096611670415389e-02   -1.163469919564752e-01   -4.377165445090709e-02   +1.570870780074000e-01   +1.892965125971403e-01   +1.199481672729333e-01   +1.176724346260022e-01   +2.155531401731579e-02; +7.595594298024484e-02   -1.621368495724491e-02   +1.042956521639707e-02   +1.608721582907997e-01   -1.409477852486105e-02   -5.496479506636028e-02   -6.494576238083712e-02   +1.801819812783886e-01   +1.391159556079707e-01   +2.443279021886098e-01   +3.017726127146309e-01   +1.187990904104155e-01   +1.015980398448983e-01   -1.000254417584623e-01   +2.252669775647045e-01   +2.310850504585659e-01; +1.790954909274139e-01   +1.029344263492495e-01   +1.439734393100292e-01   +1.942626484661331e-01   +1.926297818943415e-01   -2.745546104834466e-02   +1.827260344522816e-01   +2.888089199380739e-01   +5.406676714130487e-02   +2.747836224913362e-02   +1.452470079760264e-01   +1.157826530244973e-01   +7.319464245696110e-02   +5.470856137130517e-02   +2.856977409587489e-02   +1.180781024508900e-01; +2.138066275793071e-02   +1.570025096601858e-01   +1.845283514386862e-01   +1.386040705015350e-02   +7.830126928949445e-02   +7.077689233773958e-02   +9.742936489456129e-02   -1.435438368289442e-01   +2.509321817320665e-02   +1.258974422088126e-01   +1.616197918802449e-01   -3.848164368057874e-02   +1.631681124180404e-01   -6.873892722446244e-02   -6.469946551309591e-02   +2.194445950849016e-01; +2.871183589238862e-02   +6.611700507109188e-03   +1.041343279194241e-01   +1.088335304285969e-01   +2.360419000244516e-01   +2.965384214998395e-02   +2.409549293930444e-01   +1.450703587124605e-01   +6.140983599467374e-02   +2.095777466656299e-01   +1.999826381580501e-01   +1.912091891427657e-01   +3.630673917735135e-02   +1.684551088813143e-01   -1.108218569809671e-01   +1.290050978325977e-04];
L2E_L1E_iAMPA_netcon = [+2.574609368664684e-01   +1.038847099549779e-01   +3.473927321057508e-02   +9.792905672232322e-02   +2.371073079595138e-01   -4.663622421789578e-02   +1.166316151568123e-01   +1.896456421075192e-01; +1.756708629741113e-01   +2.059182379465324e-01   -1.003205846365121e-01   +3.615754388424087e-02   -9.480771803231550e-02   +6.796555077081240e-02   +2.393021179852755e-01   +7.638817996433039e-02; +1.552009949812547e-01   +2.800622929535684e-02   +8.074576500179491e-02   +7.423731525882127e-02   -1.304204080092049e-01   +2.875974820610844e-01   +1.150785994422892e-01   +9.665112643269660e-02; +9.553693731437408e-02   +4.058818198764080e-03   +1.282865278650300e-01   -2.728599873054322e-02   +2.673820318405148e-02   +6.596239879580568e-02   -8.345991527824466e-02   -4.096491351869355e-02; +1.458555774142269e-01   -2.226010027470647e-02   +7.383815766265364e-02   +1.209622663573768e-01   +3.404460107085719e-01   -1.096061049261372e-01   -1.014269514503472e-01   +3.174165081897079e-02; +2.116692115488266e-02   +1.926286389952149e-01   +1.299837063579708e-01   +9.630281664044968e-04   +7.247030031540172e-02   +1.407984286627100e-01   +7.679019314146829e-05   +1.720439764792191e-02; -1.062457585940850e-01   +6.215025824913419e-02   +3.881088829196573e-02   -4.143317733110434e-03   -8.739019745200127e-02   +7.266746584499750e-02   -8.618367332586023e-02   -9.948640899786452e-03; +4.596400807409887e-02   -4.087554319963136e-03   +1.164776895401257e-01   +2.248075501727947e-01   +9.740061583623288e-02   +2.592165444882495e-02   -8.005769640675238e-02   -8.359323835819582e-03; +2.541655856627572e-01   +4.508294857216582e-02   -3.814965304961422e-02   +2.466756717031724e-01   -4.802175382942193e-02   +1.419130981607290e-01   +1.115585253352627e-01   +1.775166857032743e-01; +7.336907111325552e-02   +4.946937164724219e-02   +5.518378242475486e-02   -1.277069831873485e-02   +3.464479396263702e-02   -1.167994977330028e-01   -1.253230289919986e-01   -2.952515630237126e-02; +1.480477173084849e-01   +3.253875109122811e-01   -9.971328980192688e-02   +2.667721992227909e-01   +1.066491563376924e-01   +4.301340450304705e-02   +1.081276983899590e-01   +2.101452901114634e-01; -4.822290756658576e-02   +4.978642203007803e-03   +1.938757697822037e-01   +1.319691110071183e-01   +2.575218407104635e-01   +1.211254374564555e-01   +1.969875283327135e-01   +9.148764911276547e-02; -8.311168586359938e-02   -4.992434067341422e-02   +1.605382277559545e-01   -2.988117615958460e-02   +4.023158329994042e-02   +7.422823535099089e-02   +1.822161245981880e-01   +1.007396368838944e-01; -1.471829647924264e-01   -1.766246308077271e-01   -7.487025067903094e-03   -2.946760545314758e-02   +2.832017139907959e-01   +2.119103828483977e-01   +7.265103791336913e-02   -5.228212554122608e-02; +1.143976442600069e-01   +1.923237958164240e-01   +1.375305695691270e-01   +5.020282532747008e-02   +2.874972184911981e-02   +7.141455649061174e-02   -7.136882621081651e-02   -6.653875749436042e-02; +2.477786723947935e-01   +1.353964635729867e-01   +3.261955584490575e-02   +1.111032197894594e-02   -6.262318636719325e-02   +1.475195727926511e-01   -2.979532324758186e-02   -1.815073069077222e-02];
L1E_L2E_iAMPA_netcon = [-1.003631200515510e-01   -5.262834571651109e-03   +1.301167054345669e-01   +2.137366520643368e-01   +2.059757881801123e-02   +5.706790927972708e-02   +6.466466989380838e-02   -4.838891985595729e-02   +1.237056898855941e-01   +1.759267564099680e-02   +1.034381700534890e-01   +3.376286659560337e-02   +2.201509369614653e-01   +1.016399536242022e-01   +3.917311463900329e-02   +1.856974541984088e-01; -6.583650777462975e-02   +3.990693541296070e-03   +4.052324500496175e-02   -3.986199656651915e-02   +9.307650148018100e-02   +8.113985344388304e-02   -5.739815663615001e-02   +6.139303245310736e-02   -1.181528489812672e-01   -1.911431932207316e-03   +3.314059709484644e-01   +9.459900478481582e-02   -3.368149646977280e-02   +2.745487174676319e-02   +9.221106187408414e-02   +2.539486001504474e-03; +3.560727094296424e-01   -1.515275601198527e-01   +1.167408839908387e-01   -9.498062047485228e-02   +1.229421807232039e-01   -2.616622923542983e-02   -4.723005499979439e-03   -2.820477586586310e-02   +7.417138446573285e-02   -3.779104999474553e-02   +1.162285196498654e-01   -4.303419577047011e-02   +1.693518011116022e-01   +2.369030967948572e-01   -4.846674756513659e-02   +1.389324233125059e-01; -1.269477130491090e-01   +1.581628251528933e-01   +2.211323053915273e-01   -5.148164587972166e-02   +4.236029547651785e-02   +1.015184774376822e-01   -5.024925258539354e-02   +1.021505089869278e-01   +5.144590712945074e-02   +1.847172103579660e-02   +1.092819424591926e-01   +8.050411596833063e-02   +2.676055555646786e-01   +3.037902634021220e-01   +1.770121207393087e-01   +1.023776162731532e-01; +1.965880718305496e-01   -1.112937611578033e-01   -2.153168854450216e-02   -1.671706141122105e-01   -1.695094880203342e-01   -4.691312191546074e-02   +1.795731795685763e-01   -1.364462450115344e-01   -3.416947129137989e-03   +8.536184110194260e-02   -2.702256672129011e-02   +8.079092742730987e-02   +2.812656924335329e-01   -7.890390768294323e-02   +5.873811161905195e-02   +1.239227625034409e-01; +1.784425583632641e-01   -4.601171840923965e-02   +1.631191583467078e-01   +1.042931476116390e-01   +1.305218606549664e-01   +1.219255472635717e-01   -7.647432322995072e-02   +4.411586192559017e-02   +1.316569633371393e-01   -2.856163983748342e-03   +1.422395967751413e-01   +1.343777041364986e-01   +1.607148019414912e-01   +3.573283580857655e-02   +2.066735063669714e-02   +7.825488231616316e-02; -5.553171330717505e-02   +2.896175093138648e-01   +1.331349717805026e-01   +1.437180155136842e-01   -1.943751803796440e-02   +3.764483686588337e-01   +3.450998405448974e-02   +1.911095695992280e-01   -8.668650274364245e-03   +3.595980959067387e-01   -4.871473566706919e-03   +1.173946840908476e-01   +1.955664490317121e-01   -8.246752940381545e-02   +1.699982435801509e-01   +1.553512717142929e-01; +5.896557169723070e-02   +2.486162335414582e-01   +1.519322629404760e-01   -4.233637444423913e-02   +3.362862512821441e-02   +9.005243514083655e-02   +1.528987607049640e-01   +2.695555249298772e-01   +1.396469278664220e-01   -1.817812214107352e-01   -1.561540305626927e-02   -3.013161826869981e-02   -3.582923295886000e-02   +2.097398087246598e-01   +3.502382683403188e-02   +3.839040568975725e-02];
L2I_L2E_iAMPA_netcon = [+2.167386512640824e-01   +3.517961932174264e-02   +1.488078199754317e-01   -1.224725194801317e-01   +2.532954845916036e-01   +7.996923763926567e-02   +9.415348398844400e-02   +7.210383188167213e-02; -1.128048692366739e-01   -2.245557476599484e-03   +1.650739645938890e-01   +1.709503565150695e-01   +1.482535789962847e-01   +1.875576791501503e-01   +8.336704206099192e-02   +1.080190920861083e-01; +7.680583986211974e-02   -9.361837762397618e-02   +1.323846468218430e-01   +2.682178688096419e-02   +3.760015606146672e-02   +8.058624403234621e-02   -9.726350907632873e-02   -4.705282109559575e-03; +1.763875431822408e-01   -4.717511612176610e-02   +1.448576727796232e-01   +1.515791100190385e-01   +9.014041309180684e-02   +2.591363297907101e-01   +7.214192399732064e-02   +2.091815623768349e-01; -6.740965227881214e-02   +1.452465256201662e-01   +2.320593160959559e-01   +2.442076581636635e-01   +1.525119875959948e-01   +1.583188516420213e-01   -2.790798322717027e-02   -3.016742643499525e-02; +1.418202410149540e-01   +1.574883380124998e-01   +1.131891557272930e-02   +1.768222746518250e-01   +1.267835491845919e-01   -2.035709029827014e-02   +8.949306155575584e-04   +2.012304029546428e-01; +4.776940677563249e-02   -7.862547001601294e-02   +5.598475419179820e-02   +1.334878724358108e-01   +1.230946348432794e-01   +1.521854367900591e-01   -1.462257910407621e-01   +3.141352285806890e-02; -5.758393173629322e-02   +2.281281635171641e-01   +7.246372747715579e-02   -8.886940318348548e-02   +6.288040598607003e-02   +2.887578024482418e-02   -6.595723461398652e-02   +1.977985253116959e-02];
L2E_L2I_iGABA_netcon = [-5.031923906151869e-02   -2.389120831717342e-02   +2.472948867640916e-01   +4.564451479948473e-02   -3.629024661182974e-02   -3.147100580125639e-02   +5.024923424492064e-02   +8.789665781488958e-02; +3.265254292005945e-01   -3.573797999243819e-02   -3.650673473855157e-02   +2.459412138168727e-01   +4.356418014933664e-02   +1.704975736530347e-01   +2.786125420428713e-02   +1.000903888381627e-01; +5.184900058783279e-02   -8.929542863591458e-02   +1.981583328374172e-01   +1.494559233114420e-01   -5.208969814699881e-02   +1.073441703583206e-02   +8.708768809564646e-02   +1.398098448888411e-01; +1.267686903402558e-01   +2.284113789855542e-01   -1.131946279228706e-01   +2.090072814571802e-01   +1.629751939222908e-01   +1.093231892898977e-01   -1.030130914649609e-01   -1.066579046338116e-01; +1.683973971476998e-01   +1.409360259188630e-01   +1.453397748095600e-01   +1.231047437244678e-01   +1.637521457003481e-01   +3.060493457834461e-02   -2.106596097651662e-01   +2.312142362416083e-01; +7.736674756020154e-02   +9.087948764721562e-02   +5.787492798160112e-02   +5.627442162462483e-02   +2.582228572571680e-01   -1.610048278032818e-02   -1.413525139842686e-01   -5.439391638107020e-03; +1.050679736100395e-01   +1.650137599131546e-01   -7.144547561187251e-02   +3.293881887781181e-01   +1.466499571713356e-01   -1.266169514147603e-01   +3.214613582108741e-02   +7.873647728197150e-02; +1.582403983578358e-01   +2.248688092291195e-01   -1.982548173959860e-02   +1.284600426061755e-01   +1.828476797624647e-02   +1.826381988330708e-01   +1.601176993816898e-01   +5.359315564084430e-02];
L3E_L2E_iAMPA_netcon = [+1.038818536152796e-01   +1.691095116542021e-01   +1.805984131583121e-01   +4.300391377927901e-02   +5.183435895498935e-02   +2.645399843909133e-01   +1.409775447949166e-01   +4.758626812401891e-02   -1.331541181473611e-01   +1.846314482282301e-01   -9.812414056772370e-02   -7.794278211105185e-02; +8.331131033915733e-02   +1.790644046346217e-01   -1.682831444459125e-01   -7.966897722589480e-02   +7.222591226595000e-03   -7.203776911682072e-02   +5.465464456107316e-02   -3.721898450134914e-02   +2.566604410796292e-01   +3.046295322923058e-02   +3.060848314257752e-02   +1.622866606432445e-01; +1.608999608823632e-02   +2.197089235582055e-01   +2.206394909044074e-01   +3.013808103531568e-03   +1.934810101720304e-01   +1.281862754811247e-01   +1.851624414530219e-01   +4.375281084840828e-02   +8.161577130962996e-02   +1.288634520859685e-01   +1.521910082735325e-01   -8.087193024688352e-02; +3.032452949171457e-02   +1.057532573406731e-01   +1.444565333166316e-01   +1.527234579996883e-01   -6.421071595135422e-02   +1.036569803869705e-01   -2.472571598890205e-02   +6.127365813148903e-02   -8.306874100659292e-04   -2.233831073414871e-02   +1.589337150724144e-01   +1.461573283168814e-01; +1.551221538008065e-02   +2.271002473698495e-01   +9.034132279072869e-02   -2.851890361351805e-02   +4.460552780856083e-02   +7.207969615414764e-02   +2.298219606545034e-01   +2.236802701577685e-01   +1.218244113883974e-02   -1.786181982112005e-01   +1.669423808703472e-01   -1.651885873628578e-01; +8.399421327971467e-02   -4.818516149171830e-03   -1.761975188466355e-02   +1.621208164790033e-02   +1.690005322681954e-01   +8.795366775781333e-02   +2.232242002874228e-01   +7.046320026296779e-02   -2.676479926428682e-02   +1.392930066405655e-01   -5.037954382761660e-02   +7.817003348032453e-02; +7.405676064020190e-02   -1.390647968234362e-01   +3.337655608962214e-02   +1.029650614042446e-01   +4.527570650363811e-02   -2.199924257638189e-02   +3.510223143291161e-03   +1.616458905096768e-01   +6.888207198851025e-02   -1.375508724626956e-01   +1.184159541241297e-01   +8.283651476484405e-02; +1.303978114805021e-01   +3.304772844549873e-02   -5.274113711503462e-02   +1.192184819067098e-01   +1.225952808464370e-01   +1.359240440693842e-01   -3.119261309671872e-02   +9.248961753183349e-02   +2.729798474914434e-01   -6.943016944348188e-02   -1.074375191580516e-01   -2.360331406971018e-02];
L3I_L2I_iGABA_netcon = [-2.728735107938643e-02   -5.022001922165612e-02   +2.259442953928003e-01   +2.398631432155533e-02   -1.026375738664023e-02   +2.817085709038854e-02   -2.830922717518739e-03   +2.329454839944584e-02   +7.670977121022465e-03   +8.683579325014154e-02   +8.976346065894797e-02   +1.667876405815803e-02; +4.325973016178555e-03   +1.455403235038932e-01   +2.365592246520078e-01   +1.788631533536888e-01   +7.156193386654672e-03   +2.310119282911954e-01   -8.539514823918000e-02   -2.289437161365797e-01   +2.911183410412100e-01   +1.911495646739695e-01   +1.830219258667320e-01   +2.162482968006643e-01; +6.053259912352699e-02   +1.392183368971907e-01   +8.525500050069196e-02   +1.293741509883887e-01   +9.026536417431519e-02   +7.664177017497477e-02   +2.437043213188937e-02   +1.094710687963063e-01   +6.211596378710296e-02   +1.559908107455016e-01   +1.052180563545145e-01   -2.082325367474214e-03; +6.202843873223997e-02   +1.675459637008233e-01   +9.840476790758863e-02   -1.083578813474687e-01   +2.145915910542839e-01   -1.202689231329339e-01   +3.643567063100284e-02   -1.205045896358064e-02   +2.128340496946944e-01   -1.011870998725898e-01   +1.644010246410060e-02   +1.549711262296011e-01; +1.240316242593223e-01   -1.218852318800081e-01   +1.264331946011619e-01   +8.595323866439880e-02   +1.355787613610653e-01   +6.514456040023944e-02   +1.034990885938606e-01   -6.734844907793502e-02   +4.402901734032276e-02   +1.781362509042980e-01   -5.774880818463088e-02   +1.530659099763660e-01; +6.885238329955447e-02   +5.307756122756394e-02   +2.626623972258105e-01   +1.302436338148895e-01   +3.138769473613080e-01   +2.983085204418913e-01   -4.153562409268211e-02   +6.089529747057450e-02   +2.689903319013882e-01   +1.158689307117924e-01   +2.059130589779920e-02   +1.204241251745859e-01; -1.147603300780748e-01   +2.096926970207956e-01   +2.506465474813979e-01   -5.105865182424332e-02   -1.168766244599706e-02   +1.361638633611364e-02   +2.131758559370995e-01   +1.548422800286503e-01   +1.228401832152909e-02   -9.751273951775138e-02   +8.342243642756050e-02   +7.598862242109521e-02; +1.973636429912360e-01   +2.851469726495497e-02   +1.060655375957447e-01   +1.952436269533689e-01   +2.066717320271969e-01   +5.899340424651682e-02   +2.331603057452571e-01   +1.830585078742143e-01   +2.165119413306156e-02   +1.426838593578069e-01   +2.690915694799798e-02   -6.627569622054225e-02];
L2E_L3E_iAMPA_netcon = [+4.856103133612179e-02   +3.510038430052345e-02   +7.122771179843379e-02   -9.469759813001746e-02   -1.181951323039407e-02   +1.598626295616837e-02   +3.074718986443801e-01   +2.077237614497323e-01; -4.069360954903731e-02   +1.552902526660719e-01   +1.946508222175963e-01   -9.374441362364989e-02   +2.658948114848758e-01   +5.452642212411153e-02   +2.122943346971597e-01   -3.363930772178785e-02; -3.386622761949357e-02   +7.524310032211665e-02   +1.914034625350254e-01   +2.091995924721876e-01   +1.503773230451295e-01   +2.108607397359496e-01   +3.002842934587049e-02   +1.207456430864569e-01; -9.581720932471759e-02   -1.151210354579402e-01   -3.531849525432122e-02   -1.157762808251314e-01   +1.190980542917375e-01   +1.324755635325073e-01   -1.027037026719047e-01   -2.000379274213167e-03; +1.863786091179531e-02   -1.913787290952429e-02   +6.551102430819150e-02   +1.736284100623715e-03   -5.598409217271175e-02   +2.747326826463096e-01   +2.035245806809948e-01   +6.228468270373572e-03; +1.412375839477891e-01   -1.534019663387153e-01   +9.781839410274647e-02   -2.868635588614855e-02   +1.847314677052069e-01   -2.578238757969986e-02   +2.342680443891063e-03   -1.369641869548487e-01; +8.158944758297713e-02   -6.532306202544871e-03   +1.407432096533463e-01   -1.975249170091272e-02   -5.786962204501581e-02   +1.779072609945412e-01   -1.911298603751148e-01   +5.031416548204375e-02; -6.023682700659885e-02   +1.431192303578188e-01   -1.548075038828055e-02   +1.177295581822459e-01   +1.398217603080553e-01   +3.023356611067680e-02   +1.139632972363142e-01   -1.096407235679026e-01; +1.827493881023569e-01   +1.484391391060108e-01   +1.055466257655233e-01   +2.281400334062624e-01   -2.942835909630759e-02   +1.521357354123268e-01   +1.628069866433617e-01   +7.882062641315618e-02; -5.597947508692901e-02   -5.999681945334968e-02   -6.970266722838012e-02   +5.841364419554958e-02   +1.085819877316998e-01   +3.032991400964908e-02   +1.441247614609788e-01   -1.228139077712303e-01; +2.085596610191097e-01   -3.713850079788836e-02   +1.427356580173397e-01   +1.429264372166755e-01   -1.967455337893989e-01   +8.010530582086997e-03   +1.130638465082197e-01   +7.220829773775998e-02; +4.845151790276651e-02   +6.057192943849816e-02   +6.701369285413339e-02   +2.348597166787394e-01   +1.085999278228372e-01   +1.112984593097367e-01   +1.996048718552424e-01   -4.466094752842402e-02];
L2I_L3I_iGABA_netcon = [+1.224192217028555e-01   -1.662505595300836e-01   +4.835393637528454e-03   +9.649827290647571e-02   +1.816589986814404e-01   -3.011029629348596e-02   +2.811549345711137e-01   +2.853706683989174e-01; +8.755010928928059e-02   +1.379303655881707e-01   +7.148324921999155e-03   +1.258859685706209e-01   -1.403108186591895e-01   +1.386174408452630e-01   +6.617051144244841e-02   +1.249920938807282e-01; -4.163488710510775e-02   +1.453264170785919e-02   +1.613973905076368e-01   +2.388840528520563e-01   -1.654859843133656e-02   +1.054127068570714e-01   +4.195833126807681e-02   +1.350847452563438e-01; +1.154572384704883e-01   +5.273558409730336e-02   +2.279235496667761e-01   +3.585619371932031e-02   +8.431418832829801e-02   +5.364181438776428e-02   -1.373602352431046e-01   -4.921146668687145e-02; +3.105527158120165e-01   +2.410319849386897e-01   +1.927116041474055e-01   +1.327877140980840e-01   -6.807959412147026e-02   +2.350092519212189e-01   +1.500816505498870e-01   +2.667888941158822e-01; +1.853783299308088e-01   +1.734511479235077e-01   +7.099983786155016e-02   +1.506402033348139e-01   +1.330598181143544e-01   -1.452045874968621e-01   +3.541943407969077e-02   +2.781424393470913e-01; -4.344357583868184e-02   +1.611836512380897e-01   +2.428478787602518e-01   +1.837856395087072e-01   +2.892240434124722e-02   +2.593802853818533e-01   +6.839667390807144e-02   +2.066678163708176e-02; +1.144248747493645e-01   -5.967797244771360e-02   -1.484532307522499e-02   +7.285724907643557e-02   -8.691241729795965e-02   +1.742002453628182e-01   +1.633379304592682e-01   +7.070471901908133e-03; -4.520613969604771e-02   +1.958699393996208e-01   +2.244999166573483e-02   +1.512882496160128e-01   +1.490777644296909e-01   -5.447377555506804e-02   +3.946580330881488e-02   +1.069933734396345e-01; +1.418366876631414e-01   -2.693660836094263e-02   +1.020826719498881e-01   +1.426482677346747e-01   +1.378265674727063e-01   -5.730482314608024e-02   -2.929276119138394e-02   +3.719733004734245e-02; -2.211811754432893e-01   +1.221604163516346e-01   +4.394950472315637e-02   -3.457151334245191e-02   -1.047598948628425e-01   -5.546664630381443e-02   +1.014968696876496e-01   -7.180217790869886e-02; +2.366615439228142e-01   +2.311222195876740e-01   +4.134137444542317e-02   +2.842657305683297e-01   +2.288215340159580e-01   -6.640071777358968e-02   -3.085581256483428e-02   +5.139971788376062e-02];
L3I_L3E_iAMPA_netcon = [-3.540582322531954e-02   +3.080755538460698e-01   +7.825745349226862e-02   -4.734312899127963e-02   +6.105302837226938e-02   +1.172670421175442e-02   +1.257335602230427e-01   -4.175597427483126e-02   -3.181643306264650e-02   +2.225463613168742e-01   +2.377474722366072e-01   -2.298240539484492e-03; -1.051064276894635e-02   +2.473633306667429e-01   +1.465728096672232e-01   -2.703577496661196e-02   +2.620507661897971e-01   +5.515582639714657e-02   -5.668969630963642e-02   +8.762570897993778e-02   +1.017625297457263e-01   +5.865072605061827e-02   -9.727749384172729e-02   +6.777081769368205e-02; -2.587854523566668e-02   +1.468245212511438e-01   -1.361635355180641e-01   -1.569884559646811e-02   +8.663214930708604e-02   +2.416621204973965e-01   +1.488534844814025e-01   +6.323852699342433e-02   -1.051219240900783e-01   +6.074629716743431e-02   +1.357184257280939e-01   +1.668979303998320e-01; -6.526146782373066e-03   +8.872518899889671e-02   -3.800636194173157e-02   -2.568693665758459e-04   +1.701441663356361e-01   +1.285495740088840e-01   -1.214107870180395e-01   -9.848539240629753e-02   -5.201914037412320e-02   +7.678142698929892e-02   +1.911246634873447e-02   +1.196427779630544e-01; -1.145694048475837e-01   +5.611637278161052e-02   -7.530041448495431e-02   +1.132529331110999e-01   -3.797377761193155e-02   +2.197244311617630e-01   +1.187928202368909e-01   -1.434826167905892e-01   +6.926733847612634e-02   -2.133056891467067e-01   -6.892568401130926e-02   +2.590132382028237e-01; +1.717089585172684e-01   -5.324712863241959e-03   -8.730068532057203e-02   +1.660820285314492e-01   +1.655508547942371e-01   +8.472792826346227e-02   +2.785917679133235e-02   -5.566175310481392e-02   +1.393980814122684e-01   +7.623029979197191e-02   +3.270255288248510e-01   +2.413728372458706e-01; +5.599009822458875e-02   +2.376605178742442e-01   +4.349186328565426e-04   +2.320673338611640e-01   +6.597730870679645e-02   +1.819846482026923e-01   +1.126838689298237e-01   -1.411676764617323e-02   -2.750024028785143e-02   -1.154420373467632e-02   +1.213818817650699e-01   +2.265279942023830e-01; -3.244702587272760e-02   +6.560684152077324e-02   -2.009125351418607e-02   +3.505611339168563e-02   +1.016931294441341e-01   +1.192241622722784e-01   +7.899591107007119e-02   +4.867530797760893e-02   +1.870094230129792e-01   +1.706526047682909e-01   +8.413418739671931e-02   +8.077495543983683e-02; -8.249215180167070e-02   -7.425125675080822e-02   -1.176692882439819e-01   +1.384735346992279e-01   +8.562966714831909e-02   +1.694732180890531e-01   +3.870092132471441e-02   +1.624334200097132e-01   +4.629195065075000e-02   -3.659431272176443e-02   +1.208876340118497e-01   -9.555074667954842e-02; +1.380596043177182e-01   -1.215216028450021e-01   -2.429946621466229e-02   +8.496099399308452e-02   -7.580294805815876e-02   +2.733584217059740e-01   +1.703659242996485e-01   +1.748970826476344e-01   +3.216643272539194e-02   +3.955028349464967e-02   +7.988413456567553e-02   +2.933354963953637e-02; -4.464773551657584e-02   +9.641433279078480e-03   +2.196371820899031e-01   -2.786893155654826e-02   -5.263756057006493e-02   -8.009765736219424e-02   +1.591408094675391e-01   -1.250270449508253e-02   -2.468374336618706e-02   +2.491921230255211e-01   +1.680870974149583e-01   +6.293244924489658e-02; +1.571264709529941e-01   +1.109000481187727e-01   +1.692009687561146e-01   -2.889384110966874e-02   +1.270756983313383e-01   -1.452140647382134e-01   -1.755476411850697e-02   +1.463207760505273e-01   +2.031334726002744e-01   +6.508103343564858e-03   +3.425573847639075e-02   +1.087145164317584e-01];
L3E_L3I_iGABA_netcon = [+1.424306610753312e-01   +1.637979059700882e-01   -1.673403053749348e-02   +2.747587626898872e-01   +1.647835968413663e-01   +1.494831226275818e-01   +1.527162258879871e-01   +1.911074427734278e-01   -8.195503548853200e-02   +1.785456981393573e-01   +2.875812002887400e-01   +1.545767111415635e-01; -1.509796964265267e-01   +4.411140260261943e-02   +2.186171214160800e-01   +1.589301664495953e-01   +2.358479028501673e-01   +1.662259845372860e-01   +8.728155669208192e-02   +2.873822262326066e-01   +8.453711282770265e-02   -6.157244928678466e-02   +1.027748004274878e-01   +1.784434535459776e-01; -3.708595532632532e-02   +2.197778254660552e-01   +1.421666084768378e-01   -5.921381293514041e-02   +9.217817246588493e-02   -9.039793071221133e-02   -7.497934590939746e-03   +2.351258506461524e-01   +2.266155656627619e-01   -1.149855715059229e-03   -3.715820754721411e-02   -3.641271781337008e-02; -1.743608113696946e-01   +2.254017706412216e-02   +6.654652467065839e-02   -4.570254956768990e-02   +1.816269285411234e-02   -1.101233219489065e-01   +9.315548866420761e-03   +2.391181152112545e-01   -5.150599153492182e-02   -6.039471288598076e-02   +2.279083484596675e-01   +9.663917847720838e-02; +9.112657876901462e-02   -8.718017217435581e-02   +2.384630302516950e-01   +6.778759031670770e-02   +1.679700326985457e-01   -2.002557936993060e-01   +5.680157344193237e-02   +1.120745108844505e-01   -1.479282130417086e-01   -3.865392108885871e-02   -1.438507753560551e-02   +1.682134788791342e-02; -1.218359746425204e-01   +7.451525737714457e-02   -6.438905895967229e-02   -4.375509036592515e-02   +3.510769713441508e-02   -1.272574795841745e-02   +1.040467549202841e-01   +2.583707673721399e-01   +3.241478835624290e-02   +7.666099653893667e-02   +8.993912793636261e-02   +1.200560740266817e-01; +1.368317372178132e-01   +1.928945242264509e-01   +1.737693499477796e-01   +6.999759769891153e-02   -6.917109423698516e-02   -7.796191462513222e-02   +1.994731556490442e-01   +6.645662787171770e-02   -2.210709292526319e-02   +2.006006402700191e-01   +1.537753249843186e-01   +6.825687814685254e-02; +6.803720893709733e-02   +5.253868650140500e-02   +1.179868191192287e-01   +2.046603181779810e-01   +2.946076490737192e-02   +7.060040155143857e-02   +2.495533775567868e-01   -6.190008133966032e-02   +2.490881466482554e-01   +2.883269372422674e-01   -2.230567487816085e-03   -8.249445255793725e-02; -2.077704737084585e-02   +2.112671860401482e-02   +8.504799131952279e-02   +1.031506051136764e-01   +7.123432305459969e-02   +1.262744208888571e-02   -2.094146219174893e-02   +1.298514615786660e-01   +1.425677908985585e-01   +2.112236497695961e-01   +8.834272263531076e-03   -5.426611058582538e-02; +1.315076066886858e-02   -6.252420942891301e-05   -2.772515088604939e-01   +1.833559565067948e-01   +1.273935362682547e-01   +1.432444946911842e-01   +1.029155233194449e-01   +9.826914191300118e-02   -3.642632147143457e-03   +1.263513126347021e-01   +2.197436829431881e-02   +5.452943722712918e-02; +4.182431741482158e-02   +1.238792694730212e-01   +2.257009741623190e-01   +1.528990631157738e-01   +5.112837749434575e-02   +1.280676880801576e-01   +2.060630751346110e-01   +1.530330634944257e-01   -8.898495575993290e-02   +1.336227698018690e-01   +1.280715036683537e-01   +3.839166611688555e-02; -7.589593162538405e-03   -5.031252072510942e-02   +1.482225015623442e-01   -5.000937928202572e-02   -8.485676680504187e-02   +1.784804499004621e-01   +4.579300937264740e-02   +1.228129984827440e-01   +1.907337937682942e-02   +4.990343352493764e-02   +9.206603955397703e-02   -8.551764158687977e-02];
L2E_Input1_iAMPA_netcon = [-4.475200913236028e-02   +1.085437032752290e-01   +6.685703092195319e-02   +3.192597550148649e-02   +2.817720385869483e-01   +1.492833610907844e-01   -6.952101706649379e-02   +2.792726717188786e-01];
L2I_Input2_iAMPA_netcon = [+1.320389767061362e-01   +4.233951113767523e-02   +8.387071080735511e-02   +1.266345317288955e-01   -1.540359802195523e-03   -9.499324595647862e-02   +1.205846102505543e-01   -1.218751108875088e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
