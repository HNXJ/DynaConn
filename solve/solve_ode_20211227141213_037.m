function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.895865217520331e-02   +6.439730608120665e-03   +1.843197565114104e-01   +7.106733868292320e-03   -7.580138447909869e-02   -2.244635144644501e-01   +3.634797508184592e-02   -1.481681096167894e-01   +1.093885976633111e-01   -7.356264511858432e-02   +1.725301550900926e-01   +2.204730154930554e-01   +5.081525383232677e-02   -4.915811314000655e-02   -3.373182276701595e-02   +1.737323068058897e-02; -1.222660311455421e-01   +8.292191806223068e-02   -3.488715359876075e-02   +1.450567234547599e-01   -1.037144825525755e-01   +6.070549593058466e-02   +8.765745532353691e-03   -2.282767269884338e-02   -1.639085008886687e-01   -6.611670780633994e-02   -3.639572786649512e-02   +7.753365886077088e-02   +9.109255804114634e-02   +1.986929040039336e-02   -5.916273141529753e-02   +1.508260570109837e-01; +1.328283697782227e-02   -1.376619640182244e-01   +5.761774476162707e-02   +1.258296804050029e-01   -6.482824637539891e-02   -1.104340353551155e-01   -1.953592269968047e-01   -2.150423923267517e-01   -2.028863524419823e-01   +9.275443610966719e-03   +1.737077478874413e-01   -3.821251668156628e-02   +2.255240252376482e-01   -1.858624293690118e-01   +2.288655493767740e-01   +1.170372448693317e-01; +6.196487699094690e-02   -5.937141952036591e-02   -1.078114150481764e-02   -4.058803718695943e-03   -9.780172356021966e-03   -4.835349243605193e-03   +3.079893729779296e-02   +6.471301128617828e-02   -2.199869334212008e-01   -1.162385792521756e-01   +3.184005918351891e-02   +1.623838129438399e-01   +2.084853660842856e-01   +9.776746313913165e-02   +1.495357253695009e-01   +4.900771545795252e-02; +3.539861783161677e-02   -5.169667128266707e-03   -1.902494342642315e-01   +3.766853321874088e-02   -1.857144570687837e-01   +1.403049251763569e-02   +1.428035078228463e-01   +1.643013361852838e-01   +1.779403296996070e-01   -2.230428309330066e-01   +7.873663698499915e-02   +1.236379162975724e-01   -2.391944974929772e-02   +1.224051858940087e-01   -6.741238288265552e-02   -5.596903848499342e-03; -2.496610005443761e-01   +1.969450965412968e-01   +1.849398923872626e-01   -1.192376971449586e-01   +1.489283369571168e-01   +1.147704162056278e-01   -2.137772542296907e-03   -7.421609897321824e-02   +5.157114340719610e-04   -1.295491974128208e-01   -5.384758331973137e-02   -9.781623216276165e-02   +1.640379387344917e-01   -1.559885551851898e-01   -1.626242280482002e-01   +1.652461626370554e-01; +4.246545429097823e-02   +2.000452329935834e-01   -2.484136414192630e-01   -1.749054574188253e-01   -2.030624888596542e-01   -1.157054120021457e-01   +4.259251409517878e-02   -6.310055416860390e-02   +9.208318917501615e-02   +1.367913166469087e-02   +6.993799800485605e-02   +1.017746530057891e-01   +9.731328624483275e-02   -1.193163731089936e-01   +2.088839697784155e-01   +1.050718697647772e-01; +1.521806528205563e-03   +2.516885745893956e-01   +1.900600417990168e-01   -1.339219537204286e-01   -5.417208030927800e-02   -5.799335619481134e-02   +1.743598061527248e-01   +1.569411199682278e-01   -9.160609003032222e-02   +5.433047962834697e-02   +7.075338383668058e-02   -1.243291361419873e-01   +1.533566269481906e-01   +1.241662759607485e-01   +9.565354776446788e-02   +1.374141032791115e-01; -1.258012846709270e-01   -1.403196858704147e-01   +2.722259447377066e-01   +1.595510515262399e-01   -6.479544517316087e-02   -8.366036084210179e-02   +1.990905584792483e-01   -1.531270219697488e-01   -2.208526477354954e-01   +2.545349671461124e-02   -1.474202496591442e-02   -8.018441125166045e-02   +3.065006696875622e-01   +1.923373232583018e-01   +2.244265455556903e-02   +5.577232731906178e-02; +1.608424222247032e-02   -1.251544338519346e-01   -1.204638625622472e-01   +2.407309237129860e-01   +2.676957515931172e-01   -1.020593658860283e-01   -7.598068972113278e-02   -1.484419854713079e-01   +5.625245345597893e-02   -6.140188259913228e-03   -1.362553482052405e-01   +4.081994586878865e-02   +1.905701977945705e-01   +2.846034645030763e-01   -1.386171407369230e-01   -2.594071446290195e-01; +2.817800143306909e-01   -1.524518377863921e-03   -4.620614948298812e-02   +1.386776131978049e-01   +3.763144853700689e-03   +2.635708175795911e-01   -9.214194217668374e-02   -2.301819015987983e-01   +1.462640386883455e-01   -1.029398337241375e-01   +4.554137061715793e-02   -7.043865634167552e-02   -1.895763526420477e-01   -1.175809865744120e-01   -2.415173613429383e-01   +2.749402875684899e-02; -3.027134326925577e-02   -2.591099898398784e-01   +9.347989094713091e-03   -1.235793575059546e-01   -9.647734039602067e-02   -6.659818392094989e-02   +1.131254008730003e-01   +1.306603038879122e-01   -1.576979876531665e-01   +9.010712554098989e-02   +5.337592455568008e-02   +1.078776201215603e-01   -1.585605037496726e-01   -7.351419884619688e-02   +1.477949036309751e-01   +1.026155995912458e-01; +3.633417404924027e-02   -4.069264496894130e-02   +1.989342495633221e-02   +2.917730967821688e-02   -3.750420851808477e-02   -1.783583075118192e-01   +1.434779277535426e-01   -1.687702859579266e-01   +2.324845917707145e-02   -2.510584120239516e-01   +7.102827709978179e-02   -2.837921090950257e-02   +1.016207531201602e-01   +1.512193656033379e-01   -1.016708754629146e-01   -4.329112429242531e-02; -7.088078486601233e-02   -4.278669699163316e-02   -3.003610446870796e-03   +3.494380532850822e-02   +2.349595860545803e-01   -1.692024948180480e-01   +1.888554065692202e-01   +1.099849849459046e-01   +1.323074592050380e-01   -3.877390025978696e-02   -9.696635649012617e-03   -1.492840526857195e-01   -5.926662398446808e-02   -1.609573826053174e-01   +2.443005366266678e-01   -7.113561022910461e-02; +9.539547492877853e-02   -4.333085968593910e-02   +2.976575286456973e-02   +5.072110307778902e-02   +2.627907578880183e-01   -1.874885412810532e-01   +1.472432166580695e-01   +1.596961797237950e-01   -1.040510536809231e-03   +5.909396812529915e-02   +6.462913438682617e-02   +8.091503220100900e-02   +1.176371025378862e-01   -2.491057700837627e-01   -3.181631790798845e-01   -3.116323077614699e-01; -1.776535808253061e-01   +3.201690481785636e-02   -9.974741030509292e-03   -2.259427643759849e-01   -2.172413428949156e-01   -2.387552630601004e-02   -1.515431564620636e-01   -2.544916682938186e-01   -1.392335582469281e-01   -5.532030636193784e-02   -2.174177104167788e-01   +1.445520856524014e-01   -1.324825433585153e-01   -6.996155934522771e-02   -1.037569566468591e-01   +1.070328159960703e-01];
L1E_L1I_iGABA_netcon = [-9.371674629046600e-02   +5.677448890736644e-02   -6.832004903847748e-02   +2.818661702417831e-01   -5.824595355250479e-02   -1.088533268666664e-01   -1.941961033288500e-01   -2.074672682555912e-02   +8.497910049078476e-02   -1.144054842346608e-01   -1.191466882049688e-01   -1.634887250062532e-01   +4.198400667059504e-02   -1.418599064158494e-01   +1.741982536992569e-02   -1.706339135768027e-01; -3.850669472989379e-02   +4.183031721615164e-02   -7.528363687080245e-02   +5.913656342157640e-02   +3.210553459890058e-01   -1.725536534696270e-01   -8.157930759247697e-02   -5.708480129794194e-02   +8.785936817358253e-02   -9.009805362407627e-02   -1.235509899750588e-01   +4.701364947303378e-02   +9.094320125154072e-02   +6.197548574392116e-02   -8.446306210875940e-02   -8.151993847229308e-02; -9.560391967784352e-03   +3.277321672865506e-01   -5.968937533423280e-02   +1.026822224564673e-01   -1.152102920596107e-01   +1.887124366618086e-01   -9.540801373042150e-02   +1.788752218480510e-01   -1.981576594439990e-01   -1.099346587552440e-01   +1.477840834762592e-01   -3.648917322487707e-01   +7.675274263727702e-02   -2.243660230200954e-02   +1.102414105153275e-01   +2.795752328710796e-02; +2.300795858838178e-02   -1.090192165713120e-02   +2.345392153334874e-02   -3.020994926797558e-02   -2.781488629238903e-02   -9.874988764752958e-02   +5.153354943383592e-02   +1.355885869891836e-01   -1.166136521696405e-01   -1.198950510941545e-01   +2.651441993080081e-01   -2.026964264548783e-02   -2.742087081288356e-01   -6.221635154437163e-02   -2.589848988178434e-04   -1.318857211698290e-01; -3.085025021495549e-01   -6.181439715402530e-02   -2.436698559056485e-01   -9.469908452941987e-02   +7.783350742952511e-02   +7.634330823718255e-02   +1.928315889026130e-01   +3.072260517984589e-01   +1.754849181502760e-01   +7.182768744329675e-02   -1.647223019185220e-01   -1.779586297405634e-02   +1.341943876941298e-01   +1.507195873184613e-01   -3.184730102352671e-02   -4.056996348064517e-03; +1.807363767729751e-01   +1.633332702968715e-01   +1.419261268803309e-01   +5.999666639755879e-02   +2.033180846500653e-02   -9.140708003550390e-03   +3.163208976546179e-02   -4.187722751529949e-02   -6.490362451340627e-02   -2.485711165262762e-01   -2.071017646520831e-02   -1.048673909845804e-01   +3.250534126133228e-02   -1.225274595371023e-03   +1.026965305884255e-01   +9.084150084813293e-02; +4.652853430185673e-02   +6.254810011278492e-02   -1.689761235164400e-01   +1.736767477430205e-01   -2.288560676456031e-01   +2.663259248989261e-01   -1.137719997134476e-01   +7.827279859522493e-02   -1.164246384998520e-01   +1.082818481982367e-01   -5.521922921761400e-02   +4.846088301200634e-02   -1.175036367253639e-01   -1.029830381633798e-01   -4.266099461390518e-02   +1.473416856794862e-01; +1.187274654838153e-01   -8.309071083951815e-02   -1.731016152798702e-01   -1.291124390630022e-01   -1.568882756576770e-01   -8.070423866662746e-02   +1.275159820165281e-01   +1.081441602125794e-03   -3.049307492328390e-02   +3.157983834032313e-02   -5.598806054698438e-02   +1.898690938147136e-02   -4.882776980011138e-02   +5.739223815987470e-02   +3.956796344417388e-02   +2.175662825665202e-01; -1.853619414064777e-01   -1.582019164721234e-03   +1.672868617106753e-01   +7.027777107176626e-02   +9.907865817748751e-02   -7.099218421771945e-02   +1.386084660037943e-01   +1.565761676554131e-01   -1.701796476750862e-01   -2.325234703136667e-01   -1.417597190978189e-01   +8.595256308714742e-02   +9.911597059054275e-02   +1.802311192715609e-01   +2.494722881820124e-01   +1.682763803693432e-02; -9.171912605127570e-02   -1.472073766825985e-01   -1.569770943725872e-01   +3.665401161269828e-01   -1.390803865000367e-01   +2.553685973093727e-01   -9.982871611759990e-02   -6.862014685711205e-02   -1.160216754190656e-01   -1.308584990015900e-01   -1.656043956019728e-01   -9.023959112404259e-02   -2.360869392204257e-02   +1.516915523393296e-01   -8.167969688423955e-02   -1.510460066344514e-01; -2.599464621072100e-01   -2.367784946559242e-01   -4.488512921761473e-02   -1.692027531943771e-01   -1.430228621238734e-01   -3.189470700497981e-01   -2.465548681005928e-02   -1.264765821464722e-01   -4.918292773695591e-02   -1.249340097677318e-01   -5.089885899728899e-02   -1.333867279262348e-01   -4.954539663122035e-02   +5.599049649211256e-02   -5.103799791426739e-02   -4.823849489217318e-04; -1.745513655459778e-01   +2.636979087148912e-01   -1.070316325037919e-01   -1.294207942184884e-01   +1.629857154731941e-01   -5.260134012483389e-02   -1.236549351035102e-01   -1.249499477273254e-01   +2.206748968576894e-01   -9.965592481940389e-03   -2.147893864645198e-01   -1.286815432889986e-01   +5.518457112851859e-02   -7.800764521980633e-02   +3.146142661453220e-02   +1.211403868589863e-01; -1.104774949148549e-01   -1.219389183329015e-02   +3.259529431400845e-02   +1.494715330957544e-01   +1.070456994137157e-01   +1.799932953125163e-01   -2.560512314825215e-01   -1.095667896031696e-01   -1.421073538396689e-01   -3.038065836609893e-02   +3.307039761591811e-02   -4.437777462980087e-02   -2.157420978610228e-01   -1.602890840483689e-01   -1.716773224861263e-01   -8.316495847250099e-02; -1.377969903062461e-02   -1.517148573899675e-01   +5.541722842611986e-02   +1.033609832478827e-01   -2.212405107044286e-01   -1.505113781919410e-01   -1.719025329687591e-02   -1.250929378835584e-01   +1.563482681773288e-01   -8.501921338900416e-02   -1.258374678820459e-01   +8.548406349305597e-02   +1.103326286674247e-01   -2.365929254029461e-02   -3.898526971084370e-02   +1.023699326224545e-01; -1.073090567873805e-01   -1.315425871189745e-01   +6.020472175669413e-02   +1.190061201931440e-01   +4.329681774940775e-02   +8.443913557840452e-02   +1.547517485295828e-01   -1.046476369038168e-01   +1.473818651192663e-01   +7.379248176927232e-02   -4.971410864097769e-02   +3.467052193936043e-02   +2.085078136242538e-01   -2.763477726022207e-01   -3.591076263634279e-02   -2.237340633313697e-01; +1.224831736929142e-01   +2.132566353980466e-01   +2.746271366601918e-01   -2.186743200563900e-01   +9.727462931357482e-02   -2.256244881930250e-01   -3.857587909550277e-02   -7.636288645430003e-02   -4.345108801056494e-02   -1.320083990501089e-01   +1.960375076135955e-02   -8.270678503871483e-02   +1.494735180623451e-02   -1.176341696052988e-01   +4.222440427166971e-02   -1.076968709818180e-01];
L2I_L1I_iGABA_netcon = [-2.082346602330017e-02   -1.082850254957389e-01   -2.237928673093256e-01   -1.656844782077542e-01   -1.197582469645420e-01   -5.403566772728739e-02   +1.258059950604944e-01   -1.490559196838283e-01; -1.339438053971921e-01   -1.228121425494320e-01   -1.292416871664512e-01   -6.768058712624091e-02   +1.305633405035513e-03   -1.984812124350025e-02   +6.933852638412539e-03   -9.957159929304588e-02; -1.705334068554732e-01   +7.700082416882051e-02   -1.014767603638534e-01   -1.444028995251875e-01   +2.832379883411384e-01   -6.488245990409239e-02   -1.655957283909500e-01   -2.066073914595152e-01; -3.067795181641326e-01   +8.468467684046464e-02   -3.523176531714894e-01   -1.376995734421779e-02   -5.430314131082453e-02   +7.224264261934775e-03   -2.266726255341434e-02   -1.378822504764550e-01; -9.622758592795899e-02   -7.483457322677968e-02   -9.659107538384788e-02   +2.022218341643326e-01   +3.837185046071394e-02   +1.486009112111333e-01   -4.364356214566487e-02   +1.726579110152303e-01; +1.903950920730819e-01   +1.908833183554676e-02   +1.197338809557785e-01   -1.152019958847566e-02   +2.285450336522609e-01   +1.316460994723458e-01   -1.981156979653527e-01   -3.089962372653660e-02; -1.779139290487918e-01   +1.257806761214183e-01   -2.065461515449803e-01   -1.017717173458202e-02   -8.115994315481276e-02   +3.831878530334594e-02   +1.633739634988849e-01   +6.585893018573703e-02; +6.193547379114189e-02   -1.072875554407257e-01   -1.788794561979881e-01   -2.599034472912185e-04   +6.339527320390237e-02   +4.499569341604380e-02   -1.495054037453457e-01   +1.382998257312125e-01; -2.697129075699875e-01   -1.408010220882038e-01   +1.160672728466183e-01   +1.702223623611097e-01   -1.060188507177811e-02   +1.982219396296057e-03   +1.659615379470986e-01   +2.110011946255401e-01; -1.575702325107830e-01   -3.128733377110395e-02   +1.748597266525687e-02   -7.621210913851667e-02   -1.444174386450450e-01   +2.998525088625441e-01   +1.007151064526078e-01   -1.610364589720616e-01; -2.231539505506779e-01   +8.776144313322157e-02   +5.024999253421174e-02   +3.901550321170129e-01   -1.954304460336099e-01   -1.689141010787775e-01   +4.553777319308662e-02   +1.560781906992343e-01; +1.128323225208799e-01   +1.047980176509315e-01   -1.571876254150940e-02   -1.006802878374697e-01   -1.171978196549981e-01   +2.250421657264770e-01   -3.501658418649567e-02   +6.775268913298932e-02; -3.125468700090692e-02   +7.210882398307958e-02   -8.073346035936213e-02   +6.351126395469692e-02   +6.863425933966234e-03   +2.667240477510955e-01   -2.480238293776080e-02   -1.333255996173975e-01; +2.757622186294378e-01   -1.414577663852752e-01   +8.121547064135101e-02   +1.689692051083350e-01   -1.991316952062430e-01   +1.035261047334588e-01   -2.069165919339067e-01   +1.784252468604072e-01; -4.849013896719928e-02   -1.901321027443242e-01   +1.247497005329688e-01   -1.674599483830287e-01   +2.193800042455030e-02   +2.346251330493179e-01   -9.679659926909213e-02   +2.896014466198295e-02; -2.461589755378656e-01   +4.373103679858358e-02   -5.761058453170568e-02   -9.004651418920311e-02   -3.250000877922052e-02   +1.100796824075375e-02   +1.395441192188777e-02   +9.159972084215064e-03];
L1I_L2I_iGABA_netcon = [-7.301171686376837e-02   -1.099823303590361e-01   +5.964851924249079e-02   -1.113528802187359e-01   -1.993076665139879e-01   -3.646750350712771e-02   -6.215862407304464e-02   +3.128303724626079e-01   +1.750269352812713e-01   +1.690766147657470e-02   +4.242161118637838e-02   +1.519178222596163e-01   -7.235112991743468e-02   +1.090059061576581e-01   -1.455387162480542e-01   -8.293237281826623e-03; -2.354663872808468e-01   +1.076801864546522e-01   -1.341969146728545e-01   -2.124676769479237e-02   -1.843690285919861e-01   -2.235852263358292e-01   -9.056730171653588e-02   +2.379181385651356e-01   -1.091184356219053e-01   +9.071062438847156e-02   -2.239595790814476e-01   -2.851247302165484e-01   +1.594473005707254e-02   +3.583856853722285e-02   -1.597088244224831e-02   +9.527605476015095e-02; -6.932510755114164e-02   +7.805315620902430e-02   -6.355975978561638e-03   -1.444447504102239e-01   +1.886145352751300e-01   +1.019899089312800e-01   -3.823919303136163e-02   +3.565372646903636e-02   +4.620631081628326e-02   -1.012615264808390e-01   -1.371577933591536e-03   +1.199625686641847e-01   +4.831691306988180e-03   +2.057823255774749e-01   -6.435927803262012e-02   -5.510045489858280e-02; -9.783922964605456e-02   -1.501642098618803e-01   -1.282009514179578e-02   +1.220090906123580e-01   -3.206911054142008e-01   +6.593545909330690e-03   -1.123357935155869e-01   -3.731169847178463e-02   +1.269736070888924e-01   -2.313200136450573e-01   -2.201707019676022e-02   +1.362985926350631e-01   -1.157225347750726e-01   +6.197857322953387e-03   +1.201921502520949e-01   -3.299849215718537e-01; +1.194360725582708e-01   -8.149640429946702e-02   +7.252014525514046e-02   -6.255360207025206e-03   +5.042007689999223e-02   +1.241915118639549e-01   -4.351381109776424e-03   -1.659463324940803e-01   -1.385859194472708e-01   +6.376844889601542e-02   -4.395794568325861e-02   -3.173517868535507e-02   +9.543262209415308e-02   +1.071187065135147e-01   -5.098744861877547e-02   -2.177772564897772e-02; -2.876141481298587e-01   -1.183066855643484e-01   -5.803520371712564e-02   +4.821070035774658e-02   -5.542291739625996e-02   +1.331317730824654e-01   +7.273367038868921e-02   +2.052874468354255e-01   -1.387022725373359e-01   +5.746791044723007e-02   +2.883760323018561e-02   -5.770512755139534e-02   +8.228219698045922e-02   +1.625121399800879e-01   -9.861401077251175e-02   -2.987979072953890e-01; -2.213550221601199e-01   +5.288373182717031e-02   -7.504319055581342e-02   -1.059750117053101e-01   +2.860371509344355e-01   +1.830221391010721e-01   +6.509277321741828e-02   +3.040431466706586e-01   -1.343105817834243e-01   -2.681535420482928e-01   -1.110631061941195e-01   +1.706739697511413e-01   +1.295128836711315e-01   -5.469465449298315e-03   +1.732865478486937e-01   -1.069082775233264e-02; +3.756010311466172e-02   -1.744118873955499e-01   -1.173761634031399e-02   +2.765523340520345e-02   -1.430682471000568e-01   -2.072461783728191e-02   +1.080813964439534e-01   -7.889064668638614e-02   +9.492077041762526e-03   +1.546160720574265e-01   -3.952041328610175e-02   -2.621546439680278e-02   -9.507235992888571e-02   -6.329357397426323e-02   +1.640717824484993e-02   -1.688664401892933e-01];
L2E_L1E_iAMPA_netcon = [-2.539240536614606e-01   +1.720609898199259e-01   -8.856010091310976e-02   +2.047846874436813e-01   +4.983864526564907e-02   -2.814114234562008e-01   +3.105109732678884e-02   +5.302638612693747e-02; +1.777796999805681e-02   -9.853569679062353e-02   -5.280902919119115e-02   +1.652806249092164e-02   -6.593732965751863e-02   -1.123859620119015e-01   +1.442061766482350e-01   +3.517189181346655e-02; +2.576284916697635e-01   -2.143278377859906e-01   -1.975128980670230e-01   +4.542451690662461e-02   -1.350361680325200e-01   -1.272690970442137e-01   +1.928036970940742e-01   -3.169738289151412e-04; +1.079034727332839e-01   +2.237469843692642e-01   +7.461364398396596e-02   -6.390674543191471e-02   -9.495007359276417e-02   +2.379225611262485e-01   +3.206965692555977e-02   +4.178590951385698e-02; +1.127894988882373e-01   +1.177953602179580e-01   +6.083722097656309e-02   -7.271537429551145e-02   -1.549330414649865e-01   -5.424296776382878e-02   +2.624304724889640e-01   -4.701402708462502e-02; +1.508103090633789e-01   -2.045894051668956e-01   +5.569293785058082e-02   -1.473480178130140e-01   -1.194615748571734e-01   -1.682434078368682e-02   -7.146911260367635e-02   +2.361921337006250e-01; -3.845566199592049e-03   -7.281836616538843e-02   -6.740685877236879e-02   -6.353598256401331e-02   +2.986744448697753e-03   -1.529387438483031e-01   -7.105426930764006e-02   +2.382903777078302e-01; +2.419775638230429e-01   +2.517814334228544e-03   +1.271359225094613e-01   +2.233429701004400e-02   +2.271811982996771e-01   -1.548272874302031e-01   +2.024635471438374e-01   +5.744940436317211e-03; +2.608276292305597e-02   -3.929533285709720e-01   -7.706081886953156e-02   +8.845492452442491e-02   +1.507262458246467e-01   -7.222396051382819e-03   +1.387230411577277e-01   -2.784777937167664e-01; +1.485095492347510e-01   -2.053966312396024e-01   -2.991581201304077e-02   +1.915553000434062e-02   +9.866231376838840e-02   -1.013974588557826e-01   +1.143225214081415e-02   -7.722914576055233e-02; +1.622058475706956e-01   +4.808070907307453e-02   -5.633056652365549e-02   -7.597217620132334e-02   +2.524754706541507e-01   -1.759222978470090e-01   +4.634186878524775e-03   +3.233973558356876e-02; -4.232344509306998e-02   +1.912542512985541e-02   +2.600221458150249e-02   -1.426634535085325e-01   -3.022798215221419e-01   +7.227382127639599e-02   -2.059475806987739e-02   -1.551225269297953e-01; +1.075752082595357e-01   +3.871214972170098e-02   -5.106405479332658e-02   -2.158599314528186e-01   -9.644610866307536e-02   -7.222409749338128e-02   -8.560124767292969e-02   +2.292728021127088e-01; -2.054744138916512e-01   +1.260328136517397e-01   -1.350112883284327e-01   -1.600171749574167e-01   +1.185927591164990e-01   -1.391612632641341e-01   -2.043816030023123e-02   -1.274966992584231e-01; +1.216833054828704e-02   +1.000422865639283e-01   +1.445401731576266e-01   +1.723368777357823e-01   +7.805491408708204e-02   -2.042541645918455e-01   -3.826253959968759e-02   -3.509109841338139e-02; -1.919510253640543e-01   +1.345594442776030e-02   -6.854150448951885e-02   +3.492287039572771e-02   +2.741932084062688e-02   +3.000056498100309e-01   +6.429714153637925e-02   -1.538275247135431e-01];
L1E_L2E_iAMPA_netcon = [-9.874014623112767e-02   +1.351182657458820e-01   -1.482196274115475e-01   -5.468053195430192e-02   +8.142034746919734e-02   +1.860972645748286e-01   -1.314141078167335e-01   -7.436123405964100e-02   -1.216187267294180e-01   +3.087570222775028e-02   +2.810021336049979e-01   -1.306307670233682e-01   +1.014313508846312e-02   -8.109609642493128e-02   +1.128224923773773e-01   -2.184104564353898e-01; -4.731433970425837e-02   +9.143046398189820e-03   -1.226752350004540e-01   +9.992762506414818e-02   +2.075301732341868e-01   +2.491302148356754e-02   -9.170418814304478e-03   +2.085071052265500e-01   +1.476921871802132e-01   -1.184296772360407e-01   +3.208567309995919e-03   +6.878735147208734e-02   +1.089699458263005e-02   -1.319115701848151e-01   -1.241221447115146e-01   -2.366626637043668e-01; -1.103402433651446e-01   +4.923021822252509e-02   +8.653527550104689e-02   +5.839190561390636e-02   -8.498468528261829e-02   +4.488231068230097e-02   -8.670622633381608e-02   -6.397694243710968e-02   -2.022258300786072e-01   -1.100409572169675e-01   +1.418612451569476e-01   -1.099125160248031e-01   -2.799087224895969e-02   +2.689184302815837e-01   +1.760727641726840e-02   -2.486872167707470e-01; +1.676227587584684e-01   -7.242115717092261e-02   -1.059810574919164e-01   +1.481696820200975e-01   -8.611669411247110e-02   -4.697074561598032e-02   +1.876980303164096e-02   -3.152166808545418e-01   +2.994731161464839e-02   -1.833877560290991e-01   -7.705914870148976e-02   +1.262524816855704e-01   +3.195557391565122e-02   +5.772121323414597e-02   -2.294833636852577e-01   +5.723738230215489e-02; +2.871630170010280e-01   -1.833586019795188e-01   -3.701860167034965e-02   -6.078478451425622e-02   -2.314930626278509e-02   -4.797607048808383e-02   -1.463577033153972e-01   +1.114841734917365e-02   -3.004842853273417e-02   -2.857380934581051e-02   +1.443553917156858e-01   -1.584500827729488e-01   -2.164287021885593e-03   +6.000784862007441e-02   +1.840925451276692e-01   -1.783486891945375e-01; +1.990635924038903e-01   +3.514426235970428e-03   +5.942998034172285e-02   +1.732502052332216e-01   -5.019555167836776e-02   +2.327499159402518e-01   +7.314737236569900e-02   -1.047807008568944e-01   -3.451120588597915e-01   -1.025468039685095e-01   -3.072468490921880e-01   +1.267895014660218e-01   +1.422364606307434e-01   -3.740284422111244e-02   +1.604052254091059e-01   +1.474723510458181e-02; -2.076166918315331e-01   +1.310525579904106e-01   +1.421176992167164e-01   -4.891653471708819e-02   -7.274327944205496e-02   +6.446659763072375e-02   -1.609895160926362e-01   -1.327883670950781e-01   -9.262561167843732e-02   -1.562398981256376e-01   +1.491038976156116e-01   -3.018759081069062e-02   +2.861183797385922e-02   +1.405732971386967e-01   -3.847792642845965e-02   -3.982941611573152e-02; -1.093601701343721e-01   -1.482491205294115e-01   +4.309561476510108e-02   -1.754589472433324e-02   -2.424493637254963e-02   -1.043210379712504e-01   +1.634599031042521e-02   -3.226134257986505e-03   -6.744455311315489e-02   +9.249475731824040e-02   +1.694230368998728e-01   +1.579807467617018e-01   +1.025359776841044e-01   -2.223675514217614e-01   -2.477806768838888e-02   +1.985964815149572e-01];
L2I_L2E_iAMPA_netcon = [+3.117221744069555e-01   -1.919525370110076e-01   -2.230274952104865e-02   -1.788964159039722e-01   +8.912785615726733e-02   +7.785963646898761e-02   +1.674385671855845e-02   -8.817715586735515e-02; +2.823995695929312e-02   -2.444474405276786e-03   -1.033459160807829e-01   +1.374945164732820e-01   -1.695984764263438e-01   +2.745676611312841e-03   +3.409199791074580e-02   -1.321260520780133e-02; -4.229368120735828e-02   +6.726526607164356e-02   -7.654247269298878e-02   -6.848305986115762e-02   -2.417964528291193e-01   +1.338884184918032e-01   +8.019774678220037e-02   -2.161152985124564e-02; +1.221559848085972e-01   -1.383130297249735e-01   +1.385123043439700e-02   +8.438984278303785e-02   -8.254900258484334e-02   +1.278653033001353e-01   +2.270326966661125e-02   -1.312534849333425e-01; -1.406071304819639e-01   +1.731832828273474e-01   +4.188055482419061e-02   -2.379917538432364e-02   +1.284084974103358e-02   +1.103235234477095e-01   +3.446569925184030e-01   +2.823282416406172e-01; +3.427423053923015e-02   -1.188900186626101e-01   -8.665330004395300e-02   +2.587479809494722e-01   +1.004062196619164e-01   -2.373111219911978e-01   -8.700798078050985e-02   -5.151177186049904e-02; -1.551863836895600e-01   +9.239782904308434e-02   +9.544565379543193e-02   +3.016822319972603e-03   -1.341370564525553e-01   +1.037271512143266e-01   -6.856506123204101e-02   +8.039800202113295e-02; -1.680155419277149e-01   -1.040558268899156e-01   +1.557922721855300e-01   +1.138435576615103e-03   +1.463608149193622e-01   -6.789534176679191e-02   -1.119518902628870e-01   -2.458439784254036e-02];
L2E_L2I_iGABA_netcon = [-3.425613015240535e-02   -8.678052019634337e-02   +9.709276472228974e-03   +1.652201678778528e-01   -4.466328999205541e-02   -4.020554375286349e-02   +1.238483997380049e-01   -3.822193199315754e-02; +1.740887341650209e-01   -2.467256271607120e-01   +1.510613907379140e-01   -2.642782443865795e-02   +1.233619773814506e-01   -6.061946954670444e-02   -6.556816898769319e-02   +2.533198721105154e-01; -2.834810376961600e-01   +3.146553346906341e-01   -6.081181056897200e-02   +6.602059758742571e-02   +1.796605023314188e-01   -1.454017353074549e-01   +1.474680548910050e-01   -4.057502015818904e-02; +1.679683392911745e-01   +4.300211609474423e-02   +1.403862259298223e-01   -2.344397963872901e-01   -2.181705011843014e-02   -1.444758855540085e-01   +4.984827733383347e-02   -7.836288805191693e-02; -1.063590508245711e-01   -2.136058551734120e-01   -1.856093086409893e-01   +4.579624040377198e-02   +1.072397069394098e-02   -2.697981760357925e-02   +9.843763399216995e-03   +8.144260959448656e-02; -2.318246139607756e-02   -2.368621247537614e-01   +1.345202491626981e-01   +5.623534080507394e-02   -6.851774059739944e-02   +7.208316258597967e-02   -8.602108698658446e-02   -3.243605176719411e-02; +7.009625518720894e-02   -4.628090624623875e-03   +1.923765575811823e-01   +1.595053564251828e-01   +1.409618025405691e-01   +2.063069841724622e-01   +1.175639908129665e-01   +6.516852847090385e-02; -1.381037026150960e-01   +2.462427636642729e-01   +2.398532278367636e-02   +9.769843680596597e-02   -1.239957759806991e-01   -9.754588211568356e-02   -7.479352735022810e-02   -4.558650454757054e-02];
L3E_L2E_iAMPA_netcon = [-1.418337934751471e-01   -3.117956077449344e-02   +7.304161341022460e-02   -1.082522946560146e-01   +2.316597436744397e-01   +1.291929977034898e-02   -5.600463886083212e-02   -1.126014863671989e-01   -1.992174496823745e-01   -3.839012640919650e-02   +1.698558929229071e-01   +1.178180054978093e-01; +9.000091696151800e-02   -5.505325558038383e-02   +1.359558886230199e-01   +4.023655633331014e-03   +2.091839667027380e-01   -1.749846406227227e-01   +7.659665612794770e-03   -4.016705535291877e-02   +1.635007596245561e-01   +2.518866631488785e-02   -1.759004475723234e-01   -1.382492468782343e-01; +1.157150008566154e-01   +5.445650761613810e-02   -1.234731595678678e-01   -3.540286773409553e-02   +1.891747941908285e-01   +6.283272748889647e-02   -1.175068758740471e-01   -8.936835573806970e-02   -1.802316466533281e-01   -1.507800427734423e-01   -1.645125007457269e-01   -8.369222903677588e-02; +1.012381803099658e-01   -3.823486402570422e-02   +1.414585173882018e-01   -1.119530473463616e-01   +9.076789382467454e-03   +2.450595386783702e-01   -1.770876566502438e-02   +1.912383877462462e-01   +3.297458908488878e-02   +1.984766872768462e-01   -1.604407736496356e-02   -1.802823508647648e-02; +2.018742964050012e-01   +9.828079946663135e-03   -2.097272903212803e-01   -1.965077534428329e-01   -7.883073749917528e-03   +1.052647469007257e-02   -3.445836294580375e-02   -2.104709021996866e-01   +1.491843525696866e-01   -4.246745421395703e-02   +5.722899951588853e-02   -3.290893022672892e-02; -2.786627536960625e-01   +2.509337289019202e-01   -9.607942430490521e-02   +6.813143498366624e-02   +1.481883913884577e-01   +1.433113550680604e-01   +1.811901551565782e-02   -5.292166678362591e-02   +6.528369312420826e-02   +9.052939154430696e-02   +1.971580344710294e-01   -1.474140302815991e-01; -8.220368185067045e-02   -1.642203285078032e-01   +6.400500053212897e-02   -1.787850669899274e-01   +2.887755164474570e-01   -1.801481107298387e-01   +1.314406234768269e-01   -6.752862529837574e-02   -7.532529046937993e-02   +1.027551246033279e-01   -2.488642524876811e-03   +1.174640567002997e-02; -2.557191225639750e-01   -1.849181693529312e-01   +5.372331053251288e-02   -1.405371138695971e-02   +7.247836726180554e-02   -1.987287022355795e-02   +1.409814891648427e-01   +2.050262374626471e-01   -3.808428580544719e-02   +1.599572981917468e-02   +2.634231611133753e-02   -2.777716619029236e-01];
L3I_L2I_iGABA_netcon = [+1.568468439953729e-01   -9.544775578853459e-02   -6.547468368005546e-02   +4.034857682485900e-02   -1.512055390191867e-01   +9.061220005775794e-02   +7.655828830815982e-02   -2.919486708317370e-02   +1.154920474755024e-01   -1.491461121504122e-01   +1.193211414079710e-01   +5.512571507408758e-02; +2.051766501988779e-01   +1.405906628536130e-01   +4.631943263428950e-02   -1.261335085724786e-01   +8.381913975677929e-03   -9.072828609476166e-02   +7.939189537519183e-02   +1.980849989353942e-01   +1.126478936552584e-01   +6.298327869869724e-02   +1.388975142695011e-01   -6.554059418191953e-03; -1.860627935014708e-01   -2.287086541950791e-01   +3.582625615402407e-02   +1.925811046653497e-01   +1.331345002456565e-01   -7.853571816746893e-03   +2.301778674871451e-01   -1.301193005237131e-01   +8.211728268229368e-02   -1.888386672350552e-01   +1.312909993349953e-01   +1.176128940259883e-01; -1.032147706976836e-01   +1.678314692037516e-01   +5.159337685913679e-02   -1.509598033932058e-02   +7.580941971794733e-02   -9.047274793327861e-02   +2.524430664261471e-01   +1.272733972921713e-01   +1.132245445912865e-01   -1.510005200983403e-01   +1.848416318820556e-02   +3.621771530160114e-02; +1.059464131562712e-01   +2.442040344581895e-02   +1.956569438763171e-01   -9.437302423202457e-03   -4.115382972121302e-02   +2.455567018090543e-01   -1.528575641284631e-01   -2.225313071402314e-04   -1.913658028722163e-01   +1.339741914667914e-01   +1.592080405562465e-02   +6.723523123369785e-02; +9.025170523049733e-02   -2.412044500506787e-01   -2.669596886817844e-01   +7.864658284463578e-02   -1.790232898254294e-01   -1.531505639370274e-01   -9.475020629249992e-02   +6.587720210919518e-02   -2.292896738017909e-01   -1.349775933729373e-01   +4.268940497466920e-02   +1.952692727358828e-01; -1.022407729949475e-02   +1.404921490208925e-01   -1.033590258397368e-01   -1.876178439010492e-02   -1.685554967036627e-01   -8.464948948252032e-04   -2.012766887562644e-01   -7.768029568160191e-02   +1.167624677438063e-02   -1.482510402243109e-01   -2.493512312384576e-01   +7.209435432280623e-02; -5.424666442785583e-02   +7.386262458899401e-02   -2.001877311347308e-02   -9.110335526907776e-02   +1.040535158127558e-02   +8.357209703350220e-02   +3.809866870208684e-02   +1.589837062970838e-01   -2.050711530444415e-01   -1.413359268050605e-01   +2.331229515838086e-01   -4.903737141460850e-02];
L2E_L3E_iAMPA_netcon = [+1.533695739129098e-01   -9.247875015328412e-02   -2.514012191274539e-01   +1.393664603242817e-01   +5.820207554937465e-03   -8.369620753005673e-02   -2.234403861363098e-01   +8.402046503251256e-02; +7.344636560329898e-02   -2.302558260887597e-01   -1.432217168991931e-01   -2.014468581930894e-01   +1.277445387886514e-02   -2.483018701712855e-02   -9.972566112006494e-02   +2.649469874396750e-01; -1.553330532407923e-01   +2.554091936788965e-01   +1.579914307507897e-02   -9.400933995725483e-02   +9.133807243796056e-02   +1.214952101977090e-02   +5.361184441176779e-02   +3.574784185749012e-02; +3.340696927636335e-01   +3.173256114744834e-01   -4.246833055241611e-02   -5.678358054674949e-02   +8.901394270375136e-02   -4.526749419913526e-02   +6.476321900232017e-02   +1.850167203176578e-01; -4.362607799892221e-02   +1.536294577900008e-01   -3.967205894023076e-02   +1.576317303221721e-01   +2.444692676609336e-02   -6.585226606475211e-02   -1.431235634732222e-01   +4.947571933250585e-02; -7.233754119096711e-02   -1.558600154288463e-01   +1.781668238973073e-01   +9.390094842488123e-02   +6.920146549680664e-02   +1.746351166887607e-02   -1.115713240377900e-02   +1.419953055819868e-01; -1.053377954253910e-01   -1.550506782575192e-01   +2.100321286694380e-01   +3.819154575260809e-02   -6.772801185813068e-03   -2.119735990446153e-02   -1.218464830322721e-01   +9.671064208327777e-02; -1.216206894948011e-01   +1.364834796938308e-01   -1.000984520936775e-01   -4.872008277577401e-02   +6.261738302365889e-02   -1.129529180530237e-01   +3.305675006785294e-02   +1.668133577963957e-01; +8.745407869350977e-02   -1.174018648907798e-01   +1.943259186708696e-01   +1.215285897065555e-01   +1.276966010962118e-01   +5.005715746381262e-02   +1.633252324674511e-01   -5.070549506528169e-02; -1.794673298953388e-01   -1.048475415402635e-01   -2.464853195473966e-04   -1.282864934300122e-02   -2.107881942390704e-03   -9.175821748388045e-02   +1.736632486745589e-02   +6.420889739836542e-02; +1.989727270641668e-02   +1.173888836549253e-02   -1.391675653686721e-01   -2.670820738739879e-02   -6.097104199521907e-02   +1.015378866153478e-01   -8.414225807685585e-02   -1.054118637319408e-01; -9.910384497939649e-02   -4.760482831318140e-02   +4.829301916195390e-02   +1.340846544528495e-01   -5.614587350677661e-02   -1.802570521904548e-01   -8.011396025467546e-02   -1.436854133849865e-01];
L2I_L3I_iGABA_netcon = [-1.023242437220904e-01   +3.212756545236126e-02   +1.663419042252015e-01   -1.192551419037340e-01   -1.569797938864326e-02   -4.283114718271179e-02   +9.622092489785519e-02   -3.008864044560393e-02; -1.042951917095084e-01   +4.620756497533181e-02   -7.233377586608968e-02   +4.467364857468164e-02   -1.244937313717681e-01   +3.828003956509286e-02   +3.275481175706811e-01   +3.736472397358449e-02; +1.534883533978353e-01   -5.550495710210924e-03   -3.063641557505934e-02   -2.000107344493602e-01   +2.343126544397929e-03   +1.468149887476681e-02   +6.190072683633127e-02   +1.528943364601411e-01; +7.956618358648679e-02   +1.937876275747411e-01   +5.016289348123670e-02   -5.163074933608962e-02   +9.226035200543665e-02   -1.070413903784998e-01   +2.243137844442300e-01   -1.798351681035954e-01; -1.025461754588487e-01   -2.836886517705315e-02   -1.645121885506542e-01   -1.161235814855671e-01   +9.279973772036887e-02   +1.291989747295806e-01   -5.663830823969986e-02   +3.814417205494865e-02; +1.442596121149602e-04   -1.254745934358567e-02   +8.304505867160111e-03   +1.878692517019221e-03   +8.927840273878881e-02   +1.557447350442001e-01   +9.811092264234804e-02   +1.222541466562621e-01; +1.034711625393984e-01   +5.829357425048724e-04   +9.801901383340310e-02   -1.230857114901313e-01   -4.804578133716929e-02   -3.601743014550623e-02   +1.635428813945666e-02   -2.206183147940987e-02; -4.028575375066679e-02   +2.111621754627599e-01   +1.057786255021115e-01   -5.667412020842841e-04   -1.214777306371345e-01   +1.246887111412663e-02   -2.240601411254259e-01   -1.163917194969357e-01; +2.924062493959679e-01   +1.564667044856599e-01   +5.885220742216394e-02   +1.846004171574819e-01   +5.847670546055037e-02   -9.170837615873600e-02   +2.800021648512837e-01   -1.772473185966403e-01; -1.740010913383592e-02   -1.122323394101964e-01   -1.118352137656219e-01   +1.183426367481121e-01   -6.237013386405245e-02   -2.683133842119074e-01   -7.049381830317517e-04   +4.257060515824744e-03; -1.508285659444784e-01   -6.313479477631637e-03   +1.975787496587075e-03   -1.627893193001188e-03   +1.826057484924377e-01   +1.123471162210649e-01   -8.468524176134228e-02   -1.268597932934478e-02; -6.652585158253885e-02   +1.823949289554727e-01   +3.465895693201507e-02   +1.395486674482668e-01   -5.782244760586783e-02   -1.173449470032542e-02   +7.433093429065983e-02   -1.088871380746032e-01];
L3I_L3E_iAMPA_netcon = [+1.481900161087511e-01   -5.467963006053014e-02   +3.076376364602552e-01   +1.062638497088047e-02   +3.304750924451988e-02   +1.376578140419094e-01   -2.445942815735065e-01   -1.791347906314384e-01   -1.963745039991426e-02   +1.876461346251341e-02   -1.267177838970008e-01   +4.224770700605480e-02; -1.953228608000301e-02   -3.934933253214619e-02   +3.118287477033039e-01   +8.452111034392130e-02   +7.121306827991345e-03   -3.546206893588052e-01   +2.881180006222827e-02   +2.796532438558196e-01   +2.268114638283834e-01   -1.038043973755944e-01   -6.955369001785100e-02   +7.708736426908348e-02; -1.844871214481292e-02   -2.016230926241926e-01   -1.987849382659161e-01   +4.382833091597001e-02   +1.425866887873414e-01   +3.358812199828501e-02   +1.631885406512681e-03   +1.463655530956460e-01   +7.857834627314383e-02   -5.940696051471024e-02   -6.622985345157424e-02   +1.514209274475745e-01; +2.537386781316413e-02   -3.793133599242551e-02   +3.151264960404087e-01   -1.546941191954107e-02   -2.079700332227822e-01   +9.052382063617934e-02   -2.283153438942558e-01   +1.074878886040156e-01   +4.963611824097188e-02   -4.320607273184715e-02   -1.298828119905423e-02   +2.503446753262900e-01; -5.790995181708555e-02   -2.785669829341365e-01   -1.241549488746333e-01   -2.214584849345938e-01   -1.140391106904980e-02   -2.118768369702929e-01   +1.902888203338153e-01   -2.900836596233214e-02   -1.366954542462061e-01   -2.669607282446107e-01   -1.468881076763680e-01   -1.405941449381315e-01; +1.693514277310445e-01   +1.482839528478652e-01   +9.396367450615435e-02   -2.767858110465499e-01   -2.593406191702540e-01   +8.719877463321642e-02   +1.826322573702505e-02   -2.608649888913543e-02   -6.372105504991472e-02   +1.612512237742063e-01   +8.434991184158294e-02   -1.993651138524387e-02; +2.260835660863440e-02   -2.042385241645610e-01   -8.580089743496028e-02   +1.384745253758380e-01   +1.114464757504063e-01   -1.632731257434734e-01   +1.318112189778584e-01   +2.823687281914654e-02   +9.472772943935689e-03   +4.402787301272084e-03   +9.361384249811716e-02   +1.134710484219437e-01; +4.084461338370626e-02   -5.832479696522443e-02   +8.908512570926741e-02   +6.895017302823504e-02   +2.994780889560236e-01   +1.327663196594831e-01   +9.321275017298644e-02   +2.147907825762754e-02   +4.368138392427657e-03   -3.803861696477107e-02   +3.037709934400015e-02   +1.402520942687697e-01; +2.300471503540869e-01   -1.810084007946525e-01   +1.317840908384150e-01   -1.629238711615202e-01   +1.240552649783604e-01   +2.480250361664991e-01   +1.791615763893022e-01   +1.046963035853530e-01   -1.091879389401912e-01   +6.393507258760277e-02   +5.179482291253597e-02   -3.324382483916458e-01; +1.127645052043317e-01   -9.643439287613664e-03   -1.541894651100746e-01   -1.201147558444209e-03   +2.630181650955932e-02   -6.477165164834227e-02   -9.318903671013265e-02   -4.744977516669327e-02   -7.841595788282056e-03   +2.428951979220832e-03   +1.619188499247375e-01   -7.364547389968047e-02; +8.614478160699765e-02   +2.907283493357046e-02   -2.219265488417722e-01   -1.754731130366176e-01   +1.674091714912295e-01   -2.377085095629013e-01   -1.145302315878281e-02   +1.858560104821261e-01   +1.275183131352102e-01   -3.574039034317700e-02   +2.033495705184595e-01   +9.592735270944279e-02; -1.053252276211401e-01   +1.903894508785297e-01   -4.390582248334141e-02   +1.608777342706348e-02   +1.737472069358803e-01   -1.555906428439102e-01   +6.865825278590836e-02   -1.796764870092360e-01   -9.970780731220591e-02   +2.101671764215169e-01   +2.070261778705473e-01   +1.511883701580291e-01];
L3E_L3I_iGABA_netcon = [-4.419354773828645e-02   +1.938973256662447e-02   +9.264341161010391e-02   -6.569130724705573e-02   -1.530681675737457e-01   -1.862336439235845e-01   +1.251385148788597e-01   -1.646126110824718e-01   -6.658758780233216e-02   +5.384732811215205e-02   +3.952815673694677e-03   +1.205776489355208e-01; -7.569574357849487e-02   -7.118311955525179e-02   -1.051344718169737e-01   -1.659088985879259e-01   +2.923695882066889e-01   -9.276757183727852e-02   -4.511252896173250e-02   +6.607629576541042e-02   -8.088871777953137e-02   -1.507940290094715e-01   +3.135034468477321e-01   +1.121160359619075e-01; -1.028115350438521e-01   -3.102590932134360e-03   +9.645503893923621e-02   +8.725898440128688e-02   +6.956464846859035e-02   +1.134154372534543e-01   -2.454266121074710e-02   -5.361325694175113e-03   -7.994851671193028e-02   -1.426067126315326e-01   -8.829114805450665e-02   -4.026975829111860e-02; -9.221879214772806e-02   -7.388494405995667e-02   -6.883065656744744e-02   -6.610720761394537e-02   -1.168352119878133e-01   +2.782034217601331e-01   +6.273912115925717e-02   -7.660667622108232e-02   +2.450496969151957e-02   -3.068862660911958e-02   -2.423164755195298e-01   +1.797564493607809e-04; +3.265498649476848e-02   -1.395790185308454e-02   -2.278932418891408e-02   +1.092156637968974e-01   +4.851825969398897e-02   -4.830667977696913e-04   -4.547843772900589e-02   -2.598034399774677e-01   -1.977346539555494e-02   +7.075861317820477e-02   -2.330249511564647e-01   +2.640080129133617e-01; -7.598547438286625e-02   -9.576298025169190e-02   +1.852196046069399e-01   +2.237626493509564e-02   -2.002438039277389e-02   +3.667527471166288e-02   +4.082733368009503e-03   -1.061368873992319e-01   -1.624684043980410e-01   -9.597254377213081e-02   -8.019740712813711e-02   -5.308040184425596e-02; -1.599072296663302e-01   +3.544800501727292e-02   +1.033509901693358e-01   -1.553606786228101e-01   -1.825976119366011e-01   -1.935163395034283e-01   -1.018255544746984e-01   +2.016083583850657e-02   +6.114101890256449e-02   +2.837219411442210e-01   +1.765696374158845e-02   -7.634008687137223e-02; +5.648867081835065e-02   +9.428266520023799e-02   -1.390426155828285e-01   -1.343311000745328e-01   +3.898764635394093e-02   +2.841719627334518e-02   +1.338352130276065e-02   +6.686791593285517e-02   +8.226598930841929e-02   +1.455443869066244e-01   -6.713169701717565e-02   -9.207346150118960e-02; -1.273172193586593e-01   +2.325466201015845e-01   +9.036467938453530e-02   -2.073357557885560e-01   -2.807843540917363e-01   -2.735611836708216e-01   -1.919010790047268e-01   +1.083964773033641e-01   +1.227212117829754e-01   +1.780134878550332e-01   -3.485904319612152e-02   +3.257236324516369e-02; -1.070754086045065e-01   -1.783010516933730e-02   -5.009265242341095e-02   +8.194487829914109e-02   +1.723075347661246e-01   -1.220360546711186e-01   -2.924835216808582e-03   -9.734094655325425e-02   +2.679637330917921e-02   -9.888241957818772e-02   -7.175387745628932e-02   -1.247466385851101e-01; +1.256872700302201e-01   -6.179268466915376e-03   +1.279309447200642e-02   +1.465056650630139e-02   -3.361729211406891e-02   +2.506998114023089e-01   -8.456786960722004e-04   -2.197654387180614e-02   +1.077552657008434e-01   +9.960944752484338e-02   -1.853810837652866e-01   -2.187940025296539e-02; -1.195145092717137e-03   +1.441099039502421e-01   +2.124975381751080e-01   +8.609246981401250e-02   +2.463185627428043e-01   +3.994863685121018e-03   -4.962705543437754e-02   +8.861202984794066e-02   +6.042940700320290e-02   +2.610338373682680e-01   +2.177884700238158e-01   -5.459521851659877e-02];
L2E_Input1_iAMPA_netcon = [+6.516109716949819e-03   -1.491760540555375e-01   +2.401099489952599e-01   -7.705827795004430e-02   +1.248861821298650e-01   -1.526704813840190e-02   +4.782776492192825e-02   +1.257279681134645e-01];
L2I_Input2_iAMPA_netcon = [-1.183035429131938e-01   -9.741232251936207e-03   -1.431201159392825e-01   -3.063498954352153e-01   +1.361906745465652e-01   -9.112051932084940e-02   +2.580749744423155e-01   -1.840706191878076e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
