function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.370353692159424e-01   +2.362823582394271e-01   +9.735150680419884e-02   +1.680470058671138e-01   +4.909686013003303e-01   +1.449188814898276e-02   +2.037829165672952e-01   +2.315795384484567e-01   +1.160348398091216e-01   +3.089864076991763e-01   +4.868945886319270e-01   +4.797662668896724e-01   +1.621427412376729e-01   +3.030336244646959e-01   +4.313497623573548e-01   -2.510115305005882e-02; +1.285291511093016e-01   +1.560912830752190e-01   +1.801489757546609e-01   +3.656722173087851e-01   +1.882902313952274e-01   +3.545314933120380e-01   +1.492080364641760e-01   +1.214590916816005e-01   +1.422544319402132e-01   +1.714655709182736e-01   +1.265120675096338e-01   -1.206135831500626e-02   +3.859322329862233e-01   +2.083222287620287e-01   +2.195193480247910e-01   +3.259196584530559e-01; +3.273122975883341e-01   +1.935117910795644e-01   +2.295194290356444e-01   +9.582111399802500e-02   +1.618874917968474e-01   +9.921767882518752e-02   +3.242318664818709e-01   +1.114066526834965e-01   +1.101390640952464e-01   +5.009918120895290e-01   +2.420218124194479e-02   +4.518397339897781e-01   -8.502433923914185e-04   +3.761537132000226e-01   +1.634755888683194e-01   +4.095255915306317e-01; +4.270060060364791e-01   +4.198823966346593e-01   +4.427837661661308e-01   +4.400212610700985e-01   +3.840017940297341e-01   +2.497252511385582e-01   +2.341126877579338e-01   +4.352055932545010e-01   +7.893035521566530e-02   +3.521875572268642e-01   +8.549302112220591e-02   -3.025932805202266e-02   +2.842435642914050e-01   +6.909718868203088e-02   +3.783002350293817e-01   +1.648790706605813e-04; +1.846775148077186e-01   +3.375063165257677e-01   +4.432818856532691e-01   +2.537913647930875e-01   +6.821510787461971e-02   +1.151135390793367e-01   +4.340047125308800e-01   +2.999557956412004e-01   +1.165902257144856e-01   +5.097334113917397e-02   +7.493918230713396e-02   +2.233365886579702e-01   +3.648237710493121e-01   +2.747987892228459e-01   +3.968960904447228e-01   +4.865633359500848e-01; +2.348837012816998e-01   +2.316578472641458e-01   +2.117453799057600e-01   +4.645689466555794e-01   +1.181129769614438e-01   +3.167474328630676e-02   +2.368509874772526e-01   +3.122038315205745e-01   +3.740505708186664e-01   +2.624747422690330e-01   +4.412414511462924e-01   +3.861034379632556e-01   +1.817265813717359e-01   +2.210224833411851e-01   +1.804870551743900e-01   +1.586893906079162e-01; +4.234470689131268e-02   +1.430666466725745e-01   +2.979719021972118e-01   +3.741053755941241e-01   +1.383937906173563e-01   +9.070471650887386e-02   +2.279655033947588e-01   +2.914034673467734e-02   +4.107310204366956e-01   +1.361867465679704e-01   +4.324392198951421e-02   +2.310081592802297e-01   +2.472638401473450e-01   +2.075247057610612e-01   +3.440751114781095e-01   +3.104904821672044e-01; +3.634022117521725e-01   +4.099083938518402e-02   +1.180650508130716e-01   +1.241009983394712e-01   +1.091628187742538e-01   +5.108792186996500e-01   +1.743447359501004e-01   +2.115671355412342e-01   +2.559740371779842e-02   +1.005165399507214e-01   +2.029140161571685e-01   +2.510720001448428e-01   +2.152977217917142e-01   +3.800862801785598e-01   +1.015275362899319e-01   +8.686706894948838e-02; +3.130934114645845e-01   +1.191252690186802e-01   +7.202168451844873e-02   +2.864553369373570e-01   +3.697435092094841e-01   +1.545388932542928e-01   +2.080127097417705e-01   +3.106213972970805e-02   +2.679957122567475e-01   +5.442577637748602e-02   +3.167633620781384e-01   +7.803861967154452e-02   +1.381511509912239e-01   +2.618680252089397e-01   +3.729647273878346e-01   +2.023370004504585e-01; +3.093809659861295e-01   +2.128553273984344e-01   +3.115821131594285e-01   +2.414837596946963e-01   +4.139020931060498e-01   +5.141327066636531e-01   +1.122965345715342e-01   -3.427806711315650e-02   +1.734435009654249e-01   +4.203728147695545e-01   +3.194639261451994e-01   +1.148004813414217e-01   +4.203245778378938e-01   +3.300699593269149e-01   +3.539020906701122e-01   +6.330068283220477e-02; +1.101001643743927e-01   +1.762543680614138e-02   +3.656185929791714e-01   +1.265004719314661e-01   +1.287538195979718e-01   +5.015042088806196e-01   +3.493870761797246e-01   +8.626104454150794e-02   +2.002017641916570e-01   +1.634725764171334e-01   +2.384390531583020e-02   +2.900126733475490e-01   +9.590468029852725e-02   +1.346448611974395e-01   +3.145984379928219e-01   +1.833602486239637e-01; +8.883504224829576e-02   +1.671688965061435e-01   -3.004199423610358e-03   +2.998370919760960e-01   +1.852218394349020e-01   +2.702031844383086e-02   +4.765387915035436e-01   +4.628639344141664e-01   +2.201280809136489e-01   +2.499173050315444e-01   +2.075803515896955e-01   +3.645613468265989e-01   +3.630998590191951e-01   +3.483001989342615e-01   +4.834514520440825e-01   +4.427995970564742e-01; +4.425627519408464e-01   +4.710990813530237e-01   +1.089714729164340e-01   +5.395732839593090e-02   +3.580357443552502e-01   +2.332360471743332e-01   +3.826374909755960e-01   +3.268582292933118e-02   +4.521583590526033e-01   +4.299355932311963e-01   +3.081899610523179e-01   +1.349159735389620e-02   +2.078403615943762e-01   +2.206619505853564e-01   +2.326511789811529e-01   +1.243235324774585e-01; +3.981461528217698e-01   +1.345373299966355e-01   +3.171536985306666e-01   +3.888960302282226e-01   +3.720061041913722e-01   +9.616111245871486e-02   +2.313965849993230e-01   +1.915213679804276e-01   +3.223782512057005e-01   +3.163305141536926e-01   +3.026269256589256e-01   +5.106718001204591e-01   +2.832052269901314e-01   +3.025136537781970e-01   +5.065006228273632e-01   +2.593253759216090e-01; +3.748445624962209e-01   +1.426439603569503e-01   +3.969968790817592e-01   +3.955120499965507e-01   +2.368994993328584e-01   +2.602848005053496e-02   +3.692585038361260e-01   +2.137838654857612e-01   +2.461980387484927e-01   +3.083413090566975e-01   +6.674314400722753e-02   +8.855807159446837e-02   +4.822223365280481e-01   +3.280082147686515e-02   +2.487967446668909e-01   +4.777074153868590e-01; +4.658496809499137e-01   +2.440394842544155e-01   +3.430329854168052e-01   +1.500196877671720e-01   +3.658405749338788e-01   +2.966321756152935e-01   +2.955499653797657e-01   +2.804960364088348e-01   +2.232024640651491e-01   +1.529953925442907e-01   +1.302014723767194e-01   +7.669395808498297e-02   +1.199598122597070e-01   +5.136138755449979e-02   +3.140383092203733e-01   +3.462980259207413e-01];
L1E_L1I_iGABA_netcon = [+8.620172735792060e-02   +4.427627551687929e-01   +5.171730603972219e-01   +3.809423751692952e-01   +3.190481336405773e-01   +3.151196021942503e-01   +4.873965411509364e-01   +8.621702444904222e-02   +4.463024958664655e-01   -3.815013381290688e-02   +3.961321415331638e-01   +1.631918464904775e-01   +1.066919678289722e-01   +4.755605543371114e-01   +2.051725534740079e-01   +3.621779567075014e-01; +3.367637949628640e-01   +2.674942074597386e-01   +3.099629913480397e-01   +1.480260982425225e-01   -1.092540519620279e-02   +3.287685328488873e-01   +3.104709731529048e-01   +3.257795753788679e-01   +4.804792820312613e-02   +1.973534883615204e-02   +4.640816208042070e-01   +1.502695602364275e-01   +2.367405275364644e-01   +2.869258609210766e-01   +7.148867412883395e-02   +2.378334728398138e-01; +5.474745400436647e-03   +2.629531442095662e-01   +2.555422057396172e-01   +1.683923401087477e-01   +1.191842500754777e-01   +7.121961716961661e-02   +1.899831733099672e-01   +2.511727926211386e-01   +9.748478968515388e-02   +1.305410016618232e-01   +3.803587610237228e-01   +2.974911214744531e-01   +2.840545974334445e-01   +1.659340978989109e-02   +2.412091990758664e-01   +2.287563804618961e-01; +1.978960094287051e-01   +3.253406933105628e-01   +3.828801032220802e-01   +2.814279945100628e-01   +2.558730313428311e-01   +4.655305639237013e-01   +4.112856342106930e-01   -1.933963907331300e-02   +3.501974993836091e-01   +4.535590351403075e-01   +3.056550449578558e-01   +3.998532756272715e-01   +1.318424208185335e-01   +3.290593503764132e-01   +9.335885728064958e-02   +9.585159547593124e-02; +2.342864997296228e-01   +4.568514197118470e-01   +4.707504851609108e-01   +4.789534093658043e-01   +1.379180170119873e-01   +1.226234076405121e-01   +3.076016007183977e-01   +2.828115250766449e-01   +3.805734623705695e-01   +3.498964230059644e-01   +3.898105830491653e-01   +3.327669604913995e-01   +1.305947725730751e-01   +3.310666111993858e-02   +2.006520550322730e-01   +4.254505473572838e-01; +3.603702900653383e-01   +3.370071637995634e-01   +3.377478228681069e-01   +3.616968467255243e-01   +2.709282982090570e-01   +1.177955383953607e-01   +4.521668146677691e-02   +1.440562507044087e-01   +3.879175681978171e-01   +2.062450346876064e-01   +3.311280897307473e-01   -4.156203267844735e-03   +2.002738051652018e-01   -1.250482582464878e-02   +7.191459777476975e-02   +2.715607410015491e-01; +1.067233376162074e-01   +3.542520440758167e-01   +4.380313646027206e-01   +1.518281334519259e-01   +2.667219770868390e-01   +7.257430182776511e-02   +3.968511666611557e-01   +3.925452848688217e-01   -4.553281996650178e-02   +3.455848040794257e-01   +4.174685913969978e-02   +3.081341338297632e-01   +3.119578428039275e-01   +3.539798058497597e-01   +1.631922439932912e-01   +5.141039454251013e-02; +5.073654644041180e-02   +2.163382964303045e-01   +1.484841024392715e-01   +7.976343016948759e-02   +2.976394747625568e-01   +3.114539433329015e-02   +6.295506442999639e-02   +1.603521898783105e-01   +3.648204065141366e-01   +2.199138250434609e-01   +1.534595771654052e-01   +1.848925121501873e-01   +2.036523748364579e-01   +6.513963867186097e-02   -2.692712655375154e-02   +4.581321945937834e-01; +2.451482357229167e-01   +3.682663574936349e-01   +3.992021555873170e-01   +3.010312349852361e-01   +1.676824870348507e-01   -2.765517845701466e-02   +5.986015241777577e-02   +6.125821450986121e-02   +3.317947948499476e-01   +1.686106521463898e-03   +1.565201926432440e-01   +3.720564121038322e-01   +2.772283174302837e-01   +2.000220326940353e-01   +4.229366323910295e-01   +4.509176501248484e-01; +1.850938775797447e-01   +4.242069703733571e-01   +1.247521742352252e-01   +4.694275799104107e-02   -2.282260558918652e-03   +2.879940013738324e-01   +1.182371654562873e-01   +5.293516432774291e-02   +3.939772291042802e-01   +1.113004614813870e-01   +2.595134519633630e-01   +1.733662979595886e-01   +3.935799035306046e-01   +4.202540418138370e-01   +3.925423316690045e-01   +2.137444367563229e-01; +2.762444384920095e-01   +2.522604586729164e-01   +2.561980571751416e-01   +1.717880892559094e-01   +3.461321650118958e-01   +4.504409983830568e-01   +3.583256667772122e-01   +4.351994178364380e-01   +2.746054445109717e-01   +2.043785511797487e-01   +7.228249043877324e-02   +3.693331110661631e-01   +1.331604613239273e-01   +1.305294032940571e-01   +1.872153932927739e-01   +2.384629443487536e-01; +4.020080944538876e-01   +8.660478478538496e-02   +9.996139249497271e-02   +2.746266742495517e-01   +4.013203695771922e-01   +3.001421888924332e-02   +2.930041096432960e-01   +2.558008897079634e-01   +2.657629087665889e-02   +2.331414035389308e-01   +2.351471890235008e-01   +1.467686830401384e-01   +7.893318720122497e-02   +3.419765296367131e-01   +3.806159536588276e-01   +3.861050797551229e-01; +1.863807210899155e-01   +2.043276927217180e-01   +2.484414253369283e-01   +3.849847265029621e-01   +2.009479292344815e-01   +1.772546323808795e-01   +3.532277998908925e-01   +3.269155386855591e-01   +3.509050745087647e-01   +4.613636488431878e-01   +9.265709993008948e-02   +1.787989465458459e-01   +1.241668987803893e-01   +2.970120938525455e-01   +1.987146057967715e-01   +3.494119769842515e-01; +1.398969820496748e-01   +2.176825044339201e-01   +2.634110927765433e-01   +2.144385532546095e-01   +3.507411592549189e-01   +7.758297067978684e-02   +2.671654667018070e-01   +1.666464054436635e-01   +1.974295877980937e-01   +2.171539820386947e-01   +2.412763596140767e-01   +2.084679865388420e-01   +4.009028703907883e-01   +4.493139649635183e-01   +1.653928522681479e-01   +1.987792217664856e-02; +1.158568863580624e-01   +1.438456746542900e-01   +1.363986967992076e-01   +3.117779875723903e-01   +2.102919372985712e-01   +2.101171665713709e-01   +1.709811895199030e-01   +1.801483503593460e-01   +2.956118552544585e-01   +2.862281085278373e-01   +1.918456930523899e-01   +1.884015545757925e-01   +4.475376439646615e-02   +2.402423725825273e-01   +3.534949332062989e-01   +3.533801568176668e-01; +1.997221821338568e-01   +2.205536165009459e-01   +2.168432818491418e-01   +1.154512142866798e-01   +2.424421603988079e-01   +4.640954856220288e-01   +7.465422619757482e-02   +3.620492915897175e-01   +1.112377388309495e-01   +3.865120439388387e-01   +2.111913955238599e-01   +3.123256004247398e-01   +2.206277085129074e-01   +4.536796138747328e-01   +1.053735092533141e-01   +3.357490800017050e-01];
L2I_L1I_iGABA_netcon = [+3.855428544620355e-01   +3.827818244896215e-01   +3.583446253531717e-01   +2.259636183180557e-01   +6.066618200326418e-02   +3.313344703775638e-01   +1.675770539842915e-01   +4.657090967856494e-01; +2.982385975179975e-02   +2.186077075140599e-01   +1.171739185444097e-01   +3.488407914559397e-01   +2.762195917059385e-01   +4.165710998873025e-01   +3.181463558397349e-01   +6.139667005272276e-02; +1.345974519611093e-01   +2.004803595210841e-01   +3.698491235714236e-01   +2.656880397405031e-01   +3.715792233615822e-01   -5.938857696543532e-02   +3.034230224376256e-01   +4.591627954640509e-01; +9.679437732941487e-02   +4.089179753652604e-01   +1.532298393316689e-01   +2.717374438678764e-01   +1.541620933672864e-01   +4.116288754864635e-01   +2.154326256211539e-01   +4.330697080532587e-01; +4.325139442141619e-01   +2.271920102501513e-01   +2.176816771549211e-01   +1.921419278132797e-01   +4.536632227073434e-01   +4.646816070176092e-01   +1.957926424795647e-01   +2.771718855855073e-01; +3.003683674524443e-01   +3.113391413476604e-01   +4.791885199573032e-01   +2.591979550823515e-01   +3.484256362594130e-01   +2.092661482966912e-01   +2.082802780699653e-01   +3.380986713587611e-01; +4.808444788953165e-01   -1.055671157278364e-02   +9.798638921163078e-03   +4.140246490067273e-01   +7.802736732039078e-02   +1.340456268312107e-01   +2.288375940550406e-01   +2.144532566890774e-01; +2.749531562236918e-01   +1.851205394086201e-01   +1.325249531254717e-01   +4.546860388671989e-01   +1.547010976909775e-01   +2.816143440466143e-01   +1.679704564947013e-01   +8.944909037540841e-02; +2.916636352005831e-01   +2.244144638573836e-01   +3.551826848615145e-02   +1.579116394022104e-01   +2.629316431851849e-01   +3.570282564188832e-01   +4.540241336534674e-01   +1.211929768316069e-01; +2.612178390239818e-01   +3.740826955115605e-01   +2.564315421677091e-01   +3.836763042550742e-01   +3.755793991028843e-01   +1.040953463367330e-01   +1.250769311128632e-01   +6.124533423151751e-02; +3.964028211683088e-01   +2.350210670814570e-02   +2.560932357145927e-01   +2.518886394421199e-01   +2.659499726023566e-01   +5.150352704419526e-02   +3.172397855888907e-01   -2.330171858751904e-02; +2.288411444387423e-01   +4.800987746089491e-01   +2.047502364857875e-01   +3.391489727019194e-01   +4.477018789330348e-01   +1.761210113486062e-01   +1.868944837432008e-01   +1.604168250425414e-01; +2.319599105948378e-01   +4.722097286308688e-02   +7.757864930333042e-02   +4.378972253187228e-01   +1.821520767147304e-01   +4.557495751250735e-01   +2.496432933903703e-01   +2.718700260974848e-01; +4.931890837063867e-02   +3.747187823057415e-01   +8.948723561241897e-02   +6.817392509924544e-02   +1.672701212183793e-01   +1.836426152031929e-01   +4.874436223899472e-01   +1.335308750990031e-01; -6.710592270091409e-03   -3.635244223482897e-02   +3.090732548960258e-01   +2.799929887213211e-01   +2.033561570465388e-01   +2.969858095834291e-01   +3.786721448199450e-01   +1.595713481313311e-01; +1.383288953350675e-01   +3.821874300228822e-01   +1.009054092323084e-01   +4.092787069757643e-01   +9.909162308683803e-02   +2.486364412692254e-01   +1.924182546908511e-01   +1.419837977344534e-01];
L1I_L2I_iGABA_netcon = [+5.295884357764028e-02   +1.856120524305194e-01   +1.022250732927482e-01   +3.395563816116706e-02   +4.218921030923024e-01   +2.430044982606047e-01   +4.341245874561496e-02   +2.714322078278731e-01   +2.062076644431469e-01   +6.629594849683282e-02   +1.501607746756537e-01   +3.863187871272517e-01   +7.123122857091352e-02   +4.783971995654639e-01   +9.228954001424609e-02   +1.633612045248575e-01; +3.503942701770980e-01   +8.455154010739829e-02   +1.927834512966695e-01   +3.935678958756246e-01   +1.057869500592697e-01   +3.062534301046862e-01   +3.348344895938601e-01   +2.569734081938697e-01   +4.223303770558582e-01   +4.646858348250622e-01   +6.575076464515994e-02   +9.895342435316754e-02   +2.374406935322688e-01   +2.017098936035842e-01   +9.700102898594520e-02   +1.806043151239246e-01; +2.519502755801740e-01   +2.784658092895127e-01   +2.603037481316424e-01   +1.632281444169159e-02   +2.552646305237454e-01   +7.523462923047210e-02   +1.727637488851080e-01   +1.066867523161740e-01   +2.632320994179047e-01   +4.278323886413267e-01   +4.095594391375293e-01   +2.313376364873492e-01   +3.124997336509984e-01   +2.022683156304689e-01   +1.039681218853863e-01   +2.025797412374920e-01; +2.769972860362998e-01   +2.307419168047373e-01   +3.987583111664891e-01   -3.114299823926038e-02   +2.558641706724631e-01   +1.266543526423373e-02   +2.479419915712982e-01   +2.838676034431464e-01   +2.875726655572947e-01   +3.805217326693860e-01   +4.569702098550484e-01   +2.315617162862886e-01   +3.517727343708356e-01   +6.318752168805609e-02   +3.547223319809973e-02   +3.837247961553012e-01; +2.452770279269922e-01   +3.831538788964768e-01   +2.830884768996379e-01   +1.462616734538182e-01   +2.950829519277124e-01   +4.589033804229186e-01   +1.612946725485311e-01   +1.882746736513051e-01   +2.068022084882658e-01   +3.459176530966961e-01   +3.074009494692325e-01   +3.539449682597162e-01   +3.216705728862996e-01   +7.499312174192647e-02   +3.216724792958227e-01   +4.830530875077771e-01; +1.918476870804294e-01   +2.232717893070636e-01   +2.495663769723477e-01   +3.308499402598852e-01   +4.985207092351031e-01   +2.891177849013064e-02   +1.689549033460250e-02   +3.353503044475228e-01   +3.609140568697031e-01   +3.985714358219939e-01   +3.202996888595937e-01   +1.961543669631934e-01   +2.564259234378863e-01   +2.735356489520870e-01   +3.777101632441130e-01   +4.094277144549016e-01; +4.088632169684553e-01   +2.157208785164359e-01   +4.421299307654042e-01   +4.343381972215087e-01   -5.814558361936817e-02   +3.773963099729882e-01   +2.911366628164147e-01   +1.757797212784180e-02   +9.017928552097665e-02   +4.103292428209943e-01   +4.548120546851563e-01   +4.327727151802208e-01   +1.976218161485685e-01   -8.363106516139049e-03   +2.858489178774178e-01   +1.753911136955831e-01; +1.559179260463203e-01   +5.592979207505955e-02   +2.692641833298903e-01   +2.440380563182356e-01   +7.510592345126009e-02   +4.660130867577238e-01   +3.050093859478428e-01   +1.121704872129309e-01   +4.280840474508090e-01   +2.410514815143028e-01   +3.937992585518948e-01   +3.711212588350457e-01   +3.494458390171791e-01   +2.142709381147640e-01   +2.625118820870042e-01   +5.943156211421604e-02];
L2E_L1E_iAMPA_netcon = [+2.459561237864760e-01   +2.984916267686664e-01   +4.463526544499834e-01   +1.305992220659816e-01   +8.709383472459593e-03   +2.561940545462533e-01   +1.019914804313088e-01   +2.424376131407671e-01; +1.720935133155448e-01   +1.038543971370743e-01   +2.802734651429246e-01   +2.504798220924249e-01   +1.725911437852549e-01   +7.661450328085709e-02   +3.886276544348420e-01   +8.583928896529022e-03; +2.869072585467475e-01   +7.903369324212067e-02   +2.083980701142788e-01   +4.344339150885781e-01   +3.323572837061104e-01   +4.571879271485959e-01   +4.190977078842870e-01   -2.376756361611682e-02; +3.592641966527967e-01   +1.357133593932722e-01   -2.954333469301613e-03   +8.794753688708555e-02   +1.812027936672652e-02   +4.194627628566691e-01   +2.177372467393944e-01   +5.163005135918581e-02; +2.239616961045098e-01   +3.445207796052572e-01   +4.003981114423676e-01   +3.020349625629733e-01   +1.706625448432360e-01   +3.112402400049352e-01   +2.987486498043871e-02   -5.092995943030525e-02; +4.544346584310912e-01   +5.494004799707570e-01   -3.958292582121575e-02   +4.281344397098311e-01   -4.201937118969885e-04   +3.656207232487537e-01   +2.220806498568630e-01   +3.557460054386759e-01; +4.592394299563707e-02   +3.986619074274545e-01   +2.080797321542371e-01   +7.683369353695959e-03   +2.353845957432151e-02   +4.427083388657426e-01   +2.594290168059810e-01   +4.378344311295077e-01; +2.516259567947695e-01   +4.824775704067724e-01   +2.433398891400863e-01   +3.667630065235624e-01   +3.672366677588114e-01   +2.996243484325896e-01   +3.951270456578458e-01   +2.260104425759303e-01; +1.413891423345718e-01   +7.526593847346617e-02   +1.930079989395662e-01   +1.824684372060746e-01   +4.720026215595593e-01   +3.904394567420990e-01   +1.346590827729777e-01   +2.618551146978489e-01; +1.471410144980866e-01   +4.202963053240510e-01   +4.158871085720096e-01   +4.610676735024707e-01   +5.254036316738132e-01   +1.769814202180726e-01   +2.666831351033930e-01   +1.399302383079777e-01; +2.952431874488541e-01   +2.765894105337979e-01   +2.164332397087356e-02   +4.326169458088165e-02   +1.927927321459407e-01   +4.135612619484758e-01   +3.108158101348319e-01   +4.933774945221334e-02; +4.387463543174057e-01   +1.978837015007521e-01   +1.070070256318996e-01   +3.093289987662757e-01   +4.290205878924369e-01   +5.316652420304842e-01   +2.901203719065590e-01   +4.512143308020452e-01; +2.153416808230165e-01   +4.069072491482340e-01   +4.272970223758623e-01   +1.535129635832139e-01   +4.692714214555691e-01   +2.081091765063542e-02   +2.832819834601836e-01   +4.076099903372180e-01; +2.874778412248282e-01   +1.561748318886357e-01   +2.757709875325122e-01   +1.488451429521934e-01   +3.779727990008358e-02   +3.697175247075904e-01   +4.456124307515196e-01   +1.160338101540047e-01; +3.095314740691298e-01   +4.023889267456305e-01   +8.845235824408845e-02   +9.001554301721375e-02   +2.202047217591082e-01   +4.253222797767617e-01   +2.678624222823564e-01   +1.249959957058956e-01; +3.011150732263119e-01   +2.964062482714703e-01   +2.778201523554558e-01   +9.470375426288229e-02   +2.203062758991521e-01   +1.214978243617820e-01   +4.080890233237477e-01   +2.371328589783015e-02];
L1E_L2E_iAMPA_netcon = [+1.284856962649829e-01   +2.161280595729333e-01   +4.589686484690378e-01   +2.810684441929170e-01   +3.026678903446048e-01   +3.492979813094246e-02   +2.775863506634904e-01   +3.765335736938450e-01   +2.569635113068002e-01   +2.312346835637913e-01   +3.889138035287051e-01   +1.424591582700863e-02   +2.244010425554681e-01   +2.173974069736370e-01   +3.497874887134916e-01   +4.774919474527957e-01; +3.818838170446472e-01   +4.114754329716442e-01   +3.714730156061837e-01   +1.606097456477508e-01   +2.119876062812825e-01   +3.208846923488812e-01   +3.992587523642623e-01   +7.020574955601296e-02   +1.086218264402925e-01   +2.441628738749324e-02   +5.964950024827671e-02   +1.299216376682934e-01   +2.708513521972887e-02   +9.942554635575621e-02   +8.845522824320520e-02   +1.788971380473849e-01; +1.686680699290163e-01   +4.037744013170108e-01   +4.683116907321702e-01   +4.110475510361081e-01   +1.339935531603807e-01   +4.121692055538123e-01   -7.917921141318767e-03   +3.752037129473069e-01   +2.747097778971186e-01   +1.855176995100653e-01   +5.642939258667562e-02   +4.226364379782678e-01   +5.342837129403113e-02   -5.075475497397517e-03   +1.829683822575990e-01   +2.891079731299039e-01; +2.055959105019442e-01   +1.950608147213281e-01   +2.634677992339542e-01   +5.025776894174431e-01   +7.494692972951973e-03   -1.414389046554172e-03   +7.480990180635239e-02   +3.304481323022578e-01   +4.435885999039177e-01   +3.684042565372914e-01   +2.570141476861179e-01   +6.018386162032624e-04   +2.671150891509191e-01   +7.905070778725475e-02   +1.129457715380536e-01   +2.500011238181729e-01; +3.868181046333718e-01   +1.770872805292913e-01   +1.689070179932200e-02   +7.479720882366198e-02   +4.945091625857328e-01   +4.390588925170293e-01   +4.111316069637285e-01   +2.119255108313444e-01   +1.298781266128215e-01   +1.656209822603479e-01   +3.508371737140405e-01   +7.792943004037690e-03   +3.328640685396101e-01   +3.473081806737147e-01   +1.638326139228599e-01   +9.080167831909966e-02; +7.128010230451236e-02   +2.751674955410559e-01   +5.273158705970567e-02   +1.800288086938703e-03   +3.274059136219382e-01   +2.649505935014993e-01   +2.872538837609149e-01   +3.847922449124474e-01   +4.143071545530709e-01   +3.618725770428613e-01   +5.003992044892645e-02   +3.590263490538863e-01   +3.416429813573381e-01   +2.533460378870093e-01   +7.715428033529927e-02   +1.775487763554835e-01; +1.471093155428811e-01   +1.731174810112966e-01   +1.125220158011153e-01   +1.480740258610036e-01   +1.651397219885651e-01   +5.306234806116690e-02   +1.280049830069482e-02   +2.018001616204253e-02   +2.011175910343217e-01   +2.411096633937947e-01   +1.232780135651402e-01   +6.394150155818645e-02   +4.837515858515443e-01   +3.125407123477127e-01   +4.274005214419084e-01   +2.079947787690047e-01; +8.276258910657508e-02   +1.723545071889155e-01   +4.529432574813919e-01   +3.583341498650937e-01   +4.438489781520734e-01   +2.636899922727635e-01   +4.570725979680251e-01   +1.169143037022347e-01   +1.946585245903511e-01   +4.501876844943090e-01   +4.486330377320196e-01   +6.837018220616209e-02   +2.315468716780850e-01   +1.663402498161513e-01   +3.991422236458455e-01   +2.307234541984728e-01];
L2I_L2E_iAMPA_netcon = [+2.504118345743347e-01   +8.192367924296967e-02   -2.398153236288195e-03   +2.131590558694776e-01   +4.119194620553622e-01   +3.241734847544301e-01   +6.237645197509530e-02   +2.801268786606791e-01; +8.663063261216060e-02   +1.318273209034522e-01   +4.590211097179776e-01   -4.307639365335406e-02   +2.859839714852490e-01   +1.537612826086466e-01   +8.506306844549022e-02   +2.708724239713807e-01; -2.670796941874455e-02   +4.378871884990139e-01   +1.479306084870714e-01   +2.099088370993669e-01   +4.750440078882043e-01   +4.514529291544835e-01   +3.420248799587232e-01   +1.443070960490365e-01; +3.650933626625861e-01   +4.207429748630993e-01   +4.348720702596783e-01   +3.559481079976063e-01   +3.811741465682228e-01   +2.720155873066993e-01   +2.690696633294115e-02   +2.845351021015254e-01; +4.071433447674381e-01   +4.386271338840136e-01   +1.522968598473191e-01   -9.027509014319923e-05   +1.778079368630057e-01   +4.775829868678613e-01   +1.294641313113306e-01   +4.587667380943813e-01; +2.743254535606242e-01   +1.847484319449871e-01   +3.837089807749244e-01   +2.835901250597676e-01   +9.707922841585080e-02   +1.587418189765402e-01   +4.391606375753637e-02   +3.414528380402526e-01; +1.395926879369419e-01   +1.917258916080551e-01   +3.514461108611377e-01   +1.434582787568288e-02   -1.626015828052394e-02   +1.296792118355169e-01   +1.943112807286058e-01   +4.968811610108238e-01; +2.506952011311901e-02   +2.139781238117860e-01   +2.118392256374616e-01   +5.090819238651080e-01   +3.831095785154967e-01   +3.355763058089432e-01   +4.369240828159558e-01   +1.725972753653568e-01];
L2E_L2I_iGABA_netcon = [+4.201945408399791e-01   +2.185356475552006e-01   +2.376302925783963e-01   +1.603644683895171e-01   +2.445035024608418e-02   +4.915375455042617e-01   +4.395319219844840e-01   +3.113296576889408e-01; +5.215296837097210e-01   +1.246040996859456e-01   +1.176842117022224e-01   +4.467878239599991e-01   +3.903305542023102e-01   +2.045888253456732e-02   -2.172497380699919e-02   +3.416527105329552e-01; +1.871076546824575e-01   +3.326402823629933e-01   +3.557779032412634e-01   +1.686057194105606e-01   +1.204454724878633e-01   +4.155632436423182e-01   -3.555916301524121e-03   +2.264539758829955e-01; +5.090239234899212e-01   +9.384538855990979e-02   +1.497131029824644e-01   +5.248943483752533e-02   +4.166775906588689e-01   +4.398815737527433e-01   +3.688104017977751e-01   +2.111164379160466e-01; +2.331588760543087e-01   +2.430463537878595e-01   +4.800583234238554e-01   +1.099613886800636e-01   +5.362756705420575e-02   +3.856052180970843e-02   +3.869613850298135e-01   +1.839833253577955e-01; +3.380067787751601e-01   +1.409605129540104e-01   +1.431186461779215e-01   +2.277352665643389e-01   +9.537738526610798e-02   +3.468618292975008e-01   +2.208519157737915e-01   +4.235930300155954e-02; +3.840882889428527e-01   +3.288084597356080e-01   +3.259020054022233e-01   +4.501865394220098e-02   +9.684428905270279e-02   +3.842516219797116e-02   +3.095248839998430e-01   +5.561923082659798e-02; +8.124904472001263e-02   +1.800034883558183e-01   +2.651603670547579e-01   +2.347170932412221e-01   +4.151725320716341e-01   +2.688408872391954e-01   +1.944225192102728e-01   +1.278855334131932e-01];
L3E_L2E_iAMPA_netcon = [+2.411554356960310e-01   +3.067622090486594e-01   +1.422401483039295e-01   -2.846351196767247e-02   +2.976498828906514e-01   +6.948503261228116e-02   +4.236319680454352e-01   +2.667976289649399e-01   +3.519602769748089e-01   +2.928272999421099e-01   +1.099720781788045e-01   +2.890199752179660e-01; +1.179267598847485e-01   +3.252020858838787e-01   +3.512864779535775e-01   +3.765259973455253e-02   +3.797198588728873e-01   +3.774262823878026e-01   +3.603200711753668e-01   +1.480076946280533e-01   +4.131894598466166e-01   +1.321198357017528e-01   +3.133592586192737e-01   +4.273391817175262e-01; +3.694564699795266e-01   +2.913523860929309e-01   +3.935810757494226e-01   +4.215793556436305e-01   +2.297350816517023e-02   +1.315558061052783e-01   +2.782868465844293e-01   +1.826647760875811e-02   +2.778118549403787e-01   +3.322360835827088e-01   +2.292674445978016e-01   -2.587743726562598e-03; +3.787063481855955e-01   +2.527304659948785e-01   +1.895873360603796e-02   +2.032080187609091e-02   +3.996687110369237e-01   +1.874502845085628e-01   +2.274511840444372e-02   +2.561624455320026e-01   +1.108241593653301e-01   +1.412721095479154e-01   +2.570530204324467e-01   +3.706218497171407e-02; +3.756226050374781e-01   +4.966523730958782e-01   +4.372605294351884e-01   +4.992267804278984e-01   +3.794297552601844e-01   +4.433511305156544e-01   +3.364763663187144e-01   +8.240267237885840e-02   +3.726161297308921e-02   +1.147336491589394e-01   +3.487944114559424e-01   +3.369775958556064e-01; +1.122358473291404e-01   +1.255742138044694e-01   +9.199569457840484e-02   +1.868870025241582e-01   +3.401509752203217e-01   +3.019602596668911e-01   +4.413398925728522e-01   +4.221394119982148e-01   +4.334870857815861e-01   +1.603072960574982e-01   +4.733063043302343e-01   +3.820603757175516e-02; +3.475115382240168e-01   +6.220439385656491e-02   +6.894197742797840e-02   +8.254264739009948e-02   +4.318474146192298e-02   +2.200733356418679e-01   +3.259772114470347e-01   +1.832461197914314e-01   +1.291237844641860e-01   +1.649541977315082e-01   +4.446424109255488e-01   +4.323720166608572e-01; +3.980212973321604e-01   +3.827212219505947e-01   +2.459195487755525e-01   +4.128575996711098e-01   +3.824554626026179e-01   +1.537475543838502e-01   +9.153786438152022e-03   +1.474520861881002e-01   +9.655557004479903e-02   +3.487944159713678e-02   +1.967495744331479e-01   +1.233152752182832e-01];
L3I_L2I_iGABA_netcon = [+2.380643691451119e-01   +4.523930134444117e-01   +1.168641396480588e-01   +2.662692928771677e-01   +2.367514441286488e-01   +3.643302329996723e-01   +3.352391582863167e-01   +6.188168334677439e-02   +5.610926486359723e-02   +9.682501207339114e-02   +4.064100255453040e-01   +1.007989293998818e-01; +2.464066016939873e-01   +3.407113312396896e-01   +2.693557007250079e-01   +3.349732234163783e-01   +3.668196357514779e-01   +1.587937797780889e-01   +4.440422176844690e-01   +8.679471140869270e-02   +1.407072998363758e-01   +1.868951563640314e-01   +2.877144269483549e-01   +2.398927924047352e-02; +2.207524037229769e-01   +3.176863518923930e-01   +2.781745088945297e-01   +2.192911152293649e-01   +2.825331214783893e-01   +2.174653224267883e-01   +2.038843725623455e-01   +3.220090948933283e-01   +3.261574042605960e-01   +4.189141899667220e-02   +3.354984062389759e-01   +3.203596822668626e-01; +3.518101250963867e-01   +4.087529985507586e-01   +4.286908220652451e-01   +8.592398053362758e-02   +2.729969632322107e-01   +4.733411925428068e-01   +4.324927848610269e-02   +6.024984844062155e-02   +3.195483908893199e-01   +4.108548665706429e-01   +1.103545042638775e-01   +3.693764758227149e-01; +2.072647411744816e-01   +3.764583941843712e-01   +4.171894775858436e-01   +3.898312777454828e-01   +4.123405463932138e-01   +1.629247317133648e-01   +2.165098411551300e-01   +3.407410076584436e-01   +2.143875043351219e-01   +6.357712040474107e-02   +1.629151880127933e-01   +1.811759572422610e-01; +2.619977600261576e-01   +7.470747093186289e-02   +3.227338707197433e-01   +1.996162445198024e-01   +3.438222513903920e-01   +3.102340927591478e-01   +2.044566875664887e-01   +2.780881971564853e-01   +1.225565332008227e-01   +1.152078485455565e-01   +2.498410758150941e-01   +2.734848917843159e-01; +2.464130857499012e-01   +6.463688117830679e-02   +3.860260054898593e-01   +3.180981915809803e-01   +1.348082796019310e-01   +4.382190406417740e-01   +1.312537681850010e-01   +7.268906725581629e-02   -2.612273508086571e-02   +3.569648998003410e-01   +4.797121085763403e-01   +1.022226136331347e-01; +2.114341855484576e-01   +6.911371090171167e-02   +4.195636675803970e-01   +5.186679709268485e-02   +3.336442440503454e-01   +4.012478763842783e-01   +3.388980761980182e-01   +2.685928645297266e-01   +2.048534510143055e-01   +3.420391579270026e-01   +7.828189573063257e-02   +4.133300481701360e-01];
L2E_L3E_iAMPA_netcon = [+2.791201832650922e-01   +1.427254807565220e-01   +3.842446616376610e-01   +3.209925255296736e-01   +2.404279790253011e-01   +1.854698438190953e-01   +2.593162214151267e-01   +1.393727193109266e-01; +2.923962208414318e-01   +2.348303540142730e-01   +2.852652013334956e-01   +2.053525625513699e-01   +4.266754428175222e-01   +1.284111260960923e-01   +2.795166958818129e-01   +4.298242110641280e-01; +1.281037402329028e-01   +8.185353005251823e-02   +2.981634218729678e-01   +3.588459787838339e-01   +3.374929675854034e-01   +3.664843290242731e-01   +2.882112974814606e-01   +5.012926592698427e-02; +8.251589070286237e-02   +1.256945915329449e-01   +2.166674220721666e-01   +4.503358325281638e-01   +1.689134033824475e-01   +3.968003125425270e-01   +2.668623895689399e-01   +1.499878799889775e-01; +9.856001324509191e-02   +3.205560381321638e-01   +4.888160608867156e-01   +1.224935963319283e-02   +3.620776172769428e-01   +3.298285226466806e-01   +3.311147838106306e-01   +2.838499729865086e-02; +1.179183536046088e-01   +4.334318577898582e-01   +3.307896633772655e-01   +1.497568256223192e-02   +4.866169932071720e-01   +1.780068213075695e-01   +1.404642524497472e-01   +3.790301356765738e-01; +1.702949048038087e-01   +1.041650708569659e-01   +2.337621811594827e-01   +6.898622355553381e-02   +1.089361731476402e-01   +3.326553383887205e-01   +3.203490516981578e-01   +2.719439579749889e-01; +2.893024726787319e-01   +2.932196053715965e-02   +5.291376959074728e-02   -5.199233935026779e-02   +4.146457464350991e-01   +2.599408744069921e-01   +1.217064232138557e-01   +4.340616000841437e-01; +4.722255555712827e-01   +3.277955111024893e-01   +1.564420188434043e-01   +4.043795768473618e-01   -1.568593050279569e-02   +1.518158187810438e-01   +3.044477389051658e-01   +1.722395521536556e-01; +5.134797037536992e-02   +1.109271182102960e-01   +4.096310251496155e-01   +8.787136855121558e-02   +1.082780822090583e-01   +1.114583618561818e-01   +4.569270709862665e-01   +4.177478592668174e-01; +3.663013276528195e-01   +3.494715453752872e-01   +2.284690463832598e-01   +2.915242441171798e-01   +1.686817805426063e-01   -1.038538115979905e-02   +3.465699841671589e-03   +3.594318028342903e-01; +3.725386359032603e-01   +3.583300949630103e-02   +4.263890331724969e-01   +3.932947834946662e-01   +3.168076590224748e-01   +6.984607871974149e-03   +1.686685760933707e-01   -2.010988646817452e-02];
L2I_L3I_iGABA_netcon = [+1.539995996501299e-01   +2.200577510800960e-01   +1.581522017696044e-01   +2.627274381761025e-01   +2.102577370785091e-01   +2.205022233467597e-01   +2.460367462464434e-01   +2.671596792305562e-01; +2.051514895133240e-01   +3.941109974988422e-01   +1.071142823355432e-01   +4.488306175517677e-01   -5.779220581103025e-03   +3.010773350621780e-01   +1.645828090977711e-01   +1.922011607812939e-01; +1.199372413431337e-01   +2.770962630379867e-01   +3.893238100308724e-01   +2.878126766920288e-01   +2.283292016429342e-01   +2.598674500505934e-01   +3.318528568207325e-01   +4.607890614822000e-01; +3.273222109160447e-01   +3.086303836644242e-02   +4.109686791383172e-01   +1.396678183989807e-01   +2.888940138145040e-01   +3.270493867916091e-01   +4.183332751196358e-01   +1.004154542649291e-01; +2.553698303601028e-01   +5.188514498100377e-01   +3.606589324134954e-01   +3.162016117293218e-01   +2.349048803285963e-01   +4.233918657220863e-01   +4.148679816315016e-01   +5.840233344700368e-02; +3.917744418805296e-01   +2.657054347021907e-01   +1.114267361021206e-01   +4.652189897295703e-01   +1.627956049496034e-01   +1.350927432774772e-01   +1.579270333354696e-01   +3.684784276093775e-01; +8.796366269587105e-02   +3.747792670926453e-01   +1.549349695117479e-01   +4.267892806327243e-01   +1.812295610511943e-01   -1.007556451163780e-02   +2.274815120775888e-01   +3.305774881604425e-01; +5.647529733876891e-02   +1.127909937972938e-01   +2.755401196607115e-01   +8.957403445381291e-02   +2.871914532887850e-01   +2.889091933375533e-01   +4.702136386856971e-02   +9.450866188666371e-02; +2.323343490214012e-01   -4.235399479272730e-03   +4.194199591531913e-01   +4.710256189361306e-01   +3.102934507700768e-01   +5.009928406151062e-02   +1.494025038591632e-01   +4.258154170370130e-01; +1.761288783553640e-01   +1.021810355965450e-01   +9.091363999755431e-02   +2.569926173795009e-01   +4.106421021942836e-01   +2.542559492107532e-01   +3.908643667466705e-01   +2.199881177259977e-01; -7.627548555060090e-03   +2.700909454322846e-01   +8.100071458445074e-02   +2.542095796117151e-01   +7.694117510526198e-03   +2.938482921987258e-01   +3.246448109411753e-02   +1.331843055292481e-01; +4.663930599183620e-02   +1.978082918749705e-01   +6.074979583313753e-03   +1.409299979039342e-01   +2.636095427558958e-01   +4.064773668167490e-01   +2.093671996596464e-01   +1.729724122062293e-01];
L3I_L3E_iAMPA_netcon = [+2.090245364812623e-01   +2.401091743600270e-01   +2.860545519045686e-01   +4.153251430659408e-01   +7.966655309748839e-02   +3.517037847075954e-01   +1.423951491173739e-01   +1.126883800744382e-01   +3.528728013757085e-03   +4.347837734006169e-02   +2.978992886543059e-01   +2.968084283047956e-01; +3.923933618076842e-01   +1.641578336659360e-01   +2.011483131334335e-01   +4.845015890128791e-01   +3.579340386220062e-01   +2.532509819613956e-01   +4.121953810308300e-01   +4.896192889618232e-01   +2.133151227576299e-01   +1.458273211378446e-01   +2.994950528818118e-01   +4.313531935549039e-01; +1.406022054324350e-01   +3.837295881358964e-01   +1.299999548943119e-01   +1.551956726573389e-01   +3.751318513861730e-01   +3.675252749996191e-01   +3.293581964213082e-01   +3.814206639143127e-01   +8.922265753615237e-02   +3.989575287524100e-01   +1.548774618745865e-01   +4.197490072114636e-01; +4.555772757385845e-01   +2.973930515819336e-01   +2.981075005783941e-01   +3.751308442014454e-01   +1.486644279315977e-01   +1.533646464361914e-01   +2.216594698569332e-01   +4.225565109236582e-01   +3.127284606435133e-01   +4.221446563891516e-01   +1.630216752422167e-01   +3.507972668250939e-01; +5.711442331809376e-03   +3.678285914034159e-01   +1.974433340241342e-01   +2.577154519771193e-02   +8.625293509649655e-02   +7.478478909694143e-02   +9.285369337219657e-02   +1.701797365308238e-01   +2.090849211213114e-01   +9.073806015106861e-02   +4.112986727528984e-01   +3.410062168808440e-01; +1.894100274199485e-01   +3.782954941395549e-01   +1.868433661960672e-01   +4.343709849182064e-01   +7.033219039734877e-02   +8.171389229006437e-02   +1.040522474324657e-01   +5.251508382544931e-02   +1.049326487057717e-01   +4.927321537947816e-01   +3.696164684370095e-01   +8.853195940027743e-02; +3.426813517836970e-01   +3.228962060732611e-01   +3.965375156250049e-01   +3.561062244665345e-01   +2.884710247343401e-01   +2.103408494880526e-01   +1.646279087232643e-01   +4.163448369202994e-01   +3.077647929576465e-01   +1.492719266768749e-02   +1.701113529856787e-02   -3.076601222517036e-02; +4.715762650323348e-01   +4.557538312257695e-01   +2.432832728781749e-01   +3.224730494087929e-01   +4.966644288488104e-02   +1.426498809644706e-01   +2.900595447309242e-01   +4.328237005318419e-01   +3.176860830535727e-01   +4.371660583443391e-01   +2.304778126032802e-02   +2.533529102900589e-02; +4.367364346958426e-02   +1.518210316533597e-01   +1.458239484471009e-01   +1.761737719068759e-01   +1.941238525065407e-01   +1.425498965038703e-01   +3.873409226826866e-01   +1.373022737720954e-01   +3.162328400806264e-01   +3.564541933624909e-01   +2.698162038159834e-01   +4.705743272963753e-01; +3.097748594046467e-01   +1.432447687145788e-01   +2.374299242244481e-01   +1.908832630883172e-01   +9.714819017731682e-02   +2.900532275424848e-01   +2.307040690044916e-01   +5.131909051020175e-01   +3.600930269419077e-01   +2.033966808191750e-01   +1.672767241534444e-01   +5.801649476876337e-02; +2.890952741247137e-01   +3.775836200774711e-01   +3.309434284230042e-03   +3.800349725433121e-02   +9.274435385445126e-02   +3.586711998155719e-01   +1.694252478018913e-01   +3.246750181622025e-01   +8.008671050277796e-02   +1.165444113195712e-01   +2.618441834152871e-01   +2.972610980164191e-01; +1.993501904814973e-01   +7.075087661987284e-02   +2.494502571731280e-01   +5.019415837208274e-01   +4.781695146120520e-02   +2.549159160896193e-02   +2.925937892171218e-01   +2.953999470566751e-01   +6.692765169350673e-02   +8.518867150214056e-02   +1.741199189001238e-01   +4.030377313890183e-01];
L3E_L3I_iGABA_netcon = [+3.418162058545603e-02   +3.821534131417500e-01   +2.223606419697183e-01   +4.044370493214643e-01   +3.866711030430597e-01   +3.141580399355672e-01   +9.578825625731854e-03   +1.828461069914363e-01   +2.638983911688869e-01   +4.468481807944676e-01   +4.608775716943435e-01   +1.921818097890015e-01; +5.241406335672831e-02   +9.670221010906468e-02   +4.399721742919018e-01   +1.933259265419179e-01   +1.590696609957116e-01   +3.016658457534258e-01   +3.694699040812587e-01   +2.468495292344358e-01   -1.257930198518227e-02   +4.346834977183313e-01   +2.880999245017256e-01   +3.825723580574326e-01; +3.190016989093099e-01   +3.122275724480192e-01   +4.394003589589133e-01   +3.506955696038867e-01   +1.031975503286219e-01   +4.103907728932451e-01   +1.875343204502075e-01   +1.573395016578470e-01   +3.122575541697178e-01   +3.263793623100666e-01   -4.904634811499281e-03   +2.181116013436327e-02; +3.545402280885364e-01   +3.700507972045765e-01   +9.175269225484124e-02   +6.106559834569068e-02   +1.325947881210279e-01   +4.502341413480476e-01   +1.848659529081231e-01   +2.556673249549354e-01   +2.698015008297228e-02   +4.993050260977461e-03   +4.170403765061292e-01   +4.571945711342604e-02; +3.286965177077688e-01   +3.975269932548715e-01   +5.048351609588967e-01   +1.979660993782192e-01   +3.811100089519376e-01   +1.790067006204792e-02   +3.414335190035006e-01   +1.325365395823473e-01   +1.239797138551992e-02   +4.016985103469056e-01   +2.079426745889205e-01   +2.192595561661781e-01; +1.209757859462179e-01   -1.527863025576710e-02   +1.875791739871678e-02   +9.177316530351198e-03   +3.271801093713064e-02   +4.266322903907269e-01   +1.416763764222108e-01   +3.529360271873107e-01   +4.546756229538976e-01   +4.433999121223590e-01   +3.719477158069619e-01   +3.543210671365772e-02; +4.601359674878395e-01   +4.117558001324494e-01   +2.376065192031691e-01   +5.835686738326390e-02   +3.293819272709477e-01   +3.850941039753294e-01   +4.170210939138367e-01   +3.765636936905107e-01   +3.381288464464078e-01   +4.199069006714826e-01   +3.412528717788218e-01   +1.196910273191053e-01; +2.252839817253234e-01   +2.580468539416815e-01   +3.114028696621318e-01   +4.161982880939735e-01   +2.834639370485332e-01   +7.316806903407613e-02   +1.553520516945851e-01   +2.362411053849042e-01   +2.586264394001501e-01   +2.109382942492807e-01   +2.470376393001795e-01   +3.352785413787217e-01; +4.278351282384028e-01   +1.733337086151630e-01   +4.265780912102951e-01   +2.943389309299742e-01   +4.349363521211156e-01   +1.986644927404530e-01   +2.939909263110844e-01   +2.011855316877246e-01   +2.468518121335320e-01   +4.573541751065422e-01   +3.993285701234794e-01   +4.247620607893493e-01; +2.735422030894346e-01   +2.202365635914832e-01   +3.099306756346359e-01   +6.936307313066963e-02   +6.384498694392095e-02   +2.890180558689492e-01   +1.843092764409736e-01   +1.231408954691183e-01   +2.315375654463114e-01   +2.038759614336726e-01   +2.013639930567041e-01   +1.302253384536408e-01; +2.498658506561064e-01   +3.673755410657821e-01   +2.232637434732648e-01   +3.953718989295533e-01   +1.363045616764583e-01   +1.711608579361047e-02   +8.053682478682324e-02   +6.738980162187083e-02   +9.189640989830817e-03   -4.818034095994242e-02   +4.467859810019283e-01   +2.913811901494988e-01; +1.179401013607233e-01   +2.202991765122769e-01   +1.353227673754884e-01   +2.054209380472484e-01   +3.182976620842335e-01   +1.091569087543406e-01   +2.959701519834558e-01   +2.078228382920411e-01   +1.571258428129767e-01   +8.096233035387923e-02   +4.657931348436904e-02   +1.019255474685927e-01];
L2E_Input1_iAMPA_netcon = [+1.418657578639892e-01   +1.247636761331536e-01   +2.790452688951479e-01   +1.741494515118298e-01   +2.828419203548938e-01   +2.843389784588266e-01   +3.666011972811108e-02   +2.647192674449196e-01];
L2I_Input2_iAMPA_netcon = [+2.018254567635114e-01   +1.677352870112744e-01   +4.164287039190979e-01   +4.632439925623915e-01   +2.484346935971499e-01   +2.854305267852679e-01   +2.620108114666297e-01   +3.771819320363757e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
