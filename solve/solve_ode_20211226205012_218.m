function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.023868540168706e-01   -1.590509895557702e-01   +1.986211175502038e-01   +1.057064985214363e-01   +3.231778452970725e-01   -1.273300251773875e-01   -1.359554765244381e-01   -1.241581867060783e-01   -2.862046491248788e-01   -2.054293822058897e-02   -4.294505211760731e-01   -1.693022367231781e-01   +2.182904310085756e-01   +7.958823598555498e-02   -3.377823199268447e-01   -2.822774295957493e-01; +2.821072056297845e-01   +1.434321647906582e-01   +1.748661641886765e-01   -9.561476080943489e-02   -9.622755650350129e-02   +8.713429983175927e-02   +5.768766992671932e-02   -1.767580512489697e-02   +1.255564303476783e-02   +1.542313290161009e-01   +1.195691213136101e-01   -3.484049795043059e-02   -2.244842199424193e-01   -3.097770861504128e-01   +4.006542830400261e-01   +2.202680920968960e-01; +1.804480705261884e-02   +4.227351821880906e-02   -1.469553103727717e-01   -2.750277364634382e-02   +1.686255711662485e-02   -3.118527507596037e-01   -6.957552224686589e-02   +3.042391628883186e-02   +6.719458663556699e-02   +2.070745799677328e-03   +1.858469222412332e-01   -3.719101705323702e-01   -4.649594804989014e-01   +2.283783006548440e-01   +2.697469979343752e-01   -1.532833202391455e-01; -4.908170105596379e-02   -6.891283100434276e-02   +2.390980445368099e-01   -2.609041058994713e-01   +1.198822074238289e-01   +8.639365524062532e-03   +1.521210153323901e-01   +3.632475661601828e-01   -6.674730753216643e-02   -1.184413685534660e-01   +2.505107778719777e-02   +5.566564614638279e-02   +1.646888431206391e-01   +3.465275389662191e-01   +3.707145264089571e-01   +2.705468919481421e-01; -1.449126623443207e-01   +3.489581268052156e-02   +4.367406121962949e-02   +1.668617471764905e-01   +7.392567899440347e-02   +1.596851322179940e-01   +1.655815436689763e-01   -1.149228678603773e-01   +7.024908410415820e-02   +2.416997535970656e-01   -8.998245749089831e-02   -2.915634946888974e-02   +9.006693309308307e-02   +5.224698162486405e-02   +1.422448243150173e-01   +2.977342955503685e-02; -1.982431918963927e-01   -8.590847723114572e-02   -4.357375119476521e-01   -1.523197536632180e-02   -1.843909041673670e-01   +2.684643416825424e-01   +2.189381424078641e-02   -7.450730605387555e-02   +2.470853391316128e-01   +2.267863923575454e-01   -1.278681584056406e-01   -3.717600743558476e-02   -1.674548089254473e-01   +2.092295922333793e-01   +2.013830512921548e-01   +5.593920712365918e-04; +4.850476666313728e-03   -3.394600116313086e-02   +4.101155115858578e-02   -1.200022866999843e-01   +6.428792966891768e-02   +2.418020636680612e-01   -3.470038520588970e-02   -3.940587266815539e-02   -4.018991937533272e-01   -2.205640443747470e-01   -1.563193515010536e-02   +1.546008606894445e-01   +5.423494272281814e-01   +2.443109123012640e-01   +3.200226722251659e-01   -2.563384905237933e-01; -9.921069970546079e-02   +1.075884710318878e-01   +1.252233629020054e-01   -5.044698256725901e-02   -2.779607684557919e-01   +1.755207965166961e-01   +2.079548112357040e-02   -1.020730038479482e-01   +1.341497004750283e-02   -1.118906934891240e-01   -2.452761222354696e-01   +3.877322733642045e-01   +2.097521951005859e-01   +1.397478734464447e-01   +1.279176810535396e-02   +3.658153365091970e-01; -4.778547271695307e-02   +3.181661173207871e-02   +1.573280602510568e-01   +4.714337094400874e-02   -1.074456520421137e-01   +9.476843086506954e-02   -2.348552854341155e-01   +1.145386219219389e-01   +1.006947981850791e-02   -5.057156586175235e-02   -1.861516164513801e-01   -4.221128384420035e-01   +2.365679967352287e-01   -1.384089193499927e-01   +1.679493157566036e-01   -2.034538760935820e-01; +4.703223312371325e-02   -1.276906519886192e-01   +2.135358907599257e-03   -1.053740851723780e-01   -2.141280536256942e-01   +1.931607926476395e-01   -2.343444665687320e-01   -2.822513090207602e-01   -1.511031844629001e-01   -2.287782703873651e-01   +1.366957980948401e-01   -2.977976687794931e-02   +2.175429119516490e-01   +9.192503137932390e-02   -1.151745450620326e-01   +1.331549405157512e-02; +2.855022436617581e-02   +1.094339297660369e-01   -8.029649987093243e-02   +5.993840666341829e-02   -4.925117647341073e-02   +1.529056712556478e-01   -1.275027370902106e-02   +1.702439639151289e-01   -1.493430081880668e-01   +2.031511196963471e-01   +9.738336891511101e-02   -1.018157635388046e-01   +2.675442835535257e-01   -2.700929596866356e-01   +7.169421826274440e-03   +3.384999877044448e-01; +1.811591976478911e-01   -9.328117352267201e-02   -1.932445731819947e-01   -2.543624454877319e-02   -4.331188129089998e-01   +1.756576143623018e-01   -1.247145640080047e-01   -1.926943846885607e-01   +6.493538771493379e-02   +2.055704830232045e-01   +2.170870103464722e-01   -4.207012013326365e-02   +1.132895823843864e-01   +6.812277239825305e-02   -2.549914327488368e-02   +1.626491108856983e-01; +6.934092577462943e-02   +1.525035595375868e-02   +3.052782817792519e-01   -4.733746449978786e-02   +2.643420800816033e-01   -2.627151634958396e-01   +5.945746008595647e-02   -2.247772650790060e-01   +1.468201675308786e-01   -1.010750023075511e-02   -2.258816215280726e-01   -6.500998676048303e-02   +8.337090232454847e-02   -5.992629699163220e-02   +1.998074067270089e-01   +9.298111121709277e-02; +2.454180874844435e-02   +1.442670010304830e-01   -1.913252967352134e-02   +2.218753617666775e-02   +4.027856754412061e-02   -2.094046047746741e-01   +1.096760393924859e-01   +6.941990131850516e-02   +3.029318232761047e-02   -1.244249246344984e-01   +1.492486521267158e-01   +2.064319770019694e-01   -7.713582699407801e-02   -1.313431913575534e-01   -8.762608641880727e-02   -2.571026683875105e-01; +2.276152478093696e-01   +2.469362382754273e-01   -7.459389376427807e-02   -4.166581409080123e-01   -6.248034549528382e-02   -1.246344474387384e-01   -1.632337885252144e-01   +2.879676483102415e-01   +8.685901876062890e-02   +1.882380187882020e-01   -1.702804159467060e-01   +2.196209927224876e-02   -3.611930989821751e-01   -3.153238120613560e-03   +1.717216042294965e-01   +1.861525080349294e-02; -2.452309739860803e-01   +2.442104932183312e-01   +3.454261155652426e-02   -2.164389207807453e-01   -3.362998118103024e-01   +1.301696259650232e-01   +6.304237321362703e-02   -1.250529937587727e-01   -4.797991827358605e-02   -1.697614960513704e-01   +4.224947894728187e-03   -6.503019950916371e-02   -6.856583234567903e-02   -3.835637312733826e-01   -1.329158738061097e-02   +3.775803647876953e-01];
L1E_L1I_iGABA_netcon = [-3.820097160340056e-01   -5.538209618759412e-02   -1.943116001332622e-01   -1.891065214271674e-01   +3.123283562902451e-01   +9.048376748030010e-03   -4.054982482714522e-02   -1.728534878899952e-01   +3.511385311216881e-01   -2.233736404514199e-01   +1.002315555202375e-01   -2.569328148025868e-01   +2.830194093971640e-02   -1.990720666118739e-01   -2.024855446460151e-01   -1.328182467079735e-02; -1.664862103319163e-02   +9.345375387929032e-02   -1.847321074463747e-01   -4.116815588379137e-02   -2.587725925557279e-01   +4.315383990554714e-01   +6.210615268398689e-02   +9.760890925062332e-02   -1.526069726777388e-01   -1.349889541411040e-01   +2.238896645665707e-01   -1.335691432223062e-01   -3.493562537856993e-01   -1.406125749588391e-01   -2.066632804732140e-01   -2.977420739806858e-02; +1.233892328938164e-01   -1.726159762154443e-01   -6.330838526954051e-02   -3.126067164759330e-01   +7.876493399407591e-02   -3.070659348516743e-02   -2.798881485569592e-01   -1.405754520534797e-01   +1.354247917767972e-01   +2.897931269953741e-01   +2.964916212394467e-02   -3.800056160531797e-01   -1.317131492638375e-01   +5.780198090618262e-02   -9.331903799023958e-02   +1.749996441000120e-01; -7.890536648409402e-02   +1.488015087170210e-01   +3.069161734776362e-03   -7.854407071086235e-04   +4.134744238343138e-02   -1.518003509502376e-01   +1.283192799835488e-01   -2.077018877958793e-01   -1.047417237094534e-01   +2.351490899671321e-01   +1.269967197368871e-01   -2.981469870855402e-02   -1.233590059471981e-01   -7.280078757298716e-02   -2.331044849399143e-01   -7.520009379857347e-02; +1.988490679131244e-01   +1.405204072789107e-01   -3.618836911741535e-01   -3.242392736129966e-02   -5.151609627132391e-01   -1.276923857538571e-01   +3.179425523092972e-02   +1.006816510770546e-01   -1.218219969861889e-01   -2.348561442701401e-01   -2.353707707640861e-02   -7.750023947713136e-02   -3.740672447871349e-01   +8.973025330739914e-02   -1.328384297390672e-01   -3.499934013453413e-02; +1.860508074010749e-01   +1.110319044187402e-02   -6.317277224721163e-02   -2.872269084814916e-03   -1.238958954702829e-01   -1.848971613444386e-01   +1.035391009825600e-01   -2.960297598157328e-01   -2.084947596117400e-01   -4.664778100256407e-02   +2.014557430412189e-01   +1.472344552274297e-01   +5.298222514051931e-01   +1.824409646067377e-01   +7.832207047656317e-03   -3.488132095442955e-02; -2.076579441117957e-02   -1.833542646203060e-02   -2.864031568604229e-03   +2.007451756293625e-01   -4.938953295959735e-01   +2.820408219009585e-01   -6.317849982004020e-02   +8.709747189368806e-02   -2.030624490895743e-01   -3.941560073404107e-02   +1.623510601704056e-02   +1.233640355481928e-01   +3.378978437770326e-01   -1.267858385953977e-01   -1.594586350951884e-01   +2.993206652558353e-01; +1.369073304684480e-01   -3.192884342720470e-01   +3.606330957140776e-02   +2.718769433642454e-01   +1.261593265916129e-01   -1.054200954036834e-01   +3.839046234756363e-02   -9.085686541334782e-02   +1.164908791737494e-01   +7.864727745060876e-02   +1.567932270525057e-01   +3.289673637717547e-02   -2.013538272872287e-01   -2.539586969311155e-01   -6.668704858796795e-02   +2.926292564344047e-02; +5.024373789457519e-02   +4.613047565062878e-02   +2.108120773587023e-02   +1.437302374536165e-01   -2.392358555301816e-01   -6.276371863204760e-02   +6.015132458708610e-02   +1.069952873058005e-01   -1.189040250197783e-01   -2.720429445956675e-01   +3.951733185807235e-01   +1.536236872836763e-01   +2.479565146550083e-01   +1.899939759981746e-01   -1.955864421608765e-01   +5.160053270692210e-02; +1.359129154889276e-01   -1.002549782254601e-01   -2.141752935850331e-03   -2.548869510540878e-02   +7.892490401070788e-02   +3.062954645273522e-01   -3.119302490095698e-01   -7.141884012640155e-02   +2.174018037578428e-01   -1.391127931569372e-01   -3.272276634566323e-02   +2.868893786695924e-01   +3.896390167855464e-01   -1.505920828503466e-01   -2.490927626757088e-01   -1.979474666114833e-01; -2.261767038077165e-01   -1.869742772569446e-02   -5.427204839060457e-02   -7.544228099527447e-02   -2.729361175920798e-01   +7.868262757349316e-03   -4.125404644942821e-01   -2.805410873534162e-01   +2.157681363338801e-02   -1.846332146671144e-01   -5.542583936535902e-02   -1.647666389916684e-01   -1.736187933950560e-01   +3.971366842291991e-01   +6.643489265283753e-02   -1.943860581756150e-01; +2.577075654037390e-02   +1.836742931262575e-01   -1.182920650688464e-01   -1.529556023438692e-01   -5.580499244725148e-02   +1.356943232668839e-02   +1.482962379653776e-01   +1.404596389368377e-02   +2.240123475446951e-01   +2.594279954549996e-01   +1.338650296597807e-01   +2.084754107113090e-01   -8.157775209505128e-02   -2.122429435055342e-02   -1.983905732095139e-01   +3.693580819033480e-02; -4.101214647341047e-02   +1.587887253359617e-01   +2.380217282837993e-02   -2.214223173364039e-01   +2.751239757229190e-01   -9.484861743422823e-02   -2.807430333976410e-01   +3.582346122794624e-02   -1.374818637385266e-01   -1.271064913318162e-01   -2.351303964628434e-01   +2.255335008420337e-01   +2.133832329287644e-01   -1.276180497871249e-01   +2.841614541611920e-01   +2.886755956034429e-01; -1.966389133883273e-01   -7.751599475362321e-02   +2.334000698895677e-03   -4.108010711924687e-01   +1.290732238373229e-01   +1.369023788913702e-02   -2.560315600550338e-02   +1.526836484714353e-02   +7.748482027424171e-02   -2.231587819086001e-01   +6.492841328102406e-03   -4.394365715698084e-01   +2.483397076037111e-01   -3.879901369022729e-02   -2.556563460373382e-01   +5.609556977981753e-02; -8.899680445124329e-02   -1.558313795141363e-01   +3.700292964855795e-02   +1.973113312505159e-02   -3.842559790757177e-03   +1.875653339470802e-01   -1.694653462009184e-01   +4.610883057146255e-02   -1.165235965999392e-01   -1.099723914388856e-01   -1.824666573751846e-01   -1.879914125678436e-02   -1.227700624472987e-01   -4.095581833541587e-01   +2.259985001213505e-01   -8.917878030551499e-02; +6.378985155942904e-02   -4.421646654311953e-01   -7.731864133553365e-02   +3.365640378602275e-01   -3.516384046208401e-01   -1.360715350558364e-02   +2.475202738636910e-01   -9.322827198167592e-03   +3.578708686140027e-02   -3.861883044811214e-02   -9.334510937359654e-02   +3.013401694884426e-01   +1.400467608193387e-01   -2.446850999024061e-01   +1.146057338324471e-01   -2.793163308664145e-01];
L2I_L1I_iGABA_netcon = [+1.207055387654378e-02   -3.165211821637102e-01   +3.993571716971986e-01   +5.999844620163516e-02   +2.579413480379519e-01   +3.236855242722887e-01   +3.600922606873203e-01   -2.324478843801180e-01; -7.312770641942112e-02   -4.340706880585724e-02   +2.103099584755777e-01   -4.779014625007486e-01   -2.145332490284221e-01   +1.679194894574464e-01   +7.086788850897233e-02   -1.380333456532205e-01; +8.028881069817771e-02   -4.665727006901589e-02   +8.912568645641294e-02   -4.819306727700433e-02   +8.899012432533007e-02   -5.189701031296671e-02   +2.452544168830352e-01   +7.533725939891447e-04; +7.876437235347006e-02   +3.420323522126775e-01   -4.548787761612910e-03   +1.328952151221940e-01   +5.720316328262202e-02   +1.015200121759462e-01   +5.311917601656523e-02   -3.199421774384747e-01; -1.451716496367335e-01   +5.080685544016804e-02   +1.901294794658688e-01   -1.978536731474382e-02   +1.872271194818920e-02   -8.979584286755246e-02   -6.191291088969454e-02   -8.368136552855948e-02; -4.072653765342798e-03   -1.128078379574286e-01   -3.591506683874609e-02   -9.028337064662242e-02   +3.094417398813267e-01   +1.156043597885591e-01   +8.618186116556384e-02   +1.936660190206607e-01; -1.672757846626078e-01   +8.100255048679930e-02   -6.501148867399512e-03   -1.173485512893316e-01   +3.333562963209787e-02   -2.829403903851382e-01   -3.700526619586842e-01   -3.706843184258848e-01; +1.275215084707627e-01   +6.302458191981680e-02   -6.983622494685041e-02   -1.097129845991351e-01   -3.501014484897116e-01   -3.847557562648504e-01   -2.186629171438480e-01   +3.084161874667909e-01; +1.194417775226940e-01   +1.022790008615455e-01   +1.127188467435956e-01   +1.562194076433842e-01   -3.857640372708603e-02   +1.948954767499264e-02   +5.016288147277861e-02   +2.096030810965339e-01; -1.384620673236445e-03   -2.873887115737724e-01   +1.800649716145545e-01   +6.975599692297353e-02   -3.671864634602177e-01   +1.050431324688735e-01   +1.911530274126846e-01   -1.848829125813548e-01; +1.187514699554509e-01   +2.089169344788620e-01   -1.694689954673826e-01   -1.905658843857828e-01   -2.354781730794872e-01   +5.431483755012448e-02   +1.746922567682020e-01   +1.938403562744548e-01; +3.328694583183668e-03   +3.089608063155182e-01   +2.946396107470390e-01   +6.817197304426378e-02   +3.648531331305295e-02   +2.522944622103701e-01   +3.227360832951033e-01   +2.033791418010503e-01; +1.197096780951080e-01   -1.255508107867880e-01   +1.583076240661769e-01   -2.770295209305922e-01   -1.007663443263884e-01   +2.323193619972690e-01   -6.690121380297072e-03   +1.005072326392342e-01; -1.617520096399131e-01   -3.006054865777468e-01   +1.673168617177677e-01   -1.823446903296345e-02   +2.520481003061731e-03   -1.792997353087032e-01   -7.368945802184709e-02   +4.272683598727595e-01; +5.840220153365352e-02   -2.649193833749624e-01   +3.044211397860628e-01   -3.480861770403559e-01   +1.539135978736089e-01   -3.716238084291495e-02   +1.853991326381683e-01   +7.552863768591755e-02; +1.829200788988413e-01   -2.774728413924916e-01   +1.064505193488429e-01   +2.749367705508487e-02   +7.188277865228099e-02   -1.851675019699158e-01   +2.793956012990796e-01   +4.575704424748772e-02];
L1I_L2I_iGABA_netcon = [-1.290744765931615e-01   -3.185825644514323e-01   -5.086659523114502e-01   -4.059061711109756e-02   -6.137723808855317e-02   +2.332299922687826e-01   -1.631942074502835e-01   +3.603372151416028e-01   -3.747551952605937e-01   +1.545558063502551e-02   +4.732673379879375e-01   -1.649886586845122e-01   +1.456765001763932e-01   +2.535080928914119e-02   -1.747847815734652e-01   -1.135327562159547e-03; -1.018279108040841e-01   +2.225408916911752e-01   +2.656764751651850e-01   -2.754869203946013e-01   +3.398774793209977e-03   -2.160041362100871e-01   +1.606783287391244e-01   -3.806899654242343e-01   -8.157325560815781e-02   -2.781007086131412e-01   +1.285735308121080e-01   +2.935875038429386e-01   -2.038400144033370e-01   -2.345920660021977e-01   +7.990436001565156e-02   +6.461859027373887e-02; -6.106053103535595e-02   -2.577170505301328e-02   -1.815131287736031e-01   +1.348411654229956e-01   +1.341124415625632e-01   +1.540165428263621e-01   +1.064849464212864e-01   -1.536154767214102e-01   +1.766016836351114e-01   -1.037517824648028e-01   -7.865305431145009e-02   -1.804472253523820e-01   +3.877653145338556e-02   -2.566752389742764e-01   +7.196600580649584e-02   -1.553207531084039e-01; +3.814229933713619e-01   -2.737501570832973e-01   +3.865787548577906e-01   +1.716344775711754e-01   -3.709915126276739e-01   -9.401642207216364e-02   -2.058948768505015e-01   +1.578144278176444e-01   -2.024453900276047e-01   -2.037920338293164e-01   +1.831525551951511e-01   -8.944301734435611e-03   -1.965887866151220e-01   +5.063737485298189e-03   +2.450545853647765e-01   +1.764873758774204e-01; -9.418854782393152e-02   +7.089003605345577e-02   +3.465214024301592e-01   -3.885372017358695e-02   +6.672790238694590e-02   -2.469279578558204e-01   +3.012976933927919e-01   +3.209422717302732e-01   +6.593706271165467e-02   -7.536630350066756e-03   -1.114070094758969e-01   -4.883154124660112e-02   +1.066001740317410e-01   -4.236336060630473e-02   -7.676025260443710e-02   +2.729829497357751e-01; -2.195463085974689e-02   -1.333982201676277e-01   +2.850551195366927e-01   -2.172715632304402e-01   +7.174113490163153e-02   +1.254746210632117e-01   +4.287100622554744e-01   -1.001504212768864e-02   -1.273456391019180e-02   +7.449825061208250e-02   -1.025032771314265e-01   +1.634402277657281e-01   +1.811694161421588e-01   -2.500470676223470e-01   +4.720973646069873e-02   +1.613377908404273e-01; -3.243577446966183e-01   +3.413531681436224e-01   +4.544848383184725e-02   +8.624235951087494e-02   +1.794176001779678e-01   -5.850102726352555e-02   -1.190128951958234e-02   +8.537897588854280e-02   +1.262607004167968e-01   +1.832665727519399e-01   -1.733781187655130e-01   +3.004271956837372e-01   +1.159410378646438e-01   +2.306660431589435e-02   -3.123093875743664e-01   +7.160348530336431e-02; -1.244786581242576e-01   -1.658246514514357e-02   +1.552163221389540e-01   -2.058054502855335e-01   +2.791286476994573e-01   -2.799523787399999e-01   +1.438010049706668e-01   -5.390613915202461e-02   +2.351451680066448e-01   -7.409042666770968e-02   -3.338778207975072e-01   -2.619437019041476e-02   -3.159119295224996e-01   -1.869546441460432e-01   +1.090917167766132e-01   -2.743074506796054e-01];
L2E_L1E_iAMPA_netcon = [+3.411906348663514e-01   -2.030407539934802e-01   -1.854717459775969e-01   +6.618307334095300e-02   +1.012418605333580e-02   +5.041467607397366e-02   -1.240016017366451e-01   -2.079943341963712e-02; +2.267928208651703e-01   +1.453256973729906e-01   +4.470382378529825e-02   +8.824648620370712e-02   -1.727684956307173e-01   +1.307462529649224e-01   -5.409632596199494e-02   +3.199101432483521e-01; +2.330356370769325e-01   +2.592993004923837e-01   +5.347826113954060e-02   +2.290338237723303e-01   -4.190265226290033e-02   -1.199784853032413e-01   -1.435083429438928e-01   +6.692851521712465e-03; -2.766677205769896e-01   +8.077473714049817e-02   -1.675829534296172e-01   -9.809065212347179e-02   -7.243012141283026e-02   -2.689618032672755e-01   +2.148428092584944e-01   -1.884932202966738e-02; +1.599209623757155e-01   -9.939938725724747e-03   -1.608053929075114e-01   +1.069356454241055e-01   -7.298344746785779e-02   +3.206936274499381e-01   -8.523213015616052e-02   -2.063203725612992e-01; +1.031464045660319e-04   -2.066499960203316e-01   -9.444411938949551e-02   +7.271362697781547e-02   +1.522215130407449e-01   +1.458424301434375e-01   -2.484104008738361e-02   -4.404093731902792e-02; -3.514444470842375e-01   +6.314440929489192e-03   -1.493822946500964e-01   +1.504170771509732e-01   -1.555621514800343e-01   -2.897556265504832e-02   -2.006018082744468e-01   +2.464234741905801e-01; -8.358982837400879e-02   +7.541821644665865e-02   +4.233755812673916e-02   -1.293999319671635e-01   +3.845583888339345e-01   -4.035138716407085e-02   +6.329896921333883e-02   -3.718031023477373e-01; -1.273134956887914e-02   -1.127981873121496e-01   -1.480588142276922e-01   -5.170532130261426e-02   +1.085162611438075e-01   +5.315033504115662e-02   -2.584528772710052e-01   -2.038401438633288e-01; +1.474456056646610e-01   -7.342268853498160e-02   +1.110954372458481e-01   -2.583083770684569e-01   -2.644229451541357e-01   -1.544693737946021e-01   -1.494895492703902e-01   +2.450706919477112e-01; +1.891105801216378e-01   -2.687830706944253e-02   +2.008671960845804e-01   +1.023408118575833e-01   -3.484643085188894e-01   +3.979862195979639e-02   -1.847255920898670e-02   +1.278155744814897e-01; -1.448724178018100e-02   +1.162879378089018e-01   +6.923781402491114e-03   +1.068989906622003e-01   +1.743331118852749e-01   -2.785298149396633e-01   +1.089108338779590e-02   -2.332729489392690e-02; -1.494369250355723e-01   -1.906268279669306e-01   +7.888419867005594e-02   +9.520770260737868e-02   +3.326898469688555e-01   -2.583790645915365e-02   -4.706590468294011e-02   -2.990256281856192e-01; -1.123634331874840e-01   -5.321279468155106e-02   -3.204848809461809e-01   -4.543150124473301e-01   +1.537466956942329e-01   +8.873389348352140e-02   +1.596573927190497e-01   -2.880016038148437e-01; -8.192500323788657e-03   +1.439118580069603e-01   +4.235944342078545e-02   -6.136170675569977e-02   -2.962410186535344e-01   +2.088512210341939e-03   +1.046117850362537e-01   +1.946125732811248e-01; -1.495784596535749e-01   -3.024461925509050e-01   +3.885180327849831e-02   +1.901225830085387e-01   -4.702666836652636e-02   +7.855417278187141e-02   -1.023456895370260e-01   +3.260422037330418e-01];
L1E_L2E_iAMPA_netcon = [+3.127789414619619e-01   +2.327622844892289e-02   +1.259494757740973e-01   +2.741748607863269e-01   -1.945836659345216e-01   -1.122871099741631e-02   -1.156813690257023e-01   -6.974312733392218e-03   +3.212881017010194e-02   -2.134090535074909e-02   -2.481249231169115e-02   -1.027028056254659e-01   +5.366056024024329e-02   -5.401455499406440e-02   +5.928271727027339e-02   +1.464187437633363e-02; -4.833302357227099e-02   -5.025826233057744e-02   +1.209941440065265e-01   +2.962354445013311e-01   -2.164534389634439e-01   +1.512292065293957e-01   +1.385982656345629e-01   +1.942406233252458e-02   -1.525362914201909e-01   +2.861690901481614e-01   -2.385072971048784e-02   +7.720647388884400e-02   +1.742681663279319e-02   +2.392961570101190e-02   +1.157163503539255e-01   -1.239636671121699e-01; -1.706722957783297e-01   -9.951167088680049e-02   -7.632354048455446e-02   +7.031176196562150e-02   -5.222030033499485e-02   +4.928265971580074e-03   -8.589687832896890e-02   -3.077527531034621e-01   -3.839840308056038e-02   +2.587639538080145e-01   +3.944108800074451e-01   -1.203009812221837e-01   +9.888442911783477e-02   +1.112969958520953e-01   -3.832782654813642e-02   -1.405232505559830e-01; -1.836161242329155e-01   +1.099087350022620e-01   +1.060149776632888e-01   +1.581697626314575e-01   -8.974572124250793e-02   -8.369775796299314e-03   +1.028346375635730e-01   -2.377865041470340e-02   -3.515101906542856e-01   -3.452876716825366e-02   +7.482900670372626e-02   -1.368496016348601e-01   -1.251651498553435e-01   +1.755099852229875e-01   -1.808802493627120e-01   +1.385262139377937e-01; -9.547403093165309e-02   +1.751891794887241e-01   +3.342922925470791e-01   -9.854605873603066e-02   +2.513861378420030e-01   +4.230038339890906e-01   +9.903152133997996e-02   -2.826363709746774e-01   +5.145757472017851e-01   -1.945396335338688e-01   -3.719097541203055e-02   +1.609674247602128e-01   +1.773999309456935e-01   +9.350487363753886e-02   +2.299077799919903e-02   +1.380874717212350e-01; +2.396587090882776e-01   -3.417797900910992e-01   -1.576258003027773e-01   -1.684665449363735e-01   -1.289462700162197e-02   -1.410699399421618e-01   -9.768486135035126e-02   +1.619346813208911e-02   -3.591289727287096e-02   +4.029601353815807e-01   +7.199924133292210e-02   +1.798892583285511e-01   +5.906000592375985e-02   +7.060377327655770e-02   +8.539891155238610e-02   +1.214734971407005e-01; +3.720478830974111e-02   -8.895571199633689e-02   -1.349200046394801e-02   +7.464964422456700e-02   +2.665156016788993e-01   -1.334068156035824e-01   -1.590145589915596e-01   -2.095572750165996e-01   +8.718672878890824e-02   +2.137197909896411e-01   +2.523257233549166e-01   -3.707844271581235e-01   -1.314106474036224e-01   +4.133474876301213e-02   -1.396882485730166e-03   -1.755320252002482e-01; +1.409808515008335e-01   -3.742795872129238e-01   -1.256026095479446e-01   -4.682343313901186e-02   -3.454472316888606e-02   -2.240414523510060e-01   -5.568435415259954e-02   +2.559246166664987e-01   +2.856423436630254e-01   +3.332588101422067e-01   +1.615393546198022e-01   -2.774206526660097e-02   -9.454529619733601e-02   +1.910244533565498e-02   -1.108283786803698e-01   -1.889361135484632e-01];
L2I_L2E_iAMPA_netcon = [+2.944598917648731e-01   +3.950373963906628e-02   +8.234720076428030e-02   +2.480526746998399e-01   +3.212723869506488e-01   +1.673256291912804e-01   +1.197953535831887e-01   +4.931565177261107e-03; -2.335370637699356e-01   +2.157933073186540e-01   +1.506361058755259e-01   -4.413953916969498e-02   +4.289024550334308e-02   +5.194199849743446e-02   -2.976185795365049e-01   +2.884814473727765e-01; -8.157149134232272e-02   +1.482571535287007e-01   -5.685505830520453e-02   +2.833993969154323e-01   +1.309046360435134e-01   +3.407680650709866e-01   +4.696115513668672e-02   +1.509580277088609e-01; +3.469582271528205e-02   -3.941521301972341e-01   +3.442763280208816e-02   +3.636195341362470e-02   -3.572489370793303e-02   -1.115717191040845e-01   +3.772694417629407e-02   -1.641857775255040e-02; +4.540985474636557e-02   -9.552456142292498e-02   -2.203586821080560e-01   +2.616310120206848e-01   +3.243093075914056e-01   -7.107496592629081e-02   -1.638895936900958e-01   +7.605949227269936e-02; -6.872192070288835e-02   +1.877496353043596e-01   +3.597281044147436e-03   -7.860471246441286e-02   +7.629713552146576e-02   +2.338032308007140e-01   +1.880135648966539e-01   +1.082654208520567e-01; +3.856867284693311e-01   +5.545820721128933e-02   -3.732320790417761e-02   +2.419222247070180e-01   -2.509691344749364e-01   +4.378668594988194e-02   -1.373627332747305e-01   -1.400589356318359e-01; +1.122734777890095e-02   +9.127419518292240e-02   +2.556351594845731e-02   -2.400766630796790e-01   +3.432676920504540e-02   -3.967939106670204e-01   +1.015457692632238e-01   -4.497516832447248e-02];
L2E_L2I_iGABA_netcon = [+8.968960259117556e-02   -1.547407582405184e-01   +1.456247110403477e-01   -9.512651727255293e-02   -7.866521961964951e-02   -3.319686060489282e-01   -2.044216982720322e-01   -2.757689459722995e-01; +2.351263994704954e-01   -2.120549835008721e-01   +2.215129399057462e-01   +1.156404922954274e-01   +2.970998959808941e-01   +3.428556347980997e-03   -2.310804864165312e-01   +1.644063318171252e-01; +6.279867152019319e-02   -2.607655297326802e-02   -2.474460964498174e-02   -3.218312266244852e-01   +3.829806642838732e-01   -7.327815488850363e-02   -1.441371293430226e-01   +2.173352966508993e-01; +3.813068340827337e-01   -2.052347834383073e-03   +3.534931760521167e-01   -1.279252791448970e-01   +1.084636343461282e-01   -1.388129461322827e-01   -2.537269660102587e-01   -2.297637855227543e-01; -1.251845949447932e-01   +1.756895498953722e-01   -2.603350449232794e-01   -1.137733217547984e-01   +1.096615679280049e-01   +1.236202923960820e-01   -1.704410308410773e-02   +2.370073543735795e-01; +2.526722792677600e-01   +1.621470500838540e-01   -1.423924026375618e-01   -1.778459772674700e-01   -1.209461317360794e-02   -1.204519716862928e-01   -8.270605215875583e-02   +1.692778481592371e-01; -3.034961922197447e-01   -3.575100680302123e-01   +1.731353833811332e-01   -1.248244768088796e-02   -2.416647581941986e-02   +3.507906687159856e-01   +1.470434455964655e-01   -3.203225146973072e-02; -1.112946506866557e-01   -2.591950028460953e-01   -3.702651694393142e-01   +2.315267620486022e-01   +2.814306223184652e-03   +7.508523698900937e-02   +2.541028150342822e-02   +2.745745403731523e-02];
L3E_L2E_iAMPA_netcon = [+2.122727887579334e-01   +3.346295405493207e-02   -2.004578980996160e-01   -3.029327616234430e-02   +1.467162707943002e-01   -2.472836473090569e-01   -2.517800536984280e-01   +6.633479499191572e-02   -2.508697163252501e-01   +3.464489089851865e-01   -2.196525809422943e-02   -7.246459625114085e-02; -3.055297589720839e-02   +1.466820900820958e-01   +3.358799712365010e-02   -1.600724208688116e-01   -5.070696869746347e-02   +9.819205242892435e-03   +3.097814629544973e-01   -5.710195568900955e-03   -2.639861424790186e-01   -4.292910170258402e-01   +3.249699594696100e-02   -1.075946047848184e-01; +1.839002708179433e-01   +2.730086769891434e-01   +8.218243235504813e-02   +2.011907905638244e-01   -1.654230317111603e-01   +2.652907421553189e-01   -1.515824678255410e-01   +1.365063652185937e-01   +2.045362443191544e-02   -1.442011355626931e-02   -2.294310848348961e-02   +1.263148836778455e-01; -8.192813149142805e-02   -6.842202155363804e-03   -2.637788267861058e-01   -1.798458696037649e-01   +3.116282604112761e-01   +3.492396335918794e-01   +5.309414210156125e-02   +1.748936150553511e-01   -1.356679898262035e-01   -1.914974106234232e-01   +1.657249545943212e-01   -5.443406498777184e-04; -3.165960162179932e-01   +1.756507059041541e-01   -2.441012516658215e-01   +1.094771268820941e-01   +1.885982725059137e-01   +2.524548085617986e-01   +1.639944966434179e-01   -3.185536413228748e-01   -2.038195261679941e-02   +1.106518119659465e-01   -2.984508501821103e-01   -2.421883560329605e-01; -1.078256595315639e-02   -2.459974803001881e-02   -8.680638254931211e-02   +3.252902110510255e-01   -4.162117789299323e-01   +1.688546668371650e-02   +5.760830429849582e-02   +1.946415695856404e-01   -9.136480392339690e-02   -3.071091372325697e-01   -1.120990295112126e-02   -1.575883138203167e-01; -1.960594547859017e-01   -3.341663347659062e-02   +2.373547359461081e-01   +3.899332101295849e-02   +3.159543418239141e-01   -2.393104182375370e-01   -3.766238407432888e-02   -1.616618297691292e-01   +8.546495797393186e-02   -1.936360851670639e-01   -3.018449063025736e-01   -1.704453125837245e-01; -2.796137256954540e-01   +2.017315605151611e-01   +1.700923666340780e-01   -1.881499385020238e-01   +1.637782711490501e-01   +7.488414258779587e-02   +1.238671537197860e-01   -2.489836163791455e-01   -1.850649525952638e-01   +1.882215483525708e-02   -1.429734086548683e-01   +1.356808060829570e-01];
L3I_L2I_iGABA_netcon = [+5.749730876390136e-03   -1.647830208291587e-01   -6.682130958631696e-02   +1.809580484360756e-01   -8.531674606220020e-02   +6.219253625808090e-03   -4.213723539786444e-01   -1.096999239057673e-01   +7.362684725935091e-02   -3.287323974030638e-01   +1.566898919770330e-02   -2.377293391353797e-01; -2.065204544129069e-02   +1.437333994675358e-01   -4.625373310766698e-01   -9.061101189006540e-02   +1.457947902530641e-01   +1.477246688964312e-01   +6.024156193041388e-02   +1.173374213273316e-01   -7.154512699109641e-02   +1.461977188891461e-01   +4.053483313782871e-02   +1.348034182475035e-01; -2.600779111906801e-01   -1.954725346800938e-01   -1.446214535556626e-01   +2.257591383195454e-01   +1.083033209311593e-01   -1.295016497934023e-01   -1.338929973537200e-01   -3.312503523353992e-01   +1.783094781841336e-01   -1.490753384165659e-01   +1.657481984683190e-01   +3.647697151885361e-01; +2.505688358789639e-01   -2.062194945159819e-01   +2.705510536909686e-01   +2.289419726758318e-01   -2.807051858205618e-01   +2.930020349703570e-01   +8.916699980114658e-02   -1.596581533779889e-01   -1.785531989576822e-01   +4.455883916669721e-02   +3.797056953092980e-03   -1.558348688466407e-02; +2.356269072307416e-01   +2.468819034717300e-02   -1.208044155691130e-01   -9.083695536359937e-02   -2.185731861291648e-01   -1.461550946640444e-01   +3.354406652114788e-01   -4.956587779497049e-03   -2.505606065690609e-01   +2.500671574227167e-01   +1.393692406756852e-01   -2.743701141492619e-01; -5.758694081647475e-02   +3.308507877693543e-01   +1.617023548317192e-04   +1.074019958515636e-01   -9.234189429967413e-02   -3.352363464983796e-01   +3.295619320458567e-01   -1.933504172497637e-02   +1.266985940900481e-01   +4.615454637007474e-02   +2.056060194845102e-01   -1.121774658502085e-01; -2.006179252514840e-01   -1.323066030130995e-01   +1.661192984590043e-01   +1.536780562811600e-01   -1.513530789063953e-01   +9.225120817280452e-02   +1.239946629594371e-01   -9.802157084905280e-02   +1.008816167234369e-01   +2.619349685872417e-01   +1.694138322512929e-01   -3.178605695310319e-01; +2.452813640787718e-01   +6.460923940732631e-02   -1.045908383615955e-01   -6.919939664483717e-02   +5.672852031697111e-02   +2.799740142189221e-02   -3.673916186065192e-02   -1.155887671459622e-01   +4.611292727572416e-02   +1.443879282083729e-01   +1.228868013140029e-01   -4.323949644629271e-02];
L2E_L3E_iAMPA_netcon = [+1.711312174087035e-02   -9.069018687193307e-02   +6.054043188421808e-02   +2.233597408755325e-01   +8.131861460035417e-03   -3.782321260499791e-02   -4.701169235110297e-02   -3.239143862078783e-02; -1.170965062375685e-01   -1.969734525904019e-01   +1.513276492867260e-01   +4.267777831035819e-01   +8.813453333907210e-02   +2.335806046509434e-02   -3.989058011600265e-02   +9.408063262226786e-02; -9.748929579894713e-02   -2.168627996268804e-01   -1.827640146969574e-01   +7.201025976486965e-02   -1.402898035122069e-02   +2.066057321082362e-01   +4.116649965452443e-02   -5.268203976205349e-02; +1.078106876793744e-01   -3.419061392606366e-02   -1.210875803781139e-01   -1.454035295585558e-01   +3.978210087463682e-02   +2.665569549025527e-01   +3.689317049469023e-02   -2.786684241134896e-01; +8.635669489744098e-02   +1.513230960840225e-01   +2.318371638403224e-01   +3.426968120695170e-02   +1.212316896609567e-01   -5.802754088933696e-02   -8.307620749759134e-02   +1.366062748270473e-01; -1.406917817936634e-01   +1.373487846320140e-01   -1.072496845110528e-01   -5.685123647677021e-02   -6.641395810174380e-03   -2.656934477058115e-01   -2.232708879391508e-01   +1.766171464056426e-01; +2.910836472066095e-03   -3.334410064656726e-01   -1.560421800734582e-01   -2.525633489514123e-01   -9.639876002426864e-02   -8.508593678324347e-02   +2.191604437624049e-01   +1.910969957183256e-01; -1.473305307528971e-01   -2.993637654805657e-01   +1.024438630733280e-01   -2.308096769093344e-02   +8.430588107615686e-02   -3.356050477885681e-01   -5.540530472239409e-02   -7.036371838238376e-02; -2.403000277104934e-01   +1.542200981774690e-01   -6.459452523462970e-02   -7.389174157755875e-02   -4.318718313974750e-02   +2.387068637695166e-01   +1.025974329787324e-01   -8.683449419433281e-02; +2.952165904015100e-01   -1.507869854635848e-01   -4.347969258494582e-02   -9.331369360579037e-02   -1.353063974872832e-01   +2.466807466473085e-02   +6.633151211707573e-02   -2.635002266133066e-01; +3.496904559025636e-02   +1.710123925850126e-01   -1.697581682931823e-01   +2.036834981499832e-01   +1.688951880031102e-02   -3.104847510108595e-02   -1.262313104729452e-01   -1.898474582710228e-01; +1.672349005216145e-01   +1.651436213300311e-02   +6.449066753601027e-02   +1.143906680117047e-01   -3.275904936328433e-01   -3.573199781580104e-01   -7.562862179781223e-02   +1.047627560504806e-01];
L2I_L3I_iGABA_netcon = [-1.000740818148874e-01   -1.265742842623727e-01   +1.287008835793078e-01   +3.897756727822895e-01   +2.796849858264461e-02   +1.291823009233375e-01   -9.394888348586064e-02   -1.208905937292360e-01; +1.300349416311564e-02   +1.050233828667737e-01   -1.434462449142960e-01   -2.783975376038871e-01   -2.305466387692707e-01   +1.426166648419331e-01   -2.793912278420477e-01   +8.527596643086623e-02; +1.241439250598189e-01   +1.836233539296629e-01   -2.551080108017600e-01   +6.261747057982966e-02   -1.308795968516853e-01   -2.399727577443271e-01   -9.437945424601289e-02   +1.920872466818154e-01; +6.912726121502397e-02   -9.517461991785350e-03   -4.438130537111208e-01   -1.813454364963973e-01   +3.215022621912524e-01   +2.549687845429583e-01   +4.459567508875004e-02   -2.273713899148627e-01; +1.001733698253323e-01   -2.376420993340965e-02   -3.884539641429634e-02   +4.963481374978005e-01   +1.466367051360063e-01   +1.718109844955116e-01   +4.163909379341232e-01   -1.241892026984620e-01; +1.712292986191998e-01   +2.005242972511939e-01   -1.138582806319005e-01   -2.311805697744181e-01   -2.159021408288934e-01   -1.975593763015234e-01   -2.706970962562169e-01   +1.548010505554720e-01; +1.715512147136189e-02   +2.728745765420555e-01   +8.134897033310176e-03   -6.381120834064644e-02   +1.424730057133049e-01   +2.691754444208601e-01   -7.012611489263318e-02   -2.140777931010381e-01; +2.997109349630531e-01   +6.249703891219367e-02   -1.376210301701892e-01   -3.139765586482885e-02   +2.181814256694768e-02   -3.097738324321782e-01   +1.349606502508687e-01   -6.751826437313027e-02; -1.470132450029596e-01   +3.194804170124743e-01   -2.419060111708351e-01   -7.134717345046418e-02   -2.690377373587535e-02   -8.225257645631702e-02   -6.794572975726598e-02   -1.468899057054696e-01; +3.595123352883435e-01   +7.518766671058693e-03   -2.529258425805326e-01   +1.946707004495137e-01   +1.036350008815011e-02   -5.242198649841931e-02   -8.315394312149399e-02   +3.726255736099662e-01; -3.772806073024749e-02   +1.915196276802278e-01   -4.989346998547989e-03   -1.160859439696313e-01   +2.302773672970004e-02   -6.412446220336364e-02   -2.312091949220802e-01   -5.240479931925965e-02; +3.109306396688675e-01   +3.859985290037882e-02   -4.936347732545092e-02   -1.107738403590172e-01   +1.688326404663388e-01   -1.795933697364507e-01   +5.751278212519934e-02   +2.873747033621813e-01];
L3I_L3E_iAMPA_netcon = [+2.159788406735829e-01   +3.013590825995870e-01   -3.145977315018375e-01   +3.495859382667129e-01   +1.677703854478016e-01   +6.950585221608847e-02   +9.906885145602308e-02   +1.667347472040086e-01   -9.424243118771797e-02   +2.144686969736960e-01   +1.299531513353453e-01   -1.600324687191405e-02; +2.151534873752868e-01   -1.513523927824963e-01   -1.453274665862971e-01   -2.656825680934607e-01   -1.364779171618814e-01   -2.423554735121575e-02   -7.546600776301024e-02   +1.128518025189940e-01   -2.474927164941930e-01   -1.071324466984418e-02   -1.153866951729105e-01   -1.508186518432446e-01; +1.392168934714928e-01   -1.862804408358985e-01   +6.477093463367552e-02   -7.913476557019482e-02   +5.888771212000134e-02   -7.753736909902498e-03   -4.940903661073343e-02   -3.333895035363730e-01   -2.008616329447495e-01   +2.044593992247793e-01   -1.239253293859033e-01   -4.301360508413410e-01; +1.054337452252845e-01   +1.726734785478550e-01   -1.852216568347543e-01   -1.845821088001518e-01   -9.727405797282336e-02   +7.229764653125015e-02   -1.211473859837354e-01   +2.641604455223476e-04   -1.363372145532626e-01   +9.728281438235893e-02   +4.901478633771469e-01   -3.967422013430867e-02; -1.448188171955735e-01   -2.918931465513988e-01   -5.034366973403998e-02   +1.744546488472524e-01   +8.510269300389399e-02   -1.425202866939969e-01   -8.667726597706048e-02   +4.991046737930271e-02   -1.743393588814954e-01   +9.490230332626431e-02   -3.881055993186057e-02   -1.776852043253566e-01; +6.318162794943188e-02   -1.582663179788134e-01   -3.082426683105630e-02   +8.999842171223253e-02   +2.488751733984546e-01   +1.930438446038343e-02   -3.163823478321510e-01   +1.815106486999202e-02   -2.136200986661502e-02   -3.797316673792660e-02   -2.119785260315437e-01   -1.698156048780226e-01; -4.253596870728038e-02   -1.017860797801528e-01   +8.210652054332837e-02   +3.050910889379004e-01   +3.679970943276296e-02   +3.631712780293691e-02   +1.184464406613797e-01   -1.595080636032693e-01   -2.212971331878399e-01   -9.581334604633340e-04   +1.565089248605305e-01   +1.352018354731012e-01; -4.458461772029605e-02   -8.482545221517732e-02   -4.546809896234452e-02   +1.811050656550945e-01   +1.045853454462271e-01   -1.398097029800335e-01   +6.791533934785558e-02   +2.471664429617087e-01   -1.358954071158857e-01   -7.045059495243716e-02   +1.461540152540480e-01   -5.589785958809328e-02; +1.576385111247511e-01   -1.104911009633385e-01   +2.719641606274172e-01   +2.980337289668324e-03   -3.097055310607046e-02   -1.702054281096702e-01   +1.961751194549617e-01   -2.804141729862276e-02   -1.971432787416930e-01   -5.539489179275130e-02   -2.197180721909470e-01   +6.870494469764457e-02; +1.388310998110418e-02   -9.080958202681269e-02   -3.291211152714111e-01   +2.333939118979351e-01   -1.296143488215617e-01   -8.863317559378182e-02   +1.232758671518741e-01   +1.159104079662617e-01   +2.656018851506134e-01   -1.639321524865994e-01   -2.108436982902855e-01   -2.622338057302110e-01; -1.112554136120176e-01   -3.733599416895164e-01   +1.230361978790364e-01   -3.684607390037947e-01   -1.073463390689564e-01   +2.517431479613238e-01   +2.294522403639732e-01   +1.768339617773897e-01   +1.584334293143657e-01   +2.485030797706621e-02   -5.563867050984099e-02   +3.723101498658773e-01; -1.550236078586560e-01   +2.374149514657756e-01   -8.142737182131259e-03   +2.247020922186079e-01   -2.739144819371101e-01   -1.668860717487081e-01   -1.168165474477667e-01   +1.142532943214984e-01   +1.811244915788918e-01   -1.215230442366775e-01   +6.803865770781486e-02   -1.464328439230813e-01];
L3E_L3I_iGABA_netcon = [-1.792579638386738e-01   -1.274018235770820e-01   -7.826596023872978e-04   +1.755060821583732e-02   +1.871129143979834e-01   -1.338633685589276e-01   +5.189681011989597e-02   +1.993111788577636e-01   -1.651718055817805e-01   +2.241401540035708e-01   +4.062723835685618e-02   -8.910743996738175e-02; +2.394510159707532e-01   +4.342927682534041e-02   -1.591063180064538e-01   -1.756077997735171e-01   +2.582731067847482e-01   -9.936715983971799e-02   -8.795578369451432e-02   -1.682051645520944e-01   +1.224441180668235e-01   +1.033201903696386e-01   +1.291103345533290e-01   +3.836959593188272e-01; -2.147639017155439e-01   +1.131213112715556e-01   +2.001841677975112e-01   -1.576899655179415e-01   +2.267339923691063e-01   -3.626493851483116e-02   -1.269197498029019e-02   -2.306574665493257e-01   -6.826959116009855e-02   +4.539654057526508e-02   -2.283812136879009e-02   -4.002454610106765e-02; +2.480731654989108e-01   -1.113361169729670e-01   +1.058128419346314e-01   +1.458008778264566e-01   -1.586708292044206e-01   -1.804197410973153e-01   -2.698390781444979e-01   -2.119383753729601e-01   -1.081535881435428e-01   +2.256027079333197e-01   -1.328109231270234e-01   -2.018252073077016e-02; +1.404035740477617e-02   +7.413052928860075e-03   +1.860672858431072e-01   -2.038313643276788e-01   +7.516136167298916e-02   +2.860305785290861e-01   -1.613828649570621e-01   -1.354217814343770e-01   -9.321091848825908e-02   +5.944924576650571e-02   -1.177516220926411e-01   +1.560852317168241e-02; +6.767887096216185e-02   -7.051860168230596e-02   -2.675072438380874e-01   +2.280743823325243e-01   +1.650032743029956e-01   +1.730974404044326e-01   -1.186828200348570e-02   -2.889499463511490e-01   +1.532057497487682e-01   +2.967381701372483e-02   -1.010951739175417e-01   -2.111521826496526e-01; +8.702865488139134e-03   +1.589643007874957e-01   -5.776078714594488e-02   +7.649724400347586e-02   +2.647033407607369e-01   +3.168042600617539e-01   +2.272059258113658e-01   -8.644485909544494e-02   +1.588441839750375e-01   -3.401233087044919e-02   -7.222974635088880e-02   +1.947940891997905e-03; -1.748148338158249e-02   -7.307282871164181e-02   -9.860363185822987e-02   -8.008643231895332e-03   -2.095209591680745e-01   -7.583576036865390e-02   -2.256683276647747e-02   +4.395516268833049e-01   -3.454742021211332e-01   +1.480605235289265e-01   -9.108797180106387e-02   +2.233192775210725e-01; +2.392406028164768e-02   +7.362451058288197e-02   +1.465303172886527e-01   +2.403383984575652e-01   -6.120762388978240e-03   +6.532374199650227e-02   -5.458402344219052e-02   +2.811539216620024e-01   +3.668064061105577e-01   +4.783368349477716e-01   +1.807062450979125e-01   -1.611111388380872e-01; +1.294450042958978e-01   -1.129569488752808e-01   -2.054710418334074e-02   +9.571553385760653e-02   +4.568660318684176e-01   -7.094926937529426e-02   +6.799991650450099e-02   -1.004665096899290e-01   +6.945119845816709e-02   +8.002156204315218e-02   +8.561841428717548e-02   +6.669565169436625e-02; +9.396736394525410e-02   +3.308952762594981e-01   +1.589676363359944e-01   +4.662165758021199e-01   +1.436181227945074e-01   -1.163755662763326e-01   +1.010619683002701e-01   +1.988704799868171e-01   -8.096041165078618e-02   +1.660214042366113e-01   -2.784812481976437e-01   -1.948100318023347e-01; -1.328006662710828e-01   -2.859043832537921e-01   -4.559541024844481e-02   -2.627551914348416e-01   +1.058912166110221e-01   +1.198658680576480e-01   +7.987129978126927e-03   -8.198770584044965e-02   -2.522577951421788e-01   -1.742539833255708e-01   +1.647821836856153e-01   -5.755687247323228e-02];
L2E_Input1_iAMPA_netcon = [-2.459205355654833e-01   +7.591922563710551e-04   -2.130684005474154e-01   +1.865624114902500e-01   +3.438435656834007e-01   -2.680040142699683e-01   -4.064050077828165e-01   +1.260681198159687e-01];
L2I_Input2_iAMPA_netcon = [-2.045950206187649e-01   -2.343065105170453e-01   -1.196844139011857e-01   +2.688457875923271e-01   -6.518923984116784e-03   -3.551720808345278e-02   +5.178375934950429e-02   -9.998482641903836e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
