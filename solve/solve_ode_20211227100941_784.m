function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.906874542635987e-01   -1.511203500061082e-01   +3.322258733886130e-01   -8.174396985322049e-02   -2.472937105874749e-01   -1.290625395687907e-01   +9.321983993152513e-02   +1.459701437510953e-01   +2.080820897865708e-01   -1.240794121428074e-01   -3.122698032241206e-01   +4.708924801505667e-01   +7.002972405175022e-02   -9.433191019252996e-03   -2.438124437814067e-02   -2.137343109135933e-01; +1.585621238870907e-01   -4.229206075390552e-01   +3.103191876607879e-01   -5.366538201307576e-02   -2.301241152767380e-02   -2.066774331570365e-01   +1.171336603493480e-01   -2.486705647485316e-02   +2.935825372349377e-02   -1.562616185584489e-01   +3.461391556519496e-02   +1.118447140455819e-01   -3.723443963906012e-01   +1.217634843067293e-01   -1.204039135875198e-01   -4.011958542546222e-01; -3.418697531676727e-01   -5.328926731759420e-02   -3.899001683378710e-02   +2.929621788176600e-01   +5.071193449163205e-01   -1.051965023969643e-01   +6.813017086083001e-02   +6.089505285303080e-02   -9.854846274770931e-02   +1.331149864939998e-01   -3.890922874730372e-01   +1.670609331343165e-01   +2.633435533064276e-01   -2.531487946826935e-01   +3.670783897085735e-01   -3.742665220431084e-02; -2.846097414766400e-01   +3.366533604090737e-01   -2.625352264868443e-02   +2.928000169623288e-01   +1.701398822616532e-01   -7.288195980771275e-02   +3.394200029274856e-01   +3.580011788852785e-01   +9.184825995832743e-02   +5.512383252600193e-01   -4.357270311667963e-01   +2.950114433976241e-02   -8.582411775630058e-03   +3.040683079966017e-01   -4.214922601649664e-01   -9.413195764507887e-03; -2.364273577203298e-01   +1.687068595086674e-01   +2.484072982990367e-01   +9.353359380676191e-03   +9.572478185708864e-02   +2.541644992540100e-01   +2.028032759216875e-01   +5.129536044733288e-01   -1.951987875608510e-01   -3.110727278243602e-02   +1.663521587695972e-01   +9.263872878467189e-02   -1.072679954564524e-01   -2.106504026066781e-01   -1.432123795959828e-01   -2.259719896110507e-01; +1.944588198032798e-01   +1.620572174348136e-01   -3.737924939476637e-01   +2.484350953757209e-01   -2.792921871725407e-01   +1.032749853416731e-01   -1.879192331708550e-01   +1.319809852930233e-01   +1.371330101890209e-01   -5.315529397421892e-01   -7.967954131623753e-02   -2.391510326013355e-01   -1.132946667696707e-01   -4.397724910129671e-01   -2.961254495394914e-01   -3.099065287849603e-02; +6.374501270771982e-02   +3.124884920214271e-01   -9.289959340603758e-02   +1.483228030940974e-01   +2.602136139583277e-01   -1.001209709182323e-01   -1.534350833855381e-01   -6.733435879690974e-02   -1.910653638732940e-01   +3.194990427750083e-01   +1.635426349524541e-02   +1.711770336793475e-01   -5.552438243141780e-02   -2.684511982809227e-01   +1.249793745267082e-01   +4.139361301784205e-01; -1.687091623316298e-01   +1.579574293564572e-01   -9.096430581592621e-02   +4.681571515239388e-03   -3.820343265830219e-01   -2.056493302375963e-01   +2.431863844862119e-01   +3.634694639669305e-01   -4.123245688840854e-02   +1.327482056944094e-01   -4.136835802558447e-01   +1.036247738786197e-01   +6.670556286543952e-02   -1.617026355091529e-01   -1.761311611704322e-01   -6.094956000756742e-01; +1.067448522350020e-02   -1.023681489005608e-01   +2.207555749560133e-01   -2.065210813701040e-01   -4.897826634172386e-02   +7.610804167883084e-02   +4.537965060459370e-02   +2.018039804770534e-01   -1.902286199042166e-01   +1.597466614722294e-01   -1.993034293273211e-01   -5.592941709670149e-01   -1.163055808894376e-01   -2.543262549299612e-01   -1.851881246671963e-01   -3.566020080415235e-01; -7.571771731241424e-02   +2.677053725641277e-01   -3.267378441479890e-02   +1.737304858615864e-01   +5.179032783769200e-02   +2.177089800716988e-01   +3.661222988240389e-01   -2.104406932560294e-01   -3.341835362667510e-01   -8.520708138720143e-02   -2.360165774856492e-02   -3.229461515334678e-02   +3.600004293831031e-01   +2.435193175275588e-01   -3.409732708803814e-02   +1.962379121818538e-01; -7.656058626983113e-02   -1.192839218312575e-01   +9.876951447269555e-02   +1.014878802817645e-01   +1.906936474153492e-04   +2.205163253617685e-01   +1.639637086570922e-02   -1.600635121465927e-01   -4.380506093443426e-01   -1.760077138524373e-01   -4.933881971278926e-02   +2.087864757591894e-01   -4.889313575446179e-01   +4.765229871603353e-02   -4.401278277729199e-01   -4.130953540079351e-01; +3.935625523885484e-01   +3.469183094699204e-01   -5.658714298456326e-02   +2.712713861800556e-01   -2.020255251210570e-01   +2.085695611252514e-01   -7.077937825893024e-02   -3.315806555263068e-01   -3.721302788097855e-01   +1.227551252533940e-01   -1.333871834488923e-01   +1.981816929617062e-01   -3.465525253815259e-02   -2.404820108783493e-01   -2.473998785535404e-01   +2.532649943642024e-01; +5.272738034187763e-02   -3.768495199694094e-02   +1.489329774495193e-01   +2.328763206435624e-01   +1.562210749209286e-01   +2.504833343886056e-02   -1.939025680239484e-01   +3.953555695233274e-01   -4.173751654552990e-02   -2.501160046936060e-01   +1.745542092278863e-01   +2.755596631378558e-01   +2.959759482875358e-01   +3.826050138340656e-01   -2.360565619299534e-01   -3.899196390963210e-02; -1.967592698504375e-01   +4.980177780123131e-02   -1.477545103366872e-01   +3.506129395264028e-01   +1.929912205165158e-01   -1.606029439086860e-01   -2.774917282750665e-01   +1.710304579560764e-01   +5.669703269277598e-03   +1.439877239097933e-01   +2.683215917711659e-01   +3.185147557438999e-01   -2.237918931775050e-01   -1.035339583371390e-01   +1.927644568498844e-01   -2.660619876659778e-01; -2.575245420850151e-01   -1.732064828820546e-01   -2.089787892492353e-01   -2.928553293495517e-01   +1.871953462992201e-01   -3.432301949332531e-01   -2.722287610978144e-01   +1.636215123356103e-01   -7.873474794779250e-02   +2.023114653917574e-01   -1.184027502063788e-01   +1.165589357272238e-01   -2.442505169997550e-01   -3.089851214048270e-01   -3.641473013494959e-02   -3.076800684266555e-01; -1.372975775578378e-01   +1.619745373551134e-01   -5.636601417533649e-01   -3.786519885249128e-01   -2.248523374725364e-02   -4.483493392136551e-01   +3.191370703942782e-01   +5.052172945959480e-02   -2.532171666111082e-01   -1.502535387943556e-01   -1.925859933154701e-01   +1.062977147188953e-01   -2.461104800552962e-01   -3.699799246693720e-01   -1.046457125928930e-01   +8.151697067392402e-02];
L1E_L1I_iGABA_netcon = [-2.333003202705439e-01   +8.923803948053184e-02   -5.278445903108987e-01   -6.235171971330442e-02   -2.976058411636624e-01   -2.422077220062074e-01   -1.373310597856437e-01   +2.452886765468618e-01   +1.017868284952456e-01   -6.521889151450447e-02   -1.769092111434032e-02   -3.289749918166579e-01   -1.638106863812636e-01   -2.883405826022670e-01   +2.679706338706799e-01   +4.549167714756982e-01; -1.263279441410915e-01   -4.077586504064867e-04   -7.256382499849107e-02   +1.225390998170289e-01   -2.661266492245524e-01   -9.241345014185658e-02   +2.234192238340734e-01   -2.537305599154180e-01   +2.923043969646275e-02   -2.265590366487193e-01   -6.256329777486951e-02   -3.811165981794298e-01   +2.911845642619346e-02   -2.049166630722516e-01   +2.146276275261386e-01   +1.715545389330829e-01; +9.788260119748537e-03   +2.478075501205142e-01   -2.811824885500777e-01   +1.677875039978112e-01   -1.833481201805484e-01   +3.293045776006512e-02   -2.041847583153031e-01   +2.140220053409349e-01   -1.220542018836573e-01   +1.966260644711614e-01   -4.856759644385886e-01   +2.287885478378473e-01   +1.808926302747683e-01   -4.327653283372759e-02   -4.635668865665138e-02   -5.581352535082866e-02; -2.382516945398736e-01   -4.604839091195565e-01   -1.388846708477874e-01   -4.904610317810084e-01   -7.131811419719999e-02   -6.145261675277329e-02   -5.086976605086122e-01   -2.976005607801028e-01   -1.158862827480738e-01   -2.594829062408300e-01   -3.547186092486468e-01   -3.386816329358260e-02   +2.769169386031372e-01   -7.878645194816425e-02   +1.949274421659473e-01   +2.562790711202452e-01; +2.559394356527921e-01   -4.342688863165516e-02   -2.710544469501741e-01   -1.276593085745013e-01   +3.538038746048861e-01   +3.611402975056949e-01   +3.571310252849138e-01   -9.377218480801454e-02   -9.559837469136917e-02   -5.570346761379755e-02   +3.344807521436901e-01   +1.904266126768184e-01   +4.564469057320276e-02   +1.209010882303127e-01   +1.107432640622325e-01   -1.934284936612393e-04; +1.807736701578961e-01   +2.311434006095255e-01   +2.659668992749292e-01   -9.688772140634697e-03   +2.622598629059366e-01   -2.990078599480849e-01   -4.483336504420303e-01   -3.791705947563490e-02   -5.030513582843882e-02   +1.956081386173137e-01   +7.636194002510005e-03   -3.339395992136557e-02   -6.246653392687079e-02   +4.316916483160222e-01   +6.191246356941554e-01   -1.537585722767769e-01; -3.269681966390872e-02   -1.352735481861717e-01   +2.772364610777427e-02   -4.323228791669502e-01   -2.228788154034970e-01   -5.708683051336763e-02   +1.000901221971289e-01   -3.548603582441239e-01   +3.326973800528630e-01   -1.422998067198241e-01   -2.729699926506604e-02   -2.947954823651540e-01   -1.953857881706949e-01   +4.290976522366179e-02   -2.181701820398823e-01   +2.592102225344780e-01; +5.007462201186281e-01   -2.598900190923310e-01   +1.687539970679530e-01   +4.274496938480169e-01   +2.299486071755494e-01   +5.629061601438073e-01   -2.663993002545624e-01   -2.974517570183467e-02   -3.406278548123473e-01   -6.795967974376826e-02   -1.418015306911788e-02   +2.172041848561728e-01   -2.287771236232134e-01   -1.959310719278275e-01   -2.102696052884968e-02   +3.234354857417213e-01; +2.285191199537710e-01   -2.888704729260580e-02   +7.836180621223568e-02   +1.572707198731785e-01   -5.647622903346869e-02   -2.515952431497835e-01   -3.858878406173634e-01   +1.563102248469829e-01   +1.460192775979366e-01   -3.125800420753966e-01   -6.440692719999283e-02   +3.143716870535979e-02   -1.150330263993869e-01   +1.688736287708322e-01   -1.116540371082697e-01   +5.063594491894585e-02; +8.840683358979297e-02   +1.808375092609061e-01   -1.531891497612287e-01   +2.908218495979952e-01   -5.131358871619329e-01   +2.804892497330825e-01   -5.345247279456586e-01   +1.783381110732546e-01   +2.821569040724878e-01   -1.326641123363067e-02   -3.755389116752326e-01   +2.332872077243948e-01   -1.507926377064035e-01   -2.381024717937970e-01   +1.056935401869768e-01   -2.632408142873578e-01; +2.411569901822980e-01   -3.432609327060705e-01   +1.721236147193912e-01   -3.123977214304700e-01   -2.919022538873420e-01   -5.324217976927965e-02   +3.419870281194011e-02   -1.053509623084617e-01   -2.089494150760614e-01   +4.286775519651209e-01   -3.307074006206934e-01   +3.398375699015890e-01   +2.327114799680224e-01   +2.100953433980381e-01   -1.248978101840344e-01   +1.017568938235052e-01; -2.171994651333254e-01   -3.669708633710996e-01   -2.959582115208929e-01   +2.320665017728174e-01   -4.369628902389620e-01   +1.776581078955003e-02   +1.155354838269527e-01   +4.700496787553074e-01   +2.863043115617386e-02   -1.967413301963527e-01   +2.212247602003881e-01   +9.019175907824645e-02   -2.022496122503452e-01   -1.586840658913880e-01   -5.906335874971905e-02   +4.063986439438775e-01; +2.182778365397994e-01   -3.987096029800020e-01   -8.193711225263454e-02   +2.601148280538777e-01   -2.087431351569901e-01   +1.853624249815772e-01   -1.852624093713928e-02   +1.900558190545410e-01   -1.418158391737046e-01   -6.124804717823286e-02   +3.067666709166381e-01   -5.144231236346430e-02   +6.152003308689374e-02   +1.365939055696233e-01   +2.260072249958286e-01   +2.345757442191755e-01; +1.000090179233604e-01   +4.009090724138026e-01   -2.752007385214555e-01   +1.609934404133751e-01   +3.452905849095690e-01   -3.854962891639614e-02   -2.861558400860758e-01   -2.008547050715664e-02   +5.836626258935164e-01   +9.548052690755343e-02   +1.326758549775256e-01   +1.370411404965305e-01   +3.854153554443385e-01   +2.490105619656927e-01   -3.920544623620958e-04   +1.526246585605023e-01; -1.816163875689694e-01   -4.531754543182371e-01   +3.199775610006512e-01   +7.985129598167384e-02   +1.844493892497022e-01   -2.530813168717965e-01   -1.039395408913981e-01   +2.209726338312281e-01   -3.241619973925911e-01   -4.521460156875445e-02   +6.058670135300756e-02   -1.550851285424910e-01   -2.937363012905683e-01   +1.058816185143617e-01   +1.576386938583043e-01   +1.741992819978611e-01; -1.469855119305001e-01   -2.057214897736273e-01   +3.424164071270151e-01   -9.540916630255766e-02   +2.870664438470940e-01   -4.583817932863751e-01   +2.345355851427515e-01   +1.321542377271944e-01   -7.573807737527383e-02   -5.038682246038306e-01   -1.111060457373857e-02   +2.351098113589468e-01   -2.598016570020567e-03   +2.140209659742773e-01   -2.288068107994173e-02   -2.448250678680104e-01];
L2I_L1I_iGABA_netcon = [-3.799628351157199e-01   -8.889312801450061e-02   +3.316674416936533e-01   -1.781357704029795e-01   +9.363457213707810e-02   +1.232620977411195e-01   -2.205311096862756e-01   +2.452304962890635e-01; +3.577307226639242e-01   +2.647904098056115e-01   -1.933431495780863e-01   -2.729472341821726e-01   -2.365639885166931e-01   -1.838711402671657e-01   +1.587054178740951e-01   -3.648924581315803e-01; +5.593212487593224e-02   -3.514440638274291e-01   -2.943071002958788e-01   +6.940546731768241e-02   +3.062714607091193e-01   +1.410996801346297e-01   +1.109771265670295e-01   -2.756744882025261e-01; -3.493569513737780e-01   +5.863409631806073e-02   -1.546679200268010e-02   +2.604201124072564e-01   -2.191429495751080e-01   +2.299412231879960e-01   -1.300416919954747e-02   +3.645550062535655e-02; +1.506813807463650e-01   -1.895630525370180e-01   +2.005065281974678e-01   -2.176323505969822e-01   +2.732310705328728e-01   -3.038325290076577e-01   -1.314974277645103e-01   -1.823707874032346e-01; -3.198845709919355e-01   +3.915090612017973e-01   +6.954049505043317e-02   -3.064434934835404e-01   +1.551662386895341e-02   +1.473835125780505e-02   -3.671619358804860e-01   -7.915731242994219e-02; -2.444444870716626e-01   -2.088935741742853e-01   -7.662426604244867e-02   +1.525426070641233e-01   -2.548286480727221e-01   +8.537985566512951e-02   -2.468574596320833e-02   +2.031362230256215e-01; -5.079388040162425e-02   -2.357842831358475e-02   -7.534876605411692e-02   +8.683691071082163e-02   -2.556241968085496e-01   +3.471133842809168e-01   -2.638168372001412e-01   -3.641904349296339e-02; -3.015931770354318e-01   +3.660967510225743e-02   -2.013498398874230e-01   +5.017174956242257e-02   +2.896786766356836e-03   -3.785352099611161e-01   +7.572554024995543e-02   +2.288232010167655e-01; -4.453628845890912e-01   +1.282251468338052e-01   -9.091870037961851e-02   -2.935065604040957e-02   +3.326194045613014e-01   -2.993865377729580e-01   +4.898212777095551e-02   -4.665235573312798e-01; +2.090860806498825e-01   -2.357860398127395e-01   -8.368494814417485e-02   +3.397153880962270e-01   +1.364247590389355e-01   +3.390900421935881e-01   +1.701827109601403e-01   +2.063497119289872e-01; -2.551494301825231e-01   +9.889929945240633e-02   +2.892338173018872e-01   +3.830284680159636e-01   -7.900382308998194e-02   -1.810972333596660e-01   +2.267023917226571e-01   +3.231227680968672e-02; +2.564521276545635e-01   +1.734525167715059e-01   -2.057025608903950e-01   +4.094968186773174e-01   +1.944527255034243e-01   -2.102636710796637e-01   -5.520296379556560e-01   +3.059146045358409e-02; -8.294497481180650e-02   -1.229181956784811e-01   +2.610573412783184e-01   +2.769813675618858e-01   +2.206528887390007e-01   -8.708211835281032e-03   +2.639192398373148e-01   -7.418222633219507e-02; +1.092815445683518e-01   -1.920291884825145e-01   -1.062861760432762e-01   +2.292347768288341e-02   +2.569345062747626e-01   +8.931662227311221e-02   -1.263660170080321e-01   +3.205704883468964e-01; +1.656446031478197e-01   -2.201580527783520e-01   +3.088868267204801e-01   +2.058504229604380e-02   +3.655588026586867e-02   +5.922029180797951e-02   +5.363674016660455e-02   +2.517878994507612e-02];
L1I_L2I_iGABA_netcon = [-7.337757479126156e-03   -2.965570465970899e-01   -1.938451959144530e-01   +5.267488324522390e-02   +8.740914490749502e-02   +2.895994638975981e-01   +4.235904321128157e-01   -6.427478680461210e-02   +1.395255434493480e-01   +4.046918459146148e-03   -1.100424686952232e-01   +1.335942056528464e-01   +3.761871798551281e-01   +3.775593328716680e-03   +2.531760391805423e-01   -5.528672411153691e-01; -4.988286448562661e-01   +3.640761043748372e-01   -4.053741467894353e-02   +6.114849741038000e-02   -1.702903654073551e-01   -2.715855961475384e-01   -1.573975721594578e-01   -3.783022504024790e-02   +3.577854321145590e-01   -3.595225308004366e-01   -4.736076716336041e-01   +5.081027080689029e-01   -4.487643368431055e-01   +1.871973921147777e-01   -4.164164299464280e-02   -6.696848338682182e-02; -2.252897680405672e-01   -2.958893019602266e-01   +3.429985459474610e-01   +7.451461896645011e-02   -1.172600806076285e-01   -9.099018592663480e-02   +1.227036501509585e-01   +2.128552332520875e-02   -4.460011418559394e-01   -2.959986052571661e-01   +2.938315205082819e-01   +1.336892361193449e-01   -4.952552993956281e-02   -1.620224508204577e-01   +3.755596406090753e-01   +2.160376897641320e-02; +1.193779167076349e-02   +4.794376346507540e-02   +2.650601795324312e-02   -1.499915458479423e-01   -7.805045721803466e-02   -1.255137013704357e-01   +1.819267706452219e-01   -6.746949017614953e-03   -7.849001597640710e-02   +2.108032871548270e-01   -7.584264653163200e-02   +3.208301361502456e-01   -1.305264020928307e-01   +9.750698567827758e-02   -2.498036331325457e-02   +3.780780753561297e-01; +4.441635435673144e-01   +5.228483933643567e-02   +3.130718845801498e-01   -1.088978196289061e-01   +3.083359195780394e-01   +7.297631331661851e-02   +3.643566576534387e-01   +1.986284940793504e-01   +1.409015587251700e-01   +7.129459949258207e-02   -2.129763081603756e-01   -1.988282150612681e-02   +1.151524198215596e-01   -2.400107269854457e-03   -1.818717283865771e-01   -4.116295319314937e-01; -3.295496561163955e-01   +4.258995505889833e-01   +4.601793804945362e-01   -4.029287396315954e-01   +1.772168087594791e-01   +1.222827076794773e-01   +3.561243907719751e-01   -2.663644531167836e-01   -3.832254530341449e-01   +4.651696738419697e-04   +2.826675197489726e-02   +1.429952145061460e-01   +8.894153866516219e-02   +1.510033097872969e-01   -2.066175122483156e-01   -1.670814925540663e-01; -3.431143708946995e-01   +1.847426458761793e-01   +2.853972309515309e-01   +1.146525069390773e-01   -2.749904485851382e-02   -4.052515298075304e-01   -4.107487828892630e-02   -1.787300892271425e-01   +1.117450250937210e-01   +1.017166182062557e-01   -1.285901716018321e-02   -2.275531352799920e-01   +1.015786578856587e-01   -4.614190001462635e-01   -2.878138079333454e-01   +3.877094874171204e-01; -4.233614439085275e-01   -2.173283491548116e-01   -2.573409177969765e-01   -6.677135348934013e-02   -7.345976151389606e-02   -3.565438728344655e-01   -7.674299714068994e-02   +8.268245443872675e-02   -4.697803477090220e-02   -4.087834279297453e-01   -8.379842350573485e-02   +4.716283966096462e-01   -2.585462272350090e-01   +3.265658362213679e-01   -1.228709465212631e-02   +5.829608834152229e-02];
L2E_L1E_iAMPA_netcon = [+9.945833752543079e-02   +4.529114127228195e-01   -1.176212585399422e-01   -3.092482329981966e-01   -2.935465667347573e-01   -1.192184561433317e-01   -2.213698378182709e-01   -3.266732026614757e-01; +8.549029425652829e-02   +2.150566701932086e-01   -3.404931481297410e-01   +2.489393655026559e-01   -1.952306136312323e-02   +2.821633910848404e-01   +5.388496127909498e-02   -2.494532386609021e-01; -4.813182211886481e-01   +3.890882057589585e-01   +3.175427712856241e-01   +8.803617193767793e-02   -4.194160600338478e-02   -1.105589178773341e-01   -3.651657251935144e-01   +4.434122538225488e-01; -3.795105241831295e-01   -2.550617762486340e-02   +2.048578021323631e-01   -3.925519617400373e-01   +6.164156146712865e-02   -1.750187307637673e-01   +3.675684703550429e-01   +2.739879115181070e-01; -2.141230752969399e-01   -4.073386437225798e-01   +1.575859314217053e-01   +1.749535303981261e-02   -1.014142447343805e-01   -3.633267996054093e-01   +3.497759424932289e-01   +3.006941185797829e-02; -2.041613786432714e-01   +3.074290865181351e-03   +1.124891438373473e-02   +6.529995516318626e-02   -1.362447238847052e-01   -2.046535781214799e-01   -1.607334600237896e-01   +3.623891934233216e-01; +3.084293794442782e-01   +5.252485130371473e-02   -1.820642667006098e-01   +6.662033979661947e-02   +3.373076216613510e-01   -1.503569396264924e-01   -2.781608999890213e-01   -3.206037945392993e-01; +6.105287621069260e-02   -1.318898418591123e-01   -9.517352661474358e-03   -7.701786917687886e-02   +4.719326126695295e-01   +7.857665482824250e-02   +5.205650164167688e-02   -1.584424680963786e-01; -1.291543105399193e-01   +6.222248771125030e-02   -1.720244660571574e-02   -4.276123242468441e-02   +1.871960801264053e-01   -2.899711957100424e-01   +4.472556844753472e-01   -2.935217943503250e-01; +2.577243854808302e-01   -1.710174221941181e-01   +9.097805566847736e-02   -4.874563750079386e-02   -3.144272294592612e-01   +1.309156558951423e-01   +2.877266517284027e-01   -3.540343261661084e-01; -1.928041810864015e-02   +1.164597774143000e-01   +2.391160543340123e-01   -4.631527133607834e-02   -2.867149689272628e-01   +1.107702130905711e-01   -6.608622773400960e-02   +1.893879906053896e-01; +2.311390559781380e-01   -4.012247230884726e-01   +9.425780195236610e-02   -3.626852293328755e-01   -2.238668498824541e-01   +1.996597069503956e-01   -3.677527858259406e-01   -5.856961650317000e-02; +2.935617291654555e-02   -2.670891749445570e-01   -3.053822347157090e-02   +4.286415585164621e-01   -1.493387329581764e-01   +9.901604032822449e-02   -2.870711084845289e-01   -2.008851899603195e-01; +1.613243069211505e-01   -2.656351622262360e-02   -4.230806786592234e-01   -4.448892813838932e-01   +2.227218021366060e-01   +7.536774450481748e-02   -2.520380585542750e-02   +2.303771324132252e-02; -3.402558785638113e-01   +1.447081707038187e-01   +2.078395430107295e-01   +1.857191207946847e-01   +4.219135845673602e-01   -3.084039134635125e-01   +3.286151165260112e-01   +8.418026662949450e-02; -6.547797884732583e-02   +1.915656976272662e-01   -3.792820520893384e-02   -3.238068731767954e-01   +7.218636404709930e-02   +1.428238505837236e-01   +8.716582161383624e-02   -4.158974620661576e-01];
L1E_L2E_iAMPA_netcon = [-3.936180910429118e-02   +2.175721498105425e-01   +2.048348174923499e-01   -1.942166850904784e-01   +5.686767088622693e-02   -1.896837763852119e-01   -2.568388114071758e-01   -2.281328050703220e-01   -5.266415788607345e-01   +7.529049431040869e-03   +1.429621755479006e-02   +1.982524561133376e-01   -3.275029076273330e-01   +2.570494789865365e-01   +8.515049302849836e-02   -4.431367896946176e-02; +1.653914941088519e-03   +3.591737124637672e-01   +1.329976401285524e-01   +1.441296613361850e-01   -3.873254751655213e-02   +6.187650205321728e-02   +1.594328352383825e-01   -9.208962038402405e-02   -2.215672394713836e-01   -5.040807804774312e-02   -3.628179742699827e-01   -1.451577791463851e-02   +6.862509491175406e-02   -5.621132233976707e-01   -1.820659607725678e-01   +1.099498165111989e-01; -1.541649458567890e-01   +2.443290905592627e-02   +1.592910511922395e-01   -2.853253846920011e-01   +2.272173657316300e-01   +1.918097680446022e-01   -7.233234233193447e-02   -3.201003405470061e-01   +3.613049555417866e-02   -3.117665454622902e-01   -1.380244899611446e-01   +1.583328693693035e-01   -2.483225988809982e-01   -6.658428529342217e-02   -1.421134800410583e-01   +2.245078940414214e-01; +8.612430887578473e-02   +3.014524849667972e-01   -1.273052508362405e-01   +1.829763585801058e-01   +6.818258138311177e-02   +8.076038149366609e-02   +3.358201764137589e-02   +1.306647133934802e-01   +2.203879157150470e-01   +2.155864571006824e-01   +3.868233976176445e-01   -3.935750002180625e-01   +1.221291045836118e-01   +1.449133747109277e-02   -2.681055515132808e-01   +8.591790691115023e-02; -2.088119798659005e-02   -3.002684254228644e-01   -1.881704403976473e-01   +5.605077332831612e-02   -1.977386695636876e-01   +1.079839202438556e-01   -1.830341436304890e-01   +3.260349223342408e-02   -2.320887365356906e-01   -2.633507983180096e-01   -2.003025622291483e-01   -2.113538412088865e-01   -7.610468345748217e-02   -9.241006795857679e-02   +5.255238717719312e-01   -3.388364661792348e-03; -5.130294952476058e-01   -1.704004734518477e-02   +4.396582818199282e-01   -4.202915325673738e-01   +2.788792485943792e-01   +1.725360952770043e-01   +2.321904397253571e-01   +6.280311131344674e-02   -1.271781581627664e-01   +8.890308864218380e-02   +6.320807440501594e-02   +3.017414644391047e-01   -1.165188822616446e-01   +4.349699511618480e-01   -4.329902247080042e-02   +3.740497633477707e-02; -8.796600811446940e-02   -2.884845156734889e-01   +3.564328567605209e-01   -1.080375735275227e-01   -1.402269399133624e-01   -8.293024759118695e-04   -3.271696588127621e-01   +6.499103757107721e-02   -1.867870913355173e-01   +3.660155865740947e-01   +1.559664634406806e-01   +2.983101063140515e-01   -1.928724464605469e-01   -9.303598571031176e-02   -8.858958965740515e-02   +1.406213658440796e-01; +1.163583294789067e-01   +3.168681098260706e-01   +6.811991227256121e-02   -7.609951023864811e-02   -2.724737138345193e-02   -1.611188111945256e-01   +3.117491818271676e-01   +1.702209856401432e-01   -8.466011879863974e-02   -2.653155158360997e-01   +1.149488631507669e-01   -7.654396438814275e-02   +2.446357133405008e-02   -4.268320186185206e-01   -2.318144330398984e-01   -2.267805601343462e-01];
L2I_L2E_iAMPA_netcon = [+4.364984910173124e-01   +2.312066243918514e-01   -1.408037754747922e-01   -1.378405881810798e-02   -3.459353189676637e-02   -2.488961066460275e-01   +1.192059896667722e-01   -8.084486300081038e-02; -8.277264650073303e-02   +1.722102028151795e-01   -3.090870579079761e-01   +1.651829014664862e-01   -2.199299428765583e-01   +3.266888762986854e-02   -1.038062707838183e-02   +2.691933425399216e-01; +1.506826567866548e-01   -1.294867867030785e-01   +1.119275535190872e-01   +4.639439304334532e-01   -5.710354470659920e-02   +4.959406900625940e-02   +3.462664860273549e-01   +2.343779546624077e-01; -1.851146233798470e-01   +1.571049075166699e-01   -1.481288888525156e-02   -2.248079540542132e-01   +1.589712648871441e-02   -1.104708380351355e-02   +2.157285831936029e-04   -3.322107581373761e-01; -1.888152709260639e-01   -1.653727977695876e-01   +8.982354574484273e-02   -1.220023805101375e-02   +1.118905397084892e-01   -1.171342804093098e-01   -1.602262756955789e-01   +1.199359435427808e-01; +5.579104333993560e-03   +2.640676746623991e-01   +7.412885303949043e-02   +8.051980892669280e-02   -3.344016431293018e-01   +4.868712287672326e-02   +4.018093271091350e-01   -2.155970711882112e-01; -3.699469479783119e-01   +3.468605247069828e-01   +1.559734027346029e-01   -3.308862533665484e-02   -1.291037962746104e-01   +1.185970021617794e-01   -1.813064145858593e-01   +1.506123942235843e-01; +2.405109982913383e-01   -3.735291941865845e-02   -1.779705112340252e-01   -5.453719748828092e-01   -6.046118817824881e-01   +3.947741016606590e-02   +3.997887287546283e-02   +3.145997798872332e-01];
L2E_L2I_iGABA_netcon = [-6.617468206476734e-02   -1.149095767473026e-01   -3.702643566033553e-01   +1.261560543900048e-01   +1.647915241489098e-01   -1.257145501605421e-01   -1.326944732958188e-01   -2.926237446615884e-01; -1.446900287259708e-01   +2.560053167397174e-01   -5.529650750589624e-02   +2.161394469040579e-01   +3.303857883479528e-01   -1.687406077995445e-01   +2.707739246392216e-02   +5.177924403762725e-01; +5.002983441950520e-03   +1.154842942951889e-01   +2.607929689823186e-01   -2.440629933237598e-01   -7.266304240271915e-02   -9.100721376977541e-02   -4.382632792008363e-02   +2.680898394436178e-01; -2.219861808225779e-01   -2.129512991747411e-01   -1.826006614949976e-01   -1.959164067541892e-01   -2.208203710064956e-01   +2.961370689554473e-01   +4.919086961019695e-01   +2.835836173511465e-01; +2.368968877786740e-01   -3.194438576528307e-01   +6.656735571472921e-04   -1.538485044778574e-01   +9.409246781038230e-02   -2.659535178853252e-01   +7.916545958868411e-02   +6.993404326631078e-02; +1.847670662447975e-01   -3.167336904521957e-01   -2.859621643721391e-02   -2.844191859554374e-01   +1.743369828184319e-01   +5.167571494149350e-01   +2.363749900759735e-01   -2.800869306475489e-01; +2.352400694599542e-02   +3.917468523979657e-01   -2.581707554611817e-01   +2.681904441799515e-02   +1.714666842214383e-01   +9.264645043160856e-02   -3.591938361986876e-01   +1.239144588801342e-01; -2.014722781180835e-01   +7.174986328763502e-02   +2.944846633535866e-01   -2.765143147004929e-01   +3.649297514427458e-01   -3.436774751105612e-01   +1.185673037591814e-01   +4.027767267040893e-01];
L3E_L2E_iAMPA_netcon = [+5.312474290016357e-02   -1.969813520757204e-01   +2.164089096978699e-01   +1.983158294859131e-01   +2.633392532378475e-01   -1.357022206620329e-01   +3.105493485438567e-01   -4.619478832946600e-01   -8.341738214433002e-02   +2.066278396230210e-01   +6.198423908205537e-02   +2.326988074318072e-01; -2.668229089534280e-01   -4.915397185410840e-01   -1.482371642653973e-01   +3.813862167332737e-01   -2.873001170725532e-01   +3.661966701119618e-01   +1.347878232276943e-01   -1.976513769732305e-01   -1.368093507544457e-01   +4.007548028224988e-01   -3.365385419705701e-02   -3.318498447712175e-01; -1.925085336119549e-01   -1.312323524389594e-01   -4.247835580746893e-01   +3.355790007912240e-01   -5.185313038407078e-01   -3.391304838697550e-01   -2.758532531586285e-01   -3.335470476132587e-01   +1.242082172552219e-01   -3.752649291493790e-01   -2.518708080778692e-01   -3.035572154966750e-01; +3.693513358292479e-01   -3.197941571746216e-02   +2.530801998593812e-01   +1.667023774409854e-01   +1.472995955669343e-01   -2.312523088902952e-01   -4.185789638275730e-02   -1.170072270494937e-01   -1.515781346138856e-01   -2.635665685228505e-01   -8.579175170380107e-03   +1.663787098981154e-01; +1.996241495635835e-01   -2.111289885479359e-01   -2.925908889189615e-01   -1.050158953711795e-02   +2.031356384984845e-01   +3.602735711132529e-01   +4.907324288457315e-01   +4.047005555049234e-02   -3.158365179712550e-02   +7.010002613682526e-02   -1.066757341858841e-01   +3.727642256577800e-01; -1.298277593345821e-01   +4.217040894725069e-01   -3.130152397579123e-01   -7.306681931285536e-02   +8.042366743321752e-02   -1.005787167440558e-01   +4.336767296359877e-01   -1.355672749412872e-01   -2.280396813040125e-01   +4.332197052242757e-01   -2.644854059748435e-01   +3.282337195342322e-01; +3.431237535122682e-01   -3.209319232593510e-02   +7.370239863536121e-02   -3.579471503218714e-01   -2.924236897678813e-01   -1.899756416396046e-01   +5.376595554113048e-02   -2.305226391297018e-02   +2.082357831016362e-01   +2.327915818247133e-01   -4.054709712553738e-01   -1.613847487340684e-01; -3.539935947475899e-01   -3.237353759099787e-01   -1.999198814076935e-01   -4.167424755241109e-01   -3.653177936238833e-01   +3.585309300829697e-02   +2.108591032079759e-01   -2.510760927002106e-02   -1.266749479989375e-01   -3.864240294569689e-01   -2.479893190247883e-01   +2.951843668538129e-01];
L3I_L2I_iGABA_netcon = [+1.811245474873527e-01   -4.246783477365984e-01   +1.186770928816720e-01   -4.746653403740151e-01   +2.596309487823586e-01   +1.678655694276702e-01   +6.844541887339993e-02   -4.367327525216097e-01   +4.123103243620564e-03   -3.894999425657831e-01   -8.919895035389555e-02   +3.143873947024984e-01; +4.650233222551837e-01   +2.107445917664864e-02   -2.583281597351948e-02   +3.442800573190574e-03   +4.003008583905655e-01   +4.595274367715550e-01   -2.874247522860486e-01   +1.647704343513149e-01   +1.670325587113357e-01   +3.519019162437700e-01   +1.175681060628952e-01   +2.905694202079541e-01; +3.165057606001356e-01   +7.272204143182109e-02   +3.160598023637545e-01   +2.209016438108480e-01   +1.262086072873248e-01   -2.901745126933947e-03   +7.449830591942265e-02   -2.217307124840437e-01   +1.019948433033817e-01   -2.814055447098673e-01   -1.225786107419512e-01   -3.468555152253597e-01; +4.837515141804888e-01   -3.534656394023689e-01   +3.921911418920236e-01   -1.748176106720646e-01   +3.165648559634154e-01   -2.283488416490351e-02   -3.537362803827502e-01   -3.704691344473712e-01   +2.177323353229291e-01   -2.140922570964351e-02   +1.325353638284646e-01   -6.305962303868495e-01; +1.985640380579542e-01   +8.883114089219235e-02   -8.499050773776025e-02   +1.934117185182422e-01   +1.580843996528623e-01   -3.174492192145472e-01   -1.149679948496750e-01   +9.144516168634499e-02   +3.942090038668965e-01   +2.400540901632187e-01   -2.954139861185936e-01   +2.210979248655909e-01; -1.579427923591767e-01   -1.953507662193659e-01   -4.119453999114298e-01   +1.631539615703038e-01   +2.962753604134788e-01   -1.692505193502586e-01   -7.273595616631121e-02   -4.029709074731593e-01   -2.681022267075715e-01   -1.884153380951647e-01   -3.582212976769663e-01   -2.732347767780820e-01; +2.728572681789580e-02   +2.444067060011926e-01   +3.110276375191009e-02   +1.082253415381985e-01   -1.334741556324113e-01   -5.019830588585400e-01   -1.778791029076281e-01   +4.741348161965555e-01   +1.555795921310266e-01   +5.065655134801732e-02   -4.148883164687700e-04   -3.046173608456279e-02; +5.822273467974364e-01   -3.596941463558839e-01   +2.241642195021833e-02   -3.291449714841078e-01   -8.162201243832752e-02   +1.633626383996281e-01   -3.116775809542496e-01   +3.625332041996839e-01   +1.503781989397084e-02   +2.466945363840951e-02   -3.551278167473898e-01   -2.029862433704059e-01];
L2E_L3E_iAMPA_netcon = [+2.442350466196389e-01   +1.346446617697880e-01   +7.976515238442883e-02   -9.497815191900350e-04   +4.334176119132860e-01   +3.582382467965114e-01   -3.292058655798326e-01   +3.249751922446288e-01; -1.155630421407543e-01   -2.312306230031974e-01   +6.967278563515698e-02   +1.234063499631706e-01   +3.901799195500638e-01   +2.312472316195722e-01   -2.823920613001976e-01   +4.147957893786237e-01; +1.404692173320527e-01   +2.910496794453497e-01   +1.098807250600244e-02   +1.586547180226560e-01   -1.345601162052054e-01   +2.478489019648963e-02   +2.095805594844453e-01   -4.736158133831816e-01; +1.298744112027932e-01   +3.171376825704249e-01   +1.822294163000725e-01   +1.785457211109149e-01   +2.161430880589020e-01   -4.281301755682893e-01   -2.539984025342093e-01   +1.443876706928059e-01; -2.885783563571787e-01   +3.597916137632279e-01   +3.444006320138741e-01   -4.511681469492795e-01   +2.436640105646205e-01   -7.279748648214937e-02   -3.308133150776899e-02   -1.576143961245929e-01; +3.614616494992290e-01   +2.300953422430543e-02   +7.358504705166494e-02   -4.728280076635460e-01   +1.937979170343341e-01   +2.997152141239162e-01   +2.830939420558837e-01   -1.350185119423548e-01; +1.530908609799881e-01   -5.484101929649107e-02   -2.490643031724976e-01   +2.186698412212995e-01   -1.333421936111836e-01   +2.036082028518983e-01   -3.851097140732656e-01   +2.169051967469877e-02; +2.561428209648197e-01   +2.905327756150396e-01   -4.912397157838035e-01   +3.342353672454303e-01   +6.299549607087486e-02   +3.999333436388176e-01   +7.731299109662852e-02   +1.450688102165508e-01; +3.566912220866471e-01   +5.554868085901494e-01   +2.721001016642348e-01   -1.587070987263147e-01   -1.690988778406255e-01   +2.451098858147095e-01   -1.791882023290199e-01   +2.658461074473094e-01; +1.041200213945843e-01   -3.931920651901790e-01   +2.238175976479259e-01   -2.960245754546055e-01   +2.045649722853196e-01   -1.185820691228869e-01   +1.690166182614274e-01   +2.647686045210999e-01; +7.704532288486300e-02   +1.725820048090459e-01   +9.426585382177596e-02   -1.612006365462438e-01   -2.320030593287663e-01   -2.116624821992130e-01   +2.582654652975726e-01   -6.225385309322196e-02; +1.630512026531529e-01   -3.761708635666743e-01   -9.143038401564341e-02   -3.050670001002684e-01   -9.697375170165667e-03   -1.820606883402743e-01   -1.264795019549366e-01   -4.372332916436650e-02];
L2I_L3I_iGABA_netcon = [-4.161817511398434e-01   +1.388173839975625e-01   -2.147261263193830e-01   -7.971980688966145e-02   +2.179166267659882e-01   +1.247896078485866e-01   +3.725303963174997e-01   -2.127032668054096e-01; -2.038114579291740e-01   -2.801805005336335e-01   +1.281923765886131e-01   -3.389717320481976e-01   +1.311738195326023e-01   -7.961433406743285e-02   -2.741690611297845e-01   -2.409750825503663e-01; -5.525412633571108e-02   -1.454578812056085e-01   +3.199381818496768e-01   +4.014780105575561e-01   +1.214124054960559e-01   -3.345106362699714e-01   -2.178724815716996e-01   +3.265285093103160e-02; +1.805971558718426e-01   +1.670139320695904e-01   +5.261433863082626e-02   -1.115899431458420e-01   +3.609078371617260e-01   -7.515961836877236e-02   +3.800921426404251e-01   -3.517306417875697e-01; -2.282356889120615e-02   +3.289486908147733e-01   -4.263050055220763e-02   +2.869060999929979e-01   -7.079039098625947e-02   +4.023125772736344e-01   +5.414513464242141e-01   -2.753252775415059e-01; +3.093642951188591e-02   -2.078341602036712e-01   +3.800477766722379e-01   -1.953114065429009e-01   +2.679688267128804e-01   +1.490820932515927e-01   -2.154220900531407e-01   +2.706573244716854e-01; +1.376322571352752e-01   -8.827402759925210e-02   -3.693399149787032e-01   -2.097850732076844e-01   -4.674126221376219e-01   -4.873047532644378e-03   +2.429864018941190e-01   -3.015889363846266e-01; -1.395503243700154e-01   -4.307906387012754e-01   -1.767153560331475e-01   +5.153911685943036e-03   -1.677120099721383e-01   +2.868529641186147e-01   +1.754832638366352e-01   -1.245358052225920e-01; +2.667408368830877e-01   -1.814049523774980e-02   +4.137228892362664e-01   +7.164112867571568e-02   -1.452126530946065e-01   -2.469006919339974e-01   +2.334122968179108e-01   -1.352793286372540e-02; -3.675504995097655e-01   -2.194208745993529e-01   +2.260303624894828e-01   +1.129731825188489e-01   -1.776566257294629e-02   -1.473948751535270e-02   +2.699447530325780e-01   -4.729514801876118e-02; -2.581330321460519e-01   +1.039775928706521e-01   +7.258160040164013e-02   +1.946909533816051e-01   +3.791731811696041e-01   -1.689049452654020e-01   +5.759129121805749e-01   -4.234172288761247e-02; -2.254314101138050e-02   +2.205877960165732e-01   +1.430366282860684e-01   +1.302301300174521e-01   -2.716882024468794e-01   +1.073520156654446e-01   +1.613649054791313e-02   -2.695208260432064e-01];
L3I_L3E_iAMPA_netcon = [-4.633984297105847e-02   +4.192269830081574e-01   -1.312414184985378e-01   +2.871157476520031e-02   -3.168989448362274e-02   +2.173111832358050e-02   -2.880414638588131e-01   +2.846909510824810e-01   +7.005864717207998e-02   +5.331496962896913e-01   +8.300055857856102e-02   -2.651417800387837e-02; +1.223960248380843e-01   -4.363631577721539e-01   -2.497494664863891e-01   -4.477252069632622e-01   -3.030002782559240e-01   -3.295533421391225e-01   +9.377753054739513e-02   +2.556645649127874e-01   +2.212876845829985e-03   -3.983961228434520e-01   -1.049966384375545e-03   +6.201359201382291e-02; -2.662529393318525e-01   -1.314111244671586e-01   -5.228313245060562e-01   -9.553615929764507e-02   +2.366420088397763e-01   -1.808550311112186e-01   -2.259265427071454e-01   -1.036587615693913e-01   -3.561197623866891e-01   -1.350623728964438e-01   -8.597497781790174e-02   -1.109120138910901e-02; -2.135016535763026e-01   -1.559852803248094e-02   +1.702990691650077e-01   +4.297609245020675e-01   +1.477627655307950e-01   +5.315936219012846e-02   -2.855082201432627e-01   +1.826171126124379e-01   -3.219502913740432e-01   +1.967015909624411e-01   -4.690925805195952e-01   +1.131238898319856e-02; +2.000209919534044e-01   -5.564049161752604e-02   -3.745090874349868e-01   -1.410271010528446e-01   -5.490207423388547e-01   -4.810450229195602e-02   -2.478749895198154e-01   -4.689448694084134e-01   +1.776085592220469e-01   +1.891163816193622e-02   -5.267249622862915e-01   -1.044978397365388e-01; +3.664958142254758e-01   -1.523040902015282e-01   -9.286389486542861e-03   +3.031773627435520e-01   +1.301470131830579e-01   +1.111577946003898e-01   -1.324178838020875e-01   +2.086917669753163e-01   -8.785447622698773e-02   -3.028314425864104e-01   +9.080496547399711e-02   +4.642741858158135e-01; -4.119010344902220e-01   +1.799685808595081e-01   -1.382422734527868e-01   -8.804807609690185e-03   +4.161700946313402e-01   -5.847848538565906e-02   +1.314105674033165e-01   -7.056259086274440e-02   +5.071712436607154e-01   -1.230618619565200e-01   +2.409547446849939e-01   -4.761721166193530e-02; -3.304052263321204e-01   -1.468858111725714e-02   -9.151682433294350e-02   +9.295856092133292e-02   -2.941666970616875e-01   +2.577520497450532e-01   -5.768392457254154e-02   -3.360963310352972e-01   -3.464543939329311e-01   -6.382543668986623e-02   -3.813731413994828e-01   -5.105197168922855e-01; -1.816737948893606e-01   +2.237231053386882e-01   -1.197481044508185e-01   -2.865018684550010e-01   +3.907622870632664e-01   -1.100818431794748e-02   +1.206988234609280e-01   +2.130098814154516e-01   -9.325603289999734e-02   -9.492841445471803e-02   -1.719782028619633e-01   +1.219482864428073e-01; +9.790370275863092e-02   +2.670316949977199e-01   -1.359926907168610e-01   -2.088673348733973e-01   +9.630408886093909e-02   +7.203941721057128e-02   +3.148035995169835e-01   -1.303235112539843e-01   -3.818135857401969e-03   +3.785759840854481e-01   -2.878332101612948e-01   -1.622818575203043e-01; -2.523982023664961e-01   -4.237811026742004e-01   +3.227961287293299e-01   -9.910876144658136e-02   -1.589872861608504e-02   -2.003290471731146e-01   -1.428229925668554e-01   +2.726622048481863e-01   -1.764521511358328e-01   +2.747650450853158e-01   -3.727476802115992e-01   +9.110229408470374e-02; -1.823028407950906e-01   +4.597249129875376e-02   -2.608394261429495e-01   -2.013072840484388e-01   +6.105766783625501e-01   -2.312650943482565e-01   -1.057430920537852e-01   +3.623861006571464e-01   +3.206556021480823e-01   -1.969103922871409e-01   +3.360273275452574e-02   +5.229697150576784e-01];
L3E_L3I_iGABA_netcon = [+2.413633591889537e-01   +1.335654791753771e-01   +2.087563915005477e-02   +1.863944983668390e-01   +3.488477989374320e-01   +1.306842712317275e-01   -2.344263399594567e-01   +3.089004323265884e-01   -1.023042092145684e-01   -1.699714590199170e-01   +8.900498907347562e-02   +1.015664527804951e-01; +1.523196325146605e-01   +4.649558560356714e-01   +3.918405371867507e-01   -1.373972675600930e-01   -2.682091316822220e-01   +2.764784371164954e-01   +2.058340186817963e-01   -8.775099390593810e-02   -2.640337362404281e-01   +1.268765480685802e-01   -1.225726394923594e-01   +7.023177022379964e-02; -6.929999775835194e-03   -3.577726133109974e-01   -7.361882201589642e-02   +1.210277274780809e-01   +3.025475535129075e-01   -1.015860139634241e-01   -1.372597262148213e-01   -1.567188358170792e-01   +1.659437783751154e-01   +3.020233158566537e-01   -4.162918041375397e-02   -2.648779988830476e-02; +2.147979250649304e-01   +7.280576726139250e-02   -6.195700346729502e-02   -4.380206067975814e-02   -3.409256987116388e-01   +4.553737157730489e-01   -1.142610074710392e-01   +2.333008349471325e-01   -4.101991417619222e-01   -1.616272368313599e-01   -3.097394523739508e-01   +1.790428391111714e-01; +6.453468906206677e-02   -4.657764220015570e-02   +9.321307060965274e-02   -2.464334682915360e-01   -3.258760319641205e-01   -1.439634416737887e-01   +7.219069028390428e-02   +3.953047294351171e-02   +2.755162557013661e-01   -4.559827444883864e-01   -1.620509977499535e-02   -4.660814822229352e-01; -1.171747428137582e-01   -3.934455160449650e-01   +6.013096440910012e-02   -2.095682071069877e-01   -1.862783723917020e-01   -5.526878605229017e-02   -2.940156708427874e-02   -2.517767419102874e-01   -2.621326353899446e-01   -6.016968501927520e-01   +2.723503046967580e-01   -1.804243291354006e-01; +1.644590238956209e-01   +2.194007969768587e-01   +1.239406721969394e-01   +1.247418857093867e-01   -2.544048553114718e-01   +8.505899153700358e-02   -8.460182525720628e-02   +4.431129355214349e-01   +5.052748914315752e-02   +1.509666190152396e-01   +2.909347586824080e-01   -4.127678564053665e-01; +3.157114102464903e-02   -8.197399687543105e-02   +4.256342557960011e-01   -3.587302743717725e-02   -2.791405716686232e-01   -1.941088808237580e-02   -2.827646651282191e-02   +5.383668641584671e-01   -1.667076686115946e-01   -9.586354534007084e-02   -2.570297155308568e-02   +7.073125849519052e-02; -2.088907772141187e-02   +3.142307762956193e-01   -4.345233464966116e-01   -4.191301445750325e-02   +4.771165420334664e-02   +4.911738165748721e-01   +2.294828936874576e-01   +2.541810028316469e-01   -2.870925884909878e-01   +2.181710352600075e-01   -3.449600903215766e-01   +1.592839222461988e-01; +3.178421177878664e-01   -9.778220977557160e-02   +2.717040158276677e-01   +3.458226796483319e-01   +2.559747114883713e-01   +1.109467537410676e-01   +4.324731837419753e-01   +4.145748654633848e-01   -3.480903106464572e-01   -2.620922060160790e-01   -1.032659242690599e-01   -2.620371900355224e-01; +1.300094052857608e-01   +1.648440575075479e-01   -1.076591924800487e-01   +1.393792324634663e-01   +4.599061865114138e-03   -6.381715621364641e-02   +3.799805041451249e-02   +4.110350302074425e-01   +4.132760287388272e-01   -9.934186812412688e-02   +1.747332423196456e-01   -2.721986867764054e-01; +2.526180799358415e-01   -1.815684429281068e-01   -3.846019271893294e-01   +1.625874071017966e-01   +2.450040324415678e-01   +8.241166040980547e-03   +3.240108164245443e-01   -2.420830811361379e-01   -5.014331283081211e-01   -7.052661722555145e-02   -6.862549105836838e-02   -6.504063799914728e-02];
L2E_Input1_iAMPA_netcon = [-3.000566482798613e-01   -1.997660645344324e-02   +1.257219836056573e-01   -6.009308627296490e-02   +2.646345838761358e-01   +2.476365643136182e-01   +2.472098470270603e-01   -2.309890420779486e-01];
L2I_Input2_iAMPA_netcon = [-1.280493245480697e-01   +5.544046494311325e-03   +2.308722150202211e-01   +4.293573417980799e-02   +4.515547896868780e-02   -4.022441077559442e-01   +2.641757578610242e-01   +1.132004660482017e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
