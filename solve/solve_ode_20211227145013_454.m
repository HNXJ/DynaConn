function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.115371789797540e-02   +3.579655022899093e-03   +2.474577480188381e-02   -1.803272888567109e-02   -1.906089844908933e-02   +9.053282309931568e-03   +3.800907390014900e-03   -1.287520790215553e-02   +3.004313295514882e-02   -9.999064437905292e-03   +4.960633597456303e-02   +5.301900334154165e-02   +3.403686102800460e-02   -6.279629097044441e-02   -1.630379904059280e-02   +5.289303181834167e-03; -6.280051245529767e-03   +5.032968434951017e-03   +3.531255597269106e-02   +5.648117216335853e-02   +3.905538441447869e-02   +2.318593167221104e-02   -2.650480564044563e-02   +5.708020290937755e-03   -6.028287661517416e-03   -1.411890217913258e-02   -4.821738187963670e-03   +2.915854950209100e-02   +8.836242418648676e-03   -2.327470413231212e-02   +3.958132613641433e-02   +2.873461962342688e-02; +3.877387432684574e-02   -2.439856384976108e-02   +2.977394586875056e-03   +4.839360719837627e-02   +3.809158554136355e-02   -8.135742646149698e-06   -3.275420058841968e-02   -4.338861320784397e-02   -8.027871512515317e-02   +4.985924061008758e-02   +5.301989452927103e-02   -6.324968935893273e-02   +5.799305954457512e-03   -8.140534644349908e-03   +6.277708547444373e-02   +2.853436598851992e-02; +5.397937651691466e-02   +5.668592586008814e-03   +1.187850874880687e-02   +2.879663182133858e-02   +2.694381547628247e-02   -2.279633227289000e-02   -2.393262943041245e-02   +1.139368601705785e-03   +3.284096270342454e-03   -8.564955074761393e-02   +3.479958458015414e-02   +4.543456899385762e-02   -8.422284365539101e-03   +2.346393406908842e-02   +1.225522433690312e-02   +6.899651963930740e-02; +2.185582569879442e-02   +6.607452164973347e-04   +1.159015615399735e-02   +8.798885421961895e-03   -7.121069194297151e-02   +5.196905188607400e-02   +1.215445671160811e-02   +9.204741688773049e-02   +1.962502692130576e-02   +2.622562666108610e-02   -7.251212458766207e-03   -5.356924053643616e-02   -1.604338303603701e-02   +2.885207642415383e-02   -4.716909534541571e-02   -9.862463307786359e-03; -5.789085973208789e-02   -2.831270516788929e-02   +6.329715027736538e-02   -2.005824271054248e-02   +4.079772855687071e-02   +1.837921921583201e-02   +6.549650633268606e-02   -4.934732108816828e-02   -2.261588850703753e-02   -7.785055913382504e-04   +3.915664049889861e-03   -2.362046731830967e-02   +3.918957605494823e-02   +2.920868983387924e-03   -6.423566869604982e-02   -1.292579012293454e-02; -2.702246824830550e-02   +4.659397814394022e-02   +5.072693103922764e-04   -4.568115030404019e-02   +7.312582454213415e-04   -1.234266648545046e-02   -1.466473595526899e-02   -2.115528445372650e-02   -2.504860868598631e-02   -4.934229374569519e-02   -2.193363170903350e-02   +2.281790098664355e-02   +1.764073461229367e-02   +1.355683319723145e-02   -1.595228498492272e-02   +4.941929849885671e-02; +7.652157387296529e-02   -7.807943628901880e-04   +1.525195153713814e-02   -6.863195227715145e-02   -5.664399489273719e-02   +1.229120383904424e-02   +3.986686333404543e-02   +2.552877565125478e-02   -9.141083753100462e-02   -3.674152782786258e-02   +8.643871034538279e-02   -1.471913336944064e-02   +3.653400669798513e-02   +3.543228827762087e-03   +4.250887676786266e-02   -5.912501814560355e-03; -9.677774135565365e-02   +1.076735149467667e-02   -8.726270822791691e-04   -2.493977022093481e-02   -2.462164261205263e-02   +6.009499540946595e-02   +1.542843177040615e-02   -3.815832336646409e-02   -9.615290304446324e-02   -1.644291544427405e-02   +3.057986230983455e-02   -1.480410113057129e-02   +4.820175394233435e-02   +3.732834747715410e-02   -5.019150326809501e-03   +8.435190566677617e-03; +6.860688835261727e-03   -1.539088760845157e-02   +3.880349865296705e-03   +1.023116978616522e-03   -3.982654453586956e-03   +2.700911884277454e-02   +4.538311934900768e-02   -6.745318003634242e-02   +3.823639427197031e-02   -1.891550378597516e-02   -2.608010690937287e-03   -1.230201975158193e-02   +2.499425158302023e-02   +4.868601620406059e-02   -2.886524530289085e-02   -1.534732729384594e-02; +4.383133104715713e-02   +2.333039190974176e-02   +1.037001608343061e-02   +1.064107862615950e-02   -1.142473476938816e-02   +8.995841962232834e-02   +1.313584701108619e-03   +2.741132299460940e-02   +6.681239090811348e-03   +1.376218577901062e-02   +5.648140585694266e-02   +4.221553444321693e-02   -1.335629568860641e-02   -2.236013756859364e-02   -4.671052376019009e-02   -2.379477740939516e-02; -3.751872015419785e-02   -7.006742540583286e-02   -3.614705689612255e-02   +1.605897808896518e-02   -7.946573940949163e-03   +5.041945191312980e-03   +9.090904616656523e-03   +1.188647353957929e-02   -3.289547368396865e-02   -1.824273970479989e-02   +1.881872332747618e-02   -3.485703799460457e-02   +1.157985552048302e-02   +1.263943175555933e-02   +2.516150919276010e-02   -4.705149074250595e-02; +8.261488693935497e-03   -4.869127060206263e-02   +2.307781904106427e-03   +2.030556119288072e-02   +2.159337865514500e-02   -1.707172269027850e-02   -3.162019494918321e-02   -1.358680786916750e-02   +1.045328326932516e-01   -6.442652114640621e-02   -6.660608098886887e-02   +1.945694660406969e-02   +2.827350462889659e-02   +5.342705912698038e-02   +2.596237686496355e-02   +2.161043865206653e-02; +3.793709455776251e-03   +3.493314911936810e-02   +1.141319334353613e-02   -6.338172013255650e-02   +3.344817351461113e-02   -5.608097010341674e-02   +1.526112824722062e-02   -2.232380617485030e-03   +1.828958181177174e-02   +3.391389327814178e-02   -2.701377284303786e-02   -2.979436236415766e-02   -1.730001466214510e-03   -7.480340007560767e-03   +2.491963063097899e-02   -2.360982830599831e-02; +5.547768125678644e-03   +1.216420153518111e-02   +1.925905414600287e-02   -7.794712468432056e-03   +3.919379795494775e-02   -2.153980671873186e-02   -1.235480119456605e-02   -1.579721683485887e-02   -1.397486584986831e-02   -9.493723069264721e-03   +1.003377999110881e-02   +4.394493051236191e-02   -4.091394160123993e-02   -1.035855959015172e-02   +2.326541177923264e-02   -2.418310701875818e-02; -6.698274602118692e-02   +5.884122710155383e-03   +1.470198375803359e-02   -1.467473402743230e-02   -4.484542827400523e-02   -4.676353809750408e-02   -2.627904089561839e-02   -4.522181445925627e-02   +1.488760464161560e-02   +1.798425377668083e-02   -2.488799417386008e-03   +3.156280847123171e-04   -3.242951469250831e-02   -4.191259820425422e-02   -1.082522640264342e-02   +4.895401059865070e-03];
L1E_L1I_iGABA_netcon = [-2.230855094799396e-02   +2.455315943408577e-02   -3.821108278929699e-02   +4.857377205942523e-02   +3.541056052228486e-02   +2.896572261128740e-02   -4.845380022189514e-02   +6.033427917409342e-02   +1.255432428281839e-02   -3.591910738142425e-02   +3.274839764811721e-03   +1.032927120308879e-03   -1.778583076057609e-02   +1.669873212011516e-02   -1.129464422432259e-02   -1.090976931333820e-02; +3.852639476498274e-02   +1.335106309855435e-02   +2.191621311370700e-02   +1.250144393225538e-02   +4.761575194798304e-02   -2.947782665314743e-02   -1.448036568447995e-02   -3.462003094517994e-02   -3.632207005599740e-03   +2.421672870874403e-02   -6.633145945439071e-03   +6.208023655553017e-02   +2.883770210222606e-02   +1.639047077735165e-02   -3.623915582409042e-03   -1.123817092294397e-02; -2.037088057019849e-03   -5.554921419940066e-02   -2.754415632021565e-02   +3.100761081005559e-02   +4.596172428026753e-02   -2.307107685807120e-03   -1.002974111278225e-01   -4.049258155620549e-04   +1.959692117501608e-03   -8.570715047376308e-02   +3.151366643217250e-02   +8.665969434430223e-04   +2.520766252147774e-02   -1.644526195863306e-02   +2.088721998003890e-02   +3.773845036271285e-02; -2.999329893557053e-02   +4.221591296796842e-02   -4.218297598319439e-02   -1.833661382712799e-02   +1.948342829668442e-02   -1.471218025491151e-02   -4.553451940726097e-02   +3.142450663703566e-02   -1.320641713474616e-02   +3.412231844764760e-03   +2.314186629117358e-02   +2.086130996573851e-02   -4.820716663577108e-02   -2.897126758590399e-02   +3.660981103747137e-02   -2.413852755311461e-02; -4.669587979110661e-02   -1.202523652999451e-02   +3.283074999436626e-02   +3.424454881821276e-02   -1.450865462826187e-02   -8.665492303203209e-03   -4.950302441176612e-03   +8.278391291353442e-02   -1.795585136536761e-04   +4.644644552955542e-02   -3.579045618890338e-02   -5.363803562545168e-02   +3.162169069349259e-02   -2.716739097910714e-02   -1.773239243410480e-02   +3.900384133705807e-02; +2.410154419537710e-02   +3.078383470287870e-02   +4.466378409986808e-02   -1.081740198119954e-02   +1.517197169790058e-02   -2.477740813624878e-02   +4.888166271253610e-02   +2.451206151391290e-02   -6.686516249801186e-03   +4.059836650238031e-02   -1.848295418027674e-02   +1.934217810660099e-02   +5.352339243577385e-02   +2.823355410900002e-02   -3.668705531103152e-02   -2.567605087962463e-02; -5.896925231552750e-02   +1.404832719674737e-02   -3.397668137677014e-02   -3.975125173939499e-02   -6.733058666562321e-02   +9.712548233971707e-02   -2.243141517670197e-02   +5.929107780632654e-02   -3.144403208548091e-02   +7.186498275223707e-02   +4.191678720533071e-02   +1.493799290988108e-02   +4.800283762975541e-02   -4.740775867861936e-02   -4.197645770939699e-02   +3.145924118853128e-02; +2.713007289182773e-02   +2.567987668904954e-02   -6.033406308687106e-02   +2.048082975985986e-02   -1.317278421076386e-02   -2.548262291509228e-03   +1.145698158988990e-02   +1.777662426383190e-02   -7.151198154258745e-03   +4.661132727696055e-02   +5.658590641264727e-03   -2.629238811892175e-02   -4.142965987100486e-02   -2.091160122812876e-02   -1.619030823619368e-02   +4.257699801877241e-02; -5.345737896488303e-02   -6.604824397565053e-02   +4.224648074065544e-03   +2.057745806009466e-02   -1.288240917783305e-02   -3.903364764368173e-02   -6.987051242364506e-03   -2.346019702056790e-02   -7.365512638749526e-02   -3.726780352558487e-02   -3.516445764171573e-02   +2.373076393984002e-02   +1.020977458568094e-02   +1.692774461823979e-02   +5.087097790889260e-03   +1.983518335663617e-02; -5.996060649499144e-03   +5.089882772725809e-03   -1.194300619378019e-02   +1.100352849849038e-01   -7.083272527196378e-02   +8.129945555321635e-02   -4.931557520888967e-02   +6.285870284031492e-03   -1.206312544919473e-02   -1.123081845589600e-03   -1.015976353074372e-01   -3.686559449424570e-02   +3.684097986786863e-02   -3.668898217439685e-02   +4.779560772197167e-02   -1.474009001158090e-02; +4.091430949062060e-02   -9.280434439049249e-03   +3.022759915307429e-02   -4.466901284028842e-02   +7.408283226560447e-03   -3.557620856323102e-02   -8.501888796816737e-03   -1.207646963924760e-02   +1.944340794666341e-02   +3.492983341065163e-02   -5.360850323484254e-03   -2.584940963058759e-02   +2.014577499144517e-02   +1.912410993944959e-02   -1.162311994265316e-02   -5.003521567458319e-02; -4.527945029005543e-02   +4.098483987075734e-02   -6.441006622794203e-02   -4.502424420691225e-02   -2.603805132930841e-02   -5.932539614617607e-02   -2.670830391281061e-02   -5.258194464765741e-03   +1.811059499736858e-02   +1.081032427611888e-03   -1.110265865208530e-02   -5.497954231924726e-03   +7.171437405173661e-03   -2.731516261025559e-02   +1.490692514339278e-02   -2.255199621854603e-02; +4.628699952600430e-02   +5.727101064278386e-02   +1.493264583377088e-02   -1.294727535851390e-04   +2.655528244675273e-02   +3.125805213754819e-02   -2.581978679247061e-02   -1.312831008464879e-02   -5.552253583048377e-02   +3.804400719262097e-03   +1.482644102675260e-02   -3.880279690995281e-02   +1.360127835705602e-03   -7.261037392972068e-03   -8.220105277635299e-02   +2.196902369649485e-02; +4.457661788791278e-02   -5.350862820428724e-02   +4.691033906442410e-03   +2.549007195615147e-02   -1.998993604867520e-02   -3.091137423732876e-03   +2.343737503118997e-02   -1.235752109263004e-02   +8.107984702712055e-02   +1.255917994938516e-02   -8.159089878352674e-02   +6.872689566576376e-03   +4.267145026950407e-02   +3.131454769727157e-02   -2.700807263103851e-02   -7.561587956661251e-03; -4.435709222405422e-02   -1.203409466849471e-02   -4.414654532569329e-02   +1.686712818831705e-02   -4.478564643341427e-02   +2.058491483607331e-02   +1.858292279741781e-02   +2.586163681821090e-03   +7.983479214403499e-02   +2.971536492139973e-02   +3.140414808633269e-02   -1.927997574851476e-02   +8.455525940895801e-03   +1.571528246470531e-02   -1.295004474176091e-02   -5.686663820793941e-02; +3.570268650269543e-02   +7.040292616323003e-02   +6.171026917805487e-02   -1.931457131837041e-02   +2.587480598446220e-02   -3.388483534185781e-02   -2.940745935032389e-02   +2.153170364762453e-02   -4.275947716138901e-02   +1.126863240205090e-02   -1.415988589558211e-02   +3.300618054768115e-03   +3.025200033298060e-02   +2.578366380045918e-02   +6.388119870372008e-03   -2.648599302985570e-02];
L2I_L1I_iGABA_netcon = [-7.269606273866580e-02   +2.424846267580492e-02   +2.406232924648137e-03   -3.096953610773298e-02   -9.070407614715220e-02   -3.767063104601245e-03   +2.644020539217536e-02   +1.156646633606256e-02; -4.895621163141101e-02   +1.734001523201847e-03   -3.905880177312472e-02   +5.620950529895200e-02   +2.244123190275299e-02   +1.558762750345810e-02   +1.918320069956699e-02   -3.598805282360519e-02; -3.450872230305584e-02   -5.906446523271161e-02   -4.547221172312702e-02   +3.061839659741094e-02   +1.986730624897683e-02   +1.258805024373056e-03   -3.953539110170911e-02   -3.558588562724435e-02; -6.452071533254078e-02   +3.426224907995657e-02   -6.348468585816711e-02   +1.086746476826278e-01   +2.468953141617418e-02   +1.158826937478278e-02   +3.205947841412635e-02   -3.172593069246386e-02; -2.476116438171197e-02   +1.472993301286342e-02   -8.940418779985011e-03   +2.077369076562649e-02   +7.184239702913101e-03   -8.206830853877282e-02   +4.780300407815853e-02   -1.561862452721660e-02; +8.059709654327948e-03   +9.019387878258986e-02   -8.491469899441748e-03   +1.947853992212135e-02   -7.812072086601916e-03   -1.817864695762471e-02   -9.846586836099121e-03   +3.786164442823656e-02; -2.704415901128905e-02   +1.887129040423527e-02   +5.587940271807748e-02   +1.662754491223349e-02   +3.871388174441921e-02   +3.519481011738475e-02   -4.313945906932921e-03   +5.637865645065791e-03; -2.502961703815875e-02   -3.271673127088719e-02   +5.703148225111168e-03   -6.267062473673479e-02   +1.734524763059143e-02   +2.108133477127173e-02   +1.110472701300053e-02   +8.329299213720179e-03; -2.495710762044637e-02   -4.011659592881615e-02   +2.934059382306160e-02   +3.622063969184745e-02   -2.094465083714789e-02   +3.969151266208987e-02   +8.125425133064637e-02   +2.219150921429412e-02; -3.114784051745691e-02   +4.019108071412295e-02   -4.869431428729709e-02   -1.696247683130306e-02   -2.013507270166352e-02   +2.203793878988908e-02   +6.704489449764707e-03   -3.436823518716086e-02; -5.057369782128465e-02   +3.868245660043818e-02   -4.993921627328589e-03   +2.671976649500835e-02   +2.062273108196271e-02   -5.089096826464579e-02   +2.994752333773961e-02   +1.534283299801913e-04; -8.802003302428045e-03   +1.155873293498091e-03   -4.580166382107798e-02   -6.621339372374699e-03   +7.303030841447603e-03   +6.314283661263718e-02   -2.245626369326220e-02   +1.345092903651790e-03; +2.811593005283219e-02   +4.540681858767220e-02   -1.224855939696955e-02   -4.172688171184269e-04   +1.629013446382256e-02   +6.873855544575194e-02   +2.467659976150990e-03   -4.020633901386330e-04; +5.926997681579909e-03   +5.850702814028812e-03   -3.206262022911024e-02   +2.418086189955827e-02   +1.434482107806729e-02   -1.517279159717917e-02   +5.770496102347209e-03   +2.595450017421677e-02; +5.901663921212464e-03   +3.109233860783758e-03   -1.496673825229946e-02   -4.830202263567179e-04   -1.307209992426906e-02   +2.542476881267299e-02   -1.640191208681306e-02   +2.082157441785145e-02; +1.814155994003822e-02   +7.290699017657240e-03   -2.786549454983828e-02   -3.097661665179032e-02   +2.100670170064984e-02   -3.350456735285932e-02   -1.124930961047821e-02   -8.854977532428995e-03];
L1I_L2I_iGABA_netcon = [-3.544175151562388e-02   +4.590834005944589e-03   +5.552515045296105e-03   -4.926118741089981e-02   -7.442410358683912e-02   -9.142767443934110e-04   -1.170963399106002e-03   -3.082303190746104e-02   +2.351719992754123e-02   -2.566067072957718e-06   +1.082265566455320e-03   +2.978333953305591e-02   -1.394141733302579e-02   -1.352165031855948e-02   -5.841432983088866e-02   -4.994670847766773e-02; -3.440485565554653e-02   +2.960610159634419e-02   +4.240807433850954e-02   +1.198192205426921e-02   -5.586961636327816e-02   -4.237920532419284e-02   -6.291295250623420e-03   +1.803725225769110e-03   +5.703403234183414e-02   +3.304595795335817e-02   -6.317335886642209e-03   -3.627966890757309e-02   +5.064605474997923e-02   +2.814556928259454e-02   -1.442290518011363e-02   +2.234366349139722e-02; -3.271779665206404e-02   +4.752640829267631e-03   -3.187704848658332e-02   -3.892041536019777e-02   +2.723252175668578e-03   +4.200629536640744e-02   -5.236103565905294e-02   -3.231510909127020e-02   +4.521208439481909e-02   +4.307186722345807e-03   +3.711446043144570e-03   -1.113588175262362e-02   -3.714858300924104e-02   +6.380722065044164e-02   -1.809976958121548e-02   +2.022327770235562e-02; +9.152306171563930e-03   +2.206433477318755e-02   +6.361704731320686e-02   +2.698245373704186e-02   -1.184300063899466e-02   -2.336581415959453e-02   -2.351606468985371e-02   +2.347759586958228e-02   -3.642102922439949e-02   -7.192955931107090e-03   -9.950753042889754e-03   +6.188002775723886e-02   +9.257871539394818e-03   -6.484124629653607e-03   +4.915782291407157e-02   -7.388404526888491e-03; -3.180530608870410e-02   -2.187789652265563e-02   +1.973596903100824e-02   -3.934182592154438e-02   +5.751299037051070e-02   +4.471442297542205e-02   +8.807370853904679e-02   -1.636114592098503e-02   +7.617714227673764e-02   +1.439417808506950e-02   +1.388644111766097e-02   +9.790364418763783e-04   -2.211869857482490e-02   +2.766320355360694e-02   -2.651875702566200e-02   -2.124747508433954e-02; +1.857490845323402e-02   +1.471725922329120e-02   -1.315414958782336e-02   +1.800219066715689e-02   -2.975204896099228e-02   +4.029352196609118e-02   +3.677436800010947e-03   +3.425201126351100e-02   -1.363713898396201e-02   -3.175782953645261e-02   +3.009757861143487e-02   +1.598307283103861e-02   +3.057474557517894e-02   -1.452928818739894e-02   -2.216024613189218e-02   -3.901134241892257e-02; -6.938381216761695e-03   +1.477515999013932e-02   +6.082728920178085e-02   -2.742704010725289e-02   +4.499133428926412e-02   +4.259313811497056e-02   +5.766997974855389e-02   +2.876307659126737e-02   -1.296495074488545e-02   -1.239119741533503e-01   +4.209960508683332e-03   +2.656550999421225e-02   +1.075641885317274e-03   +2.220078822936514e-02   +1.098311553431426e-02   +2.603711518817840e-02; +5.787839111443597e-02   -8.833802181075190e-02   -2.182488360290387e-02   +1.895418944635729e-02   -3.622723585167321e-02   -1.639560872249168e-02   -6.195941464140220e-02   -6.078480184750741e-03   +3.256511501898230e-02   -1.173000150281834e-02   +1.496148670757199e-03   +2.048765410420164e-02   -5.602383478964651e-02   -4.626337650715058e-04   -2.483848604997831e-02   -5.536665025071302e-02];
L2E_L1E_iAMPA_netcon = [-5.695599417580309e-02   +5.466857639270034e-02   +4.047878484967236e-03   -1.848875079555046e-03   +8.946124606926452e-03   -2.272297998860924e-02   -2.535730342038726e-02   +1.503789032061021e-02; -2.258072006155317e-03   -1.624407718778745e-02   -1.201494497374473e-02   +3.019716717849166e-02   +4.377402512047593e-02   -7.104228842420251e-03   -2.825935484823841e-02   -2.185948383528244e-02; +1.006487576326154e-02   -8.391054586640390e-02   -3.107850023384929e-02   -1.344457144906519e-02   +2.822820177956362e-02   +6.804778372786433e-03   +7.994648481388725e-02   -9.494091819828486e-03; +2.166587061235277e-03   +3.040981538838891e-02   +7.528837036983096e-02   -1.433568264005524e-03   +1.476086476318257e-03   +1.141683889710061e-02   +5.534670228483212e-02   +4.304361783413444e-02; +1.745856289008111e-02   -4.157014886864996e-02   -1.982861782857189e-02   -9.735332405632725e-03   -3.345934618696442e-02   -3.357286640821687e-03   -1.077015150559769e-02   +7.969456265488650e-03; +5.522375950273159e-02   -8.485446971575077e-02   +4.654923971297058e-03   +5.692253485052454e-02   -8.753389450938633e-02   +2.051034496587017e-02   -1.206143637274732e-02   +5.336043678329155e-02; -1.600124283233767e-02   +2.600490414239209e-03   -5.167488733972764e-02   +1.343048411049257e-02   -3.424685740390399e-03   +2.680359394466808e-02   +5.364705854720477e-02   +2.577327572747461e-02; +6.060169987316414e-02   -8.386844754754794e-03   -1.485680979594160e-02   +2.172667927609606e-02   +2.795039386150118e-03   -1.347293735588819e-02   -2.173599791720144e-03   +5.568510860710092e-02; -3.202471638443778e-03   +3.304238760956446e-02   -2.994052540632979e-02   +7.470403480968568e-02   -5.235634228127642e-02   -1.916746310885263e-02   +2.739802047868354e-02   -5.305873565556064e-02; +4.832313543478700e-02   -1.291826564117239e-02   +1.576210686205498e-02   +9.266444759509652e-04   +8.123094239372922e-03   +3.277403837748059e-02   -1.540737547011297e-02   +5.657647171665112e-03; -5.402331986051014e-02   -1.632716432751439e-02   +1.950565626983790e-02   -3.086358341463152e-02   +6.317652952359945e-02   -1.479917961467361e-02   -4.054400240062841e-03   -3.627771025485390e-02; -6.056990493581690e-03   +1.031649872236102e-03   -6.181363994004137e-03   -5.451903664426822e-02   -2.002075103811329e-02   -4.685941011116094e-02   -4.663113426652878e-02   -4.329675557081244e-02; +4.320645867114713e-02   -1.403099535138029e-02   +1.940813897511190e-04   -1.174534249433338e-02   -4.478228711407102e-02   -9.437829972795726e-03   -2.677412394398136e-02   -3.773958941343818e-02; +1.338143325484391e-03   +6.047869254885221e-02   -1.009857230465483e-02   -2.535111477872304e-02   -1.697956975477912e-02   -1.256223981040866e-02   +1.300385912071915e-02   +4.099065994798382e-02; -3.850811544927907e-02   +5.117669253993172e-03   +3.855074318482243e-02   -1.412098214010555e-02   -1.162889893296035e-02   -2.141285509145689e-02   +2.476402252841073e-02   +8.899456039510242e-03; -6.708328363171791e-02   +2.087011100719097e-02   +7.235355194636230e-03   -1.664194987852588e-02   +1.759625983522901e-02   +3.220457077794071e-02   -2.731797173718045e-02   -2.278700841249607e-02];
L1E_L2E_iAMPA_netcon = [+1.202496471374050e-03   -4.884264868870081e-03   -9.423578138858107e-04   -6.031041941929340e-02   -3.744403698486740e-02   -3.361534383293555e-02   +1.173630632785423e-02   +5.989040056181153e-02   -2.578994158037290e-02   -2.136152077833156e-02   +3.939116265028027e-02   -4.775435110472425e-02   -3.645617140925371e-03   -2.012602316482166e-02   +4.173202595652029e-02   -1.542211391061852e-02; +5.707017787391028e-02   -3.014144706130210e-02   -4.508983142387700e-02   +7.873292329278980e-02   +2.353478631974262e-02   -8.625182851888374e-04   +2.712945119822469e-02   -2.855419593079290e-02   +2.984012963810882e-02   +9.743660563640738e-03   -4.326711539979818e-02   -6.515996260453533e-03   +4.835172381675466e-02   +1.093734698406402e-02   -4.255586631415754e-02   -3.464057426758547e-02; -2.366913178067468e-02   +1.294940238231411e-02   +5.012249140893064e-02   -2.414707881966580e-02   -2.317230388887547e-03   +2.184603430109336e-02   -2.887244597025595e-02   -1.465357904811345e-02   -3.497079927625599e-02   -1.385352129650337e-02   +2.557503793856794e-02   -2.924656083616990e-02   -4.784738479453426e-02   +3.333984033505098e-02   -9.433997272225013e-03   -8.271889202209363e-03; +1.993079827766884e-03   -1.355772892327682e-02   -4.019805317574330e-02   +4.125274596251264e-02   -2.695824238642890e-02   -3.957380643514057e-02   +1.726841482944377e-02   +1.618866691957481e-02   -3.388936344322661e-02   -7.761702899812502e-02   -1.011216508669286e-02   +2.151618959622623e-02   +5.457277532291155e-03   +8.161465076873217e-02   +2.222424829177739e-02   +5.646682023692871e-02; +1.000506843099246e-02   -4.126907938783986e-03   -2.202052112298235e-02   +1.380308214085701e-02   -6.273456807484883e-03   +4.655574095223840e-02   -2.238677366711106e-03   -3.794761669601177e-02   -4.608521259233887e-02   -4.580536674790847e-02   +1.477503890000451e-02   -8.593711490937248e-04   +1.168563674297950e-02   +2.350314159282325e-02   +4.998996364468744e-02   +2.677971210922483e-02; -1.932784906657405e-02   +2.501176646084127e-02   -5.054898271983216e-03   +5.546195541526643e-02   -4.935479958162576e-03   +7.959678352024390e-03   -2.836866474060499e-02   +1.979960512962784e-02   -8.916642749168641e-02   -1.176935191762820e-02   +1.407117131296592e-02   +7.590520401797961e-02   +1.334812773063811e-02   -3.879322513779726e-03   +5.492975407850077e-02   -1.958919906574704e-02; -8.789211972744007e-03   +7.107716904522766e-02   -2.445326314633111e-03   +4.072676916695301e-03   -5.516649940143212e-02   +1.027666623387110e-02   -1.854437855576526e-02   +2.895496790168170e-02   +7.715311929675787e-03   +1.126738770160747e-02   +2.432817330812134e-02   +1.235747333081334e-02   +1.117587852029432e-02   +5.751334758235740e-02   +6.734818605004345e-03   -2.293330855804970e-02; +3.271902342324496e-02   +2.113258959981829e-02   -2.077270053430812e-03   +3.245598034610234e-02   +5.616725892707659e-02   +8.460297101127939e-02   +2.715728418342751e-02   +3.260791512801238e-04   +8.064931629608628e-04   +6.024040708786354e-02   +5.865943677869167e-02   -5.990858389038235e-03   +8.268004801633434e-02   -2.932448342265653e-02   +7.751354225140113e-04   +4.560848860302134e-02];
L2I_L2E_iAMPA_netcon = [+2.475882912214477e-02   -5.906490035348548e-02   +3.042242664146396e-04   +2.422149236907943e-02   +6.228935316848670e-02   -2.615605221860424e-02   +2.327853089366203e-03   -6.418225148469027e-02; -1.049597843207694e-02   -2.848358034674700e-03   -5.499457542902420e-02   +1.050160929082081e-01   -1.065882537493734e-02   +1.742255340870557e-02   -4.863019530326720e-02   +6.266569645718156e-03; +1.154046641131406e-02   -9.707145588389586e-03   +1.321411275722203e-02   +4.292189777803176e-02   -4.299893772301198e-02   +5.448663837174138e-02   +7.877870504955856e-02   -3.828927981472364e-02; +2.569027973222552e-02   +4.231064614987672e-03   +4.534512166176398e-02   +2.294438055208927e-02   -2.335065121208945e-02   +4.977348932728186e-03   +4.306180888475955e-03   -1.664609115373467e-02; +6.393157143481694e-02   +3.276932648544222e-02   +3.250687850520825e-02   +1.508712819132772e-02   -1.648934332956201e-02   +1.252115584864352e-03   +3.888383340437031e-02   +4.047219055101502e-02; +6.418913616243688e-03   -3.649838142462055e-03   +6.856686502675123e-03   +3.398307234770817e-02   +5.547857256327657e-02   -7.609090651133674e-02   -3.723027790340019e-02   +8.431336172131151e-03; +2.360936002336873e-02   -3.221405439098964e-02   +4.106133518497175e-02   -9.068163239917944e-03   -5.981067328246222e-02   +4.526747688257454e-03   -1.705577228013647e-02   +1.565557652110714e-02; -6.103019769881567e-02   -4.040858877871934e-02   +2.182191659693204e-02   +3.308093009532527e-02   +8.615130510743349e-02   +1.016124106054712e-02   -6.616209254087921e-02   +1.363365623834340e-02];
L2E_L2I_iGABA_netcon = [+2.815589254524112e-02   -1.511193985006763e-02   +5.561041608474841e-02   -7.102587857255753e-03   +2.381710214917544e-02   -3.860795483899297e-02   +5.146872930243072e-02   +2.201926928293575e-02; +1.058825585341130e-02   -6.756112782610365e-03   +6.677036623799332e-02   -8.867099869644476e-03   -4.324709670865487e-02   -2.141308659626194e-02   -4.444124281171816e-02   -3.001294772415445e-02; -4.157491867025176e-02   +3.147714294989794e-02   -1.233196040146954e-02   +7.296499693494932e-02   +8.155598177110311e-03   -1.835425669266693e-02   +1.793639924991598e-02   +1.500003712127935e-02; -1.741740746388370e-02   -1.259344379159864e-02   +4.962204680045761e-02   -7.195554350711633e-02   +2.040721772523290e-02   -4.003391786808093e-02   +2.149882451239843e-02   -3.805559388223048e-02; -1.826049009577706e-02   -9.931611808305818e-03   -3.286154522921898e-02   -1.715318518162626e-02   +3.404715188685101e-02   -4.855368133595124e-02   -2.545594933688301e-02   -4.857060598219688e-02; -2.282550995103202e-02   -7.272033136637574e-03   -2.828811769358322e-02   +4.287480665138957e-02   -4.940080691891311e-03   +2.365322572537517e-02   +5.114061490339888e-02   +3.514251646262735e-02; +9.864933075131820e-03   -1.391402367709015e-02   +9.379593118417028e-03   +9.048506053414168e-02   +4.071453535406926e-02   -2.810295076112380e-02   +5.053298154317909e-02   +1.509494010764964e-02; -2.089261871463885e-02   -3.823311409655488e-02   -3.828957830421670e-02   -3.960433294549719e-02   +4.177862742634782e-02   +4.855465783449424e-02   -2.496385989432495e-02   +3.362041318650967e-03];
L3E_L2E_iAMPA_netcon = [-3.790567254771884e-02   +1.373575973651011e-02   +7.695548777047744e-03   -2.476487547163965e-02   +4.908150044539052e-02   -3.989551505365298e-02   -7.800257238459263e-02   -8.691881979398592e-03   -1.896417281244569e-02   +3.649532202232634e-02   -3.634057936517514e-02   -2.843608463461535e-02; -6.950629175828711e-02   -1.712345815894930e-02   -1.194069244729067e-02   -2.607627479135127e-02   +6.076737100283846e-02   -4.279954002618795e-02   +1.945403915995326e-02   -3.009949557159465e-02   +6.003967775266103e-02   +4.777979702871098e-03   -4.926399272743592e-03   +2.415720269848538e-02; -3.792208893955414e-02   -5.536344244295949e-02   -5.688663358263755e-02   -2.115788819186441e-02   -1.786745843011124e-02   +4.486926480076248e-02   +6.935408112190935e-03   -5.418235861248347e-02   +3.481290007595880e-02   +3.390424691659073e-02   -2.690317473711427e-02   +1.964480674234748e-02; -1.699187843422056e-02   +5.573279725529180e-03   +1.647952730721748e-04   +3.359409521529941e-02   -3.557362993633634e-02   -1.761061585141244e-02   +6.779912348998533e-02   +7.147738791097939e-02   +3.406659492456252e-02   -6.447123212881267e-05   -2.766288439420497e-03   -3.275933164784837e-02; +1.421386192011334e-02   +3.659028302135832e-02   -3.180021283662785e-02   -3.607427839055537e-02   -2.653166158721100e-02   +9.744146060162844e-03   +5.312759104732629e-02   -1.450881887321696e-02   -2.554209207696276e-02   +1.873998697771865e-02   -1.554720845888050e-02   -5.947955719441947e-02; -3.719315986719806e-03   +2.405632493450119e-02   +2.524970949379948e-02   +4.390170239549883e-02   -3.156343024081270e-02   +2.272648125797993e-02   +1.370693992967294e-02   -3.257583385051915e-03   +3.800707194565297e-02   +3.026299362062153e-02   +4.039978055159326e-02   -6.724208429405451e-03; -1.782681861142002e-02   -1.801302160163053e-02   -6.287584256844340e-02   -4.888110229601955e-02   +1.333265901893558e-02   +2.467460130667220e-02   -5.736022398177557e-03   -3.971610639421124e-02   +3.955877750270356e-02   +2.442689314102270e-02   -3.456911366457387e-02   +4.050972832233213e-02; -4.188208753069639e-02   +2.568873897671725e-02   -3.378532238236258e-02   +2.239091599528287e-02   -1.603465338493960e-02   -1.133042843935968e-02   -2.202850792390477e-03   +2.072377115311192e-02   +3.905266892052550e-02   +1.304793517645187e-03   +2.261459718861298e-02   -3.492949666329811e-02];
L3I_L2I_iGABA_netcon = [+4.392412802270109e-03   +1.447750233743988e-02   +8.411438158816256e-02   +2.199893764721152e-02   -4.541898383464295e-02   -8.551273637705631e-03   -3.416863483477485e-04   -3.308226047797687e-03   -4.448570834378479e-02   +6.400336242722870e-03   +1.149408465088011e-02   -2.161188082703621e-03; -7.033350935720818e-03   +4.019796804531854e-02   +5.129464553221308e-02   +2.203773495713987e-03   -5.421175691186626e-02   -6.157922842396332e-03   -7.178352335035977e-03   -2.543302563297986e-03   +6.608919816834658e-03   -6.019345306874100e-03   +2.252293983391769e-02   -4.912788909312885e-02; -4.179362857107496e-04   -7.283551204318421e-02   +4.445420883490851e-02   +3.987177525264515e-02   -1.767317891103178e-02   +1.698059203464366e-02   +4.364346639786860e-02   -8.065984996476235e-03   +4.050991154996676e-03   -1.492977362676353e-03   -1.173402292748632e-02   +7.363835167506503e-04; -6.359076265757699e-03   +1.633091761534279e-02   -2.968797144665015e-04   -1.175539144504120e-03   +5.222350492397182e-02   -9.755478113213322e-03   +1.275260478625344e-02   +3.962292868611063e-02   +2.848787288521545e-04   +6.886509245898585e-04   -5.950114892715637e-04   -4.123996396326751e-02; +2.641476944493424e-02   +6.293628887793896e-03   +9.864619166035975e-03   +6.959946533599136e-03   +1.339790696507764e-02   +4.953409834911129e-02   +2.154374376719477e-02   -1.356431697332683e-02   +3.740181533575783e-02   -5.929689246064376e-02   +3.569452165847643e-02   +3.312766316338560e-02; -3.433080750040790e-03   +1.344402861267622e-02   -4.732010565429911e-02   +3.737317242270504e-02   +6.428568737805333e-02   +1.495250034397770e-02   +1.304525854974856e-02   +1.279898395082108e-02   -5.134233187913180e-02   -2.429351513050946e-02   -2.475599729809003e-02   +7.202809368395968e-04; -2.292048315389304e-02   -4.202847235456639e-03   -3.709031651221220e-02   +2.125564299484849e-02   -3.482661320036547e-02   +1.041383764333692e-02   -3.738710121449179e-02   -1.294061993963978e-02   -2.743050920971675e-02   -7.073677249590213e-02   +3.195119238267769e-02   -1.103056517169853e-02; -2.992588665249240e-02   -8.393621946038418e-03   -1.344611087521189e-02   -1.459046103746633e-02   -5.620702704413966e-02   +1.499318788207651e-03   +3.142404232273000e-02   -2.144010896103268e-03   -1.736942339297588e-02   +2.591505690114958e-02   +4.367706935323080e-02   -5.676691130488560e-02];
L2E_L3E_iAMPA_netcon = [-1.418535017688682e-03   -5.863187625227858e-02   -6.075365883965241e-02   -7.037478026973022e-02   +8.382588189628224e-03   -5.859323148733364e-04   +4.737550649545102e-03   -2.362122612112743e-02; +3.631547392275700e-02   -2.558533152081220e-02   +5.723754443336602e-02   -1.240420925665801e-02   -1.602715219358140e-02   -2.580327228495264e-02   -5.010815829110642e-02   +5.822032992003363e-02; -3.495500471884348e-02   +4.103416912223376e-02   -6.534471156331909e-03   +1.680241469375949e-02   +3.784473783027957e-03   -2.040096536989046e-02   +1.282265825157948e-02   +3.842329688517493e-02; +4.553413362190428e-02   +5.756925871742495e-02   -6.067669779919094e-03   +1.205313806027607e-02   +8.369070554254533e-02   -1.608876057720483e-02   -6.954645416719992e-03   +2.343629951963034e-02; -4.930406642958370e-02   -1.906026440147209e-02   -2.992862187055155e-02   -5.628314787904187e-02   -1.310450454189093e-02   +2.265702462456387e-02   -1.745268577735517e-02   +3.800443502788349e-02; +5.099823723111122e-02   -5.247693519386402e-02   +2.738802964193608e-02   +3.302632195373339e-02   +8.163357986961144e-03   -1.292724162640378e-02   -2.215212894629662e-02   +3.555798423260236e-02; +4.476571463059680e-02   -1.063730593151516e-02   -1.593543415467415e-03   +2.559409796444310e-02   -1.223433437592953e-02   +1.573657297656280e-02   -2.707437174058819e-02   -2.760609958441804e-03; +2.636461144498246e-02   +1.606445406881928e-02   -2.046652663082869e-03   +4.475613987778956e-02   +4.325687327453259e-02   +7.081535225291443e-03   -3.132007092293479e-02   -8.304884762911762e-03; +4.591955239286041e-02   +1.778005248622500e-03   -2.449438373628385e-02   -1.383579318366015e-02   +3.699162085495485e-02   +3.220330392885540e-02   -2.847889650960123e-02   -7.326752157233656e-03; +1.692173194222742e-02   -4.558503282416997e-02   -1.624020362573925e-02   +4.008168118262947e-02   -4.125710497215653e-02   -2.066448204040811e-02   -2.955955343443797e-02   +9.510694073112623e-02; +1.715548299765065e-02   -1.199520162121324e-02   -1.663389333235343e-03   -1.169879961497210e-02   +4.743342795216792e-02   +1.063288663820096e-02   -7.252325850533031e-02   -3.779994236470071e-02; +3.077917273520089e-04   +6.710889347772411e-02   -3.690690361599222e-02   +6.329571235914194e-02   -5.651210968065336e-02   -4.371841448027004e-02   +1.749873702251203e-02   -2.709199409877242e-02];
L2I_L3I_iGABA_netcon = [-6.764280828814799e-02   +4.341734684555983e-02   -1.432125013488967e-02   -1.738392726238715e-02   -4.210546625105208e-02   +5.619551153267547e-03   +3.638963725681224e-02   +2.157867616349025e-03; -1.139040374892973e-02   -4.493883816221188e-02   -1.826258880376785e-02   -5.772269434709780e-02   -4.211627252135575e-02   +6.435168710961453e-02   +1.708463800155775e-02   -3.831656476538803e-02; +3.802773788225134e-02   +1.094876761387719e-02   -7.797397907137586e-02   +2.310766973957067e-02   +2.551403472011631e-02   +6.028479627836542e-02   +4.197861067902763e-02   +2.259363053670937e-02; -3.074599706536295e-02   -2.107106258938973e-04   +4.696796380351878e-03   +3.374194729665536e-02   +8.349365515564465e-03   +2.150908704080595e-02   +4.170951127209168e-02   -1.926051260811370e-02; +3.267432089776012e-02   +7.383357805607272e-03   -6.384609694194435e-02   +5.317419266437617e-02   +2.093060235179558e-02   -1.961987547368207e-02   +5.436656897600457e-03   +3.268133200784890e-02; +2.599786195895968e-02   -8.360701460406914e-03   -2.741470087494880e-02   +4.768331635469560e-03   +2.353242763748703e-02   +5.894569767184885e-02   +2.370247064100909e-02   +2.052940138189989e-02; +1.593720295050903e-02   +2.804944880321335e-02   -1.617044782171146e-02   -8.645749624067185e-03   +9.067170088795283e-03   -8.854728645802445e-03   +9.292534608667835e-03   +2.789962796246197e-02; +3.805408070875433e-02   +5.797131249804419e-03   -5.526565333780863e-02   +2.536425319333923e-02   +1.155658562376612e-02   +5.730043077042550e-02   +9.383266044101715e-04   -3.819084893407588e-02; +4.863402617895622e-02   +6.902660362843155e-02   -1.112430898244564e-02   +9.174513198918850e-02   +5.140378460243517e-03   -2.116806485079077e-02   +7.636603516963078e-03   -3.325923215826930e-02; +1.989733518256365e-02   +4.615970355970565e-02   +3.104369467145452e-02   -2.237155893806112e-02   +2.903164987013793e-02   -4.274083966906625e-02   -1.335798994161464e-02   +2.400407223744654e-02; -1.355562421390304e-02   +5.208684917235013e-02   +2.086572965491368e-02   +8.147623379477329e-03   +3.964564088503311e-02   +8.311043925001026e-02   -4.769300597908848e-03   +2.030267595681994e-03; -4.957266189079344e-02   +7.590641615530681e-03   +9.859194073318058e-03   +8.012326668220317e-02   +3.652223957571869e-02   -3.381650293706169e-03   -6.455670890611533e-02   +4.414166439639156e-04];
L3I_L3E_iAMPA_netcon = [-2.255829471410212e-02   +1.761854554157111e-02   +9.276535872013807e-02   -5.388511954749433e-03   +2.867309339464625e-02   +3.405627739529610e-02   -4.549700798511413e-02   -3.708824682833867e-03   +1.523978991083336e-02   -3.412754074207843e-02   +3.308090483021765e-02   -7.597174615949446e-04; -2.221415287892287e-02   -4.639002762457503e-02   +1.549163191386710e-02   +5.024396550878174e-03   +1.186893422607040e-02   -5.355797152115495e-02   +9.044310341525530e-04   +2.077580692568877e-02   +3.839867120705693e-03   +5.049913786862816e-02   -4.807420015042416e-02   +4.560588675706204e-02; -1.028093243690207e-02   +1.604220295802274e-02   -2.487595292259165e-02   -5.227444627999939e-03   -4.196200711286085e-02   +2.071690625179368e-02   -2.045033889936065e-03   +2.167944964733586e-02   -1.157377500079279e-02   -7.060415028952190e-03   -5.042718537913762e-02   +1.439528627260995e-02; +4.458333479583974e-02   +2.157288320827665e-02   +2.404608365117154e-02   -2.658872499380779e-02   -1.707183668240489e-02   -1.153049672987643e-03   +1.852731907040842e-02   -4.553465371563167e-02   -6.477932640161484e-03   +4.549609315827232e-03   -4.692267436609171e-02   +3.281728862857371e-02; +2.933212194241360e-02   -8.649785685278039e-02   -8.331852482632128e-02   -1.596275447532495e-02   -4.261173269338075e-02   -6.858781392050814e-02   -1.015865278671925e-02   +1.600843811874802e-02   -9.440873874792237e-02   -7.951819444901868e-02   +7.649739953258460e-03   +5.937446460589744e-02; -5.740596687804921e-02   -6.015632203091009e-03   +7.476087569789792e-02   +2.221553914161295e-02   -1.583311844452437e-02   +5.682560172697077e-02   -1.006485191931511e-03   +3.426822029512312e-02   -2.165083751280746e-02   +5.309199784471411e-02   +1.913057902119336e-02   +2.246720711024708e-02; +5.908462086040731e-02   -3.493174836467926e-02   -2.222395610101804e-02   -1.273251202396858e-02   -1.198447556021755e-02   -2.364515723948827e-02   +2.291854492719650e-02   +4.665655956061081e-02   +1.868983960642144e-02   -5.080333466047066e-02   -2.749487751279300e-02   -5.881558834141601e-03; +1.757046906643863e-02   +2.564010880758317e-02   +4.753173127449675e-02   +4.170214991032831e-05   +2.508887002518374e-02   +2.807304764550353e-02   +2.310307651816884e-03   +3.720419257271636e-02   -1.875307797467958e-03   -6.914158976535920e-02   +2.614412806315593e-02   -2.516448062303569e-02; +1.992354930067532e-02   -4.588272193781202e-02   +5.099457756407580e-02   -3.256879769706656e-02   -2.184568449486882e-02   +1.087412074433153e-02   -3.813336350924667e-02   +4.229890648497567e-02   -1.928394175920954e-02   +3.570845273132175e-02   -5.271341748323694e-02   -3.664163515175631e-02; +2.795305547311732e-02   +3.813289195533794e-02   +2.369352464823083e-02   -1.372262767505916e-03   -2.306820641676289e-02   -2.641560672134909e-02   -4.526411337909830e-02   +5.577402300120142e-03   -1.392017350708745e-02   +5.112997956419889e-02   +1.794523956171079e-02   +2.246224060634486e-02; +1.364289253191739e-02   +5.776569865831412e-02   -3.956090157129927e-02   -6.609850967212105e-02   +1.860679680087962e-02   -2.858430540781563e-02   +4.673242293805821e-03   -1.198243072451206e-02   +5.816024915904907e-03   -6.019903584278704e-02   +4.972678565359742e-02   +2.510302756713459e-02; +8.178809461772569e-03   +1.973988271943955e-02   +4.435564408105284e-02   +4.162048880543063e-02   +6.574078256456942e-02   -2.463611793101365e-02   -9.118275397389077e-03   -5.355288393284517e-02   -3.033343206434770e-02   +5.863100779431615e-02   +1.579255501119554e-02   -1.348550607702666e-03];
L3E_L3I_iGABA_netcon = [-3.489645679878650e-02   +3.521004374761889e-02   -4.111677571040663e-02   +5.102277868974528e-03   +2.245817321797836e-03   -2.658994123974064e-02   -4.616239315467170e-02   -2.707169752951017e-02   -7.092219904718622e-03   +2.794119330144217e-02   +1.058281056010516e-02   -7.114279836150520e-03; +4.389563840924089e-02   -1.806780669124309e-03   +2.487082657812218e-03   +4.691362792294412e-02   +4.032299950246939e-02   -5.386057517403504e-02   +7.338684738582049e-03   -5.245779565904676e-03   -7.606068520588665e-03   -2.466893301670904e-02   +4.343294603751924e-02   -1.404549257560463e-02; -3.261288837618552e-02   -3.623351415548957e-02   +2.145994682733527e-02   -1.832907883349069e-04   +2.905383670077120e-02   +1.523791629149506e-02   +2.495779562033226e-02   -2.463835169813710e-02   +3.686553305270854e-02   -3.274724755076509e-02   +2.240952210567253e-02   -6.385764141965451e-02; +3.244315084584699e-02   +2.731353487243061e-02   -3.007641795660710e-02   +8.137463147666647e-03   +5.326673278566724e-02   +6.134595198526629e-02   +1.152828778446595e-02   +5.429678958593021e-02   +6.957312814267644e-02   +1.838770656199595e-02   -6.674972486942188e-02   -1.681837209727077e-02; +4.491052841243959e-02   -9.151511029947033e-02   +2.018462259266802e-02   +6.016877120435582e-02   -7.367551168457222e-03   +7.715177022379264e-03   +4.263238566585247e-04   -2.870140185759407e-02   +8.136065579131013e-04   -1.325290535062385e-03   +3.152182111104536e-02   +3.241025092411140e-02; +1.899729329733653e-02   +4.209758519572351e-02   +4.140145584944675e-03   -3.702150904115607e-02   +3.139279201821104e-02   -2.775341843396108e-02   -2.258010594694871e-02   -2.313726906634298e-02   -1.188468215973927e-02   +2.138262545184448e-02   -1.716933746355079e-02   -1.156006980756643e-02; -4.652290280568881e-02   +4.075595657951477e-02   +3.751975201216501e-02   +2.454559463350180e-02   +5.096951645757233e-02   +1.425199001416336e-02   +2.401723852972239e-02   -1.052701047018638e-02   +2.015316299300172e-03   +9.391686516529744e-02   -7.609413786930783e-03   -1.524241004403106e-02; -6.002307905356734e-02   +5.247873466203568e-02   -3.110998914086628e-02   -6.264019625579362e-02   -1.198200174401143e-02   +1.639592229373691e-02   -4.892581819605049e-03   -2.617120811777872e-02   -5.109374021946823e-03   +3.615705815692785e-02   -6.645279775299169e-02   -5.366701359317608e-02; -1.107914311179504e-02   +4.235692814423019e-02   +1.230158772690401e-02   +2.417962518434250e-02   -6.027045828128231e-02   -1.022076901337581e-02   +1.467471192181299e-03   -2.196851086620055e-02   +6.200313440605708e-02   +4.376643525672986e-02   +3.338211598277957e-02   -1.383424884189109e-02; +2.374851716404185e-02   -5.288787443278560e-02   +7.840626333160943e-04   +1.673733870268856e-03   +1.437189120044587e-02   -3.186144968298038e-02   +4.684493402403675e-02   +2.210258309160013e-03   -4.155397644348856e-03   +7.091924354454751e-03   -5.561592462116446e-02   -3.844247221559261e-02; +2.289553786177794e-02   +6.737963421727423e-02   -1.381602908563311e-02   +2.736583104359703e-02   -4.144207676390876e-02   +2.789310741005117e-02   +2.084791488377432e-02   +2.917165491139093e-02   +5.153966850289189e-03   -1.843959384944959e-02   +3.480061819745031e-03   -8.449821922410453e-03; -2.064915583229840e-02   +2.519626002439351e-03   -2.475825664819608e-03   +3.588020630275338e-02   +4.272232697834059e-02   -4.110437818587775e-02   +1.924220495585019e-02   +6.527214217210307e-04   -1.639759230085623e-02   +5.580093531091469e-02   +1.004019010317765e-03   -7.720289458102422e-02];
L2E_Input1_iAMPA_netcon = [-1.745486831546831e-02   +2.601147649633507e-02   +2.458786154741673e-02   -6.851136226215540e-02   +7.870968697875496e-04   -4.900559837865036e-02   -3.356901180472074e-02   +2.712599205031530e-02];
L2I_Input2_iAMPA_netcon = [-2.079534748196137e-02   +3.711477923167844e-02   +3.824952019099585e-02   -4.938305444670514e-02   +4.054150367497394e-02   +1.455475968320888e-02   +2.840898737583082e-02   -2.670126401929824e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
