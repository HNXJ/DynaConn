function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.993815000967429e-02   +1.352920716041048e-01   +9.425541526960617e-02   +6.742868417352083e-02   +2.622300677251537e-01   +4.313605526039814e-02   +1.147480542686575e-01   +1.427717219124128e-01   +8.222153517722912e-02   +1.388929186194910e-01   +3.307106764520207e-01   +2.720537412125146e-01   +1.157050769115378e-01   +1.501944654943862e-01   +2.705785624842503e-01   +1.417019972568409e-02; +7.695314250885427e-02   +6.737295887850764e-02   +8.845854660028349e-02   +2.025827239955543e-01   +1.122838306755630e-01   +2.522493000876024e-01   +1.354888552830413e-01   +1.128100536636325e-01   +1.112578296763587e-01   +7.675887203797230e-02   +9.010370215972754e-02   -7.258683137625080e-03   +2.472535945860889e-01   +1.429039106258900e-01   +1.596051079681601e-01   +1.807067384524453e-01; +2.000976334288000e-01   +9.579542889062666e-02   +8.755983322495635e-02   +5.278146858327285e-02   +5.626060893721466e-02   +8.436527507791017e-02   +1.761061508448390e-01   +8.463964384067137e-02   +4.147048373091237e-02   +2.888755933580214e-01   +2.462413518674204e-02   +2.031468657820278e-01   +2.674165333103683e-02   +2.101840777832182e-01   +1.263354220283932e-01   +2.333526135939964e-01; +2.263151276300154e-01   +2.624537239877152e-01   +2.810405410960166e-01   +2.557996573697270e-01   +2.426065119385617e-01   +1.135576365277739e-01   +1.305148752842328e-01   +2.675950356105564e-01   +5.413215300471832e-02   +1.848501044178477e-01   +5.232183924466567e-02   -5.078050177387053e-02   +1.823823745558846e-01   +5.963393960807672e-02   +2.384201807416478e-01   -1.995949267375664e-02; +1.003986739453821e-01   +1.873194182604904e-01   +2.670173414624350e-01   +1.533908766046576e-01   -1.635539981418539e-02   +4.527247284422217e-02   +2.390698080804595e-01   +1.596297384317985e-01   +9.081776799291651e-02   +9.523435293413140e-03   +5.633219765737577e-02   +9.950373358256699e-02   +2.094355508771835e-01   +1.892347947171875e-01   +2.196806885125707e-01   +2.754708550947103e-01; +1.384367830973494e-01   +1.435065130020024e-01   +1.195677633078830e-01   +2.478843725936775e-01   +4.834927764979580e-02   +1.452949833409749e-02   +1.551769815216080e-01   +1.949497467044805e-01   +2.149016243810905e-01   +1.457811045414108e-01   +2.684752545544242e-01   +2.527459561404242e-01   +9.230863074086153e-02   +1.664616633919528e-01   +9.914216981989289e-02   +1.105636772776243e-01; +2.028609956223523e-02   +6.725951518193470e-02   +1.468633264519127e-01   +2.578896021464784e-01   +9.380324616831894e-02   +6.034439039492988e-02   +1.585304328100990e-01   +1.597851517282258e-02   +2.595360524272766e-01   +4.539924641121335e-02   +3.715665235387033e-02   +1.755373382145484e-01   +8.547085572428242e-02   +1.269952438388230e-01   +1.623993801867361e-01   +1.770847068582960e-01; +2.223045959122082e-01   +3.387019061342869e-02   +8.068376417967890e-02   +4.582031471730643e-02   +7.464974031329387e-02   +3.013860864212991e-01   +9.897832694551985e-02   +1.283771315325035e-01   +3.213816484204188e-04   +7.184344203507348e-02   +1.466035441091904e-01   +1.245195746638759e-01   +9.564560421044419e-02   +2.690869603297612e-01   +4.968509687451059e-02   +3.620559782383362e-02; +1.891470769680801e-01   +5.902202237858845e-02   +8.558987434310598e-02   +1.677346975069613e-01   +2.056151880581722e-01   +5.023944484406226e-02   +7.874652623359221e-02   +2.492405870237638e-02   +1.715923980418844e-01   +2.269176832173697e-02   +1.959027363175880e-01   +1.617763581618415e-02   +6.291652058366523e-02   +1.251720343925078e-01   +1.607941794464882e-01   +1.181561391471710e-01; +1.775473137434950e-01   +1.327149500574634e-01   +2.056668329382880e-01   +1.169326638272071e-01   +2.414541973334041e-01   +2.715679715029496e-01   +8.202514467742122e-02   +1.748848650394793e-02   +1.150286391961240e-01   +2.621248177804346e-01   +1.914132418346752e-01   +8.845140457068563e-02   +2.949448571619807e-01   +1.956912301024382e-01   +2.190727647353128e-01   +2.395809287328492e-02; +5.089961930153072e-02   +1.580122084160281e-02   +2.127025240827302e-01   +8.106038973552436e-02   +1.013916092334636e-01   +3.039814063450826e-01   +2.005964226462604e-01   +9.395303217563415e-02   +9.216300257774922e-02   +1.231490310709444e-01   -2.616024628584426e-02   +1.562339991667827e-01   +8.871999928982428e-02   +1.009566921903746e-01   +2.369330395987100e-01   +1.065911718027399e-01; +2.940417346551671e-02   +1.026592269772441e-01   -2.246114128589931e-02   +1.355386448022399e-01   +1.200370510109080e-01   +1.693694347393476e-02   +2.934265701849310e-01   +2.362734342380444e-01   +1.581662546854796e-01   +1.704639317903614e-01   +1.310140319909830e-01   +2.347756348718078e-01   +1.875499180087388e-01   +1.996467384855089e-01   +2.714686033123900e-01   +2.469326412161482e-01; +2.631816294132132e-01   +2.782284776216686e-01   +9.423829571242504e-02   +9.443781805141205e-03   +1.668516839713154e-01   +1.446651217966293e-01   +2.040848697737058e-01   -5.743262124723452e-03   +2.253357637844340e-01   +2.933533045339518e-01   +1.961805712608386e-01   +3.021744328275719e-03   +8.060429821845819e-02   +1.548537080019257e-01   +1.742173720763578e-01   +1.192040480702242e-01; +2.609605723260764e-01   +4.615166827376867e-02   +1.793837538366045e-01   +1.997640920487949e-01   +2.307991089682361e-01   +7.547286579238995e-02   +1.348390518348846e-01   +7.911177390687778e-02   +1.875398205746226e-01   +1.492383284976636e-01   +2.432416004432862e-01   +2.696083229409960e-01   +1.901095762317491e-01   +2.222058258871172e-01   +3.318279644421541e-01   +1.189915808378315e-01; +2.280014050876588e-01   +8.205049085313801e-02   +2.114447444397996e-01   +2.461834241416709e-01   +1.635075642875977e-01   +4.805491190559431e-03   +2.258372730890378e-01   +1.274443190352181e-01   +1.314680391468944e-01   +1.362905679333438e-01   +3.426643134577318e-02   +4.529840261100003e-03   +2.915621200243735e-01   +2.870671880905315e-02   +1.298646178460878e-01   +2.838463678807306e-01; +2.732824997560112e-01   +1.443441221216414e-01   +2.252428688758695e-01   +3.838821676054634e-02   +1.785967868699868e-01   +1.656538135381586e-01   +1.862149692959497e-01   +1.697952859808783e-01   +1.973241795725198e-01   +9.367766361227678e-02   +5.093943168469739e-02   +7.511824232313066e-02   +7.870001705633405e-02   +5.985618983196431e-02   +1.804910563784454e-01   +1.740688769441426e-01];
L1E_L1I_iGABA_netcon = [+4.636152735702200e-02   +3.058786219047359e-01   +3.271818168386055e-01   +1.947274042779601e-01   +2.230361980925372e-01   +1.915039239506280e-01   +2.687192351388810e-01   +4.451216009922694e-02   +2.732614674056957e-01   -4.972217881623301e-03   +2.472875915104344e-01   +1.104164057438283e-01   +4.505947330277643e-02   +2.860616666091391e-01   +1.238755489067222e-01   +2.529975698784954e-01; +2.377388189645347e-01   +1.433290492618237e-01   +1.879863308068463e-01   +5.402193196219195e-02   -3.985665875898876e-02   +1.729361728839919e-01   +1.609039373244173e-01   +2.133883858581385e-01   -2.265742310109502e-02   +1.886094106848304e-02   +3.074079795735089e-01   +7.591413748510262e-02   +1.712868178749559e-01   +1.731290894271801e-01   +6.725502921548378e-02   +1.845347657423811e-01; -2.343249541584042e-02   +1.668700903772606e-01   +1.127360197016057e-01   +9.937744432389953e-02   +5.855790535583181e-02   +5.676539813128782e-02   +1.533379316169060e-01   +1.763263845831876e-01   +4.914044401808197e-02   +7.966837851395454e-02   +2.050942341877689e-01   +1.761985379688874e-01   +1.444479125814017e-01   -1.213828533512281e-02   +1.483631872408928e-01   +1.719674436942931e-01; +1.059768689714164e-01   +1.633395574086189e-01   +2.303109032734107e-01   +1.665328701182523e-01   +1.746400840950971e-01   +2.937542961696157e-01   +2.230930270782791e-01   +2.033413997339475e-02   +1.745838900965094e-01   +2.211768778848178e-01   +1.363469897166288e-01   +2.394403079155429e-01   +7.595501906892500e-02   +1.949567993145672e-01   +3.901904959080213e-02   +6.856722389113537e-02; +1.069664210786343e-01   +2.662963204063038e-01   +3.156208902162783e-01   +2.832822933863540e-01   +7.772709499007188e-02   +8.989228384894921e-02   +1.691404437571384e-01   +2.073326045258420e-01   +2.301658621939372e-01   +2.002346721934217e-01   +2.395316825227618e-01   +1.792653417520556e-01   +8.350788918775268e-02   +2.639308495060952e-02   +1.066112489641758e-01   +2.565697321381233e-01; +2.165581605745397e-01   +1.842590144116401e-01   +1.481966608177785e-01   +2.291962596618611e-01   +1.634115108281103e-01   +4.621086106044697e-02   +4.231760854261872e-02   +7.740433334237062e-02   +2.530953492623340e-01   +1.744641375482980e-01   +2.196636873399449e-01   -2.888162468040716e-02   +1.022183066119435e-01   +2.721190215104765e-02   +8.207075006138050e-02   +1.601626164402073e-01; +2.870027546102622e-02   +2.088319159077214e-01   +2.592574685686523e-01   +8.895379813899408e-02   +1.575059797318769e-01   +3.890480199966149e-02   +2.338536420383281e-01   +2.224645254104170e-01   -7.005511908925018e-02   +2.123268845654722e-01   +5.435222158079884e-04   +1.905088415645762e-01   +1.751401925766552e-01   +1.903503305921508e-01   +8.352163091389964e-02   +3.089361990118668e-02; +5.597580234377403e-02   +1.659870649329445e-01   +1.187446954630503e-01   +6.888654747792378e-02   +1.487722262078001e-01   +4.123501076741187e-02   +4.878915900935051e-02   +5.115311259718435e-02   +2.152099051288290e-01   +1.569408030064049e-01   +7.234948162013376e-02   +7.654633666623253e-02   +8.497207159298328e-02   +9.218464078540352e-02   -3.398549763656381e-02   +2.935274171631920e-01; +1.584935227446593e-01   +2.313305107105715e-01   +2.524824214316800e-01   +1.641283263942714e-01   +9.068969457378949e-02   +7.536945106184027e-03   +5.750920366615168e-02   +6.600162760023880e-02   +2.032225892193139e-01   -1.348236642733709e-03   +6.007777417875972e-02   +2.235536004838806e-01   +1.520780985658964e-01   +1.621652953264124e-01   +2.667627153581079e-01   +2.280330858602820e-01; +9.248136210508598e-02   +2.311654280267961e-01   +5.644709568542554e-02   +2.622816721650068e-02   +5.083964190301696e-02   +1.269319100467193e-01   +1.202451534097560e-01   +6.811501695840687e-02   +2.348189138827495e-01   +5.815557890114036e-02   +1.506691822103822e-01   +8.728430650902519e-02   +2.002105835108418e-01   +2.277217267769557e-01   +2.132447560682146e-01   +1.314976936972135e-01; +1.698239251994091e-01   +1.421156525787290e-01   +9.968044715060242e-02   +7.383286724003228e-02   +2.209929128926197e-01   +2.568523694084202e-01   +1.833254051373400e-01   +2.671817321618365e-01   +1.404987680089008e-01   +1.053467745379316e-01   +6.113929930092801e-02   +2.578506727609013e-01   +7.232563801579787e-02   +5.261526103885486e-02   +1.185885215840549e-01   +1.431381529360451e-01; +2.338963429341532e-01   +4.883455171872288e-02   +3.585240996092880e-02   +1.671079634173140e-01   +2.268648121416090e-01   -2.797501139760075e-03   +1.740766668347825e-01   +1.543047132263206e-01   +1.274901985389382e-02   +1.208342007252391e-01   +1.569198411994531e-01   +7.742019123282447e-02   +4.129557633384753e-02   +1.627479370279480e-01   +2.288753225419011e-01   +2.137599626885134e-01; +9.251954631136707e-02   +1.040560866102307e-01   +1.643933046302005e-01   +2.112665933520129e-01   +1.195046354922301e-01   +9.368614116855933e-02   +1.913591546544932e-01   +1.698186683874153e-01   +2.092490246575046e-01   +2.971853459630570e-01   +1.758214997425590e-02   +1.000927570867086e-01   +6.187635402013688e-02   +1.609802121613042e-01   +1.366692504908719e-01   +1.668843189366305e-01; +7.405451223059360e-02   +8.940773958688833e-02   +1.160720301173747e-01   +1.278058258956075e-01   +1.967772568148567e-01   -2.350588515272270e-03   +1.774505244393757e-01   +8.470815093084208e-02   +1.433348420893648e-01   +1.259629289224310e-01   +1.758624958380242e-01   +7.902428428739679e-02   +2.532686203728710e-01   +2.748962221843125e-01   +9.354207590105909e-02   +7.965783864042515e-04; +9.518390173509213e-02   +5.829447354546773e-02   +5.044737464110851e-02   +2.175976147553791e-01   +1.777797211396034e-01   +8.087149786298692e-02   +1.196304052710855e-01   +1.514323417190074e-01   +1.731690938264112e-01   +1.865410275571030e-01   +1.196559049114286e-01   +1.474188545565693e-01   +6.230664372358832e-02   +1.264992329951357e-01   +2.238260387569857e-01   +2.276842252078540e-01; +1.244588418411164e-01   +1.087530400737668e-01   +1.306634898660089e-01   +9.469332609978390e-02   +1.132144437455812e-01   +2.839956501070974e-01   +1.546657335283631e-02   +2.001036647545969e-01   +1.124863736446985e-01   +2.300944860921952e-01   +1.195060049928253e-01   +1.535348051425775e-01   +1.609274659121609e-01   +3.101235036231078e-01   +2.296182618108024e-02   +1.859837528484114e-01];
L2I_L1I_iGABA_netcon = [+2.113509822477766e-01   +2.263425612699987e-01   +1.596194519603628e-01   +1.367601754871561e-01   +9.828019784091649e-02   +1.983182312728851e-01   +9.436949675287770e-02   +2.393332806830134e-01; +2.777307829949876e-02   +1.701097791882902e-01   +6.315700722774714e-02   +1.454073836370025e-01   +1.508224509552705e-01   +2.149837667709426e-01   +1.830330339500464e-01   +5.269762424867738e-02; +5.059064967293664e-02   +1.128710800282809e-01   +2.042669799649218e-01   +1.260398304526567e-01   +2.076857671061842e-01   +2.729815674068711e-02   +2.462866673195721e-01   +2.769013983364701e-01; +7.762919985920284e-02   +2.181918124093564e-01   +6.735792300391613e-02   +1.296297299567246e-01   +9.972729620346771e-02   +2.242328414394594e-01   +1.438483762895648e-01   +2.851100808896467e-01; +2.241844415758394e-01   +1.299467826653518e-01   +1.263565153496297e-01   +1.168778407439113e-01   +2.777806636235486e-01   +2.592302296191923e-01   +1.020625928567777e-01   +1.827363111683848e-01; +1.982444682673605e-01   +2.050180801413237e-01   +2.731810362783975e-01   +1.853753702542471e-01   +2.016218347134680e-01   +1.701443101903908e-01   +1.570941012803870e-01   +2.081247674112966e-01; +2.661987237174512e-01   +3.567950655449081e-03   -4.267980034950630e-02   +2.279951130143201e-01   +3.574327626315130e-02   +8.031901705494224e-02   +1.530005712509157e-01   +9.986635474465179e-02; +1.705227430590725e-01   +9.238844498948121e-02   +1.346052165120585e-01   +3.011305900479114e-01   +8.799201821559428e-02   +1.937031068171393e-01   +8.014374330875265e-02   +6.932474690850630e-02; +1.960033186488948e-01   +1.430218780892887e-01   +3.167297324326380e-02   +1.521819531322614e-01   +1.479905820719504e-01   +2.291907335874764e-01   +3.119385519523204e-01   +2.674097176790122e-02; +1.386465967657173e-01   +2.480180626218024e-01   +1.818118203040620e-01   +2.337414533261961e-01   +2.461498126763409e-01   +4.292912219640164e-02   +2.268450795801234e-02   +4.919757813075226e-03; +2.146327421781910e-01   +3.052401648563480e-02   +2.077544342471678e-01   +1.324430611048554e-01   +1.338334065630437e-01   +2.374631507208480e-02   +2.197537585365545e-01   -5.791142312168202e-02; +1.114819106964950e-01   +2.402430938807199e-01   +1.023046376259710e-01   +1.705281732716032e-01   +2.559095371902822e-01   +1.023918436466378e-01   +9.771337186581827e-02   +7.333779788206123e-02; +1.615831336890745e-01   +4.816864663290388e-02   +3.611383864593821e-02   +2.336684151779976e-01   +8.964095353496232e-02   +2.316435945377951e-01   +1.626717904449968e-01   +1.414678800571273e-01; -2.269952050956079e-02   +2.292627870738119e-01   +4.225191525848881e-02   +2.717037625277550e-02   +1.121873267483719e-01   +1.235906122896006e-01   +2.917273828971709e-01   +1.296615910214406e-01; +4.652469987027408e-02   -4.096840037554955e-02   +1.696446887372264e-01   +1.526906645553525e-01   +1.620251315949638e-01   +2.016689148928947e-01   +2.431058627068568e-01   +1.158927308357186e-01; +5.656678590633089e-02   +2.139070403928623e-01   +2.093120001820420e-02   +2.102451526332522e-01   +5.549259503847197e-02   +1.349633719021479e-01   +9.425287363808912e-02   +7.066858919729900e-02];
L1I_L2I_iGABA_netcon = [+4.054197477775107e-02   +1.317870545111423e-01   +6.646500917425052e-02   +2.669674846969997e-02   +2.681674203950754e-01   +1.123926499308577e-01   +8.534509214904837e-02   +1.591872435061898e-01   +1.259676293642159e-01   +5.198742754293314e-02   +1.095616531025665e-01   +1.883137565694094e-01   +3.338291763792296e-02   +2.977814262936271e-01   +4.394438683794548e-02   +1.145060882358964e-01; +2.125327491200931e-01   +2.152183073040262e-02   +1.044381841451138e-01   +2.172494665384496e-01   +7.736847245924225e-02   +1.836017279782012e-01   +2.012004501854467e-01   +1.505378635904275e-01   +2.369938313533599e-01   +2.569072902051954e-01   +1.862877787362048e-02   +5.094201482708817e-02   +1.834093346649799e-01   +8.949084620503187e-02   +5.154505186015469e-02   +1.683451416604633e-01; +1.505293712870941e-01   +1.934326183292642e-01   +1.880215840964441e-01   +1.147415114429756e-02   +1.457084079834773e-01   +5.301099096424041e-02   +6.638002467509538e-02   +1.021584131099349e-01   +1.404267754108184e-01   +2.912890129368030e-01   +2.474477798347350e-01   +9.827164635422365e-02   +1.506045965777803e-01   +9.081375356356954e-02   +8.143194119926271e-02   +1.004244447147932e-01; +1.779340223687062e-01   +1.211951261738017e-01   +1.842369603394574e-01   -1.652333644378040e-02   +1.260838891376482e-01   +5.637204683913682e-02   +1.344455686971108e-01   +1.048472040197505e-01   +1.701898474048397e-01   +2.339620981422574e-01   +2.689656770390019e-01   +1.397020527226536e-01   +2.398334685366752e-01   +1.895381065291046e-02   +3.102204132582260e-02   +2.383500589013461e-01; +1.668740149287778e-01   +2.150408134195697e-01   +1.969568030947442e-01   +9.764034000171576e-02   +1.875468844635740e-01   +3.107747987562124e-01   +1.147737064109862e-01   +1.235431488370870e-01   +1.339867110569377e-01   +1.860538188455285e-01   +1.493475213526377e-01   +2.255476816553347e-01   +2.328140501453981e-01   +3.726469174155021e-02   +1.977821473438333e-01   +3.171103181555492e-01; +9.491150456898392e-02   +1.368176001516001e-01   +1.324529548938341e-01   +1.802404595203674e-01   +3.051910299282687e-01   +1.657422634907790e-02   -2.070655432886874e-02   +1.746957286622116e-01   +1.851206349614154e-01   +2.491500015970191e-01   +1.810892182182180e-01   +1.399244329084746e-01   +1.708168011865283e-01   +1.621350119195778e-01   +1.881954088490471e-01   +2.727945465923779e-01; +2.400156215983750e-01   +1.096844259195994e-01   +2.471228289381500e-01   +2.467590704707677e-01   -1.144450459873886e-02   +2.157602689309236e-01   +1.591258266577219e-01   +8.174422624754268e-03   +5.269244621230306e-02   +2.705087151198488e-01   +2.409235207579879e-01   +2.494946706340643e-01   +1.385017881064803e-01   +4.854302331840643e-03   +1.511713193052927e-01   +1.475190750813830e-01; +7.849197919276074e-02   +7.086115584053530e-02   +1.647565718707051e-01   +1.326840440445099e-01   +7.808627409260302e-02   +2.479397567182328e-01   +1.844615989177520e-01   +3.154189663726126e-02   +2.635514514353354e-01   +1.256824526739008e-01   +2.385345075091454e-01   +2.536591654629596e-01   +2.066713715929336e-01   +1.270432029651507e-01   +1.449559904454762e-01   +5.126364689697092e-02];
L2E_L1E_iAMPA_netcon = [+1.517163151665533e-01   +2.087250939479739e-01   +2.874211771165928e-01   +7.424858784157867e-02   +1.923383032440169e-04   +1.282721201881663e-01   +6.726174377661907e-02   +9.142261813926481e-02; +1.025821756397199e-01   +2.552453403556944e-02   +2.181331523687893e-01   +1.649811015489897e-01   +1.135200638734533e-01   +9.709419562649139e-04   +1.832397947959916e-01   -1.197446573781443e-02; +1.336747355050525e-01   +5.976935166185394e-02   +9.507274974430832e-02   +2.414827751685377e-01   +2.172123673020534e-01   +3.317970840625994e-01   +2.780953828835888e-01   -1.278281883416273e-02; +1.925063453954806e-01   +1.329272253627386e-01   -3.988814170816098e-03   +5.985079702680315e-02   +1.102866777252281e-02   +2.860936515674687e-01   +1.383573160041433e-01   +3.996065744476133e-03; +1.572277092270324e-01   +2.079606753757034e-01   +2.434824352054870e-01   +1.355332325113144e-01   +1.111684470714279e-01   +1.623269519083783e-01   +2.222393468780176e-02   +2.782503111808225e-02; +2.678662394671487e-01   +3.053742716613249e-01   -4.187202597922650e-02   +2.457539792568062e-01   -8.765990528488451e-04   +2.138479865156142e-01   +1.032311014248368e-01   +1.900830337612459e-01; +1.886996060130107e-02   +2.418421643107227e-01   +1.123976053167791e-01   +6.725949963264103e-03   +5.500328870265352e-02   +2.664406865365501e-01   +1.534463449325602e-01   +2.676965377399242e-01; +1.882491533759230e-01   +2.789281756478934e-01   +1.539249226482076e-01   +1.931503878629516e-01   +2.577474162118841e-01   +1.870394092460799e-01   +2.233986033016494e-01   +1.405439417341478e-01; +9.094417773461176e-02   +5.486487183294915e-02   +9.670247912246301e-02   +1.094006120548546e-01   +2.993190777475890e-01   +2.214420921925361e-01   +9.539815994676900e-03   +1.664089208124577e-01; +7.527721429556505e-02   +2.361678176432145e-01   +2.161149275264392e-01   +2.358048001855618e-01   +2.966970352604121e-01   +1.045753609917743e-01   +2.163802818677592e-01   +5.377673438049289e-02; +1.770429049232422e-01   +1.874085755676177e-01   +2.836643106100276e-02   +2.734683942506098e-02   +1.599279050025033e-01   +2.604991785849423e-01   +1.787088054390211e-01   +5.724558945802155e-03; +2.874374950432721e-01   +1.140917500611967e-01   +8.934007898075901e-02   +1.716287298124135e-01   +2.325765591991145e-01   +3.607719470694484e-01   +1.398499546335585e-01   +2.190476964625116e-01; +1.180047429138972e-01   +2.452764159848324e-01   +3.077597226980020e-01   +7.742638977787393e-02   +2.170864090642399e-01   -4.833626750586254e-02   +1.849290508249167e-01   +2.356742467743755e-01; +1.773192405392115e-01   +6.735164340468748e-02   +1.563717291567406e-01   +8.729742528386686e-02   +2.665530438078605e-02   +1.656864507576071e-01   +2.118172917463899e-01   +1.032902634717772e-01; +1.988789925448709e-01   +1.912014329712262e-01   +1.440430069217503e-02   +3.426420262121502e-02   +1.383836665758975e-01   +2.200123088009359e-01   +1.452618771596848e-01   +4.685760655282838e-02; +1.438839331288497e-01   +1.563490352704597e-01   +1.822465142119065e-01   +5.070999832308731e-02   +1.595353573635362e-01   +7.679586157580583e-02   +2.042113234895099e-01   +6.430432470134627e-02];
L1E_L2E_iAMPA_netcon = [+1.043925752896769e-01   +1.233386058520295e-01   +2.462560209308716e-01   +1.459981686058527e-01   +2.044702042564385e-01   +3.692158385606175e-02   +1.575294975116438e-01   +2.458936712696622e-01   +1.349417566643246e-01   +1.323209608797960e-01   +2.032456639267598e-01   -3.481198117440000e-03   +1.382184083776961e-01   +1.766179930415022e-01   +2.020785756644783e-01   +2.653549692365432e-01; +2.291589622285471e-01   +2.681889382005646e-01   +2.099223675090220e-01   +6.566186709537561e-02   +1.223798723959367e-01   +1.912883708158560e-01   +2.461804959332400e-01   +3.083253301569987e-02   +6.502367060353650e-02   +6.289968748430880e-03   +2.540719657796183e-02   +5.685106610845528e-02   +2.578465223785180e-02   -2.611884099391984e-03   +2.620042731881284e-02   +6.876701371905893e-02; +6.716239634397644e-02   +2.639769160903087e-01   +3.000220290806934e-01   +2.261323592329803e-01   +5.902725546405316e-02   +2.184851563976449e-01   -7.401026527817110e-03   +2.369220568877320e-01   +1.784599672746649e-01   +1.315821828087097e-01   +5.801468388803743e-02   +2.053418847327728e-01   -4.915383012691598e-03   +3.268776911476499e-02   +1.345315015692363e-01   +2.117534200626408e-01; +1.262036484710613e-01   +1.183355788038105e-01   +1.223435422962369e-01   +2.732157589981931e-01   -4.137681663284639e-03   -1.329116522156569e-02   +7.407162545932518e-02   +2.037946974413295e-01   +2.490600245115758e-01   +2.377287641135382e-01   +1.872497054377013e-01   +3.804601952377681e-03   +1.107418440794641e-01   +8.009132348962521e-02   +7.004100854562913e-02   +1.517932635989068e-01; +1.950042466642113e-01   +1.046533715195273e-01   +3.201477744319635e-02   +1.471000325081610e-02   +2.648783729156201e-01   +2.447272518990214e-01   +2.632973812613115e-01   +1.525116635951319e-01   +6.317484609989094e-02   +8.188373642113853e-02   +2.312848142983899e-01   +5.881284517513204e-02   +1.643920810981541e-01   +2.226200316438572e-01   +1.091324854263388e-01   +7.087115011305908e-02; +1.300435619258441e-02   +1.273643146304321e-01   +1.850028299002958e-02   -8.925005107796168e-03   +1.889026412541267e-01   +9.716920666980891e-02   +1.442669343277783e-01   +2.521819923531468e-01   +2.504514200354738e-01   +2.276690856290608e-01   +2.658618581240052e-02   +1.793776513948919e-01   +2.217659683475180e-01   +1.347421218854986e-01   +7.231648997512271e-03   +1.039625770546530e-01; +6.020090831156227e-02   +9.427195983127204e-02   +3.971386675645457e-02   +1.225771556427821e-01   +8.482812899124322e-02   +4.972395691726551e-02   -1.979857593369502e-02   -6.783173640089383e-03   +1.206727556992012e-01   +1.529542245917533e-01   +1.052752354380139e-01   +6.412834171643370e-02   +2.796161305154860e-01   +2.189595881109785e-01   +2.507861133020342e-01   +1.199484805839419e-01; +5.606834017699237e-02   +3.686498500546090e-02   +2.263698160149002e-01   +2.612697847031423e-01   +2.404893045534367e-01   +1.304225634291050e-01   +2.577725925117014e-01   +6.124536986377940e-02   +1.294799603724448e-01   +2.358353295466623e-01   +2.751837194719056e-01   +6.996945722251280e-02   +1.421844825819350e-01   +9.373458484378012e-02   +2.301912652859786e-01   +1.694571283834585e-01];
L2I_L2E_iAMPA_netcon = [+9.794331666334570e-02   +2.398306768641085e-02   +2.839224411768985e-02   +1.322450810412802e-01   +2.632917430436277e-01   +1.249023139095111e-01   +3.149795540346666e-02   +1.646180689085570e-01; +6.024345499849071e-02   +9.126292177508780e-02   +2.427674461074021e-01   +1.838714456708489e-02   +1.799979470439932e-01   +1.290613300002317e-01   +7.956977527725642e-02   +1.595875717115048e-01; -4.776693857635084e-02   +2.629852748707076e-01   +7.714148691725582e-02   +1.474685524727163e-01   +2.204822596787728e-01   +2.713315036441857e-01   +1.953399499245976e-01   +7.172815327231215e-02; +2.409932889383645e-01   +2.759513944204413e-01   +2.876626405994741e-01   +1.957026293757339e-01   +1.915764461074675e-01   +1.391762341853041e-01   +1.688631131655313e-02   +1.795106999030306e-01; +2.145767441086319e-01   +2.219676293748502e-01   +6.364351064482175e-02   -2.846288562345250e-02   +1.090989298057507e-01   +2.365871030858875e-01   +6.486312607162868e-02   +2.647347917033980e-01; +1.296735732471220e-01   +1.440793755801051e-01   +2.585924027549550e-01   +1.451415941362764e-01   +3.294039614395407e-02   +5.596578042113021e-02   +3.408053425104504e-02   +1.619478337244127e-01; +9.599065280617611e-02   +1.674005044556265e-01   +2.548925818714269e-01   -5.579852758005731e-03   -4.421904172207055e-02   +6.249057863795263e-02   +1.161957596254777e-01   +2.653448860805570e-01; +3.095871070768016e-03   +1.201472585062238e-01   +1.427035524319799e-01   +3.591461997372578e-01   +2.538079575117191e-01   +2.346728717907449e-01   +2.638160992067655e-01   +9.983623294002478e-02];
L2E_L2I_iGABA_netcon = [+2.510763234843222e-01   +1.294159933817377e-01   +1.912904866445946e-01   +1.046415423040541e-01   -7.997542024419515e-03   +2.430207048144298e-01   +2.666558107533162e-01   +2.383678055842581e-01; +3.267587343271824e-01   +4.177031547883277e-02   +1.005631880434194e-01   +2.833473319916635e-01   +1.953920792426539e-01   +2.073293812814384e-02   +1.048091809156503e-02   +2.066579826105330e-01; +8.987676079151387e-02   +1.748298460631909e-01   +2.144618162037585e-01   +1.305462770122452e-01   +1.155267826912386e-01   +2.454856008453601e-01   -1.206949305498608e-02   +1.461834619786084e-01; +3.100628730027456e-01   +1.432484026944948e-02   +9.268386931338296e-02   +1.787789970308964e-02   +2.403168164366612e-01   +2.385485435419001e-01   +1.950480485611470e-01   +1.332547648100887e-01; +1.628959562901110e-01   +1.682164595428144e-01   +2.998909688382023e-01   +7.063438522469397e-02   +1.777449863704155e-02   +1.990027328333521e-02   +2.202576591892295e-01   +9.556910316926914e-02; +2.214748733475037e-01   +6.961487287380357e-02   +7.492228861225510e-02   +1.241238704073172e-01   +7.100378717150441e-02   +2.800681989732368e-01   +1.549416258620741e-01   -2.186785231055889e-02; +2.096576079171845e-01   +1.801570960023794e-01   +1.638314716749695e-01   -1.019530527981742e-02   +1.002737037920803e-01   -3.266335239341762e-02   +2.253824707567161e-01   +4.153786803100654e-02; +3.876478019277996e-02   +1.264348192774432e-01   +1.531358784523770e-01   +1.497713641988614e-01   +2.268404769435113e-01   +1.671385668606912e-01   +8.422001788816438e-02   +5.978126335537821e-02];
L3E_L2E_iAMPA_netcon = [+1.281888024056123e-01   +1.874219131141291e-01   +8.985946909556870e-02   +3.984533839945577e-03   +1.301817790457613e-01   +2.327824657536586e-02   +2.420836471189841e-01   +1.890145682011783e-01   +2.192494370028649e-01   +1.666890603693625e-01   +7.518175356110902e-02   +2.090575830549735e-01; +1.134009490604260e-01   +2.393207748415845e-01   +2.279202439517008e-01   +2.537043620955205e-02   +2.121571239493930e-01   +2.116046024289789e-01   +2.080906834706104e-01   +4.846852440708006e-02   +2.018838063205891e-01   +6.462980239230079e-02   +1.847189042521004e-01   +2.344704108572996e-01; +2.050287144321885e-01   +1.474030509239206e-01   +2.455690683227117e-01   +2.590617527451024e-01   -2.769734899527965e-02   +8.571234369800992e-02   +1.639379496371282e-01   -9.242540808924195e-03   +1.258357300707044e-01   +2.476442296181177e-01   +1.228944520883962e-01   -1.205428074736345e-02; +2.055626867874594e-01   +1.476252316343192e-01   +3.266016277355187e-02   +6.035595832894099e-02   +2.493159536763376e-01   +1.124942442607008e-01   +4.692486695255937e-02   +1.176511710380258e-01   +3.034726909926302e-02   +1.102313532973950e-01   +1.694599018314625e-01   +1.208423226631377e-03; +2.181254498972663e-01   +2.998899136966882e-01   +2.494385712194069e-01   +2.978195053982710e-01   +2.297187914683906e-01   +2.851639132570175e-01   +1.913717932179077e-01   +3.668383447837914e-02   +1.698608810825954e-03   +4.531892198034526e-02   +1.584232269663744e-01   +1.382068980298816e-01; +7.660903166119351e-02   +1.156020509080947e-01   +4.266415204012090e-02   +1.089411572053822e-01   +1.926683906270043e-01   +1.656078105697901e-01   +2.755305414868922e-01   +2.638504901089704e-01   +2.561900209352715e-01   +9.616811634930861e-02   +2.905558195158437e-01   -1.159511890039943e-02; +2.189856097593394e-01   +6.591580067801808e-02   +7.904231029430359e-02   +4.228516430430456e-02   +4.071310989741678e-02   +9.109523265199679e-02   +1.495236063700587e-01   +1.105661782683837e-01   +5.994503652205773e-02   +9.019363012522130e-02   +2.518719088056086e-01   +2.667089481844075e-01; +2.582037451092573e-01   +2.414592828323928e-01   +1.271954372806103e-01   +2.121312304596717e-01   +1.925265238583321e-01   +1.030915414834356e-01   -2.456217192918733e-03   +7.928506487707360e-02   +7.305345345423669e-02   +2.655012576626961e-02   +1.506013442871721e-01   +4.381048966982199e-02];
L3I_L2I_iGABA_netcon = [+1.469958886602810e-01   +2.807282922942290e-01   +2.565831353885134e-02   +2.271696559511786e-01   +1.073500362108265e-01   +2.303067457532851e-01   +1.978613454645946e-01   +3.313883204619672e-02   +3.561200916087502e-03   +2.180213957691166e-02   +1.989239835361835e-01   +7.998264959516709e-02; +1.721924607729974e-01   +1.964231417525957e-01   +1.449637754534275e-01   +1.977454994592285e-01   +2.170825797945989e-01   +1.043553873574830e-01   +2.795630414195711e-01   +5.606859821052041e-02   +6.176127251515093e-02   +9.626444272853854e-02   +1.269076361825154e-01   +2.791114708522830e-02; +1.492254018691836e-01   +1.872307768355824e-01   +1.835057798737848e-01   +1.661826920578091e-01   +1.535325383082395e-01   +1.557968257883433e-01   +1.239325129412989e-01   +1.854173139936116e-01   +1.844315453792773e-01   +3.289500239690078e-02   +2.290651828887424e-01   +1.962984265719145e-01; +2.541367522373524e-01   +2.742012265128223e-01   +2.640363403139984e-01   +8.496541317444885e-02   +1.672275386924201e-01   +2.725063592588692e-01   +3.800734143883273e-02   -8.455144658419352e-03   +2.390330936812108e-01   +2.330411973478484e-01   +3.998617173809857e-02   +1.934951747870453e-01; +1.024110808293624e-01   +2.574355215309166e-01   +2.757029301475420e-01   +2.294656131566194e-01   +2.496055624186329e-01   +7.755503528170909e-02   +1.101090357567975e-01   +1.837195766620501e-01   +1.075362590372331e-01   +2.422320271743915e-02   +4.872076218027727e-02   +4.517509680938639e-02; +1.223137546622668e-01   +9.055391009258507e-02   +2.105341197407295e-01   +1.183487748598162e-01   +1.751111132840225e-01   +2.163032052527308e-01   +1.276092818222568e-01   +1.450208749253450e-01   +4.500119539398013e-02   +9.580535708049601e-02   +1.619110065613483e-01   +1.598827304556028e-01; +1.160461791551274e-01   +8.988657443599248e-02   +2.832517014951831e-01   +2.288971130688027e-01   +1.334290162667033e-01   +2.391532823181121e-01   +3.467669561541664e-02   +4.735131165000869e-02   -1.116618554187991e-02   +2.108902518812853e-01   +2.743069363356332e-01   +1.008903641779361e-01; +1.449447640920003e-01   +6.306331630757125e-02   +2.212403356629480e-01   +4.196490553894099e-02   +2.233393485833159e-01   +2.606625767402782e-01   +2.155853094944998e-01   +1.971415231992654e-01   +1.176246217888219e-01   +1.924538112709681e-01   +8.186066986142021e-03   +2.384416474650155e-01];
L2E_L3E_iAMPA_netcon = [+2.042539351881666e-01   +1.058026160610415e-01   +2.272563554866452e-01   +1.745577495104618e-01   +1.413777333119180e-01   +1.289127647734816e-01   +1.526341710019461e-01   +5.275524330517972e-02; +1.596827066543569e-01   +1.734949006820455e-01   +1.959630004483401e-01   +1.553253843491658e-01   +2.467216121522795e-01   +1.002091783482393e-01   +1.287611913868271e-01   +2.356579270194983e-01; +4.721160064311566e-02   +4.003850034561588e-02   +1.896941456967563e-01   +2.164298214014101e-01   +2.059124952630537e-01   +2.428335432692055e-01   +1.732204826749673e-01   -3.276771639092099e-02; +9.238071332119457e-02   +6.334239625679636e-02   +1.457385473403829e-01   +2.387860664754485e-01   +9.638582006116009e-02   +2.621758143379077e-01   +1.809516726312450e-01   +8.298295866546787e-02; +8.158597341142181e-02   +1.778511602494962e-01   +2.935761663729407e-01   +1.520488538996810e-05   +1.957262562984383e-01   +1.971559656866305e-01   +1.897483182618871e-01   +5.522241777683990e-03; +4.385916515492011e-02   +2.620436298067547e-01   +2.041328796366537e-01   +3.666403928282175e-02   +2.929611877114608e-01   +1.377823636160077e-01   +8.486811832940347e-02   +2.032212775394445e-01; +1.087964453665521e-01   +5.490918382244406e-02   +1.471199676973965e-01   +5.671843528589716e-02   +1.000856477906908e-01   +1.579528130059803e-01   +2.192015556915473e-01   +1.771807133536888e-01; +1.388136196869914e-01   +9.689008380165462e-03   -2.873079240145124e-02   -5.796159374623374e-03   +2.597450782671964e-01   +1.121028013857925e-01   +4.171622374648404e-02   +2.214018260828656e-01; +2.892778573966813e-01   +2.266779338442632e-01   +8.240085552393371e-02   +2.375103896357177e-01   -1.852963232023980e-02   +1.220406299598939e-01   +2.153621142180144e-01   +9.625679315889582e-02; +3.399063650395323e-02   +9.563627022551768e-02   +2.517039196084758e-01   +2.831224840070046e-02   +7.428522756277676e-02   +7.782385712627395e-02   +2.817395406346922e-01   +2.464405536264614e-01; +1.972231358327314e-01   +1.659117919715766e-01   +1.096994355342672e-01   +1.527747368771853e-01   +1.138396591891619e-01   +1.372697387875527e-02   +4.487576944081175e-02   +2.148201947246557e-01; +2.221176857961253e-01   +5.505164930320825e-02   +2.842128013988105e-01   +2.209771854184369e-01   +1.994863384901148e-01   +2.748812635989250e-02   +1.400832008344299e-01   +2.246600020922952e-02];
L2I_L3I_iGABA_netcon = [+1.027709317675386e-01   +9.855798609913050e-02   +5.765588859874624e-02   +1.945290886045090e-01   +1.540681373636851e-01   +1.787553296649350e-01   +1.078895183088848e-01   +1.357290676982421e-01; +1.472243824940569e-01   +2.459767959716497e-01   +7.916269213881758e-02   +2.447172171369000e-01   +4.334601183208249e-03   +1.753708129202934e-01   +8.462607305127781e-02   +1.076594756244205e-01; +4.450192342613644e-02   +1.787925229821212e-01   +2.070264702167460e-01   +1.812439714548806e-01   +1.617358402184036e-01   +1.629478235892539e-01   +1.867183024095262e-01   +3.029629163028196e-01; +2.260643016375203e-01   +3.873454870551446e-02   +2.527518168844721e-01   +8.881403074700797e-02   +1.504497913949662e-01   +1.898215388273499e-01   +2.846019884613566e-01   +5.008029390962700e-02; +1.470983609806232e-01   +3.104958852613672e-01   +2.253678730574376e-01   +1.702318000099525e-01   +1.275652397549361e-01   +2.262395896318180e-01   +2.718963012267506e-01   +1.662681426725347e-02; +2.145145187125491e-01   +1.454962085354856e-01   +4.961071315117316e-02   +3.285479391550393e-01   +5.736539055652175e-02   +8.454560393104865e-02   +1.139986405921920e-01   +2.242703364243517e-01; +5.047478432785901e-02   +2.779091666869964e-01   +8.595346400729914e-02   +2.526302250931903e-01   +7.255948912982928e-02   -3.861960308770694e-02   +1.842168790148272e-01   +2.175795812991435e-01; +1.194669457247467e-02   +6.104167732365891e-02   +1.465128302851203e-01   +9.865135016749881e-02   +1.939735173550247e-01   +1.646116680824517e-01   +1.168974955157397e-02   +9.736401856406350e-02; +1.477407553144923e-01   -1.563041191962666e-02   +2.476100808268916e-01   +3.040940863061156e-01   +1.488572019511920e-01   +6.259062871659944e-02   +9.358068799489802e-02   +2.584245061583930e-01; +8.773994560642906e-02   +3.914876366416889e-02   +6.306959081832128e-02   +1.682278628884155e-01   +2.547737885410434e-01   +1.101524175888950e-01   +2.412084439317754e-01   +1.591935166886255e-01; +1.566168863241774e-02   +1.926252149567024e-01   +4.615381435128278e-02   +1.549408972917583e-01   +1.483134687819236e-02   +1.947257506847802e-01   +5.527773362345235e-02   +9.745240721990819e-02; +1.330196136775332e-02   +8.650766926551198e-02   +3.886014021220974e-02   +7.031303262847244e-02   +1.555725425705342e-01   +2.747751003047154e-01   +8.521263190548291e-02   +6.962277230527415e-02];
L3I_L3E_iAMPA_netcon = [+1.338902317395345e-01   +1.545107012268583e-01   +1.635194961492564e-01   +1.916285257415385e-01   +3.991006506455341e-02   +2.217101030370328e-01   +9.303915234659904e-02   +3.674206763965317e-02   -4.063811470372401e-02   -9.634316689432250e-03   +2.093547411819970e-01   +1.738076152219605e-01; +2.288209561106829e-01   +1.104205424429905e-01   +1.259689508913204e-01   +2.789261391348778e-01   +1.832408585921189e-01   +1.947285681230489e-01   +2.493840503734160e-01   +3.222241723407942e-01   +1.186386107016311e-01   +1.116904886401192e-01   +1.575144722236755e-01   +2.872899207647207e-01; +8.375353817671215e-02   +2.208740752104512e-01   +1.155255825297494e-01   +8.098015713182358e-02   +2.172534762163826e-01   +2.410812749810626e-01   +1.955824692821007e-01   +2.141406584144191e-01   +6.559175281885506e-02   +2.160406602961359e-01   +6.001464559742013e-02   +2.788302628008614e-01; +2.419536959972096e-01   +1.137345128805711e-01   +1.656963751502931e-01   +2.344799010904450e-01   +9.967613308104686e-02   +6.958324128584532e-02   +1.465086919853548e-01   +2.405162591606423e-01   +1.751648404936119e-01   +2.209161169132723e-01   +7.584956940270457e-02   +2.054743913241001e-01; +5.006258373745368e-02   +2.432223546091837e-01   +9.993216899255815e-02   +3.158812500045368e-02   +8.186886247559386e-02   +3.711928281378064e-02   +3.433809711557978e-02   +1.153538528528648e-01   +1.240372716581972e-01   +7.026126001888557e-02   +2.237921160173296e-01   +2.237655404101556e-01; +1.204758579616806e-01   +2.471621333186130e-01   +1.196166691714085e-01   +2.558473504982836e-01   +4.159817255491022e-02   +3.725555914667670e-02   +5.426919475619874e-02   +3.471070068444738e-02   +8.641489255420318e-02   +3.056571180246211e-01   +2.039444415941705e-01   +6.358853323532211e-02; +1.744206428082929e-01   +1.719092524717688e-01   +2.160122310154941e-01   +2.460396413367716e-01   +1.658869054988021e-01   +1.158045603681033e-01   +7.679947030593261e-02   +2.880372626098152e-01   +2.101879039647136e-01   +2.813831540408883e-02   -1.322611588889909e-02   -2.741461093003827e-02; +3.019881460823619e-01   +2.578902613709150e-01   +1.556951956648776e-01   +1.673655119865764e-01   +1.827545368111233e-02   +5.628157256869565e-02   +1.865458692134863e-01   +2.663520618376429e-01   +1.976248846641137e-01   +2.242111016879276e-01   -1.316409726332415e-03   +1.713798625401512e-02; +3.630664398588632e-02   +6.740366394095652e-02   +1.277594209419520e-01   +6.290863067739805e-02   +1.174125623526577e-01   +6.819386557989528e-02   +2.172345223201196e-01   +6.315110134742244e-02   +1.614231034913436e-01   +2.124845645323118e-01   +2.031007311457927e-01   +2.614986272165834e-01; +1.791578397951967e-01   +8.880493488160277e-02   +1.917345951673390e-01   +1.161748150816937e-01   +5.052244681852919e-02   +1.554791049722249e-01   +1.064817519956112e-01   +3.387254486258115e-01   +2.105007997450591e-01   +1.265645578350325e-01   +6.928374114123856e-02   +2.636412893135062e-02; +2.208826021719764e-01   +1.852228337354264e-01   +9.117379343090050e-03   +3.366568462845852e-02   +4.435644993807222e-02   +2.138444415210948e-01   +1.281047053604676e-01   +2.195827834688821e-01   +6.778730054443462e-03   +7.736040990750420e-02   +1.657281457204118e-01   +2.053399467298340e-01; +1.491251919725605e-01   +5.246104482686585e-02   +1.119040240301734e-01   +3.098295926481888e-01   -3.282163203428069e-02   +3.255530436009085e-02   +1.618669954023171e-01   +1.911171579317829e-01   +5.779156080317114e-02   +3.515117599840214e-02   +1.221039088885151e-01   +2.510610727072388e-01];
L3E_L3I_iGABA_netcon = [+1.535591704322650e-03   +2.289999927842237e-01   +1.365216550786265e-01   +2.398113943436599e-01   +2.331802312824562e-01   +1.935634768658104e-01   +2.253671743064858e-02   +9.732665138402460e-02   +1.608530805337951e-01   +2.464377897667261e-01   +2.614858488718243e-01   +1.399532056382994e-01; +1.709832788865947e-02   +4.888589613062226e-02   +2.718266566092812e-01   +1.665588657978428e-01   +1.084241235513455e-01   +2.274481404859212e-01   +2.468196511701985e-01   +1.480990959139652e-01   -3.911996701886077e-02   +2.716018735850653e-01   +1.535810133354884e-01   +1.829296235768451e-01; +2.002341878788542e-01   +1.668284912528822e-01   +2.257347308225563e-01   +2.253340572400492e-01   +6.692041460292501e-02   +2.292036498237112e-01   +1.217511053119924e-01   +1.220311606601112e-01   +1.261940959788118e-01   +2.017238151461703e-01   -1.229503708699954e-04   -1.656455668497102e-02; +1.895518986489954e-01   +2.038249691131251e-01   +4.856113833244078e-02   +6.691021187897953e-03   +1.117147693888486e-01   +2.611235049187599e-01   +1.023773758124135e-01   +2.066625789942195e-01   +1.469158164441180e-02   +3.408989231425800e-02   +1.858591175927640e-01   +5.000847200931905e-02; +2.260955304175646e-01   +2.252188179583215e-01   +2.926500999043821e-01   +1.171015352341093e-01   +2.588090004405798e-01   +3.786064128630652e-02   +1.996230788385149e-01   +8.618094449988203e-02   -1.637046406787077e-02   +2.833926962164966e-01   +1.201368807302859e-01   +1.239461171659461e-01; +4.860671590117711e-02   -2.512013719630277e-02   +3.842749846799413e-02   -2.936151509473021e-02   +7.821758231101874e-03   +3.062445746328384e-01   +9.611448043354567e-02   +1.649607241544426e-01   +2.442016473984281e-01   +2.337642572154794e-01   +2.620196679235995e-01   +3.220141818705011e-02; +2.705171800781254e-01   +2.293047624983006e-01   +1.287858486204157e-01   +2.036865002478341e-03   +2.190534812183043e-01   +2.193104229219761e-01   +2.288700193093571e-01   +2.224098627758114e-01   +1.992410681139364e-01   +2.544351905974754e-01   +2.104911098159443e-01   +4.938987740186879e-02; +9.750944142239631e-02   +9.782198871888392e-02   +1.815378526150574e-01   +2.709042880256891e-01   +1.701872505789852e-01   +6.241860974186696e-02   +1.412385507858840e-01   +1.587363665310223e-01   +1.314132175793113e-01   +1.128067230524813e-01   +1.698511575525521e-01   +2.161433138075532e-01; +2.425138675493433e-01   +1.311613557240695e-01   +2.588345258946712e-01   +1.553517492569909e-01   +2.560340650229903e-01   +1.237630285869465e-01   +2.009435983354473e-01   +1.580444228334751e-01   +1.206038204631356e-01   +2.587653132845458e-01   +2.190673079750671e-01   +2.101955580988049e-01; +1.899378646788717e-01   +1.485328547433298e-01   +1.868136562588373e-01   +2.603434937791752e-02   -2.256522841168639e-02   +1.860667133017463e-01   +1.042514747951321e-01   +1.019321808390188e-01   +1.670007466156639e-01   +1.382214321009462e-01   +9.177786784421037e-02   +4.175046894112493e-02; +1.056942106967773e-01   +2.272363387394634e-01   +1.487742615534393e-01   +2.548937817695262e-01   +1.095804638857080e-01   +2.743019768924584e-02   +3.327411124056662e-02   +5.212412631763081e-02   +1.011562056342422e-02   -1.744912899718174e-02   +2.890763322031564e-01   +1.996427368922690e-01; +9.970132075664935e-02   +1.476828114000913e-01   +5.570022017984338e-02   +1.143722345008459e-01   +1.588727979595202e-01   +6.750050030887086e-02   +1.539757991603093e-01   +1.480215019263101e-01   +9.298649375943824e-02   +4.583898848868614e-02   -1.452723985327240e-03   +5.576407469716001e-02];
L2E_Input1_iAMPA_netcon = [+1.555196970975525e-01   +6.392554525462306e-02   +1.613789763587199e-01   +9.003025273346731e-02   +1.593020451970798e-01   +1.850681884382475e-01   +4.774925697340910e-02   +1.422663446023046e-01];
L2I_Input2_iAMPA_netcon = [+1.081519189654661e-01   +5.712870500029545e-02   +2.722673030196066e-01   +2.438722813442599e-01   +1.086119456350477e-01   +1.677834958505295e-01   +1.696607835208659e-01   +2.522842495212159e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
