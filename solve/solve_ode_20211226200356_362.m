function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.045528436916451e-02   +1.401921187048846e-01   +2.619941788952567e-01   +1.510300008996290e-01   -3.127867810291119e-02   -9.411197988557597e-02   -2.752753422400411e-01   -1.697653015424560e-01   -1.946746265814073e-01   +4.181095519531688e-02   -1.018817553113399e-01   +1.114727710892718e-01   +2.754636708183767e-01   -2.716897791732429e-01   -1.282132138773440e-01   +5.055963026345842e-01; +1.865394024524106e-01   -1.221528835845751e-02   +2.197893463118227e-02   -6.294239211476621e-02   -6.698554395390997e-02   -3.352810738475597e-01   -7.316065062431780e-02   +6.516490193003562e-02   -5.507719927106190e-02   +9.583862258082881e-02   +1.204027976254340e-01   +9.301203069035645e-02   +6.525559297935250e-02   +2.029738052901474e-01   +2.955151025561861e-01   +1.923515477689211e-01; -4.596586787594429e-03   +3.400291795970822e-02   +1.209916780339068e-01   -1.755986114439361e-01   +7.506622131222332e-02   +3.809679626782508e-02   -4.266848327089676e-02   +4.210701015304400e-01   +2.970185720732887e-01   -1.633808435412824e-01   -8.865541057238738e-02   -3.203702642223769e-02   -1.500832418017346e-02   +2.632540053473859e-01   -8.569253787737779e-02   +1.628077608747009e-01; +3.403641281177997e-02   -1.941378864904575e-01   +2.160950156247604e-02   +1.060139926696471e-01   +8.675323440612537e-02   -3.398962955297682e-01   -1.582447732877822e-01   -5.927833770443214e-02   +1.710541611837970e-01   +1.464579521118032e-01   +2.876869414666227e-01   -9.679295105657472e-02   -2.659543146456247e-01   -1.634036305765971e-01   -1.204971815886265e-02   -3.764727533882210e-02; -2.997497335936605e-01   +2.304258082386388e-01   +2.857611531734466e-02   +9.100626369075321e-02   -2.803189816656304e-01   +1.665112653161303e-01   -3.133160611437728e-01   +3.119264768094881e-01   -1.144589958911311e-01   +8.653007395265068e-02   +2.083688250364784e-01   -7.121250346231450e-02   +1.843341382004567e-01   +2.201259908612107e-01   -2.583643887355346e-02   -1.038614311221114e-01; +9.524199338515588e-03   -4.105426933486459e-01   +1.958075178973829e-01   -1.345277789790851e-01   +1.342288979506076e-01   +2.228602187181045e-01   +1.147536633275963e-01   +1.236928719251081e-01   -2.864435761914759e-01   -1.338382916975155e-01   -2.820696286937228e-01   -1.552348522444047e-01   -4.360850705249066e-01   -2.103425937248946e-01   -4.993184169102887e-02   -3.034370156450688e-02; +4.420067859210040e-02   +9.594649566903515e-02   -2.224678251177557e-01   -2.053503642047245e-01   -1.978863114439351e-01   +1.176244862064948e-01   +1.717383091894244e-01   -2.068701531229042e-02   +1.009926625456739e-01   -1.163984175100819e-01   +1.165403178203156e-02   +3.237465367503412e-03   +2.706112137122157e-01   -1.481390685900960e-02   +1.808619566517792e-03   -1.468560853521984e-01; +4.266742951893058e-03   -2.498029770025703e-01   -6.689687659262515e-02   -1.569370177878919e-01   +1.640175606793990e-01   -1.305307965431190e-01   +7.357148271410395e-02   +5.552971264089214e-02   -7.554159340588039e-02   -6.994230397823608e-03   -1.233610988910357e-01   +6.737098644679282e-02   +1.150596549282774e-01   -9.109353159544752e-02   +3.234478320642292e-02   +1.570530744633923e-01; +9.192704058388494e-02   +8.187842417493868e-02   +2.919557403425990e-02   +3.828304836126244e-02   +4.642267720123050e-02   +2.656966509468451e-01   -6.819568818269894e-02   -2.108345027199678e-02   +6.792491773073860e-02   -8.019449392538157e-02   -4.748237444322666e-02   -2.128886018705705e-01   -5.827582115422034e-02   +4.811949355304149e-02   +2.717358920235527e-02   -2.239196008806400e-01; +9.030251262841552e-02   +8.627445955216410e-02   -1.660206939032482e-01   -5.826056525097476e-04   -8.258698414882731e-02   +4.423895353974543e-02   +1.793142608414730e-01   +1.497761006757857e-01   -1.805155248174817e-01   +1.910281465048369e-01   +4.465459130460246e-01   -2.806425571329979e-02   +2.293753956476167e-01   -1.986066321725340e-01   -5.577182871745150e-02   +7.507000884294168e-02; -1.216032281563249e-01   -1.699529383306532e-01   -3.919344822767374e-01   -2.947943366572103e-01   +9.268292090662902e-02   +2.904613352455637e-01   +1.215065311109911e-01   +1.451052834003436e-01   +9.116951822419514e-02   -1.696635367598272e-02   +5.283068614390173e-02   -1.912918212066148e-01   -5.299466880241679e-02   +6.826859345768415e-03   +3.374225998456849e-01   +1.732899982621765e-02; -2.781441226947275e-01   +2.278528368079550e-01   -2.853988489947187e-01   -6.719356690391773e-02   -1.664480294943554e-01   +3.586249840939812e-01   +7.335849436099556e-02   +9.427360286654662e-02   +3.484039422152523e-02   -3.689252396003473e-01   +1.061893602720590e-02   +2.592056609896632e-01   -1.802805471396217e-02   -2.287563775988411e-01   +6.718444584797251e-02   +3.427526054161182e-01; +6.082861305706430e-02   +1.838211408755584e-01   -3.171710057244363e-02   +1.929399389362345e-01   -1.558277232824160e-01   -4.395859943160581e-02   +7.601822567457155e-02   +2.075424890826300e-01   -9.004060174994229e-02   +3.286117032396382e-01   -3.105318766547255e-01   -2.047918885054100e-01   -1.794917552598591e-01   -6.198399201683991e-02   -1.942378611800218e-01   -1.791905807936328e-01; +3.431194532449831e-01   -6.507135692461703e-02   -5.575704349507076e-02   +1.698626755078114e-01   -7.188084003281087e-02   -1.229208659809888e-01   +1.830704476916943e-01   -3.061518592152456e-01   +3.375897784857498e-01   -6.369897416428794e-02   -1.667442754106214e-01   +9.249494935887004e-02   +2.381348604654114e-01   -4.941471448163813e-02   +1.368617949128287e-01   -1.024161135010096e-01; -1.817412780212521e-01   -1.520670091159024e-01   -3.603167470932190e-01   -1.822793474802780e-01   -9.884170022362446e-02   +3.069916369894290e-01   -3.146291716522541e-01   +2.466126401267428e-01   +1.123382890288444e-01   +3.851949055716562e-02   -5.845820256676483e-02   -1.062456748546353e-02   +5.299704639324084e-01   -7.122366471169299e-02   -7.125835650283805e-03   -5.917378705637793e-02; -1.862825351277524e-01   -1.979676548063834e-02   +1.591699330130380e-01   -2.013442865821438e-02   -2.654921810949924e-01   +1.047632692491447e-01   +9.127103352534868e-02   -2.418057068459655e-01   +4.741284222152869e-01   +7.610540208701938e-02   +2.704722948588300e-01   +2.555865293755645e-01   -1.802713815961114e-01   +1.980546005218189e-01   -9.068912245042818e-03   +1.228753063013625e-02];
L1E_L1I_iGABA_netcon = [+8.737447496508481e-02   -1.616169793606506e-01   +7.713960305704008e-02   +2.597241371284547e-01   +4.155911914483938e-02   -1.185359615661825e-01   -3.492429490274401e-01   +1.800869535725129e-01   +2.034490162928107e-01   -2.570652560149844e-01   -1.501756527760544e-01   +1.626884518624072e-01   +2.311011092975252e-01   +3.549988012264252e-01   -1.689548737432434e-01   +5.094746423788599e-03; -1.345054142592089e-01   +4.852568771664054e-02   +1.246640593607718e-01   -3.848461081238417e-01   -8.696453211049651e-02   +2.610409720744522e-01   -6.268464436699331e-02   +1.628820599165104e-01   +1.093694063714906e-01   -1.337002162958968e-01   -5.759835785843717e-02   +4.451442228878332e-01   -1.584143657272769e-01   +1.717699584092068e-01   +1.718351415556110e-01   +8.180604343991760e-02; +1.954362823060457e-01   +3.718280357342697e-01   -5.040059809087653e-02   -2.157870437278619e-01   +1.343181228584120e-01   +9.735928724134411e-02   -7.121652009912296e-03   -1.469947830030993e-01   -5.023260143633845e-02   +2.450795909800083e-01   -2.474376059922868e-02   +2.456258113106842e-01   +1.454075222988837e-01   -2.220920450998435e-01   -6.177943222731989e-02   +1.046071447698624e-01; -1.101856352451016e-01   +8.671698336863375e-02   -2.980764597445389e-01   +1.446110910644377e-01   +3.914210123485902e-02   +3.311188104136765e-01   -1.262605598777984e-01   +7.966444765152594e-02   -3.518773589782280e-01   -2.118341253141302e-01   -2.406933063441079e-01   -1.182131749323069e-01   -3.560530496139205e-02   -2.260350242910561e-01   -1.533138332501467e-02   +1.274353446977155e-01; +3.706695282940142e-01   +7.318894848254417e-02   +1.808636497888204e-01   -1.696351013275865e-01   +1.535527210495616e-01   +3.493441427863045e-01   -2.539466545786425e-01   +3.607951728277131e-01   +2.822679056868109e-01   -3.974879875910566e-02   -2.032712965094908e-01   +1.625365993535383e-01   -4.685627815695404e-03   +1.559896401715601e-01   -3.480356845262235e-02   +2.142501431244505e-01; -1.039014976368035e-01   +4.618836456596213e-02   +2.291531669191346e-01   -3.443723605441559e-02   -1.452864063258437e-01   +8.580813275741304e-02   +1.762670561331835e-01   -5.026831308210339e-02   +4.439579331494988e-02   +3.363096681189782e-01   +2.621988715636067e-01   +2.136902588474162e-01   -2.747892269893548e-01   +7.439638448185280e-02   -2.513093369240720e-01   -4.078494075183213e-01; +4.880349865269173e-02   -2.930609519706110e-01   +4.111080367272962e-01   +2.820658105640487e-01   -1.267924167516672e-01   +2.559761601437430e-01   +2.013663121970330e-01   +2.096759298858892e-01   -1.516686316366645e-01   -2.848233847591319e-01   -1.340715311898078e-01   -1.047400084484376e-01   +1.829999046215259e-01   -1.607604066007334e-01   -2.805158888610070e-01   +1.344875997945432e-01; +1.919858866494588e-01   +3.403174703028223e-01   +3.288789541545673e-01   +1.266768742583917e-01   -3.047930048654358e-02   -2.678126343735214e-01   +3.520120371490301e-02   -1.483610131183858e-01   +2.541477273263454e-01   -5.787528660890514e-02   -1.463475431662111e-01   +1.556140059968541e-01   +1.417914629406787e-01   +3.734458377567433e-01   +1.535761717490280e-01   +7.481344432437120e-02; +2.630769930376188e-01   -6.151642856580609e-02   +7.666321911940843e-03   -7.867916117306453e-02   +2.924530831357794e-01   +1.370173176389073e-01   +2.527752767758646e-01   -1.620171114236854e-01   -8.273862944659972e-03   -1.128125029379999e-02   -2.978210190035613e-01   +2.970994193799688e-01   +2.880585205396970e-02   +2.853813182241686e-01   +3.275397885300502e-01   +2.734641125643114e-01; +3.194359330888304e-01   -2.186856916742398e-01   -1.394331557573317e-02   +1.790784736895243e-01   +3.072624240527781e-01   -6.060631484664841e-02   +1.136917587393799e-01   +2.078589516372460e-01   +1.179499219599397e-01   +1.840471628072896e-02   -2.663213126133710e-02   -3.322379030437557e-02   -2.971088635571718e-01   -2.821546122567490e-02   +3.850275563647981e-01   +1.697608445432279e-01; +1.607350759699788e-01   +1.541601897169362e-01   +5.979545003391318e-02   +2.871601616441886e-02   +1.859342494762219e-01   -2.280292380219017e-01   -2.092373019199487e-02   +1.580565804810224e-02   +5.238408211211962e-02   +7.517591285989239e-02   +2.387608644196010e-01   -3.982969249505659e-02   +8.355093372266159e-02   +3.733396306822719e-01   +3.192887167361141e-01   +1.921007886691215e-01; -2.389429328015084e-01   +1.015536646612338e-01   +1.098204836872701e-01   +1.896180163449896e-01   -9.370521690254879e-02   -1.907561789179832e-01   +1.933944971580109e-01   -6.141292524273683e-02   +1.022210018581372e-01   +1.487381121925936e-01   +5.253009438276977e-02   +1.300597996721872e-02   -1.822880534949324e-01   -1.215492097130093e-01   +2.097174864641856e-01   +2.431764505643687e-01; -2.011677348661439e-02   -1.999711877864422e-01   -1.410792800348155e-01   -3.682679158545262e-01   +4.225965398277843e-01   -1.607194602962795e-01   -8.248885438724765e-02   -1.051542292184365e-01   -9.220030790146483e-02   -2.740251469752710e-01   +4.390241882060578e-01   -1.716600606832312e-01   -1.982116392665010e-01   +1.452224187825717e-01   -1.735810049457760e-01   -7.460459131502752e-02; +2.471912600952468e-01   -2.920221064189151e-01   -1.049647602121303e-01   +2.329729521403913e-01   -5.906378557877948e-02   +1.577795989276552e-01   -2.017386732139976e-02   +4.996154181215472e-02   +1.797209203491466e-01   +1.937021573465708e-01   -1.507854860161498e-01   +9.313110713021767e-02   -2.855309499485821e-01   -2.703309392169019e-01   +5.225543415717789e-02   -1.082277967389238e-02; -1.681695811274759e-02   +1.061851825540711e-01   -1.552614050986464e-01   +2.160801297110569e-01   -6.834523222445141e-02   +5.500415817398223e-02   +2.830502787527531e-02   +1.070277150600648e-01   -6.790125921082366e-02   -1.461862993929132e-01   +1.285227711380063e-01   +6.222805979951719e-02   +1.137681829183651e-01   -1.728288196856489e-01   +1.525982637208146e-01   +3.543445199240843e-01; -1.200455555412590e-01   +2.874585054966332e-01   -2.548995633294354e-01   +1.061242635863918e-01   -8.664771090642462e-02   +2.321927621358854e-01   -4.806564348214340e-02   +2.472000029003617e-01   +5.300798168896657e-02   +1.116543362970587e-01   +2.944033792578488e-01   +2.444912979771950e-01   -5.263414249103694e-02   -1.528188518733957e-01   +1.327117583026797e-01   +1.702225955661039e-01];
L2I_L1I_iGABA_netcon = [-1.323397586359121e-01   -1.232593570223375e-02   -5.737972858714224e-02   -3.359049417484900e-02   +2.935526168583673e-01   -4.912276561932950e-02   -3.714593754031890e-01   -1.026829059558706e-01; -1.381821688867821e-01   +3.193966739210549e-01   -4.551996373167690e-02   +1.064818810756202e-01   +2.564108482714282e-01   -1.498019802641084e-02   +2.761566288576511e-01   +5.983094752678355e-02; +3.433787366613525e-01   +1.839239409371725e-01   +1.694274819423332e-01   -3.352481689642499e-01   +1.366516368587940e-01   +3.959458331163297e-01   -5.146247381229185e-01   -1.189187218782130e-01; -1.057711988800706e-01   +1.440895560824326e-01   -4.033456656370571e-02   +9.931162258682430e-03   +9.334779302989685e-02   +3.877508959739392e-01   +3.886691746979164e-01   -2.962718568217752e-01; -2.146463249782902e-02   -2.526600610462710e-01   -1.870995112584906e-01   -2.467955639673782e-01   +1.325518669191870e-01   +3.124690183312796e-02   -2.435958938383495e-01   +1.273037896372029e-01; -2.519868929056923e-02   +1.595988233270302e-02   +4.814061870889352e-02   -1.411008466672936e-01   +1.132669348175347e-01   -1.341330478476346e-01   +1.510441224682724e-01   +2.040693445357202e-03; +1.319814157825161e-02   +7.130313412290071e-02   +4.266030994198353e-02   +6.658036040541460e-02   +5.822693199165077e-03   -6.063801584381634e-03   +2.252117672317904e-01   -1.126226979821405e-01; -1.921170486254600e-02   +1.484218393704443e-01   +2.858669926993360e-02   -1.295200762546864e-01   +1.668619410313374e-02   -8.333161544985034e-02   -2.323870256783294e-01   +1.442360728416019e-01; -1.948914653985460e-01   +1.207669578187292e-01   +2.296673118969686e-03   +9.969968995612132e-02   +8.045184540675167e-02   -2.090717532411130e-01   +1.762591416007734e-01   -6.518787308629856e-02; +1.298018267066245e-01   -2.353106004401102e-01   +1.876229288249853e-02   -2.341720328528553e-01   -2.916827491761868e-02   +6.377707162034907e-02   -1.464415920924100e-01   -3.002909575542674e-01; +1.562984801125337e-01   -1.589182930465716e-02   +2.850818031433047e-01   +3.240282555774288e-02   +2.157730119111258e-01   +3.787381131126885e-02   -1.155141427975103e-01   -1.340535731506829e-01; +1.100958647114483e-01   -5.095776346524589e-02   +5.643089859507255e-02   -7.536204839241532e-02   +1.839333330840654e-01   -5.169054659782388e-02   -2.866289523689421e-01   -2.112422432277644e-01; -2.163895073993891e-01   +8.173347918366780e-02   +8.113580705782338e-02   +2.613118695562818e-01   +1.479278315288026e-01   +1.023491432326969e-01   -1.870527384509539e-01   +1.788904580211538e-01; +9.292321713964038e-02   +2.516773100144953e-01   +7.075635421259058e-02   -1.883712559769077e-01   -8.690963489683698e-02   +2.230962953853085e-01   -1.495869456413254e-02   +2.237342458912537e-02; -2.523576637647897e-01   -1.869354287423275e-01   +2.094999185591190e-01   +1.329349057658719e-01   +1.696890469057012e-01   +1.530705676540162e-01   +3.035350906056594e-01   -3.510751624523273e-02; -2.400594950587520e-01   -1.057674633887159e-01   +1.961063697124325e-01   +5.746437810747183e-02   -2.829299792565710e-01   -2.581792320187279e-03   +2.066263613682017e-01   -3.754027089252912e-01];
L1I_L2I_iGABA_netcon = [-6.692624654528499e-02   -2.487482939482305e-01   +1.772743320552129e-01   -4.385501571471560e-02   +1.368386271786615e-01   -1.407032966064954e-01   +2.199157314933993e-01   -1.834994851080504e-01   -1.226078486568709e-01   +1.850513952602011e-01   +2.084044804709287e-01   +2.539459813167807e-01   +2.785338412590915e-01   +4.637373358739338e-01   -3.263807348263271e-01   +1.670701388067568e-01; -1.498570579956316e-01   -4.641436039972942e-02   -3.528229563005684e-01   +2.665908827310810e-02   -2.793132507294422e-01   -2.382220826761006e-01   +1.146931878619469e-03   -8.462872541676129e-02   +1.706013022231239e-01   -1.376413796371324e-01   -2.183286577117544e-01   -1.105046289336045e-01   +1.266492570975941e-01   +1.501880055611606e-01   -1.593813531546603e-01   -1.648549597932402e-01; -5.596007440734637e-02   +1.455234132886061e-01   +1.622279198547621e-01   -1.721935917174634e-01   +4.060945193899416e-01   +1.126629425612702e-01   -2.964352197317068e-01   +1.145928343893838e-01   +9.878544025814305e-02   -2.358441553730412e-01   -7.846972712843064e-02   +1.881308547405713e-01   -5.533954235369894e-02   -5.075103493998020e-02   -1.328839940756714e-01   +4.825208412210125e-02; -5.588910660169256e-02   +4.476346452975041e-01   +2.307765022746426e-01   -2.341139972622654e-01   +2.086146786925881e-01   -1.239349790625498e-02   -9.639919699849418e-02   -2.378537515942967e-01   -3.973351152524248e-01   +2.041924099712298e-01   -1.046807190621729e-01   -1.781197668200177e-01   +7.178765528442199e-02   +1.699580317958698e-01   +7.449437234401889e-02   +4.164658837142433e-03; -7.743255962603716e-02   -3.075928646006552e-02   -7.425737526131986e-02   -1.188528147039615e-01   -2.234702497968876e-03   -4.038752798661855e-01   -2.408053843258777e-01   -8.707276839353925e-02   +1.651936422822919e-01   -3.858683461025983e-01   +5.099369103557140e-01   -1.916984313032919e-02   -1.444373511455681e-01   +2.872425094344936e-02   +3.022576861785023e-01   -9.387160288602524e-03; -2.299737273813899e-02   -2.098261363480271e-01   -1.318730232639453e-01   +2.270379623216149e-01   +2.484313838263946e-01   -3.504629132711585e-01   +2.191967262497120e-01   +5.335273949916296e-03   -8.519355163133818e-02   -1.110798190323390e-01   +4.097464284250723e-01   +8.064536500030145e-02   +1.969242992289609e-01   +1.141723623492562e-01   -9.640078446122259e-02   -2.061713133549124e-01; -5.301188009020864e-02   -3.574814975078749e-03   -1.348023402797871e-01   +2.166542118750404e-01   +1.256133819043842e-01   +7.759196826770233e-02   +2.741006762436064e-02   -1.073556091779720e-01   +2.340811396234876e-01   +2.576865204779186e-01   +1.201458090158350e-01   -1.482542952759235e-01   +2.624741942845638e-01   +2.068891855940640e-01   +1.492066827755079e-01   -8.744975629456765e-02; +1.613758456167055e-02   -1.774520890661624e-01   +2.924551363852702e-02   +9.435872796915606e-02   -1.382101479295530e-01   -2.174359973226122e-01   +2.520122818409701e-02   -2.302753012998771e-01   +1.129925784189826e-01   +1.915394309336940e-01   +3.813229760736702e-01   +1.994165187471016e-01   -7.037470397344588e-02   +2.820498948049539e-01   -8.164919227609940e-02   +1.302170430638960e-01];
L2E_L1E_iAMPA_netcon = [+3.326899945469700e-01   +2.039269304172299e-01   -2.306435047268444e-01   -2.753808037947397e-01   +4.385648602369079e-01   -1.569331859620527e-02   +1.354907558122685e-02   +5.054942092129005e-02; -3.370281130200403e-02   -2.447527687100797e-01   -6.321057143564986e-02   +9.629204503012315e-02   +3.508951522431729e-01   -2.151870396550000e-01   +9.118657395097898e-02   -3.364790952227747e-03; +3.701740237575519e-01   +1.242836151649853e-01   +1.926376628229748e-01   -2.122436967524234e-01   +3.178072664161094e-02   +1.440964164859372e-01   +3.125416433726942e-01   +9.722234181149862e-02; +4.008268939417312e-02   +1.723157427413894e-02   -2.001002943287595e-01   +6.664916573184365e-02   +1.191518106286494e-01   +1.363478833822825e-01   -2.178493791922123e-01   -3.228722211967363e-01; +1.291164519138867e-01   +2.004768190035473e-01   -1.720489397553952e-01   +3.148644270700557e-01   +1.923537580151352e-01   -3.566306512818786e-01   +2.572012470926991e-01   +7.799263745403626e-02; +1.312043162085867e-01   -5.456093325490887e-02   +2.076059519086382e-01   +1.292512275395639e-01   +9.296554391532702e-02   -6.178559707459298e-02   -3.392099491152457e-02   +7.553572842005035e-02; +7.346456994544176e-02   +1.076546126474902e-01   +1.987218793469443e-01   +3.104517328152008e-01   -1.023669855896420e-01   -8.501638094341631e-02   +1.693057621541411e-01   +3.782404925715154e-01; -1.156829832802276e-01   +2.149338247101460e-01   -2.480943922982809e-02   -1.167386282583721e-01   -3.449991102394057e-02   -1.973671851318202e-01   -2.811273713952523e-01   +5.872034219735714e-02; +1.649172687823826e-01   +5.810940594855098e-02   +9.615426539409963e-02   +2.333262306292736e-02   -2.118493129481575e-02   -1.211904932591027e-01   -2.959324572686183e-01   -2.667921294780863e-01; +1.330449262401860e-01   +1.974662222967790e-01   -1.038535812305605e-01   +2.257241454759959e-01   -2.599991412182202e-01   +1.224740400921207e-01   +9.819349492840876e-02   -6.372029390331317e-02; -2.838750524889140e-01   +1.980510465085216e-03   +1.189548267737576e-01   -4.205698379591305e-01   -1.812220899559658e-01   +1.721398051513550e-01   +3.525538944482932e-02   -3.343304778930831e-03; -5.778916420331523e-02   -1.086487976336436e-01   +7.116111474629816e-02   +1.797690653045171e-01   -4.212989232213374e-01   +1.170710905801495e-01   +2.762256110331228e-01   +1.864324986730037e-01; +2.154146856530481e-02   +1.620274797968780e-01   -5.433412527653499e-02   +6.924844605858171e-02   +3.875324309719971e-01   +2.017122733622237e-01   +1.398784028977591e-02   -2.372985337644494e-01; +1.521528079734134e-01   +5.190271648415731e-02   -2.877956101743077e-01   +3.198935787574491e-01   -7.040524292352301e-02   +1.876772771977805e-01   -1.260404644775219e-01   -2.722997303167622e-01; +2.130541732681835e-02   -1.036364820827018e-01   -2.274830666899079e-01   +3.483885873976730e-02   +1.791497276657780e-01   +1.974594327127238e-01   -9.475255478856862e-02   +1.908215360111497e-01; +4.479212535587304e-02   +3.818588478927666e-03   +2.032056349993765e-01   -9.090982383338778e-02   -1.723335541312542e-01   +2.548878759428434e-01   +6.728136379070333e-02   +7.749753734326551e-03];
L1E_L2E_iAMPA_netcon = [+2.466829689357363e-01   -5.957515208725776e-02   -1.103230667801042e-01   -3.033003740951221e-01   +7.677052281754564e-02   +3.067920411977408e-01   -1.174985084524443e-01   -8.463166335803762e-02   +1.404446730993146e-01   +2.538686411614624e-01   +1.964901690686338e-02   -2.027189904084109e-02   +4.646198999551730e-01   -4.091007551147609e-01   +1.393803918156565e-01   -1.484427699990646e-01; +1.484346311044301e-01   -9.395154411275741e-02   +1.009214803696621e-01   -6.293518392243713e-02   -3.599124484292177e-01   +2.527039954433140e-01   +2.500681734666113e-01   -2.742769650912020e-01   +1.399381702157504e-01   +4.346736568946830e-01   +1.280095450503389e-01   +2.553869059216047e-01   +4.510115825553601e-01   -6.623576539044967e-02   +1.831171895384909e-01   -4.636514631212015e-01; -1.368337341452604e-01   +4.505015667322551e-02   -1.736012496176917e-01   +2.899337947041142e-04   +2.874138213812749e-02   +1.012716500074834e-01   +7.798300344597138e-02   -1.112285940854404e-01   +1.965087439567469e-01   -6.965827622486016e-02   -9.097672927827875e-02   -2.726828306844030e-01   +5.799591345713175e-02   -3.844047514929502e-01   +1.142862320242512e-01   +3.784016012827542e-01; +3.381753629538540e-01   +1.121218716481186e-01   +3.607487896635916e-01   -3.628954110889457e-01   +1.255766125920170e-01   +1.651455180955677e-01   -8.232416062497393e-02   -2.146945634669045e-01   -3.370979621531366e-01   +5.534182808636717e-03   -4.040300653723038e-03   +8.881139403834125e-02   -7.577195699990685e-02   -3.529765172041793e-02   +8.031865982403068e-02   +7.622241573279115e-02; +1.032076711721453e-02   -6.138659505722352e-02   -1.202025582986200e-02   -1.943442878637190e-01   -4.130873291394405e-02   +3.130058383921257e-02   +2.530572021031688e-01   -2.345577190891069e-01   +1.571040289741309e-01   +1.717780323054957e-01   +1.635569378849901e-01   +1.038462384787585e-01   -1.951821450293583e-01   +2.285358167754313e-01   +1.685934331044883e-01   +1.923061886531141e-01; +2.578432770846235e-01   +6.113705412133850e-02   +6.567612646856037e-02   -6.413533097006077e-02   +1.168276292885674e-01   -1.971552740240878e-02   -1.058257777764628e-01   -2.856956680495068e-01   +1.229999910379262e-01   -3.786123393430021e-02   +1.359641117883126e-01   -1.717069158262812e-01   +5.709212105919258e-01   +8.220008278417679e-02   +6.808428635444307e-02   +7.831975865888355e-02; +3.108958970756149e-01   +4.214825247138296e-02   +4.663228266524273e-02   -7.979825874161825e-02   -1.843945675782827e-01   +9.785329624528974e-02   -1.831774711050346e-01   -3.601113780361952e-01   +1.892921593245175e-02   -1.489824596226365e-01   -8.944223304083965e-02   +6.460190597414293e-02   -5.300449564356888e-02   +3.354642931830264e-01   -1.080768246315054e-01   -7.398842544494906e-02; +3.704041425104103e-01   -3.348523028585618e-01   +1.314159811673012e-01   -1.158028611004421e-01   +2.503157682394020e-01   -2.027600564281751e-01   +6.803055871324622e-02   +2.352560193042099e-01   -1.672636384908347e-01   -1.494243231690225e-01   -2.195967331360648e-01   -1.183654881815238e-01   +1.797717687554755e-01   +7.715738661180967e-02   -1.281492926601762e-01   +2.826186095500275e-01];
L2I_L2E_iAMPA_netcon = [+1.184804043200028e-01   +2.307025551143399e-01   +1.909599341908576e-01   +1.808926914078496e-01   -8.874700018755826e-03   -4.347198194117058e-02   +4.422536562249533e-02   -5.452523328648816e-02; +5.727591714056653e-02   +3.168441463669123e-01   +8.001653376523722e-02   -1.507600949352867e-02   -3.188732418685398e-01   +8.238392854031167e-02   +1.973663848289895e-01   +2.252378344099674e-01; +3.359291582714828e-02   +3.397227049814511e-01   +4.753386616249587e-02   +3.388155579704263e-01   -2.589472043278783e-01   -4.818721720581533e-03   -8.087440752553661e-02   -3.422635599919580e-02; -1.868089009205382e-01   -6.648190682797173e-02   -5.548310063246635e-02   +6.224864121920674e-02   -1.526408648288421e-02   +9.933452209692338e-02   +2.668069251611009e-01   +1.226936730267280e-01; +3.044135830576995e-02   +1.873153480930873e-01   -4.244734304455249e-02   -7.940300506972935e-02   +2.112007675896485e-01   +2.102038215409797e-02   -6.334404844583559e-02   -1.127921162302017e-01; -1.514385469467982e-02   -7.595254987058506e-02   +5.923115297047767e-02   -1.330842111726698e-01   -1.153216221484704e-01   +2.958179246730910e-01   +2.068813217322717e-01   -4.841771012864716e-02; -7.606558691910958e-02   +1.047996507207519e-01   +1.442965252554878e-01   +1.623504147353162e-01   -3.487639258726802e-02   -2.543453595578864e-01   +1.120160229483905e-01   +9.036916112616723e-02; +4.000289405052722e-01   +2.644027461566528e-01   -1.839382711369132e-01   +4.299345238395725e-03   -7.499732237516010e-02   +1.021775782791181e-01   -1.356370895866164e-01   -1.168954172879817e-01];
L2E_L2I_iGABA_netcon = [+1.613543256738658e-01   -7.438105032337253e-02   +4.026212801716941e-01   -5.298063072657340e-02   +2.380762216677233e-01   +8.943721523747405e-02   +2.333982099517741e-01   -2.287796101783085e-01; +1.903228836285993e-01   -1.653335243918383e-01   -1.886209659197035e-02   -1.247801556116981e-01   -4.898120438973540e-02   +1.675290282823214e-02   -1.283078178752976e-03   -1.181704349272412e-01; -2.020228009696798e-01   -7.666982621548271e-02   -1.548302282060089e-01   +3.716833930619557e-01   -2.992598489646535e-01   +3.827409406154760e-01   +2.363539790182522e-01   -1.270623232685703e-01; +1.986998557806950e-01   +2.308401064665473e-01   +2.022481518283609e-01   -1.488948434296331e-01   +1.739879625262163e-01   -1.440072692645530e-02   -1.623201073312130e-01   -1.218635826465747e-01; +3.575911097813006e-01   -1.925187673749531e-01   +1.642745778389483e-01   +1.090825809481165e-01   +1.842019572566004e-01   +1.147443700829369e-02   +4.444254430971190e-01   +2.645992988035921e-01; +3.104091303724334e-02   -2.398674490207234e-01   -3.736523640420671e-01   -7.498943330437194e-02   +5.923131085196194e-02   +7.074620737549001e-02   -2.149442670671170e-01   +1.441040076812087e-03; +3.273586359711558e-01   -1.432058512262366e-01   +3.700181476194502e-01   +2.200338336221183e-01   -2.800236869867949e-02   -3.458441901954543e-02   -2.161944976835994e-01   -1.519963772111389e-01; -8.353741979801546e-02   +2.251529556662299e-01   -1.442814122902725e-01   +1.174739678566984e-02   +1.130566166103612e-01   -4.603702400328420e-02   +1.633794345471190e-01   +2.113822578907817e-01];
L3E_L2E_iAMPA_netcon = [-2.188853737820334e-01   -7.328430791899536e-03   +5.520301051614598e-03   +3.233475021050329e-02   +6.124038878817323e-02   +8.304379903984187e-02   +3.017807671342208e-01   +3.324475721791533e-01   +1.055585555166398e-01   +3.060454884678607e-01   +5.529315930563714e-02   +1.008756408471440e-01; -9.987195634150108e-03   +2.557342639841088e-01   +3.754187882632211e-01   -1.996993411542134e-01   +1.283607419228189e-01   -4.739006719088931e-02   -1.148361879545323e-01   -9.772189388600816e-02   +5.014290497130894e-02   +3.466655664587160e-01   +1.513705968004916e-01   -1.666749052285892e-01; -1.182047461635282e-01   +7.331243941407799e-02   +1.328193488897024e-01   +1.738555966122849e-01   -7.175671949189895e-02   -1.551359725815643e-01   +2.809468677227804e-01   -3.130773492979517e-02   -4.202190121732606e-02   -1.857013797079469e-01   -2.233013695709753e-01   -2.873228926091817e-01; +1.136136142221495e-01   +1.555117450965883e-02   -5.857823671210955e-02   -1.699100455764511e-01   +1.234723610875536e-01   -1.313645300294502e-01   +1.533720321140928e-01   -1.521580048099233e-01   -1.298318616343518e-01   -1.335035434078637e-01   -3.695177845490592e-02   +2.202411844889776e-01; +2.027539276456342e-02   +7.876981240057500e-02   +2.208857535251648e-01   +2.489697339630519e-02   -1.140112538879656e-01   +2.310033824082383e-01   +1.291330645367922e-01   +2.718454143172174e-01   +1.426689033284699e-02   -4.713725492288057e-02   +1.515507771068641e-01   -7.649696151885550e-02; -1.323231113494033e-02   -4.832422952726249e-02   +3.076076426926898e-01   +2.425580600414450e-01   +2.745996729901808e-01   +5.133063695564295e-01   +2.838753432018164e-01   +5.236789872656558e-02   -3.734739391448672e-01   -1.778677315063051e-01   -9.480829924772077e-02   -1.263314528297396e-01; -1.700065322330314e-01   +5.182281601557703e-02   +1.425242331662022e-01   +1.675621061871263e-01   +5.214960863456405e-03   +1.089172973780047e-01   +8.823513030855618e-03   -1.153951800821283e-01   +1.921627444229021e-01   +1.631155889828898e-02   +2.959243341951899e-01   -1.828482194790723e-01; -1.175291299149789e-01   -9.118752669488386e-02   -3.724690392848866e-02   -1.374229202050189e-01   -1.678619799287850e-01   +1.556785439074109e-01   -1.456452395806926e-01   -7.802505920757313e-02   -1.915164335188518e-01   +1.626442213790243e-01   +8.640017310106171e-02   -1.343701291590373e-01];
L3I_L2I_iGABA_netcon = [-1.064968498190000e-01   +5.122212080414225e-01   +1.235905346033483e-01   -2.897553474272875e-01   +1.077285857006617e-01   +7.860039255369936e-02   +8.776284392229952e-02   -1.447658302294428e-01   +1.241535628544144e-01   +3.238432225218794e-01   -1.739069485736742e-01   +5.368902661074781e-02; -3.093819369115153e-01   +3.720138707391447e-02   -1.266499985637217e-01   +1.596726907445706e-01   +6.089496936383166e-02   -3.126119930601902e-01   -1.309653655961624e-01   -1.668306183112315e-02   +1.624178449552137e-01   -6.421174211994793e-02   -1.338708908951616e-01   -1.019891268383208e-01; +4.474299656076376e-01   -1.909540964493256e-01   -1.210831802524012e-01   +9.913434232418497e-02   -3.424161697398895e-01   -5.304953501054134e-02   -2.005731046938655e-02   +2.959874383856002e-02   +2.478595775911275e-01   -2.369257867535786e-01   -6.897258828102774e-02   -2.061011800122006e-01; +4.486398606851765e-01   +6.032925282812074e-03   -3.080703337317175e-01   -3.199424110187462e-01   -2.835191940203241e-01   +2.895466288342144e-01   +9.590532963295076e-02   +3.099083316358206e-03   +2.847154779237542e-01   -1.317444257361560e-01   +1.936851516803915e-02   +2.808973593609440e-01; +8.305643902945777e-02   +1.592086263142776e-01   -2.857663516513607e-02   +5.184704126386129e-02   +1.200301291725813e-02   -1.161271634039947e-01   -3.397045750055826e-02   -6.674271323625569e-02   +4.790931749150604e-02   -2.069559184710643e-02   -4.284316551364904e-02   +2.831775135960455e-01; +1.556479082643832e-01   +1.048894475157027e-01   +6.457449242383947e-02   +1.998393587062608e-03   +2.912744500371079e-01   +1.115835606216622e-01   -2.069040304956729e-01   -3.723217383464427e-01   +3.281293075999566e-01   -7.972232660922389e-02   +1.374796057725544e-01   +1.347503078672438e-01; -7.452554830181228e-03   -1.213750042974290e-01   -1.625722805972583e-02   -2.816503339323094e-01   +1.880115601275768e-01   -1.593763500909683e-01   +1.692160543120605e-01   +1.900664312986036e-01   +8.429686317929028e-02   -2.847918984888007e-01   +2.515605066243481e-01   -2.631401983213079e-01; +2.726237367676646e-01   -4.604946497881922e-03   -1.744914537803952e-01   +5.479415370230186e-02   -2.651044832365328e-01   +5.018613983093595e-02   -1.016094988416541e-01   -2.741744544168379e-02   -1.952549124428191e-01   +3.398597837839015e-02   -1.405632087014921e-01   -1.964091778621826e-01];
L2E_L3E_iAMPA_netcon = [-9.140873915444887e-02   -1.338115623244260e-01   -4.403976038077057e-02   +3.354217514892772e-01   +1.204888379224443e-02   +1.768313503316497e-01   -1.025431565556941e-01   -4.209698917998889e-01; +1.064909771484373e-01   +9.314252662238831e-02   +3.160487223480102e-01   -1.238009952151343e-02   -7.357085096313004e-02   +3.157120890058311e-02   -9.924801073791291e-03   +5.780980419871459e-02; +6.929434899464854e-02   +2.893232179794760e-01   -1.241705133713423e-01   +5.167239063044196e-02   +2.717613488787616e-02   +1.465368101024913e-01   -1.191231631850432e-01   -5.146988598431670e-02; -1.117421345495846e-01   +1.672310191902349e-01   +1.827258142690096e-02   -2.990940523341953e-01   +1.959287082937267e-02   +3.401836212509439e-01   -1.803272351787360e-01   -6.185413154364827e-03; -3.179016812764643e-01   +2.895973946062914e-01   -1.202199025370746e-02   -2.512070642062365e-01   -2.479086596382562e-01   +1.216074692306472e-01   -5.393395726829637e-02   -1.938931323694812e-01; +2.063832825030837e-01   +1.046978324206078e-01   +1.290706324563344e-01   -1.118837938548963e-01   +3.785563577102526e-01   -2.094519157852680e-01   -1.028421838472740e-01   -1.128610827148864e-01; -3.084414039555377e-02   +1.387006421466405e-01   -2.336109310458195e-01   +8.403450985350804e-02   +2.425501496024854e-01   +9.032270245596298e-02   -2.211088458940660e-01   -1.531265326436564e-01; -2.362008016885150e-01   +2.386703412162294e-01   -1.935684651956004e-01   +2.133149795036041e-01   +5.273147094925983e-02   +1.179844795593804e-01   -4.072254738957894e-02   +2.137800520907413e-01; +1.775864787761487e-01   -2.240120158793827e-01   +1.474197725284740e-01   +8.191994657263316e-02   -3.671764769041082e-02   +4.741804280264972e-02   -2.798905387609867e-01   -9.733830451120978e-02; +2.702702833031981e-01   -4.461796756183198e-02   -1.416281590972523e-01   +1.473803445639261e-01   +1.706244478149281e-01   -1.663179440716174e-02   +2.873513859431769e-02   +2.461130122476668e-01; -2.056985788711447e-01   -1.676114755180194e-01   -8.192941403359665e-02   +1.293104239198819e-02   +1.219044901873783e-01   +2.448154873752621e-01   -6.278252779305646e-02   -8.099249803853055e-02; -2.583836850354250e-01   -1.503491284481195e-01   -9.896906395388566e-02   +3.025795115032687e-01   +2.360700537621659e-01   -3.944156811308666e-01   +3.951433161853362e-01   -3.708508341868939e-01];
L2I_L3I_iGABA_netcon = [+1.260921766618052e-02   +1.273019135950219e-01   +1.788222318544533e-02   -8.165530150284216e-02   +1.995481920224090e-02   +4.366846927152888e-01   -9.844309185791453e-02   -6.237287679709484e-02; -6.584035098442528e-02   -1.441972133442201e-03   -1.829187374304725e-01   -2.423937169894122e-01   -1.270335183015258e-01   +2.971774754750666e-01   +2.429113533413240e-01   -1.124556044474443e-02; +1.101973172795084e-01   +2.492093995522114e-01   -1.921678055523712e-01   +2.208364765742608e-01   -8.960517155062767e-02   -1.066510277890516e-01   +7.438296254026779e-02   -5.714281488736528e-02; -7.716065152050242e-02   -7.003996893587449e-03   +1.329116905953710e-01   +1.153159880582973e-01   -2.660429769892221e-01   +4.113042108836190e-01   +1.495910279386152e-01   +3.767294312162461e-01; -1.020823471356116e-01   +1.604875575157837e-01   -7.780278343825202e-02   -8.548426883731784e-02   +1.471277465829146e-01   -2.142153151986613e-01   -1.463646971936143e-01   +2.088642021283063e-02; +1.998702004842163e-01   -1.184343535858174e-01   -1.117949483889867e-02   +1.618857665583631e-02   -1.510028405934990e-01   +2.487716889852315e-01   +2.063616158553626e-01   -2.099572832674650e-02; -3.364801014806277e-01   +8.213772514879503e-02   -3.392665603593846e-01   +4.940205976061775e-02   -1.110375934257282e-01   -1.746228209839516e-02   +1.767546354132258e-01   -1.690878809401477e-01; -3.113918835067495e-01   -2.796359219420265e-04   -4.225957875801768e-02   +9.892825312598466e-02   -3.335090543824561e-01   -2.961611319717922e-02   -1.573575822755358e-01   +4.139566564829091e-03; -9.380039067097640e-02   +2.601025011572049e-01   -2.562818450355375e-02   -2.323740941734618e-01   +1.648232580948743e-02   +2.372385963338192e-01   +1.134018971564012e-02   -2.326388672925880e-01; +1.834686734800756e-01   +2.602372332437715e-01   +1.994544453822066e-01   +2.586211099129532e-01   +5.366974833819688e-02   +2.789946772020822e-02   -2.466238485953957e-01   +3.792335005619354e-01; +2.326762488175614e-02   +7.454552815679005e-02   -1.739594563810119e-01   -2.544630463571207e-01   +7.304016447638659e-02   -2.296070132939298e-01   +2.102223099431072e-01   -4.286917093603562e-02; -1.360850368039905e-01   -1.459497265597762e-01   -2.505084544160953e-01   +9.178392622518791e-02   -2.332280847480163e-01   -2.706422869063563e-01   -8.513340688998856e-03   +6.857990941222941e-02];
L3I_L3E_iAMPA_netcon = [+2.097659265324080e-02   -1.137717897119445e-01   -2.368774850552614e-01   -1.964000227274848e-01   +2.592835485027790e-01   +1.244270386502404e-01   +3.429343817908914e-02   +2.048494907030712e-01   +1.009306715900523e-01   +1.468322538680740e-01   -1.423427692230952e-01   +8.128082955236773e-02; -5.533390570943597e-03   -1.667416095237901e-02   +2.343254645075022e-01   -7.178050856507960e-02   +4.742976916325827e-02   -8.666420158475113e-02   +1.376015380046444e-01   +1.062187741770214e-01   -1.109530653978610e-01   +7.847679836427854e-02   +1.438851349898135e-01   +1.286165482777072e-01; +2.481589269563428e-01   -1.974782432751836e-01   +8.650793346180546e-02   -8.309713330250143e-02   +1.972523507706440e-01   -1.067485789477689e-01   +1.059545185523503e-01   -1.614058897289698e-01   -2.513733759956692e-02   +5.494411718474231e-02   +1.407220272487772e-01   +2.333579833923286e-01; -3.109103990226746e-02   -3.809588763678621e-02   -2.872929846534750e-01   +2.821999289599124e-01   +1.995520238012923e-01   -8.534838791874287e-02   +3.652814495601339e-01   -2.203078702019218e-01   +2.326302793356948e-01   -2.832634547987517e-01   +1.660736856914563e-01   +2.308840519778162e-02; +1.187759647833443e-01   -1.860795970674983e-01   +8.615227121987942e-02   +1.824499728499062e-01   +5.882478396024785e-02   -1.290403451300730e-01   +2.006839239236460e-01   +3.534403530787321e-01   +2.985096383531987e-01   +8.366746855956986e-02   -3.034217407847132e-01   +9.863120286355589e-02; +2.889558792065779e-01   -1.841146833559437e-01   +1.767396039545727e-01   +1.750008977370097e-01   -5.717894129623929e-02   -1.407724660066618e-01   -2.158101219359602e-02   +1.134185313980380e-01   +1.053211256128751e-01   +5.208314710273390e-01   -2.312061366156812e-01   +2.276445463048174e-01; -1.554250577059470e-01   -9.768800498228414e-02   +8.995309868083506e-02   +1.769341231009571e-01   +2.187835864669269e-01   +1.718154016657068e-01   -1.519195776207118e-01   -1.483077906387392e-01   +7.817085407763555e-02   +5.637216310546684e-02   +2.510720087630453e-01   +1.778645068251071e-01; +1.471675701088855e-01   -1.198545451659861e-01   +2.304198758716677e-01   +6.339459169547701e-02   +1.868481417828463e-01   +3.315169917350198e-02   -8.475453292928578e-02   +3.633769447114883e-01   +1.313247462808127e-02   -1.516493427567442e-01   -6.340055315327892e-02   +4.230461756945603e-01; +1.839687758489416e-01   -2.306745271257647e-01   -4.146729141735154e-02   +2.828963228319029e-01   +1.551492030643868e-01   +5.556685621445538e-03   -3.651050946776981e-02   -7.306260534128410e-02   -1.047979397132941e-01   +1.161217474595994e-01   +1.395777355538928e-01   +1.676743272311831e-01; +1.076297008345598e-01   -2.004156938308966e-01   +1.230523998295091e-01   -2.216397212404374e-01   +1.823886668836675e-01   +1.977793764389195e-01   +1.529386144838428e-01   -1.947614405294847e-02   +6.692270164080769e-02   +5.467719719132290e-02   -1.330320288907781e-01   +1.627587078629542e-01; +3.372346378043543e-02   -3.459245879703449e-02   -1.123140062209754e-01   +1.813270981246277e-01   -1.516146434272817e-01   +1.539977890426849e-01   +2.524974324021916e-01   -1.914524344309212e-01   +2.550544336157382e-01   -2.751702617136101e-01   -6.832731667228428e-02   +2.233096927270765e-01; +3.894516162664726e-01   -2.502552401379862e-01   +7.720268842706608e-02   +2.523921196928427e-02   +1.381387910529591e-02   -1.525257029367469e-01   +1.358966976294796e-01   -2.354199499909331e-01   +2.208452624696677e-02   -3.671313256568010e-01   +3.968426233970829e-02   +2.501591182510259e-01];
L3E_L3I_iGABA_netcon = [+7.431921263599169e-02   +7.624249065211219e-02   +3.411368171795399e-02   +1.874542970939029e-01   +1.903262605121351e-01   +1.023723698123691e-01   +3.005610652079239e-01   +2.367736236727200e-01   +2.893742792798360e-01   +2.836940683689495e-01   +7.720030498645639e-02   +2.058937758918228e-02; -1.238531302669098e-01   -2.899770603627200e-01   +3.515999386528492e-02   -7.188503995493135e-02   +2.273045025033089e-02   -2.929996648092675e-01   +7.372412216626946e-02   +2.651378348139989e-01   +9.725618322091054e-03   +1.883719301885282e-01   +9.095899379471806e-02   +2.473885703567642e-02; +7.523996210893362e-02   +2.036770721563586e-01   -2.051116441186863e-01   +8.553968331877568e-02   -9.189143738968925e-03   +4.730576155596710e-01   -2.676502814538164e-01   +7.798151769718447e-03   -2.725099572053967e-01   +3.505544653854883e-01   -6.590141854347327e-02   -2.665702202796195e-01; +5.171956231382928e-02   -9.110262874457196e-02   +2.296309011092901e-01   -3.209401265640118e-01   -4.699678871789706e-01   -2.110652075406148e-01   +9.941760122193063e-02   +3.902333161164129e-01   -2.250941563958239e-02   +2.428384069395315e-01   +1.418663072718395e-01   +1.114980912432879e-01; +1.781936078201061e-01   -2.795252710290856e-01   +2.171069880044491e-01   -4.532516102621537e-01   -1.397334999864121e-02   -9.265464172943344e-02   +2.298355840592776e-02   +2.100071248878194e-01   +2.601984071877083e-01   -1.385207694995252e-01   -1.911142469895687e-01   +2.356482663273073e-01; +2.670791122390714e-01   +1.105014841462328e-01   +5.755124317658164e-02   -2.691164239888869e-03   -1.064897125795260e-01   +1.487598755256172e-01   +1.071748137547933e-02   -3.740586066539135e-01   +1.793996090873939e-01   -2.159109723091291e-02   -1.357231101100149e-01   -3.601548637528649e-03; -3.227428406050581e-02   +3.371701933241666e-01   -1.848420086528703e-01   -3.426648193779915e-01   +3.006055119187177e-01   +4.005983873342518e-01   +5.075600648315505e-02   +1.977281287480319e-01   +4.038821754783559e-02   +1.864328363042097e-01   +2.126391686738920e-01   -9.029686610339530e-02; +2.511643264718945e-01   -1.923667579491174e-01   +1.246041339976449e-01   -4.528707710762909e-02   +2.080160050352765e-01   -4.710543608582681e-03   +1.200593302639461e-01   +2.825070683307787e-01   -1.597465550749624e-01   -2.451491320616499e-01   -2.690418899097112e-01   -2.074337595839141e-01; -8.969486246844527e-02   -3.768859475561499e-02   -3.819432095944529e-01   +5.291241454611125e-02   -1.727234432538223e-02   -2.554055498068851e-01   +3.046694389625352e-01   -2.365507837319623e-01   +1.949640903787214e-01   -1.729755870592994e-01   +1.618414688379557e-01   +4.060840651966971e-02; -1.305924795834618e-01   -1.473789484132851e-01   +1.574652580544623e-01   +6.598413057040864e-02   -2.221114962862858e-02   +1.884938402693645e-01   -9.981287933111752e-02   -9.462725997911192e-02   -1.745288067925851e-01   +1.214892754642285e-01   +8.356016798583946e-02   +3.469304795670764e-01; +3.484849415636630e-01   -7.696025807853767e-02   -1.153219940391549e-01   -7.773237625171531e-02   +2.467723570306431e-01   +1.451407830998761e-01   +1.754053773631364e-01   +5.668669473569646e-02   +5.751271899967753e-02   -1.573138738396066e-01   +3.189185173314319e-01   +1.303282935825087e-01; +5.971865118371091e-03   +6.123099239754190e-02   -1.522337725144634e-01   -1.033614715175119e-01   +3.447539466946861e-02   +1.116263759316278e-02   -1.026965983558640e-02   -8.790243278510469e-02   +1.862515528062415e-01   -1.974389111228576e-01   +1.091273044336512e-01   +2.588592131639036e-02];
L2E_Input1_iAMPA_netcon = [+1.106298440580023e-01   -3.668497484767523e-01   -2.092557414677060e-01   +3.158975177030225e-01   -3.318491502752990e-02   -1.611011565622924e-01   +2.924342005598930e-01   +2.597110334718659e-02];
L2I_Input2_iAMPA_netcon = [+5.445553538501632e-02   +1.073873146396709e-01   -2.886275148663212e-01   -3.599166253729572e-01   +2.954369751734039e-01   +1.138484045941876e-01   -3.316308000531472e-01   +3.566872050705937e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
