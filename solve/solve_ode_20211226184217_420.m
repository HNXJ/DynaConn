function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.274107809175484e-01   -6.361813843291603e-01   +2.037509873201681e-01   +2.470240590325799e-01   -8.140878435790944e-01   -4.215141881421036e-01   +3.586114289129100e-01   +3.281768417566384e-01   +1.733134076910204e-01   -1.327249531246404e-01   -1.872902307076165e-01   +1.235011786804044e-01   +3.056992375844476e-01   -3.556748375324986e-01   +4.531748083554761e-01   +6.115397898622618e-01; +2.803198684896382e-01   +3.629261004210158e-01   +1.369044256872257e-01   -1.303699577533266e-01   +7.070927809068907e-04   +6.488251879563509e-01   +2.324082970129544e-01   +6.635856166788617e-01   -1.404857133094276e-01   -1.528476455810473e-01   +3.667012920465585e-01   -7.088066793955187e-01   -7.286818991794760e-01   +4.729560932302530e-02   +2.873475535622123e-01   +1.066794952855550e-01; -3.399436943423287e-01   +4.762391966074233e-01   -1.454249625827990e-01   -3.826382193671846e-01   -1.341703094549619e-01   +5.656128135145583e-01   -5.745165696345973e-01   -2.910406879414538e-01   +6.326727274548126e-01   +9.678337319901255e-01   +4.242002400538176e-01   +1.877322216079158e-01   +9.282006422313061e-01   +4.205722677128374e-01   +3.868525434719399e-01   -4.287636466577767e-01; +3.414581449479258e-01   +1.310684235936956e-01   +3.216667536110372e-01   -2.010577924024842e-01   +5.199367163501036e-02   -7.709466720783962e-01   -2.443357988070911e-01   +4.431939253759156e-01   +1.340630160648138e-01   -6.137584539415797e-02   +4.110232228832406e-02   -1.088286697589023e-01   -2.741300412421755e-02   -1.344777524145728e-02   +8.545845368954751e-01   +3.009495255875808e-01; -1.900949832042488e-01   +6.718352094539801e-01   -8.665978845569492e-01   +7.987713782679585e-01   -4.864247523418180e-01   +3.331750891331917e-03   -3.035458609269649e-01   -4.616497033675609e-02   -4.024415395831501e-01   -1.664758255122465e-02   -5.036722583202230e-01   +5.054148596300722e-01   +3.193164325567791e-01   -7.553063176825823e-01   +4.495294659070144e-01   +1.947598734776310e-01; -1.590762020994273e-01   -7.555274172865976e-01   -4.376046540175699e-01   +6.414348310216109e-01   +5.816681096612430e-03   +8.040193876609333e-01   +2.686005024806502e-01   +3.198195217718007e-01   -8.502979303520320e-01   +4.997123992705320e-01   -5.927056093263896e-01   +1.121279157409561e-01   -1.821331600123577e-01   -1.800975186456374e-01   +2.066166271061896e-01   -7.660030069042831e-03; -7.182602049397110e-01   -5.240430114049184e-01   +8.233997725459918e-02   +2.675566424736061e-01   +3.641019345776866e-01   +3.539481894530211e-01   -2.905269467762917e-01   +4.163696062830361e-01   -7.491804438971686e-02   -3.074726567608563e-01   -1.340783245436257e-01   +1.712315975480002e-02   -2.563395466748534e-01   -6.738515078360241e-02   +7.012013906999319e-01   -5.596024478022095e-01; +8.405057350654513e-02   -2.057113794865028e-01   +8.615143068667336e-01   +4.031855789212936e-01   +1.456847925357759e-01   -4.362815886412389e-01   -4.290159230983329e-01   -2.817167694921858e-01   +4.479458962901269e-01   +5.442393955970207e-02   +8.111340811657024e-01   +1.229883102276051e-01   +7.653721315858747e-01   -9.382218039703316e-02   -6.732460023041339e-01   -4.254064610448099e-01; -1.071247941725543e-01   -3.752511381260886e-01   -7.392449329271297e-01   -8.433601043573408e-02   +1.914930340234637e-01   +3.948504582874661e-01   -2.248764248020796e-01   -1.780683360860228e-01   +5.240594894325022e-01   -2.253675870159518e-01   -2.079955534192299e-01   -2.634308683851769e-01   +1.664726942115009e-01   -1.032073911789029e-01   -3.932674015961724e-01   -3.235297432325871e-01; -2.588787368332647e-01   +5.510396375850252e-02   +3.201703349458253e-01   -3.807391109722139e-02   +1.663000935415660e-02   +4.765099863707367e-01   +3.153138002912934e-01   -7.447292735388287e-01   +1.791525711107844e-01   -3.022094083566433e-01   -4.273263833185883e-01   -8.057224799758760e-01   +1.795437704491536e-01   +1.442508169258873e-01   +3.799787980713935e-01   -2.102148512356987e-01; -6.748552270800288e-01   -8.496520851148039e-02   -5.530855603936745e-01   -2.579464150032442e-01   +1.273728322256340e-01   +9.750981599660762e-02   -1.700069380897695e-01   -2.672094160916644e-01   +4.637165683846244e-01   -1.483079317659487e-01   -3.707462012470788e-01   +4.611277154670681e-01   +3.334369256796008e-01   +4.503629680432424e-01   +4.707089687817144e-01   -9.057370992662701e-01; +6.310150658925950e-01   +5.231609885434596e-01   +1.825150627970334e-01   -2.954227723221838e-01   +3.792024510701477e-01   +5.826828873847912e-01   +1.976340071598948e-01   -7.837218547427701e-01   -2.291077860259077e-01   -1.791105474129782e-01   -5.110182722747737e-01   -1.250030554795036e-01   -3.797308056800105e-01   +2.960929412198250e-01   -2.140112234192724e-01   +7.478737608393353e-02; +4.893303717793428e-01   -3.837342518794790e-01   +2.098373617996313e-02   +5.314419502981022e-02   -2.205104321391263e-01   -7.251983464779133e-01   -6.288344544521751e-01   +2.104237631256135e-01   -1.874329128672823e-01   +1.580975206631881e-01   -3.530457410083589e-01   +1.222986519445067e-03   -3.734166958913778e-01   +2.853975343183177e-02   -4.219712700362849e-01   +4.431487637387869e-01; -2.939189086908073e-01   +1.072636502919796e-02   +1.379144640930200e-01   -9.235793135353562e-01   +1.000000000000000e+00   -2.292944649209948e-01   +3.926474942946908e-01   +8.075661145323239e-01   -3.656992331653153e-01   -1.275440104552506e-01   +1.726946710346410e-02   -3.176833052315055e-01   +5.112556932893040e-01   +5.339095586945711e-02   -1.682372574708388e-01   -3.988413095318160e-01; +7.198734144432289e-02   +1.903152195370457e-01   +4.710881588252156e-01   +3.895889483566919e-01   +1.565596078419136e-01   +3.141901050454578e-02   -3.664160294011543e-01   +2.162928356685201e-01   +5.077051205304887e-01   -2.976546382450118e-01   +5.397475352599936e-01   +2.704373464213494e-01   +4.689356539592193e-01   +5.419571030806600e-01   +9.527325554828071e-02   -4.153693556721836e-01; +2.844317838020520e-01   -7.045431447219638e-02   +3.575429093620560e-01   -3.202470799821608e-01   -1.037366634728503e-01   -2.069529782552190e-01   +1.260540029447365e-01   +2.643664518372016e-01   +1.083110767429088e-02   +7.559819276408800e-01   -3.549846036104262e-01   +6.478964996149562e-02   -2.524566937569536e-01   -4.718130087972821e-01   -1.499165171011555e-01   -1.267333367576409e-01];
L1E_L1I_iGABA_netcon = [-3.207013822715301e-01   +2.553776383694759e-01   +1.452826493766138e-01   -1.321386982345364e-01   +6.438100895908985e-01   +5.770980715049162e-01   +5.220797625737709e-01   -6.785898011229391e-01   -7.662829309064474e-02   -3.380438196470509e-02   +4.787733557866625e-02   +3.632970495435288e-01   +1.288936423657122e-01   -6.983139032564797e-01   -8.795824305173346e-01   -5.713543091753408e-02; +1.371853270069417e-01   +1.648152833345393e-01   -1.682159607710732e-01   -9.385489696226685e-01   -5.839909301029553e-01   +4.973454535005716e-01   -5.490096161200766e-02   -1.021263513563997e-01   -3.666459157695023e-02   +3.594309918460903e-01   -1.099001044689696e-01   -6.549670747540638e-01   +3.910367516506273e-01   +2.249147148292176e-01   -2.642680471786100e-01   +3.904223910168191e-01; +2.669593389218748e-01   -6.217853208452646e-02   -5.129468363645125e-01   -3.749225845393785e-02   -9.957573368739088e-02   -1.925652187978066e-01   -3.628178385706347e-01   -6.423035631144820e-01   -1.007335815294045e-01   -8.630003391912989e-01   +4.632631865970677e-01   -8.624861583336435e-01   -2.889106370571232e-01   -1.310418744126605e-01   +1.124642757327177e-02   +2.563207816441831e-01; +1.718713787202733e-01   +6.192623596526667e-01   +2.889752354611462e-01   -2.936643357280558e-01   +4.070288186102128e-01   -2.091054736523870e-01   -1.480115060350755e-02   -6.950156226179045e-01   -1.869123473532172e-01   -6.272163768632902e-01   -5.149975166359503e-01   -4.101267141003857e-01   +2.514066542312517e-01   -8.053927050224656e-02   -2.876604335286277e-01   +2.103015989516363e-01; +3.819511130602601e-02   +2.648039641758896e-01   -5.400447629014163e-01   +5.583863068810131e-02   -4.386766367931350e-02   +1.655584200635586e-01   +6.878322114532560e-02   -2.847403415502448e-01   +3.529478816920697e-01   -4.776398069146250e-01   +2.206048972895577e-02   -6.828022925027850e-01   -1.405940264909188e-02   +1.995318384476853e-01   -2.861144354171525e-01   -3.446131964709568e-01; +2.841942996144459e-01   -2.244035454154258e-01   +9.156143255293990e-02   +3.586162984361568e-01   -3.747708340937253e-02   -4.951809621794011e-01   +4.056727912412993e-01   +6.166065796920106e-02   -7.966728284059607e-02   -5.357786728449245e-01   -7.016529399787348e-01   +1.278099399006524e-02   +1.140758269675370e-01   +3.636153716501244e-01   +6.302382649805430e-01   -1.227544155646997e-01; -5.426294097253818e-02   +7.841791899474350e-01   +4.819834289903954e-01   -1.928420096885703e-01   +6.356144235255367e-01   +3.996734363571571e-01   +1.067048762420118e-01   +3.037568626900047e-01   -1.683257766132916e-01   +2.607870372676655e-01   +1.559276845041715e-02   -2.432402895906147e-01   -3.862472039376521e-01   +1.619018371527244e-02   -2.245377201619500e-01   +2.367009155601158e-01; -3.223298883081286e-01   -6.992537304787497e-03   +2.490506970801243e-01   -6.164438720770401e-01   +6.423294466686256e-01   +2.692127973779860e-02   -4.367430841373990e-01   +5.725972199730236e-01   +2.459674750376236e-01   +3.311974626323349e-01   +1.105655585399733e-02   +1.249287988283741e-01   +6.637305068907690e-01   -6.325662545708866e-01   +1.503193665304436e-01   +2.331156907662848e-01; -3.043230732529987e-01   +4.135102531087414e-01   -4.405316034983190e-01   +2.942467774041831e-01   +2.442056105329854e-01   +2.865944487961449e-01   -4.806696028781767e-01   -4.268230492137423e-01   -4.196183062421669e-02   -2.363136405151239e-01   +1.902253077488748e-01   +1.771929724284311e-01   -2.480516159702746e-01   +4.292178836821225e-01   +3.251200976836454e-01   -6.209291360580237e-02; -1.675588134571157e-01   -1.477117130018798e-01   +3.648777744534523e-01   -4.690244791101204e-01   +2.138361987530071e-01   -4.083627167481181e-02   -6.329444607365522e-01   +1.622968317259348e-01   -1.583568724728678e-01   +3.024633509884502e-01   +6.018206168450455e-01   +4.836976978035063e-01   -2.401918318700440e-01   +1.167421607617676e-01   +3.017342869568406e-01   +2.560666309465955e-01; +4.338491969629136e-01   +8.736792308822192e-01   +1.618249116620007e-01   +3.610814038234992e-02   +2.277676225517747e-01   -1.046833267309020e-01   +1.932275688996447e-01   -6.920648638946893e-02   +7.974651897083283e-02   +7.787092310079505e-02   +3.044631859311829e-01   +1.929312352529705e-01   -5.936461670674265e-02   +2.501323203956944e-01   +4.383183569991614e-01   -7.794603415089793e-02; -2.612777720551508e-01   -6.121502962356761e-01   -4.854919713267702e-01   +1.256601654333970e-01   +1.946023914100367e-01   -3.204939950073751e-01   -1.877789009217516e-01   -2.608559095684423e-01   -6.501446522233628e-01   -4.265967062600737e-01   -2.114276691288381e-01   -5.599292979863868e-01   +2.406245726812138e-01   -7.210773650710863e-01   -3.589645006150153e-01   +6.838815085893449e-01; -1.157325391882930e-01   -1.300889007898730e-01   -4.323267214976368e-01   -1.819858148841182e-01   +1.251680348101109e-01   -1.934722188974456e-01   +1.797479425975154e-01   +3.775110578560576e-02   -4.519894478366628e-01   +6.170425916768419e-02   +4.525623491626642e-01   +5.776656638777572e-01   +2.357107475429207e-01   +6.433368786802507e-01   +1.087597649641713e-01   -2.376067457430938e-01; -1.265962842183568e-01   -8.242466190801293e-02   -4.837781518170691e-02   +1.383423478457210e-01   -1.898258629961208e-01   +2.599838571123688e-01   +2.427767554213030e-01   -3.318448558255537e-01   -7.281034060786673e-02   -6.105218906470551e-01   -4.123215497525052e-01   -5.830227990712339e-01   +2.419579174244503e-01   +2.361953804761588e-01   -3.965103375853505e-01   +2.122822352660740e-02; +2.534998378538402e-01   -4.267790420415730e-01   +1.470430268494316e-01   -1.429556180761237e-01   -1.284227274763038e-01   -1.000000000000000e+00   -5.067005298125792e-01   +2.262019144806936e-01   +1.693380878937150e-01   -5.455506436199796e-01   -1.675074335611934e-01   +5.689870006984730e-02   +2.246669012834205e-01   +9.600151871997620e-02   +2.378484669698237e-01   +1.156962779122146e-02; +2.002777728586826e-01   +3.321266339065943e-01   -8.844414941466755e-01   +4.136582990948279e-01   -1.235979213086345e-01   -2.721718025625854e-01   +2.432229359529444e-01   +4.160369536968668e-01   -5.149793718122061e-01   -1.925270859810562e-01   -1.844654479329173e-01   +1.032317510299532e-02   +1.553226218845433e-01   -1.971383374782996e-01   -4.285387470993865e-02   +7.503425964247279e-02];
L2I_L1I_iGABA_netcon = [-1.043796272335322e-01   +9.313993564064647e-01   +4.269912110619073e-01   -1.075478220151025e-01   +1.000035947386732e-01   +2.659861202243528e-01   +5.832975158010659e-02   +1.387818933941379e-01; +4.340554899541577e-01   +5.419852658637840e-01   +1.912481038263719e-01   +4.089670141176694e-01   +6.078035296253917e-02   +1.348618421895097e-01   +4.035954846180061e-01   -5.792921306131422e-01; -1.182363791196957e-01   +6.013156678100811e-01   +8.397404923641855e-02   -1.863048109887514e-01   +2.406707664234120e-01   +1.585885341825123e-01   +3.354851789351060e-01   +1.959473153170750e-01; -2.664849119054837e-01   -5.333409677372395e-01   -6.909871353956637e-01   +8.612941469161396e-02   +2.770330190327410e-01   -2.723550231200448e-01   -7.008824202847476e-01   -1.163987111063494e-01; -6.325959107775105e-01   +6.790621687442202e-01   +2.007663407264938e-01   +7.776895501645172e-01   -1.000000000000000e+00   +8.919603163949573e-02   -4.781638424592941e-01   -2.622760417484239e-01; -5.178453818088030e-01   -8.233744040645069e-01   +7.441362901749159e-02   -2.046361385484983e-01   +5.551153195593082e-01   -3.837893409920346e-01   +6.421863845999078e-01   -2.661130369206119e-02; +5.805111499560474e-01   +2.202072486857957e-01   -3.203160840464469e-01   -2.387943732880007e-01   +9.314129231055959e-02   -8.348696027476392e-02   -1.673952282262948e-01   +8.804664852465902e-02; +6.453487299369527e-02   +5.090903938831380e-01   -5.527224705135771e-01   -4.449628836161857e-01   -2.196485979456712e-01   +4.972889220377033e-01   -3.117906260965413e-01   +1.496293464792453e-01; +5.387959833891193e-01   -3.247681738520596e-01   +6.780258241490530e-01   +3.203051786063363e-01   -2.544139822558715e-01   -8.297199292521537e-02   +1.800223306057857e-02   +1.064227918511592e-01; -2.872273713686742e-01   -1.609962224198805e-01   +5.953083144807590e-01   +4.764488084828313e-01   +1.311416710459151e-02   -3.005615103762338e-01   +1.033929252034377e-01   +6.819339679928925e-01; +1.798742058945869e-01   -6.976956180363614e-01   -4.802544016508736e-01   +2.694356720193951e-01   +2.947484245225631e-01   +5.593920658046436e-01   -4.605080005283385e-01   +3.140696530372388e-01; -1.456492226697082e-01   -4.787716022792132e-01   +1.162345267174291e-01   +2.574568940732742e-01   -1.254073717322146e-01   -5.445525925012905e-01   -3.796544070891004e-01   -5.453222495772438e-02; -1.468858332374157e-01   -3.616204958191774e-01   -4.533504830220585e-02   -4.108962841835994e-01   +1.826790229524231e-01   +7.231474555974990e-01   -6.959121697023403e-01   +1.145206540538562e-01; -4.684735258264960e-01   +5.236409859536763e-01   +3.671960039997362e-01   +1.279267429493197e-01   +4.243430872959362e-01   +5.921228658465090e-02   +1.355602121202787e-01   -5.080013981850143e-01; +2.457778146570110e-01   -2.522404025449477e-01   +6.547016348270456e-01   +7.018807183906280e-01   +2.404068876080600e-01   -7.433580193638183e-02   -2.076892488319691e-01   +3.972174049549645e-04; +1.090281582887125e-01   +5.830007751618415e-01   -7.182164078176865e-01   -1.207426080047073e-01   -6.703294754521452e-01   +9.217625258735027e-01   -2.275816837706285e-01   -5.675149836394663e-01];
L1I_L2I_iGABA_netcon = [+4.508059432094686e-01   +1.919781290345231e-01   +3.847418371218929e-01   +4.270128798822601e-01   -9.210708802367124e-02   -5.824044206749765e-03   -1.798447515796656e-01   -3.573791971362703e-01   +2.461869787668316e-01   -7.894071061595501e-02   -3.458099245296224e-01   -8.755740414386934e-01   -9.100055278100208e-01   -3.497995290458659e-01   -2.576282227413201e-01   -4.612190651826670e-01; -8.556474164252731e-01   +5.660533854948668e-01   -1.729513210003891e-02   -7.293617684840835e-02   -1.126671873529093e-01   +1.771255318011492e-01   +2.798505134551986e-01   +1.780411855518852e-01   +2.846426472598824e-01   +5.273596616805869e-01   +7.240134773384949e-01   +7.876617046104935e-01   -1.827267094819804e-01   +3.530520437324531e-01   +2.755879153316498e-01   -4.486167405344308e-01; -1.203686271419119e-01   +2.431146771615459e-01   -3.209392638324970e-01   +8.516279120021566e-01   +6.434869246842607e-01   +2.438043481907338e-01   -2.465686378313682e-01   +3.731490932550859e-01   -4.178604839850937e-01   -3.695160855712508e-01   -3.325674716591785e-01   +1.494173446858195e-01   -7.160544241464866e-01   -3.473403077515771e-01   -9.877912420889207e-02   +1.919324946081776e-01; -8.110995630749055e-01   +5.445051771779262e-01   -2.852750915044210e-02   -1.478031440060552e-01   +4.465125473276859e-01   +2.205723082106831e-01   -5.629096446258723e-01   +7.316004624449632e-01   +4.223079654035889e-02   +1.068731731473026e-01   +7.498642307306689e-01   -2.259218926053257e-01   +1.550874430112344e-01   -2.379831578138066e-01   -9.147101255639477e-01   +4.005323723547882e-01; -4.066570574051329e-01   +5.976796063082316e-01   +1.000000000000000e+00   -7.259404030597515e-02   -2.686335399604516e-02   +6.771330296989087e-02   +5.213918514536618e-01   -1.348558719154025e-01   +4.502223744824030e-01   -5.923589484227300e-01   -2.475694547573379e-01   -3.552514747922446e-02   +6.847836079306460e-01   -1.144842209765042e-01   -3.788763302980169e-02   -2.064766142847768e-01; +2.039458239748339e-01   +7.723407577006679e-01   +1.711333708268315e-01   +1.661780922263782e-01   -7.032336257285528e-02   -2.177859287642995e-01   -4.600119095993686e-01   -2.032875644241856e-01   -7.568934845188791e-01   -2.484477596023079e-01   -7.683173171487132e-01   +3.352983518944737e-01   -6.006243192975931e-01   +3.535421179391076e-01   -3.407668813531226e-01   +5.481062170425359e-02; +3.309665589748333e-01   +9.725468495028440e-02   +9.776947764171693e-01   +3.361131562652115e-01   +1.376994137028310e-01   +1.576506104704524e-01   +2.096341682283872e-01   +3.560247757381386e-01   +4.080448509307656e-01   +2.913267881759455e-02   +2.801842732575608e-01   -2.623365320151342e-02   -3.583579920677421e-01   +3.896125703979822e-01   -3.659646126242667e-01   -1.602320010720197e-01; -7.007283765246313e-01   +7.888480877703383e-01   +2.488534691451283e-01   -7.021418110563569e-01   -6.937772040844906e-01   -4.106321261322023e-01   -2.930894854281342e-01   -4.703181100470112e-01   -5.744333818556591e-02   +3.261970603242330e-01   +2.343086513672026e-01   -5.502568702874502e-01   -2.676583194994438e-01   +6.610889097417854e-01   +2.970256476682432e-01   -8.171050254166905e-01];
L2E_L1E_iAMPA_netcon = [+2.441633486692910e-01   +2.674500763636402e-01   -6.182671961665761e-01   -4.680860459537328e-01   +6.398891170051314e-01   +4.352016855581058e-01   +3.622492879760784e-01   +9.474078233605882e-01; -6.137366452566800e-01   +7.269391040014098e-01   +6.625982474259122e-02   -6.782287848517179e-01   +5.397798862663575e-01   -3.617926373938866e-01   +8.425555592305904e-01   -4.334285743370659e-01; -6.994869674196014e-01   -2.621124389645077e-01   +1.630056659547620e-01   +1.382414402080736e-01   -2.687590328381112e-01   +1.429441451863596e-01   +4.712564415515922e-02   -1.000000000000000e+00; -6.369760029338256e-01   -1.421963560649817e-01   -7.974781573544312e-01   +3.611560443601877e-01   +1.264997949271905e-01   +4.654606302818595e-01   +1.178167380869529e-01   -4.802850453591264e-01; +7.574855138156436e-01   -5.220299622040628e-01   -6.421364168868349e-01   +4.033202701649178e-01   -1.819139666906537e-01   -5.647028302345904e-01   -4.110411771369705e-01   -7.138241288804700e-01; +3.127369797290586e-01   -4.103149290645234e-01   -4.265961269689489e-01   -8.531252669036831e-01   -9.078623464585058e-01   -3.305522627238807e-01   -6.413992779753088e-01   +4.588878865598372e-02; +6.715112619896633e-02   +4.009152498783833e-01   +1.181669412909446e-01   -7.991306387399687e-01   -2.470390321553217e-01   +5.039530026973675e-01   +6.626869828001245e-01   -1.957099843770378e-01; +2.246416223955934e-01   +9.976706069134138e-04   -3.069349016692520e-01   -4.656432914426265e-01   +3.343049311764295e-01   +4.916017764749189e-01   -3.669394693015328e-01   +2.125893587065971e-01; +1.771805322902576e-01   -2.843073602699608e-01   -2.794579419287181e-04   -5.178787077561003e-02   +6.415697178974729e-01   +7.578113858910387e-02   +5.140157380198430e-01   +6.534792551020277e-02; -3.555164450552216e-01   +2.264229481142467e-01   +1.733319134659481e-01   +1.605636642608878e-01   +3.785027104660822e-01   -2.838149307459247e-01   +1.793743529797091e-02   -7.704229780455273e-02; +7.678384973597013e-01   +5.841251628033658e-01   +5.380479392657261e-01   +8.700948395705453e-01   +9.015211406611484e-01   -8.559170897374833e-01   -4.117553400298148e-01   -2.137660872964401e-01; +4.295376082315312e-01   +4.003205912932405e-01   +3.557357961774891e-01   -1.985262716309733e-01   +7.320274033379055e-01   +4.792894939325528e-01   -1.088588182275339e-01   +7.519221574208921e-01; -1.579543936528998e-01   +3.564658620990042e-01   -4.243269505748395e-01   -6.112074605604433e-01   +1.129929785676064e-01   +3.376176141290985e-01   +1.816222161125892e-01   +3.512112674399469e-01; -1.527533089905345e-01   +3.014498604277962e-01   -5.532313046225119e-02   +1.928482147155236e-02   -6.414298782983087e-01   +5.537267081159273e-01   -3.873144895620085e-01   +2.083532758918593e-01; +1.328246396504206e-01   +3.050761475220775e-01   +1.470415999913591e-01   +8.909837843777656e-01   -2.947563812724363e-01   +9.501839945756775e-01   -3.213722095327433e-01   +1.079718972494360e-01; -4.740591458445613e-03   -5.054392357766719e-01   +5.711597917307525e-02   -5.181115797963320e-01   -9.421433652033137e-01   -7.513840143030862e-01   -1.273509518850002e-01   -4.055785664037723e-02];
L1E_L2E_iAMPA_netcon = [+3.608457826331659e-01   +1.857611501609221e-01   -2.449675204117466e-02   -3.339161203457611e-01   -3.807142247248753e-01   -1.566458514861527e-01   +3.453694356187275e-01   -7.150196496079771e-01   +3.759951055324018e-01   +6.626289908172346e-01   +4.838274880724896e-01   -2.880269331828241e-01   +7.078866281811916e-02   -4.385466444155438e-01   +1.016570131997363e-01   +9.112736679961349e-02; +4.323704913990888e-01   +5.441864797393872e-01   +3.091832887200740e-02   +1.699087859377046e-01   -3.906911216922113e-02   -7.411605490558970e-01   +4.555658624760033e-01   -3.611822173644353e-01   -7.740408501489286e-01   +4.356236900099101e-01   +5.291841478272641e-01   +2.108775606321002e-01   -1.520496512659819e-01   +1.729733402006563e-01   +6.193280795536475e-02   +7.544405533438105e-02; -1.704909692873542e-01   -7.712691682742095e-02   -3.328734031214262e-02   -4.984499889562709e-01   -8.511387900998427e-01   +7.342025392300938e-02   -1.359320511983804e-01   -4.862352174940734e-01   +7.408461676496637e-01   -1.607008503065253e-01   -1.448634012553451e-01   -1.567384431967636e-01   -3.217748875314645e-01   -9.968500133240360e-02   +6.066748159428983e-01   -3.894867320443447e-02; +4.443143619041242e-01   -8.370935792590585e-02   +5.842508927296083e-01   +1.857977825356295e-01   -9.244395303217520e-01   -2.568495659740450e-01   -2.903946018024330e-01   -1.472501550306986e-01   -4.173261772074414e-01   -2.142889809401596e-01   +6.751644166465023e-02   -1.091114386706674e-01   -4.218936032286614e-01   -6.297221856813802e-01   -1.306370051891118e-01   -4.335415249809709e-01; +9.134468505336632e-02   +4.353818458800769e-01   +3.897934478363825e-01   -4.486439049950762e-02   +1.606764963501851e-01   +2.885704438293549e-01   -5.520572680681928e-01   +3.893240565184292e-01   +6.715418017482380e-01   +1.334303479971393e-01   -4.709146720826519e-02   +2.274415337424746e-01   +7.715367683176753e-01   +3.090321799804135e-01   +6.096216646982028e-01   +4.148163447397540e-01; +3.646971979709456e-01   -7.510667750379726e-01   -3.351839443476118e-01   +1.493532961579407e-01   +7.085386744147716e-01   +1.825829884181934e-01   +2.074955027661112e-01   -1.190520221240444e-02   -2.285703746219485e-01   -9.995402106312086e-01   +2.741017822304638e-01   -2.770576542537562e-01   -9.712317244844695e-02   -1.720437195659189e-01   +7.639189361890737e-01   +7.881339260707153e-01; -5.985823671976412e-01   +1.000000000000000e+00   -9.010644498534763e-01   -2.850246706120996e-01   +1.177635154627185e-01   -5.063942826797335e-01   -1.213626456918780e-02   +3.738651686722009e-01   -5.217516511123467e-01   +2.051281460576810e-01   -9.727739401565541e-02   -2.408917458649469e-01   +3.963021853656918e-01   +8.306209343275027e-01   -6.740652849527677e-02   +5.388840846556350e-01; -3.545680070106239e-01   +1.138747900192583e-01   -3.456933860832360e-01   +1.505266688769296e-01   -4.477423221363702e-01   +5.244787826583416e-02   +1.788857921979140e-01   -9.798503672803677e-02   +1.157856242219419e-01   +1.076781572114121e-01   +2.122235277643661e-01   -1.274936681531523e-01   -2.434087652807768e-02   +1.737561268236283e-01   -4.482874213441940e-01   -6.539277392166025e-01];
L2I_L2E_iAMPA_netcon = [+6.612008652460506e-01   +6.709016374429060e-01   +1.202417365491328e-01   -3.630615210115041e-01   -2.715175590820734e-01   +3.106541216174137e-01   -6.583930274892301e-01   +1.144814617328328e-01; -5.501510932408513e-01   -1.256077723843640e-01   +9.478741606589679e-02   -3.809721862835461e-02   +7.636448546843950e-01   -2.508498816867458e-01   -6.470101751234862e-01   +9.273862733473093e-02; -3.243224968637178e-01   -8.765944262750942e-01   -6.190797360948382e-02   -6.364811728887046e-02   -6.216434610811237e-01   +4.334469809565564e-01   -4.911910066452233e-01   -3.888651003181963e-01; -6.034103826240977e-03   +2.172768972106420e-01   +4.002276053070857e-01   +8.447737737860478e-02   +1.902863530968677e-01   +1.158314123494034e-01   -5.551265691933214e-01   +9.653551492379326e-01; -6.337444484621624e-01   +3.256342671940343e-01   +4.190383112366047e-02   -5.906861755101731e-01   +7.165521626454109e-01   +1.745423285146819e-02   -6.158029705048838e-01   -3.564790204945333e-01; -9.801414243178155e-01   -2.799496339600124e-01   -9.176296056354118e-01   +8.970594067909725e-01   +1.554553380615947e-01   -5.414778549274614e-01   -4.714023537198765e-01   +1.413931021292905e-01; -3.894472746145147e-01   -4.126778814171091e-01   -7.201563499535116e-01   +5.953053740637231e-01   +2.995224441778416e-01   -7.559158636720161e-01   +5.544364183649436e-02   -6.463296291120108e-02; +3.295359864997638e-01   +2.712574591228186e-01   +2.272229475761689e-02   -1.198110330860427e-02   +2.577761732099398e-01   +2.609257038897270e-01   +3.703476052775329e-01   +5.286569229667604e-01];
L2E_L2I_iGABA_netcon = [-1.920247563980841e-01   -3.020665987324724e-01   -4.964989037988440e-01   +2.432596079741353e-01   -9.468232452703476e-02   -2.761387389733725e-01   +7.535898588478238e-01   -8.352950047380703e-02; +8.306506587986491e-01   -8.153925163496745e-01   +5.119563174561259e-02   +2.546590917712783e-01   +8.620343872759115e-01   +8.895514186296727e-02   -2.870686809117995e-01   -1.463837503524738e-01; +2.611895033215300e-01   +2.988452998645403e-01   +3.183588855014808e-01   +1.581042282066364e-02   -8.476909401552990e-02   -5.068592485431946e-01   +7.285457284618531e-01   -4.487363361388728e-01; -2.238721769372579e-02   +1.183662721194409e-01   -3.897233280109814e-01   -5.928837952918413e-01   -1.314359210909081e-01   +4.676293417703824e-01   +4.675824049353529e-01   +5.410721959404702e-02; +8.568011681074156e-01   -3.347550053344972e-01   +5.441525202905590e-01   -6.441784384103152e-01   -3.840742354624439e-01   -2.579894404871161e-01   +3.088418781957622e-01   -4.651920818601090e-01; +1.268437873160883e-02   -5.772494743208251e-01   +5.921167034546723e-01   -4.201017113486994e-01   -8.096889939324640e-01   -1.600408703256495e-01   +3.785274720169891e-01   -4.943382859321294e-01; -1.382529798714725e-01   -2.861370109302763e-05   +4.439255768062067e-02   +4.204198867171789e-01   +5.782310328440562e-01   -7.861757688655706e-01   +1.602950997334074e-02   -8.887494171572809e-02; +6.702802656976636e-02   +3.361102193249488e-01   +4.441422578702601e-01   +6.363165092972813e-01   +5.729324349610200e-01   +3.318415610035243e-01   -1.577812410614517e-01   +1.457196688238636e-02];
L3E_L2E_iAMPA_netcon = [+7.764026600476395e-02   +3.548282935366760e-01   +1.401527872646951e-01   -1.704265481169032e-01   +4.932572711498578e-01   +1.274625250550465e-01   -6.393946021298503e-01   -1.741211013628354e-01   +2.324709068602323e-01   +6.032855281130679e-01   -4.477209060288361e-01   -1.744566814869020e-01; +3.607620892276253e-01   -7.997287793882045e-02   -3.204580221989566e-01   +5.709003283072891e-01   +4.479110551900295e-01   -5.875546627182823e-02   +3.452858087376163e-01   -4.694004650988319e-01   +4.324155594238656e-01   -3.942789810606064e-01   +1.907727152279041e-01   -1.412650005905602e-01; -4.705451996207354e-01   +1.880653605506117e-01   +7.465652940271682e-01   +2.183350761283234e-01   -6.720970104732822e-01   +6.468910687451921e-01   +3.049363045817469e-01   +7.276245756969969e-01   -3.250792925819427e-01   +4.908984986043521e-01   -1.000000000000000e+00   +4.788341593506053e-02; +2.245723788040351e-01   -7.741638897132314e-02   -2.716421231632787e-02   +3.600495041137202e-01   -4.070261437820766e-01   -1.659419160517918e-01   -3.198052748497707e-01   -6.382952368178860e-01   +1.490720233150936e-01   -6.094174678987152e-01   -4.499554582304174e-02   -4.366003244594965e-01; +6.886627028575643e-02   -5.399940735033566e-01   +6.800122123375586e-01   -5.312703415411359e-01   -1.163854007891695e-01   -3.161333536767978e-01   -5.583752938886420e-01   +3.346421571282351e-01   -5.750033088526732e-02   +1.651037505226626e-01   +5.616737659466266e-02   -3.336406573013657e-01; +1.930848733205469e-01   -6.207153328280520e-01   -2.756179668859962e-01   +8.069762456749117e-01   -5.742669730024024e-01   +3.630762826315911e-01   -2.257687869628614e-01   +2.171870180880602e-01   -2.035932636152060e-01   -3.770885378169116e-01   +3.038370314791050e-01   -6.058047837893376e-01; -1.849564275288491e-01   +3.109617409091565e-01   +5.372196387059011e-01   -7.832189087454559e-01   -1.369184191780805e-02   +3.102581626248346e-01   +2.277895963635210e-01   -5.777032848293907e-01   +5.344937065661008e-01   -6.331823230550131e-01   +6.104330925527935e-01   -2.351015052017698e-02; -1.430211558555356e-01   +2.548394152448640e-01   -9.887391288474668e-01   +1.392319859243964e-01   +6.481400774223679e-01   +3.208139235476605e-01   +6.042891015623336e-01   +5.231830539816863e-01   -1.031674436062137e-01   -1.624815073465569e-01   -1.432255837582090e-01   -3.977903035410197e-01];
L3I_L2I_iGABA_netcon = [-1.452326467937753e-01   +8.323268035386433e-02   -1.915804217662665e-01   +5.224342854459234e-01   -3.430992991340406e-01   +8.053976359050121e-01   +2.552312982046790e-01   +2.577671110414324e-01   -2.143590908525851e-01   +9.283922331757291e-02   -9.407285358198753e-02   +1.967279406380523e-01; -7.208176766619050e-01   -3.987289482345494e-01   +6.987052212345173e-01   -2.995408743095275e-01   +4.467675383064303e-01   +4.434252572207396e-01   -1.776961193579265e-01   -1.974252527345139e-01   -1.519669789996433e-05   +9.073126224056430e-02   +2.989003673716632e-01   +1.727200672461510e-01; -1.000000000000000e+00   +1.477593397929640e-01   +3.164175808083068e-01   +2.472924358947940e-01   +2.012113276572278e-02   -7.522268588079620e-02   -2.217436881699922e-01   +2.322975835992362e-01   -5.466352329594275e-01   +8.344563528403390e-01   +6.433784592818533e-01   +8.610204629287519e-01; -4.196534864731817e-01   +2.126294308283391e-01   +2.688359127546762e-01   +4.974167511169605e-01   +2.396886967355600e-01   -8.904068078051454e-02   -1.863259764998394e-01   +4.177065048117352e-01   +3.326576475671889e-01   -8.675828587582756e-01   -5.636538848671605e-01   -4.568368261692908e-01; +1.998663201174936e-01   +9.041053121197595e-02   -1.847902768636686e-01   +4.439654545066194e-03   +4.661348865526014e-01   +1.684397268664035e-01   -5.222748417543089e-02   -2.302610665349639e-01   -4.834090776732100e-01   -4.654876680148118e-01   +6.885597088559653e-01   -1.844651011755349e-03; +5.032777873693709e-01   -1.069777198759294e-01   -5.064589869379602e-01   -1.297223178058553e-01   -4.707124472913608e-02   +3.029884473279335e-01   -1.600393952827312e-01   -7.183867529180477e-01   -1.030449894506140e-01   -4.055865626864412e-01   -1.132990824423249e-01   -4.960691096541816e-01; -1.782377794459898e-01   +4.141933079567139e-01   +4.062275984349654e-01   -9.028851417650982e-01   -3.540910667114651e-01   -4.956645946204451e-02   -4.789264917291643e-01   +1.624493537511998e-01   +1.445141285514842e-01   -2.032489674937912e-01   -1.350686594052145e-01   +8.326260149314867e-02; +2.136089035104743e-01   +1.310509583344711e-01   +6.801524235204127e-02   +2.458418822966925e-01   -2.769772223734256e-01   -8.540196329192167e-01   +7.511357369855146e-02   +1.646260389795222e-01   +1.098004396016740e-01   -6.716866398727571e-01   +2.824400785578416e-01   -2.305691116663345e-01];
L2E_L3E_iAMPA_netcon = [+4.073264848035572e-02   -6.640538610527689e-01   -8.383851737583574e-01   -7.262058429802107e-01   -6.695651830965593e-01   +8.692013168604960e-01   -4.487653182236902e-01   -4.162701388087635e-02; -3.461332919429974e-01   -2.230899252709651e-01   -3.793648828191449e-01   +2.571032480751569e-01   +6.248770171140666e-01   -6.606730148736965e-01   +1.769326099654532e-01   -1.432087969008895e-01; -4.237282468046612e-01   -6.780550734032404e-01   -2.365331578731368e-01   -4.974908755787747e-03   +9.518397064632813e-01   +7.392790255536278e-01   -2.303683248938973e-01   -2.255716849085525e-01; -7.901625567262306e-01   +2.967706137011179e-02   +2.515843125330928e-01   -7.296934077433871e-01   -2.240403914309056e-02   +8.956900511586244e-01   +8.856348007070890e-01   -2.818077166698604e-01; +8.102578288844492e-02   +1.341589898003870e-01   +3.730208592410294e-01   -4.837119476193600e-01   -3.492762247951729e-02   -6.535312969328351e-01   +1.000000000000000e+00   +2.834911225488865e-01; -8.357852003771539e-01   +6.528798616924685e-01   -3.294413280946801e-01   -6.054907819900801e-01   +2.060743466312294e-01   -1.438880782147453e-01   -5.902407247615244e-01   +6.789457164318518e-03; -8.770318955222668e-02   -1.015070538620870e-02   +4.241472743434392e-01   -1.555075751460177e-01   +2.025696731318712e-01   -1.482238331671977e-01   -1.353120690128099e-01   +4.796778831770585e-01; +3.515858448144419e-01   -4.621870337169835e-01   +5.425147246703161e-01   +9.922189166349075e-01   -3.296596636232582e-01   -8.015337220872302e-01   +2.406805777806788e-01   -9.268452330506990e-01; +4.239483769576166e-01   +5.913421115060168e-02   +2.033231574413331e-01   -3.268747384991390e-01   +5.316556857466573e-01   +2.711748555594153e-01   -4.189629697379123e-01   +2.092946905301757e-01; -1.043591199541954e-01   -9.282941509544002e-01   -2.478058227939492e-01   +2.690787274098532e-01   +2.099345669272328e-02   +1.523281963551849e-01   -1.907006152910214e-01   +1.426363396010887e-01; +2.725999897407839e-01   -6.309003171846399e-01   +3.488156706874805e-01   +6.714406632113677e-01   +4.885530121062430e-01   +9.485612344113555e-02   +8.420291805158561e-02   +7.522652034979376e-01; +9.671272527479207e-01   -8.880630314804518e-01   -4.738322822158900e-02   -1.278805746477718e-01   -1.868353038665196e-01   -4.474641857804611e-01   +8.494208329038692e-02   +5.629534587969198e-01];
L2I_L3I_iGABA_netcon = [-7.536113640471179e-02   +4.276490788985605e-01   -7.327213181978555e-01   -2.266838485609252e-01   +3.773689254004031e-01   -4.259428022268337e-01   -2.602146553661328e-01   +4.201498525502292e-01; +8.994841847611819e-02   +3.382252418661484e-01   -5.700065684275089e-01   -2.263964177917230e-01   -1.065590235946959e-01   -1.412025553729040e-01   -1.545585451858771e-01   -1.591694519797161e-01; +2.534294922897241e-01   -1.000000000000000e+00   +4.007456646500576e-01   -3.790241453928253e-01   -2.004996967724673e-01   -2.246745981182641e-01   -9.662266341956423e-02   -3.236172114562305e-01; +5.035989345938389e-01   +6.627878072966790e-02   +1.233346111757831e-01   -2.691447385195667e-01   +1.589658151815509e-01   +5.342415579484775e-01   +5.786476568031403e-01   +6.003608463293982e-01; +3.842209903334789e-01   -6.548422712724320e-01   -2.957108674422380e-02   -2.259554074777531e-01   -4.574433863985160e-01   +3.987781055753691e-01   -8.350717493435408e-02   +2.331513827119571e-01; +1.442971220647792e-02   -4.878739171568534e-01   +8.162850519742669e-02   +1.381120037746446e-01   +5.438854695040817e-01   +6.522853493998119e-01   -6.836830209002012e-02   -3.528345791282137e-02; +1.653730471556174e-01   -4.777886619238642e-01   +4.155992339438533e-01   -2.406108143875456e-01   -5.014663390468277e-01   -4.692420927901797e-01   +4.631412123646576e-01   +7.122002742197030e-01; -3.605222217580289e-01   -4.153675485331793e-01   +5.644283116535622e-01   -6.350813699657114e-01   -1.472498464850369e-01   -3.922971457069277e-01   +9.310789065571005e-02   +4.790869169853412e-01; +3.215929546250797e-01   -1.745423469243486e-01   +2.359724251626534e-01   -3.841770061857007e-02   -3.574466577841792e-01   +7.128552391650890e-01   -1.938880818417073e-01   -1.461682288009264e-01; +2.458455200820611e-01   +6.744394188716263e-01   -2.160617238630483e-01   -4.463555959973118e-01   +6.067567855535331e-01   -6.534864015964953e-01   -7.529120337587333e-01   +5.285992009354890e-01; -1.446314619506676e-01   -3.454581338530252e-01   -2.733548233866041e-01   +2.373903919449638e-01   +7.500034754706253e-01   -1.940424399795625e-01   -3.121592793892332e-01   -8.598365794647966e-02; +2.936161573189670e-02   -3.219565344084374e-01   -1.361445148510259e-01   -2.169686371735084e-01   +8.747127245993948e-02   -5.207120535313343e-01   -2.393540069430868e-01   +4.918719527189372e-01];
L3I_L3E_iAMPA_netcon = [-5.932813249478752e-01   -8.507017679251293e-02   -1.420647641304834e-01   -1.314900007216962e-01   -3.921219611593622e-01   +2.644227866712470e-02   -3.476214483417535e-01   -5.645711052294949e-02   +8.362242713626339e-01   -9.916651173151972e-02   -2.269486745303437e-01   -1.200310950990058e-01; -3.212621493025780e-01   -3.440384788886433e-01   +1.706426681474225e-01   +4.098329736305053e-01   -9.388397173708361e-02   -3.027691083041060e-01   -1.978805133828939e-01   +4.921138556792489e-01   -8.758960758938873e-02   -4.179842586112410e-01   +3.910129999424405e-01   +1.889247760736512e-01; -4.917905235201314e-01   +3.180497880630606e-01   -3.190579302358619e-01   +1.864254853793391e-02   -3.886251680549093e-01   -2.388914573964059e-01   +1.657678945416688e-01   +6.057228606561715e-01   -1.842640089494931e-02   +3.025137976573996e-02   +1.081054088888453e-01   -4.453177447845766e-01; -2.783351754667793e-02   -3.246821598561211e-01   -1.560072295491705e-01   -3.912331042732007e-01   -6.481091294175602e-02   -3.892417779600051e-02   +5.549826318134176e-01   -1.090072065874506e-01   -4.586420831827707e-01   +1.192659083277593e-01   +4.835665080032659e-01   -1.894766813871655e-01; -7.209150969820775e-01   -4.400795007077658e-01   +4.847842950345321e-02   +1.518485064293332e-01   -3.325504689793303e-01   -3.848211629290980e-02   -2.288820206495659e-01   -4.039735025680170e-01   -3.534248310515861e-01   +3.495685762757892e-01   +2.809546344130249e-01   +2.144099052318885e-01; +7.213488586146486e-01   -3.371147223659321e-02   +6.504721875952782e-02   +8.539473122388644e-02   -5.641155529930368e-01   +5.362693363052697e-01   +2.205474190908092e-01   -3.286390317641909e-01   +5.602754814060441e-01   -4.834637938470925e-01   -3.598360717772953e-02   -3.937489504229489e-01; -3.742997025696103e-01   -2.851555703759504e-01   -1.083701527843273e-01   -2.365297300567084e-01   -2.887545323609315e-02   +1.536004908512865e-01   -4.236504235523121e-01   +2.246265663983950e-01   +2.649479670859339e-01   -1.446142224207339e-01   +5.291992356147104e-01   +1.398264526832843e-01; -1.277510353930567e-01   -3.348806462657111e-01   +8.472905280118787e-02   +3.707249456031989e-01   +5.246703201973237e-01   -3.067684685472932e-02   -4.327328453210474e-01   +3.655049063128236e-01   -3.072366293105774e-01   +1.738311617675480e-01   -3.535029017373437e-01   +1.680591416894009e-01; -5.660022076162991e-02   +4.521607782262005e-01   -7.759576232983378e-01   -3.474378642363122e-01   +2.577597579688590e-01   -2.548151506374579e-01   -1.280807941723244e-01   +4.801064264088979e-01   -3.795055729826603e-02   +1.592691028862726e-01   -3.426354991212387e-01   -3.459999328845766e-01; +4.651969848703106e-03   +5.304907632500501e-01   +3.866475243113308e-01   -2.715539678116359e-02   +5.520677363147545e-01   -5.688956489102335e-03   -4.379126561160064e-02   -9.854733303091706e-02   -1.000000000000000e+00   -7.634886767731942e-01   -4.373165714758662e-01   +5.883594069344169e-01; +3.746541064726258e-01   +6.525083276876665e-01   -2.322357139994396e-01   +7.167080148344075e-03   -2.551675215273274e-02   -5.093939338597762e-01   +1.518248368288377e-01   +2.169852744566870e-01   +4.223141251075125e-01   -6.137661721745676e-01   +5.343785093096266e-02   -4.952557057622813e-01; +1.701436529236937e-01   -9.737427334412384e-02   -8.500285861312080e-02   -2.148198128940549e-01   +5.741851090300570e-02   -2.120869760694817e-01   -3.468371740032674e-01   -3.230151300806951e-01   +1.118673513817740e-01   -1.835819355931732e-01   +2.800258896466207e-01   -4.851310453364576e-01];
L3E_L3I_iGABA_netcon = [+1.492651575194183e-01   +2.377888773638681e-01   -4.141892991444918e-01   +2.616534613248230e-02   -2.022913723014738e-01   +3.363343216980216e-01   -7.613413585316030e-02   +5.502801606726280e-01   -1.059245681801388e-01   +2.074927468590544e-01   -3.814607657372483e-01   -3.174222506711661e-01; -5.917963491116271e-02   +4.716264483670621e-01   +1.239700924391994e-01   -4.429371858056983e-01   +3.639710078994095e-01   +3.580807818203076e-01   +1.416183984240838e-01   -7.306790002975213e-01   -1.661749471678950e-01   +3.883164421095549e-01   -9.389554850261617e-02   -8.200562124866584e-02; +1.607926033712426e-01   +1.905409018141487e-01   +5.873865094801397e-01   -1.469447354244938e-01   -2.200593094364784e-01   +3.034125283452713e-03   +6.679703189518002e-02   -6.231566272902902e-01   +4.801526986725754e-01   +3.748109614339538e-02   +5.155859297035447e-01   -1.006751419677126e-01; +5.576202721030722e-01   +1.197137481653734e-01   +1.906874051466732e-02   -4.545295474372804e-01   +7.813495596044130e-01   +1.234381793206682e-02   -1.329675656681159e-01   +5.462151031760420e-01   -8.728101847909643e-02   +1.962333264987848e-01   -1.000000000000000e+00   +5.645536087172298e-01; -3.479547010261080e-01   -6.379964571581251e-01   +4.812086077463320e-01   -1.026533562599804e-01   +1.867563738368381e-01   +3.704844616343793e-01   +2.806158294499069e-01   +3.781197021715094e-02   +2.982053486133947e-01   -3.870061138741881e-01   +3.457692362055406e-01   -1.943168064660124e-01; -2.404097156260992e-01   -3.993202286036155e-01   +5.584620357441656e-01   +6.792775905861588e-02   +2.724658811170125e-01   +6.820145339934189e-02   -1.306214858205673e-01   +4.891832866842262e-02   +4.286367573818260e-01   +1.304121574345636e-01   -1.471139863873947e-01   +1.886505725065944e-01; -3.193036738800666e-01   +1.423438387932251e-01   +3.233626660942759e-01   +6.788833390670376e-01   +2.096457461144290e-01   +5.350329736041765e-01   +9.608187170356468e-01   -5.902409706986288e-01   -1.383536351321581e-01   +3.196334459499222e-01   -1.188316929346188e-01   -7.835809342437704e-02; -3.445690251685255e-01   -5.215649881626402e-01   -4.037148709807065e-01   +3.086715207074489e-01   +4.711982155313815e-01   -5.624853588505025e-01   +3.071936311596293e-01   +4.571323391627345e-01   -5.822058125782420e-01   -3.665766933271754e-01   -1.187763678313138e-01   +2.205473721379614e-01; +3.077267171100913e-01   -3.814360724628784e-01   +2.494056032674444e-01   -1.445152484265046e-01   -8.794782602367651e-02   -1.114702711159559e-01   +2.639660551818404e-01   +2.003343909826862e-01   +5.313803675393297e-01   -5.404441332427105e-01   +7.334987381046868e-01   +3.425510506874425e-01; +1.192700736166752e-01   -2.210681407970279e-01   +2.329764802676669e-01   -6.597682271799784e-01   +1.512069141263730e-02   +3.026009490503764e-01   +6.108434700411550e-02   -6.829857123279307e-01   +8.292947683048603e-02   +3.917984967065213e-01   -1.232072947158045e-01   -5.508175461274588e-01; -7.336526621100270e-01   +5.812473117319516e-02   -4.617706873854486e-01   +3.120147671154568e-01   -4.480489998869719e-01   +4.666028825823129e-01   +8.432818975191017e-02   -6.671731453163325e-01   +3.348414077030815e-01   -1.678157091963900e-01   +2.992489009387028e-01   +3.009480482419811e-01; -5.422462166299634e-01   +3.602803775220013e-01   -8.631632706688159e-01   +6.860665847065679e-01   +2.930240464582070e-01   +3.159524990525253e-01   +4.892367050872262e-01   +6.956214498906741e-01   +2.766381610326752e-02   +7.813136926354148e-03   +1.090081988490658e-01   +1.854033383622798e-01];
L2E_Input1_iAMPA_netcon = [-2.627687883201468e-01   -1.895728765477035e-01   -3.733195673349220e-04   +1.000000000000000e+00   -5.613444497604700e-01   -3.233583937722957e-01   -1.908978743886765e-01   -1.677691827927419e-01];
L2I_Input2_iAMPA_netcon = [+1.818905720646186e-01   -3.484886894348761e-01   -1.788429305958850e-01   -1.000000000000000e+00   +1.311312816383473e-01   +3.316421840300185e-01   +1.843483933042676e-02   +1.102089699922122e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
