function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.770165400634140e-02   +9.352636879429371e-02   +5.993621513176328e-02   -2.641675720600647e-02   +1.041591383628857e-01   +1.836395501899000e-02   +4.264790873317324e-02   +8.087485968395229e-02   +1.952325016509282e-02   +1.005661734184214e-01   +1.569701528177193e-01   +1.524349617935313e-01   +4.803687704093978e-02   +9.448273496110650e-02   +1.547627413153657e-01   +5.765943284019021e-03; -1.302568747171263e-02   -3.314632561113262e-02   +5.180531635161274e-02   +1.725171179102465e-01   +1.060346406174582e-01   +1.442038476182197e-01   +1.099558144671187e-02   +1.643663032143899e-02   +6.357440322068385e-02   +4.520042695331465e-02   +5.069469043941779e-02   +1.048608336224088e-02   +1.583584411201364e-01   +1.178090142681358e-01   +7.518268441309611e-02   +1.213094303197418e-01; +1.366490530523932e-01   +6.513646474242354e-02   +5.444428336031901e-02   +9.071476816499221e-03   -2.337284253798835e-03   +5.837565502415289e-03   +5.198238010134441e-02   +2.443568974871290e-02   +2.186847573912036e-02   +1.699344697494617e-01   -7.622473443369835e-03   +7.381797070516523e-02   +2.206661521997735e-02   +9.490299646154880e-02   +5.518485800482964e-02   +6.230902413105949e-02; +6.232323051055738e-02   +1.342864412741989e-01   +1.371399251970609e-01   +1.331671330410569e-01   +1.010466487669150e-01   +1.912858468785494e-02   +5.488625163983812e-02   +1.142100583139120e-01   +4.074353173047879e-02   +8.253154203105190e-02   +2.783055728743262e-03   -2.428044821637369e-02   +9.614635918167241e-02   -5.727985635203489e-02   +1.499564867250523e-01   +5.868531452981174e-02; +7.514591364146463e-02   +1.011445957968784e-01   +1.881659031236710e-01   +8.674932034030448e-02   -1.974517263971161e-02   +5.469398190690412e-02   +1.240826011721041e-01   +9.991866994105697e-02   +4.199213984242563e-02   +4.924443059701325e-04   +1.860398838798942e-02   +3.067620127449813e-02   +7.619222847324018e-02   +4.023985123004697e-03   +7.804311169905920e-02   +1.549498102384754e-01; +8.907427369101104e-02   +2.735082660686850e-02   -2.023231394791091e-02   +1.380514075386333e-01   +3.165584260282942e-02   -1.459960468069505e-02   +9.078749368951074e-02   +1.457590163121118e-02   +8.414006501652510e-02   +8.357514106777413e-03   +1.287892817891803e-01   +1.727100805566362e-01   -2.565801671350571e-02   +3.439284607861948e-02   +3.820397023072362e-02   +4.423982228219703e-02; -5.002789982810749e-03   +4.892553401336681e-02   +2.607169882732812e-02   +1.415509231069730e-01   +4.160316870526173e-02   +3.783558141058099e-03   +1.095402133576389e-01   -2.818014699481158e-02   +1.561846182745320e-01   +9.910506649055972e-02   +2.386101147530111e-02   +1.021990085675654e-01   +3.452455918045797e-02   +1.100248339211214e-01   +4.444183994243498e-02   +1.079726715722285e-01; +5.893100922919931e-02   +5.970868018303918e-03   -1.600042777154435e-02   +4.247833619771087e-02   +7.648724700187676e-03   +1.820830905621871e-01   +5.076538373680655e-02   +3.524539466132406e-02   -2.712668639901637e-02   +4.120558440783909e-02   +1.299962327361435e-01   +4.586486623830852e-03   +1.564133323181879e-03   +7.066329319216794e-02   -1.712587824951261e-02   -1.579692364129417e-02; +1.237304382056564e-01   +1.709225844848192e-02   +1.039306750345855e-01   +1.129420983427139e-01   +8.940121978762536e-02   +2.830002477275067e-02   +2.697087737994549e-02   +3.036969453787342e-02   +5.484267532875364e-02   +3.907213837173492e-03   +1.646711609458821e-01   -2.005887452143030e-02   +5.544535890732798e-02   +8.819409065236778e-03   +7.970043742845469e-02   +5.469901502656931e-02; +4.653706772445234e-02   +4.552335003400775e-02   +6.209383739673489e-02   +1.122760319954127e-01   +1.197183858797369e-01   +1.641714102588747e-01   +3.347553596253908e-02   +8.382814108721893e-03   +7.175756701139990e-03   +1.457549601775229e-01   +9.606467352408105e-02   +5.143128711866246e-02   +1.771552414907857e-01   +1.267105415482389e-01   +1.096057861003679e-01   +2.532454331599140e-02; +5.464661205607503e-02   +4.848671590920233e-03   +7.026834919506406e-02   +2.078911663104250e-02   +4.243258613305620e-02   +1.973822019670334e-01   +1.353476376744116e-02   +1.026833692342386e-02   +2.564728140718880e-02   +4.234258929603514e-02   -3.441624086550073e-02   +1.028469770890732e-01   +5.662268846046743e-02   +6.753497016364492e-02   +8.378590374405137e-02   +9.042982020138315e-02; +6.146543657226992e-02   +5.639523141087992e-02   -8.010991936160363e-03   +1.467756064893573e-01   +6.259760336353699e-02   -6.963147214923242e-04   +1.043424857253950e-01   +8.708049405473450e-02   +1.037479131642786e-01   +7.078277893674849e-02   +1.169227087271597e-01   +1.004386002136757e-01   +8.853840938496804e-02   +9.077857400885640e-02   +1.099906253948162e-01   +1.379318209639323e-01; +1.797217233700769e-01   +7.874508458515030e-02   +6.974956596331679e-02   -5.425771284884566e-03   +5.811816807327917e-02   +5.583777073257223e-02   +3.556508887915607e-02   +1.207999199075514e-02   +9.259895611524030e-02   +1.551931054766872e-01   +1.352203100600240e-01   +2.723771402894439e-02   +5.949017197941489e-02   +2.662141338066425e-02   +7.185548908812781e-02   +2.730871915203478e-02; +1.323644448088032e-01   +3.523487022619340e-02   +6.596197407070242e-02   +1.449953916798559e-01   +1.731248062231981e-01   +3.445861345486921e-02   +8.612895168975608e-02   +5.582424984854367e-02   +6.451059269256779e-02   +8.940434202906418e-02   +1.484624622596697e-01   +1.711898694700473e-01   +1.405152318954358e-01   +1.789841478975732e-01   +1.677450905680952e-01   +9.177144684825789e-02; +8.226485540481966e-02   +4.099562869508913e-02   +1.523658188262404e-01   +1.223984810137902e-01   +1.048461471713907e-01   -2.193332924278727e-02   +1.150963318839255e-01   +7.887399157371615e-02   +1.330294046332569e-01   +1.076722796991260e-01   +8.658331712202452e-02   -5.794645300617821e-02   +9.513515926897020e-02   +2.073495960217974e-02   +6.224151293234063e-02   +1.309783384307667e-01; +1.836288218601879e-01   +7.947508588005962e-02   +8.081635647586195e-02   +3.501090032005426e-02   +1.220920327435897e-01   +1.420116754504950e-01   +8.217517029793922e-02   +5.789264494432326e-02   +6.217171468567359e-02   +3.326466882287171e-02   +8.913726418188145e-02   +3.641306226294957e-02   +1.185568422939151e-01   +1.642542842811997e-02   +6.769443481488967e-02   +1.216215826721407e-01];
L1E_L1I_iGABA_netcon = [+2.576081287848029e-02   +1.803223448193960e-01   +1.549606743481548e-01   +1.432678204505395e-01   +4.644831478299614e-02   +1.095770057611561e-01   +7.676304449610580e-02   +3.333362225257859e-02   +9.953872510819224e-02   -1.010930484083100e-03   +6.442685633227781e-02   +2.992159287003557e-02   +3.718620141599769e-03   +1.324100532331893e-01   +8.023678772077410e-02   +1.437942551523538e-01; +1.274081490475199e-01   -9.494622437095299e-04   +2.561868623633773e-02   +6.373134920279887e-02   -4.069628123996070e-02   +9.278516210068974e-02   +6.194569019257763e-02   +5.431111495237496e-02   -3.823818722041263e-02   -5.517339054812954e-02   +1.022501890573290e-01   +4.453473450851137e-02   +5.094162964013894e-02   +1.086627978240551e-01   -2.087155917756954e-02   +9.998271905868961e-02; -1.404097761858836e-02   +1.450544540743499e-01   -2.297944573445291e-02   -2.221375822827745e-02   -3.075757538944811e-03   +1.436682796373346e-02   +9.724478152944584e-02   +8.696242793036457e-02   -2.621710937389065e-03   +1.539156421694052e-02   +6.327359168314553e-02   +1.083906132894850e-01   +3.928979994265447e-02   -8.615341121989365e-04   +5.244116533043568e-02   +5.929379466403528e-02; +6.469083985989880e-02   +6.964891922514728e-02   +9.746465966823113e-02   +4.551712435703502e-02   +8.586373391297633e-02   +1.864119496604098e-01   +3.883655560009396e-02   +4.379087189368318e-02   +3.864837028691417e-02   +1.562540640845305e-01   +1.219518815713000e-01   +1.372449679692130e-01   +6.872734950486614e-02   +6.805947166122484e-02   -2.003256828246251e-03   +5.818740982802603e-02; +7.208583382213431e-02   +1.102155096528367e-01   +1.284362893824234e-01   +1.149017163113116e-01   +6.141005446962459e-02   +4.427715555482194e-02   +5.213714897563347e-02   +1.071218199516128e-01   +1.733382573972106e-01   +8.957796843921545e-02   +1.326084597854945e-01   +6.905366248252910e-02   +1.209803191222825e-02   -3.895558674421499e-02   +4.176046626586866e-02   +9.088666681897957e-02; +1.142834432386671e-01   +1.020118998108697e-01   +2.893639576624242e-02   +9.651770655036442e-02   +5.741274369682182e-02   +3.153878496230479e-02   +4.072445026761219e-03   +5.273608172421576e-02   +1.578458247774243e-01   +7.159424576583480e-02   +6.424199584880498e-02   -5.428387811333427e-02   +1.252521144382377e-01   -3.249132313354504e-02   +6.952862404613208e-02   +6.012649301980426e-02; +3.701558522479868e-02   +1.206363112318033e-01   +1.610884873683194e-01   +4.307012726924019e-02   +4.948628685717394e-02   -1.809471130501930e-02   +1.168390892194313e-01   +8.225896366432159e-02   +3.629824246088886e-03   +1.052904922075454e-01   -9.632475281129970e-03   +1.207990768548181e-01   +8.389700501667294e-02   +4.017135216293994e-02   +5.740932314718413e-02   +5.975028109147787e-02; +1.888614859547720e-02   +6.913314596041417e-02   +4.022041855237138e-02   +5.860873653394636e-02   +1.199284004572188e-01   +4.321512274992913e-03   +3.073957423315990e-02   -5.540479036418260e-02   +1.344073153497674e-01   +8.253684872313213e-02   +2.009001959981354e-02   +6.088687913269024e-02   +5.411403219120375e-03   +6.146244117921924e-02   +1.980333394732835e-02   +1.595796175302030e-01; +5.615883436251022e-02   +1.530696300803440e-01   +1.101334855024950e-01   +3.432692057248664e-02   +2.360684674638280e-02   +9.001282501005793e-03   +4.020303272379913e-02   -8.908466850574014e-03   +9.398329589067300e-02   -8.128854854841536e-03   +2.045248241138488e-02   +1.059627614288478e-01   +6.779830240020504e-02   +1.370466977846609e-01   +1.453427525857853e-01   +6.539101600125218e-02; +7.475442151871599e-02   +1.101665327257745e-01   -3.846852883592561e-02   +4.213014560773876e-02   +3.452276566608032e-02   +7.052823459567864e-02   +1.386943477374430e-01   +6.209912986295821e-02   +1.349138140258105e-01   +1.695560278273012e-02   +9.999893632651415e-02   +1.759940040255756e-02   +6.191394986265268e-02   +1.361706177544414e-01   +1.371227189556295e-01   +1.274667712490557e-01; +9.706499280547339e-02   +7.352225942936341e-02   +1.153624366177904e-02   +8.374094468828941e-02   +1.656029375795705e-01   +1.492107365199858e-01   +8.529541685237854e-02   +4.802938882902185e-02   +6.437748570857535e-02   +6.113626443506196e-02   +5.184170073605095e-02   +1.270479844937916e-01   +3.878087041499145e-02   +2.268489276725955e-02   +3.572605941628976e-03   +7.402564854961802e-02; +1.397013149100679e-01   -1.424502045628898e-04   +4.123802877879273e-02   +6.035913059540432e-02   +8.152155536841565e-02   +3.484692066573443e-02   +1.045869499485087e-01   +3.354081477857987e-02   -1.612150294714921e-02   +8.437446126126714e-02   +9.874470761086589e-02   -1.315760913560570e-03   +5.423828408955765e-03   +7.968465995793912e-02   +1.104424543361363e-01   +1.153556918200550e-01; +4.045218875777511e-02   +7.409063027008322e-02   +1.076323120380678e-01   +6.799749812604312e-02   +7.505290077032310e-02   +6.941196500995256e-03   +6.051631942631079e-02   +1.106252264350790e-01   +1.018284583106714e-01   +1.432114717864479e-01   +3.784334432853640e-02   +6.203165281914744e-02   +5.212289780436241e-02   +9.341135527690370e-02   +9.378753794635586e-02   +2.461172563131128e-02; +1.843092150353412e-02   +5.876543916504860e-02   +3.228876395699189e-02   +5.976746995470340e-02   +1.149992684120335e-01   +2.382541845199842e-02   +1.573339783539117e-01   +2.300385199719728e-02   +9.329411967618616e-02   +9.564953898023557e-02   +6.259760644909861e-03   +7.605054267801421e-02   +1.271074653704977e-01   +1.147385089656852e-01   -5.312009417805935e-03   +8.267171610043663e-03; +6.009950999341790e-02   -1.390607132710280e-02   -4.520164421689313e-03   +9.729620775870890e-02   +3.417169118821707e-02   +1.401601181545886e-02   +3.587413031529975e-02   +4.747355138929962e-02   +6.683323161927673e-02   +1.039633741835556e-01   +5.932325116948588e-02   +8.267846814425013e-02   -1.681714883489221e-02   +1.469773621477314e-02   +6.955356056017360e-02   +1.717275830399254e-01; +4.275381808627358e-02   +5.612639669622714e-02   +6.206325134546602e-04   +8.864525938665564e-03   +8.564337687836390e-02   +1.922575865146831e-01   -9.425326071037561e-02   +6.767952923059355e-02   +1.176287365333869e-01   +1.298619641106362e-01   +1.241532988427340e-01   +4.558209537889550e-02   +1.685217001451702e-02   +1.965276192323724e-01   +2.092092339342094e-02   +5.473318524918737e-02];
L2I_L1I_iGABA_netcon = [+4.062767131975939e-02   +1.011617471099252e-01   +2.060536955892352e-02   +3.933006290181523e-02   +3.969861195760977e-02   +2.016155213790185e-02   +3.108299354263305e-02   +7.621553233861679e-02; +5.063844482188871e-02   +1.150828959353922e-01   +7.461600186301154e-02   +1.157724812464350e-01   +4.577401152775523e-03   +1.007242171111452e-01   +1.195401341083304e-01   +3.837148925856440e-02; +6.328276430121935e-02   +5.680608109677313e-02   +1.586064797207479e-01   -6.580737127502883e-03   +9.230732832928853e-02   +2.447322261281407e-02   +1.005157549357204e-01   +7.809817127269919e-02; +9.375411378312680e-02   +7.964727163492416e-02   +4.192961935065632e-02   +1.097349379252280e-01   +8.146945271945323e-02   +8.921543137894938e-02   +7.224041991225236e-02   +1.264766826885619e-01; +1.455151576210822e-01   +8.148230401326137e-02   +4.451154085010551e-02   -3.653195692404833e-03   +8.233746295911351e-02   +1.114808092445837e-01   +2.659395871785077e-02   +7.436057802920454e-02; +2.784349103051652e-02   +1.166350686032078e-01   +1.094755493490138e-01   +5.127523351506379e-02   +1.137477215939743e-01   +5.216425659227475e-02   +4.298086799124760e-02   +6.421057089335200e-02; +1.053693564027431e-01   +2.897033002399145e-02   -2.703499389295613e-02   +7.172294995928946e-02   +6.532545290306743e-02   -8.890727884719927e-03   +5.302672869868363e-02   +1.098016207397366e-01; +4.159212092921938e-02   +4.749126021970417e-02   +1.732453383779993e-02   +1.976708281599169e-01   +5.857029301367926e-03   +6.154167950971304e-02   +5.695474526506164e-02   +5.292762301322823e-02; +5.848890060634271e-02   +1.058439047109091e-01   +4.576643268423732e-02   +1.553964533741538e-01   +6.546904844590401e-02   +1.545537396422175e-01   +1.814021687701037e-01   +1.905425065906527e-02; +7.962697675757088e-02   +1.137510132112430e-01   +2.527736688804627e-02   +1.373463717636413e-01   +1.459331130550371e-01   -1.855674171607274e-02   -1.564914167188477e-02   +1.461839773588862e-02; +8.623758751880936e-02   +8.291079690689285e-02   +1.903750740310302e-01   +9.874015908809125e-02   +5.293633729323601e-02   +1.976905584127985e-02   +1.556393363850996e-01   -5.256793578960760e-02; +4.772802322915363e-02   +6.479554807223629e-02   -3.618810133691745e-03   +6.962907867349646e-02   +1.444601390515597e-01   +9.521395240616189e-02   +5.160091399458087e-02   +3.592834378435273e-02; +4.014982153515659e-02   -1.565267142281095e-02   -6.456396030958791e-03   +1.349319242904247e-01   +6.080171966738437e-02   +8.931288448387877e-02   +7.432851223924186e-02   +1.799778629328509e-02; -3.817730468202546e-02   +1.204240539793951e-01   +3.674426640499339e-02   -1.550338397195430e-02   +7.700126541900837e-02   +6.556510029681062e-02   +9.786606430995197e-02   +9.864010291701186e-02; +4.188349199912907e-02   -5.733135770161357e-03   +8.410833538278950e-02   +1.165139534535984e-01   +4.101032040085828e-02   +1.163272373529208e-01   +1.316070713281986e-01   +1.065268959244456e-01; -1.632788170592939e-02   +1.331382449949417e-01   +2.552210984029075e-02   +1.047639719705394e-01   +3.737060448277538e-02   +3.058916453394159e-02   +6.237256078331689e-02   +4.328088447173836e-02];
L1I_L2I_iGABA_netcon = [-1.625056703061858e-03   +1.163539463018243e-01   +3.317095105731450e-03   -1.508624429117591e-02   +1.414078823883690e-01   +4.019148325980280e-02   +8.468474666003489e-02   +1.074660889502587e-01   +9.456270434503905e-02   +3.020897086951128e-02   +7.563747845174272e-02   +9.271742680069528e-02   +1.744241795014027e-02   +1.197153613271708e-01   +1.311388695962442e-04   +5.595980813564133e-02; +1.100985643968384e-01   +2.584506015094211e-02   +7.615636902815895e-02   +6.491918850497816e-02   +8.249583492392934e-02   +6.764253013492330e-02   +1.849341211418586e-01   +7.080163545890490e-02   +7.777408085890834e-02   +9.914340778377756e-02   +4.599785481204187e-02   -8.117323985064382e-03   +1.261179670326014e-01   +2.350851753821635e-02   -4.558183692156504e-03   +6.969457951437256e-02; +4.524505399218233e-02   +1.358094729921727e-01   +9.895010149925325e-02   -6.296529434414110e-02   +1.216690309170198e-01   +2.426354397578983e-02   +7.099118611547228e-02   -1.607220524382072e-02   -9.859070000244583e-03   +1.660044126835531e-01   +7.645129716905937e-02   +8.380624978271416e-02   +1.470626034505840e-01   +3.549999809458625e-02   +3.008905421316856e-02   -5.075736525455371e-03; +6.212212139611864e-02   +9.593432927720252e-02   +1.479407080884602e-01   -2.878214182150276e-02   +3.394659856584212e-02   +8.168524921347486e-02   +1.088077802779726e-01   +5.997162194559547e-02   +7.239681545335058e-02   +7.654670972107265e-02   +1.085973719700682e-01   +4.317378302702885e-02   +1.438020364954258e-01   +6.407275059322901e-03   +7.964687635193007e-03   +1.747012516310297e-01; +7.320281353270565e-02   +8.988411808657341e-02   +1.621663006615052e-01   +8.203928747987872e-02   +1.251049645700271e-01   +1.634712190702811e-01   +2.616155630234303e-02   +3.806303270213779e-02   +7.252564844935877e-02   +5.664874685387970e-02   +2.249165873946276e-02   +7.563896057376819e-02   +9.707083779385213e-02   +2.921382753861190e-02   +1.292372291911210e-01   +1.424825314748436e-01; +6.409648057553684e-02   +8.404378189347546e-02   +2.599948587318876e-02   +1.242755060162501e-01   +1.383801092559839e-01   +2.723528146715476e-02   +1.321605228355947e-02   +6.963452002214875e-02   +3.314204277296989e-02   +9.240871610246204e-02   +9.578151190737609e-02   +3.985342730868996e-02   +2.731073717209767e-02   +7.832271453198626e-02   +7.312541666664676e-02   +1.446363337398867e-01; +5.434275924463483e-02   +4.708751793768915e-02   +1.644833649031849e-01   +5.881509611002299e-02   +1.313523158361195e-02   +9.808292346357755e-02   +5.236375837963424e-02   +2.686593883427233e-02   +5.646674723965509e-02   +1.351687546525974e-01   +8.149034341339072e-02   +1.290346014181821e-01   +1.047352843543815e-01   +2.942992996325905e-02   +5.369834752127519e-02   +3.765853219085440e-02; +7.657911090674577e-02   +4.013542860222149e-02   +9.594075924018991e-02   +2.363450524041929e-02   +1.734287899559338e-02   +1.178741817394657e-01   +1.103023184685140e-01   -4.045875205806689e-02   +1.730908652350339e-01   +6.834014188167131e-02   +1.352607013486167e-01   +6.945752992475819e-02   +4.082315300437740e-02   +8.128434547284530e-02   +7.757319873005632e-02   -2.504482184228883e-02];
L2E_L1E_iAMPA_netcon = [+9.016801723769025e-02   +1.093807266287946e-01   +2.118112223241277e-01   +9.597737331108493e-02   +3.255316034327670e-02   +2.990124960025833e-02   +5.259762102121571e-02   +2.777504629905733e-02; +3.387047340031206e-02   +5.624224737202432e-03   +6.588757708256264e-02   +4.141522819818434e-02   +9.085533766472280e-02   -6.524614355522890e-02   +5.065051576228365e-02   -2.170782870018656e-02; -1.186846804537976e-02   +8.295661271475943e-02   +3.669284005404271e-02   +1.118926490291936e-01   +1.011709907180556e-01   +1.081976938068988e-01   +1.631338607418111e-01   -4.307095091366650e-02; +1.106862908576391e-01   +4.768713901653716e-02   -9.923261771292722e-03   +2.717297036875047e-02   +5.575352150875097e-02   +1.089913444658988e-01   +7.548084925383501e-02   +3.611390120006403e-03; +1.295187425659531e-01   +1.089673795339665e-01   +1.158283841112056e-01   +5.931592250331946e-02   +7.223588347801346e-02   +1.002515592384416e-01   +1.244146104412209e-02   -2.831883625646619e-02; +1.938819767172815e-01   +1.222861324544717e-01   -1.577742035477678e-03   +1.487942619679633e-01   -2.766988534644161e-02   +1.422066233292982e-01   +4.828845735201845e-02   +7.613216486760725e-02; -3.245835340982260e-03   +1.151127138701005e-01   +3.590354277750132e-02   +5.219400175529323e-02   +4.421797572130193e-02   +1.646540076881296e-01   +1.810214349256634e-02   +9.562799830740261e-02; +7.863666303981667e-02   +1.972609950564192e-01   +1.510778165430279e-01   +8.423188879936469e-02   +1.269261628003301e-01   +6.303145874225806e-02   +1.113224096087222e-01   +8.829422664545369e-02; +7.596006402067690e-02   +2.906809465461565e-02   +6.704475107151459e-02   +1.324481875729980e-01   +1.784872667699575e-01   +1.306967523164687e-01   +4.468542586302492e-02   +1.135951521619326e-01; +2.402424626069602e-03   +1.740985471584527e-01   +1.384157425039167e-01   +7.995056307430050e-02   +1.486001497983490e-01   +7.384594177567939e-02   +1.757855074538017e-02   +3.107705557290312e-02; +6.534286848325463e-02   +9.638000456614175e-02   -3.086473506547225e-02   +2.898139858170033e-02   +5.776591344761335e-02   +1.213960094092371e-01   +9.576680572604533e-02   -8.488955625203096e-02; +1.640978167019904e-01   +9.870964500859547e-02   +2.793298420479337e-03   +9.075974343079762e-02   +1.138011789394325e-01   +1.778329918148593e-01   +6.381950064548962e-02   +9.322117003796072e-02; +7.890006407878999e-02   +1.625473555488408e-01   +2.097992460467354e-01   +2.985063181690328e-02   +1.194171312093001e-01   -3.150941525216668e-02   +1.313060385908522e-01   +1.551673167173250e-01; +8.679026866179607e-02   +5.608786655774874e-02   +4.343170567459585e-02   +2.365430600203321e-02   +2.344068997207220e-02   +1.074006545765529e-01   +1.087472765832571e-01   +8.933307543739617e-02; +7.830659363012625e-02   +1.083161693051521e-01   -4.619208655054612e-03   +1.665801904837408e-02   +8.807744747553622e-02   +7.699520187558881e-02   +7.341693324935492e-02   +6.756324275925368e-02; +1.114231319051323e-01   +6.701444236404205e-02   +1.465257289977631e-01   +9.413254364998983e-04   +1.066914045660158e-01   +2.020177499597955e-02   +1.307136215019830e-01   +5.557580379122534e-02];
L1E_L2E_iAMPA_netcon = [+4.267851701179241e-02   +1.201319113603780e-01   +1.244934401208960e-01   +9.219255175921603e-02   +7.719026452343133e-02   +5.863955423853197e-02   +8.843404518059793e-02   +1.098779663690429e-01   +1.013955938207180e-01   +6.034427092196441e-02   +1.645780448026379e-01   -3.516965437233688e-02   +4.188870086591394e-02   +6.039065799904882e-02   +9.888795577831781e-02   +1.494408948247070e-01; +8.756870943725299e-02   +1.283358023568796e-01   +1.225342686384376e-01   +4.315508501529348e-03   -1.454444422653761e-02   +1.062847908103145e-01   +4.788426023038404e-02   -3.357742875560470e-03   -8.694370720552376e-03   -7.232564733349119e-02   +9.293015289923573e-04   +3.550208937331700e-02   +6.206959170756648e-02   -9.081808654588253e-02   +1.091809071921261e-02   +2.739820842709735e-02; +3.622933066189438e-02   +5.059894258573788e-02   +1.386548271705349e-01   +7.417066023729425e-02   -1.343938572508555e-02   +8.970126684547466e-02   -4.235397000018782e-02   +9.411830571660215e-02   +5.632970567094370e-02   +2.536639998491120e-02   +9.162940994714664e-03   +9.865994117785271e-02   -3.927580171924493e-02   +1.572596340003964e-02   +4.579722152445663e-02   +6.577091962662235e-02; +6.622725017620362e-02   +8.162499716253679e-02   +3.663019900974032e-02   +1.786241539349160e-01   +4.299369703528724e-02   +3.288911514823698e-02   -1.681294309470815e-03   +1.507481923278441e-01   +1.344611264817460e-01   +1.199731249746128e-01   +5.050328633101169e-02   -4.441995395677713e-03   +3.887556887638456e-03   +6.633829670835889e-02   +4.273841596168244e-02   +1.482992072089962e-01; +8.571636554372106e-02   +2.071844219416835e-02   -2.305864160720067e-02   +1.811346914228617e-02   +1.476587600898876e-01   +1.580808131950000e-01   +1.680142380988496e-01   +7.011692503768135e-02   +3.192149816473862e-02   +3.176763814380413e-02   +2.071580802201179e-01   +4.441922330530490e-02   +1.071967632235973e-01   +1.302907025731710e-01   +7.101111070944999e-02   +3.718705574376771e-02; +8.265011342131496e-03   +4.618809285002340e-02   +5.493253193268669e-02   -6.545830686883525e-03   +6.268269806393216e-02   +1.547090765351790e-02   +1.178633889101135e-01   +1.195216104760355e-01   +1.110969292305273e-01   +8.569484387505510e-02   +2.299829492968743e-02   +5.243057796913170e-03   +1.198852151897401e-01   +1.153133270392858e-01   -3.945325291410554e-03   +1.186838589435239e-01; +1.436985080123083e-02   +1.869587172777356e-02   +5.056088720548014e-02   +8.055893306805618e-02   +1.088724985918715e-01   -5.514714223318849e-02   +3.017631072071637e-02   +1.808427934794392e-02   +3.716367209912270e-02   +7.862822097213377e-02   +4.648965864007135e-02   +6.501230314785977e-02   +1.312116142456317e-01   +1.222895053319165e-01   +1.718701526884276e-01   +9.167831658957470e-02; +4.397987455985806e-02   +2.858155081667743e-03   +1.663789764811159e-01   +8.542098668044487e-02   +1.117958618625759e-01   +5.468344613547731e-02   +7.439180355289679e-02   +2.781505139660711e-02   +3.965368167802700e-02   +1.557502610412022e-01   +1.044384724853963e-01   +1.088824830836719e-02   +1.312165669342558e-01   +4.131043961071557e-02   +1.271433462769640e-01   +5.804482560759312e-02];
L2I_L2E_iAMPA_netcon = [+2.996239081375892e-02   +2.902155065819345e-02   +4.057730108147319e-02   +1.775854809530853e-02   +1.044888102186651e-01   +5.743878747863267e-02   -7.021381927786235e-03   +4.016545316064488e-02; -1.007869206693297e-02   +9.215276035133949e-02   +2.031622622079408e-01   +8.617150971243614e-03   +7.985981458503816e-02   +3.775788821302777e-02   -1.807289132115414e-02   +6.020425042455066e-02; +6.099641782849592e-03   +1.491818460241360e-01   -3.262570882498142e-02   +4.499107199502163e-02   +1.136874498319997e-01   +1.333437010007315e-01   +8.214602460371874e-02   +1.360768570206799e-02; +6.801786077029073e-02   +1.244788812476204e-01   +1.283046996597502e-01   +1.466597407699521e-02   +7.741621175854130e-02   +9.586249919186733e-02   +1.098227605523912e-02   +4.448291656121477e-02; +1.037110705898703e-01   +1.425968539344522e-01   +4.435841319348845e-02   -2.998530278671210e-02   +3.225089185462687e-02   +1.260770603760321e-01   +5.838769946375649e-02   +1.301586350652360e-01; +7.536193325965940e-02   +3.766087486615935e-02   +1.986558788003040e-01   +5.526117209383223e-03   +5.016956316628038e-02   +1.349957236097333e-02   +7.684074156900280e-03   +4.388494801305878e-02; +3.973096447745415e-02   +1.145264090328722e-01   +1.669791921011669e-01   +2.889912778839423e-02   -2.111174554098866e-02   +8.238233512328730e-02   +4.544851549183441e-03   +1.379285800443723e-01; +8.245460286197421e-03   +6.964978278132337e-02   +1.206940002816247e-01   +1.172785236105859e-01   +1.898260581697804e-01   +1.358197090313054e-01   +1.199471006443485e-01   +3.116702833702954e-02];
L2E_L2I_iGABA_netcon = [+9.271306074547800e-02   +7.929695070559573e-02   +6.907110638666905e-02   -2.600028585860378e-02   +1.038496438945789e-02   +1.641161623562663e-01   +9.298704121156248e-02   +7.315755621342049e-02; +1.603099186165161e-01   +2.910998917978917e-02   +5.924212363894080e-02   +1.501464882782382e-01   +4.938355249535453e-02   +3.913677875429630e-02   -2.024885841118212e-02   +7.398569405382648e-02; +5.712885036135210e-02   +7.193341693706286e-02   +1.080617237848251e-01   +9.235753582188830e-02   +4.595786285864077e-02   +1.570672619555091e-01   -9.093527471505951e-03   +1.168120946629045e-02; +7.455408413007783e-02   +4.255938576785079e-02   +1.618289240744761e-02   +1.193592475094000e-02   +6.511471516768856e-02   +1.672124745472767e-01   +7.748408089526428e-02   +7.547786536457421e-02; +9.177471431149423e-02   +9.068787794138153e-02   +9.011076525470449e-02   +2.433566282160051e-02   +6.575742732549709e-03   +6.786471793358002e-02   +8.891704409665718e-02   +2.537450609266840e-02; +8.862340632908654e-02   +2.032412129549438e-02   +4.157778692588864e-02   +3.613161435820911e-02   +7.582134307374566e-02   +9.869530644858228e-02   +9.676091110323390e-02   -1.007108632261929e-02; +1.521241588461453e-01   +6.065957679740665e-02   +8.406643745695305e-02   +2.534113434453211e-02   +1.053585882693376e-01   -1.160298983068176e-02   +7.808558858390993e-02   +2.402566250602387e-02; +4.627058249401413e-04   +6.171246077920474e-02   +3.761544421931621e-02   +1.938242845477148e-02   +3.584300117462517e-02   +8.425633513249219e-02   +1.600678950527964e-02   +4.540814095523174e-03];
L3E_L2E_iAMPA_netcon = [-1.554616799617296e-02   +6.089081711810609e-02   +4.067211241823940e-02   +5.159485178964060e-02   +1.014945647257045e-01   +6.943586883438754e-02   +1.354305304878709e-01   +6.641005555866902e-02   +1.186495383013194e-01   +1.132629764088582e-01   +3.810186681157480e-02   +1.185502043687128e-01; +4.676491918865804e-02   +1.344042147277764e-01   +1.403176942985783e-01   -3.851393243082563e-02   +7.948073624100130e-02   +1.279290828184827e-01   +6.452308729932073e-02   +6.307912910706200e-03   +9.505315388860838e-02   +2.349852621600090e-04   +1.198920109927043e-01   +1.374909780978315e-01; +1.347185397947474e-01   +1.237678514582606e-01   +1.178748171625913e-01   +9.626628460688652e-02   +1.674558552138850e-02   +9.755405950637214e-02   +1.012748691097429e-01   +1.486186125571304e-02   +3.406955166875270e-02   +1.456526337621032e-01   +4.337233889132466e-02   +4.695043197732388e-02; +1.503040977059115e-02   +9.292470321924320e-02   +8.053515346474774e-02   -3.503678748354351e-03   +1.387286201552712e-01   +6.476365815599834e-02   -6.175919530323658e-03   +1.005403328548868e-01   -1.663435868281025e-02   +9.395203916210607e-02   +8.093222507652988e-02   +7.755740798397606e-03; +8.029242773225698e-02   +1.346814566472480e-01   +9.795173988746463e-02   +1.395579280565853e-01   +8.953604781140700e-02   +1.768494616406515e-01   +8.171548441297057e-02   +3.890378552127201e-02   -4.582601181469759e-02   -1.340894638950128e-02   +1.449618672895638e-01   +3.987687875492583e-02; +6.869827410963897e-02   +3.719342324633553e-02   -9.224016213068746e-03   +9.443119507288192e-02   +1.371087930180844e-01   +3.678603251131933e-02   +1.551153791450301e-01   +1.088163560486885e-01   +1.021850158500258e-01   +9.654847393491714e-02   +5.334853902157545e-02   -3.148110374203508e-02; +9.753382327490417e-02   +7.393489314827607e-02   +7.745187534091719e-02   +1.416941061792708e-02   -1.610483948641464e-02   +5.541003154673856e-03   +1.169082235223731e-02   +2.555414491116896e-02   +5.999855474409348e-02   -1.588073397329667e-02   +1.508151227233933e-01   +1.316310591154718e-01; +1.028206816938558e-01   +1.116957668827165e-01   +1.118417286542125e-01   +6.805441924913597e-02   +1.067008895594269e-01   +8.781141058207499e-02   -7.441489580199022e-02   +2.335623589400312e-02   +1.448099400900729e-02   -4.366819656107239e-02   -5.518031668969966e-03   +3.512499771816376e-02];
L3I_L2I_iGABA_netcon = [+1.336116185149524e-01   +1.300296553120093e-01   -1.607099749107521e-02   +9.865236768639735e-02   -2.113908889658052e-02   +1.108727450069902e-01   +1.131894201268276e-01   +3.191800910964256e-02   +9.074142331957451e-03   +4.205726008774371e-02   +9.287119440015243e-02   -9.830551542251187e-03; +4.424013907486945e-02   +1.111090160616627e-01   +3.278856260563334e-02   +5.987286148322862e-02   +4.788842604283629e-02   +2.278335458679899e-02   +1.346244769139705e-01   -2.188733073538151e-02   -5.830734085831892e-02   +1.174582015849171e-01   +9.987328474384544e-02   +4.501893573625876e-03; +4.932524120360970e-02   +1.319622355094748e-01   +8.964295165070239e-02   +5.850389030296322e-02   +1.384319658833533e-01   +7.427016769559987e-02   +3.194335983496896e-02   +5.601424153013941e-02   +1.267221384533697e-01   -1.764731109726869e-02   +1.602066583190945e-01   +7.782952397940407e-02; +9.979463550393890e-02   +1.832337016200197e-01   +1.246489839010197e-01   +4.608720596902610e-02   +1.352886925626622e-01   +4.978132279839870e-02   -2.709632111055238e-02   +4.660247582097685e-02   +1.192657396905304e-01   +1.081183960982732e-01   +1.808193581505032e-02   +1.247162604782687e-01; +6.617131364600878e-02   +1.016123201909525e-01   +1.249346260288575e-01   +7.866672169821121e-02   +1.726287455247903e-01   -3.730207944335574e-03   +6.910208539708185e-03   +1.233252046049886e-01   -2.308004180460563e-02   +1.969390338828838e-02   -2.398211587228104e-02   +1.066984591528790e-01; +6.546021658041912e-02   +9.729411226061749e-02   +1.655733523671270e-01   +7.861655652393847e-02   +5.414542268814899e-02   +1.271115739378814e-01   +7.636590338320778e-02   +7.452992399053525e-02   -2.340318952902312e-02   +4.698727727009616e-02   +8.111779051537278e-02   +5.828602134201646e-02; +4.714747831600930e-02   +3.340612951707349e-02   +1.503599714640351e-01   +1.248192039359216e-01   +4.722518349139550e-02   +8.845089132843385e-02   +2.628675701982963e-02   +5.513277988336997e-02   +4.073087214157858e-02   +8.665273156456695e-02   +1.120584044465159e-01   +6.981277536408038e-02; +3.399197351400419e-03   +7.488823823104618e-03   +1.018293667647035e-01   +2.409618227391833e-03   +1.351060698837094e-01   +1.176223082806382e-01   +1.502762654638625e-01   +9.158445206508105e-02   +8.052356987219034e-02   +1.068121969484643e-01   -9.168514576289250e-04   +1.031596331661211e-01];
L2E_L3E_iAMPA_netcon = [+1.757630858779902e-01   +6.406761020611225e-02   +1.516002044335238e-01   +7.471715681602295e-02   +1.660239261217265e-02   +7.458834147139129e-02   +8.160763980271579e-02   -4.406554674768050e-02; +1.135945375600398e-01   +1.491425633140107e-01   +7.982661502833722e-02   +7.805494175697499e-02   +1.690200358947578e-01   +1.412182869135913e-02   +7.829746748404059e-02   +1.439535839835949e-01; -4.871788432768375e-03   +3.762436635763493e-02   +2.951705325680496e-02   +8.463527939139903e-02   +7.702636650938351e-02   +8.868253315864104e-02   +9.120189224289836e-02   +2.884275137569086e-02; +4.458062180135063e-02   -1.133576111006306e-02   +7.675258582844199e-02   +1.399470503346710e-01   +9.781683591138580e-02   +1.438937403468830e-01   +1.264863930525128e-01   +5.867793421783853e-02; +1.055996258621452e-01   +1.354967692353488e-01   +1.297122542618172e-01   +1.217004243944969e-02   +1.473663947974255e-01   +1.532364871805904e-02   +3.331330986644407e-02   -1.901990699926793e-02; +2.232604643021253e-02   +1.466563185386269e-01   +8.038290281618406e-02   +4.211190810028907e-02   +1.758390072471928e-01   +3.329733472689177e-03   +5.125728226427495e-02   +7.895772004361902e-02; +7.600517247311590e-02   +3.013286113966913e-02   +2.239936430384715e-02   +2.119670958043217e-02   +6.808284855290261e-02   +2.473728937596659e-02   +5.752217192763544e-02   +8.671229278095874e-02; +6.013885765992567e-02   -3.334116815019438e-02   +1.725117509129706e-02   -2.016856063193872e-02   +1.639744703247728e-01   -5.519370228107353e-03   -6.218089573363002e-03   +7.141173371226142e-02; +1.587621941799018e-01   +1.737691192735402e-01   -8.062544665471284e-03   +7.078986511242276e-02   -1.943091364970937e-02   +7.395695386948566e-02   +1.392657533505202e-01   +6.967626736429161e-02; +4.312614962214902e-02   +6.034127542941123e-02   +7.125615202436000e-02   +1.351382509912512e-02   +6.798055177675278e-03   +4.615602686034892e-02   +7.815350640517332e-02   +9.107262479127470e-02; +5.257524226587053e-02   +5.156147541539723e-03   +4.967160128048049e-02   +6.474594423151275e-02   +1.361492192490337e-02   +8.486728705567414e-03   -5.413690553984548e-03   +1.375709436447655e-01; +8.174497659813555e-02   -7.697438167646366e-03   +1.541356562474276e-01   +8.069898538879812e-02   +7.905536963736098e-02   +1.415133134760239e-02   +4.429220636380543e-02   +8.355361596380123e-02];
L2I_L3I_iGABA_netcon = [+7.682034695537868e-02   +4.806534028566339e-02   +8.123222786184213e-02   +8.747709456556638e-02   +3.238791059903734e-02   +6.483343929693687e-02   +1.306867876534457e-02   +9.687305649202425e-02; +4.235520290461255e-02   +1.464528319767225e-01   +1.905728405353342e-02   +1.187612848875447e-01   -2.836869819152231e-02   +1.151662533985423e-01   +5.464929867263189e-02   +5.274727194146605e-02; +4.316171142401359e-02   +1.410584206290857e-01   +1.159872823881236e-01   +9.228237069955969e-02   +2.790568121616856e-02   +5.510333306679954e-02   +1.170184978003480e-01   +1.452512148034313e-01; +1.113557524829783e-01   +2.934951932911454e-02   +1.017033874376749e-01   +5.242258905751521e-02   +2.035724306286432e-02   +7.264301273705058e-02   +9.430340178821892e-02   +4.119652775557357e-02; +6.624670208477029e-02   +1.345185079152395e-01   +1.088105013854495e-01   +1.465432223028097e-01   +1.443576499013563e-02   +7.701316894511344e-02   +1.011208633182823e-01   +4.255235047619821e-02; +1.161743575157030e-01   +8.841368844856515e-02   +6.173379939396226e-02   +1.720538327327286e-01   +1.842743670877978e-02   -1.266479203817766e-02   +9.951247872679263e-02   +7.260180841546109e-02; +1.619669322793945e-02   +1.353648545970817e-01   +6.719962610150569e-03   +1.464360285138263e-01   +2.536352960642838e-02   +7.630478004689210e-03   +4.028578979069220e-02   +7.473067350943886e-02; +1.894053931739781e-02   -2.819200721102913e-02   +8.592162393176779e-02   +9.068616265587233e-02   +1.197025989902198e-01   +3.151504186922464e-02   +1.043911508003917e-02   +3.790396998756384e-02; +5.989270816539308e-02   -1.611244497204907e-02   +1.235149456131089e-01   +1.919010447917154e-01   +1.050968530131050e-01   +1.194831347202534e-02   +1.980626997424506e-02   +1.325454147738531e-01; -3.845052632395334e-02   +3.747414877610881e-02   +4.027565332342183e-02   +1.286402980159093e-01   +1.304262975125176e-01   +5.085821702193214e-02   +1.006614646299643e-01   +3.672064820541265e-02; -1.655597429940909e-03   +1.608366516014011e-01   -6.473835559455512e-03   +8.203246634306831e-02   -5.718356952422760e-02   +1.063647472261365e-01   -2.033201881220285e-02   +3.065144207168260e-02; -4.873651620706722e-02   +1.926141209768731e-02   +7.789489338523493e-02   -3.419946503734395e-02   +1.033021903981819e-01   +9.724764207287685e-02   +2.513070930090146e-02   -8.790074152770534e-04];
L3I_L3E_iAMPA_netcon = [+3.905390255987883e-02   +2.198705708196253e-02   +9.429496026561199e-02   +1.300311774307510e-01   +9.822080559899317e-03   +1.262443814318392e-01   +5.836228314029884e-02   -5.945978520975725e-03   -2.101683537058549e-02   -2.018234946342323e-02   +1.115759444204107e-01   +2.972854271234438e-02; +8.438131093421526e-02   +1.269081038898526e-02   +5.775988289980206e-02   +1.949988404021077e-01   +4.643827883486479e-02   +9.453498785429729e-02   +1.107965155199318e-01   +1.210935337641650e-01   +7.783176229128574e-02   +2.107752258341951e-02   +5.208215111565879e-02   +8.885060448883608e-02; -5.955102680031132e-04   +1.473179672186371e-01   -2.943604844789296e-02   +2.566774821374426e-02   +1.317109196808514e-01   +1.379960649232604e-01   +5.634116480651356e-02   +2.951874139761043e-02   -5.367613619638524e-02   +9.748703946624213e-02   +7.301231243064579e-02   +1.186600194824309e-01; +1.402952069771068e-01   +5.919880526229852e-03   +3.997054625563726e-02   +8.987553268144288e-02   +3.998404754083792e-02   +1.399063980279788e-02   +9.760612511577091e-02   +1.094059126896712e-01   +1.198561671863585e-01   +1.155583822290599e-01   +8.049317130419265e-02   +7.176321213062813e-02; +3.959666806735487e-02   +9.087082871022645e-02   +2.164980740890085e-02   -1.150901916100983e-02   -4.467483547841629e-03   +1.430521899717319e-02   -4.617361715873148e-02   +1.148831807599036e-01   +6.173348642418069e-02   +2.876128978010020e-02   +9.807020774405498e-02   +1.102011441659498e-01; +7.966745602283667e-02   +9.964261361537595e-02   +7.703484084492661e-02   +1.522961273187721e-01   +1.695166059205147e-02   +5.825597334551393e-02   +2.605138777276345e-02   +5.940009417936735e-02   +3.671736502195506e-02   +8.276301403196074e-02   +8.842471530332387e-02   +6.125143605458442e-02; +6.431249435328514e-02   +6.954212836694815e-02   +1.540319053010887e-01   +9.622050691819040e-02   +8.770884391627265e-02   +6.074171040652921e-02   +8.752462228400740e-02   +1.738443132363900e-01   +7.937989242443619e-02   +2.059879804159034e-02   -4.402207006852240e-02   -8.635247212317336e-03; +1.627390141761907e-01   +7.996643533819148e-02   +2.504832706846104e-02   +9.351465580959099e-02   +2.086694585681080e-02   +7.878350246574899e-03   +6.890898644817028e-02   +1.661272211418875e-01   +4.997733352930906e-02   +3.214733181366455e-02   +1.397001081701049e-02   +3.081111700246648e-02; -4.689883927159405e-02   +5.063953058136718e-02   +1.618566927645483e-02   -9.226509561291552e-03   +5.674261497876441e-02   -5.033176103190823e-03   +7.420964115166429e-02   +3.445518744316393e-02   +5.153359898307122e-02   +1.203714015344735e-01   +8.739671844560798e-02   +1.191064183366340e-01; +1.502418757989964e-01   +4.843436038966109e-02   +9.815417371149247e-02   +6.751346702843886e-02   +3.013717519629686e-02   +2.513122832858663e-02   +5.095345060067827e-02   +1.597909867436838e-01   +8.843125011508858e-02   +2.317956953315830e-02   +7.311036086886170e-03   +2.899356048946437e-02; +1.032796695162701e-01   +6.398904731889299e-02   +5.104329631448543e-02   +1.536558140707171e-02   +1.272195451068023e-02   +9.302574001971374e-02   +8.733459613827840e-02   +1.299617269360643e-01   +2.804507739641222e-03   +3.328720707101786e-02   +4.764090344375869e-02   +7.138500391584857e-02; +9.276908591687369e-02   +3.077189333198863e-02   +8.814943579087844e-02   +1.530044649504877e-01   -2.906421289118605e-02   +1.475962733061227e-02   +1.235102490443006e-01   +8.807168378823296e-03   -8.906011458036919e-03   +1.930712206033385e-02   +4.634684518627845e-02   +1.644551493245513e-01];
L3E_L3I_iGABA_netcon = [-7.316197119520775e-03   +1.007556418565619e-01   +1.975355932709387e-02   +1.460187472990515e-01   +1.284726613567239e-01   +1.361496528601397e-01   -1.105312138356710e-02   +4.137595155841670e-02   +1.534127496149306e-01   +1.128138669204013e-01   +1.534057755215467e-01   +5.138310415209779e-02; -4.923902470588101e-03   -2.739718614231027e-02   +1.717080533303418e-01   +9.344533897155598e-02   +7.063364180532226e-02   +8.978437605647906e-02   +1.313238095795314e-01   +8.103364078436370e-02   -4.335745070040045e-03   +1.576953652139524e-01   +9.382146049625673e-02   +9.298768936107965e-02; +1.916901981031671e-02   +1.157112594157562e-01   +1.141609799488709e-01   +1.548166178968115e-01   +3.763372653720289e-02   +1.334760396121101e-01   +2.556527004272837e-02   +4.181609526730384e-02   -4.282057135005034e-02   +1.131777746932250e-01   +7.583861760589782e-02   -3.421274721039555e-02; +4.917882013387816e-02   +1.189117587702935e-01   -5.184081224957929e-02   -9.735429749650353e-03   +2.739261554760762e-02   +1.626424931722577e-01   +8.242251614345683e-02   +6.630524629053128e-02   +2.150103869256510e-02   -1.607494607935531e-02   +8.355130650859628e-02   +2.478964200371164e-02; +1.189611553089705e-01   +1.024205330646037e-01   +1.840679280376297e-01   -2.194251219937814e-03   +8.083044588893487e-02   +1.955032307167047e-02   +1.429271381761406e-01   +3.476357913802139e-02   +1.740486528638157e-02   +1.715532132464842e-01   +2.611164904165553e-02   +7.361670284452436e-02; +4.027265890501787e-02   +3.594995162224991e-02   +2.305843815401527e-02   +5.831610176847168e-02   -1.545141318337239e-02   +1.538373644035825e-01   +4.584431434675693e-02   +5.924819002013022e-02   +5.715659478564977e-02   +1.336717630842968e-01   +6.168105776933221e-02   -1.614167764450644e-02; +8.732061523156508e-02   +7.051326157543575e-02   -2.055303241882411e-05   -1.173754843440087e-02   +4.964908506454116e-02   +1.488280423039315e-01   +1.270606184123488e-01   +1.341188690938025e-01   +7.019611415209029e-02   +9.571395865829946e-02   +1.089099728814651e-01   +5.012819996108827e-02; +1.034077539037994e-01   +1.237942056286637e-01   +1.127449023377101e-01   +1.919260027797954e-01   +1.135848736573603e-01   +7.984457594523268e-03   +2.282300822627455e-02   +8.787473169646146e-02   +4.462687352846003e-02   +2.679839496321057e-02   +8.021050481365359e-02   +8.636712953750730e-02; +1.161210308692594e-01   +3.466875816310547e-02   +7.173274723305878e-02   +3.365977947005484e-02   +1.461239105801379e-01   +8.162521455891521e-02   +6.017380923392313e-02   +7.376193995175397e-02   +9.121560420375828e-02   +1.666158476728670e-01   +1.248650168040434e-01   +9.630178783958479e-02; +6.930272515392406e-02   +5.027053309884645e-02   +5.372477007803292e-02   +4.093843779129128e-02   +9.050486423864971e-03   +5.897693897789777e-02   +1.378149017804077e-02   +4.304877223445024e-02   +3.236715988964592e-02   +1.280014176819047e-01   +3.520968310888636e-02   +8.366119736236990e-02; +1.080817907458952e-01   +8.442873428068912e-02   +4.260993577720179e-02   +1.350271300558219e-01   +3.704272418934282e-02   -2.292877600323908e-03   -1.732394119761577e-02   +7.230574902047962e-02   +7.470189047396453e-03   -5.031137001718716e-02   +1.851105709106164e-01   +1.627191818143737e-01; +9.442546404944088e-02   +9.396905261761154e-02   -2.408248901286219e-02   +7.493400217324434e-02   +1.010679365380438e-01   +2.284695267348367e-02   +9.387495746809493e-02   +7.821353662780235e-02   -3.111478845910549e-03   +3.839742254907386e-02   -1.533723728839231e-02   +5.293270301438658e-02];
L2E_Input1_iAMPA_netcon = [+6.201674060565859e-02   +5.224606825591140e-02   +6.532150923969074e-02   +5.606291283502025e-02   +1.022722591132700e-01   +3.555080753644289e-02   +6.477779414612708e-02   +1.298292153957802e-01];
L2I_Input2_iAMPA_netcon = [+6.582708846975173e-02   +7.160989587597881e-02   +1.887796272851023e-01   +7.333275388804630e-02   +8.538343714244541e-02   +3.481498024713892e-02   +9.921916391434667e-02   +1.255815110041442e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
