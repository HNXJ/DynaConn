function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.493860674670945e-01   +1.629557004354513e-01   +1.589334137810185e-03   +4.984326094150623e-02   -3.587217213362366e-02   +3.392791113773316e-02   +1.809093357803412e-02   -1.297279505034444e-01   -3.119147823015055e-02   +7.439137466624642e-02   +4.215912709029880e-02   +4.749609705339319e-02   -1.443900196402893e-01   +3.563217931169672e-02   -1.430776800502060e-02   +2.436376916583030e-02; -3.709573369891589e-03   -2.278147278397287e-01   +2.505650010438172e-02   +1.690870178798795e-01   -1.405330929381771e-01   +7.602744543985547e-03   +3.382831770873140e-02   -5.606484932863991e-02   -2.875025515853071e-01   +1.826836419011949e-01   -2.009887355109966e-01   -8.930420808509429e-02   +2.540013519295855e-01   -1.653503368832826e-01   +2.478610748731185e-01   -7.213573098145640e-02; +1.192185803350130e-01   +2.056513863470047e-02   -1.027800804393593e-02   +4.338916212787439e-02   -1.738827645365453e-01   +7.333693750859918e-02   -4.612761200779514e-02   +2.564557953321311e-01   -1.210294954191301e-01   +1.057996915528032e-01   +6.740507476254637e-02   -1.302751429208444e-01   -7.149236871451219e-02   +1.278191774213143e-01   +1.949705880867663e-01   +1.921530045045637e-02; -1.120933040532131e-01   -1.880154750977953e-02   -1.599784411026615e-01   +5.315125495443070e-02   -6.712206652549256e-02   +2.442213233048839e-02   +2.212517291915471e-02   +2.303907338835716e-02   +1.896848995078698e-01   -6.497571210057776e-02   +2.861495576966050e-02   +7.985157968029839e-02   -2.498664221097000e-02   +8.179394152676701e-02   -1.516992028305217e-01   +1.702758162807047e-01; -1.489367906311475e-01   +4.051362247595115e-02   +2.034820115956089e-01   -6.501188331781399e-02   +5.404429862744947e-02   +6.904443524053498e-02   -3.829835018945550e-02   +1.316118436449318e-01   -9.028007026754185e-02   -1.427360606491397e-01   +1.638011593228509e-01   -1.010967576568848e-01   +3.377130922860149e-01   -5.563717518304002e-02   +9.395094782197230e-02   +2.994279931568649e-01; -2.706293878905160e-02   -1.454412552910194e-01   +1.901518569077256e-01   -1.622933163211771e-02   -1.552917013499780e-01   -2.680307637813986e-01   +8.899569259177068e-02   -1.146331428739296e-02   -5.154620890998949e-03   -7.898982741439749e-02   +2.415109978226898e-01   -5.397027728951103e-02   -5.263841641542939e-02   -2.561765435554230e-01   +4.683610896381225e-02   +1.134587085403552e-01; -1.448593386590230e-01   -7.521830994203568e-02   -8.053690007260303e-02   +2.109534158317824e-01   -2.643482195205490e-01   -6.643286564787947e-02   -1.028623367315872e-01   +3.216147237358048e-02   +8.874637299539263e-02   -3.744836933974893e-03   -1.595757989379424e-01   +2.237369086674998e-01   -2.306350479168789e-02   +2.377177348604336e-01   +1.867662695320934e-02   +6.417395160380560e-02; -9.244878866793194e-02   +1.929701891137156e-01   +5.755862015334674e-02   -1.987776922420620e-01   -6.195372630088566e-02   -1.208059743567624e-01   -1.405220232181554e-01   -1.346032877708743e-01   +1.677184916084104e-01   -1.327657889859754e-01   -1.613210983297070e-01   -4.100106443480694e-02   +9.227053001515936e-02   -1.395695617667314e-02   -5.861088226001200e-02   -2.987522620600908e-02; -1.701015547099325e-01   +7.212288009793602e-02   -1.982240801839152e-01   -1.032112383327829e-01   +1.467673394977480e-01   -1.857097510054431e-01   +3.360914352224356e-02   -1.148502681593597e-01   -1.624592614419351e-01   +9.087000298339361e-02   -7.363841784544486e-02   +6.992780308431126e-02   +8.437288080866245e-03   -8.168412443344389e-02   -2.167307077090622e-02   +2.152706250219447e-01; -3.763621784131184e-02   -1.239491229198360e-01   -1.722077807362556e-01   -3.820497598634195e-02   +5.309937534675505e-02   -1.110539119172457e-01   -1.296354547850857e-01   -1.155755588011519e-01   +1.002221354727420e-01   +1.967574097017494e-02   -5.771795425619655e-02   -1.247018625078609e-02   -1.670465711890369e-01   -1.132092410975076e-01   -1.370409755645073e-01   -1.186426708532701e-01; -1.684405885890786e-01   +2.927107719921269e-02   -2.273335822439743e-01   -1.897338144337104e-01   -3.624392218332177e-02   +1.264306758271548e-01   -3.998919407498866e-02   +2.051971067086435e-02   -2.421258672013199e-01   -4.260228420098702e-02   -1.604519570056333e-01   +2.082720213324216e-01   +9.764920808213189e-02   -5.618934336321730e-03   +1.098220907907010e-02   +3.480780960143060e-02; -1.455547622652716e-01   -6.954792837812009e-02   +1.850910972628247e-02   -1.171457697645380e-01   +7.232727543177540e-02   +1.326735906125857e-01   +1.752446829407509e-01   +6.798721691327544e-04   +5.222550784593350e-02   +2.132286510380647e-01   +9.533385200734436e-02   -1.538334956275948e-01   +1.508771093015772e-01   +8.912353600486790e-02   -9.143628088625953e-02   -9.803580759627686e-03; +2.832173169712361e-01   +5.786394733086124e-02   -1.338339802686700e-01   +1.813843578754089e-01   -1.148347219931275e-01   +1.766616913151950e-01   +1.442491342516651e-01   -4.881077808325410e-02   -3.477164792934718e-01   -1.917835330808938e-01   +3.535053627242045e-01   -1.524683170172500e-01   -1.445097412453089e-01   -3.838408012284340e-02   +7.405166338880198e-02   +9.747443429165174e-02; -2.358235246252563e-02   +1.633948541334381e-01   +8.212974760224599e-02   +1.030742429895157e-01   -5.763158394577010e-02   +2.768783002542232e-01   -2.982370365405461e-01   -1.597528200732925e-01   +2.116611621375629e-01   -1.272361286894037e-01   -1.443364935124606e-01   -1.687112627724219e-01   -9.486438210064009e-02   -1.034084718346281e-01   +5.439996845988638e-02   -2.987984117798078e-01; -1.308891203870915e-02   +8.670253052000731e-02   +9.856689916865767e-02   -1.940740936052607e-02   -3.055670170005573e-02   -8.330250757751921e-02   -1.136033776571924e-01   -9.155484408443489e-03   +2.042054462102934e-01   -3.209957376696151e-01   +6.638012299394931e-02   +9.386595190299410e-02   -1.092500732994102e-01   +1.601580977762616e-01   -2.532914961467694e-02   -1.587455331704149e-02; +2.195222542217058e-02   +2.513997004590307e-01   +5.548155765793937e-02   -6.067304678830357e-02   +7.288786082583174e-02   +9.124698818030906e-02   +6.203836793304756e-02   +1.164292214202775e-01   -2.534875058139600e-01   -6.546425211953073e-02   -1.924700253304897e-01   -6.536636760653441e-03   +2.037356674236761e-01   -1.216503715692115e-01   +1.102308239385347e-01   -1.253337778074514e-01];
L1E_L1I_iGABA_netcon = [-2.904938976163091e-02   +1.956387327715500e-02   +1.139768689295549e-01   -1.005591682444195e-01   -1.348242484162534e-01   -1.023752090685290e-01   +3.473435809990043e-01   -1.179671274906521e-01   -9.244638030563362e-02   -1.307547891534163e-01   -2.146387106544619e-01   +3.019289157285224e-01   +4.366049619443742e-02   +1.302713432247606e-01   +1.997771658621108e-01   +1.818998246002853e-01; -4.378143144138819e-02   +2.276267196418021e-01   -1.559117963195635e-02   -2.282768267120949e-01   +1.851151635416587e-01   -8.215341056372545e-03   -2.891467434503802e-01   -4.634606346143518e-03   -1.148799528402662e-01   -1.344926106416332e-02   -1.310023113503018e-02   -1.118428457093769e-01   -1.494508060089715e-01   +1.620411782942270e-01   +1.371517722860251e-01   -1.758205383650901e-01; +3.226533431651383e-02   +1.839956928092512e-01   -2.997712900052190e-02   +3.865596972360703e-02   +1.490834210383601e-01   -7.578585404841673e-02   +1.635703047839344e-01   -1.582655007184269e-01   -9.735272010493609e-02   -1.194974772747017e-01   +6.620907083844521e-02   +1.649050597761590e-01   -1.894378846408472e-01   +1.152660039422079e-01   +1.538220015951773e-01   +3.310126642624209e-01; +2.227033020766501e-01   -7.819992550645831e-02   -1.901982711832376e-02   -9.420049627567931e-02   -1.071512388117803e-01   +3.776426625040505e-02   -2.285612426985948e-01   -1.772380342154779e-01   -2.142491071494120e-01   +6.029534710478296e-02   -1.573473343867242e-01   -1.388284305059190e-01   -1.359560727970295e-01   -1.398887462892205e-01   +1.154907216402311e-01   -1.579116116661289e-01; +8.445817621361812e-02   +2.979239619420057e-02   -2.198786350138453e-01   -3.740615826546254e-02   +2.091123174712552e-02   -1.009339324231866e-01   -8.889404797105850e-04   +6.204540272291389e-02   -8.067159616094235e-02   -8.829611482980421e-03   -1.194840634482358e-04   -2.868624428008474e-01   -1.808163340986603e-01   -3.030744410989270e-02   +9.729095148411478e-02   +1.191093460179821e-01; -6.335935384854555e-03   -1.012383334313479e-01   +4.804418549671130e-02   +3.107544259917474e-01   +6.418249585191774e-03   -1.845548482210919e-01   +1.371359153271819e-01   +1.805669407899070e-01   -8.883675571318672e-02   +8.989126857569603e-02   -5.976009548065640e-02   -3.155163611501815e-02   +1.664671391429687e-01   -1.166977321423359e-01   -2.008589909959003e-01   +1.942068246401132e-01; -1.412147123415851e-01   -1.063327629809585e-01   +1.153555413255891e-01   -2.869129474732267e-01   -4.148877916254161e-02   +3.527005313750351e-01   -1.504249584581221e-01   -2.672663180233197e-02   -1.336359408161261e-01   -1.552612309663118e-01   +1.360927442533400e-02   +2.034576570050912e-02   +7.031880874367258e-02   +9.259247192618941e-02   -6.174076945724050e-02   +6.686962228244514e-03; +2.843245020857503e-02   -2.552026022379413e-01   +2.889458664547324e-02   +2.998222930840617e-01   -3.934453992622005e-02   +3.637276101711798e-01   -1.327045177953892e-01   +1.050130772213492e-01   +4.344125726029463e-04   +2.802276202939692e-01   +1.413575910579519e-01   +6.355136388220578e-02   -1.064607701644326e-01   +1.279533142485468e-01   -3.175554017232413e-01   +2.509848846977579e-01; -1.396010679126538e-01   +2.277274685670354e-01   +1.814141447736909e-01   +1.577511665173878e-01   -1.397011396523598e-01   +9.648313919645517e-02   -1.112524398326613e-01   -1.320314593692906e-01   +2.571308347889746e-01   -7.825858200380042e-03   -3.981668982706197e-02   -6.924382669065870e-03   +1.214165011911977e-01   +7.889663314188465e-02   -3.169848964844954e-02   +7.590755144109547e-02; -2.867930471178661e-02   -6.139406311893710e-03   -2.598096410138759e-01   -9.668035898661594e-02   -9.282805811100493e-02   +5.997203253420143e-02   -1.466199241227165e-01   -7.313349784828301e-02   -1.980120861704995e-01   -1.011885059893797e-01   -4.428217269019391e-01   -5.572174836046173e-03   -1.694918959392104e-01   -1.130470636056080e-01   +1.150560488401602e-02   +2.087942308062609e-01; +1.294686423004919e-01   +2.525553508897532e-01   -1.503186835593216e-01   +2.669517155270162e-02   +1.300759410416828e-01   -2.715845825919876e-01   -1.149078217721971e-01   +6.714706896879397e-02   +1.040429497611190e-02   +3.279096488895809e-02   +7.349306593015094e-02   -1.800181200715174e-02   +4.944795146103721e-02   -1.462795160820450e-01   +1.418689283395994e-01   -1.469178224457555e-01; +1.993101046640394e-01   -1.795207358933462e-01   +9.605455836356001e-02   +4.575581742152330e-04   +5.595390225016005e-02   -1.052730700289340e-01   +2.405752438172737e-01   +2.016256243686372e-01   +7.943537268291295e-02   +6.474781248177627e-03   +3.831877702149136e-02   +1.613174845556317e-01   +1.397917880047644e-01   +1.706569054558858e-02   +3.782042966443866e-02   -2.302778769202275e-02; +7.608744554666778e-02   -3.528836204838090e-02   +1.821265181275351e-01   +1.520228127326800e-01   -1.878546721536410e-02   +1.684463124867178e-01   +4.678847123154641e-02   +2.304621116714758e-01   +2.949499372868608e-01   -9.520089062155518e-02   -3.480932062826765e-02   -9.226457162209530e-02   -2.829951172794781e-02   -6.579390013416248e-02   +1.817721111673361e-01   +1.188511680481333e-01; +2.238638790368486e-01   -1.008370344063052e-01   -3.838631644829266e-02   -7.015375185644446e-02   -1.241884347674198e-01   +3.723775860377495e-01   -6.381408436649424e-02   +1.399306942949941e-01   -2.638832403319299e-01   +1.127932971688464e-01   -4.709071931982143e-02   +1.087206578508564e-01   -1.697102719167725e-01   -1.656804718770753e-02   -3.227111915963586e-01   +3.866178065425716e-01; -2.942312072080071e-01   +2.936558365839481e-01   +7.018253380320356e-02   -1.265174908358138e-01   -1.746355516246034e-01   -6.021350416152679e-02   -2.635937964327745e-02   -5.408626077177290e-02   +3.469007545519750e-01   +1.237621897205727e-01   -3.536078872449157e-01   -2.437387980292012e-01   +1.690551274889289e-02   +6.868800046684925e-03   +1.982945861648157e-01   +1.526792054652797e-01; +6.398816179873124e-02   +2.484870505210738e-01   +2.819830892140174e-01   +7.407647112209755e-02   +5.023002175985542e-02   -2.158516766726911e-02   +1.776713679724586e-01   +3.642058414156274e-02   -7.241859753060313e-02   +4.992683120095201e-02   -3.890261433508380e-02   -8.943366891486490e-03   +1.330794525673887e-01   -2.495419784933952e-01   -5.533623030916385e-02   +1.677171587197683e-01];
L2I_L1I_iGABA_netcon = [-4.539334787745117e-02   +6.796264913035394e-02   -6.924820944353506e-02   +1.743610494477684e-02   +3.116949858960041e-03   +1.014856148640671e-01   -2.962855951402174e-01   -6.483614274522076e-02; -7.760822452430823e-02   -1.500862623127792e-02   -1.811118594677836e-01   +1.279807801016303e-01   -7.722319551129117e-02   +1.564310359987047e-01   +1.627231972478357e-01   +6.499851131656288e-02; -2.474096090009023e-01   +1.898152298259969e-01   +8.286918429734286e-02   -9.342251087714970e-02   +3.923015200917482e-02   +1.561426378437821e-01   -8.533184789236987e-03   -9.910027500530841e-03; -2.320396976536271e-01   +3.149777979750079e-02   -5.264429217253220e-02   +1.696406165280657e-01   +3.408375722927017e-01   -6.361102687893472e-02   +6.673469265760293e-02   +9.547100149010827e-02; -8.878181348065553e-02   +1.601172384659628e-01   +4.343137637219497e-02   +1.999289386887984e-01   +1.154995367023786e-01   -1.334939288186293e-02   +2.855500020244418e-01   -7.483070447746504e-02; +1.289184294553290e-01   +1.224494017595261e-01   -2.461782724980859e-01   -2.817611752373480e-02   +5.983846189406754e-02   -3.452543862025861e-02   -6.536847217279082e-02   +1.906906287137252e-02; +1.995104880661982e-02   -1.416466348549467e-01   -2.005660616525498e-01   +1.519887694494702e-02   -3.708569379031108e-02   -3.157657808407761e-01   +1.879392155519284e-01   -1.637132497918897e-01; -1.882059535873172e-02   +1.580611501580190e-01   +3.040901412577425e-02   +1.322844567527201e-02   +1.086177077566430e-01   +1.684987540737792e-01   +2.719745996092648e-01   -1.226407752076050e-01; -1.746545895206773e-01   -1.079420565022603e-01   +1.229756566479137e-01   -3.459293268272128e-02   +2.060359575718978e-01   +2.266512386908969e-02   -9.272697872449874e-02   +4.107462742939739e-03; -3.986965837473970e-02   -1.459120049996760e-03   -5.605488691862633e-02   -3.870790020172894e-02   -1.913033307544440e-01   +1.856453209616951e-01   -3.064877646795208e-01   -2.607205224157227e-01; +9.965207155231233e-02   -8.459415702096065e-02   +6.621397272521694e-02   -3.796562943777472e-02   +4.709360342094876e-02   -7.606129502273939e-02   -2.278380245414333e-01   +5.732176693693282e-04; -5.464075592997295e-02   -1.971268540288380e-02   +2.589399592775274e-01   +2.485538538067554e-01   +7.746008127138139e-02   -6.428243261373284e-02   +1.214263962176711e-01   +5.913738372107401e-02; +3.949494777275575e-02   +1.570529785288337e-01   -1.692550736035575e-01   +1.890585889748052e-01   -7.526658686218810e-02   -2.417644552358541e-01   +2.427921372402725e-01   -1.844367189967830e-01; -1.361706571214114e-01   -1.204682311891397e-02   +8.374873731422199e-02   +2.502350876597170e-03   +2.111228365590116e-01   +3.115190725043213e-01   -4.817631370704006e-02   -2.043127691914167e-01; -1.861994545897316e-01   -1.097117864643358e-01   -5.114379765407601e-03   +1.260425409692692e-01   -1.459487067979395e-01   +1.064511989003634e-01   -2.318399121501366e-02   +5.162340892060253e-02; +2.041356861637736e-01   +2.935192608072621e-02   +1.164459636059533e-01   -1.588417524485618e-02   -9.899906953831292e-02   +3.133833878342138e-01   -9.825717981888157e-02   +1.993316262166936e-01];
L1I_L2I_iGABA_netcon = [-6.093260296173118e-02   +9.632773757730988e-02   -1.702353928662148e-01   -8.712615557929981e-02   -1.080451110065396e-01   -1.909302882527299e-02   -3.468193486229657e-01   +9.330136675800699e-03   +3.975552432776354e-01   -1.299094095722925e-01   +1.511893927081124e-01   +2.623888478685947e-03   +1.394035670682260e-01   +9.815442929372692e-02   -1.168345614231984e-01   +6.370115156959512e-02; +2.209997145567949e-01   +8.524835289080514e-02   -8.039676124605627e-02   -1.808282655591373e-01   +2.643678354715044e-02   +2.430446408411994e-02   -6.753190821718008e-02   +1.767814129051495e-01   +9.976723810040913e-02   -1.322964181312228e-01   -2.737873432118813e-01   -2.511157501103014e-01   +2.315182854184291e-01   -4.047414278105407e-02   +7.694541769813767e-02   +4.649362138440018e-02; +4.602229473243283e-02   -3.117123895516789e-02   +7.291012876735077e-02   +5.116659473465777e-02   +9.520404069534007e-02   +2.099125285066404e-01   -2.772750054507846e-01   +1.306222569113501e-01   -8.213438754737717e-02   -1.212252814584525e-01   -3.098878564855378e-01   +3.601353981723716e-01   +5.835245087805458e-03   -1.051574935152751e-01   -2.403840193067259e-02   -3.360282866632216e-02; +1.373065856456137e-02   -1.486160321415789e-01   +3.792120983609217e-02   +8.482872298044505e-02   -7.028926182580691e-02   -2.596347712042644e-01   +2.945051320980363e-01   +1.966703643605550e-01   -2.097086347097311e-01   -8.214488089294435e-02   +1.080838390405937e-02   -5.842342462539163e-02   +2.471667298009554e-03   +1.577586548716099e-01   +4.615544255684549e-02   -9.814620452971589e-03; +5.737515862162740e-02   +1.846164941199025e-01   +1.975193520227097e-01   -1.444736307912770e-01   -1.257033753757968e-01   +9.807451990186701e-02   +1.096109580913922e-01   +2.416643592203859e-01   -2.414097036268589e-01   -1.349247272631565e-01   -3.652841762521214e-02   -2.118618382359324e-01   -1.059398789890573e-02   -1.883425613448270e-01   -4.727429326933709e-02   -1.276226459051211e-01; +1.987119991142686e-02   +1.440718926248956e-01   -2.675776016230280e-01   -1.224897303179354e-01   +3.067118200606494e-01   -2.989628238545656e-02   -9.994523352318820e-02   +8.215700258197399e-02   +3.647508170487329e-01   -2.719066787013210e-01   -8.728798524073147e-02   +6.001193786686636e-02   +1.827138750805385e-01   +1.658746957862222e-01   +1.976149419273031e-01   -1.772090961065350e-01; -1.657131623733720e-02   +2.422580590405570e-02   +2.540287184293107e-02   +3.029382824981072e-01   -1.700164349657996e-02   -6.619608995041860e-04   +1.164335258760331e-01   -7.884615752399410e-02   -2.879603081105324e-01   +2.836419050045445e-01   +1.030533648594872e-01   +1.673564849811228e-01   +4.273416073179269e-02   +2.602837212252138e-01   -2.811096630237720e-01   -1.498704790834183e-03; +1.116199450986240e-02   -1.957158818647283e-02   -1.062645509974318e-02   +1.048283862347970e-01   -1.014054807730518e-01   +1.116625353515388e-01   +1.835789859064314e-02   -1.936489295646938e-02   -5.543657549325799e-02   +9.803132563727349e-02   -2.177105161712013e-01   +5.864392522906157e-03   +2.289561370865691e-01   -9.418642345859497e-02   -2.801112335095768e-02   -1.716064443539678e-01];
L2E_L1E_iAMPA_netcon = [-2.273261204292420e-01   +2.221514940589330e-02   -2.396779593486565e-01   -9.363746831525121e-03   -9.382067081239841e-02   -6.647386057556462e-02   +2.455439855633829e-01   -2.376066403182454e-01; +1.960993644698119e-01   -1.798541112261111e-01   -1.683724948149100e-01   +2.290495348756706e-01   +5.026926488448595e-02   +2.536206151300598e-01   -2.451674554616902e-01   -7.594374289560786e-02; -2.339106791204099e-02   +8.780243471530391e-02   +8.051269281750606e-02   -2.093934125956407e-03   -1.152471912634151e-02   -2.556005543150751e-02   -1.151417768390610e-01   +6.830865858419605e-02; +3.664573564690582e-02   -2.402082490572836e-01   +1.524346140486926e-01   -1.048539090985303e-02   -7.090319645619923e-03   +3.890185868395863e-02   -3.527553478573173e-01   +1.887872348227659e-01; -3.331607144699856e-02   -1.297614107561915e-01   -2.432322891259688e-01   +1.019843728528063e-01   -1.421424987353606e-01   +6.845268730754317e-02   +1.079553915185387e-01   +7.391777526028026e-02; -1.950728931857460e-01   -2.189554711737060e-01   +9.704219358977018e-02   -7.366693500535548e-03   +1.751645234043255e-01   +7.969063877408310e-02   -8.086045655952154e-02   -4.380986792669827e-03; +1.396384871674647e-01   -1.887253890582116e-01   +2.335189112122445e-01   -7.985195628896670e-02   +8.687292886256864e-02   -1.896149480845221e-01   -3.737170144454348e-02   -4.042898521039084e-01; +8.858952700657547e-04   +1.493586541329093e-01   +1.346519701922070e-01   -1.317014720512588e-01   +1.876263011945712e-01   +1.591282044318797e-02   +5.114014749683667e-02   -1.398170620525002e-01; +2.432262390064383e-01   +7.238296104866346e-02   -1.009651990520035e-01   +2.127432250246956e-02   +2.227198861923918e-02   -5.624567712197087e-02   +1.272896910177830e-01   -2.168274746396091e-02; -1.932287619880660e-01   -8.037014191235553e-02   +2.375310672716300e-01   +1.598125714715272e-01   -2.531200198348691e-01   -2.178348619101986e-02   +3.720037357599175e-02   +1.179476221950607e-02; -1.398012860914890e-01   +3.334014915475597e-01   -3.240465789535736e-01   +6.881596023547042e-02   +1.058618073983926e-03   +2.402592886943307e-01   +7.994479722167791e-02   +1.472590212048281e-01; +6.986007456511593e-02   +5.128922872658286e-02   -1.045945026609572e-01   -1.076275635632854e-01   +4.207949121253414e-02   +8.400487545768662e-02   -1.221541558449286e-01   +1.885700513625285e-01; +2.556873786340554e-01   -1.091961282727167e-01   -2.925891592542874e-01   +2.755696746341508e-02   +1.175593125170029e-01   -2.218841336672115e-01   -8.777754531855392e-02   +1.434665217483936e-02; +1.835926264841625e-01   -1.797658168901116e-02   -5.806150360276371e-02   -1.992673661180086e-01   -1.177773818160850e-01   +3.702920342040898e-02   -7.111050686236138e-02   -4.800042233915906e-02; -2.466298355103584e-02   +7.833957088834470e-02   +6.906182963758685e-02   -3.339228209786561e-01   -1.610788130315863e-01   +2.124466644853615e-01   +5.883268365219967e-02   -1.575431379536563e-01; -2.563485331806117e-01   +1.449762461576771e-01   +2.375312145227523e-01   +9.204976714566066e-03   -1.559670883691581e-01   +1.768215377249615e-01   -2.099205770946138e-02   -3.567261703895537e-01];
L1E_L2E_iAMPA_netcon = [+1.806632262844811e-02   +5.035150234289985e-02   -7.853451738345413e-02   +3.527497644524027e-02   -1.017805967922964e-01   -1.037360096280309e-01   -8.358910410769896e-02   +2.202185215400293e-02   +1.554894092376199e-02   +3.731807828897744e-02   +1.478983147156867e-01   -1.541629457900626e-01   +8.838564906755651e-02   +2.088014789336352e-01   +2.008971441173015e-02   +1.807266261330305e-01; -3.796169140729706e-02   -1.037906815877025e-01   +1.870109033523878e-02   +1.748831135122452e-01   +1.448848889578400e-01   +6.888526219581918e-02   -6.130229768398313e-02   -1.619952544218238e-02   +8.492805111456217e-02   +1.333569359675063e-01   -1.846031936071239e-01   +3.924505504192197e-02   +2.487993991925796e-01   -2.133024081987623e-01   +2.026900317033550e-01   +1.923100741209828e-01; -1.722723860492015e-01   +2.402891922580587e-02   +2.883038429578253e-02   -1.503739667849177e-01   +6.123315402222984e-02   -4.464252218741051e-03   -2.103078556929954e-01   +1.627110134280878e-01   -2.640671308627992e-02   -1.334302416526821e-02   +7.961260223135014e-02   -2.337818471251506e-01   -1.514861231822631e-01   +2.628810453448317e-02   +2.805223944546411e-01   -9.209272353417848e-02; +2.805427214343000e-02   +7.391709913067842e-03   +2.589207740335505e-01   -1.273088171227781e-01   +1.006948932420929e-01   +1.721135238754223e-01   +1.583602123073084e-01   +9.932315616438064e-02   +1.118154383235453e-02   +6.136966535341324e-02   -2.930102698926707e-01   +2.631307267099330e-01   +1.327246777356185e-01   -3.353637222196490e-02   -6.856756328148661e-02   -1.066297625647493e-01; +6.476518386949703e-02   -1.156906494970431e-01   +7.432507165908898e-02   +2.056856651023739e-04   -4.670510327887821e-02   +2.311958703547493e-01   +8.878562656647338e-03   +1.705638223468366e-01   -1.230491618676957e-01   -7.435861662602407e-02   +1.070633627454230e-01   +7.675605927796701e-02   +2.508555466163409e-01   -5.292871337360120e-03   +1.063987725839614e-01   -2.704594822198928e-02; -2.766131827558077e-01   +2.408190615849139e-01   +3.117786401039283e-01   -1.011081751496775e-01   +8.905993246031318e-02   +8.330734385243675e-02   +7.401248241393420e-02   +9.027588111312533e-02   -2.084487969645651e-01   -6.125196022953312e-02   +2.028676917020478e-01   +1.242007947684195e-01   +1.990689761054433e-02   -2.500275814163369e-02   -6.998991907423291e-02   -5.382801679590117e-02; -1.152225157840928e-01   -1.237943737330810e-02   -5.447897306152886e-02   -1.007207016382866e-01   +1.086623297743811e-01   -4.290720689563798e-02   -3.581683189556814e-02   +5.337684226606682e-02   -1.361509188058270e-01   -2.387304741180536e-02   +1.649926970013482e-01   +1.475849559405216e-01   +5.077447526946327e-03   +5.362615778333413e-02   +5.190627050614231e-02   -2.752237137205910e-02; +3.695360463787696e-02   -2.267792204104509e-01   +3.532604508441074e-02   +2.419082844164857e-01   +8.509651804162460e-02   +1.143802375161793e-01   -2.331990569239233e-01   +2.863758748753177e-01   +1.309593510153590e-01   +1.130970375208776e-01   +4.766579090711250e-02   +7.494077632688002e-02   -2.276300870260490e-01   +2.980235655989901e-02   -4.957885246898407e-02   -2.819733733138974e-01];
L2I_L2E_iAMPA_netcon = [+4.297522157652561e-02   +8.643459136374140e-02   +2.079446323538443e-01   -4.206176991183424e-02   +1.559063518107315e-01   -8.428592145940431e-02   -1.689989292382464e-01   +5.183545489509304e-02; -1.928918340364968e-01   +3.661670793922507e-01   +2.583953269873503e-01   +7.553379530806682e-02   -3.077972101657608e-02   +3.624230253546777e-02   +1.412388196727647e-01   +2.353906579248042e-01; +7.118636776285353e-02   -9.211934071220745e-02   -1.958264996226547e-01   +5.960464301607708e-02   +2.309501689291203e-01   +1.123498095084295e-01   -3.308678854745555e-01   +2.232611736259843e-01; +1.864940278135769e-01   +1.234259212336663e-01   -4.388993549127015e-02   -2.012819559392441e-02   -6.771919053955126e-04   -1.187215209584936e-01   -9.846448276679919e-02   +9.169731188762001e-02; -9.539929677351819e-02   -5.453229005877411e-02   -1.882309221049270e-01   +4.239859303925879e-02   -2.836900691435638e-03   -2.684707393106464e-01   -3.765034776478009e-02   -6.236852850408771e-02; +1.831242061996134e-01   -8.153081970221576e-03   +2.961246752005146e-01   -1.028113081252355e-01   +1.099991741149749e-01   +1.189873385939960e-01   +2.305159285078250e-01   -7.776222416506059e-02; +8.211532019405528e-02   +1.856676022760526e-03   -1.838558159869325e-01   -1.186607142937653e-01   -2.622403539119035e-02   -3.635913813314992e-02   -2.246488754777489e-01   -3.497869875667502e-02; -3.474959563926935e-01   -2.185942329289311e-01   +2.606080857886341e-02   +3.697681921477803e-01   +1.955712337324328e-01   -1.002213180880835e-01   -6.113315513179261e-02   +2.955539280395302e-01];
L2E_L2I_iGABA_netcon = [+2.824963013283546e-02   -1.162995955419266e-01   -7.477987234475421e-02   +8.076788973140851e-02   +2.639267066579510e-01   -3.752942867857311e-02   +2.192372972162712e-01   +8.956520554171071e-02; +8.659055880771493e-03   -1.071714017106776e-01   +1.611177489558627e-01   +1.905191779706380e-01   -1.042519769348760e-01   -9.952981550753766e-02   +9.630177445843910e-02   +1.495841978348470e-01; -2.172082646765330e-01   -1.605733238868069e-01   -8.757675995795362e-02   -9.190442086131589e-02   -8.143255347399950e-02   +2.339941878469766e-01   +1.026823537548293e-02   -4.573947978981140e-02; -1.636560653315546e-01   -1.229872995554662e-02   +2.740320990138379e-02   +8.068029989213971e-02   -2.542620734725349e-01   -1.050701067014242e-01   +5.122206178385365e-02   +6.496874171247637e-02; -1.511605963684502e-01   +7.744860808707933e-02   +6.322173625773925e-02   -1.234627472315601e-01   +1.387628292232224e-01   -2.153798431805028e-02   -1.589419755820801e-01   +2.096338950118920e-01; +1.830140941834796e-01   -3.176962484015538e-02   -5.869239825413063e-02   +6.539925871681120e-02   +9.741392041049050e-02   -6.343068697982780e-02   -2.030491048804820e-03   -2.213571013941369e-01; -1.423435984203461e-02   +7.835270515564924e-02   +3.363112156468728e-01   -1.268962409191959e-01   +1.091289309509165e-01   -1.827318252108494e-01   -1.909535774269154e-01   -3.349609751459414e-01; +8.333287550007551e-02   +1.082934548910184e-01   -8.713129840277804e-02   +5.040145995051019e-02   -2.454818548996496e-02   +5.000696250887186e-02   +1.729874676816224e-01   +8.590868790388974e-02];
L3E_L2E_iAMPA_netcon = [+2.846093471441918e-02   -4.094057141870620e-02   +8.538868872459818e-02   -1.970302360533938e-02   -1.676419838445768e-01   -1.879608221435194e-03   +1.408606652012722e-01   -1.259829518642128e-01   +1.224720715370196e-01   -9.321351334638503e-02   +2.486678573791863e-01   -1.244252801761527e-01; +1.864664415812940e-02   +1.483586809108653e-01   +5.089341934073927e-02   -1.733313698685141e-01   +1.675916767666900e-01   +5.552390300237103e-02   -1.486354908601401e-01   +2.121612113281759e-01   -2.532312666088771e-01   +2.898693232383217e-02   -3.082482881346676e-02   +1.874345389747137e-01; -1.581100812384336e-01   +2.141951121645669e-01   +1.483967425661926e-01   +2.972100903528929e-02   -2.180133599939814e-01   +1.732216832012670e-01   +6.713053361260948e-02   -1.359187536035532e-01   +1.269210758111606e-01   -2.536640063698958e-01   -4.143835469438143e-02   +3.745183389053749e-02; +2.159622754375474e-01   -1.623090483296540e-01   -1.822100706443801e-01   -7.497320483978041e-02   +1.417210524522302e-01   -9.623317049243074e-02   -5.317988575071123e-02   +1.754104628610322e-01   -1.516143765811938e-01   +6.612471459084024e-02   -9.735672684227749e-02   +1.437459395972277e-01; +1.482754629840775e-01   +1.653991599125825e-02   -8.012566686389959e-02   -6.017610800653390e-02   -2.982913561671666e-01   +1.391509745854243e-01   -3.310504433490466e-02   +2.799060694354369e-01   +8.039762636782730e-02   -2.195313461900603e-01   -1.837236653514264e-02   +3.843502717984985e-02; +7.707811283555401e-02   -4.319058766219742e-02   -5.464115381253526e-02   +3.153755609739900e-02   +2.713332904319160e-01   +5.920815772792488e-02   -1.664158703133915e-02   -1.104515191505913e-02   +8.727445076563053e-02   +1.111068673964547e-01   +5.782731144650747e-02   -2.238288478656147e-01; -1.051977159474051e-01   +4.907965073093410e-02   -5.803737339684659e-02   -1.616765579913558e-01   -4.484279458413049e-02   +1.150468202729241e-01   -4.961725377131754e-02   -7.634026885609262e-02   +2.244594799966294e-01   +8.880138630857534e-02   -1.365461252410178e-01   -2.729041565825386e-02; -1.087539110712721e-01   +1.092846172029927e-01   -8.655301780848221e-02   -2.883572560478532e-01   +2.875245463474962e-01   -1.378525406540586e-01   -2.293099695184947e-01   -9.521534811979085e-02   -1.597756743540196e-01   -8.089491544564457e-02   +2.948716448952731e-02   +2.311344271071528e-01];
L3I_L2I_iGABA_netcon = [-9.867922102786118e-02   -2.255099035927388e-01   +1.481045985655515e-01   +3.581317753240004e-02   -1.693838173931674e-01   +6.183186126036930e-02   +2.557733292891691e-01   -2.686798438747516e-01   +1.460358423451961e-01   -2.056328780867337e-01   +1.069116717434066e-01   +7.990645746275532e-02; -1.422887344660780e-01   +4.373433756587329e-02   +2.774117162132987e-01   -6.556215474401458e-02   +9.056292249530483e-02   +1.040108911632197e-01   +1.400349148609272e-01   -1.908200847095880e-01   -9.317901681728810e-02   +1.506783276556073e-01   -5.596872851289832e-02   +1.651728588249501e-01; -3.407948564891902e-03   -2.216099356473802e-01   +3.237133567300964e-02   +1.394650818444289e-01   +1.187577397948896e-01   -2.408397025089689e-03   +9.903678359445538e-02   +1.042334665348388e-01   +1.902075641533412e-01   +2.397470045531725e-02   -9.134378276111427e-02   +3.198790981887321e-02; +6.122331443218582e-02   +5.302170559108751e-02   +1.233573601791730e-01   -6.388633239561818e-02   +3.567146653043347e-01   +1.920953546182607e-01   -3.666214690006433e-02   +2.417533202514256e-01   +8.076256373964721e-02   -1.007437751637478e-02   -1.023438168342369e-01   -2.400354439721802e-01; -1.102358617238635e-01   +9.614329573872843e-03   -3.620468392154497e-01   +8.977649223508967e-02   +2.130502611314699e-02   -2.051760635386998e-01   +1.230383099582588e-01   +5.699481759181433e-02   -1.710437486954882e-01   -5.146065309839714e-02   -2.017314295285038e-01   +1.149912339588613e-01; +1.467758823323684e-02   -2.041306929576093e-02   -9.669539726029416e-02   -1.803741914014284e-01   -6.129028508448556e-02   +2.193467206170194e-02   +1.716471012695406e-01   +9.488260068976329e-02   -5.159666191957574e-02   -1.794053718205483e-01   +1.809922270834288e-03   +2.584410395310108e-01; +1.009895999824604e-01   -8.434579419344517e-03   +5.886718108786201e-03   +7.085222099589215e-02   +2.827700341216708e-01   +7.965938770109046e-02   +1.250092857574306e-01   +9.742789844573135e-02   -2.420470413787527e-01   +3.064655318508377e-02   -7.749165375563145e-02   -1.981544177024992e-01; -1.402630560010542e-01   -1.496028527627318e-01   +1.506601791644134e-01   -1.568844455804143e-01   -9.731967669402976e-02   -6.977455269879723e-02   -1.119337840953161e-01   +8.504964921578709e-02   -9.432363243111028e-02   +2.441250135312045e-01   -1.563479141159942e-01   +3.483546858244230e-02];
L2E_L3E_iAMPA_netcon = [+1.381346130522160e-01   -1.418029050991643e-01   -6.843074947153116e-02   +3.729195305274173e-02   -1.450461397573042e-01   +4.421756063766431e-02   -1.028078255417727e-01   -1.585855837628914e-01; +1.662391618066349e-01   -1.404382966440669e-01   -4.021272572827553e-02   +1.069260651047938e-01   -1.357689048157068e-01   -7.415479989294531e-02   -5.829413688213576e-02   -1.120916663284954e-01; +2.829678789528851e-01   +1.973864980636190e-02   -2.795858337675018e-02   -1.459432117035220e-01   -5.309910560715939e-02   -2.385560190371684e-02   +5.594157473347064e-02   +1.890799617197956e-01; -3.162676511581440e-01   +1.292777628933945e-02   -6.189840229266774e-03   +1.849731707478554e-01   -2.857953010561661e-02   -9.953681771175629e-02   +1.224891097132496e-01   +9.251638736610829e-02; +3.080943807826853e-01   -1.111254434467786e-01   +3.060615859201136e-01   -4.849325906425142e-02   -1.828415292195118e-02   -1.027730476774187e-02   +3.535672156190970e-01   +1.258889525795447e-01; -1.604946040088993e-01   -4.355438087406463e-02   -3.593352861330350e-02   -2.626526557778497e-01   +1.268407830147739e-02   -1.075305536530568e-01   +2.127216714369484e-01   -2.029333855239608e-02; +2.698472529646072e-02   +1.302588153345140e-01   -1.056956849931114e-01   -1.717724706114053e-02   -1.372712497907548e-01   +1.769854328590341e-01   -2.280456706723482e-01   -6.370225267036610e-02; +2.986798126886000e-02   -4.556964125079596e-01   +1.958262555049898e-01   +1.329795088432301e-01   -2.439849246439003e-02   -1.916503051121680e-01   +9.475439597341481e-02   -1.192234465430418e-01; +3.657669260302406e-02   -1.626576661761071e-01   -4.095066329562033e-02   +1.940594538960904e-02   +1.365053910144291e-01   +7.798723747522844e-02   +2.740809999383592e-01   -1.550255203449937e-01; +4.254476740291026e-03   +2.724251110279956e-04   +3.802296033600014e-02   +1.676300360161848e-01   +2.772698210301044e-01   -1.132057057075019e-01   +2.710303016479574e-01   +3.954950287848972e-02; -1.632699904372336e-01   -3.139073579988909e-01   -1.752938093919036e-01   +8.624555693796221e-02   +1.121194369601239e-01   +2.875816372917974e-02   +1.141942635116931e-01   -1.913814590956901e-03; -1.227513247403619e-01   -1.438490029618413e-01   -8.182019600001972e-02   -2.445834306951365e-01   +4.744122077581432e-02   +1.015202239110002e-01   -1.610787816716707e-01   +1.635133891926488e-01];
L2I_L3I_iGABA_netcon = [-1.792487969880152e-01   -1.348839657545375e-01   +2.279113282960813e-01   +4.037212651680568e-02   -8.052726532127599e-02   -2.009526369676476e-02   +8.927923765884517e-02   +1.875068723459925e-01; -4.209705860265334e-02   -8.305199292344007e-02   -1.331772103664214e-01   -1.324748714640792e-01   +3.033102310091330e-02   +2.202371296235430e-01   -1.058559198429754e-01   -1.937603279356691e-01; -1.095011678317922e-02   -2.715926326030903e-02   -1.368883587683446e-01   +1.077780150236541e-01   +2.299376363974824e-01   +5.424023804102240e-02   -2.322837021553315e-02   +7.780650774348609e-02; -1.346431292049150e-01   -5.004022403070200e-02   -1.071611139760047e-02   +3.872137340342161e-02   -1.670525308678586e-01   -4.028896187702320e-02   -2.060419887115715e-01   -6.547915918244948e-02; -1.987597533680107e-02   +1.361516406277499e-01   +1.517891834757685e-02   -9.873247636845489e-02   -1.191449152734773e-01   +1.593812542774751e-01   -3.610260027284679e-02   -1.644150326477438e-01; +1.346318466919258e-01   -1.650088452592258e-01   +3.775810761708072e-02   -2.290019302949164e-01   -8.788496965392684e-02   -8.228879078662045e-02   -9.156938940164271e-02   +1.183934747809156e-01; -7.236962359040877e-02   +1.141608262501486e-01   -2.289839505999884e-03   -1.197970276783901e-01   -6.269233469471187e-02   +2.445822825383435e-02   +6.436170816657959e-02   -1.882458938547230e-02; -2.177739723461279e-01   +1.660058697748992e-01   -8.801988391899904e-02   -1.318380047512251e-01   -2.794955811350266e-01   -5.628472709898722e-03   +9.751915193753857e-02   +1.173115936566362e-01; -2.330763927891029e-01   -1.585855814975164e-01   +1.254281591896053e-01   +1.288512815755452e-01   -9.955019379064448e-02   +1.224898659325160e-01   +3.098368304905338e-02   +4.451523653646876e-02; +1.927647820969510e-01   -1.653034669503758e-01   +1.132898243337609e-01   +3.957127057451330e-02   +2.349022721451005e-02   -6.218889335769108e-02   -8.522400484825184e-02   +2.130855458526457e-02; +3.062816131448377e-02   -1.487386124262270e-02   -3.560445913480290e-03   -8.704178284204955e-02   -1.700399609039680e-01   -8.839624292504038e-02   +2.497432402007076e-01   -7.441810420721572e-02; -8.372359796446535e-03   +1.120630220359507e-01   +4.517610523761064e-02   -1.733273045692259e-01   +1.320868641983932e-01   -9.776590090758167e-02   +3.594701902065129e-01   -2.134346248905602e-02];
L3I_L3E_iAMPA_netcon = [-5.838743345374399e-02   -1.210184237230451e-01   +4.298318892224418e-02   +8.419027770231215e-02   -1.837473140801898e-01   -6.660904878153080e-02   -3.622733946550575e-01   +1.118912422348075e-01   +9.836134988405851e-02   +2.633044985441940e-01   -1.533064257171222e-01   +2.341814411109970e-02; +5.789990567329692e-02   +9.640951262027573e-03   -2.328625390138933e-01   +3.459402416082798e-02   -2.380447978559782e-02   -3.700684076718377e-03   -2.215408308330574e-01   +2.464086512330864e-01   +1.442839147577258e-01   +2.856243043056749e-01   +3.504139627109453e-01   +2.854961508296486e-01; +1.520632727615117e-02   -2.130514182761969e-01   +8.902009477352392e-02   +9.470365818424320e-02   +2.279252372983983e-02   -1.379490706547803e-01   +7.718790097631924e-02   +1.223625140066382e-01   -8.048398802996819e-02   +2.125917750416372e-01   -1.831603539848546e-01   -1.288376160169304e-02; -1.956083417321333e-01   -2.287763245073673e-02   -1.848811312059915e-01   -2.866493401747154e-01   -2.451635945861318e-02   -2.354368063389894e-03   -5.309189573731100e-02   -3.175446132994467e-01   +1.376406223585287e-01   +1.073987878690576e-02   -9.646720076980086e-02   +9.462344210032125e-02; -1.785903090843109e-01   +2.289018135670871e-01   -4.409985472200881e-02   +9.933205295637591e-02   -1.117223866182281e-01   +4.773425013535506e-03   +3.041285012046810e-01   -1.880420002673001e-01   -4.067656385370610e-02   +1.377704021983174e-01   -1.686459624810698e-02   +6.413201779810056e-02; -1.351508487444152e-01   -1.334843943264443e-01   -7.491600886099559e-02   +1.140899966404932e-01   -2.455077126276231e-01   +1.699829062571327e-01   +1.913893426293465e-01   -7.342284316275753e-02   -2.431143968057534e-01   -2.084702010120277e-02   -7.345533190370383e-02   +1.866314214846576e-01; -4.671075583392694e-02   +8.767867801424202e-02   -5.163365132863611e-02   +4.507967502515398e-02   -1.334117096488591e-01   -1.492027023471626e-02   -5.564398917003945e-02   +2.166266263462169e-01   -1.432496390439005e-01   -1.005096376653972e-01   +2.202376038236492e-01   -3.506005784056091e-01; +1.009671699057689e-01   -2.262508423500966e-01   +5.920325247104705e-02   +9.166191097804334e-02   +6.093994330637023e-03   +4.666093473622437e-02   +1.068887565249911e-01   +1.790100095839138e-01   +1.052213584378831e-01   +5.605019931091063e-03   -1.294372662822293e-01   -1.875012278131681e-01; -1.728705743240700e-01   -3.594965122203886e-01   +1.577056051074208e-01   -2.177018627716162e-01   -1.911961518854017e-01   -4.852715484184793e-03   +1.898727313203723e-01   +7.006786482203657e-02   +9.206532821872909e-02   -1.063059699898901e-01   -1.546245482226173e-01   -7.089928839765627e-02; +3.554853372931611e-02   -1.284540338822986e-01   -1.233686654488029e-01   -1.802811443418345e-01   +3.910432506009248e-02   +6.088470584763490e-02   -1.548277920979150e-01   +1.632908441293667e-01   +4.659211441350809e-02   +2.211851544328767e-01   +1.242328280633924e-01   +1.653765125133702e-01; -4.552820070331886e-02   -8.322492275383814e-02   -2.072642148592289e-01   -2.281073856423751e-01   -1.321997000090152e-02   -1.412648855830743e-01   +7.946849936742548e-02   -1.627990767965751e-01   -1.280626531298504e-01   +3.023473300141741e-02   +1.487706090970470e-01   +7.014373019160527e-02; -8.277157049007204e-02   +7.093814562474376e-04   -1.842931120446026e-01   +8.384569924252480e-02   +1.031271769792669e-01   +2.803937258158034e-01   +9.674070394249989e-02   +3.113629961727208e-02   +2.016320415666523e-02   -2.752444625794292e-01   -6.224869126124968e-02   -2.620404460837495e-01];
L3E_L3I_iGABA_netcon = [-1.796582359647574e-03   -1.121708457182698e-01   +1.826305257985693e-01   -5.763428490355023e-02   +1.032878556803820e-01   -5.563244436293042e-02   +1.417754289208031e-01   -4.765596463022083e-02   -7.612276696164859e-02   -1.274326318772719e-01   +7.310927939689670e-02   +1.742836025249097e-01; +1.250290543400761e-01   +9.887200371239263e-02   +3.178170970938861e-01   +1.452389147026286e-01   -3.449237246698675e-01   -1.227449439685949e-01   +3.397000644762089e-02   +2.305467976486480e-02   -1.787656048163204e-01   -2.677279883565937e-01   -1.208024339561042e-01   +1.817482572686670e-01; +1.399144140847932e-01   +1.504635953572425e-01   -8.781923179786343e-02   -1.027981264301952e-01   -2.434582496800596e-01   +3.012100486754090e-02   -6.324635889942132e-02   +1.260372304324012e-01   +6.508044075121208e-02   +1.164058619745920e-01   -2.648318461870680e-02   -3.736116104256682e-01; +7.946974339955976e-02   -5.417885661843831e-02   -5.047593104245265e-02   +1.084757821236351e-01   +2.507812671474000e-01   +4.176324871353103e-02   +3.653032058011663e-02   -8.370511040412946e-03   +5.210315479448488e-02   +1.146650006971604e-01   +1.142877648413534e-01   +2.062905655421336e-01; +3.151625025123710e-02   +1.215842204231118e-02   -1.344375326943238e-01   +7.224841961114929e-02   -7.180427650602653e-02   +3.039039869904845e-01   -3.061232235196688e-01   +1.915413299145704e-01   +1.373933033678554e-01   -2.380436060124538e-02   -1.119192552202858e-01   +1.745839788237235e-02; +5.470345353017995e-02   +1.429988435321153e-01   -3.650817279338500e-02   +1.819216655580920e-01   -2.556890093027747e-01   +1.020643180294470e-01   +1.838442006770329e-02   +9.224312671894679e-02   -6.121957915905717e-02   -1.330947919292149e-01   +2.178842547645876e-01   +3.193743315129692e-01; +1.418274510798798e-01   -1.888038905559494e-02   +1.534639107533863e-01   -1.642733255788867e-01   -1.367178186900544e-02   +1.785715983280743e-01   +1.310453483155555e-01   +1.580115352650517e-02   +8.934027575962078e-02   -7.098618448513482e-02   +1.657806017713582e-01   +2.753545025358170e-02; -1.238686234125811e-01   +5.118701074196610e-04   +8.864957806329864e-04   -6.976541319127554e-03   -1.326147687004674e-01   +2.986497505549661e-02   +1.911672808696614e-01   -1.730901415807865e-01   -2.752871541507871e-01   -1.335724791687259e-01   +2.096849583654203e-01   -6.307503999819011e-04; +9.796157475403648e-02   +1.106602713663152e-02   +5.452159492032572e-02   +2.976243440963714e-01   -1.586333377546689e-01   -1.727644153696588e-01   +1.229669288454451e-01   +2.683314965649191e-02   +2.724529705085061e-02   +9.938973219226432e-02   +1.792984926050428e-01   +1.647359621890203e-01; -1.166353853790924e-01   +5.779266006407530e-02   +3.679911447435946e-02   +5.156411569559559e-02   +9.576175366379212e-02   -2.133232050991768e-01   -1.422135206694802e-01   +4.401148421714948e-02   -1.446088746235345e-01   -1.818841974902861e-01   -2.168752641740800e-02   +2.258100881809385e-01; +6.725375982083917e-02   +1.503481730020658e-01   -1.837792247554192e-01   +2.902307439271115e-01   +1.531307169182296e-02   -2.122316752649119e-01   -1.313264000320451e-01   -3.525281706764408e-01   +2.165629985617772e-03   +1.576949181150130e-02   -2.200010572912520e-01   +2.560946948849153e-01; +2.107462081054915e-01   +3.785363874659178e-02   -1.548714595847518e-01   -1.783966122448132e-01   -2.759710702468715e-01   +3.871008801070070e-01   +1.825659017889088e-02   +1.741611152591032e-01   +7.708880123898582e-02   -4.966223967443811e-02   -1.018947142085715e-01   +1.499953203328296e-01];
L2E_Input1_iAMPA_netcon = [-1.330703871933770e-01   +1.726609292240371e-01   +1.810355660879951e-01   -2.246010915956625e-01   +1.082035873381739e-01   -1.027861686037504e-01   +1.300995176924878e-01   -1.836920355440165e-01];
L2I_Input2_iAMPA_netcon = [-7.780353072968738e-02   -6.201862736717309e-02   +2.418781337734472e-01   -1.639472070817936e-01   +1.199932404687476e-01   -1.690052472093081e-01   +3.866582318083023e-02   +1.619543892857984e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
