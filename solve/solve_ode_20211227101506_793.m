function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.271035263161268e-01   -1.057526542830085e-01   -1.400206544881627e-01   +4.334585886910990e-02   -2.558666682838916e-01   -1.746337515632048e-01   +1.288959381147279e-01   +2.600619765041050e-01   +5.127986947438214e-02   -2.596084771115125e-02   +5.975867473612173e-03   +3.442078412537967e-01   -3.962832584798779e-01   +1.547364499560377e-01   +4.263727603903406e-02   -3.350634156717019e-03; +2.821649656113931e-02   +2.464914353574814e-01   +4.515603016386636e-01   -1.302901946837334e-02   +3.414437520257989e-01   -7.478309345042136e-02   +8.049629035508106e-02   +1.158077765902488e-01   +1.050200675879218e-01   -2.894500843566726e-01   -1.942207404989552e-01   -5.280613054505675e-02   -1.053988515064232e-01   +1.350355522318350e-01   +1.537500916622756e-01   -1.224102323583247e-01; -1.374108591005310e-01   -2.730838849592566e-01   +2.914288533190755e-01   +2.075704429824389e-01   +1.113279969410552e-01   +1.647230457573148e-01   +2.203265557292753e-01   -1.600271183867842e-01   -1.694055208174953e-01   +6.647291988987548e-02   -4.151654057468628e-02   +3.354203050410111e-01   +1.525558768112231e-01   -9.176313340963471e-02   +3.352490811120223e-01   -1.284939204305135e-01; -3.301347962171002e-01   +2.267437417446147e-01   +2.421496383883997e-01   +2.303902712347640e-01   +2.113661710375652e-02   +2.141058071584989e-05   +3.829131177679923e-02   +3.360694495134602e-01   +2.348933550989239e-01   +2.761492370895718e-01   -2.301384093178834e-01   +7.695271820411032e-02   -2.228852382365697e-01   +3.187048124583803e-01   -1.110338119831054e-02   -6.575792610401858e-03; -7.453865462332329e-02   +4.725126206087578e-02   +2.885660333178556e-01   -2.098692597020432e-01   +7.160251430056996e-04   +4.621022761129082e-01   -6.279939978241433e-02   +5.419422712656414e-01   -3.409783285080190e-02   +2.598093194771664e-01   +1.700339908867116e-01   -1.815100620674262e-01   -3.129905555452479e-01   -3.341047674369150e-01   -3.748338129888679e-01   -4.569104393394089e-01; -1.432481083058568e-01   -3.048793947622407e-01   -2.598562460460818e-01   +1.377494847954150e-01   -6.671959475541608e-02   +5.250237846451294e-02   +2.958479608449349e-02   +3.681150495446482e-01   +2.216636095221375e-02   -2.199430803400248e-01   +1.504135480785191e-01   -1.405106973158044e-01   -4.459378729563334e-02   +9.888702002244941e-02   -4.336331008229088e-01   -6.711837306448812e-02; +2.034569343473402e-01   -5.320827249516125e-02   -1.657972232216941e-01   +1.166771781947197e-02   +3.225559703733865e-01   -7.450473121901564e-02   -2.476627773983297e-01   +7.736021044628878e-02   -1.789654863072199e-01   +1.009601146217454e-01   -5.812704445333758e-03   +3.400618420911549e-02   -9.195815300598031e-02   -9.892462822723008e-02   +9.650074049682417e-02   +3.465171452511970e-01; -8.041744196658432e-02   +1.638350076133731e-01   +1.695528189701144e-01   +9.332624610190050e-02   -2.557145413043155e-01   +4.548348798654402e-02   +1.959738386798894e-01   +1.589722069653521e-01   +1.765637834209742e-01   +3.601276951666011e-01   -2.640158594746190e-01   +5.656764939067227e-02   +1.690702430231210e-01   +3.134628510065431e-02   -1.129989282561737e-01   -1.342448843449449e-01; +1.028250044184260e-01   +1.258048127850615e-01   -7.517001133383355e-03   -8.915491472710692e-02   -2.497975217112757e-01   -2.291691357581166e-01   +1.266183958481443e-01   +4.080705500682899e-01   +2.546584801691734e-01   -1.425705694813302e-01   -1.723921778383201e-01   -8.791667543531212e-02   -2.020691776997901e-01   +7.229821066400566e-03   -4.113893314168031e-01   -3.134986355747715e-02; -4.383441985001357e-01   +8.962045690873831e-02   +4.995386320077242e-02   +2.010776316835099e-01   +1.088032291108241e-01   -1.324113990169916e-01   +4.883196993785338e-02   -2.771445597134988e-01   +5.435437540237179e-02   -2.772735381083193e-01   +7.226078553039139e-02   -3.074412856168025e-01   +8.356327886843541e-02   -2.251619569354521e-02   +1.806970144570438e-01   -1.629809653679627e-01; -2.395450920512155e-01   -1.899175866453428e-01   -1.633967263908395e-01   +1.737477161947230e-01   -2.067663770283962e-01   -1.543094738063049e-01   +1.020953588189516e-01   +1.310016428326384e-01   -2.259739482656165e-01   +2.382426247384798e-02   -9.796323739264394e-02   +2.309158925704762e-01   -2.562412766977261e-01   +2.915393989241627e-02   -4.135912458786156e-02   -3.406295761412104e-02; +1.172896383811063e-01   -2.124049155882091e-01   -4.015620706824978e-01   -1.709861761106111e-01   +1.836349840015526e-01   +2.485773327205905e-01   -1.154731240161140e-01   -3.061863448101310e-02   +1.388939107918327e-01   +9.859986729490011e-03   -4.387948898986452e-01   -1.744014836126051e-01   +2.183041342769009e-01   +1.785769919814791e-01   -5.024790160614054e-01   +1.373293649506655e-01; +1.685442603549769e-01   +4.756334548622160e-01   +3.033059415792074e-01   -8.031450998127931e-02   +4.435333627182207e-01   -2.038126523167691e-01   -5.127742789424593e-02   +7.084038309140819e-02   -1.532925905820034e-01   +2.070591649611539e-01   -2.221666663955410e-01   +2.077554563176302e-01   +1.468414907793819e-01   +1.413635752588630e-01   -1.470837454082212e-01   +1.273381485724391e-01; +5.006783048907371e-02   +2.226953915463485e-01   +3.432460165266016e-02   +1.719933497095360e-01   +1.161149671061543e-01   -8.558682450261770e-02   -2.940559000942918e-01   +3.126524259798076e-01   -5.321414373853778e-03   -5.985914263791179e-02   +2.747442931536577e-01   +9.261549582693179e-02   -3.788639933226698e-01   -2.330986922665440e-01   +2.966458758291658e-01   -8.387975279078767e-02; -3.920291036379011e-01   +1.418597588888864e-01   +3.534273632888121e-03   -1.123254825638152e-01   +5.551270524577434e-03   +1.413706077047746e-01   +1.586619074184438e-01   -4.294037136498871e-02   -2.944543427781379e-02   -2.642059681515400e-01   -6.403344566111153e-02   +1.469470056214198e-01   +9.891764172811388e-02   +1.849465657743641e-01   -2.113826484512560e-01   -3.807596295078822e-02; +1.231263942056840e-01   -7.537927201185493e-02   -2.801782720270489e-01   +5.815050259069691e-02   -1.878770480265632e-01   +4.580078371907189e-02   -1.117909357505591e-03   -6.352666712388452e-02   +5.913474965748423e-02   -1.369232281174492e-01   -1.870929226768067e-01   +2.278605851642840e-01   -2.931363847998014e-01   -3.708501260616892e-01   +4.549006176304640e-02   +6.405696647689393e-02];
L1E_L1I_iGABA_netcon = [-5.165381219894093e-02   +4.911729468185178e-02   -1.251904700991264e-01   +4.114515231485814e-02   -5.842251877370175e-02   +1.544404971816485e-01   -2.583267689660242e-01   +7.081353507107958e-02   +1.248723003576713e-02   -2.223900132057686e-01   +1.030448787748185e-01   -3.094317470656122e-01   +6.063109684954622e-02   -2.663590666717411e-01   -1.334364277325943e-01   +1.529784053543137e-01; -1.931338455934114e-01   +1.188226645374950e-01   +1.429164316883632e-01   +5.849934864337648e-02   -2.886113473286044e-01   +2.263940286277795e-01   -2.181427425680209e-02   +1.408251979463904e-01   -4.255433386558527e-02   +6.737200198919052e-02   -1.846050381333723e-02   -3.967860058441492e-01   -5.018271984523315e-02   -7.035907345425597e-02   +1.039567392699765e-01   +1.301299344279855e-01; +1.770852808443497e-01   +1.686938737555023e-01   -6.006526993975528e-02   +9.447806660013945e-02   +1.775703443673597e-01   +2.281546992591630e-01   -2.157299684673372e-01   +5.755609946603714e-02   -2.573655279842982e-01   +1.961664489023831e-01   -1.825084704505325e-01   +3.351282804505147e-01   +2.007858653793145e-01   +1.909595326174734e-01   -1.346423234950272e-01   -1.822070295190880e-01; -6.443683105235437e-02   -4.148002859059113e-01   -5.255927076163770e-02   -1.724250144864416e-01   -2.565558165753200e-01   +9.673183111004860e-02   -4.383839347210985e-01   -3.088578182332325e-01   -1.057859132848488e-01   -1.297522284807324e-01   -3.835679918977654e-01   +2.403028148574365e-01   -4.568106791806931e-02   +8.071582724915111e-02   +1.746501684291288e-01   +2.055694112294376e-01; -1.422728748664275e-01   -1.895369267160579e-02   -1.328799736839147e-01   +1.538419839921479e-01   -1.422837196079781e-01   +3.230841594246787e-01   +3.024543074264362e-01   -1.328911699714505e-01   -5.133049867287695e-02   +7.249796152809060e-02   -1.625940993327922e-01   +4.207764752830552e-01   +1.450069814836236e-01   +1.539670091624440e-01   -1.343321736110849e-01   -8.647817732577187e-02; -1.602231340553826e-01   -2.466334020861271e-01   -3.464583201692380e-02   +3.920945773767063e-02   -1.428791284636748e-01   +4.802284083146232e-02   -5.265384085615206e-01   -1.210562563970209e-01   +1.569843410280675e-01   -6.613046620924733e-02   -1.666685082827549e-01   +7.248920363157434e-02   -2.978512723008487e-01   +1.785540293709405e-01   +1.757000050334072e-01   +1.439448110659887e-01; +7.480799095049492e-04   +7.588365606351748e-02   +3.638740213150689e-01   -5.081994991206495e-01   -1.118452371270455e-01   -8.277145951339764e-02   -6.899315058938774e-02   +2.131798007767187e-01   -2.234090141597772e-02   -3.194873708858451e-01   -1.782119941877699e-01   +3.100079347989670e-01   -1.422488936514223e-01   +4.142917238558697e-02   -1.803178450675331e-01   +9.072120807010869e-02; +9.093895436244659e-02   -2.214361561352891e-01   +1.201803936653383e-01   +3.237511207203229e-01   -5.074560975932835e-02   +2.919782768774444e-02   -1.762276013555031e-01   -1.376183181852304e-01   -2.991514435865630e-01   +3.193353758269675e-01   +3.940638048952894e-04   +3.294869735937928e-01   -1.002335452279082e-02   -1.167371250605740e-01   -2.416166263619461e-01   -2.104203557854367e-01; +3.808812727340189e-01   -1.198321578190726e-01   +2.921939666060473e-01   -1.380719765105551e-01   -1.092081299408727e-01   +1.662306506543807e-02   -3.069841838417086e-01   +4.528962645563468e-02   +9.730558159740452e-02   -2.587014204682758e-01   -4.304728029955077e-01   +2.163195857123598e-01   +4.928935482494857e-02   +6.480153515249674e-02   -8.844725314304486e-02   -4.026990226257950e-01; +3.441867365916765e-01   -1.355903567625384e-01   -2.315163263273854e-01   +1.264169746952787e-01   -3.355474452563229e-01   -1.599631109914007e-01   -2.438407346259729e-01   -1.191410882887618e-01   +4.425590287879318e-01   +7.580860491822085e-03   -3.103779578244975e-01   +1.128722007038240e-01   -1.035554445487276e-01   +1.037302895851133e-03   -1.568947536284153e-01   +1.017949335839594e-01; +3.917958202934875e-01   -1.693476466163705e-01   -8.377077015110548e-02   -3.379014077638407e-01   -5.723243711505442e-02   -1.556734120843005e-01   -1.903614672347675e-01   -1.894817345280422e-01   +2.235600588038399e-01   +4.365227517583568e-01   -1.294144730174830e-01   -1.835850502028437e-01   +3.436086339400746e-01   +1.722593847404003e-01   -2.480319100363765e-02   +2.922287714392607e-01; -1.072995816137787e-01   +1.127867823557408e-01   +4.874533572358609e-02   +3.916231829626515e-02   -3.446990279435440e-01   +1.193929987501395e-01   +2.722896933105402e-01   +1.859525893404685e-01   +1.063260469780129e-01   -1.747618618729588e-01   +1.803973119394759e-01   +1.793231743273334e-01   -2.526382877042549e-01   -1.941821287071867e-01   -2.690634346883872e-01   -2.599436889147348e-02; +1.907456173086155e-01   -2.831549505585559e-01   -1.389963652932462e-01   +3.368344040785143e-01   -2.286591817355186e-01   -2.319072205452129e-01   +9.218814024539010e-02   -7.097418597211261e-02   -3.525183549692398e-01   -5.641025228657853e-02   +6.572297622902055e-02   +6.465218301101273e-02   +1.025518161717971e-01   +1.428928300314354e-01   +1.008544666340925e-01   +1.496673979713479e-01; +1.143758228081239e-01   +4.189180604729472e-01   -6.338292463674594e-03   +4.360421039250290e-01   +1.557532446223335e-01   -2.273242549571101e-01   -8.753256331881916e-02   -6.196396264956323e-02   +2.959503558834115e-01   +1.962499533039211e-01   -1.524815705819003e-01   +2.076869643982663e-01   +3.548092412365634e-01   +1.366304901068087e-01   -1.409393440551064e-01   -1.019348702357749e-01; -1.197151083218239e-01   -1.538534078589719e-01   +2.260049196771022e-01   +2.445828312681182e-01   +2.143185995310705e-01   -9.938520658185078e-02   -1.653788094732766e-01   +1.392886272610414e-01   -1.785953154988838e-01   +3.605789970051282e-01   +1.354991419701562e-01   -3.793815679512133e-02   +9.053963600844579e-02   -1.736036800892653e-02   -2.971418738322513e-01   -6.882609270661509e-02; -6.460379320183753e-02   -2.081832095820139e-01   +1.991111019360222e-01   -1.405412583301593e-01   +3.058210431477313e-01   -3.453750367871652e-01   +3.535381298655965e-03   -1.396115939498950e-02   -6.308473777090215e-02   -1.363599878896249e-01   -1.036885247314699e-01   -5.756104601962377e-02   -5.776456351343941e-02   +7.165404719816099e-02   -2.343818845054824e-01   -1.055878941288265e-01];
L2I_L1I_iGABA_netcon = [-4.268253509315936e-01   +7.026809094135457e-02   +3.197186300341334e-01   +3.387305173579439e-01   +3.433770475137864e-01   +1.155097737180240e-01   -2.026062700874760e-01   +1.094540583164428e-01; +1.972278453237006e-01   +1.492944095075243e-01   -1.196015611689157e-01   -1.075467422419727e-01   -1.783813730791765e-01   +1.657523659187201e-01   -5.068295430353743e-02   +2.161396228993409e-01; -6.290249605328622e-02   +2.233695692732058e-01   -1.256471964161181e-01   -3.607347923138499e-02   +3.190703995328620e-02   +4.153569660299228e-02   +2.215165992182335e-01   -2.936777373385419e-02; -2.242516470775335e-01   -8.166272095614720e-02   -1.142756453512828e-02   +5.895762081387362e-02   -3.461381303801396e-01   -1.803573357658286e-01   -1.375290289750696e-01   -2.550031631869154e-02; -1.805572976065224e-01   +1.145606786806852e-01   +4.436311500232145e-01   +2.407961365786008e-01   -8.285057044477524e-02   +2.926060035481078e-02   +2.308368585881430e-01   -1.242633741583725e-01; -2.211807070035514e-01   +2.744453452620433e-01   +9.198333940966558e-02   +1.647381351765982e-01   -4.759700492315503e-03   -4.601107366167236e-02   -3.364336588493288e-01   +1.156928283207422e-01; -9.525025415725143e-02   -2.234235952481113e-01   +1.365448451108222e-01   -5.233086997437846e-02   -6.023455948228964e-02   +1.488565491782451e-01   +2.581309813359071e-01   -1.247964277868411e-01; -2.366391804364998e-01   +2.542192380393528e-02   -2.219563061045474e-01   +1.088174181409292e-01   -3.243305081538036e-01   +1.000451531547328e-01   -1.744208308625865e-01   +2.044766351325508e-02; -2.723202315815299e-01   -2.724537459795557e-01   -1.321277297867929e-01   +2.461259010619099e-01   +1.630923103820608e-02   -1.761667032985779e-01   +1.468726676014882e-01   -2.777921406341777e-01; -2.722340292917373e-01   -1.209334942541210e-01   +4.682813168794386e-02   +1.810985149445389e-01   +2.354384374229056e-01   +9.058113190304781e-02   -2.452601906645980e-01   -3.482817736694210e-01; +4.848650831603299e-02   -1.407158081951712e-01   +1.168449211783019e-01   +6.982546725808719e-02   -2.974176852583373e-02   -4.507574330522381e-03   -8.552617880368296e-02   -1.022454986791009e-01; +1.022273793790736e-01   -2.632728606926195e-02   +3.025585311227353e-01   -1.190674619484612e-01   -7.670300038760798e-02   +7.315429525023294e-02   +4.108849031104020e-01   +8.829870076002123e-02; +2.650473828013578e-01   +4.330501427186225e-01   -3.082877519377474e-01   +3.286666692718326e-01   +1.486961803363526e-02   -2.850634101734162e-02   -2.616155845280191e-01   +3.083406396640800e-02; -3.117250934446308e-01   +1.792420093668155e-01   +5.540284844197346e-01   -7.526029941412138e-02   -9.146770367126136e-02   +8.144817768154185e-02   +1.988158168503045e-01   -2.695393782213933e-02; +3.446853270098322e-01   -1.325910078282354e-01   +6.152071888519926e-02   +7.974269141827250e-03   +2.287413236916930e-01   -2.097216786764424e-01   -2.635836314736485e-01   -1.893472507245544e-01; -7.256486768893031e-02   -1.753814271077993e-02   +2.883411041164987e-01   -2.731648603088347e-01   +7.498224031800613e-02   -1.498164582780490e-01   -9.742862764010467e-02   +1.100100251001271e-02];
L1I_L2I_iGABA_netcon = [-1.585017512812948e-01   -2.684799143954818e-01   -2.585301627909488e-01   -2.620224728378875e-01   +1.692817261475427e-01   -1.570321976928253e-01   +8.088414359318928e-02   -6.067575230041171e-02   -1.967040797988859e-01   +2.521669302362547e-01   +6.137338801680327e-02   -6.460313108645245e-02   +2.570917416393873e-01   +3.723905395098331e-02   +9.169080533250809e-02   -1.868835663049409e-01; -5.191673410448021e-01   +2.766059910631405e-01   +2.282304968786217e-01   +3.107339515116021e-01   -1.077474612990634e-02   +5.545796791637310e-03   -1.822354782758554e-01   +2.829042928427686e-01   +3.987064515319254e-01   -3.286557497830603e-01   +1.008237871280991e-01   -1.919616046092246e-02   -2.887837748721546e-01   +3.372374787310762e-01   +2.503464775861485e-01   -1.239009103848480e-01; +1.831307943392952e-01   +1.443353636844832e-01   +1.681763427129102e-02   +2.974151501068617e-01   +1.378627677823091e-01   -1.251961387095928e-01   +2.006007325976203e-01   +5.652836350087689e-03   -2.327351480895169e-01   -1.297097052844169e-01   -1.738338774491680e-01   +2.710982731231535e-01   +4.007417932353473e-02   -2.494807960462710e-01   +3.879127194380950e-02   -3.577023909263409e-01; -1.980895578122471e-01   -1.216793133874891e-01   +2.966894465449418e-01   -1.727632223893393e-01   +8.241088603974413e-03   +1.888906338966658e-01   -1.250738495992468e-01   -1.129226759345037e-01   +1.810955723842261e-01   +4.299614867432723e-01   -1.166314856694128e-01   +3.409706027067789e-01   +1.044925643472830e-01   -1.330052626183161e-01   +1.195760900332972e-01   +2.689267486637004e-01; +6.069739590983940e-02   +1.255224263231719e-01   -1.134640040729652e-01   -2.515308122581046e-02   -3.719874340654986e-02   -2.847143170317718e-02   +1.960927458713863e-01   +1.872215002522762e-01   +3.154482282929968e-01   -2.083721229375073e-01   -1.245640296758856e-01   -2.055105367144799e-01   -9.775979102150045e-02   +2.921138721402039e-04   +1.213954718899129e-01   +3.795227283350411e-02; +7.240882078395831e-02   +3.263516750868742e-01   +3.221029513466901e-01   -5.363963740933897e-03   +4.762708062189189e-02   +7.940398616521957e-02   +9.770547419234921e-02   -3.296662528771646e-01   -1.921006524824456e-01   -2.590289718790199e-01   -1.133825417726810e-01   +4.053213325697272e-02   +1.756779543331429e-01   +5.568306985382011e-02   -3.154414707872660e-01   -1.144858679585499e-01; -1.559112630988095e-01   +1.092743581724777e-01   -8.280142986554248e-02   -1.137236743655190e-01   -3.389896776021597e-01   -4.908065936920737e-01   -1.518763166005997e-01   -4.616982120769550e-02   +3.632449548647965e-01   +3.587525703605425e-02   -7.822705359782987e-03   -1.724642088185545e-01   +2.649417760117613e-01   -2.258617398051169e-01   -1.231502677003254e-01   -1.326384530266380e-01; -5.017296854397924e-02   -1.622718868495896e-01   -9.849184746589126e-02   -9.537566811317749e-02   +1.132321434233831e-01   +8.681870955799487e-02   -6.341248832704843e-02   -1.982051136446547e-03   +1.628930154799636e-01   -4.368669399534458e-02   +1.883237291082726e-01   +5.363565541818576e-01   +5.081084557832865e-02   +2.200121807378498e-01   +6.936350623126213e-02   -2.130828495944743e-01];
L2E_L1E_iAMPA_netcon = [-1.601163883827914e-01   +7.408588002303082e-02   +2.749406535866031e-01   +1.100910764558878e-01   -1.154912340629433e-01   -9.511267963292422e-02   -4.347270775240513e-01   -2.194952676559108e-01; +8.548296588948312e-02   +3.282713077937113e-02   -2.760941022831882e-01   -1.766301360015074e-01   -2.402634470600231e-01   +2.724428245362528e-01   -1.909921952174160e-01   -1.329579886744012e-02; -5.900158760634031e-01   +3.357490417860129e-01   +2.832073620795506e-01   +9.068945767907113e-02   -1.131575901870148e-01   -2.477775580803467e-01   +9.067586548454797e-02   +3.031871140498105e-01; -2.342678791908844e-01   -1.518357204011843e-01   +2.172782075543027e-01   -2.952079312530807e-01   +1.018207413831475e-01   +1.269673895368016e-02   +2.203797141842411e-01   +2.340760572348471e-01; +9.927943130365138e-02   -6.707144943051835e-02   +1.978951211257405e-01   +2.019596731695559e-01   -2.687133349236033e-01   -3.176444581400980e-01   +2.639150253488916e-01   -4.697022021017568e-02; -2.978530424597156e-01   +2.823351196868963e-01   +3.792996450311634e-01   +6.338601235206051e-02   +1.147890004769544e-01   -1.693242879615865e-01   -1.717706523760139e-01   +2.151004104097556e-01; +1.984903889784094e-01   +1.536921022225431e-01   -2.194142746673133e-01   +4.397464682514292e-02   +1.129350644191027e-01   +7.106722792220925e-02   -3.933585789659695e-01   -1.455099025130905e-01; +6.311751126111000e-02   +3.343559840397327e-01   +4.743820740136211e-02   -1.034066675317141e-01   +1.979356729779021e-01   -2.912142543503032e-01   -2.095633754478368e-01   +4.263052797878095e-02; -6.435522153000400e-02   +2.099082386335713e-01   -2.230131573675503e-01   -2.606795780615845e-01   +1.571317348236400e-01   +1.296363932929848e-01   +1.967481128954531e-01   -1.117043919676285e-01; -1.245524570871270e-01   +3.614256044876826e-02   +5.479844962551966e-03   -3.630498302177057e-03   +2.686020238767561e-02   +2.242424242973507e-01   +2.280060175376827e-01   -2.028836638287326e-01; -4.856645230729728e-02   +2.226197888577114e-01   +3.369317100028523e-01   -1.809401145348763e-01   -1.449393968447087e-02   +3.242401631267751e-01   -4.236239286691516e-01   +2.327371776978770e-01; -1.058710437595216e-01   -3.469430172142399e-01   +1.844288733982840e-01   -8.390943114068738e-03   -2.235189772493129e-01   -2.486114148241088e-01   -2.468796995328453e-01   +7.217200425188793e-02; +6.266059805064479e-02   -1.002527928999740e-01   -6.200779703638275e-02   -4.020863511093477e-02   -1.444685783128791e-01   -4.109060967793721e-02   -9.553106292297470e-02   +2.431781286777911e-01; -8.434252309219800e-02   -4.197866135364197e-01   -3.615388828015349e-01   +5.653182604545784e-02   +9.331863613268765e-02   -1.123013740820278e-01   +1.943367361579724e-01   -6.840701042851538e-02; -6.420971057305841e-02   +2.750688352984709e-02   +3.313821173126191e-01   -1.825046936547338e-02   +2.017926958261755e-01   -4.015180357343081e-01   +8.292315955124771e-02   +4.889392459244107e-02; -2.279541142781616e-02   +1.858558014052676e-01   -3.448792365796359e-01   -2.103882719040907e-01   -3.250833712574028e-01   +1.730978635460112e-01   +3.160110148427931e-01   -3.073527385795751e-01];
L1E_L2E_iAMPA_netcon = [-2.477377323599746e-01   -2.172581018637292e-01   -3.127029732624965e-02   +8.463844557476259e-02   -3.827427087759136e-02   -3.934992364853047e-01   -1.412042879043791e-01   -4.446089841535289e-01   +6.707029241135298e-02   -1.235127420097579e-01   +1.557233745450692e-01   +4.330080262142434e-01   -5.808500641350719e-02   +4.382902900014470e-01   -2.385441873046693e-02   +8.167636877313077e-02; +7.916172852409506e-02   +4.872019855916742e-01   +3.569529626315184e-01   -6.211581685512432e-02   -1.072871151246610e-01   +8.385077729705044e-02   +1.447747103316332e-01   +2.555732842928396e-02   -6.482803305135391e-03   +1.720845126307381e-02   -4.663947858099500e-01   -1.930040465807185e-02   -1.517207471877498e-01   -1.543062094930459e-01   -2.093565661742072e-01   -7.755167451391415e-02; -2.729323862588491e-01   -1.449174800199827e-01   -7.219948643731663e-02   -2.677123612086155e-01   +3.788671219689986e-01   +1.166673714715286e-01   -3.007626722599965e-01   +6.759846368469474e-02   -2.003256830234160e-01   -1.736705649544155e-01   -2.400522967143798e-01   -2.028946649034472e-02   -3.698223573893977e-01   -5.169421206662410e-02   +9.423203187919282e-03   +2.810386365739727e-01; -1.242797965520079e-01   +6.810321648142195e-02   -7.456890981870540e-02   +1.619634857797017e-01   +3.709668632631669e-03   +2.583284882574346e-01   +2.021527320490406e-01   +2.176088183962704e-01   -4.329806293584915e-02   +2.488745969964874e-02   +9.460970989472844e-02   -9.201217523606764e-02   -1.956919821396086e-01   -6.205032685607281e-02   -2.869526017313887e-01   +1.445543959723679e-02; -1.396838604623155e-03   +5.440043977034150e-02   -3.045952930125453e-01   -1.045610922579355e-01   -1.405117642484752e-01   +5.266444683925968e-02   -2.385123455060276e-01   +2.790065654796816e-01   -8.806846515171454e-02   +2.950416227553663e-02   -1.466571962839715e-02   -5.960622008467252e-02   -8.077742854315742e-02   +1.519433694665932e-01   +1.240742525580131e-01   +5.340640936308002e-02; -2.421346699634042e-01   +9.260015572526820e-02   -1.102243360704970e-01   +1.775603806202515e-03   +1.517443314073491e-01   -1.499991483968215e-01   +4.397374582605212e-01   -8.383447901874330e-02   +1.249727250048547e-01   +3.585739376324668e-02   +3.567105718674113e-01   -1.346642466455023e-02   -5.400174885430402e-02   +2.979783287793810e-01   -3.397727023050491e-02   +1.218088342750476e-01; -3.480158776164907e-01   +5.372041098894845e-03   +4.628115384101152e-01   +1.228689553342830e-01   -2.039131381882223e-01   -1.886991739546562e-01   +3.597331256344634e-02   +9.650492349369896e-02   +2.085612902184583e-01   +2.440020606266795e-01   +2.626141537720829e-01   +1.925497115608772e-01   +6.907714450784469e-02   -3.443965620643427e-01   -2.221667326736619e-01   -1.927326914605944e-02; +9.545340599925123e-03   -2.095359401517756e-01   -4.397006086391812e-01   -8.560698583463291e-02   -6.271956979823044e-02   -5.846790538023448e-02   +3.060317118666729e-01   -9.302367637462672e-03   +3.236652175237900e-03   -3.383394937515590e-01   +2.152537156722437e-02   -1.581528411660797e-01   -1.972091145237689e-02   +5.372478967017608e-02   -1.964085093452863e-01   -2.671814409495643e-02];
L2I_L2E_iAMPA_netcon = [+2.723169443892965e-01   +1.665742816993881e-01   -1.325105372756357e-01   +2.635761622992765e-01   +1.519749617449209e-01   +1.802842768016637e-01   +1.043821870921707e-02   -1.805523809960567e-02; +1.267239210574053e-01   +3.745363248314936e-01   -1.940186469301081e-01   +1.816695954481971e-01   +7.331957345166062e-04   +7.495912684709852e-02   +3.543290312104342e-01   +1.457438772389414e-01; -4.241109608905280e-03   -2.516577712133006e-01   +1.342858604342272e-01   +1.429368345747722e-01   +1.493496599307421e-01   -1.066186620395239e-01   -1.503227131064309e-01   +2.220184573270155e-01; -4.285577906580101e-03   -8.318912638709733e-02   +2.056146571266696e-01   +4.689503178874083e-02   -1.626934080247808e-01   -3.285044697244287e-01   +1.641785771236092e-01   -9.102287884529203e-02; -1.095621197238838e-01   -1.807327619348333e-01   -1.501203812919852e-01   +2.528270803287246e-01   +1.645791059717967e-01   +1.837647880315312e-02   -6.647226263584306e-02   +2.433245719149504e-01; -6.149317718656921e-02   -1.055644331209809e-01   +1.702036350749138e-01   +7.674490949115190e-02   -2.120267544789657e-01   +1.322080853240752e-01   -1.180133140793383e-01   -1.371038216309360e-01; -1.931138589644693e-02   +2.365636808577722e-01   +3.163431283230789e-01   +1.024664106935508e-01   +1.692288932401542e-01   +1.569055581708233e-01   -8.782943491802295e-02   +3.383240651320304e-02; +2.324075645888515e-01   +1.319459883628974e-01   -3.216288530481234e-02   -3.152275320438713e-01   -1.623748709951099e-01   +1.344254706599654e-02   +8.983285066077457e-02   -1.706101441080973e-02];
L2E_L2I_iGABA_netcon = [+2.488607078060104e-01   -1.707647147613649e-01   -2.916732064497447e-02   -1.245822800159375e-01   +2.264367160484948e-03   -2.691615396328331e-01   +2.896102073540381e-02   +6.136155983714112e-02; -3.533593317620090e-02   +2.704569972541551e-01   -2.205726881969902e-01   -1.148853728294199e-01   -2.542558563643019e-02   -2.580474290883508e-01   -2.953373871001916e-01   +3.446081771733944e-01; -1.547945471962670e-01   +1.409436054975132e-01   -7.874171587249369e-02   -6.938248508836357e-02   -2.981079676792617e-02   +4.794358938858266e-02   -1.851568444800161e-01   -8.070119039930990e-04; -1.010237397546787e-02   -3.679650922715824e-01   +3.473433506717362e-02   -2.980053096720232e-02   +7.076917015256617e-02   +2.136489569325903e-01   +2.986655424465325e-01   +5.235695200440429e-02; -3.247749177367487e-02   +5.526248729926483e-02   +2.444412479924804e-01   -2.099782109393469e-01   -1.069165574149634e-01   -2.575073451414268e-01   -1.965405593111838e-01   +3.346199380557807e-01; +3.745705874962917e-01   +9.687027250305605e-02   +6.103248738797315e-02   +2.135005715075870e-02   +4.359977201327745e-02   +3.959623796215520e-01   +3.811731296505122e-02   +2.695357089651095e-02; +6.634011984612162e-02   -1.732950841727602e-01   +1.162508726485310e-01   -3.685361024214306e-01   +3.627203539697188e-02   +2.702030009281521e-01   -2.641107121957122e-01   -1.958990054595453e-01; +1.713341687496439e-01   -1.460030233589633e-01   +2.636112115572021e-01   -1.999911435952017e-01   -7.752744991160032e-02   +1.842636870926491e-01   -2.471424363063364e-01   +1.901321389109686e-01];
L3E_L2E_iAMPA_netcon = [+3.693965374064564e-02   -1.950271282743685e-01   +9.852494569256012e-02   -1.738670932989658e-01   +1.763307701593188e-01   +3.548848885934952e-02   +2.996605089207517e-02   -1.694456815704695e-01   -1.899009426125170e-01   +4.282937303531836e-01   -4.166302942020148e-02   +2.083026587659060e-01; +1.017036539230981e-01   -1.567341830884127e-01   +1.097183082909535e-01   +3.004694784938597e-01   -7.557181858728988e-02   +2.111170126371499e-01   +2.946572686374990e-01   -2.797031304082641e-01   -1.062590838805203e-01   +3.488145957396439e-01   +1.499344982374911e-01   -4.814289975189140e-01; +2.762750553850789e-01   +9.108513106683011e-02   -1.904426070013361e-01   +2.042218221677167e-01   -2.687241979396900e-01   -2.988800368815100e-01   +2.725401641081098e-01   -3.751013411560949e-03   +3.013263707052724e-01   -1.813196576033475e-01   +1.000150879487051e-01   -3.169510376610259e-01; -5.830979130842611e-03   -3.177443165668266e-01   +8.418145374503720e-02   +3.826304645458269e-02   +3.350886337978218e-01   +1.206964974650952e-01   -1.021869962940100e-02   +4.380108771905855e-02   -1.204281329989660e-01   -8.844320552365559e-03   +1.215424326534522e-01   +2.408504609924027e-01; +3.113570433753738e-01   +2.078781460534043e-02   -9.333588034724093e-02   +8.392550672688774e-02   +6.767014105346342e-02   +3.638934004534291e-01   +2.616164423285472e-02   -1.660875672122019e-01   -2.080246209871519e-01   -9.590081058556202e-03   +1.429758517327370e-01   +3.375794884801959e-01; -2.775115356791709e-01   +3.541781003518469e-01   +1.182767092347419e-01   -1.318199015861380e-01   +2.375000729079038e-01   +4.722436277289502e-02   +2.381256634835856e-02   -1.566986429645031e-01   -2.914946952180797e-02   -4.040561694062831e-02   -7.219544086063791e-02   +6.057841733209317e-02; -1.042819828925900e-01   -2.019815751372678e-02   -1.942260843438336e-01   -2.288956708528011e-01   -1.243725291143803e-01   -1.011514834975032e-01   +2.126437831457272e-01   +1.371690904620003e-01   +3.359926636060738e-01   +2.640322629129264e-02   -3.615051999296471e-01   -1.660600225056343e-01; -4.750388758541068e-01   -1.393487750470538e-01   -1.465959371239621e-01   -2.350834514309562e-01   -1.933334820552925e-01   -3.884671308147658e-01   -9.457460091870644e-02   +3.043512418728949e-01   -1.195583294956843e-01   +2.819511450212608e-02   -2.930844353660213e-01   -1.358974333004929e-01];
L3I_L2I_iGABA_netcon = [+3.849308956274752e-02   -1.229152363680108e-01   -3.057247310089481e-01   -3.726215380051150e-02   +4.111528511359112e-02   -2.654771547312809e-01   -6.376847989543744e-04   -1.231176629911106e-01   -1.041574614432028e-01   -5.835008239975462e-02   +1.887912711662204e-02   +2.175948310082173e-01; +2.845098269775383e-01   -2.989717264798097e-01   -8.699825449735657e-02   +2.605410248413987e-01   +9.427014117246579e-02   +4.226436756601183e-01   -3.565279609628701e-01   -4.442973869000839e-02   +9.737716906833285e-02   +9.964932670445907e-02   -9.375942310879036e-02   +2.687241391827772e-01; +1.614442098968359e-01   -2.200059342444157e-01   +1.068947630834599e-01   -2.028477953517346e-01   +4.353951040506344e-01   -8.044138392802422e-03   -5.119225564959740e-02   +1.281145375516886e-01   -1.365370766807575e-01   +1.107439163122723e-01   -3.533981153295199e-01   -1.399182325801354e-01; -1.952209477809510e-02   +1.869149482336321e-01   +3.165996227069363e-01   -8.851060072485739e-02   -1.647094595429493e-01   -2.618876545117381e-01   +2.793795270027475e-01   +5.745074132328896e-02   +2.777971699351060e-01   +1.778685390822734e-01   +8.831147079951647e-02   -4.035670025369869e-01; +2.824004158014276e-01   +1.686706575190784e-01   +5.329298937180967e-02   +1.634917187197238e-02   -1.915065806637870e-02   -2.708293978002982e-01   -4.742034273434823e-01   +8.158284648393715e-03   -1.312173144324202e-01   +3.115626508062608e-01   +4.011758953977120e-02   +3.330426793271065e-01; +4.493333139979504e-02   -8.842999243498009e-02   +1.303301914361029e-01   +2.932886918473708e-02   +3.893756948975855e-01   -2.981489424932293e-02   +1.689153823533330e-01   -2.391837388823793e-01   -2.541621416578301e-01   -8.508036946859468e-02   -2.004166662041806e-01   -1.198325908191695e-01; +9.899449612194902e-02   -1.598032024600953e-01   +2.294800579527073e-01   +8.057286895675259e-02   +1.845202722263063e-02   -3.422043188180272e-01   +2.085717659900722e-01   +1.232770116546108e-01   +7.634321561779228e-02   -3.061936955269503e-01   +7.653920658770062e-02   +1.240379630028258e-01; +4.607252250336568e-01   -2.136256774198081e-01   +3.763313015000901e-02   -4.508728246079527e-01   -4.804088887605454e-02   -2.146454609878916e-01   +1.605230411141907e-01   +2.796671770375806e-01   -2.422897168505741e-01   -1.056976141110080e-01   +2.492707012400847e-01   +1.985061476018910e-02];
L2E_L3E_iAMPA_netcon = [+2.898240470668845e-02   -1.247095638299367e-01   +6.943579686241197e-02   -2.626424970132114e-02   +3.313521995129323e-02   +4.483164730975343e-01   +7.647693509930013e-02   +1.134028911371860e-01; -1.809821994822694e-01   -2.978346814958825e-02   -1.528831722259771e-01   +2.267322874341163e-01   +1.838943159417151e-01   -1.961001485061031e-01   -4.669181091458301e-01   -1.501394493857505e-01; +2.762606208573112e-02   +5.516546522694109e-02   -1.337046643781851e-01   -1.408484838696325e-01   +1.145512458794361e-02   -2.224951748354729e-01   +2.629899562363730e-01   -2.837568151737298e-02; +2.548470433011165e-01   +2.443270728321645e-01   -5.017934867946415e-02   +1.020083770520969e-01   +1.666066402560630e-01   -8.356124853123911e-02   -9.047751555132813e-02   +2.718804105451452e-01; +2.584566299001084e-01   -4.164951589889079e-02   -7.041959905209261e-02   -8.042505102636047e-02   +5.272200868289176e-02   +3.499791970301861e-01   +3.242603929153100e-02   +1.213109098809482e-01; +3.229046989445835e-01   +3.831272824186147e-01   -9.456953893614665e-03   -3.026262185371560e-01   -3.494075266262961e-01   +1.425936647391836e-01   +1.040559871280379e-01   +2.317479457438937e-01; +2.044019515663501e-01   +8.626156772593108e-02   -1.632391695170965e-01   -1.604413594951662e-01   +8.414103947850994e-02   +1.610242975801072e-01   -1.161628575790577e-01   +2.293877622515693e-01; +5.498869067924919e-03   +1.759295608450176e-01   -1.811541099673296e-01   +3.733062339320615e-01   +3.378603889479007e-01   +2.808751189625343e-01   +2.470522595736691e-01   +7.307122560642179e-02; +4.856535435942602e-01   +3.057212679892339e-01   +5.581452863950057e-01   +1.358591651613896e-01   +1.672142259414054e-01   +2.476285364997128e-01   +4.110451256599539e-02   -6.304537086723208e-02; +1.539091141284538e-01   -1.050235908374328e-01   -1.135398906803394e-01   -3.060691456147847e-02   +2.385403267967761e-01   +3.967241239811790e-02   +1.711100256541489e-01   -8.371825422870123e-02; +2.359401274399082e-01   +3.016581515277632e-01   +1.882720445933332e-01   -1.079227152979047e-01   -3.241727636832532e-01   +2.147271135713794e-01   +3.093490155133772e-01   +1.856807345533980e-01; +1.405134485125786e-01   -1.534672910741056e-01   -2.596156112982124e-01   -1.620188663275149e-01   +3.181254654156043e-02   +8.691313619997423e-02   -1.947834384271698e-01   +1.604697315379673e-01];
L2I_L3I_iGABA_netcon = [-1.494556472372133e-01   -6.134632398420253e-02   -8.328207380131303e-02   -1.780008741178211e-01   +2.835648920441002e-01   -1.147040918492829e-01   +1.177363972405532e-01   -2.987928342703280e-01; -1.095368296649145e-02   +1.497215576608199e-01   -1.357334257867517e-01   -5.954625008499678e-02   +1.797256553598112e-01   +1.746849882006685e-01   +3.574170736325174e-02   +5.167548579430786e-02; -1.284551582954566e-01   +1.759371685715111e-01   +1.089858216885246e-01   +1.237573068008064e-01   +3.521385117807335e-01   -1.437680154682739e-01   +2.940352761100056e-01   +1.932526905347811e-01; -1.092096791841620e-01   +2.569644648556731e-01   +1.256652386903321e-01   +1.111509310376662e-01   +5.009866708197049e-02   -8.226870172311787e-03   +2.644818940568394e-02   -4.490433347791083e-01; -1.734176775821717e-01   +2.607241339078392e-01   -2.882350515295374e-01   +3.453465727524667e-01   -1.047999499009672e-02   +2.556313544503683e-03   +4.288162577882463e-01   -5.434704310429526e-01; -6.846623204675129e-02   -7.785331215026782e-02   +4.289492930716531e-01   -2.849500001871607e-01   +3.687540118027115e-02   -3.328742719043379e-02   -4.140858289337926e-03   +8.137957181276553e-02; +7.320996015261250e-02   +2.749319459116989e-01   -3.511123456172623e-01   -3.733726874164283e-01   -8.196270973458208e-03   +2.580947073271654e-02   +9.623374774518381e-02   -1.653524784897687e-01; -8.788736538468830e-03   +1.454375398495835e-01   -9.012249666769147e-03   +3.143200965147305e-01   +1.755876011379351e-02   +3.577667003951582e-01   +2.358578239079564e-01   +2.943283080362893e-01; +9.638596836270512e-02   +1.715794499147796e-01   +1.343529887951436e-02   -1.480958494395966e-01   -2.413559069670747e-01   -3.242498238042387e-01   -1.489380826754545e-01   +1.710363482528078e-01; -1.405440698966310e-01   -8.413630059327018e-02   +5.005062810139467e-02   -2.231136810274493e-01   +5.956048604643586e-02   -9.902631452192670e-02   +3.797818920229625e-01   -6.001093537976186e-02; -2.404615637794550e-01   +2.288472334140795e-01   -6.814259614923823e-02   +2.507931924512119e-01   +3.182384255089147e-02   -2.156567951768135e-01   +4.932900154914747e-01   -2.488964997138315e-01; -5.041932741398140e-02   +1.884243343270618e-01   +2.515523038348925e-02   -7.358170963996459e-02   -2.533871483195231e-01   +1.491957704426540e-01   -2.291903100812225e-01   -3.556843947707942e-01];
L3I_L3E_iAMPA_netcon = [-8.843847912471274e-02   -1.539248998774191e-01   +1.140151590286065e-01   +2.312237697999093e-01   +1.537365552998471e-01   -1.108094584176994e-02   -5.967167285291063e-02   -1.658349722590667e-01   -1.770454720347275e-01   +2.733176460560373e-01   -2.873851729536330e-01   +4.918992753308307e-02; -7.830613918510579e-02   +2.187001797951742e-02   -3.171086516107977e-01   -2.394355183383899e-01   -1.563591392650077e-02   -3.377454609996026e-01   -6.104604051893679e-02   +3.920539619680550e-01   +7.315515001719433e-02   -2.612578929601314e-01   -1.209020403080440e-02   +4.354662106271198e-01; -2.038986189224486e-01   +2.196416742804385e-01   -2.092720696442965e-01   -1.747604363808132e-01   +2.426902745066325e-01   -3.082522479716548e-01   -9.259363703596896e-02   -3.379130807582562e-01   -3.179052543260526e-01   -3.438870536890850e-01   +2.931048359769482e-02   -1.361794973263697e-01; -2.220871273806559e-01   +1.983986556363656e-01   +9.012281298864525e-02   +1.492419186912773e-01   -1.348015040372363e-01   -4.675723279263679e-02   -3.113095137939867e-01   -1.324753999881015e-02   -2.508267824266127e-01   +1.039588679368084e-01   -2.095886767856062e-01   -1.978092554121296e-01; +2.194084988701668e-01   -1.102880494408725e-01   +1.854552919159457e-01   -2.563825471125868e-01   -4.099854897818881e-01   +6.583207309582650e-02   -3.039761095565601e-01   -2.093875144288295e-01   +1.295574125170028e-01   +2.905298726115665e-01   -1.930116314629362e-01   -8.990965356616351e-02; +4.544600061230995e-02   -4.085881791070898e-01   -1.559371906535550e-02   +1.438357328984093e-01   +2.793732899853490e-01   +1.342021349702508e-01   -1.566019403788318e-01   +1.033924127961223e-02   +9.775851446629592e-02   -2.929240657107183e-01   -6.174636994369653e-02   +1.967232759396139e-01; -3.711707562818163e-01   +1.373682247272420e-01   -2.916424663024770e-02   +4.624811820458154e-02   -1.159898161677319e-01   +1.374607253120197e-01   -8.908143623778753e-02   -3.918295360435576e-01   +1.986281449179011e-01   -8.020559865807911e-02   +1.568257296743194e-01   -3.013629906806516e-01; +7.968536982437775e-02   +2.224429789925973e-01   +5.795255536623772e-04   +7.923730689494835e-02   +3.250852872507674e-02   +1.319143157365183e-01   -3.956733087370067e-01   -3.633277749762814e-01   -1.843294539609159e-01   -4.362582891779640e-03   -1.817988761654446e-01   -3.908770505215362e-01; -1.672184248360122e-01   +3.730637115627868e-01   -1.721057849410512e-01   +8.732626196960266e-02   +3.021376129772623e-01   +1.632878329068076e-03   -2.446855555240635e-01   -2.021563359397699e-01   -1.637943292567606e-02   -2.389208908028705e-01   -3.463076283876358e-02   -1.249522231451616e-02; -2.947568787025590e-02   +1.471341619530478e-01   +8.989781517549306e-02   -2.048343917418367e-01   +2.474979979082272e-01   +1.596561804955612e-01   +3.326989205498736e-01   +2.266212584848162e-01   +4.559495516172650e-02   +3.040086932433213e-01   +5.657618601154529e-02   -3.105601820287436e-02; -2.984826264506377e-01   -1.711508716182540e-01   -1.952076386327373e-01   +8.872839385336789e-02   -1.939398700127717e-02   +1.610057150797636e-01   -7.797113582305641e-02   +1.942055350545496e-01   +2.685485425616806e-01   +3.240345294190458e-01   -2.908587515030054e-01   -2.059788299706625e-02; -3.469543015840879e-01   -1.342806257333849e-01   +7.558945804878441e-02   -2.001502150943300e-01   -4.297072397845790e-03   -4.711895564299600e-01   -9.906135769896257e-02   +2.077875094854432e-01   -1.287682527252181e-01   -2.004546122057428e-01   +7.305554750469007e-02   +6.140114989319176e-01];
L3E_L3I_iGABA_netcon = [+1.324859342367775e-02   +6.582096584115434e-02   +8.230964266376350e-02   -1.033839773950967e-01   +1.985266581003042e-01   +8.993380995378078e-02   -3.425261145689333e-01   -1.835748823268581e-01   +1.201499796019092e-01   +1.166588802998742e-01   +3.858649073153240e-01   -1.247904240512524e-01; -2.224747842149738e-01   +4.022821456525852e-02   +8.515049048573620e-02   +4.317642650829299e-02   +2.245268776937928e-02   -1.156836730856597e-01   +1.120528540659579e-02   -6.214518428531755e-02   -1.544264499310194e-01   +1.049740220210388e-01   -1.739958178238529e-01   +1.470541167990966e-02; +4.882884378050845e-02   -2.951127316866364e-01   +9.221770836109162e-02   -2.475718389400746e-01   +3.119228574023496e-01   +1.005272607288268e-01   +1.827700808796696e-02   -1.641923306466930e-01   +2.923646576505036e-01   +2.019350730198032e-01   +1.384788908160170e-01   +6.097546718684017e-02; +1.232011488301735e-01   -1.575285003014443e-01   +2.660687879503760e-01   -1.720420188326549e-01   -1.097207802464367e-01   -5.109961985486469e-02   -1.662415040439381e-01   +3.036994359446354e-01   -2.684360091567657e-01   +1.273763667522245e-01   -7.385730901785938e-02   +4.723097329660239e-01; +5.998016189593414e-02   +2.713165040616309e-01   -2.536672585220107e-01   -1.474436262910682e-01   -2.444550089240654e-01   -5.634886255372135e-02   +3.373576527219717e-02   -7.982430252612552e-02   -2.138537395036422e-01   -3.984891619591833e-01   -4.004317263635491e-02   -1.825709693157386e-01; -6.389357229586452e-02   -2.047742904144235e-01   +6.798522280144387e-02   +2.016264433902428e-01   -1.503029345793369e-01   -5.042560480271087e-01   -1.042470138362158e-01   +1.076237937097067e-01   -1.156481566641162e-01   -4.554251315431927e-01   +9.518041743851086e-02   -4.810124871984063e-02; -1.533158357221548e-02   +2.344658074896474e-01   -9.099999546225310e-02   -2.477145724294993e-02   +8.318765588283696e-02   -2.688949957290697e-01   -1.304424403945987e-01   +3.381654201959703e-01   +2.119052711256979e-01   -2.144631544394046e-01   -1.273973456977879e-01   -3.425721708192292e-01; +8.797913443506628e-02   -1.239156563070241e-01   +5.900189997444892e-01   +4.570672449893386e-02   -1.491004539531918e-01   +2.201827937181397e-01   -1.764699829477340e-01   +5.178743566481913e-01   +1.410231692791610e-01   -1.810116934329809e-02   -1.816497148746559e-01   -2.084343349234221e-01; -1.729952685642406e-01   +2.993056881220577e-01   +5.370997651821031e-02   +1.269792825341563e-01   +4.362064991883311e-01   +4.005040598134169e-01   +2.668411483806530e-01   +1.021582296229332e-01   -9.951641256862166e-02   +9.505650299324392e-02   -4.135684903223733e-01   -1.534530378170487e-03; +2.142423633694876e-01   -1.597065932144101e-01   -2.220768743395907e-01   +3.499758261727874e-01   -9.227507441735397e-02   +2.532467764983408e-01   -1.276350332731238e-01   -2.113686536471356e-01   -2.627232515888492e-01   +1.156786581918340e-01   -2.087794164040089e-01   -2.319037613685401e-01; -2.278294999525431e-01   +6.724110944570015e-02   -2.961147638953378e-01   +2.899145674365377e-01   +1.749454389772152e-01   +1.628035385669160e-01   -1.005078272613151e-01   +3.892192549680479e-01   -9.058242662990930e-02   +5.389377932124859e-02   +3.145692252084027e-01   +1.247350502024588e-01; +2.110363183076950e-01   +8.775749258353488e-02   -1.927278235880872e-01   -7.181967571287159e-02   +9.773116759871275e-02   +1.060923748425708e-02   +2.288466895151970e-01   -3.424003119522003e-01   -1.342022021764961e-01   +2.726238835183612e-01   +4.244154451835061e-02   -3.577847895100211e-01];
L2E_Input1_iAMPA_netcon = [-1.612701761412680e-01   +6.032552425680524e-02   +3.248738570427309e-01   +7.515565358788596e-02   +4.289407341746768e-02   +1.116311126278439e-01   +4.513532288603355e-01   -9.351335242324298e-02];
L2I_Input2_iAMPA_netcon = [+5.021311062589466e-02   +1.678925929146736e-01   +1.966054376508589e-01   +4.281623303212599e-02   +2.048914062186508e-02   -4.138483586341289e-01   -4.034139088937447e-03   -2.746972450292400e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
