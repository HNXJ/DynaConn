function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.938023640712649e-02   +4.820532396289507e-01   +8.277526989833992e-01   +6.299041912201089e-01   +5.629928520923616e-01   +8.679329137062229e-01   +4.496766253208761e-01   +1.530776048021353e-01   +1.771149471479630e-01   +3.989414948582426e-01   +5.240487582907134e-01   +1.779241514941121e-01   +3.491797587870626e-01   +6.012047690597921e-01   +3.992171723049887e-01   +6.939651776552407e-02; +3.400906265052740e-01   +1.195061518974425e-02   +4.682089431106927e-01   +5.630836323173020e-01   +2.507299493689895e-01   +2.883084461795588e-01   +8.208693636664209e-01   +8.961918338049466e-01   +6.157280645489976e-01   +1.828767027445989e-01   +8.944146512853491e-01   +1.898458084103390e-01   +1.760223312243370e-01   +2.706080374948773e-02   +4.860423328340498e-01   +2.877342774305327e-02; +6.012682995468711e-01   +6.406844779010328e-01   +7.581467304484009e-01   +4.297277280930265e-01   +1.002348795219062e-01   +7.661320854054567e-01   +7.957748333348038e-01   +3.862369667697216e-01   +4.209569125147306e-01   +3.840393909845174e-01   +4.114459749428073e-01   +1.316341948885834e-01   +6.225523129270105e-02   +1.252733632795696e-01   +7.498826553876357e-01   +5.286104181323243e-01; +8.607276540055400e-03   +2.112772763588746e-02   +4.148128060834716e-01   +5.640101525121851e-01   +1.839926916984523e-01   +7.251801797709237e-01   +4.184890814657544e-01   +8.710331993000280e-01   +4.431784168916895e-01   +2.748530192855137e-01   +8.118764336848544e-01   +8.124447255662558e-01   +1.118170176818458e-01   +8.305657433692170e-01   +2.036171503388533e-01   +2.821519110948747e-01; +4.322776692484468e-01   +5.737088293684727e-01   +5.686164081853241e-01   +6.227570723164630e-01   +3.546453525902809e-01   +7.565372596387665e-01   +4.524909400107962e-01   +2.375386190847522e-01   +5.017419186598430e-01   +7.552337362069012e-01   +3.290507105194155e-01   +6.183844891441302e-01   +2.164305963437521e-01   +2.944806762887900e-01   +8.042208445803750e-01   +1.452793593072020e-01; +4.342337877619303e-01   +1.343221250320242e-01   +7.566265965523025e-01   +1.491053922727760e-01   +5.770054043013642e-01   +2.686913981870287e-01   +4.105259319428260e-01   +1.669059066555071e-01   +4.468294682455937e-01   +4.324638116708707e-01   +6.850517702531225e-01   +2.188761128952390e-01   +4.364864290205538e-01   +4.801270708247554e-01   +4.368810184481645e-01   +6.379106575344746e-01; +2.897545632035900e-01   +6.021893829258212e-01   +8.414166975816242e-01   +5.940260937182621e-01   +3.373037274908281e-01   +5.614962464309456e-01   +3.354051034696338e-01   +7.527855120582400e-01   +8.707532042920997e-01   +3.561377119711582e-01   +1.333183778666904e-01   +1.515580685133496e-01   +3.841290213244030e-01   +8.372658836473499e-01   +4.865233968959491e-02   +2.160872498102951e-01; +5.178374558346117e-01   +3.166590126553998e-01   +6.988103479515099e-01   +5.547908928387232e-01   +5.261085896024406e-01   +1.420195951682046e-01   +7.292425773179803e-02   +3.910184920359586e-01   +6.902616285292074e-01   +6.139615993567834e-01   +2.660651670219589e-01   +6.794405644174863e-01   +2.804818219281716e-01   +9.499349003143792e-02   +6.443300064604849e-01   +5.498976300962578e-01; +1.444829175205624e-02   +6.108600377616153e-01   +6.023891036198691e-01   +6.261427987114172e-01   +7.313169589122279e-02   +8.246844485994165e-01   +4.050073044762774e-01   +3.973517158821019e-01   +4.504015038185512e-01   +4.340556859697355e-01   +1.529731335626799e-01   +8.027240082527655e-01   +8.314185580850208e-03   +6.947896376599385e-01   +3.343456824582680e-01   +4.337177487414896e-01; +6.454346894842435e-01   +1.051784399596372e-01   +8.013348623502443e-01   +7.371027263711474e-01   +5.781340021851178e-01   +1.677758991559664e-01   +7.007548273786189e-02   +1.437836215621513e-02   +6.754705435755416e-01   +3.532817173519519e-01   +9.759538142306763e-02   +4.942645437169248e-01   +7.486422580279043e-01   +2.314934181945439e-01   +7.669484055547042e-01   +5.931833478685994e-01; +3.463405977911768e-01   +4.385714185925904e-01   +4.677319555157217e-01   +7.133993535671254e-01   +8.080700549223785e-01   +1.657022940213363e-01   +5.637204575910917e-01   +5.507571170810314e-01   +2.279357550679574e-01   +2.665981282637151e-01   +6.516105814533233e-01   +8.605079215137922e-01   +1.080565397060492e-01   +6.379399880744346e-01   +6.850091328656058e-01   +1.693294508896617e-01; +4.734981127709231e-01   +2.710280238538419e-01   +8.626932843242677e-02   +3.736483996811416e-03   +8.779601403399625e-01   +8.266799649301513e-01   +4.697924256660849e-02   +6.276034418530241e-01   +6.291738340507476e-01   +2.617263447253225e-01   +9.803466129250893e-02   +2.381644756050331e-02   +8.234751210493060e-01   +6.295371970485944e-02   +4.863144531612874e-01   +3.656930254743325e-01; +5.957451157215385e-01   +6.663561014232193e-01   +7.865464739066893e-01   +1.388301047537923e-01   +6.002358629395140e-01   +6.389402280028481e-01   +6.374297977742046e-01   +5.715882766844136e-01   +8.097491619180291e-01   +3.989155760830084e-01   +3.693498016924768e-01   +7.902382226164412e-01   +7.554702382632413e-01   +6.516379651982097e-01   +4.014174953149796e-01   +8.143127669358667e-01; +7.567009192116088e-01   +5.989498349424355e-01   +2.785173551343397e-01   +5.559390169199512e-01   +1.192379105380302e-01   +2.161997466241603e-01   +5.390490799544519e-02   +2.064055888232642e-01   +3.139386809241737e-01   +6.177572202318045e-01   +1.758777327881736e-01   +7.059756359485543e-01   +5.014413964089115e-01   +5.657825849462433e-01   +3.620660114806722e-01   +2.918170219339183e-01; +3.432334979594926e-02   +4.769455238533983e-01   +7.532802885667069e-01   +4.796820251029878e-01   +2.424281487971448e-01   +1.564171713399033e-01   +2.458149224337288e-01   +3.458742500453299e-01   +2.158091129307264e-01   +8.921517372644183e-01   +3.249899384830163e-01   +5.500132318390832e-02   +1.710826923036385e-01   +6.651274528955425e-01   +2.845240537768160e-02   +6.205549568342780e-01; +7.102793107076577e-01   +3.259165392054655e-01   +1.887323049076250e-01   +8.778743905950938e-01   +9.594838391222460e-02   +1.259347348514979e-01   +8.045329207255000e-01   +1.358562576333640e-01   +5.450769414874318e-01   +6.788253538106256e-01   +5.932974507939086e-01   +1.492047577543795e-01   +6.746102940412455e-01   +7.287564558317959e-01   +8.573233873035537e-01   +8.157468873558513e-01];
L1E_L1I_iGABA_netcon = [+4.786177413963574e-01   +5.829001772697890e-01   +6.284897745513122e-02   +2.949619893827714e-01   +7.432148422727566e-01   +3.568038904598152e-01   +3.293990120940246e-01   +2.100613033885990e-01   +7.650036795972269e-02   +3.441353321291034e-01   +3.350694022790500e-01   +5.292831217872281e-01   +2.954241855250006e-01   +8.117288145096014e-01   +1.907326220423295e-01   +4.748926677039510e-01; +1.332050676928560e-01   +8.274065048697200e-01   +4.605349326528489e-01   +7.949604573642428e-01   +4.099331983336120e-01   +3.826515552793290e-01   +1.238467928981034e-01   +4.579424721127004e-01   +4.269745858944558e-01   +1.346710012182803e-01   +1.948857244068410e-01   +6.296649640359501e-01   +4.288288342141303e-01   +6.510793725586459e-01   +4.440671022469504e-01   +6.495326416896965e-01; +5.649278148408813e-01   +8.862918819512672e-01   +7.042447019736012e-01   +5.718273154321558e-01   +1.071006507153573e-01   +5.336420767682087e-01   +5.809280625465194e-01   +7.777486707347054e-01   +7.884416962012161e-01   +8.505338283191516e-01   +5.911717904127560e-01   +4.341992643860582e-01   +8.734163649981094e-01   +7.589270479924843e-01   +3.954911694981157e-01   +5.004072909305066e-01; +4.718715915820142e-02   +1.299000533849237e-01   +8.209627532843288e-01   +4.002702957794688e-02   +1.693899527096611e-01   +6.496352700086951e-01   +6.480903537571424e-01   +5.046203595332280e-01   +4.512802945195516e-01   +8.673247421132907e-01   +5.761734871087466e-01   +7.103870856832024e-02   +3.225915441697245e-01   +1.640605266481157e-01   +9.125151269868499e-02   +8.779785125072037e-01; +1.691477054106299e-02   +7.902943264850181e-01   +4.647609545276896e-01   +7.983713393599635e-02   +3.809359504205266e-01   +7.708151605359822e-01   +6.339543534478955e-01   +3.440038826762625e-01   +4.620726179178419e-04   +1.467301179663198e-01   +6.501734999860804e-01   +1.148213969937397e-01   +7.366428165007154e-01   +4.220872940335388e-01   +6.037828111506733e-01   +4.956585545330826e-01; +7.031283921244995e-01   +8.470210006577643e-01   +1.407135744134156e-01   +6.102101360042712e-01   +3.259875801700964e-01   +5.385295158665265e-03   +6.200417771962573e-01   +2.645127886919201e-01   +7.397251729359275e-01   +1.561605451157149e-01   +8.511817728380388e-01   +1.206193406920828e-01   +3.483554005012464e-01   +1.192997645765397e-01   +4.756447844296419e-01   +1.288807674840055e-01; +4.459291641064406e-01   +2.047316853881509e-01   +1.202508292407830e-01   +2.311803239913068e-01   +1.679365342867367e-01   +3.441841559960061e-01   +2.623372508331384e-01   +4.831566528899198e-01   +7.954694639985349e-01   +1.397102984286368e-01   +6.750495228645386e-01   +8.953203520778099e-01   +8.989440890419363e-01   +4.687748149869129e-01   +4.667509418076086e-01   +2.720925008231004e-01; +2.556132755038972e-01   +1.946868844617641e-01   +1.717166257360198e-02   +1.436480606702791e-01   +6.517417763351697e-01   +4.681725599614610e-01   +4.451415993740058e-01   +5.642845052477955e-01   +1.744777056078581e-01   +3.751072406762064e-01   +7.371047746078999e-01   +8.565817035143392e-01   +4.712370923232522e-01   +4.084184813112690e-01   +1.574810752812183e-01   +6.280878729577496e-01; +2.642564085745804e-01   +5.428125997286779e-01   +2.671927424996704e-01   +2.062004645555421e-02   +1.621062337318442e-01   +6.345844685702667e-01   +7.218234078808590e-01   +8.155877418538305e-01   +3.408013311716695e-01   +9.664406013567209e-02   +6.884577675002423e-01   +3.187287292876622e-01   +7.990831922612414e-01   +8.363230567886751e-01   +5.410205103047201e-01   +6.196417331903421e-02; +4.845789542643318e-02   +3.683294490500117e-01   +1.342204110350192e-01   +5.213908056942741e-01   +3.671169800233203e-01   +7.431202238015434e-01   +2.836276487761579e-01   +2.061342043624990e-01   +8.453616578054566e-01   +6.904012832671973e-01   +2.074373727962319e-01   +5.538170553285541e-01   +6.930199915924324e-01   +1.706146103767413e-01   +6.952107612057674e-01   +1.979370789031608e-01; +7.828131474842369e-01   +7.905737912922885e-02   +2.696912869281665e-01   +3.601530624885729e-01   +4.731247818284344e-01   +5.921995700370182e-01   +4.112837723435019e-01   +8.617838034277171e-01   +2.892137553890213e-01   +3.698625877352552e-01   +5.186002606906912e-01   +4.297766271965380e-01   +2.315838604807209e-01   +8.820150717015586e-01   +7.988858336121126e-01   +3.044964099760077e-01; +1.673911794821171e-01   +8.153124744224990e-01   +5.044443802661127e-01   +8.295922105466406e-01   +8.925216315475295e-01   +6.087792402546574e-01   +4.177391589156411e-01   +1.315174058043709e-01   +6.550895740872849e-01   +4.098318666783076e-01   +3.140121286399581e-01   +7.453885431096173e-01   +6.095176795920167e-01   +4.501401474313642e-01   +7.116419036409445e-01   +2.269583854068964e-01; +6.592766095717528e-01   +8.483452416368492e-02   +4.715829812444722e-01   +1.057252449542861e-01   +4.880644401376253e-01   +5.117759519223767e-01   +5.314448357691435e-01   +1.860642073272424e-01   +6.738427854357255e-01   +7.950280087860584e-01   +1.536685616795405e-01   +7.006429927531210e-01   +8.694260269671090e-01   +5.571687045122108e-01   +3.303866846236454e-01   +1.175273321925524e-01; +2.284472428212685e-01   +2.283573733237735e-01   +2.119711687800923e-01   +8.637853037708682e-02   +1.644919796324041e-01   +7.800599138421084e-01   +8.321515380034495e-01   +6.787639976147966e-01   +3.825884436097378e-01   +5.900346959126230e-01   +8.829530327720790e-01   +6.627233105506884e-01   +5.585287766908376e-01   +7.883015026322301e-01   +5.799685291796982e-01   +6.632210314605387e-01; +3.918117070367079e-01   +1.481579352682545e-01   +3.972928598322625e-01   +7.907723244939121e-01   +5.773856424169445e-01   +4.606419921812241e-01   +9.717500282995944e-02   +3.096477897424283e-01   +1.504936942719156e-01   +4.596817342824143e-01   +2.411380394084220e-01   +4.001407069039216e-01   +3.443565567878263e-01   +2.120441434160559e-01   +1.571446305524805e-01   +2.759962064054289e-01; +3.977619172732832e-01   +6.676684778458157e-02   +1.734935523847451e-01   +8.404641594194689e-01   +8.381328352900813e-01   +6.829159445349518e-02   +1.735680457331606e-01   +7.298696784982074e-01   +7.201496626645836e-01   +1.237912773254595e-01   +4.865683649418256e-02   +5.606392580271055e-01   +5.889933014034798e-01   +4.690600142277509e-01   +3.658339161404834e-01   +4.077843339507745e-01];
L2I_L1I_iGABA_netcon = [+8.788288041790868e-01   +4.350343477865233e-01   +2.552125982304753e-01   +7.848661462656270e-01   +8.419332146343219e-01   +8.354889093289442e-01   +3.263112960859580e-01   +7.136348426862251e-01; +7.081323352360042e-01   +7.789552194560067e-01   +6.364971029321013e-01   +2.529288069312839e-01   +3.857008291997248e-01   +6.063330517602390e-01   +8.127154806679536e-01   +1.946761802141074e-01; +1.879879038687421e-01   +2.186325171843583e-01   +2.410574450215905e-01   +3.186767513585270e-02   +7.123619070061118e-01   +8.675521597395855e-01   +9.698386959957044e-02   +5.524615404980987e-01; +3.446053607206476e-01   +7.078999310165390e-01   +6.058024986462660e-01   +5.529463131782544e-01   +5.372767225699997e-01   +5.499174660147985e-01   +4.404999835190110e-01   +7.217364977455971e-01; +2.823090978701354e-01   +1.649192783809951e-01   +5.379960752245989e-01   +5.066786004158655e-01   +3.958180897149364e-01   +6.974533453254024e-01   +4.464295740172101e-01   +5.365490623752726e-01; +7.095871988737619e-01   +6.488173256960570e-01   +8.152373385537075e-01   +3.676955700484137e-01   +2.651708115937898e-01   +6.313441239641034e-01   +7.835226162396843e-03   +6.116458155176573e-01; +1.329416820164549e-01   +3.254131926495537e-01   +3.457865232265928e-01   +2.082582749335034e-01   +6.251844685403298e-01   +2.454173306346984e-01   +2.042188415375568e-01   +6.075367182684926e-01; +5.264384188399739e-01   +3.051329737432701e-01   +7.032401856652426e-01   +3.512962360377835e-01   +2.462362791191904e-01   +6.196495863977901e-01   +4.028873285980115e-01   +2.755345548728174e-01; +3.620256302943980e-01   +6.400357827806783e-01   +1.776553147565781e-01   +2.134578049035199e-01   +2.848613070875559e-01   +1.471642002358967e-01   +3.722226265602830e-01   +8.613655902923787e-01; +4.781448509952013e-01   +6.141250771745664e-01   +1.843147153362033e-01   +4.906064928268272e-01   +1.871664508987265e-02   +6.298811317075943e-01   +8.091564730752614e-01   +6.246594258269669e-01; +4.595986214661374e-01   +7.037710091729469e-01   +7.568990037121502e-01   +3.318497815738082e-01   +6.398787858231059e-01   +8.782053145552160e-01   +1.661428501477904e-01   +2.493908707224191e-01; +7.127782731194762e-01   +4.713780714306864e-01   +5.585904395827260e-01   +3.761518861783791e-01   +8.717792456259151e-01   +2.458032295640458e-01   +5.637092613410529e-01   +2.935395789102705e-01; +2.777196532310670e-01   +8.594980075400810e-01   +8.236710921011802e-01   +1.826465925397883e-01   +5.036358874536488e-01   +2.687838306694062e-01   +2.814522726404405e-01   +4.483713577457197e-01; +6.253999418836533e-01   +2.285235261438935e-01   +8.867945530241537e-01   +4.684487200957440e-01   +7.428089598483192e-01   +1.660291267476697e-01   +8.722788152571145e-01   +1.937149242652742e-01; +8.611158674031363e-01   +1.943462071194344e-01   +2.458687038766871e-01   +8.119649159079544e-01   +5.834977798694372e-01   +1.293493849373832e-01   +3.531791775301905e-01   +6.205949384387457e-01; +1.635010042673522e-01   +6.185570729159559e-01   +6.491500067879727e-01   +5.546501948469820e-01   +7.401761530213937e-01   +1.123742454447223e-01   +8.780659692946584e-01   +2.728528894810034e-01];
L1I_L2I_iGABA_netcon = [+5.107475294592004e-01   +6.143960542942616e-01   +2.764043807752793e-01   +6.753526480457771e-02   +4.544120038190805e-01   +3.543951313596591e-01   +8.791318471742281e-01   +6.180127840375853e-01   +3.650931123977725e-01   +7.024951297316467e-01   +1.351751367802371e-01   +2.763769833472898e-01   +1.154653916347783e-01   +6.786979818798821e-03   +1.858036117372104e-01   +7.081673438644941e-01; +7.177658793574615e-01   +5.323828963581555e-01   +3.387178633418954e-01   +4.108158132272479e-01   +8.309942570816198e-01   +4.063167644904097e-01   +6.022504165912177e-01   +8.631060426202226e-01   +3.913652559662393e-01   +8.888984190621415e-01   +5.928438375896472e-01   +3.133873393354050e-01   +4.425971454069758e-01   +5.546787428001850e-02   +3.192299326651763e-02   +7.917911123327080e-01; +7.607118197286669e-01   +5.244897666442011e-01   +1.960981591525255e-01   +7.354807957396319e-01   +2.960448437005521e-01   +7.792193381695289e-01   +6.798499417538939e-01   +5.906915431776016e-01   +3.413870201050085e-01   +3.217675271214652e-01   +6.093818050054222e-01   +3.563920658185131e-01   +2.988171831736146e-01   +1.474518051947585e-01   +5.497826405951535e-01   +1.149662733310054e-01; +3.791534148636329e-01   +4.844828877451070e-02   +5.350559591049638e-01   +7.779424557266225e-01   +9.523919142414125e-02   +2.404612451071778e-03   +3.178538786065033e-01   +3.017359856771733e-01   +5.385642649340994e-02   +5.755450214954951e-01   +4.970204909256781e-01   +4.237038514830767e-01   +2.242701002477246e-01   +4.642307018311801e-02   +7.118055512525190e-01   +4.697515611804025e-01; +7.230653130482508e-02   +7.321579985494616e-01   +7.091193658386327e-01   +5.997072646505058e-01   +5.605091066811752e-01   +4.390032079351006e-01   +5.744542487815734e-01   +7.475742226922681e-01   +5.559469340880536e-01   +1.646049351443965e-02   +2.797249731164390e-01   +1.908550407071460e-02   +2.226762051880397e-01   +7.824644073903803e-01   +1.814071544357139e-01   +4.199258950371219e-01; +5.695934614009213e-01   +6.350542340460513e-01   +1.169412181861790e-01   +8.044847227496502e-01   +4.991400775051699e-01   +8.630629036809150e-01   +6.533862625091731e-01   +7.367170968892969e-01   +4.931546868888111e-01   +5.236023588002093e-01   +8.955737346271541e-01   +7.381366653958525e-01   +1.201379497874324e-01   +8.138224598816163e-01   +6.366311430219120e-01   +8.157264538269615e-01; +6.938618318803662e-01   +1.356174179020339e-01   +7.695411129119644e-01   +8.865435763353428e-01   +3.433659180357795e-01   +8.793794834582842e-01   +4.564190128209069e-01   +4.278330692990173e-01   +1.314884488581383e-02   +5.267062317427874e-01   +2.762997970001134e-01   +3.144470629570273e-01   +6.945966293068954e-01   +3.728872373509781e-01   +7.556602395433907e-01   +5.104145508911682e-01; +6.639860576134821e-01   +9.895223607030564e-02   +8.094194861916298e-01   +6.436400505343787e-01   +1.034981244991417e-01   +7.122772504768115e-01   +5.312244848844604e-01   +6.902620258901315e-01   +3.282696579747166e-01   +7.584423798726034e-01   +2.374575462066848e-01   +4.427704503368911e-01   +4.467704307509103e-01   +6.870158253629881e-02   +8.327470468679284e-01   +3.421167890082348e-03];
L2E_L1E_iAMPA_netcon = [+6.985358171928056e-01   +2.566661653490022e-01   +1.286077129684519e-01   +8.804750483942339e-01   +1.047633316399436e-02   +4.370114411723022e-01   +5.965955359298790e-01   +7.381767272423367e-02; +8.286106929491646e-01   +7.855526281282417e-01   +4.797924672972648e-01   +3.299788936391516e-01   +4.527326675876999e-01   +1.597966549007118e-01   +8.204221695198255e-01   +3.590958984897758e-01; +7.739595644485292e-02   +1.179457785469897e-01   +2.958358676525694e-01   +1.408655510862290e-01   +5.590743322174191e-01   +7.640104051098798e-01   +2.990351959020221e-01   +2.824775140230512e-01; +2.329657009075307e-01   +6.505746719620021e-01   +1.921462173073037e-01   +5.843114285138381e-01   +6.776929827807070e-01   +2.814570960703585e-01   +7.886628101389807e-01   +7.455112506503166e-01; +1.779636882927516e-01   +8.902905387514973e-01   +1.250589645332852e-01   +2.650189807081059e-02   +8.471127973093679e-01   +8.566377559717089e-01   +6.079085512798971e-01   +4.235548224803060e-01; +6.260758344614225e-01   +4.624641251176623e-01   +8.605574703952906e-01   +6.983318579229105e-01   +6.279948037017163e-01   +2.012317235377799e-01   +7.162088495711492e-01   +6.219291972982253e-01; +9.369272808081520e-02   +3.000207440673833e-01   +2.642602461351600e-01   +4.090613276019107e-01   +8.326498895909893e-01   +4.147264200533122e-01   +1.420222239400619e-01   +3.068024670939844e-01; +6.025571754940397e-02   +1.101530054595842e-01   +4.742965033350950e-01   +6.073874285702753e-01   +3.607235313430489e-01   +8.128556568666078e-01   +8.756126024665388e-01   +8.199859686462961e-01; +3.192840215790666e-01   +7.928759968879326e-01   +3.719321581104052e-02   +2.428125538512028e-01   +1.440247295934483e-01   +8.662459511746583e-01   +4.721544523858676e-01   +6.031513287821744e-02; +2.691209751111065e-01   +2.532871326499024e-01   +7.756237552138913e-01   +3.678824285999190e-01   +7.355751174471505e-01   +7.847039944863470e-02   +1.122561199351450e-01   +8.646953257215034e-01; +5.084895565667692e-01   +4.252811833931709e-01   +1.643015213633613e-01   +5.496659870777492e-01   +3.715555047290597e-01   +3.700147692241117e-01   +5.244738988892647e-01   +8.082212256193512e-01; +2.390884235424731e-01   +4.108785381980597e-01   +7.367426376473681e-01   +6.554682097453832e-01   +5.762529186346486e-01   +1.754008794624987e-01   +8.965891588837426e-01   +2.069564741604312e-01; +5.382014095484842e-01   +7.454474925888074e-01   +2.186515421528348e-01   +5.490126037921712e-02   +8.805616209290258e-01   +6.049049867653294e-01   +4.151045783441316e-01   +7.231291979465490e-01; +3.769204361904935e-01   +4.624368749424136e-02   +1.033640007352535e-01   +6.009479450097851e-01   +8.344039155634499e-02   +2.702914841521679e-01   +7.048935530188327e-02   +6.585522461555321e-01; +2.569949966028695e-01   +1.878297386469303e-01   +5.919362554747283e-02   +6.845405663167263e-01   +1.044871689938559e-01   +8.362189909686249e-02   +3.737282325622645e-01   +2.113398130317208e-01; +1.343339241976220e-01   +3.950472675192439e-01   +1.254152915030669e-01   +4.865449857005280e-01   +2.256492258673065e-01   +4.967362703924021e-01   +9.630583830862237e-02   +7.381175609999682e-01];
L1E_L2E_iAMPA_netcon = [+3.305623160936155e-01   +1.429422760865022e-01   +8.348169756795967e-01   +8.723784475128793e-01   +2.954897216876085e-01   +8.485276315424665e-01   +4.526081836665373e-01   +8.894856367353301e-01   +1.221601400337195e-01   +5.871091633217511e-01   +5.775064971232340e-01   +6.827655189121926e-01   +3.401742540216475e-01   +6.136223801472134e-01   +5.046106315633309e-01   +4.431713739508811e-01; +3.552879136213494e-01   +4.664988588877545e-01   +1.943412425074506e-01   +7.917755766929932e-02   +5.975899147575062e-02   +6.168365336144782e-01   +7.958332084987223e-02   +2.803634828542516e-01   +1.852614713963517e-01   +2.829025863805432e-01   +2.444758850948794e-01   +8.526132127056260e-01   +1.264660265263704e-01   +2.593429091258631e-01   +5.306861463026120e-01   +2.162178543953735e-01; +2.913035655897289e-01   +5.402980286976548e-01   +8.106644009751458e-01   +8.305618011715412e-01   +8.500439654107913e-01   +1.006944769000364e-01   +2.588210185190692e-01   +4.788431443379104e-02   +3.962384569668705e-01   +5.157625265445028e-01   +3.067168739238787e-01   +9.535403156237766e-02   +6.815918727017151e-01   +5.423140581624974e-01   +8.027120474392011e-01   +6.902921564985287e-02; +7.083771453776637e-01   +2.887214300289775e-02   +2.072167494647422e-01   +1.961621711635458e-01   +6.618800260678457e-01   +2.878180254308225e-01   +8.165912927669118e-01   +8.068124025379634e-01   +7.015397200938370e-01   +6.848451684281933e-01   +4.191008785474535e-01   +5.041357067761834e-01   +8.434639481608049e-01   +2.999455584081427e-01   +8.204231349219377e-01   +8.783068746230028e-01; +1.155460282448385e-01   +7.699036029955164e-01   +7.835635831696615e-01   +2.911169785815011e-02   +1.424348440183346e-01   +7.252995442130444e-01   +8.441123637411960e-01   +1.678784959148569e-01   +5.099396831789370e-01   +3.751098508921956e-01   +4.960730494197063e-01   +6.957531207070770e-01   +2.148348434366577e-01   +4.714460912165024e-01   +8.909591550842064e-01   +4.184818851955917e-02; +2.867275248472310e-02   +7.564697776177567e-01   +2.340394974998353e-01   +7.297835680683349e-01   +8.644064679459164e-01   +7.607113993288324e-01   +4.687607850573475e-01   +8.420601496718320e-01   +2.923596916463819e-01   +3.621049996152830e-01   +7.605252807087498e-01   +8.276215771634640e-01   +7.672932341221725e-01   +5.603505396984816e-01   +1.728135996133452e-01   +5.211483621616658e-01; +2.859072205989498e-01   +2.021566361283067e-01   +5.267880397601782e-01   +6.898885044057815e-04   +3.461131130863553e-01   +4.722166475970210e-01   +6.740315335305990e-01   +5.337892953836618e-01   +5.269632259680118e-01   +7.069747589015695e-01   +5.662804632382208e-01   +9.450088737271482e-02   +3.244679800651786e-01   +4.907371022989764e-01   +2.174694123075366e-01   +3.157308152334518e-01; +7.733610651337298e-02   +4.943462543468229e-01   +4.410738162759730e-01   +3.558571815738170e-01   +6.544028561424992e-01   +8.658039848682144e-01   +8.905066994187817e-01   +5.699778821848787e-01   +7.916266593365018e-01   +3.583505452281903e-01   +3.123073553300137e-01   +8.874255080874994e-01   +5.992347198137197e-01   +8.132525574283769e-01   +3.007189473874077e-01   +9.447695924628978e-02];
L2I_L2E_iAMPA_netcon = [+5.621930321237338e-01   +2.105016182726724e-01   +8.067679865928742e-01   +4.302156953116653e-01   +6.999027990924183e-01   +4.392634128590665e-02   +7.274717758942731e-03   +8.091602880006998e-01; +1.390743519101179e-01   +1.132815981831007e-01   +1.442038271601594e-01   +7.733053151949206e-01   +6.836248667414160e-01   +3.581065293670171e-01   +6.304973172386987e-01   +4.294615371328990e-01; +7.606396491470234e-01   +6.745673127787162e-01   +7.513402284785714e-01   +6.708020233041018e-01   +4.704146227610219e-01   +4.631873127984225e-01   +4.571389319024016e-01   +6.376558570234582e-01; +3.594929185940360e-01   +1.585246394745609e-01   +7.962497078600700e-01   +3.843892087112290e-01   +8.615284055719906e-01   +1.414745104594966e-01   +4.180092933547113e-01   +7.742595754036604e-01; +6.382023668997281e-01   +7.792098769122440e-01   +5.741372361784338e-01   +5.495685762371729e-01   +8.333676673565855e-01   +6.719664034260474e-01   +3.761066140406841e-01   +6.703938033899882e-01; +5.417907033758395e-01   +3.397746356518656e-02   +8.056043580748303e-01   +6.716897611628818e-01   +4.869317761037646e-01   +1.607896496604756e-01   +9.483571592355561e-02   +6.642877041810522e-01; +8.569628769945730e-01   +4.088045410034277e-01   +1.486444425021576e-01   +4.310420945267091e-02   +1.279442715122784e-01   +2.000201336778262e-01   +1.327399920522365e-01   +1.611778096789595e-01; +8.203122539980531e-01   +3.150019474049643e-01   +4.993794400116562e-01   +4.439098461288383e-01   +7.857949684580104e-01   +2.173256796515149e-01   +1.164808004096951e-01   +1.924264617738168e-02];
L2E_L2I_iGABA_netcon = [+8.332962987132804e-01   +2.124131625207579e-01   +1.877561258426241e-01   +1.707487267586256e-01   +5.978009392882575e-01   +3.333074493684541e-01   +7.399919208609964e-01   +8.521325365146381e-01; +2.271866456307854e-01   +3.880949297715612e-01   +1.112029190990440e-01   +1.448211948561590e-02   +8.908271796788679e-01   +6.300621093146095e-01   +6.884022357620950e-01   +6.240385593393557e-02; +5.896973996443997e-01   +3.238944843015558e-01   +4.980719177184058e-01   +4.242630077647551e-02   +3.521979160704146e-01   +6.925008416163521e-02   +8.894361649988047e-01   +7.490230201517065e-01; +7.773315630178508e-01   +6.257146189255305e-02   +2.309689111173212e-01   +6.645586832243503e-01   +8.267412298547341e-01   +5.827929904839858e-01   +3.876513639410216e-01   +5.963996749218595e-01; +1.429747104898876e-01   +8.153489836175922e-01   +5.495267707643322e-02   +7.614108060362029e-01   +2.750958283342593e-01   +3.284091100158140e-01   +3.748537469298530e-02   +2.445072093763798e-01; +6.748837586082373e-01   +1.517550581083696e-02   +4.912976125905072e-01   +7.145699917961115e-01   +7.951124394668591e-01   +2.365078327638842e-01   +8.580162024941540e-01   +7.051741310859635e-01; +1.445180920093423e-01   +8.784379169361318e-01   +2.560634615543613e-01   +2.569922530691957e-02   +6.485003586443634e-01   +4.693576260168600e-01   +5.418129346569969e-01   +5.579998133363052e-01; +7.806963764539601e-01   +2.813677949390552e-01   +4.456486855353335e-01   +1.857988141572892e-01   +4.239541300022188e-01   +7.056941626719763e-01   +8.544272583854235e-01   +5.443990647940237e-01];
L3E_L2E_iAMPA_netcon = [+3.163349369670877e-01   +5.693559789917761e-01   +1.410510469232251e-01   +7.521286649180009e-02   +6.455314844787020e-03   +8.788469554730343e-01   +3.533520790150138e-01   +7.789670341151016e-01   +1.088168847150264e-01   +2.650956026610342e-01   +2.615311386279053e-01   +4.521811274909841e-02; +2.389807922162984e-01   +8.021864934302351e-01   +2.619100207990574e-01   +3.339383609804831e-01   +4.146972039850555e-01   +5.060410155590772e-01   +8.256194887414402e-01   +8.886127955783096e-01   +5.049026929195198e-01   +8.685844471427420e-01   +3.195293598845888e-01   +2.334041358478185e-01; +8.610811895593067e-02   +6.645410474489428e-01   +9.263781160297931e-02   +6.617467326068797e-01   +9.798282379636007e-04   +1.105811521483045e-03   +4.884160313181752e-01   +8.861214843467375e-01   +5.291898943629862e-01   +5.498690238394297e-01   +2.227532841324207e-01   +6.403368040258672e-01; +2.682432358822038e-02   +1.832123141256031e-01   +7.305411979364271e-01   +2.366586249340071e-01   +2.453376994911268e-01   +1.382120021626018e-02   +3.007987279965386e-01   +5.952606904480853e-02   +1.917578539332276e-01   +2.837488696912350e-01   +1.797154427850844e-01   +2.981634090759044e-01; +8.141398721883196e-01   +3.348947506723972e-01   +3.051598480063887e-01   +8.890309674059853e-01   +6.063661944205740e-01   +3.328459757683064e-01   +8.783535743993637e-01   +1.506705813485854e-01   +7.571903191781049e-01   +4.364698777707615e-01   +6.168624379644020e-01   +3.636026457928808e-01; +7.973839496277232e-01   +5.331588501109956e-01   +9.869796088224429e-02   +4.454704452018768e-01   +5.715463782771731e-01   +8.157386523873710e-01   +8.018903110500970e-01   +3.446027071624503e-01   +4.185079032194005e-01   +1.752108446755566e-02   +5.704311849958865e-01   +2.303417119175087e-01; +5.625794904780962e-01   +4.625950412231592e-01   +5.643992253788988e-01   +1.876718374608928e-01   +5.213614279638876e-02   +3.250289609474399e-01   +7.708752735087575e-03   +3.101964068336370e-01   +2.569535939841964e-01   +9.956820311269775e-02   +6.198634149227072e-03   +4.217975870415949e-01; +7.612488402355453e-01   +8.908606498020447e-02   +7.714013410745056e-03   +2.373412671906847e-01   +5.002839730585434e-01   +8.153196578162973e-02   +2.692893616116340e-02   +4.401912876722099e-01   +4.468491026295269e-01   +7.753272690223867e-01   +7.866112402786292e-02   +5.544590676705302e-01];
L3I_L2I_iGABA_netcon = [+8.802705015152918e-01   +4.513422805120891e-01   +5.861660032634450e-01   +2.479686859752835e-01   +8.525950020721179e-01   +4.028130420894613e-01   +4.500169292660254e-02   +1.917511360353866e-02   +7.826052638059515e-01   +4.037967599664747e-01   +7.754822420489749e-02   +6.682049391054677e-01; +8.087580962801802e-01   +8.680037460040797e-01   +8.033352503732509e-01   +1.471240680053193e-01   +4.658366381919496e-01   +7.552094266674193e-01   +5.326646398947891e-02   +1.875486130296076e-01   +4.453991070189074e-01   +5.962228529993439e-01   +1.091364194509926e-01   +5.804537960513344e-01; +9.086226346475983e-02   +7.714322509453196e-01   +8.069222950324318e-01   +1.065498795774007e-02   +6.426815217055025e-01   +3.925775650725724e-04   +5.577415962156043e-01   +8.330976471605869e-01   +6.506643370376298e-01   +1.834099928911540e-02   +5.260942431392598e-01   +1.001103199586704e-01; +8.604217656899287e-01   +2.270270962097675e-02   +3.313812409932432e-02   +5.874052568359225e-01   +8.069205683749547e-01   +4.998858926234369e-01   +3.457619749276598e-02   +1.864318444346302e-02   +7.796580435877176e-01   +7.408843737925815e-01   +8.948040757806252e-01   +4.954580040915950e-01; +1.420059840494074e-01   +8.635572480460670e-01   +3.699353888836870e-01   +3.836585330897173e-01   +5.098104153786869e-01   +8.303703708859159e-01   +3.502944494447110e-01   +1.539139712869027e-01   +8.994021458729415e-01   +4.460437484249652e-01   +2.001139776866879e-01   +1.520499314360529e-01; +3.026295225590621e-02   +6.156887465522952e-01   +1.909598013103109e-01   +1.298745184561545e-02   +1.506750545343519e-01   +5.824092981664541e-01   +6.243758761283924e-01   +2.124768347201803e-01   +4.668851522836740e-02   +6.851190606916836e-01   +7.752861828797116e-01   +7.483627052766642e-02; +5.687552052251903e-01   +7.909200334786000e-01   +5.219725901316862e-01   +5.826915952531716e-01   +4.047973500281392e-01   +2.776142256393334e-01   +6.346995838903329e-01   +7.937677324133977e-03   +7.463382242891334e-01   +3.429722666554058e-01   +4.562195432419838e-01   +6.518351823533144e-01; +4.424561759360788e-01   +1.884325710208764e-01   +2.768656076075622e-01   +5.217425525066175e-01   +3.175365108273497e-01   +1.270615320469274e-01   +2.012055981669405e-01   +2.434144017856828e-01   +4.927683340177867e-01   +8.849715245362700e-01   +2.490940496990383e-01   +2.672600991883645e-01];
L2E_L3E_iAMPA_netcon = [+6.050568905630432e-01   +5.966823567074696e-01   +2.095241997228020e-01   +7.834598010343686e-01   +4.552022540836906e-02   +4.645735385369542e-01   +6.084743172861867e-01   +8.410651057032438e-01; +4.808344780686131e-01   +6.603171289260545e-01   +6.628888790989206e-01   +7.231111271505120e-01   +9.391659701766959e-02   +4.450323913450428e-01   +7.697197805101590e-01   +6.214988611730852e-01; +7.682256701492729e-01   +7.920166563361253e-01   +7.616987292517807e-01   +8.171879363016552e-01   +5.265007349013604e-01   +5.869737643405498e-01   +7.823775525150168e-01   +5.191263686016482e-01; +3.697485496857358e-01   +8.579560430266678e-01   +7.690099176241307e-01   +5.485612107746098e-01   +4.658911783615305e-01   +4.457471342911499e-01   +2.578683669651377e-01   +1.652036634684833e-01; +1.319630700800274e-01   +4.919083384304658e-01   +2.241117498151198e-01   +7.132149761922522e-02   +1.608575771356526e-01   +4.947670330669980e-01   +8.015315245741439e-01   +6.842574150211664e-01; +4.515564317000935e-01   +8.807357841789679e-01   +7.986484168200952e-01   +4.859880288459916e-01   +4.636377542455938e-01   +8.848663601077565e-01   +6.467052716258812e-01   +8.816889844041995e-01; +4.367821424948484e-01   +8.842878193605544e-02   +4.840049133607034e-01   +2.157277513440546e-02   +3.197089460941323e-01   +7.361584734085641e-01   +3.137255623249204e-01   +6.999941685639698e-01; +8.427474037324412e-01   +6.224030067102004e-01   +3.861200673890213e-01   +7.020777615923876e-01   +3.168392977628555e-01   +6.958081417431277e-01   +4.634175011370161e-01   +3.922894307861593e-01; +4.176663642419237e-01   +4.917568574744670e-01   +7.939671968019880e-01   +5.672082714414048e-01   +5.149420439836081e-01   +3.119272962159552e-01   +5.461916992924211e-01   +5.894009275335915e-01; +2.511672271654316e-01   +1.427980436237328e-01   +7.019023503332633e-01   +7.903798017185378e-01   +8.120543978064358e-01   +2.267728312915461e-02   +1.150762158829476e-01   +5.881338276370571e-01; +5.187280541275531e-01   +2.884928138534251e-01   +6.622239512722768e-01   +7.310373011040749e-01   +8.418853392748968e-01   +8.597640422199202e-01   +2.397811979250630e-01   +3.361008904767289e-01; +8.140873559957906e-02   +5.232554497976277e-01   +3.738786347650163e-01   +7.776777372323357e-01   +4.414488919187267e-01   +1.814489158127722e-01   +5.948076875413487e-01   +7.666768732922583e-01];
L2I_L3I_iGABA_netcon = [+8.514347125240018e-01   +3.597728539326150e-01   +2.528277611412652e-01   +6.311676795432739e-01   +6.604443197397959e-01   +7.580800004145217e-01   +3.788356157878060e-02   +4.643927722065505e-01; +5.001135124226698e-01   +4.287562410728483e-01   +6.395238871364963e-01   +1.515844044627902e-01   +7.958341567295683e-01   +7.403373990400399e-01   +4.220301789408856e-01   +2.286932330883049e-01; +7.084303935046988e-01   +6.594156590034885e-01   +8.460652647817504e-01   +5.669814803991893e-01   +3.240765851910998e-01   +5.515137721503552e-01   +3.613793169658409e-01   +1.555726852225998e-01; +1.954610431510332e-01   +7.529504328767256e-01   +1.916832958513209e-01   +4.471444475121786e-01   +2.796357829711132e-02   +3.276226181136518e-01   +3.337499784118308e-01   +8.820007029966666e-01; +2.770216071511596e-01   +3.463812667309776e-01   +4.748634593316561e-01   +4.320464294921554e-01   +3.216581039909918e-01   +5.876927127129810e-01   +9.033790108748248e-02   +1.129486973976608e-01; +7.141401288215925e-03   +2.271894180200206e-01   +3.908953139640087e-01   +1.626014266860467e-01   +3.262858731700778e-01   +3.567611191374605e-01   +4.752667493415964e-01   +6.369208067868509e-01; +3.175849537314983e-01   +4.303602106907263e-01   +8.454830996838474e-01   +5.743900791625063e-01   +6.561375090073978e-01   +2.736618945471798e-01   +2.894569974344980e-01   +2.730644675009850e-01; +3.211077132472129e-02   +8.905056468957779e-01   +2.785906869975001e-01   +7.914752097315227e-01   +6.077960652958723e-03   +6.807206835503554e-01   +5.119664053375056e-01   +6.799631064773614e-01; +7.930551342539029e-01   +2.623458702075331e-01   +7.536925432408207e-01   +6.217757268141774e-02   +4.474991741095609e-01   +2.361378355559393e-01   +3.710001585765250e-01   +4.049282383825571e-01; +6.992262331138560e-01   +4.425957968599240e-01   +2.233482172465765e-01   +4.498387860972076e-01   +5.600843937726107e-01   +3.074303264867182e-01   +1.896187806003884e-01   +2.773504434287813e-01; +6.477597271332814e-01   +8.704933934588261e-01   +4.856626322321571e-01   +6.197228263732589e-01   +2.601356815180925e-01   +3.158425868426777e-01   +8.489928220783294e-01   +1.117959164172557e-01; +6.866762262389554e-01   +7.124247799579438e-03   +3.026504118201479e-01   +1.341664954522684e-01   +1.304032269215866e-01   +8.707997280303194e-01   +4.381945470526873e-01   +4.944147702174435e-01];
L3I_L3E_iAMPA_netcon = [+4.017457341121569e-01   +8.967542798006759e-01   +2.507839461660281e-01   +5.545327872994817e-01   +7.021450378299412e-01   +2.875975480297927e-01   +2.646695646552258e-01   +2.031333769188213e-01   +2.980692237655170e-01   +2.578220470768486e-01   +2.418396270805812e-01   +4.280614611517110e-02; +3.621796535384206e-01   +7.719912821855044e-01   +2.004898625980375e-01   +1.211824831070079e-01   +7.129716512872941e-02   +4.864569836126616e-01   +5.045080821771887e-01   +4.984930417340872e-01   +2.051971407184352e-01   +4.351366930402253e-01   +6.821875417885486e-01   +5.083503354462047e-01; +2.920371675361351e-02   +5.628179541459860e-01   +4.051961883086226e-01   +5.329178672228945e-01   +4.397899517029549e-01   +4.109335121742012e-01   +4.489771475712183e-01   +4.171582935178078e-01   +3.073902434204528e-01   +5.190101946334000e-01   +4.181751118067888e-01   +5.008683002983856e-01; +3.518832755022916e-01   +6.697270446800386e-01   +5.614018225129301e-01   +3.807894308476951e-01   +3.993466036426390e-01   +8.032415706963347e-01   +6.908679283954058e-01   +1.089696687113949e-01   +8.310995603979507e-01   +8.205295340192095e-01   +1.523981601010676e-01   +6.678509398433614e-01; +9.434145869264851e-02   +2.980436527939478e-01   +2.696832671206944e-02   +7.847896025630712e-01   +6.837426959613058e-01   +4.996483293144139e-01   +8.565151106516450e-01   +4.535104048006583e-02   +7.921308522882009e-01   +5.103545279628172e-01   +3.368693776628822e-01   +9.685011860036548e-02; +3.018333645450084e-01   +5.949382365691670e-01   +7.503097722883698e-01   +3.897942099544091e-01   +8.878805326767680e-01   +3.042474922445678e-02   +8.147933936739009e-01   +2.249323992835641e-01   +6.069115815614988e-01   +2.614681397535910e-02   +3.097004755214257e-01   +1.318627702273226e-01; +7.383339515479168e-01   +3.386195732279156e-01   +3.581273708168318e-01   +2.544621138981021e-01   +6.023114561162207e-01   +1.693362882451882e-01   +5.154117817826758e-01   +8.293685091329895e-01   +7.519066899392640e-01   +8.870347950983928e-01   +4.693858876742923e-01   +6.386658362052604e-01; +6.541701649987244e-01   +1.871348710021015e-01   +6.569888393717397e-01   +5.327910391300117e-01   +8.824946200178551e-01   +5.286275231939358e-01   +8.694006597731620e-02   +4.361365395572799e-01   +3.843915638693909e-01   +2.618777036830863e-01   +2.185504586919913e-01   +8.640142410578249e-01; +8.570490877109561e-02   +7.593256570782514e-01   +6.684944713032216e-01   +7.313766187210409e-01   +3.338638418397988e-01   +6.519254373290678e-01   +1.650548902325303e-01   +7.016705287198913e-01   +7.488375861735578e-01   +4.137265825130335e-01   +1.920043995082320e-01   +2.144715048530987e-01; +8.272837615401527e-01   +6.987386786254324e-01   +3.658752898203455e-01   +2.181048441253472e-01   +5.135171076513710e-01   +6.978245644335235e-01   +4.530903555718007e-01   +7.889616341049037e-01   +5.967789066883117e-01   +3.113768850633673e-01   +7.958320256901587e-01   +1.933385929637171e-01; +4.061696360972152e-01   +3.140565108464858e-01   +8.814513520551991e-01   +8.478416414505805e-01   +8.779318103814512e-03   +5.569001467391892e-01   +7.435360793213620e-02   +2.309366030296230e-01   +3.309195498643362e-02   +8.636333066924557e-01   +6.996564928516275e-01   +3.223139004654346e-01; +1.012501576142993e-01   +1.607060958605815e-01   +2.320332099454337e-02   +4.084790519806378e-01   +3.891747378267604e-01   +2.152358555847660e-01   +7.093746474952305e-01   +1.870619261624626e-01   +2.906095479154616e-01   +2.202990422337597e-01   +7.057456218969127e-01   +2.404191546670417e-01];
L3E_L3I_iGABA_netcon = [+1.782813453985704e-01   +4.053061788121489e-01   +2.971010066279823e-01   +8.300321931821291e-01   +7.420429999851967e-01   +4.988128851341561e-01   +2.743986290069356e-01   +6.852501274980329e-01   +5.814233867164611e-01   +6.658588751522105e-01   +5.354632640479846e-01   +2.091797683971213e-01; +7.010133670503271e-01   +5.681672290735379e-01   +2.646625782746696e-01   +2.139762794016991e-02   +3.351266681774196e-01   +6.308157066111504e-01   +6.005779047431552e-01   +8.758965086882623e-01   +7.716222269458404e-01   +4.007106923864838e-01   +1.130993231318169e-01   +1.907234811677481e-03; +5.318529606050540e-01   +8.683597465890641e-01   +8.554346034991479e-01   +7.585957506470945e-01   +1.875931863789776e-03   +6.721422720493738e-01   +5.305212134282867e-01   +6.231385636930384e-01   +3.817363874886820e-01   +3.752639535227118e-01   +2.551660308922689e-01   +1.323798667867193e-01; +3.673790399560982e-01   -1.402048339638196e-05   +1.207540822507197e-01   +6.564869173685751e-01   +6.509089896174872e-01   +2.377594935645668e-01   +3.741100170485066e-01   +3.345396448921868e-01   +8.960604118608978e-01   +4.290400209413539e-01   +4.165775566201937e-02   +5.419580720770987e-01; +3.774428907519923e-01   +3.499630868265431e-01   +8.946855179559217e-01   +2.423256759962697e-01   +4.856492803663728e-01   +6.947573957153467e-01   +8.667667942746481e-01   +8.339318965837443e-01   +2.367083512292675e-01   +5.029702948631367e-01   +7.536103091869343e-01   +5.257879904418062e-02; +6.180028929571186e-01   +4.269841038427867e-01   +7.557954239192944e-01   +7.987256543454400e-02   +3.699988113349385e-02   +8.837377828767796e-01   +7.885572219133613e-02   +5.839259018079252e-02   +7.420153790467997e-01   +5.462971249686153e-01   +2.501488428794061e-01   +1.961949927882325e-01; +5.297435753610115e-01   +3.263736047891819e-01   +4.298316367153489e-01   +5.432608303048109e-01   +6.212933160995140e-01   +4.315392226687671e-01   +3.113058860108960e-01   +1.447515788096608e-02   +2.900539744518835e-01   +1.458033460471609e-01   +2.735319267530151e-01   +6.567529698177281e-01; +2.727099141087829e-01   +1.582013422140840e-01   +1.109946395931398e-01   +8.228800969695330e-01   +3.836956801830463e-01   +6.679772215394344e-01   +4.710845585195522e-01   +6.929214217007889e-01   +6.934150261249967e-01   +7.764185833451699e-01   +1.401277659289440e-01   +5.334443632058187e-01; +2.507690107589752e-01   +1.673985172420666e-01   +6.982882574034356e-01   +4.617099257285030e-02   +8.448318856691579e-01   +8.168313723236247e-01   +1.662624765199763e-01   +6.485520804457807e-01   +2.187407171051091e-01   +3.767642355116368e-01   +3.864669136643671e-01   +5.618735340140534e-01; +7.436532290350206e-01   +2.870543381434855e-01   +7.690442286667381e-01   +2.939932339518730e-01   +3.195673620539329e-01   +8.774803659290414e-01   +6.759667474242452e-01   +5.058115187903588e-01   +8.415582922153495e-01   +8.809984934854918e-01   +1.442491606972734e-01   +3.389352826399775e-02; +4.952889925601784e-01   +1.141059475877367e-01   +1.951489815935084e-01   +1.695127433229858e-01   +7.075285067267992e-01   +4.490276397233214e-01   +7.610911337738089e-01   +5.567325922192917e-01   +5.091413880156189e-01   +1.519332950919774e-01   +8.358031534852435e-02   +7.299557757723404e-01; +5.758907865174252e-01   +4.699397718784728e-01   +8.979647004278416e-01   +6.563510914743407e-01   +2.163091762906412e-02   +4.684445225533920e-01   +8.849167984118447e-01   +5.611173910766303e-02   +7.120300276782577e-01   +3.640390262361098e-01   +4.171129634504222e-01   +4.021854611645098e-01];
L2E_Input1_iAMPA_netcon = [+8.991990545235751e-01   +8.993083379645922e-01   +9.003848250049079e-01   +9.008754689049745e-01   +8.993300272178623e-01   +9.006734689708953e-01   +8.997712326485473e-01   +9.006975280249173e-01];
L2I_Input2_iAMPA_netcon = [+8.992763524277461e-01   +8.995927731708353e-01   +8.997253223832793e-01   +8.994901726353869e-01   +8.993304132899006e-01   +8.997726264687910e-01   +8.998930810642659e-01   +8.994440345360109e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
