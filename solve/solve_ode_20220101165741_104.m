function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.954395393822269e-02   +4.975420508168776e-01   +7.983849950636895e-02   -3.516662263247872e-03   +6.597442207237381e-01   +5.492403508358323e-02   +7.678235660561606e-01   +1.207938883516079e-01   -4.914726943531106e-02   +5.777377902435435e-01   +1.745851949192045e-01   +2.657812397430310e-01   +3.726553791451477e-01   +1.928237339549474e-01   +2.244352804266442e-01   +6.973395988298795e-01; +1.863521038517046e-01   +6.287860214795888e-01   +3.246128201054079e-01   -5.878032101503153e-02   +1.344824984456039e-01   +6.883992332275428e-01   +2.637118757916157e-02   +6.681016247916734e-02   +4.108059074026316e-01   +2.836138588022142e-01   +4.036277775022554e-01   +6.967960581899083e-01   +6.394578453877792e-01   -4.232179326223773e-03   +3.105437230876061e-01   -1.488140928309784e-01; +2.907026174475251e-01   +2.120568594447834e-01   +4.711005135304496e-01   -1.408698270867011e-01   +2.203521293728288e-01   +4.959000297823005e-02   +2.725325873557983e-01   +4.062181211764898e-01   -5.442595657225117e-02   +3.418072331003524e-01   -3.045463182920902e-01   +7.196118470612991e-01   -6.219503359316546e-02   +5.885398891611087e-01   +4.449285103530580e-01   +1.810162070613723e-01; +2.284705135691835e-01   +3.784430830320553e-01   +4.178335917493274e-01   +1.487024517428784e-01   +4.552647714681276e-01   -1.515320124828629e-02   +2.044586659127684e-02   -1.786354910354948e-01   +4.228364575163198e-01   +4.631075350083745e-01   +8.962148335800402e-02   +5.405735447869709e-01   -1.433424893455837e-01   +4.176967273256003e-01   +6.930466662391509e-01   +8.432108920707421e-03; +2.485475332447396e-01   +5.072148351505532e-01   +2.187515312904999e-01   +2.182703806161589e-01   -2.864825669798301e-01   +4.481622575816377e-02   -1.218607457023639e-01   +4.634880306235267e-01   -7.280578115370734e-02   +1.291020018248992e-01   +1.484085799513215e-01   -3.824866358466478e-01   +3.506188482701226e-01   +7.393166551139043e-01   +3.637838836272739e-01   +4.680296677810699e-01; +6.992406570786907e-01   +2.113418114857605e-01   +5.879641696977180e-01   -2.856682909725565e-01   +6.776886014647848e-02   -5.975046132693802e-01   -3.460680094568845e-01   +3.139864116969415e-01   +4.102214637963020e-01   +2.853618848304629e-01   +3.880784696458153e-01   +2.416704969067958e-01   +3.216511977690261e-01   +1.913202339145034e-01   -9.228561059248155e-02   -1.669068560893084e-01; -1.830889538922825e-02   +3.254308375249075e-01   +2.835970403713161e-01   +7.991923480930624e-02   +7.329094859951166e-02   -1.367614812989760e-01   +3.340850476788531e-01   +6.543494694387130e-01   +5.932507140715360e-01   +4.483440965035272e-01   -2.485062801285175e-01   -1.866991965258594e-02   +3.905305793763449e-01   +2.422206985705048e-01   +3.052283489663810e-01   +3.657444577844777e-01; +1.529592433548160e-02   +3.505607595880972e-01   +4.648255770849837e-01   +2.540182675037896e-01   +1.062834341034949e-01   +2.241701388991543e-01   -3.894028030928087e-03   +2.689356880130823e-01   +6.077408231607287e-01   +3.997925655108666e-01   +4.815828147989851e-01   -1.451594809349466e-01   +4.413689258796966e-01   +5.324802506713926e-01   +6.194765225976779e-01   +1.032696546683971e-01; +6.114472057646321e-01   +5.835213358049929e-03   +1.414556884254988e-01   -1.846749675166313e-01   +2.214736274642192e-01   -3.229293924990044e-01   +3.862423670456580e-01   +1.253779568180110e-01   +3.124224038205614e-03   +5.977176822466889e-01   +1.468477028286613e-01   +4.701352997799679e-01   +3.009124573601607e-02   +1.132645927977739e-01   +1.508975420039732e-01   +5.376307624133947e-02; -3.858289245278488e-01   -1.101115029575453e-01   +4.852376967918099e-01   +6.562686701543022e-01   +6.761523296003760e-01   -4.724420395654158e-02   +4.566832768358247e-01   +2.131294233308553e-01   -6.477289639057163e-02   -7.715688474840111e-02   -7.498900237276671e-02   +6.221543244578037e-01   +3.486888171073929e-01   +1.532776719880601e-01   +1.680061257462656e-01   +4.862361725278662e-01; +8.272985871596623e-01   +7.252440250882699e-01   +6.114357662257907e-01   +4.262023209467591e-01   +5.488839450937588e-01   -3.817047056070135e-01   +2.698532380678317e-01   +2.492245100013508e-01   -5.072866179665660e-02   -3.062491982721149e-01   +6.961803903356234e-02   -2.172542109605858e-01   +2.172397987852877e-01   +3.639037036126579e-01   +9.237904829656059e-02   +1.608739750307739e-01; +3.635046375812321e-01   -1.082762434849890e-02   +2.800705922879386e-01   -2.274122581562222e-01   +9.144897519504203e-02   +9.065940203564768e-02   +9.500280995355581e-02   -1.103258939398753e-01   -4.700591143750830e-02   -6.094126205191461e-02   +2.022008850202937e-01   +1.077987476929208e-01   +1.207620292546066e-01   -4.167363708555582e-01   +3.646924690705560e-01   +2.570066702982568e-01; -3.199316740475014e-01   +2.491525535113372e-01   -2.324009396162452e-02   +4.178535732205144e-01   -6.547299944527471e-02   -1.457313073272133e-02   +3.627830858528640e-01   +6.138636131338819e-01   +8.461126774578057e-03   +7.606450155838552e-01   +4.743163395387192e-01   +1.997326419887011e-01   +2.036747860729158e-01   -2.180241570855090e-02   +4.726912671835484e-01   +5.474705716699879e-01; +3.144188362898412e-03   +2.674241098339398e-01   +6.547638285699334e-02   +3.622145514824127e-01   +2.227324374025895e-01   +5.041930602712895e-01   -3.257995066679745e-02   +5.237237211529334e-01   -2.622242539104444e-01   -1.739792135132063e-01   +4.511453792465202e-01   -1.592461279054128e-02   +4.078939247191146e-01   +2.737644489555162e-01   -3.823366816088334e-01   +2.549948665443529e-01; +9.349690781329278e-02   +2.279505058845641e-01   +6.919521302566065e-01   -1.592067109203629e-01   -6.120934223002364e-02   -2.838810149806232e-01   +6.856754880249643e-01   -6.428196223047662e-02   +5.449939304231204e-01   -7.116294198204053e-02   -3.000921945914008e-01   +1.895828742235639e-02   +8.137491981749663e-01   +1.857750142362611e-01   -7.412664621455689e-02   +7.049868898986926e-01; +8.443746817226447e-01   +8.215733099960916e-02   +1.469206797303615e-01   -2.196141475891884e-01   +2.816817955120202e-01   +7.620697383606886e-02   +1.333872686174260e-01   +1.118263894991474e-01   +2.166231370877315e-01   +3.785761680915398e-01   +4.152447454140162e-02   +4.951419736381623e-01   +4.107977898516588e-01   -3.073583005016566e-01   +2.155982619876905e-01   +2.818070915565513e-01];
L1E_L1I_iGABA_netcon = [+3.562885877228668e-01   +7.422408411748094e-02   +8.906259368982714e-02   +1.018684614606084e-01   +3.795578631171873e-01   -1.828857198185080e-02   +2.108330038005140e-01   +5.557679435431911e-01   +8.214027224188186e-02   -2.600311187236594e-01   -1.050040980638866e-01   +1.769933436352220e-01   +4.067486409005550e-01   +1.407020822416860e-01   +6.564577464451091e-02   +1.595454003514293e-01; -4.124419121545767e-02   +2.053853719229995e-01   +2.945267838829372e-01   +2.410556324123603e-01   -5.103413471602734e-01   +2.419667653308921e-01   +2.977442226098300e-01   +4.862138924534659e-01   +4.610417387862139e-01   +1.718437017330466e-01   +4.494402924920352e-01   +2.624055658149390e-01   +5.765448201179901e-01   +2.635354830566590e-01   +1.891803953794687e-01   -6.523884963686941e-02; -9.397454351680187e-02   +2.690635327818698e-01   -1.856111963419961e-01   +4.583036590865625e-01   +4.524608804249373e-01   -2.172290194149763e-01   +3.221238450787724e-01   +4.010010451067751e-01   +6.838437812126916e-01   -6.380569576381978e-02   +1.636819852386042e-01   +1.111304390002207e-01   +4.681967662253663e-01   +8.015633463767435e-01   +3.229413875749787e-01   -3.242921372731645e-01; -1.124062350440257e-01   -9.781361556067386e-02   +1.297737372469300e-01   +1.585336911931490e-01   +4.645222920925043e-01   +1.491394924070455e-01   +2.697580549579516e-01   +5.117625748042767e-01   +3.067630026703890e-01   +1.697412760038670e-01   +1.999701949743584e-01   -2.631034602628172e-01   +1.870880190817899e-01   -2.021263679738480e-01   +1.070361772041086e-01   +3.704235560372224e-01; -2.463114310063031e-01   +1.669982868504709e-01   +2.464235605318493e-02   -2.085390549218109e-01   +2.556443794944480e-01   +1.617251445129677e-01   +1.940288328421843e-01   +2.542486057775698e-01   -4.022774407780927e-01   +4.120410187783852e-01   +3.743055012858211e-01   +5.279388203667820e-01   +5.618534663627865e-01   +1.988977602561104e-02   +4.522837786179589e-01   +7.424632711484186e-01; +3.631671765462727e-01   +1.214498434198109e-01   +6.728959093956148e-01   +6.529454165486193e-02   +8.773982788122409e-02   +2.242675497880171e-01   +4.644769022737837e-01   +1.679018076340505e-01   +1.560809254281890e-01   -1.931585914428249e-02   +2.713575162151502e-01   -1.621068561209018e-01   +6.128786137404865e-02   -2.441740883582297e-01   +5.600700971947926e-01   +2.734011343180923e-01; +4.502585959031671e-01   +3.549483232233281e-01   -1.147001669407429e-01   +3.408980090926571e-01   -7.546051384183633e-02   +3.051370979928192e-03   -9.212628619326375e-02   +3.591796978880211e-01   +2.839827007952991e-01   -4.776641638299042e-02   +4.828127627483259e-02   +3.290496838124160e-02   -7.636127426250416e-03   +9.469647293256148e-02   -1.177106792639994e-02   -2.307283988172292e-01; +8.162083775626059e-01   -1.487305432166067e-01   +3.746763652802090e-01   +3.172699127651946e-01   +4.446535274013245e-01   +2.841296290690092e-01   +6.572723101864610e-01   -2.774342361930400e-01   +5.899518687788283e-02   +3.058389637405551e-01   +6.858700668909886e-01   +1.590888235741832e-01   +4.446265198669711e-01   -7.663829272215394e-02   +6.104126227862083e-02   -3.070812355660935e-01; +4.130091465212040e-03   +2.066823698218442e-01   +1.981513476389791e-01   -2.303033989925903e-02   +5.533475226796586e-01   +1.424619980775562e-01   +1.339585691092430e-01   +4.966676743537762e-01   +5.529726370363803e-01   +5.122832485337687e-01   +5.423067907757163e-01   +2.271053150587055e-01   +5.626339378255388e-01   +5.353835501547027e-01   +2.621585757071862e-02   +5.589030340412381e-02; +2.884119891622139e-01   +4.832784284416128e-02   +6.086274257200757e-01   +1.000754766899765e-01   +1.021803584886805e-01   -4.381083181776066e-01   +2.043877903694150e-01   +6.621991139805793e-01   +1.552395643606542e-01   -1.145954481821624e-01   +3.519053293862475e-01   +4.713071371048525e-01   +3.288859283832244e-01   -5.841202977022403e-02   +1.669434420373445e-01   +8.353990436579017e-02; -1.846159956581083e-01   +2.767870115555991e-01   +6.290800149283475e-01   +2.922916960618531e-01   +4.756167853511817e-01   +2.875704626736936e-01   +6.308009906248342e-01   +7.156526507817027e-01   +3.641948772431429e-01   +5.287086325896772e-01   -2.248412350583251e-01   +2.812354192682758e-02   -7.568736585195590e-02   +4.170342378347448e-01   -6.832339941268506e-02   +9.369687424201733e-01; +2.985466649270402e-02   +1.930539955573050e-01   -6.786760224853677e-02   -5.587331986841060e-02   +9.761225126471054e-02   +1.775544143359006e-01   +1.029331479941615e-01   +4.722215342939655e-01   +9.689511744588403e-02   +6.855525768191991e-01   +5.623178810879393e-01   +2.758789614651748e-01   +5.285143895300630e-02   +5.389295874375015e-01   +2.607252217849296e-02   +2.741870253151997e-01; +5.373617498447025e-01   +5.430303221289322e-01   +3.597737269614604e-01   +5.512675091574341e-01   +2.589987648683382e-01   +3.443594328527618e-01   +5.083990450083044e-01   +5.547131398820342e-01   -6.063982396452189e-02   +1.199787707080804e-01   +2.848518295050330e-01   +3.895604483533823e-01   +1.620193846048110e-01   +3.288107625664415e-01   -3.764872677865142e-02   -6.090043276276013e-02; +2.474448039008422e-01   +7.926914219135601e-01   +4.727333276626844e-01   +6.636703509591713e-02   +3.644368810997274e-01   -2.938119285286441e-01   +1.951936429829314e-01   +2.929578769959247e-01   -2.257113342253242e-01   +4.247025840324969e-01   +9.112118183544402e-01   +9.121550942224366e-02   +2.808198986452493e-02   +1.391382363477653e-01   -1.621092381639774e-01   +3.024616161430496e-01; +1.843282562328625e-01   -4.785464565015690e-02   -3.352968550509744e-01   +1.012897275902386e-01   +2.299889407071578e-01   +2.704443440821699e-01   +1.950600418356678e-01   -5.906366078508828e-02   +5.586992169350842e-01   +2.562068772800491e-02   -3.397042995831398e-01   +5.816006412249536e-01   +5.356794216912708e-01   -1.106991286906841e-01   +7.984578396891497e-01   +1.989912911927900e-01; +5.591383986402063e-01   +7.352369843480781e-02   -7.141122795851124e-02   +7.667564521073814e-02   +5.863612129120854e-01   +5.937739872149241e-01   +2.933101605239540e-01   -3.920281657155661e-01   +2.717561871840591e-01   -5.871582707626805e-03   +5.390431895286696e-01   +6.120748816392095e-01   +5.105856849426328e-01   +8.261151376877524e-02   +1.709824385090676e-01   +6.774680673823026e-02];
L2I_L1I_iGABA_netcon = [+3.515273949774131e-01   +4.369176742736061e-01   +3.038807440666789e-01   +7.024121120216872e-02   -9.000370339756746e-02   +6.258889152303955e-02   -9.198348430801231e-02   -1.148266454443876e-01; +2.984864186829241e-01   +6.379606489383792e-01   +3.262434460791954e-01   +1.254560919865172e-01   -1.997102315804891e-01   +2.641528156934154e-01   -6.467788839161694e-01   +3.483519905935618e-01; -3.664235758135032e-01   +6.228142152170701e-01   -6.811973991319263e-01   +5.315879495036325e-01   -5.701515698161580e-02   +1.344353424166660e-01   +3.559166729451883e-01   +3.752998601432484e-01; +5.110612833905670e-01   -3.340999647293760e-01   -9.185825577794443e-02   +1.833992760729905e-01   +5.339913050405882e-01   +3.229726370746355e-01   +4.906236891048132e-01   +3.693631078937434e-01; -2.045769400984238e-01   +2.871841058093269e-01   -1.276103730445226e-01   +5.483218077373622e-02   +6.158869493005787e-01   +1.042854749885467e-01   +6.814937671512189e-01   -3.885492240061142e-03; -1.890940822072129e-01   +1.564063369530651e-01   +4.143272365859946e-01   +2.698779563233784e-01   -9.507828671875884e-03   -1.266186575899922e-01   -3.021843987248813e-01   +6.813633642172058e-01; -2.493321047306407e-01   -7.964798414828977e-02   +4.657985519562806e-01   +4.417469471926808e-02   +4.275449128772454e-01   +2.713101332892099e-01   +1.623706804132425e-01   +1.068555014775376e-01; +4.493911715744370e-02   -2.751327791635654e-01   +3.003650144642024e-01   +6.483062336542420e-01   +2.636745321016677e-01   +4.973311057829152e-02   +4.789527687036051e-01   -9.925104944481875e-02; +3.376419409630576e-01   +4.229427165755283e-01   +6.134446705756069e-01   -1.339857107171892e-01   +3.204604351535253e-01   +9.801752057996735e-02   -3.906406155521114e-01   +4.199552232003488e-01; +5.598338010380399e-01   +8.094175958997840e-02   +7.059756994561028e-02   +5.927539655608333e-02   +2.470467189621615e-01   +4.580623413946713e-01   +1.073369986426025e-01   +1.837158497934621e-01; +8.879456146380027e-03   +9.643833968824234e-02   +4.761283180721868e-01   +2.625323291769743e-01   +5.014937100720482e-01   +1.116081562911386e-01   -2.966767160018483e-02   +5.322842721453951e-01; +2.328739270909693e-01   +4.059396602907968e-01   +1.115985189320922e-01   +5.363048800976673e-02   +2.092747533456379e-01   +3.254160764431357e-01   +1.512883958664466e-01   +6.134017722954739e-01; +6.934332348276284e-02   +9.116083866585338e-01   +1.011030655911715e-01   +3.096590347755145e-01   -9.446743989557745e-02   -1.211180121431915e-01   +2.612071435604096e-01   +5.621872348129101e-02; -2.187831409272148e-01   -4.665186820399536e-02   +8.417284195000436e-01   -1.144232619546640e-02   +3.325855740234813e-01   +1.346327078875406e-01   +8.922238429515893e-02   +1.079275328380155e-01; +3.080113270614775e-01   +6.608172313389902e-01   +2.844746097342281e-01   -8.470544864386423e-02   -1.890349279350880e-01   +6.331208409643806e-02   -2.094009616579763e-01   +3.132230035730955e-01; +5.990191446890265e-01   +1.102333964903589e-01   +3.411348247334520e-02   -2.655756357394092e-01   -1.085051809792053e-01   +2.366612223690865e-01   +1.478254798229449e-01   -3.372147584386256e-01];
L1I_L2I_iGABA_netcon = [+3.112507911496674e-01   +1.054325761957547e-01   -2.526301607877696e-01   +2.370988005272884e-01   +7.395260945104858e-01   +2.738893750140577e-01   +2.632512824507700e-01   +5.783954632897175e-01   -2.018790624448707e-02   -3.139187743466946e-01   -1.619088529054058e-01   +2.798554735485466e-01   +3.890603818756120e-01   -6.012563838739676e-02   +1.293651999828367e-01   +1.934260085145904e-01; +3.990648870673393e-01   +4.132264456648145e-01   +2.057077210179936e-01   +8.794753478874426e-02   +3.318864387217324e-02   +2.108638995686454e-02   +2.674178721757141e-01   -2.050412242003481e-01   +2.959032281693212e-01   +4.450493870579371e-01   +9.595752364983716e-02   +3.191653139201209e-01   +4.336943327501120e-01   -1.164006898680370e-02   +5.982579927254567e-01   -1.546802468984607e-01; -2.071243383003123e-01   +3.961275467778699e-01   +2.646274796155449e-01   +3.279608752573503e-01   +2.453498167788993e-01   +1.903283949511491e-01   -6.098475574387732e-02   +5.978865468251845e-01   +2.895998049567283e-01   +3.004453329551465e-01   -4.223083927735105e-02   +9.458356368690735e-02   -9.762850136703623e-02   +3.520799624714088e-01   -3.646413396850843e-01   +2.115035893732936e-01; +7.989394757981911e-01   +5.262140026976310e-02   -3.891537083466347e-01   +1.119795202272350e-01   +2.242664689106491e-01   +2.204858864809193e-01   +1.927326132441657e-01   +4.616578331774041e-01   -1.492986009524507e-01   +4.013788781216463e-01   +2.847219389819241e-01   +2.885322944199433e-01   +1.342070245458933e-01   +3.940191208880890e-01   +8.672518313641583e-02   +2.379891316125799e-01; +5.514858013472029e-01   +8.723048441365266e-02   +3.304328873434353e-01   +6.466803433198370e-01   -9.393479742110947e-02   -1.864322098883503e-01   +5.844373499925254e-01   -3.846088461008313e-01   +5.015818536126588e-01   -2.385082472364963e-01   +7.398339395779630e-01   +5.063653046322856e-01   +2.478463834382834e-01   +5.024426586122503e-01   -1.023717804817530e-01   +1.619395681173902e-01; +9.157475284877531e-02   +2.095199433873029e-01   +2.828724989498271e-01   -2.796370985444614e-01   +3.294492842670200e-01   +2.065881493039889e-01   -6.374565328027532e-02   +6.201031086064286e-01   +1.097232431941366e-01   -4.197858662025838e-02   -4.485570715372220e-02   +6.814474545710603e-03   +4.881097408584961e-01   +5.009570606927251e-01   -9.777814410715235e-03   +1.054768025334971e-01; -8.591481915481511e-02   +7.740526701920535e-02   -2.162954487556470e-01   +4.509916051571432e-01   +4.318846524144021e-01   +4.669197249911574e-01   +4.654043348629300e-02   -9.755659912840398e-02   +4.990442519161037e-02   -2.963710215987524e-01   +3.847237026177983e-01   +1.924805397487135e-01   +6.955572708930408e-02   +3.505175099289385e-01   +5.669850613013663e-01   +1.736678099952245e-01; +3.422103483181999e-02   +5.756677132759114e-02   +5.197393436184082e-01   +2.636033896035838e-01   -1.184317997926547e-01   -3.927444976792552e-01   +5.069734808064269e-02   +8.803604811093160e-02   +4.333481882106066e-02   +5.390798429754977e-01   +2.377511986977875e-01   -1.717414466699245e-01   +4.740222385157667e-02   +2.534720427360230e-01   -2.045922493642816e-01   +5.066509833303483e-01];
L2E_L1E_iAMPA_netcon = [+4.891950608142218e-01   +3.689069446878668e-01   -1.796751342546414e-01   +2.626614369874871e-01   +4.286266811836506e-01   +4.735760051329611e-01   -2.944896954080006e-01   -8.722121423168014e-02; -2.387164439449376e-01   +2.596018483654511e-01   +1.167529234841138e-01   +1.909096572667678e-01   +4.388589677830936e-01   +2.059744085249188e-02   +7.655105462480595e-02   +4.794472585189533e-01; -2.678838299938902e-01   +4.664244980719456e-01   +6.746018801813218e-01   +3.850580670601584e-01   +1.826867975878977e-01   +2.894816993515310e-01   +3.602996870184274e-01   +5.738202450256920e-01; +4.657655449023930e-01   -2.045366766330359e-01   -9.137493162552301e-02   +5.537341624589677e-01   -2.573855739547672e-01   +1.762673208634144e-01   -1.429468000559417e-03   +3.195246443820519e-01; +5.494169663370512e-01   +1.744824058812002e-01   +1.643993310274664e-01   -1.789753842094944e-01   +1.830519847900158e-02   +5.697923464874888e-01   +1.670050904206703e-01   +3.435579872178396e-01; +4.835227891916482e-01   +8.254119195769534e-02   +2.945803605016789e-01   +2.841410146203389e-01   -9.823257644645533e-02   -3.069104417570193e-02   -3.354775454421888e-02   -2.147089176159852e-01; -1.733129211969893e-01   +4.928971125123682e-02   -6.573690576880761e-02   +7.911695737106885e-01   -3.326835922682879e-01   +8.358346041209709e-02   +4.046554441272813e-01   +9.554305285637821e-01; +2.403269131827878e-01   +3.267727587377313e-01   +1.174204003814375e-01   +3.780237800819808e-01   +1.176871819030395e-01   +4.764527367005040e-01   +5.405647434244443e-01   +4.188586076031191e-01; -2.126317480842076e-01   +1.817875788801351e-01   -1.515250394620254e-01   +8.047852414281936e-02   -5.421363923633037e-01   +4.351151634648109e-01   +4.023086247196740e-01   +3.469837658013055e-01; +3.747334759337886e-01   +2.411228013857554e-01   +2.172966928138079e-01   +3.131996257526380e-01   +1.668613689036309e-01   -5.943319072116206e-02   +1.331615887057386e-01   +4.117742611641965e-01; -9.069742610518701e-02   +1.699490452385272e-01   +8.047921195293438e-02   +9.565794037066031e-01   +3.580536097504572e-01   +1.120357064808729e-01   +2.371472045859732e-01   +4.256515218421167e-02; -2.033423087882910e-01   -6.902760109958389e-02   +1.668377178459106e-01   +5.623490656375132e-01   +2.302960162706300e-01   +3.761044031671988e-01   +3.058386629658176e-01   +5.482222528801322e-01; -2.043614277290401e-01   +7.891280440596347e-01   -1.208286308161799e-01   +2.838641556519126e-01   +5.762611978727978e-01   +1.257236506446545e-01   -2.912466083324688e-02   +6.722304049101080e-01; -1.261114576885289e-01   -5.187027119414849e-01   +1.650255805108107e-01   -3.093591050043246e-02   +4.742613865592702e-01   +6.093256181569926e-02   +2.130331149703500e-01   +5.841061732263424e-01; +7.629631891999095e-01   +3.793127474570631e-01   +7.599912276844367e-02   +4.273311405175034e-01   +2.373976465044726e-01   +1.272254203375571e-01   +5.403066317797695e-01   +3.684361637628379e-01; +3.909230855658082e-02   -4.566400417577804e-02   +3.178359564734721e-01   -5.661312045601877e-02   +4.799964361389347e-01   +7.191826279483796e-02   +3.123852649436433e-01   +1.094166327381942e-01];
L1E_L2E_iAMPA_netcon = [-1.081391636818151e-01   -1.835223619676450e-01   +2.824543348653875e-01   -1.602120708110641e-01   -1.375747128395729e-01   +9.792991768723529e-01   +6.692122943414679e-01   +1.568742605641151e-01   +1.741156445167845e-01   +4.530571791465167e-01   +4.930978041382651e-01   -1.710901640525776e-01   +6.927493216570574e-02   +2.291386824920092e-01   -6.549446941366104e-03   +2.797591976046097e-01; -3.668348294516973e-01   +5.263964506429515e-01   +6.340905891462101e-02   +6.602298801225941e-01   +6.177556502940471e-01   -1.242440745568242e-01   -1.960403641129538e-01   -1.167734840369821e-01   +3.534308018029388e-01   +3.736171315752851e-01   -1.179444017318389e-01   +1.394185738671092e-01   +5.068428994475423e-02   -2.732114611364861e-02   +4.662254444033876e-01   +5.466532361695725e-03; +8.217138766784537e-03   +1.211911384984854e-01   -2.727524689832559e-01   -2.583021441901481e-01   +5.284557091648476e-01   +3.044181276132746e-01   +2.561671899428128e-01   +6.192490601987305e-01   +3.937228614998379e-01   +4.005867795940633e-01   +3.791083567393513e-02   +1.108319219059711e-01   +2.958247767233640e-01   -4.851483755643422e-02   -4.997300159291716e-02   +5.741061125673026e-01; +2.919440166350495e-01   +4.157994786661993e-01   +6.575477146264626e-01   -1.867665725511419e-01   +2.067497650732740e-01   -4.148529885690105e-01   -3.953060117143204e-01   +1.565496864660523e-01   -1.639859032853766e-01   +4.402980524534081e-01   +5.180021313063590e-01   -6.333944479175027e-01   +2.809534898953158e-01   +7.868900883163596e-01   +6.254069152768633e-01   +5.595515118867099e-01; +3.024327912993645e-01   +1.899183593406615e-01   -6.763701293055327e-02   +3.857422848214128e-01   -2.376060527404375e-02   -2.885745592960218e-01   +3.760994987414250e-01   +4.135386595118126e-01   -4.912870046592277e-02   +5.075743190921840e-01   +4.548501867120821e-01   +4.433508868958546e-01   +1.083907919203143e-01   -1.465230825750301e-01   -7.646362278009128e-02   +6.756856201300852e-01; -2.780308728072311e-01   +2.528220720097443e-01   -1.830774335676242e-01   +3.167753036538057e-01   -2.071112996239892e-01   -2.720616139909565e-03   +6.252988643389354e-01   +9.621792528667798e-02   +2.541953678892780e-01   -1.122684900551329e-01   +1.648779743230861e-02   -9.235781591211442e-02   -6.376226003912244e-02   +3.041328641298557e-01   +3.789816960611885e-01   +3.129288641491068e-01; +2.537463417332342e-01   +4.644746149316258e-01   +4.686804468204456e-01   +4.196365163366333e-01   -3.586156193341714e-01   +1.614973277494091e-01   +1.956645478971359e-01   +4.342614497886077e-02   +3.856511434049592e-01   -7.050134068106312e-02   +1.219927636036182e-02   +3.287363669666076e-01   +5.511785571236598e-01   +3.383051067178448e-01   +3.723245985390401e-01   +2.400870824418970e-01; +7.523131392077477e-01   +4.379262226120921e-01   +2.572096512199079e-01   +3.285969491877019e-01   +8.028034331746026e-01   +9.134762582488098e-02   +1.221052826074403e-01   +3.403666256491834e-01   -2.071989851053025e-01   +8.388938355348517e-02   -2.914239985406954e-01   -4.417304728269084e-02   +1.381118400294358e-01   -2.675793815116483e-01   +1.693121050747470e-02   +1.729902976011730e-01];
L2I_L2E_iAMPA_netcon = [+3.296971971771609e-01   +2.997823932758487e-01   -3.268243054654083e-01   -2.452575524727409e-01   +1.839494037462107e-01   -9.694105144995166e-02   +2.627212935668485e-01   +1.951454025891919e-01; -1.218829673917908e-01   +4.040490033821518e-01   +2.337516378858813e-01   +1.244978306066545e-01   +4.001452278160655e-02   +3.313425610103966e-01   +1.945384451065079e-01   +1.084788125316530e-01; +7.735268508271947e-02   +1.704326100895711e-01   +4.960707959663317e-01   -7.603812145013086e-02   +6.507419680509672e-01   +1.479256471880284e-01   +5.204169278818342e-01   +1.365527731786241e-01; +4.389824078260787e-01   +6.693567218485803e-01   +1.495440156628589e-01   +2.695578383886670e-01   -2.967631362892589e-02   +3.354725301384515e-02   +4.880632175154493e-01   +2.536967019244029e-01; +1.423849677211054e-01   -3.820764627878055e-01   +4.439154220554353e-04   +3.359009421514396e-01   +7.568593608511032e-01   -2.032537759016017e-01   -2.284425875297294e-01   +5.368211995785082e-01; +5.667988259405630e-01   +4.838303327402190e-01   +2.208572428475557e-01   +2.541974909244384e-01   -1.623665286563314e-02   -1.602163556258002e-01   +1.835925471509614e-01   +7.058474100372434e-01; +1.667642783369547e-01   -4.488664301450959e-02   +6.443049477524778e-01   +1.944454370994786e-01   +2.480710104732822e-01   +7.819603297298241e-01   +4.410025398110894e-01   -1.626022225346362e-01; +3.489224538184899e-01   +1.201025095432570e-01   +1.089351391213789e-01   +4.071536706941463e-01   +3.816222259929988e-01   +2.582984942989672e-01   +6.003309129257987e-01   +3.946484362905191e-01];
L2E_L2I_iGABA_netcon = [+5.419398393790644e-01   +3.147626843041419e-01   -2.633665770427115e-02   +2.462019185828265e-01   -2.074782118521259e-01   -1.052947587127166e-01   +2.321444185325836e-01   +2.390305971294907e-01; +6.513619289906862e-01   -1.005441686590001e-01   +1.839384241604169e-01   +5.078456388597654e-01   +1.271459981803206e-01   -1.607029345505336e-01   +5.908941435823591e-01   +2.960547994845611e-01; +2.752615035162533e-01   +2.886826128723362e-01   +1.359557070088026e-01   -4.967766228534370e-02   +5.096575451129084e-01   +3.872019257798035e-01   +1.151182183979949e-01   +3.440148219217242e-01; +8.966915694458838e-02   +1.089194932701245e-01   -1.055704220192843e-01   +2.220780851322281e-01   +7.045025549360342e-01   +8.347493022738127e-01   +7.869803456659945e-01   +3.334123731813548e-01; +3.347326266997671e-01   +3.760249381435856e-01   -2.193873320444701e-01   +4.869407419007461e-01   +1.453711807710492e-02   +1.339462245757395e-01   +6.411203755202012e-02   +6.647373143224508e-01; +4.583902815359793e-01   -1.999355257806229e-01   +5.179515187302739e-01   +7.525001703127077e-02   -2.509611159789316e-02   +6.401443057309342e-02   +4.547111405237076e-01   -3.243460714229618e-02; +4.928806936112063e-01   +3.903407538908016e-01   +3.313024250936148e-01   +5.231594915590345e-01   +5.265952461433345e-01   +2.083140000470866e-01   +6.148122094368259e-02   -3.639514130737392e-01; -4.155833833872820e-02   +4.743135046824181e-01   +3.756846528701910e-01   +7.090734786883798e-02   +7.243588564163167e-02   +3.774466190140208e-01   +1.048208456535693e-01   +5.428533865668257e-01];
L3E_L2E_iAMPA_netcon = [+5.296200689983395e-01   +2.246826579757372e-02   +7.924919241196797e-01   -6.177065339115379e-02   -3.597440946520838e-01   +2.345755753056695e-01   -1.569998752029919e-01   +6.934143569064626e-01   +2.386835642121183e-01   -2.488389614523324e-01   -1.829996384826450e-01   +6.117417156992078e-01; +5.641327322882481e-01   +5.097128552460346e-01   +4.752444129816398e-01   +3.741379517387342e-01   +6.182351896276960e-01   -3.096837712859909e-01   +1.887915405640159e-01   +9.855856237266267e-02   +3.237500662897622e-01   -5.306061919974732e-02   +2.840167286074228e-01   +3.686609610942335e-04; +3.912799591671113e-01   +1.105668642083497e-01   -1.604765526852709e-01   -6.816616670256570e-04   -2.287717037837315e-01   +5.131526513536755e-01   +2.363844474161260e-01   -1.570259874517865e-01   +2.278799818994721e-01   +3.546074635329489e-01   +2.564033205963195e-01   +3.612149628465672e-01; -2.899315188967161e-01   +3.359015037362333e-01   +1.723872391510211e-01   +7.079008263526007e-01   +6.116333684097903e-01   -2.468307427196953e-02   +4.222209366784697e-01   +1.491631495978862e-01   +2.929750442741185e-01   +2.470484419180969e-01   +2.437856225161269e-01   -3.150866938746193e-02; +5.745304415544998e-01   +4.994169804005991e-01   +6.585649346082620e-02   +6.884193775978913e-01   +4.318285024368566e-01   +3.003111042116322e-01   +5.338649408033359e-01   +3.413352593278431e-02   +1.427821127264690e-01   +2.833577750899323e-01   +1.084479176436248e-01   +2.747194342865670e-01; +9.219051716183565e-01   +2.569702524239167e-01   -3.132772807772671e-01   +4.561719453760434e-01   +6.264475893491166e-01   +6.433209003043086e-01   +3.862129036401445e-01   +1.034669503893731e-01   +4.439144070616710e-01   +1.435647040035873e-01   +3.749134946582778e-01   +9.492367299379251e-02; +1.004818628690187e-02   -4.052504552393881e-01   +1.526867248395847e-01   +7.052964805106985e-01   +3.211757623838415e-01   +9.661473625883760e-02   +7.334722726916705e-01   +3.511595249120550e-02   +4.484506500699273e-01   -4.776546977417942e-02   +2.934335957356453e-01   +7.070748856196604e-02; +4.784403781016510e-01   +2.795943258584107e-01   +8.666467238638058e-01   +3.693796714425714e-01   +4.639905262013652e-02   +3.006727772157668e-01   +1.204027567070960e-01   +1.729282080871713e-01   +8.653147920732908e-01   -2.211967181523734e-01   +3.419539565263327e-01   +1.265087539960044e-01];
L3I_L2I_iGABA_netcon = [-2.794391350610393e-01   +6.739368678427431e-01   -3.643591158819581e-01   +1.611321498232415e-02   -1.373257202377589e-01   +1.390529357924838e-01   +4.498682856688083e-01   -1.044135697194162e-02   +3.655755979365176e-01   -1.855794542864466e-01   +1.375708161754793e-01   -2.440543397752942e-01; +4.119125283026350e-01   -2.301708677337030e-01   -1.156029292235117e-01   +7.545561839734767e-01   -1.499337576635580e-01   +5.342845068511222e-01   +3.041523176143534e-01   +1.432344853730823e-01   -1.526259649986348e-01   -5.514834554179060e-03   +9.568010280227029e-02   +2.763225079341382e-01; +5.171002376307018e-01   +1.254870644238244e-01   -9.522803343328193e-02   +4.768213977505333e-01   +5.344993709364227e-01   +5.435901833997405e-01   +1.353077710568966e-01   +6.196936921379664e-02   +1.069414511547125e-01   +4.306374002669748e-01   +7.383292646070481e-01   +5.998415189911377e-01; -8.555328541444751e-03   +2.889692688422588e-01   +1.620280569101888e-01   -2.820841052787953e-01   +2.686290200202176e-01   +2.471320505604231e-01   +1.416842069733434e-01   -2.491982356075324e-02   +1.837055980308748e-01   +1.964261405092942e-01   +3.470514387236355e-01   -1.319548292981702e-01; +6.261025606074776e-01   +1.589735112711451e-01   +4.682082935168627e-01   -4.697641377661065e-01   +4.287485102273641e-01   +3.350814054866013e-01   +1.971383694128492e-02   -3.419772236164240e-01   +5.612364338438348e-01   +1.956285509238812e-01   +8.261612950112118e-01   +1.502100053140973e-01; +3.625050441044794e-01   +5.799842643688865e-01   -3.121165266299310e-02   +2.965599166123130e-01   +4.592120451544496e-01   +5.811710240369650e-01   -1.206942198367581e-01   +2.788566535719122e-01   +4.533103492364209e-01   -4.303842111682090e-01   -1.991207506603101e-01   +1.937344191806866e-01; +4.088897793965482e-01   -1.283404510154175e-01   -7.407930164111969e-02   +1.387480188184042e-01   +2.115112930806421e-01   +9.600584871007854e-02   +5.399127664749417e-02   +6.094831625717838e-01   -3.212587397832568e-01   +1.871505847364680e-01   +6.289325708674136e-01   +9.564396754382254e-03; -1.316761488078316e-02   +4.814821182824105e-01   +4.060852042182552e-01   +2.150897657574731e-01   +2.237218702027109e-01   +5.940046056711662e-02   -2.429331926207078e-01   +3.792741769730172e-02   +3.781674349181751e-01   +6.213267444824812e-01   +3.951732389911887e-01   +2.217770468496095e-01];
L2E_L3E_iAMPA_netcon = [+1.089837913497146e-01   -1.986391017647055e-01   -1.707868413197224e-01   -2.823312101698219e-01   -4.157083046135824e-01   +5.090017092601531e-01   +3.445050365280999e-01   +1.385441220732794e-01; -6.534792258534507e-02   +9.166443850993514e-02   +1.817731426887690e-01   +2.975740518804048e-01   +3.690541038247654e-01   +1.115501155248919e-01   +6.641535114022801e-01   +3.350100165032780e-01; +1.541214208836444e-01   +2.456609556793733e-01   +2.625986437574420e-01   +7.340229214742409e-02   +3.124736690317981e-01   +3.077891554901537e-01   +2.649321968590399e-01   -3.319037500206884e-02; +3.531814201881099e-01   +4.620662024132584e-01   +2.711723674979498e-01   +5.393386000831361e-01   +4.663629580206410e-01   +2.219450967864962e-01   -7.672487864194363e-02   -2.749138780106023e-01; +2.307632873251168e-01   +4.297671493582961e-01   +6.521183559876892e-01   +8.735042354757472e-02   -2.157011722203963e-01   -2.032576044308910e-01   +2.096886108093385e-01   +1.334341261887307e-01; -7.894741226642847e-02   +5.300308194033165e-01   +3.547176331523957e-01   +4.809627820111931e-01   +4.522046632527333e-01   +4.482140331488551e-01   +1.744450083648503e-01   -2.221873080483487e-01; -8.917762480542354e-02   -1.589474370714874e-01   +5.181800906758909e-01   +6.209607156120114e-01   -2.824790908924074e-02   -2.004279322969418e-01   -9.137805082832329e-02   +1.214663525693624e-01; +4.999628245001845e-01   +7.364738056504322e-02   +6.934958602868821e-01   -3.751448056289516e-02   +9.479162538236910e-02   +2.507102849715455e-01   +1.592847431311987e-01   +6.400266531513026e-01; +5.958818088165617e-01   -1.184937549651686e-01   +2.062443882955778e-01   +2.979807359124738e-01   +5.375281675409824e-02   -1.178689082822933e-01   +4.361089202541694e-01   +1.808196883190029e-01; +5.407361526713115e-01   +8.760435245548907e-01   +4.350195446259433e-01   -3.116599611485713e-02   +4.662954309760921e-01   +4.891751078802214e-01   +5.169158996936768e-01   -3.243035063693698e-04; +3.218925046650331e-02   +1.075893363097388e-01   +1.486953954523516e-01   +9.034184693070962e-02   -2.025452136823919e-01   +2.555230039982565e-01   +1.634329703833927e-01   +5.601857603264626e-01; +2.753384948907626e-01   +4.881414409646241e-03   +8.541488905831036e-01   -1.850459045532320e-01   +3.886049507296117e-01   +2.179465905728971e-01   +5.071685606315715e-02   +4.396043137703600e-01];
L2I_L3I_iGABA_netcon = [+5.179340900528200e-01   +4.917843891640971e-01   +3.103486911369487e-01   +4.751545654423879e-01   -3.430704666599070e-02   +1.928871990679273e-01   +2.847825602641710e-01   +1.471758136319118e-01; +3.947346450304839e-01   -2.257238446425699e-01   -3.790688904505791e-01   +6.076895363018093e-01   +1.751181106427423e-01   +4.113685287563106e-01   -2.891892343069737e-01   +5.002730689538073e-01; +2.048057272367894e-01   +5.571797248844837e-02   +4.056179887581421e-01   +5.520454125392659e-01   +2.190101424499637e-01   +1.103216628845020e-02   +8.226909280501223e-01   +1.460403581788833e-01; +3.813766252208489e-01   +1.205111991781192e-01   -2.847625811941437e-02   +5.708310860055274e-02   +1.684538190179193e-01   -1.290471049347739e-01   +7.285657158465617e-01   +3.085454533360188e-01; +6.372543809840046e-01   +6.919101673610145e-02   +3.160915880976043e-01   -1.635603124170851e-01   +7.474903636939030e-01   -1.146575559145229e-01   +6.091493539993781e-01   +5.960680911995237e-02; +3.887498776813056e-01   -2.281643172449599e-01   +2.422849704855086e-01   -2.480245985155333e-01   +4.208734371859207e-01   -5.081880921536428e-03   +5.144492587807804e-02   +6.501993812034845e-01; +4.550153986688553e-01   +3.629263800394701e-01   +4.294790857646623e-01   +8.662088199401531e-02   -1.506518105049286e-01   +2.793831175410869e-01   -3.447790679726448e-01   +1.903794613259544e-01; +2.160443643721620e-01   +7.046334598086824e-01   +2.557308477771901e-01   +3.716614469799239e-02   +5.180269936949337e-01   +2.499213687862592e-01   +4.985586090658924e-01   +2.764405365915548e-01; +3.434593205151287e-01   -2.249049017995079e-01   -1.855568278440775e-01   +3.726633906229687e-01   +2.890315177884584e-01   +3.068611114287341e-01   +3.073766336133267e-01   +3.460945368789463e-01; +5.394510826362051e-01   +1.261356430896326e-01   +1.000000000000000e+00   +2.562925705535024e-01   +6.172903410239663e-01   +2.629313261941574e-01   +4.262210193161835e-01   +5.254034770586662e-01; +2.127029249316272e-01   +3.327249179291171e-01   +1.668017456001944e-01   +2.114185957643422e-01   +3.156764076444072e-01   +3.330660043536530e-01   +2.518234272993785e-01   +2.353847396877946e-01; +4.701713302500709e-01   +2.811066578483737e-01   -2.331189312214678e-01   -8.167438923852573e-02   -2.298202280099383e-01   +6.182607022323928e-01   +1.897895756627398e-01   +6.219422612524998e-02];
L3I_L3E_iAMPA_netcon = [-8.744157887136775e-02   +4.154980684441315e-01   +4.585365681593678e-01   +2.448064613147721e-02   -3.194207847097862e-01   +2.503765788493340e-01   -1.733376741090584e-01   +2.155047253366857e-01   +4.846251994693293e-02   +4.859768630420777e-01   +4.563904410169914e-01   +3.499427801403393e-02; +3.242800347467918e-01   -4.446211918680987e-01   +5.838067811281378e-03   +7.985287276262337e-01   +2.928187303669141e-01   +4.086037906477091e-01   +6.336097185994383e-01   +2.849895503938248e-01   +1.541566457732928e-01   +2.685993870345410e-01   +1.356945733630935e-01   -1.985486005636916e-01; +4.463618728517671e-01   +3.620063123187778e-01   -3.684870798103806e-01   +3.053711059427322e-01   +4.546806233731595e-01   +7.439144921729700e-01   +1.216593529757405e-02   +4.000732922452707e-01   +3.923404875446084e-01   -2.374984272347825e-01   +3.385003166029614e-01   +7.429495849820950e-02; +1.553074673529358e-01   +2.668436070609452e-01   +4.361890179726664e-01   -5.160095197045911e-03   +6.566000195910360e-02   +6.299148293776522e-01   +7.194606683487865e-01   -1.342256462640463e-01   +6.582059222432528e-01   -2.542268284711514e-01   +1.053158617161490e-01   +3.368500140936836e-02; +3.669258333546325e-01   +7.934095276740182e-02   +6.919291313640052e-03   +4.293937401088127e-01   -5.292419874008461e-02   +4.292304382813431e-01   -3.271378182295470e-02   +1.527584076991876e-01   +3.411156388428599e-01   +6.073600399754571e-01   +1.752988261413037e-01   +5.769810399626258e-01; +4.617994756968450e-01   -1.078100884101787e-01   +6.252848854383501e-01   +1.401112638123523e-01   +3.119812431510018e-01   +6.134442050034209e-02   +1.841572750326648e-01   +2.045025614060580e-01   +2.227546491643994e-02   -5.860468386184270e-02   +5.301973397935233e-01   +2.618373094890756e-01; -1.583717651224689e-02   -1.450924355035441e-01   +2.114232604776499e-01   +5.415755862009833e-02   -4.225213235152068e-01   +4.360878085098384e-01   +3.487476720524271e-01   +5.258984536817296e-01   -2.772870598338224e-01   +5.753568451077547e-02   +4.193581768717250e-01   +1.890633442481552e-01; -1.725587618339561e-02   -5.050846041422835e-02   +4.919897294518074e-01   -1.912747524601044e-01   +1.314056054122621e-01   +6.393603000404589e-01   -4.334480735550239e-02   +4.879859635051578e-01   +4.195524444981308e-03   +2.899867302053714e-01   +2.758856742702991e-01   +2.145233708739609e-01; +2.231398293180019e-01   +9.354800749072525e-02   +3.251823883003317e-01   -1.338609198969172e-01   -2.289368310975567e-01   -1.385746630838669e-02   +5.262035096941921e-01   +2.263226671152067e-02   -2.556719649283902e-01   -2.278697494101291e-01   +2.792074888875149e-01   +3.409444706765174e-01; +1.925748120551233e-01   +1.294837687839533e-01   +3.550215944333636e-01   +7.003897908659346e-02   +1.918034108919049e-01   -1.914475242459786e-02   +2.347198523036255e-01   -4.066944452389760e-02   -3.122799692893213e-01   +1.246649735340731e-01   +1.621180887864593e-02   +9.650828002714651e-02; +3.899137803729484e-01   +6.163493274510252e-01   -5.791698822384353e-02   +1.594297630035682e-02   +3.473731592673310e-01   -2.703826764420050e-02   -1.053485339480150e-01   +6.467811859571325e-01   +3.918256983686129e-01   +5.343355138026868e-01   +5.656101726584582e-02   +5.772722468006104e-01; +1.774062526145592e-01   -6.032397359018346e-02   -1.214687505810464e-01   +4.247133279008145e-01   -1.381447454754816e-01   +3.621646208130774e-01   +2.954074369934040e-01   +1.465965277358464e-01   +2.144983812714897e-01   +1.099495377248516e-03   -7.971679973713260e-02   +6.312684966181394e-01];
L3E_L3I_iGABA_netcon = [+4.700232522257615e-01   -3.630195847436940e-02   -1.256136164048783e-02   -1.831488818563423e-01   +1.802609872140350e-01   -3.672303423408459e-01   +8.144239792125521e-01   +6.349251781098680e-02   +2.881897709759657e-01   -1.673315129233057e-01   +3.196066941904275e-01   +1.915970825262900e-01; +5.117964737881167e-01   +3.756148144246806e-01   +1.572867517381525e-01   +3.216929328275048e-02   +2.097584799939924e-01   -1.432586753370081e-01   +5.302200637076186e-01   +8.716279128869434e-02   -2.402120285640068e-01   +3.562392783894287e-01   +4.059542371393796e-01   +7.805529243139300e-02; -1.902978880708925e-01   +4.447768440554624e-01   +1.021690957361770e-01   +4.088298969759139e-01   +4.931125359748644e-01   +4.073387302377104e-01   +8.109105836742166e-01   +6.381766553082718e-01   +2.182933225517054e-01   -3.449618669674979e-01   +4.383860621417666e-01   +1.527601911879960e-01; +2.505010548249419e-02   +8.990935969997692e-02   -1.538628107485313e-01   +9.243445917188087e-02   -2.704358487172865e-01   -1.811620298785942e-01   +2.259133051230452e-01   +4.188381028603964e-01   +7.470588923916683e-01   +3.564179134640536e-01   -1.107014947128553e-01   +5.064207344329921e-01; +5.531719367533089e-01   +3.960890857268199e-01   -1.805275903455691e-01   -1.220664760511072e-01   +1.328979410604116e-01   +1.484041770323281e-01   +4.994369164450421e-01   +3.707282071452767e-02   +1.798358423064663e-01   -9.478837532314818e-02   -3.831103792812944e-01   +2.848778298156685e-01; +1.627729041197159e-01   -2.435323963403476e-01   +3.222110938877144e-01   +7.389086216343956e-02   -1.486718480407388e-01   +2.916250523477767e-01   -1.638732183624454e-01   +1.590601443685477e-01   +2.084336711867729e-01   +7.396933082804902e-01   -4.654547782973506e-01   +7.309277647965094e-01; +6.827064247207677e-01   -1.230104884476051e-03   +6.369959161767449e-01   +9.350099734262728e-02   +2.387430569255350e-02   -1.493552818450704e-01   +3.886082317026458e-01   +3.227563931247264e-01   -1.409176448320242e-01   +5.842887938540553e-01   +1.656489582080518e-02   +1.347192939145940e-01; -1.888279883294615e-01   +2.706391042000821e-01   +2.097603683191142e-01   +5.535721392250813e-01   +1.419475149800662e-01   +5.289729755260367e-01   +8.110327030077564e-01   +3.103821537984971e-01   -3.981379617950506e-01   +1.217306407076091e-01   +3.405501437163594e-02   +4.333614501785432e-02; +8.416940472559011e-01   -1.633615897580768e-02   +5.888808788577553e-01   +2.618610508050312e-02   +2.694240641848620e-01   -1.451443560315795e-01   +3.498955229301567e-01   +7.972083837032373e-01   +8.387829444256026e-02   +3.164243784580130e-01   -1.254443888921636e-01   +3.082692887179255e-01; -3.561885254610316e-01   -2.643736668254810e-01   +4.304091107536859e-01   +2.258144485971207e-01   +4.796165548141346e-01   +2.554456119125849e-01   +1.537948047914898e-01   +4.134634114243477e-01   -1.507218182504090e-01   +2.152693228168152e-01   -1.047064480420199e-01   +4.345608367440968e-01; +4.778826758278072e-01   +4.863477264155098e-01   +9.813593062893697e-02   +6.346370816853502e-01   +1.840088564511573e-01   +1.700591760224827e-01   +1.089253661710946e-01   -3.186524566040105e-02   +6.156632775406852e-01   -3.315888654119853e-01   -3.393839760316414e-02   +1.650700764079809e-01; +2.179260983839043e-01   +6.237144156065717e-01   +3.853851615468002e-01   -7.656537173836677e-03   +6.882059046952962e-02   +1.733410027091435e-01   +1.428994085458664e-01   -1.386887003950737e-02   +2.568250349088953e-01   +4.586097967890823e-01   +2.500401516256738e-01   -8.957798283949826e-02];
L2E_Input1_iAMPA_netcon = [-8.390667187572177e-02   -1.722229722096958e-01   +5.831149229570647e-01   -3.179829379032682e-02   +7.092483749068883e-01   +2.584111138750020e-01   +3.698831383914708e-01   -1.127047723232927e-02];
L2I_Input2_iAMPA_netcon = [+2.611900666562265e-01   +6.524835117115373e-01   +2.973650662963110e-01   +3.081070144475472e-01   +6.638371441827695e-01   +1.502857087162857e-01   +9.872857087991949e-02   +3.662833762946248e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  33.63 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
