function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.538571117828568e-01   +5.329950150597539e-01   +1.953070087201740e-01   -4.910899401400021e-01   +8.529510574033282e-02   -3.175546994419651e-01   -4.962024366590212e-01   +2.707537227161836e-01   +3.898073157109402e-01   -1.457107951206630e-01   +1.042828758631834e-01   +9.220342658092985e-01   -1.744661499917413e-01   -2.738153515604257e-01   -6.873671354315498e-01   -5.236272188372526e-01; +5.632944073171882e-01   -1.096507332851001e-01   +6.082397164516339e-01   +2.945662309924841e-01   -3.662939468587339e-01   -3.403011102490959e-01   -3.921458122411822e-02   -1.093266000130674e-01   -3.138561083955083e-01   +1.718213422005214e-01   -4.190826571960243e-01   +4.701037254727500e-01   -3.976426825419223e-01   +1.139206823521986e-01   -7.971170076574417e-02   +9.741380658555387e-01; -2.937938154857166e-01   -6.257206255298453e-01   +4.982985900453469e-01   -2.637543926302011e-01   -7.955927356728482e-01   -4.445958798006580e-01   +6.349736333062475e-01   -1.865252753918814e-01   -1.813140084717264e-01   -5.909087823457784e-01   -1.302304846113309e-02   -2.938777239368685e-02   +1.045009048227201e-01   +7.896862451470384e-01   -5.787029406465052e-02   +9.098749148519165e-01; +4.829438457707951e-01   +2.442079399110912e-01   +5.332373744304363e-01   -2.766773233774031e-01   -1.992224056439336e-02   +3.918985569939313e-01   +3.890358481855717e-01   +4.560171907032537e-01   +7.579063496121642e-01   -4.215628732390989e-01   +2.111035587243799e-01   +1.029163958908842e-01   -2.507409489633743e-01   -5.016222289975153e-01   -6.654389349295906e-01   +9.222454867747384e-01; +5.841280107789001e-01   -2.284766261555244e-01   +4.811757841921612e-01   +2.858716455073482e-01   +2.045674396556493e-01   -2.382768211991882e-01   +1.010489446711065e-01   +3.772421628173153e-01   +1.359041420340147e-01   -1.995183627499190e-01   -3.004819836392502e-01   +5.475355132238036e-01   +4.886398845974583e-01   +4.549653987583319e-01   -3.365340038411401e-01   -3.942200589827010e-01; -1.358953480729378e-01   +5.840517363508161e-01   -2.274794659189947e-01   +2.358185168417025e-01   -4.398688241865931e-01   -1.747264008485873e-01   +1.228452052805449e-01   -4.813448891918777e-01   -2.697471606955277e-02   +2.232745700824663e-01   -7.404478614888738e-02   +1.000000000000000e+00   -4.703295080467668e-01   +4.593793884208137e-02   +6.604956432956851e-01   -3.265437666297901e-01; +1.820649770440954e-01   +6.313433991589799e-01   -2.091282845980443e-01   -2.242481939453387e-02   -6.971977763550743e-01   -3.234288088021073e-01   +7.409167894459733e-01   +5.292401756471017e-01   +1.714907454371489e-01   +4.614313542436496e-01   -2.618274673558857e-01   -6.341475054189578e-01   +6.530824949161250e-01   +9.882922639340957e-02   -2.353878438748332e-01   +2.574340719945149e-01; +9.651279838733408e-01   -4.353606652375409e-01   +5.258139927553916e-01   -4.302994115366180e-01   -1.622350565433574e-01   -1.993598431914236e-01   +3.177387800781164e-01   +2.336441437621264e-01   +7.688649644821499e-02   -3.299205937237105e-01   +4.825970972560376e-01   +3.869070897331432e-01   +6.817857384936020e-02   +7.262385562459204e-01   +4.563140916560648e-01   +3.563537693942150e-01; +1.130512030184535e-01   +1.524002972273949e-01   -1.263526561420543e-01   -2.410793255159061e-01   +3.393213772297796e-01   -2.848956646828928e-01   +3.527033258268225e-01   +1.646929526367835e-01   -1.275906048260722e-01   +3.681486778334130e-01   -5.899381949135869e-01   -3.497991398661289e-02   +7.108935428985116e-01   -1.181427912081130e-01   +3.951260747063878e-01   -1.468644442786471e-01; +8.951223625797545e-01   -6.826093036333526e-03   +5.269181921621813e-01   +4.690411652369200e-01   +3.352958748474530e-03   -5.957218198950930e-02   +4.366910886520799e-01   +3.873033708334856e-01   -3.321920940520635e-01   +5.963474602036959e-01   -2.239913098764014e-01   -1.574246804771498e-01   +4.122691782345855e-02   +5.738625069757742e-01   +8.457286878866380e-01   +5.186551251820773e-01; -4.920735312856533e-01   +3.526822322833935e-01   +4.700249224298810e-01   -6.821343531439085e-02   +6.278563189369364e-02   +6.743367770552572e-02   -3.015275550965941e-01   -2.204868908615427e-01   +1.954140467404480e-01   +6.868429216730596e-01   -3.861382968637811e-01   -3.867877662360130e-01   -9.088719520884059e-02   +6.461176239898445e-01   +3.430116535210161e-01   -1.893209590786883e-02; +4.127003282299204e-01   +4.556560015483632e-02   -4.168660941672211e-01   -3.057662763232612e-02   -3.516751485938089e-01   +5.744814154554068e-01   +4.406155932264822e-01   -4.876699098487741e-01   -5.555759602733161e-01   -4.070845125568390e-01   -1.204751621481082e-01   +1.900759242229665e-01   +7.737549020584264e-02   +5.385643152990649e-01   +4.923322683103533e-01   -3.842050503767384e-01; +6.864156213124133e-01   +3.790294225340900e-01   -7.905726052634383e-02   +5.206646777733134e-01   +6.631706495905837e-01   -2.197917643723035e-01   +2.757986085118050e-01   -2.288826732734566e-01   +2.955791102981903e-01   +5.400410309973916e-01   +4.082801111881517e-01   +4.804397308506108e-01   +3.896157184201863e-01   +9.073923295937693e-01   -1.971232332036391e-01   -5.738446298332607e-01; +2.167591949530657e-01   -6.553273755403148e-01   +1.685922950083739e-02   +1.783631122126067e-01   +5.165001695173757e-01   -3.963774070571799e-01   +7.546562526225678e-02   +6.679306077564073e-01   -1.861140484917602e-01   +7.469595579503978e-01   -6.111642286636647e-01   -1.989597151934651e-01   -4.059579972391316e-04   +6.186661496878996e-04   +8.576794011267406e-01   +2.584263418842448e-01; +4.827962116989044e-01   -2.599990438311785e-01   -1.060451514452911e-02   +6.271343397413462e-01   +5.537022084071907e-03   -5.287771823319683e-02   +4.285555302196178e-01   -4.637115587400604e-01   +3.814560900100081e-01   +1.160584233459426e-01   -6.009042501214148e-01   +7.573728426787845e-01   +7.553364048128121e-01   +1.017351012149740e-01   +2.356107381937150e-01   +7.268505594344170e-02; -1.209587821409854e-01   -3.150713880694249e-02   +4.004766686739493e-01   -1.868686439565135e-01   -2.332485735099981e-01   +6.784289377253583e-01   +8.410507559382574e-01   +6.171998597415363e-01   -5.859134726254599e-01   -7.069046567834287e-01   -1.305874324592532e-01   -4.495509697505179e-01   +8.508646950518471e-01   +1.491481601227469e-01   -1.896533872431972e-01   +5.356864191635805e-01];
L1E_L1I_iGABA_netcon = [+3.910212739585668e-01   +4.578798006392327e-01   -1.374823080294151e-01   +1.793517686747188e-01   -3.873574797832104e-01   -5.459453042110283e-01   +2.705046048277513e-01   +2.689046241235991e-01   +6.183473090694151e-02   +2.552091641818141e-01   +2.496076023994448e-02   +4.679855213814085e-01   +3.930257500270231e-01   +7.739113617788890e-01   -1.706950526060881e-01   -6.134337146537979e-01; +1.122025706948142e-01   +6.940465057679928e-01   -1.654819297544973e-01   -1.831611184987020e-01   -1.174322472949530e-01   -3.527721152361340e-01   +5.995326399673737e-01   +4.979060898300427e-01   +2.817273045584014e-02   -4.789934407576711e-01   +5.465279666591734e-01   +3.304595189318228e-01   +5.083032730705266e-01   +4.854880754399435e-01   +3.547750977655028e-01   -5.973006730648912e-01; +6.790504757666859e-01   +5.292089107512926e-01   +2.949701008880625e-01   +2.391633294904935e-01   -4.505979636321364e-01   -5.350125228775131e-01   +5.011779451773548e-01   -6.607804267123364e-02   -1.242398379140283e-01   +1.284845475181641e-02   -3.839220531456600e-01   +5.193471058401347e-01   -4.473818326774720e-01   -4.955155530996854e-01   -2.902571970757366e-01   +2.087154392175146e-01; -6.002567653364704e-01   +1.381649833685761e-01   -6.465792861268770e-01   +6.569560238721551e-01   +7.558027952138918e-02   +3.771206230680344e-01   +2.269969051655038e-01   -5.837887649695529e-01   +1.648264808620988e-01   -9.111083910115744e-01   +4.964025180726487e-01   +2.536358016809035e-01   +4.496731763946540e-01   -2.575381197974143e-01   +4.366675389390829e-02   -2.854421865248518e-01; -2.658450900366521e-03   +3.337661585403743e-01   -4.307868479977174e-01   -3.313426986226559e-01   -3.521683141952427e-01   +9.888673864429280e-01   -9.329585840503707e-01   +3.494065159635674e-01   +9.458537687388544e-01   +1.471691539575628e-01   +1.664645462157159e-01   +1.341782588844088e-01   +1.601923418986458e-01   -1.496423421360588e-01   -5.115549558129372e-02   +5.310900535719963e-01; +3.601810407775520e-01   -1.949834494948003e-01   -3.552949970255637e-01   -4.571647429209660e-02   +3.265034103915311e-01   +2.499907883821160e-01   -1.216910098532528e-01   +6.802408478180748e-01   -2.600700042399194e-01   -2.722395877817879e-01   +8.081398483326412e-01   +5.502269012698476e-01   -1.249627685717652e-01   -3.640943997536505e-01   -2.122776280153841e-01   +5.780531206251166e-01; -4.433447783605413e-01   +7.722476499429107e-01   -3.487901765780532e-01   +2.466304922863007e-01   +5.604536854165522e-01   +4.131031588649824e-01   -1.198645400135623e-01   +5.802001898797388e-01   -2.261645370026056e-01   -1.197733854059247e-01   -2.495756398660655e-01   +4.365094484000918e-01   -5.993505215124511e-01   +4.148441689654050e-01   +3.345806801397049e-01   +7.108037884762229e-01; +1.000000000000000e+00   +5.749245389121920e-01   +1.666786003186636e-01   +2.317504631209255e-01   -3.346549111732789e-01   +2.381804030949811e-01   -2.826048136944129e-01   -5.155871821105608e-01   -4.157153579034574e-01   +8.923344797534483e-01   -2.870879908175960e-01   +4.526612780852738e-01   -3.453078911447337e-01   +2.681121959443500e-01   -1.966761560160864e-01   +8.451881282512147e-02; +4.119476625952477e-01   +7.828667240069298e-01   -8.798671208944254e-01   +9.029599094879848e-01   +4.012655342241752e-01   -8.355893988973101e-01   -6.941160101359477e-02   -7.942878776589661e-01   +1.829825630413160e-01   -1.292493762067921e-01   -3.374938905653180e-01   +5.365025705423130e-01   -4.967559653880602e-01   +2.640243632012883e-01   -2.507631563531421e-01   +2.543631603496214e-01; -5.086139832604442e-01   +2.637092685925452e-01   +2.754684590511034e-01   -2.337249451455616e-01   -5.127274564241033e-02   +6.050936879133458e-01   -5.780686083704196e-02   -2.845616157470120e-01   -1.424411875706552e-01   +2.729380683713583e-01   +9.294268565482701e-01   +4.336999310967245e-01   +6.741376354557858e-01   +1.748222033070602e-01   +7.128509090988336e-01   -2.184810862939966e-01; +3.560631094564003e-01   +4.359930648555887e-02   +1.972649213296466e-01   -1.390165828813840e-01   -5.008515351440188e-02   +7.535664076465859e-01   -2.879292800779527e-01   +1.721407197077346e-01   -5.635479797395683e-01   -8.313986082662307e-02   -2.217978787031021e-01   +3.653673807647116e-01   -3.426622507114547e-01   +3.947950927660602e-01   -1.748749889251663e-01   -7.250374511902354e-01; -2.176024930844282e-01   -2.189797598498573e-01   +3.254695649466570e-02   -8.028334896248804e-02   +3.671112980512631e-01   -3.756387252823825e-01   +8.709400434544665e-01   +6.059293616134134e-01   -5.848230382787440e-01   +5.936505045709328e-01   +7.256864433958695e-01   +4.022110375553241e-01   -2.535431782858938e-01   -3.177854161491711e-01   +2.721056420159079e-01   +2.674273471812588e-01; -4.735831357714843e-01   +3.946700982347728e-01   -3.597905773583757e-02   -2.900948525393263e-01   -2.962365840879863e-02   -1.479262159748671e-02   -7.026312565581860e-02   -6.412938409165773e-01   +4.953524901295345e-01   -1.768344079331824e-01   +8.334043949274410e-02   +6.363376876736199e-01   -2.392834508428578e-01   -2.625357830117733e-01   +2.536812852688723e-01   +1.533737778213415e-01; +6.375379207256306e-01   -6.851123288571748e-02   -1.888274868637345e-01   +1.234394805257694e-01   +1.995988617550264e-01   +6.810443903233542e-01   +2.953345501907105e-01   +7.066531080830226e-01   -2.018828848627313e-01   +4.564073479195453e-01   -2.478024965748075e-01   +1.239323052098741e-02   +5.087051119224807e-01   +7.257216600745412e-01   +3.310095765259903e-01   -4.487614537655446e-02; -6.242759659510592e-02   +7.435721584338731e-02   +3.983045196466302e-01   +1.117836390123400e-01   -7.448981060676756e-01   +7.177758341788920e-01   +5.519908543438956e-01   +2.519936478281222e-02   +8.299843727095297e-01   +6.145220593311771e-02   +4.642866559372642e-01   -5.240913238727262e-01   +4.855369636790168e-01   -3.401380365827373e-01   +5.522162783219212e-01   +3.650278183539522e-02; +6.536591612256929e-01   +6.728426256212342e-01   -2.484909360488342e-01   +2.924946921401548e-01   +8.138892080772331e-01   +3.633998938728181e-02   -6.434611129794120e-01   +2.838831468250348e-01   -5.330266699254707e-01   -8.050908105778762e-02   -3.360571821131530e-01   +3.472498449333212e-01   +1.242772467254046e-02   -4.596218768146826e-02   -2.473722577500617e-01   +1.685915389902677e-01];
L2I_L1I_iGABA_netcon = [-3.129859445745468e-02   +2.401987811569541e-01   -1.496731741238134e-01   -5.637563904636117e-01   -8.224557747671272e-01   +6.459518505887818e-01   -5.928386371298422e-01   +2.862585502420079e-01; +2.434643943960273e-01   +5.423649272220542e-01   +3.061255982643074e-01   -2.943546827160798e-01   -3.360500307114295e-01   +2.432356693093061e-02   +1.072821653471499e-01   +3.243503292044352e-02; +3.985678392498491e-01   +4.565865251793233e-01   +9.414648455395410e-01   -1.658366412710912e-01   +2.968133996630172e-02   -2.376482215304811e-01   -4.914496304394984e-01   -3.770422056791426e-01; +1.000000000000000e+00   -3.570794921616775e-01   +3.575765626892721e-01   -1.964544791251495e-01   -2.216204298486322e-01   -3.640081128392696e-01   +1.828650401685594e-01   -1.634594125969250e-01; -9.338408917315039e-02   +7.882156561065834e-01   -5.856253445092773e-01   +2.265985000805137e-01   +1.534201965299204e-01   +4.920906870760625e-01   -6.634659025021918e-01   +5.432710543786877e-01; -4.675781632673558e-01   +3.681289554282562e-01   -6.730499818133312e-01   +5.120476805831311e-01   -2.549960422974459e-01   +3.254098873747630e-01   +6.579726281098376e-01   +2.345911531352238e-02; -6.413622417087420e-02   +1.150997704708271e-01   -7.879970744744772e-01   +3.321718661063162e-01   +9.555856955828747e-03   -3.602897732882533e-02   +6.081988925823333e-01   -4.104601044588174e-01; -1.880240051043343e-01   -2.341458137415598e-01   +3.158018608759181e-02   -2.055301814572729e-01   +6.090877335046885e-01   +6.141196315360171e-02   +5.250520667246575e-01   +1.116889816111309e-01; +1.342969957636796e-01   -2.636257878158655e-01   -4.473963730194560e-01   +4.848952890237413e-02   -4.869662800435539e-01   +1.564347696255641e-01   -2.227710910623140e-01   +7.265122686302272e-01; +5.465514789997677e-01   -7.837222717679827e-01   -9.993565200684124e-02   -4.148069648333328e-01   +6.521387689880191e-01   -7.112288504768307e-01   -2.224716276107563e-01   -5.484651728002125e-01; +8.991520796050981e-01   -1.890464524728210e-01   +6.858551277069719e-01   +1.087275314675701e-01   -2.307675355272725e-01   +6.455101564824800e-02   -4.233668098986645e-01   -3.475210774377962e-01; +2.836867996672370e-01   -1.731817088979657e-01   -2.928074824131049e-02   +6.777468819792770e-01   -1.466018897518488e-01   +3.535647891515108e-01   +2.204862339661914e-01   +1.568072598502538e-01; +3.465198348095930e-02   +7.938063384774076e-01   +3.582181492994516e-01   -2.654481157707160e-01   +2.619158333078090e-01   +4.115353401426444e-01   -6.208017352695467e-01   +2.490326963694274e-01; -1.898125013488305e-02   +1.721504694995956e-01   +7.873411693847494e-01   -4.979933588322540e-01   -5.425055359808055e-01   +2.149057762586584e-01   +5.806779303736496e-02   +6.394122028738768e-01; -2.206234569756650e-01   +8.310947321389202e-01   -4.325210962002352e-02   +5.941117582271804e-02   +5.219111015279656e-01   +3.102934690286694e-01   -2.631361600722052e-01   +4.936810277418797e-01; +2.957309776128232e-01   +5.233353070323288e-01   +5.330678405074728e-01   -5.275345260310363e-01   +6.373593916882138e-01   +1.684114237822592e-01   +1.254409958187869e-01   +6.704705829221485e-01];
L1I_L2I_iGABA_netcon = [+2.979217590474432e-01   -2.882947069694765e-01   -2.365587773789763e-02   -1.548472650716366e-01   +1.656389039808037e-01   -1.150897626514128e-01   +4.772024905959237e-01   +6.200823159972901e-01   -2.144104851636155e-01   -1.138294148972673e-01   +4.201757211808804e-01   -2.473968888071190e-01   -2.746836153090814e-02   +4.962154019960107e-01   -2.901915779416121e-01   +4.736191388000290e-01; +3.791361248280894e-01   -3.587391279260763e-01   -1.436533618103689e-01   +6.151489775786110e-01   -4.901478145772861e-01   +2.823598825912403e-01   +2.235129805926882e-01   +5.124757991529747e-03   -1.439787024084691e-01   +2.799440658763577e-01   -5.610171437657431e-03   +1.429322779136355e-01   +6.877544930833060e-02   +5.231603142613879e-01   -5.360526661831800e-01   -1.666958992601267e-01; -7.015697312422595e-01   +1.688424656424730e-01   -7.380472220964832e-01   -5.075136897897765e-01   +3.402495067037419e-01   +6.592214545667476e-01   -2.453924797202716e-01   +2.548883660760093e-01   -1.387342465900702e-01   +6.199937650404610e-01   -6.415716594805609e-01   -1.982850368897878e-01   +6.876790462108910e-02   +1.708141225154532e-02   -2.561707834136831e-01   -4.671195343495672e-01; -1.875208126383865e-02   +3.745269524859516e-01   -9.850899682423901e-02   +4.562001945851346e-01   +8.582754912885319e-01   +7.123353537005546e-01   +1.000000000000000e+00   -4.708278043588374e-01   -6.593547818110662e-01   -5.045613799336062e-01   -3.388073785489088e-01   -4.258308260474983e-01   -1.705970571867495e-01   -5.277780072545929e-01   +7.245579950995734e-01   +1.960501651807020e-01; -7.102559661760767e-01   +6.876739163724238e-01   +7.801503184515257e-01   -7.318123637284332e-02   -3.709355018441217e-01   -1.189150519364469e-01   -5.900369982782806e-01   -6.586989711953788e-01   -4.220304992694220e-01   -7.167329212854496e-01   +2.582755061154410e-01   +6.344295679075800e-01   +6.671803052881553e-01   +7.693138985011950e-01   -7.472548430711942e-01   -1.312493557710794e-01; +4.405077643187100e-01   -4.145033939267672e-01   -7.813561898373247e-02   +4.057583910974272e-02   +9.627923485531590e-01   +5.906250446393200e-01   +7.211939447421285e-02   -1.666876078063165e-01   -2.896918568230630e-01   -3.550045796465293e-01   +7.918909832450297e-01   +1.298275442246820e-01   -3.805173557681913e-02   +8.375614764864998e-02   -4.134046851184879e-01   -6.412130542057295e-01; +6.272681139253981e-01   +7.659406419732618e-01   +2.728210772616657e-01   -6.710847254850962e-02   -2.742040501672918e-01   +7.922569191080351e-01   +1.729761807741022e-01   -6.231019754534921e-01   +4.170948458317605e-01   -4.738676507597558e-01   -6.465449133102501e-01   +6.696285790973497e-02   -1.546348806863270e-01   +9.926361224124652e-01   +3.281045746118765e-01   +5.553589816859813e-01; -4.442487923486684e-01   +8.352860301509615e-01   -1.790762990028567e-01   +1.282225015035311e-01   +8.704251290935539e-01   +5.486377345631310e-01   -5.122264250539529e-01   +9.337789827240486e-02   +3.488489979080923e-01   +8.060532269383581e-01   +2.839778937199580e-01   -5.117670661590065e-01   +6.840559162699196e-01   -3.358972255322974e-01   +1.564243829393084e-01   +6.444285629246437e-01];
L2E_L1E_iAMPA_netcon = [+1.794882426834194e-01   -3.034790516575670e-01   -7.334548351533885e-01   +3.546971852669221e-01   -7.423205228719002e-01   +3.268721191756739e-01   +6.219117987452880e-01   +8.961254803616525e-01; -2.259271990323194e-01   +1.805629363898846e-01   -1.012770412141887e-02   -5.729298175325654e-01   +5.612390297065529e-01   +3.427351475012997e-01   +1.000000000000000e+00   -4.757090479790388e-01; -5.603725945105136e-01   +8.224067923518769e-02   +6.650305305258220e-01   +3.641075382395030e-01   +7.900940474444061e-02   +2.830890950968964e-01   +4.174818115128146e-01   +8.546874141120738e-01; -4.393249996031983e-01   -1.661534935553666e-01   +3.251172529846755e-01   +9.456099189043258e-01   +8.720753066020460e-01   +9.324399336675157e-01   -8.304022647292800e-01   -6.719340387032482e-02; -4.958699258333689e-01   +3.797323011880419e-01   +1.663869571298342e-01   +5.643477402747139e-01   +7.933259534718610e-01   +4.211157966885761e-01   -3.216533926234497e-01   +1.010042009490572e-02; -2.570228719686966e-01   +8.952893307655535e-01   -9.956125206053992e-01   +2.145986830525985e-01   +4.144159897272995e-02   +1.572575759576007e-01   +7.738689437177080e-01   +1.531680199642871e-01; +5.136138780475472e-02   +4.754557440312981e-01   -9.169589195221373e-01   +2.527274432603874e-01   -2.116131441273087e-01   -1.808851894708595e-01   +5.383757863952422e-01   +5.348932787697740e-01; -6.005446503674975e-01   +5.018206412466276e-01   -3.461414991302410e-01   +3.099689490402783e-02   +7.183052036100650e-01   -2.452977542497966e-01   +3.445432783382774e-01   +5.377921805033257e-01; -3.743699240837585e-01   +1.128115778081411e-01   +6.551662460922755e-01   -3.624121827391383e-01   -1.340381107331409e-01   +8.748924114635977e-02   -3.761183147235491e-01   +2.697557720890164e-02; -3.640054044675730e-01   -2.411152059793780e-01   -2.812468839114315e-01   +6.384330019739451e-01   +5.254165205662593e-01   +3.152764021149888e-02   +6.545105831058540e-02   +6.698096257634895e-01; +6.015200750104052e-01   +8.145189686793936e-01   +6.372788079746390e-01   +9.285492376761789e-02   -8.669669171525004e-01   -4.918905696529984e-01   +6.046963487490280e-01   -1.964496287966556e-01; -8.583314979774864e-02   -8.609014097002300e-02   +2.646257759327264e-01   +2.407293625648354e-01   -1.416228562442277e-01   +1.994901793465460e-02   +8.386415732847717e-01   -5.322463924039644e-03; -3.971854510173178e-01   +6.412236003694186e-01   -4.282252408775024e-01   -1.245518755674561e-01   +6.014238143331355e-01   -5.322610415677805e-01   -9.584511287885527e-01   -2.856685230091664e-01; +3.040388873255387e-01   +4.528705591877804e-01   +6.709416788599460e-01   -9.869380178707364e-02   -5.265636999902613e-01   +6.996570887661528e-01   +8.308563644833959e-01   +4.261128691433563e-01; +7.626674164874001e-01   +1.516166384567198e-01   +3.076491402549479e-01   -1.469810583675512e-01   +1.966396964006523e-01   -4.442128019474940e-01   -2.024756749211279e-01   -2.238701127377908e-01; -9.818599010875793e-01   +3.444948238507100e-01   +6.380648457708423e-01   +5.140424086915375e-01   -4.207324320782416e-01   +2.030664134019807e-01   +3.655779166593895e-01   -1.761264476057114e-01];
L1E_L2E_iAMPA_netcon = [+2.376112052460563e-01   +8.966836740940583e-02   +1.094145533930720e-01   +1.795280413792535e-02   -1.003963607731754e-01   +1.517264621872645e-01   +3.072652721661594e-01   +4.249951561581237e-01   -5.794998679134701e-01   -2.692018320433849e-01   +1.273027022592793e-01   -4.328888804171433e-01   -3.600812630692464e-01   -4.625679152892294e-01   +6.900500319371461e-01   -2.199756303549366e-01; -1.866099029149794e-01   +7.884878919418445e-01   +5.001977744287129e-01   +5.086368921002619e-01   +4.246401381500037e-01   +2.549478293976559e-01   +9.455709990897600e-02   +6.623503975916325e-01   -5.222439707546996e-01   +2.123382842634502e-01   -2.095049219755699e-01   +8.201980350729579e-01   +7.033452387601389e-01   -5.319252738421668e-01   -3.067260954938874e-01   +1.225780866905079e-01; +4.727215587921685e-01   -4.038227669055662e-01   -3.877052473879825e-01   +1.305968653670714e-01   +8.078618707127795e-02   +5.411986753701459e-01   +3.043436548553071e-01   -6.964580857822446e-01   +4.697529658821349e-01   +3.486314816612991e-01   -1.113197964872050e-01   +5.997842699779455e-01   +3.716135321566597e-01   +2.690619298277230e-01   +2.665345328294500e-01   -6.042111071681089e-01; -6.679032923360960e-01   +1.702784993292946e-01   +4.540750556943757e-01   +6.732228481429789e-01   -3.007361956684891e-01   +8.813908850592768e-02   +2.009626188494299e-01   -1.541238765544820e-01   -3.174190818218920e-01   -6.788404694320174e-01   -4.375684843562380e-01   -3.547165179757892e-01   +8.560921977804682e-01   +7.379995373414745e-01   -3.341383486342668e-01   -4.966069276816237e-01; +5.149992697973101e-01   -2.445476512778848e-01   +4.457524351161154e-01   +8.434993043999035e-02   +1.000000000000000e+00   +3.224760266030372e-01   +1.701813196143092e-01   -3.346403946462784e-02   -1.342485993734225e-02   -7.613591434188715e-01   +3.580362395173590e-01   +6.936394812855406e-02   -3.474369433604637e-01   +2.697911461801599e-01   -1.532884308810373e-01   +5.570881954956913e-01; +4.036588288216761e-01   -1.874741213572846e-01   -6.428569191313706e-02   +5.354197835269049e-01   +5.130507722672027e-01   +5.542854002883997e-01   +3.161787552985386e-01   -3.887078453865269e-01   +5.648625384011054e-02   -5.303197948711147e-02   +7.129968536032775e-01   +4.086813561715343e-01   +4.171890840006058e-02   -3.052001983210581e-01   +2.975827104679783e-01   +4.275304824971274e-01; -1.476817397522953e-01   -6.244866520983987e-01   +1.720941681563754e-01   -2.940465062925214e-01   -1.108568710344689e-01   -1.231015408971742e-01   +1.761197113550159e-01   -4.308104944339266e-02   +3.506354206165586e-02   -5.023013573278774e-01   +7.715848099978152e-02   -6.739135222533955e-01   -2.139979420300434e-01   -3.287922585875976e-02   +3.325031934164451e-01   +3.265913768034360e-01; +5.064774205418549e-01   +5.817228013375315e-01   +3.632988531619892e-01   -2.273221127872172e-01   -3.786554798578723e-01   -8.158313756721138e-02   -1.527231049408909e-01   +5.662426184905797e-01   -1.040052051031358e-01   +5.402379743281238e-01   +3.218915498636412e-01   -2.214593510926295e-01   -3.156839310878684e-01   +6.319926183660416e-01   -2.485361149253547e-01   -4.134128781127801e-02];
L2I_L2E_iAMPA_netcon = [-6.262936327222925e-01   -4.703308913646029e-01   -4.540995814535030e-01   -1.869307326548870e-02   -5.156522717371118e-01   -2.475238686397296e-01   +6.663003092995166e-02   +4.806665602795299e-02; +3.599594508968237e-01   +7.575855593496285e-01   +3.116100802871633e-01   +4.046144445135005e-01   +7.122458406871375e-01   -5.399459205762658e-01   +4.724402429578792e-01   +6.078549713989706e-01; +4.924828074179676e-01   +3.619377718463218e-01   +2.054344712307862e-01   -1.220246712628388e-01   -3.979299023830639e-01   +1.102721007737939e-01   +7.390423056826763e-01   +2.500567153646639e-02; -3.282050050629433e-01   -8.287572024178087e-02   +1.471808375220039e-01   +8.619188987942671e-02   +1.530784100323173e-01   -3.287501165491873e-01   -3.118264350696575e-01   -3.095913281928864e-01; +1.924554756461582e-01   +3.034278925037676e-01   -6.724209799505617e-01   -4.535258612330422e-02   +6.923378806963411e-01   -2.562661063204893e-02   +1.052417364869636e-01   +6.821692926676217e-01; +5.734186537437989e-01   -1.653549232703304e-01   -3.451943985644594e-01   -2.024527304241312e-01   -1.062329923163515e-01   -7.724787183810220e-01   -7.120371548818077e-01   +6.275047663031131e-01; +1.000000000000000e+00   +4.232182205068124e-01   +4.407433482784627e-01   +5.902991182721696e-01   +1.900753074572049e-01   +6.014814433910870e-02   -5.512239343093445e-01   -5.371968918702175e-01; +2.212851254300721e-01   +3.469427881735964e-01   -4.624734342896006e-01   -3.652663466612890e-02   +2.046754466322899e-01   +1.245131551461855e-01   -4.317322491941250e-02   +2.733521425547005e-01];
L2E_L2I_iGABA_netcon = [+2.306409338761503e-03   -3.785361570420749e-01   +2.952618279179433e-01   -5.840744898748760e-01   +5.110497478027851e-01   +2.134336953802288e-01   +7.825304153340000e-02   +4.224154065003952e-01; +8.950867011229970e-01   +4.633091660015813e-01   -5.260173694485422e-01   -4.508472131557534e-01   +6.692693431296824e-01   +7.444466344312832e-01   +5.457274877831511e-01   -1.146349268997541e-01; +5.392566679149826e-01   -3.867671417143113e-01   +4.515668849618087e-01   -3.945318576816379e-01   -7.117794961000519e-01   +2.112590957183495e-01   -2.720038472934605e-01   -2.542213368136749e-01; +7.376974325069401e-02   -3.509542935014145e-01   +6.655199930524809e-01   -4.345110616435386e-01   -3.781712338167897e-01   +2.628393837291481e-01   +9.845443830460022e-01   +5.350130612438123e-03; +1.005166923710627e-01   -9.070083023370930e-01   -2.739772598827311e-01   +9.678079567524267e-02   -2.725745785774163e-01   +1.588698165209425e-01   +7.033225174776716e-01   -6.046302915259185e-01; -5.019030108894299e-01   -6.169442602612608e-01   -4.785509879830331e-01   -5.503586889867651e-01   -1.912812081331825e-01   -2.803048968401345e-01   -1.225579497862309e-01   +2.723796612138678e-01; -1.964076007676155e-01   +3.727871095647081e-01   -3.616992641822849e-01   -1.700113813558368e-01   +6.200901583052708e-01   -1.598422481079080e-01   +8.223122349567000e-01   +6.388100280981246e-01; -7.014988691662354e-02   +3.328781986655119e-01   +7.316702333071321e-01   +1.000000000000000e+00   +2.752839515500809e-01   -1.167773108150451e-01   +3.557823004031418e-01   -6.126382170617980e-01];
L3E_L2E_iAMPA_netcon = [-4.644604002890812e-01   +4.022792223192463e-01   +3.300051969669821e-01   -3.986445197185470e-01   +4.007371654055744e-01   +4.968646286793859e-01   -5.011774010698485e-01   +5.508306940084338e-01   +2.997860076684803e-01   +6.015627592639011e-01   +6.220886848982059e-01   +5.032377974261560e-01; -1.384627107378733e-01   +6.280024022688464e-01   -3.371751262090608e-01   -2.202356237424404e-02   +4.014509146684364e-01   -3.756637382599961e-01   +4.551872478215740e-02   +8.866333077675466e-02   -1.323444776493714e-01   -6.069338409403823e-01   +5.569759821590325e-01   -5.167279424752671e-01; -2.589866293755435e-01   +3.604075011350799e-01   +3.596865850101557e-01   +1.934728391131582e-01   +3.215750905641835e-01   -6.357268388711060e-01   +2.981091038646729e-01   +9.983587594959340e-01   +6.407543602199937e-01   +6.669712076456225e-01   +1.598382045474669e-01   +6.609234044993850e-01; -3.238732757284357e-01   +1.365963966428090e-01   +3.321857686004032e-01   +4.901509059392378e-01   +2.228404009670716e-01   +7.192103320526249e-01   -4.009442215681232e-02   +1.168925264352502e-01   -5.631933865831825e-01   +2.832563960537020e-01   +4.836573494279900e-01   +4.832098288193699e-01; +1.709492744857492e-01   +2.648012419658589e-01   -6.898486941456278e-01   +1.256616171359382e-01   +1.524143386520857e-01   +6.035161751013279e-01   +4.268341747472820e-01   -2.506318790768080e-01   +5.579574970636244e-01   +1.232826891099172e-01   +2.509850759510741e-02   -7.840425512970073e-01; -6.018202638027365e-01   +9.696269336678830e-02   +5.730306027019328e-01   -3.847210400824849e-01   -5.344884743619686e-02   -1.489043029383130e-01   +2.166284344966914e-01   +7.784564569269736e-01   -2.256188637927707e-01   +3.072328029013425e-01   +3.496373587713358e-02   -5.215402907513322e-01; +1.954613057858622e-01   +5.097166392174997e-01   +4.067414690820652e-01   +9.236084340827948e-01   -9.134490073579607e-02   +2.592783669686649e-01   +4.220012354379053e-01   -3.021205761729043e-01   +8.665909767308392e-01   +5.940723640209749e-01   -4.704543499820221e-01   +1.000000000000000e+00; -2.322699146279312e-02   +8.048914108058538e-01   +8.283008990229742e-01   +3.760797997373223e-01   +3.050708635144732e-01   -2.508732900652509e-01   -3.770603296706494e-01   +5.410711966142464e-01   -4.620059467665391e-01   +3.572124537377423e-02   -5.808114718274328e-01   -3.347004358673903e-01];
L3I_L2I_iGABA_netcon = [+7.860121378851195e-01   +4.195192984727872e-01   +1.021825503853535e-01   +7.777893871401564e-01   -1.818938223274401e-01   -5.348002918277889e-01   -7.971279496390263e-01   -1.657265405807927e-01   +2.265105326977455e-01   -2.899781202235379e-01   +5.291277020728337e-01   -1.211522092777966e-01; -5.742153356002033e-01   +7.653859300422023e-01   -4.649479527228519e-01   +1.807431985470828e-01   +8.474756006559701e-01   -7.658822926307750e-02   +3.641991545292080e-01   +5.919398535830540e-01   -7.289862356477249e-02   +8.041584193300966e-02   +4.703153785438411e-01   +2.976129233505926e-01; +3.579191881654879e-01   +4.913645915417231e-01   +4.496382190446531e-01   +3.359684252179831e-01   +5.987108862518554e-01   +6.698722729877902e-01   +4.559478547226986e-01   +3.685346068851331e-01   +5.848625897067863e-01   +4.430133636957855e-01   +8.305021369248672e-02   +7.848209980739540e-01; +4.465915836710015e-01   +7.015752518826838e-01   +2.625952232674245e-01   +1.130084365897465e-01   +4.542981758558697e-01   -3.706757597143344e-01   +2.099513701835621e-01   +2.294056986648776e-01   -1.010191049634614e-01   -1.517327140064789e-02   -3.250616688659633e-01   +4.341479205754690e-01; -7.149227284529108e-01   -2.545220186357231e-01   -3.715437767198306e-01   +7.786640388495785e-03   -4.061247376971783e-01   -1.103098891810041e-01   +2.914549078188152e-01   +4.928850247583683e-01   -2.350692551564696e-01   -1.488339956806810e-01   +2.477479623169087e-01   -2.693230340738724e-01; +6.284362900753189e-01   +3.573878745115568e-01   +8.631744764622601e-02   +1.830318828518068e-01   +6.998036969788820e-01   +4.816198833598986e-01   -1.155887811327711e-02   +7.246271431856568e-01   +2.757447754457644e-02   -2.573148780463711e-01   -2.729768245043020e-01   -1.670313656750932e-01; +2.861478947460540e-01   +6.433794254541718e-01   -9.193812689986348e-02   -3.833160368955727e-01   +1.364275586782024e-02   -3.946529231663582e-01   -1.000000000000000e+00   +3.226771213740890e-01   -4.538197957685744e-02   -9.381848886534953e-02   +2.525778814864449e-01   +7.780215243900133e-01; -2.702455178544898e-01   -3.499747334945202e-01   +4.545444075934409e-01   -7.780045185037857e-02   -3.936911264268620e-01   -5.685136363386932e-01   -1.711083912763114e-01   +7.079726933974032e-01   +3.575571027442682e-01   +1.617680806875665e-01   -3.242101809227185e-01   +8.744529878923449e-01];
L2E_L3E_iAMPA_netcon = [-7.360168607569225e-01   -4.040302908959674e-01   +9.339197751665693e-01   +8.365092842562420e-01   -1.417105800280681e-01   -1.258253188076298e-01   +1.026842525993987e-01   -6.130521424297335e-01; +6.583016978743954e-01   +8.814754376814690e-01   -7.563939721674021e-01   -1.856730590995764e-02   -9.090078644123939e-02   +1.234913314990896e-01   -4.346591842774427e-01   +7.140429191684838e-01; -5.176450799890463e-01   -7.682987750084516e-02   +4.319986899096306e-01   -2.053535482124472e-01   +5.395683471866913e-02   -1.250297745790142e-01   -1.493978382475123e-01   +7.492611090776781e-01; -6.011664059315937e-01   -4.057222370353281e-01   +7.898121452629012e-01   +7.816350781065458e-02   -1.914307112334537e-01   -6.058462167594694e-01   +6.607169254977585e-01   +2.984870936884775e-01; +3.231783930261225e-01   -7.897710885236473e-01   +7.814088467572108e-01   +8.705861526047315e-01   +6.292290868308850e-01   +2.783113102758870e-01   +1.000000000000000e+00   -2.103645762946474e-01; -5.191489630233285e-01   -3.052083244151360e-01   +7.554909965298895e-01   -5.823592783696904e-02   +6.874928297944779e-03   +8.394307482726647e-01   -7.492935042816129e-01   +2.980084882357358e-01; -5.122734924354766e-01   -4.466061716531462e-01   +7.012363555711594e-01   +7.226391680453144e-01   -6.990198817860467e-01   +5.688091314447916e-02   +4.033932694771700e-01   -7.369185282536060e-01; -2.969978366850061e-01   -7.005480077367371e-02   +3.020378971930074e-01   +1.917497289840359e-01   -4.886894967065127e-02   -4.568319434507693e-01   -1.046072196015085e-01   +2.097883568928433e-01; +2.503483835627802e-01   -6.838790820811523e-02   +6.773943700044258e-02   +3.806376803288442e-01   +8.448066933391041e-01   +7.544835848029662e-01   -2.009555662732257e-01   +2.244805614137834e-01; -3.514155317346748e-01   -5.054179304736497e-02   +4.335994572133417e-01   +4.516068460935399e-01   -4.583831976824493e-01   +7.179106122077609e-01   -2.713835694735909e-04   -2.659011357184818e-01; +3.600579533528386e-01   +4.072397800422160e-01   -9.678804543483215e-02   +2.125563973103076e-01   -7.330062734880467e-01   +7.001869216105674e-01   +6.065763917287216e-01   +1.987416788297612e-01; -5.442405926249199e-01   -5.421810619690892e-01   -6.883573536120541e-02   -3.380876321987367e-01   +5.117952101554780e-01   +7.429942077910116e-01   -7.681539548639512e-03   -3.292681973911815e-01];
L2I_L3I_iGABA_netcon = [-3.065386844645155e-01   +6.040353423155865e-03   +1.097711240457440e-01   +4.969478795868050e-01   +3.076496662163917e-01   -2.661269485646492e-01   +6.474631536569690e-01   +4.883784876357487e-01; +2.363875780503006e-01   +6.168517454083344e-01   -8.775782499722069e-02   -1.572397608134189e-01   +2.025658389145858e-01   -5.033385867428002e-01   +7.546530505707827e-01   +1.753812161781819e-01; +7.991412451580018e-01   -7.813323391500741e-01   +6.179021462447799e-01   +5.722688301989308e-01   +7.268968254284477e-01   -2.226073974538680e-01   -9.162135463302032e-02   +5.589402968552122e-01; -2.938368687812997e-02   +1.699873479091582e-01   +4.276934259148371e-01   +1.308549114187644e-01   +6.065751971585526e-01   +4.958162712267294e-01   +7.379911278770971e-01   +2.972310981851469e-01; -1.941009855709009e-01   -2.320619489588857e-01   +9.404056700654825e-02   -4.845795542154147e-01   -2.111122234553572e-01   -1.572190732553834e-01   +1.352396116534485e-01   +6.811273819402469e-01; +3.612942918887315e-01   +9.070862776036552e-01   +8.658624272473038e-01   -6.595556118939502e-01   -1.308457461788852e-01   +4.273316192895225e-01   +4.532060310426883e-01   -2.907177216063074e-01; +5.289477510001213e-01   +4.449253665043420e-01   +1.000000000000000e+00   -5.665316296052594e-01   -6.391419655122950e-01   -8.051179062976485e-01   -2.403762509033784e-01   +6.021244474072184e-01; -5.175962076678147e-01   -1.006461912387348e-01   -3.585358092373550e-01   -4.228478827842682e-02   +6.066787692644883e-01   -3.360848014188895e-01   +2.904549737196595e-01   +3.711438020650000e-01; +6.372141844941279e-01   +5.672560445143319e-01   +8.860529668669935e-02   -2.777918050425930e-02   +9.172244719445673e-02   +3.188989918868221e-01   -2.220785945232312e-02   +3.903683322905258e-01; +2.351229694235409e-01   +6.615654063288247e-01   +2.099532901344030e-01   -1.460930659456149e-01   +3.415772297775732e-01   +2.994840785598995e-01   -4.542212946350170e-01   +3.593062898667505e-02; -3.263943725874540e-01   -5.259797431950547e-01   -3.760422033926870e-01   -4.599411729105051e-01   -3.177373767628230e-02   +6.245243421433122e-01   +8.005079139459931e-01   +6.333070685473377e-02; +2.855012420639131e-01   +2.822543585621580e-01   +1.580029317846297e-01   -3.352572447115702e-02   +1.206217880408098e-01   +5.141005395557086e-01   +9.730086817646946e-02   +4.487446857279301e-01];
L3I_L3E_iAMPA_netcon = [+5.352762136109080e-01   +6.474940541010947e-01   -4.800902430829884e-02   -6.213717577459160e-03   -2.198131784075447e-01   +2.442959715147981e-01   +4.122162187130418e-01   -4.680279945305119e-02   +4.152827583424965e-02   +7.198766603705383e-01   +7.221189921867650e-02   +1.566811377819438e-01; -2.207210687228599e-01   -7.024287060746989e-02   +6.106092016073821e-02   -3.789484083966007e-01   +1.822455138268374e-02   -1.135262884103289e-01   +2.473789328314197e-01   -4.342866269661103e-01   +4.442607699455361e-01   +6.335126977621460e-01   -1.074380052705834e-01   -1.282197971419226e-01; -2.647795480217437e-01   -4.324445955357641e-02   +2.186595657527213e-01   +4.461407239678729e-01   -3.029724915888976e-01   +8.158396464317188e-01   +5.832970463699125e-01   +4.628780280022720e-01   +2.948055837954288e-02   -2.077393318140202e-01   -5.652766313510997e-01   +6.691715338998486e-01; +6.343438437598541e-01   -3.619186394458997e-01   +3.200785779329577e-01   +2.956981039415023e-01   +6.895644212783772e-01   -2.323310083311877e-01   +1.457652513291549e-01   +7.357768834397221e-01   +1.529122839795824e-01   -3.376589343585774e-01   +1.414736695880579e-01   -2.231812349588745e-01; +5.274251962214502e-01   +2.440022432622107e-01   +1.131565587799425e-01   -2.478841398058261e-02   +5.049849610427862e-01   -3.105607445276395e-01   -6.226932652557879e-01   -3.922227017774032e-01   +5.845093940284430e-01   -1.441872389771910e-01   +1.000632767444589e-01   +1.273728124014066e-02; -4.354833134135270e-01   -4.667654928460147e-01   +3.904593521883914e-01   +3.808203410533575e-01   +2.708871949005827e-01   +5.453059315456139e-01   -2.401011898390225e-01   -5.702073290401202e-01   +5.664659123231889e-01   +7.368994257746218e-01   -5.375648663505640e-01   +4.818543808193156e-01; +4.507543309356932e-01   +7.610531814444291e-01   +5.099366450580447e-01   -2.368850293077045e-01   +1.709947423871506e-01   -1.263515173344572e-01   +5.792308884301394e-01   +5.253807440319493e-01   -4.583068081308504e-01   +4.791222646440709e-01   +3.313594985129745e-01   -7.140744876576467e-01; +3.857989438400210e-01   +1.000000000000000e+00   +3.329764778328882e-02   +3.122685203390871e-01   -2.134429063777978e-01   -6.730766629919519e-01   -5.581879151223622e-01   -2.129682172912609e-02   +9.733134523275896e-02   +4.520644248265018e-01   +8.045071524497783e-01   -3.847995583934838e-01; +3.981184490965659e-01   +7.497225705847187e-01   +7.526836960530452e-01   +2.941023922499876e-01   -3.702420812759424e-02   -2.083529223756043e-01   -1.974583752157652e-01   -2.151484445768855e-02   +2.519938506409372e-01   +1.407076222179390e-01   +3.361126842590166e-01   +6.507611386229080e-01; -1.100792114517777e-01   -4.913046268684398e-01   +4.512078588845638e-01   -2.609269397826496e-01   -2.266660114582648e-01   +5.838144771280197e-01   +2.431258908676313e-01   +3.367705607438630e-01   -2.266399463016412e-01   -4.635341083526963e-01   -6.651501680474832e-01   +9.985595876886501e-01; -2.585834098080376e-01   +7.961752526344238e-01   -1.347386107652079e-01   +5.907053602596674e-01   +5.051495613580699e-01   +2.591243022361159e-01   +2.537078676885984e-01   -9.224237437568082e-02   +8.784452936063715e-01   -2.265073119973462e-02   +9.495616872906654e-01   +6.273733806959858e-01; -4.546581924744069e-01   +5.945809368771108e-01   +6.953005605834421e-01   -5.068958043754801e-02   +7.292297437994687e-01   +1.507209617852516e-01   -3.290317588403778e-01   +1.819423557242850e-01   -1.581508655732808e-01   +4.656155648961135e-01   +1.765203579741503e-01   +6.711228542942455e-02];
L3E_L3I_iGABA_netcon = [+4.541443393474824e-01   -4.088182335405450e-01   +7.977125070255651e-01   +1.924052246226845e-01   +2.506629172134471e-02   -6.301241522350634e-01   -5.608587888373631e-01   +3.090637213672927e-01   -4.283194514116634e-01   +6.666495457187733e-01   +5.026554310844619e-01   -7.611567156413490e-01; -6.055321153192540e-01   -6.693567902514896e-01   +3.903048673584880e-01   +1.717772250826596e-01   +2.702070743691209e-01   +8.497048230171784e-01   +3.692585328813562e-01   -4.197585376641244e-01   +2.405590295684878e-01   +4.853519230983142e-01   +6.728689944337390e-01   -6.384576658147392e-01; -2.016688065241941e-01   +1.526340449400028e-01   -3.728177928496444e-01   +1.865418249727813e-01   +3.067109892232648e-01   +7.861566137889073e-01   -4.858755344446494e-01   -1.428157275508326e-01   +5.273988440824198e-01   -2.244476131158648e-01   -5.867989631637925e-02   +5.909129494212760e-01; -7.665068413539949e-01   -8.080260761765117e-01   +5.617826462283377e-02   +8.803297708221380e-01   +9.262412893178610e-01   -2.121553206167765e-01   -4.492077026964150e-01   +1.987843339773404e-01   +5.759482611450757e-01   -4.415819458594991e-01   -4.247938319716080e-01   -1.425743910217945e-01; +6.446352675823849e-01   -1.052045541026658e-01   +3.970601790956213e-01   -4.357023867217535e-01   +7.871135152893909e-01   +8.217829906211552e-01   +4.996588048559104e-01   +3.006874330724181e-01   -5.049733669354287e-01   -1.634134460510889e-01   +8.708997795841129e-01   +4.415444274263552e-01; -7.809069070934214e-02   -1.980465869885878e-01   -3.547291502481607e-01   +4.835121949074144e-01   +2.697756927721693e-01   +6.120647138337323e-02   -8.438245572704092e-02   -9.713273525211644e-02   +6.149446163399626e-01   -4.912719752172308e-01   -2.170970088010516e-01   -1.760312773847094e-01; +7.721608810881355e-01   +2.361565290228954e-01   +6.582751110918755e-01   -6.193742266173151e-01   -6.207066933620070e-01   +1.169951181628595e-01   +9.630957438782820e-02   -1.175172897539222e-01   -2.785613416769628e-02   +3.502164965941443e-02   +2.656380082635377e-01   +5.808236601477639e-01; +3.061254061229566e-01   -3.141389637194238e-01   +5.395191512316505e-01   +2.013648651620099e-01   +6.944198257251881e-01   +7.838116865375351e-01   +8.205299441644008e-02   +6.396568097092658e-01   +1.053814108270204e-01   +1.756387719954689e-01   -5.604462765553623e-01   +3.443307861101909e-01; +4.841698949264481e-01   +4.468889450543506e-01   +6.824826283179983e-02   -4.126561701688522e-01   -2.591254553979893e-01   -1.596964109053640e-01   -2.052844032892230e-01   +2.464450157706980e-01   +6.310939013035775e-01   +8.685081222750695e-01   +3.948613528036009e-01   +2.418795970929786e-01; +3.395451496102803e-01   +4.301141796927068e-01   +7.503976277620972e-01   +3.570449416536718e-01   +5.159854544456548e-01   +4.050449320960833e-01   -2.662345100305621e-01   +3.091646458336444e-01   -3.662846642624257e-01   +8.217440438174249e-01   +4.365223451349496e-01   -3.460602551239180e-01; -1.966349895107371e-01   -6.557610195317222e-01   -4.089998856468036e-02   -2.890777605452956e-01   +1.000000000000000e+00   +8.066980600826243e-02   -5.000857512647274e-01   +1.222432092296304e-01   -5.537260064667089e-02   -7.118685429990879e-03   +2.530137554864934e-01   +6.889049548874576e-01; -2.112696459226537e-01   +4.815710140276095e-01   -3.896103076287574e-01   +3.388392406674080e-01   -7.114817709537348e-02   -5.575344477728605e-01   -3.001743941907126e-01   +9.326871393866297e-02   +4.699147261596192e-01   +7.093049061523922e-01   +5.977827896424323e-01   +7.047855337673340e-01];
L2E_Input1_iAMPA_netcon = [+5.781597614053142e-01   +1.630070972955006e-01   -4.294827034937096e-01   +6.505195298733996e-02   +1.697319010923211e-02   +6.259952992842615e-01   +1.000000000000000e+00   +4.708810003480540e-01];
L2I_Input2_iAMPA_netcon = [-3.071619923732577e-01   +7.580958471117885e-01   +4.598614016157590e-01   -4.894188973695388e-01   -1.000000000000000e+00   +3.130826975913750e-01   -6.055837431435753e-01   +5.617460217920035e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
