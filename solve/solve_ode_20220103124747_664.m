function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.590769026523887e-01   +7.868860553257808e-01   +9.266638040316214e-01   +1.901519775953177e-01   +2.271060888644899e-01   +7.542891939551674e-01   -3.490328219406415e-02   +4.432849612514979e-01   +3.362692590028942e-01   +2.184308930232101e-01   +3.799613378178259e-01   +1.813560026402681e-01   +4.968115965090678e-01   +2.746767532634615e-01   +2.427994671728032e-01   +1.988941718736079e-02; +1.147811704718891e-01   +9.935507711436088e-01   +8.831546502534973e-01   +7.812344885290702e-01   +3.628437847186372e-01   +7.221531237224444e-01   +7.299486189059911e-01   +1.458187654057378e-01   +8.392755604853357e-02   +7.592832105091192e-01   +5.667428000948198e-01   +6.695090546044826e-01   +5.306845544488595e-01   +2.741653057682282e-01   +7.084279159585471e-01   +2.747311870757402e-01; +2.802527752160573e-01   +3.598329995444156e-01   +4.001009239627501e-01   +5.940233297922132e-01   +5.276378078577337e-01   +4.612564240959724e-01   +4.210820948825444e-02   +6.948538595559844e-01   +3.451039419851125e-01   +5.302608302426682e-01   +8.825445540292541e-01   +2.345884474675323e-01   +4.995718363818446e-01   +5.108179554375484e-03   +3.946550668861473e-01   +9.476893925659623e-01; +2.464821192709835e-01   +6.109894142001979e-01   +1.126283574220418e-01   +2.399444412085854e-01   +9.271947917506522e-01   +8.388740001799216e-01   +2.502888707490832e-01   +5.910734861350894e-01   +7.485497700892610e-01   +2.625443768598629e-02   +2.038455124563206e-01   +8.875089266618368e-01   +5.710295506799352e-01   +1.580231905143718e-01   +6.466819942365095e-01   +4.693884149979568e-01; +8.155523315486897e-02   +7.487613770622421e-01   +8.769416087373458e-01   +8.077927360100584e-01   +5.410421829762573e-01   +3.433937611916654e-01   +4.716161632157270e-01   +2.431176564699606e-01   +3.007147714913503e-01   +5.165759111862761e-01   +2.407043711852234e-01   +6.299645024249555e-01   +3.968195601275442e-01   +8.231979123738308e-01   +2.241003555683859e-01   +9.121586514454773e-01; +1.130110164301596e-01   +2.240442720413029e-01   +7.857518441163202e-01   +8.082428607058545e-01   +6.445683022047253e-01   +9.053204666520105e-01   +3.490122571178180e-01   +4.039743449013278e-01   +8.294164094786737e-01   +8.955515095181099e-01   +8.850953918577755e-01   +2.264747574964223e-01   +3.882341615467732e-01   +1.298812688074426e-01   +9.145415337671916e-01   +3.759210675111998e-01; +2.896437486335810e-01   +8.053880198713329e-01   +5.302679107082750e-02   +3.760702288628030e-01   +8.832339412336677e-01   +5.752372715528729e-01   +4.848342153195259e-01   +6.298047970984644e-01   +8.906157750685855e-01   +9.525397529585589e-01   +6.982802233746219e-01   +6.551440202347349e-02   +3.896710534290828e-01   +3.728050844092591e-01   +7.154063204343777e-01   +9.140675675557525e-01; +6.871431300065632e-01   +7.643074796773133e-01   +7.786093624746273e-01   +3.686544956789221e-01   +6.207053508439612e-01   +4.595091051178111e-01   +5.654973885810274e-02   +3.937082516878256e-01   +1.000000000000000e+00   +8.867933685155825e-01   +2.147273083368103e-02   +7.354725569601570e-01   +8.467728252176944e-01   +6.009388836673714e-01   +3.017228814444818e-01   +8.846756503034828e-01; +5.153910844914291e-01   +5.002634873155909e-02   +2.898965112646566e-01   +4.279638165494899e-02   +5.126805165517221e-01   +1.114796008279302e-01   +1.632997452147217e-02   +5.859458979478988e-01   +4.924141719763740e-01   +8.238645516897272e-01   +7.608681040002272e-01   +5.483048038574677e-01   +3.523794879082545e-01   +1.902700167110196e-01   +9.917646598524373e-01   +7.326118156012021e-01; +7.183956322619773e-01   +4.888916497285352e-01   +5.677707432727116e-01   +2.686754527575559e-01   +4.354949097730806e-01   +3.639084814295776e-01   +9.374478834911178e-02   +2.663962477049903e-01   +6.231589522854199e-02   +8.490804722278983e-01   +6.985246938144880e-02   +8.754539428451846e-02   +3.136074573330471e-01   +7.668055338394384e-01   +2.649395270153038e-01   +8.884681108389988e-01; +4.835331052238619e-01   +1.506748980192678e-02   -4.601320354817724e-03   +1.310284023146516e-01   +9.382502836501203e-01   +5.755302561105925e-01   +2.723960017221283e-01   +2.149364720728534e-01   +2.127524243011347e-01   +8.979435006062088e-01   +9.647437092750671e-02   +7.904950828334519e-01   +5.553036944591977e-01   +8.881993652572596e-01   +4.414768645687923e-02   +1.267818176174537e-01; +1.379805321105090e-01   +9.308199232670195e-03   +9.364969775509835e-01   +5.045528230071042e-01   +6.377640225575411e-01   +5.642594981598672e-01   +7.148253149187074e-01   +3.897287700636944e-01   +6.025943002039943e-01   +1.353217903793308e-01   +3.567537517819935e-01   +8.194936128135351e-01   +8.556705407989935e-02   +4.736645782294006e-01   +3.981258003406234e-01   +1.065253963002713e-01; +4.902747262847518e-01   +3.510546352747742e-01   +6.673721322044415e-01   +2.816589460859502e-01   +1.818023488208318e-02   +4.867917209742729e-01   +4.737467967518494e-01   +7.706643134999702e-01   +2.367984267924649e-01   +9.352207779567050e-01   +1.499687036777532e-01   +4.552707001769677e-01   +2.452177090386879e-01   +1.956743395199396e-01   +3.613170231336706e-01   +2.162923396385747e-01; +1.107793123335471e-01   +8.820170664897614e-01   +7.898144376519122e-01   +7.673514063372119e-01   +7.818547665559559e-01   +5.692024461530064e-01   +3.248145511562198e-01   +8.183053314613160e-01   +3.750684980634251e-01   +3.995240420834584e-01   +9.095686215227516e-01   +6.156283823587068e-01   +6.249137372331401e-01   +5.290849520897483e-01   +1.190215118754246e-01   +3.488304480860127e-01; +1.420998248032965e-01   +2.700144771952523e-01   +7.092083619797519e-02   +3.885654204817532e-01   +4.317918906776260e-01   +1.115177693459147e-01   +6.551822508109575e-01   +2.961105993069029e-01   +8.636182451783179e-01   +5.405220587846761e-01   +9.245084260268761e-02   +8.740841804525777e-01   +6.487613871509122e-01   +2.102134960636300e-01   +7.043506986367485e-01   +1.447382788020233e-01; +5.667756186908107e-01   +2.892871255635704e-01   +2.941767276854307e-01   +6.502111371883741e-01   +5.508903118278961e-01   +6.575159408609680e-01   +2.422177480725523e-01   +9.634379243072912e-02   +5.659093528137707e-01   +4.527874143368549e-01   +1.621443729487189e-02   +4.280575436223461e-01   +1.945062561462964e-01   +9.641835187295484e-01   +9.214765062972148e-01   +2.025660801181556e-02];
L1E_L1I_iGABA_netcon = [-1.794496809109929e-02   +2.890182585906078e-01   +9.237874158305328e-01   +2.841744383001523e-01   +4.188231121953619e-01   +1.247362613583513e-01   +2.887600825067412e-01   +3.834493057653441e-02   +2.204568242049942e-01   +6.061364289385993e-02   +4.670000597238768e-01   +9.721845074987435e-01   +1.651096086468442e-01   +8.448250113865885e-01   +1.053255830826280e-01   +4.349989257332970e-01; +7.497659126865991e-01   +7.989124383547734e-01   +5.186537475884037e-01   +8.676382883166349e-01   +7.649549061067303e-01   +8.677243616145047e-01   +6.456887106462370e-01   +8.836760361068670e-01   +9.658031555484727e-01   +9.443825742270541e-01   +1.362045437032547e-01   +1.145304459572314e-01   +6.208809455058260e-01   +9.608734744884092e-01   +9.978927524347182e-01   +3.003139759722142e-01; +3.379543713205099e-01   +8.266333619035917e-01   +1.042621181655080e-01   +8.884090250650407e-02   +1.188682212167261e-01   +2.377866760388320e-01   +5.961310598519091e-01   -2.158197717144103e-02   +8.451958089395432e-02   +1.053730572661139e-01   +5.328203043834912e-01   +4.256653130922011e-01   +8.409245824157129e-01   +8.097558791434640e-01   +8.010569352166249e-01   +7.378596608832672e-01; +3.585486950806203e-01   +5.086030428332791e-01   +6.310854419927275e-01   +7.687859334097045e-01   +6.619425981340294e-01   +6.496088594320316e-01   +6.076441599416265e-01   +8.716040778189611e-01   +6.665871947417783e-02   +3.248025537556437e-01   +5.308945735451717e-01   +2.177662975134006e-01   +8.036062708715788e-01   +4.373929758669329e-01   +9.174394917592393e-01   +5.334862072827792e-01; +7.593542675624484e-01   +6.151475447211896e-01   +8.387893680963419e-01   +3.582998691090266e-01   +9.911561577997926e-01   +5.363733817770583e-01   +3.400455923601441e-01   +4.720436822770820e-01   +2.846198854181009e-01   +1.004665524543701e-01   +4.959354355841707e-02   +5.720142118574891e-01   +9.289384239740135e-01   +7.700247237201472e-01   -9.244678071048847e-04   +1.777319186466282e-01; +2.627589334095660e-01   +9.319039986830181e-03   +2.590511157110881e-01   +1.588082503699538e-01   -8.589354136481465e-03   +4.366064378493868e-01   +9.284979435266002e-01   +3.122631205251327e-01   +5.531071853236010e-01   +3.946577146837978e-01   +9.155495948910880e-01   +2.021779396505245e-01   +2.836668365127836e-01   +2.376288657142493e-01   +7.317320084237828e-01   +4.228176592662051e-01; +6.680412552520386e-01   +5.460887694714164e-01   +3.315824692851559e-01   +8.013947869612681e-01   +2.893329169315936e-01   +8.746248731576624e-01   +6.740951871716291e-01   +5.370855082076412e-01   +8.498102280172819e-01   +6.375231594502834e-01   +9.114279508936184e-01   +3.255068500303008e-01   +7.964791317193795e-01   +6.198820947329255e-01   +9.478199576348972e-01   +8.002689200812915e-01; +9.865849844517375e-01   +1.433984865537287e-01   +5.569211589375092e-01   +4.991103951148023e-01   +6.354800365776426e-01   +2.090444354349600e-01   +3.324471179810254e-01   +5.848107400973801e-01   +2.091003392147095e-01   +8.072224536877595e-01   +7.700940401151402e-01   +9.333618771127167e-01   +3.042802838127483e-01   +7.818942125547195e-01   +4.756809097530700e-01   +5.839787032083381e-01; +5.371970193100903e-01   +9.898872931457666e-01   +3.803167709412636e-01   +9.538611318428790e-01   +2.213364586773891e-01   +7.020226978467489e-01   +6.120584019921839e-01   +9.915891427683979e-01   +8.414068646272944e-01   +1.239727679542855e-01   +2.099727997542457e-01   +2.172153313893660e-01   +8.868732223114741e-01   -7.005686217028800e-03   +6.873499899232578e-02   +4.537354724555359e-01; +2.674790315776984e-01   +3.878764703246083e-01   +5.346025938247718e-01   +3.138918179802106e-01   +8.094689657628236e-01   +3.992795587840628e-01   +3.275946926433251e-01   +8.582639657076451e-01   +9.167539551860110e-01   +8.966889176842852e-01   +8.159187346046266e-01   +9.192571433931868e-01   +4.861040006574672e-01   +3.905613629990673e-01   +3.467445459273245e-01   +8.568603783060214e-01; +1.248771381531648e-01   +2.166547257723636e-01   +7.982472250962271e-01   +9.232481662044599e-01   +1.395986484319005e-01   +6.355204544956632e-01   +7.508166836150182e-02   +4.591285008731275e-01   +3.845234184792959e-01   +6.947865500161077e-01   +3.147621198628588e-01   +8.904209081867765e-01   +7.705172135999604e-02   +4.965403231179912e-01   +4.617149754517431e-01   +4.969516553143660e-01; +1.462337633411868e-01   +9.291795690012434e-01   +7.549146540794789e-01   +4.898958249864294e-01   +4.836374243652909e-01   +6.781716913134335e-02   +1.591402620886642e-01   +3.366602758185399e-01   +1.225174991433459e-01   +5.563345445677292e-01   +2.860760214076580e-01   +4.348757419288222e-01   +3.821274440363773e-01   +8.868359351876304e-01   +2.829719077007845e-02   +4.993607221948704e-01; +9.073986267541889e-01   +1.438637506948618e-01   +4.819218266846585e-01   +5.509350385163951e-01   +6.600172231946668e-01   +5.898889251089795e-01   +1.938286674901185e-01   +5.544277987609748e-01   +5.318128247714697e-01   +3.247463969809930e-01   +9.430188011540338e-01   +9.682254827124750e-01   +8.714196436961151e-01   +5.901463268804061e-01   +2.794670651456364e-01   +7.950468910365081e-01; +4.219746875987629e-01   +8.499276488650847e-01   +2.933634368056414e-01   +3.832313990659514e-01   +7.345706990708254e-01   +1.857094563150141e-01   +3.799765924162999e-01   +6.296941293672047e-01   +3.334316675454504e-01   +4.733349094147158e-01   +1.883412693823815e-01   +1.373787831833119e-01   +2.915512388199897e-01   +2.408409748996371e-01   +5.853130194371320e-01   +9.164377218360661e-01; +6.172120464218898e-01   +5.983727301606623e-01   +6.428141604947427e-01   +7.128626617146736e-01   +8.140840071843201e-01   +4.960420683793269e-02   +8.488948618755248e-01   +3.379461862241380e-01   +8.263059821285520e-01   +4.721623461840348e-01   +6.805014813840182e-01   +5.614760925083557e-01   +2.479572192401334e-01   +4.853519261814261e-01   +9.032678812791158e-01   +4.778105612818599e-01; +4.122827387714708e-01   +6.065458648501341e-01   +6.123542766547679e-01   +2.892019461184739e-01   +4.813477176112798e-01   +2.957585118227252e-01   +5.733924850233991e-01   +2.563156356208763e-01   +8.600415459998850e-01   +2.766191368680155e-01   +2.435882293902016e-01   +1.330872288135174e-01   +6.927693480785049e-02   +4.914182055770105e-01   +9.156941749964945e-01   +9.477544791709610e-01];
L2I_L1I_iGABA_netcon = [+6.910904080315959e-01   +5.208971574793230e-01   +7.362980775406663e-01   +5.526962004222131e-01   +9.583176020240485e-01   +7.323943883576091e-01   +9.247783018934043e-01   +4.727779768470428e-03; +5.435137246957260e-01   +9.102196484547247e-02   +1.852476289814609e-01   +8.823139656428203e-01   +2.021240850878765e-01   +6.267514797668439e-02   +8.964736965172443e-01   +7.697653409892774e-01; +9.964484715822309e-01   +5.216909517175025e-01   +6.749685162328705e-01   +6.717805157332418e-01   +8.374682559258668e-01   +7.566363313308759e-01   +2.804989190768745e-01   +2.072510957909742e-01; +3.888529169062653e-01   +1.698776586519057e-01   +9.335073048198529e-01   +4.332149429493001e-01   +7.936330122475284e-01   +3.643926183863807e-01   +9.013062199027174e-01   +1.950576091681557e-01; +7.561028737016758e-01   +5.115417128796212e-01   +6.510566754894875e-01   +2.604887908429686e-01   +9.310476548861570e-01   +4.152771690861482e-01   +6.032690713140808e-01   +2.147798141371526e-01; +5.631115769221873e-01   +5.847121878156667e-01   +7.755895952135927e-01   +2.330330984254985e-01   +1.853779491430192e-01   +8.107230763980703e-01   +9.834187835031087e-01   +5.960408191580533e-01; +9.278336709616614e-01   +4.629831890591498e-01   +2.213220228006824e-01   +2.833866003456641e-01   +7.783991042329546e-01   +1.881695880472179e-01   +6.507008640030661e-01   +3.593395421792181e-01; +9.930780289863629e-01   +3.836253320184778e-01   +6.931062384008467e-01   +9.576215158706591e-01   +1.327066047581694e-01   +4.641884776687275e-01   +4.561866244227685e-01   +2.758372853711386e-01; +7.772455561509097e-01   +1.917650339211400e-01   +4.717513200930727e-01   +1.722172524177402e-02   +8.314468530537137e-01   +3.669387085002728e-01   +8.055381003406532e-01   +7.478891740538004e-01; +4.313127816497922e-01   +9.266668932872748e-01   +7.123965834076667e-01   +8.490481370280905e-01   +4.050603590646191e-01   +8.245338036701142e-01   +9.455116539750176e-01   +3.042642599355155e-01; +4.975480748231037e-01   +6.190712614178552e-01   +5.132599684896072e-01   +4.173520820920091e-01   +2.409668127065820e-02   +9.309112980045881e-01   +6.915284510419043e-01   +4.639098914755766e-01; -1.104829898642648e-03   +4.270484495155578e-01   +3.892869415446710e-01   +4.182774836658834e-01   +4.000940480474347e-01   +5.685492129016035e-01   +2.897032751361890e-01   +5.696150595593106e-01; +4.307437943695878e-01   +1.572154385196521e-01   +6.598127034772157e-01   +7.799323981837517e-01   +2.138930113223091e-01   +6.346267427088198e-01   +4.148130516913449e-01   +7.655583964669861e-01; +4.676593950750541e-01   +4.567300674148950e-01   +7.389317287634048e-01   +3.758625409447158e-01   +9.354379849645145e-01   +4.192020511244910e-01   +3.728732355728901e-01   +3.281527256339364e-01; +6.466747336579902e-01   +1.691423820159580e-01   +3.348717430187365e-01   +2.687234408057118e-01   +5.981551302017013e-01   +6.126622037108128e-01   +3.695436537419711e-01   +7.421369844592747e-01; +8.042117503761913e-01   +4.425202051076169e-02   +7.383760688000627e-01   +2.764180476498129e-01   +4.316583218484129e-01   +6.603232805324029e-01   +1.209989898036233e-01   +3.283606945894124e-01];
L1I_L2I_iGABA_netcon = [+5.473599416631282e-01   +1.963269694679221e-01   +7.689770772984215e-01   +2.852621067352613e-01   +6.081562276922747e-01   +2.784346772377260e-01   +8.840092152724115e-01   +2.393293454672855e-01   +5.928838623255349e-01   +9.082103976759122e-01   +4.321260869513947e-01   +4.458829378945001e-01   -8.489021049033142e-03   +7.422125984257519e-01   +6.271512715504615e-01   +4.986457419850065e-01; +5.302886816570729e-02   +6.156922913152857e-02   +3.661823507194425e-01   +3.151958940383829e-01   +9.248342112697732e-01   +3.572012668792455e-01   +3.396571969458021e-01   +1.284780650084552e-01   +4.587133130234053e-01   +2.166681795650651e-01   +3.111820680940273e-01   +2.839475558797087e-01   +9.331255264584397e-01   +1.786246721276454e-01   +8.589083811505029e-01   +2.500042181302451e-01; +3.755380210567868e-01   +6.456435361284308e-01   +3.829505656424181e-01   +7.324909681633641e-01   +2.337859837695011e-01   +5.118768586473318e-01   +7.712317590050228e-01   +8.861622779094973e-02   +7.721809103561846e-01   +4.827909200965245e-01   +6.162325505562096e-01   +8.344892735666619e-01   +9.791537579053465e-01   +6.626578835912035e-01   +3.259709290263947e-01   +1.191050131145288e-01; +8.372605736535177e-01   +1.276286521593303e-01   +6.133885625169834e-01   +9.449682802014518e-01   +5.023027203689253e-01   +9.000672967363559e-01   +6.298084123172433e-01   +5.918413126432703e-02   +4.911331895228996e-02   +3.330441193954337e-01   +4.296031184835686e-01   +5.042621199509201e-01   +3.198611313439481e-01   +5.079017505148009e-01   +1.991315631347227e-01   +1.069640564683088e-01; +9.828118806557443e-01   +7.880920705580694e-01   +7.416378309840999e-01   +6.974244357583108e-01   +2.915228764535703e-01   +6.594159926840011e-01   +6.695517259809027e-01   +6.648112842399302e-01   +9.006212506321364e-02   +6.939271126148817e-01   +1.718276142234810e-01   +3.986451370304317e-01   +4.669062405676047e-02   +2.196475818861942e-01   +7.239521874326955e-01   +9.608599623997688e-01; +5.522048979491229e-01   +3.948583694263835e-01   +1.276244214173915e-01   +3.468209984190360e-01   +9.642452826942084e-01   +1.314412640427655e-01   +6.793858977083650e-01   +6.751147212261702e-01   +5.680835762636387e-01   +7.462108412204400e-01   +3.462862623372485e-01   +4.953636507597619e-01   +8.694574708466225e-01   +7.293894150703649e-02   +2.036660231511973e-01   +8.048384935991210e-02; +8.089533266553777e-01   +7.810080876806863e-02   +4.140204605520782e-01   +3.259399021374519e-01   +5.494633858588578e-01   +9.300858904246403e-01   +7.349877594978488e-02   +2.434909869077939e-01   +7.471176863730415e-01   +9.196043561006697e-01   +8.928626265718392e-01   +8.948956774519912e-01   +1.558058713398146e-01   +2.992218093920132e-01   -3.268302794954243e-03   +6.358489930921896e-01; +8.802844524757164e-01   +3.632930339965935e-01   -2.775173535684493e-02   +8.974276292231179e-01   +1.689493515408950e-01   +1.000000000000000e+00   +8.024561646248725e-01   -1.364659042936627e-02   +8.009119343435502e-01   +3.859234846103120e-02   +9.140003417158418e-01   -8.507793764322020e-03   +8.308911587838387e-01   +8.492057755087595e-02   +9.630082411925089e-01   +6.932748997259038e-01];
L2E_L1E_iAMPA_netcon = [+2.677722583683218e-01   +9.115481104799804e-01   +6.778149642245539e-01   +4.963804819238397e-02   +3.173317499737919e-01   +3.989242278475434e-01   +8.114157513106783e-02   +6.279658692104830e-01; +2.761094290174977e-01   +1.790028509157828e-01   +7.666076967586734e-01   +9.032044401640275e-01   +3.467232112302040e-01   +5.674832732829626e-01   +2.789677627925761e-01   +1.210690581335058e-01; +5.137693804547683e-01   +8.950924504275959e-01   +7.633638604706084e-01   +1.345103846281952e-02   +6.564652078433649e-01   +3.754319443094796e-03   +4.350409349855964e-01   +8.462146793734378e-01; +5.279559768472522e-01   +6.102230200948300e-01   +4.862272098028175e-02   +5.821148260052154e-01   +2.796140053465115e-01   +4.858238444603530e-01   +2.284685773585628e-01   +4.443519894179971e-01; +8.535846395839990e-01   +7.309043101564112e-01   +7.799293407542627e-01   +5.337509993363198e-01   +7.712440323172376e-01   +3.606566237726915e-01   +4.803576580355234e-01   +4.843929067475140e-01; +4.796451272312468e-01   +6.820414781564178e-01   +4.202825767499749e-02   +5.963079908223257e-01   +6.609649100580971e-01   +8.581246409948919e-01   +2.486503518489436e-01   +4.070104982059985e-02; +4.860738629520936e-01   +3.201732111849547e-01   +2.500811570877168e-01   +4.052436350719248e-01   +3.906989040541080e-01   +2.741918781378234e-01   +5.450807996820004e-01   +3.021740384367041e-01; +7.216629625073915e-01   +1.536236578164064e-01   +1.672028902250948e-02   +9.344365641901675e-01   +5.017030603823911e-01   +3.520331802608381e-01   +5.503920209022388e-01   +5.972464783925313e-01; +7.623229506759532e-01   +6.269492593064453e-01   +6.408984571254412e-01   +1.222558725602671e-01   +3.708992552683929e-01   +2.362775507308233e-01   +7.603600397269415e-02   +1.000000000000000e+00; -1.954290945457614e-02   +1.362060988509856e-01   +1.240836698440014e-01   +1.809477739385524e-01   +2.096906311107189e-01   +5.651193817942389e-01   +8.805957688678319e-01   +8.204250394520489e-01; +1.961814231963224e-02   +2.385099525184516e-01   +5.961178157768269e-01   +5.064661884925802e-01   +1.533154933309150e-01   +4.334250295992202e-01   +1.649122779482617e-01   +7.133052434285307e-01; +3.766873732174628e-01   +5.288734101897790e-01   +5.960397356362785e-01   +5.355206623110181e-01   +7.045862998462130e-01   +3.096611070198933e-01   +6.320587211261951e-01   +4.689151981172243e-01; +6.722961409549761e-01   +7.138083174492978e-01   +6.481746965900398e-01   +2.642925831224469e-01   +1.942576048591574e-01   +8.644058471772224e-02   +1.030429123988924e-01   +5.540997199118595e-01; +7.284513547466583e-01   +7.996428249355874e-01   +7.406899369239375e-02   +8.959230000674426e-01   +4.676369621306636e-01   +8.450917773261242e-01   +5.455970521279607e-02   +2.243887404511822e-01; +9.491074974483046e-01   +1.995265865752710e-01   +3.989245594973418e-01   +5.503776244688499e-01   +3.641731240427244e-01   +2.505479155995362e-01   +5.970151764554658e-01   +3.778638424593542e-01; +8.447116607833919e-01   +6.064671002762648e-01   +7.108409708913987e-01   +3.421317818021374e-01   +4.636129298993509e-01   +8.906853948576707e-01   +7.287889051502057e-01   +9.543757622244683e-02];
L1E_L2E_iAMPA_netcon = [+8.534733967832583e-01   +4.417914627493066e-01   +5.944049587041323e-01   +1.258507791490568e-01   +9.339280446908609e-01   +3.032040885552853e-01   +5.635123280209203e-01   +5.192848316477054e-01   +9.623470996921192e-01   +5.521929781525767e-01   +6.604238086707919e-01   +5.091822996300918e-01   +5.173947148465132e-01   +3.656242058634120e-01   +5.371543429963929e-01   +2.132347285024307e-01; +7.642336836369719e-01   +2.171088147447720e-01   +1.091860085089653e-01   +5.860943264064844e-01   +8.283428640751066e-01   +6.219312830437499e-01   +8.941093400027575e-01   +2.340032658984793e-01   +3.400125940008230e-01   +3.378988045447281e-01   +7.496730631397978e-01   +6.694371357420893e-01   +7.022841597933834e-01   +8.961542836936360e-01   +4.128142690231403e-01   +5.467920510969394e-01; +7.869905558827537e-01   +8.941710563290067e-02   +1.202728713516617e-01   +9.788462485533997e-01   +2.627130433010939e-01   +3.547201654537438e-01   +9.362690860006578e-01   +3.137639606069711e-01   +1.804878045272281e-01   +6.105695701670029e-01   +8.404000200792200e-01   +4.795709508292693e-01   +8.699286812260881e-01   +9.892217565528890e-01   +8.534351876883094e-01   +6.515702636742949e-01; +7.252422779093854e-01   +8.155947137551373e-02   +5.267455302927735e-01   +3.875241058203845e-01   +4.248785261104435e-01   +8.567084069539207e-01   +2.003789297651601e-01   +1.314129955814368e-01   +6.138542941497176e-01   +4.293328067726914e-01   +3.622802834658436e-01   +9.397157903772405e-01   +7.393723557315564e-01   +5.852993158829533e-02   +7.471785953906541e-01   +7.972209879247595e-01; +3.596231606794831e-02   +2.523988734734623e-01   +1.724461316756038e-01   +7.547795245690393e-01   +2.100752276961168e-01   +4.910636391215777e-01   +9.985846848873478e-01   +3.046594923337126e-01   +9.910163828784539e-02   +7.764957097402047e-01   +7.004526494204186e-02   +5.737721191712682e-01   +9.579015480341484e-02   +6.440121704679993e-01   +3.850855858249115e-01   +1.077182449669160e-01; +6.587035303071584e-01   +4.271643696944478e-01   +4.001592418071339e-01   -6.553494939588794e-02   +9.085996150073152e-01   +1.011574174631348e-01   +4.535175393563507e-01   +2.185539800537872e-01   +7.520218495875850e-01   -5.787432199523323e-05   +7.589631048507839e-01   +4.044859644591227e-02   +7.536568726904064e-01   +5.105728560154154e-01   +7.103844296358597e-01   +3.423025324502652e-01; +2.834819570561761e-01   +6.635322960848854e-01   +3.801671065969067e-01   +3.837210782617376e-01   +3.451072564829345e-01   +8.923317446956195e-01   +9.220365812247965e-01   +4.354564942770695e-01   +6.807935472227400e-01   +7.693944825394465e-01   +6.490477841323190e-02   +1.353290039732792e-01   +1.050739710666436e-01   +3.512002405637235e-01   +3.457495759183998e-01   +7.961835023031490e-01; +1.596531298214612e-01   +4.528344479106918e-01   +3.015364913161953e-01   +4.388646386628801e-01   +9.524283369713712e-01   +4.979200560405922e-01   +9.675344640700220e-01   +9.002699248511241e-01   +3.756434394611450e-01   +5.489593048405094e-02   +3.672440643997889e-01   +3.436928456603508e-01   +3.355704622152542e-01   +7.688829171724192e-01   +8.492848035581638e-02   +5.417262386823684e-01];
L2I_L2E_iAMPA_netcon = [+3.616476312370351e-01   +2.650182205398511e-01   +4.046911105522473e-01   +5.666091957301419e-01   +1.690072942779718e-01   +8.814846433430679e-01   +6.731633166844682e-01   +2.740268441090583e-01; +5.242383321828471e-01   +2.226845590721937e-01   +6.441686692245889e-01   +2.423624091528448e-01   +6.710795998810235e-01   +8.092616308610434e-01   +5.924993692886894e-02   +5.166918372067052e-01; +6.287962716582753e-01   +7.403954921126269e-03   +7.035857665482100e-01   +6.101468960048441e-01   +1.581390945401233e-01   +5.727034794817971e-01   +8.022451859628957e-01   +7.461637651754423e-02; +4.893322564815518e-01   +2.967446821818997e-01   +5.755862023609050e-02   +9.574085032059576e-01   +3.755717559030709e-01   +6.095356986529874e-01   +9.750181160563018e-01   +2.250650706193113e-01; +1.588586418683754e-01   +4.231852912385624e-01   +4.003781313936081e-01   +8.331423677117381e-01   +8.325595233827255e-01   +5.846913430500938e-01   +6.974578499647230e-01   +2.889901769866286e-01; +9.189823468119117e-01   +5.016431530791209e-01   +9.105754492745844e-01   +8.565566140764532e-01   +7.113835834434684e-01   +8.538671909761583e-01   +8.702166251924421e-01   +5.132591956593586e-01; +1.205074285814451e-01   +5.703325398110435e-01   +9.284347410052672e-01   +9.082219814808372e-01   +9.823276314836353e-02   +7.332600870612128e-01   +2.403738568419249e-01   +1.133421493040375e-01; +5.473121345847092e-01   +3.853744630855936e-01   +2.029699116708191e-01   +2.851990171375559e-01   +7.606601699985684e-01   +4.062669471073883e-01   +9.756319808612195e-01   +6.169680304319362e-01];
L2E_L2I_iGABA_netcon = [+4.541672130068654e-01   +6.046846362938574e-01   +6.524878219099723e-01   +9.118089510674217e-02   +4.869352567297420e-01   +4.940814009557530e-01   +2.911280803671769e-01   +7.301936825085288e-01; +4.281829049078273e-01   +3.501915195220279e-01   +1.030120755886351e-03   +4.966812287353181e-01   +4.839428906774314e-01   +5.962402995894615e-01   +4.889481199323657e-01   +4.672229028820494e-01; +5.920454812110085e-01   +5.276594660392057e-01   +4.093632317771042e-01   +5.555574877655537e-01   +3.227620981467984e-01   +2.682370992076786e-01   +2.012593671678334e-01   +1.000000000000000e+00; +7.322598870964894e-01   +5.569542787250558e-01   +3.899971103358771e-01   +8.339709310302003e-01   +2.314949360059984e-01   +8.501898692555257e-02   +1.663647192717066e-01   +4.275608230804525e-01; +5.189270004849359e-01   +7.647512689858736e-01   +5.193738893985359e-01   +8.034208296454124e-01   +4.074628551049012e-01   +7.260463508754349e-01   +6.721329872812141e-01   +3.112670327495650e-01; +3.953471452392112e-01   +2.519680469381104e-01   +4.645924331088586e-01   +3.654445285630104e-01   +7.977127593010607e-01   +8.653680716241403e-01   +2.597758325816770e-02   +4.375320793735499e-01; +7.852360069002253e-03   +4.532918212000406e-01   +8.557551620360404e-01   +5.767817505894094e-01   +4.870903086549471e-01   +3.868008637000672e-01   +9.342564233181305e-01   -4.252444420477816e-02; +8.901283134748128e-01   +5.244866613312328e-01   +8.885585723830339e-01   +4.917948407911193e-01   +9.013919506366801e-01   +5.484022050236025e-01   +3.512777368570327e-01   +3.311366230873560e-01];
L3E_L2E_iAMPA_netcon = [+2.354708608362397e-01   +9.364447493183560e-01   +4.814316497227610e-01   +7.895870642944804e-01   +1.749631000464422e-01   +4.321047203399664e-01   +4.030047513220209e-01   +1.156851080570906e-01   +1.096832703623140e-01   +5.335670980231139e-01   +1.648048254372876e-01   +4.598991387178014e-01; +2.575458856789518e-01   +4.820765168080025e-01   +1.834002309084302e-01   +2.385634893153809e-01   +6.311968553621427e-01   +9.324397524101725e-01   +7.401202681471636e-01   +6.256918026138504e-01   +2.575353410871205e-01   +4.858286198486553e-02   +1.365839012972471e-03   +6.881132152407496e-02; +8.012749072675737e-01   +3.672842878062074e-01   +5.523913646016498e-01   +1.199599576618207e-01   +8.790471318511837e-01   +8.711270969824121e-01   +5.222866700179484e-01   +6.890819144060851e-01   +6.952814124553333e-01   +3.881010862327270e-01   +4.156096394839489e-01   +9.443034553533182e-01; +1.870659160838699e-01   +4.627056456712737e-01   +1.955101919044968e-01   +8.325271689467639e-01   +5.202978086151154e-01   +5.763649348342418e-01   +8.759147781735221e-01   +2.770340266902664e-01   +8.447633936001981e-01   +8.281316519725416e-01   +4.886725856396045e-01   +2.342535310425004e-01; +2.192291485857860e-01   +8.167490681211552e-01   +4.375212277087049e-01   +5.656837198355641e-02   +1.998192344498101e-01   +9.890540207114884e-01   -1.797398605751124e-02   +6.814178688291797e-01   +7.144374913360611e-02   +8.406274898813025e-01   +2.770420734375191e-01   +2.339467102723502e-01; +3.777888121046195e-01   +3.659433038192028e-01   +8.716977563836651e-01   +9.821346371824856e-01   +3.836750084393707e-01   +9.581977381856691e-01   +1.018129314543228e-01   +3.933824388031279e-01   +5.044462338749275e-01   +8.125880743030902e-01   +6.220652394657724e-01   +8.866716374254374e-01; +1.404409989281387e-01   +4.790367683172526e-01   +6.104741210936429e-01   +1.140498103794364e-01   +6.512849423069976e-01   +4.921291728168899e-01   +7.828537634003945e-01   +1.226992523378915e-01   +4.888026700238704e-01   +3.883770204446487e-01   +9.974309214428391e-01   +7.667527400983272e-01; +6.074621797824962e-01   +4.133733225262180e-02   +3.862563935044863e-01   +1.769442374626532e-01   +3.289144817693834e-02   +9.196425728038766e-01   +3.915891600875256e-01   +4.772972382397885e-01   +9.078793891386954e-01   +9.934333092826479e-01   +9.430193770415864e-01   +3.612746011445184e-01];
L3I_L2I_iGABA_netcon = [+6.889308817043348e-03   +3.439472646468164e-02   +6.323293785782351e-02   +6.507701629658770e-01   +6.608674361236189e-02   +4.903500499139990e-01   +8.212497352449063e-01   +3.908255449865842e-01   +4.093795396387129e-01   +9.729528212741655e-01   +8.728072986218256e-01   +6.233887197995999e-01; +3.575353287353761e-01   +4.293632404844104e-01   +3.111999528275843e-01   -2.422399874191214e-03   +4.633529066788833e-01   +6.152809569531996e-01   +4.542559959159124e-01   +9.004983486376160e-01   +1.095022331920204e-01   +9.131899842143016e-01   +3.003813306090822e-01   +6.462091627398729e-01; +3.444549853552292e-01   +6.943988182527071e-01   +3.073726986900179e-01   +7.903084701814856e-01   +3.541869730100952e-01   +8.421848656214727e-01   +9.433545912796503e-01   +3.152435507387224e-02   +6.563716989025804e-01   +5.154773282886889e-01   +1.471663706634580e-01   +5.799256814146836e-01; +6.421426876916406e-01   +9.615310035702415e-01   +3.559893903119496e-01   +2.615500403732403e-01   +1.613778301958262e-01   +5.849194402064934e-01   +1.757454433723671e-01   +2.833551434772197e-01   +7.165214446728990e-02   +3.361028335734333e-01   +5.016910594824935e-01   +8.116620068048284e-01; +9.685444725454792e-01   +1.351647821942860e-01   +4.928243483573835e-01   +8.322622529452584e-01   +5.039197882379102e-01   +8.903902479737573e-01   +9.176146364395558e-02   +5.723506626400404e-01   +6.051459961156467e-01   +7.920446539801949e-01   +7.648973675048539e-01   +5.434016144007264e-01; +9.155102583366420e-01   +1.799248968510415e-01   +1.130272070651356e-01   +7.652357238140309e-01   +9.145594586384425e-01   +7.487500180093077e-01   +8.973794134927215e-01   +5.581353802586394e-01   +1.430221729255836e-01   +8.538038250029462e-01   +3.603079556705426e-01   +6.174565505534685e-01; +1.184886324300097e-01   +5.579964128323476e-01   +9.596617803180529e-01   +5.666209254215980e-01   +9.532654202166674e-01   +8.329148848044129e-01   +8.127860864247475e-01   +8.014371814792650e-01   +6.065460377745061e-01   +3.656104208613141e-01   +3.088233042932802e-01   +5.619002840017472e-01; +3.110141705322219e-01   +2.094786020285712e-02   +7.611703844361046e-01   +1.816524784902229e-01   +4.383344188711690e-01   +4.250405162527100e-02   -4.583897200048454e-02   +9.875319536779332e-01   +4.604769409670625e-01   +1.067646035913216e-01   +7.123787684052962e-01   +8.180810550257306e-02];
L2E_L3E_iAMPA_netcon = [+9.012625045505614e-01   +2.834161917650335e-01   +5.496297913317606e-01   +6.921476853661974e-01   +3.233106865089522e-02   +7.277706041652179e-01   +7.568463544389583e-01   +6.465707863212390e-02; +3.155284497436805e-01   +5.885233644196671e-01   +6.758070485931826e-01   +7.329939460077305e-01   +2.425721229796075e-01   +2.166407311758647e-01   +8.332214053397119e-01   +7.432043308445556e-02; +6.104045321787834e-01   +5.415092450183001e-01   +8.872351793547519e-01   +6.300315839464427e-01   +8.958791912562205e-01   +4.622964297239803e-01   +9.772473848099609e-01   +4.639573717692864e-01; +1.782201214258568e-01   +9.149147043683563e-01   +8.841080512178467e-01   +4.343383428892600e-01   +3.727600036365533e-01   +9.531511721898613e-01   +2.793930611131946e-01   +5.077178630596823e-01; +7.450083258435346e-02   +2.037548540286986e-01   +6.674053857687625e-01   -1.914671432031445e-02   +1.623273727540507e-01   +5.433229212762322e-01   +4.983787140052183e-01   +6.616333336136604e-01; +3.999782712752191e-01   +7.708865998770447e-01   +1.690359202802266e-01   +7.763917140722131e-01   +2.774557485599712e-02   +1.263984644901668e-03   +4.864909519732463e-01   +2.987758330166628e-01; +4.579907037101893e-01   +7.773582771272946e-01   +7.885946552788244e-01   +2.550945602402430e-01   +8.423311641979426e-01   +1.909736673997966e-01   +6.915524733894998e-01   +9.409292755188248e-01; +2.936915654348250e-02   +5.903008349433937e-01   +8.928139260867876e-01   +4.654051623665715e-01   +1.184835955236895e-01   +7.386302620269165e-01   +1.189270631828741e-01   +3.646431956611432e-01; +1.000000000000000e+00   +9.183300361586887e-01   +6.869650276038437e-02   +1.412753691162871e-01   +1.252334580374515e-01   +8.855147031018472e-01   +2.901594204015597e-01   +9.297534097980118e-01; +1.741350916214475e-01   +3.532100689116360e-01   +7.964803232594803e-01   +3.751052675166662e-01   +4.018269791013265e-01   +9.081452086852194e-01   +4.700382603012279e-02   +9.576719247458121e-01; +6.534106949633907e-01   +3.886276935030871e-01   +2.478462964985131e-01   +2.189535615306253e-01   +1.115608585386399e-01   +3.389683990816199e-01   +2.146636424644683e-01   +9.466131197745101e-02; +9.380193212204416e-02   +6.349150724971773e-01   +8.085642990495088e-01   +4.149669660573101e-01   +4.765560583009960e-02   +7.432426427752569e-01   +7.871500776710620e-01   +7.586378767110392e-01];
L2I_L3I_iGABA_netcon = [+3.865948168180292e-01   +6.314197380442303e-01   +2.665543337757178e-01   +6.716727958637065e-01   +5.289970564989874e-01   +4.266921666501026e-01   +4.148747106061707e-01   +4.869713740076091e-01; +3.771372753111733e-01   +1.155234836748342e-01   +1.175323424044203e-02   +8.527460724617455e-01   +7.159059145731743e-01   +4.482415796841210e-02   +1.021200528651537e-01   +6.319504272490000e-01; +3.699884622900906e-01   +6.519655793477876e-01   +4.027063034814836e-01   +1.087175759230423e-01   +8.191395836644504e-01   +6.077644562120972e-01   +1.721247124390876e-01   +8.727815039972726e-02; +6.338569934821404e-01   +8.846409118196915e-01   +6.176992380204527e-01   +4.827758386820426e-01   +5.492919929689395e-01   +6.702805101527552e-01   +4.449124554094034e-01   +7.129117224074070e-01; -6.754103094016537e-03   -3.163109312614795e-02   +1.371191607014805e-01   +6.822644836425829e-01   +2.128994240616835e-01   +6.972620951180363e-01   +4.789145224491855e-01   +3.082161602985535e-01; +5.269354506578836e-01   +4.307894807155132e-01   +4.491852762481167e-01   +7.059713133792267e-01   +2.940000683376404e-01   +8.777660719611435e-01   +3.884843597976945e-01   +1.329901640441684e-01; +2.963649348132918e-01   +1.103947629063965e-02   +4.656012590488556e-01   +9.956208155409141e-01   +6.110304267637380e-01   +1.035740738237256e-01   +2.779363289540281e-01   +8.433790782394661e-01; +2.370219498085285e-01   +9.418529747206958e-01   +9.197166940189274e-01   +9.560207489900380e-01   +5.099060333726627e-01   +1.205681314092187e-01   +7.831656185498379e-01   +1.426899293929277e-01; +3.346989774156248e-01   +5.661053551945707e-01   +2.895238742522563e-01   +2.064090378801763e-01   +3.565565596189112e-01   +2.562812659696112e-01   +6.052836932187586e-01   +4.952220033337941e-01; +4.348647737320473e-01   +2.102686448941138e-01   +1.945525226798599e-01   +3.827383009378642e-01   +9.474684303361410e-01   +5.131652589126223e-01   +4.824258226793216e-01   +9.566424128947498e-01; +6.185933943585058e-01   +1.028062288639057e-01   +3.160639943789360e-01   +5.965935858965795e-01   +5.100051847148549e-01   +7.593765123759906e-01   +9.386784755987534e-01   +6.395131574131682e-01; +3.856624818111497e-01   +2.266144530660924e-01   +6.161916653056624e-01   +2.707047361848839e-01   +1.405562662105271e-01   +1.428881459282625e-02   +2.954211032855234e-01   +7.037282563483763e-01];
L3I_L3E_iAMPA_netcon = [+1.113838099424526e-01   +6.914410256755233e-01   +1.028585641162657e-01   +2.092655870823334e-01   +3.086091922271751e-01   +6.390754878344034e-01   +8.184596966508505e-02   +3.343464510755015e-01   +5.248424313474140e-01   +3.320150482235287e-01   +6.130616429573423e-01   +9.068719942724801e-01; +3.606048500604607e-01   +8.458569889765359e-01   +2.577797925993887e-01   +3.682590990969866e-01   +8.070228101183473e-01   +3.805671810170498e-01   +3.701710232005950e-01   +3.880018649084918e-01   +6.343943003906659e-01   +2.658464259144690e-01   +7.089544514311755e-01   +2.201077960860507e-01; +4.806766454676013e-01   +3.859311549013213e-01   +7.886906706737968e-01   +8.918815610277274e-01   +6.077265632808396e-01   +5.825966402630548e-01   +9.969816360095006e-01   +4.336995368557211e-01   +2.093704783737842e-01   +3.118023571914028e-01   +9.341541336529253e-01   +8.561585491677938e-01; +4.967635622991782e-01   +9.858445677584030e-02   +5.698189474178265e-01   +7.444670785890064e-01   +4.486090640023294e-01   +5.886951023960691e-01   +6.006322970404472e-01   +6.891969042798782e-01   +5.377300946599576e-01   +2.008112021470094e-01   +4.220395446739189e-01   +4.718652779099467e-01; +9.390243992805325e-01   +8.143761761865421e-01   +6.009692087202242e-01   +4.842527680964322e-01   +2.515230429959379e-01   +3.497962309795530e-01   +2.558689705192344e-02   +2.141535838688055e-01   -6.290005771722127e-03   +2.497497407403486e-01   +6.139541935728379e-02   +4.917352798243677e-01; +3.928653140312668e-01   +1.819066544853374e-01   +6.381709971320625e-01   +4.412985382966263e-01   +9.666676284167347e-01   +6.084671448747359e-01   +3.095121461814057e-01   +9.599475964297952e-02   +1.773406918472940e-01   +5.640428549677725e-01   +3.179231875343025e-01   +7.453453506245369e-02; +4.961771926459791e-01   +2.050247985442315e-01   +8.260251668416033e-01   +8.814555405825327e-01   +1.250978633710860e-01   +3.052240956623069e-01   +3.939900233578792e-01   +1.210721156759958e-01   +9.272177755909471e-01   +7.160314829546258e-01   +2.871584339031140e-01   +2.867234469836630e-02; +3.799764920362402e-01   +4.194552481153727e-01   +2.525043205347944e-01   +6.045698965123811e-01   +8.460173993614242e-01   +2.562566948949763e-01   +4.068567686654672e-01   +3.046333443247261e-01   +3.311878771743251e-01   +2.740651413690064e-01   +7.000541409956271e-01   +5.684548744413759e-01; +3.290485850187072e-01   +5.338696230483031e-01   +3.652144116483471e-01   +5.764914868424067e-01   +5.527242345469144e-01   -1.639191871733325e-02   +1.040256621378342e-01   +5.638476266114218e-02   +3.367205520387631e-01   +2.420769239834899e-01   +9.009099641970190e-01   +8.922933986057410e-01; +7.468074008694009e-01   +6.128862633822995e-01   +5.634906900156773e-01   +4.015903461186476e-01   +4.178117257573010e-01   +4.126157673332206e-01   -3.650251475449225e-02   +6.559786811369670e-01   +4.034172294219315e-02   +9.303709880115759e-01   +4.779297348723119e-01   +1.590848871608274e-01; +8.674091049167496e-02   +2.636972523020127e-01   +6.500609246850484e-01   +2.337906752300354e-01   +7.849209536014934e-02   +5.184231249367940e-01   +9.225762869373900e-02   +7.495707404455167e-01   +7.572157218606705e-01   +1.556144508289419e-01   +6.905044860280807e-01   +2.662110439259741e-01; +5.915549113680496e-01   +6.289527543218583e-01   +3.862033241210825e-01   +6.083330943589033e-01   +6.847359130525545e-01   +4.248278934475923e-01   +3.339501105968077e-01   +7.908429446647565e-01   +6.209773767499230e-01   +4.133754453347224e-01   +5.031386766817282e-01   +4.093705845046632e-01];
L3E_L3I_iGABA_netcon = [+3.183858106083239e-01   +7.155658757485578e-01   +7.141029979414232e-01   +8.804386090968677e-01   +4.658089456657409e-01   +1.075707840232581e-01   +2.486956412029178e-01   +7.196914200534278e-01   +8.037258312127020e-01   +2.515392076527899e-01   +4.936608260197824e-01   +2.766730352696269e-01; +8.633202915644247e-01   +3.770552790466689e-01   +6.339320106767486e-01   +5.035943284518465e-02   +8.979290056430419e-01   +3.929851417237411e-01   +8.322386339256346e-01   +7.218641426052793e-01   +6.244819641052194e-01   +7.529781541617129e-01   +2.456786095112860e-01   +4.878839144709791e-01; +8.325332265731040e-01   +3.266491975215806e-01   +4.024711908384606e-01   +4.590884580905198e-01   +5.631047821230238e-01   +5.555197347910863e-01   +2.480614897314635e-01   +8.514470437452689e-01   +5.787758954198315e-01   +1.291580871037412e-01   +7.579300596208318e-01   +8.628600047059160e-01; +1.441464240010611e-01   +6.729159184626213e-01   +3.173490223086448e-01   +2.991548074035327e-01   +1.062970015713790e-01   +6.764069830368065e-01   +2.752104626355282e-01   +9.907362446095931e-02   +2.860400011829463e-01   +5.255150876145335e-01   +7.528529675586635e-01   +5.568342912454000e-01; +2.195989412742180e-01   +7.146174556506655e-01   +6.008844946324440e-01   +2.844346236650137e-01   +1.248734729903971e-01   +5.843064619513491e-01   +9.145327845598598e-01   +2.803152900734183e-01   +2.936881514658921e-01   +8.409676282344906e-01   +6.281778714994873e-01   +2.036574448320707e-01; +4.453574687391069e-01   +8.193064976610359e-01   +7.613260181049667e-01   +5.214222274851205e-01   +7.691978055632350e-01   +1.010027177789931e-01   +3.909681496530369e-01   +3.122806078874523e-01   +8.458149363495751e-01   +8.510825005359589e-01   +8.276180593522322e-01   +2.804047219074192e-01; +5.313366736791361e-01   +8.024145171834367e-01   +2.071002759311912e-01   +2.149586758120835e-02   +4.236451040932299e-01   +6.497156587453530e-01   +6.256525824961243e-01   +2.096704070961539e-01   +9.531960922394787e-01   +6.122379937136634e-01   -1.054192591813428e-02   +3.753410089481949e-01; +4.723979691612636e-01   +4.300167432237571e-01   +8.628778625805967e-01   +3.834495276681212e-01   +7.295534041714229e-02   +1.106816417507503e-01   +5.896246926822631e-01   +4.431411138408094e-02   +6.176330620325124e-01   +8.193610250804779e-01   +1.981270918635215e-01   +9.929120478432715e-01; +3.162711876465610e-01   +5.734411286559771e-01   +2.549937021490885e-01   +7.151273360883911e-01   +8.851917445232116e-01   +3.153928224788270e-02   +3.750511421278321e-01   +5.612135491576410e-01   +5.971713142305374e-01   +9.165618807192980e-01   +7.175893914719600e-01   +6.270671308314542e-01; +8.320077144571351e-02   -6.836230034923887e-03   +3.722525181122377e-01   +5.808861904468609e-01   +7.698189882131351e-01   +2.080997369257023e-01   +1.611682678472542e-03   +3.492493244865830e-01   +6.863262151098712e-01   +2.962753811937081e-01   +6.212773871993239e-01   +5.409229726860963e-02; +8.922398127565038e-01   +7.797482705096910e-02   +7.081322540248869e-01   +5.047579083457087e-01   +4.282626052508848e-01   +8.693069269523693e-01   +9.142101069636090e-02   +8.137726611171524e-01   +3.301028584081614e-01   +9.586965704462954e-01   +4.830304783907795e-01   +7.417714216288317e-01; +6.479296810652349e-01   +8.392563640310777e-01   +5.250097737013775e-01   +8.989812922830545e-01   +8.412471630706905e-01   +4.872647898273128e-01   +9.579457114528054e-01   +8.847032175877294e-01   +4.599586561025413e-01   +9.163855639604642e-01   +5.304233780440597e-01   +9.052523712716929e-01];
L2E_Input1_iAMPA_netcon = [+9.832252706538065e-01   +9.731868824175528e-01   +9.269067167542805e-01   +9.820345286230361e-01   +9.356380261456316e-01   +9.981471693946670e-01   +9.485637305446096e-01   +9.550415369335709e-01];
L2I_Input2_iAMPA_netcon = [+9.538307533588944e-01   +9.598919349298646e-01   +1.000000000000000e+00   +8.895029308842292e-01   +9.450791751087949e-01   +9.489490107692974e-01   +9.437691571849236e-01   +9.490686335362305e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
