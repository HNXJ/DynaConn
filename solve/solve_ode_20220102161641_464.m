function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.557208187163866e-01   +2.625093394848437e-01   +1.219946941105304e-01   +4.401162248176449e-01   +1.404460476995340e-01   +6.929594955715763e-01   +4.365608735650512e-01   +6.985865458929413e-01   +2.244042581908469e-03   +6.461761582405247e-01   +1.740509676125389e-01   +4.770042519381563e-01   +1.041592465586028e-01   +5.024339705072053e-01   +1.803125281642693e-01   +3.629839337325027e-01; +6.723814106725962e-01   +6.867541576708425e-01   +5.815627964039838e-01   +3.244082637823802e-01   +2.762316754949786e-01   +5.509278374733063e-01   +6.004973998877947e-01   +5.666172891847205e-01   +4.362915539480708e-01   +5.510120034038536e-01   +5.314681112921411e-01   +1.481908164678621e-01   +4.964891210664971e-01   +2.782709862436160e-01   +1.191852139619556e-01   +6.219373106028515e-01; +4.821499331515280e-01   +3.889972142779389e-01   +6.614654578178781e-01   +6.593689352891379e-01   +8.898568027623772e-02   +3.605637593303769e-01   +3.261019852920397e-01   +2.031578485654874e-01   +4.847584780241525e-01   +4.386908618267362e-01   +4.092171446754783e-01   +5.970609867386540e-01   +1.490466484422962e-01   +4.047303239857468e-01   +2.845102076021113e-02   +3.893838721058041e-01; +2.471561249061975e-01   +6.340765838064034e-01   +4.926451246609942e-01   +1.670950048786198e-01   +5.760373171915990e-01   +6.898042555579084e-01   +1.457064815043083e-02   +5.907621992096276e-01   +7.074778837153557e-01   +7.413130539477292e-02   +4.152189326503442e-01   +9.049462448227788e-02   +2.602424463655376e-01   +1.352973580547584e-01   +1.750215053819571e-01   +4.416218883934482e-01; +2.550158072945337e-01   +1.149588485239591e-01   +6.963716278859157e-01   +2.141133133333954e-01   +2.675463878750145e-02   +1.913872831742154e-01   +3.584394136081566e-01   +1.892481367940534e-01   +3.920822552040460e-01   +4.473137623591676e-01   +2.036488351587845e-01   +4.755262268939754e-01   +1.422663076716064e-01   +3.366961134334036e-01   +1.019832436907811e-01   +1.285211737033666e-01; +4.237550191490684e-01   +7.159597547155522e-01   +4.972565566377636e-01   +6.923020635918921e-01   +6.844684258551386e-01   +5.179196090307208e-01   +5.021306795898208e-01   +3.076169900590205e-01   +1.680818214073607e-01   +3.953375651302767e-01   +1.723973310053094e-03   +6.930478502923180e-01   +1.969099382905391e-01   +5.870480178048081e-01   +3.217101741698444e-01   +2.497733225938242e-01; +6.396298896950490e-01   +5.127290100507506e-01   +1.074440534567620e-01   +6.279838014384347e-01   +5.667229190848014e-01   +6.101566620420805e-02   +6.747992128423879e-01   +4.543246636831625e-01   +9.411392673130840e-02   +7.152279421316647e-01   +5.689119650937079e-01   +3.233523353320895e-01   +5.206442933207569e-01   +3.441111988874924e-01   +3.894253208329437e-02   +1.217275992543059e-01; +1.709418267887756e-01   +2.214927783718124e-01   +5.435752299828606e-01   +2.198870509011605e-01   +2.892383109286175e-01   +6.247674912835485e-01   +1.949151212296650e-01   +1.743756739503368e-01   +5.614634552956821e-01   +4.415675879948300e-01   +6.367873514984612e-01   +6.515175159019677e-01   +4.037521626508210e-01   +9.316317043984024e-02   +1.189563961803976e-01   +6.085887014426524e-01; +2.020646285486210e-01   +1.870691571132401e-01   +5.400844194161329e-01   +7.168439576771504e-01   +2.967440720094618e-01   +6.465134920936620e-01   +5.382230966996998e-01   +5.334035955300115e-01   +4.196741290251123e-01   +3.199325251506051e-01   +6.131658459789958e-01   +3.289487411214810e-01   +6.173555095875461e-01   +6.411819776506592e-01   +2.448823668932965e-01   +6.758001299755435e-01; +2.249668211187872e-01   +5.167599052802502e-02   +3.269954427856088e-01   +9.085970112791396e-02   +2.352287353067155e-01   +4.465426946430217e-01   +2.476501346417543e-01   +2.227803257363246e-01   +1.441836227215727e-01   +2.421896003050509e-01   +4.797148022579972e-01   +2.530240590064353e-01   +1.872529473935858e-01   -3.850113713326196e-04   +4.849541357175298e-01   +5.911714154105195e-01; +6.562576669390889e-01   +5.601613455803467e-01   +3.021861154489368e-01   +3.879162514734673e-01   +2.844421062317278e-01   +1.448056065949181e-02   +2.142249510713889e-01   +6.173198276841989e-01   +1.055620764253994e-01   +5.733983073474147e-01   +4.862107215356886e-01   +3.101329563160249e-02   +5.072113959588298e-01   +2.047013606974113e-01   +3.215727698321095e-01   +5.469295824420816e-01; +3.807599976424495e-01   +6.394917478024521e-01   +1.051663191022170e-01   +1.055640815882521e-01   +6.059140062714361e-02   +2.117127183661044e-01   +3.566334041140866e-01   +6.066884883842470e-01   +2.068421822777581e-01   +3.951645950332794e-01   +3.618576824306637e-01   +2.508410720788123e-01   +5.018315137951849e-01   +3.066826739850510e-01   +3.605876609248061e-02   +8.535112599705161e-02; +6.519483630386005e-01   +5.511037955629737e-01   +6.708111094586321e-01   +2.821333437573939e-01   +5.302635453048089e-01   +2.637692903580047e-01   +5.382982292634038e-01   +7.203048427494463e-02   +5.968284791693493e-01   +3.200725814098492e-01   +3.622551758556369e-01   +3.560762854799002e-01   +7.255614996493716e-01   +1.007631907533476e-01   +6.816124023733537e-01   +7.118479836043256e-01; +3.769742614100882e-01   +2.433650660710276e-01   +6.183758326249277e-01   +4.484140828696123e-01   +1.288927781965618e-02   +2.324354757268637e-01   +1.417074287524893e-01   +2.740986466159970e-01   +4.644547041534527e-01   +5.907749685892404e-02   +2.855227935578279e-01   +3.115685174965358e-01   +6.827959777569172e-01   +6.484479296120511e-01   +6.313537870027412e-02   +4.196539812007705e-01; +1.302635547829618e-01   +4.254149130683875e-01   +5.628571620432175e-01   +5.314981726110485e-01   +5.037668842404734e-03   +2.040760493136100e-01   +4.267477927373767e-01   +4.531175919654454e-01   +5.431386271754411e-02   +4.664123053500852e-01   +6.411466727035060e-01   +4.591205761411437e-01   +1.449725321393401e-02   +6.499292394756110e-01   +3.013388702969244e-01   +3.409844654662373e-02; +4.254967366201642e-01   +6.639089947797344e-01   +6.636308156172688e-01   +1.759394408112681e-01   +2.098955570135013e-01   +2.355629209963906e-01   +4.532264571947911e-01   +4.150762329472058e-01   +3.361419072736502e-01   +2.787557710509129e-01   +1.265375681296712e-01   +5.053345994207965e-02   +1.652548098174660e-02   +7.040271997726106e-01   +1.527909172766382e-01   +6.477381589701309e-01];
L1E_L1I_iGABA_netcon = [+2.926081029083595e-01   +2.346089072076631e-02   +2.843394457974616e-01   +1.623061899753383e-01   +6.297168338146062e-01   +1.994563808995504e-01   +5.820337404767750e-01   +6.760937553848744e-01   +3.945436765976380e-01   +4.879663894766177e-01   +5.739648920884047e-01   +2.798151338581765e-01   +3.825723663164474e-01   +4.794634076502787e-01   +1.126221640062384e-01   +6.393543405213066e-01; +4.977117900254238e-01   +5.316346302979013e-01   +1.717665457811954e-01   +1.689046103910910e-01   +4.932948498311972e-01   +1.744146706897479e-01   +1.700149156514029e-01   +2.448962529286308e-01   +3.522472254561845e-01   +7.134091903616165e-01   +1.094194860695244e-02   +4.065159727586969e-01   +5.050877955026310e-02   +1.872192404270512e-01   +4.300562910874404e-01   +1.319206051941495e-01; +5.051597493007565e-02   +2.478222626545438e-01   +6.240521438157806e-01   +3.052611013590435e-01   +2.513300506058840e-01   +6.520470535215757e-01   +2.149338595794147e-01   +2.277921081502651e-01   +5.779302635046015e-01   +6.647202642314177e-01   +1.328812837350622e-01   +2.069518916342238e-03   +6.879702746271428e-01   +2.521876549035574e-01   +2.651281251162895e-01   +5.599138855256667e-01; +6.743310082123120e-02   +6.162424132802641e-01   +1.579178582304566e-01   +1.922024084535661e-01   +1.439950660027728e-02   +1.098557067693043e-01   +5.403985380582574e-01   +4.075374869344602e-01   +3.368418006318021e-01   +2.354345983559153e-01   +1.415161959167265e-01   +1.000843015765842e-02   +1.112091190157348e-01   +1.742708367876816e-01   +1.351497178531585e-01   +7.211774131356783e-01; +1.010373409469390e-01   +2.107797620967372e-01   +4.464543492668598e-01   +4.425307450229923e-01   +4.924916223965392e-01   +5.029750389383318e-01   +6.405380355645778e-01   +5.322609883893180e-01   +5.629819455300962e-01   +2.247150867816409e-01   +7.057012945672902e-02   +1.982491981995560e-01   +7.192446545486857e-01   +5.515913252780852e-01   +3.383261318605165e-01   +4.131855271083393e-01; +6.594159361745264e-01   +5.883149821343221e-01   +1.287047111932615e-01   +7.025758686852339e-02   +5.357826107382122e-01   +5.351666592819765e-01   +4.779933085655135e-01   +1.371816376149609e-01   +1.584589175119830e-01   +7.183428770236422e-01   +6.992404647826383e-01   +3.609042373717725e-01   +2.803593036336987e-01   +6.334248016885734e-01   +2.273849754560950e-01   +4.827536384994170e-01; +3.917733636889215e-01   +4.810006381035389e-02   +7.145626990024492e-01   +6.139582278957343e-01   +5.856541180728925e-01   +2.671027943779709e-01   +4.006880077130412e-01   +6.828261262854012e-02   +6.257322010239815e-01   +2.239392388466187e-01   +6.910334607965486e-01   +4.446229514590837e-01   +4.400056238713156e-01   +5.969019210754420e-01   +1.815375292056946e-01   +4.088939475682105e-01; +4.475418316785842e-01   +6.036530897815113e-01   +2.408695442046553e-01   +2.068444274890162e-01   +4.557739182191546e-02   +7.048264257853348e-01   +1.945779741301540e-01   +5.045593562407104e-01   +4.415551324909370e-01   +1.232347072928673e-01   +6.512211434001287e-01   +6.864208795820305e-01   +4.572424128009013e-01   +4.268173377907289e-01   +4.607887772259576e-02   +3.089305397909489e-01; +3.586408734896433e-02   +3.999244845654665e-01   +1.497280466849729e-01   +3.608690786179549e-01   +6.974226548962054e-02   +3.205325993087470e-02   +7.822655766254616e-02   +1.711629587759944e-01   +4.547039098906828e-01   +3.433503141782592e-01   +1.712636601248992e-02   +7.107119678947256e-01   +5.423853671768536e-01   +1.654388245710255e-01   +4.597639384621207e-01   +2.668500725874721e-01; +7.010333896583015e-02   +6.388616288485700e-01   +5.405620913307789e-01   +7.276817697098390e-01   +1.280417220194373e-01   +2.609473983387557e-01   +6.757494654654777e-01   +5.448412243549132e-01   +5.978837418880062e-01   +7.258465944193609e-01   +7.131274241701301e-01   +1.016547319962593e-01   +1.212269893648858e-01   +6.298571549142545e-01   +1.495844035562114e-01   +4.966361928433223e-01; +5.082709353176966e-02   +1.661602562265317e-01   +3.716826449766609e-01   +5.908209348191584e-01   +5.591057855149161e-01   +4.359703594904662e-01   +4.292928045480626e-01   +3.402547651066161e-01   +4.788099600186490e-01   +6.712515584040615e-02   +3.109319527930707e-02   +2.565423974109184e-01   +6.082589371201683e-01   +6.094287383790176e-01   +6.305341971718845e-01   +6.120533253839900e-01; +1.472994873810862e-01   +3.959916222385298e-01   +3.104083945324354e-01   +3.330668195842829e-01   +1.192070508215674e-01   +7.176327437764611e-01   +3.460694521403894e-01   +3.755082629484723e-01   +2.283652514252107e-01   +1.998429251588547e-01   +3.230536348051445e-01   +4.125120254217012e-02   +5.917607335190626e-01   +4.394275864759229e-01   +2.895178328338673e-01   +8.657921962028334e-02; +3.922667960213459e-01   +2.723432127047561e-01   +1.109088854351974e-01   +1.410406364473184e-01   +5.625580188829529e-01   +5.227519911446984e-01   +2.452472588734896e-01   +4.616725087594297e-01   +6.198237674154320e-01   +3.246654759349196e-01   +2.320124062104498e-01   +4.509481223195853e-01   +4.347473070788075e-01   +5.156206332678592e-01   +3.446283037370674e-01   +7.249844724933179e-01; +4.539292478992325e-01   +7.161282486419665e-02   +4.168663549909656e-01   +5.800116967579971e-01   +7.025465197238894e-01   +1.272254639900957e-01   +4.736041362253858e-01   +3.647188319497292e-02   +2.315151700801597e-01   +2.036919533413244e-01   +5.254851035076447e-01   +6.761771343828640e-01   +1.710757498751625e-01   +1.556465339326554e-01   +4.335264289832038e-01   +1.328336331435371e-01; +3.421747895109380e-01   +6.109680931604472e-01   +4.418781363527815e-01   +6.473617492501481e-01   +2.012027873139261e-01   +4.414827796005708e-02   +4.354688550250932e-01   +3.359969105944701e-01   +6.718835983975367e-02   +3.351625539208147e-02   +3.049087512674879e-01   +5.510449530077325e-01   +5.763117698742642e-01   +3.491224610226430e-01   +9.482555070770152e-03   +2.685217485652026e-01; +7.393945926952446e-02   +1.509716597518972e-01   +6.182652053931538e-01   +4.854469908074158e-01   +3.715890097698901e-01   +1.764784941465860e-01   +7.003112460157418e-01   +5.451404710113885e-01   +5.666861531048275e-01   +3.727148480448290e-01   +6.155946586472762e-01   +6.256200043370705e-02   +5.357417687617474e-01   +3.314783411999859e-01   +6.158624348219791e-01   +3.013361389262794e-01];
L2I_L1I_iGABA_netcon = [+1.020246073180513e-01   +6.935982119033544e-01   +6.079752101934058e-01   +2.400878299450337e-01   +6.771707636329638e-01   +1.608427892974854e-01   +5.280377671282488e-01   +6.429530056244551e-01; +1.743489382958780e-01   +5.061739493949986e-01   +6.574408295544364e-01   +3.103915716252681e-01   +5.404871561458605e-01   +7.078794445356051e-01   +6.903732517845240e-01   +2.338711078809687e-01; +3.872161079785449e-02   +6.478153117522210e-02   +6.781530003886680e-01   +5.202203535616682e-01   +5.185766765868085e-01   +1.231414570236357e-01   +6.002678400418865e-01   +2.239454905290938e-01; +1.799086732270955e-01   +3.582710349960269e-01   +4.400006371864678e-01   +5.497216723955088e-01   +4.540351726912742e-01   +4.274279336882466e-01   +2.609662971415163e-01   +2.142842683359686e-01; +6.068436574929912e-01   +5.137944127418970e-01   +3.496920498417528e-02   +2.694774124488946e-01   +6.946341376631273e-01   +1.832737089593585e-02   +7.288398917170139e-01   +3.991201835559345e-01; +4.044635890402457e-02   +3.387444917789192e-01   +3.367491535778968e-01   +2.915642273106374e-02   +6.900422640895858e-01   +5.719965601506196e-01   +1.997209175414891e-01   +6.847803753882795e-01; +5.423714353550541e-02   +5.644669510261003e-01   +5.439506199220159e-01   +2.077224198787722e-01   +3.110256080098088e-01   +4.902889768642812e-01   +5.120293982984044e-02   +5.651703273374139e-01; +7.211917252427440e-02   +1.503710287742824e-01   +6.593765506138687e-01   +2.867127789990574e-01   +7.082630552094623e-01   +5.257879532924338e-01   +7.279035437147268e-01   +2.849149840326222e-01; +5.116988272105172e-01   +2.294895041660961e-01   +3.669355033789053e-01   +2.416969685377320e-01   +6.425410777400274e-01   +3.586272679814514e-02   +4.416545041211138e-01   +3.370158540127686e-01; +1.094281158328529e-01   +1.334092341599727e-01   +4.710511590091044e-01   +5.955282056773575e-02   +3.833884000821941e-01   +7.159849995723146e-02   +4.157466646626933e-01   +4.879240746547753e-01; +5.469850222689753e-01   +1.574052292758718e-01   +7.210096852050466e-01   +3.405912274070977e-01   +1.358077349392553e-01   +3.099424487954792e-01   +4.881033806170366e-02   +2.790057978370479e-01; +5.323846191589721e-01   +5.260604149638920e-01   +2.934309178605540e-01   +5.886151699439000e-01   +6.382004172211050e-02   +1.102445914079521e-01   +1.671039563798137e-01   +4.170775376689317e-01; +2.257394430268800e-01   +2.284170077145679e-01   +6.777158886137731e-01   +6.555292687693526e-01   +5.573921224097934e-01   +6.564077848854806e-01   +5.768335178285942e-01   +5.874685963877685e-01; +6.839944073641353e-01   +6.425841087351661e-01   +5.505199305108941e-02   +2.597837462761118e-01   +4.470585132958080e-01   +7.050251200471580e-01   +1.087928001884655e-01   +3.101296520810661e-01; +5.128225582378864e-01   +7.258586305137318e-01   -2.448986855479601e-03   +3.248889792273695e-01   +3.574746860995943e-01   +2.530521271053167e-01   +5.133975602348043e-01   +4.175806539912579e-01; +6.695082262747114e-01   +6.202671392337903e-01   +2.719499955041854e-02   +1.440617105454643e-01   +4.602994944939306e-01   +3.578709748575972e-01   +3.465126217959433e-02   +1.306577039425538e-01];
L1I_L2I_iGABA_netcon = [+6.259049423393853e-01   +2.245665574082250e-01   +2.655360816291081e-01   +1.826357116684291e-02   +1.191869547597518e-02   +2.852392532501414e-01   +3.717077231070274e-01   +5.980625313005226e-02   +1.620639405986663e-01   +5.940038064487757e-01   +1.116595698239600e-01   +4.886513505923826e-01   +4.309110497939033e-01   +3.552856070926947e-01   +5.922148021033511e-01   +1.784616126521658e-01; +3.146557713316798e-01   +7.574095045233226e-02   +3.377648456161541e-01   +6.724560345311049e-02   +7.197274072337332e-01   +5.115243316854428e-01   +3.171043576408512e-01   +3.437347186517062e-01   +7.294159178582969e-02   +6.478275116300858e-02   +7.102400147387465e-01   +1.253868191881564e-01   +6.904610396592289e-01   +4.507265088135878e-01   +7.374285343634728e-03   +5.324393602811798e-01; +2.458877445506535e-01   +3.209447576545615e-01   +1.808660815869390e-01   +2.305145242776377e-01   +1.059274200286709e-01   +6.607439838037984e-01   +6.177539456587158e-01   +5.963582696368169e-01   +4.648703566679454e-01   +2.370937997343907e-01   +4.999690715506153e-01   +4.697231375342116e-01   +2.955464426934564e-01   +3.868037574042339e-01   +5.910022573017821e-02   +2.200217044321812e-01; +4.231217904914898e-01   +6.998676686366114e-01   +2.867473709966609e-01   +6.371566010802258e-02   +5.443697126177471e-01   +2.520405646316191e-01   +2.220755627414062e-01   +3.201751654550843e-01   +2.248345357792272e-01   +3.533454240324163e-01   +5.304426989462327e-01   +2.069322843768787e-01   +5.778609357902090e-01   +5.916828880065013e-01   +9.955284183258370e-02   +4.255201223334242e-01; +5.425484791159750e-01   +3.440999051258613e-01   +2.872998244368844e-01   +4.938020093401545e-01   +1.591117594380721e-01   +5.087401943509194e-01   +7.942029226064065e-02   +1.769438436054330e-01   +6.588236951088837e-01   +6.407928431686745e-02   +5.538616219875445e-01   +5.845047844488493e-01   +2.235916349294959e-01   +2.422789397023385e-01   +3.112706022574078e-01   +6.361894364124321e-02; +5.647488588310798e-01   +9.249471265581762e-03   +9.834005275913117e-02   +1.259769764251011e-01   +2.060231155382332e-01   +4.945752214806229e-01   +3.596389497414846e-01   +6.269228359050292e-01   +5.811428100918038e-02   +4.892843965303550e-01   +4.628585463444722e-01   +3.348135085154292e-01   +2.671011131741461e-01   +7.046926229674829e-01   +3.293129459450793e-01   +2.627380050975608e-01; +4.771737768202801e-01   +3.179638128876167e-01   +5.665321755937031e-01   +1.370984691465803e-01   +1.871658970599756e-01   +1.334150726105894e-01   +5.999703434260321e-01   +2.974223526933414e-01   +2.412686445760942e-01   +5.719149491597293e-01   +5.365521389311750e-01   +1.115230654774264e-01   +6.996113559158037e-01   +3.352348336189891e-01   +4.120972894153705e-01   +6.500962879851137e-01; +6.277213492118673e-01   +4.064811313234857e-01   +3.844143488850636e-01   +4.336052248738750e-01   +8.057331397953713e-02   +3.959032965549621e-01   +6.355880481504080e-01   +5.549173890349242e-01   +6.229384293180389e-01   +3.418322772623720e-01   +5.279817072267552e-01   +9.095958470716879e-02   +3.471719172004570e-01   +5.301883170022477e-01   +9.398310058710012e-02   +3.644266744530189e-01];
L2E_L1E_iAMPA_netcon = [+1.395732715687783e-01   +6.014868611524679e-01   +3.632838058734001e-01   +6.217061895618287e-01   +3.701874732556263e-01   +3.037748746501594e-01   +2.829464656923347e-01   +1.640936823964980e-01; +3.028091303539449e-01   +9.343344814188659e-02   +5.649643714421332e-01   +2.248401648243742e-01   +9.577451038009802e-02   +5.908938481112914e-01   +1.905729760772737e-01   +1.918024961058445e-01; +5.791244261575428e-01   +1.628706291670146e-02   +6.713379915684469e-01   +7.059529203405380e-01   +2.300185193903455e-01   +2.395353095991440e-01   +5.982110199171237e-01   +2.418077933461115e-01; +3.059813047470183e-02   +2.681200505418615e-01   +2.336138081912876e-01   +6.772263139461612e-01   +6.729843229768036e-01   +6.873223565209490e-01   +5.025913194233045e-01   +3.077083940432722e-01; +5.922188007509857e-01   +5.523408320242925e-01   +4.057787793759930e-01   +7.242385213076069e-01   +5.772103142800016e-01   +5.416078133098502e-01   +3.262281949530995e-01   +2.137160631017863e-01; +1.467871036481204e-01   +1.402988079256198e-01   +3.391768842590953e-01   +3.443979325924746e-01   +2.140967714624259e-01   +3.048825063484781e-01   +4.352311376672336e-01   +7.131141479081148e-01; +7.215778064736771e-01   +1.089128530469357e-01   +4.968485607488247e-01   +3.226517418734990e-02   +5.272030638435509e-01   +6.594696389707680e-01   +5.845806656541882e-01   +9.407708385711743e-03; +4.060301864983357e-01   +2.611391007274564e-01   +3.485975481242056e-01   +5.608712893403731e-01   +8.081252357029223e-02   +6.489249436886119e-01   +1.154939959662327e-01   +3.942714662553213e-01; +6.444654104261355e-01   +4.863611706712986e-01   +4.234142829990487e-01   +5.112062070265726e-02   +5.120049410431145e-02   +6.167368170655151e-01   +6.812591725378495e-01   +5.944802648082880e-01; +1.371278619085321e-01   +2.782195104340947e-01   +2.450807299956997e-01   +4.376687597933419e-01   +5.631824377558986e-01   +2.111329312619036e-01   +6.120809974160263e-01   +4.085839324359974e-01; +5.597699043102650e-01   +9.893927975495229e-02   +5.620662409286636e-01   +6.425062895579340e-01   +1.719833575217426e-01   +1.190512428433216e-01   +5.785338379134605e-01   +2.856624146530106e-01; +5.866568782984051e-01   +6.576555487728444e-01   +8.379591169563098e-02   +2.351516321850947e-01   +2.462471041062521e-01   +2.807653357270776e-01   +2.590191421750053e-01   +1.067691788768028e-01; +4.422142113905405e-01   +4.704348203584007e-01   +6.762480893686147e-01   +1.193948038231366e-01   +4.137433374628625e-01   +2.577641749060083e-01   +5.213290063128233e-01   +5.467075245414739e-01; +6.038215767339742e-01   +3.947087667621880e-01   +3.439455709050271e-01   +5.214914627441342e-01   +2.711504649637819e-01   +3.443583556214552e-02   +1.055288349999858e-01   +2.952671688513937e-01; +3.695014559908541e-01   +2.644825156003522e-01   +6.354534162014462e-02   +1.023029858530985e-01   +1.052626856167741e-01   +7.067987201392163e-01   +6.899060103713680e-01   +4.733933149946629e-01; +6.147191970813869e-01   +2.987661100282145e-01   +7.402928350566704e-03   +7.026761025672482e-01   +1.048016468459420e-01   +5.098087545505036e-01   +2.453618178387902e-02   +1.683879956004643e-01];
L1E_L2E_iAMPA_netcon = [+2.853248444517598e-01   +6.578471465136815e-01   +2.894870679505491e-01   +6.812443455195896e-01   +4.590474245645061e-01   +6.491859805520904e-01   +1.458925064653896e-01   +2.556769413268908e-01   +6.405633055934030e-02   +6.754683979932288e-01   +3.379039465636995e-01   +4.557068658504302e-01   +6.569375129871267e-01   +5.433404793694938e-01   +6.663562798205239e-01   +3.441225931147524e-01; +1.157437367707243e-01   +2.089961961483235e-01   +3.684408955303238e-01   +3.564756436958318e-01   +1.520384690088219e-01   +6.938025870804436e-01   +3.306149428240678e-02   +1.420728313638261e-01   +5.863186394530583e-01   +6.341155978651067e-01   +5.772606699554301e-02   +3.683694268874711e-02   +6.020414601027796e-01   +6.159208375786452e-01   +4.575198555860498e-01   +1.992594416894868e-01; +2.305539302136337e-01   +2.239508703510759e-01   +7.927014004801283e-02   +3.204534063087425e-02   +3.585134876967958e-02   +5.580224280614419e-01   +6.270909409373800e-01   +2.870993194982299e-01   +1.481827608299680e-02   +7.221034943699197e-01   +3.251642291671826e-01   +4.329218412543672e-01   +4.385017545912840e-01   +7.166302085281572e-01   +2.463915350208976e-01   +3.932908203519073e-01; +3.689288988688192e-01   +2.343174726442392e-01   +5.635957131770514e-01   +5.527723249682910e-01   +1.635837204164954e-01   +1.628481678420506e-01   +4.967977410743450e-01   +3.478207464356995e-01   +4.005700068465683e-03   +3.965209720327466e-01   +5.466297098484965e-01   +6.118253314758140e-01   +1.269604560517675e-01   +6.254749900407762e-01   +4.726104866227862e-01   +5.961077242233130e-03; +2.439987059952637e-01   +1.138450267940698e-02   +2.422267493380668e-01   +5.850695927870685e-02   +2.554775429418557e-01   +2.069037635551071e-02   +5.552000146980406e-02   +2.908562500522849e-01   +2.898369348922989e-01   +6.818345873440408e-01   +1.485349453009285e-01   +3.188181607900104e-01   +5.998097668582253e-01   +1.997189994703570e-01   +4.365566238998970e-01   +4.851170800482971e-01; +2.152033461782770e-01   +5.307766919359849e-01   +4.067430039093486e-01   +2.453787731198442e-01   +3.571753192456498e-01   +9.750139867931126e-02   +5.616728414332784e-01   +2.087801751282323e-01   +3.719790897996037e-02   +5.391694971092823e-02   +2.949792254000426e-02   +7.009893505822137e-01   +3.680754133996358e-01   +1.188088780852826e-01   +2.846800693276476e-01   +5.934232622126052e-01; +1.795498882649199e-01   +2.683463332009803e-01   +4.914499891213613e-01   +4.135338873965245e-01   +4.732588596596135e-01   +5.464866099603537e-01   +2.691135805478840e-01   +2.794595912042786e-02   +2.072938410996568e-02   +6.985724537276464e-02   +3.606520997309710e-01   +5.948753688828556e-01   +6.501219354645976e-02   +7.118846643055300e-01   +3.307413326539884e-01   +2.268409682358407e-01; +2.089769666855422e-01   +1.090544562076948e-01   +2.674580444960918e-01   +2.410945635294676e-01   +4.023698010872708e-01   +1.631676678405575e-01   +2.985282749622110e-01   +5.339545386240179e-02   +3.075473632964876e-01   +1.192473010445405e-01   +6.249010430274577e-01   +6.740721364505498e-01   +2.101318009647261e-01   +3.329867333222308e-02   +9.641360450988586e-02   +3.482228520888339e-01];
L2I_L2E_iAMPA_netcon = [+9.914633062783967e-02   +2.846970687630911e-03   +3.591474841916850e-01   +3.804807013147124e-01   +3.850162963552026e-01   +3.588129009101889e-01   +8.033808629593059e-02   +4.444263987800684e-01; +4.369869872015881e-01   +1.158029269245318e-01   +7.295128566047625e-01   +1.719662108631440e-01   +5.570388273001653e-01   +2.833280877778934e-01   +6.309741014302750e-01   +1.066450514336204e-01; +5.563876610652776e-01   +1.276296173984271e-01   +6.411317869398019e-01   +6.971653750478354e-02   +5.795314376451324e-01   +6.252269520298660e-01   +6.936840764358834e-01   +6.919289696218355e-01; +1.702431408977578e-02   +4.199507639427114e-01   +9.460632972989437e-02   +4.000448313865830e-01   +8.371798749060454e-02   +6.300845498317745e-02   +4.830009625166370e-01   +1.608601042627305e-01; +7.218269395915896e-01   +4.106399576299865e-01   +1.527916401225948e-01   +4.219689325225017e-01   +1.113862540172738e-01   +3.314330442976048e-02   +2.709470560506260e-01   +3.151641270705555e-01; +3.239497684049781e-01   +7.246745220040249e-01   +2.578503376104549e-02   +6.508995531581422e-01   +3.812038589261771e-01   +1.246195005262567e-01   +5.346654036252803e-01   +1.769257130817580e-01; +3.361965381352255e-01   +3.757984223457450e-01   +1.770468461800447e-02   +2.721969814120697e-01   +3.578955646474756e-01   +6.302243961913162e-02   +1.345349640078145e-01   +3.839105459735971e-01; +6.535571565289049e-01   +3.891529385482680e-01   +6.602105879067250e-01   +5.796459766942600e-01   +3.681764966770004e-01   +6.343808576313800e-01   +2.617238396643610e-01   +6.972046147035498e-01];
L2E_L2I_iGABA_netcon = [+3.783622935474795e-01   +1.039387965363669e-01   +6.451318339277322e-01   +6.186379116940872e-01   +1.302231509219691e-01   +5.979196751934518e-01   +3.879844809710153e-01   +5.862747375663370e-01; +4.259097973694635e-02   +4.914669875074755e-01   +2.962191241463715e-01   +6.348539780321273e-01   +7.154515256312978e-01   +5.120576538711555e-01   +9.992901053879727e-02   +3.574497890106888e-01; +7.087628430269328e-01   +1.878848055640541e-01   +2.490367709778812e-01   +6.871488052490785e-02   +2.277559083368887e-01   +6.268942403173429e-01   +4.462773231865215e-01   +2.481863500256483e-01; +1.939488301206620e-01   +3.397739129938653e-02   +5.079502409697016e-01   +4.575265317528669e-01   +3.775109030663034e-01   +2.753618011905578e-01   +4.951121302776870e-01   +2.062607600641297e-01; +6.816650352866567e-01   +9.656734593356676e-02   +2.111988984354522e-01   +3.419892999821866e-01   +7.111139514494512e-01   +8.484095532446832e-02   +2.388721335433635e-01   +2.322847196600230e-01; +4.328563643865684e-01   +6.446264670231479e-01   +5.788442406623298e-01   +8.402105161842513e-02   +6.108230967230723e-01   +5.739832727197787e-01   +6.070051349051636e-01   +4.820426255468303e-01; +3.708350448879456e-01   +1.683017163417971e-01   +5.793919143285609e-01   +6.445125539112876e-01   +6.164750488424721e-01   +1.354486160530083e-01   +4.645809127826109e-01   +3.506625228024359e-01; +6.058623492408362e-01   +4.020035740003240e-01   +5.707195859115077e-01   +6.069986610151340e-01   +6.188417616620308e-01   +3.754231110220703e-01   +3.205904537649538e-01   +6.253833601537895e-02];
L3E_L2E_iAMPA_netcon = [+6.145848098802563e-01   +4.916964016824515e-01   +6.044028927414543e-02   +1.334785989686706e-02   +3.489397155866658e-01   +4.243645033259472e-01   +2.315050571592916e-02   +1.915857838180502e-01   +6.039030016914885e-02   +3.023608602690921e-01   +6.396381262993581e-02   +1.285065023556197e-01; +1.044986576705018e-01   +2.389309500583426e-01   +3.351789300817282e-02   +3.028910583097189e-01   +4.727367459153667e-01   +5.321136649382184e-01   +3.009557545162009e-01   +2.258071130748506e-01   +6.648705545997996e-01   +4.273850024594217e-01   +5.252710047567438e-02   +3.797538906379144e-01; +1.560977595855358e-01   +6.319183096686232e-01   +3.994291033925341e-02   +3.127035651479129e-01   +7.066607899794840e-01   +3.974142498158711e-01   +1.534937424685496e-01   +4.532222846259136e-01   +6.791873714408445e-01   +4.183804410553600e-01   +2.171943016298241e-01   +6.806451779912279e-01; +2.452866029482148e-01   +1.523714406339542e-01   +5.183729415532542e-01   +4.573162735447441e-01   +6.221272474124918e-01   +3.083367315239263e-03   +6.439541794219888e-01   +9.233196336952511e-02   +1.513606032084618e-01   +3.791081923423461e-01   +3.646664861616944e-01   +2.380701468854400e-01; +7.561147704506517e-02   +6.009542236204866e-01   +5.358653458809987e-01   +6.927419668786067e-01   +5.581756246908999e-01   +1.089478705635276e-01   +2.837679354774849e-01   +5.665866669854383e-02   +2.068943926057002e-01   +3.022888697574279e-01   +1.671581103838432e-01   +2.589215627819225e-01; +2.688507788196374e-01   +9.870416429778736e-02   +1.748842886922278e-02   +5.498431884725832e-01   +6.981937831220281e-01   +6.414669786117122e-01   +5.796572779576616e-01   +7.176503216671070e-01   +1.985485867057145e-01   +7.107363740186932e-01   +5.672842784640705e-01   +6.579456887275961e-01; +4.729387521206153e-01   +4.813256523129731e-01   +8.741472459525770e-02   +5.879349849626597e-01   +2.737911153237166e-01   +3.201689322400573e-01   +7.265243384490567e-01   +1.862049081202087e-01   +3.084429507755999e-01   +5.392886978241804e-01   +1.530326828149473e-01   +3.147175293691686e-02; +1.142775934273466e-01   +5.911440766827322e-01   +9.119098629336961e-02   +1.061164596338482e-01   +5.253816179631735e-01   +5.857776616170660e-01   +2.663996281476483e-01   +3.651713400515484e-01   +5.404926961541916e-01   +4.202927006955832e-01   +6.730395109839493e-01   +6.254757356102122e-01];
L3I_L2I_iGABA_netcon = [+6.531766249643111e-01   +4.434252057019491e-01   +4.750691729573446e-01   +2.162274130650909e-02   +6.063943440868786e-01   +2.444214685099685e-01   +2.528604293896971e-01   +4.783356369709237e-01   +1.722680627198089e-01   +6.430033721764213e-01   +5.819541452568473e-01   +4.822439499902155e-01; +6.644326730541678e-01   +5.226713565029946e-01   +5.736898254261228e-01   +4.939882494981077e-03   +1.769863765014434e-01   +1.221910877817476e-01   +2.414488457131972e-01   +2.560131764981152e-01   +3.784617871502083e-01   +6.050010497410999e-01   +5.066051110288911e-01   +7.264426782724773e-01; +5.378152939253569e-01   +1.506635840111279e-01   +4.330137285515031e-01   +4.575439089447868e-02   +6.031259536778227e-01   +5.310317703509898e-01   +1.782807474186645e-02   +2.464845481578125e-02   +4.977417355867932e-01   +5.928395951961454e-01   +1.938406696023287e-01   +7.158699431909235e-01; +5.419384560162348e-01   +2.030771871239277e-01   +6.855194492503509e-01   +6.019118703037618e-01   +2.399358704660345e-01   +6.665951539322359e-01   +1.876567454402800e-01   +8.844521773573052e-02   +2.656489011538962e-01   +7.053054379101349e-01   +5.069412276217128e-01   +4.346039482555096e-01; +5.606906660394928e-02   +1.366094810981971e-02   +1.885240748829138e-01   +3.725188162728850e-01   +7.164852052420722e-01   +6.965371012387996e-01   +6.251330540892872e-01   +6.159779141099849e-01   +4.727310204769464e-01   +9.801190614546473e-02   -1.144582120894027e-03   +2.030426518444265e-01; +1.518035391992717e-01   +5.412550307167535e-01   +5.832081954470634e-01   +1.080637577532139e-02   +4.037856534062429e-01   +5.422750372845470e-01   +4.647524784263947e-01   +5.336172591962350e-01   +6.873911042020191e-01   +1.414958637027944e-01   +4.010638633921577e-01   +2.504162760394045e-01; +6.924898874630523e-01   +4.177590420203174e-01   +6.394533643438677e-01   +4.272110399474832e-01   +5.342857661771398e-03   +3.404202261959556e-01   +2.195769345319736e-01   +3.935841219602645e-01   +2.917205562985326e-01   +2.849121362155874e-01   +2.384470012689935e-01   +3.958795289709693e-01; +4.722606898314055e-01   +2.386599698263612e-01   +5.438311717164377e-01   +6.800925732096788e-01   +3.725770154324859e-01   +5.129048699504262e-01   +3.959729921393059e-01   +5.083160862484172e-01   +5.329221075993922e-01   +9.529520545048942e-02   +1.672338196839440e-01   +6.065886494095077e-01];
L2E_L3E_iAMPA_netcon = [+3.358853113021840e-01   +6.684416125173367e-01   +1.760222489061701e-01   +7.054220152159713e-01   +5.671023156450515e-01   +3.044085047433945e-01   +1.952748268465133e-01   +9.816222408023110e-03; +1.897812175028706e-02   +3.955920820672168e-01   +5.708558826462374e-01   +5.926258922490771e-01   +1.377059668721257e-01   +8.770891488517008e-03   +5.504321014800975e-01   +9.633963308482120e-02; +5.372259598548631e-02   +2.798892446587259e-01   +7.126688051213342e-01   +5.696817269897941e-02   +6.964970584962871e-01   +3.836231573016691e-01   +1.211410484942614e-01   +6.080782633493517e-01; +2.308653057968076e-01   +4.134952581896096e-01   +5.510870263189573e-01   +2.773905802160795e-01   +2.772890303552025e-01   +1.626708098544979e-02   +1.692870473741914e-01   +5.366948290632251e-01; +4.312478040963484e-01   +5.773710301156093e-01   +6.985681089921452e-01   +3.219782014616027e-01   +6.489816031079995e-01   +6.896379828871646e-01   +2.644221649725236e-01   +4.673947875876139e-02; +6.805379715623195e-01   +6.732059405078508e-01   +3.066778271923618e-01   +5.385149284590144e-01   +1.756503461098909e-01   +2.245112414501519e-01   +4.373968314758073e-01   +2.165788196937807e-01; +1.697801913940306e-01   +2.564401066100475e-01   +1.042068899768446e-01   +4.308045509159325e-01   +5.032984072163553e-01   +5.606371016269551e-01   +5.487968400245163e-02   +5.438222600690266e-01; +2.562427941741081e-01   +6.587074934996919e-01   +9.382702750850149e-03   +6.513579070285874e-02   +2.284726937530824e-01   +9.580363913097195e-03   +1.627403103502882e-01   +3.425842108067980e-01; +6.146815793081805e-01   +6.102167741120232e-01   +3.862565630053302e-01   +5.572065904711360e-01   +2.576826224863419e-01   +3.460646314502491e-01   +5.474042501605819e-01   +2.734883614544683e-01; +4.893483005567916e-01   +3.321702938873090e-01   +3.704120246093337e-01   +5.203935087907325e-01   +4.745814012092707e-01   +6.304738021724674e-01   +5.679117359927731e-01   +4.277769411026430e-01; +3.325973049050865e-01   +1.158743864204172e-01   +4.179326005694048e-01   +2.965485299168376e-01   +6.731416743394027e-02   +3.122078660119313e-01   +7.273984041915800e-01   +5.581741678092349e-01; +2.919769487464898e-01   +3.506267176252269e-01   +1.176057754507173e-01   +2.959412040994827e-01   +5.294661617837264e-01   +2.262975765407208e-01   +4.394306349177012e-01   +1.005794651616154e-01];
L2I_L3I_iGABA_netcon = [+3.558882112336509e-01   +5.716026635139363e-01   +6.702256419734822e-01   +6.962363594392531e-01   +5.196430290835012e-01   +2.550975508003071e-01   +6.185502627737166e-01   +1.151118724995216e-01; +6.779428072325738e-01   +2.329045641369273e-01   +3.479349888285593e-02   +4.291838968494419e-01   +6.416174428665049e-01   +9.454592171982878e-02   +4.246689588099418e-02   +2.047221160252702e-01; +1.095407066318078e-01   +5.465881132215598e-01   +1.960230419899431e-01   +5.856682427359464e-01   +4.860759224662196e-01   +2.736712201608165e-03   +1.831557787729912e-01   +5.757434392383087e-01; +4.805175133294801e-01   +1.454725660386819e-01   +2.695641782167509e-01   +4.847846329015941e-01   +3.086506748440503e-01   +5.249307405565609e-01   +6.044452259176866e-01   +1.469852948448605e-01; +5.702004920883774e-01   +6.453750505709815e-01   +2.192701848821319e-01   +3.501608158052599e-01   +1.251680594018203e-01   +3.603976104083160e-02   +1.699014849671146e-01   +6.753468355821027e-01; +6.363255449975119e-01   +6.802387303841047e-01   +3.870026108058481e-01   +4.752151458138323e-01   +2.194742861711212e-01   +1.431142986456422e-01   +8.755290017838774e-02   +2.998030900732442e-01; +5.358726207895793e-01   +3.099154674167626e-02   +5.070236381171551e-01   +3.894925402213386e-01   +1.738578017555873e-01   +5.671803363978203e-01   +5.984696811426874e-01   +5.124755146524104e-01; +2.866477639071582e-01   +4.872879993142460e-01   +6.103854544513616e-01   +5.975406915357834e-01   +7.598501215812432e-02   +1.825588813952218e-01   +4.212508126032941e-01   +2.572274566056033e-01; +6.693114327237819e-01   +1.164394467465928e-01   +5.978170265663865e-01   +3.536384541287128e-01   +7.017552842158563e-01   +4.469511103237376e-01   +8.125848330327355e-02   +5.334884695487521e-01; +2.011203566861609e-01   +6.502934828414558e-02   +3.878914032986800e-01   +6.204906019813298e-01   +2.106507529791422e-01   +1.808273658378067e-01   +4.556112715952596e-01   +6.275790188688467e-01; +4.812063711169120e-01   +6.835904873018869e-01   +6.604809522459121e-01   +4.004532475655567e-01   +4.383914295696476e-01   +5.279696337734958e-01   +7.162616287911694e-02   +4.580964178890795e-01; +4.127913482852806e-01   +2.347659136760936e-01   +2.571587300798874e-01   +6.010773031085695e-01   +6.654215776697420e-01   +4.027652193310717e-01   +7.010518233496503e-01   +6.019538463181848e-01];
L3I_L3E_iAMPA_netcon = [+6.144302354051050e-02   +1.114928594471068e-01   +4.379481783906525e-01   +5.627367570018700e-01   +6.716095290345024e-02   +1.579782366362058e-01   +6.518763950553481e-01   +1.072778008177941e-01   +6.041996824185528e-01   +6.610562411910431e-01   +7.044464235817844e-01   +3.274029371872472e-01; +6.340873962999802e-01   +5.928002431829761e-01   +3.845435795878349e-01   +5.605615464899487e-01   +6.282395275190065e-01   +6.775920371106495e-01   +5.186690663214852e-01   +4.312404326859391e-01   +2.366193371075093e-01   +2.256783101189489e-01   +3.569259703272492e-01   +3.827289940512564e-01; +2.546939979802400e-01   +1.382946494223682e-01   +2.359758939037929e-01   +5.264929427111696e-01   +3.854006965151291e-01   +5.531810706802200e-01   +4.889207351602615e-01   +6.044448466903964e-01   +4.353232924971838e-01   +5.376652939420218e-01   +4.976533372315907e-01   +3.652605719088617e-01; +5.448876753898609e-01   +5.420407915610151e-01   +6.186202426029161e-01   +6.034319626563268e-01   +2.842505876434192e-02   +8.714297413889271e-02   +4.232578735768603e-01   +5.260966936486355e-01   +1.434144617923914e-01   +6.507479663996918e-01   +6.494018052762417e-01   +8.915284574897266e-02; +1.938856010239240e-01   +2.625609358368897e-01   +5.400695184317585e-02   +2.778881833830025e-01   +1.297085535864309e-01   +6.690313221320682e-01   +6.070057558615859e-01   +8.858781560636116e-02   +3.803660794580643e-01   +7.209803027911103e-01   +6.785786547487291e-01   +6.973407799860006e-01; +6.451806829759589e-01   +6.364215512435605e-01   +1.676062215730633e-01   +3.380443597019278e-01   +6.592724941131700e-01   +4.724719402070911e-01   +5.915328213319982e-01   +4.992126045475571e-01   +3.388639327324284e-01   +4.606254312022043e-01   +1.796252747019364e-01   +1.099389099840156e-01; +1.752405291120013e-02   +1.979810782373363e-01   +5.173257860818706e-01   +8.848822712202464e-02   +4.854944031822565e-01   +3.514734522027108e-01   +1.050250120469346e-01   +2.481406139249623e-01   +5.517312391132281e-01   +1.212090491258476e-01   +9.749074086243963e-02   +6.956639510853606e-01; +7.094010931256518e-01   +4.943032471520184e-01   +2.999918992498599e-01   +5.213868092562165e-01   +2.782301181341901e-01   +2.748022924321151e-01   +3.835998829384705e-01   +1.892465100602727e-01   +5.356396492961425e-01   +4.956719237334856e-02   +6.679835479275302e-01   +3.786989752179053e-01; +2.082232772764080e-01   +6.250407502461316e-01   +2.663241181304536e-01   +5.716845126646537e-01   +5.105011717736339e-01   +2.582611571094434e-01   +2.426091223403843e-01   +7.040925273658828e-01   +5.894962017426288e-01   +4.261819147212039e-01   +5.848439117278721e-01   +4.583585609273207e-01; +3.350124104993554e-01   +1.320431356464673e-03   +4.553334095468765e-01   +3.419283920337248e-02   +2.050338412881667e-01   +6.243731746522960e-01   +1.152850576476904e-01   +3.810982287204475e-01   +6.319185131849007e-01   +7.197777825266781e-01   +1.795167616248954e-01   +6.528483017978448e-01; +8.084967240992116e-02   +6.022043347029956e-01   +1.659934176341178e-01   +3.450964102308778e-01   +2.849925078408415e-01   +5.126790752800539e-01   +6.934156071948266e-01   +5.927941460302880e-01   +3.616779476669847e-01   +2.270378976099721e-01   +2.479854120062868e-01   +4.220758514231099e-01; +2.387797581885868e-01   +4.127021247497036e-01   +1.925656714504331e-01   +1.130247357720246e-01   +4.072445837970919e-01   +2.191187785328149e-01   +3.916517998878460e-01   +4.768195835394970e-02   +2.821156806148174e-02   +4.734812368049983e-01   +2.913903502918750e-01   +3.883760298141173e-01];
L3E_L3I_iGABA_netcon = [+4.941386652023966e-01   +5.146387485893978e-01   +5.540198327645263e-01   +1.544358075269481e-02   +2.043574755187446e-01   -3.022011920000608e-03   +2.895336502696588e-01   +2.703258362953239e-01   +5.640710680536959e-01   +1.170480934051148e-01   +2.937600663947360e-01   +6.243736683968712e-02; +1.294419180941502e-01   +7.168177311909151e-01   +2.715351174100337e-01   +4.119425003937121e-01   +2.002784354510948e-01   +4.206816201293160e-01   +6.823972655626971e-01   +7.458124641152704e-02   +4.592473322622747e-01   +9.474967932565574e-02   +8.663847776954682e-02   +3.732295913988625e-01; +2.582270549261844e-01   +6.224250651670920e-01   +3.333395064327883e-01   +7.075088427484170e-02   +7.386459044324994e-02   +5.436631551323101e-01   +3.282986062328686e-01   +1.942287616536320e-01   +4.954064812713648e-01   +1.124794871846149e-01   +6.629255271742325e-01   +5.219858730822282e-01; +2.734666741425275e-01   +6.305443571331470e-01   +4.769422162773478e-01   +6.482456366340544e-01   +3.332551160662536e-01   +4.807991261440765e-01   +6.542695245431545e-01   +7.400276403932375e-02   +5.471661224442053e-01   +4.024283357650197e-01   +5.904007016236721e-01   +2.018329913576940e-02; +5.963160337768705e-01   +5.793987406753116e-01   +2.701001961218711e-01   +2.781164740820319e-01   +1.322187259220904e-01   +3.774421921784224e-01   +6.009601989374505e-01   +3.329730947393391e-01   +4.236833718082256e-01   +3.264597793409539e-01   +5.084640805013668e-01   +8.437820739011349e-03; +4.021671964582509e-01   +4.336059486128021e-01   +8.662882018238599e-02   +5.035208082466282e-02   +3.258757038041611e-01   +9.214747864000576e-02   +5.488841733449755e-01   +1.621731654151511e-01   +7.021503838175981e-01   +8.567361455229866e-02   +4.973437012568866e-01   +8.919731871495878e-02; +3.822231683323477e-01   +3.946855648217932e-01   +1.055414140013004e-01   +4.382708284955090e-01   +4.281876412814754e-01   +6.613868402831755e-01   +6.513405635979288e-01   +5.320266791259521e-01   +3.486679557045458e-01   +4.894776981597155e-01   +6.732569824851923e-01   +1.099672160418545e-01; +6.785437192500464e-01   +2.718422862561642e-01   +3.492905680662073e-01   +5.220346244236709e-01   +1.138813785317409e-01   +2.342468577123904e-01   +2.503576674834497e-01   +2.533155494030216e-01   +2.706225551155488e-01   +2.916011102726943e-01   +2.677822602792460e-01   +6.981886555557203e-01; +5.095277917085256e-02   +3.273466037318359e-01   +6.697618514474325e-01   +2.466038930506967e-01   +3.120061175606356e-01   +6.294349542598382e-01   +6.314111056195058e-01   +8.223937397312518e-02   +6.666300681391149e-01   +3.920997637413277e-01   +3.683719819627057e-01   +5.113226870055552e-01; +1.671193793586470e-01   +4.029771183383045e-01   +8.255828834961640e-02   +6.985748477499210e-01   +5.218597214404982e-01   +2.826916285127447e-01   +3.063712021421201e-01   +4.252008974764272e-01   +5.596148860145911e-01   +6.617832298647865e-01   +5.735980049348316e-01   +1.969740881091595e-02; +1.745036855133599e-01   +6.591824702334705e-01   +4.446746695892496e-02   +4.078637884242196e-01   +6.735212844110430e-01   +2.717724435120626e-01   +2.654370984976918e-01   +1.194410167271530e-01   +6.118969170859379e-01   +5.013642574550450e-01   +2.214561031184751e-02   +5.772130607785613e-01; +3.334421924369381e-01   +1.110400374878791e-01   +6.313313107615112e-01   -1.557774319045849e-05   +5.452856638078514e-01   +6.528280916012070e-01   +1.502753115241256e-01   +2.992243110673782e-01   +5.626754050823266e-01   +2.817622189919389e-01   +2.558442440592273e-02   +1.932933759249731e-01];
L2E_Input1_iAMPA_netcon = [+4.829280542383673e-02   +9.682761318592496e-02   +6.563919988138027e-01   +2.504608605678729e-01   +8.607961487971336e-02   +3.150869124920043e-01   +2.410666046799980e-01   +1.243844771399757e-01];
L2I_Input2_iAMPA_netcon = [+1.721611255293852e-01   +3.138321029012637e-01   +2.120402751079264e-01   +2.944875289692926e-01   +3.891048642223937e-01   +3.987466201282689e-01   +1.505064758551752e-01   +6.551192358465328e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
