function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.029169064013900e-01   +6.513255104975126e-01   +3.122991217891945e-01   +3.185222229620698e-01   +2.646188837395566e-01   -3.406479714575273e-01   +3.425179030260363e-01   +1.696288352405374e-01   -4.808650492024755e-02   +3.421762613637986e-01   +3.114591437431954e-01   -7.766590843569071e-02   +1.057332784445774e-01   +1.067555421558147e-01   +4.092830740863410e-01   +8.493078684383099e-01; +5.134387883280201e-01   +1.085640596841495e-01   +4.100108748229220e-01   +1.862883145216453e-01   +2.119251887540429e-01   -1.204960328068813e-01   +1.569402797526976e-01   +1.345235198029107e-01   +3.865058851633031e-01   +2.729419661636098e-01   +3.075215129029239e-01   +2.297674146111540e-01   +7.378704369590597e-01   -2.289776050138013e-01   +3.119627896830082e-01   +5.861955995641396e-02; -3.984256727643124e-02   +4.712940790898234e-01   -3.943031604566982e-02   +3.513693884436725e-02   +1.195757174165154e-01   +3.580356047223258e-01   +1.576464607905252e-03   +4.457043579167100e-01   +8.503891798594587e-02   +6.296856444964434e-01   +3.709951494964004e-01   +3.485343513432768e-01   +7.152792639466821e-02   +3.650482109546499e-01   +2.082128944269431e-01   +4.679503250568646e-01; +2.427594594634602e-01   +7.414692503678258e-01   +3.115564751604871e-02   -9.561917858502531e-02   +4.027612174664227e-01   +1.489956807162206e-01   +7.595476361778725e-03   +2.529695709626425e-01   +2.598470786884773e-01   +2.400050217207677e-01   -2.125602234357220e-01   +3.401439512272678e-01   +1.557030352099180e-01   +2.789287648640262e-01   +4.161792906486090e-01   +1.575718841425260e-01; +1.003397925365438e-01   +1.252620204420707e-01   +1.760740102095865e-01   +3.002184579931849e-01   +1.771752650464377e-01   +4.767726205649885e-01   +7.889860689176199e-02   +2.008345435578002e-01   -2.031727784810944e-01   +1.074341877116501e-02   +5.087367649907701e-01   -1.148139713564311e-01   -1.300263058828104e-01   +2.627236215652338e-01   +4.051138958971467e-02   -1.448093690131387e-01; -8.374369568190490e-02   +4.254128256574882e-01   -1.862236268174573e-01   -6.902329529273923e-02   +4.283151524067560e-01   +3.707830121152993e-01   +1.219410477626344e-02   -7.789506796537397e-02   +1.023294686447208e-01   +1.678575547913597e-02   +1.484376444221728e-03   +2.762635256869480e-01   +2.013489995003592e-02   -6.682833798663393e-02   -3.871491932883172e-01   +2.808746800411768e-02; -1.963548865058935e-01   +1.728826146148376e-01   +3.391873178270708e-01   +7.692911126009225e-01   +1.834859449802493e-01   +1.155391290677067e-01   +2.240884824785873e-01   +2.898903364764374e-01   +2.932021285042583e-01   +1.282779048974701e-01   +3.668383163460038e-01   +2.740176974365061e-01   +2.649188828736510e-01   +3.567884305996931e-01   +6.596222532253405e-01   -1.690315940491008e-01; +2.714111710466460e-01   +5.775782583343568e-01   +8.443403656857031e-02   +1.483158043669545e-01   +5.344603695250119e-01   +3.439645951780763e-01   +1.818393752178251e-01   +6.591962323530307e-02   +2.507174070562092e-01   -2.080456894169667e-02   +3.695396012319718e-01   -4.023002367011306e-02   +8.885032507703258e-02   +1.958412325974024e-01   +3.599011814156286e-01   +4.742015416970859e-01; +2.509325805012225e-01   +7.834843885572279e-02   -2.196727545420514e-01   +1.997073898888862e-01   +2.905679915453769e-01   +7.491039017869135e-02   +3.863140821926769e-01   +5.813338623075894e-01   +3.447504772809352e-01   +3.754692484227902e-01   +3.659210733186811e-01   +3.998153968746160e-01   +2.907996518039265e-01   +1.797622399719993e-01   +7.915603231414167e-02   +4.185009969923637e-01; +3.200263829384831e-01   +1.023043530886840e-01   +6.304717198351857e-01   +9.022750750747337e-02   +4.426699644937084e-01   +3.012944441906542e-01   +5.044380000232529e-01   +7.953447462397345e-02   +6.004083664571715e-02   +4.071521398964117e-01   +3.074441908239899e-01   +9.320069220593971e-02   -2.380766806294291e-02   +1.466670521820617e-01   +2.916932693279602e-01   +2.873368191767200e-01; +1.706531175502847e-01   +1.063725694780055e-01   +1.997627132435875e-01   +2.763142201836311e-01   +3.877498979270776e-03   +5.133489071017525e-02   +4.414399130739984e-01   +1.420828608405132e-01   +3.498153552591989e-01   +2.209729334328427e-01   +4.725829719170944e-01   +3.402282646598614e-01   +2.712621167361081e-01   +2.764165857946891e-01   +1.613599924003795e-01   +1.733325356725755e-01; -4.573330610928114e-02   +3.029541523425730e-01   +4.801871114517376e-01   -6.611500377578315e-02   +3.038273150769444e-01   +1.055114918418524e-01   -4.669520868892269e-02   +1.523842609361704e-01   +5.794738406630442e-01   +2.052734479578803e-01   -7.376059418270119e-02   +6.403728636684005e-01   -9.214068605426169e-02   +1.759290185692283e-01   +6.470765528405198e-01   +5.348387848510194e-01; +5.469784729335762e-01   +1.992086344102517e-01   -6.809834515494725e-02   +2.406373704816582e-01   +5.073799114513464e-01   +1.541703400181242e-01   +7.213101249430913e-02   +2.380414831852573e-01   +2.337254346974775e-01   +2.764717671626443e-01   +2.538635702207599e-01   -1.447012687597542e-01   +7.509591173664387e-02   +2.942852629933922e-01   +3.013901420824913e-01   +2.095618766638379e-01; +2.544427835386617e-01   -7.862044163842555e-02   +4.444990745160827e-02   +5.190587886226685e-01   -1.596164559506531e-01   +2.362906704733002e-01   +2.074803364680176e-01   +3.504110377752898e-01   +1.963051534843915e-01   +3.050457400403442e-01   +1.601100734734991e-01   +4.326588370965042e-01   +3.396333264222695e-01   +1.592071546768250e-01   +5.248618145922134e-01   +2.002968955188649e-01; +4.648317431243396e-01   +4.727563867780837e-01   +3.716631466225390e-01   +3.628789981315949e-01   +9.512767236753135e-02   +5.476556702997724e-01   -6.178446861123576e-03   +9.021113327561994e-02   -3.158713203917449e-02   +4.609621779546818e-01   +3.192428323183728e-01   +3.815104952275755e-01   -1.741304419157463e-01   +2.999190141143754e-02   +1.878535965403337e-01   +2.514816102041757e-01; +1.906386168019401e-01   +3.397715165146900e-01   +2.288791373269455e-01   +5.059252174796508e-01   +2.588452433275286e-02   +1.957930035438069e-01   +1.774137107485508e-01   +6.837608977721486e-02   -9.748104037057315e-02   +8.159719514220828e-02   +5.264987878239490e-01   +4.718750872116364e-01   +4.199427100214485e-01   +3.680719443671823e-01   +4.360337080279748e-01   +6.608701314379762e-01];
L1E_L1I_iGABA_netcon = [+4.826946629021165e-01   +2.525421619743156e-01   +4.566857513352088e-01   +4.428422982305543e-01   +5.992340265472357e-01   +6.646073984973229e-01   +5.170759218208224e-01   +1.932449710796237e-01   +1.692210350632384e-01   +4.450317557075285e-01   +3.604984655299046e-01   +7.601693368942841e-02   +3.669942427046648e-02   +9.652280297026819e-02   +5.961917652227384e-01   +4.395969486032733e-01; +1.709203214686724e-01   +1.484391149070229e-01   +4.029446694758053e-01   +1.875701303055919e-01   +3.012896128786656e-01   +2.659790093143212e-01   +5.591974585505332e-01   +4.001678886959130e-01   -1.589476166031476e-01   +2.091406706345785e-01   -1.679422839161304e-02   +2.791111427084231e-01   -2.744674897149830e-01   +1.508776484633150e-01   +6.570966689480751e-01   +1.769709636416313e-01; +2.943763240059153e-01   +1.028811673561013e-01   -2.873506830425945e-01   +5.228864928015291e-01   +5.485871891469397e-02   +6.859136054330056e-01   -1.198053991202106e-01   +2.731728939844583e-01   +4.585806919571029e-01   +4.057045999054658e-01   +8.530023618186144e-02   +5.348928754387823e-01   -4.645699726948031e-02   +2.887653986699477e-01   +2.967869852009546e-01   +1.239444046032124e-01; +2.610975220751933e-01   +2.509223926306447e-02   +5.986695600721818e-01   +4.006871567549550e-01   +3.512041624029492e-01   +3.118035245008359e-01   +2.954631125436093e-01   +2.156220620348489e-01   +1.200869536177780e-01   +2.142492292981545e-01   -9.944300644675381e-02   +4.472216707725417e-01   +5.319219574507396e-01   -6.211890790607910e-03   +7.908208175993585e-02   +4.132455026802314e-01; +4.809998251881261e-01   +1.773440210328607e-01   +2.265602261647315e-01   +2.059422802084549e-01   +2.014549810838925e-01   +1.876554088293429e-01   -1.922672692455936e-01   +4.201918018671054e-01   +3.041372861778463e-01   +1.083554014294150e-01   +4.545020484833900e-01   +2.024886659394703e-01   +2.435627703696781e-01   +2.190538493453820e-01   +2.200183467568378e-01   +2.737711260100893e-02; +2.171152464469155e-01   -1.056300758587821e-01   +4.568724981074063e-01   +3.536168130575017e-02   +3.750690644846145e-01   -5.967151754183293e-02   +4.413423441987986e-01   +5.356510936112329e-01   +7.154038128364235e-01   -1.909726090360994e-01   +1.633532053524330e-01   +6.821671718528693e-01   +9.966069370663803e-03   -4.453918346601023e-02   +6.952954135542680e-02   -1.992517549611514e-01; +4.365428356304161e-01   +1.976286467090704e-01   +1.926735842019158e-02   +2.879843090307334e-01   +4.971238413055037e-01   +4.239506817538019e-01   -5.811800590293394e-02   +3.281789930499839e-01   +5.258538910974094e-01   +2.014481809783358e-01   +6.064643543966959e-02   -6.233269714534552e-02   +2.964231595843028e-01   +1.837646472583329e-01   -6.016438318741074e-03   +4.686892299211653e-01; +1.334353426594040e-01   +5.665412193414689e-01   -6.992393029352444e-02   +3.896920326896911e-01   +3.761852504231381e-01   +8.849967697688980e-02   -5.815692045366500e-02   +6.603438889748418e-01   +4.997636538367777e-01   +5.510174278777126e-01   -1.227356580230358e-01   +1.956169004991424e-01   +2.118729495769802e-01   -8.188385403029871e-02   -9.878548150830473e-02   +5.185210084776676e-01; +4.471562732652807e-01   +6.322181947035036e-01   -1.114242109548607e-01   +5.698232230438107e-01   +8.195084268683968e-01   +3.888382001448371e-01   +2.118479966748674e-01   -1.042010035227005e-01   +7.869786897419381e-02   +3.125772000806131e-01   +5.136125235723844e-01   +1.449149679246986e-01   +3.708478199371509e-01   +1.557066377268972e-01   +2.118373804606266e-01   +1.282490075127723e-01; +2.463359673798305e-01   +5.877318471788460e-01   +6.257067647588560e-01   +1.391183375379198e-01   +3.209938093661081e-02   +1.389633039401406e-01   +1.959542184187919e-01   +4.231455723289202e-01   +3.388599214758410e-01   +1.792119827029235e-01   +5.437935638352347e-02   +5.963442194256701e-01   +1.643969928750825e-02   -4.983610183800613e-03   +5.077027162300972e-01   +3.798807654304329e-02; +2.571844027041064e-01   +4.796408300101321e-01   +9.865784437064262e-03   +2.814236097748321e-01   -3.204502667865539e-01   +3.787707265937420e-01   +4.177196965582399e-01   +5.603089538564383e-01   -1.259851210273860e-01   +5.715379185351951e-01   +3.729426417855453e-01   +1.026389333448319e-01   +3.508318126495250e-01   -8.757903258922745e-02   +4.255612221768374e-01   +3.917982597363126e-01; -1.206223400813728e-01   -1.755778330715638e-01   -9.445635429404292e-02   +3.135929716028260e-01   -1.219425599467691e-01   +9.183353285369747e-02   +4.473173578768878e-01   -8.790347861052017e-02   +3.692149638558281e-02   +3.373260921983052e-01   +7.431486022777636e-01   +9.439331591506427e-02   +3.608244010486805e-01   +4.333067956894186e-02   +4.565993615391714e-01   +2.242195269168646e-01; +2.245703631236458e-01   +4.020627155315083e-01   +3.577510838917837e-01   +2.906992148906044e-01   +2.148636781082190e-01   +4.020499886308015e-01   +1.080378335379276e-01   +5.238519724407997e-01   -1.144839570461771e-01   +1.470074183095805e-01   +2.397308188448230e-03   +3.343763498778459e-01   +2.556115440398567e-02   +2.188756011215390e-01   +3.358432076810375e-01   +5.869305752356239e-01; -1.896274568360617e-02   +4.076572027609214e-01   +9.699298158150067e-02   +1.246428757514873e-01   +5.932508763277746e-01   +3.104279604737499e-01   +2.370552883380363e-02   +5.115680220190485e-01   +2.918517245664072e-01   -7.448540216139704e-02   +2.492289700569871e-02   +3.936989914487753e-01   -8.622383491919620e-02   +6.034130012565174e-02   +4.494039535131382e-01   +1.593493129223035e-01; +4.994540283599148e-01   +3.485455008824940e-01   +3.718280233582558e-01   +2.620860203623783e-01   +2.174707474581707e-01   +1.190012563381120e-01   +7.085950107636117e-02   -3.251264873765140e-01   +2.806065447985775e-01   +4.574681029915502e-01   +4.203392429455490e-01   +7.099221306415301e-02   +2.104208889431755e-01   -1.369103680900707e-01   +5.941129522472128e-01   +6.522392837240722e-02; -1.189665809793723e-01   +4.732791274313652e-01   +3.307683379804462e-01   +5.040054390542139e-01   -1.431774463328467e-01   +9.835927076922785e-02   +2.257326996999336e-01   +5.236377097453716e-01   +2.818055602265111e-01   +1.970173493195695e-01   +3.560305081342861e-01   +3.702889701912111e-01   -1.034422283359149e-01   -9.487790682088708e-02   +1.338271155374639e-01   +6.126194663108908e-01];
L2I_L1I_iGABA_netcon = [+2.175976093306800e-01   +8.751202893883070e-01   -1.617815416736074e-01   +3.870841682292958e-01   +3.829162755069517e-01   +3.156481815146016e-01   +4.573508261932302e-01   +5.521313753965287e-02; +5.441227497363660e-01   +4.182726033262282e-01   -2.068899180773630e-01   +1.432321902643034e-01   +6.921591735441306e-02   +1.754659576645551e-01   +3.869678323927007e-01   -4.426123075791027e-01; -1.347222986296983e-01   +5.913132349978897e-01   +2.362279475527438e-01   -2.166798209945068e-01   +6.554563811872693e-01   +1.299247142065525e-01   -7.732663136600476e-02   +1.238900990018195e-01; +1.354839029679875e-01   +2.384208407806299e-01   +8.411590058980065e-02   +1.948575462631655e-01   -5.321019758555667e-02   +2.952108805467214e-01   +3.920407365611935e-01   +2.844133655085319e-01; +5.438248200382453e-01   -3.373418622488397e-01   +1.959853074052375e-01   +4.827211510573898e-02   +2.822644577847240e-01   +3.469036268123509e-01   +5.008901699602794e-01   -8.250992742792806e-02; +5.142395461597704e-01   +1.383215462589577e-01   +1.658772692558341e-01   +1.527965568405457e-02   +6.290165322097083e-01   +2.378767839985537e-01   +1.440425298461785e-01   +3.342688841414918e-01; +1.023208886756713e-01   +3.397833137590182e-01   +2.485815426377223e-01   +8.304993328502873e-02   +6.732234696454548e-01   +4.231333170219917e-01   +2.567141651315255e-01   +1.856276422389274e-01; +2.097123989458324e-02   +5.880735626371646e-01   +3.688106509911179e-01   +4.987475171235619e-01   +3.274912417392548e-01   +6.938712691993297e-01   +4.557978659908510e-01   +5.506949603679312e-01; +1.310299261215280e-01   +2.143932072632964e-01   +2.857255259667095e-01   +1.479348698921704e-01   +3.108675459314745e-01   +1.760710145947099e-01   -4.363024828694002e-02   +2.355328451959333e-01; +5.250263589413641e-01   +2.947898879727710e-01   +2.535078912126807e-01   +3.473018226663946e-01   +5.594480023267039e-01   -2.106120461414113e-01   +1.014513730583854e-01   +4.009307634035947e-01; +4.916644786045398e-01   +3.101143901172151e-01   +5.489453799910688e-01   +4.730857094887728e-01   +1.467106252218565e-01   +5.325752960340465e-01   +5.720234595004891e-01   +9.201324525931322e-02; +1.122678103812385e-01   +1.187513159037430e-01   +4.169918659379702e-01   +3.625027367654773e-01   +2.098378297329025e-01   +9.868849619198219e-02   +1.499414655929062e-01   -3.887040699203911e-03; +7.644875647236393e-02   +2.550645067234916e-01   -1.333749977833886e-02   +7.900880712079053e-02   +1.251550622125841e-01   +1.210785309354201e-01   +4.381044031309406e-01   +8.673704757025016e-02; +3.686652584337426e-01   +6.875512911066030e-02   +2.079901523819606e-01   +4.506045848378419e-01   +1.005375705978657e-01   +2.412782194219309e-01   +1.513992705360366e-01   +5.211614294152082e-02; +3.859174730381013e-01   +2.831011746158572e-01   +3.834519099427762e-01   +2.899444209552410e-01   +4.097424708609681e-01   +2.552289862841694e-01   +2.580263364015553e-02   -2.119940823404812e-02; +2.367852870596706e-01   +5.339414415199058e-02   +4.521017735398317e-02   +2.796648491401236e-01   -1.375215616217372e-01   -1.674160303493920e-01   -7.003244841377548e-02   +1.775383537312402e-01];
L1I_L2I_iGABA_netcon = [+3.548142072994120e-01   +2.160592189005557e-02   -5.863362586705428e-02   +3.215046489867769e-01   +8.413613211810862e-02   -3.502297876065779e-01   +1.043643514491386e-01   +1.641461343017745e-01   +2.598622204230856e-01   +2.240857150877930e-01   +1.812850066118005e-01   +2.411844675648826e-01   +1.070109767465713e-01   +4.771496500681649e-01   +1.771392394157499e-01   +4.472767927156377e-01; +4.582719488823227e-01   +3.148557360356539e-01   +1.539519580776508e-01   +4.422125516262159e-01   +4.916861157769374e-01   +9.607115257057885e-02   +7.385811229379405e-02   +2.816222588028244e-01   +1.180842721401840e-01   +1.267873411399022e-02   -1.543790375140320e-01   +1.152824470428729e-01   +4.469232672632212e-01   +1.192950886573424e-01   +2.591710006839150e-02   +3.678007244005821e-01; +1.073640522819728e-01   +9.869388426289101e-02   +1.915227947171041e-01   +5.334163147992281e-01   +1.186081862462467e-01   +2.117174391945070e-01   +5.292836879314753e-01   +1.489640042480492e-01   +6.205712736560393e-01   +4.988718955119518e-01   +1.883424726212548e-01   +3.226921994993253e-01   -1.827589762726470e-01   +2.010937389470453e-01   +3.696853172723690e-01   +7.725183705235986e-02; +4.522441486647570e-01   +1.057897290612524e-01   -5.866190728965130e-02   +3.172268523828579e-01   +2.140992637123676e-01   +1.702783749879747e-01   -1.087174781712021e-01   +3.667969684641527e-01   +7.908968462145883e-01   +2.914827156787479e-01   +5.357980513495144e-01   +6.156375753220485e-01   +2.536125723483303e-01   +3.439224961053046e-01   +2.202152876268424e-01   -1.041870476316406e-01; -2.441190571486749e-02   +2.091800058800178e-02   +2.497039266447322e-01   +5.252426979388316e-01   +2.321069027830294e-01   +3.845857259595247e-01   +4.270987985191602e-01   +6.376202099306272e-01   +7.776231426845381e-02   +1.791357846196160e-01   +6.640175367099139e-01   +2.157397258438853e-01   +2.251799641570602e-02   +2.526109880768148e-01   -2.464604091798226e-02   +1.065127829055325e-01; +3.101584289032279e-01   +2.038769509125385e-01   +5.616298244796996e-01   +6.703229101132603e-02   +3.895726390304027e-04   +1.381526955286701e-02   +2.502971716029272e-01   +5.143801840212818e-01   +5.533341391374842e-01   -1.584162234572468e-01   +1.221929479188172e-01   +3.141954533614383e-01   +1.582085002475975e-01   -3.514267577216046e-02   +7.358567619687171e-01   +2.276853051145913e-01; +3.865073615540408e-02   +3.270390702109330e-01   +5.364968860842850e-02   -3.279410787912500e-02   -1.644051604211836e-01   +7.012958185850620e-01   +3.385634707464085e-02   -1.279401421332834e-01   -8.511797032746229e-02   +3.634299941532968e-01   +3.147321793179439e-02   +6.918200686058126e-01   -1.514487883045378e-01   +3.688184656334234e-01   +5.030607992401013e-01   +4.185352198541983e-01; +3.688953826715482e-01   +4.961924816167569e-01   -9.224015501419373e-03   +1.733384899095560e-01   +1.584900977418332e-01   +1.152656196675952e-01   +3.623801345364475e-01   -4.802180473061847e-02   +1.108886533779555e-01   +1.486122622173187e-01   +9.440239970872773e-02   -3.124457629106879e-02   +2.110075495115654e-01   +5.834981091511150e-01   +2.216981435594664e-01   +2.482093749922234e-01];
L2E_L1E_iAMPA_netcon = [+5.864958006820927e-02   +2.619248290905635e-01   +2.474685914754451e-01   +4.430077795658606e-01   +4.685686829971112e-01   -1.214830408445410e-01   +1.681141374171285e-01   -1.829258837852238e-02; -9.183201337701732e-02   +4.704070729052679e-01   +3.867169584050519e-01   -6.443002797189366e-02   +7.178519997566685e-01   +4.852198159952447e-01   +2.234067577387494e-01   +6.588326867101567e-02; -6.931258020734968e-03   +3.028230938677795e-01   +7.811726326684558e-02   +7.341411510470053e-02   +3.452986188235352e-01   +3.483303592833766e-01   +2.111226893330152e-01   +1.104237306671794e-02; -2.729907948158509e-02   +1.017871221044648e-01   -1.693670914095410e-01   +1.270822184254981e-01   +4.769931952348646e-02   +1.328590514219713e-01   +4.879968340374687e-01   -1.398511882100963e-01; -5.715554396726152e-02   -1.350670389381008e-01   +4.328744574455186e-01   +1.494020180448797e-01   -2.175779260972028e-01   +2.365621221212671e-01   +1.095722747948288e-01   +2.397051457258072e-02; +1.506980782404582e-01   +4.251824564191207e-01   +1.860195164911345e-01   +3.184344944652739e-01   +4.695721477488389e-01   +1.221567806699014e-01   +3.482080134593333e-02   +4.254125307591132e-01; +2.102117031845600e-01   -1.042175485212583e-01   +4.056940514266737e-01   +5.323026507376220e-01   +2.433578441814154e-01   +7.106450230647468e-01   +1.978922610347024e-01   -7.017223504899123e-02; -1.267055213741371e-01   +1.990540106715862e-01   +3.210616090437117e-01   +1.413184777255033e-01   +8.595951780880341e-03   +5.090922118983574e-01   -1.706108773634734e-01   +2.785548974099777e-01; +4.501829485463492e-01   +2.445872713323716e-01   +3.794874826099476e-01   -3.377741035970506e-01   +5.024602931043557e-01   +2.136729991166084e-02   +1.196448049139089e-01   +3.381422228099843e-01; +4.064103950840015e-01   +4.958890717981823e-01   +2.492972188404047e-01   +3.948981569243480e-01   -7.320803124776139e-02   +5.515389041227486e-01   +3.299497795148710e-01   +3.309722954946730e-01; +1.609852183958855e-01   +4.968067435475319e-01   +4.608634647658677e-01   +8.716592618349618e-02   -1.373749103071651e-01   +4.740649885031425e-01   -9.444686469949036e-02   +3.255673213173162e-01; +3.162069910322861e-01   +1.408778882245733e-01   +1.210379907934335e-01   +3.132605530057713e-02   +1.673245877135438e-01   +2.455734495046755e-01   +1.317501276584133e-01   +9.328450969657777e-02; +2.515268854725886e-01   +3.161945427413813e-01   +1.151367533322111e-01   +1.872426469358335e-01   +1.921633920105293e-01   +1.192532987284195e-01   -3.224476673904477e-01   +3.815162565538520e-01; +1.173239511213328e-01   +3.924389032464066e-01   +3.869398911920827e-01   +3.675988188901764e-01   +2.040380663642749e-01   -1.606379044315811e-01   -3.021624261485403e-01   +2.142649495049858e-01; +2.072954007059900e-01   +4.913691062814908e-01   -6.790377848778051e-02   +4.384886077472227e-01   +2.630478544889681e-01   +3.795119238434200e-01   +4.839454758072871e-01   +1.248906404599102e-01; -8.793826608069065e-03   +2.369213544007381e-01   -9.168939299763622e-02   +4.951104863864764e-01   +3.546607311284486e-01   +5.370836141362426e-01   +5.215244344801824e-01   +5.710087428786003e-01];
L1E_L2E_iAMPA_netcon = [+2.044802971262907e-01   +2.312043527656050e-01   +4.098327773700211e-01   +2.847004143055153e-01   -3.709301372734241e-02   +2.685048418449228e-01   +5.282977415111310e-01   +3.442208353416163e-01   +3.973677098541324e-01   +4.434521588668337e-01   +2.484925510304111e-01   +4.284662013447946e-03   +5.167384465966125e-01   -1.688565895429927e-01   +4.098680894276922e-01   -1.585071330764968e-01; +3.722216627366277e-01   +3.308499742110572e-01   +4.979574112238144e-01   +1.998536013778811e-02   -9.537229198924532e-02   +1.286576067154044e-01   +1.350233969674951e-02   +3.827501873989695e-01   +5.418893021047810e-02   +2.725460088102371e-01   +7.196182221209290e-01   +3.779279586169409e-01   +3.074743884604302e-01   +2.258257370878532e-01   +2.972321527316230e-01   +4.249813669397812e-01; +1.099583260333959e-01   +2.950000834133979e-01   +3.576654267082778e-01   +1.494408960539583e-04   +1.941854084125199e-01   +1.352853038890692e-01   -5.930415449324306e-02   +6.606040843293849e-01   +6.807354843832701e-01   +3.079749814723015e-01   +2.097063810299481e-01   +5.263074546446832e-01   +4.073551139828719e-01   +3.830709242981540e-01   +1.552309608978802e-01   +5.560292778091490e-01; +2.558588616378553e-01   +2.556533035711346e-02   -1.815048679808678e-01   -1.304299595478947e-01   +8.445981069884571e-02   +1.809529948798527e-02   +7.863116984352952e-01   +2.166908113791351e-01   +4.416019245127772e-01   -4.605472190982839e-02   +4.753939550143514e-01   +4.417802382963386e-01   +2.382626473766631e-01   +2.387842369010414e-02   +1.148774167090599e-01   +5.225086988015905e-01; -8.427096532970377e-02   +3.797835001162265e-01   +4.922985304980336e-01   +1.823168175747474e-01   +7.134050914696093e-01   +4.960109509033303e-01   -2.546187817062325e-01   +2.912624391909471e-01   -1.613272299544684e-01   +1.466352182230485e-01   +8.602429112687429e-02   +4.155203638432059e-01   +5.164515327293899e-01   +5.859014884383883e-01   -1.514461382853352e-01   +3.465006855885719e-01; +9.899613033334653e-02   -9.847754059133698e-02   +5.820524152894394e-01   +5.502677008769731e-01   -9.656718841112107e-02   -9.763937859642755e-02   +3.900074145833507e-02   +5.549972077844509e-01   +2.694089846487890e-01   +1.375463989610142e-01   +1.371467289423531e-01   -2.516102973006141e-02   -4.969533937579795e-02   +3.743747267252878e-01   -3.265682490244177e-01   +4.047098578278757e-01; -6.003012186346377e-02   +3.004880197097047e-01   -7.374171657323906e-03   -7.838873928526303e-02   -1.318829229176580e-01   -7.374359773015202e-02   -1.937961691734959e-01   +1.116256213783317e-01   +1.760884469268997e-01   +2.089931510960284e-01   +3.457394052863889e-01   +7.427078463289282e-01   +3.766732322973889e-01   +2.496508241266208e-01   +5.011238032243368e-01   +2.261427066690333e-02; +5.332989308639973e-01   +1.158090318087016e-01   +6.737227703013711e-01   +2.172994547622334e-01   +6.359642627812562e-01   +3.385962542059048e-02   +3.893263967832091e-01   +1.118743945876530e-01   +1.196141936858937e-01   +8.497487145728842e-02   -2.063407553763789e-01   -4.651135112808782e-01   +4.474493159559653e-01   +2.674573262195101e-01   +3.467244477175547e-01   +3.466529397999744e-01];
L2I_L2E_iAMPA_netcon = [+6.796137641940651e-02   +2.461142587019934e-01   +2.276236840277887e-01   +3.273348096864377e-01   +4.210232544887632e-01   -1.987863474258446e-01   +3.754720841485438e-01   +4.183247958092934e-01; +9.972716663480188e-02   +6.010322858376575e-02   -2.056820661785076e-01   +4.148764928810040e-01   -2.024508453540736e-01   +2.708565574049518e-01   +3.237425824918297e-01   +4.823769577552282e-01; +3.984360597681321e-01   +9.529211293890856e-02   +3.010633674400022e-01   -7.507009660194008e-02   -6.207251136164965e-02   +7.903333326921441e-02   +1.085854385086800e-01   +4.457175603711553e-01; -2.100599166228828e-01   +5.168230509280805e-01   +4.271148728236627e-01   +1.491123341072211e-01   -2.263302432292506e-02   +8.759282514783043e-02   +5.781881363096659e-01   -1.100541935204059e-02; +1.616208688628429e-01   +2.899533085469732e-01   +5.656708922918190e-02   +1.360295683539595e-01   +1.043098447880385e-01   +1.434746213266556e-01   +4.734517813171434e-01   +1.761940981654100e-01; +2.364809180562350e-01   +2.437481658742427e-01   +1.893942350274868e-01   +4.139808867589413e-01   +4.502258246061934e-01   +5.169391008089127e-01   +4.169744017222052e-01   +4.458512367021180e-01; -1.372924573558563e-01   -1.441164356968852e-01   -1.964986239778897e-01   +5.992333464615601e-01   +7.816754186774245e-02   -2.531984696814107e-02   +2.329698536343632e-01   +4.024795649772998e-01; +1.260084118787403e-01   +2.583114783646876e-01   +1.431395404063388e-01   +1.221163751825680e-01   +3.311058425995757e-01   +1.343444481817075e-01   +8.180011165216557e-03   +2.344924689938672e-01];
L2E_L2I_iGABA_netcon = [+3.730981737880266e-01   +2.436693202194533e-01   +4.027701713396160e-01   +2.590287874500962e-01   +2.602486528626752e-01   +3.610530292106123e-02   +3.217645777224704e-01   +2.225983688481778e-02; +5.274165083524965e-01   -2.329991838073780e-01   +2.178071080932328e-01   +5.995032395418718e-01   +1.308525649630718e-01   -1.367196909814013e-01   +1.699257907856963e-01   -1.135176892088300e-01; +4.170049784271768e-01   +2.157461597974721e-01   -5.892047918791120e-02   +2.223047064719653e-01   +1.945077908174551e-01   +1.889405850014270e-01   +5.025020886674191e-01   +4.426120827822757e-01; +3.493036813787246e-01   +3.391788561611661e-01   +3.600840370639820e-01   +2.410705240891688e-01   -1.002587600871001e-01   -2.412953047202566e-02   +1.978944782314649e-01   +4.011124097695604e-01; +6.691694704325035e-01   +3.431849703212962e-01   +3.129515130292702e-01   +8.800730780212081e-02   +4.197142364927966e-02   +3.285932274758784e-01   -1.082343287552299e-01   +2.895305848833412e-02; +1.297360894374652e-01   +4.308083281935298e-01   +1.197371582282298e-01   +9.381532037597795e-02   +2.472805412136514e-01   +5.116574048293700e-02   +4.100440683472746e-01   -9.383603953350361e-02; +8.580971122507275e-03   +2.730974970032578e-01   +5.886386028154816e-02   +3.364207540111286e-01   +1.496860099972992e-01   +3.101736608109554e-01   -1.531801809876307e-02   +2.429089289876725e-01; +3.907690958352070e-03   +5.571045835295477e-02   +1.148397538467767e-01   +4.612581808138981e-01   +3.628331200909606e-02   +3.522744303255443e-01   +4.933925764111452e-01   -1.195380594888761e-01];
L3E_L2E_iAMPA_netcon = [+1.375917405966268e-01   +3.194609822324738e-01   +1.968601502125827e-01   +6.574842278616194e-01   +4.450871263389338e-01   +4.054344083536390e-01   +1.475051204331015e-01   +5.682646856214300e-02   +1.569120973645234e-01   +3.013989374735045e-01   +1.099033370193725e-01   +2.751835935921654e-01; -1.596387612471940e-01   -1.821844284645181e-02   -1.135194192592519e-02   +2.343334533025131e-01   +2.288559552215588e-01   +1.194457099142205e-01   +4.059347085187504e-01   +9.312027736003581e-02   +2.435224656388887e-01   +4.637866003277303e-01   +4.343155439780230e-01   -7.580785464026117e-02; -4.982598799628239e-02   +2.582714337959691e-01   +2.520837964835758e-01   +4.003983057349574e-01   -1.620455690381862e-01   +5.200644384671700e-01   +3.078074330417273e-01   +6.217708195362968e-01   +3.934294510613352e-02   +5.790618678951724e-01   +2.353950633367202e-01   +6.032511744549677e-01; +2.710289108736391e-01   +6.116173851085582e-02   +3.409563502025041e-02   +2.410469470530572e-01   +3.289875773633634e-01   +1.283032255771034e-01   +2.389400142499250e-01   +4.997358319330451e-02   +3.151942827732671e-01   +4.296054955744356e-01   +2.409777067448089e-01   -1.274626545731442e-01; +2.510863481825097e-01   +1.924396739042447e-01   +1.970017577689901e-01   -2.735902027280588e-02   +2.754054685255551e-01   +5.382876046913916e-01   +3.215929232045823e-01   +2.695018983374252e-01   +5.912763934855234e-02   -7.522887860403835e-02   +1.507895705507766e-01   +9.134070106160164e-02; -2.217264750613518e-02   -8.312188680169973e-02   +5.891214054908576e-02   +1.455088491826325e-01   -2.318110453953142e-02   +3.528688827628136e-01   +6.052539038676311e-01   +3.045590597948994e-01   +3.711930538177820e-01   +5.690365061629046e-02   +2.732249625308197e-01   +8.494869031511158e-02; +2.730512283589867e-02   +3.478507929178160e-01   +4.274746329238864e-01   +1.276505547810653e-01   +1.832325379949489e-01   -1.130391495767169e-01   +2.144604551687437e-01   +5.185560644090129e-01   +3.876709609514530e-01   +1.041771705886837e-01   +1.666550499893944e-01   +2.219435096893518e-01; +9.826406128707342e-02   +2.137790843105652e-01   +4.914899088672075e-02   +1.456670112284451e-02   +2.064468647184636e-01   +8.338940927014532e-02   +2.855177397029214e-01   +1.622001769753648e-01   +4.501919153276759e-01   -1.033224264499031e-01   -7.394683559770140e-02   +2.213792687439973e-01];
L3I_L2I_iGABA_netcon = [+2.878960431320172e-01   +2.587525901780803e-01   +4.713979907115805e-01   +1.253782252384885e-01   -1.117362291276779e-01   +5.634638134277395e-01   -2.850678738162702e-01   -1.958332433157350e-01   +2.693170829332146e-01   +2.838772385515256e-01   +5.699072678072096e-01   +2.423059850458552e-01; +5.174597314760276e-01   -3.386956977018839e-02   +3.077155717935762e-01   +1.746066094502408e-01   +6.110528312277644e-01   +4.739114118504936e-01   +1.262384065469010e-01   +5.399268970327901e-01   +4.194938970947296e-02   +1.501443618744518e-01   +1.895043243079026e-01   -3.859537976964114e-02; +3.808806044386117e-01   +1.599136416481154e-01   -9.466519781115426e-02   +6.651940666745060e-02   +2.471038729729568e-01   +1.763853416702431e-01   +2.077992813866890e-01   +3.983069943826658e-01   +3.391892603960273e-01   +2.546902544392984e-01   +6.504490384265078e-01   +2.149476181137149e-01; +5.133402280398749e-01   +2.952013136830925e-01   +3.642206196416308e-01   +3.663190885671165e-01   +3.681031374572768e-01   +2.681293471620757e-01   +7.975122074966360e-01   +4.483312560869813e-01   +2.183836747243117e-01   +3.600475323424961e-01   +1.521532634994884e-01   -1.128080612679981e-01; +5.413701332999291e-02   +3.805571712288302e-01   +5.519879274347569e-01   +3.428201823114488e-01   +1.979437915152100e-01   +2.624972444858421e-01   +3.498151725092565e-01   +5.532651339334773e-01   +1.282756762763310e-01   +5.201839329850141e-01   -8.730422871752075e-02   +1.004884102046377e-01; +4.413020301720307e-01   +6.364221379535878e-02   +3.653246141308946e-01   +5.834092912727713e-02   +3.430676360359657e-01   +3.956912790198385e-01   +8.153207413617167e-02   +1.320294691987611e-01   +6.370122314111530e-02   -3.337743742665100e-02   +1.279210896481515e-01   +4.893721865849428e-01; -3.747680150296009e-02   +1.418035150396579e-01   +1.888245196285397e-01   +4.765805807830379e-01   +5.647175978481775e-01   +6.413717975574135e-01   +3.582369937965771e-01   +6.680013489722756e-01   -1.445127719132371e-01   +2.017031975971976e-01   +2.478807250116282e-01   +2.613288830140357e-01; +6.341405405437681e-01   +2.938588543933263e-01   +3.321285677248648e-01   +5.435312541629557e-01   +1.332605627740271e-01   +3.186470390363572e-01   -2.950107067956164e-01   +5.748350113319349e-02   -1.485360493323412e-01   +2.277844582305844e-01   +2.264045484073098e-01   +7.709839182339887e-02];
L2E_L3E_iAMPA_netcon = [+7.993353265180288e-02   +2.821242751509613e-01   +3.929461311499529e-01   -7.103338311630794e-02   +5.826626586225466e-02   +8.756049076174043e-01   +5.637492898431217e-01   +1.753782700076792e-01; +3.028272889845248e-01   -2.188635483640597e-01   +7.302639448623545e-02   +5.105680403573131e-01   -5.888054840374969e-02   +1.753141781638081e-01   +1.321193540414090e-01   +1.884690496073993e-01; +3.013643077707658e-01   +3.467287665614375e-01   +1.192697816297155e-01   +1.376376972213720e-01   +3.255236333245030e-01   +2.261244889183054e-01   +2.711341950834537e-01   +5.260471940864452e-01; +2.780229828609853e-01   +3.376248602817160e-01   +4.432802119038270e-01   -2.268874075177780e-01   +4.134171002277983e-01   +4.405665072084523e-01   +3.495526657026866e-01   +3.672811939558951e-01; +2.133718854435600e-01   +6.493254557131912e-01   -2.086213896250007e-01   -1.655143246820685e-02   +2.099209885581749e-01   -5.196102496113747e-02   +4.935980107739350e-01   +3.178634647626004e-01; +5.279337565580677e-01   +3.587162685920906e-01   +1.560524085529509e-01   -2.698801939219565e-02   -3.302291993397026e-01   +4.126190337372050e-01   +2.562990573160353e-01   +2.782614050913959e-01; +3.233236971377879e-01   +4.294163690402151e-01   +1.657718844984238e-01   -2.132829599823654e-02   +1.637498101236213e-01   +2.097655522255845e-01   +5.308202650614890e-01   +2.868732751231928e-01; +2.355267138006788e-01   +2.744900351214523e-01   +4.958772565539457e-01   +4.942364494924202e-01   +2.647045226677797e-01   +2.612435517666195e-01   +7.062482138502889e-02   +2.367888860209967e-01; -3.473403638922662e-02   -1.278655731547779e-01   -6.754825457615608e-02   +2.298042531400383e-02   -4.261963329152221e-02   +3.280904476102997e-01   -4.509465874406011e-02   +2.497361151889549e-01; -2.552819957124539e-01   +1.811878190706491e-01   +1.352594008224090e-01   +1.837210127396402e-01   +1.929621856718167e-01   +3.815737409162299e-01   +4.152156635285000e-01   +1.548322895966571e-01; +4.045359216182448e-01   +5.254990477106064e-01   +3.225327422725283e-01   +3.298479118010418e-01   +2.457616945558021e-01   -3.303315877688833e-01   +4.792421115347506e-01   -2.123008002439885e-01; +3.295722711245705e-01   +2.399528138838727e-01   +2.600865549486258e-01   -3.019118329962076e-02   +2.290422642776597e-01   +4.234204897382778e-01   +1.283475575410702e-01   +6.849671648798099e-01];
L2I_L3I_iGABA_netcon = [+1.855754645248157e-01   +6.352964008695173e-01   +1.771937258136782e-01   +1.781165939819544e-01   +3.836631567563108e-02   +6.023386968522332e-01   +4.720851072985071e-01   +3.892785882742347e-01; +1.368422755234845e-01   +2.294083506782789e-01   +5.387954306360933e-01   +2.825644986235660e-01   +4.660241924409231e-01   +4.289569565913655e-01   -2.000403631338114e-01   -1.617242844966757e-01; +3.962749354407956e-01   +4.033756105054654e-01   +3.041992109850490e-01   +3.310105068572209e-01   +1.344569648763385e-02   +1.096745682972066e-01   +4.871669483112149e-01   +2.259535104483835e-02; +2.000870609424540e-01   +5.164897274175877e-01   +3.299718252201218e-01   +6.138041777751473e-02   +2.356240528603011e-01   +4.451030004356855e-01   +1.198182569232600e-01   +3.472325204675477e-01; +2.083012479540233e-01   +2.067714096583626e-01   +4.381931815166681e-01   -2.323808667921938e-02   +3.633296931080316e-01   +1.141704217947156e-01   +2.369536966099777e-01   +2.902840991583261e-01; +3.054972952607560e-01   +3.442162415577487e-01   -6.237389960536983e-02   +7.171319364240569e-01   -1.616044479376322e-01   +2.765848999474005e-02   +2.058720468398681e-01   +6.015738064469225e-01; +1.905992719571983e-02   -7.474909753927718e-02   +2.606753855499660e-01   -6.292396273959930e-02   +6.117744749628841e-01   +6.636133810371534e-01   +1.100546108329984e-02   -1.498860857078848e-01; +4.033763722401186e-01   -2.727565242904142e-01   +5.252720514991218e-01   +2.516966233243755e-01   +1.902132040379994e-01   +1.437697105862001e-01   -2.286672921641960e-01   +5.617802165914543e-01; +7.676606849963227e-02   -5.663637005174497e-02   +9.507970069667437e-02   -5.890491893753026e-02   +2.330181649301113e-02   +2.838874296842716e-01   +2.871850964749780e-01   -1.988600082574297e-01; +8.788419819836794e-02   +4.328505458982339e-01   +5.790070450609834e-01   +3.167259688652258e-01   -7.104047568632371e-02   +2.114665004065782e-01   -1.435156457241387e-01   -6.310912881687449e-02; +3.057921469923673e-01   +4.932964869162444e-01   +2.805322552585773e-02   +3.395393943132608e-01   +2.408687922896575e-01   +2.612046011731704e-02   +2.318979206830614e-01   -5.674303213006761e-02; +3.197404168997742e-01   +1.191111858239032e-01   -9.154166116515509e-02   +6.730849975800851e-02   +5.532949335464253e-01   +1.011265771403226e-01   +5.081438125945855e-01   +1.455497625796725e-01];
L3I_L3E_iAMPA_netcon = [+1.695215662983438e-01   +2.621182560405568e-01   -2.746482679718953e-02   +3.291870225396949e-01   +6.832683912421954e-01   -2.991018660130199e-03   -1.593634809371162e-01   +1.315562027282882e-02   +5.271862838199617e-01   +2.517374670904869e-01   +3.932323853907543e-04   +4.518611789883378e-01; -4.458690703547281e-03   +1.893125094032150e-02   +5.283092187752741e-01   +1.951539833712979e-01   +3.708536572100501e-01   +1.206155881340824e-01   -9.165116241927056e-03   +3.552127393121748e-01   +5.048433722089067e-01   +4.766459618552508e-01   +2.239884287824166e-01   +5.373955756905474e-01; +1.446401875818323e-01   +4.641685075940799e-01   -5.582638206269504e-02   -2.149268788432321e-01   +4.916612087822973e-01   +1.867022725057964e-01   +1.228782329935179e-01   +3.454963529725652e-01   +3.264134488722731e-02   +2.720004632216426e-01   +2.955374149276823e-01   +4.803936707945326e-02; +1.292698490132220e-01   -3.405948741796208e-02   +2.353337731574801e-01   +5.717763880575578e-01   +2.747458272397083e-01   +8.659024406356290e-01   +4.157223107972719e-01   +5.142615808079692e-01   +1.329481278809361e-01   +2.469029952540984e-01   +3.388718925809548e-01   +3.703181447829354e-01; +7.297518369686172e-02   +3.411869390201183e-01   +2.362868144599284e-01   +1.960369006612404e-01   +3.625387862206261e-01   +3.909898937535063e-01   +2.379896464922605e-01   +1.297270541404198e-01   +2.905615236423810e-02   +2.932460442467712e-01   +3.066979832579648e-01   -1.546882214832276e-01; +2.217043333321149e-01   -1.125123999571292e-02   +3.873923675732455e-01   +3.736076376765249e-01   -2.228517581885187e-02   +2.310444532341961e-01   -9.294702829781344e-02   +6.289438389589799e-01   +2.535731053050689e-01   +2.006576050851808e-02   +1.402150840316130e-01   +6.806050057026010e-02; -7.903483273871567e-03   +5.107322538961561e-01   +7.992791671309889e-02   -1.407846749999022e-01   +1.872857976677035e-01   +2.028364843082058e-01   +6.058784571681285e-01   +2.365978596098463e-01   +5.743802152314745e-01   +2.174066737493240e-01   +2.693971631832385e-01   +2.290730537772366e-03; +2.810882736406719e-01   +4.941695150109346e-01   +6.290253021472393e-01   +8.735641050040219e-02   +2.319878492731519e-01   +4.339157756784630e-01   -1.382125752706104e-03   +4.114550570400047e-01   +2.925638667176401e-01   +5.258917341791336e-02   +3.788745506299657e-01   +1.036042278396805e-01; -7.727289182585215e-02   +1.513583081408926e-01   +3.217655139052163e-01   +1.168732335747149e-01   +3.656874943276218e-01   +9.886098202362739e-02   +1.576945521929254e-01   +4.874805083344743e-01   +2.906313408317136e-01   -4.847865054810578e-03   +1.270419173383014e-01   +4.105802754244668e-01; +4.525623008452635e-01   +2.819086533054948e-01   -1.778226213613630e-02   +2.480504841904731e-01   +2.864229543919557e-01   +1.604954192325118e-01   -1.174900943413389e-02   -1.572212742329365e-01   +4.363272490306302e-01   +8.252940828200525e-01   +1.208659374330841e-01   +2.900057818686335e-01; -9.996674767686163e-02   +6.550687236326597e-02   -3.178611979070986e-02   +2.386909471593781e-01   +2.606678074131926e-01   -2.092509326290931e-03   +2.728466193267408e-01   +1.614178809254098e-01   +4.353635156696994e-02   +9.957021488250595e-02   +4.835028334855869e-01   +2.578682882644645e-01; -7.360555598659005e-02   +5.771935655429808e-01   +2.762363112158515e-01   +3.992049740548903e-01   +1.591175712901594e-01   +3.255929251745879e-01   +5.350624960731984e-01   +3.711763701079604e-01   -5.260994756097152e-02   +2.709592872063014e-01   +4.571832682369485e-01   +7.992834200442406e-02];
L3E_L3I_iGABA_netcon = [+3.353513157641850e-01   +4.458443205412292e-01   +3.369373225283078e-01   +6.563516752054220e-01   +3.524843771339273e-01   +6.311599809477838e-01   +2.656112960387133e-01   -1.771834815992173e-01   +1.363549387972954e-01   +5.952042260885964e-01   +1.960175893020867e-01   -5.403581520744390e-02; +3.001491107739048e-01   +3.638635123953626e-01   +4.902547442734551e-02   +2.894177377800924e-01   +3.365602629989222e-01   +6.628463297441652e-01   +2.436461243116732e-02   +5.437456578953233e-01   +4.947703293873018e-01   +5.515452599938434e-01   +5.402675045253187e-01   +3.470541109197539e-01; +1.702569377509440e-01   -1.285714094209684e-01   +2.058085242816275e-01   -1.355733386139044e-01   +6.296211878031113e-01   +3.085014656025395e-01   +1.547180123201997e-01   +1.626471755878728e-01   +1.662648626639527e-01   +3.799937900647313e-01   +1.091635911348311e-01   +3.358204802183573e-01; -1.465760992587099e-01   +3.337919010209149e-01   +5.966620283489658e-02   +1.574020755308967e-01   +5.103395863353664e-01   +2.632628549185529e-01   +1.168827512987233e-01   -2.959423462207766e-01   +7.662196366122710e-02   +3.092069236081812e-01   +2.737442321043876e-01   +5.925795019856559e-02; +1.858831948079163e-01   +1.171399735308746e-01   +4.301397617197329e-01   +3.110057742261671e-01   +4.001732898024777e-01   +5.284619460321955e-01   -8.482173119745826e-02   +2.285193102398871e-01   +2.359706075678430e-01   +6.980520888653448e-02   +2.064485022745605e-01   +1.984461406209458e-01; +3.825671908389132e-01   -1.382655474617865e-01   +1.331240735412839e-01   -1.015176041524549e-01   -3.855489265926847e-02   +2.527726511024788e-02   +1.746672906312302e-01   +3.265691403068971e-01   +1.995972057215787e-01   +3.817375236597306e-01   +2.203067194066429e-01   +4.932272640237327e-01; +1.651476033213513e-01   +2.507106071898481e-01   +2.580773833893197e-01   +4.060911011602408e-01   -9.009246362351947e-02   +3.826108178969250e-01   +3.590371062407086e-01   -2.016633094531285e-01   +9.099676577820598e-03   +4.418279337575250e-04   +3.566514237320298e-01   +1.799508111519789e-01; -2.717456591835383e-02   -1.367242486007798e-02   +5.550496977045641e-01   -1.063993916088502e-01   +1.471159184102491e-01   +2.931511400127348e-01   +2.533920794751103e-01   +3.271859707571016e-01   +3.418958970265214e-01   +2.518164322770902e-02   +5.246483731239797e-01   +8.485815886569259e-02; -1.010386539789081e-01   +5.774266371982408e-01   +2.908016246252649e-01   +1.800359936093046e-01   +3.961228218401870e-01   +7.795872035023906e-02   -1.384540486646269e-01   +6.410926626836655e-02   +4.062037235861445e-01   +1.877528536675470e-01   +4.334297390096839e-02   -7.043994245783029e-02; +3.098560072140997e-01   +3.502141464672137e-01   +4.022508969867560e-01   -1.417821758903928e-02   +1.906323911661054e-01   +3.194271971285931e-02   +3.975611874027785e-01   +5.522686399092370e-01   +1.036772962277620e-01   -1.411716271130869e-01   +5.008673980919390e-01   -2.328395763297281e-01; +2.844361222053555e-01   -9.359534512841693e-02   +5.384696509815515e-02   +3.256469686643005e-01   +1.938281122983644e-01   +1.528248471143063e-01   +4.757555417613687e-01   +1.918421017557862e-01   +1.511644841400898e-01   +6.651305016870717e-01   +3.834306388693847e-01   +7.857266826380763e-02; +1.370845254658725e-01   +3.903385553005435e-01   +3.133150187932041e-01   +2.288726210292326e-01   -6.972476128511942e-02   +7.769614184521807e-02   +2.199252057594649e-01   +3.484669971416515e-01   +3.120549548651934e-01   +1.530459722702656e-01   -7.409031514659539e-02   +5.615796985350571e-01];
L2E_Input1_iAMPA_netcon = [+2.873705606468457e-01   -2.159675781596766e-01   +6.930233121061105e-01   +2.690441050929578e-01   +2.562567799131548e-01   -2.743121694444479e-01   +1.739792447682330e-01   +2.050389349779427e-01];
L2I_Input2_iAMPA_netcon = [-5.253600674719437e-02   +2.048732153903600e-01   +5.015442631900077e-01   +6.552068437850338e-01   +3.020332955614621e-01   +7.394670634215102e-02   +6.310866956122995e-01   +7.192500247984336e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 30*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 30*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
