function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.114101680750524e-01   -1.019534802347722e-01   +5.356674687423171e-02   -1.098748729068972e-01   +4.859689746371677e-01   +5.362084680976749e-02   +3.644896392634684e-01   +5.694423122704311e-01   +1.731449809097440e-01   +6.932936451680249e-02   -4.112896881878306e-02   +5.596880683081632e-01   +5.947615387639288e-01   +2.349067091351974e-01   +1.666731693775312e-03   +3.310290757333221e-01; +4.069494764065504e-01   +2.935964851650837e-01   +7.056222091390320e-01   +3.602057545101457e-01   +2.764546748421338e-01   +4.308180695416565e-01   +7.546636233332692e-01   +2.089080898168820e-01   +4.334857768533718e-01   +7.178601675210760e-01   +2.153384058008289e-01   +5.288743727141063e-01   +3.231244015786685e-01   +1.825703105296938e-01   -5.188966605325327e-02   +6.702896199032995e-01; +3.704302669775120e-01   +7.651254059167336e-01   +7.192002123807887e-01   +3.939013304618499e-01   +7.815069495398784e-01   +5.978059997004640e-01   +2.809187078821743e-01   +2.180628660450687e-01   -1.772928207006181e-01   +6.776329312621289e-01   +5.087213489342913e-01   +5.407292422688085e-01   +1.683500479616925e-01   +2.618818606954301e-01   +8.317139128870370e-01   -2.523564863159093e-01; +5.377724017911938e-01   +3.184013817502498e-01   +5.534208706255295e-01   +9.256808214376941e-01   +4.497969647263296e-01   +2.975623831480677e-01   +4.349369074002655e-02   +1.110626387721249e-01   +4.404285224141647e-01   +4.849291336660369e-01   +5.132574341277364e-01   -1.266828293668421e-01   +9.000125535620116e-01   +1.898391664033158e-02   +3.725973659930349e-01   -8.805643507466700e-02; +7.280723843865495e-01   +8.153700207400213e-01   +3.332385187999814e-01   -1.555944876508721e-01   +7.397361563379318e-01   +6.004701409664208e-03   +1.926566337554580e-01   +2.658367094028609e-01   +1.000000000000000e+00   +2.582528157895688e-01   +6.267622017028701e-01   +4.882967539082371e-01   +3.860710542016420e-01   +2.693651619941898e-01   +1.772092755215377e-02   +3.430291783238367e-01; +9.518601069997165e-02   +8.425924064492561e-01   +6.480583379775499e-02   +8.638086205892647e-01   +5.276123712941055e-01   +4.277005334590218e-01   +2.200905156498189e-01   +4.527505297544522e-01   +3.655240777742798e-01   +1.004794800204050e-02   +1.687333047528923e-01   +3.918728528624164e-01   +4.146164941700620e-01   +4.755497133765285e-01   +3.640084806811588e-01   +2.294490258562188e-01; -5.529942420631690e-02   +2.133055103584215e-01   +4.051502504323026e-01   +1.131898476461994e-01   +1.683546440614330e-01   +5.159200340477477e-01   +2.651019407919089e-02   +3.721591319034458e-01   +7.026316793301018e-02   +3.168196730606598e-01   -4.572371574226013e-02   +6.108319335876629e-01   +6.712829481822945e-01   +1.057309179771965e-01   -6.696837973836561e-04   +5.542778534226837e-01; +2.950636830343941e-01   -1.880295712178794e-02   -8.447138865236334e-03   +2.454237446634732e-01   +4.249236398120589e-01   +6.755044039680448e-02   -6.776871589703766e-02   +3.333460736207726e-01   +1.227652371317905e-01   +9.978507414958659e-01   +2.167280542148191e-01   +3.918341029072553e-01   -1.014786493669922e-01   +2.881530506163638e-01   -3.404996477684669e-02   +1.893398438405463e-01; +2.692983624520341e-01   +6.758869379766065e-01   +2.489508672721966e-01   +3.447746552204300e-01   +2.626861579787391e-01   +8.302811123254585e-01   +6.837762413657372e-01   -1.195588839326726e-01   +2.683575765133674e-01   +2.829339836647101e-01   +7.338987733026152e-01   +4.563087858509264e-03   +4.395159396508851e-01   +3.997653191780107e-01   -4.773024990941204e-03   +6.360164973547375e-01; +5.770041493008187e-01   +4.399299780244159e-01   +7.146012985157250e-02   +6.158093922756324e-02   +3.479371319576765e-01   +5.227838001175612e-01   +3.752621880021715e-01   +3.055960570473973e-01   -2.451142139240798e-01   -2.895781981603821e-01   +4.160041657745595e-01   +4.390399923809263e-01   +5.973646142003523e-03   +7.667197217829154e-01   +4.607555373148319e-01   +5.289510345121039e-01; +1.114956474599488e-01   +5.292152955835857e-01   -1.800002434572946e-01   +9.213882447687048e-02   +3.418671920410007e-01   +2.279960022321741e-01   +2.929068381114332e-01   +6.175843659138238e-01   +3.488124525881503e-01   +8.351892553822163e-02   +1.725814523637974e-01   -4.890576427830930e-02   +1.348514268990836e-01   +4.857697314958043e-01   +2.584816307683421e-01   +3.045801777289087e-01; +4.388916208182295e-01   +1.887626296540135e-01   +2.002109492291793e-01   +2.864858714584511e-01   +7.255320398310255e-01   +6.258510082256457e-01   +1.537660877470776e-01   +6.643021467521958e-01   +2.129733925531485e-02   +4.511496669499412e-02   +4.715265109474759e-01   +7.482070063514276e-01   +3.524394203361071e-01   +3.144387473054178e-01   +8.667257113724525e-01   +8.254795742024087e-01; +5.162237404218611e-01   +2.528327162242242e-01   +9.408811572324196e-01   +4.902386177878971e-01   -2.007117866376971e-02   +4.191132879916417e-01   +9.179630676969373e-01   +3.625096905625563e-01   +8.397244779809415e-01   +2.283250409534554e-01   +1.893156729024022e-01   +5.868093207756406e-01   +3.575582235374566e-01   -2.365907705572501e-01   +3.334932180804846e-01   +5.433436622452907e-01; +8.716958074902403e-01   +3.846374529146434e-01   +5.794484161742203e-01   -7.119882106411786e-02   +7.678973368410967e-01   +5.385685090197543e-01   +3.664446055234613e-01   -8.673513815020836e-02   +4.007217770629618e-01   +5.152968139615633e-01   +3.902725714191098e-01   +3.210220615866421e-01   +5.132760506855541e-02   +1.448745848127957e-01   +6.453034746218281e-01   +1.626078685203411e-01; +2.156173605806770e-01   +7.573968768660824e-01   +5.862959500096270e-01   +2.496100655270991e-01   +2.243267631112531e-01   +2.071251359927886e-01   +4.307283207911585e-01   -4.627385232497574e-02   +1.652218537621927e-01   +1.177765481331369e-02   +1.950980654156129e-01   +6.236364920811884e-01   +3.312119144001585e-01   +8.298094721532385e-01   +3.388413817544045e-01   +2.705717239954361e-01; +7.980598312238280e-01   -9.570347432545867e-02   +3.637856724260474e-01   -1.466673330953830e-01   +2.078019402057310e-01   -1.918853402820893e-01   +9.043063287596341e-01   +3.503612401707961e-01   +5.993438756956331e-01   +4.213132255376543e-01   +2.548854895957988e-01   +3.979566139845668e-01   +7.165246934253716e-01   +1.829729255268354e-01   +5.997821799736125e-01   +7.780681137327343e-01];
L1E_L1I_iGABA_netcon = [-8.892222451236748e-02   +4.057929499084099e-02   +3.411592441680716e-01   +3.305480647989936e-02   -4.383182095035992e-02   +4.620632062556128e-01   +6.777958090376935e-01   +4.248323055455716e-01   +5.973895785520281e-01   +5.401605564884366e-01   -1.157029306813088e-01   +3.278742732439321e-02   +3.765414091201997e-01   +1.552238535906506e-01   +4.247658530065116e-01   +4.809512395731140e-01; +5.500797634846480e-01   +1.679708752612236e-01   +3.380760110399836e-01   +1.225260014242962e-01   +2.276015940895300e-02   +7.748026592500799e-01   +4.875536516231659e-01   +8.156077986084628e-02   +4.481857212010550e-01   +4.042599342044663e-01   +3.856046647845681e-01   +3.336399481517462e-01   +6.392945813949288e-01   +2.992847622398891e-01   +6.470126464337800e-01   +4.518529518458399e-01; -1.662188548800129e-01   +4.504421157887759e-01   +5.167226862134667e-01   +5.376636748179090e-01   +2.421028866267104e-01   +1.306961211654584e-01   +7.071213364270835e-01   +3.221966915378364e-01   -1.380386110434831e-01   +4.632342537652557e-01   +4.075356642911269e-01   -5.403713199252295e-02   +3.877880124348644e-01   +7.963724258204407e-01   +4.794718877261187e-01   +7.244250280964774e-01; +5.503440058658228e-01   -3.975447119443240e-02   +6.687887892910924e-01   +5.826935199094385e-01   +1.911293606429778e-01   +3.024510717960837e-01   +4.827535884650769e-01   +1.768927544198265e-01   -2.479052960653474e-02   +5.325144993283021e-01   +5.263675813643397e-01   +3.507031077030690e-01   +6.838987047049440e-01   +5.459808688023985e-01   +8.190753409587758e-01   +2.984238661544243e-01; +3.422894300571084e-01   +2.863960376442689e-01   +3.756493089898104e-01   +7.790784545124027e-01   +6.801387032666874e-01   +2.986747665653762e-01   -2.491462849173110e-01   +7.564639331787975e-01   +1.857732742023302e-01   +6.702158388539463e-01   +5.084968113270936e-01   +1.129088246866880e-01   +3.142614007292489e-01   +3.259594850861371e-01   +6.456468434640480e-01   +4.240393724644329e-01; +5.932029237946593e-01   +6.043274547770148e-01   +1.494815937576661e-01   +2.967974570800113e-01   +6.978158826159655e-01   +4.281511589370255e-01   +2.206499796906414e-01   +6.908293506951182e-01   +5.611840520732410e-01   +8.281826938267930e-02   +4.292887815577416e-01   +1.624510442593935e-01   -9.029368127501777e-02   +5.062871762281561e-01   +7.382659066711919e-02   +6.200043664091625e-01; +1.126623951303119e-01   +1.000000000000000e+00   +1.886139752492056e-01   +3.594824631417777e-01   +7.277622997046015e-01   +4.194059769954418e-01   +8.139681381476326e-01   -7.030810918232053e-02   +7.021391596896579e-01   -2.838714138619735e-03   -8.244374608291111e-02   +9.798605496053277e-02   +6.847280255171577e-01   +7.307774885351870e-01   +7.289496392367958e-01   +2.966648302439339e-01; +2.218743420365987e-01   +7.569815848787348e-02   +5.591276544595472e-01   +5.176899634781231e-01   +3.627392509915385e-01   +3.182627218644716e-01   +5.729387812855227e-01   +3.340196340472147e-01   +2.682083337173058e-01   +5.544851328630948e-01   -2.381202611324764e-01   +3.154802435712729e-01   +5.133442774445913e-01   +7.628396186932838e-01   +5.247500241884762e-01   +1.579309620101259e-01; +5.971293172531723e-01   +5.965616127922326e-01   -1.123313375286078e-01   +3.573394070205085e-01   -8.760071438342105e-02   +2.636749620018207e-01   +2.590633491626009e-02   +1.594866829748554e-01   -1.618073394792490e-01   +2.680515510996969e-01   +1.306267695038474e-01   +6.751756608213291e-01   +6.575901617518618e-01   +5.924279370095290e-01   +1.405614478450861e-01   +7.098678080650320e-01; -1.114498344898589e-01   +2.039683090885840e-01   +1.476773156128118e-01   +9.658746351968393e-03   -1.591597806127468e-02   +8.551232284714244e-01   +8.332990643751955e-01   +4.298822000069631e-01   +7.563686429254610e-01   +4.368779474605690e-01   +7.068385085316938e-01   +4.491040477345746e-01   +3.096270825198998e-01   +1.743742353024360e-01   +4.956333277991622e-01   +5.223734567145750e-01; +8.155105144653954e-01   +3.131048365071050e-01   +3.025666837808929e-01   +2.791906326479250e-01   +1.624426041822864e-01   +6.960383557287260e-01   +2.921389146540241e-01   +6.340531608903750e-02   +6.999936432294657e-01   +2.514623645918811e-01   +5.729215558629748e-01   +4.855037735795296e-01   -1.381896270227477e-01   +4.023600727931226e-01   +3.277329699941224e-01   +4.405211557714986e-01; +3.268940996215590e-01   -4.558463266755708e-02   +2.492305697641182e-01   +5.018444986108523e-01   +6.895648643072789e-01   +7.884422393866671e-01   +3.942912301765227e-01   +3.827220501146881e-01   +3.464954557034219e-01   +8.451210862274658e-01   +3.093144352830980e-01   +7.297819806235676e-01   +6.526109008778934e-01   +7.698728841655251e-01   +4.769877116097630e-01   +5.731902997190453e-01; +3.722458548287121e-01   -2.540548416460831e-01   +1.302659755303184e-01   +6.991068581468096e-01   +4.992852804347478e-01   +6.903026443611729e-01   +8.403857912764742e-01   -1.464957759277597e-01   +3.754125159672804e-01   -5.915300363798782e-02   +1.098145380360048e-01   +1.303365389247153e-01   +7.114726768916618e-02   +3.481591469239804e-01   +3.126167298074081e-01   +6.344337294664566e-01; +7.648447821327121e-01   +1.775701217603672e-01   +3.044097655435894e-01   +5.893955693055083e-01   +4.020328422510946e-01   +1.639340828446148e-01   +1.070983957883511e-02   +3.104871649786207e-01   +8.764307906330668e-01   +1.521869068185226e-01   +3.237430123469312e-01   +2.048200529625875e-01   +2.878708544986944e-01   +8.122842862188521e-01   -1.284928734003160e-01   +3.181715346016827e-01; +9.495427815792304e-01   +4.047935622604938e-01   +7.537803959664162e-01   +3.350372393361519e-01   -2.885238712666314e-02   -8.760563896479336e-03   +4.236419587981508e-01   +1.187437224588545e-01   +8.357325004430501e-02   +3.171475545609701e-01   +4.128956616130250e-01   +2.759262766581399e-01   +4.912081888786653e-01   +2.450714550178666e-01   +7.305433393369813e-01   +4.154620534534038e-01; +4.536926060233087e-01   +6.020390185487574e-01   +5.918350522176294e-01   +1.937746085299787e-01   +8.221808138346574e-02   +1.993955532941438e-01   +7.986590883032041e-01   +4.987433478775697e-01   -1.462311027146631e-01   +4.046115478665896e-01   +6.660185169762540e-01   +4.600436577179340e-01   +1.391776416260037e-01   +7.348579956467001e-01   +4.975330936059353e-01   +5.457530923893186e-01];
L2I_L1I_iGABA_netcon = [+5.296648773628573e-01   +2.971526155470568e-02   +5.226294334764293e-01   +2.899080738386436e-01   +1.162966334663803e-01   +7.056904567046238e-01   +4.255216515336958e-01   +1.632053925484557e-01; +2.942830111204097e-01   +3.323584196283496e-01   +2.717166772666531e-01   +2.637027363630332e-01   -9.954261583496424e-03   +2.860040742842204e-01   +3.856535990977285e-01   +4.986831727934585e-03; +8.713156408521234e-01   +4.002123835641740e-01   +6.658136433348765e-01   -2.850520303442832e-02   +4.053221238212297e-01   +7.062359891854129e-01   +3.546082470015456e-01   +3.872312602028342e-01; +4.104717771294007e-01   +2.402541281211879e-01   +1.637044936618962e-01   +8.914299685145344e-01   +2.039370651052674e-01   +7.507821117901796e-01   +7.150188364616120e-01   +3.731585533710012e-01; +6.999757832566073e-01   +7.781588040818201e-01   -1.935080064119366e-02   +5.053730260379392e-01   +4.949662264796300e-01   +1.437138787949666e-02   +2.189294116716731e-01   +2.381976939529455e-01; -2.297348216032103e-01   -4.853979678815041e-02   +8.531517388609648e-02   +6.165136650937020e-01   +4.152185096437186e-01   +9.536682041288431e-02   +3.728416937804452e-01   +6.999881426138587e-01; +1.721592973902007e-01   +6.903639432989929e-01   +1.884203566524147e-01   +6.080345869266897e-01   +8.415255607428680e-02   +7.302537315523407e-01   +8.763523521554478e-01   +3.448672516014802e-01; +2.335397829678851e-01   +2.337916990754774e-01   +8.525120433686184e-02   -8.491897068498726e-02   +8.059444351470737e-01   +5.491231373654597e-01   +3.212265389757258e-01   +2.022179706340279e-01; +5.595681143346530e-01   +2.553559078501696e-01   +1.257602784448284e-01   +2.446354645974748e-02   +7.159703772780592e-02   +6.720641849053210e-01   +3.307700625525409e-01   +3.050604812795275e-01; -4.609271443961489e-02   +2.449699402469826e-01   +2.645821876631820e-01   +3.834970535592677e-01   +1.930858983183114e-01   +4.551086898891160e-01   +3.153140990257780e-01   +2.663958829277932e-01; +7.147048461338633e-01   +1.328728451633137e-01   +3.741989355882492e-01   -1.166143641069847e-01   +4.431762327345799e-02   +6.599140587525137e-01   +1.232775589765623e-01   +2.047922203323550e-01; +1.349809003849443e-01   +5.853809587939147e-02   +4.688780796441420e-01   +4.996924214574228e-01   +4.574239914947236e-01   +5.395156916720529e-01   +3.064831474084406e-01   +2.703186064658427e-01; +5.938690712588186e-01   +1.637275801237461e-01   +1.327287304367987e-01   +8.317047789986897e-01   +5.138075764892944e-01   +8.056855543344046e-01   +6.817649800330593e-01   +7.479985836038004e-01; +1.039187487952029e-02   +1.000000000000000e+00   +8.624004936773509e-02   +3.662312214225281e-02   +3.784036142119911e-01   +1.616704354448490e-01   +3.039092310675396e-01   +2.417222120338604e-01; +4.166090255334039e-01   +7.497304742172064e-01   +1.690255036717375e-01   +2.643148576028823e-01   +4.215298646644745e-02   +5.115257273239577e-01   +5.959863565425613e-01   +6.061533643284475e-01; +3.157561231574103e-01   +4.938761449438426e-01   +1.936913562646553e-01   +5.211624130249347e-01   +2.745453743116505e-01   +5.030019974943852e-02   +8.663511432824013e-01   +5.309715943442593e-01];
L1I_L2I_iGABA_netcon = [+1.582056463474360e-01   +3.504113879203916e-01   +6.788346901927846e-01   +5.848344840157461e-01   +2.264455473965288e-01   +5.064380111906012e-01   +2.880856074547904e-01   -2.736057635586119e-01   +5.241413406336107e-02   +3.394284345862904e-01   +3.383301072271769e-01   +3.527591487101774e-01   +3.401547485296575e-01   +8.546713411988836e-02   +3.228883578750195e-01   +5.713651710541573e-01; +7.189933169074788e-01   +3.243572292659251e-01   +5.054221295052491e-01   +5.176992565439622e-01   -2.507180669611674e-02   +3.393813524816228e-02   +2.127524434162564e-01   +7.847293476619793e-01   +4.445345772913422e-01   +4.908736800721790e-01   +4.815067345670452e-01   +6.710196370645332e-01   +2.825155822505314e-01   +4.017460527111683e-01   +1.650136390640871e-01   +1.595336346532026e-01; +7.482345559210328e-01   +8.004647603977481e-01   +6.821059274780173e-01   +5.328497469410534e-01   +6.764507058617039e-01   +2.810265543006821e-01   +5.089085609245216e-01   +4.326766536879701e-01   +2.868386967446709e-01   +8.375374053193276e-01   -1.228683832880298e-01   -1.921066882123998e-01   +5.316818840328578e-01   -1.374985596793948e-02   +7.048610727267456e-01   +4.393249082704907e-01; +1.827661250260649e-01   +6.757279271064998e-01   +4.297698967263022e-01   +6.257406702026813e-01   +1.383288995959872e-01   +6.509656784995292e-01   +4.047047571093769e-01   +5.636179667935181e-01   +3.068777609279057e-01   +7.437841545156942e-01   +4.802680419511011e-01   +5.375315671103019e-01   +8.084017936838587e-01   +7.604112016539278e-01   +6.087425895415770e-01   -1.118002654153031e-02; -1.054249035533643e-01   +3.121702074404270e-01   +5.335327578921100e-01   +4.656356452753604e-01   +2.656555808074149e-01   +2.935134456042372e-01   +4.871442424338926e-01   -9.746656354266475e-02   +3.649736284659556e-01   -1.207857829085453e-01   +7.468581508491809e-01   +3.471698716263095e-01   +4.574493865155552e-01   +8.218983771290620e-01   +4.587669943977729e-01   +6.231671736391604e-01; -3.373230370455165e-02   +3.911614638641301e-01   +8.336693252231806e-01   -1.530419482883241e-01   +9.644152771479048e-01   +3.912552627461699e-01   +6.457625269974823e-01   +3.380346486800709e-01   +4.770954503640378e-01   +2.498277723117729e-01   +7.912918957854624e-02   +5.177769558341044e-01   +9.452506099379906e-01   +2.919765505965973e-01   -2.650451366562788e-02   +6.124454785692439e-01; -2.352789886649007e-01   +6.196922501497232e-01   +1.131971219064271e-01   +4.111825034149872e-01   +4.006990974994533e-01   +8.709047611407325e-01   +3.753568380816312e-01   +2.774635398982073e-01   +6.161470623155985e-02   +3.739779159097882e-01   +5.741643623499291e-01   -5.154759606254983e-02   +3.999936973928090e-01   -1.305599649626898e-01   +3.580808934617295e-02   +3.743113757909670e-01; +5.869277423768119e-02   +7.632857732310122e-01   +1.334685881522786e-01   +1.000000000000000e+00   +5.709317942714667e-01   +4.006087094425359e-01   +4.149598920409360e-01   +5.625418406822379e-01   +3.533137079154921e-01   +5.680505051386971e-01   +6.766869249335048e-01   +6.378763554762035e-01   -2.033542540764495e-01   -1.209788826561194e-01   +9.692512534149645e-01   +2.053598781789185e-01];
L2E_L1E_iAMPA_netcon = [+7.435549124191604e-01   +2.093939511854676e-01   +8.354001709386069e-01   -1.241042611290537e-02   +1.814993700972942e-01   +3.864283049257417e-01   +1.175261006733711e-01   +1.006918273730283e-01; +4.042414743437959e-01   +5.380565857585743e-01   -1.085734128106781e-02   +1.187637105391072e-01   +2.186622848011971e-01   -5.706700985793052e-02   +4.019011994832909e-01   +6.603868101804908e-01; +6.926865688099174e-02   +6.405482410195569e-01   +5.921483225618877e-01   +3.727386602585518e-01   -1.069170784264630e-01   +5.339837579789375e-01   +9.904724692540778e-01   +2.934539555206778e-01; +1.000000000000000e+00   +4.477868883337585e-02   -4.343323293299070e-02   -4.429411960631762e-02   +3.701970191877236e-02   +7.584072514241340e-01   +2.126273381846707e-01   +3.415713722540009e-01; +5.413256368591207e-01   +4.208221673843576e-01   -1.813816513756596e-01   +6.140406271220700e-02   +2.951230700601853e-01   -2.185203752633215e-01   -1.509638749102594e-01   +5.583542926110144e-01; -1.076718875328010e-01   +1.724892026890712e-01   +3.502024487327821e-01   +1.891415513193230e-01   +3.289982722361269e-01   +6.289853683221958e-01   +6.744524353506044e-02   -3.777357911842405e-02; +5.427184246185208e-01   +5.011193028579238e-01   +5.209631254442518e-01   +4.315211876060822e-01   +4.727103146011420e-01   +8.675275284346447e-02   +6.251382795781896e-01   +1.685251806157178e-02; +6.551845858101464e-02   +4.375743609529287e-01   +8.277914076124596e-01   +3.779435183037275e-01   +5.026779777275894e-01   +6.842975139178905e-01   +5.992498061126289e-02   +3.700369224294606e-01; +4.669933206422152e-01   +3.462366679488498e-01   +1.748175800267406e-02   +2.698518713192675e-01   +1.862064975035028e-01   +7.808827702723942e-01   +2.989839513991872e-01   +5.442416275442876e-01; +4.186964009438729e-01   +3.889862786898294e-01   +3.453198948220955e-01   +5.667337166775301e-01   +4.580879425587949e-01   +4.441082896642735e-01   +6.895070655707225e-01   +5.042512102320726e-01; +3.878727257281678e-01   +3.193163476557020e-01   +7.522866916343914e-02   +2.289931088932101e-01   +3.159235894161802e-01   +4.176841674191810e-01   +1.942112947719829e-01   +5.380626891321308e-01; +4.785997696703666e-01   -5.799498858761544e-02   +5.487159467952866e-01   +2.420619960998168e-01   +2.140553057908755e-01   +2.784977872432955e-01   +2.955622591113851e-01   +4.103593174068049e-01; -8.818329332804317e-02   +1.500399000585064e-01   +4.402146633310273e-01   +7.598702254421820e-01   +5.567191597238506e-01   +3.952679565676673e-01   +5.352271697397383e-01   +4.416643874257840e-01; +5.052707074802801e-01   +5.770750672757563e-01   -1.654743524320754e-01   +6.386038758798754e-01   -3.781720289404279e-02   +2.063419490621267e-01   +3.884402773832963e-01   +4.934056158927282e-01; +3.351592694750552e-01   +4.444320662154382e-02   +4.638360699381194e-01   +2.535939632380040e-01   +2.386070412520191e-01   +2.595097633773658e-01   +9.068535211467956e-01   +5.873044653689631e-01; +2.972090613511809e-01   +3.025886040445355e-01   +1.583806523511572e-01   +4.203067881962634e-01   +3.686744452266101e-01   +2.285871191590486e-01   +3.289137147743993e-01   +7.082176643219439e-01];
L1E_L2E_iAMPA_netcon = [+7.807929772894804e-01   +7.118694055313161e-01   +7.689502623112249e-01   +2.914214764553695e-01   +1.590816154628951e-01   +3.040330850738098e-01   +4.990370798802001e-01   +5.034498895937808e-01   -1.567943239261249e-01   +3.976044995666148e-01   +3.089049512948081e-01   +1.463235205242580e-01   +4.669876557937782e-01   +4.012679187514554e-01   -2.425353024393676e-02   +1.796259268989673e-02; +2.937819370281760e-01   +3.986097838765159e-01   +6.556443082563048e-01   +5.758170150668291e-01   +1.452006075511103e-01   +4.064949151991578e-01   +6.480830091061411e-01   -1.345455297420378e-01   +1.983352208142596e-01   +8.825888077706490e-01   +7.310464437642460e-02   +9.767981882500627e-01   +6.783732410983351e-01   +2.046983906356917e-01   +4.309465990866034e-01   -1.905517516952797e-02; -4.978841580950296e-02   +2.291463741786963e-01   +4.134417187096321e-01   +3.821763711040346e-01   +6.128426083569670e-01   +9.332894875988565e-01   -3.042335151576765e-02   +3.298374849148817e-01   -1.017967577055241e-01   +2.734667993970913e-01   -8.282194318414246e-02   +3.462158495624520e-01   +9.307363421744765e-01   +3.501465376160682e-01   +6.516369191175662e-01   +2.595449832138727e-02; +4.764576241987680e-01   +1.725387742036260e-01   +4.882241601484892e-01   -4.308284440573983e-02   +5.677823427844848e-02   +1.000000000000000e+00   +7.038440776666373e-02   +7.325467816556138e-01   +3.513125875623573e-01   +5.855606098194513e-01   +3.670338748858392e-01   +3.657695120253527e-01   +2.019850857615054e-01   +6.975307811686644e-01   +4.327017135108456e-01   +5.919752516133522e-01; +4.632400201191579e-01   +7.526804331931779e-01   +6.545741351372373e-01   +4.726503376916361e-01   +5.492304355356240e-01   +6.235779311660162e-01   +3.199998065126367e-01   +4.709612750107580e-01   +1.382585986348658e-01   -9.529405595893249e-02   +6.059492240268173e-01   +2.376022890030146e-01   +5.894425026311891e-02   +4.216999632965375e-01   +5.968320782807165e-01   +6.631589464863586e-01; +6.406944121018019e-01   +2.535038728293533e-01   +3.312477183982764e-01   +6.704508728349469e-01   +6.956234952337302e-01   +2.706309452471361e-01   +4.912639475229837e-01   +4.627370829779390e-01   +5.742647946716627e-01   +8.646880590829440e-01   +5.124063770637421e-01   +6.207963253069530e-02   +2.976631246705800e-01   +1.851933855618335e-01   +1.694875749732695e-01   +4.615129577266431e-01; +4.165528416422999e-01   +2.613370038177957e-01   +6.431947390705767e-01   +3.911610690001073e-01   -1.555007604661905e-01   +5.907815255571320e-01   +1.554713826287167e-01   +6.476761233271964e-01   +1.320844397760069e-01   +2.172174472437975e-01   -1.373657954596504e-01   -5.096898134690282e-02   +5.318981233895007e-01   +5.736574297278636e-01   +4.143624539693715e-01   +4.456879643609398e-01; +5.611960050877643e-01   -1.842673837402508e-01   +6.799130253734611e-01   +3.172837792322943e-01   +2.572112590725890e-01   +4.650228100359115e-01   +5.204182024038999e-01   +9.769783221239149e-01   +2.013573577707318e-01   +7.375913922013659e-02   +5.503869927419797e-01   +3.522741637739342e-01   +1.001334856423894e-01   +6.264923977349624e-03   -1.798197309351062e-01   +1.325243987451833e-01];
L2I_L2E_iAMPA_netcon = [+1.942392795769200e-01   +2.694387094372027e-01   +8.060045007336344e-01   +5.972229533179522e-01   +9.392998060287234e-01   +6.263430031666373e-01   -3.347220939988717e-01   +9.012652393119731e-01; +7.767907770135343e-01   +7.868235251640303e-01   +3.264069659647688e-01   +1.274581880509227e-01   +3.975124561972720e-01   +3.019174893030565e-01   -5.884442786131143e-02   +6.369147823233677e-01; +4.729748453248985e-01   +1.061703257154527e-01   +4.035099320291894e-01   -1.916529269710026e-02   -2.257442838688392e-01   +6.043557273102185e-01   +8.455601558831687e-01   +2.700763242719267e-01; +3.407548116578493e-01   -7.480902141126694e-02   +5.692885941368288e-01   +7.836461372081420e-01   +7.400560161329105e-01   +2.390450073518774e-01   +1.159877497938235e-01   +7.745359031051496e-02; +3.963520142951236e-01   +6.905342118289519e-01   +2.528189111303026e-01   +3.790949999961759e-01   +8.224003639798605e-02   +8.325440879591215e-01   +4.689125103425069e-01   +9.052177851228835e-01; +3.830465024020949e-01   +3.163343656458446e-01   +7.822172445125301e-01   +5.991999929994386e-01   +3.115531121856747e-01   +4.298561740228807e-01   +7.741968968344173e-01   +5.458168679147888e-01; -6.245350628308793e-02   +8.474280040269616e-02   +3.372831590815353e-01   +2.421978105947727e-01   +8.083078941463699e-01   +3.020866789486480e-01   +2.121873612102351e-01   +5.235072497396683e-01; +2.880793529453549e-01   +5.873758642560671e-01   +1.650078140932119e-01   +4.205797665309580e-01   +8.573833741352545e-01   +3.657337476113260e-01   +2.461877519186028e-01   -1.989381550746638e-01];
L2E_L2I_iGABA_netcon = [+5.110156669859162e-01   +5.247481763601489e-01   +6.866492012972091e-01   +4.750366014581488e-01   +1.478302404200115e-01   +5.155293862751698e-01   +1.519749623243073e-01   +3.166576688269557e-01; +4.276846707471869e-01   +3.252911515600883e-01   +4.186303834817790e-01   +4.425848787369036e-02   +6.235092947764996e-01   -1.607809316954643e-01   +2.002422329606575e-01   +6.326783440194805e-01; +2.143323153474978e-01   +3.013240526807621e-01   +2.010956870196697e-02   +6.141577991629389e-01   +5.439942224463866e-01   +1.000000000000000e+00   +2.894031886229474e-01   +2.940418483848926e-01; +3.635345483704542e-01   +1.917265925400972e-02   +4.245960907997192e-01   +5.144803145970106e-01   +4.245181993977667e-01   +4.203898539190339e-01   +4.812420133712687e-01   +8.923578626234443e-01; +5.575128128790326e-01   -2.458674301645193e-01   +4.871371100517791e-01   +6.723071526768737e-01   +3.792209835450635e-01   +1.766646678865128e-01   +2.202712270546687e-01   +5.763774082168592e-01; +6.728764237343341e-01   -1.637114269241547e-02   +3.400919917471789e-01   +5.392730643793887e-01   +1.966488478466530e-01   +6.040742075471610e-01   +1.987531575125023e-01   +6.949246035983186e-01; +5.279318050271561e-01   +1.455196715890297e-01   +1.701290498805439e-01   +4.993546507735627e-01   +5.377701793881492e-01   +7.301970818586606e-01   -1.967368106356483e-01   +1.216215918272155e-01; +7.812173853404262e-01   +5.060575657974679e-01   +5.613200261741720e-01   +6.765279443989112e-01   +3.295308653297604e-01   +5.336398110599305e-01   +2.007504838748791e-01   +4.621669764783391e-01];
L3E_L2E_iAMPA_netcon = [-1.035400412613657e-01   +1.434077595886576e-01   +2.962715554032262e-01   +1.905684825165865e-01   +3.516218371066658e-01   +6.144493799151715e-01   +2.995928620788619e-01   +9.022960228790569e-01   +7.033580400550905e-01   +9.056653620919536e-02   +2.543770253848317e-01   +7.226585299058492e-01; +6.107058661255690e-01   -5.517485113247025e-02   +4.237050076429636e-01   +7.156061616797931e-01   +6.294918077104729e-02   +1.229340795426903e-01   -1.276030929819848e-01   +6.976308012478448e-02   +1.890243291818924e-01   +3.404794940640527e-01   -2.025230636555614e-02   +4.119983850996736e-02; +2.446284093955462e-01   +1.792752673486823e-01   +4.554307858519518e-01   -1.098475487459424e-01   +3.722852909460507e-01   +1.399773720011195e-01   +7.785447379216921e-01   +6.429620115717513e-01   +5.754314814746286e-02   +8.324228070489928e-02   +7.349622636150552e-01   +8.285046978123092e-02; +5.359999620683077e-01   +2.260680591765559e-02   +6.655814388946738e-01   +3.373198658059594e-01   +4.402782802918290e-01   +4.435328488208770e-01   -6.564617389974575e-02   +5.616571185480422e-02   +5.743870828111143e-01   +3.328774858627352e-02   +6.269366878364806e-01   +8.231228112303940e-01; +5.412157667503051e-01   +6.328403228919269e-01   +3.427088640109630e-01   +1.701061487006580e-01   +4.251965827440113e-01   +1.068044742457927e-01   +4.434103025672210e-01   +6.388745633316584e-01   +2.798754770892939e-01   +6.078825751039543e-01   +2.737360998009770e-01   +2.625917927247974e-01; +2.043948002866079e-01   +2.044780064226031e-01   +5.109497326607186e-01   +5.616945541668961e-01   +9.420496868735356e-02   +1.000000000000000e+00   +7.304438768032339e-01   +5.591395761666700e-01   +3.232780481741164e-03   +4.681274692528340e-01   +3.352252953929544e-01   +4.004078906448804e-01; +9.965511000704168e-01   +4.470956482198041e-02   +1.605377843204199e-01   +6.312043669144762e-01   +5.494600414389131e-01   +4.853499440457494e-01   +7.150181390191904e-01   +9.840549509353037e-01   +3.581371950051156e-01   +2.354360355713998e-01   +1.648662732724463e-01   +3.251615910528182e-01; +1.343331128733222e-02   +2.116730805939419e-01   +6.650674764367215e-01   -1.024464420116186e-01   +5.023851817058923e-01   +3.908651890013140e-01   -6.907821412003393e-02   +2.074638632051415e-01   +8.734201881630625e-02   +4.457883835496436e-01   -9.141207758206135e-02   +7.239310735564051e-01];
L3I_L2I_iGABA_netcon = [+5.728895217830006e-01   +8.071372465905009e-01   +5.486704795997452e-01   +7.324494949598439e-01   +4.570047209876267e-03   -7.766784250760046e-02   +3.022846581083768e-01   +4.961406951837207e-01   +3.877675690228700e-01   -4.882073177403297e-02   -7.986491152499832e-02   +6.061142263383040e-01; +4.912255897065004e-01   +6.959742054779716e-01   +3.261544072802933e-01   +1.501707145674977e-01   +1.800773899836523e-01   +7.706353569856882e-02   +7.839277596195619e-02   +5.976851263769986e-01   +6.047417741937370e-01   +5.164961498634244e-01   +4.959548853972808e-01   +9.610819599918471e-01; +6.436000017557153e-01   -2.237295867932702e-01   +8.104788184594267e-01   +1.682696205084021e-01   +1.000000000000000e+00   +3.587425548493222e-01   +3.534121634822204e-02   +7.631874273597039e-01   +4.145546009740279e-01   -2.644103561674977e-01   +3.935934903210252e-01   +7.227918365239856e-01; +6.275055876732724e-01   +4.387818756565333e-01   +3.731426532156900e-01   +4.380615167676727e-01   -4.083411908404749e-02   +8.508589889662195e-01   +5.466312448197648e-01   +2.712863042064003e-01   +1.071060792459133e-01   +8.704127425349514e-01   +7.809301321335724e-01   +3.728869861840599e-01; +2.458781921016170e-01   +8.552777142558718e-01   +5.652872891099165e-02   -5.604194714432939e-02   +1.775107046730313e-01   -1.680147198820737e-01   +6.172645281539507e-01   +2.298749454163536e-01   +2.301266239075147e-01   +1.401834611075330e-02   +5.111664562113010e-01   +3.438369333927999e-01; +2.604573344596141e-01   +2.390230704045492e-01   +3.867070306860745e-01   +3.184899407111795e-01   +8.845235509906239e-01   +4.059470818846559e-01   +2.420173268551579e-01   +2.264688414601110e-01   +1.551396630069697e-01   +7.343870611512548e-02   +1.053220413633886e-01   +3.148871916238475e-01; +4.958837128221744e-01   +4.172651106069448e-01   +6.158633775049893e-01   +2.848445390538843e-03   +6.971270078068647e-01   +7.364381772207163e-01   +7.740429338636914e-01   +1.373407450484022e-01   +5.390350445522682e-01   +6.261024545009162e-01   +1.358103156869301e-01   +3.159274277590272e-01; +3.435976322160222e-01   +3.710005654028141e-01   +1.718682639701983e-01   +1.613309174092394e-01   +2.903507873949828e-01   +5.221025329629689e-01   +2.504679937014002e-01   +3.869448084110028e-01   +1.796992250929180e-01   +1.426385609297089e-01   +3.184732784510360e-01   +6.682609608559102e-01];
L2E_L3E_iAMPA_netcon = [+4.545667414259013e-01   +2.400144659361858e-01   +7.867625634185540e-01   +3.357052546868773e-01   +3.408064148767797e-01   +3.862186290578734e-01   -1.336795800779991e-01   +4.566905328551321e-02; -4.492778854697792e-02   +7.510801188850144e-01   +6.623654517258812e-01   -7.954736115544743e-03   -2.319700401653724e-02   +5.558549295492916e-02   +3.329961588722369e-01   +1.442037632784302e-01; +3.298676282494279e-01   -4.873891396999134e-02   +3.905118296300259e-01   +8.444182422510367e-01   +3.434947615598125e-01   +8.685310701929669e-02   +2.259231987073801e-01   +1.630053441429599e-01; +4.970814486171115e-01   +4.148798967962691e-01   +4.437821969422641e-01   +4.837827209561816e-01   +2.597064555690432e-01   +9.298292960940151e-01   +6.073166925660730e-01   +1.137976369372115e-01; +7.501255031572761e-01   +4.090769931491048e-01   +8.078629315499445e-01   -3.774276046216891e-02   +4.186270878672113e-01   +1.000000000000000e+00   +3.591840080374678e-01   -2.184159097167868e-01; +4.806924531077616e-01   +6.759096800697206e-01   +9.494489395600607e-01   +5.390018141297886e-01   +6.896010241800197e-01   +3.093009846325748e-01   +1.211947914569322e-02   +7.582228474662319e-01; +2.947301643540071e-01   +2.163278627271158e-01   +3.446325512246620e-01   +7.300504472934259e-01   +6.203855868763818e-01   +3.873706713274200e-01   +4.721819319004044e-01   -1.254098792792610e-01; +2.708417250087116e-01   +6.092398243707530e-01   -2.101662919450384e-02   +8.786900796645091e-01   +5.346797971700876e-01   +7.060996170934222e-02   +3.418109300520580e-01   +7.831883386811560e-01; +3.766208030010321e-01   +3.115398519643447e-01   +4.449997026651846e-01   +9.605262358401253e-01   +1.005438939709844e-01   +4.679218588722762e-01   +7.754257057789331e-01   +5.153462048227153e-01; +4.236819786123259e-01   +7.410180731731110e-01   +2.000192741929820e-01   +3.794441368971583e-01   +3.102370948703649e-01   +7.473821187154394e-01   +5.212238731272580e-01   +3.482305795806068e-01; -1.896373009695308e-01   +5.899959467048836e-01   +3.854157072244485e-01   +9.127550095762652e-01   +2.286567577549261e-01   +5.860632292282132e-01   +6.743241238664958e-01   +2.227237226961936e-01; +3.696967637274365e-01   -1.526794114664089e-01   -2.774227655606182e-02   +6.162597663251508e-01   +3.521360942610626e-01   +6.747542602280786e-01   +4.523051299327536e-01   +2.497777325061123e-01];
L2I_L3I_iGABA_netcon = [+4.439843230184815e-01   +6.792678542209041e-01   +3.941662544391100e-04   +7.664856411477368e-01   +4.687000626218548e-01   +7.240278611534730e-01   +2.420669224693597e-01   +1.852191156664873e-01; +2.153374153641375e-01   +3.629550244056546e-01   -1.330707098863849e-01   -2.656224736655380e-01   +7.949162407890407e-01   +8.178653097510334e-01   +5.836870861326806e-01   -2.320896500114805e-01; +7.189730521385671e-01   -2.177496467321068e-01   +2.390003367232376e-01   +4.771560552680723e-01   +4.713823811017236e-02   +2.201932310509680e-01   +7.141836821923917e-01   +4.158724717165871e-01; +4.912350131093664e-01   +3.283720953680824e-01   +4.464252537312918e-01   +2.698074503525922e-01   +8.223639206601865e-01   +8.829314435673838e-01   +2.454041244776566e-01   +1.485040691640475e-01; +1.928590734367540e-01   +4.055720454354357e-01   -1.237585525188551e-01   +4.364912765066795e-01   +7.800922218435211e-02   +8.370597791598511e-02   +6.214273369095461e-01   -2.191230104085299e-01; +7.366533045888974e-01   +2.087695632117293e-01   +1.395448539762452e-01   -1.761114764474619e-01   +6.444369052155388e-02   +5.122462621847498e-01   +3.676813821669553e-01   +1.613569848314810e-01; +1.344475487271807e-01   +1.846565836884926e-01   +1.985336412009654e-01   +1.824977608856350e-01   -1.930319989580600e-01   +3.592768680010496e-01   +5.701944584485165e-01   -3.955255488352166e-02; +9.165165575362881e-01   +2.163383985159625e-01   +5.092541700256907e-01   +3.114992325219675e-01   +2.929916508646242e-01   +3.775452560525215e-01   +3.188462580605296e-01   +4.669549621397258e-01; +3.839529748962420e-01   +7.372667639880264e-01   -1.557499054211597e-01   +6.926902315570307e-02   +4.909872394500428e-01   +2.328542380113884e-01   +6.188036640844935e-01   +1.802535148385636e-01; +5.066702354579852e-01   +3.971872223736186e-01   +1.584255647057555e-01   +4.326121884998601e-01   +4.956168853188181e-01   +1.874565038981169e-01   +1.626711493369026e-02   +8.622291509633101e-01; +2.193336419704849e-01   +8.843710437607882e-01   +4.233938863747458e-01   +1.979322475172586e-01   -2.057003287418217e-01   -1.896528644108934e-01   +4.936021698555339e-01   +2.388518702382204e-01; +1.306342892650234e-01   +1.506951567283159e-01   +5.591240307401311e-01   +3.817553634438722e-01   -7.862276017286376e-02   +1.287389041671388e-01   +5.139181584490543e-01   -2.311391798352466e-01];
L3I_L3E_iAMPA_netcon = [+3.920289717217895e-01   -2.733982628940564e-01   -1.318633487992489e-01   +6.535681927869950e-01   -9.186178522021092e-02   +4.923495954544879e-01   +4.182748037883478e-01   +5.128804841176160e-01   -7.297373467320863e-02   +1.093194417154472e-01   +1.172466359691667e-02   +3.392388391325506e-01; +1.114811210135153e-01   +8.632649122672932e-02   +2.630962104151425e-01   +1.181142501743908e-01   +6.339076376347432e-01   +1.843578695758458e-01   +7.135336528335982e-01   +4.234871611521654e-01   +8.462988559359775e-01   +4.114581225194712e-01   -1.387130801600772e-01   +6.980371396751079e-01; +8.280344539548945e-01   -8.812626899185756e-02   +5.271830620324727e-02   -1.379852605794259e-01   +3.014314091058605e-01   +3.689580911685080e-01   +4.545456639511790e-01   +7.444831117514200e-01   +3.671517520313349e-01   +4.066963396111690e-01   +7.946474709534895e-01   +3.998045480522745e-01; +2.372029961094679e-01   +7.038739715796597e-01   +7.804244682078266e-01   +2.659717703120943e-01   +8.333230180415756e-02   +1.497226930147816e-01   -8.543647093452671e-03   +5.115742523430205e-01   +1.846711200758696e-01   +3.935190617138515e-01   +3.433996328843757e-01   +3.013996493399557e-01; +9.522398303047297e-01   +4.269748274648187e-01   +6.500656464954353e-01   +8.130166781838549e-02   +7.235529465610875e-01   +3.309533799993987e-02   +6.481943337175925e-01   +3.060395627792839e-01   +8.058068707668871e-01   -1.879463263997881e-01   +4.694757656333848e-01   -2.413761560681224e-01; +5.302260337069304e-01   +3.621980653646667e-01   +5.910889529986323e-01   -2.285864754326485e-02   +5.310680556122926e-01   +2.180280372211271e-01   +5.718779289924307e-01   +1.827983615919505e-01   +9.593331700071728e-01   +4.605845632434939e-01   +1.387447016754894e-01   +2.221257080776278e-01; +4.241669236271461e-01   +3.501012047508669e-01   +7.100589387970735e-01   +3.400724471311153e-02   +1.045656378037441e-01   +1.069712062051452e-01   +7.108505405320151e-01   +1.489189285647223e-01   +6.615831972236230e-01   +7.936936900698098e-01   +4.752270369751659e-01   +6.614439605978611e-01; +1.161662343102454e-01   +5.694548232749280e-01   +3.718613175667985e-01   +3.224534448130923e-01   +4.476900486325210e-01   +1.601616314672273e-01   +7.819202604613379e-01   +9.058278058226551e-01   +6.265007712042296e-01   +6.265603611041101e-01   +3.165644937454756e-01   +8.851729660659098e-01; +4.478754491660933e-01   +1.386937034698761e-01   +3.754153269120259e-01   +7.546385583950203e-01   +4.003239921804154e-01   +4.293740136697795e-01   +4.710469494221485e-01   +9.733413836779612e-01   +6.902928435604473e-01   +2.022883954669538e-01   +1.799340108151418e-01   +1.973047472471762e-01; +6.926343708224542e-01   -1.050490821283380e-01   -7.603206276816743e-02   +6.177466521385882e-03   +3.836863177484819e-01   +6.019903363017205e-01   +9.804819308945127e-01   +2.858304192183451e-01   +2.514967800222569e-01   +4.342167888164290e-01   +3.803191649654041e-01   +3.634142578720865e-01; +1.516193816370142e-01   +6.505486581841597e-01   -7.554820719247166e-02   +3.536027204084843e-01   -3.586239321650649e-02   +5.953626446327487e-01   +3.133934563952813e-01   -1.313736481766918e-01   +3.936087376121601e-01   +2.584024982644424e-01   +3.008780330732411e-01   +3.136618426534585e-01; +1.085434283947192e-01   +3.525184192157135e-01   +6.137745162616457e-01   +1.816144289087226e-02   +7.606976602942666e-01   +3.343583268085735e-01   +1.000000000000000e+00   +4.805077642124989e-01   +4.778736589591741e-01   -2.130116197718503e-02   +4.795282521203594e-01   +3.410600965817878e-01];
L3E_L3I_iGABA_netcon = [+5.082857970432709e-01   +7.975254504046625e-01   +5.986956595070908e-01   +4.568660656885255e-01   -1.195089183256605e-01   +9.045096324049474e-01   +2.501070638740714e-01   +9.871989458983909e-01   +1.865787063079095e-01   +2.094835421345562e-01   +2.860154304431278e-01   +7.186938422435976e-01; +3.212713245875817e-01   +5.444539429572082e-01   +5.834864277130710e-01   +3.899659995550834e-01   +1.160758507766398e-01   +2.729380050732131e-01   -1.389791428548244e-01   +1.946075723850587e-01   +6.182712067265398e-01   +6.477362492241333e-01   +5.164506466890889e-01   +7.179978013676527e-01; +4.739084296921445e-01   +2.724560679194165e-01   +1.923649378191217e-01   +3.350469918130251e-01   +8.103034005054831e-01   +6.522799900247834e-01   -1.020592141548275e-01   +3.859873143415025e-01   -1.591903968299306e-01   +4.244354786771254e-01   +3.366621294300739e-01   +3.904994676202949e-01; -2.483342334091416e-01   +4.792095172041062e-01   +3.030797764325753e-01   +2.581443413376125e-01   +1.860060895990472e-01   +4.675105400093178e-01   +5.369015542510637e-01   +3.463200699947067e-01   +3.243726493790129e-01   -3.147613474797684e-01   +4.613036925287494e-01   +3.556528742705138e-01; +1.981472527261196e-01   +2.073032725382437e-01   +9.628568945256859e-03   -1.290192294862667e-02   +5.786206768706168e-02   +4.604676925778182e-02   +1.888829821983827e-01   +6.507427209154175e-01   +4.314568367572715e-01   +4.310810719971713e-01   -5.025683165614344e-02   +4.373750548692665e-01; +5.130837441353310e-02   +5.248752728233695e-01   +8.818132888660153e-01   +3.928511738573700e-01   +6.419316522256602e-01   +5.670557665573007e-01   +1.152922743021872e-01   +3.935227154399223e-02   +1.417874462086361e-01   +2.439521366480209e-01   +3.843628153445102e-02   +5.793109920031004e-01; +1.169442778150920e-01   +1.255315297588979e-01   +4.194796835830593e-01   +5.466665805185688e-01   +6.070866374573771e-01   +1.483502765083827e-01   +1.074285921037891e-01   +1.658151897584324e-01   +4.610630268085797e-01   +4.302396049050502e-01   +7.845440671628967e-01   +4.962911520415630e-01; +1.587209373532218e-01   +2.245317181890998e-01   +8.037401086877948e-01   +5.801700423254500e-01   +2.744798453041023e-01   -7.457009955163381e-02   -5.290753514335719e-03   +6.883671540866456e-01   +2.053732223732485e-01   +1.535098327443299e-01   +7.643330539895857e-01   +9.019362497116864e-01; +1.743195739115936e-01   +3.412038689979395e-01   +2.941002170181041e-01   +4.937569869777352e-01   +1.987317913505965e-01   +8.457553298420997e-02   +1.542027190933211e-02   +4.750931060379653e-02   +1.284821088011057e-01   +2.528183628576864e-01   +4.270741685362019e-01   +7.478562028624770e-01; +5.637645044030811e-01   +2.569133538428370e-01   +4.194600098474155e-01   +4.778190337488126e-01   +5.772282291142846e-02   +3.879766470063878e-01   -1.487494094749054e-01   +6.631998671989280e-02   +3.514431431525780e-01   +6.439844791489047e-01   +4.654768382831872e-01   +5.009561926941183e-01; +4.195206042602757e-01   +3.740795861744622e-01   -5.574956487899106e-02   +6.641517433730789e-01   +2.113819858726385e-01   +1.000000000000000e+00   +4.033018348604931e-01   +1.617541440943225e-01   +2.084498376947067e-01   +2.828572361923794e-02   +4.551426880340815e-02   -1.183296363446471e-01; -1.536693210601670e-01   +4.082453259145666e-01   +1.204681470024288e-01   -1.600260010831855e-02   +8.367448946669587e-01   +5.124111879572166e-02   +4.405486747459324e-01   +4.190614662405845e-02   +7.718043713638665e-01   +7.132968134382333e-01   +5.049675910605775e-01   +8.897026150901596e-01];
L2E_Input1_iAMPA_netcon = [+2.370536997288519e-01   +3.729240616423972e-01   +3.740461469554465e-01   +4.650681838754439e-01   +3.778967695320551e-01   +5.924312130125639e-01   +3.982730354324101e-01   +9.061292256111125e-02];
L2I_Input2_iAMPA_netcon = [+8.530291617280918e-01   +3.061890187542692e-01   +2.680464187572817e-01   +7.254141681088260e-01   +4.100602736860778e-01   +5.758887531472686e-01   +3.952393474994950e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
