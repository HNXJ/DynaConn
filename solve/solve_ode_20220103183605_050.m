function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.146863970979588e-01   +9.502470163356164e-01   +7.032784472745951e-01   +1.599035650712061e-01   +9.247322381896035e-01   +2.151883769575593e-01   +7.443185068710085e-01   +3.063191410824316e-01   +5.336119574089374e-01   +8.341150287621988e-01   +9.734419190260483e-01   +9.713456738643645e-01   +7.007472653237419e-01   +3.680686488703126e-01   +2.976605140579321e-01   +3.825712382805340e-01; +3.494854891732345e-01   +1.097986917852347e-02   +1.422211558379085e-01   +1.738341502994619e-01   +7.651708445931131e-02   +8.122929540585231e-01   +7.968419375632634e-01   +7.566467741648858e-01   +7.918000733227191e-01   +1.859176051833106e-01   +4.731767758621803e-01   +6.624653715633083e-01   +3.708135890341874e-01   +2.780271165595919e-01   +6.873147687552030e-01   +9.580717028534599e-01; +2.032664648304695e-01   +4.758762699431645e-01   +8.101648325690954e-02   +7.106037770859814e-01   +3.107426134360319e-01   +3.832004688744417e-01   +6.619966994016556e-01   +9.557331971148878e-01   +4.546634209103507e-02   +9.246172759168068e-01   +8.712218622936200e-01   +2.045014965649750e-01   +5.464876772390405e-01   +7.369580332819828e-02   +7.786312712766298e-01   +8.131730780486683e-01; +2.259407916738905e-02   +4.903141498009030e-01   +4.342267145932453e-01   +8.381687842663108e-01   +6.349301204061155e-01   +8.657181588498173e-01   +4.394931692621842e-01   +8.021326465155187e-03   +4.631532632981613e-01   +4.242713828824554e-01   +9.450805514115962e-01   +8.990474792571783e-01   +5.125286702670381e-01   +1.535249762963204e-01   +7.207186434971573e-01   +8.944833541306906e-01; +7.645559466312775e-01   +5.183424407311406e-01   +9.015233407788231e-01   +8.238620810670408e-02   +9.105057249197305e-01   +3.202214947879515e-01   +5.802295396090966e-01   +4.019327088176247e-01   +9.417566651343957e-01   +2.963062514342935e-01   +2.375185245519416e-01   +4.850272370950145e-01   +7.676230856405655e-01   +3.667778265300450e-01   +2.773144666446407e-01   +7.214275603052965e-02; +5.716935966349562e-01   +2.854005465921378e-01   +7.283988149314995e-01   +8.397285336681261e-01   +7.965966820225781e-01   +3.797683870369765e-01   +5.187334337588280e-01   +1.546379095818879e-01   +4.731346383728207e-01   +3.506029097169631e-01   +9.232765628847301e-01   +6.653810207796257e-01   +7.702544015414919e-02   +7.156999715921079e-01   +1.771243248236186e-02   +9.058257206752803e-01; +5.798105651969608e-01   +5.629233490838742e-01   +6.824387420175283e-01   +5.459159131255480e-01   +6.433057368333877e-01   +6.417838916614838e-01   +7.241961499114401e-01   +8.244636413830830e-01   +7.789087984899233e-01   +9.746103230809990e-01   +6.316805664347431e-01   +5.279124566456812e-01   +2.066883319912147e-03   +5.355313248908938e-01   +1.636915317473485e-02   +6.689493357208711e-01; +3.866673720491140e-01   +5.098336256930943e-01   +2.045372050831535e-01   +9.680530006060393e-01   +4.442674389469573e-01   +3.885691186603121e-01   +2.215441403571972e-01   +2.876315982281311e-01   +1.102323525331593e-01   +5.361565685171599e-01   +2.873589335917118e-01   +7.069530859965585e-01   +4.071742544343369e-01   +2.308784171669906e-01   +9.353786416014918e-01   +3.465242075949669e-01; +5.528738006280884e-01   +6.725072965614023e-01   +5.291535987320455e-01   +6.752221778895208e-01   +7.485738925605583e-01   +7.435956186031686e-02   +9.999852503667980e-01   +9.776414439176613e-01   +5.190898955693323e-01   +7.918393265814373e-01   +8.503784412838039e-01   +7.209776697020117e-01   +6.604229033974001e-01   +4.746473720465891e-01   +9.365694639135407e-01   +8.405513208585992e-01; +1.884286773426624e-01   +6.154943559372326e-01   +8.289753726955149e-01   +3.342399837326840e-01   +8.294429302965701e-01   +1.993468579061046e-02   +6.228902119652291e-01   +6.258082175007115e-01   +6.385248735581263e-01   +7.989032214171692e-01   +1.633151984235424e-01   +2.965265653923873e-01   +3.728328207027846e-01   +7.191040724902422e-01   +3.764194730577144e-01   +1.930160766712917e-01; +1.187914515544850e-01   +5.632654016216027e-01   +1.770387391943507e-01   +2.165452078853257e-01   +3.449885272225803e-01   +8.771002573586973e-01   +9.850756815668283e-01   +7.469297993910201e-01   +5.796486331869362e-01   +1.406036829228182e-01   +8.285383544680862e-01   +1.143840428490672e-01   +3.981191017438050e-01   +5.192473290507195e-01   +1.059826816308867e-01   +8.426771043065286e-01; +5.819531636844732e-02   +5.046073762353042e-01   +5.159263821602216e-01   +5.731196761896612e-01   +1.442625370284384e-01   +1.554374541403882e-01   +4.977988187690791e-01   +8.809634992554706e-01   +8.395984396182173e-01   +4.523663382127798e-01   +2.159801697924050e-01   +3.276127104563750e-01   +1.339236894385720e-01   +5.170110210068263e-01   +7.259303935082082e-01   +4.258236842874299e-01; +9.382453170222996e-01   +6.629843696087392e-01   +3.568416104042768e-01   +1.924648617507675e-03   +5.022381006420450e-01   +9.202071267626724e-01   +5.231160839299277e-01   +3.309271226797306e-01   +1.143671099380739e-01   +4.550856626519653e-01   +2.656384701188120e-01   +4.618242586612235e-01   +3.401869900063408e-01   +3.887662391924360e-01   +4.555890701321318e-01   +5.590921339332916e-01; +7.461603894322354e-01   +6.397279496825796e-01   +6.525498982343563e-01   +5.917936139563231e-01   +4.133372100316890e-01   +5.637944071057593e-01   +8.546191575272796e-01   +9.647647992826452e-02   +5.163231546128813e-02   +9.598073833254475e-01   +9.054066745101212e-02   +7.153741944287477e-01   +1.210552551990701e-01   +4.833829631053274e-01   +1.598108467360777e-02   +4.485919236672952e-01; +2.401178991707508e-01   +1.425541544515928e-01   +2.809790236528889e-01   +8.979198134389547e-01   +1.773842898756600e-01   +9.236048461915043e-01   +2.502825282530211e-01   +4.475320300563062e-01   +5.232899415064545e-01   +5.252483982492662e-02   +9.167670420568574e-01   +4.029085449851929e-01   +3.715655310759250e-01   +7.457321079044753e-01   +1.220734376076791e-01   +7.592568513133107e-01; +2.020734238806581e-01   +1.773247488242512e-01   +4.321647824150153e-01   +2.579312576279260e-01   +4.932014312827202e-01   +5.978352374520196e-01   +5.780439988467327e-01   +2.364081130575642e-01   +7.018565376580564e-01   +3.627597003885692e-02   +7.284172104977727e-01   +2.418198472652964e-01   +2.505934727270959e-01   +7.059782577938736e-01   +6.585109746872618e-01   +9.426371633670294e-02];
L1E_L1I_iGABA_netcon = [+8.395530887996334e-01   +7.469862497059249e-01   +8.729908616443570e-01   +4.396742626083942e-01   +9.233113365561590e-01   +7.715755867913034e-01   +3.210720971875339e-01   +6.381705122837579e-01   +9.520175619291557e-02   +2.630826339862239e-02   +1.349515665193071e-01   +5.237450710439023e-01   +8.695049805960530e-01   +5.765260495765563e-01   +1.696533703120740e-01   +6.287070143551018e-01; +6.167590715139948e-01   +9.945250647722710e-01   +3.134249303219674e-01   +1.494952602983933e-01   +8.827868691975796e-01   +2.762584298345231e-01   +9.644058664074346e-01   +4.342371696296362e-01   +2.917745413479131e-01   +5.106703118515877e-01   +4.287867885741924e-01   +2.019627015552267e-01   +8.059710267347040e-01   +2.925954690611924e-01   +6.025763342462440e-02   +3.390511573814083e-01; +6.688102822635498e-01   +3.717265519919284e-01   +4.322008922652218e-01   +6.505839305433023e-01   +5.883377247564443e-01   +5.262751071517208e-01   +3.548377328715612e-01   +4.854231258800462e-01   +3.293389415099471e-01   +8.631201149552451e-01   +4.843639285363766e-01   +7.720106878051355e-01   +6.408693766224072e-01   +1.365959261496646e-01   +2.128178938248648e-01   +1.555527817329752e-01; +7.819727244699973e-01   +5.035357429748709e-01   +3.810336381529544e-01   +7.242738705366935e-01   +8.379317046075614e-01   +4.091289307748447e-01   +3.209552195496236e-01   +9.984015165138763e-02   +4.803484129872748e-01   +5.827586623662949e-01   +6.701319159590912e-01   +3.869612343431869e-01   +7.312966447691497e-01   +4.634762764643720e-02   +2.069703719442953e-01   +3.974454031731274e-01; +3.106834940599649e-01   +7.533973849684683e-01   +6.571670178930435e-01   +1.670160737561231e-01   +7.779330035853513e-01   +7.823313769324743e-01   +9.120157504105399e-01   +8.065392128604544e-01   +2.440762784887769e-01   +4.225150177245701e-01   +3.538537943407157e-01   +6.665757287947623e-02   +6.707706716293114e-01   +6.202430721663784e-01   +2.200450795591848e-01   +9.114222503408344e-01; +3.260896687793447e-01   +1.314059958752702e-01   +2.439813962628510e-01   +3.415757702480430e-01   +7.901464860055228e-01   +2.767949694566751e-02   +8.817579605615660e-01   +5.875137208234190e-02   +4.565199763245049e-01   +7.168012854044741e-01   +5.065491600302572e-02   +7.568933852746759e-01   +8.859456391975919e-01   +6.061082534928768e-01   +5.815385390516993e-01   +1.539873914486376e-01; +6.334103456664085e-01   +5.164427866769967e-01   +6.864316802927920e-01   +1.063241241314761e-01   +6.978321550455887e-01   +4.103484951801737e-01   +3.567068952455323e-01   +9.577632921517341e-01   +7.557418539629800e-01   +2.303302479571316e-01   +2.910809993680176e-01   +4.561497247479868e-01   +8.559626660071527e-01   +3.711071174730932e-01   +3.402672789229079e-02   +4.680104527514485e-01; +8.989707105839686e-01   +9.065947282566140e-01   +3.315049746655277e-01   +4.301509306938216e-02   +2.104263302221062e-02   +8.275242045104816e-01   +7.442437806094914e-01   +7.724617920453175e-01   +7.171609296167629e-01   +5.605745116541405e-02   +7.997827487211991e-01   +3.177387525474198e-01   +4.081580085206081e-01   +8.369287151170718e-01   +7.930180991685158e-01   +7.604393387365774e-02; +3.735266199200225e-01   +1.022608593559439e-01   +8.775013085289333e-01   +4.775807143355572e-01   +3.254096781463581e-01   +5.904120025375166e-01   +1.224105451124242e-01   +4.418900324734757e-01   +2.309409223389170e-01   +9.767952614512615e-01   +6.522059628111715e-01   +2.761794746633724e-01   +1.076562084104263e-01   +5.182796177717882e-01   +1.347851652966916e-01   +3.392187113671036e-01; +8.855354981507045e-01   +1.791434251344403e-01   +9.987556750383512e-01   +4.787614664836953e-01   +9.431884198516119e-01   +2.100243397698637e-01   +5.933688774254010e-01   +1.623618195346771e-01   +7.011628129286793e-01   +9.697564250128239e-01   +7.077515082248813e-01   +5.777627822269240e-01   +4.072180470270333e-01   +8.046991248617298e-01   +5.811298166988274e-01   +4.924997519391698e-01; +1.203834004574610e-01   +1.792718714725914e-01   +6.846801095280368e-01   +5.495848907072720e-01   +4.034721911427263e-01   +2.956131182844863e-01   +4.381586617013048e-01   +8.250416575690901e-02   +3.052165473007726e-01   +1.331458300287190e-01   +7.612533723485960e-01   +9.080057064758964e-01   +3.396020482375754e-01   +5.739604731572437e-01   +8.480409982505462e-02   +4.944709795964283e-01; +9.097124261157478e-02   +5.372846123408094e-01   +3.444070941552845e-01   +6.534125795200685e-01   +6.306612510659045e-01   +2.652720635227718e-01   +9.609899428123834e-01   +7.391454200773918e-01   +4.654802004182844e-01   -3.033346341557210e-03   +3.876083381684802e-01   +4.477970809451415e-01   +1.133696362849176e-01   +7.149474181457772e-01   +2.265765589473985e-01   +1.298744396767548e-01; +5.470004443927317e-01   +9.735413909436335e-01   +5.620125470166496e-01   +3.501805424189777e-01   +8.530936780033370e-01   +9.302977844356514e-01   +9.692070353084706e-01   +5.373695686554715e-01   +4.411102395477773e-01   +9.311920298394829e-01   +3.646746042752906e-01   +9.792577954967780e-01   +8.555289450487727e-01   +7.376297748831248e-01   +4.507106478361816e-01   +8.022483882405342e-02; +6.056368426521874e-01   +8.452378018184656e-01   +8.915753010088432e-01   +2.521479189549807e-01   +3.734141278328595e-01   +5.508295949248604e-01   +2.451799493693049e-01   +4.861956871698959e-01   +7.318005084128346e-01   +7.355014590219292e-01   +8.122091050643629e-01   +1.084884921891132e-01   +8.914469151413947e-01   +4.490559480297265e-01   +1.795285934747430e-01   +6.748192014612127e-01; +7.259131290468813e-01   +6.701135196097495e-01   +6.493670402144306e-01   +1.809768881816256e-01   +2.019543215900069e-01   +4.320325654833406e-01   +7.737481652019168e-01   +8.883082382990757e-01   +8.743128094631121e-01   +4.301713823447518e-01   +3.906406614720336e-01   +4.193175563196980e-01   +6.867998170114410e-01   +2.824171134889485e-01   +4.149737821782100e-01   +1.210336483834919e-01; +9.939744492223483e-01   +1.278375513101723e-02   +3.755849744011467e-01   +4.753301632746026e-01   +9.082263408349223e-01   +3.255514297461087e-01   +7.093052144835446e-01   +5.824696270568469e-01   +9.107903021319336e-01   +9.486287935312177e-01   +8.756958613056941e-01   +3.883890942422019e-01   +7.472579274797704e-01   +1.549053260273831e-01   +9.673198369226840e-01   +9.910018315028827e-01];
L2I_L1I_iGABA_netcon = [+5.741231631260593e-01   +5.641979313259000e-01   +1.060077549617247e-01   +4.555524668174781e-01   +7.966162111998643e-01   +9.770576411329618e-01   +2.232708651207383e-01   +7.618882938344036e-01; +5.615492018675705e-01   +9.509173120770700e-01   +1.227618794716004e-01   +5.668101984980886e-01   +5.427440442582622e-01   +4.244003800732789e-01   +6.677949572103874e-02   +5.021567885326165e-01; +6.132277397847836e-01   +1.151325931801586e-02   +4.345591748593710e-01   +8.174290285535438e-01   +2.603437106007255e-01   +3.923208445518106e-01   +8.327334300153110e-01   +8.268621967958311e-01; +4.690934765408935e-01   +1.259038159861262e-01   +9.315500603245169e-01   +3.563046667929102e-01   +7.839600914033714e-01   +4.602211168012108e-01   +4.365577836468575e-02   +9.202706547707036e-01; +4.356243943753588e-01   +8.555620567532125e-01   +1.377326888580657e-01   +2.474273682784726e-01   +7.775618396851639e-01   +1.230278962389936e-01   +9.098828399950473e-01   +7.100012867164719e-01; +6.504080036046948e-02   +2.182260077529179e-01   +8.243209461010614e-01   +7.660880775341560e-01   +1.451226691527550e-01   +4.593992834188861e-01   +4.528443204616003e-01   +8.018513151868263e-01; +6.414154319915876e-01   +7.054459084553861e-01   +9.302573622368394e-01   +3.885726864010450e-03   +8.245024082484237e-01   +2.632734186695017e-01   +2.828637112690526e-01   +9.590101121670909e-01; +4.246904939146600e-01   +7.769369297015877e-01   +5.737545398105720e-01   +2.729596601968602e-01   +6.218008227996229e-01   +9.991412684920235e-02   +7.604962407277394e-01   +9.499705163970853e-01; +7.523233315303045e-01   +4.238439121349292e-01   +4.999791193945733e-01   +3.061096507824352e-02   +4.553828980586195e-01   +6.602338755591964e-01   +9.247888116261154e-01   +2.970127198835910e-01; +3.088375803311653e-01   +7.309047817512062e-01   +9.329540638912319e-01   +6.681350702247779e-01   +4.822037454635619e-01   +9.442642873101803e-01   +1.392840569410729e-01   +3.523476085830969e-01; +5.986555580645337e-01   +4.576315067715001e-01   +8.617175807572164e-01   +9.710371794040511e-01   +2.193229612263748e-01   +7.611328164215394e-01   +9.492869070931889e-01   +5.435248389964835e-01; +3.325794306032531e-01   +8.063688539845232e-01   +2.546069646187723e-01   +9.447830047619384e-01   +8.573548592241282e-01   +3.909187938723495e-02   +3.085460906608052e-01   +2.113959950693667e-01; +6.449039929250993e-01   +4.323264545937646e-01   +4.592161079498915e-01   +4.834932720491618e-02   +8.787476378692154e-01   +2.640558860991218e-01   +2.101548757217167e-01   +8.176498941512653e-02; +3.422922535832199e-03   +1.487131466425254e-01   +7.383846304218582e-01   +2.910890443579051e-01   +8.432334066531958e-01   +6.406764839784111e-01   +4.621448978593802e-01   +5.099029717071537e-01; +1.444147215860204e-01   +8.054987082183156e-01   +7.533466924306240e-01   +4.851310982737333e-01   +4.391879941272639e-01   +9.328151826667219e-02   +5.942056529921325e-01   +1.963736581091178e-01; +2.500061983064347e-01   +3.791422372581281e-01   +2.374055544694702e-01   +8.870694003358667e-01   +5.438028867602863e-01   +7.622600766493856e-02   +5.510504370778132e-01   +1.451710361712280e-01];
L1I_L2I_iGABA_netcon = [+7.038838219308768e-01   +8.662948166529132e-01   +6.134501160733368e-01   +5.257772533425419e-02   +1.434177551873032e-01   +2.352494350718349e-01   +8.421327608918030e-01   +3.702760444816443e-01   +7.088641726077602e-01   +3.839163104911859e-01   +2.425790347173677e-01   +6.669506971311168e-01   +1.635396392262546e-01   +5.736316047219221e-01   +4.113481828353432e-02   +4.535461356879058e-02; +6.010288770305025e-01   +8.001771625086014e-01   +6.118017718588730e-01   +5.805382192451180e-02   +7.453710991719192e-01   +5.549884121519266e-01   +1.980404638296468e-01   +5.603425424984027e-01   +1.864737159407891e-01   +7.237263734615440e-01   +5.082693684277978e-01   +3.359301986324683e-01   +1.090580639081748e-01   +8.084061494105362e-01   +4.362994470688255e-01   +9.219185767141993e-01; +1.661684548666291e-01   +6.234371111907709e-01   +3.098388253320304e-01   +5.960342740564182e-01   +9.537998494528667e-01   +1.134030083154080e-01   +6.175374335624421e-01   +8.299378203742266e-01   +2.310873856621771e-01   +6.372568924093833e-01   +7.320959241418704e-01   +5.471745339679732e-01   +7.388626409565066e-01   +6.746099735373513e-01   +9.224644728392899e-01   +1.759100484909394e-01; +4.824324990970696e-01   +4.757092895068346e-01   +1.367104376253820e-01   +6.608116149704423e-01   +2.628086316190598e-01   +8.201285062486495e-01   +1.568800955314180e-01   +7.124430080789721e-01   +9.997175043297754e-01   +1.024887906095394e-01   +7.767050218802640e-01   +5.363183167079260e-01   +2.161566012262581e-01   +4.404670006272879e-01   +8.818014419139036e-01   +7.454143764192389e-01; +2.897313619874351e-01   +2.205461767347418e-02   +6.002122922552383e-01   +4.820573528371084e-01   +9.057756170858633e-02   +6.559931561332206e-01   +5.819133299607856e-01   +1.159651907502831e-01   +9.046267159142871e-01   +4.904934350398960e-01   +6.796333735277562e-01   +9.006286741205520e-01   +4.841208076871054e-01   +8.920350820487111e-01   +9.458681999901823e-02   +4.727306245520518e-01; +4.013572338625623e-01   +1.201285734719012e-01   +8.924272957439456e-01   +9.798994379231555e-01   +2.321510835833184e-01   +2.346768817994943e-01   +5.413294107704462e-01   +7.385212641107116e-01   +1.236273692513961e-02   +5.587176996252936e-01   +8.169290473004729e-01   +2.831655645838931e-01   +5.220909188870148e-02   +7.866386853564252e-01   +6.771175599232661e-01   +2.496214472063353e-01; +4.945408167738543e-01   +7.179152868818931e-01   +5.620563485840032e-01   +8.657816373797167e-01   +8.932018843468997e-01   +3.046610008949117e-01   +6.847389970262462e-01   +9.235593002320707e-01   +8.303022697080534e-01   +5.473918046500780e-02   +4.172154555092464e-01   +1.396634595385432e-01   +5.763647044480242e-01   +5.844966778473825e-01   +1.141842721496647e-02   +6.688550098694837e-01; +8.614993003038660e-01   +6.739098382569294e-01   +6.350133574467486e-01   +9.532564310821083e-01   +1.968730251212652e-01   +3.291733484117253e-01   +6.970644139164197e-01   +9.198650108427785e-01   +2.502522756762207e-01   +8.594035883583832e-02   +4.969561812956965e-01   +9.573949205486900e-01   +4.964223285955690e-01   +6.211756816215269e-01   +1.218843902576871e-01   +6.111163905981588e-01];
L2E_L1E_iAMPA_netcon = [+3.707100253986894e-01   +5.607106186486669e-01   +2.041294259434144e-01   +5.154026030974893e-01   +2.888161811914828e-01   +7.190129004458849e-02   +2.798790564650809e-01   +2.644078933427985e-01; +4.342826493163949e-01   +1.882687163071753e-01   +1.342459922408152e-01   +6.852236307478700e-01   +6.221837456212469e-01   +5.908415518206450e-01   +9.295741540293725e-01   +8.996721073242491e-01; +7.166585890373434e-01   +6.095496759464417e-01   +8.516883707150860e-02   +2.044202210980932e-01   +8.698295451441508e-01   +8.068487583414775e-02   +7.631429917532490e-01   +1.559904160550380e-01; +1.945504449029105e-01   +7.384811989575387e-01   +9.392452725230391e-02   +9.722597001285459e-01   +8.160702846325371e-01   +3.973139817400134e-01   +2.651967020570370e-01   +5.549409803262251e-01; +4.403101132845270e-02   +8.338077397636680e-01   +5.493547072743914e-01   +3.529395517782550e-01   +2.085241395132732e-01   +5.620194005096458e-02   +2.434277802379634e-01   +4.212697159845969e-01; +3.173193111283781e-01   +2.767610650115905e-01   +7.299686285075436e-01   +1.834606750758958e-01   +7.511680127414073e-01   +1.247137053572035e-01   +1.627139864335357e-01   +5.474655547128554e-01; +7.894076474689878e-01   +6.121352879205419e-01   +5.441155321915144e-01   +2.427700912512823e-01   +1.999308196130912e-01   +2.447487412897362e-01   +2.905288218085127e-01   +7.501941413257214e-01; +4.688069313582562e-02   +5.471356151641333e-01   +5.061216548973119e-02   +2.573055193684535e-01   +5.771577555889374e-01   +9.470065266634589e-01   +5.625681757601410e-01   +1.055477168525671e-02; +2.155145076591485e-01   +2.773656470710618e-01   +6.342915587233806e-01   +2.227210606978360e-01   +8.741494149138672e-01   +2.042854486007908e-01   +3.986544227695651e-01   -2.107685860334417e-03; +2.698081672859666e-01   +3.379935649273368e-01   +9.916724351962944e-01   +3.543712792686442e-02   +7.157948681588748e-01   +3.285880105765712e-01   +9.882858511184951e-01   +2.307503395897912e-02; +7.909474427547568e-01   +5.696645263186864e-01   +9.125626213807612e-01   +3.563721192417124e-01   +7.022606015691704e-01   +8.640953752817080e-01   +5.448190683223764e-01   +3.555004457821593e-01; +9.872597908654900e-01   +7.401555944691344e-01   +7.712027333395924e-01   +8.987337403255832e-01   +4.636513017308031e-01   +9.214550331220405e-01   +9.309972970489772e-01   +4.301099505194354e-01; +9.676461000946336e-02   +7.662022154954909e-01   +1.921765345454079e-01   +1.401715204090158e-01   +5.034974317529504e-01   +1.950826214326212e-02   +9.902598189656959e-01   +5.469860491396977e-01; +1.971526658949003e-01   +4.013973510049032e-01   +3.280702581985940e-02   +9.551731225312249e-01   +7.996108703590353e-01   +3.622746249796763e-01   +8.336846041632686e-01   +4.865945478420224e-01; +1.176995870843485e-01   +1.505069469126579e-01   +3.769133896729177e-01   +9.064715986976967e-01   +9.350620382695242e-01   +5.296174653390451e-01   +1.806214253505264e-01   +9.179711082438001e-01; +6.415889127802317e-01   +2.040020068957926e-01   +5.757809904561196e-01   +4.106312195061583e-01   +7.876558259363637e-01   +4.050158099427663e-01   +3.079926716423960e-01   +4.182431652069128e-01];
L1E_L2E_iAMPA_netcon = [+4.998827825541988e-01   +4.502654470097593e-01   +6.149721601572284e-01   +4.909548277220784e-01   +2.315502861094295e-01   +7.157530696076678e-01   +6.912396696607424e-01   +6.336745906068353e-01   +5.212833243235248e-01   +2.422834145593994e-01   +8.757179475832937e-01   +1.753355623695731e-01   +1.369893898516182e-01   +2.458480666528388e-01   +1.848889199849091e-01   +2.398158280837439e-02; +8.345578145276891e-01   +3.664301361496669e-01   +1.039395083766631e-01   +6.613879958254587e-01   +8.371280791011834e-01   +3.840882150792317e-01   +9.756127022553993e-01   +6.232961015044861e-01   +6.728745906421904e-01   +7.285014629611281e-01   +6.598197681365029e-01   +3.026404414493876e-01   +2.863704714332873e-01   +7.486837773647878e-01   +1.498939782618154e-01   +2.460654659464666e-01; +1.853021421443189e-01   +3.008399861358819e-01   +7.564425992399103e-01   +1.783778231420100e-01   +7.344351905593405e-01   +3.816231749622844e-01   +7.536162681518230e-01   +4.066142913461795e-01   +7.732478469896696e-01   +1.329859009128982e-01   +5.402745059374519e-01   +1.081793147398213e-01   +3.476908699226027e-03   +9.319528749181217e-01   +1.359851993569755e-01   +9.891659397093976e-01; +3.395388212754565e-01   +2.355647720769683e-01   +5.393394916421375e-01   +4.780317358386661e-01   +4.892777482075915e-01   +7.126795979705628e-01   +5.527567187394151e-01   +4.268356302555801e-01   +4.635608160308146e-01   +4.241912907543697e-02   +2.536678866199963e-01   +4.469753602192922e-01   +3.071701499945362e-01   +2.777649353863235e-02   +1.655570781745741e-01   +6.339789456915350e-01; +6.946034061116025e-01   +1.384580807545983e-01   +4.425016011921905e-01   +5.002000824210949e-01   +8.486456330969205e-01   +8.342924873487965e-01   +2.596887086040119e-02   +5.080388525160374e-01   +9.059990145077819e-01   +6.500945195354160e-01   +1.062063068072566e-01   +5.878037992725632e-01   +9.043284121579291e-01   +4.357028846470586e-01   +9.191974991768116e-01   +3.586811095959270e-01; +6.992175435706957e-01   +1.029443511700191e-01   +7.426559273261767e-01   +6.053116423527283e-01   +7.180076557506760e-01   +6.694725984485947e-01   +1.936478271640772e-01   +2.603959770322614e-01   +2.559560483022292e-02   +2.005801024467465e-01   +9.725110429981005e-01   +2.230707111468214e-01   +2.941738115426797e-01   +8.314225277912272e-01   +2.637586825582304e-01   +9.557817883892013e-02; +3.674070996081834e-01   +2.324678116640320e-01   +3.874387551679663e-01   +2.458118464347476e-01   +5.224187645589866e-01   +6.489255220443573e-01   +9.379928903541924e-01   +4.218731752078130e-01   +4.825198787644478e-01   +9.751103169407146e-01   +5.943275242068441e-01   +1.098328949830389e-01   +8.271668579127461e-01   +9.955941383496786e-01   +2.101203950761206e-01   +4.087121923422710e-01; +3.232572964801848e-02   +3.448281717715535e-01   +5.294646426042307e-01   +5.168170701521408e-01   +9.378964242853585e-01   +5.616926420084445e-01   +3.957093822355317e-01   +5.224524764607098e-01   +2.747286663972814e-01   +8.202605520189443e-01   +8.203251382711899e-01   +5.599621537957826e-01   +7.442798010470675e-01   +9.185554161287190e-01   +6.169030349745434e-01   +9.308278847611166e-01];
L2I_L2E_iAMPA_netcon = [+6.736003488183230e-01   +6.114351756474381e-01   +4.225408290202065e-02   +7.978650490786044e-01   +5.209662553038383e-01   +8.227769686206069e-01   +6.477703610815670e-01   +3.856963942197092e-01; +2.486708801004382e-02   +9.426053713352338e-01   +5.444134321350959e-02   +9.346655826249795e-01   +6.220316782893306e-02   +1.130002725511063e-01   +3.934425771841419e-02   +1.705076654008225e-01; +7.409618868452137e-01   +9.625547207778822e-01   +4.040615423839635e-01   +9.391900370262971e-01   +2.857229560118052e-01   +2.080862091462574e-02   +5.642273242031320e-01   +4.463743895182599e-01; +2.145325166033688e-01   +3.707887771024404e-01   +9.841800574031159e-01   +1.440880907653258e-01   +7.126644664457270e-01   +7.150817441243095e-03   +3.054836592388259e-01   +8.744947395971525e-01; +8.580851152411320e-01   +8.003443346048006e-01   +7.114366085253035e-01   +3.238131896677391e-01   +8.841945296769048e-01   +3.337987132333861e-01   +2.627852776575390e-01   +4.081958707458096e-01; +1.575904789027418e-01   +7.293286835972379e-01   +9.859096890846130e-01   +4.324120208790252e-01   +3.646517362649889e-01   +6.687614986199938e-01   +7.194346642172338e-01   +1.644388464806678e-01; +6.717183220132587e-01   +9.545641686268711e-01   +6.476306128582696e-01   +7.075158036578848e-01   +5.638097578703363e-01   +5.965196760086020e-01   +3.081689912857395e-01   +6.626421265533553e-01; +9.338879164281375e-01   +1.227625330517185e-02   +5.034998313583114e-01   +6.185812196568869e-01   +8.821327962178470e-01   +7.935907542387390e-02   +9.010606174664144e-01   +9.300094151511207e-01];
L2E_L2I_iGABA_netcon = [+6.171196158847318e-02   +5.229151944221226e-01   +3.508797521901339e-01   +2.577051270202604e-01   +4.344078777324093e-02   +8.950518948482982e-01   +3.415410124138082e-01   +4.526907406125066e-01; +3.545847158181579e-01   +6.535221059943615e-02   +5.585137870090204e-01   +9.822836839782709e-01   +3.609928606584204e-01   +5.435307823405454e-01   +9.330245476475888e-01   +6.771407346212194e-01; +9.319243876536136e-01   +1.808259764347568e-01   +6.906463164785145e-01   +3.494046354341498e-01   +3.850300372697110e-02   +7.161050992841670e-01   +9.136776431932563e-01   +7.713296369885004e-01; +2.396053719192754e-01   +3.121549732480022e-01   +4.435661508746114e-04   +3.982829011430944e-01   +4.853135163976759e-01   +7.151850260925566e-01   +7.251518956667068e-01   +9.270044819365773e-01; +1.064423060178139e-01   +2.464626054009950e-01   +4.488084711689381e-02   +7.513196067366640e-01   +7.279755797745137e-01   +1.712495626479136e-01   +4.424482373381485e-01   +6.558128048384821e-01; +7.144199013164803e-01   +3.244425792677758e-01   +3.033205994658059e-01   +1.059441709887429e-01   +1.452967237789955e-02   +3.526856295699324e-01   +1.537706218055204e-01   +5.002039420530755e-01; +7.046788425916301e-03   +8.777505229693838e-01   +8.724101756575947e-01   +5.936098848737266e-01   +5.136392231179154e-01   +3.821376300846559e-01   +8.300933941741619e-01   +3.431491473582367e-01; +1.782790660236651e-01   +3.040332591554931e-01   +6.269342875373063e-01   +1.222535884189243e-01   +2.411370514073748e-01   +7.570625713745223e-01   +2.530084413208925e-01   +9.476428725348155e-01];
L3E_L2E_iAMPA_netcon = [+7.658572418162796e-02   +1.512973900902170e-02   +3.678587573878513e-01   +4.949194468608390e-01   +1.950233469973106e-02   +9.596861435164015e-01   +3.600685797617076e-01   +1.833012631793672e-02   +2.040347406731361e-01   +6.647937377227560e-02   +2.451685042735615e-01   +9.994983309688829e-01; +9.537201419190241e-01   +9.764311423702740e-01   +1.156669046573457e-01   +6.550092491485628e-02   +8.088377844037247e-01   +3.876263306176379e-01   +2.285295434759911e-01   +1.242755803976231e-01   +3.586515397830156e-01   +7.425805404120331e-01   +5.343651618186189e-01   +3.447709060739613e-01; +6.650991118098343e-01   +7.197097624552941e-01   +5.134318914780159e-01   +8.651146228247514e-01   +7.937605835866474e-01   +6.642063497567592e-01   +7.277406220368493e-01   +6.658646629078032e-01   +8.897030748106174e-01   +9.916588351422226e-01   +3.320083091671803e-01   +8.243989943114747e-01; +1.671873958414611e-01   +8.717196541406451e-01   +7.415664191038474e-03   +9.983264305044941e-01   +4.216188108722271e-01   +5.856232919564666e-01   +7.706845987043602e-01   +5.087862424942875e-01   +8.178208604800733e-01   +7.671799663237560e-01   +6.731989472240086e-01   +1.107187297562740e-01; +1.968850900895016e-01   +8.196136112201772e-01   +8.713702796870424e-01   +1.218970692763758e-01   +6.301438137797356e-01   +5.413175550688828e-02   +3.411735229791815e-01   +7.510147937407546e-02   +3.192855839648367e-01   +8.858287110826162e-01   +8.770648283578100e-01   +7.786035647618026e-01; +9.943935832951345e-01   +3.527239366495034e-02   +9.086991424177808e-01   +1.031187367011778e-01   +5.691498210660956e-01   +7.372914388988076e-02   +5.725308297160299e-01   +5.383131715746778e-01   +5.988127885063124e-01   +4.086279490441953e-02   +9.835465684000424e-01   +1.516156208903995e-01; +9.273124373276832e-01   +9.523896451055938e-02   +1.082137303349494e-01   +1.494659440408852e-01   +9.027044535349692e-01   +2.316985242006942e-01   +6.415902331554304e-01   +6.819434637946105e-01   +6.972525808449196e-01   +7.950790092172353e-01   +1.420199391145346e-01   +7.331872174047125e-01; +9.803922451478465e-01   +9.027532781687200e-02   +4.434169274772224e-02   +1.248987416300014e-01   +7.473021072042854e-01   +4.165924663717246e-01   +3.694248950153752e-01   +5.893009107152043e-01   +1.779343949879637e-01   +7.100202935540718e-01   +8.774086807025703e-01   +1.141341986723665e-01];
L3I_L2I_iGABA_netcon = [+7.694393255616385e-01   +5.344899452591177e-01   +5.956233522817341e-01   +3.064041891771438e-01   +9.684224064869305e-01   +1.141548312344262e-01   +2.971680317395580e-01   +7.971643355307760e-01   +9.184635924719766e-01   +9.953160183277074e-01   +3.131545090146216e-01   +9.925182258237363e-01; +6.375195852936794e-01   +4.497290456656469e-01   +5.620775695491134e-01   +7.574128767652821e-01   +5.496540697325217e-01   +6.442814818854296e-02   +1.678159061335719e-01   +4.832818142189992e-02   +3.872832549533621e-01   +2.923815174655235e-01   +4.458806896900034e-01   +9.188483228355550e-01; +7.987022561091295e-01   +1.152981266106011e-01   +7.212686400760543e-02   +6.505576025934580e-01   +9.811009347174215e-01   +4.745481274203864e-02   +7.251405553775242e-01   +1.792062202888412e-01   +7.463129168352879e-01   +5.218534496483584e-01   +2.059329663107261e-01   +6.866138544886287e-01; +9.634312274222654e-01   +7.173697393207460e-01   +7.685505124253451e-01   +3.313099933828625e-01   +1.286636685725232e-01   +1.331105229845068e-01   +3.006546328213380e-01   +2.451157490546307e-01   +8.783569467483199e-01   +3.567498423315369e-01   +9.429150922257878e-01   +2.203548269824438e-01; +7.109839314985751e-01   +1.819763863852602e-01   +8.659128817767839e-01   +9.754461640435108e-01   +1.665181007943120e-01   +4.910543332536330e-01   +6.758456059380100e-01   +2.604675156878884e-01   +3.927728664882402e-01   +5.208504926984763e-01   +2.892116681704560e-01   +3.137077652951834e-01; +6.432987289019564e-01   +3.233198286072864e-01   +7.027283291077576e-01   +5.336161753548205e-01   +3.355239912317303e-01   +4.676392388175941e-01   +7.457505557525328e-01   +6.536566203840128e-01   +1.695934606782017e-01   +4.972573892014315e-01   +1.210490376018805e-01   +2.302250809244816e-01; +5.129692471794522e-01   +9.678863506750582e-01   +1.075251817401236e-01   +7.488078205640215e-01   +5.357385717400730e-01   +1.547726897806637e-01   +7.467010713980972e-01   +9.845092740974780e-02   +4.367248523881208e-01   +1.853999049644376e-01   +7.009321433227499e-02   +7.095747189183591e-01; +9.483545842218220e-01   +7.023760255485745e-01   +6.626074981366425e-01   +2.672275151495408e-01   +6.953714990441013e-01   +1.363662086357980e-01   +7.819001149084451e-01   +4.705973044259282e-01   +8.553326611496367e-01   +4.817772625083869e-01   +7.258682088269228e-01   +3.727598028724378e-01];
L2E_L3E_iAMPA_netcon = [+6.574247068902097e-01   +3.874249083257255e-01   +2.367668370558278e-01   +4.630023902297413e-01   +9.060679478748049e-01   +9.554455081476712e-01   +7.676063474334320e-01   +3.558254842760327e-01; +3.786212794868474e-01   +2.390710745085765e-02   +9.098698975398806e-01   +2.904470648823468e-01   +6.813814737832515e-01   +2.238146739446604e-02   +8.995045186226462e-01   +6.632531415189059e-01; +3.065644991572405e-01   +3.324360154377746e-01   +4.875696595693525e-01   +2.782558707262802e-01   +8.443601038798993e-01   +5.003322487516728e-01   +7.917077341269936e-01   +5.904213539543045e-01; +1.531572859812976e-01   +4.871458075831659e-01   +5.935484060933377e-01   +1.430624012325092e-01   +9.883836412212529e-02   +3.361417632582713e-01   +9.533718688499013e-01   +5.297127795550418e-02; +7.758729613333835e-01   +2.653121381990520e-01   +9.541557937892587e-01   +1.429005738158796e-01   +7.374565864266663e-01   +6.704649076041701e-01   +5.354530419650066e-01   +2.139287253107743e-01; +7.081054653901033e-01   +5.274250975744139e-01   +7.938709504316144e-02   +2.639083492395263e-01   +5.473431989540964e-01   +1.663031343639164e-01   +1.622102738327278e-01   +6.039490675510553e-01; +1.732252766077577e-01   +4.133094479457449e-01   +2.230638958437318e-01   +6.093154777594442e-01   +2.558220451110615e-01   +2.233662002892211e-01   +1.365605171469215e-01   +2.715415187246768e-01; +4.487839781065864e-01   -5.662419863925554e-04   +1.574567751696041e-01   +1.034947574982330e-01   +7.132083677885962e-01   +1.164049302645320e-01   +2.676653400249554e-02   +1.111795400499909e-01; +8.410479041101031e-01   +8.891652619204989e-01   +3.943542590282856e-01   +4.890576273904669e-01   +3.603176217230913e-01   +9.895830691323781e-01   +6.868341043124084e-01   +2.153885411256122e-01; +7.010965704328019e-01   +2.381791463372419e-01   +1.868975152734177e-01   +8.954442133404236e-01   +8.468691352399789e-01   +1.397828353080675e-01   +5.875710317080498e-01   +8.783781658366933e-01; +7.646556685267446e-01   +7.973218901041560e-01   +7.661605336085612e-01   +1.900669513781065e-01   +8.184390686759677e-01   +7.668933188597709e-01   +2.943173095902647e-01   +4.612326773890849e-01; +9.781149923217557e-01   +5.795381675919418e-01   +2.306773650110543e-01   +5.235467015190304e-02   +6.133043715260543e-01   +6.270105346224063e-01   +7.371958811546783e-02   +7.320940839685320e-01];
L2I_L3I_iGABA_netcon = [+5.915605286227908e-01   +1.436367767272399e-01   +3.443533792111333e-01   +3.699923906805527e-01   +5.978820687733418e-01   +5.071898920311231e-01   +7.709764902640937e-01   +2.676191032983034e-01; +8.402074019845446e-01   +9.915026812193811e-01   +4.376594477589621e-02   +5.375215998874104e-01   +4.749280279766500e-01   +2.403468258747045e-01   +1.771513229141774e-01   +5.918538251949166e-01; +6.046453270912961e-01   +4.832979475842982e-01   +9.457187037949319e-01   +9.724255705084520e-01   +3.817303481305306e-01   +2.720254878317669e-01   +4.534412126607830e-01   +6.825458917438962e-01; +7.459660968556904e-01   +4.027401325216714e-02   +8.651607560053202e-01   +9.950237312350839e-01   +9.811718456919590e-01   +4.085236926105817e-01   +3.013419062247757e-01   +4.153397851020301e-01; +8.479905110491169e-01   +2.687077618902104e-01   +1.353877719063224e-01   +4.147842448432217e-01   +1.381013827227947e-01   +2.609738280595859e-01   +3.843495417383702e-01   +5.104593566448148e-01; +1.462561878626712e-01   +6.720403051062668e-01   +5.905212649991369e-01   +4.479336657518458e-01   +2.712095130607947e-01   +8.535513505336501e-01   +7.994325063380066e-01   +8.155457767684704e-01; +7.434257691418156e-01   +1.462616852877360e-01   +6.934790791301704e-02   +2.480799862564549e-01   +2.241654355579335e-01   +4.818164297216817e-01   +7.824408989693745e-01   +5.394915565977477e-01; +1.581415233244709e-02   +7.713330838073607e-01   +9.501328782716452e-01   +5.967357742433818e-01   +7.951744711472842e-01   +3.405345581560628e-01   +6.458819862705787e-01   +5.890780048798102e-01; +2.243410449403725e-01   +2.682528580412824e-01   +4.970991123742421e-01   +7.422748982564353e-02   +8.202757002955501e-01   +6.371476134877135e-01   +2.452092746296288e-01   +5.362215092660233e-01; +5.333935976274867e-01   +8.814518542379532e-01   +2.639117664158247e-02   +9.079018018652598e-01   +7.950852684655499e-01   +4.121792781631148e-01   +6.074765451091630e-01   +5.390858499749530e-01; +7.181986305631483e-01   +3.658282989923970e-01   +5.291737817255376e-02   +4.801117262965086e-01   +1.125323894216718e-01   +5.478839763728606e-01   +4.187886305555200e-01   +1.514656586773858e-01; +4.318823096122446e-01   +9.968552426943049e-03   +2.999156075171350e-01   +5.059585384376035e-01   +6.343014172516944e-01   +3.384235893099730e-01   +2.959498008316248e-01   +6.996221605481907e-01];
L3I_L3E_iAMPA_netcon = [+5.995006830203436e-02   +7.729114753231733e-01   +5.531663403453915e-01   +5.725961350317565e-01   +9.151580149876171e-01   +8.338807706406562e-01   +8.473286682568814e-01   +8.604431780580251e-01   +5.313474485450395e-01   +9.909172713309294e-01   +4.815311648870639e-01   +3.507399826339673e-01; +9.221328928008413e-01   +8.400780072687074e-01   +8.468366689034706e-01   +9.367987191691083e-01   +5.928784522655532e-01   +3.975355325701367e-01   +6.282380698274601e-01   +8.575751237578566e-01   +5.654132368421518e-01   +6.991047887135944e-01   +7.429418582136129e-01   +3.971884544379602e-01; +1.855395441051046e-01   +5.941831466560127e-01   +9.695980049230272e-01   +7.805849838456403e-01   +5.758547119618215e-01   +6.948506606376115e-02   +4.411007411254461e-01   +9.495827356561259e-01   +9.854561555932403e-01   +8.434591930287308e-01   +5.915288823897233e-01   +9.874577604236559e-01; +5.428800951877480e-01   +7.641914298892123e-01   +4.637207653636158e-01   +5.935855989042665e-01   +6.547573843884734e-01   +3.768110671416511e-01   +2.331648180041840e-01   +6.951705148994586e-01   +9.607438571905189e-01   +7.343813296449417e-01   +2.566282577492602e-01   +2.944386483877510e-01; +3.979891070081326e-01   +6.638317562207851e-01   +7.704945259809356e-01   +5.787049125990896e-02   +4.310336875970481e-01   +8.542141788380793e-01   +5.072756091447904e-02   +3.612483756236589e-01   +5.600350392588690e-01   +9.966829035524739e-01   +6.079422886317514e-01   +2.279124231469343e-01; +9.107910325568900e-03   +5.849193967488131e-01   +2.411301521774806e-02   +5.408678941493230e-01   +9.378464315389506e-01   +2.550579855690392e-02   +7.049803116063663e-01   +3.742632121961212e-01   +5.262350580459727e-01   +5.059107475225120e-01   +2.281632506201987e-01   +3.290288055506609e-01; +1.054424317716599e-01   +2.394307179724815e-02   +6.751341625972083e-01   +8.623052344357571e-01   +9.914094584020297e-02   +4.237823437310419e-01   +8.476120529718530e-01   +8.433729407247269e-01   +4.762989652908045e-01   +1.926259539000494e-01   +1.930620149464270e-01   +1.670018725433427e-01; +8.556249631923835e-01   +6.855013103967762e-01   +8.386030604235749e-01   +3.384195630821980e-01   +4.060296750361447e-01   +2.515844512614756e-01   +4.067414451363277e-01   +3.847668146833456e-01   +9.013295976056023e-01   +9.555857115063587e-01   +3.379374681740764e-03   +3.825684614370164e-01; +3.389345764159363e-01   +3.266977516652575e-01   +6.870216860791312e-01   +1.779612060401199e-01   +8.936079903233888e-01   +7.359989399414280e-02   +2.924055759746946e-01   +7.710897221539816e-01   +4.817972614018078e-01   +4.517721146598492e-01   +6.526355308889514e-01   +5.272751271011381e-01; +1.502985235190656e-01   +8.197398924177375e-02   +9.000841475849296e-01   +8.788970046444099e-01   +7.358725374422552e-01   +9.180904523652897e-01   +2.598288392067580e-01   +7.769398161372773e-01   +4.876369857843417e-01   +6.079320151707368e-01   +4.005514847296618e-01   +5.942687966244943e-01; +8.035819492221328e-01   +7.438927443788715e-01   +9.544758892627908e-02   +8.416895061086006e-01   +9.581533320772326e-01   +2.645420733262366e-01   +5.090709756478951e-01   +4.324160794720466e-01   +3.117576039394074e-01   +6.429351096783624e-01   +2.713979490518086e-01   +1.703896464229669e-01; +6.516494228673382e-01   +9.687151273087030e-01   +7.683276661969934e-02   +8.321305405628162e-01   +9.733395146109607e-01   +1.056447918591688e-01   +1.199427267311052e-01   +4.844188735233441e-01   +8.547997767040456e-01   +7.631389505206431e-01   -1.065570583252153e-03   +6.972016532551696e-02];
L3E_L3I_iGABA_netcon = [+4.447518522481032e-01   +6.873722108132665e-02   +5.778815314267645e-03   +4.923066018035590e-01   +5.467392240192898e-01   +2.545458370689989e-01   +7.175039826742327e-01   +7.602210253938728e-01   +3.818232914707255e-01   +4.491151296821985e-01   +1.997019214684087e-01   +6.543142546106014e-01; +5.906847903318431e-02   +8.059782662229745e-01   +1.299456077916201e-01   +1.916365668970995e-01   +2.173910588748147e-01   +3.355940580895883e-01   +2.250732294662122e-01   +8.903941585114069e-01   +6.102999671967154e-01   +3.945080341081259e-01   +8.273120375892156e-01   +9.020680314295687e-01; +6.254705606844176e-01   +9.119083321720870e-01   +3.089232497716420e-01   +6.430708313784365e-01   +2.708934084081696e-01   +5.966255614639063e-01   +5.022782533733942e-01   +7.335707247992603e-01   +1.655992475661504e-01   +6.752331876309893e-01   +4.423345958958059e-01   +8.339106569499585e-01; +8.030325015166067e-01   +4.257764024280944e-01   +2.362661823184770e-01   +2.517792718359338e-01   +1.339208658892242e-01   +4.821559273015977e-01   +4.761376941773935e-01   +6.913697247849253e-01   +1.022768008373714e-01   +3.125963625675263e-02   +4.104347682022008e-02   +1.739658958091956e-01; +4.019719270495333e-01   +1.907440000738109e-01   +6.494628423513118e-01   +9.453672625280306e-01   +1.614826458377513e-02   +8.962264757716114e-01   +4.291972923173190e-01   +6.442287142387794e-01   +6.195288446210764e-01   +7.877859367470222e-01   +7.664580214889476e-01   +1.582487002935012e-01; +8.812209626322187e-01   +1.825562545660241e-01   +8.095001542120828e-01   +2.888257608052009e-01   +9.150707552637733e-03   +2.921837717717924e-01   +5.531792148262675e-01   +6.179770102893289e-01   +9.573673909320625e-01   +3.760477979106683e-01   +9.428561739309584e-02   +1.355660177602476e-01; +7.211908995751720e-01   +6.708523746856841e-01   +7.417498540558486e-01   +1.442034200111340e-01   +9.825803740166592e-01   +7.693224653142335e-02   +2.087595964649331e-01   +7.875611267083650e-02   +6.678803025438350e-01   +6.438248553228951e-01   +6.556958677621942e-01   +1.597456201960975e-01; +1.964260819347113e-01   +5.235559245098549e-01   +1.198462469370879e-01   +8.680436284439410e-01   +6.473522024517140e-01   +3.898055785555132e-01   +2.771266112978631e-01   +5.502265315492582e-01   +4.718008750606132e-01   +4.980335830125969e-01   +2.698616408251051e-01   +3.954771843200105e-01; +3.750687563136712e-01   +7.754414898904383e-01   +1.699555147735164e-01   +8.856277380351786e-01   +8.153344426528101e-01   +1.923976339006208e-01   +8.110249905428424e-01   +8.803794490684826e-01   +3.393913925144833e-01   +2.163678539847766e-01   +4.368320993828994e-01   +6.646500836071216e-01; +2.114418598950995e-01   +2.991352907246034e-01   +2.699339761205807e-01   +6.651232233693640e-01   +2.771730769057547e-01   +7.283926205717831e-01   +1.004849794904882e-01   +9.850067057685531e-01   +5.895228813819063e-01   +2.109254710152468e-01   +8.506494921527671e-01   +2.231406406416063e-01; +2.646679781174321e-01   +4.753642355467423e-01   +8.136472021396229e-01   +9.976902319813286e-01   +1.379029645014688e-02   +4.225022245108289e-01   +3.539547370662525e-02   +7.197996165767699e-02   +5.457439713741258e-01   +4.516650820825603e-01   +9.059293958702854e-01   +6.433700543097406e-01; +9.933888505308585e-01   +7.091098977629221e-01   +5.932663480498681e-01   +2.654977086883419e-01   +1.007552722757372e-01   +2.645797986829918e-01   +6.856288049147093e-02   +3.169621215318803e-02   +3.927206039307132e-02   +6.352559923924493e-01   +2.841327395783875e-01   +6.087001907288039e-01];
L2E_Input1_iAMPA_netcon = [+9.991869316570090e-01   +9.915508944604482e-01   +9.987998873442777e-01   +9.877944130729728e-01   +9.902666054700264e-01   +9.992102020058168e-01   +9.839621771394166e-01   +9.958726252420074e-01];
L2I_Input2_iAMPA_netcon = [+9.962858241327704e-01   +1.000000000000000e+00   +9.896038689988741e-01   +9.879932484791358e-01   +9.887199033190737e-01   +9.891443842289596e-01   +9.929191869927740e-01   +9.955353662523869e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
