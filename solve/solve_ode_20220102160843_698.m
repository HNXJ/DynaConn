function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.392744224640464e-01   +1.505060695499975e-01   +4.833761704952605e-01   +4.866933101976366e-01   +7.388261588439046e-01   +2.148541924456060e-01   +1.677460608355962e-01   +1.104005593748764e-01   +1.779676682169838e-01   +6.989678329809736e-01   +1.083585652794106e-02   +2.493249911477351e-02   +4.747526908307695e-01   +8.328952974818375e-02   +1.010767957431930e-01   +3.276696274416815e-01; +7.597756625729182e-01   +2.946865074679783e-01   +5.392768292966205e-01   +4.547107032381343e-01   +6.034822612182453e-01   +5.594606189408447e-02   +7.562964877190057e-02   +2.271016800966004e-01   +3.773253829036222e-01   +1.750179167450708e-01   +5.664858851683571e-01   +5.631123262066346e-02   +4.538888634259304e-01   +7.126992918522834e-01   +1.949855783689383e-01   +4.607100345666827e-01; +6.550283770801030e-01   +7.918119842946293e-01   +2.980775435192995e-01   +1.256142779769557e-01   +7.094646251836925e-01   +1.804217853490199e-01   +5.884746953924525e-01   +2.077453450488547e-01   +3.834158905616033e-01   +1.148171733006550e-01   +6.375780770284633e-01   +3.578914183266457e-01   +4.939860405862067e-01   +6.136748949832433e-01   +2.072293869560183e-01   +6.637487206035224e-01; +1.939758288124903e-01   +1.979270797035124e-01   +4.921440705449056e-01   +6.745822778583835e-01   +1.415156043862290e-01   +7.289497121160199e-01   +7.658435852848542e-01   +3.541246382637176e-01   +5.244729786483296e-01   +1.049279700200405e-01   +5.218525585172750e-02   +3.436654477322325e-01   +3.117605471157679e-01   +6.859004593057004e-02   +1.407227140356831e-01   +5.515774278338518e-01; +2.598517100735369e-01   +1.825252467828776e-01   +7.528959238697688e-01   +4.394507298533905e-01   +3.057138232269915e-01   +5.803342736453985e-01   +6.645759299623486e-01   +3.042789479192314e-01   +7.862335752155492e-01   +6.132133822027130e-01   +2.979037255314548e-01   +1.713332015259113e-01   +3.042054441002526e-01   +2.025972756161564e-01   +5.244622609390664e-01   +4.595942067992769e-01; +1.104304913391672e-01   +4.699816301023775e-01   +5.107078936504209e-01   +1.948912033463657e-01   +4.929329199976632e-01   +6.128044771422483e-01   +1.934136330844136e-01   +2.324518565986635e-01   +7.789044152286264e-01   +5.404341087304355e-01   +1.695870276456884e-01   +7.388051593824858e-01   +2.522107981615346e-01   +6.792567246231701e-01   +5.507073544860491e-01   +7.724065429704337e-01; +5.417437493555434e-01   +7.220651770194100e-02   +6.502825297581228e-01   +5.118948156185282e-01   +5.212472226476459e-01   +3.405896268085833e-01   +5.445634512455375e-01   +6.906295601277409e-01   +6.722533214334728e-01   +7.503691572721790e-01   +7.087420284025860e-01   +5.050510724622447e-01   +3.682608722538656e-01   +1.655414077188524e-01   +8.480310520093835e-02   +3.749878072304193e-01; +2.875390735358190e-01   +3.149083000869328e-01   +1.655101001920358e-01   +7.118772386519163e-01   +2.868209006452215e-01   +2.428076635329390e-02   +4.519723498975591e-01   +7.315622531505110e-01   +6.799115875300221e-01   +1.395899353272996e-02   +1.320895773316953e-01   +3.905884191611658e-01   +2.308572833217101e-02   +7.795653313768054e-01   +3.683232174468918e-01   +5.080291495910053e-03; +8.012309882389661e-01   +3.153960490500751e-01   +3.557185244933929e-01   +2.036981440822438e-01   +5.062519787840334e-01   +6.868547565431606e-01   +1.778605145718340e-01   +4.857627467776990e-01   +1.371378061212974e-01   +6.870948867559161e-01   +8.471137716225234e-02   +5.252098641392741e-01   +1.340518897383902e-01   +5.825192089431608e-01   +2.362374326620603e-01   +1.021221421268881e-01; +5.900066382241721e-01   +5.908269051438861e-01   +4.080588208546427e-01   +5.117202275986587e-01   +2.632088766774251e-01   +4.271725899668874e-01   +2.768263795174721e-01   +2.176676809943300e-01   +7.996960458196160e-01   +1.923005109541507e-01   +3.255221402243590e-01   +1.702581523523485e-01   +1.319791172681709e-01   +1.508095650455049e-01   +2.885606524258592e-01   +6.136984191579609e-01; +1.052577002794219e-01   +7.052790794324780e-01   +6.870044277565966e-01   +6.140517901405117e-01   +2.699591895493044e-01   +4.936544731493278e-01   +2.191124898543075e-01   +1.897817719811417e-01   +5.112232084108641e-01   +4.905783757461279e-01   +2.599796599329090e-01   +3.135579302196295e-01   +6.712810271014472e-02   +3.007697403083593e-02   +6.607438707641335e-02   +7.817388140004949e-01; +9.084601137026953e-02   +7.982103020941353e-01   +7.853584737587815e-01   +8.090175840844060e-01   +8.011958110233125e-01   +7.886622381201965e-01   +6.945527642231114e-01   +3.980850058514019e-02   +4.324687736477465e-01   +7.086496149645245e-01   +1.105760368738910e-01   +2.545705614488752e-01   +6.587736011607958e-01   +4.089604677208677e-01   +7.040022112606197e-01   +2.646397874066839e-01; +3.484142985339989e-01   +1.234470138156987e-02   +2.916928535782357e-01   +2.518729916329935e-01   +5.952853908964731e-01   +2.800142373182520e-01   +7.913005074443946e-01   +3.186935276154342e-01   +5.574934431160632e-01   +7.613472115103329e-02   +2.529623167872261e-02   +1.742801824333523e-01   +7.385846787724408e-01   +1.633410040493279e-01   +6.716365733180946e-01   +3.951760503071119e-01; +4.141799102912739e-01   +2.966278117962187e-01   +7.890941705159464e-02   +1.121385987556303e-01   +3.941608972459095e-01   +5.147076631061007e-01   +6.264232200190891e-01   +1.232095387719363e-01   +5.986510750038853e-01   +4.119427978407488e-01   +2.412326778990553e-01   +3.076721418555542e-01   +6.098995339002928e-01   +1.228684486796581e-01   +2.131668624989345e-01   +1.631816228447709e-01; +2.163795089335270e-01   +7.055593168193572e-01   +4.354871210089324e-01   +4.620350513691833e-01   +2.076078082670420e-01   +3.997021746015408e-02   +1.659633819196802e-01   +7.676567806339411e-02   +2.496682238358394e-01   +6.060159275576390e-01   +5.759579788909925e-01   +6.319194719015802e-01   +6.196701456161989e-01   +5.806751664442885e-01   +4.564867982240505e-01   +5.030770475822606e-01; +1.632719517272258e-02   +7.357270805156206e-01   +1.930620880341550e-01   +6.483891219542148e-01   +6.244224333355677e-01   +3.888164784946158e-01   +7.889792275642245e-01   +6.116623268721156e-01   +5.009273401849862e-01   +1.251506419603219e-01   +6.075569021093473e-01   +5.387304419255113e-01   +6.131195726126758e-01   +8.079647269077649e-01   +2.593306774422518e-02   +2.182398296676272e-01];
L1E_L1I_iGABA_netcon = [+6.610838588745831e-01   +8.572989401041982e-02   +2.303817197203044e-01   +4.467728402370731e-01   +7.397218969106311e-01   +4.694156114887507e-01   +6.037405635503176e-01   +7.855635461906237e-01   +6.716197526217886e-01   +4.818684463413588e-01   +4.432236572553635e-01   +6.462310743455474e-02   +5.757807665874561e-01   +2.034657787185186e-01   +7.188101692105785e-01   +1.366508873406876e-01; +9.405353574709704e-02   +1.055273119758901e-01   +7.445881370706388e-01   +5.087729869104459e-01   +5.811813622383489e-01   +6.021847375192599e-01   +1.617983203961197e-01   +3.086485622376400e-01   +8.557350390168686e-02   +7.305731665323175e-01   +7.218782229635997e-01   +2.407685943541606e-01   +7.703420291832279e-01   +5.290569279041675e-01   +5.123587971000162e-01   +1.855737418638487e-01; +5.984401707979562e-01   +3.331377209434023e-01   +3.662324251066972e-01   +6.523868529065903e-01   +7.042836149206225e-01   +7.170113729280263e-01   +5.541342830730868e-01   +1.348927862335797e-01   +1.739640854178095e-01   +4.732185913307222e-01   +4.610321064894884e-01   +5.100687738841861e-01   +7.484638462896532e-01   +1.572396970877616e-01   +4.021758908725063e-01   +6.347304133111005e-01; +5.062441004176591e-01   +4.406179020410698e-01   +3.086781237640736e-01   +7.706641882625107e-01   +1.749021043684938e-01   +4.363357164350127e-01   +1.555317599499258e-01   +2.013738136347525e-01   +3.652116694125890e-01   +3.218064667850518e-01   +4.860731158873760e-02   +2.928156135914395e-01   +1.857151730578498e-01   +3.693569974980243e-01   +3.817927420738383e-02   +4.793878282870664e-01; +3.049850833308649e-01   +1.028672000165263e-01   +6.535818025860494e-01   +6.528805735189228e-01   +7.731965120306518e-01   +1.055351808344479e-01   +2.804255909543460e-02   +1.677069709562713e-01   +6.888212855955019e-01   +5.039499719430348e-02   +7.535878769235150e-01   +4.161019160497552e-01   +4.673649345967563e-01   +2.057447636829131e-01   +4.984258554595403e-01   +1.697029809765562e-01; +1.089045272746961e-01   +6.312023858423867e-03   +1.904647364366560e-01   +7.723062874650044e-01   +5.389126236855084e-01   +3.930443274720491e-01   +3.804496949306105e-01   +6.759532461307204e-01   +5.279989970861599e-01   +2.340876603403874e-01   +1.212701377062542e-01   +2.430731046348371e-01   +1.877600473565399e-02   +6.836288549064331e-01   +9.471343154215495e-02   +6.184099427894295e-01; +7.858765388015870e-02   +4.109717711802058e-01   +5.397748345876171e-01   +2.347342588805602e-01   +2.918656465576411e-01   +4.699793806288985e-01   +3.855754572640545e-01   +7.646119323035349e-01   +1.179233813896733e-01   +3.193084923656268e-03   +5.063185083334453e-01   +7.248201393709607e-01   +6.151835800854428e-01   +5.712206813525978e-01   +6.375290604034213e-01   +2.901034250305508e-02; +4.903847132477982e-01   +5.302619161626473e-01   +3.245393719268257e-01   +6.189025402141790e-01   +5.346128699137640e-01   +7.909740220812678e-02   +6.910298347053759e-01   +5.429320088162612e-01   +2.837782503119374e-01   +6.999839661452442e-01   +6.935072084286702e-01   +7.873879374229272e-01   +2.314493876478794e-01   +4.973194575531938e-01   +2.596814514248356e-01   +7.818441321359406e-01; +5.433706372020529e-01   +4.993750495539590e-01   +6.804094135540928e-01   +4.793291847217235e-01   +1.554193850368169e-02   +2.807346703529963e-01   +3.516773261557639e-01   +6.766225524022107e-01   +5.064049904026929e-01   +5.907995235881769e-01   +6.492745613184809e-01   +7.064916847481473e-01   +4.250036240410355e-01   +2.249384589840922e-01   +3.912758659696935e-01   +5.869211657158094e-02; +1.875343044706972e-02   +1.284374766635334e-01   +7.755832198927605e-01   +7.967311945559827e-01   +2.211062963635076e-01   +7.929836246386570e-01   +4.739778774079077e-01   +5.177704070273174e-01   +4.930199179921682e-01   +1.474349967747575e-01   +2.436781738347794e-02   +2.705541825352927e-01   +1.604599568604196e-01   +1.251531162360621e-01   +7.717266806283365e-01   +3.509113320592439e-02; +5.528633275366173e-01   +1.605110624836331e-01   +5.751948706488847e-01   +7.129506785224250e-01   +6.208566794839087e-01   +4.109900134043288e-01   +3.834200833256295e-01   +6.024902460448235e-01   +1.440962641531658e-01   +4.040274534959715e-01   +7.028536474020336e-01   +4.509056651105174e-01   +6.673152225327430e-01   +4.548649085514840e-01   +5.127947926204712e-01   +2.248874845505563e-01; +2.789856519283266e-01   +9.610940413437691e-02   +2.926287900055143e-01   +7.827396067866175e-01   +7.941122153111249e-01   +3.667240455292915e-01   +3.980008582686032e-01   +6.284317950135957e-01   +3.257084006267911e-01   +3.171968412050324e-01   +1.136318345419404e-01   +2.627990333449992e-01   +3.237481668869422e-01   +1.059822563742468e-01   +9.516299359728966e-02   +5.154154392522252e-01; +1.222564203271986e-01   +7.268428103063868e-01   +3.770071131659402e-01   +7.312914973681074e-01   +5.574045316709599e-01   +3.141582779708549e-01   +2.448809634460439e-01   +4.334122664857042e-01   +4.873594537645615e-01   +3.306396986773164e-01   +4.793660727955334e-01   +4.905703318721659e-01   +5.239215568379832e-01   +4.325404571316845e-01   +1.712053206289173e-01   +3.891156502044295e-01; +3.410813242598347e-01   +3.885434251402789e-01   +7.296133414564623e-02   +8.275484237031201e-02   +3.733238369471467e-01   +6.570366869041440e-02   +2.886234910459084e-01   +8.008556363071231e-01   +7.127723101771563e-01   +1.216152458312288e-01   +2.905875741627373e-01   +2.643039756102457e-01   +4.588796449424262e-01   +7.940426974048428e-01   +3.226180768838503e-01   +5.558089929423601e-01; +5.552633231568918e-01   +6.449477519210486e-01   +2.481329334075236e-01   +2.336723076364706e-01   +7.618961959997970e-01   +3.178999400487464e-01   +3.842138435094509e-01   +1.689189580562145e-02   +5.984771870529221e-01   +6.764991930781008e-01   +6.157229433711313e-01   +2.697849121611410e-01   +5.697403568587509e-01   +7.539462119757930e-01   +2.603040063622428e-01   +6.297553698427705e-01; +6.826144081910914e-01   +4.795044873766428e-01   +5.669109253354316e-01   +1.378250655808475e-02   +4.912535277354367e-01   +7.816422826723487e-01   +1.509439739765606e-01   +3.172541843429005e-01   +4.511833011243113e-01   +7.332585504906520e-01   +7.064133480946141e-01   +3.647586266831808e-01   +6.543253251047615e-01   +5.239356809915950e-01   +8.034718338063644e-01   +7.968649948294244e-01];
L2I_L1I_iGABA_netcon = [+1.074605407361139e-01   +2.134612566914994e-01   +7.773013604100207e-01   +2.042505544408865e-01   +2.817442860091809e-01   +6.123115094785453e-01   +7.515401069771346e-01   +6.348802770143077e-01; +2.831295016972643e-01   +1.122608554776989e-01   +6.935369415457605e-01   +4.040212630635344e-01   +3.643892009343305e-01   +8.086475496434246e-01   +2.346976548679216e-01   +2.065369153502662e-01; +3.666043274086754e-01   +6.183166065041560e-01   +7.672599098896521e-01   +4.272235149303289e-02   +2.194381232576959e-01   +8.866628257705465e-02   +7.144989541472269e-01   +3.371877662782376e-02; +2.778396522032490e-01   +4.552907283964047e-01   +2.622735292381722e-01   +1.837401331375252e-01   +2.348630906035844e-01   +1.252350973083998e-01   +2.043920885385243e-01   +3.457315284531101e-01; +5.935306240142710e-01   +7.664167415777756e-01   +3.793893773510223e-01   +1.332916022503701e-01   +2.359836737930883e-01   +7.035884832637404e-02   +6.595049812966846e-01   +5.086460672781721e-01; +7.424570279172075e-01   +4.089997732949480e-01   +6.262185887412711e-01   +3.392490089083030e-01   +3.330658196761407e-02   +5.447573463039993e-01   +4.555838521471230e-01   +5.653604597842733e-01; +5.677186772697619e-01   +7.826110921726435e-01   +7.672551283270619e-01   +5.358144807390206e-01   +2.623310490846502e-02   +7.986029955998625e-01   +3.172707201640838e-01   +4.762460071306388e-01; +6.239670850183427e-01   +4.832367519508827e-01   +7.640072862042526e-01   +8.075673032501917e-01   +6.321394634515711e-01   +9.771036414256873e-02   +2.630089877195172e-02   +7.483833846704115e-01; +7.690041565720105e-01   +4.202658002520857e-01   +4.363953019964975e-01   +3.798450112548111e-01   +6.386567568207081e-01   +7.782237755793080e-01   +9.392038720796496e-02   +1.719968004980988e-01; +2.473220764488582e-01   +3.612306381476667e-01   +1.016008364472425e-01   +1.959864027393741e-01   +1.968102484228668e-01   +7.302911991624015e-01   +5.906387821043462e-01   +2.297953426916301e-01; +5.090530556388200e-01   +1.842414068490966e-01   +8.082752463657172e-01   +1.595704004741213e-02   +3.645030022120525e-01   +6.219970848017203e-01   +2.797804343322590e-01   +3.911807408713768e-01; +4.294376940762458e-01   +2.564009960281298e-01   +5.751649245188150e-01   +2.970860820109182e-01   +4.213908372857229e-02   +5.425395202987028e-01   +3.258494645872589e-01   +6.539268817821671e-03; +2.874630421874225e-01   +7.512357250771354e-01   +4.872009585669194e-01   +9.308867734323664e-02   +4.675201533495105e-01   +2.617176308230958e-01   +5.744926847591483e-01   +1.521812036388845e-01; +7.764331167552463e-02   +4.248598028749441e-01   +6.541424851776773e-01   +2.849431270459202e-01   +6.185626894837919e-01   +1.648701870896471e-01   +1.603339495900766e-01   +3.982388823508917e-01; +5.292432404756988e-01   +4.158154995169390e-02   +4.455384762961010e-01   +7.923064779040081e-01   +3.717852127922061e-01   +5.393856491556708e-02   +1.690820474644558e-01   +3.885631904464396e-01; +6.361357532538917e-01   +4.604703197789090e-03   +6.850801610935428e-02   +7.235972138419323e-01   +2.997428284099140e-01   +5.952009447409528e-01   +9.677669766250620e-02   +2.189078679558025e-01];
L1I_L2I_iGABA_netcon = [+7.730371710134115e-01   +7.334911650047765e-01   +5.927663166724682e-01   +1.177954006481522e-01   +1.027440884599687e-01   +7.406337204846866e-01   +1.057641900946150e-01   +1.961201828046479e-01   +1.255844232123897e-01   +2.656812942685332e-01   +5.988244613528377e-01   +4.012350572485425e-01   +2.635159023208319e-01   +5.066723134242276e-01   +7.182112122751071e-01   +7.254348690995038e-01; +4.152147063730953e-01   +7.441413178181425e-01   +2.886546104909481e-01   +2.805069905983925e-01   +7.236490384906246e-01   +7.671345784153202e-01   +3.920084337981414e-01   +1.314560588359181e-01   +3.808639487033000e-01   +7.200944826250357e-01   +5.011001564276839e-01   +7.481426415148764e-01   +4.519492864939147e-01   +3.169792155140123e-01   +2.126906795827763e-01   +4.376323102380738e-01; +3.274219158316309e-01   +3.824921146926001e-01   +3.550786624390312e-01   +4.722993648446691e-01   +2.613312900715224e-01   +5.959141227244420e-01   +2.242070674271316e-02   +6.541101586026599e-01   +6.237913419281318e-01   +4.320085840271775e-01   +1.363048528934665e-01   +6.642477100140265e-01   +2.854570332592554e-01   +4.758809031251684e-01   +3.587332571892536e-01   +1.429717399362055e-01; +6.796494263172069e-01   +3.049607056805848e-01   +4.423633127776955e-02   +2.983879209590647e-01   +4.889513611461369e-01   +2.459952240685720e-01   +1.982137350447023e-01   +2.523528766935928e-01   +7.937348359713479e-01   +1.183014095659942e-02   +2.650012273480290e-01   +1.364437270584081e-01   +8.027089673428828e-01   +5.091058166315483e-01   +9.365176617361234e-02   +5.158979254305991e-01; +7.746325925598313e-01   +7.399543715511190e-01   +3.443400570200615e-01   +3.108958702546219e-01   +2.137564353359962e-01   +9.422764082765420e-03   +1.394162056836101e-01   +4.021041830169113e-01   +6.659013699605951e-01   +5.346882017440899e-02   +7.889517124443963e-01   +4.124981623129831e-01   +3.325487280913698e-01   +6.214390140396003e-01   +2.446077455856643e-01   +4.385092660259859e-01; +7.996386708769003e-01   +3.891548616623715e-01   +1.659964710215436e-01   +5.002646524071892e-01   +4.858015092596152e-01   +2.323418974952484e-01   +6.393183677265151e-01   +7.398107115591644e-01   +3.900082517909026e-01   +6.424885413354646e-01   +7.259475267529358e-01   +3.648650384352294e-01   +5.601299386556319e-02   +3.996253730298693e-01   +4.060598831409251e-01   +3.014103391938077e-01; +3.672871647805912e-01   +1.097027799493301e-01   +4.398247700638768e-01   +4.058803190426064e-01   +6.367216136318482e-02   +7.636381613937795e-01   +3.763323082917079e-01   +8.156922148271409e-02   +5.578007315661130e-02   +9.221330539986944e-02   +5.795081657036474e-01   +4.042114068746688e-01   +1.363617131572479e-01   +1.950526412748874e-01   +2.484813593344576e-01   +2.316453732613026e-01; +2.665931602708622e-01   +1.698833866657509e-02   +4.971458260392383e-01   +5.114073880076079e-01   +5.724708408534358e-01   +1.859703690707976e-01   +3.801900500849183e-01   +1.482911141287828e-01   +6.323041854791511e-01   +6.232840706124365e-01   +6.137589552989285e-01   +3.536614073772635e-01   +7.906673443243924e-02   +2.247826692719380e-01   +3.697397741865606e-01   +5.779307223819568e-01];
L2E_L1E_iAMPA_netcon = [+6.268223940355564e-01   +4.237359545933803e-01   +5.869491695908133e-01   +2.655468044899588e-02   +1.023568745307629e-01   +4.151346155252961e-01   +2.701890890401745e-01   +2.135676339351610e-01; +1.615861058673741e-02   +5.519161287814928e-01   +5.254145675921326e-01   +5.554352626098917e-01   +8.051878021535961e-01   +5.484086845775016e-01   +6.423079443842955e-01   +7.904159363445350e-01; +2.667176180917386e-01   +5.151284911341569e-01   +2.299138547242464e-01   +5.450141390740484e-01   +4.157290302296682e-01   +6.183650102900885e-02   +4.696033743018172e-01   +5.679957286692894e-01; +1.730033181651842e-01   +6.833189621094043e-01   +5.598651591926574e-01   +3.870274784957971e-01   +3.436743485624005e-01   +1.002227293970520e-01   +2.264739908768877e-02   +3.209304785843348e-02; +7.700479236340642e-01   +2.551947389412860e-01   +1.749748935688334e-02   +7.649209010630227e-01   +7.982764367432281e-01   +1.871446352401369e-01   +4.445679445457394e-02   +4.922089876970620e-01; +6.648005225260021e-01   +6.170842635521695e-01   +3.982310502615467e-02   +3.603730990767071e-01   +3.916724835114220e-01   +5.948928261150265e-01   +4.320227652555583e-01   +2.328142445752150e-01; +1.764040399691355e-01   +5.928170845767826e-01   +1.246389144288826e-01   +2.901407749179926e-01   +2.861396459487883e-01   +3.684194991258181e-01   +4.933599629788426e-01   +6.372317979329056e-01; +6.409273616182841e-01   +5.041004337212274e-02   +6.311850024659230e-01   +6.198851599630162e-01   +3.520815910225028e-01   +4.106174969220225e-01   +3.355480599652479e-01   +4.717122323956435e-01; +1.186807398648943e-01   +3.145332599284253e-01   +4.723985355499464e-01   +4.398876041789994e-01   +5.589728124221577e-01   +4.295937792516722e-01   +6.879182673666711e-01   +4.408133735883982e-01; +4.888604919003793e-01   +4.150719993603230e-01   +6.709469928394117e-01   +1.659888273792874e-01   +6.193741945416542e-01   +4.226473295063395e-01   +6.202369288420074e-01   +2.746930936718792e-01; +7.474218000977925e-02   +3.938626565860514e-01   +4.292070681270061e-01   +7.878394749312893e-01   +1.222072964758159e-01   +3.663528995540623e-01   +6.790848943788121e-01   +7.419093040181093e-01; +5.939428742624711e-01   +7.237347825130263e-01   +3.752449273519958e-01   +5.894068760548697e-01   +2.543211426681560e-01   +3.889740966585787e-02   +3.470949139378235e-01   +4.124820998664626e-01; +5.222330154065306e-02   +5.476853612519250e-01   +1.587225014714930e-01   +4.510960356215194e-01   +1.180847687147579e-01   +7.263450315048293e-02   +3.553276216937379e-01   +2.380072066606115e-01; +3.734132932702730e-01   +2.017723842714798e-01   +6.872794879439255e-01   +2.825255510130348e-01   +4.194745320668846e-02   +9.666066351992303e-02   +4.760177318889786e-01   +2.800530360571453e-01; +5.551979987196437e-01   +4.761059710991064e-01   +7.580723677534127e-01   +5.378512222611763e-01   +5.882487738662046e-01   +3.772946363844307e-01   +5.386543963548725e-02   +9.891160644912091e-02; +1.656048927066171e-01   +5.101859341505269e-01   +5.458815670479246e-01   +3.435793062221063e-01   +4.707883226173261e-01   +8.057311542879124e-01   +8.003934835733411e-01   +4.758440230231475e-01];
L1E_L2E_iAMPA_netcon = [+7.450760495216253e-01   +6.705804211657329e-01   +4.440845613789736e-01   +1.490288335655526e-01   +4.318013361662030e-01   +6.699602495094158e-01   +3.288745725206039e-01   +3.990363260787486e-01   +6.487127174760302e-01   +7.828572783898887e-01   +7.021815071785950e-01   +7.243149626769371e-02   +7.188090988098136e-01   +6.678923743382439e-02   +1.741646387529011e-01   +3.143445064932029e-01; +5.496459016252088e-01   +2.232087662569703e-01   +2.252675524395439e-01   +2.488057035623781e-01   +7.948348195610474e-01   +1.809443788331080e-01   +3.603457258528772e-01   +7.595669644771281e-01   +4.986751666006978e-01   +5.993072437165009e-01   +1.706358768642381e-01   +3.395144282953521e-01   +4.641953173380393e-01   +7.511609463843991e-01   +3.855504968586964e-01   +8.750357780550949e-03; +6.115513692280620e-01   +1.771459598215090e-01   +5.076028896365708e-02   +2.715877801913101e-01   +3.596728094972573e-01   +1.288188065368298e-01   +7.315045930639114e-01   +2.395462118248353e-01   +4.497260313989610e-01   +1.301599284293523e-01   +4.181663645406045e-02   +1.729532584075032e-01   +7.056207064136039e-01   +4.046936068256261e-01   +3.536798120994765e-01   +5.700527761591410e-01; +2.042214177682109e-01   +1.326514789251369e-01   +1.969483162108715e-02   +8.067009611227073e-01   +4.392884159786059e-01   +7.676295797946064e-01   +7.546000888793587e-01   +5.081771573076378e-01   +3.216801923043025e-01   +5.576163632461698e-02   +6.412492101730396e-01   +3.240230396130178e-01   +3.425520352852402e-02   +2.173052402809503e-01   +6.950995675884656e-01   +3.227924821658413e-01; +7.777489712704015e-01   +2.748356299696022e-01   +1.154553108408184e-01   +6.272340634880257e-01   +2.273718459475092e-02   +3.349519330389915e-01   +1.419775528572972e-01   +3.148951708285848e-01   +2.888475112988250e-01   +1.749417513333945e-01   +1.050476642729205e-01   +7.118922193849324e-01   +2.737368216850060e-02   +9.610003704762284e-02   +6.541364600772379e-01   +4.937933070200496e-01; +7.832059467248570e-01   +3.582492035611354e-01   +7.695162707450101e-01   +2.113019897599608e-01   +2.573835905534986e-01   +2.482149365262301e-01   +3.306263633096432e-02   +2.232683484551097e-01   +1.641433138566321e-01   +1.253188259625571e-01   +1.244420951426607e-01   +5.606114748937031e-01   +7.664750912473058e-01   +5.269902221027424e-01   +7.180397802298709e-02   +8.091783318000660e-01; +3.691626312871508e-01   +7.338422594891071e-02   +2.155398175584953e-01   +7.484021626270388e-01   +1.762615771494737e-01   +3.410648403385553e-01   +7.891342169586001e-01   +5.138369422860382e-01   +5.025686270043019e-01   +8.687057590377799e-02   +2.002911673954380e-02   +3.048449704547113e-01   +6.787817983700464e-02   +6.150542541137739e-01   +3.390246270019343e-01   +4.465386751030718e-01; +6.741039764481571e-01   +2.313264027088548e-01   +7.029702821167545e-01   +5.390827771822391e-01   +4.383778968193342e-01   +4.018551717398084e-01   +1.178257496411722e-01   +2.176825518837525e-01   +1.501723923883001e-01   +3.467996792562987e-01   +7.060429464439542e-01   +7.879478767578384e-01   +6.363254753134019e-01   +2.753542736590370e-01   +2.312382654594193e-02   +3.322685838411545e-01];
L2I_L2E_iAMPA_netcon = [+5.102805061453013e-01   +6.550781751859700e-01   +7.551036717136871e-01   +6.289156072893666e-02   +2.389921351183183e-01   +1.716460499148965e-01   +8.079474302582412e-01   +8.059088430279302e-01; +4.132905690948833e-01   +2.110338042170123e-01   +2.971998938156525e-01   +8.124335642788419e-02   +2.761388479928747e-01   +1.077676228785819e-01   +6.412047271250120e-01   +1.644075904903139e-01; +7.173533241035118e-01   +2.866004114573834e-01   +1.538789696913725e-01   +3.819610214622403e-02   +1.239463716861823e-01   +1.732054434165173e-01   +7.603327061730124e-01   +6.543511542708206e-01; +1.534188354448318e-01   +2.068974374022590e-02   +1.887428771823785e-01   +7.690242525146481e-01   +5.384666062980759e-02   +2.867396731461774e-01   +2.360462851523811e-01   +3.026029020441817e-01; +1.132872758486326e-01   +6.200876164404988e-01   +1.694727347140626e-01   +5.363323361206520e-01   +5.528661458277653e-01   +3.818803910476313e-01   +7.262836208693730e-01   +4.595410435106527e-01; +9.519831727855352e-02   +4.098776203626476e-01   +4.734367838468559e-01   +2.881218102828518e-01   +4.293625656680084e-01   +2.914467481345483e-01   +8.627728017636513e-03   +3.711933909919874e-01; +2.620135067512148e-01   +5.761376719869702e-01   +4.178734186900851e-01   +5.072665680563830e-01   +3.201322966524051e-01   +5.157160441907354e-01   +9.735859235313216e-02   +3.282165420917001e-01; +9.467299340486818e-02   +1.513173665524357e-01   +1.210712701135529e-01   +2.597649443877086e-01   +4.595861753585300e-01   +6.556860271876780e-01   +2.512813257526600e-01   +2.771711980618515e-01];
L2E_L2I_iGABA_netcon = [+5.403072687663099e-01   +1.433465197708171e-02   +1.443528328208182e-01   +5.401332207870878e-01   +1.096748163916631e-02   +3.690774682646599e-02   +4.503414492387043e-01   +2.770675706209650e-01; +7.606510557003643e-01   +1.186115550506887e-01   +2.186005188466970e-01   +3.127671521414276e-01   +6.246155500477584e-01   +5.817646654580473e-01   +3.506459916584987e-01   +8.025318572859736e-01; +4.538009716730623e-01   +8.593702560954392e-02   +3.150114308537832e-01   +6.572471690763279e-01   +4.376480370945017e-01   +4.766244738380205e-01   +7.008764848781847e-01   +3.925807490393405e-01; +2.584927517271065e-01   +4.107337695634422e-01   +5.315842879792875e-01   +1.988701683689942e-01   +1.099162570739169e-02   +5.573796473674425e-02   +4.513338239419135e-01   +7.051007930079012e-01; +5.683493613741897e-01   +5.741496136884197e-01   +3.409703918549269e-01   +6.002868052947542e-01   +4.081223903822218e-01   +5.635816638199910e-02   +6.870973141139363e-01   +3.122711584138338e-01; +7.618977436994177e-01   +8.155989313999332e-02   +6.124276481206476e-01   +1.806716455823032e-01   +7.068597949636434e-01   +4.258732842994802e-01   +6.289079964906231e-01   +4.404858924008934e-01; +2.057768972660224e-01   +1.891000853936565e-01   +6.214788527234140e-01   +6.491770850122488e-01   +2.795871714882508e-01   +2.679977482429305e-01   +1.653102901458567e-01   +5.831767956193449e-01; +2.035093750074478e-01   +1.259876924095951e-01   +2.222072024324777e-01   +2.194093293816191e-01   +5.757126401491434e-01   +2.882433737781562e-01   +7.775455897858526e-01   +5.223178515849048e-01];
L3E_L2E_iAMPA_netcon = [+4.813415037221512e-01   +4.452824486506596e-01   +5.370858758362971e-01   +4.711613291053641e-01   +3.753030244121757e-01   +7.182871947465687e-01   +7.897761807550143e-01   +1.405935899122502e-01   +1.548026518811843e-01   +7.904226556261448e-02   +4.633732425562952e-02   +2.637677986222858e-01; +5.511101205401098e-01   +6.758103236358820e-01   +5.056694392618213e-01   +5.108467949158647e-01   +3.787099829254758e-01   +1.596414112530898e-01   +7.528183920421686e-01   +3.812328908545958e-01   +3.278406404012053e-02   +7.063210498772939e-01   +6.137710600923958e-02   +2.020967491308838e-01; +4.174847484967898e-01   +4.802795543293861e-01   +4.281741697597647e-02   +5.237497665744574e-01   +3.593983093545157e-01   +2.797128282441914e-01   +6.245285018759837e-01   +1.200301563124481e-01   +4.095841733960640e-01   +1.393730033974026e-01   +2.826635375453700e-01   +5.806665646514495e-01; +5.924508878965912e-01   +7.709126026838808e-01   +3.222363067625734e-01   +2.786395071147582e-01   +7.050988093902018e-01   +3.420989579912924e-01   +4.447429282576857e-01   +5.158986664598342e-01   +1.745493680346143e-01   +1.369930370844068e-01   +5.786748042283695e-01   +4.604081113021426e-01; +5.715054019167822e-01   +2.101684782829367e-01   +4.621291221524971e-01   +6.545122284616364e-01   +3.305556707227942e-01   +1.938436347247797e-01   +8.071848651761934e-01   +2.219841389978459e-01   +8.408705531358225e-02   +3.313102094206609e-01   +7.465996953648384e-02   +6.527496288989036e-01; +4.793601320229323e-01   +4.625809314554418e-01   +5.700034622543790e-01   +8.015505809010263e-01   +6.139164367494159e-01   +6.839306322170613e-01   +2.342981887291679e-01   +6.427140058851735e-01   +4.635386177709525e-01   +4.876945033255874e-01   +6.774406178688489e-01   +5.264568908964515e-01; +1.438084137773173e-01   +7.562820612852335e-02   +4.088397593407369e-01   +1.328509858339603e-01   +3.030284108807202e-01   +2.715867943244835e-01   +6.565035199705461e-01   +2.987238233379905e-01   +2.768049989942262e-01   +7.795246052306360e-01   +3.875102349315860e-01   +5.487977137850101e-01; +1.191816821964826e-01   +3.417475126734513e-01   +6.218938116746279e-01   +4.270164315503533e-01   +7.200519141881579e-01   +4.445127940415929e-01   +6.541835655102554e-02   +2.456918721196527e-01   +2.959920793256721e-01   +6.386215133854586e-01   +7.439996534393939e-01   +2.889826111099986e-01];
L3I_L2I_iGABA_netcon = [+1.107164168568369e-01   +6.066132477185439e-01   +4.902377816895432e-01   +2.343696399942179e-01   +3.306879490555528e-01   +6.462704855018424e-01   +3.601561195756672e-01   +6.860973087440204e-01   +4.664075044304637e-01   +2.282050127185509e-01   +2.313029391704617e-01   +3.576691595306435e-01; +5.909663116189065e-02   +2.750918178682134e-01   +7.679510899021347e-01   +1.753846026524953e-01   +6.642304301920771e-01   +6.715393965357708e-01   +3.631157522137698e-01   +3.163855641172831e-01   +3.810504159269492e-01   +5.469471324704470e-01   +6.779993974572731e-01   +5.283486031425156e-01; +6.434585198658358e-01   +5.226450259978822e-01   +5.346972400366993e-01   +4.943906291937826e-01   +2.371794333949728e-01   +6.378103508347115e-02   +5.850808108251233e-01   +8.105669992743632e-01   +5.420255553436167e-01   +4.533876238540099e-01   +7.072243706178302e-01   +6.734668324655698e-01; +6.324442603323686e-02   +7.644605571400753e-01   +8.876803374688793e-03   +7.573666776057142e-01   +4.712631847184569e-02   +3.505284487252160e-01   +2.727635900520266e-01   +7.546859277093666e-01   +2.737741151534567e-01   +7.623574578772493e-02   +7.259435964535188e-01   +1.323340546129307e-01; +1.459662926467201e-01   +6.317945841658386e-01   +4.496094107941501e-01   +2.510439653962710e-01   +5.196822258340897e-01   +1.321568345134583e-01   +7.191694800751521e-01   +7.327167347161552e-01   +6.333633551070238e-01   +5.359948387232160e-01   +8.077116644165403e-01   +2.630750518752077e-01; +1.595443865632161e-01   +4.346480363631592e-01   +2.454640968156989e-01   +5.548563295691590e-01   +4.083018475763298e-01   +7.599662401699127e-01   +2.371486018606116e-01   +7.229244182445480e-02   +7.365430566929163e-01   +4.437584603774805e-01   +3.409674400445241e-01   +7.437631388846941e-01; +9.334173806229229e-02   +4.203881326046066e-02   +1.520330730783502e-01   +4.794801441526760e-01   +1.988534571261437e-01   +6.259019331671554e-01   +1.757893671675990e-01   +3.789719444599376e-01   +6.051310360066460e-01   +1.720314516670342e-01   +1.042561984612067e-01   +2.487717572969637e-01; +3.968072053450911e-01   +2.397431939064121e-01   +6.330102425531512e-01   +7.596289386701073e-01   +7.294827302102472e-01   +5.764537290058530e-01   +6.408489464520232e-01   +7.986585475571792e-01   +7.432708801236191e-01   +3.108720934517893e-01   +6.962104050606861e-01   +2.083758140133699e-01];
L2E_L3E_iAMPA_netcon = [+2.250862957147280e-01   +5.526047227486233e-01   +7.154085557284448e-01   +6.627259853320120e-01   +7.324787525076247e-02   +4.460243874472342e-01   +2.820327632217322e-01   +4.430727513979968e-01; +7.855206247396215e-01   +5.916821003399182e-01   +6.742820712624489e-01   +5.391948477256823e-01   +6.117694824764767e-03   +3.308246061455726e-01   +2.370323123898851e-01   +8.872834372118281e-02; +7.803307958788285e-01   +2.479643977244260e-01   +7.896348432475120e-02   +6.158547968279258e-01   +1.442373912559370e-01   +1.153376296328412e-01   +7.331366380977123e-01   +8.081843066161827e-02; +1.948319024400590e-01   +5.950098494652681e-01   +2.808741578836961e-01   +4.222326841429366e-01   +3.362552593195428e-01   +4.079308817949016e-01   +3.878945562018923e-01   +7.267631984585564e-01; +5.152333619100211e-01   +6.506882974152143e-01   +2.118566961066340e-01   +2.247030995947436e-01   +6.709710357740298e-01   +2.122862017966587e-01   +5.492288034512278e-01   +4.098077827185098e-01; +4.354249416630330e-01   +7.561717497925148e-01   +5.160398192545668e-01   +1.335999069492255e-01   +4.575272238940024e-01   +2.446654153810092e-01   +5.676537018487897e-01   +5.242331339561611e-01; +1.372718798916738e-01   +9.801023998053628e-02   +1.483758699528938e-01   +3.405139973339404e-01   +1.414959352559009e-01   +7.786469683736510e-01   +4.681952148446404e-01   +8.065353343930574e-01; +4.777033336044227e-01   +6.169351018193251e-01   +6.451987259287233e-01   +2.321691551370731e-01   +1.769483430066658e-01   +7.319973563635802e-01   +4.157198323632050e-01   +3.215359646027289e-01; +3.452423082323160e-01   +4.015756360762090e-01   +7.518525526210561e-01   +3.019934239726715e-01   +5.752024373446692e-01   +6.615672082891323e-01   +5.845622855535143e-01   +4.054313021936480e-01; +7.351097984330183e-01   +4.152500017400839e-01   +6.608359335305600e-01   +5.303906975932174e-01   +3.949468446010076e-01   +3.837755762149398e-01   +3.623178784228356e-01   +4.589192710944564e-01; +5.075601441584057e-01   +2.798115253980656e-01   +9.342247827735180e-02   +6.498027968815292e-01   +6.184611929973992e-01   +6.022168789179334e-01   +1.277807092177393e-01   +3.657944539970114e-01; +7.152041929338847e-01   +3.459137232383351e-01   +1.914770098878054e-01   +2.420136712408840e-01   +4.133860015922378e-01   +7.137960440151513e-01   +4.175590540656118e-02   +4.843871570713646e-01];
L2I_L3I_iGABA_netcon = [+1.524857740680344e-01   +2.875060304626132e-01   +4.840592039223259e-01   +3.453924243810938e-01   +5.864079022081296e-01   +5.597571940091826e-01   +1.481618290620885e-01   +7.087702968194054e-02; +1.610926840667379e-01   +3.275687068262284e-01   +6.551671301707420e-01   +7.278166985520514e-01   +3.295875999688894e-01   +5.048199888085809e-01   +2.289899433926652e-01   +7.406787802801973e-01; +5.546818302585557e-01   +6.643736040326583e-01   +4.404187368667949e-01   +5.132702365277246e-01   +4.642994383633401e-01   +6.264909808233657e-01   +4.652530630369690e-01   +2.505944289306300e-02; +6.241659727321632e-01   +1.690451439378109e-01   +5.603794991175061e-01   +6.731097400876443e-01   +3.430295325719000e-01   +1.193236832644931e-01   +8.019034412063375e-01   +4.769659138187295e-01; +4.428736984034165e-01   +1.025419479721660e-01   +5.692693113782068e-01   +3.683748503970443e-01   +2.676813943209962e-01   +5.080712495337284e-01   +3.410561452362311e-01   +2.460790866882576e-01; +5.182305722744478e-01   +7.195726160125693e-01   +3.980256117376708e-01   +1.109763805241638e-01   +7.225629349238047e-01   +2.695076754806887e-01   +7.435651715211834e-02   +7.635889043872663e-01; +8.100995992982326e-01   +1.367624806518545e-01   +3.096054277454359e-01   +3.356556648558142e-01   +3.089217553719492e-01   +4.779121179778654e-01   +4.309326243750427e-01   +8.093230481763940e-01; +4.362517211295025e-01   +1.296566850158625e-01   +1.321576208972011e-01   +6.119531064805974e-01   +2.388269844052608e-01   +4.097434689747554e-01   +2.220526805460700e-01   +2.484985015039425e-01; +6.895320567037887e-01   +1.243450081137347e-01   +4.442623409542482e-01   +1.185731666624089e-01   +4.889697750762272e-01   +6.233582185307980e-01   +4.828149381171705e-01   +4.076382576314567e-01; +7.426908658593145e-01   +6.791015862018220e-01   +3.168449423961506e-01   +4.935722428862154e-01   +2.173447080632217e-02   +5.158249794617209e-01   +2.751871931130996e-01   +3.493148898525230e-01; +4.111676623255799e-01   +4.740265639417027e-01   +4.445214322264162e-01   +5.565938394570550e-01   +3.496976884220863e-01   +2.265639940765561e-01   +6.235310634679912e-02   +1.220200016806642e-01; +2.466890510333028e-01   +5.135245049248459e-02   +3.691183565903427e-01   +3.694999560449421e-01   +5.222824294487033e-01   +6.050240195986264e-01   +6.897203851786722e-01   +3.643596921889504e-01];
L3I_L3E_iAMPA_netcon = [+6.587946643004533e-01   +2.845520733290691e-01   +5.773239627236707e-01   +1.267426717766442e-01   +7.699242586524604e-02   +6.101609227503374e-01   +3.727193907590415e-01   +1.796142583280245e-01   +2.873815369102185e-01   +1.917024412811936e-01   +7.985940538959055e-02   +5.077344491213892e-01; +6.733322089994328e-01   +5.535474165522440e-01   +7.153847366270372e-01   +1.044927800389245e-01   +4.854638424343508e-01   +2.364501099143849e-01   +3.777004527774216e-01   +1.899381771413964e-01   +5.134312345153720e-01   +7.548326401338760e-02   +3.405053426309343e-01   +6.738461150011614e-01; +2.634484349569329e-01   +2.325442183488867e-01   +2.065863877965807e-01   +6.489142402848618e-01   +6.141904302960285e-01   +7.082331466035239e-01   +2.987525344821259e-01   +7.096971931437620e-01   +7.964498341060153e-01   +1.505387820742359e-01   +1.601088212407147e-03   +5.195706656152688e-01; +1.709306358242015e-02   +4.929382023421246e-01   +1.353030739849568e-01   +7.092474244039552e-01   +6.943305253574428e-01   +1.138858826940074e-01   +6.851708120642189e-01   +2.787072707965845e-02   +5.086830210810526e-01   +2.421385111242785e-01   +3.673338964631326e-03   +6.236291186797445e-01; +1.254896998532030e-01   +5.175030656056318e-01   +4.034476829332449e-01   +7.279595486348444e-01   +6.670670796963014e-02   +1.903717702897623e-01   +1.652795731124269e-01   +1.256006775565010e-01   +2.620747219067629e-01   +2.529520410231381e-01   +3.971031997380814e-03   +3.005506536964471e-01; +6.295178664711478e-01   +2.075153537241873e-01   +1.235462039484561e-01   +3.815466734918145e-01   +2.710515213755895e-01   +4.526468325581174e-01   +2.755641052595017e-01   +5.011737422909426e-01   +1.070561563498552e-01   +6.100955975471208e-01   +1.047131122221186e-01   +1.259671235464941e-01; +6.655009901379967e-01   +7.874635199462019e-01   +4.981725151853711e-01   +5.785998206446862e-02   +3.906938530869228e-01   +6.925693596451468e-01   +4.048412716633270e-01   +6.228205887166044e-01   +2.863319099683488e-01   +4.573047336886988e-01   +4.277682986552848e-03   +3.837249385145802e-01; +3.053053600140053e-01   +4.275543808245092e-01   +4.466414627505501e-01   +1.900906171701130e-01   +6.340460968352086e-01   +6.598208151056528e-01   +6.465632035843987e-01   +6.976493572432153e-01   +5.346413856011164e-01   +2.564194368253029e-01   +7.179002647765989e-01   +3.709739745858272e-01; +1.009397826208788e-01   +1.293344211276547e-01   +7.842216707594515e-01   +5.306677033710017e-02   +5.386711015264106e-01   +2.992167587903651e-01   +6.953352950735922e-01   +4.307585666935204e-01   +6.777603141933051e-01   +6.446973959895861e-01   +3.486018882912060e-01   +5.781411027991854e-01; +7.176722159946367e-01   +1.736844114794412e-02   +1.096970153852399e-01   +8.440167734798777e-02   +2.003369448830278e-01   +7.886756440910720e-01   +7.424748967480714e-01   +2.870519230760303e-01   +6.520300418418857e-01   +5.090315636516252e-01   +2.519148103774246e-01   +4.195955819281312e-01; +1.166481551305792e-02   +7.056104213447221e-01   +6.861532037869682e-01   +5.971384142162478e-01   +7.694822717498609e-01   +4.655970892410452e-01   +5.930830027848440e-02   +6.790000448478000e-01   +5.753432256019515e-01   +2.675000834909367e-01   +5.968095023826697e-01   +6.901749309366385e-01; +3.110740106233661e-01   +3.276314490047654e-01   +2.089318101978196e-01   +4.533936820005779e-01   +2.520447683294363e-01   +4.798595690814227e-01   +2.790502438881273e-01   +2.400329227119118e-01   +2.800861601614305e-01   +6.944079142529864e-01   +4.761726521338494e-01   +3.293300357405214e-01];
L3E_L3I_iGABA_netcon = [+4.968005147367965e-01   +1.897969968826893e-01   +3.808786499992926e-01   +1.240680854375169e-01   +7.633744515967380e-01   +1.895016740399089e-01   +2.842529306049113e-01   +8.022469092489238e-01   +1.148722426476920e-01   +1.952441611018587e-01   +4.388850675833121e-01   +4.866869602376287e-01; +6.049547528718213e-01   +7.580057305938553e-01   +1.643902837914025e-01   +6.738019202415306e-02   +4.716593097892040e-01   +6.669319967250470e-02   +7.048992626290558e-02   +2.664120710175209e-01   +6.775623515266548e-02   +4.544280838439798e-03   +6.122003529448700e-01   +2.009916178773334e-01; +6.206117005165539e-01   +6.985443693039477e-01   +7.203453867560480e-01   +2.919048599388963e-01   +4.032518864435264e-01   +2.076181450587715e-01   +1.014429026540749e-01   +7.492341094457954e-01   +9.157220836146757e-02   +6.626612050563057e-01   +1.737231910892739e-01   +5.544453661638350e-01; +1.959056093884551e-02   +4.949702063694153e-01   +3.799521373978960e-01   +7.581098286120292e-01   +1.717058134142694e-01   +5.493104143890977e-01   +3.502704852922108e-02   +7.264384880366027e-01   +3.783304778270973e-01   +4.484656392942599e-02   +7.195544515547028e-01   +6.758550078223526e-01; +6.102968525206341e-01   +3.289393363663131e-01   +1.591477114887819e-01   +4.536497617995342e-01   +6.078046447736041e-01   +1.274146734062583e-01   +1.303120170652558e-01   +4.920510386251180e-01   +1.401373792344154e-01   +4.713467669140158e-01   +8.739007660529073e-02   +4.000410073547344e-01; +6.306670588847260e-01   +4.483128572955601e-01   +1.565176779304464e-01   +1.832481425022046e-01   +2.448011408020854e-01   +1.915607686207758e-01   +5.281171126919567e-01   +5.714560755829394e-01   +1.841160999689075e-01   +6.145960771047715e-01   +4.314987049986408e-01   +1.256897835751791e-01; +3.835121147121509e-01   +1.168715815312161e-01   +5.190532865507788e-01   +5.385001060288248e-01   +6.615217237152415e-01   +4.326948576838561e-01   +5.772967471102799e-01   +3.814625621980270e-01   +2.027025658999250e-01   +5.999159518358620e-01   +5.632991006261381e-01   +4.336418041914492e-01; +6.345318333804209e-01   +3.368231859787268e-01   +2.271873974982841e-02   +3.532492321565250e-01   +2.501825567147693e-01   +7.733583803088813e-01   +3.103451081743064e-01   +3.885685182764071e-01   +5.112124790572449e-01   +3.705508660987045e-01   +4.024094928314548e-01   +2.821746506401647e-01; +5.141803627943387e-01   +1.039126035797775e-01   +4.333673248502922e-01   +3.975082311781215e-01   +3.477607710024179e-01   +7.435382108780993e-01   +3.466297186997813e-02   +7.009852600817651e-01   +5.778222863089340e-01   +6.676860885485023e-01   +1.174919447353913e-01   +3.704965680258663e-01; +2.479245331698020e-01   +4.752269646472332e-01   +5.524351599522193e-01   +5.765667787211518e-02   +3.828253441183946e-01   +5.652466882849292e-01   +4.090733163393058e-01   +1.696293319718118e-01   +7.148809488240849e-01   +6.159500901425978e-02   +3.535621694657968e-01   +6.041331250415877e-01; +3.170919687247308e-01   +1.551834228522250e-01   +8.895992457435287e-02   +6.307014790818771e-02   +4.143430749270435e-01   +6.971672729843729e-02   +4.858382308319723e-01   +5.650511487408332e-01   +5.918793764239384e-01   +4.610882039465680e-01   +2.261570396530750e-01   +7.654887675792333e-01; +6.548297370848766e-01   +1.351966610132194e-01   +5.736909195289289e-01   +1.318694347038247e-01   +3.333646031977464e-01   +7.963212502226469e-01   +5.315678602230490e-01   +8.085177681780210e-01   +6.509822362051062e-01   +5.688244573379362e-01   +5.199587847610408e-02   +2.869958418738708e-04];
L2E_Input1_iAMPA_netcon = [+4.237694928164822e-01   +5.799225972734030e-01   +1.883883950557580e-01   +7.758019871656776e-01   +1.302183617945455e-01   +7.647760832597468e-01   +6.673437515185087e-01   +8.875296715095403e-02];
L2I_Input2_iAMPA_netcon = [+2.300790070328933e-01   +2.663551088282625e-01   +4.273793834961099e-01   +6.543032161655734e-01   +7.119729440873437e-01   +6.217310368229066e-01   +1.007535008969769e-01   +1.875226982251016e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  5.6 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
