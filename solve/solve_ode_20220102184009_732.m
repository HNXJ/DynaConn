function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.317834358979330e-01   +3.674098002948840e-01   +8.520968438057323e-01   +4.241558643774778e-01   +1.084917413372974e-01   +6.523066833001999e-01   -1.204372567311870e-01   +6.632959144064164e-01   +2.682266514759225e-01   +9.688010531177951e-01   +2.638469247579905e-01   -5.360680531388556e-02   +1.731101938343946e-01   +4.834018506467652e-01   +8.697186237623361e-02   +1.012117913616398e-01; +5.297875941501677e-01   +6.338291053470012e-01   +4.695746854754906e-02   +7.894392357291806e-01   +5.162937867687430e-01   +4.413781384160142e-01   +4.312955598867425e-01   +4.386056267903561e-01   +6.580773802070448e-01   +8.600085251433522e-01   +5.597834640487914e-01   +5.348375774368589e-01   +4.340358660641375e-01   +9.506652253959920e-01   +4.775769944046017e-01   +1.833522446723173e-01; +6.962913036871743e-01   +1.501897366832636e-01   -1.202482845105622e-01   +3.119495742956983e-01   +2.600701421987106e-01   -2.851145814423371e-02   +5.953728117651020e-01   +2.738518484747564e-01   +6.255337275238581e-01   +5.254826207269095e-01   +4.453841176521841e-01   -8.505081330940698e-02   +4.830087312387966e-01   -1.315265474523190e-01   +3.758607173899296e-01   +3.624398933112881e-01; +6.217097842261156e-01   -1.815246504120267e-01   +1.742880167383616e-01   +7.011056935053300e-01   +3.040767508934586e-01   +4.600787144291724e-01   +7.034661756141888e-01   +7.345781048669985e-01   +4.770468986581103e-01   +4.625109018602272e-01   +6.888831752460134e-01   +5.493009650553710e-01   +3.065426601999026e-01   +6.256027569040422e-01   +2.900772405688073e-01   +3.870228504080727e-01; +7.477330572963523e-01   +1.398308635314815e-01   +9.060253666915832e-01   +7.873581585435591e-01   -3.716859671560177e-02   +2.211424023324230e-01   +2.951979900692674e-01   +8.125173649693772e-01   +5.271838273936437e-01   +5.085614279483944e-01   +6.484540545447054e-01   +2.470638186434462e-01   +3.970404586285965e-01   -1.751989326966742e-02   +4.433378409885610e-01   +3.382012178360078e-01; +2.186656238570986e-01   +7.091060733258111e-01   +4.572928857869324e-01   +2.348909681729750e-01   +9.491863296901790e-01   +1.538932643833429e-01   +8.889379481702353e-01   +1.914419959668388e-01   +3.839143894191411e-01   -1.934670551464106e-02   +1.374725269762032e-01   +5.603132248915593e-01   +8.174325652308989e-01   +2.542447347515496e-01   +2.294536970306135e-01   +9.976715862335117e-02; +6.002527643282609e-01   +7.371727738468739e-01   +3.650301294831672e-01   +3.409192667616519e-01   +1.204469971739285e-01   +1.913500456497695e-01   +4.908308144928251e-02   -1.361026399127361e-01   +8.282882469456407e-01   +4.722152421590782e-01   +3.635250975137285e-01   +6.523596892725917e-01   +3.644420870513008e-01   +2.613118385255931e-01   +8.304833716413824e-01   +3.762761933339859e-01; +5.150843957249881e-01   +6.565272267001316e-01   +1.704203439425082e-01   +8.119321419770291e-01   -2.116658946502397e-01   -5.402432044147540e-02   +5.992724180018154e-01   +6.361115124142517e-01   +4.244298865467867e-01   +6.326768918489017e-01   +2.481228997554258e-01   +5.627050923316426e-01   +6.237173165963567e-01   +5.870416158259739e-01   +8.825268559908828e-01   +5.422442773343764e-01; +1.874216049398815e-01   +5.612426009092010e-01   +1.462392163595215e-01   +4.972042789137532e-01   +3.753751633701592e-01   +7.647129073034989e-01   +7.456309341766318e-01   +1.355482371424722e-02   +3.007803070955133e-01   +5.894847246934687e-01   +7.641378486095491e-01   -5.790678141660310e-02   +5.611362947888504e-01   +6.216856842316335e-01   +6.846616044272080e-02   +5.989451443660042e-02; -5.046286585687381e-02   +4.246802943900553e-01   +8.778280870782058e-01   +9.031822879278670e-01   +6.312269258488525e-01   +7.774912817661245e-02   +7.302655596829964e-01   +5.422081082867467e-01   +1.775086973006121e-01   +2.922616767354199e-01   -1.535568333452926e-02   +7.140364501074343e-01   +9.006105985111879e-01   +1.615584931908806e-01   +5.043906749660778e-01   +5.800421225440372e-01; +2.145921423951530e-01   +5.460169013539872e-01   +6.866713568379714e-01   +4.094205878578255e-01   +6.854218127725923e-01   +6.731009759757109e-01   +5.228212083538413e-01   +5.043721912762704e-01   +5.115844270891827e-01   +3.938658226607093e-01   +6.312356888190482e-01   +4.405314975784005e-01   +2.407046586870538e-02   +6.618124612994075e-01   +3.900458528518103e-01   +6.035024088205807e-01; +8.802931901723439e-01   +4.771002017626968e-02   +3.379902845912692e-01   +1.097643908144401e-01   +2.773093313277041e-01   +4.854735421628406e-01   +3.867011733434457e-01   +3.329858521898813e-01   +7.291837805689055e-01   -8.335578918633771e-02   +2.737846604546170e-01   +7.672341969484188e-01   +2.348311349092119e-01   +6.117507468492860e-02   +1.222233072602416e-01   +5.317573196573826e-01; -5.736146274951279e-02   +4.307465964601374e-01   +6.705125132344977e-01   +5.048533313931489e-01   +8.301462997522783e-01   +5.913139263319237e-01   +4.069501158107507e-01   +4.876958985568186e-01   +8.613645026227857e-01   +3.643808384303259e-01   +4.730296993786878e-02   +2.094781162512627e-01   +3.075883887875273e-02   +2.334792211043194e-02   +4.977040511341050e-01   +3.805682883126098e-01; +2.760645210036942e-01   +5.352046216848018e-01   +4.887033885477230e-01   +4.170363797586259e-02   +2.557241481489278e-01   +6.378871662408163e-01   +4.230730552222294e-01   +5.737530339264442e-01   +8.932808261533642e-02   +3.694782734100360e-01   +3.762106983373087e-01   +5.365233956655008e-01   +9.319995899287250e-01   +4.568518112659805e-01   +8.443257991117070e-01   +4.843005697325395e-01; +6.343630885660586e-01   +1.070963624808643e-01   +2.342132208949976e-01   +6.797354956949199e-01   +4.085677289341602e-01   +4.787500616527500e-01   +5.440597601157063e-01   -3.750668676916789e-03   +1.046221018044005e-01   +5.303683577359174e-01   +3.420864829734630e-01   +7.278634662249049e-01   +7.796520171800275e-01   +7.364237340736000e-01   +7.232864049936533e-01   +2.310495214040197e-01; -7.195920547491977e-02   +4.145142917048634e-01   +7.562080444743136e-01   +4.295721142875407e-01   +6.624228890727102e-01   +8.011520814940414e-01   +1.506367929585553e-01   +9.356999779144423e-01   -1.124829245674751e-01   +6.575997320834772e-01   +4.872568295366756e-01   +3.498544309335122e-01   +8.527962789945806e-02   +6.121131729749857e-01   +7.352490906326905e-01   +4.178675382380894e-01];
L1E_L1I_iGABA_netcon = [+6.547693038863279e-01   +5.155558625181927e-01   +6.705081671267240e-01   +2.926323368517593e-01   +3.080624429430971e-01   +2.155687658691270e-01   +6.824737467033867e-01   +2.767004705876934e-01   +1.151280185103757e-01   +8.538375179076197e-03   +3.936361004129696e-01   +3.101049297501405e-01   +5.576056157084459e-01   +3.434868389871225e-02   +8.800347221622393e-04   +8.977650623515752e-01; +3.126648814279848e-01   +7.157412261862366e-02   +7.426218129428421e-01   +8.472242167453352e-02   +4.404104924300173e-01   +7.055998650549707e-01   +4.268052245432540e-01   +6.566397992524746e-01   +5.258699716010450e-01   +3.652254823537691e-01   +4.125256094719565e-01   +5.376387391572430e-02   +8.445206342799046e-01   +4.166924234514063e-01   -1.229157446824978e-01   +1.664319012434951e-02; +2.502430622208641e-01   +5.569526048696393e-01   +6.828167263350335e-01   +1.514193841355469e-01   +6.057347475328119e-01   +4.752605641491444e-01   +5.357969618779133e-01   -1.376914184226417e-02   +1.222643609590870e-01   +8.555635387341807e-01   +4.126708799806055e-01   +4.195785542039508e-01   +1.527737390887788e-01   -1.733150611146806e-02   +9.154619523051227e-02   +8.215281357692532e-01; +7.347763637866764e-01   +1.933133986215044e-01   +3.532182943219663e-01   +5.544311868323124e-01   +4.937265845943807e-03   +2.726843149568970e-01   +2.200534135197056e-01   +1.753542717103910e-03   +2.280751692908750e-01   +2.634390302773416e-01   +3.044951639289229e-01   +8.657247383876354e-01   +2.722118188554475e-01   +6.380976378373659e-01   +2.275556201387636e-01   +2.351205046657454e-02; +5.147168022518780e-01   +3.578119938888404e-01   +1.416104613750765e-01   +2.896496708029107e-01   +7.018096694405721e-01   +3.449812522508349e-01   +5.971469053647626e-01   +1.130480116459622e-01   +6.054613047455263e-01   +4.267955747296132e-02   +2.738375934846304e-01   +4.985563654530563e-01   +3.929848155008819e-01   +5.555146202383367e-02   +1.786788839111676e-01   +4.529825994863096e-01; +2.478326279561062e-01   +6.588764392079680e-01   +7.009892944460749e-01   +7.501087154559762e-02   +5.925587654816155e-01   +7.837032863973711e-02   +2.131102850520571e-01   -1.160065263130858e-02   +1.639718646619328e-01   -4.350517210737812e-02   +5.981704680447224e-01   +7.978241139860599e-01   +4.024633602415988e-01   -5.004454635263766e-02   +4.216896204280809e-01   +3.712183817081608e-01; +5.510406666481350e-01   +2.977464826958860e-01   +3.657659405955592e-01   +2.187445940213650e-01   +8.403546220806200e-02   +3.548592442387892e-01   +5.785023538700702e-01   +1.439308881728512e-01   +1.795981186458427e-01   +1.795991560573041e-01   +4.071357256850369e-01   +4.897739554443268e-01   +7.640444885208185e-01   +3.856366817252918e-01   +4.083662946820878e-01   +2.811080458863471e-01; +8.218896118438543e-01   +5.323001237453209e-01   +2.226897761546605e-01   +5.387916564334833e-01   +3.795230391178607e-01   +2.613101902338732e-01   +3.588521361428883e-01   -1.834080771631858e-02   +1.000000000000000e+00   +1.994149904911497e-01   +6.815809872373809e-01   +1.054823287040170e-01   +2.264611582657158e-01   +4.276429948037484e-01   +1.390017046820393e-01   +4.683241022825005e-01; +3.960217869573031e-01   +1.975096957854788e-01   +2.711550623225615e-01   +1.696113969795296e-02   +5.443959859178360e-01   +7.090248225174512e-01   +2.983054189923258e-01   +3.910770460378321e-01   +5.043186616920168e-01   +4.931122468385500e-01   +4.092106120467633e-01   +6.438601424070760e-01   +1.821532146209662e-01   +2.994043285589901e-01   +4.040906095462874e-01   +3.586910882231572e-01; +1.270645954855417e-01   +6.984386351389977e-01   -1.196929138473714e-02   +6.964303436108175e-01   +2.639995452950741e-01   +5.279573835108112e-01   +4.249703490004142e-01   +2.977372661452042e-01   +5.596643199778569e-01   -1.331347739602457e-01   +1.132247639844015e-01   +5.011699101192654e-01   +5.603164908464903e-01   +5.152886558003854e-01   +3.277219503732824e-01   +5.090364977536183e-01; +5.127734748512975e-01   +3.415977595762018e-01   +3.455064493070319e-01   +3.622343234685721e-01   +2.384549230276046e-01   +3.415428674991755e-01   +5.843006864731110e-01   +1.664851940072218e-01   +6.333103906781802e-01   +7.225846056375548e-02   +2.588233339534923e-01   +4.599948068103388e-01   +5.903362308573841e-01   +3.161300014014281e-01   +2.322015212555993e-01   +6.927274689535398e-02; +4.687031320927472e-01   +3.356309622500893e-01   +1.463110993853241e-01   +2.897464872987703e-02   +2.706296039559333e-01   +2.573732461822312e-01   +1.049491155509231e-01   +5.861503404908269e-01   -4.334238533081061e-02   +6.692783879934896e-01   +5.814146113666963e-01   +8.540657355388767e-01   +1.939930027470654e-01   +1.389747367664781e-01   +3.199333071023164e-01   +7.575302649962783e-01; +6.107357541549217e-01   +2.197789984172239e-01   +1.570089355109321e-01   +7.201152248023442e-01   +5.069734587903785e-02   +1.800971280369622e-01   +4.472411399362974e-01   +3.437401380573050e-01   +5.626588439927990e-02   -2.045907851206178e-02   +7.819852953777210e-01   +2.750655887578102e-01   +4.723505629705715e-02   +1.643143187938627e-01   +5.236635455738721e-01   +5.297542054367030e-01; +3.252080110345907e-01   +3.970560438253079e-01   +3.597439325510492e-01   +7.001261672164111e-01   +1.197198341180464e-01   +3.979932862362651e-01   +5.791409335207706e-01   +2.115161510443550e-01   +7.600244549144285e-01   +2.040836965391533e-01   +3.384683319925109e-01   -3.698091112670192e-02   +2.473613892254405e-01   +4.961431940518848e-02   +1.051657606083969e-01   +1.780067515548723e-01; +6.939436419821898e-01   +4.105844232921245e-01   +2.216668243625812e-01   +1.746986874243859e-01   -2.658820309069223e-02   +2.664434655205251e-01   +2.560487952916674e-01   +7.897748828255560e-01   +3.575569947149542e-01   +4.352087406949040e-01   +6.912823060900845e-01   +1.505143718045919e-01   +6.012421519773710e-02   +1.753429226953626e-01   +2.177320842729621e-01   +5.741771075806809e-01; +6.424022961568130e-01   +4.471536762843212e-01   +7.694002859340160e-01   +3.306162361642914e-01   +6.412713084273991e-01   +2.948472944504335e-01   +4.506107213474300e-01   +3.504863778543901e-01   -5.970975780594402e-02   +4.067108974230823e-01   -1.348313764334514e-01   +4.724796712927338e-01   +4.870672657043352e-01   +3.386403014797235e-01   +1.579342830190357e-02   +3.253607905981465e-01];
L2I_L1I_iGABA_netcon = [+6.355453452701298e-01   +1.717008415552932e-01   +2.608137719863625e-01   +8.528687381314073e-01   +2.667657793806734e-01   +4.186178336845874e-01   +1.191059575512736e-01   +4.841605371490958e-01; +3.795765473374328e-01   +7.341992092280256e-01   +2.752767755953741e-01   +3.286163375837917e-01   +5.445787147444647e-01   +3.102273049986152e-01   +5.772612107544011e-01   -1.510961812274633e-01; +5.165251011664188e-01   +4.301015304174738e-01   +4.399147877412506e-01   +2.603324582329820e-01   +4.207951985639277e-01   +1.414339871808310e-01   +3.493128460960797e-01   +2.380874680364808e-01; +4.547484231265170e-01   +2.145154549553382e-01   +2.014488050829506e-01   -6.192426132947011e-02   +7.509629681477178e-01   +3.629512890583861e-01   +4.242414183440514e-01   +5.382169551945389e-01; +2.436090037276349e-01   +8.918787725677270e-01   +3.131920450905621e-01   +7.957473740916218e-01   +2.932527592545022e-01   +2.920791084842925e-01   +3.841296478891187e-01   +3.186631968918859e-01; +5.758281810957477e-01   +6.641261060049204e-02   +3.585296444074709e-01   +3.219572763604110e-01   +1.178241608803242e-01   +4.649310921059378e-01   +4.694472660552719e-01   +7.901640426398076e-01; +4.694436049504493e-01   +9.720148383182264e-01   +8.332895816044161e-01   -3.527521875394087e-02   +4.340577884161871e-01   +2.140642083934202e-01   +5.462192450605574e-01   +1.937914939625668e-01; +4.204820190164751e-01   +4.656518842368670e-01   +1.884116053637442e-01   +1.884892437302491e-01   +4.010560911069257e-01   +3.655372877379173e-01   +3.034132209542699e-01   +2.024638644891829e-01; +6.420478071403131e-01   +9.054734959837419e-01   +4.878409016598369e-02   +6.555288254498972e-01   -8.301253079841774e-03   +1.772913830947011e-01   +2.777152329471939e-01   +3.963129177091120e-01; -1.338545220821950e-02   +1.420142217354928e-01   +2.422421026646667e-01   +7.432701450834061e-01   +7.767097828837426e-01   +2.917216386079093e-01   +1.132936642783823e-01   +8.110447497169354e-01; +1.856863916084322e-01   +8.126053120063015e-01   +2.663339720420472e-01   +6.442963161297564e-01   +2.958800732629807e-01   +3.164221709054818e-01   +4.810039800349131e-01   +1.331474721746367e-02; +5.419990617525275e-01   +1.998084747719922e-01   +6.949671507368712e-01   +1.328844907072587e-01   -1.073771893842378e-01   +6.854107188101944e-01   +4.051368112033353e-01   +4.553326615342039e-01; +3.113416359815034e-01   +7.298946868204375e-01   +9.548388418871433e-01   +1.261542582804556e-01   +5.165368244416860e-02   +1.514936999914352e-01   -1.082838245728722e-01   -1.872650272904228e-01; +9.135980661785707e-02   +2.720701759560640e-01   +7.952659978164245e-02   -1.698496149823264e-02   +3.640956400778987e-01   +3.200801110796222e-01   +3.564226153629118e-01   +2.495743665304631e-01; +6.812356642449900e-01   +7.258226439589066e-01   +7.999405200675828e-01   +6.885761964342009e-01   +5.533087705085544e-01   +7.264742111483291e-01   +6.081988272144686e-01   +6.759251120687081e-01; +2.536295934550828e-01   +2.772554230736320e-01   +7.089858795657213e-01   +4.509285574535790e-01   +1.178000932069634e-01   +3.700462375518948e-01   +7.441361467047778e-01   +9.170154594756605e-01];
L1I_L2I_iGABA_netcon = [+6.403305830640587e-01   +5.038499123398333e-01   +3.966958129459832e-01   +6.089236348122832e-01   +4.302375724567296e-01   +1.719510740198496e-01   +6.580301057760845e-01   +4.690561900889132e-01   +3.533550073766076e-02   +6.217088045792879e-01   +4.612893244918809e-01   +3.215929192159495e-01   +6.832655268680594e-01   +2.231610901881812e-01   +3.687175867679788e-01   +3.848478444703582e-01; +4.211644169763927e-01   +8.325424710259675e-01   +1.382256763443124e-01   +6.655293183469271e-02   +3.117871677159807e-01   +5.818332706276177e-01   +8.586013254251215e-01   +1.829761164966714e-01   +6.983933233690921e-01   +7.321746093149866e-01   +4.527387457347075e-01   +3.497434141491466e-01   +3.623019495810487e-01   +7.790488505980359e-02   +1.010697348638514e-01   +5.206670845743361e-01; +1.493987114120539e-01   +2.564469187019458e-01   +2.118346426262530e-01   +4.222086429795383e-01   +6.481293859945096e-01   +8.515953990385496e-01   +5.667286374849554e-01   +6.912390559364088e-01   +5.969261172495868e-02   +2.209394242463918e-01   +2.304539928833463e-03   +5.684759086427769e-01   +4.568706831809005e-01   +7.341847400180938e-01   +3.876502488656846e-01   -2.484931443218095e-02; +5.640544830239005e-01   +5.295739215484575e-01   +2.577391322853280e-01   +2.648694798877003e-01   +5.825308064076531e-01   +3.355765283204907e-01   +6.691596714619409e-01   +6.224186187836247e-01   +3.116667606876089e-01   +3.057757947766584e-01   +2.554029238924940e-01   +1.810900407326103e-01   +4.853893487677551e-01   +1.470519197306954e-01   +5.161680219921578e-01   +2.484567098907607e-01; +5.393589455622612e-01   +1.717733857933050e-01   +4.550505950535840e-01   +8.095536631865822e-01   +2.219924265651524e-01   +8.192794911936651e-01   +5.529350945964504e-01   +2.949189097849576e-01   +6.200485497426818e-01   +2.822775091908117e-01   -2.715180285790799e-02   +4.555213496625740e-01   +7.306588654103063e-02   +4.341618163821562e-01   +4.333445948450364e-01   +5.096210222588935e-01; +1.365040394066923e-01   +4.264797086871232e-01   +1.335736506830177e-01   +6.629447708299708e-01   +4.653891948358820e-02   +4.883808439809311e-01   +6.666753970741014e-01   +7.195647381856579e-02   +3.131313747237273e-01   +1.146604315033538e-01   +4.949684868285608e-01   +2.134639157479177e-01   +5.808080305636509e-01   +5.489592783854558e-01   +1.972924196820975e-01   +4.764123969779833e-01; +5.405834989645206e-01   +5.451303988823031e-01   +3.202730519643457e-01   +4.294739701455617e-01   +9.017260442041026e-01   +2.172071734781582e-01   +5.413707945330333e-01   +1.884890386378893e-01   +3.639793392379617e-01   +7.362184762040476e-01   +1.833489113186173e-01   +5.509737063568451e-01   +3.898086799268886e-01   +2.145481293754397e-01   +1.959046686231242e-01   +4.580578333737975e-01; +4.792688087201057e-01   +3.052737783398762e-01   -3.688810520103393e-02   +4.445521358348832e-01   +8.327829941917824e-01   +5.941598424217793e-01   +2.900056690081105e-01   +3.678466147804371e-01   -3.720113375636701e-02   +5.800732907794407e-02   +1.000000000000000e+00   +3.098266748794460e-01   +5.635731331274921e-01   +1.815935550532969e-01   +8.139530220739101e-01   +1.705577873495579e-01];
L2E_L1E_iAMPA_netcon = [+6.483533937517367e-01   +5.330333349258777e-01   +7.885889823162094e-03   +2.936524106305414e-01   +8.478401258910896e-01   +4.714363920479885e-01   +4.410004598154833e-01   +4.962835434608541e-01; +6.354312112248606e-02   +5.069835014572578e-01   +1.223382746730576e-01   +3.046468997530666e-01   +4.031357564662604e-01   +1.959158317555912e-01   +4.175825365787950e-01   +5.126053584587407e-01; +2.193010971788392e-01   +9.341671584777249e-01   +4.016306603106773e-01   +1.877976557412532e-01   -7.852731311483839e-02   +5.530032757400942e-01   +4.769667930773333e-01   +6.537525504040868e-01; +4.854418482453102e-01   +2.809547656712231e-01   +1.294932024603849e-01   +6.925628493049356e-01   +1.507227399151353e-01   +2.850886537228320e-01   +3.065073725753116e-01   +3.617394023848648e-01; +3.332539544352599e-01   +4.589706713179901e-01   +1.745800667598051e-01   +5.709279334907224e-01   +5.974941146074970e-01   +5.648517650549774e-01   +9.908093213794983e-01   +7.183723076754015e-01; +6.269501590264785e-01   +1.696493362511156e-01   +6.503290681728301e-01   +1.435846983811321e-01   +3.662488243425789e-01   +6.706381935446444e-01   +7.370985259167318e-01   +2.133591401858847e-01; +3.246189865290106e-01   +5.945499345171116e-01   +2.228651315291169e-01   +2.372422617815111e-01   +1.206321020682841e-01   +1.938271932671503e-01   +5.545493074081135e-01   +3.920871677464330e-02; +3.956161296210639e-01   +6.589797410898812e-01   +9.115109116154101e-01   +3.400940525909102e-01   +1.303695855037810e-01   +5.703348809171510e-01   +5.013543773012438e-01   +6.018877514685255e-02; +7.847374104612113e-01   +5.599176597766328e-01   +1.160621127852124e-01   +5.858455259384077e-01   +2.964265086326230e-01   +4.045315944507482e-01   +1.722215756048059e-01   +3.453156046687997e-01; +3.964366519751994e-01   +6.384381001340045e-01   +6.428725741428177e-01   +3.039490227951588e-01   +3.468948683819996e-01   +3.542959850392320e-01   +5.825610485705094e-01   +7.011615550338031e-01; +1.449039263760803e-01   +3.650460405490223e-01   +3.990796217602150e-01   +3.862999552496157e-01   +4.019930627254955e-01   +2.963016259303262e-01   +1.326567716472175e-01   +6.371699547241755e-01; +5.047694806646219e-02   +3.717204571541369e-01   +5.381794948819111e-01   +3.765794076448999e-02   +2.790300180015390e-01   +3.779552364696654e-01   -1.736483799249994e-01   +2.186630439916930e-01; +1.786385341968578e-01   +4.453571875073783e-01   +1.157951228851146e-01   +5.209358364479616e-01   +6.195960979861591e-01   +1.926873065051066e-01   +3.210902274138568e-01   -7.290524175703905e-02; +2.301931400446357e-01   +3.544538388810430e-01   +2.972806477339892e-01   +7.341044135090874e-01   +4.605818074024479e-01   +4.951975948558546e-02   +4.502639237388372e-01   +3.769886052865966e-01; +2.365811250029835e-01   +2.363886482043264e-01   +8.188925218446893e-01   +3.251652909061692e-01   +3.067961633707857e-01   +7.677731161176617e-01   +3.038830443832552e-01   +5.698887843837263e-01; +3.517688660711005e-01   +1.902785871863385e-01   +2.174006766957278e-01   -1.079274490506637e-01   +6.343345638406649e-01   +3.979590422223003e-01   +2.896964134498231e-01   +7.923549281192838e-01];
L1E_L2E_iAMPA_netcon = [+1.936976525140045e-01   +1.824232772136042e-01   +4.006914413520334e-02   +5.226857195431748e-01   +1.866472745455609e-01   +3.194276598840442e-01   +4.287300158374104e-01   +4.342746320517121e-01   +5.392228406932384e-01   +6.125610311337449e-01   +5.234559681450307e-01   +5.987344345834796e-01   +4.958450155291043e-01   +1.612067916213358e-01   -1.548819339863706e-01   +3.423932668283157e-01; +4.167173950488951e-01   -9.142012696969057e-03   +2.025519236434886e-01   +5.359616861940351e-01   +4.178896036965147e-01   -2.364817078796466e-02   +2.263982000390038e-01   +4.453420263247164e-01   +4.074700894979044e-01   +2.092759372251487e-01   +4.920634017194625e-01   +7.399354569972506e-01   +2.227195842031919e-01   +1.831328918694642e-01   +6.139540549410578e-02   +4.436541286812692e-01; +9.614397829126913e-01   +5.999628627734257e-01   +1.448936258823039e-01   +1.489827585102025e-01   +5.277118637929182e-01   +7.127801985203890e-01   +4.331541807102077e-01   +8.243872174110801e-01   +4.579670295447982e-01   +3.736731797567035e-01   +1.559452728489195e-01   +3.293028765559397e-01   +9.275542224146630e-02   +3.914051981812433e-01   +6.097032693224541e-01   +9.865030752057655e-02; +4.179121838015573e-01   +5.091077298885753e-01   +5.551751116033843e-01   -1.291098420143475e-01   +3.902171358179544e-01   +3.386209141577944e-01   +6.652606426684685e-01   +3.088784902863196e-01   +4.229855171924053e-01   +4.449427695690299e-01   +7.086843073379053e-01   +3.250754784115648e-01   +4.002630928708162e-01   +3.894258756888326e-01   +6.921237431929289e-01   -9.918735309815981e-02; +2.245960356960189e-01   +1.089161065852514e-01   +7.956620858368229e-01   +4.180867094175582e-01   +2.488283735545331e-01   +7.382573507226315e-01   +4.031160154867366e-01   +4.281685797021170e-01   +8.966996415400936e-01   +1.780998826091120e-01   +4.208309310862821e-01   +1.894676511782570e-01   +3.906652249889201e-01   +6.924563491131130e-01   +8.835227491797152e-01   +3.122431432718493e-01; +8.048575871698667e-02   +7.050443174835178e-01   +1.065157015707890e-01   +4.431325992441228e-01   +2.589171156658074e-01   -1.481965351452142e-01   +5.364888017460839e-01   +5.247610262696816e-01   +6.472970535968884e-01   +4.225316771938814e-01   +6.456959146281480e-01   +3.084957140945565e-01   +2.832793444986219e-01   -4.718623236319906e-02   +9.989004320186803e-02   +1.110116386236046e-01; +9.444495519368937e-02   +1.238968355720697e-01   +5.528341109118393e-01   +7.461036839769236e-01   +2.673994422886201e-01   -6.409303713949994e-02   +8.164937303638446e-01   +5.468318846352785e-01   -2.675260769015627e-02   +2.059126003692516e-02   +2.462100466200380e-01   +7.185959743278403e-02   +8.558040723430257e-02   +1.325842300211432e-01   +3.202780271680650e-01   -2.904070350600836e-02; +1.524857550407372e-01   +3.861744719560621e-01   +6.904325627500359e-01   +5.213640097367628e-01   +8.064916781601991e-01   +1.000000000000000e+00   +6.661564084687704e-01   +1.555283007388474e-01   -8.156608921450403e-03   +5.591142536066863e-01   +7.965381672499497e-01   +2.928262198066193e-01   +4.674363917686272e-01   +1.793867634891249e-01   +3.268482747168678e-01   +3.606549923745490e-01];
L2I_L2E_iAMPA_netcon = [+5.694913488731433e-01   +8.453753727906280e-01   +4.617659529931321e-01   +3.864502465538476e-01   +6.546447523671102e-02   +9.820635604218775e-01   +3.934962359209114e-01   +5.412560642811327e-01; +7.725900527069272e-01   +2.013162207337503e-01   +9.433593034835981e-01   +8.785948485850662e-01   +7.313704378590202e-01   +1.836493179018572e-01   +3.486933076366922e-01   +4.765514710169174e-01; +8.236691983373047e-01   +1.669593871037119e-01   +2.572722097839676e-01   +3.792902061092439e-02   +3.836994895040763e-01   +7.915967205864648e-01   +5.665065540573989e-01   +5.159468143208220e-01; +2.862986385619533e-01   +6.026691157089198e-01   +4.840828783261949e-01   +1.000000000000000e+00   +5.159558863866879e-01   +3.637957733901235e-01   +1.784682303909106e-01   +5.272108514229970e-01; +7.102021630827838e-01   +4.274372867408472e-01   +5.431738644894105e-01   +7.220518455495549e-01   +7.086914171501082e-01   +6.597327630354713e-01   +9.386391321440832e-01   +2.732760992634632e-02; +2.955534306614387e-01   +6.935900289019331e-01   +2.673543799180747e-01   +8.231760958147537e-01   +1.933055293933781e-01   +2.430841675039941e-01   +5.063457147215908e-01   +4.556505849956954e-01; +5.630429518637130e-01   +4.075405538004990e-01   +2.400073432289484e-01   +8.937842264233946e-01   +6.464448928735999e-01   +5.917427229006291e-01   +8.588075837964099e-01   +3.199762013862610e-01; +7.663888332809227e-01   +3.776370390609548e-01   +1.024959055186096e-01   +5.231225563460089e-01   +8.295188641159382e-02   +8.911901627583305e-01   -2.749899917367793e-01   +6.198722673039901e-01];
L2E_L2I_iGABA_netcon = [+2.160286781209962e-01   +4.330200433356173e-01   +2.734923501587855e-01   +1.218228761801482e-01   +2.254388065459823e-01   +4.114123005661104e-01   +5.038993933277199e-01   +6.761366532904040e-01; +4.315143877107585e-01   +8.354474312404341e-01   +5.167237138700784e-01   +3.315020582230424e-01   +6.067019219932192e-01   +5.284084457521128e-01   +5.188892032194513e-02   +2.847242213019757e-01; +3.259348312505617e-01   +9.587109898091385e-01   +2.227545375742700e-02   -1.301697052663503e-01   +5.144290203579640e-01   +7.867518467338375e-01   +1.806663604914231e-01   +6.020738426807669e-01; -1.848006216576702e-02   +8.421801244216536e-01   +5.822822220551329e-01   +6.246972341320171e-01   +9.855456055076952e-01   +6.962325212297800e-01   +1.740084243040850e-01   +2.548881787443210e-01; +1.728794291477321e-02   -9.303978655505804e-02   +2.323606173253305e-01   +6.595628869970884e-01   +7.453898322652662e-01   +3.631645399836895e-01   +2.066135808681750e-01   -1.074446654014369e-01; +2.104353096943018e-01   +3.457609927056170e-01   +2.387072873540492e-01   +1.163456411858812e-01   +6.163309316740180e-01   +1.967885961574173e-02   +4.885157095177446e-01   +7.503080878641262e-02; +7.485403412478804e-01   +1.049444412782408e-01   -5.268445225444134e-02   +3.776799959744017e-01   -5.943249056637213e-05   +1.553119242593290e-01   +6.297682101036518e-01   +7.475353542518561e-01; +2.846902301042941e-01   +6.880335805180099e-01   +6.076846379863325e-01   -1.062268052977144e-01   +7.855181708307170e-01   +6.625742082932808e-01   +5.838069694799063e-01   +5.673410327688158e-01];
L3E_L2E_iAMPA_netcon = [+1.423490658881607e-01   +1.047780143091089e-02   +2.971982135261935e-01   +6.827106718280476e-01   +2.679044003303974e-01   +2.346636480330038e-01   +5.686332527188485e-01   +6.910313912935716e-01   +4.358620809836384e-01   +3.989756484177040e-01   +5.007742360862952e-03   +5.933644514956630e-01; +5.255373289067113e-01   +8.685217905450954e-01   +6.768980883301406e-02   +1.844094495445880e-01   +3.677249295907644e-01   +8.429433520515318e-03   +3.690811873429788e-01   +1.349624130096694e-01   +8.000498984802843e-01   +1.314029296418207e-01   +6.070466080038242e-01   +2.720176834357984e-01; +2.387849301786123e-02   +4.798060910040640e-01   +6.359261919122109e-01   +3.390214934008260e-01   +9.328724287499333e-01   +5.580185662108570e-01   +7.872587043343779e-01   +4.205788081645614e-01   +5.826900196913269e-01   +2.628851079498291e-01   +1.256251986571967e-01   +6.512737212040116e-01; +4.740512891980388e-01   +3.534809564376394e-01   +7.424908564696310e-01   +3.527113161964856e-01   +5.288694433054344e-01   +3.756121453536582e-01   +3.117232611952297e-01   +3.952430958853298e-01   +4.263236922417690e-01   +6.809046910771936e-01   +8.177951033061283e-02   +1.859867918058241e-01; +6.529950037310224e-01   +2.900625537092683e-01   +6.531720793519187e-02   +3.528568266248090e-02   +5.866005889681761e-01   +3.972515673526512e-01   +5.030331635649456e-02   +2.341945852386490e-01   +7.410898697150160e-01   +4.936690272951949e-01   +6.781063831485928e-01   +7.880875453951594e-01; +3.968300088081270e-01   +7.122782183074521e-01   +5.486120968868370e-01   +1.633792089849997e-01   +4.982022061236826e-01   +9.576091250733941e-01   +7.362862081211206e-02   +4.564184149039967e-02   +1.392522614857485e-01   +6.923064593916490e-01   +8.587077376904009e-02   +4.249566084071222e-01; +2.100091621168056e-01   +5.018677686075343e-01   +7.583377907064227e-01   +2.174682138008566e-01   +2.103983017389466e-01   +7.734530566585014e-01   +5.680157285415856e-01   +6.478973475880617e-01   +4.494222112402980e-01   +5.809075790631000e-01   -9.777477185050772e-02   +1.561986161239766e-01; -9.348220980489308e-02   +5.353585558194717e-01   +1.281853807444040e-01   +3.913978238745692e-02   +4.228977769779260e-01   +1.722180030883749e-01   +3.439736906355561e-01   +5.606212718718778e-02   +1.000000000000000e+00   +6.900563844706804e-01   +1.084607559299632e-01   +4.319202723545776e-01];
L3I_L2I_iGABA_netcon = [+7.064179122233735e-01   +4.361828665235416e-01   +2.643154716683420e-01   +7.323163495896781e-01   +1.071185287710477e-01   +3.051902909719745e-01   +6.655064222280567e-01   +4.697947357186065e-01   +6.925129549253590e-01   +1.083422748479211e-01   +6.522675331160588e-01   +7.302592109550722e-01; +4.437390536690868e-01   +2.350659500851526e-01   +4.026808137989697e-01   +3.232710742487017e-01   +9.677562916670083e-01   +1.174597138861676e-01   +5.580055833240526e-01   +1.198540113520475e-01   +5.440896586940032e-01   +8.180946570685588e-02   +4.589937328849504e-01   -2.002028530750970e-03; +4.740347290088456e-01   +4.327553678780157e-01   +7.570039942717961e-01   +2.224702650860820e-01   +5.911834567105455e-02   -4.560232118570560e-02   +5.649326033609953e-01   +8.533583233023674e-01   +3.989289560944087e-02   +1.781456087270622e-01   +1.431429169002866e-01   +5.412080074367507e-01; +3.905385917969700e-01   +7.606466037826525e-01   +5.799864514448045e-01   +1.403139585980651e-01   +9.959679350396296e-02   +6.774495106195598e-01   +2.423245761091188e-01   +2.539393083734629e-01   +3.435340413161599e-01   +3.535967141612031e-02   +6.472009276184628e-01   +4.651416191807558e-01; +1.851035686298050e-01   +2.155098076020943e-01   +3.652789760310632e-01   +4.125234948380946e-01   +6.002795519599290e-01   +8.704740938304989e-01   +1.189948038276006e-01   +7.369026599670213e-01   +7.149254763398534e-01   +3.160438772847619e-01   +1.867843440959689e-01   +8.158045240908537e-01; -4.138522845641638e-02   +7.430530810417415e-01   +2.852300505257654e-01   +6.021852621021184e-01   +8.723974394487184e-01   +3.091680377807093e-02   +5.234177847325903e-02   +5.821658777184014e-01   +2.948803382838277e-01   +2.387893078147840e-01   +3.005208757914457e-01   +8.613946520313617e-01; +8.342619577835415e-01   +4.939371265468354e-01   +5.782037156470010e-01   +2.225696671562676e-01   +1.501505478097916e-01   +2.605958639222407e-01   +9.752558123071680e-01   +2.033388693679650e-01   -3.987359032681326e-02   +4.035983909713358e-01   +4.316582780426246e-01   +1.607627578093529e-01; -1.401921576874585e-01   +4.712684669680381e-01   +9.011081920863496e-01   +7.859332870710745e-01   -1.505036766293089e-01   +6.617855380470188e-01   +3.565873877766782e-01   +2.863376918544048e-01   +6.781783064795576e-01   +5.063378380138419e-01   +3.315982128243786e-01   +5.922577855217518e-01];
L2E_L3E_iAMPA_netcon = [+3.443103492659261e-01   +2.756130295311895e-02   +1.337358074827681e-01   +2.901234168236233e-01   +1.431206920369888e-01   +4.316519655360110e-03   +3.608087125678569e-01   -1.459176835961235e-01; +3.682970282295666e-01   +8.531261755450579e-01   +4.446344811195099e-01   +7.532992078720388e-02   +7.531024461312831e-01   +5.322433216777742e-01   -2.246383512090960e-02   -9.317557748370682e-02; +2.988721643283438e-01   +1.592462701229698e-01   +6.248522482183232e-01   +8.007314881923783e-01   +5.150814436275764e-01   +3.370629354994904e-01   -2.130205716187114e-01   +3.115489252423098e-01; +7.638132239771016e-02   +5.325197163738862e-01   +6.195774269075179e-01   +4.878506620880566e-01   +6.758492704105891e-01   +4.065175619007481e-01   -6.649684576899087e-02   -9.908882511807413e-02; +8.693985646108300e-02   +4.103993780815148e-01   +4.261632034785046e-01   +7.885528551721944e-01   +7.409930971678349e-01   +9.894285256294365e-02   +9.445998205174116e-02   +5.811628069915306e-01; +5.736272380751437e-01   +7.658727285438311e-01   +7.855915961007904e-01   +5.959479123415434e-01   +2.201884747255307e-01   +4.760184624640632e-01   +1.000000000000000e+00   +4.821245197815271e-01; -9.961193361141346e-02   +3.505029978672624e-01   +8.963884928143444e-01   +8.638216942844460e-01   +3.530558054592413e-01   +4.562525888415813e-01   +4.110335813869782e-01   +3.817337621712238e-01; +6.405906099650926e-01   +4.117535678544899e-01   +2.231155380361351e-01   +9.167661525132685e-02   +5.143522827277083e-01   +5.276028666481409e-01   +7.792182654691832e-01   +7.882613309020261e-01; +7.651574362866513e-01   +2.097618269572419e-01   +5.298355915730715e-01   +2.986491057423534e-01   +2.346665555744944e-01   +1.917533767052942e-01   +7.870847756594711e-01   +3.774037626541629e-01; +1.346976683045025e-01   +4.992177941095856e-01   +1.132244304271860e-01   +6.923021119147632e-01   +1.745235515367112e-01   +1.901092564746291e-01   +8.106424158803965e-01   +4.692279973453008e-01; +6.566218080817615e-01   +2.080746497289309e-01   +5.847812255339834e-02   +4.835001073352999e-01   +7.329657690842705e-01   +9.392818859866786e-01   +1.496836507694899e-01   +8.614425339948445e-01; -9.872139847858061e-02   +6.512674693279197e-01   +8.185193596938780e-01   +3.913610299218940e-01   -1.025762031584218e-01   +2.557874285182694e-02   +1.395453121861213e-01   +5.604185763974464e-01];
L2I_L3I_iGABA_netcon = [+2.907046582208382e-01   +6.757591919025793e-02   +9.742589970287857e-01   +9.329870305600270e-01   -1.760412988821716e-01   +1.992674275543633e-01   +3.163554348851799e-01   -4.587677636435296e-02; +1.734498062583445e-01   +3.993769808624157e-01   +7.502622018595240e-02   +6.946292688184640e-02   +3.953800024200753e-01   +2.702992908399997e-01   +5.708177529374480e-01   +3.690657828293026e-01; +5.424618838906254e-01   +2.601674550101312e-01   +3.957347739909478e-01   +2.731186740208236e-01   +8.343392193824171e-01   +8.193503819011579e-01   +3.579434581868775e-01   +4.551956205323507e-01; +2.904763951867944e-01   +2.775626778655840e-01   +7.385627047772719e-01   -2.190410321341638e-01   +8.169008368504885e-01   +3.601932705452753e-01   +4.319307414020511e-01   +5.589250592431715e-01; +9.260233223530403e-01   +9.784013029161974e-01   +4.551420019270210e-01   +7.453179973762582e-02   +5.187471113419233e-01   +8.509931647974649e-01   +4.924802236708983e-01   -9.473094684608109e-02; +3.468263374497088e-01   +5.910686759897089e-01   +9.365754495272429e-01   -1.325257936486710e-01   -2.161441927481299e-02   +7.327632281186172e-01   +6.198610220542959e-01   -6.254885735547452e-02; +7.961591502755287e-01   +7.209719464620907e-01   +3.917868208668384e-01   +8.592829289831596e-01   +1.969374255489874e-01   +6.672025859872092e-01   +8.922446204133727e-01   +3.934462848812457e-01; +2.361356266674502e-01   +5.709619342411160e-01   +1.089679462067227e-01   +2.664944350970035e-01   +5.463067607021317e-01   -3.701878457319900e-03   +3.486466855939994e-02   +4.022119954760981e-01; -5.638912287506059e-02   +4.749888377056860e-01   +4.988572642797647e-01   +1.705949288861142e-01   +5.481027316970793e-02   +7.390532083588905e-01   +6.620585368242176e-01   +5.306897974760950e-01; +5.786168715214937e-01   -2.045838745790015e-01   +2.186788887838348e-01   +5.039947601821588e-01   +3.479877388000551e-01   +8.696289225441725e-01   +3.684594076359491e-01   +3.785216228642482e-01; +3.165344090157468e-01   +4.133268031781870e-01   +2.592581070318106e-01   -2.635805670250749e-02   +6.253786759723080e-01   +9.191990701088905e-02   +2.340171460225252e-01   +8.930693004070466e-01; +1.822350655680627e-02   +7.225602602356322e-01   -1.536193707958118e-01   +5.298438582935443e-01   +9.701530389574561e-01   +4.697163311271573e-01   +3.389443398423731e-01   +2.778024966492795e-01];
L3I_L3E_iAMPA_netcon = [+7.092104456938156e-01   +7.847060726608439e-01   -1.059790983603039e-01   +6.698935757970356e-01   +5.163087646439394e-02   +2.827664426684488e-01   +2.800331132845093e-01   +1.438642285853280e-01   +3.222650001976239e-01   +4.546516733662649e-01   +3.957056576931153e-01   +4.068351601623549e-01; +4.765392770603832e-01   +6.599643587268004e-01   +6.289718884788492e-01   +4.069987012402197e-01   +8.364975213077331e-01   +3.681904552992512e-01   +1.290277008107296e-01   +6.197658639287610e-01   +9.107418943794031e-01   -1.453672827402863e-02   +2.862823209643811e-01   +3.128951755081258e-01; +4.243629768122062e-01   +8.196721459333429e-01   +8.655794544107622e-01   +3.666326731917879e-01   +6.437016141618315e-01   +8.268716374739628e-01   +5.191465039722964e-01   +1.077241727119039e-01   +3.187885527517313e-01   +6.118431492817341e-01   +2.534950595495207e-01   +9.350430863137472e-01; +6.144187032914509e-01   +7.057361604151728e-01   +2.595099273819125e-01   +3.607760630996263e-01   +8.252452530828362e-01   +5.637395095982325e-01   -1.035602841425704e-01   +2.624174581197853e-01   +1.452488825758525e-01   +2.660607718571296e-01   +6.134011838562229e-01   +4.870094791309817e-01; +6.255099770926404e-01   +4.698188681446277e-01   +6.954610227606716e-01   +7.821916389101775e-02   +6.867412143678312e-01   +2.847947041671087e-01   +1.395708988076017e-01   +3.738369603658017e-01   +5.836916611129073e-01   +7.441145899591796e-01   +9.340515796531248e-01   +1.912752686869888e-02; +1.738867177942594e-01   +8.545098803721962e-01   +6.678683421509066e-01   +4.071385896497452e-02   +2.797562682833013e-02   +2.533517493735561e-01   +3.091962836744813e-01   -3.367652528018354e-02   +5.194052885502661e-01   +1.064342286985357e-01   +4.231979321009925e-01   +1.337364961447066e-01; -5.571658884134430e-02   +2.335677214767992e-01   +1.291880020476610e-01   +3.799875255592305e-02   +3.635061994423566e-01   -1.481189649695953e-01   +5.301234275760229e-01   +4.150560189842825e-01   -5.624256595616216e-03   -8.147450798393152e-02   +6.547246923629413e-01   +2.969843551729358e-01; +8.641174224220416e-01   +6.024020136719846e-01   +5.051773400630766e-01   +7.773340624679044e-01   -7.550906105925778e-02   +2.955680065852698e-01   +2.736218879342366e-01   +6.563212762383006e-01   +1.932388401652433e-01   -1.311483254515480e-01   +1.668226133175917e-01   +5.291461115962515e-01; +1.622412952328665e-01   +8.909476039204840e-01   +1.774164325268131e-01   +7.061105677723073e-01   +5.470678536492637e-01   +2.556849124830635e-01   -1.921742586769298e-02   +5.492517229599678e-01   +5.106797232893964e-01   +7.511016230003530e-01   +2.379284051011085e-01   +7.173272023521758e-01; +7.150896745218234e-01   +9.681230371167263e-02   +5.997284663362332e-01   -1.352661153838572e-01   +8.098097686912401e-01   +4.010676528745800e-02   +6.225921445270581e-01   +3.374256033565841e-01   +4.572376127285404e-01   +3.494199941194472e-01   +8.977124049989036e-01   +1.867599722770721e-01; +5.253771864198981e-02   +5.772066743267571e-01   +4.843563777831145e-01   +4.491032242437051e-01   +1.000000000000000e+00   +3.715087032143622e-01   +4.662508456518641e-01   +7.282703187638606e-01   +8.545995655669217e-01   +4.886322119997923e-01   +7.925639275683838e-01   +8.795115545312140e-01; +5.635576248592525e-01   +4.948027589852672e-01   +1.984087298680912e-01   +3.912268732811935e-01   +1.238178544375962e-01   +2.108200035113768e-01   +4.695900782851727e-01   +2.188485325940382e-01   +7.700345359579551e-01   +9.523598490982403e-02   +5.472172870736974e-01   +4.401376848188736e-01];
L3E_L3I_iGABA_netcon = [+1.454992927269829e-01   +8.341572873074330e-01   +6.104492259473105e-01   +3.131366233373112e-01   +2.827998380057861e-01   +1.207130919028730e-01   +7.646328729021701e-02   +3.506010070599295e-01   +5.752448510401099e-02   +6.561482234610212e-01   -1.284439728084864e-02   +1.749926529070242e-01; +8.568541227174218e-01   +5.986724383002374e-01   +6.201459902032919e-02   +2.250521092911736e-01   +4.747386223449058e-01   +3.861060708719956e-01   +3.448287441669450e-01   +5.530264888074458e-01   +2.402257184828783e-01   -1.602130683205728e-02   +1.406249016952539e-01   +4.233838332011786e-01; +5.991031916239907e-01   -7.097140073673433e-02   +1.224925244699994e-01   +5.421030547789873e-01   +5.745975279569473e-01   +5.282241178705009e-01   +4.469706547083772e-01   +3.431839665279665e-01   +8.913611155295657e-02   +2.953420597110695e-01   -7.747956286683141e-02   -1.052659435015550e-01; +3.386458657589999e-01   +5.677446667643350e-01   +1.127978175523677e-01   +8.101593832878076e-01   +6.967341061387424e-01   +3.430858052451475e-01   +5.237774517008247e-02   +3.835010917472796e-01   +4.504210736066451e-01   +3.416886180715366e-01   +5.633788039154646e-01   +6.354918438868005e-01; +6.578347716807107e-01   +4.554984920069164e-01   +5.864833000096094e-01   +9.144828862594570e-01   +2.005922604219739e-01   +6.486642326327406e-01   -6.054891425526338e-02   +9.022170513509290e-01   +5.244753917734943e-01   +6.905936265990555e-01   +5.910151555230416e-01   +1.229755804358340e-01; +1.639168922898825e-01   +4.396570069051647e-01   +1.639955508706492e-02   +1.146548152383423e-01   +4.410712482382901e-01   +8.129579017162499e-01   +2.947183081316965e-01   +3.182753235320639e-01   +6.658069133119365e-01   +4.104827383609433e-01   +5.543638001159228e-01   +4.949313703208628e-01; +2.876735578157394e-01   -2.572391497575798e-02   +4.893044398830248e-01   +7.767721079771982e-01   +7.139285203559477e-01   +2.860731020383599e-01   +7.072538324527362e-01   +5.938253007746863e-01   +3.854766917003897e-01   +6.504422798519696e-01   +7.103606687409326e-01   -9.129297607101752e-03; +3.939490296618031e-01   +2.558944358020049e-01   +5.840990003399974e-01   +5.830934974372997e-01   +9.308200341075267e-01   +1.017626375738156e-01   +4.201194293092581e-01   +1.108407777907399e-01   +2.860731246682697e-01   +4.525577828713232e-01   +6.446541480035425e-01   +7.988094502237597e-02; +3.517617198982117e-01   +7.251169078372810e-01   +4.760382366379093e-01   +3.378450289585974e-01   +4.713376712269583e-01   +2.378634931319559e-01   +1.893902016468977e-01   +4.246662751947108e-01   +6.569073179420002e-01   +5.367433739166574e-01   +8.823737768705393e-01   +5.206217512320489e-01; +2.162897490344895e-01   -2.032392947444592e-01   +6.451111736883532e-01   +3.122388770712713e-01   +1.984594091254340e-01   +5.186248777127961e-01   +5.421309895980492e-01   +6.400602614995760e-01   +2.634891196999319e-01   +2.026275643677714e-01   +2.752745840086899e-01   +9.336578224671068e-01; +7.462947622154369e-01   +1.986434945354193e-01   +2.157355281739304e-01   +1.074930910805098e-01   +3.191719315774227e-01   +3.153967396582814e-01   +1.172685154141171e-01   +6.605137634476921e-01   +2.075929139731751e-01   +5.748750889424836e-01   +2.491819788494950e-02   +2.946290224579742e-01; +5.090637142908132e-01   +5.040222742534649e-01   +1.610764917318964e-01   +9.673183223483147e-01   +6.541681937607355e-01   +5.908613242502355e-01   +6.412321230130253e-01   +1.447858019872053e-01   +2.420749703885259e-01   +1.652500096456744e-01   +3.353686920006744e-01   +2.109357144305191e-01];
L2E_Input1_iAMPA_netcon = [+7.254591221576179e-01   +7.883667395181041e-01   +1.000000000000000e+00   +9.470942674082519e-01   +6.630010999954157e-01   +9.253554735292607e-01   +8.514646371723811e-01   +7.096448391197244e-01];
L2I_Input2_iAMPA_netcon = [+9.467997658145576e-01   +8.407265427980957e-01   +1.000000000000000e+00   +8.146465771074175e-01   +6.493354537445114e-01   +8.222168335474244e-01   +9.893377369795243e-01   +7.345869223023372e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
