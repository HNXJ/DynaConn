function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.097032563790546e-02   +1.054695350292127e-01   +7.833232230868413e-02   +2.297986603074939e-02   +1.502490846841301e-02   +5.905481878320915e-02   +2.500400669246320e-01   +2.457281269772041e-01   +2.281237225671710e-01   +2.443887024790630e-01   +7.803603165593180e-02   +1.789775943427452e-01   +1.381209601356786e-01   +1.026351010706419e-02   +2.170667471472966e-01   +4.541529347431632e-02; +1.847310535833871e-01   +2.071100877991004e-01   +1.023845252978665e-01   +1.149993741342178e-01   +2.429138167210795e-01   +2.480875759948948e-01   +1.094894961929176e-01   +7.811988150351443e-02   +2.367785801354860e-01   +2.244537181844871e-01   +1.048938982813892e-02   +6.706208373512453e-02   +1.990439084702270e-01   +2.646845722167249e-01   +1.016086205839938e-01   +2.563793961639454e-01; +7.673895232848117e-02   +1.746701995382290e-01   +2.655792751239493e-02   +2.591378247245250e-01   +1.267576332978583e-01   +1.335276874476554e-01   +2.095172574338872e-01   +2.448444874048855e-01   +1.900863398027355e-01   +4.012117937108629e-02   +3.452816975615149e-02   +9.917745646341254e-02   +1.550255902203246e-01   +1.360254886529529e-01   +2.089685114041041e-01   +1.134447946106006e-01; +1.497486022709132e-01   +1.337121547175290e-01   +1.721089692702570e-01   +1.475889883071254e-01   +1.916164050122384e-01   +1.119860950985342e-01   +2.301752623751309e-01   +1.293481717476169e-01   +1.561362155503518e-01   +1.564906046341318e-01   +2.535162361488217e-01   +1.765659016536728e-01   +3.211775390589117e-02   +2.423196877913810e-01   +1.279254340093343e-01   +8.369610432970435e-02; +2.508861255349024e-01   +1.491099588561038e-01   +1.471524549667780e-01   +1.518091518052834e-01   +1.615016921121513e-01   +1.597931561195189e-02   +2.416010440099054e-01   +1.281163467785829e-01   +8.019394605664011e-02   +2.248575635141813e-01   +1.400646002457656e-02   +2.246896116972308e-01   +7.759959864667491e-02   +2.536603429357908e-01   +4.519046505821420e-02   +2.132615027110894e-01; +2.311496597138621e-01   +6.343946190391399e-02   +1.617837802128752e-01   +1.265339726255777e-01   +1.798874328157318e-01   +3.916936847603021e-02   +1.306196958265199e-02   +6.224996566907044e-02   +2.299922514850388e-01   +1.653081564936206e-01   +5.694944476909470e-02   +2.631189371756594e-01   +9.506222116670515e-02   +2.367655669171559e-01   +6.704454736923588e-03   +7.320201142663176e-02; +6.513907378480366e-02   +1.600082886530032e-01   +2.188468645916652e-01   +9.450727192320287e-02   +1.859066426933135e-01   +1.806946022704845e-01   +1.585135846890490e-01   +8.799159117084208e-03   +2.380548423241477e-02   +1.104344884374071e-01   +1.432111116544666e-01   +2.063585625026678e-01   +1.879201000675898e-01   +2.463248178164534e-01   +1.041622722287103e-01   +2.139905274840185e-01; +7.916115721629487e-02   +1.449893223113736e-01   +6.135352106081235e-03   +2.428623908684570e-01   +9.694717507742649e-02   +9.995239035859999e-03   +1.897205004281850e-01   +2.233818130124177e-01   +7.899214309803212e-02   +5.310453509043243e-02   +5.662771238868920e-02   +2.556857629388840e-01   +2.132479494513642e-01   +4.041030925351132e-02   +1.037892962465410e-01   +6.044299963394383e-02; +1.970772712344993e-01   +1.497648962535771e-01   +1.744173391431462e-01   +1.303693984192058e-01   +1.593156726439557e-01   +2.400854333976319e-01   +3.383153421740154e-02   +1.980299219169978e-01   +1.310662595621211e-01   +6.845654469052630e-02   +1.898570404328818e-01   +2.449371608262080e-01   +7.794863038136497e-02   +1.092083544503999e-01   +2.528987146203566e-01   +2.370306718799862e-01; +2.082595934936004e-01   +6.694777421049156e-02   +3.776401343403966e-02   +4.554678939561791e-02   +3.612499831378645e-02   +2.581938469524234e-02   +1.086690655469157e-02   +2.501570870767916e-02   +9.484890671246504e-02   +1.927895686887142e-01   +9.518413086734556e-02   +2.991889821015241e-03   +1.581115483579202e-01   +1.824368916247283e-01   +3.031660925931319e-02   +3.796695548489930e-02; +2.606185120249919e-01   +2.510070891970416e-01   +1.903518646096595e-02   +1.393868983540091e-01   +1.588690659520714e-01   +6.491902256059290e-02   +2.092884374193860e-01   +2.052038350311199e-01   +9.975293851823352e-02   +1.685574623163401e-01   +2.201490852433117e-01   +2.233046128757605e-01   +2.891271458325190e-02   +1.499399887213302e-01   +1.004500129328189e-01   +1.539871044880711e-02; +2.178458180927856e-01   +2.561625045502321e-01   +1.175732889404023e-01   +1.226338524543706e-01   +2.777534155783633e-04   +1.185554812176118e-01   +2.262267840208503e-01   +1.779497093307177e-01   +2.167699885663027e-01   +1.052797509430176e-01   +2.083340432059967e-01   +1.493460683360277e-01   +1.637675889340144e-01   +1.135600198298292e-01   +2.093941722334864e-01   +2.120255252089984e-01; +2.177632383337464e-01   +6.380983205721288e-02   +1.002873646216840e-01   +8.769898843806608e-02   +2.448484416737572e-01   +8.353415800520048e-02   +2.010400232861249e-01   +1.676930947062475e-01   +1.366379010968069e-01   +1.897851639365789e-01   +1.391096252031840e-01   +1.248484576508378e-01   +2.038206055730248e-01   +4.590627737934958e-02   +2.142164943983329e-01   +6.180874884250502e-03; +7.289795978891229e-02   +6.737069685088718e-03   +1.121162218152819e-01   +1.263957894115710e-02   +2.299979018783065e-01   +1.626373550041378e-01   +2.033972515623186e-01   +1.682382361948004e-01   +1.842300984524777e-01   +2.457508714921906e-01   +1.422820887557793e-01   +3.325474655080170e-02   +4.387082091301384e-02   +2.490751227877853e-01   +1.199434433225672e-01   +1.122868623993721e-02; +7.125462831612765e-02   +1.785671729192126e-01   +8.514782783857984e-02   +6.731046074210142e-02   +2.020693389763586e-01   +1.220037153038513e-01   +1.469241411092531e-01   +4.322448386910996e-02   +6.004375487502928e-03   +2.321863336607730e-01   +1.960609836434322e-01   +2.268654939301351e-01   +3.150261825544066e-02   +6.092167118274659e-02   +2.369492945255674e-01   +1.382852528073848e-01; +1.752595255376905e-01   +1.074933695294083e-01   +7.791543178251915e-04   +2.571795699770148e-01   +1.939602839888721e-01   +1.488939438577579e-01   +9.828968757288117e-02   +2.456275631277243e-01   +1.686729973525762e-01   +2.281064634953665e-01   +1.855592058352397e-01   +3.636632590338266e-02   +2.286488814837250e-01   +2.186173802868600e-01   +1.806714948032902e-01   +7.046574359946142e-02];
L1E_L1I_iGABA_netcon = [+1.890982689661363e-01   +2.618742559046383e-01   +2.072280325030410e-01   +1.168414839430005e-01   +1.942678004635545e-01   +1.071318882528382e-02   +2.458790640670364e-01   +2.468128927909601e-01   +2.390124439617179e-01   +1.239256793474526e-02   +8.419006353835256e-03   +1.157105122301369e-01   +7.607994609329340e-02   +1.268738881829696e-01   +9.065721640001174e-02   +1.144769261650039e-01; +1.207274694572109e-01   +2.568269677207143e-01   +1.095916837810804e-01   +1.298321994657529e-01   +7.244341976753914e-02   +2.165108139601147e-01   +1.471086043416442e-01   +2.600929461585003e-01   +4.483531887100035e-03   +1.462413921847079e-01   +9.594743187934890e-02   +7.509353864986454e-02   +2.279172695836128e-02   +8.748425853230565e-02   +1.063976964906034e-01   +2.276401397242268e-01; +2.223667626012771e-01   +2.237675402229030e-01   +2.527323149687857e-01   +2.132162839324044e-01   +3.833185658419416e-02   +2.064249320549434e-01   +9.907167205015714e-02   +9.792389280700611e-02   +9.316087086218480e-02   +2.136906699291966e-01   +1.109964755380231e-01   +1.461463515594259e-01   +2.166989622886176e-01   +1.614141030479459e-01   +6.508558275402322e-02   +2.073282486116730e-01; +2.779782144219414e-02   +1.842755194544791e-01   +9.091809069695946e-02   +1.544948925552335e-01   +2.584067565898217e-01   +1.053046967251163e-01   +9.396034400593589e-02   +2.049392354386056e-01   +1.879372038862872e-01   +1.950286673272984e-01   +1.505955769285596e-01   +2.598367421957919e-01   +9.187818104720023e-02   +1.863174670023622e-01   +2.528238123022768e-01   +2.038721001801813e-01; +1.030455391445920e-01   +1.255066959320264e-01   +1.423424209406990e-01   +2.514992475358554e-01   +1.034082814708867e-01   +9.743690952348011e-02   +1.484528349875411e-01   +2.583003017957341e-01   +8.335551403556676e-02   +1.099484772436848e-02   +2.420192182415150e-01   +1.132841612569804e-01   +2.134845152090709e-01   +2.252596202444761e-01   +1.537593348559903e-01   +3.244909990428359e-02; +2.579135218623008e-01   +1.561827218115351e-01   +2.745109244688299e-02   +8.146701830442447e-02   +1.265574496234795e-01   +6.016947941198186e-02   +1.890897571694260e-02   +6.941936484570792e-02   +1.887998453183380e-01   +2.461503465475692e-01   +1.051631158216411e-01   +1.380831416431122e-02   +1.679692558726758e-01   +1.445213809061729e-01   +5.078986319076764e-02   +1.964600284679856e-01; +2.002895741933079e-02   +5.671298063534660e-02   +1.735890146011363e-01   +6.809991773008371e-02   +1.307302391598540e-01   +5.336116324865543e-02   +9.585066629348826e-02   +2.813683510415993e-02   +9.952191316217149e-02   +2.143156333619959e-01   +1.998990928128300e-01   +8.637700398558716e-02   +1.196382304673229e-02   +5.921198275888836e-02   +1.584832463119700e-01   +1.290018310551669e-01; +2.352756353783897e-01   +4.723054443369086e-02   +7.724643746246031e-02   +1.698326797579773e-01   +1.663678579964037e-01   +1.106760906830855e-01   +5.532877750876370e-02   +9.091530946006784e-02   +1.660734724025055e-02   +3.031309939687020e-02   +5.045353325917507e-02   +2.465296565749582e-01   +3.862430803521952e-02   +7.879103794432385e-02   +1.821804351943763e-01   +2.270674887701008e-01; +4.325416721338186e-02   +1.073989116791620e-01   +7.577294446510809e-02   +9.577404224550892e-02   +7.820771660526405e-03   +1.507832351299294e-02   +5.514091037929590e-02   +6.739023462359540e-02   +1.789514576839900e-01   +5.747884501643692e-02   +4.399012569769979e-02   +2.197357202868134e-01   +1.728489780615086e-01   +5.271393472558396e-02   +2.181359361277912e-01   +2.428327712028052e-01; +6.004066240169097e-02   +1.661169146581245e-01   +2.699159594509633e-02   +1.188160554729997e-01   +8.049032916262805e-02   +1.458783867078941e-01   +2.404280872367325e-01   +3.759301292462865e-02   +2.316879313508804e-01   +1.219274531752710e-01   +1.814872501698440e-01   +2.259570004293672e-01   +1.529626125306552e-02   +1.676300879671431e-01   +1.070189613435733e-01   +2.321863465510397e-01; +2.525557210530658e-01   +2.004298227363586e-01   +2.333799065432466e-01   +8.713078700358770e-02   +7.214148603322265e-02   +1.432293103266962e-01   +8.321965581137927e-02   +1.753499068737560e-01   +1.986811488995214e-01   +2.299768023341925e-02   +1.458370861855544e-02   +1.783929091036202e-01   +1.264830943213867e-01   +2.087033421435177e-01   +1.020724452304669e-01   +1.971051361817171e-02; +2.376158262765654e-01   +9.112315471063744e-02   +2.556286655384156e-01   +9.175279308874408e-02   +8.017313305640045e-02   +2.090637630692365e-01   +6.851867578798476e-03   +2.135362142017176e-01   +4.310979004611262e-02   +2.021226604596346e-01   +2.238380284840333e-01   +5.534323719678300e-02   +1.346276067642266e-01   +1.253314770622881e-01   +2.465911196393679e-01   +1.064075739532961e-01; +7.847085281294686e-03   +7.145950386411161e-02   +9.185296159342131e-02   +6.175952142395910e-02   +1.859541012792978e-01   +1.162366989701398e-01   +5.625611841494946e-03   +1.383831763697968e-01   +1.659143788246163e-01   +1.156290852045490e-01   +2.613225867951876e-01   +1.038415537973531e-01   -6.961601142389190e-04   +1.906763698306858e-01   +2.500879292034559e-02   +2.201220922385276e-01; +1.468798656648519e-02   +2.147581345629319e-01   +1.596979403771100e-01   +6.337254668592281e-02   +1.729531745433096e-01   +1.689559145353633e-01   +2.099297010091854e-01   +5.572489632677024e-02   +2.313156816721576e-01   +2.363966152542615e-01   +9.423225291181971e-02   +3.652541043125931e-02   +2.495372833843646e-01   +2.502023937919291e-01   +8.054150313982916e-02   +2.155568603673750e-01; +1.283411157217225e-03   +1.681568816170501e-01   +2.325690923500134e-02   +8.813707476177057e-02   +4.868293280153235e-02   +2.098693292878401e-01   +2.109900277303686e-01   +2.191844433503991e-01   +1.470904138607050e-01   +1.523340784299169e-01   +1.211832046990420e-01   +1.372066740868925e-01   +1.552120769040415e-01   +6.070430151223161e-02   +1.018682778215645e-01   +8.313724979709902e-02; +8.562058612997759e-03   +1.562898890381455e-01   +8.618857373707467e-02   +9.850584895559006e-02   +2.420741248507086e-01   +2.199819240249195e-01   +5.606443530872834e-02   +2.411337175864858e-01   +2.035413630755924e-01   +4.775799318713180e-02   +8.321271360162488e-02   +2.165534909641852e-01   +2.527497552049641e-01   +2.297034644578224e-01   +1.321947774431774e-01   +1.398397667891565e-01];
L2I_L1I_iGABA_netcon = [-2.794518282046062e-04   +1.711821815046248e-01   +2.710318004266924e-02   +2.299421319350551e-01   +1.323442111649226e-01   +2.003918060205570e-01   +1.137514875950581e-01   +3.183839079182300e-02; +7.888763960403304e-02   +1.201628843080668e-02   +1.927310447354676e-01   +5.786489084518235e-02   +5.662245863694432e-02   +5.550886817525661e-02   +2.234113152585431e-01   +1.351570131361570e-01; +1.731126151475336e-01   +9.814083219475944e-02   +1.148226405479641e-01   +1.557987329619492e-01   +2.705115128798084e-02   +2.527947431182944e-01   +7.133690151841268e-02   -5.480272362522072e-04; +2.059050233376322e-01   +2.407119425384513e-01   +1.551397292269051e-01   +1.618781723110699e-01   +1.782051861176346e-01   +6.109255574756481e-02   +2.410782164333619e-01   +2.105869113337607e-01; +1.655804674754953e-01   +3.871125462779026e-02   +6.597308996032498e-02   +2.295710263681596e-01   +1.369566180272900e-02   +2.205479663156928e-01   +7.152786776233409e-02   +1.258449834286900e-01; +1.597561772255364e-01   +2.381127635212138e-02   +2.322246313011783e-01   +1.126276149232371e-01   +1.947689363352117e-01   +2.188845959074929e-01   +2.690730389379686e-01   +5.778403215620739e-02; +2.049718506830681e-01   +8.375181884750883e-02   +2.556617477351876e-01   +1.552842815011067e-01   +3.946962626077868e-02   +9.270487933764240e-02   +5.252571449777678e-02   +2.423295451680330e-01; +4.866257336884404e-02   +2.155330051776324e-01   -1.739948370217568e-03   +2.177521028263195e-01   +2.547099579804888e-01   +6.471679846187603e-02   +1.330789950722758e-01   +8.181100719228114e-02; +1.726409270383779e-01   +1.776268561476979e-01   +8.399652578800113e-02   +1.866338424773820e-01   +1.670039673129836e-01   +6.857380400689383e-02   +1.039289767440610e-01   +7.367792765147999e-02; +1.404124316335131e-01   +8.403088233198483e-02   +1.128612576207411e-01   +1.787339411539182e-01   +3.169849513295973e-02   +2.005378162605360e-01   +1.281972293526483e-01   +1.641549997299659e-01; +1.287601957908270e-01   +1.603449612219271e-01   +1.157456189715867e-02   +7.753988688712158e-03   +1.230218570441113e-01   +6.193054472418717e-02   +7.567051385334689e-02   +1.262997992868113e-01; +6.119866835720555e-02   +1.670536576437832e-01   +3.422194906533593e-02   +9.988940350912774e-02   +3.739834101768132e-02   +1.473697484871560e-01   +1.129892931046765e-01   +1.641234671181346e-01; +1.999653813252469e-01   +1.560946195994045e-01   +5.430725143095105e-02   +1.377763190902484e-01   +1.734408506173733e-03   +1.578344546039894e-01   +4.882753299273245e-02   +2.427502167575239e-01; +1.323562928719468e-01   +1.364158492976352e-01   +4.321049106787867e-02   +2.559647410780256e-01   +1.090834545333683e-01   +2.629879809350891e-01   +2.032497702282127e-02   +1.539749703933177e-01; +7.249454007312948e-02   +1.216441612578484e-01   +3.308720817513938e-02   +1.604036862520980e-01   +3.503381494987824e-02   +8.843255101969238e-02   +1.830027527213543e-02   +5.592348101803379e-02; +2.901392055883815e-02   +1.550634121456388e-01   +1.695404613593041e-01   +2.210855011741990e-01   +4.636859405720146e-02   +2.367385313493717e-01   +2.483238975156326e-01   +6.308432957485564e-03];
L1I_L2I_iGABA_netcon = [+1.501130852262740e-01   +7.869726444284171e-02   +1.130936324720203e-01   +6.827422453577192e-02   +3.845210237600855e-02   +1.937394694972892e-01   +1.212855766229674e-01   +2.203668924055821e-01   +8.403999584591974e-02   +1.919755113471425e-01   +1.845147891661004e-01   +2.291465396130048e-01   +1.120446225156781e-01   +2.144472435593476e-01   +1.616460495348197e-01   +1.117375154835406e-01; +9.619180023695819e-03   +4.226028329966979e-02   +7.241956505271306e-02   +6.157495786377998e-03   +2.409277158573782e-01   +1.754737096061585e-01   +1.979305597861349e-01   +1.773701690858214e-01   +1.719311899590477e-01   +1.000117459441923e-01   +8.704014634835061e-03   +1.055258372966476e-01   +1.528639561108552e-01   -2.422378113364064e-03   +1.930978903093449e-02   +1.620016732225184e-01; +3.323035224993773e-02   +2.927380401944300e-02   -9.999299765738323e-04   +5.158462267001202e-03   +2.586651199479989e-01   +1.729203514921496e-01   +2.458365580908934e-01   +2.282992515013244e-01   +7.252855506756398e-02   +7.852365035812821e-02   +4.577103223378865e-02   +5.900493076640600e-02   +2.295101032486881e-01   +5.976226544621762e-02   +7.213822609609752e-02   +1.736771773275602e-02; +1.375046255473112e-01   +2.201474851592872e-01   +1.355659971195558e-01   +8.638580290835556e-02   +7.273108529606233e-02   +1.446521956684592e-01   +1.111406743582161e-01   +2.045334815389571e-02   +6.982635129568605e-02   +1.444572576165728e-01   +2.346748892116186e-01   +2.433206309683823e-01   +2.348928842577752e-02   +2.795805679313969e-02   +9.527514424120404e-02   +1.527897236018798e-01; +1.110102182248098e-01   +7.676726473632510e-02   +2.815523445034558e-02   +2.340612726939308e-01   +1.453724125269224e-01   +2.219984604735341e-01   +3.480620146410722e-02   +1.418312879858775e-01   +2.443030134983931e-01   +1.511467841460824e-01   +2.324653238240102e-01   +7.119837961461151e-02   +4.045814597363195e-02   +2.547682390685929e-01   +2.212289664405408e-01   +2.544197727619042e-01; +8.448772513424664e-02   +1.875212503924718e-01   +8.211186273287878e-02   +2.030928086697933e-01   +1.134336069481000e-01   +1.983947334429487e-01   +2.133558102141243e-01   +1.720177244592994e-01   +1.045186141953188e-01   +2.380699458903174e-02   +1.470840371647926e-01   +2.298770851757519e-01   +7.104447345399081e-02   +1.617551188167657e-01   +2.361389558071395e-01   +9.348058060273910e-02; +2.501370053329608e-01   +2.165919270506285e-02   +1.895246134189837e-02   +6.019297233134851e-02   +2.583865561171604e-01   +1.555489148231299e-01   +2.456147969200408e-01   +1.121454027341982e-01   +2.462038787259793e-01   +6.786746278059462e-02   +2.543041272026914e-01   +1.382410790266163e-01   +1.155973758530326e-01   +1.457356547536899e-01   +5.824676209145207e-02   +2.012776512902765e-01; +1.935439211051598e-01   +1.710474867810068e-01   +7.247481512689923e-02   +7.966769401256985e-02   +2.199590690139056e-01   +1.029527168074885e-01   +6.284814675112970e-03   +4.071220423392097e-02   +9.991066384013307e-02   +8.217406947350993e-02   +3.388364153748921e-02   +2.406777722897011e-01   +8.520898553634264e-03   +5.445582593936353e-02   +2.537310452841809e-01   +2.522307068899769e-01];
L2E_L1E_iAMPA_netcon = [+2.413560633586992e-01   +9.817833300654839e-02   +1.732437906800007e-01   +1.518529491475347e-01   +2.378232905268257e-02   +8.852190371490766e-02   +2.299491279195296e-01   +1.348297406608061e-02; +8.488975205534217e-02   +8.041604171146924e-02   +2.089017067441186e-01   +5.820095250714796e-02   +1.854148123067863e-01   +1.296287342491279e-02   +8.422233289879674e-02   +1.845529765416724e-01; +8.190792068920903e-02   +4.391725714809184e-02   +1.997005931386681e-01   +1.750985468399428e-01   +1.300200338579403e-01   -5.687190603885704e-03   +5.885324423231338e-02   +1.004198405493297e-01; +1.487654229489603e-01   +5.280243450407623e-02   +6.932186371219537e-02   +2.510925828081922e-01   +1.440063349161254e-01   +6.186694913736973e-02   +1.620396379917034e-01   +4.040792034810285e-03; +4.966922554600037e-02   +1.310943012842011e-01   +1.778667013887968e-02   +1.224812929719124e-02   +6.728977094446688e-02   +1.417961133908800e-01   +6.204557100468367e-02   +6.281640307078913e-02; +6.449149419942485e-02   +1.371495862821689e-01   +3.888834945659628e-02   +1.165129078619793e-01   +2.367798747182110e-01   +2.578318567091619e-01   -8.062086789646951e-04   +2.186788019308216e-01; +1.054816014195174e-01   +1.085681461241386e-01   +2.519002157126740e-01   +1.057401495983934e-01   +6.486874126863740e-02   +2.772583172167229e-02   +1.123249980372582e-01   +1.306430056871991e-01; +4.912862902881581e-02   +1.210140875262573e-04   +1.915707021919060e-01   +1.784199159676226e-01   +7.681246485559996e-02   +1.298894441646263e-01   +2.101600977658822e-01   +2.067181480869937e-01; +6.776150027625727e-02   +2.180739774715113e-01   +1.474964533623185e-02   +2.216859206010264e-01   +1.788933936160740e-01   +7.268076962246323e-02   +7.566720784396355e-02   +8.779025727438688e-02; +3.119274723637193e-02   +2.304173992901088e-01   +1.873964208697231e-01   +2.127405314033865e-01   +1.115775970964490e-01   +2.572763166680396e-01   +2.543366772296779e-01   +1.788396332747252e-01; +2.147945261166473e-01   +9.458225800934776e-02   +1.414322351286508e-01   +3.154281721167847e-02   +1.313029263305643e-01   +1.934888173076992e-01   +8.057546179738462e-02   +5.334370800509686e-02; +1.560301325587801e-01   +2.536281504203619e-01   +1.054761024776458e-01   +2.229482188377272e-01   +2.574209252842830e-01   +2.060294109302613e-01   +1.282083527796435e-01   +2.567385522736947e-01; +1.276526840842128e-01   +1.490392543312166e-01   +5.384362874623980e-02   +2.327640038123006e-01   +3.171017391267709e-02   +1.029136799595640e-02   +6.458258977683122e-02   +8.553416330122070e-02; +1.121412739908119e-01   +1.458295773812374e-01   +2.364150186408674e-01   +1.036567868013421e-01   +1.230173772538338e-01   +1.603739215824853e-01   +2.281058714836122e-01   +1.332079445661151e-01; +2.090189938603976e-01   +6.592121562723008e-02   +1.060799598768927e-01   +5.127979717240697e-02   +6.060284330977076e-02   +2.043042814092209e-01   +2.428838148631952e-01   +1.652348369146031e-01; +1.531119324911959e-01   +8.368783759807912e-03   +7.487049173382136e-02   +1.976334284485730e-01   +1.226214877227092e-01   +1.991517926909438e-02   +1.325322587179076e-01   +1.934792477682993e-01];
L1E_L2E_iAMPA_netcon = [+3.321931122983210e-02   +9.536053458157756e-02   +1.951563914574579e-01   +1.946556793297955e-01   +1.042372768195923e-01   +1.549824661639631e-01   +1.497557158711840e-01   +2.380207672225394e-01   +2.103464311945167e-01   +1.286008193380421e-01   +7.719295146363843e-02   +2.472671402083632e-01   +1.164541037186223e-01   +7.425696708194045e-02   +1.448054913973932e-01   +4.087004373692634e-03; +1.940254276829206e-01   +1.741577257465612e-01   +2.534030822400565e-01   +5.598943017961264e-02   +1.164840487267808e-01   +1.806717125620353e-01   +1.822104580964720e-01   +9.229183650476515e-03   +6.627800743361785e-02   +7.411094241350440e-02   +1.859990698824047e-01   +1.035679626910222e-02   +2.105540959661510e-01   +1.312238074600582e-01   +7.160250701868050e-02   +2.032932048613122e-01; +9.059818443303659e-02   +1.063128612232310e-01   +6.316967701892753e-02   +2.637310425642116e-01   +1.498872343996951e-01   +1.505576125262080e-01   +2.205060897357150e-01   +6.923119830480136e-02   -9.103728434072529e-04   +5.932345001371145e-02   +4.727761597222379e-02   +1.491236678075780e-01   +2.382201535273210e-01   +4.266683964561552e-02   +8.934686392797719e-02   +1.420333357150800e-01; +4.531089043841766e-02   +8.411596234660521e-02   -1.654244522211029e-03   +1.243475434321418e-01   +2.083118097578106e-01   +2.167995758541142e-01   +1.552245602125007e-02   +5.757020853581076e-02   +2.211385119004546e-01   +1.147008190229968e-01   +2.088679585355339e-01   +8.862067397645047e-02   +2.644994463363916e-01   +7.584746523279334e-02   +5.126037348002477e-02   +1.401851063424388e-01; +5.119691711504620e-02   +4.587856094519602e-02   +1.009655953205920e-01   +1.314068017800094e-01   +7.907419552981744e-02   +1.558536119622338e-01   +1.650272966903054e-01   +1.171434848847086e-01   +7.095443849442555e-02   +1.811052330137630e-01   +8.643940005861619e-02   +1.531970848888889e-01   +3.609066513474348e-02   +9.666754128401631e-02   +2.345111131139271e-01   +1.109681577831874e-02; +1.253351921974009e-01   +1.346167776579171e-01   +1.363341334363733e-02   +1.262494816936815e-01   +6.886324247943936e-03   +9.989359096734186e-02   +1.665902281291052e-01   +1.856211639902717e-01   +6.523018667701971e-02   +2.070005099809442e-01   +2.282188664053918e-01   +7.777844193231169e-02   +4.743886936620910e-02   +1.328663016245151e-01   +9.091879770139540e-03   +1.576823369842087e-01; +1.771891516923200e-01   +3.877060889380882e-02   +1.235647340948188e-01   +1.835432715686800e-01   +4.627257269557936e-02   +2.146296851219038e-01   +2.153404395352083e-01   +2.957074043277253e-02   +2.491436076017908e-01   +2.391767159621424e-01   +1.425170178098656e-01   +1.018915926837382e-01   +7.462938114027558e-02   +8.945498172203821e-02   +1.968901412665181e-01   +1.170569250408112e-01; +3.800041310935318e-02   +9.079999020899175e-02   +3.107920448443097e-02   +6.459753030782421e-02   +2.209028591958358e-01   +7.250988327644531e-02   +6.270353286191066e-02   +1.898358983865561e-01   +2.348620767267968e-01   +1.712088539154892e-01   +8.154563812975126e-02   +2.355158364863400e-01   +7.392859270721053e-02   +3.006985309170310e-02   +2.381247682523689e-01   +1.815826811424661e-01];
L2I_L2E_iAMPA_netcon = [+1.498368578489614e-01   +2.036125153774164e-01   +2.217753828601540e-01   +2.332148258315807e-01   +8.081811156597905e-02   +2.580891883359726e-01   +2.142080830977209e-01   +1.219357660007039e-01; +4.112311221345939e-02   +1.838906525604061e-01   +1.340865540667465e-01   +1.593341695087071e-01   +8.961308221483898e-02   +9.116872875456950e-03   +2.022746325182276e-01   +1.666679820497529e-01; +1.187339706196303e-01   +5.603982421603403e-02   +2.375284391981949e-01   +1.562056266631247e-01   +1.342099713754533e-01   +2.517396532816928e-01   +2.630146486952127e-02   +4.108054669040175e-02; +7.597492897917152e-02   +1.963405160575794e-01   +2.195998068295154e-01   +1.844860760837799e-01   +2.597283683969373e-01   +2.482567087417979e-01   +1.582505425520156e-01   +2.332965617213446e-01; +7.121639975192015e-02   +2.714214196025116e-02   +2.356305983133461e-01   +2.522671868624020e-01   +2.110142309671253e-01   +2.782534556481771e-02   +1.559402204432384e-01   +2.102152620107794e-01; +4.828519889271270e-02   +2.118311518014331e-01   +1.826989948737022e-01   +1.394689851818264e-01   +1.526006404422217e-01   +1.951914291046153e-02   +1.599764359829996e-01   +2.176192650441400e-01; +2.353720044434090e-02   +1.849099118773405e-01   +1.485687129079734e-01   +1.025500031894978e-02   +2.355108514733590e-01   +1.055313352018778e-01   +1.987544208419186e-01   +2.202515148816928e-01; +2.151900658089465e-01   +8.686309801172673e-02   +1.616601271573146e-01   +1.803099524929184e-01   +4.288105085983675e-02   +2.075567914291047e-01   +1.130584289229280e-01   +1.151339059047483e-01];
L2E_L2I_iGABA_netcon = [+5.178342417981548e-02   +1.890439763037462e-01   +2.479330312329611e-01   +1.896504513311478e-01   +2.585093886705206e-01   +2.044278314617944e-01   +2.418627051488935e-01   +1.544767790544640e-02; +2.517122284337407e-01   +2.238309522806519e-01   +1.281477196637550e-01   +2.035415283241355e-01   +5.161548378257456e-04   +2.304519570597848e-01   +5.764116814613537e-02   +5.160601576998432e-02; +7.560836891644422e-02   +7.880256088732834e-02   +1.779695159761905e-01   +8.594849616570435e-02   +2.506197877355894e-01   +5.663877887376662e-02   +4.090722123285165e-02   +5.448329120101746e-02; +1.910959202931152e-01   +1.730712022746514e-01   +3.629025718089566e-02   +1.587960462522390e-01   +3.077934743977914e-02   +1.295768829088433e-01   +2.133468594329085e-01   +1.261568903910976e-01; +1.826905993483984e-01   +1.479731494106573e-01   +2.081495638638804e-01   +1.351070041426011e-01   +3.323399498507006e-02   +1.559775154907489e-01   +2.532626543587386e-01   +1.170474761674636e-01; +1.727790758658713e-01   +7.262289809600297e-02   +2.583176184369025e-01   +2.915190106088392e-02   +1.573262434263068e-01   +1.048310093160156e-01   +2.109177927643170e-01   +1.969009693530440e-01; +2.492598647618032e-01   +2.156076294215624e-02   +1.494747463567049e-01   +8.168829454532377e-02   +6.815833219767400e-02   +2.526768353203813e-01   +2.148868707556581e-01   +6.582245517936600e-02; +2.510303693435101e-01   +2.300289816487768e-01   +2.209239147075504e-01   +3.026073538918808e-02   +2.567266867789862e-01   +3.288796676205660e-02   +2.159700225871632e-01   +2.314579253674375e-01];
L3E_L2E_iAMPA_netcon = [+1.755815325188778e-01   +1.185130337143389e-02   +1.413173779058653e-01   +4.071532813762163e-02   -1.973919336724783e-03   +2.810691940143273e-02   +7.603857529436436e-02   +2.262488715338138e-01   +9.708832407911550e-02   +9.056900563867362e-03   +9.056281882398130e-02   +2.444306000759254e-01; +2.055914305934781e-01   +2.175678268987675e-01   +5.184777818530821e-03   +1.406933781035847e-01   +2.129190956953540e-01   +1.936673352419859e-01   +1.790229702446014e-01   +1.415308292516324e-01   +2.135145951843266e-01   +2.364314708239870e-02   +1.241492801712241e-01   +6.751587346789603e-02; +1.689240998152575e-01   +1.171199953716681e-01   +2.319334458790242e-01   +1.635424038142901e-01   +1.738976523800439e-01   +3.168477566379853e-02   +9.893850553049058e-02   +1.372592257537104e-01   +6.156484518534538e-02   +1.482486815120838e-01   +1.444379057805945e-01   +2.543352320353012e-01; +5.151746924681648e-02   +5.275333377628349e-03   +1.963654535499725e-01   +1.161475893857045e-01   +1.486926253788515e-01   +8.355024864020899e-02   +1.474987982353626e-01   +1.449331661218775e-01   +4.792132263496100e-02   +2.383747825083775e-01   +1.229208238689998e-01   +5.464439532664508e-02; +1.556558188505189e-01   +1.265841099234418e-01   +7.761501989600561e-02   +1.209351681403128e-01   +2.171652082904279e-01   +1.647840022723109e-01   +2.129519607545907e-01   +2.005818591160860e-01   +6.667648832408110e-02   +2.366864002585134e-01   +1.322642415599515e-01   +1.954269433634730e-01; +1.649035714282790e-01   +2.375645150593791e-01   +2.317041674260993e-01   +5.036532593873654e-02   +1.460726770691680e-01   +1.037511379159484e-01   +4.224264641232385e-02   +4.349871738806018e-02   +1.680923355588674e-01   +4.467262373952662e-02   +4.941754880907118e-02   +1.286539500098529e-01; +2.465319508222587e-01   +1.379541440023627e-01   +2.486947000477931e-01   +2.051306833212827e-01   +8.559709197191373e-02   +1.700271729017093e-01   +1.620404361020681e-01   +7.914729168807841e-02   +1.327763815719018e-01   +8.139148343046446e-03   +2.408519791566430e-01   +2.470309071537590e-01; +1.416398083568999e-01   +2.254557183614921e-01   +2.362642307664672e-01   +2.621494617365875e-01   +1.554514992104692e-02   +1.872334961362775e-01   +2.007157069574961e-01   +4.224889616821887e-02   +2.481960359846073e-01   +2.102704808399363e-01   +2.549890631453593e-02   +4.522224745775745e-02];
L3I_L2I_iGABA_netcon = [+2.062514681653570e-01   +1.711303323464126e-01   +1.141006676076815e-01   +2.303231508186166e-01   +2.126139818747683e-01   +2.472756197859902e-01   +1.711788806759612e-02   +2.609996316012469e-01   +2.284590661775279e-01   +1.144593912117876e-01   +3.624595142421019e-02   +4.356425091760938e-02; +1.853311923968831e-01   +1.160336788319066e-01   +1.757082283602166e-01   +1.715825828654002e-01   +1.686762453251488e-01   +1.570329091668359e-02   +5.920530763194816e-02   +2.406093757139658e-01   +9.737272828380021e-02   +1.724719864941155e-01   +1.897245507458375e-01   +1.432691796390124e-02; +4.905329105273653e-02   +1.358988745202999e-01   +2.194219918301815e-01   +2.574932064206730e-01   +7.331242872678286e-02   +2.252370638229331e-01   +1.458082305027548e-02   +1.046635806421828e-01   +1.319863826322537e-01   +8.793875168927133e-02   +2.631935201678008e-02   +1.260677605523996e-01; +2.014497062775587e-01   +9.444807454049482e-02   +2.440255760767636e-01   +2.549027497128701e-01   +4.460535131349691e-02   +1.885898710231931e-01   +1.622493472173724e-01   +1.611987199124128e-01   +1.689833875239875e-01   +8.458177651893016e-02   +1.730792410294996e-01   +1.981968844557972e-01; +5.833307527326751e-02   +2.494840867475770e-01   +2.157134486808883e-01   +9.414858393268286e-03   +1.099993640905907e-01   +2.119018656526147e-01   +1.463285019089098e-01   +2.441422227264027e-01   +6.060239448905858e-02   +1.816596075631650e-01   +1.952190354219265e-01   +1.460581553675931e-01; +8.645325489756035e-02   +1.958955623199755e-01   +1.740115668439141e-01   +1.669779562522808e-01   +2.551352189753680e-02   +8.008519193195830e-02   +1.507669074445597e-01   +2.005406956034536e-01   +2.519604525821827e-01   +6.937839467090857e-02   +1.361888927104872e-01   +8.912850743331707e-03; +1.798882008093814e-01   +1.491976044391091e-01   +1.424562200246186e-01   +1.867639668441948e-01   +1.509099846550822e-01   +8.949570119793751e-02   +4.020768561707622e-02   +5.846434642658808e-02   +6.274531255944987e-02   +2.274990622147456e-01   +2.415663472333491e-01   +1.931024231167827e-01; +1.694494230414101e-01   +2.237140081910194e-01   +1.922996384491532e-01   +2.514679831732046e-01   +2.564104576130543e-01   +3.987708287787339e-02   +2.256818757953762e-01   +2.204831825676257e-01   +1.773486784855420e-01   +2.555166842822120e-01   +1.723319119844104e-02   +1.280493472723055e-01];
L2E_L3E_iAMPA_netcon = [+1.069430346344939e-01   +2.269087063315031e-01   +8.697900255037948e-02   +2.490532619232800e-01   +1.390155190613705e-01   +1.719968380803592e-01   +1.767068503110468e-01   +1.071833842741262e-01; +8.559492114533114e-03   +6.049029694882561e-02   +1.712454667250368e-01   +9.376354191829633e-02   +1.043641267535441e-01   +1.374442496682997e-01   +2.105625003107511e-01   +2.351152645111272e-01; +2.495427921623334e-01   +8.801007276101297e-02   +1.028219304516776e-03   +1.272547950103046e-01   +1.566238146163563e-01   +2.434375232349470e-01   +1.267651026872922e-01   +1.599313683025317e-01; -6.137114033360590e-03   +2.033738900559205e-01   +8.973484594311731e-02   +2.481798856955990e-01   +2.144429064183766e-01   +2.163099988294101e-01   +7.972483054103190e-02   +1.996567426429711e-01; +1.235612711271068e-01   +7.738454697620566e-02   +4.709768616298557e-02   +1.623359006682205e-01   +1.729691709678254e-01   +1.739520917685906e-02   +3.599795062772055e-02   +1.560293101731340e-01; +2.021727375139339e-01   +5.445286870854101e-02   +3.279312698592968e-02   +8.232430098570297e-02   +2.672220185208146e-01   +2.177280356083191e-01   +5.671410179210004e-02   +1.078967382901664e-02; +1.871842922404166e-01   +1.406161778265830e-01   +1.520370108347737e-01   +1.548550387489310e-02   +1.260976438621110e-01   +2.179720645954926e-01   +2.531129698532332e-01   +1.107729498211156e-02; +1.199076428255261e-01   +1.955091041100787e-01   +2.051486165899636e-01   +6.822956949676270e-02   +1.506404409320649e-01   +1.533125220434236e-01   +1.466632688845654e-01   +1.895208457270113e-01; +7.443646803009839e-02   +1.181016516857726e-01   +1.621692614427091e-01   +2.908712041850330e-02   +1.674447825587894e-01   +6.823382596341382e-02   +1.009057635416515e-01   +2.365526809394207e-01; +7.170867867422175e-02   +1.601345338687251e-01   +1.502809567314199e-01   +8.540749005707017e-02   +6.092230578509730e-02   +1.474310650696707e-01   +1.651706550438992e-01   +1.151164440586437e-01; +1.096693937422129e-01   +6.726786941114561e-02   +2.238076469351844e-01   +2.168945581192913e-01   +1.197660187110433e-01   +1.245860867304896e-01   +2.599900535214623e-01   +7.918775575256845e-02; +5.874521992800624e-02   +1.189140053627048e-01   +1.356206956530314e-01   +2.418729061002995e-01   +7.024868395913011e-02   +1.481670480138553e-01   +1.129945802238945e-01   +9.909396648969204e-02];
L2I_L3I_iGABA_netcon = [+1.057938404648129e-01   +4.585512223145710e-02   +2.623223261963142e-01   +1.680732057689325e-01   +1.478058992472667e-01   +2.069773530251359e-01   +1.676843534239330e-01   +2.198315210543619e-01; +6.160271451743666e-02   +2.009032429516375e-01   +2.387470640708308e-01   +1.534945562229216e-01   +2.531785740251439e-01   +1.290375518867446e-01   +1.727481773027897e-01   +1.970881251270595e-01; +6.918455136230632e-02   +3.153574606560535e-02   +7.554710208170372e-02   +5.832626225785920e-02   +1.490782898257341e-02   +6.851585352940358e-02   +1.909777862960245e-01   +1.306454409946826e-01; +1.392418319078723e-01   +2.027339362929417e-01   +3.039107470611700e-02   +7.695309926022395e-02   +2.094578767802675e-02   +2.365165498260685e-01   +2.166268536110238e-01   +2.552410977440456e-01; +2.109330566365272e-01   +2.158243515242765e-01   +2.380250300689957e-01   +2.220829228509675e-01   +2.550180644663491e-01   +9.443745462751537e-03   +1.857290419017391e-01   +2.047119027690857e-01; +1.208217978646637e-01   +1.359925305816760e-02   +4.453265072216100e-02   +1.150268088361016e-01   +7.127535582957605e-02   +1.254292547950535e-01   +1.700839387955053e-02   +2.037790364035457e-01; +1.958380092956969e-02   +1.688670720539648e-01   +7.883295162141417e-02   +2.593264899292985e-01   +2.237765058575817e-01   +1.229057144685769e-01   +2.095556722894398e-01   +2.561228123115937e-01; +1.899283193008990e-02   +3.935100189802925e-02   +1.240965319077602e-01   +1.317386066177817e-01   +1.695782005884845e-04   +2.436625888421775e-01   +1.212783568573810e-02   +2.110969092324007e-02; +7.336388329580946e-02   +1.096667497259751e-01   +1.362555621570490e-01   +2.125447041964954e-02   +2.302176377475499e-01   +1.913759082746044e-02   +1.288296604838436e-01   +1.056157906064272e-01; +1.586760526609542e-01   -9.363368393023675e-04   +2.018888153230063e-01   +1.846068687055158e-01   +1.122108289825325e-01   +2.191980056185789e-01   +2.949314803327517e-02   +1.013061947205137e-01; +2.633188352089431e-01   +7.838222991620883e-02   +2.063206368696364e-01   +1.634514899506705e-01   +9.939796286460707e-02   +1.232392088232314e-01   +1.681625983322536e-01   +1.196555217362040e-01; +2.335363439682699e-01   +9.603935755523534e-02   +1.948592929960919e-01   +8.897812914327093e-02   +1.222615417628289e-01   +1.723616091793674e-01   +1.479601599140256e-02   +1.533244500677086e-01];
L3I_L3E_iAMPA_netcon = [+9.509843603543006e-02   +6.027592159519965e-02   +1.450355997172272e-01   +3.575617597917968e-02   +1.477155182615902e-01   +1.496145813305318e-01   +1.574782592286301e-01   +2.413658285996693e-01   +7.635871176186533e-02   +1.268478045203013e-01   +5.858986010113349e-03   +1.872008414489517e-01; +1.791022732678001e-01   +1.191524309221925e-01   +5.755020033569632e-02   +1.133735779188113e-01   +1.913420140558686e-01   +1.557213281086428e-02   +6.137615890556378e-02   +1.138958714264386e-01   +2.370257975665266e-01   +1.752675260730926e-01   +7.377497036041510e-02   +2.308688717719662e-01; +4.917962757485517e-02   +1.430737393490712e-02   +7.548926295665617e-02   +1.226274854708218e-01   +6.728703225387125e-02   +3.577233398207486e-02   +5.852704210744485e-02   +2.295268016899192e-01   +4.464576771277946e-02   +7.366983976702476e-02   +1.925295072684353e-01   +2.289326318135134e-01; +1.920187875078935e-01   +1.876517786062530e-01   +7.797246838324846e-02   +2.585303521661771e-01   +1.659814015787086e-01   +1.716213444157923e-01   +2.113337367123037e-01   +7.200457937395345e-02   +1.101835900785017e-02   +2.338231982141014e-01   +2.958372848080712e-02   +7.222131380649076e-02; +3.624555815760459e-02   +1.564599684771165e-01   +7.892906113991674e-02   +3.653800671664809e-02   +3.662647050385309e-02   +1.505809927396219e-01   +1.714812841594555e-01   +1.024043320317018e-01   +1.273442426672436e-01   +1.159672205009106e-01   +1.418034161727980e-01   +1.820424509894747e-01; +1.437236943295743e-01   +1.614981907025681e-01   +6.770810834111810e-02   +1.202827756224837e-01   +1.570568558186077e-01   +7.190556530812986e-02   +1.643002833321793e-01   +2.263651420484959e-01   +2.353186192942973e-01   +1.448112751528463e-03   +3.819300925646620e-02   +2.699877035245612e-02; +2.243347619887952e-01   +1.954425493661999e-01   +3.143371491249809e-02   +1.511463715126442e-01   +1.778322360494580e-01   +1.424836674159906e-01   +2.261820351915467e-01   +2.483926387044230e-01   +2.506142577505178e-01   +6.126345317689767e-02   +2.261154975503215e-01   +2.335715385975713e-01; +7.333288972659910e-02   +1.750295608991712e-02   +3.868870160530250e-02   +9.076039939629181e-03   +2.169826776813829e-01   +1.904041914187895e-01   +1.267334843304737e-01   +7.549623002843048e-02   +1.651807673634511e-01   +1.068269943966260e-02   +1.010444380993072e-01   +6.862272388095315e-02; +1.426534466639144e-01   +1.914787043024254e-02   +1.521733937655654e-02   +1.862073883326700e-01   +5.513911605413521e-02   +2.383822569364852e-01   +4.783258932609977e-03   +1.547861103691028e-01   +1.841421732087478e-01   +1.736583038517336e-01   +9.443413506983203e-02   +1.660391542920635e-01; +1.229410262429724e-01   +1.822707094068067e-01   +1.582778446271522e-01   +2.584662112360021e-01   +2.346511382614887e-01   +7.402478391141271e-02   +1.445973723611929e-01   +1.558212791181905e-01   +4.571694411079229e-02   +1.552122816878504e-01   +1.149279442874684e-01   +4.659758858816383e-02; +2.401532412342937e-02   +2.179542192519499e-01   +4.152392142735613e-02   +1.169540457505993e-02   +2.070452788273807e-01   +2.570669229347324e-01   +1.546934208258341e-01   +1.799621102762855e-01   +1.385973286280647e-01   +3.757294453488395e-02   +1.788897263712041e-01   +2.119311999107832e-02; +5.775378459359267e-02   +1.651729956437522e-01   +5.343129717028648e-02   +2.116976711101803e-01   +2.260178650094030e-01   +8.807982650929719e-02   +6.770519817144852e-02   +1.557425110600633e-01   +1.579936162030662e-02   +8.142302430757092e-02   +1.437934872775473e-01   +6.041016284868778e-02];
L3E_L3I_iGABA_netcon = [+2.113481239319577e-01   +1.557868359520675e-01   +6.369016891105748e-02   +1.418422669981362e-01   +1.491924044810604e-01   +3.565991189157747e-02   +1.450640261658231e-01   +2.055718285180436e-01   +1.514357652056892e-01   +5.943935623758360e-02   +6.409744024444566e-02   +1.553188055997855e-02; +1.653129293883221e-01   +3.526181810239390e-02   +8.228811702870603e-02   +2.289797307953049e-01   +1.007621994322490e-01   +2.340638263134474e-01   +1.867125111294438e-01   +2.018831669673417e-01   +7.510183999215959e-02   +1.091932821884888e-01   +1.261894964531395e-01   +1.251707088103850e-01; +5.838937225391520e-02   +7.261205577709982e-02   +2.575905852759485e-01   +2.023477497497654e-01   +2.108145997737075e-01   +6.350746151324441e-02   +1.245019175373859e-01   +2.256509784528348e-01   +1.990332573789064e-01   +1.265367032347097e-01   +2.319502118524455e-02   +6.228630711006545e-02; +7.312322001236142e-02   +1.016464315072989e-01   +2.329035002447170e-01   +1.889559043322356e-01   +4.843775424135366e-02   +2.052493996304013e-01   +8.412342352936414e-02   +1.486706143090156e-01   +9.282664454058696e-03   +2.416293379236610e-01   +2.547328923484227e-01   +9.841974620094536e-02; +2.009105323447457e-01   +1.169770914119934e-01   +2.019619078516445e-01   +7.314810494167058e-02   +1.689470554602766e-01   +7.555094109967755e-02   +2.505687649042280e-01   +9.289209501065589e-02   +2.073625899704978e-01   +1.285982881285979e-01   +1.081355248113246e-01   +1.194590721929204e-01; +2.456596046408761e-01   +1.013913822624461e-01   +1.487497908729616e-01   +4.102135359332480e-02   +2.074077778619163e-01   +2.511160731165181e-02   +2.155780908596969e-01   +7.290628789844436e-02   +4.502845075133311e-03   +6.657344090752586e-02   +1.990934753259953e-01   +6.273407013196952e-02; +1.657397410266268e-01   +1.916526609680480e-01   +9.532776945327559e-02   +5.239864269545591e-02   +4.660973878588678e-02   +2.529962538907394e-01   +3.521106831465740e-02   +2.431904375180724e-01   +1.673685262369414e-01   +1.972702969631461e-01   +9.130203468437750e-02   +6.738484537643033e-02; +7.383091305820373e-02   +1.310165486402365e-01   -5.581498326376145e-04   +2.442420957709509e-01   +4.448648482944174e-02   +9.729961077492498e-02   +5.524590257830049e-03   +3.891291426756879e-02   +2.020775940929743e-01   +1.923947467348744e-01   +1.260772886009045e-01   +1.245006827155173e-01; +2.027900081729940e-01   +5.404378202495995e-02   +2.153548684636741e-02   +1.814890550866848e-01   +1.222737262219130e-01   +2.256310239640101e-02   +1.583271422070864e-01   +8.682667634089430e-02   +2.327420632392386e-01   +2.327949805952534e-01   +5.775792012949385e-02   +2.625448367861617e-01; +1.470366583968236e-01   +2.524307345693421e-01   +2.622937290721354e-01   +1.839874812390636e-01   +4.174777821274961e-02   +2.158804496528720e-01   +1.075933270822987e-01   +7.458628416753205e-02   +1.462723124642678e-01   +2.434776448843479e-02   +1.716039334470996e-01   +2.518004010788730e-01; +2.993211358281710e-02   +1.233466106008534e-01   +2.325195912314711e-01   +1.527470811761305e-02   +1.401386803970938e-01   +2.203580802251172e-01   +1.707572797084199e-01   +7.706193143999064e-02   +6.862286095084533e-02   +1.214758008454184e-01   +2.050607943192328e-01   +2.423057061146210e-01; +1.924626411424995e-01   +3.773843366984565e-02   +1.730460760891501e-01   +1.985474960230824e-01   +2.292701804809561e-01   +3.674451383372812e-02   +1.875786555240200e-01   +1.991776598293020e-01   +1.184502088127389e-01   +2.030542699522835e-01   +9.002224473172987e-02   +1.227305593708959e-02];
L2E_Input1_iAMPA_netcon = [+1.742624771292725e-01   +1.338745943769324e-02   +3.288970923690062e-02   +2.340085418125852e-01   +5.908759658641411e-02   +2.341534076904635e-01   +2.198108329654068e-01   +1.325130647128493e-01];
L2I_Input2_iAMPA_netcon = [+2.264985484953778e-01   +5.062284706140827e-02   +2.539458449529084e-01   +2.265928701590727e-01   +1.746453781587379e-01   +2.317111874441935e-01   +9.378779918883053e-02   +2.017748214593156e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
