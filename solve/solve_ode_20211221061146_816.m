function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.330480556862544e-01   +1.154146030313580e-03   +5.918549140545519e-02   +2.273974566538219e-01   -2.277471510975754e-01   +5.701241914674103e-01   +2.103788487519464e-01   -4.759961788880993e-01   +1.385782392624114e-01   +2.500926629734644e-02   -3.388359030207069e-01   +7.384029436607026e-02   -3.080673797381584e-01   +2.107567145961880e-01   +1.161764400813639e-01   -5.375958092761748e-01; -9.915153640032096e-03   +2.523817112433800e-01   +2.198111245248470e-01   +6.620403626350003e-01   -6.155107092287745e-02   -3.248532897524997e-02   +2.115966785923173e-01   +5.341759357785469e-01   -4.354470082667921e-01   -3.219802423544115e-01   -7.337444939904815e-02   -3.886203475798840e-01   -3.271325507387333e-01   +2.203850106787348e-01   +3.568556631953673e-01   +1.538006911269952e-01; -1.014190875923998e-01   -4.926134141389434e-01   +6.348280154605979e-02   -1.621227453544902e-01   +4.562735477149770e-01   -2.914284902510889e-01   -1.843307313641552e-01   +7.056287647641929e-01   +8.042929391200676e-02   +2.555031873171604e-01   +1.190927841610019e-02   -2.807039727573594e-01   +2.446906710135071e-01   +2.570168601396823e-01   +3.323646468302491e-01   +1.895313172604474e-01; +1.085332398981831e-02   -8.714479762270913e-02   -4.999835589350463e-02   -4.666443505083116e-02   +1.923621578250597e-01   -2.684963172278901e-01   +1.987899032767711e-01   +1.485004431607084e-02   -1.303427216681662e-01   -1.653915591490234e-01   +9.121259339868787e-02   +3.979982459252509e-01   -1.757048188282246e-01   -5.805567713453424e-01   -4.197905161644911e-01   +1.111199327881441e-01; -3.521112151125697e-02   +4.471236771542341e-01   +6.568838313021986e-01   +1.731372779041926e-01   +3.240724396295297e-01   +9.290034596646092e-02   +8.001184802934774e-02   -1.488138864237288e-01   +2.996086026193997e-01   -3.970212998749623e-01   +1.413086832555584e-01   +1.589679057804152e-01   +2.336270646963788e-01   -9.183676998403811e-02   +6.197892530515365e-01   +9.984795813834343e-02; +2.569138001918800e-01   +2.807165458418192e-01   +2.312353837789430e-02   +1.447937811675830e-01   +1.083113080936834e-01   +2.784613828076266e-01   -1.649254348350624e-01   +2.604778960292335e-01   -1.651634759139928e-01   -2.788671011684644e-01   +2.180490253306158e-01   -1.835146334416263e-01   +2.010342198707279e-02   +1.662904425356963e-01   -1.852169246438912e-02   -1.197310513046938e-01; +5.017399325461712e-01   -1.105732812145795e-01   +1.556737810896176e-01   -6.579326479731967e-02   -2.274661100009463e-02   -1.997448422932811e-01   +3.653037939584496e-01   -1.104125772773911e-01   -9.694665438031665e-02   -5.361251254107692e-02   -2.932611590788055e-01   -2.091174492106763e-01   +5.050900558398737e-01   +2.580315149351793e-02   -3.821207990637614e-01   -5.232193523452071e-01; +2.838710636898197e-01   +5.258432389511036e-02   +5.315541163536762e-01   -2.828152737868758e-01   +3.325339960750934e-02   -7.638427921358648e-01   -3.647910112957069e-01   -3.714690952464901e-01   -3.828757981772740e-01   +3.103130628095883e-01   +3.368044141978802e-01   -1.621326060034077e-01   -5.391119203418203e-01   -2.593253933041566e-01   -7.152743735913328e-02   -1.881342380310927e-01; -4.255096144737785e-01   -6.295039085657784e-01   +3.026207619359062e-01   -5.562231568778278e-02   -5.013770889017268e-01   -1.863591549275960e-01   -2.357749213215942e-01   +2.714378647280572e-01   +4.647737597320539e-03   -2.131987087003235e-01   +4.214040326035808e-01   +1.591362308623480e-01   +4.173872046752958e-02   -5.685963847223133e-01   +2.073650358883543e-01   -3.141303768461706e-01; -1.524462154758641e-01   -5.698456284670780e-02   +2.609252871615463e-01   -2.102448775205985e-01   +6.841294055439676e-01   +3.462503598770042e-01   +2.796525255262258e-01   -2.173258781039965e-01   +5.888559825010670e-01   -3.684333524916305e-01   +2.268272138586083e-01   -2.616149022961421e-01   +4.765179921280507e-01   +6.327023394564957e-02   -1.230838770088628e-01   +4.829588875951773e-01; -3.220418560575988e-01   -1.874887879771109e-01   -6.263229682281385e-01   +6.452095882500237e-01   +7.855834405199709e-02   +1.886415485406222e-01   +1.649082053716131e-01   +8.993190847044792e-02   +1.444987637604273e-01   -3.688492952568752e-01   +2.061770790332168e-01   -7.436384133894367e-01   +1.267239693327302e-01   +8.470108068305371e-02   +1.437328405543738e-01   -5.387029275567754e-01; +3.402698298796014e-01   -4.124221952948436e-01   +7.928675855193329e-03   -1.182088575645719e-01   -3.234056958565187e-01   +3.692380341636591e-01   -3.025933131723608e-01   +2.932138901765144e-01   +4.903640987849360e-01   +2.380311158631821e-01   +2.091237977006444e-01   +3.438174386703579e-01   +2.112244513302120e-01   +4.519529248714552e-01   +1.756614526545470e-01   +5.890263842732744e-01; +3.500925312369022e-01   +2.361340664118433e-01   -4.622935616006258e-01   -1.128112697251084e-01   +8.047776103639417e-01   -5.020310010014413e-03   -7.770484224082644e-02   -2.743575622776679e-01   -3.349761205242060e-01   +4.298620640894228e-01   -3.890761786489354e-01   +3.589570216061072e-01   -1.257230531879678e-01   -1.598980245208821e-01   -5.332257943253400e-01   -1.952712836122993e-01; -3.413499943287999e-01   +5.214474519060726e-01   +1.291720885011963e-01   -3.034203116812718e-01   +6.047571907742946e-01   +6.502191850370409e-01   +6.544859034107783e-01   -2.427911161371454e-02   -6.991590752098356e-02   +6.938237163587930e-01   +1.733145794892904e-01   -5.107225682911154e-01   +6.202198607160106e-02   +2.233152583188699e-01   -4.265413475739064e-01   +2.320047110393343e-01; -1.144377378358707e-01   +3.362092312400414e-01   +1.012781785172158e-01   +3.899904701412357e-01   +3.350100889229354e-01   -1.475000733587863e-01   -5.257356923858765e-01   +3.886663564650653e-01   +5.588292130378534e-01   -3.950324590104549e-01   +1.055169225216654e-01   -9.793921662096972e-03   -6.928109080463452e-01   +1.565275791401236e-01   -1.436995824833161e-01   +4.056609980597372e-01; +6.738357309148499e-03   -2.534513479010622e-01   -1.701635935233767e-02   +2.585059699241023e-01   -7.148548409756867e-01   +1.166045538788321e-01   -4.952348360368207e-02   +5.267352419641257e-01   +1.814295921465124e-01   -3.547966564472144e-01   -4.551855770952574e-01   -3.083786107789874e-01   -2.143169681166691e-01   -3.135103856245109e-01   -3.120854786513956e-01   +1.825379152468093e-01];
L1E_L1I_iGABA_netcon = [+3.533062451739214e-01   +1.066366204159554e-01   +4.124362969004335e-01   -2.277526030452428e-01   +1.080280995020151e-01   +2.367896453033635e-02   -4.265523753059632e-01   +6.619630506862213e-01   +3.685931558850358e-01   -4.042399093228657e-01   +5.907129349870910e-02   +4.869411224146098e-02   +4.286935922952922e-01   -1.715956377923220e-02   +8.124305992263116e-02   -2.941634405699659e-02; -2.399400596240721e-01   -1.090756812265173e-01   +1.225888160232401e-01   +1.174327977376350e-01   -4.692904286404549e-01   -8.567071085071202e-01   -1.300093224537410e-02   -2.079824743499513e-01   -3.489975657348447e-01   -4.904178677153365e-02   -1.290141388742583e-01   -2.771067503334659e-01   -5.003435549894292e-01   +3.188372174065419e-01   -3.653604520524165e-02   -2.347284612439548e-01; +2.207569683496517e-01   -2.356354155331351e-01   +1.672375697886134e-01   -4.477364891626130e-01   +4.297390450432063e-02   -6.191223429540722e-01   +5.357305631143295e-01   -1.491793240586813e-01   -4.428972077524953e-01   -5.253470707893813e-01   +1.566414028822140e-01   -5.561093466566583e-01   +5.188225904461315e-01   -5.209115031881109e-01   -4.007363922067106e-01   -3.686423505557593e-01; -7.261230125737150e-02   -7.474395678810641e-02   +6.806231359402062e-02   -2.116733248454542e-01   +3.061261552727015e-01   -1.937384783816780e-01   -3.644922344154102e-01   -3.932442848068111e-01   +1.495427165210522e-01   +6.321354137434174e-02   -2.892566759018030e-01   -1.440648676325255e-01   +2.744714137005606e-01   -1.093306799929754e-01   +3.946386499328126e-01   +1.297307579105949e-01; +5.791028091568115e-02   +1.815366337461489e-01   -1.299972083798554e-01   -2.405431490951403e-01   -1.057714725100654e-01   +2.537500563844591e-01   +1.291466989722240e-01   +2.651937794379383e-01   -1.646128904361400e-01   +1.986396585112474e-01   +4.040243534620407e-01   +2.808936302432600e-01   -4.927845239228552e-01   -5.267052266688156e-01   +1.652779482153120e-01   +4.620801305960120e-01; -5.148663485888116e-02   -9.510012755853400e-02   +4.208026265387115e-01   +5.214819527146233e-01   -4.575306698791238e-01   +7.412033505711808e-01   -3.202780414751200e-01   +3.776195298435119e-01   +1.371198419214385e-01   -3.592651863412698e-01   +5.575256243797625e-01   -4.662113038078065e-02   +2.102939739992186e-01   +2.140209001224537e-01   -5.492263622783671e-01   +6.200884900844971e-01; -1.874521975724487e-01   -7.484560437250837e-01   -2.316787218858268e-01   -1.192769738833123e-01   -2.521123426092128e-01   +1.328008644794946e-01   +2.347417426954661e-01   +3.186766026158969e-01   +1.833977321785339e-01   -1.044990127337168e-01   -8.860061920746276e-02   -6.229314777322438e-01   -3.185111955403497e-03   +2.794847477002715e-01   +1.107524427341471e-01   +7.879121864978432e-02; +1.219008999969322e-01   +2.927480524137135e-01   -1.767596039140462e-01   -6.135741565648736e-03   -6.593405033085343e-01   -4.501080380113229e-01   -8.151255935426883e-02   +1.962483242902356e-01   -4.006902175643628e-02   -6.771823601749496e-02   -1.873134851972987e-01   -3.747582974842268e-01   -1.506029617618622e-01   -2.372390040728318e-01   -2.431704040849021e-01   +2.026245594342553e-01; +8.818298328468938e-02   +2.570462367772201e-03   +2.540655176453611e-01   +7.071951393108986e-01   +9.960818064508839e-02   +5.523687912190421e-01   -5.519864174695688e-01   +1.900639764391961e-01   -2.855177173003293e-03   +3.693416653486284e-02   -5.571124231358144e-01   +7.718025745466485e-02   -5.779490873791645e-02   -2.054729410518423e-01   +1.073066550101862e-01   +3.832233136539122e-01; +1.910656425987110e-01   -6.063068898246406e-01   -3.617524105039894e-01   -1.785650380217921e-02   +4.185835314431400e-01   -1.817032369674884e-01   +2.123685735047151e-01   -6.228812689814640e-02   +5.973939166757276e-01   -3.880669732072131e-01   +3.835268303156906e-01   +6.045682409876252e-01   +4.460644995769562e-02   -2.208542158216849e-01   +2.898108255119186e-01   -4.656533095925239e-02; +1.026926074361293e-01   +1.674259282145277e-01   +5.851333780986393e-01   +2.500964997619968e-01   -1.525563647073136e-01   -1.585049901633387e-01   -2.317179323632674e-01   -4.820787290662058e-01   +3.728648836098579e-01   +2.092340979213862e-01   +2.916093415701137e-01   -3.512367982399933e-02   -1.992742738245127e-01   +4.693956326965705e-01   +3.517032747901633e-01   +4.675487959260489e-01; -9.392187168186096e-01   +4.170122229264109e-01   +3.065226179766023e-01   -3.661479002440253e-01   +6.809998910246585e-01   +3.200140587596768e-01   +1.071288796084449e-01   +2.786130641562243e-01   +5.914044496778126e-01   -2.122269745914168e-01   -5.420179825466978e-01   +9.634269120033018e-02   -6.600236256374264e-01   +1.585207808621406e-01   -6.095486159658583e-01   -6.470518413749439e-01; -3.255013789430743e-01   -3.020917753354172e-01   +3.861863842731411e-01   +5.987694360265561e-02   -3.073047695015496e-02   -3.725280277909839e-01   +5.558387176543605e-01   -5.416833434199588e-01   -1.262661395495145e-01   +1.954606136183457e-01   -5.228587215176528e-01   -7.715396484532016e-01   +1.621733299768827e-02   +2.901925535420083e-01   +2.700184428104656e-01   -4.692524449896597e-01; -5.140937346595890e-01   -1.266867004555471e-01   -4.145861109006662e-01   -3.384963764977435e-01   -2.230928762508769e-01   -5.885209859147519e-01   +5.105860188008579e-01   +4.818412725754283e-01   -2.059331315467943e-01   -3.492834531806892e-01   -2.435015862648147e-01   -1.305594222380956e-01   +3.191654750415813e-01   -4.120281475040452e-02   -4.175121284093350e-02   +7.818577102355880e-01; +3.799284048225151e-01   +6.924459254782678e-01   -1.358509775584002e-01   +2.376274181842415e-01   -3.089806279010101e-01   +8.664211862669766e-02   -1.596512051301280e-02   +4.367644345573195e-01   +1.417370104052828e-01   -2.000871856781528e-01   -4.792962732009877e-01   +5.176166022186237e-01   +6.805422464490206e-01   +3.488183333300701e-01   +1.330493669413398e-01   +3.937031057829689e-01; -1.471871170808553e-01   +4.604538363515779e-01   +2.062324643997422e-01   -5.436309401276702e-01   -7.676784785548421e-02   -2.343358320717822e-01   +4.453070161542532e-01   -5.947711029321806e-01   -9.344849953219786e-02   -2.074037693896124e-01   +9.841426755985477e-02   +2.921633241119638e-01   -3.733036985477973e-01   +9.816034158996855e-01   +1.563929974234796e-01   -3.360938360487378e-01];
L2I_L1I_iGABA_netcon = [-8.110160338675575e-02   -2.327078493446976e-01   -3.283850662531087e-01   -8.609271420640233e-02   +4.415859590613831e-01   -4.323604263454245e-01   +5.029829076867186e-02   -1.185123762617080e-01; -1.891201686282342e-01   -5.796033814560856e-01   +4.989410095300342e-02   -1.611674530285601e-01   +5.244756669655748e-01   +9.162813808519975e-02   -1.380248921338512e-01   -4.733837099165968e-01; -1.538099809899601e-01   +2.871350077510801e-02   -5.160346700601059e-03   -3.068330823851436e-01   +1.235417747428794e-01   +9.244499037074697e-01   +1.509369442762389e-01   -2.636439564340606e-01; +5.003121635869099e-01   +1.849315676453419e-01   +5.316290014560078e-02   +4.962327842705628e-01   +5.318816777341728e-01   -7.159144464511660e-02   -1.085916171439786e-01   -6.433913926190482e-02; +5.574904029939923e-02   -3.085179593001048e-01   +7.964280388055434e-01   -3.964809004765507e-01   -1.625900011170140e-01   -1.777443177999825e-01   -1.399813843268701e-01   -2.270241270082490e-01; -2.575813181529544e-01   -3.437566320939653e-01   -2.309562269224166e-01   +4.033174646881377e-01   +9.991069338675937e-02   -2.993878061860220e-01   +4.258437600947496e-01   -1.391691809840487e-01; -4.781106752263546e-01   +4.982249699700342e-01   +6.555130379864119e-03   +2.540717849459827e-02   +2.964084799066264e-01   +6.435456394669529e-01   -1.026161773061514e-01   +1.519172946932658e-01; -1.486275730927292e-01   -1.586128099206582e-01   -2.349420673336740e-01   +3.773433398287668e-01   -1.358280582822814e-01   -6.133676607025846e-01   +3.400105102811555e-01   +2.732470255635967e-01; -4.586439614662988e-02   +1.205121358686645e-01   +3.619589023489063e-01   -4.166894395410938e-01   -1.751682000971488e-01   +6.981877825173055e-01   -5.235486301031090e-01   -1.931090660492870e-01; +9.317675649650403e-02   -6.897086890970652e-01   -4.629658787151346e-01   -6.180200484549410e-02   +2.315429025880855e-01   -2.157329958882044e-01   +9.735110490734004e-02   +3.416729405277774e-01; +1.260522912722323e-01   +2.466128585081172e-02   +1.020257676302852e-01   +3.557089091394231e-01   -1.035391609202995e-01   +4.769611646409546e-01   -7.350835674838069e-01   -2.068218907583789e-01; +1.789385597239107e-01   -1.915093805124146e-01   -1.026714250589004e-01   +3.969363675937282e-02   -3.075270610741481e-01   -2.003482822999233e-01   -7.277428365817141e-01   +5.224369982754040e-01; -1.719899098787935e-01   -4.875763372970300e-02   +2.260110430929942e-01   -2.503306828711753e-01   -5.462552059745656e-02   +5.622652133665806e-01   -1.210844010746562e-01   +7.662486866926133e-02; -1.442848378308418e-01   +7.026710176551343e-02   -4.048368383316804e-01   +8.880989946826882e-01   -2.531304862334114e-01   -2.668131838319184e-01   +9.650006606842398e-03   +4.508123466375596e-01; +2.692532356620763e-01   +3.718109670721913e-01   -2.203132271518675e-01   -2.987753082895699e-01   +9.396068391835630e-02   +2.708231294036479e-01   +2.847613057660202e-01   +1.977751292426738e-01; -4.944175475091654e-01   -5.408613481700509e-01   -1.389406974836592e-01   -4.940818632475845e-01   +1.621924268335336e-01   -4.120742867123409e-01   -6.225090017174542e-02   +3.641087600264902e-01];
L1I_L2I_iGABA_netcon = [-2.528603833134467e-01   +6.151024873795597e-01   +3.343228068674708e-02   -7.105462184425159e-01   -8.681765607106276e-02   -2.232122564141431e-01   +8.154611774135198e-02   -2.972782555840575e-01   -3.030609694153894e-01   +4.538085217847927e-01   +4.328826497516034e-01   +3.187479749601859e-01   -4.575614639574190e-01   -3.042823698207733e-01   +4.455713803124650e-03   -4.052109416493586e-01; +1.994042016319132e-01   +1.956704836037673e-01   -4.282006289552874e-01   +2.774423278602343e-01   -1.258699190734895e-01   +2.417185182652482e-01   -4.012738233438724e-01   -2.706166604136736e-01   -5.885558605832489e-02   -6.864133601608940e-01   -3.098673872541107e-01   +2.469780620638588e-01   -3.577274179949499e-01   -6.257686946061516e-01   -2.533956503743849e-01   +2.596858921729346e-01; +4.995400779918351e-01   -7.259028847420519e-02   +6.654873838485748e-01   +6.876099427875118e-02   -6.110558054008661e-03   -5.690217231509477e-01   -3.544286186334060e-01   -6.991710686580760e-01   +4.001373293923554e-01   +4.217565672763576e-01   -8.332891206789485e-02   -1.897902293464782e-02   +1.828875102401473e-01   -9.482940506005944e-02   +1.461473205651088e-01   -5.098512892594653e-02; -1.314393703625628e-01   -3.438001756101736e-01   -9.511640102801341e-02   -7.322975886498317e-02   -1.345367250328762e-01   +1.902414098201604e-01   -4.053972779305833e-01   +3.805141847625815e-01   -2.553185142386459e-01   +4.090067011656673e-02   +3.509530908410178e-01   +5.943431471555244e-01   +2.783497213321930e-02   +1.456707761273635e-01   -3.496526338397422e-01   +3.567644055515891e-01; +4.864763571544471e-01   -2.282061652628348e-01   +9.156734325820354e-01   -1.743664185313243e-01   +8.747804101215028e-01   -1.837430217835954e-01   +1.987286181884662e-01   +4.007366501701915e-01   +5.476952308855754e-01   +1.917783701312278e-02   -2.340551276586280e-01   +2.132714678892237e-01   -3.312811083301662e-01   -2.895146708421707e-02   +5.924236689343967e-01   +5.609992719671439e-01; +2.566265484748576e-01   -5.883425261702119e-01   -7.084166140667966e-02   +4.559647590751655e-01   -1.260595981721451e-01   +7.024337744829078e-01   -2.249145001784778e-01   -6.725278849196215e-02   -4.378558818436312e-02   -3.016108573190528e-01   -9.978014911020101e-02   -5.179023494410265e-01   +3.642467662505177e-01   +1.396108142568374e-01   +5.594842977613218e-01   +2.874757079149749e-02; +4.567051636457959e-01   +1.492578734596248e-01   -1.468420705951871e-02   -1.216143085257605e-02   -1.200623858373607e-01   +5.109505587442333e-01   +8.157164486739615e-03   -1.674614377931110e-01   +2.451131411260231e-01   -6.650708488862036e-01   -5.191009972672029e-01   +1.124069730672476e-01   +5.519290648225889e-01   -1.875008993787888e-01   +6.808276265636437e-02   +2.498411381831721e-01; +8.967162607069390e-02   -2.712212735006858e-01   +3.693703475065345e-01   +8.427403379154430e-03   -3.231761645047272e-01   -2.690038302352790e-02   +3.571730022170863e-01   +4.094931064841443e-01   -3.998924887611745e-01   +2.061976608407955e-01   -1.578756110507627e-01   -2.702390179781677e-01   -3.678908186555893e-01   +4.584035769395141e-01   -2.212306769823133e-01   -1.214705167725440e-01];
L2E_L1E_iAMPA_netcon = [-8.795432641271272e-02   +4.119804258227504e-01   -2.778168101581878e-01   -2.294598075483776e-01   -1.547280046422598e-01   +6.151787409627073e-01   -7.081510302093252e-02   +5.667892569220396e-01; +1.317444917244770e-01   -1.326677128069926e-02   -7.533536101094630e-01   +4.229702397200494e-01   -3.217522856237794e-01   +3.453944777374490e-01   +4.514625791328596e-01   -4.660831278575980e-02; -1.204915210825347e-01   +4.281216716353148e-01   -3.211442543820997e-03   +6.720435366197942e-01   +5.847885313730703e-01   -3.192979892915858e-01   -3.179754504066061e-01   -2.618963857161408e-01; -3.224627926904398e-01   -9.331612819336252e-02   +1.301589430354166e-01   +9.127500606413065e-01   +4.978241805919192e-01   -6.027442455201083e-01   -5.325313456183386e-01   +3.398909838208233e-02; -1.868323088427693e-01   -7.181315138508370e-01   +8.770346784335765e-02   -1.612433484683903e-01   -9.945735265486921e-02   -1.411114576095928e-01   -2.108594811678043e-01   -6.666637079137248e-01; +5.446226053167313e-01   -6.373802232731977e-01   +3.149958593026962e-01   +1.776390636842050e-02   -1.550974412235076e-01   +8.352330812029757e-02   -1.064054083615118e-02   +2.302139505446053e-01; +3.943038977282861e-01   +5.025134211988104e-01   -6.890487221538084e-01   -1.244512644825958e-01   +2.744668607684580e-01   +3.742215110186445e-01   -1.133768198475560e-02   +2.344356176088407e-01; -3.512704858720408e-02   -2.688900760813245e-01   -4.031393076624155e-01   +1.687356462223575e-01   +6.914123734579436e-02   +3.328266255257574e-01   +4.391005309256993e-02   +1.953711508253481e-01; -4.201526864301984e-01   +2.779707798087145e-01   +3.624868884186195e-01   -1.710923735987361e-01   +6.959895917875870e-01   -8.707385602770208e-01   +1.904093297767830e-02   -1.422177484112996e-01; +2.737843265049081e-01   -3.447659756204849e-01   -1.245990505241918e-01   +2.837992884016384e-02   -2.520890209005898e-01   -2.416885741735856e-01   -1.273425607819301e-01   +2.477236704030358e-01; -2.844579290203939e-01   -1.364685074487144e-01   -6.047305263247137e-02   -4.870283522044279e-01   +3.014532705201097e-01   +6.906168437542859e-02   -4.275551977458092e-01   +4.633776542750332e-01; -3.198608052846242e-01   +3.190671360906164e-01   +7.047637533364958e-01   -6.924950348344409e-01   -4.203340468524872e-01   +4.890136528125031e-01   +1.388144920485797e-01   +3.018271425901393e-01; +2.653980012606752e-01   +2.344495204339850e-01   -2.742616902593813e-01   -2.113549147890954e-01   -1.015296641937815e-01   +4.824783437558605e-02   -6.417678489883928e-01   -3.780966577039563e-01; -3.285993553138332e-01   -6.407456892465020e-02   +5.589097551906709e-01   +3.474626579444945e-01   -1.890650276902269e-01   +1.696408779763548e-01   +9.032725196775346e-02   +7.727457448578776e-02; -3.605522209252869e-01   -3.926304267921482e-01   -6.147713297835445e-01   -1.608451692666722e-01   -6.155646933380696e-02   -4.774218331663320e-01   -4.117217088145479e-01   +3.824746805299445e-01; +8.006126911542243e-01   -5.112459235292702e-01   +3.514928740428279e-01   -1.642376773195793e-01   +6.597541319878053e-03   -9.600081149845259e-02   +6.554985327739068e-01   -5.507499860433835e-01];
L1E_L2E_iAMPA_netcon = [+3.773563613961913e-01   +6.334739544360261e-01   -1.892398088730811e-01   +1.198688407144518e-02   +9.911851230935034e-03   -4.577772881025603e-02   -1.857956673090985e-01   -7.075137648951463e-01   +3.609971961057101e-01   +1.192940814620979e-01   +2.409785311541639e-01   -4.058799410474850e-01   +1.406545900247427e-01   -1.102326771675551e-03   +6.824145395576886e-02   -3.377012272759577e-01; +2.450632512206833e-02   -1.501868097472116e-01   -6.665016377744869e-01   +1.846005639802815e-01   -4.014824253670393e-01   -6.256466902443730e-01   +2.985668103707851e-01   -5.218027735906642e-01   +3.690419654644304e-01   -3.672693646519021e-02   -3.455570361369568e-01   +6.367174500541168e-01   -1.397190629157862e-01   -1.083365535476880e-01   -4.754339188902771e-01   -4.221720620798292e-01; -4.537044383612938e-01   -6.724998539068487e-01   -1.751895225250165e-01   +6.158288520722465e-01   -1.352198725218831e-02   -4.863414702209328e-01   +4.220819949297100e-01   +2.039515139807368e-01   -1.617082539447256e-01   +3.397556199440287e-02   -3.494794157623651e-01   -6.783014823914946e-01   -1.000000000000000e+00   -2.344418871214361e-01   +2.916824533796653e-01   -3.085543143666069e-01; +7.218638119393190e-01   +1.734303313449958e-01   -2.666149528040058e-01   -5.366678855580129e-01   -3.687222307850920e-01   -3.904639856510191e-01   +3.190975890153961e-02   +4.489116167317614e-01   +6.419556721071743e-01   +1.438106087973280e-01   +2.675150353192044e-02   -3.869943983001853e-02   +3.556101439035405e-01   -1.516972376690289e-01   -7.690566135974534e-01   -3.425250560351403e-01; +3.819580140745383e-01   -5.641829582412421e-01   +6.079145318892033e-01   -1.553882149678603e-01   -2.468838823110586e-01   -2.037138977917884e-01   -5.235535357106466e-01   +1.631257447599590e-01   +4.012160020055264e-01   +5.166745259723173e-01   -5.544238112492053e-01   -6.690143790881825e-02   +2.670768596166186e-02   +1.516556581316250e-01   -4.253534828072990e-01   -5.446041021307310e-01; +3.052407255266947e-02   +6.836162795325261e-01   -3.930561751551707e-01   +1.482960486599005e-01   +2.606472419791828e-01   -2.465081315634890e-01   -3.947785049429128e-01   +7.482246415257109e-01   +1.722505906881510e-03   -2.901749255818668e-02   +5.899028207312966e-01   +1.998577677634435e-02   +2.399765954165121e-01   -2.727865476773301e-01   -4.509394850568603e-01   -3.092081338391744e-01; +3.212284447857949e-01   -3.216172694871111e-02   -9.972974118254156e-02   +7.273121230613251e-01   -1.796732823107928e-01   -1.772258153614574e-01   -5.421447815698016e-01   +2.402254425202033e-01   -3.920746439034307e-01   -1.814853569388335e-02   +4.063960851087798e-03   +2.867188007683659e-01   -2.096008769684353e-01   +2.536912385955821e-01   -4.096482573146804e-01   +2.901574013849862e-01; -6.476608519541424e-02   +5.548768534192302e-01   +4.897279065658652e-01   -3.941796507778433e-02   -8.262726230751087e-01   -1.394321720316785e-02   -8.040330514148933e-02   -6.775706327312342e-01   -5.008586484106158e-01   -2.808272545191286e-01   -1.640303573568069e-01   +1.873936288810771e-01   -1.192277949966658e-02   -8.619934008318442e-02   +1.661715259589298e-01   -5.348002513035708e-01];
L2I_L2E_iAMPA_netcon = [+2.452965366192269e-01   +1.764302255202219e-01   +6.328916379949860e-02   -7.872158620182296e-02   -1.492613274395366e-01   -1.398557868069467e-02   -1.882328256899363e-01   +5.703333961653141e-01; +8.246372934810225e-02   -4.259623811886613e-02   +5.366522910042071e-01   -1.982548275182482e-01   -4.282017572149447e-01   -3.276556455355932e-01   +2.817111937251358e-01   -2.649004695424617e-01; -3.081650914263531e-01   -5.294639063107320e-01   +1.220512820000741e-01   -1.463549430164011e-01   +6.297996996508812e-02   +2.186998727883943e-01   -2.865817908284545e-01   +7.573236858649883e-01; +9.545538466699405e-02   +5.088448970612712e-01   -1.607543165366192e-01   -3.262034106948319e-01   +3.200998935754672e-01   +3.123001992626007e-01   +2.025267253223861e-01   -4.211290505125954e-01; -8.911255063623752e-03   -3.023902696963995e-01   +6.920080610973030e-02   -7.149665974508000e-01   -5.948130233858443e-01   -5.870636179930343e-01   +2.869487393968025e-01   +6.981486494192695e-01; +3.823459527017500e-01   -1.245029000337390e-01   -3.399597805782399e-02   -5.300997174699013e-01   -5.333001734286758e-02   +2.891459410750239e-01   +3.711203498015527e-02   +1.501042421713602e-01; +3.722218547088718e-01   -7.723899953143718e-01   -7.421410639822423e-02   +3.112746987181509e-01   +3.783089310929057e-01   +2.375108893998557e-01   -7.006142207234549e-01   -2.310982099385789e-01; +1.366749309236942e-01   -3.564707369268171e-01   -2.849930230893893e-01   -2.941944988767043e-02   +2.002484091712411e-02   +6.190932565258078e-02   -8.720407770856761e-01   +3.519556973181602e-01];
L2E_L2I_iGABA_netcon = [+7.185230088299386e-01   -2.908623636514132e-01   -6.117570733105855e-01   -6.671034711119639e-01   +1.520558656414441e-01   -2.503971308683312e-02   -7.628580965234819e-01   +4.459955882422102e-01; +3.530390341273930e-01   -6.594092608687955e-01   +7.574010507845855e-02   -1.652921752977665e-01   -8.206978948396251e-02   +5.871779393599562e-02   +7.654667528558320e-01   +1.411472033572923e-01; -2.444754607289576e-01   -1.175048937355908e-01   +6.134686723722715e-01   -8.446173848140859e-02   -2.694567875051999e-01   -8.561409425902585e-01   +1.781089914358384e-01   -4.668947274643213e-01; -1.368113751586123e-01   -5.430241651355985e-01   -4.275231857890799e-02   +1.120340326910108e-01   -4.386605638436800e-01   -1.359911717463757e-01   -4.466867311761042e-01   -1.793204887060267e-01; +2.810844886272085e-01   -6.513220116701723e-02   +4.968265605357690e-01   +3.057192554150487e-01   +3.955153805245422e-01   -5.251375329203498e-01   +5.932199713686885e-01   +3.477663764923430e-02; -2.576656967292691e-01   +2.296860860138619e-01   +4.877052959688947e-01   +2.743537769834765e-01   +9.878500671444049e-02   +3.656118354036707e-01   -2.041382098459589e-01   +2.142105674023931e-01; -3.390919508380196e-01   -1.064051806596678e-01   -8.802669078278598e-01   -4.915605122874871e-01   -4.313381163145437e-01   +6.133988946531495e-01   +5.939358174024687e-01   -3.805216271450276e-01; +4.594332095182299e-01   +1.317889419237890e-01   +4.877999355539536e-01   +3.248458736380283e-02   +6.980362507962558e-01   -8.698008592791364e-01   +2.663607191087903e-01   +4.261458695481321e-02];
L3E_L2E_iAMPA_netcon = [+5.377907039535196e-01   -6.257855616190744e-01   -1.276932492965544e-01   +1.309943225995163e-02   +1.019804088945307e-01   -8.063779963702361e-03   +1.225675223890587e-01   +1.464896049315928e-01   +3.965662804986392e-01   +1.010951517346123e-01   -2.223716973896364e-01   +5.193207683792902e-01; +3.381231169431049e-02   -2.890551732142697e-01   -3.212889937902730e-01   -2.495028953057783e-02   +3.000878721596416e-01   -5.211586394064154e-01   +3.057052229348419e-01   +4.845635385181255e-02   -2.622142602701087e-01   +9.713181976493284e-01   -2.981580423193007e-01   +2.962612371344039e-02; +3.152342993204932e-01   -1.610585345350855e-01   -1.138619130078870e-01   -2.284166108454155e-01   -6.898350652110795e-01   +1.368816646557995e-01   +7.873242823930939e-01   -3.039974385217780e-01   -5.663257369711039e-01   -9.634457641986820e-02   -1.957370491422225e-01   +2.757068288255056e-01; -3.712955237030409e-01   -6.065196807572981e-01   -9.651702094126261e-01   -3.434012250236976e-01   +6.393001940729584e-02   -4.072690296515891e-02   +3.380757025756546e-01   +4.017590349635454e-01   +8.632798115108901e-01   -2.584138600453990e-01   +7.275549110094531e-01   -1.909710495788632e-01; +4.554466401420145e-01   -2.168982202108677e-01   -4.795462631255185e-01   -4.208412049358604e-01   +2.613695646296522e-01   +3.808549552642255e-01   -1.818382099996305e-01   +6.683006314547516e-01   +2.525697834855752e-01   +2.488138078879614e-01   -4.291293909898651e-01   +2.045335982078392e-01; -2.437095857911348e-01   -4.057052670661092e-01   +1.952254566727642e-01   -1.092526035246356e-01   +4.226421850556251e-01   +6.115537511512705e-01   +3.036459777933675e-01   +5.519193080596756e-01   +4.693937708225672e-01   -1.174210266466348e-01   -5.453964802781028e-02   -5.165059649803558e-01; -2.759476532068078e-01   +1.361045381214320e-01   +4.373137010071360e-04   -4.457568377726160e-01   -3.668807942995770e-01   +5.244870367531983e-01   -3.488425662693859e-01   -3.990307490064008e-01   -3.679227606320332e-01   +2.052040620094131e-01   +8.351625082178782e-01   -8.095092267471360e-02; -2.279367530714289e-01   -1.979384873083102e-01   +2.737599643258894e-01   -3.331159040966558e-02   -8.902340353858373e-02   +1.150548148589589e-01   +3.415509164386458e-01   +2.462243949825496e-01   +4.828741946562681e-01   +3.286828732344269e-02   +2.423051718335918e-01   +6.893375473168322e-01];
L3I_L2I_iGABA_netcon = [+5.911909532122578e-02   +9.425818124193908e-01   -6.598284918989156e-02   +1.513325870440010e-01   -3.823888194225415e-01   -5.988481916931783e-02   -1.256805115466695e-01   +1.525228006479034e-01   +2.750025721384895e-01   -2.175054445673743e-01   +5.532364914040182e-01   +4.658983104283863e-02; +1.424423156598063e-01   -2.156871205024890e-01   +2.472635675261820e-01   +2.573786808702564e-01   +6.115305770156608e-01   +5.500662815563459e-02   -3.040994631010155e-01   -2.578562542839123e-01   -6.424886459566326e-02   +1.264511584503788e-01   -1.800882057362285e-01   -1.244422191561736e-01; +5.651921760061211e-02   +4.470541104238507e-01   -3.233418874979425e-01   -1.564815304763401e-01   +1.331394889078122e-01   -9.474928564309479e-02   +1.509164965817054e-01   -3.454854969221929e-02   -6.395758449197014e-01   -6.194461580305136e-01   +9.070441928965757e-01   +4.176992290402421e-01; +8.118821606513134e-01   -1.967427581772178e-01   -1.157323996180655e-01   +3.866429213531739e-01   +5.213689538861903e-01   +5.446589286318163e-01   +4.797007212549612e-01   +2.255560458072708e-01   +3.098768338839327e-01   -4.565576136674523e-01   +9.054479581344596e-02   +1.117077980956675e-01; -4.714252208139732e-01   +2.338205729602440e-01   -3.534113897065292e-01   +1.141728599562930e-01   -4.794211991775232e-01   +1.930952330550500e-01   -4.957298983377856e-02   -3.949723678282860e-02   -1.314794179633800e-01   -2.341047632783102e-01   +1.927777487091724e-01   +1.878688485382169e-01; +5.553764418487598e-01   +3.402232214406217e-02   -4.003736514817411e-01   +3.152833149718174e-01   -7.051039654434812e-01   +4.051742235929506e-01   -3.612153347852624e-02   +1.737532456005061e-01   +5.707945537446294e-02   -2.484237775101197e-01   +4.435181840382481e-01   -2.816936435267992e-02; +5.123414892693753e-01   +2.873981592211755e-02   -3.156287133133361e-01   +3.131347957930692e-01   -1.412179666916868e-02   -7.669977358903649e-02   -1.304290737788406e-01   -2.741721796081046e-01   +3.430168740182786e-01   +5.568501472028868e-01   +8.053057614813568e-01   -4.124957104055508e-01; -1.006067140701458e-01   +3.344137725756836e-01   +7.506120236283348e-02   -2.567033600664901e-01   -3.866238118005113e-01   +4.453417821040656e-01   -3.102715104488917e-01   -7.918480895975802e-02   +1.117347717832740e-01   +1.697874863061833e-01   +9.166930493161274e-02   +2.757692073880468e-01];
L2E_L3E_iAMPA_netcon = [+5.000504393719160e-02   +9.853803811231764e-02   -5.499718113346798e-01   +2.123776903003918e-01   +5.121766562904680e-02   +5.424839358158181e-01   -6.025851361235474e-01   -3.905356749825438e-01; +8.754144491573095e-01   +2.827875915035406e-01   -3.878324939753388e-01   +3.822244356641178e-01   +4.986504711874735e-01   +4.587405565037350e-02   -3.668586722780074e-01   +3.133287562921231e-01; -2.399035151839321e-01   -5.690581517356229e-01   +4.720462106049773e-01   -1.632551548655323e-01   +4.392492677668093e-01   -8.703114473577866e-02   +4.487720007935174e-01   -3.408302754207757e-02; +1.013957635166485e-01   +4.395898431082506e-01   +1.421563790361041e-01   +6.270602504560506e-02   +7.503669695113378e-02   +8.310137170806299e-02   -2.108225705617848e-01   +1.053658935571973e-01; +1.478703373916364e-01   +9.307446448905890e-02   -7.668921444226953e-01   +6.343669403930727e-02   +6.207590791750697e-02   -6.390665151894891e-01   -6.938944424742513e-02   +2.778561650933783e-01; +7.545274281636759e-01   -1.151070158233566e-01   -2.927808416894533e-01   +5.003790009326400e-01   -3.102772695125194e-01   +4.914863671039934e-01   -9.525679743783645e-02   -2.794033924558105e-02; +5.878060759201869e-01   +2.349080933636383e-01   +3.727883348393271e-01   +8.506940402105197e-02   +1.325073398340631e-01   -6.343115789344356e-02   +7.759319547331883e-02   -7.326709967747413e-01; -2.748552082083628e-01   -3.846343565499215e-01   +4.858774019082871e-01   -4.488660049184174e-01   -3.916936663364950e-02   -3.168056699243639e-01   -2.846768153891695e-01   -6.595566181033366e-02; -2.164602259465450e-01   +1.604482671415672e-01   +2.570013328971628e-01   +3.982099261043452e-01   +1.368819649510913e-02   +3.770025666195504e-01   +1.356866877062918e-02   -3.034193893406437e-01; +1.699599443073457e-01   +1.498670406911377e-01   -1.156705697061175e-01   +5.114675187626206e-01   +9.548237354735891e-01   +4.493521126642783e-01   -8.415259496313059e-02   -2.297265167912642e-01; -1.342361417777383e-01   +3.826846546520701e-01   +2.714568223515963e-01   +2.014512549098257e-02   +1.588146145888485e-01   +5.008812925449381e-01   +2.046300054780660e-01   +1.643683938741845e-01; -3.972728390734979e-01   +3.929832821845042e-01   +3.501460799613738e-01   +1.959656850558013e-01   +3.260176214403918e-01   -4.045727053053048e-01   -3.607096178159105e-01   +6.932454711819698e-01];
L2I_L3I_iGABA_netcon = [-2.142415411168393e-01   -6.079440556696754e-02   +1.290548079041941e-01   -1.673424105387787e-01   -6.322948224909221e-01   -2.625752202912459e-02   -4.024947940194081e-01   +5.945088150581812e-01; +5.843740955506060e-01   -7.034441883798412e-02   +2.726080296323665e-01   +5.429789942367573e-01   -6.344464277783837e-01   -4.101672718215729e-01   -2.625473878823532e-01   -4.482439817507546e-01; +4.242935715857539e-01   +1.983940900164181e-01   -7.639663150619215e-01   +6.474480573231950e-02   +1.107634077387109e-01   -6.543545451753653e-02   -3.162808950094070e-01   -9.719620720267637e-02; +6.122026200957931e-01   +3.803622735116549e-01   +6.137380219940264e-02   -2.038519963305832e-01   -1.401478160580006e-01   -2.953613037428586e-01   +7.756049798003167e-02   +2.117710572899316e-01; -6.261518978873197e-01   -4.010474665312699e-01   +2.354585899758261e-01   +8.837196005636724e-02   +2.810625443134084e-01   +1.447661140718605e-01   -2.333002456558422e-01   +5.459978258408451e-01; -5.791848611792363e-01   -2.833667798468707e-01   +7.464444782971249e-01   -3.987302125047085e-01   +5.134060095306819e-01   +2.081370381506618e-01   +2.753869259600318e-01   +1.678558770797554e-01; -2.322347759083201e-01   +6.301868377271800e-01   -6.647419355151554e-02   +2.222516357342558e-01   -1.712185601672725e-01   +4.084646753134947e-01   -2.637811056134733e-01   -4.758336460256943e-01; +8.466673202224173e-02   -8.876309934621501e-01   +1.883629446630489e-01   -2.467318460874763e-01   -1.882178646717880e-02   +2.499344765490220e-01   +3.910391533393157e-01   -3.045678616054285e-01; -7.643194564159378e-02   -3.202146683967947e-01   +1.840106987913550e-01   -6.144438293808805e-01   +6.158364509650930e-01   -3.610828900922789e-01   +2.265561358372605e-01   -2.946780992269130e-01; -6.595008976949120e-01   -4.972401189434353e-01   +1.090848242975361e-01   +4.916841053605280e-01   -4.496690944203406e-01   +8.261021379316176e-01   -5.396159321254387e-01   -4.968218975810554e-01; -5.013609819085377e-02   +2.573799201468309e-01   -1.390826957757483e-01   +2.938403966967337e-02   -5.376944043490951e-01   +3.396094467736399e-01   -1.935276011039265e-01   +5.232304628296103e-01; -1.917844772213530e-01   -2.621219158276182e-01   +1.655719481432834e-01   -3.113003570338115e-01   -2.709312970020866e-01   +4.264647512117009e-01   +1.503420775044326e-01   -5.944264037794388e-01];
L3I_L3E_iAMPA_netcon = [-1.639514729998325e-01   +1.583380809815633e-01   +1.422893757733327e-01   -5.341848679659782e-01   +8.232643122371663e-02   -1.436992148000847e-01   +1.739838290986653e-01   -4.506733395638882e-01   -2.071268397229110e-01   -2.376674633315941e-01   +3.617729098124266e-02   -2.811321313298886e-01; +6.185226352510476e-01   -1.879986241799434e-01   -3.971433271612057e-01   -1.913300404164105e-01   +3.467426979381585e-01   +2.076330340144858e-02   -3.630245125753374e-01   -9.800488652840540e-02   -1.331447590498294e-01   -4.076788164029530e-01   +5.094671632872972e-01   -1.016056068572010e-01; -2.830768896477981e-02   +2.928656592999799e-01   +1.086231295337212e-01   +3.097065614019689e-01   -2.627586030143776e-01   -9.729067990311410e-02   -7.911610370419279e-02   -1.262590092965376e-01   -4.571061946198881e-02   +2.439431968610679e-01   -2.618397595944678e-01   +1.807918450278942e-01; -1.927258880306649e-01   +2.910982824955798e-01   +2.666823907196873e-02   -3.711861750581320e-02   +3.887370193396820e-01   +5.203655346442945e-02   +3.099318886326919e-01   +9.203523010381098e-02   +2.542844029576091e-01   +5.215639996030801e-01   -2.914907707940519e-01   +2.283575071038694e-01; +3.435428169404779e-01   +4.740557348786351e-01   +2.094167611067324e-01   -3.519948602360587e-01   -2.472443513568126e-01   -4.711428504660821e-01   -8.109445979135854e-02   +1.074921178371312e-01   +7.027138680854894e-01   -4.233232906196912e-01   -1.843053617056795e-02   +2.426404915562549e-01; -4.151487601514656e-01   +3.589897048435764e-04   +7.288652797432960e-01   +8.440268135750571e-02   +6.102926645680822e-01   -7.517388056572492e-01   -1.665694577314343e-01   +2.491655651340686e-01   -6.450811852949221e-01   -4.550201631939217e-01   -1.942759745778656e-01   -4.957416258706782e-01; -2.952172130232282e-01   -1.834909035376627e-01   +2.219894152758535e-01   -1.144989904524810e-02   -7.516230039272154e-02   +2.379179002654572e-01   +5.257455789152579e-01   +2.430398470347043e-01   -9.990377421930624e-03   -3.482141388842082e-01   +1.216967893728938e-01   -2.108167540835525e-01; -9.786283760528425e-02   +6.198650786705325e-01   +1.474763466940839e-02   -1.649120193616344e-01   +4.151101508825893e-02   +1.275372884877561e-01   -1.160587509622068e-01   -7.630230097082423e-02   -3.509125232582462e-01   -2.771088184597875e-02   +1.426080218937529e-01   -1.968902838463416e-01; -7.426883870401180e-02   -2.759342393223454e-01   +2.114990980018749e-01   -3.019311114014763e-01   +2.046030305834631e-01   +4.594366367336630e-01   -2.639560152672088e-01   +1.079790666143558e-02   +2.814392957416731e-01   +2.073527394487888e-01   +4.478576798952257e-01   -1.462715847760256e-01; -1.814251643213757e-01   +1.008489285029968e-01   +1.991080386372102e-01   -4.377069184053839e-03   -2.962246925924015e-01   -9.598147916519550e-02   -3.217918474482007e-01   -4.453914235638859e-01   +5.631470125186389e-05   +1.238081525710426e-01   +3.333928772987024e-01   +3.221310905116255e-01; +1.396328957457865e-02   -8.092862948522746e-02   +1.754174063210182e-01   -1.578627323081636e-01   +1.169566427436372e-01   +8.147562086221112e-02   +1.606159017024998e-01   -1.000230839362243e-01   -1.825260923783950e-01   -4.053821699615841e-01   +2.707211741127037e-01   -4.871956862371760e-01; -4.362388921836073e-01   +7.500806054439813e-01   +2.455495841646647e-01   +1.933099231469315e-01   -4.701328628724084e-03   -5.079668053723230e-04   -1.701320016875121e-02   -6.141033097367510e-01   +1.532566224570897e-01   +1.902998464434946e-01   -1.631908593453048e-01   +3.633073642630876e-01];
L3E_L3I_iGABA_netcon = [-1.132059333707192e-02   +3.052667662922833e-01   +4.707185809823226e-02   +3.822053239619289e-02   -3.226549019630622e-01   +1.934481394923988e-01   +1.608434982508300e-01   -8.125615946675731e-01   +4.497793079914807e-01   +2.137820080337273e-01   -5.270471967212161e-01   +1.849882121008287e-01; +6.393735742061012e-01   +1.799107325237491e-01   +1.098398852392731e-01   -4.314961956005009e-01   -2.475250990807355e-01   +6.458728362513980e-02   -5.047632191161211e-01   +2.495326917117295e-01   -4.197912002060267e-01   +2.580302465464366e-01   -4.936755279166376e-01   +5.206344371869723e-01; +1.668261839314933e-01   +3.249764243182789e-02   -3.216038262760149e-01   +5.467790894310316e-01   +9.419308625604006e-02   +4.081362212456992e-01   -1.880082931221083e-01   +9.374950550562723e-02   -4.385684541508393e-01   +7.596794307950229e-01   -1.117373062952675e-01   -1.784695244861938e-01; -3.570549015421241e-01   -2.181209326313614e-01   +5.020604576503325e-01   -1.514401994814329e-01   -4.326488968590619e-01   -2.116382215129724e-01   -1.491864611510514e-01   -2.477545750767397e-02   -2.849414734602980e-01   +6.675799712656885e-02   +1.942342018003176e-01   +5.093197760795078e-01; +5.782563384564265e-01   +6.757375589459060e-01   -1.445609566447424e-01   +2.772460111403188e-02   -1.201256072366676e-01   +3.903950247111264e-01   +6.187008562566438e-01   -5.828026206600656e-01   -1.947245984417371e-01   -6.318153916884516e-01   -2.961623538873699e-02   -7.037039384281885e-02; +5.022634224029434e-01   +2.480996544024947e-01   +3.386007062765424e-01   +6.061905063138867e-01   +1.305120203210878e-01   -3.165232633301155e-01   -4.571526640554387e-01   -1.538188517084442e-01   +1.469512261867255e-01   -2.849306017365963e-01   -8.953755585431433e-02   -1.077799289650358e-01; -3.027865641742752e-03   -5.098767293301427e-01   +3.772197166128469e-01   +5.842703814690255e-01   +7.888896043748166e-02   -1.097236998752625e-02   -1.502537594486219e-01   -2.237263707250899e-01   +3.250103169286176e-01   -1.516053534277890e-01   +6.146085421620576e-02   +4.232459173921055e-01; +5.075944233849181e-01   +2.505061382018149e-01   +2.439813054246846e-01   -6.656979700641831e-01   -2.486538648328610e-01   +4.776914437959428e-02   +1.918443257250696e-01   -7.598050735499151e-02   +8.951697831657007e-02   -6.115540539941112e-01   -1.099088103889344e-01   -3.739901841974000e-01; -9.754154600172649e-02   +6.420406998525897e-02   +1.447448086144484e-01   +1.710195720549965e-01   -1.145928812280408e-01   +5.485015998352133e-01   +8.139025876513941e-01   +4.916384532217463e-01   -4.428827131894734e-01   +1.531373765814558e-01   +5.563973514822629e-01   -2.108620682730085e-01; +9.016724611074782e-02   +3.750871398140306e-02   +4.795801236264539e-01   -1.742236773505286e-01   +4.086928533075758e-01   -2.104152827331721e-01   -3.408228460213807e-01   -3.986279989927827e-02   -1.763099526914904e-01   -7.983338775401990e-01   +4.798558660783636e-01   -2.241684403397044e-01; +3.008679869875200e-01   -2.498979189460030e-01   +5.774080011297571e-01   +2.146068315919740e-01   -4.172618673493975e-01   -6.251284259276565e-01   -3.246396431480460e-02   +2.833281603113277e-01   -1.156868926018604e-01   +1.701628750584824e-01   -7.196844040870582e-01   +1.384191637080275e-01; +1.490195525568577e-01   -4.278946849137960e-02   -3.734920971661726e-01   -4.131314877383546e-01   +3.014617800263513e-01   -4.094057685154764e-02   +5.504376490586244e-02   +1.401082425123949e-01   -4.629406708212666e-01   -1.633039747433796e-01   +6.609055797407885e-01   +2.809308291282134e-01];
L2E_Input1_iAMPA_netcon = [+3.641542066718061e-01   -5.794539634170475e-01   -4.303963869883342e-01   +2.582730303105348e-01   +3.890039831439634e-01   -2.545546000394101e-01   +2.398976744135320e-01   -4.580910101217572e-01];
L2I_Input2_iAMPA_netcon = [+8.973079201050432e-01   +5.207843960812005e-01   -1.597769013324493e-01   -1.849593316084857e-01   -1.367581677026426e-01   -3.856100887425088e-01   +1.393953883418571e-01   +1.833134754578497e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
