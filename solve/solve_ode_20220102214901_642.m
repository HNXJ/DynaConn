function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.002926162032217e-01   -4.922600212570547e-01   +2.819053224018221e-03   +1.082478369184084e-01   +5.348269759952393e-02   +1.460616612576127e-01   -5.105064089370173e-01   -7.713729239523943e-02   +4.758977083654156e-01   +7.531932104540467e-01   +1.542025868998321e-01   -1.249274104846853e-01   +5.102322072608527e-01   -2.388576449289682e-02   -3.186762900724331e-01   -1.780606450178868e-01; +3.262363734831238e-01   +4.014964517419354e-01   +2.419867543515599e-01   +2.636190855036005e-01   +8.732937209642883e-02   +6.534169109215044e-01   -3.800980607122089e-01   -1.001701427336963e-01   +1.634705380532602e-01   -3.469566184661482e-02   +2.124728541139874e-01   +2.565689210084224e-01   +3.512244539196518e-01   -1.132452348339193e-01   -1.222308003506452e-01   -1.209781755306797e-01; +3.113972849342572e-01   +4.850927653792197e-02   -2.574482621438872e-01   +1.213070537624189e-01   -1.947810315113412e-01   +4.371444114819930e-01   +5.882743595442236e-01   -2.603681035108272e-01   +4.209458108945826e-01   +3.050307327017117e-01   +1.656718923171377e-01   -4.310471126696270e-02   -1.914216931424199e-01   -5.472685246110246e-01   +2.513841332719053e-01   +5.953783120614844e-01; +4.170563210672277e-01   -2.659036517947847e-01   -5.841518314165527e-02   +4.736617499967340e-01   +3.029886218830999e-01   +6.577311158458059e-01   +5.484195807672289e-01   +2.489999029457748e-01   +1.597525708046333e-01   -1.379419597498573e-01   +3.374205831246279e-01   +4.185074112998068e-02   -2.284097689724434e-01   +4.782147402614685e-01   +1.727291316078717e-01   +7.776919121947142e-01; +4.171742922543182e-01   +1.315205177652578e-01   +6.261088283429386e-01   +3.855146309989676e-01   -4.854260987545820e-02   +3.269499672906454e-01   +5.466818305382987e-02   -1.836586578217568e-02   +6.186099761730558e-02   +2.444211233138312e-01   +4.936122352892111e-01   +7.317156370290227e-02   +2.761655652801178e-01   -1.244154968686699e-01   -1.689131297382942e-02   +2.178041234420685e-01; -1.962793509689693e-01   +6.748154656253063e-01   +4.935362025295509e-01   -1.188562731580124e-02   +3.902421208494340e-01   +1.934719643035049e-01   +2.419189086691216e-01   +2.348447893754139e-01   +1.307440878279582e-01   -5.536175398653732e-02   +4.552262818724884e-02   -2.583263020066203e-01   +1.128914655835066e-01   +2.863833651477293e-01   -2.402295695019963e-01   -4.098830584773112e-02; +3.059970633560036e-01   +4.271721554223531e-01   +5.749369397112534e-01   +3.951552243547916e-01   -3.336556979434796e-01   +8.030972007960453e-02   +1.013783077656349e-01   -9.279082617642596e-02   -6.872339765389702e-01   +2.468349873112947e-01   +6.551683147749703e-02   -9.698272839128820e-02   +3.266651192415294e-01   -1.016789871592901e-01   +5.136687184957504e-01   +3.358137888308755e-01; +6.372549120335001e-02   +5.265932242933168e-01   -1.913614178541119e-01   +8.359589139547918e-02   +3.418348294644772e-01   -1.035603541209663e-02   +5.112077066751619e-01   +2.844219872925338e-01   +2.090154567288403e-01   -2.941048770200647e-01   +6.854641826019936e-02   -4.503458753962948e-02   +1.412354221959600e-01   -1.008329443648184e-01   -1.030949335314340e-01   +7.758362215809811e-02; +2.244353583347752e-01   +5.455122878320614e-01   -1.022139524186548e-01   -1.053797383800425e-01   +2.362765430507847e-01   +3.967830335068342e-01   -2.286878058589442e-01   -4.151227891856630e-01   +5.061712963995137e-01   -1.208398818672169e-01   +3.945823851787973e-01   -9.451146867740878e-02   +1.556911233773846e-01   +4.124892008943635e-01   -1.820443464934723e-01   -5.051874794408699e-02; +2.787314282222403e-01   +1.771124977685141e-01   +1.822293304863777e-01   +3.539973844615534e-01   -1.803279515583456e-01   -2.856864599331092e-02   +2.190013341235731e-01   -2.727896616541940e-01   -1.476073590455687e-01   -3.265137412958914e-01   +8.101360232810193e-01   +2.684902346811326e-01   +3.763238283972131e-01   +4.323845171629526e-01   +3.754841411010424e-02   -4.003450842731387e-02; +5.248264926967932e-01   +6.483404991658303e-01   +3.340998874555359e-02   -2.815531868320613e-01   +2.309788151641143e-01   +1.893679901803186e-02   -2.079881168560024e-01   -3.363930682736287e-01   +3.383612015454623e-01   +6.445733863453517e-01   +9.142869144924257e-02   +1.861567946179910e-01   -6.164333043712958e-01   -1.133037325789298e-01   +2.290932747313705e-01   -1.986787190539738e-02; +4.283767953740258e-01   +2.660082986955193e-01   -6.064894641659226e-02   -2.169827551895952e-01   -1.815175540835799e-01   +2.282665543708866e-01   +2.057436471252324e-01   -1.673127127821375e-02   +1.338980519630392e-01   -7.152286150647167e-01   +2.543618779089536e-01   +3.203814565026628e-01   +6.114164486066004e-01   +6.569735495312426e-02   -3.002539315164450e-01   +1.940503714802611e-02; -4.827514929187036e-01   +3.298831791840518e-01   +7.027864626765726e-02   +1.692779194114598e-01   +4.385293015580032e-01   +6.772102471533078e-01   -2.260553033489581e-01   +7.082598337095750e-02   +3.462090819029721e-01   +4.722801792601708e-01   -1.664923346958635e-02   +2.323749203362463e-01   -1.003957002968823e-01   +1.457378500582221e-01   -8.315326207893515e-03   +9.719255181458372e-02; -5.761152487827742e-01   +3.785935080408747e-01   +2.859236913802847e-01   -6.865198739201120e-01   +2.101511448260465e-01   +7.354340656864322e-02   -1.668908734239004e-01   -3.823906023490981e-02   -3.592496479444855e-01   +2.809016530226284e-01   +5.274746226563868e-01   -1.245597227847215e-01   +8.930233729222603e-02   +4.712602725898264e-01   -5.395397816382357e-02   -3.449036222715351e-01; +2.373766119910736e-01   -9.636372232209842e-03   +3.403657328788035e-01   +2.750656124901134e-01   +5.201553775696722e-02   -3.002998040151525e-02   -1.416247286684364e-01   +6.875252076151905e-02   +2.695270246495763e-02   -1.026132903401196e-01   +2.518059934793796e-01   +1.716515244639440e-01   +6.143258401749809e-01   -2.792143342726333e-02   +2.099917076319598e-01   +5.138061338033329e-02; -1.000000000000000e+00   +5.405011416411656e-01   -3.840682698549849e-01   +4.257650926736949e-01   +7.131842665561037e-01   +4.692063938506655e-01   -2.333192561486775e-01   +6.117256820208501e-01   -4.491621458154569e-01   +2.521665738023389e-01   +2.156918107044850e-01   +1.084902819565581e-01   +1.154564783916621e-01   +2.460806114965873e-01   +5.907685951097117e-02   +2.763292795003309e-01];
L1E_L1I_iGABA_netcon = [-7.820619238664803e-02   +6.890331854619854e-01   -4.602784569255945e-01   -3.969931762115451e-01   +5.665230052070803e-01   +9.815246151628600e-02   +6.303520036429090e-01   +2.000722422298740e-01   -4.181097660892108e-01   -8.294739747383019e-02   -2.706710814093098e-01   +6.646208196019179e-01   +8.111303680555531e-01   -4.371784314809670e-01   +5.757109641262359e-01   +5.039916943123952e-01; -1.775961746127691e-01   +1.965319960342661e-01   +1.000000000000000e+00   -3.888593619758756e-01   +4.663026925870525e-01   -3.801274983363397e-01   +4.629205530237081e-01   +4.674048883668353e-01   +3.049135683679318e-01   +4.014507063897594e-01   +1.101232361193284e-01   -2.968746540719295e-01   +4.182807386056411e-01   +6.386829934388295e-01   +6.662631237339658e-01   +4.239222064440307e-02; +2.607560375765652e-01   +4.653766575361874e-01   -4.256594774170055e-01   +4.851960670402453e-01   -3.213953547287563e-01   -3.994597420955799e-01   -3.158649761273045e-01   -2.211492719410155e-01   +2.783653457458342e-01   +1.525920539804230e-01   -3.499619058378861e-01   +5.234358758388760e-01   -1.068685922089740e-01   -4.123774718133240e-01   +6.724869546051687e-01   -3.848503164783815e-02; +4.077875861377168e-01   -3.095442373768489e-01   -5.172744587747152e-01   +6.485410807037255e-02   +2.280418676458604e-01   +6.814125048560683e-02   +1.918466450660496e-02   -2.073878592174075e-01   +3.909038740310487e-02   +3.199066400462557e-01   +2.408126532428445e-01   +2.283660408610809e-01   -5.398995604048960e-02   +3.842074612894260e-01   +3.781404120037563e-01   -2.396890352044464e-01; -1.354021100299615e-01   +2.683298668093473e-01   +6.293749205834738e-01   -4.719332952943658e-02   +4.470341298208368e-01   -3.927093225599798e-01   -2.751062838216887e-01   -5.939597775001840e-01   +5.282363756983897e-02   +3.756792270892059e-01   -9.323866986331324e-02   +7.855690243935045e-01   +6.227843428128406e-01   +9.339169612816466e-02   -4.303862135526018e-01   +2.777572957973167e-01; +3.709426229049160e-01   -1.205202112667370e-01   +1.301301810927136e-02   -3.536745264414504e-01   -9.317294925911697e-02   +3.417873181674076e-01   -2.617888033822568e-01   -4.429865158865999e-01   +4.752930873165646e-02   +7.645372923453917e-03   -1.299565287420232e-01   +3.974316129136176e-01   +3.199799424626824e-01   -2.513318870931736e-01   +3.385426080429491e-01   -2.789072873828753e-01; -8.945297768209538e-01   -3.217895995347888e-01   -1.943087636550888e-01   -6.010473696123523e-01   +4.181886508458713e-01   -1.935422087955214e-01   -1.802390113669359e-01   -2.452855675783965e-01   +6.739036271456099e-01   +4.077923275621346e-01   +4.442794420747191e-01   +1.695277891273669e-01   -2.413792056153779e-01   +4.028448738449966e-01   +6.768597297818156e-01   +1.519532186108145e-01; +5.360651269612193e-01   +4.308658168866262e-01   -4.029747193341238e-01   +5.872647602782522e-04   -3.153864529118951e-02   -2.676136827993443e-01   +8.752206717938784e-01   +9.373986087975765e-02   +4.989677979558078e-01   +1.700260616971343e-01   +2.223346685793914e-02   -2.483920666543495e-01   +8.847812471163045e-01   +3.479310994831761e-01   +3.478347217200772e-01   +7.715181289442261e-01; +2.087031439871411e-01   +6.300858089685291e-01   +2.298128960079761e-01   -2.010536088991518e-01   -4.965826414369335e-01   +4.591989833529165e-01   -2.459649032867515e-01   +1.231735469004416e-01   +1.606193409994742e-01   -5.169284957485601e-01   +8.941323186162715e-02   -3.635883768635375e-01   -1.148722789968628e-01   +4.357959363688102e-02   +5.658060746279808e-01   +1.314702446948338e-01; +3.511148909427994e-01   +5.967429952221842e-01   +7.452742820668877e-02   -3.286841925645901e-01   +3.749684504180070e-02   +4.100548106755267e-01   -1.561658598211794e-01   +6.421682599974428e-02   +5.322026274185291e-01   +4.863184663909337e-02   -7.017410950025516e-01   +9.432797359450841e-02   +6.506413017791682e-01   +1.301760075974915e-01   -1.306248513284760e-01   +1.639609328066956e-01; +3.565042958225816e-01   -3.324311913321985e-02   +2.596399440000436e-01   +4.519185311773885e-01   +5.535694115625380e-02   -2.318458203690363e-01   +1.502431759251448e-01   -2.673905984496494e-01   +6.693991172521043e-01   +4.086113279596541e-01   -4.928216765054241e-01   +5.085662234413316e-01   +4.782306316274422e-01   +1.471103771906146e-01   +2.371988089069594e-01   -6.486136559361452e-01; -1.931997401139079e-03   +1.694276372129416e-01   +5.474450041871037e-02   -5.559003858705620e-01   +3.623371369623624e-01   -8.444591099756865e-02   -1.986429431002136e-01   +1.813640240475781e-01   +2.741670137496255e-01   -1.576209932530087e-01   +2.644112558517012e-01   -1.719071596811945e-01   +5.054619939438273e-01   +6.143853955865385e-02   +4.903431464804305e-01   +1.009598885647690e-01; +5.982118601182087e-01   +1.805926376450994e-01   +2.928318831475450e-02   +1.905333856543969e-01   -1.628453247181084e-01   -1.963314216066135e-01   +2.251699907188849e-01   +9.015882526960939e-02   +2.633176096389235e-01   +5.475732901654272e-02   -5.122012860323551e-02   -5.263356837426689e-01   +5.061579496025662e-01   +8.804021879869926e-02   +1.017754946580878e-01   +2.574716302738998e-01; +5.606977875394468e-01   -2.167788979212976e-02   -2.210513309440498e-01   +1.736922620746713e-01   +1.791965029454388e-01   -9.248159028643206e-02   +3.273188531068901e-01   +7.580988295518663e-02   +6.701672648033835e-01   +9.163986397893499e-02   +6.951735567004523e-02   +2.917794133584478e-01   -2.187424813171261e-01   +1.450492195069285e-01   -3.687868808558771e-01   +5.780475690013146e-02; +1.246422156076777e-01   +3.294373342591814e-01   -4.934363290958089e-02   +2.505213221706623e-01   -2.370469941035968e-02   +2.364031938998527e-01   +4.870471643680524e-02   +2.378248751635905e-01   +5.740693771665649e-01   +8.702388778841534e-02   +8.117142427098476e-01   +1.136231933606895e-01   -2.620756334823808e-01   -7.131366253251310e-01   +8.999880461213525e-01   +3.706286599486875e-01; -4.186709832044083e-01   +2.807362737098318e-01   -2.386532073233011e-01   -3.265186885485046e-01   -1.394185596755346e-01   -9.338748221698205e-02   -2.609045609596776e-01   +1.687473503948095e-02   +1.004176638276901e-02   +2.970006096955306e-01   -5.037937938282586e-01   +8.689191996213470e-03   +4.477286431327832e-01   +2.454659764410637e-01   +3.849599624307835e-03   +2.136278944650146e-01];
L2I_L1I_iGABA_netcon = [-1.761377275456446e-01   -3.828600900825908e-01   +2.130303770340738e-02   +7.261802701967786e-01   -2.852186571890227e-01   +5.203262724573227e-01   -1.331804865264469e-01   -1.330213761361610e-01; +1.915042610663332e-02   +7.168496434820654e-01   -2.366485323576565e-01   -5.473524908656313e-02   +4.083589379880008e-01   +5.606881337522782e-01   +1.280816800587830e-01   -4.183452105714622e-01; +4.077333019182420e-01   -6.677568830355046e-02   -1.351536703414905e-01   +3.672169567939723e-01   -2.693075484091947e-01   -2.158241337708121e-01   +6.792871475856953e-02   +3.990555526120195e-01; +3.942286085112071e-02   +7.602341258247630e-02   +5.475576411306670e-01   +3.047906259714893e-01   +1.737323163299543e-01   +3.839992645077771e-01   +4.079519835128947e-01   -1.665137736239845e-01; +2.914225628093904e-01   -1.277306571376817e-01   +5.410597068194450e-01   +5.340981840756345e-01   +8.705903944746327e-01   +3.825115363228929e-01   +2.482683715484773e-01   +2.707178651338065e-01; -3.323843610333524e-01   +1.310743083912762e-01   +5.600392492226981e-01   +4.395725893635224e-01   -2.024805978349470e-01   +5.513544519099165e-01   +6.139511211547044e-01   +6.914409611937123e-01; +2.441326145482586e-02   +4.978414923088391e-02   +2.344166652650613e-01   -1.148474072457691e-01   -1.067100940756708e-01   +6.755861224178793e-01   +4.959845093260385e-01   +2.257281610508457e-02; -9.858844090123020e-02   +5.106612271884969e-01   +2.188979631754577e-01   +2.442821797363282e-01   +6.672729064524490e-01   -1.612862016503349e-01   +5.088781472234855e-01   +2.152912034370448e-01; -1.708103528613159e-02   +9.680523038036325e-01   -7.936832136278843e-01   +4.019631343192960e-01   +3.054613983198726e-01   +6.110577239049316e-01   +1.848712462808531e-01   -9.651825776677200e-02; +1.048399543416032e-01   -3.133158600997654e-01   +5.651751266527347e-01   +1.022789785828907e-01   +3.035449169894071e-01   +3.236281439273523e-01   -7.042303596521320e-01   +8.539333500557525e-02; -2.426839312391982e-01   +3.000959223440472e-01   +1.583306503046632e-01   +2.686997419108204e-01   +8.172569168485684e-02   -6.137707302277368e-02   +1.345929302986113e-01   +2.307156086215282e-01; +1.850693836485690e-01   +4.682997633017157e-01   +2.225010132383797e-01   -1.468957020907027e-01   -4.312227345617628e-02   +5.430034107672457e-02   +7.747677784552361e-01   +3.730720308390369e-01; +4.292711025939315e-01   +2.323595596773109e-01   +2.470191444743063e-02   +1.606765830483690e-01   +2.523388115934564e-01   -6.490688533098836e-01   -3.493775431982322e-01   +5.753233864008600e-02; -2.101049377333868e-01   -4.508704064591341e-01   -8.183690539179747e-02   -3.217518957448076e-01   +4.821196879442450e-01   -3.250410504209285e-01   +4.818997845357901e-01   +4.700186178432871e-01; +5.377955429768558e-01   +3.152504070306825e-01   +3.720944045639623e-01   +2.725629738487957e-01   -5.001575375852846e-01   +8.203491085777971e-01   +8.428419889228815e-01   +2.575403567048199e-01; -3.580615691126564e-02   +2.694099125044446e-01   +4.321681951112342e-01   +4.999724922758848e-01   +4.901527443995834e-01   +2.857915817799354e-01   +2.279408349916487e-01   +6.331334401212391e-02];
L1I_L2I_iGABA_netcon = [+5.212601948902145e-01   -3.878823591080436e-01   +1.340251184326887e-01   +4.903928880797332e-01   +1.400228246136465e-01   +1.697441622586901e-01   -3.650153138856799e-01   -2.384196162445890e-01   -1.867324611597960e-02   +2.660461509626534e-01   +3.182134001408018e-03   -6.841885219554066e-02   -2.562486060540372e-01   +1.107053485235432e-01   -2.867495328265342e-02   +1.446521871968182e-01; +1.978528637961763e-01   -3.873931058226956e-01   -1.311123597401802e-01   +1.899265615531127e-01   -2.858658660779244e-01   +1.512450747562404e-01   +3.186782005326139e-01   +2.590308183559871e-01   +1.187957646139994e-01   +6.133875321895773e-01   +3.326690956045558e-01   -6.092990567381872e-02   +1.276156774984290e-01   -3.712858259484224e-01   +5.502279914295073e-01   +4.130837194944232e-01; +2.638880734414300e-01   +6.464157888025512e-02   +3.683147849283673e-01   +1.182831524474736e-02   +6.478746886511327e-02   -5.968481311950231e-01   +1.162268059481665e-01   -9.566187135797068e-02   -1.949844177785768e-01   +2.533187124166399e-01   -4.288739456242085e-01   -6.177321926089920e-02   +2.246678132946083e-01   +5.568659646079098e-01   +7.321873284144603e-01   +2.895556773136194e-02; +3.129927845789794e-01   +4.772878003105205e-01   +3.162085679476634e-01   -2.609732554862921e-01   +5.042031130388533e-01   +7.279619323461041e-01   +2.866477670005471e-01   -1.266428641311206e-01   +1.904837769813262e-01   +5.105144068134858e-01   +2.687317883935713e-01   +4.777106816249397e-01   +1.694600321533914e-01   +9.075391721735089e-01   +1.527800124337283e-01   +7.646525303682414e-01; -2.312956374793311e-01   +2.434196504613802e-02   +3.409222290358909e-01   +4.218145664223858e-01   +2.226546454931235e-01   +6.304247383550327e-01   +3.734248335138544e-01   +5.051894904299509e-01   +2.733112720025181e-01   +3.249464247496233e-01   -8.734175200329254e-02   +1.851371886724442e-01   -8.989979957553572e-01   +5.538724742873035e-01   +5.020269030808657e-01   +1.000000000000000e+00; -1.849767141126807e-03   +6.734309507037289e-01   -6.419849233063388e-01   +2.362349166330602e-01   -1.410311867792407e-01   -1.451134256034405e-01   +4.559934873148787e-01   +5.592722449125379e-01   +2.473844805599846e-01   +3.532956280800500e-01   +1.359421542384741e-01   -1.366144893626548e-01   +1.590783783254949e-01   +8.054476696914730e-01   +1.937160926539958e-01   +1.966079022143398e-01; +3.354240448784809e-02   +4.716561993049898e-01   -2.092554569226487e-01   +5.247520994543131e-01   +3.348829348108998e-01   -5.218267276854545e-01   +1.884464670409295e-01   -2.694563175496679e-01   -4.672460949204338e-01   -2.654989249350861e-01   +4.100314775727681e-01   +4.054022941185328e-01   -7.413886803956082e-02   +1.871241046475757e-01   +6.477539543050360e-02   +2.103827903801208e-01; +3.438147474794109e-01   +2.874089306689090e-01   +4.232400214882029e-02   -1.393327798554381e-01   -1.059023542590508e-02   +3.205260359106975e-01   -1.897426212198879e-01   -2.874654254243969e-01   +1.368460653253726e-01   +1.619424525487954e-02   +1.205304297010684e-01   +5.391331691690848e-01   -2.434776053583909e-01   +2.065799310288828e-01   +8.303308241353971e-02   +3.996125838112567e-01];
L2E_L1E_iAMPA_netcon = [+4.724213472994029e-02   -6.758680099857044e-01   -1.520995512347215e-01   +5.073843858558326e-01   +2.539804450560786e-01   +2.154978850384664e-01   +4.268388462928611e-01   -1.860359338613257e-01; -9.107884465471254e-02   +2.776208066549471e-01   -6.296483555960826e-01   +4.670427689349633e-01   +2.670169008798953e-01   +4.573968539412778e-01   +1.670801626556470e-01   +2.715001225672793e-01; +4.797719449452172e-01   +8.543343068384875e-02   +1.740770005341715e-01   +2.090650898624050e-01   +1.193077404605072e-02   +2.235204160783130e-02   -5.772292835296317e-02   +2.835605495908713e-01; +2.532024002944359e-01   -1.177384984223837e-01   -3.634660231192384e-01   +3.043243430081627e-01   +1.773126669421017e-01   -2.534276763113855e-01   -3.115241334738355e-01   -8.697628742015874e-02; +7.205002214602155e-02   -3.494480788292226e-02   +3.605685617077837e-01   -4.319715301408690e-01   +7.388969132171795e-02   -2.562835863064010e-01   +1.145064836741089e-01   +2.362248760887833e-01; +6.892690476620627e-01   -1.220383608609087e-01   +1.007612489039822e-01   +5.798355315990595e-01   +3.096040292650030e-01   +6.592283757573555e-01   +4.272229576674937e-01   +5.225962470595922e-01; -3.433964835996995e-01   +9.098099148393839e-01   -1.449606863067039e-01   -3.875662374822005e-01   -1.492858662169694e-01   +4.563881250872067e-01   +8.030016383653457e-01   -3.520458915255084e-01; +3.032665964895504e-01   +3.807412250856393e-01   +7.878697584023783e-01   -1.416172897725628e-01   +2.807127881935926e-01   +1.232333547294471e-01   +6.473712633386577e-01   -5.033393925760130e-02; +1.878288893162885e-01   +3.093855662911497e-02   +8.425314359983518e-01   +6.374873732331945e-01   -7.145578652130309e-01   +5.827745252976142e-01   +6.984731997470554e-01   -3.293225577581664e-01; -3.379864612286790e-01   +4.009049743633904e-01   +9.216946935154406e-02   +2.692965632392041e-01   -9.414505010515950e-02   -3.336554045917675e-01   -2.241678548884309e-01   -2.208500729190360e-01; -8.972091064146809e-02   +6.996904521822153e-01   +8.385608955542482e-01   +2.624921990310672e-01   +1.242287483208056e-01   +2.502144371318172e-01   -2.598698842033183e-01   +1.378921621698449e-01; +1.921410694770939e-01   -2.913420469114449e-01   +5.354509494438802e-01   +1.822820202032728e-01   -4.264622102490398e-01   -2.135771233386241e-02   +1.173133843127850e-01   -4.141616942516342e-01; -2.569147606748364e-01   +3.563726148081448e-01   -9.146663487192949e-02   +1.278641865998874e-01   +4.673089970883246e-01   -6.054839858015291e-01   +1.764467463002100e-01   -1.618018837337410e-01; +3.305365436781021e-01   +9.340770245803089e-01   -3.104671444153748e-02   +1.185276275974825e-03   +4.428935759456412e-01   +1.767937918141021e-01   -3.821998742532682e-01   +3.332081745660610e-01; +6.462587412563023e-02   +3.769055598159672e-01   +1.863661859476105e-01   +2.725996025471111e-02   -5.887861982763802e-02   -1.771611738697395e-01   -2.495538965993313e-01   -3.420151696782102e-01; -2.243348071528864e-01   +1.822718413135055e-01   -8.204085605504877e-01   -3.085256842842546e-02   -3.070848715594459e-02   +1.176288432896254e-01   +7.794680018445419e-01   -1.933690634813142e-01];
L1E_L2E_iAMPA_netcon = [+3.009074317104065e-01   +4.432048643146140e-01   -1.406502247855242e-01   +2.123853361503515e-02   +1.929688742147641e-01   +3.663933490913607e-01   +4.053233325580025e-01   +1.174968654784873e-01   -1.193398494362753e-01   +6.821105970815000e-02   +6.752636452107550e-01   -2.674811379504426e-01   -1.330710243433752e-01   -1.999423131423524e-01   -7.900014890604265e-02   +7.006204351461924e-02; +3.460655650927612e-01   +5.480692977445160e-02   +2.217264495918478e-01   -9.489004155147492e-02   +2.638070764336240e-01   +1.667300802990869e-01   +8.143252043437481e-01   +3.068791556114607e-01   +1.799756311665288e-01   +1.578977886796165e-01   +5.551631656598203e-01   +1.632681771204182e-01   +7.269167811404064e-01   +3.682143383842938e-01   -8.327228717535032e-02   -3.864735950804811e-01; +1.000000000000000e+00   -2.223322389603301e-01   +2.440066080206537e-01   +3.510534971105925e-01   +4.620922576149347e-01   -2.283503733462229e-01   -1.674002259304173e-03   -4.736300486746122e-02   +2.051228387331890e-01   -2.695254638981590e-01   -5.022180732310413e-01   -1.923812955256477e-02   -1.172910178076031e-01   +5.262194845235563e-01   +1.862353132453760e-01   +8.859260790382642e-02; +1.564378150719372e-01   -6.761807560457636e-02   -4.060729327851076e-01   +4.517785153246483e-01   -1.566394731196578e-01   +7.435514096224549e-01   +7.290010617943775e-01   -3.073679889775889e-01   +6.464282108378414e-02   +1.907576957784421e-01   +4.926249373186379e-01   -4.577986753164946e-02   -3.382222982959622e-01   +7.862167796182373e-01   +6.212019789411933e-01   -8.249817442975667e-02; -2.748915007940301e-01   -4.523471719659239e-01   -3.152600179042569e-02   +2.963814464382924e-01   -1.746938132955795e-03   +1.012667399083811e-01   +2.778125448827460e-01   +5.700984121433545e-01   +4.177389281773723e-01   -1.602029280610822e-01   +1.825119310628230e-01   -4.893921096606976e-01   -3.706383788904842e-01   -8.267116359214130e-02   -1.010030009593126e-01   -5.421081407961711e-01; -1.805325371989074e-01   +6.814616885352864e-01   +9.737383715891906e-02   +4.332349125988664e-01   -2.224985735122659e-01   +8.909678316789213e-05   +8.032578579246017e-01   +1.236405879197446e-01   +2.695137857088178e-01   +2.971687802510510e-01   +3.267125774805377e-01   +6.092045778216786e-02   -1.236531894594936e-01   +4.927644282400115e-02   -2.465854838910247e-01   +8.088503863355817e-01; +3.276549578254901e-01   +4.625790198773860e-01   +1.809700760942341e-01   -3.385581013884253e-02   +3.926415039255151e-01   -1.188800901497833e-02   +1.414106070186165e-01   -7.337417872934918e-01   -4.098453022992002e-01   +2.013559104323673e-01   -1.516359039988623e-01   -1.008850264445071e-01   -8.529099801234402e-01   +5.924159837308098e-01   +2.737734812441590e-01   +5.718944863121455e-01; +4.321781621570011e-01   +1.411781065566866e-01   +5.029169195796792e-03   +6.874207899346133e-01   +4.616605556481641e-01   +4.543455746552260e-01   -3.141019752678494e-01   +2.606604204830152e-01   +1.535678070358505e-01   +2.302376488274562e-01   -5.880074385805113e-02   +1.135374188727771e-01   -7.111615967943352e-01   -2.482935480965963e-01   +4.423089790572733e-01   +2.595920750164911e-01];
L2I_L2E_iAMPA_netcon = [-9.545765202333517e-02   +5.589198048503231e-01   +4.862002765400624e-01   -1.538347951184283e-01   +2.767281042430825e-01   +1.299211217537247e-01   +1.775063013398200e-02   +4.236337246547757e-01; +6.470488240940152e-01   +3.781036827598468e-01   +4.172557631449603e-01   +9.172106019703606e-01   +4.567315260992842e-02   +2.258016350794494e-01   +2.597566196699956e-02   +3.969807988326244e-01; +2.048840766089525e-01   +2.504179861537417e-01   -1.550769472724532e-01   +3.901283563963233e-01   -2.730702133539441e-01   +3.417445018228806e-01   +5.702510395199918e-01   -1.043031352678808e-01; +5.544559925825575e-01   +5.165141721372338e-01   -4.214929994142605e-01   +3.485374295735560e-01   +7.430009735567349e-01   +2.436306424708547e-01   +3.020111729577099e-01   +4.577434690494719e-01; +5.495961685338107e-01   +2.391932463124219e-01   -4.124020256257681e-01   +3.757928528625120e-01   +6.925506763274101e-01   -9.682245852930579e-02   +1.434564255084072e-01   -2.419428502300670e-01; +3.855449807626710e-01   +4.127212267983803e-01   -4.134482917065689e-01   +4.194443370319734e-01   -3.369148611379909e-01   +1.047717044400463e-01   +2.239549016930334e-01   -1.134278462888936e-01; +7.442537487972660e-01   -3.273672869905483e-01   +4.214748126929057e-01   +4.726954918562813e-01   +1.401146319120646e-01   -1.628924298250935e-01   +5.481968117626006e-01   -5.713289910196766e-01; +4.391320836286986e-01   +7.425728450563852e-02   -4.765720271190877e-01   +3.214863426676994e-01   -3.166694549118043e-01   -2.035636158493576e-01   +1.171860527006330e-01   +7.981250839057059e-01];
L2E_L2I_iGABA_netcon = [+4.232618811876689e-01   +6.280204371940913e-01   -2.870068128411164e-01   -3.281180638551516e-01   +6.741693201611434e-02   +1.247836698202434e-01   -3.112654263500759e-01   +5.749570675696093e-01; +2.407603107014160e-01   +3.869136895765896e-01   +2.236594782656131e-01   +9.631911642240101e-01   +3.874240181942036e-01   -3.623693680137914e-01   -4.242386686346491e-01   +2.621893870223430e-01; +1.122242328413106e-01   +5.039158666858788e-01   -7.103817748930787e-01   -4.305224847412927e-01   -7.451673811642755e-02   +6.695239945602567e-01   +1.566506360157737e-01   +6.514553709308757e-02; +4.584521362929482e-01   +1.734528262314515e-01   +1.216366063204722e-01   +6.562792730238447e-01   +5.756376565582254e-01   -1.911258032044602e-01   -2.325603406775879e-01   -4.428628708841147e-02; -2.381690841834578e-01   -1.037278170372474e-01   -1.894745557170707e-01   +3.335616082486612e-01   +5.101118954904134e-01   +2.473188134618928e-01   +3.738184302395334e-02   +1.935479640667717e-01; +9.563473466605549e-01   +5.494790790224779e-02   +1.276938814214564e-01   +1.811977130620625e-01   +6.754604909357723e-02   +3.358894013687774e-02   +4.834575122374863e-01   -4.479251266446307e-01; -3.304978604601923e-01   -2.107758101626468e-01   -1.039319068662029e-01   +2.323697376953829e-01   -1.871209804041826e-01   -7.211137924809194e-02   +2.157839488882596e-01   +7.562504306592609e-01; +3.323816273894734e-02   +4.850428823862327e-02   +6.150158676094146e-01   +1.774139386090792e-02   +6.282635343088129e-01   +2.835803239798880e-01   -3.748494246881881e-02   +5.464352835466814e-01];
L3E_L2E_iAMPA_netcon = [-8.740314213897056e-02   -3.548309392111104e-01   -4.481975296350058e-01   +2.297294394471264e-01   +8.041008199709540e-01   -6.500434953356957e-02   -1.402538253093821e-01   +1.000000000000000e+00   +2.900443719832121e-01   +2.196740354864661e-01   +2.858594303535081e-01   -6.153407380207588e-01; -4.113341899675122e-01   +1.951611605798339e-01   -2.984445466957489e-01   -7.489888099998282e-01   -4.922194687005494e-01   -2.691606621609658e-01   -5.790641175911247e-02   -1.146515683699538e-01   -4.819883844714814e-02   +6.109866468572198e-01   -1.668525517351026e-01   +5.551937893313411e-01; -6.858149965431675e-01   -1.366222646308780e-01   +7.005494541680226e-01   -4.975087523054862e-02   +1.845143216114756e-01   -4.591240320001783e-02   -7.232407736071374e-02   -1.851385082589072e-01   +3.664621313867307e-01   -5.114942318012405e-01   +9.140407734219891e-01   +2.135701479478359e-01; +6.246947876522598e-01   +2.982370116030995e-01   -3.165413833318496e-01   +6.318738149925707e-01   +8.496767022641131e-01   +3.087546091314289e-01   +2.705862517011176e-01   +6.400528640320502e-01   -5.579498990172958e-02   -2.042452234707098e-02   -2.671787689761227e-01   +3.242173266298530e-01; +9.918519049399767e-02   +5.817421500474109e-01   +8.334270470442109e-01   +1.318949466125751e-02   +5.726094843063005e-01   +6.510176033259113e-01   -3.088259936556653e-02   -9.520090820929730e-02   -5.237490294261330e-01   +3.491010819487608e-01   -1.314041521109324e-01   -4.890452809231209e-02; +6.902341930776240e-02   +3.126550463942146e-01   +5.396959404108207e-01   +1.087648894315884e-01   +8.875639892402848e-01   +5.326966732724642e-01   -2.987774142358229e-01   +2.890772464469765e-01   -1.301536244887461e-01   +3.314462059193602e-01   -1.382105500012352e-01   -2.339709847179677e-01; +4.778144783276422e-01   +4.124573456890222e-01   -6.718086722951104e-03   +3.894815174823588e-02   +1.593233641697900e-01   +5.322494386104167e-01   -1.017073380983110e-02   +2.349647377752482e-01   -2.153194647122039e-01   -5.159179784366928e-02   +7.666878802071029e-03   +3.501681701554437e-01; -4.103018338634269e-02   +6.158312162278698e-01   +1.183178559181062e-01   -4.233184157215399e-01   +4.625904414744639e-01   -2.790093606823165e-01   +4.888557042609115e-03   -1.391602231867351e-01   +2.813215487653756e-01   -4.523252332873642e-02   +5.520547779406227e-01   +5.706083290632188e-02];
L3I_L2I_iGABA_netcon = [+6.647079501369280e-01   +5.503568149388504e-01   -1.001400618733879e-01   +2.326675539104172e-01   -2.945348873060964e-01   +1.063449269037553e-01   +8.749925022454341e-01   +4.753020392538297e-01   +1.266919830031925e-01   +5.083901460704232e-01   -9.804836621401636e-02   +2.665379340298537e-01; -4.357589049062598e-02   +1.150096722518840e-02   +4.264312676317246e-02   -8.550431225987726e-02   -1.568062634038574e-01   +2.661179740961719e-01   +2.317179969178141e-01   +8.659895807258181e-02   +7.435403398766087e-02   +1.166568432035302e-02   +5.482504083615566e-02   +2.809409542162750e-01; -9.376993623036495e-02   -2.267467059727724e-01   -5.386847005255741e-02   +2.065899366716863e-02   -3.152840411141795e-01   +3.901830385932032e-01   +5.950479711122465e-02   -1.428946876144772e-02   +7.756161044236279e-03   -2.483617754165633e-01   -7.535399108936723e-02   +4.442156933006747e-01; +4.317066720247973e-01   +1.295160231217435e-01   +2.955011728086687e-01   +1.570071000801370e-02   +1.757576409777401e-01   +3.602144308340219e-01   +2.870227269988476e-01   -1.493188329143648e-02   +2.734968327848143e-01   +3.326137244786211e-01   +2.298923820820770e-01   +1.699838909718816e-01; -1.801786023880282e-02   +3.926031802417876e-01   +6.290480463107456e-03   -3.548457153677340e-01   +2.626726981543936e-03   +3.389685021854833e-01   +2.066721041454338e-02   -8.468311652026128e-02   +1.267937605683136e-01   +1.625565095811242e-01   +1.305340456008556e-01   +8.975996834528105e-02; -1.390968634010310e-01   +2.394465829876465e-02   +2.420980723968201e-01   +3.213014129137049e-02   -4.369938958928267e-02   -3.964866279290295e-02   +1.364407360663966e-01   -6.763680518615625e-02   +9.021797599048627e-02   -1.102218266866152e-01   -6.696945745885382e-01   -2.396843978769730e-01; +1.231554829897655e-01   +4.621741478171473e-02   +2.289963236082408e-01   +2.869005236237451e-01   +4.080218547946103e-01   +4.339113847998454e-01   +3.964894632343436e-01   -1.145335046783261e-01   -2.121203883573982e-01   +1.737834160364214e-01   +5.111554857679003e-01   -2.453035769157085e-01; +8.042149339035348e-02   +2.223821443077554e-01   +6.591965396645139e-03   +2.957008988302761e-02   -2.855697914320119e-01   +5.424082916042730e-01   +1.106588474265779e-01   +3.159687721855955e-01   +1.942395030410149e-01   +2.023823237342988e-01   +1.968250403601974e-01   +4.010497352591768e-01];
L2E_L3E_iAMPA_netcon = [+8.559359761251234e-01   +3.497656679606425e-01   +4.146504438958494e-01   -4.433371617475322e-01   +1.801959676591561e-02   +7.167391132663334e-02   +4.547314618277291e-01   +5.292113255989830e-01; +3.748760625622225e-01   -1.752792473717849e-01   -2.832496353576385e-01   -9.123127108638913e-02   +7.561146618303248e-01   -5.098851415569460e-01   -8.116459734171870e-01   -3.909776576556410e-01; -9.423233618620769e-04   +1.359170817333554e-01   +2.123859711333690e-01   +1.970099659813498e-01   -3.097280781705869e-02   +8.273452237012610e-02   -1.392677874031464e-01   -2.800829158459921e-01; +4.434508036313156e-01   +2.330460928626182e-01   +6.689657221978045e-01   +8.581779850941346e-01   +2.226652364775826e-01   +3.788681510819893e-01   -2.302556377126797e-01   -2.704114407474191e-01; -1.375005882344687e-01   -2.203446091180861e-01   +3.018274879091862e-01   +3.497298258275895e-01   -4.836775288638463e-02   -3.357715302567559e-01   -1.531214862335621e-01   -5.091782820485272e-01; +1.936835418761526e-01   +4.296235946634515e-01   +8.671319396971279e-02   +6.710856012446823e-01   -3.083046560226187e-01   -9.603730895972924e-02   +2.425227314221542e-01   +2.241834036594371e-01; +9.651707826629169e-02   +5.012328182775772e-01   +8.851173879199830e-01   -2.962438808307840e-01   +4.970543378095221e-01   +3.231619688603987e-01   +3.700679234613808e-01   -2.580306506834747e-02; +1.378787446091404e-01   +5.091844196735346e-01   -3.207973166201183e-01   +1.041781276490870e-01   -1.785161448684067e-01   +6.455468683797567e-02   +3.805377349947118e-01   +5.060306707566142e-01; -3.447185938548487e-01   +5.622649516795517e-01   +6.003859556718527e-01   +6.208881076442736e-01   -1.052958710033682e-01   -3.382174059118070e-01   +3.988352348925872e-01   -2.194109443692580e-01; -2.057415834448863e-01   +2.827548483818502e-01   +2.814130620526298e-01   +4.271946291896526e-02   +3.108018097705313e-01   -4.264096874107163e-01   +5.473668039841101e-01   -5.655288912125964e-02; +5.888224080043638e-01   +4.146928756821063e-01   +1.473961022535338e-01   +4.012748905740782e-01   +3.485691575288304e-01   +6.875237316178107e-01   -2.996830263768298e-01   +1.584998809147387e-01; -6.011192772362525e-02   +1.353924324170794e-01   +6.179661762420324e-01   -1.411437911208533e-01   -2.161767436285285e-01   -1.090272361045834e-01   +2.024887196442771e-01   +3.458278207987357e-01];
L2I_L3I_iGABA_netcon = [+2.136414003479216e-01   +9.173097997564533e-02   +3.333918105974221e-01   +1.190069161359170e-01   +1.456452434758776e-01   +5.290170673960374e-01   +7.945130245692492e-01   +2.540913143998335e-01; -2.775119542735862e-01   +2.474659340940149e-01   +5.059968137221769e-01   -1.352953319433124e-01   -3.301565522327087e-01   -1.390895234237124e-01   +5.560772410867059e-01   +5.905695070645772e-01; +3.798252384260900e-01   +7.787039821815845e-01   +4.769719516878752e-01   +2.027304156233911e-01   +2.149334806181153e-01   +2.676588035918291e-01   -1.252842145198441e-03   +1.794072644796182e-03; -1.515003235614286e-02   -3.125054333869990e-01   +3.515845532468561e-01   +1.823367930475761e-01   -1.625204047223824e-01   +3.029179346754762e-02   +3.937472836057676e-01   +3.307632606293222e-01; -2.965268987308097e-01   -1.955870177816843e-01   +1.230147058957944e-01   +3.391204496704280e-01   -2.226918404894382e-01   +2.705576626778396e-01   +3.453283126877774e-01   -1.910517206063970e-01; -1.234235731873653e-01   +7.756968594895145e-01   +3.044371480090489e-01   +4.283553158316187e-01   +2.645254714983548e-01   +2.048838217766974e-01   -2.768634187307527e-01   -5.319129258686226e-02; -5.268336614230804e-02   +8.674381595698323e-01   +4.760932241666299e-01   +2.909846685807926e-01   -1.777179873904623e-01   -1.627530096452048e-01   +6.925524182320749e-01   +4.485079466036441e-01; -2.889894074393900e-01   +4.715032853942376e-01   +2.847609964507697e-01   +3.113440489493818e-01   +9.085043296382239e-02   +6.141776011069600e-01   +9.679056211560186e-02   +7.823085483178477e-01; -3.743479060111016e-01   +5.262272716176521e-01   +2.030439699097113e-01   +1.580598996141822e-01   -4.688332024546867e-02   +4.805900924627195e-02   +2.379347206939727e-01   +2.051118859723881e-01; -5.472037608384090e-02   -2.755575927478880e-01   +5.856259350470655e-01   +1.379593215000435e-01   +4.031461327547163e-01   +2.136077675188708e-01   +2.683661970419490e-01   +2.610893288440366e-01; +3.796082771954421e-01   -4.305589747040934e-01   -6.576919649524464e-01   +4.355618208624494e-01   +1.136768998664640e-01   +8.286772115064320e-02   +1.934370353210611e-01   -1.062326247923044e-02; -4.675317375270474e-02   +6.071157681916185e-01   -4.876780506108783e-02   +1.765967739219230e-01   +3.854934260879475e-01   +5.316555126699913e-01   -1.826071890833882e-01   -2.539039661570416e-01];
L3I_L3E_iAMPA_netcon = [+2.180560277560179e-01   -8.595035133404331e-01   +2.837086175192778e-01   -9.689550292347163e-02   +1.154631853516828e-01   +3.765254572226077e-01   +1.664281727447491e-01   +2.840826188020839e-01   +6.990749757440839e-01   -6.815665001026873e-02   +2.407404374349258e-01   +4.042376191076800e-01; -2.297938944534914e-01   +4.179473186642192e-01   +1.114197685789362e-01   +4.132703382334090e-01   +3.407745696335718e-01   +8.718507463505411e-02   +6.518756648249932e-01   +9.654007777775806e-01   +5.071043240587827e-01   -5.226634573828445e-03   -1.382346093117946e-01   -2.983114810116903e-01; +1.869132891645194e-01   +8.379233261404270e-02   +3.977319747897486e-01   -2.316920453573405e-01   +7.147069302592914e-01   +1.290383223187313e-01   +4.245144303157729e-01   -3.735078199508718e-01   +5.254351576811868e-01   +1.622680536522425e-01   -1.576373781412075e-01   -1.581378922669826e-01; -7.942533839309614e-02   -1.168384881483653e-01   +6.606662761669706e-02   -2.235344258312234e-01   +4.450465559849724e-01   +1.490208127070188e-01   +6.015269787047188e-02   +5.859856833451742e-01   -1.232685798745200e-01   +3.164139286595228e-01   +8.653952231037021e-02   +4.318304291720846e-01; -3.940500476849277e-01   +2.058262090600867e-01   +7.285780371510369e-01   +6.106619633126339e-01   +1.126087336289495e-02   +2.909158836526421e-01   +1.694417467563038e-01   +2.714590079056775e-01   +3.286256506494087e-01   -7.777626114987297e-02   +4.965921150352901e-02   +2.800115174075557e-01; +9.692775208825613e-02   -1.536131136511630e-01   -3.683582766001301e-01   +8.524293692836214e-02   +1.267799834091944e-01   -3.666620091764940e-01   +6.675964080377413e-01   +1.087191401723376e-01   +9.593576165737845e-02   +6.338283871887286e-01   -1.924892380197784e-01   +8.816755422065323e-01; +3.705786326684020e-01   +3.095002339570447e-01   -2.465162868429054e-01   +1.283250230464600e-01   +4.367184079938309e-01   +1.273650164748670e-02   +3.060971575781118e-01   -8.814719201407267e-02   +2.786911669168151e-01   +1.340953245615324e-03   +8.456174185351990e-02   -2.338793544618532e-01; +3.544902365343253e-01   +4.362752800532712e-01   -1.612803042301331e-01   -2.725888763069508e-02   +3.953711700249720e-01   +4.270125935554380e-01   -3.047147478797663e-01   +1.496246464748256e-01   -2.265087566473390e-01   -1.689071048555169e-01   -4.322757376752042e-01   +4.194415994559660e-01; -2.381961509224121e-01   +3.964817381960073e-01   +3.797573782517294e-01   +8.246984805184967e-01   -9.648393334103096e-02   +5.854036032522222e-01   +3.914967501883334e-01   +7.623259877569914e-02   +2.617449212021819e-01   +3.991692366698005e-01   +1.730436435946592e-01   +4.574037408975314e-01; +1.000000000000000e+00   -6.212361450083819e-01   +3.168297371187126e-01   -4.216630542320712e-01   +2.433226363424724e-01   -2.905535344016964e-01   -1.566522424026701e-01   +3.007043676811007e-01   -1.872495996741190e-01   -9.181850903060151e-03   +4.741025005923661e-01   -2.932577483393076e-01; -1.866187070596562e-01   +6.216306666008092e-01   +5.408459487153764e-01   +1.234294891176924e-01   +1.826793411959176e-01   +1.139563167225822e-01   +5.165564787241633e-01   +2.838815509813541e-01   +3.713849722519107e-01   +1.339873967607225e-01   -3.008072481628307e-01   +5.973418184226379e-01; -2.472713312883431e-01   +2.467613319897510e-01   +7.062830320880251e-02   +5.009702054060399e-01   -4.333625690030367e-01   -2.369628451832050e-01   -1.701913014988460e-01   +3.291723870885159e-01   +4.512085555665041e-02   -2.193995852083930e-01   +2.439798268294993e-03   -1.627310835448383e-02];
L3E_L3I_iGABA_netcon = [+7.892544436416379e-02   +8.915567239679927e-02   +1.279413401554439e-01   +2.098506382172438e-01   +2.113552067471841e-01   +1.482504229044376e-01   -1.023568160778338e-01   +2.411081152179031e-01   -8.899899388384820e-02   +5.428238708218365e-01   +4.991162407610701e-01   +3.786535645906800e-01; +4.329596892089503e-01   -3.447504649148033e-01   +2.193368602694260e-01   +4.483844461233991e-01   +2.462642797239520e-01   -2.488353143409164e-01   -9.557110284647648e-02   +1.162834439592211e-01   -2.733596189789308e-01   +1.562980069323430e-01   -5.583437969960133e-01   -1.843372666015486e-01; +3.482648941491184e-01   -3.889781881112425e-01   -5.809673780137703e-01   -2.170061703589056e-01   -2.655243207994664e-01   +4.802546341662007e-01   +3.841959456492756e-01   +2.921119177008386e-02   -7.060991985028442e-02   -1.936157261271863e-01   -1.644999774814259e-01   +2.761813966956064e-01; +1.132369973079579e-01   +8.397884512286664e-02   -3.451776515719285e-01   +5.083254042713488e-01   +9.675441724842352e-01   -2.050520058171858e-01   +5.613522653092207e-02   +1.872884335277692e-01   +9.590192693461588e-01   +1.723562858611472e-01   +5.562853887365447e-01   -5.297474700791249e-02; +2.806652431643551e-01   +3.360636608606017e-01   -1.887999746336117e-01   +4.148180517642879e-01   -2.878733156210251e-01   -6.840922882728727e-02   +2.759585297203588e-01   +2.392351407870708e-01   -5.936367396416520e-02   +8.851752228656926e-01   +3.147794810087474e-01   +2.906429722615970e-02; +1.917544218739046e-01   +2.939495202525846e-01   +1.186564331534053e-01   +1.131049326619303e-03   +1.926927119136065e-01   +8.016382376428277e-02   +1.916942290387341e-01   +1.430388587927813e-01   +1.675897682766971e-01   -4.975798687861337e-02   -3.192936177952359e-01   -2.739771307814244e-02; -3.611259043584098e-01   +7.597554972261188e-02   +3.323987323397812e-01   +7.956065387349761e-01   +2.333904990655026e-01   +4.217187910268222e-01   +4.586098964685429e-01   +6.799118555232109e-01   -1.252137347360326e-01   +4.352531225512977e-01   +3.690542257769951e-01   +3.254513209377858e-01; +2.895819917434070e-02   +3.267663862675915e-01   +3.685428389387301e-01   -1.814345655619598e-01   +2.570388921121167e-01   -3.382571560207251e-01   -7.403805738375001e-01   +6.298633024895259e-01   -1.660466423162712e-01   -5.214555448256317e-01   +4.988919766401110e-01   +3.421661907313742e-01; +1.930155184364354e-01   -1.333699088047926e-01   +5.969002993361106e-01   -5.018261520139684e-01   +4.030029535221124e-01   -6.429778697927009e-02   -7.356789201423589e-01   +8.765879203089427e-02   +1.946253815611287e-01   +6.947411558708390e-01   -1.523230998387328e-01   +5.704571639859308e-01; +1.893934054889961e-01   -1.227085059060888e-02   +1.891254752652752e-01   +6.043628038024301e-03   -3.383154217898259e-01   +2.599316260506385e-01   -4.678888565406806e-01   +2.639334004239203e-01   -1.353619463108501e-01   -8.055668173244515e-02   +2.737395278129411e-01   +9.821628196935431e-02; -2.093332309342407e-01   -2.642988307283775e-02   +3.293270215007419e-01   -3.711317934231843e-01   -3.068215745523946e-01   -8.500997354656563e-02   +3.053180784992854e-01   +1.625504943457154e-01   +2.978335003504766e-01   -4.789415956100515e-01   -1.620891876964305e-02   +4.408454548412291e-01; -3.558085305678346e-03   -8.713083337310433e-02   -4.014149380488518e-01   -1.364475511236995e-01   +8.510713867033964e-01   -1.594412716149402e-01   +4.044940292197792e-01   +4.210459238487539e-01   -4.813910481023043e-02   -4.266539922449649e-01   +1.317552666320196e-01   -6.274556377685871e-01];
L2E_Input1_iAMPA_netcon = [+8.982553732541125e-01   +9.084895808283329e-01   +8.703893010620305e-01   +5.623678636000831e-02   +4.232417747681967e-01   -8.027448795696661e-03   +6.330989803172187e-01   +5.245635493307135e-01];
L2I_Input2_iAMPA_netcon = [+4.701998344883979e-01   +7.473394455922202e-01   +7.610045621163521e-02   +1.404938037297633e-01   -5.382186887143750e-02   +5.205140446647543e-01   -3.879757771062287e-01   -1.020521499988449e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
