function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.555190650090840e-01   +7.200712809195073e-02   +1.211030709890696e-01   +7.210538521271206e-02   +1.795509179724742e-02   +5.057551857501705e-02   -1.431362322646876e-01   -1.552084282973697e-01   -1.696658519722447e-01   +3.547670852110221e-02   +6.234145508305648e-03   -2.220493715738023e-01   +9.288106525093509e-02   -3.023011188031882e-01   +4.710104987295961e-02   +4.885197659961223e-02; -1.175325241389297e-01   +8.417591744803750e-03   -1.592566173115456e-01   +5.916661127992490e-02   -6.342549975059943e-02   -5.196304029909338e-01   -1.640860497966953e-01   -1.671452871552219e-02   -1.344871824727240e-01   +1.448444005458537e-01   +2.350979065999038e-01   +1.242339467651488e-01   +1.144962238988650e-01   +7.032623503646290e-02   +2.344999149737031e-01   +1.993833539916874e-01; -5.470987215523732e-02   +3.169759028536422e-01   +1.633591783282699e-01   +4.786191488945456e-02   +1.289510538963619e-01   +9.180671091188621e-02   +6.726393249370737e-03   +4.378042136895366e-01   +5.748627392859735e-02   -3.292664261665010e-03   +4.431340221651876e-02   -8.109451038173993e-02   -5.905726537941649e-02   -4.288926602788343e-02   -5.385199866163008e-03   +5.447128593316505e-02; -7.548596319726229e-03   -2.523747529612635e-01   -7.256966082622765e-02   -1.206284710232726e-01   +6.127265802976609e-02   -1.151420189691701e-02   -2.288139728005594e-01   -2.333633617133022e-01   +4.172204393649278e-02   -1.941591958627401e-02   -1.184207411535524e-02   +5.189054237917681e-02   -8.362262539239367e-02   -1.995308677268524e-01   -7.769397580899966e-03   +4.726242475761369e-02; -3.470633135283598e-02   +2.798967033380025e-01   +1.699150923923728e-01   -8.757029272137970e-02   +4.608628400111611e-02   +2.598009010015432e-01   -2.102365351398237e-01   -1.996153231569426e-02   +4.552943813964014e-02   -9.795499130919025e-03   +1.540353606422717e-01   -9.056089361996750e-02   +1.645146658209743e-01   +1.406174265264788e-01   +2.513084679981558e-01   +5.783534485970042e-02; -1.378793472915424e-01   -2.172162864228370e-01   +1.690668293458005e-01   -1.106941515667336e-01   +2.128878441848846e-01   +2.968923147402999e-01   -8.518594721885726e-02   +5.997943088037494e-02   -3.869163446074214e-01   -3.298082656491322e-01   -1.645530169666704e-01   -2.959392215834163e-01   -2.777134299668816e-01   -1.426199933510477e-03   +1.642716974565281e-01   -2.461206462183892e-01; +1.818594299097703e-01   -5.056547977573723e-02   -1.557266356661705e-01   -2.339673697384034e-01   -1.549793848773360e-01   +1.167813739061803e-01   -1.876293585126981e-01   -9.193614122945475e-02   +3.311516014989613e-02   +5.291672962931063e-02   -5.754811732059553e-02   -9.653438209144836e-02   +1.618674759149294e-01   +9.470740906250466e-02   +5.511179750440164e-02   -3.583087589420436e-04; +5.489395350017073e-02   +3.747411529011870e-02   +2.302564529311468e-02   +1.708003671141062e-01   +2.244244851500387e-01   -1.406373114371850e-01   +9.779795936340244e-02   +1.019402634366730e-01   -8.023258790008468e-02   -8.215042978337428e-02   +2.620053401168026e-02   +1.440031011158902e-01   -3.108155285543863e-02   -7.066022064701591e-02   +1.959900264844267e-01   +1.314774073695062e-02; +5.443512371924400e-02   +1.769306190199205e-01   -1.384003308081278e-01   +1.292595286925323e-01   -8.860078631394372e-02   +1.188987869750551e-01   +1.373202224365441e-01   -4.178058408442913e-02   +2.048396226486096e-02   -3.943825566467715e-02   +2.305023444925525e-01   -1.405068495083940e-01   -1.322706821089966e-01   +1.265300810124822e-01   +9.692966337987207e-04   -2.284832107477877e-01; +1.553155178454884e-01   +5.734518533580421e-02   -1.079174411916968e-01   +1.369754054091573e-01   -6.180899013920233e-02   -1.368655174935102e-01   +1.143015744529459e-01   +2.446598455195580e-01   +1.855833779643646e-01   +2.288325203533816e-01   +3.007039366056339e-01   -3.304558492172595e-01   +2.819192280629455e-04   +1.211568532907364e-02   -2.245376814197917e-01   -6.778470534893297e-02; -1.057276218630147e-01   -1.844037347932370e-01   -2.166930690958175e-01   +4.481579933608063e-02   -9.384098875559040e-02   -6.360787573747272e-03   -1.217876421353021e-01   +1.856836982191591e-01   +2.386788404119141e-01   -4.883537818420126e-02   -1.584921530478432e-01   -4.670184273994713e-02   +9.440911413096029e-02   -1.292993876185240e-01   +2.767791765961787e-01   +2.820389789666292e-01; -2.051369480807835e-01   +2.268921146166826e-01   +1.093100424279419e-01   -1.143589377056624e-03   -1.660297729819649e-01   +3.733327233610708e-02   +1.999067026088785e-01   -1.118477767548675e-01   -1.842302748426460e-01   -8.420458056268534e-02   +3.536862368661434e-02   +2.225643469708918e-01   -1.187206176264344e-01   +9.285069577484545e-02   +3.357237884931262e-01   +3.516538766458368e-01; -2.033212192269129e-01   +1.388777317300840e-01   +2.369991356971839e-01   +1.012630240302611e-01   -1.947390566872149e-01   +2.288536196331885e-01   -2.471740635531762e-01   +2.256772277441095e-01   -2.378086535577371e-01   +7.894783377701971e-02   +1.086252744047466e-01   +3.964948482772608e-02   -9.209710203994241e-03   -3.225539354272235e-01   -1.601390431556599e-01   +1.927387920689029e-01; +3.674428579115746e-01   +4.163763705053012e-02   +6.815688579285512e-03   -1.434865800532376e-01   +1.820972749988932e-01   +6.516255310806546e-02   +1.645760432084128e-01   -1.814460324585077e-01   +5.539171507581077e-02   -1.578439507174015e-01   -2.006419486988515e-01   +8.619978947477308e-02   +6.844919098766637e-02   -5.129956257294130e-03   -1.264579234380676e-01   -6.671070352154088e-02; +3.249555829344504e-02   -1.154176517145831e-01   -4.490979172650604e-01   -7.722899067980496e-02   +2.427280724174417e-01   +4.447785112834332e-01   -1.858704982525990e-01   +1.292671246427267e-01   -2.641418629900551e-02   +9.297834249613689e-03   -1.473172157350601e-01   -3.833131385015939e-02   +1.273340241153830e-01   +2.349047143620249e-01   +2.147695063936058e-01   +8.756635973543325e-02; -1.447093783609762e-01   -1.384813022672847e-01   +2.004284255139798e-01   -8.827722692699888e-02   -2.677425815078568e-01   -2.147443757391475e-01   +1.007313382088718e-01   -2.365038123092856e-01   +4.994563353523505e-01   -1.836120639189697e-01   -7.220030915626166e-02   +4.184949414239186e-01   +4.522930281036824e-02   -1.916205649186166e-01   +2.473211699762517e-01   -1.033510444561825e-01];
L1E_L1I_iGABA_netcon = [+3.683295323907072e-02   -1.034809560983406e-01   -1.393956462882233e-01   +5.038648291700423e-02   -5.508008250835456e-02   -2.035918995245939e-01   -9.829138464524649e-02   +2.169374598575919e-01   +2.463126976885649e-02   -2.663616688195640e-03   +8.927478620722482e-02   +1.800242950714951e-01   -1.862924125028699e-01   +1.056966856004166e-01   +1.785549438396506e-01   +1.113206971146443e-01; +2.083254870756357e-01   -2.268495034675247e-02   -8.500930227322456e-02   +7.233749781598175e-02   -1.582524654159880e-01   +1.383789109131112e-01   -1.977973662697714e-02   +3.490234267066211e-02   +1.285001960347928e-01   -1.495803681486374e-01   +7.657966969061047e-02   +3.338051898989109e-01   -5.401400856376556e-02   -8.418635886218825e-02   -5.595806800855066e-02   +2.053260125700414e-01; +2.300225763094928e-01   +4.265676155601366e-01   +2.086613423623405e-01   -1.450638073622047e-01   -1.551944962192741e-01   +1.057751479672734e-01   -2.459743446616760e-01   -9.387273684302408e-03   -1.747076277534005e-01   +1.882809663217023e-01   -7.282501525549151e-02   -1.357145674589735e-01   +3.120325690006375e-01   -3.151127331810796e-01   -2.865990096319769e-01   +2.343877221201786e-01; +2.174490198626911e-03   -1.283133174838231e-01   +5.164319247279828e-02   +8.738451157991182e-02   -1.059486037413097e-01   +5.472214052834394e-02   +3.254921412514816e-02   +2.898734144089628e-01   +4.657501195163933e-02   -1.841050294693266e-01   -1.707087669960898e-01   +2.382797282489818e-01   -8.779960978528324e-04   -1.685921580259633e-01   -1.949394635730633e-01   +1.966538503355918e-02; +3.255917819123608e-01   -3.300830310746837e-02   +1.927794745125926e-01   +2.331112704631741e-02   -6.459394023148556e-02   +2.959643810300642e-01   -7.412573119587006e-03   +1.699015594194560e-01   +2.638697107896029e-01   +1.017179084228001e-01   +1.793250422620703e-01   +5.274499794832943e-02   +5.894948723835308e-02   +2.216191561130630e-01   -1.140769145034915e-01   -5.992440348456213e-02; +3.728950392892731e-03   +7.132466037515331e-02   -9.481181359574613e-02   +5.861734185600339e-02   -1.422526807767653e-01   +4.177735619222443e-02   +2.367705433522591e-01   +2.141574668790426e-01   +9.071514821948451e-02   +6.386519201766752e-02   +2.414989939133447e-01   +3.088402788926277e-01   -2.103604071545197e-01   +1.062136010071099e-01   -2.646304760730177e-01   -6.462118774604231e-02; +8.426676902212772e-02   -6.757472564995898e-04   +5.493028126256173e-01   +1.463098907027514e-01   -5.985250947746228e-02   +1.805642463078735e-02   +4.886395170720172e-02   +9.819109803797457e-02   +5.777664277836553e-02   -2.926949082199860e-01   +1.063737338014609e-01   -1.622067029568761e-01   -9.685580384712641e-02   -8.246999863435550e-02   -3.883275446394472e-02   -7.636357470019273e-02; -1.193006202189400e-01   +2.150229894820767e-01   +1.006438381070208e-01   +5.916201449977872e-02   +2.425298122240354e-01   -1.440130544259547e-01   +7.184107329852252e-02   -1.687242263710713e-01   -4.633266506790368e-02   +2.260341874432739e-01   +7.303193810127376e-02   -2.578746259649540e-02   -9.605957292322213e-02   +2.925715404264231e-01   -2.917053487333611e-02   +9.695836712655451e-02; -3.293847845211882e-02   +1.891192768292252e-02   +1.034879046158234e-01   -1.542347531333037e-01   +1.876572633883970e-01   +2.739275673698074e-01   +2.438740670351434e-02   -1.509614995929153e-02   -1.071855556275693e-01   +1.099204494149891e-01   -9.121076029075209e-02   +1.510026503854076e-01   +1.558461847895441e-02   +2.600447514108422e-01   +2.581118993819215e-01   +3.643979441957679e-01; +1.180982443694156e-01   -4.196814621332325e-02   -1.748386329624916e-01   -1.047241875863948e-01   +1.805751518944660e-01   -6.728249429796654e-02   +1.024059947706078e-02   -1.525342287180518e-01   +1.992593348181889e-01   +1.138964502428653e-01   +2.310493084724244e-02   +1.091713713421114e-01   -1.219082259814985e-01   -1.745985461632975e-01   +2.250544828404804e-01   -1.086570113142015e-01; -8.328790272373776e-02   +5.315465030356881e-02   +3.108930152808834e-02   +9.277443200403536e-02   +2.600838172381195e-01   -5.140756747961332e-02   +6.997114691412137e-02   -2.647601965140179e-02   +1.699338973097962e-01   +2.277216720867074e-02   +3.418558750449236e-01   +2.408992626482341e-01   +2.665004827856707e-01   +1.004820786636862e-01   +1.983984815916968e-01   +9.215708487900712e-02; -7.643396476616746e-02   +1.447961657168799e-01   -7.211510431134188e-02   -7.174915200132939e-02   -2.276842565864722e-01   +7.297389071078796e-02   +2.307250475246597e-01   +1.644065044476560e-01   +3.382371040603386e-01   +1.239422458273740e-01   -6.129968762369171e-02   -2.234111836966355e-02   -1.599626153945589e-01   -1.929388688896191e-01   -1.233350879197789e-01   +4.348797260725734e-01; +1.962237345834784e-01   -2.236115145724096e-01   +2.798451786216987e-02   -8.611596730356867e-02   +2.162366276439135e-01   -1.210040379580283e-01   -5.872264605261892e-02   -3.308573654138076e-01   -1.594768747619454e-01   -3.202154802928559e-01   +2.449077666216392e-01   -5.683043849676143e-03   +1.579839037710944e-01   -8.125829570680813e-03   -1.550061371069475e-01   +1.304170764716353e-01; +1.293910127698286e-01   -1.223692952504439e-01   -1.582335160455998e-01   +1.693420711419324e-01   -1.146814750324101e-02   +1.054879071351763e-01   -1.087219034603380e-01   +1.670588266009175e-01   +1.644682317965213e-01   +2.653053337798602e-02   +7.931135459800936e-02   -9.792300511013630e-02   -7.915269978829835e-02   -2.213473113446415e-01   +1.014245136615825e-01   +3.209290834411407e-02; -2.335595046102202e-02   +1.060823566210448e-01   +1.960596852899968e-01   +2.082771212383202e-01   +1.613226010249838e-01   -8.684255372723115e-03   +2.208956610268699e-01   -2.525872717556473e-01   +7.737771990392787e-02   -3.306049145258464e-01   +2.752463415864757e-02   +5.563964354312685e-02   +1.714487385634855e-01   -1.469733478216490e-01   +8.838627979269308e-02   +5.331280412122906e-03; +1.035426226914111e-01   +1.445206857163760e-01   -1.687915829277158e-01   +1.323467123800161e-02   -1.695375800331449e-01   +3.042576232817533e-02   -1.056604666430185e-01   +2.525661975940597e-01   +2.013341071155722e-01   -1.715370121356232e-02   +2.301114922744364e-01   -8.121931505601217e-02   -2.793954434965018e-02   -3.518175688138042e-01   +8.816837223363655e-04   +9.916459111102255e-02];
L2I_L1I_iGABA_netcon = [+1.869746184802663e-02   +1.381574821118908e-02   -5.960274900263209e-02   -2.464432147673691e-02   +2.142396735826647e-01   +9.710677405589399e-02   -2.934938979494923e-01   -1.576098315893205e-01; -4.306353124350752e-02   +1.307251045017578e-01   -7.568611508655318e-02   +2.236682817799265e-01   +2.438264140464042e-01   +1.292188621237440e-01   +1.726771271975885e-01   +1.128856638453713e-01; +1.374440678446124e-01   +3.383676816382887e-01   +3.689630008241817e-01   -1.212636809817559e-01   +4.530379776679363e-02   +3.902470988382014e-01   -1.258998377041375e-01   +2.376452071696592e-02; +1.771951959292524e-01   -2.330708990239045e-02   +2.740738699316531e-01   +2.036409614005640e-01   +2.312249326054067e-02   -8.716440105814816e-02   +2.853476269182602e-01   -5.105079523789113e-02; -6.027121759301535e-03   -1.853769698791942e-02   -3.871675703587524e-02   -8.533860103707432e-02   +1.815837072612251e-02   -1.614355751515556e-01   -2.960736592791400e-01   +1.657070120891291e-01; +8.933912379334490e-02   -3.664536022546559e-02   +1.653589405425275e-01   -1.356051892418543e-02   +2.311977710618651e-01   -1.422473535504955e-01   +1.089500812340384e-01   -2.195590938410481e-01; +2.862138330709026e-02   -3.787042205639394e-03   +7.400325959424404e-02   -1.874287773007174e-01   +9.111361458193287e-02   -5.757355820068637e-02   +2.767638446576627e-01   -1.099223796517619e-01; -1.056472140799238e-01   +1.518547555046143e-01   -1.637265424921356e-01   +2.595816965105834e-01   +1.103497215536926e-02   -1.359336755801340e-01   -3.265558905344049e-01   +1.419065485391735e-01; +8.645134743099496e-02   +1.086092193009603e-01   +1.503729612659609e-01   +1.593145760691154e-02   +1.296517818253895e-01   -1.374316488146365e-01   -4.258092082414837e-03   +6.082423401975784e-02; +7.912305801176821e-02   -1.412700851165880e-01   +3.912719145592318e-02   -1.994614331428904e-01   +4.497260736448861e-02   +1.831036341854160e-01   -1.352114594238888e-01   -1.686617775527641e-01; +3.455045422062173e-02   -1.652930510762126e-01   +1.171171197208068e-01   +2.040751476527259e-01   +2.916482075611755e-01   -2.637469567445043e-01   -2.741128075530387e-01   -6.307131674889793e-02; +1.426700556976340e-01   +3.180566928025093e-03   -1.558523668861047e-01   -2.180792566738950e-01   +2.730457096138173e-01   -4.816645984755667e-02   -3.914860232208439e-01   -3.696321227612334e-01; -5.088156385428048e-02   -8.122365412462053e-02   +1.031296010604629e-01   +2.257362006677631e-01   -3.768549814024522e-02   +1.165509463257797e-01   -1.523976557848373e-01   +8.733081733624928e-02; +1.714699370416901e-01   +1.963866203282867e-01   -1.017246607396901e-01   +1.637868409337069e-02   -1.222881698549464e-01   -1.540158661851055e-01   +1.210861814484306e-01   +4.230405019798835e-02; -7.221041589965688e-02   -1.441514546344117e-01   +2.671770357200239e-01   -4.189369720105618e-02   +1.876269868574351e-01   +2.512905669922510e-01   +1.398548290428328e-01   -1.607496040573402e-01; -4.432719706656051e-01   +1.513627066147637e-01   -1.197871439489756e-01   -3.359754003575802e-01   -1.732132074959687e-01   -3.429388990259168e-02   +3.161212578913376e-01   -2.336541826933873e-01];
L1I_L2I_iGABA_netcon = [+7.733636500954977e-02   +3.054159188066486e-02   -4.132205281793437e-02   -1.551665164524110e-01   +2.868545042107643e-01   +8.163882727010943e-02   +2.765405388817086e-01   -3.249500081309492e-01   +6.437112453023941e-02   +1.754836241951456e-01   +2.106215057682620e-01   -1.444091241572890e-01   +3.177290965952215e-01   +4.380353406256720e-01   -1.957124695238631e-01   +1.456522010210530e-01; +2.186212483290614e-01   -9.712830160917200e-02   -3.799684960228152e-01   +1.647089811056015e-01   +5.048856312091299e-02   -1.755590889587028e-01   -5.059028022066423e-02   +2.622736296183409e-01   +1.151633903207331e-01   -2.351963191153311e-01   -6.566939588824142e-02   +5.513904585020706e-02   -1.595369995328100e-01   +2.675065087243617e-01   -4.513725601652750e-02   +3.117369020940720e-02; -3.127054724500273e-02   +1.774861667889084e-01   +2.219309169673195e-01   -1.349435322088622e-02   -2.754241838425101e-03   +1.688841479199628e-01   +1.087300970638008e-01   +2.736061120938010e-02   +3.556704211658017e-02   -4.542281759546071e-01   +5.734758379608434e-02   +2.321348143987683e-01   -3.793889693677875e-01   +1.858212742024232e-02   +1.557627710402626e-02   -5.376139033679911e-02; +5.450371954458863e-03   +2.841853666927324e-01   -1.242230481946623e-01   -1.672848141544415e-01   -4.812997020585203e-02   +1.855750327733429e-01   +2.464400702290638e-02   -2.199108314674619e-01   -2.334576484703697e-01   +2.958190952006872e-01   -1.335453578737380e-01   +9.020316860187981e-02   -2.454304561717106e-01   +9.247775318250215e-02   -8.583542337331765e-02   -6.770082038339377e-02; +1.184857927114063e-01   -1.053756876973083e-01   +2.133651595320854e-02   +1.051862277975983e-01   +4.259762838906032e-03   -2.048570987382880e-01   -2.763068951599982e-01   +1.318922457361474e-01   +7.232379677805248e-02   -2.940695285812441e-01   +2.986232560647696e-01   -1.629658292391641e-01   -3.013848061069621e-02   +7.830775222834901e-02   +1.897784969392333e-01   -7.767817242273238e-02; -6.514058538932004e-02   -2.424571373080967e-01   -3.935017712395089e-01   +9.085146404236381e-02   +1.354426992760034e-01   -1.061492202626807e-01   +2.765847479707901e-01   +1.192818538773559e-03   -1.127646207588554e-01   +9.790031229749363e-02   +1.867542650721233e-01   -3.203968967683159e-02   +2.121386677052892e-01   -8.344157370821850e-04   -1.642667272863806e-01   -1.189412089413188e-01; +1.163499609923054e-01   -4.983935275301569e-02   -7.523190650995137e-02   +8.163888069883819e-02   +1.824092958221059e-01   +1.936379202908164e-01   +1.394106745132195e-01   +1.277112239927248e-01   +2.860306697252433e-01   +2.172124840354210e-01   +6.567162995343577e-02   -8.976429840365577e-02   +2.684265015603355e-01   +4.124057608748748e-02   -8.772629413910282e-03   +2.375753307775834e-01; -2.339192130038584e-01   -3.953956518145178e-02   +1.716597583455434e-01   +2.564625638601630e-01   +1.475353015175351e-01   -4.603374783317654e-02   +1.609054345041605e-01   -2.363670411243186e-01   -1.235520890451469e-01   +1.659995179367385e-01   +1.185270105240394e-01   -4.048686967071552e-02   -3.241619725630801e-01   +1.061679864897057e-01   +7.393783453429523e-02   -1.399265728038643e-01];
L2E_L1E_iAMPA_netcon = [+1.941374380244899e-01   -9.084760977115904e-02   -1.631112724400478e-01   -1.452647571091873e-01   +4.045702831706713e-01   +1.515753814271488e-01   -2.203144317304040e-01   +1.691001960140270e-01; -8.981641051714584e-02   -8.219032401405703e-02   -1.284820120807380e-01   +1.620554429614185e-01   -3.623016563245525e-02   -2.858666515312523e-01   -1.124025201906808e-01   -4.547975071460364e-02; +3.140939461220842e-01   -1.208841291298953e-01   -1.689893024829573e-01   +7.530689993484549e-02   -8.350963350480170e-02   +1.470646305486944e-01   +2.602182281954706e-01   -3.472817949734851e-02; +3.408739925927404e-02   -1.754466041918827e-01   -8.985356503964946e-03   -1.101232088913396e-01   -7.500888024976256e-02   +1.650848554039626e-01   -1.697651555521742e-01   -4.707996007531540e-02; +1.223646923616906e-01   -8.532564914413222e-02   -2.906052911028082e-01   +3.609506287901291e-01   +2.284661595720441e-01   -2.621332043201161e-01   +3.224614958489396e-01   -3.294134906581904e-02; -8.714740887743991e-03   +1.161958059876392e-01   +6.864540690080134e-02   +2.217144530939386e-01   -1.103434480634370e-01   -1.672238917850368e-01   -2.274553378327318e-01   -3.050354987386445e-02; +6.816952431655537e-02   +6.040642351283856e-02   +2.068290832306074e-02   +1.344356250297663e-01   -2.765566317942629e-02   -1.195512976195902e-01   +1.628989355271906e-01   +1.551298538286460e-01; -3.603852727202134e-02   +2.509774569701070e-01   +4.079355177793902e-02   +1.355450740814975e-01   -5.767416316941774e-02   -1.053685377306675e-01   -2.098652020763666e-01   -3.352909794099610e-03; +9.361783177250317e-02   +1.271648347245921e-01   +3.254479696831198e-01   -3.020895341745609e-01   -1.668661273168299e-02   -2.606581218036149e-01   +3.889144417552742e-02   -2.083515481278504e-01; -6.110081743216275e-02   +3.816825800736227e-02   +1.838402651110989e-01   -1.669263799220196e-01   -2.635414004950726e-01   +5.895990651777851e-02   -1.264119685476897e-01   -7.268815811819704e-02; -6.851494850132270e-04   +1.572278678810120e-01   +8.773686205505650e-02   -3.259698323109129e-01   -2.889849233559233e-02   +1.580979031385196e-02   +2.066727803311782e-01   +4.415322676839991e-02; -1.095149915646567e-03   +1.720965855223519e-01   +1.249506948606414e-02   +1.909572104430355e-01   -3.778385275679448e-01   +3.059429610042048e-02   +1.416544213635473e-01   +3.249258724208268e-02; +2.196091701243633e-01   +1.962127626581022e-01   +2.556802159502512e-01   -2.049281146279622e-02   +4.017316645915557e-03   +1.619296622576122e-01   +5.550497903985567e-02   -2.341976429733419e-01; +2.172153838638362e-01   +5.441399282817104e-02   -6.753438061714437e-02   +5.977215929442014e-02   -2.634300676741415e-01   +3.623435834489678e-01   -2.992125905228943e-01   -7.661356123140551e-03; -8.870665665962368e-03   +8.789125393829639e-02   +1.564111297556056e-02   -1.982263465472605e-01   +3.952892929114240e-01   +2.473882926918628e-01   +5.084593584394370e-02   +1.438543441766022e-01; -1.701109251050138e-02   -2.890745354779647e-01   +1.743811117165446e-01   +4.835253557818724e-02   -3.202966452081900e-01   +1.543947123280577e-01   +2.000336004428973e-01   +5.596447753849383e-03];
L1E_L2E_iAMPA_netcon = [-9.973498880153414e-02   +1.739877910870525e-01   -1.592773770697274e-01   -1.474955386371035e-01   -4.986060345577455e-02   -1.540338653361795e-02   -9.200600660691784e-02   +2.481562824364233e-02   -1.049299296987186e-01   -9.672900751812488e-02   +3.004280929563775e-01   -6.940794048149179e-04   +5.783304061868024e-03   -1.761572889144868e-01   +2.043759300879724e-01   -1.726091274184171e-01; -1.127134838143082e-01   +7.402110942809471e-02   +1.582013908584833e-01   -2.880909923932544e-01   -1.877317571948620e-01   +3.898712291729488e-01   +1.464018115232383e-01   -1.200556871184832e-01   +3.855255415675116e-02   +3.445065774724574e-01   -1.075395382885335e-01   +1.852182546424016e-01   +1.329001559158834e-01   -1.954604924341107e-01   +1.176762958607873e-01   -3.851890728529773e-01; -2.771379990095101e-01   -1.348175843300839e-01   -4.287941305244814e-02   +1.935757826223515e-01   +2.145304437262558e-01   +1.664324428691375e-02   +1.783811612989367e-02   -3.161770826452457e-01   +2.632317417890390e-01   -6.231623228268052e-02   -1.009593455962063e-01   +9.795293863315747e-02   -1.218362481982409e-01   -1.096547728832839e-01   +1.857110937145220e-01   +2.750287415473150e-01; +1.855384437480525e-01   +1.580113200389007e-01   +5.026772099647876e-01   +2.970121030502787e-02   +1.161521943241080e-01   +4.424826427726386e-02   +8.890553089763789e-02   -2.410356760589198e-01   -7.557796976232585e-02   -8.733479304146470e-02   +2.518747817953692e-02   +9.191992383597780e-02   +3.774775003169477e-02   -2.534482798726711e-01   +2.148524845726024e-01   -4.899340343384851e-02; -2.574103589220203e-02   +1.379775291440574e-01   +9.615434149086227e-02   -3.448835406159777e-01   +5.191565066133998e-02   -1.895489352682057e-01   +2.220356262302058e-01   -1.640111885999941e-03   -1.090119573592395e-01   +1.929088971580199e-01   -7.252231018960772e-02   +1.181610284938236e-01   -1.330450151747499e-01   +2.880090823827091e-01   +1.052842009394862e-01   +1.643172050003470e-01; +1.251620538842369e-01   +3.092233090304388e-02   -2.496128094547798e-01   -1.193839641816407e-01   +2.892340843561392e-01   +8.417392269659211e-03   -1.534459254709258e-02   -2.664910575455036e-01   -1.629090598077269e-01   +3.555080764912215e-02   +8.871985060389599e-02   -2.495499550156492e-01   +2.365791128988670e-02   +3.512295583206522e-02   -1.734320595407149e-01   -1.700583865764659e-01; +7.846734275699246e-03   -9.976595326504091e-02   +1.954383322932335e-01   +9.108188980135962e-02   -1.242851203129187e-01   +3.865845189346319e-01   +3.873464569745518e-02   +4.424174624607988e-02   +1.928097489953939e-01   -1.705656849689819e-01   +1.466061167605438e-01   +9.226206655628796e-02   -1.122655525307946e-02   +9.855342702296392e-02   -2.310550095915561e-01   -4.362378367889881e-02; +2.730275771442505e-01   -5.136213782103386e-03   +1.382885046744429e-02   +5.486806353346640e-03   +3.129859331754263e-01   -2.920090477309927e-01   -7.889503478099794e-02   +6.682638331618800e-02   -9.511125675380691e-03   -6.530587262759474e-02   +7.973825790683703e-02   -1.138423126523365e-01   +9.046928045577049e-02   +1.472635854194169e-02   +2.319291554783232e-01   +2.699561361588886e-01];
L2I_L2E_iAMPA_netcon = [+6.025147854909731e-02   +3.018021367833341e-02   +1.696508547464765e-01   -1.975373124182581e-02   -2.403443625049150e-01   +2.064202084431523e-01   +1.786180084487494e-01   +1.195105591748210e-01; +5.523990430437166e-02   -1.018872016907819e-01   -4.657601610881935e-02   +5.332330901647855e-02   -7.041217263823062e-02   +2.017339608152458e-01   +6.109071100853413e-02   -2.324359806456026e-02; -1.850439638775739e-01   +3.570203299148370e-01   +1.227147977271323e-02   +3.353227070467859e-01   +7.602226978831123e-02   +7.220719727056298e-02   +3.283175950874154e-02   -2.209643104223866e-02; +8.293653524304617e-02   -1.536484011720660e-01   -2.516732947234352e-02   +1.990169348819366e-01   -2.041370444977597e-01   +2.266183341622562e-01   +2.324338317874155e-01   -8.909498580254464e-02; -5.834300971208996e-02   +2.516729157440564e-01   -1.273323051764279e-01   +1.119734807394977e-01   -9.254853276178722e-02   -1.823843733016402e-02   +1.808852957714685e-01   -9.468356260256605e-02; -2.020135243736852e-01   +1.170010999879799e-01   +1.194262328366645e-01   -7.439001639919830e-02   -2.464734596669787e-01   +3.530844528926899e-01   -1.551093027983116e-02   -1.167171991081433e-01; +2.903586912261501e-02   +1.207016239882024e-01   -3.685384223307034e-02   -1.901681799107937e-01   +1.028964314939364e-01   -2.597461760984547e-01   +3.146494636804590e-02   +6.355954191376950e-02; +2.358005332335839e-01   -1.015032489307133e-01   +2.222593270864491e-01   +1.205824203775929e-01   -2.447830616290404e-01   +2.551448106263744e-01   +2.150098382626952e-01   -5.651492833446350e-02];
L2E_L2I_iGABA_netcon = [+4.979781147475325e-02   -9.805685596305863e-02   -1.100426727948557e-01   -1.369381475676877e-01   +1.344968711319235e-01   +7.623486909942982e-02   +4.570855980723740e-01   -1.900362154547935e-01; +3.973684116616160e-01   -2.544583019506239e-01   +1.547492183561835e-01   -7.311254250865670e-02   -4.800901824096114e-02   -3.490417047323674e-02   -3.501377082684980e-02   +1.374795969042637e-01; -3.172958922458770e-01   +5.679256520997275e-02   +3.820688381893244e-02   +2.898854314704666e-01   +1.104026237896917e-02   +1.954225514237675e-01   -2.643335656988248e-02   +4.229763768477016e-02; +3.545360228312080e-01   +7.282469336170416e-02   +5.177379400917273e-02   -3.669082255727224e-01   +1.578322241137726e-01   +1.072742828965608e-02   -8.696327366003243e-02   +4.758570088041232e-02; +1.214997112588941e-01   +6.406390373547712e-02   +6.906292328055558e-02   +1.115260040694566e-02   +4.498004979536314e-02   -4.802861251602380e-02   +4.531892361323736e-01   +1.361544491397022e-01; +1.238797289199841e-01   -3.134390797267687e-02   -2.273309624016612e-02   -1.713894956411105e-01   -1.702905808063683e-01   +2.491501579906070e-01   -3.722280452057038e-02   +8.561945821445607e-02; +2.933872657604140e-01   +8.657424332776505e-03   +4.049511369691212e-01   +2.083381018474793e-02   -5.691634416812882e-02   -4.096447550344721e-02   -6.412362411058745e-02   +5.770512410063065e-02; -6.002905786776709e-03   +5.079586557918443e-02   +3.119819820380941e-02   +3.432662777247567e-02   -6.072822622302589e-02   -1.026032971827391e-01   +1.939131943983933e-01   +1.689293895837346e-01];
L3E_L2E_iAMPA_netcon = [-1.624537934404973e-01   -4.207244771207951e-02   +1.658503092848442e-01   +6.422585808000779e-03   -6.519962553258804e-02   +2.675709015645896e-01   +1.327170235095972e-01   +2.860838444972969e-01   +1.721083385777076e-01   +3.120224788967828e-01   +1.252934255743019e-01   +6.827412667691615e-02; +6.036005030985059e-02   -4.969391241971563e-02   +2.428426611776413e-01   -6.693781713817351e-02   -1.015989335714195e-01   -1.070454331044277e-01   +2.687187976372175e-02   -7.683539472765026e-02   -1.958571337864070e-01   +1.077635493919028e-01   +4.052031028214781e-01   -3.975304318527062e-02; +5.740732186846326e-02   -7.670175904890229e-02   +1.319647195095940e-01   +2.647141169931406e-01   -1.035503932208595e-03   -3.643802751508777e-01   -4.216062045762994e-02   +4.215717924277151e-02   -7.901218919855334e-02   +2.165876736940359e-01   -9.512908664239421e-02   -1.416781968789786e-01; +2.888785262688567e-01   +2.347801250432091e-01   -1.398543664016892e-01   +1.799548847247482e-01   -1.016525891433638e-01   +1.163039989470965e-02   +2.470156285836399e-01   -1.935259295412038e-01   -2.610584550454448e-01   -2.617089002345377e-01   -2.136738767230964e-01   -3.132296401637975e-02; +2.047923326758797e-01   -1.849875570531278e-01   +1.447998266094435e-01   -1.112193384055490e-01   -2.745704691330612e-01   +1.340502972594591e-01   -6.959975058075780e-02   +1.523269373459062e-01   -1.668947521775201e-01   -7.762898103616386e-02   +3.243610585923757e-01   +2.261986244021367e-02; -8.939589606689638e-02   -5.331553301866154e-02   +7.689338845528430e-02   +1.469473321071526e-02   -3.914125859314550e-02   +3.577832914460714e-01   +2.834760920502550e-01   +2.815167491999776e-01   -2.415396063523602e-01   -3.257552778036368e-02   +2.281347013058679e-02   +1.013501876777490e-01; +1.377686435538062e-01   -8.902423994225288e-03   +1.112531921494125e-01   -8.836930759140471e-02   -2.982707712112203e-02   -1.193409048995158e-01   +3.555206460544029e-02   -1.576189605270453e-01   +3.215355335040764e-01   -1.238579189180120e-02   -1.273356915667004e-01   -3.366389253462566e-01; +1.043486618734553e-01   +7.101119854103839e-02   +2.442710549524087e-02   -1.115599480464537e-01   -1.533810027137666e-01   +1.341585852772415e-01   -1.398425951692357e-01   -2.269250457040029e-02   +2.334234396938275e-01   +1.732984932525732e-01   +4.578583660070919e-02   +1.005695095904069e-01];
L3I_L2I_iGABA_netcon = [-1.301800163474215e-01   +3.223815196817407e-01   -6.258929377031405e-02   -3.694611285339889e-02   -8.819614621775793e-02   +2.078585325191178e-01   -2.266174574433290e-01   +6.416391691278797e-02   -2.566073221566583e-03   +9.854208762100217e-02   +9.236367595678663e-02   -6.390047789463007e-03; -3.999790976080860e-01   -2.216251181260345e-01   +1.046745641518223e-01   +1.807521703313185e-01   -9.345046983474675e-02   -6.914722788137453e-02   +8.602755956384581e-02   -2.272986312765264e-02   +2.558041139554395e-01   -2.719243306286111e-01   +1.234649362553188e-01   +2.267173574503787e-01; +2.739465471298526e-01   -1.243386899023230e-01   -1.696577421351691e-01   -1.339359534876229e-01   -4.412321894252907e-01   -3.272914330875267e-02   -1.715463345318889e-01   +2.485324022360525e-03   -7.574912593485943e-02   +2.482550512589796e-02   -3.197523400787056e-01   -1.379362566511011e-01; +3.917264148654772e-01   -1.244843678311679e-01   -8.225968495734763e-02   +2.750988127063519e-02   +3.419754877974357e-02   +1.753446196743449e-01   -2.561813951853210e-02   +2.951669111911445e-01   +1.775704879750799e-01   +6.366503899591938e-02   -4.149807070157119e-02   +2.819735207832579e-01; +3.105227107459356e-01   -1.173402612078463e-01   -2.777790147898818e-02   +4.601071504169016e-02   +2.337298491247834e-01   -3.111520052098958e-02   +1.240357529824289e-01   -2.076727419855816e-01   +8.171277674278528e-02   +1.295371651611413e-01   +1.741783316030422e-01   +2.077621164585279e-01; +1.258876778724377e-02   +1.629631936366267e-02   -6.254496008873295e-02   -6.078614908007555e-02   +2.806294731181028e-01   -1.046320072573140e-01   -2.513109797261420e-01   -4.972554816436489e-01   -8.064366478988126e-02   -8.811886760485861e-02   +1.334316993017825e-01   +6.184368386602798e-02; +1.538965182814928e-01   +9.440836056583940e-02   +4.251642090015904e-02   -2.840733639361517e-01   +2.005860863193897e-01   -1.146384521281899e-01   -1.490722674694732e-01   -1.190108705570769e-01   -1.977479762300581e-02   -2.878636545550730e-01   -8.671823505034361e-02   +9.997064474428358e-02; +2.311907502952245e-01   +1.698895373362878e-01   -1.164200845568973e-01   +5.876349443158228e-02   -2.425050357697404e-01   -5.831852782154463e-02   +9.154304792720160e-02   -6.106331124504037e-02   -1.033250686396709e-01   +1.505933149402644e-01   +1.444737674812605e-02   -5.736564346781499e-03];
L2E_L3E_iAMPA_netcon = [-2.028303718271744e-01   -2.880302073795250e-02   -4.051863200348988e-02   +2.585694345344882e-01   +3.040979829640643e-01   +3.510069050046443e-01   -2.036816337516960e-01   -3.025012386945425e-01; +1.479600710006802e-01   +1.506791782165889e-01   +1.256516913992342e-01   -1.577878746392644e-01   +1.401576801073902e-01   +2.719600429644928e-01   -1.178762926469156e-02   +3.025347115825468e-02; +1.574940041025821e-01   +3.277175031541149e-01   -1.549128093909874e-01   +1.161372171768100e-01   +1.602484966891156e-01   +3.355151481386030e-02   +2.217602931249801e-01   -5.188905013861111e-02; -2.798034335589545e-01   -1.949592385738457e-01   -2.762160687381437e-02   -1.279549924089022e-01   -2.837865705167836e-02   +7.013096099280700e-02   +2.036447686281702e-01   +4.047398764416939e-02; -1.785583367685302e-01   +1.623960968301479e-01   -1.714816759054454e-01   -3.467585417385360e-01   -1.601413446784605e-01   +1.616515198204684e-01   +5.575895805218954e-02   -4.024075836116996e-02; +2.028463804844688e-01   +1.129245896739943e-01   +2.416357236109632e-02   +5.020094880590358e-02   +3.772256476023417e-01   -1.617970490824885e-01   +8.415656191326398e-02   -1.253644541376452e-01; +1.754606564727653e-01   +1.426177815811924e-01   +4.477664369809586e-02   +9.683774084596269e-02   +1.957973363510229e-01   -8.907889956949289e-02   -3.888689255047710e-02   +3.386914039850530e-02; -1.780599815766778e-01   +4.239822100755885e-01   +3.522957463864534e-02   +1.815800827888653e-01   +1.268291952257083e-01   +6.363771471155409e-02   -8.754736733356146e-03   -5.953449761419385e-02; -8.151390366146379e-03   -2.726910621358608e-02   +4.867512476907750e-02   -1.336861915870404e-01   -3.160228652250809e-02   -2.257570101029956e-01   -1.543030078723876e-01   +2.453790089920811e-01; +3.433788349777653e-01   +8.062360602186117e-02   -2.689123457088902e-02   +3.428286465482585e-01   +2.811268643049299e-02   -8.146268768410896e-02   -2.013533968441911e-02   +2.936707034813744e-01; +4.704104795190023e-02   -4.907375149023879e-02   -2.390443062092150e-01   -1.780852098969781e-01   -5.199726864193883e-02   -6.374723759293918e-02   +4.797436493793463e-02   -1.472223193512822e-01; -4.444945047205421e-01   +1.794002671871719e-01   -2.646968410243679e-01   +1.975417012536920e-01   +9.425283059262188e-02   -3.918382163385107e-01   +1.543281956901309e-01   -4.027648136622611e-01];
L2I_L3I_iGABA_netcon = [-2.657196497797875e-02   -2.067458204309079e-02   -2.316930873672462e-01   +9.545832797011944e-02   +8.090897409638005e-02   -1.027198340040471e-01   -2.524925357036975e-01   -1.126701238182135e-01; +8.732645404773724e-02   -1.280361711464868e-01   -3.560949169083616e-01   -2.863433665447391e-01   +1.197663698424307e-01   +1.220855718617743e-01   +1.239990945030330e-01   -5.568798732776065e-02; +5.641463571841868e-02   +4.122078546906118e-02   +8.195905976681826e-02   +3.527591540709383e-01   -8.663546837130651e-03   -5.414828922085482e-02   +1.201425035640484e-01   -1.031368516987797e-01; -1.339323105807084e-01   -1.749672585934522e-01   +2.498462086412110e-02   +7.071296495309599e-02   -4.091298466203783e-01   +1.930885184932721e-01   -9.418979058811144e-02   +4.457342012626687e-02; +1.363988311312307e-01   -1.729202775481026e-01   -2.890726955612503e-01   +1.264797888228317e-01   +2.924152016703308e-01   -8.666920734747185e-03   -2.095740586035679e-01   +1.303056307610677e-01; +3.433433098576780e-01   +9.636819366389456e-02   -7.588603957716478e-02   -1.961552470652028e-01   -2.587771823544839e-02   +4.006651450736346e-01   +3.833047692385309e-01   -2.297727879451696e-01; -9.595657134098616e-02   -1.130080357397222e-03   -3.006388632650853e-01   -1.755199477366039e-01   -4.474942425537101e-02   +1.242938461237636e-02   +8.435260782855555e-02   -2.931428420144078e-01; -2.322172805671884e-01   +1.055894172210137e-01   -4.175600148617500e-02   +1.648374872124196e-01   -1.639992423856662e-01   -7.240179084508208e-02   +1.003046394142161e-01   +1.017476646964828e-01; +6.070403505895484e-02   +3.974406245528271e-01   -4.434237142614138e-02   -1.360899834216852e-02   -8.848459639732936e-03   +2.639722135665085e-01   +1.585994219612420e-01   -7.784471375680574e-02; +2.436794021672513e-01   +2.801990449985945e-01   -1.004144606814485e-01   -1.279220258793209e-01   -1.079326941837097e-01   -6.270399775828589e-02   -2.256879425052236e-01   -5.599663145831459e-02; +6.701376287502807e-02   -2.116274165086729e-02   -2.655137584783590e-01   -2.879627771733022e-02   -2.723661641540879e-01   -2.152708575366580e-02   +1.764580340140397e-01   +1.711363338012695e-01; -1.474126059958941e-01   +1.513578885641561e-01   -1.727348229331969e-01   +2.337463614685396e-01   -3.740099981917603e-01   +5.522729772891807e-02   -1.199592243623817e-01   -1.704416796266099e-01];
L3I_L3E_iAMPA_netcon = [+1.242576793479941e-01   -1.981798976106794e-01   -2.187991556514004e-01   +1.600737430794438e-01   +9.355690287375237e-02   +1.936830213921927e-01   +3.089881341042484e-01   +3.748383895824816e-01   -9.661270476128725e-02   +1.068178471426208e-01   +7.066680483562512e-02   -1.257525013492076e-01; +8.857239207503169e-02   -1.216987767983248e-01   +1.880900238878355e-02   -2.791741107385063e-01   -4.463288687384995e-02   +1.436806211884967e-01   +1.426244210178896e-01   +3.414289222258551e-01   -2.710338860399343e-01   +3.046024025991374e-01   -2.616701042058998e-02   +1.242205045688998e-01; +6.342879662377221e-02   -2.598919491734509e-01   +1.421404875558075e-01   +1.922188720724345e-01   +1.004615052541783e-01   +1.416133343986314e-01   +3.479115691960679e-02   +1.112760373559141e-01   -1.572923759599751e-01   +2.002908231736186e-01   -3.923159237102405e-02   +2.702821562141469e-01; -1.101789028644008e-01   -2.554530958747304e-01   -2.872744011401261e-01   +2.485116857236690e-01   +3.682563725871790e-01   +2.274293266418308e-02   +3.226409171296166e-01   +1.324550744747442e-01   +6.731623413975395e-03   -2.776886394776554e-01   -5.353061764065536e-04   +1.886537993535775e-01; +5.333016158834770e-02   +1.645343989848047e-01   -1.095544343691403e-01   +2.176653900838401e-01   -1.967252033057809e-02   -1.644017055444853e-01   +3.223461797005547e-01   +2.789666011351732e-01   +3.031035214778948e-01   +4.732615623470065e-02   -4.519263441356662e-01   +3.919477324181492e-02; -3.161650406487242e-02   +2.099259840055972e-02   +3.827140069819854e-02   +5.432977366000394e-02   -1.285360456216385e-01   -1.773401194318488e-01   +5.740878378150691e-02   +2.223308334691263e-01   -5.419795944691696e-02   +5.684745112525772e-01   -2.835593616303752e-01   +1.082654464347947e-01; +1.024116828404171e-01   +2.090490664849071e-01   -1.920059240462624e-01   +2.118131821535824e-03   -1.747087681194678e-01   +7.664449782830535e-02   -1.258790477497319e-01   -1.429579886156273e-01   +1.652270031481449e-01   +3.034555441720906e-01   +7.607340431920376e-03   +2.304340279295648e-01; +9.224032517894712e-02   -1.893545224616971e-01   +2.921886145560630e-01   -9.009825630195216e-02   +1.330380401133159e-01   -2.501134185231041e-02   +3.525601181983483e-02   +2.572643464712770e-01   -1.815976493463634e-01   -1.514099598849549e-01   -3.353582201742870e-02   +2.309299864260007e-01; +1.489012530140479e-01   -2.521233859206821e-02   +1.049240849071718e-01   -2.846203766030501e-03   -9.189003080989633e-02   -1.848635463657559e-01   +2.109494218664200e-01   +3.671629934299123e-02   +5.822951698647159e-02   -5.768168620225320e-02   +1.099404743142871e-01   +8.002173667622837e-03; +9.072949594159199e-02   -2.437019566958079e-01   -2.048215532789069e-02   -2.557638276271393e-01   +3.126383526226801e-01   +2.600068261751026e-01   +6.165669012766549e-02   +1.162211515890060e-01   -1.508160511484449e-01   +1.308738556714370e-01   -1.659867198776710e-01   +1.860713869944877e-01; -1.792386855982977e-01   +5.715990232758493e-02   -5.081623728412690e-02   +4.248533211823788e-02   +5.752129668227605e-02   -7.397638618253791e-02   +6.165302394314948e-02   -1.251070546757750e-01   +5.701546264244253e-02   -7.428856917575104e-02   -2.625983051866978e-02   +8.014885531143137e-02; +1.863791765893144e-01   -1.003902006860188e-01   -5.001389332785010e-02   +1.708597385623198e-01   +2.116197922965061e-01   -1.371213748908606e-01   +2.521393282383799e-01   -3.725826422069475e-01   -1.325304148601266e-01   -2.155042140187717e-01   -2.504325042086296e-01   +7.236263735016657e-02];
L3E_L3I_iGABA_netcon = [+4.358364414601970e-02   -1.640832417414297e-02   +1.254653690568022e-01   -4.102090110934574e-02   +2.567702941665607e-01   -1.200469035741764e-01   +1.895393930137659e-01   -3.240480302577857e-02   +4.773051799076520e-01   +4.148333266337285e-01   +1.861231404365596e-01   +2.461888737651011e-02; -2.013821034437241e-02   -4.046515362119359e-01   +4.991205745714083e-02   +1.459886785816667e-01   -4.567362805806487e-02   -2.596755988932375e-01   +1.210065697467081e-01   +1.127916392806842e-01   +1.397432773128178e-01   +2.518991940723445e-01   -8.331599271842127e-02   -4.802025632120163e-02; +1.639392423428196e-01   +9.037002570034811e-02   -2.082166185078424e-01   -2.117218733903893e-01   +1.311385177813443e-01   +1.565546496642030e-01   -3.653928114675445e-03   -9.306991299172812e-02   -1.979019854321941e-01   +4.786765407399738e-01   +1.109041342986975e-01   -2.316804152633858e-01; +5.562701924692055e-02   -1.086107551486755e-01   +9.738831892571391e-02   -6.733925884942138e-02   -4.931187304129563e-02   -5.086539018887277e-02   +2.928061905253085e-01   +1.101254408346225e-01   -2.780966701728780e-01   +1.024375323993627e-01   +1.611161346939855e-01   +2.885081320078270e-01; +2.319019781427776e-01   -2.175692318266128e-01   -3.904589566138620e-02   -1.828352379469789e-01   +1.248738663205938e-01   -2.705729127392091e-01   -8.563737809076898e-03   +7.489412216583104e-02   -4.946255537958092e-02   -7.017764264070737e-02   -1.788494434431680e-01   -2.479942737520776e-03; -6.478213230554930e-02   -1.926479913931602e-01   -2.179100714276889e-01   -8.117131337800773e-02   -2.314363781782275e-01   +1.578244604532182e-01   -4.325362897822166e-02   -1.100956673799486e-01   +2.367209182611256e-01   +8.386169814948657e-02   +6.450562999548977e-02   -2.878657360038650e-01; +3.512877251946643e-02   +3.567300056757669e-02   +3.996635213001149e-02   +1.070492795094112e-01   +2.130208985480281e-01   +2.318734962731604e-02   -1.158611323189268e-01   -9.175727748237475e-02   +8.616703540972569e-04   +3.865805112256787e-01   +3.011203511061896e-01   +1.315193769196139e-02; +9.835345758656693e-02   -1.509399448904901e-01   +1.979053412867853e-01   -5.237381036802410e-02   +2.335440042927523e-01   +1.824335074150665e-02   +5.056657049514048e-02   +4.188307241529205e-02   +2.394775395721792e-01   -2.845791064737576e-01   -1.315955201928738e-01   -7.907787392022585e-02; -1.359243771699768e-01   -1.543085519769561e-01   -2.465336724404427e-01   -6.480413227592016e-02   -1.362357020356063e-01   +3.026320500050330e-02   +1.601020061087725e-01   -1.648606680015732e-01   -1.213159696335016e-01   -1.358356402287403e-01   +3.635888340323958e-01   +1.806416665303013e-01; -3.478474033447729e-01   -7.248051673155347e-02   +6.841323178011133e-02   +7.151947171808359e-02   +1.587437712000502e-01   -1.134849618190527e-01   -8.840576444317311e-02   -1.609464222224547e-01   -2.335024795945158e-02   +7.666931490085301e-02   +2.467828408455934e-01   +1.570056045862844e-01; +3.387881422072196e-01   -3.386187206991978e-01   +4.332057629531800e-02   -1.175293957707224e-02   +2.161113938147020e-01   +3.205122260799870e-01   +1.294356633559183e-01   -6.167651184064915e-02   -2.778808674767855e-02   -5.297107207398891e-02   -7.050204927614459e-02   +2.984553526822518e-01; +5.531445258981513e-02   +1.291155126982108e-01   -3.178476622754398e-01   -1.889184034585207e-01   -8.449797192170037e-02   +2.645940539655300e-01   -2.846380862981413e-03   -7.495606794615500e-02   +1.459415044496901e-01   -2.321402396783770e-01   +6.548622262969869e-02   -4.539173725965097e-02];
L2E_Input1_iAMPA_netcon = [-8.567263795310798e-02   -2.024575767842874e-01   -1.371912213776104e-02   +2.483484294303580e-01   -8.535783014752932e-02   -1.057440463491342e-01   +8.239818944465274e-02   -6.095344148935747e-02];
L2I_Input2_iAMPA_netcon = [+6.373107551331983e-02   +4.745122698021889e-02   -1.286872836045084e-01   -1.387006121716973e-01   +1.983899403423384e-01   +7.536135782352966e-02   -1.357534055702662e-01   +3.567393989779006e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
