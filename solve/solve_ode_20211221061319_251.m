function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.072480230425119e-01   -6.472665861384943e-01   +1.286029440938267e-01   +1.159574030226760e-01   -5.554815280192904e-01   +3.290577957779097e-01   +6.094763174750217e-01   -6.609651579978313e-01   +3.863404716538713e-01   -4.162184285956414e-01   -7.477168759790347e-02   -3.044478365831924e-01   +5.369953833197255e-02   -6.151020184348144e-02   -2.194539646462636e-01   -5.482493360906993e-01; -1.630418083000300e-01   -5.387764557465099e-02   +3.590041633391935e-01   +7.565872805033974e-01   -1.960134021801947e-01   -6.435560662764342e-01   +5.373012799392960e-01   +3.157753103457636e-01   -2.266762271131061e-01   -4.840873769727771e-01   +5.423148608488421e-01   +3.724419616217968e-01   -5.558094782045052e-01   +5.796423959833267e-01   +8.604735844462477e-01   +3.664265460691717e-01; -5.852129022413762e-01   +1.132629841217317e-02   +1.822576989006741e-01   -4.116643261922921e-01   +9.226211071643663e-03   +3.917215121662903e-01   -4.035309670222755e-01   +1.166095014666293e-01   +5.283115626066444e-01   -4.853944458074402e-01   +7.391664784481683e-02   -3.048841072965238e-01   +7.382139399990876e-01   -4.251696177239573e-01   -3.689958560379010e-01   -4.045069887925022e-01; -5.644590838463467e-01   -5.146871936334915e-01   -1.596326324519538e-01   +9.569136321364254e-02   +6.064469320678384e-01   -4.074319039725223e-01   +5.602430979304741e-01   +4.430873211191188e-01   +5.366042068503825e-01   -1.022335719497736e-01   -5.645971541650004e-01   -2.548638113681724e-01   -2.595195793930143e-01   -6.371183704634567e-02   -2.259237120263876e-01   +4.515831935619765e-01; -4.599376210654250e-01   +2.802411556144990e-01   +3.373497369982024e-01   -5.424838574120426e-01   +6.763374210081203e-01   -6.021555780142260e-01   +4.360854920677323e-01   +4.807888866952974e-01   +6.267917925792437e-01   -8.200611113966104e-01   +4.610050456808938e-01   +4.276593590643774e-01   -1.830761786933309e-01   -7.323089274649798e-01   +1.475042700579784e-01   +6.143583465973649e-01; +7.632193789396259e-01   +2.698112908941280e-01   +1.555084217391293e-01   +5.542273154107676e-01   -4.941347963475280e-01   +3.979140613766632e-01   -5.291040502236483e-01   -3.379138004130235e-01   -4.515109013952494e-01   +4.308901729765165e-01   +6.615960820710075e-01   -3.349580591889739e-01   +1.323195659900441e-01   +6.633374103512724e-01   -3.296342151082282e-01   +1.475999119961710e-01; +1.028593128012142e-01   -1.569422749377931e-01   +5.683548973963927e-01   +1.440543929300805e-01   -4.500214014993503e-01   -2.684528974849393e-01   -3.681868466834679e-01   -1.570597143565972e-01   -6.429117355997145e-04   +1.317254494442457e-01   -6.079564610151719e-01   -5.709572569909600e-02   +8.825619844001602e-01   -2.164544247525164e-01   -1.627432322521269e-01   -4.802288267063163e-01; -2.775982591354897e-01   +4.604007457109844e-01   +3.396508289195659e-01   -5.088118887647670e-01   -5.699661362394574e-01   -4.741415866189280e-01   -1.374772948717088e-02   -3.874854649615744e-01   -7.575866738839897e-01   +5.207629389527438e-01   -4.220220498785153e-01   -7.210946788867472e-01   +2.634865470075443e-01   -6.447266736686491e-01   +3.647942166595284e-01   -4.910064771740737e-01; -4.469307391724134e-01   +2.031477111578272e-01   +7.155753831572150e-01   -6.518069536285533e-01   +3.327477198043668e-01   +4.100989837070031e-01   -2.569479550248785e-01   +7.097545883067782e-01   -4.107449242474042e-01   +1.133695057040389e-02   -3.825070046343184e-01   +1.061733704965200e-02   -4.041260748250284e-01   +1.691126936779833e-01   +5.934884893871695e-01   +2.260138032529191e-01; +1.424930465198095e-01   +1.183213618254700e-01   +8.069415663015542e-01   +3.224950379893435e-01   +2.080364032749297e-01   +7.396735846003045e-01   -2.938150316178212e-01   -6.065007402314101e-01   -1.456285112618438e-01   +4.129903462906981e-01   +2.095452041835563e-01   +4.307442419551502e-03   +1.470926027879917e-01   +5.262740275722196e-01   +3.885854613244518e-01   +6.544892095019929e-01; -5.456423772297261e-01   -1.385982620039859e-01   -3.234802358800223e-01   +8.332615059828310e-01   +5.256580318968865e-02   -3.781416767590580e-01   +1.424742920700044e-01   +5.423826684540465e-01   +4.869379179900268e-01   +3.715919813433166e-01   +2.482512764488894e-01   -6.830863111811173e-01   -4.552116307330737e-01   +6.561935058548815e-01   +7.181944434469876e-01   -6.515515893303626e-01; -4.503846676388956e-01   +3.240386857351094e-01   +4.650945521032600e-01   +5.065510753162497e-01   -1.027540579696846e-01   +6.186669898905872e-01   -6.792771402713377e-01   +5.853122730265669e-01   -4.706634220705912e-02   -1.291067955235088e-01   +3.266876268605938e-01   -3.912045837343081e-01   +4.603848749221313e-01   +5.820436682001777e-01   -5.388705167628424e-01   +2.503804418035627e-01; +7.568649692438337e-01   -4.243741465156888e-01   -8.825931403250309e-01   -4.014772087141617e-01   +4.158422752758653e-01   +2.171359361378256e-01   +3.139758663640089e-01   +3.407718977772087e-01   +3.374457485662818e-01   +3.402798951782466e-01   +2.822615761200243e-01   -4.097183380063744e-01   -1.480689047295002e-01   -6.674283152279896e-01   -1.410180316015349e-01   -5.979144938534153e-01; -5.481038470551207e-01   -2.085853853415342e-01   +7.431307179761434e-01   -2.423309036509053e-02   +6.520939459347161e-01   +9.761600989678577e-01   +2.854703318067852e-01   -1.079824740155994e-02   -4.099064190716507e-01   +5.495846339720329e-01   +3.239280671110187e-01   -1.805762078378721e-01   -4.972965893542002e-02   -1.882157017906027e-01   -9.171661408169060e-01   -1.631995495430792e-01; -3.294583656935788e-01   +8.784260287558990e-01   -1.107607012602800e-01   -3.927358464205974e-01   +4.662831842710873e-01   -4.206821519127307e-01   -8.537656938451574e-01   +2.149404177369735e-01   +7.339897609889712e-01   +8.404432702871542e-02   +4.699553351258459e-01   +5.312046847894888e-01   -3.881553684725855e-01   -4.345501055112572e-01   -4.234974660461572e-01   +1.701262921525164e-01; -3.613881125158278e-01   -7.722437833926388e-01   +1.045968718275516e-01   -1.023512681376429e-01   -1.000000000000000e+00   +5.292205929473095e-01   +1.557420494768955e-01   +9.024195342852432e-01   -2.140140432996362e-01   -9.929604898406508e-02   +8.888485015580565e-02   -7.243070199723749e-01   -1.792891852594697e-01   -6.440156788925721e-01   -7.421735771408857e-01   -5.635587529539650e-01];
L1E_L1I_iGABA_netcon = [+5.660909214048386e-01   +5.384717342620053e-01   +6.088386896125567e-01   -2.318821664051056e-01   -2.126602790075543e-01   -3.285379862197536e-01   -5.981198120776470e-01   -1.722267202144823e-01   -6.737580395136747e-02   -6.120956101363091e-01   -1.537638505583428e-01   -3.691322383379582e-01   +3.031927807164490e-01   +3.141509200794272e-01   -1.199132237743246e-01   +4.123105352693766e-01; +4.411706138906216e-01   -2.778693922974166e-01   -1.404791096554344e-02   +5.472968632932760e-01   -1.936197396163604e-01   -3.385790099902863e-01   -5.153120698396157e-01   -3.828943227195208e-01   +3.047535336235243e-01   +3.738389141375477e-01   -4.309314515082808e-01   +1.223791623266095e-02   -5.605594017525619e-01   -1.436663805782983e-01   +5.534733373909932e-01   +1.124023514912704e-01; -9.001338225670655e-02   +6.189627290859809e-02   +4.985689092476255e-01   -4.944112727749811e-02   +5.608937435708488e-01   -8.477253700502437e-01   -1.283186754370906e-02   +3.498759862520961e-01   -6.283584100995624e-01   +1.252105789480188e-01   +5.801310707969667e-01   -8.024269927052275e-01   -1.432876268480378e-01   -1.086455373897525e-02   +2.462903107099888e-02   -2.924498025250422e-01; +3.501786524987176e-01   -4.632552947855979e-01   +1.009511722358570e-01   -5.057184741930602e-01   +6.757618514132677e-01   -9.731242279112624e-02   -2.207269921362782e-01   -8.130145357832813e-01   +5.532125276523991e-01   +3.658482831963067e-01   +3.137082397602046e-01   +2.453310582765040e-01   +3.448847636266763e-01   +3.690290172447743e-01   +7.106470346001462e-01   +4.726146786699087e-01; -3.720774986165818e-01   -1.535049590005810e-01   +6.052998609216841e-02   +3.779301523241931e-01   +3.017605440932046e-01   +1.195271231221750e-02   -1.240925528962868e-01   +2.938616934126848e-01   +3.200449266420930e-01   +8.151268338041509e-02   +1.354438903843589e-01   +4.999086134613546e-01   -1.180958746924855e-01   +7.492902520283179e-02   -3.514734069469575e-01   -2.725558781565683e-01; +1.063170787301686e-01   -2.287460203249501e-01   -1.762668958358768e-01   +2.508910734105405e-01   -3.098287968841539e-01   +1.474957426863560e-01   -5.821933934736061e-01   +1.584533642015734e-01   -4.021866199772074e-01   -5.462925090507913e-01   +4.245542507977877e-01   +2.825354572345539e-01   +5.961269496288670e-01   -2.436103428419247e-01   +2.170198837742672e-01   +1.242432462507753e-01; +4.116552353777260e-01   -8.578885868376759e-01   -5.030769236030110e-01   +2.447974652719240e-01   -4.257068386232155e-01   -3.419064798590746e-02   +2.981714445582181e-01   +5.316808404311021e-02   +5.607548947031965e-01   +1.369614593523535e-01   -1.302620463156914e-02   -1.400683665945115e-01   +3.960311478670742e-02   +3.337933595891491e-01   +1.292308336599882e-01   -2.730818791649054e-01; +3.536783773392410e-01   -1.904903934297773e-01   -6.585894891382930e-01   +4.374510710877805e-02   -6.609031632227451e-01   -5.377663264532728e-02   +1.907424440062720e-01   +4.884914444618528e-01   -7.441064588024680e-02   -5.791432898464490e-01   -5.085599952985341e-01   -2.530252178126193e-01   -4.959969323635504e-01   -4.270700888119258e-01   -1.241563644663926e-01   +4.979157821081692e-01; +2.718753850573485e-01   +2.974608837732686e-01   +6.535325381603203e-01   +4.569881945093175e-01   +6.015460010675179e-01   +2.007705564990230e-01   +1.642666576192464e-01   +6.071770560168982e-01   +5.738189348225657e-01   +5.449707644898364e-01   -8.149661249097179e-01   +5.997080470344551e-01   +3.263925263635188e-01   -2.340443857500309e-01   +6.035248918036767e-01   -3.128917162068438e-01; -1.891973818871538e-01   -3.579128099785777e-01   -3.735856405629813e-01   -4.474342921659901e-01   +3.968809899781173e-02   -1.556970503607671e-01   +1.046840717468245e-01   +3.425471226410119e-01   -8.267317951547197e-02   -8.051170059215965e-01   +3.446664315656717e-01   +1.511337403328687e-01   -3.163084031646163e-01   +3.364325175429518e-01   +5.106272999358400e-01   +1.707842340148866e-01; +1.590703460561669e-01   +5.246453508280178e-01   -9.150742616463299e-02   -2.064607911667697e-01   -2.952802027582039e-02   -3.301170481877356e-01   +1.509013423915723e-01   -8.481948138855734e-01   +4.401932330308366e-01   -4.699201806555861e-01   +5.535969975923242e-01   +3.468664804064034e-01   -1.394810085569576e-01   +5.781626100545497e-01   +6.263030591679397e-01   -7.512769461649493e-02; -6.597519685521205e-01   +6.021063019298881e-01   -2.811329256773492e-01   -5.857881299715291e-02   +4.431835503109300e-01   +5.210431308743423e-01   -1.054736497628851e-01   -1.351142116763140e-01   +9.587367151456894e-02   +4.650294014827805e-01   -1.453948922999353e-01   -3.206856589033608e-01   -5.723427586930099e-02   -9.654914848383286e-02   -3.901679949917940e-01   -7.821290911831085e-01; -1.872675343973685e-01   -2.183526273992347e-01   +2.149386418908378e-01   -4.008544050197908e-03   -4.426815497834596e-01   -7.456691658307699e-01   +5.403087172756967e-01   -5.201390307749953e-02   +3.510173497917708e-01   +7.000720625849163e-01   -4.523159615784517e-01   -1.000000000000000e+00   +2.366059109478004e-01   -3.093217708989208e-01   -3.929613014087519e-01   -2.735416431058269e-01; +2.129732966959471e-02   -4.707276144013736e-01   -2.604750752999252e-02   -4.704433884527977e-01   -1.744736987357484e-01   -3.014891029893595e-01   +7.978329416251856e-01   -2.547839823700463e-01   -1.913881045249674e-01   +7.228183882024484e-03   -3.097061710381726e-01   -2.841116900439137e-01   -4.827549910940338e-02   +3.979815640081142e-01   +2.052380978742423e-01   +7.813343166730981e-01; +1.436895589235745e-01   -1.619968986835219e-01   -3.483590621286533e-01   +5.643143609525221e-01   +3.394585133757556e-01   +9.643277868660008e-02   +4.683776929129478e-01   -2.688652492023307e-01   +6.159370456828009e-01   -5.274620250522509e-01   -4.720696433049445e-01   -3.383593194059881e-02   +6.376927765331404e-01   -9.873565420098274e-02   -2.079644972378935e-01   +4.033582409207825e-01; +3.113058445853873e-02   +2.137917189141098e-01   +7.014104083195795e-01   +2.068877893532592e-01   -5.704645878132562e-01   +1.716048382197013e-01   -2.190434134618625e-01   -8.856296004075845e-01   -2.298014605170585e-01   +3.716203465118903e-01   -4.086085998296092e-01   +6.181436613309891e-01   +3.107190832863969e-01   +2.192473024080652e-01   +4.939844480603421e-02   -6.553690910556652e-01];
L2I_L1I_iGABA_netcon = [-2.961685995816765e-01   +1.365452088278035e-01   +3.460294669867187e-01   +2.896894212703970e-01   -3.058445657143149e-01   -3.323397663885871e-01   -4.669918833809962e-01   +2.873597357989459e-01; -6.907613076381404e-01   -5.770962879935591e-01   -3.065932262080380e-01   -6.613533048232959e-01   +8.699709805914840e-01   +3.584048296780259e-01   -3.636495695257224e-01   +2.055070852645293e-01; -5.043328616706712e-01   +5.699102467330530e-01   -9.397681155872292e-02   -4.668285403166347e-01   +6.066580350887204e-01   -7.462552517481637e-02   +6.066411395787351e-01   +2.240112922342006e-01; +4.306092002242359e-01   +2.393636410137893e-01   -3.299469952333562e-01   -2.946484277308716e-01   +5.691283641406103e-01   +4.899793434045498e-01   +4.427086948975744e-01   -6.202245024157703e-01; +4.296716226423523e-01   -2.532022624428319e-01   +1.000000000000000e+00   +2.261167288274415e-01   -4.570450739676596e-01   +5.027954348075574e-01   +8.708854965396760e-02   -7.392867671361664e-01; -1.513867135528935e-01   +2.119354435815743e-01   -3.586331710627054e-01   -7.802079875911461e-03   +5.359909582341822e-01   -9.893721735284644e-02   -1.745693493657717e-01   -6.294943770917087e-01; -3.859551831591096e-01   -2.528963830328784e-01   +3.577507542670273e-02   -2.262924373338515e-01   -3.901167826127285e-01   -2.012823469325291e-01   -4.662250068061293e-01   +5.407110351335264e-01; -2.889292873401193e-01   -5.593189389199233e-01   -7.430802985158191e-01   +4.417895535797505e-01   -4.828164177514470e-01   -2.418820040672032e-01   +4.155832518994363e-01   -1.790039174218966e-01; +4.319778935809859e-02   -4.310480449646185e-01   +5.620238250042832e-01   +2.272751691739592e-01   -9.126790084386004e-02   -7.479593483963563e-02   -3.175145846624897e-01   -2.986987181323922e-01; +1.213545126968977e-01   -5.401109933303249e-01   -1.980082596371522e-01   +3.222681961613448e-01   +5.042120000496113e-01   +2.363242283127410e-02   +3.357079332376509e-01   +1.679854793700006e-01; +7.892063650576112e-02   +2.558584188261511e-01   +4.560163080418446e-01   +7.046779455749853e-01   -6.154687936478365e-01   +7.936827123673449e-01   -6.325453024436433e-01   -3.577917550421045e-01; -4.909311925979961e-01   -1.500510811427938e-01   +1.559313296373465e-01   -4.422991706710940e-01   +3.250596041482081e-01   +1.799604179599980e-01   -6.387679656909269e-01   +2.985753262542221e-01; -2.025211480766144e-01   -3.875585198627690e-01   -3.609854333683744e-01   -6.130793445594700e-01   -3.332347388656148e-01   -2.359211774922356e-01   -3.342819634731830e-01   -1.034464089423107e-01; -6.513735619110240e-01   +6.007802574235790e-01   -6.803555570066555e-01   +4.296653641048044e-02   +6.891783464093677e-02   -2.853983212914023e-01   +2.634962165740142e-01   +2.564703294600631e-01; +4.095199246952654e-02   +1.358868120120687e-01   -1.666487896382531e-01   +2.113299532764353e-01   +4.411264840955771e-01   +3.313747243229429e-01   +2.658624945929028e-01   +4.330436898152394e-01; +3.100064388336675e-01   +2.594176085194932e-02   +1.367644043866520e-01   +6.921888573206702e-03   +5.153125676579154e-01   -6.534679245088029e-01   +5.110648261195441e-01   +6.332122697005417e-01];
L1I_L2I_iGABA_netcon = [-9.406078421424918e-02   -1.951401854711897e-01   -6.216312869078561e-01   -1.000000000000000e+00   -6.870291116818623e-01   +3.769989136167111e-01   +3.897841904138246e-01   -4.241285378891482e-01   -7.441291262890513e-01   +7.234379537938311e-01   -1.170753158397720e-02   +1.318861564359803e-01   +3.393236602403094e-01   +3.103568395684070e-01   -3.606486109220338e-03   -3.379527969876196e-01; +7.085455744184462e-01   -4.296879723352159e-01   -2.828355081212909e-01   +1.545367990800006e-01   +5.991927933441512e-01   -4.474205123464864e-01   +2.986782838619991e-01   +4.684669396460159e-02   +1.373468708553205e-01   -2.518727147035126e-01   -7.292311529358919e-01   -3.462198536978152e-01   -6.890198613997748e-01   -1.808787569476877e-01   -8.217502455919166e-01   +1.946331824115074e-02; -2.222078599604584e-01   +5.910622169200190e-01   +2.867934388638448e-01   -3.346930902321216e-01   -6.319693590971703e-01   +1.110745234200900e-01   -3.587517491096906e-01   -9.318094831449354e-01   +1.556868489968609e-01   +8.208085720002505e-01   -5.364597538719829e-01   -4.695253275222094e-01   +2.152824894367504e-01   +1.174159428098205e-01   +7.062678872675059e-01   -2.010599680259398e-01; +4.518658987989300e-01   +1.106391575124304e-01   -5.027427525751256e-01   +3.139284977495149e-01   -7.167606815074860e-01   -2.961975172173821e-01   +2.914870302722838e-01   +7.837205773268094e-01   +4.642717173965276e-01   +5.097539810193163e-01   -2.121381055745330e-01   +8.229661294589761e-01   -3.053534410306363e-02   +7.257759885931567e-01   +2.936746169028274e-01   -1.023586321877484e-01; +3.803126169367553e-01   -2.972832157774952e-01   -1.124493300876978e-01   +4.917872604403378e-01   -7.125997043352162e-03   +5.334390584655548e-01   -4.859947740717511e-01   +7.726666212155464e-01   +6.875729365155177e-01   +2.498087763179088e-01   +2.201711881477922e-01   -8.211394350449923e-02   -6.139857753531744e-01   -5.660226603256672e-01   +2.563827095370826e-01   +9.564986859062171e-01; -3.543131746063358e-01   -8.897812714063479e-01   -1.335245505438145e-01   +2.017483811248682e-02   -2.321627534090491e-01   +8.933584641614495e-01   +4.507014977101587e-01   -3.351467394241476e-01   -8.745291343967147e-02   -5.459756651901200e-01   +2.055325298741687e-02   +3.603093791290878e-01   -2.773442239902987e-01   -7.830510806560899e-02   +1.401592961540681e-01   +6.175408000258338e-01; -1.403319304751146e-01   -1.799647146301416e-01   -8.233604504605326e-02   -4.694338171901166e-01   -3.528460846018262e-02   +3.516670682667233e-01   +3.373886124898349e-01   -6.469184968327029e-01   -2.158531335370661e-01   -8.960020535933265e-01   -9.205313065796003e-01   +5.087453560201048e-01   +9.432075234591006e-01   +1.247792666691176e-01   -4.483829416364720e-01   +2.973185930617145e-01; +3.397928954617349e-01   -7.666036669075187e-01   -2.711733217174238e-01   -4.223312952303988e-01   -5.249228549031630e-01   -6.409510872825985e-01   +2.376570288868874e-01   -4.238338975395316e-02   -3.929400206864996e-01   -4.177941530359051e-01   -6.080421422089211e-02   -3.552892906987802e-01   -1.450627853445110e-01   +7.969862977631438e-01   +2.923511237948681e-02   -6.179843558261161e-01];
L2E_L1E_iAMPA_netcon = [-2.889429242594094e-01   +7.557461452031589e-02   -6.836262568334616e-01   -4.942279775765195e-01   +2.981341730532311e-01   +3.615784021539298e-01   +2.137167371063695e-01   +3.404052374326543e-01; +4.813180497982638e-01   +3.945275261175498e-02   -2.872157202129798e-01   -1.215654385838252e-01   -2.913797187881405e-01   +6.136370302015551e-01   +5.432504375439254e-01   +3.650541621461890e-01; +3.426482291626198e-01   -3.029009136293114e-01   -2.282679054322131e-01   +7.491369081273788e-01   +6.106135257314462e-01   -5.872550393352050e-01   +6.604040379978449e-02   -7.309482447811494e-01; +4.587159368341671e-01   -1.328347281132870e-01   -9.610359195658022e-02   +6.328850468700071e-03   +1.401820956530182e-01   -2.480002141091278e-01   -5.214433752812798e-01   -3.594078826044759e-01; +4.960695636855186e-01   +7.008521652778378e-02   +3.686667401484233e-01   -4.250846272353044e-01   +1.570755911563903e-01   +2.409562799080039e-01   -2.304147145323259e-01   -7.943206465506879e-01; +8.633452077829649e-01   -5.520455971961897e-01   -3.673087343581117e-01   -1.382238169118792e-01   -6.132841407972009e-01   -5.289961004209407e-01   +4.060177222113141e-03   +1.133075719618431e-01; +8.709347841356332e-01   +2.984884480632246e-01   +1.680351025534101e-01   -5.254981492959517e-01   +7.374209286742990e-01   +1.188222580944102e-01   +1.950405019346860e-02   -3.096033593883589e-03; -3.553523409557470e-01   -5.738483956995836e-01   -7.344504950619402e-01   -4.395030271515653e-01   +2.219989943241449e-01   +4.352522545820729e-01   -6.118100888651986e-01   -1.561489939317295e-01; -8.866779082028722e-01   -1.211457212506681e-01   +3.383212745118924e-01   -7.186062263308135e-02   +3.352855610006774e-01   -6.370420000097780e-01   -6.414990585188801e-02   -6.046452519361918e-01; +7.034718961442095e-01   +2.686975769445558e-01   -1.322663942884109e-01   -2.895221470901780e-01   -2.967496178781634e-01   -7.833989164365275e-01   +2.750681124183161e-01   +4.806541812144138e-01; +3.944977401014344e-01   -4.532928877955722e-01   +4.063891714313543e-01   +1.320236521513184e-01   +9.314339390523715e-02   +5.005473166672523e-01   -4.632163646922023e-01   -2.236020323485446e-01; -6.144730246341998e-01   +5.702446729097336e-01   +7.998042888365817e-01   -6.375886727988577e-01   -1.550968382280840e-01   -1.068130341058793e-01   +3.683560391745246e-01   +5.585730296128387e-01; +6.475946884172822e-01   +2.295334315605371e-01   -1.175885943764626e-01   +4.233149047725427e-01   +2.480244398217672e-01   -4.159096551911616e-01   -1.000000000000000e+00   -7.481504605840761e-01; -5.395683696119752e-01   +9.298909569808217e-02   +5.580846926309763e-01   +7.120553102124704e-01   -6.373970904421626e-02   +5.609326241801376e-01   -3.430905163116455e-01   +2.206000316610324e-01; +2.864617476701673e-01   +3.386699456715828e-01   +1.240605849930770e-01   +2.716446443780906e-01   +5.394794222660403e-01   -7.303030595071094e-01   -5.368342590239482e-01   -4.066160543436249e-01; +4.543172991478456e-02   +3.044523825705899e-01   +7.116004446091415e-02   -4.769658453048596e-02   +3.243084434217192e-02   -2.019784414422167e-01   +2.571234804417924e-01   -1.738271036326348e-01];
L1E_L2E_iAMPA_netcon = [+5.123612561072731e-01   +8.340287739137732e-01   +1.805035423979116e-01   -3.141082102806751e-01   +8.763163275562635e-02   +8.809130957908586e-02   +1.860066780186779e-01   +5.720322369857209e-02   +3.616207513386417e-01   +2.320738697061389e-01   +1.565116062721391e-01   +3.392320668262062e-01   +1.063348514131200e-01   +5.603657491038441e-01   +3.367127090682641e-01   -3.392570256159901e-01; +1.125686311296189e-01   -7.013278356702407e-01   -7.210124557562015e-01   +4.301926925864093e-01   +2.406483046703166e-01   -8.884413414390353e-02   +5.633572919952161e-01   +1.034973308790014e-01   +4.759895175751404e-01   -3.167980666833717e-02   -5.548574908235187e-01   +4.191503613376892e-01   -1.275039989727254e-01   +4.205014559268979e-01   +3.583126399924756e-01   -6.334327048507895e-01; -4.419484881709400e-01   -2.597749538817263e-01   -5.602025136470025e-01   +6.657663045840507e-01   -1.790153042093281e-01   +1.477264524871824e-01   +5.085822742047441e-01   -4.671080482283362e-01   +3.418851899968474e-01   -3.110426616351492e-01   -8.887991659863461e-01   -1.000000000000000e+00   -8.016485265720089e-01   +4.221941556508114e-01   -1.578561470707088e-01   -6.496839115845607e-01; +9.100565176793550e-01   -4.628454618149429e-01   -3.077585145533031e-01   +2.200314597477485e-01   -8.396654759947948e-01   -7.374762446946612e-01   +1.441949805992299e-01   +5.800919529865196e-01   +6.851104871082772e-02   +4.820283472567730e-01   -4.448048652828784e-02   +3.750215692559163e-01   +6.590494407594759e-02   -1.828787092315420e-01   -1.187951708920354e-01   -4.246760373893455e-01; -4.310595231970604e-02   +1.080811399478193e-01   +6.129011210675274e-02   -2.390677135186302e-01   +3.625350844434641e-01   -6.521681377701842e-01   -9.483610155662130e-01   -4.416229469644144e-01   -4.027100974329387e-01   +9.131851462022689e-01   -5.903126828706564e-01   -4.496590588770774e-01   -2.421746870665931e-01   -2.735476099781711e-01   -4.544735739962050e-01   -7.221591013493842e-01; +4.960341996774958e-01   +7.882452252648613e-01   -2.155694673117893e-01   +6.676446723601618e-01   +7.973946793452332e-01   -2.498927943021652e-01   -8.917749945223101e-01   +3.492608469649016e-01   -4.467714455753456e-01   +3.117385655558852e-01   +6.491437680707858e-01   -2.041700612813754e-01   -2.968506685441523e-02   -7.028745017528930e-01   -2.796134694750764e-01   +3.136826900555282e-01; +5.747751997586372e-01   +8.723876381990038e-02   +1.784937765707187e-01   +1.905526701024184e-01   -6.440808714465944e-01   -7.911176833957262e-03   +4.191661998738428e-02   -3.575354787808358e-01   -6.375321363713805e-02   -6.771520594669318e-01   -1.896452666063443e-01   +6.917948142728018e-01   -1.502264354096746e-01   +7.684677454095027e-01   -5.520277275992304e-01   -5.448238208971552e-02; +2.926570255036895e-01   +5.510018382140820e-01   +4.429356646126663e-01   -2.839847627225692e-01   -2.301219809076914e-02   -3.017042770032153e-01   -5.085587348643871e-01   -6.808818072340806e-01   -6.234352082649661e-01   +3.294523272210344e-01   -6.381108257887366e-01   -5.505395010672149e-01   +1.693303883418574e-01   +5.633712481159021e-01   -4.389058929505363e-01   -1.272977038409815e-01];
L2I_L2E_iAMPA_netcon = [-3.087981661589510e-01   -5.332735748533729e-01   -4.122018003368924e-01   +6.786771873790530e-01   +6.028751784086588e-01   -4.281498478711807e-02   +7.467290991943772e-02   +5.648464248700616e-01; +4.348388555759464e-01   -3.798499895983976e-01   +4.741400222900239e-01   +1.598272072283518e-01   +3.291577056100531e-01   +5.044536747613602e-01   -4.555060361213824e-01   -1.683551612304131e-01; -6.090313735004463e-01   -1.933685856911768e-01   +2.376071457335372e-01   -8.356445317642187e-01   +3.535742309637329e-01   +7.365165860946701e-02   +4.613387037650175e-01   +7.568529582808746e-01; +1.373380316993796e-01   -8.571345512531162e-02   -3.243128918163884e-01   -6.560450411296453e-01   +1.087569356589929e-01   +4.464845782451784e-01   -5.699178583544868e-01   -1.000000000000000e+00; +4.515900831382484e-01   -7.952987470291882e-02   +6.125621904137196e-01   -6.527931766236240e-01   -4.090601979061411e-01   +2.762154683314100e-01   +7.713195625901891e-01   +4.344137425795598e-01; +4.977510276059904e-01   +2.776511967713206e-01   -1.934573974944533e-01   -8.813370738373033e-01   +5.209193819042144e-01   +4.856139666622378e-01   +2.296593257933950e-01   +5.764528997231633e-01; +1.536265661502330e-01   -8.300011379903260e-01   -1.057011279219391e-01   +1.875904177765711e-01   +5.702702050426900e-01   -1.788385479530443e-01   -5.165058874423942e-02   -4.167147177017637e-01; +2.934603463281573e-01   +4.378505358645335e-01   +4.641297436318730e-01   +7.156564664904314e-02   +6.516454477962439e-01   +2.188106919585397e-01   -9.463736879974743e-02   +9.234405548172750e-01];
L2E_L2I_iGABA_netcon = [+3.018702938946451e-01   -2.328545728044718e-01   +1.061735333929693e-01   -4.278562854283158e-01   -1.353436522902313e-01   +3.189787856049737e-01   -2.292955196003437e-01   -2.229276181462864e-01; +2.080680055437559e-01   +2.809077405264718e-02   +2.288678545689189e-01   +2.072548949766279e-02   -5.390129538922044e-01   -4.503338309438710e-01   +8.894970972023759e-02   -3.854777521243240e-01; -6.450501926546268e-01   -4.132946879169076e-02   +8.884037437333994e-02   -5.229901929361005e-01   -2.158499716626888e-01   -1.000000000000000e+00   -6.454962344572297e-02   -3.962760178653718e-01; -1.086848759634416e-02   -2.167228718448219e-01   +1.205096319958438e-01   -2.375010149967599e-01   -4.710665452800406e-01   -6.903215152920089e-02   -4.899765373623582e-01   +1.802693037968614e-01; -1.938586638885476e-01   -9.567796593959055e-02   +4.495881175339553e-01   -4.511539656925802e-03   -1.917066054127062e-01   -6.356932266657218e-01   -2.217170676909607e-01   +5.584297201683773e-01; -2.362739346032959e-01   +5.871334775454928e-01   -2.789885819680220e-01   +1.405706862076284e-01   +3.966399097118778e-01   -2.215574634134758e-01   -5.890924872705603e-01   -2.039376179452762e-01; -7.176713549995943e-01   -1.190765471118578e-01   -2.587076848613614e-01   -1.791709782669151e-01   +1.127411139740613e-01   +1.016565149420117e-02   -1.059994013593376e-01   -6.587700422133934e-01; +6.866461643450720e-01   -2.127844222254316e-02   -2.020501054518997e-01   -5.139835670126316e-01   +3.831371882990463e-02   -5.931069128335076e-01   +8.430281211163208e-02   +4.162663061019591e-01];
L3E_L2E_iAMPA_netcon = [+1.659992160516539e-01   -8.096424986616349e-02   +8.339291553710697e-02   +5.582445272960453e-01   -2.538347642417801e-01   -4.832468906002586e-01   +6.377928762244214e-02   -5.324993105702051e-01   -6.873194776903805e-03   -3.252142149453278e-01   -1.841844260414108e-01   -3.608498715911204e-01; +4.508580557000383e-01   +4.491491168849118e-02   -7.635613039088904e-01   -4.507996683559131e-01   +8.404058124007446e-01   -2.039485823478333e-01   -1.552260583610748e-01   -4.520115673765651e-01   +4.247918565559885e-01   +8.075114286791976e-01   +8.055719846137116e-02   +6.319321656723599e-02; +6.643681731159978e-01   -4.500895024392943e-02   +3.624490567766271e-01   -4.252489912780724e-01   -9.402945097511082e-01   -7.887468805754166e-02   +5.020039897721243e-01   -6.150690858387110e-01   -8.903295271064126e-01   -1.080882215749317e-01   -2.630462826360667e-02   -2.490611103480380e-01; -2.361935736622749e-01   -5.940804022647988e-02   -9.268321123915103e-01   +3.386888688508566e-01   -7.467110233925153e-03   +4.158081159530844e-01   -2.422341659669257e-02   -1.323165024029711e-01   +7.473139496541827e-01   -1.961297537635930e-01   +7.958357619505850e-01   +3.795814808837747e-01; -3.895763072493870e-01   -3.071049408511933e-01   -2.298943533120557e-01   -9.568234772831860e-01   +4.352467183714256e-01   -1.720066047422048e-01   -3.386912150308974e-01   +1.000000000000000e+00   +7.604159275933414e-01   -4.659234058683158e-01   -7.995832902197239e-01   -4.782323265738784e-01; -6.553865452748284e-01   +6.045382321483778e-02   -3.298853455846548e-01   -5.266999165442673e-01   -3.832592956537750e-01   +2.573366371408521e-01   -1.601597864841515e-01   -5.906842357921554e-02   -9.699992061089581e-02   +5.309525538975919e-01   -3.031940069934350e-01   +1.950117977086141e-01; -1.643502936194161e-01   -2.232536542393458e-01   +6.195173406801696e-01   +5.077834657185255e-02   -8.817845638519870e-01   -2.889826776774820e-01   +4.450605753845138e-01   -1.469731526537365e-01   +3.698279133714666e-01   +5.300751630623292e-01   +3.108431200102281e-01   +3.092576292249282e-01; +9.306815609723570e-02   +5.230173215335174e-01   +7.390660873106765e-01   -2.229874399753459e-01   +3.352048930104259e-01   +6.489105555778641e-01   +5.466824729829554e-01   +6.112512498580790e-02   +8.262422440846440e-01   +1.008168942408222e-01   -1.512985059927239e-01   +9.560332701801177e-01];
L3I_L2I_iGABA_netcon = [-3.645172893677946e-01   +1.000000000000000e+00   -5.345107551758929e-01   -4.503954839886300e-02   +2.196817382103878e-01   +2.075373764822921e-02   +2.099752729657430e-01   -5.882796751061393e-02   +6.022286375407292e-02   -3.771187279153110e-01   +2.476983241102405e-01   +4.552433702788577e-01; -2.959543131922543e-01   +1.399433329556606e-01   +1.968252630866027e-01   +3.069598030341739e-01   +7.299275635528508e-01   -2.530031704144795e-01   +2.734543723195227e-01   -2.658541076786806e-01   -3.550514427710226e-01   +4.350805909840915e-01   -6.247823808996840e-01   -5.623153609803178e-01; -2.221288790652894e-01   +6.558432056718855e-01   -6.824800882579677e-01   -1.208724811001951e-01   +8.938789774780904e-02   +2.749819143040908e-01   -2.851008868249056e-01   +4.310554517007069e-01   -2.187579046171272e-02   -3.422195029097009e-01   +6.683230270999097e-01   +4.520364052158652e-01; +8.352192285997950e-01   +1.945467471970586e-01   -4.183037450115796e-01   +5.623701267370753e-01   -1.966698660956689e-01   +4.169741165209697e-01   -2.161392044459149e-03   +5.714332279784179e-01   +4.161635983494995e-01   -4.186727933643644e-02   -7.349313780394433e-02   +6.027754399304190e-01; -3.238042903167875e-01   +1.153787966928703e-01   -3.267029305605890e-02   -1.981499811873940e-01   +1.777458400212860e-01   -2.019576539338334e-01   +2.318598221676886e-01   +5.323978158118619e-01   +1.786019234755788e-02   -6.413772921768031e-01   -1.560774936905147e-01   -1.253459615124457e-01; -1.260904554023576e-01   -2.527724264762148e-01   -5.136162033725098e-01   +4.706813901381204e-01   +1.604565164119351e-01   +5.162689827249394e-01   -2.480100396517514e-02   +3.365709238755923e-01   -4.363588959651515e-01   -2.425468284374616e-01   +4.877059956106315e-01   +3.268414951784454e-01; +3.282195288862977e-02   +2.399718639796740e-01   -4.892796525348318e-01   -2.661688936891884e-02   -4.426712813173880e-01   -1.375201079257787e-01   -1.194580830320246e-01   +2.435077214426570e-01   +2.627529534064242e-01   +1.342149827025660e-01   +5.887594217099522e-01   -2.684768453167274e-01; -1.270914774822438e-01   -9.932723701958059e-02   -5.566247189165952e-02   -8.162758751966495e-03   +1.315710180619629e-01   -3.393766701387135e-02   +8.986753472049333e-02   -4.526656165401836e-01   +2.492129915734342e-01   -2.866148057587959e-02   +4.445299370510006e-01   -2.939772886263051e-01];
L2E_L3E_iAMPA_netcon = [+1.396567549188729e-01   +4.990924303769023e-01   +2.110704097064316e-01   +5.540372827784953e-01   -3.474916319741568e-01   +3.069608616728998e-01   +2.630371804006625e-01   -4.326380736108312e-01; +3.723898521333042e-02   +7.135608512823360e-01   -1.356772517284743e-01   +2.359473382864451e-01   +7.111020323632568e-02   -4.236254629609728e-01   -6.830657743929820e-01   +6.538742624260331e-01; -4.675061993280454e-01   -7.105491767517021e-01   +3.013310764463217e-01   -6.434748746293719e-01   +8.920454581169960e-01   +4.849163580544291e-01   +1.692255081570720e-01   +1.919677717114450e-01; +5.605195372479951e-01   -3.671107268538157e-02   +2.645409959532011e-02   +1.005781030497033e-01   -2.403712925069870e-01   +1.495711212707273e-01   -7.830040556861338e-01   +2.265833080280780e-01; +6.811833163720835e-01   +6.514867534013452e-01   -5.355821801579603e-01   +9.429302879451909e-02   -3.185633526821653e-01   -9.671734509119745e-01   +4.637960086708384e-01   +2.288978371914913e-01; +8.816282273010331e-01   +4.509639094967307e-01   -2.337848774825542e-01   -1.869794132456077e-02   +5.808641208483917e-02   +6.804819347778999e-01   -4.768311924122563e-02   -2.329487069732393e-01; +9.049784868030857e-01   -2.573667725433715e-01   +7.094656759022232e-02   +8.114691408822113e-02   +6.520949003692565e-01   +1.707271018398443e-01   +6.523309038593393e-01   -2.094129795929781e-01; -6.680375478735329e-02   -1.704896953584420e-01   -2.148265277689444e-02   -1.333478448143033e-01   +3.178265802100717e-01   +3.668454142517851e-01   -5.183088025350417e-01   -1.136177770464780e-01; -1.678273612181913e-01   -8.396838959016485e-02   +4.587503408313069e-01   +6.944909835050429e-02   -4.504238667989113e-01   -1.430068043734328e-01   -1.986400367114826e-01   -5.401010362969073e-01; +1.084800607495350e-01   +2.795903635364708e-01   +4.642303361565441e-02   +3.902733928082613e-01   +1.000000000000000e+00   +9.886736852823009e-03   -6.406658557039905e-01   -3.538253865854378e-01; +4.887939395979825e-01   -3.969568088564234e-01   +7.917751321693998e-01   -3.109297510496640e-01   -4.074646149826260e-01   -4.492837552824789e-02   -3.450446800137006e-01   -5.389079224860323e-01; -2.303290872026730e-01   +1.139902195694188e-01   +4.245143538105532e-01   +2.900140563001942e-01   +4.129868257723794e-01   +3.002627163218421e-03   -4.131331775865162e-01   -9.485437298861397e-03];
L2I_L3I_iGABA_netcon = [+3.360952973620425e-01   +3.611453998128644e-01   -1.091065075192033e-02   +2.961965392883487e-02   -2.106055436435215e-01   -5.104983058394053e-01   -3.106454074868287e-01   +6.470354469718689e-01; -4.921053902700827e-02   -4.673026479888839e-01   +1.398187628203849e-01   +2.038761384823886e-01   -8.505436963615117e-01   -1.391272134278663e-03   -2.541715304485703e-01   +4.269546775639908e-01; +9.258912135804884e-02   +4.821829993964167e-01   +1.047840984963662e-01   -3.669443112055624e-01   +2.571166401303318e-01   +5.417737618831068e-01   -3.547291549922843e-01   +2.554452402429483e-01; +5.138481190327024e-01   -1.238689140847356e-02   -5.432562652528551e-01   +2.143862940961954e-02   -3.199757288356966e-01   -5.488014030692089e-01   +2.453285195246758e-03   +6.810483639405955e-01; -7.844115441601375e-01   +2.538471655257142e-02   +6.315092624962092e-01   +1.611646113493676e-01   -3.389885986574150e-01   +4.280326330694890e-01   +1.745911668239918e-01   +3.806378293426030e-01; -9.289990372560994e-01   -5.353651346543049e-01   +1.000000000000000e+00   +8.771539215934911e-03   +4.823595024749178e-01   +1.767305870098476e-01   +5.376327683526397e-01   +4.203603556645954e-01; +2.493697390178395e-01   +1.404230432206377e-01   +4.208768834394280e-02   +2.059587859363617e-01   +3.205128412029848e-01   +1.028141449555764e-01   -6.200995155491908e-01   -7.763705525003752e-01; +2.214443331573285e-01   -2.376156673107478e-01   -1.633765495906650e-01   -5.543230146113422e-02   +7.108144818861416e-02   +7.884856615637439e-01   +1.412920847898487e-01   -6.666248001294180e-01; +1.502008855400121e-01   +2.605594316267995e-01   -8.798269097089788e-02   -6.024571760991418e-01   +8.376796506357068e-02   +1.234536835493002e-01   +3.522894631711374e-02   +4.753630126008451e-01; -5.992235483274974e-01   -3.675074698316931e-01   +3.861018331484532e-02   +1.691458049424819e-01   +2.134700149314173e-01   +6.390952343974339e-01   -9.507243960563422e-01   -9.390117200631043e-01; -3.576038985911922e-02   -5.082971686968409e-01   -2.489709744514794e-01   +2.498771512373973e-01   -7.503489617632708e-02   -1.487884652703521e-01   +1.776267269567535e-01   -7.359947076557506e-02; -5.182223230948003e-01   +2.262783851632691e-01   +1.086645309388554e-01   -4.450052664356574e-01   +4.763633354225322e-01   -3.242531106744817e-02   +4.648050559706909e-01   -7.315987829172728e-01];
L3I_L3E_iAMPA_netcon = [+2.744854251436914e-01   -4.213562354709455e-01   -4.356718125416952e-02   +4.118245850146844e-02   +1.665337024240600e-01   +3.691609960973430e-03   +9.396832356954904e-02   -4.350496224711602e-02   +2.244793009199189e-01   -1.229519559351685e-01   +3.028073077646032e-01   -3.966809031913343e-01; +4.570264074237893e-01   -1.133235351078630e-01   +6.301121981816450e-02   +3.036172716783319e-01   -3.428759111300931e-01   +6.521068454635824e-01   -3.675420794764312e-01   +1.323812673563445e-01   +5.022274947717784e-01   -2.278859332297521e-01   +4.996504099106144e-01   +4.991672505188947e-01; -9.935263674528678e-02   +5.543118342982819e-01   +3.231942886207531e-01   -4.335737894631337e-01   -5.878701915467710e-01   -6.995625750141674e-01   -3.387661207360639e-01   +6.225643770498978e-02   +2.568525117618000e-01   +3.308168495781179e-01   -3.527754643217171e-01   +1.027154429033841e-01; +3.586040466773614e-01   +2.332472732794359e-02   +2.637686605266032e-01   +4.841221761571514e-01   +5.495836527268892e-01   -2.540089700620816e-03   -1.810061586447360e-01   -2.013937015389296e-01   +3.856072621345032e-01   +4.185493441622883e-01   +1.237733318973929e-01   -4.389479195132177e-01; -4.332645398702052e-01   +6.716676403939285e-01   -1.235057045403013e-01   -8.699289478693160e-01   -1.723660607344215e-01   -4.565478121223505e-01   -3.019517094887370e-01   -2.893169358599500e-02   +7.722785116669997e-01   -1.189482361604125e-01   -1.105274881167536e-01   +4.786915298117064e-01; -2.026663826455579e-01   -3.346006184510899e-01   -2.093915033197218e-01   -2.209634071280116e-02   +1.000000000000000e+00   -1.813054504704596e-01   -7.459632952909964e-01   +3.711747400096461e-01   -1.198733100349208e-01   -5.886724194043485e-02   +5.021376818493434e-01   -4.211919595666351e-01; +2.902625578393239e-01   -6.564505674465049e-01   -4.585281013549208e-01   -5.668037819446642e-02   -1.761109478988010e-01   +2.831811173072984e-01   +7.570491015855803e-01   +4.409658699459868e-01   +2.725700461573256e-01   -7.422402992299423e-01   -3.680547426401181e-01   -2.584910636566196e-01; +1.078005231294242e-01   -1.668948867728150e-01   +5.466700597565528e-01   +3.587923412589924e-01   +1.575213436626249e-01   -1.883437103251230e-01   -4.010303568303604e-01   -4.900177146052216e-01   -8.192043199056076e-01   +3.218313703188798e-01   +2.829946076105912e-01   +3.983112065411787e-01; -3.739677123051082e-04   +3.281420679619503e-01   +7.557537393646278e-02   +2.121048945615831e-01   -2.020199413506269e-01   -2.893284666029963e-02   -5.720238549551259e-01   +4.352756186905927e-01   +6.141467078573369e-01   +1.496734542380372e-01   +4.582822941095890e-01   -4.152412703404547e-01; -5.118424915354913e-01   +2.078314714261067e-01   -2.934253858057280e-01   -8.940368149120405e-02   -6.124282317495015e-01   +1.053076069237048e-01   +3.362495913403443e-01   +2.861616892992092e-01   +2.159287046971294e-01   +6.948444367953518e-03   +8.762555076749949e-01   +1.396715599401562e-01; +4.106913566681609e-02   -4.153590982613892e-01   +4.760214189695240e-01   +3.627241671785529e-01   -4.234371558988564e-01   +2.988243911932788e-01   +6.223318465090788e-01   -3.787899837767952e-01   -5.824026348299776e-01   -6.643236364931557e-01   +6.246225542422047e-01   -3.075705493127754e-01; -5.425804655429417e-01   +4.007338027091690e-01   +5.855722018473962e-01   -1.458821881847473e-02   -3.047263683324224e-01   +5.347723194060873e-01   +1.797082040287341e-01   -1.375603644847550e-01   -1.553379436191684e-01   -1.265872003492463e-01   +4.052186910896560e-01   -1.449941139448863e-01];
L3E_L3I_iGABA_netcon = [-2.987732649196940e-01   -2.167427794759320e-01   +5.852669877146420e-01   -1.578552632097137e-01   -4.940398114471240e-01   +1.073123036725101e-01   +2.736842310496230e-02   -7.543883365811241e-01   +7.340962260556469e-01   +9.453009513195573e-02   -4.703238573634462e-01   +5.581192874806015e-02; +1.000000000000000e+00   +5.639257561693841e-01   +5.396273222320909e-01   -5.316088473826778e-01   +1.108722796326184e-01   -3.618757489236243e-01   -7.573544322404411e-01   -1.995703123286424e-01   -1.037450089269282e-02   -4.303403187087306e-01   +2.487722478896973e-01   +3.005055529767651e-02; +1.152202244305513e-02   +4.240197808451121e-02   +4.094941715965920e-01   +7.519987977898148e-01   -1.449258170494413e-01   +8.995303619267737e-01   +3.514278089707406e-01   -3.982699397673326e-01   -9.546420829799741e-01   +4.898094808428578e-01   -3.639646803810434e-01   +3.247021898174262e-01; +7.138249214455787e-02   +1.675477689549406e-01   +4.836275815581804e-01   -6.331734010816229e-01   -5.690857800909946e-01   -3.093947362034795e-01   -7.116683012754157e-01   +4.268223451130467e-01   +6.155224772680266e-02   +4.930168002143838e-01   +3.980155606559210e-01   -2.980180009106204e-01; +3.167806646920260e-01   +4.896296273244518e-02   +2.295494323313344e-01   +2.005146242223625e-01   -6.029382636779237e-01   +5.002138310007220e-01   +2.725090111330341e-01   +1.343414317759138e-01   +1.620551104253607e-01   -3.496714768760603e-02   +2.502189173454645e-03   -8.864235179726085e-02; +5.200808587512434e-02   -4.689819348776787e-01   -1.611606378456946e-01   +7.834384008997747e-01   +5.310826148548679e-01   +4.684535629380194e-01   -3.007279894991692e-01   +9.102072718340480e-02   -5.923848938436740e-01   -4.121749154327418e-01   +2.817848691478235e-01   -1.732855836381774e-02; -2.175012545618934e-01   -9.841834074867810e-01   -2.324238581189979e-01   +1.693275572807135e-01   +4.609385676313996e-01   -5.793716897665197e-02   +1.359652973362312e-01   -6.778474698775618e-02   +5.188386139940091e-01   +5.455936994227902e-01   -6.477780428142474e-01   +5.674761086537077e-01; +5.358155985924330e-01   +1.413265910629457e-01   +1.687579499430623e-01   -6.042809461332943e-01   +2.344860802700041e-02   -4.056375470171247e-01   +5.148006387247704e-01   +4.120290887560116e-01   -4.255944483616463e-01   -3.559444344269599e-01   -4.676513646922899e-01   -1.066210177020460e-01; -5.286303870130029e-01   +3.354263091715444e-01   -3.066014803738675e-01   -2.642577650909705e-01   -6.138191180430185e-01   +4.680963091334625e-01   +9.664511963469279e-02   +5.720513812730866e-01   +8.969925921597428e-02   -3.551421201841287e-01   +1.401952141482312e-01   -5.159200623089607e-01; +3.396768784601735e-01   +2.178366958520676e-01   +6.806810137652349e-01   -2.679630617756066e-01   -1.545437635682563e-01   -5.654199221314136e-01   -7.182689732883146e-01   +3.980564654599867e-01   +2.681020245530920e-01   -4.209810705015834e-01   +2.742643090613839e-01   -5.419141427113624e-01; +2.845258534500299e-01   -6.976004805353374e-01   +2.942758235181737e-01   -3.099449447907938e-01   -2.508343034798933e-01   -6.470176359080730e-01   +4.958405290601416e-01   +4.243783072362105e-01   +4.234725244375794e-01   +1.968064702689140e-01   -9.120406838910941e-01   +6.685496642700282e-01; +1.417323668869794e-01   +8.397016347419085e-03   -6.641240423226913e-01   -3.458003189198242e-01   +7.857879913086264e-01   +3.804788805853268e-01   +7.083806012254583e-01   +8.847006088384153e-03   +3.867158653013376e-01   -4.397121579788919e-01   +9.523136837534604e-01   +7.155854711630679e-01];
L2E_Input1_iAMPA_netcon = [+5.915240740696945e-01   -3.325919635404292e-01   -1.462970895036152e-01   +7.258962884719878e-01   +2.532885882079626e-01   -4.256834357996044e-01   +2.689270990094394e-01   +2.570248061863213e-01];
L2I_Input2_iAMPA_netcon = [+4.387499668995034e-01   +7.388127674918976e-01   +6.103896643762299e-01   +4.867970457225815e-01   -1.529303202368173e-01   -1.000000000000000e+00   +5.879241281230394e-01   -3.160460034084385e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
