function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.395578820492462e-01   +4.049735273005581e-01   +3.485863609557463e-01   +2.002829653884360e-01   -9.517611490710146e-02   +4.685871517392938e-01   +5.844050434511832e-01   +4.585625285322377e-01   +2.803870568010799e-01   -8.411258801368572e-03   -7.262325669248200e-02   +2.207822262148079e-01   +2.955771812700789e-01   -1.806681485740013e-01   +3.155161218669045e-01   +9.440869459927588e-02; +6.625488649864971e-01   -5.359122216387338e-02   +3.323593727594076e-01   +3.507612451992931e-01   +7.933404967706677e-02   -1.823506347643106e-01   +3.966520199178266e-01   -1.963781231642657e-01   +7.890786439158446e-01   +1.303537487821557e-01   -2.341008030181505e-01   +8.253455472832970e-01   +1.764283486783365e-01   +1.474488572623089e-01   +3.455519056766498e-01   -4.161735523960979e-01; +4.026102791933533e-01   -1.433978110898036e-01   +2.779436330562422e-01   +3.121749245822615e-01   +1.360138897938133e-01   -1.261496104461385e-01   +1.980747761512949e-01   +6.877127710373006e-02   +2.087344018323163e-01   +7.011097342143416e-01   +7.731482606581250e-01   +6.316718294709492e-01   +6.086205710499746e-01   +2.933059541443922e-02   +1.917221747407223e-01   +2.910429767223232e-01; +1.329323657908691e-01   -4.683632715764858e-01   +3.535134498015498e-01   +7.928219769228172e-01   +2.445480265086374e-01   +6.136630020004414e-01   +2.622946099613428e-01   +3.471800429057534e-01   +1.030180433143358e-01   +3.725408987812894e-01   +4.965176518608705e-01   +2.928205630250375e-01   -2.296739687991916e-01   +5.480670243587624e-01   -9.327055822055473e-02   +2.571485437087139e-01; +4.245487132134002e-01   +4.645325648074507e-02   +1.192792001753009e-01   +1.127425609614190e-01   +2.326726910641576e-01   +6.856134295779172e-01   -1.266598252207756e-01   -2.374092166702589e-02   +5.618373147948287e-01   +4.865405073837402e-01   +2.674442213515268e-01   -3.211334285712035e-01   +4.406750540282560e-01   -1.473423508033666e-01   +6.715227302556960e-01   -3.057846816098648e-01; +1.929866760508008e-01   +2.163749043012548e-02   +3.240261504556274e-01   +2.755809270537961e-01   +4.676302682763489e-01   +9.624427673199400e-02   +2.869251385304375e-02   +2.891106031052692e-01   -1.676692587750753e-01   -9.386882718296283e-02   +9.961997862933712e-02   +5.825066301842191e-01   +2.756353206824627e-01   +5.622401786781182e-01   +7.045009559101429e-01   +1.913925054651658e-01; -7.981157445531352e-03   +6.062279641657534e-01   -3.719957605570443e-02   +7.444081248065308e-02   +2.241956080036467e-01   +5.760077765983309e-01   +7.345554322141104e-02   +3.777836004623217e-01   +1.305335418466409e-01   +1.653964261439553e-01   +4.059302586531743e-01   +1.144290548864877e-01   +1.833944650904684e-01   -1.039382093950767e-01   +8.740324688326713e-05   +1.063397569859683e-01; -4.625725432734622e-02   +4.122656283578343e-01   +2.117015588465108e-01   +4.436036049487749e-01   +5.347986244761928e-01   +3.633213523062118e-01   -8.102471005790098e-02   +1.265599272161755e-01   +4.954676750639462e-01   +5.717843208234255e-01   +5.115385315923144e-01   +7.839365059415491e-02   +5.524825628140446e-01   +2.658983161775777e-01   -7.036207401902954e-02   +1.318155130574225e-01; -1.058702409608138e-01   +1.443136794673082e-01   +1.105192320842076e-01   +1.383491252283352e-01   -2.210964732630823e-01   -8.110108226342205e-02   +4.872106204422723e-01   +2.163370895389218e-01   +2.921248638902612e-01   +5.493584146277022e-02   +6.740256997930810e-01   +8.866729342875522e-02   +5.198672377288213e-01   +1.399734152871789e-01   -5.611622945135829e-02   -1.596361742198562e-01; +1.763464838930171e-01   +2.541403860186711e-01   +3.187530570097422e-01   +1.000000000000000e+00   +1.339389672804478e-01   +1.765201760872702e-01   +1.919711120413271e-01   +4.338534310118846e-01   -9.759064280586587e-02   +1.846014411482612e-01   -3.828848328332635e-01   +5.957881097443878e-01   +4.623662474259441e-01   +3.525396495728607e-01   +2.707402806984585e-01   +3.822087179340828e-01; +2.459610130343409e-01   +5.516260982076256e-01   +6.446381236835981e-01   +1.302706058317517e-01   +9.581701898368855e-01   +6.981149422240186e-01   +5.672917734906243e-01   +3.019799709366810e-02   +9.055815115327236e-03   +5.001391502308502e-01   -2.689722381953568e-01   +2.389256357675072e-01   +4.060143762366150e-01   -2.201028130701886e-02   +3.495759569141023e-01   +1.941819334926317e-01; -1.351774907318946e-01   +7.123478682149255e-02   +3.852212603386682e-01   +7.549653429434535e-01   +6.340937509238751e-03   +4.034116664307221e-01   +2.069944915261462e-01   -3.034211629286519e-01   +6.019523640216795e-01   +4.757334200812620e-02   +8.048235472867553e-01   -1.815480998764536e-02   +1.495429697530151e-01   +2.568633879599740e-01   +2.697881159648783e-01   +2.688359128235126e-01; +6.296615602408285e-01   +4.361472624543117e-01   +4.573283533476594e-01   +2.210983080224687e-01   -1.994134425946394e-01   +6.131889340411086e-01   +3.854307863627175e-01   +2.494409338326410e-01   +1.787013568427797e-01   +2.476607463633218e-01   +1.983506481810987e-01   -1.784022698205031e-01   +1.324451949155390e-01   +3.123309460440450e-02   +7.426595919624331e-02   +2.886800908024806e-01; -3.017705416102035e-02   +5.640386234019255e-01   +5.226885291175020e-01   +4.604793845055586e-01   +6.261912410437894e-01   +8.408520444119390e-02   +1.445075584978582e-01   +2.646042210907080e-01   +4.623152406244351e-01   +8.856660639470143e-01   +2.905173053267500e-01   -4.866340589501726e-01   +3.823998218748606e-03   +4.308881513847946e-01   +8.852408689281903e-03   +4.312692510511370e-01; +3.284996439740563e-01   -7.268584841778272e-02   +3.570981538294062e-01   -2.861911651264409e-01   +2.592947082146227e-01   +4.649936102036596e-01   +1.856008343366137e-02   -1.312505019743750e-01   +9.811289904750566e-02   +3.821431076005447e-01   +2.383226461983339e-01   +1.023286278963044e-01   +1.789183336885176e-01   +1.272076137139335e-01   +6.508595778148516e-01   +6.113541269118419e-01; -2.776979559546146e-01   -4.839855443681963e-02   +1.270996353589103e-01   +6.569456968547001e-01   +2.837833931743106e-01   +3.490608019259647e-01   +5.284564042820699e-01   +4.196137829073454e-01   -7.925839942132314e-02   -1.417266564609412e-01   +2.711121800007716e-01   +3.398358282049460e-01   +2.236023054881159e-01   +9.220320533810832e-02   +4.891222918532255e-01   -2.218714088047712e-01];
L1E_L1I_iGABA_netcon = [+6.494186821486350e-01   +2.542632246209752e-01   +7.638764248629720e-01   +2.358537870580982e-01   +1.375226420166919e-01   +7.612691749632453e-02   +1.501653932395572e-01   +4.939772054380697e-01   +2.555914751792246e-01   -2.796487516753580e-01   +1.601094418606508e-01   +2.829213318994857e-01   +1.250571837548493e-01   -1.857112205794646e-04   -1.929295282740726e-01   +8.474623232810193e-01; +3.157931222206082e-01   -9.186923150303809e-02   -1.298858816220894e-01   +1.783649910579872e-01   +3.213466262135109e-03   +5.514158216082395e-01   +4.386297653775784e-01   +3.659716619323997e-01   +3.868980278705453e-01   +7.952326861447740e-01   +4.454068745463197e-01   +5.323445338414116e-01   +2.105134545580284e-01   +5.789658943451809e-01   +5.576897085873066e-01   +1.041376219323982e-01; -6.070155614516809e-02   -1.560756327519700e-01   +2.541873072543679e-01   +1.058943857303410e-02   -1.224598501743652e-01   +8.252399996809915e-01   +5.701494428115920e-01   +2.479575298931644e-01   +4.226985633472838e-01   +2.526038640279195e-01   +4.668096437555036e-01   +1.822911841267138e-01   +8.904659097344790e-01   +3.843032006341384e-01   +3.049975408858550e-01   +2.076053220205373e-01; -3.743312984424124e-01   +2.063570701582658e-01   +7.631597611396810e-01   +8.466091129353483e-03   -3.293549991723806e-02   +3.382325295720030e-01   +1.927075389104305e-01   +1.665100173631565e-01   +1.420267833990710e-01   +3.269822395707943e-01   +2.287553523001261e-01   +5.671922247181379e-01   -4.239908918030301e-02   -4.179542716889283e-02   +1.880184933538497e-01   +3.815875104191800e-02; +4.606646311699309e-01   +1.271517332369472e-01   +1.339220464513372e-01   +7.383642852869216e-01   +7.729141190006307e-01   +1.201674478775651e-01   +2.625796898111266e-01   +1.859356358136085e-01   +2.243850945100457e-01   +8.877057855949917e-02   +7.513429722574984e-01   -4.167652030605571e-01   +5.234174430481807e-01   +2.393051894471676e-01   +4.104311562248316e-01   +2.252599452232804e-01; -1.744029059719857e-01   +3.599799939639350e-01   +6.905467422270455e-01   +4.281969568172968e-01   +1.027476535764712e-01   +2.406861960373115e-01   +7.404085418116476e-01   +2.329058527315129e-01   +8.276876642727031e-01   +7.491092781261656e-01   +2.987034116690461e-01   +3.034461457774640e-01   +5.119221512744039e-01   +3.861148257938475e-01   -3.002022408636289e-01   +5.906445938262139e-01; +2.973770117363292e-01   +4.706403595519684e-02   -2.780325908189828e-01   +6.326113285943198e-01   +5.582645110700082e-01   -3.438359204509201e-01   +2.474843556849024e-01   +7.777687717039154e-02   +4.902658374900399e-01   +3.558620009092157e-02   +2.826072378620975e-01   +2.492032331369529e-01   +6.733663140710335e-01   +4.147148221357934e-01   -1.824422459764809e-02   +2.277821618723419e-01; +7.396848639405543e-01   +1.508141301152064e-01   +4.970891530061876e-01   +9.755111661991030e-02   -7.178318297835650e-03   -2.260449517962776e-01   +5.874647774371813e-01   -1.567278072399237e-01   +5.546129199545292e-01   +7.520838522273708e-01   +5.970529812658495e-01   -1.299479418790007e-01   +5.746270533421672e-01   -9.666854265718404e-02   +6.126501324775233e-01   +4.894169751640812e-01; +3.662370977756568e-01   +7.252205308658097e-01   +3.787284178506224e-01   +4.145912885407810e-01   -1.456025566667669e-02   +5.915470140616295e-01   +5.639209156332012e-01   -1.490738529289093e-01   +3.096259526205974e-01   +9.585023186028697e-02   -1.794733483105111e-01   +2.090336585421745e-02   +1.000000000000000e+00   +6.341243173211898e-01   -2.095474541376042e-01   +5.661964810641256e-02; +6.211614394787459e-01   +4.854780691034903e-01   +6.586922503188560e-01   +2.345293442950426e-01   +2.964929756328631e-01   +4.848343400399227e-01   +3.610928432630466e-01   +2.309777396264068e-02   -1.362652867601210e-01   -4.233926341005784e-01   +2.264619419464946e-01   +1.494707901902286e-01   +4.612673531382409e-01   +5.755217283265188e-01   +3.874402884944368e-01   -3.857999676599763e-01; -6.292769702278797e-02   +1.657999647808679e-01   +1.528585943442623e-01   +2.952376336119161e-01   +6.687545347317141e-02   +9.243193284999728e-02   +4.874047912705464e-01   -5.057558692109420e-01   +1.367502011438433e-01   -3.769897398967357e-01   +2.116678525323896e-01   +2.165764320883870e-01   +2.622859466041040e-01   +7.510508941025572e-01   -9.175605489035199e-02   +4.038045185833252e-01; -4.072757352644570e-01   +5.694705703281039e-01   +1.542331922218550e-01   +1.951814691155970e-01   +7.017709836963266e-01   -2.906118473565855e-01   -1.151674020517547e-03   +3.854235242141459e-01   +7.529923619945169e-01   +8.342160197763729e-01   +6.685513309663781e-02   +7.328486862859714e-01   -3.995802657435669e-01   +2.443386542461985e-01   +5.982944553837936e-02   -2.888112948304642e-01; +5.785223744210016e-01   +1.132383695737889e-01   +4.458947602989048e-01   -3.642316461860535e-01   +4.760936868740682e-01   +5.450653749246891e-02   +7.782212349292168e-01   +1.314849666162346e-01   -5.924052915687151e-01   -5.676572701081589e-02   +1.614749934757472e-01   +3.116459697739690e-01   +2.748383716476987e-01   +5.438860628730166e-01   +3.123842812285635e-01   +2.865646234461178e-01; +6.032572313997960e-01   -3.144426338945172e-01   +4.581864127310974e-01   +6.976536692156987e-02   -3.819367407826424e-02   +2.825556524432512e-01   +1.638834569509078e-01   +9.418297848752473e-01   +1.137832367858497e-01   +5.627410687152860e-01   +1.593100966860943e-01   -1.338880012769755e-01   +2.128010615787162e-01   -1.075419827164053e-01   +3.657742256375273e-01   +6.675331813063051e-01; +1.850372273175406e-01   +4.320247462664432e-01   +4.072712905888689e-01   +6.458202064323442e-01   +3.082792377794290e-01   +2.239881746148402e-01   +3.426317633894759e-01   +3.702828662223475e-01   +6.678290066232990e-01   +2.123441993693539e-02   +8.221856150480013e-01   +4.443702076174911e-01   +5.932606191742597e-01   +2.956604031756898e-01   +2.603759119236510e-01   +6.500235132946602e-01; +8.824010022515540e-01   +7.126420732496310e-01   +4.152538082620811e-01   +1.151754506785080e-01   +7.014545541146632e-01   +2.859549054637717e-01   -4.918660646471047e-02   -9.592151222133413e-02   +6.463504565366027e-01   +4.704914900828971e-01   +7.164810265435466e-01   +3.919991297686644e-01   -7.958062829190567e-02   +5.125988351974680e-01   +6.998068620373145e-01   -2.390955574329431e-02];
L2I_L1I_iGABA_netcon = [+6.316967151586593e-01   +5.340978773894505e-01   +2.174663692363132e-01   +8.995870197400504e-01   -4.671578604333604e-01   +2.158796144060083e-01   +2.334673958248284e-01   +3.590163993762126e-01; -1.631400027440405e-02   +1.118014182014095e-01   +5.949295543123831e-01   +2.583797416691969e-02   +2.562633604161460e-01   +2.108914749208931e-01   +4.065444173698895e-01   +4.540010440792134e-01; +4.208959896484295e-01   +7.232975248059531e-02   +5.969165552333375e-01   +3.527738014373558e-01   -3.957633069041355e-02   +3.935502805831408e-01   +4.662678710747186e-01   +7.919990961533206e-01; -1.503850182614304e-01   +1.644263197010046e-01   +5.818198127751468e-01   +5.042155402715102e-01   +3.615151209862215e-01   -2.795767935803781e-01   -7.272987256371957e-03   +6.201573515429804e-01; +5.205856867075647e-01   +1.284485620183795e-01   +1.940717164476251e-01   +2.892464137290144e-01   +1.573906484099504e-01   +1.523407369366954e-01   -6.032546223829467e-02   +2.965559410221519e-01; +2.984716169775409e-01   +5.633647417557616e-01   +1.498292343431026e-01   +6.345018411877963e-01   +1.059874082002967e-01   +6.921757132664150e-01   +5.330621758289663e-01   +3.315933583212290e-01; +8.178341821062703e-02   +4.377638119959064e-01   +7.451089296971755e-01   +5.165501703323006e-01   +3.391407660045554e-01   +2.880539245467162e-01   -4.085756012916352e-02   -2.771115297508867e-02; +7.850232020824645e-01   -1.734692733180385e-01   +6.370564581828990e-01   -2.277732646670559e-01   +7.852979822600976e-02   -1.895727227119130e-02   +5.062448839137171e-01   +4.065617869118233e-01; +3.784585094937645e-01   +3.367688904585163e-01   +2.363730631164825e-02   -1.229741347497359e-01   +3.744711329015972e-01   -8.936462951803018e-02   +3.267434518899687e-01   +6.505125370950674e-01; -3.422309960323394e-01   +4.012687014858624e-01   +6.054940722160462e-01   +2.600462806388053e-01   +3.373148995430980e-02   +4.616143411011527e-01   +1.000000000000000e+00   -2.099532249555114e-02; +4.576370843280744e-01   +2.743254470624051e-01   -2.920982266472581e-01   +3.495197142430895e-03   +7.720757730522232e-01   +1.407753145202748e-02   +1.073746018295765e-01   +3.945772553953714e-02; +5.153165120473393e-01   +3.948402171631520e-01   +6.841968636964495e-01   -6.638907345129285e-03   +6.161649375789123e-01   +4.816445625328692e-01   +4.041270498361358e-01   +6.727924700289685e-01; +3.324405483259255e-01   +2.424724496450806e-02   +8.822576103816605e-02   +6.777625915853511e-01   +3.745434213243601e-01   +5.439785860983871e-01   -9.169930950139048e-04   +2.690988788483802e-01; -3.411339140694145e-01   +7.117640161536237e-02   +1.111509232545285e-01   +3.229269701593137e-01   +5.066323760137604e-01   -9.085486205269079e-02   -2.654924844539387e-02   -1.030021924857910e-01; +2.757810674947840e-02   +6.931610844971572e-02   +3.271915253413499e-01   -8.642088411833629e-02   +2.186777429665781e-01   +3.565947997740189e-01   +2.569560385238525e-01   +3.519728620165499e-01; +3.207645439527632e-01   +1.492642017856235e-01   +6.876839756834002e-01   +7.802900189567804e-01   +3.634966502726913e-01   -8.426574293183690e-02   +2.529937412233848e-01   +5.697838776795444e-01];
L1I_L2I_iGABA_netcon = [-4.986847809196487e-02   +1.038244646302080e-01   +3.744831205611910e-01   +3.404650344318519e-01   +6.297805634632066e-02   +7.023490238801261e-02   +1.904366439614506e-01   +4.703086920456019e-01   +2.831675476539790e-01   -4.001979484257686e-02   +1.750427628205324e-01   +3.123443621876926e-01   +5.220446459082599e-01   -3.101218705636242e-01   -1.148050013195605e-01   +3.874177566671076e-01; +2.683246155936136e-01   +6.018991757041624e-01   +6.344506354887044e-01   +7.814933680620089e-01   -9.836190661838633e-02   +1.367294021618642e-01   -5.400298566266439e-02   +3.229392961758398e-01   -8.078418657366819e-02   -2.492553490441827e-02   +3.302537905867833e-01   -1.707798946073679e-01   +5.869203514784793e-01   +7.693375554141488e-01   -7.722266225553864e-02   +1.726170029811029e-01; +1.649808100813041e-02   +1.070281943119080e-01   +3.307232073403373e-01   +3.184781610193340e-01   +2.912716127676269e-01   -1.397919507638441e-01   +2.741341137063400e-01   +2.379222700380051e-01   +4.205579048083579e-01   +7.789619604526118e-01   +4.131054674885316e-02   +4.271647547269365e-01   +6.184271342327324e-01   +2.439259196676580e-01   -5.458283753752973e-02   -1.750442366789538e-01; +3.733508555379551e-01   +5.683307991339083e-01   +3.690712522636743e-01   +2.195074902444853e-01   -1.004180056119270e-01   -1.713072651198121e-01   -1.807244168574097e-02   -1.949172146060647e-01   +4.045926132164403e-02   +5.302179790451221e-01   +3.933201051174963e-01   +1.000000000000000e+00   -2.627830609273420e-01   +2.612820734405472e-01   +3.066842361230506e-01   +5.683109138440990e-01; +6.055320840027345e-01   +6.108110306561038e-01   +8.017262809231878e-01   +2.871682310876258e-01   +1.658465797813504e-01   +4.628141074131812e-01   +8.234204090427261e-02   -4.887772410524110e-02   -2.669762581545401e-01   +2.756595809643901e-01   +2.169646576172171e-01   +4.304804127102243e-01   +1.270735593471917e-03   -1.378408305788441e-01   -1.801020591679398e-01   +2.343279773012099e-01; +3.766547056444381e-01   +7.416824785535499e-02   +1.785803522469336e-01   +2.354577341385471e-01   +3.950222523689209e-01   +3.560201274202408e-01   +1.704897258283442e-01   -1.533466233174611e-01   +2.216619058716025e-03   +8.902738975125148e-01   +3.638293698648342e-01   +3.650198980966047e-01   +2.500425497289939e-01   +2.212367744598295e-01   -3.896864156368075e-02   +5.138242907543098e-01; +1.665372190773863e-01   +8.228212207313228e-01   +1.003997810181232e-01   +4.346461291928932e-01   -2.797068193832032e-02   +5.601414966553628e-01   +2.463226984877592e-01   +4.330178044351017e-01   +2.494172523102096e-01   +1.881759083210466e-01   +2.670586987938693e-01   +1.849005907879928e-01   -9.520153390058381e-02   +1.753958442847734e-01   +4.944309292029053e-01   +5.551349474992471e-01; -5.474265064972937e-02   +1.098624248819042e-01   +4.181623222691692e-01   +2.085045408151774e-02   +1.175858638193487e-01   +6.442856128028736e-01   +1.829487832478478e-01   +2.876010184421086e-01   +7.925668526454774e-01   -1.453696805827536e-01   -2.922919562158604e-02   +3.414950340748088e-01   +4.024147833286134e-01   +5.930423555975528e-01   +2.927179851162215e-02   +4.465993474717442e-01];
L2E_L1E_iAMPA_netcon = [+6.553766231334452e-01   -4.360352290605164e-01   -7.265714553168308e-03   +2.988470150036468e-01   +3.343436768567515e-01   +4.161869977686420e-01   +3.551910573727927e-01   +3.377133056649335e-01; -9.321970400546145e-02   +4.837416964195069e-01   +5.146732176568048e-01   +1.321191845379861e-01   -1.648387980499892e-02   -1.781160421247709e-01   +5.805116452533872e-01   -2.153158520190177e-01; +5.427757475260944e-01   +1.827090307020203e-01   +2.363941455245221e-01   -5.295693012082445e-02   -1.578764254264818e-01   +6.644355292013043e-02   +8.279013908034791e-02   -6.422914935015257e-03; -4.112526989835398e-01   -8.194247120724527e-02   +2.471257317159906e-01   -4.110241051988303e-01   +1.462383645648343e-01   +2.689257975593743e-01   -3.990160265290367e-01   +3.626838153568723e-01; -4.832299798167021e-02   -1.306204371730788e-01   +7.424219542349085e-02   +5.853788748568793e-01   -3.452101407808863e-02   +2.505536453888513e-01   -6.609244615113237e-02   +5.095295512705094e-01; +7.172180645120496e-01   +6.857951990593532e-01   -2.977917879409722e-01   +3.781099063741114e-01   +3.507950689081504e-01   +2.651721725809550e-01   -5.321351221096411e-02   -3.625596749725760e-02; +7.982789042436775e-01   +3.770601531257524e-01   +3.816364238599419e-01   -1.397379405070790e-01   +5.271755432211003e-01   +1.438022990684092e-01   +5.733060084260328e-02   +4.252296019417185e-01; -1.833468236718878e-01   +1.216883873662351e-01   -1.323731204866564e-01   +2.505974347098098e-01   +2.745197389178363e-01   -2.743920615990664e-01   -1.863243986882461e-01   -2.589696862520040e-01; +6.080614635241107e-01   +5.672744947587797e-01   +1.270282164864359e-01   -1.381996184968499e-01   +4.402953256391672e-01   +6.744252468314758e-02   +8.043776920400482e-02   +3.982394694633116e-01; +4.804421000277855e-02   +4.385157511097904e-01   +4.523177160427813e-01   +1.934855759415215e-01   +5.137227490237712e-01   +2.028560375378398e-01   +5.103265408034553e-01   +1.350832599594751e-01; -5.618665464892475e-03   +1.168886203294539e-01   +4.531366019489185e-01   +3.127344252951486e-01   +3.116425126357719e-01   -1.047519391100256e-01   +2.897561112411777e-01   +4.483467403532645e-01; +3.897101550564245e-01   +5.948315513135188e-01   +3.601181347798328e-02   +3.086558632100180e-01   +1.338037328130554e-01   +1.601900723548345e-01   +2.165888302324929e-01   +3.294613130560641e-01; +1.644136391806570e-01   +2.289899471995802e-01   +1.662856875579299e-01   +7.846206455344468e-01   +6.476902759816178e-02   +1.128669110556294e-01   -5.946797895641007e-02   +4.298144969395366e-01; -2.609317177134673e-01   +8.838884448207197e-02   -1.022327127965728e-01   +2.570669196766023e-01   +2.237392868467048e-01   +5.398172712097354e-01   +1.000000000000000e+00   +8.716438232345226e-02; +3.770884555225492e-01   -2.178197100579056e-01   +9.583090723896051e-02   +4.252583141366946e-01   +1.727462391653708e-01   +5.178009615723356e-01   +4.008132656405583e-01   +3.236296771323131e-01; +5.886497360974246e-02   +5.344950027056765e-01   -1.523280011249444e-01   +3.959677685777129e-01   +3.706210268229686e-01   +8.290280322040298e-02   -1.991485083460462e-03   +8.305206454075773e-03];
L1E_L2E_iAMPA_netcon = [-2.814071815582208e-02   -8.629882244281253e-02   +2.573538866888324e-01   +5.106444700112291e-01   +4.396631155478949e-01   +4.080168517556047e-01   +3.140547326912129e-01   +4.622037146977772e-01   +4.662540447245215e-01   +2.395214734910494e-01   +5.907325706945802e-02   +3.421604790292693e-01   +8.041786872486950e-01   +3.734675404012585e-01   +2.068944125808087e-01   +4.448778725064190e-01; +1.963785848059480e-01   +2.531479660984725e-01   +9.497378965055021e-02   +3.475505685660950e-01   +2.182102562174874e-01   +4.167579314596365e-01   +1.887717845821966e-01   -4.316820633806637e-02   +2.818916353553665e-01   +5.395827962234953e-01   +3.757798377834325e-01   +5.563844911603897e-03   +3.259892013910047e-01   +1.276144033506777e-01   +5.601594523923497e-01   +1.874456952161670e-01; +4.587912192665645e-01   +4.123676189489420e-01   +3.099431312846750e-01   +1.002592735350496e-02   -2.601717434012699e-02   +1.940785481792172e-01   +2.178161967727882e-01   +6.758485300165242e-01   +8.998818271894257e-02   +3.578659537048514e-01   +4.402629254651120e-01   +1.000000000000000e+00   +6.690743605193761e-01   +5.822573150090419e-01   +2.600220863119909e-01   +3.161322005988210e-01; +3.901087756662742e-01   +8.412601130247075e-01   -4.282227771948906e-01   -2.473383107790178e-01   +5.645298305375709e-01   +6.461873480081448e-01   +4.650425521606448e-01   +2.085860086518500e-01   +5.863600316218844e-01   +9.753554676856382e-02   +1.558341208409957e-01   -3.086474445719766e-01   +2.467570753413917e-01   +4.141045058793247e-01   +3.503394338676192e-01   -3.372775187884134e-01; -1.106454593226617e-02   +7.453902810242671e-02   +5.875780108593189e-02   +1.920934711597922e-01   -1.284941114683177e-01   +2.818606370527594e-01   +6.170000683934381e-01   +6.139053555237214e-01   -3.691934607150796e-01   +4.196148502868762e-01   -4.427920653059843e-02   +2.074834793903751e-01   +1.759897591860976e-01   +3.933049294554534e-01   +1.125388835134666e-01   -2.177234504143710e-01; -7.338925375538349e-02   +6.251888659789105e-01   +7.354287517545000e-01   +4.032510123944094e-01   +1.839018510793141e-01   +4.152532322310923e-01   -2.096607629914317e-01   +2.837045220152409e-01   -3.423996639197999e-02   +2.002536234057421e-01   -1.523505565707871e-01   +9.924657526768461e-02   +6.199427151114494e-01   +2.006498679739967e-01   +2.602817923094278e-01   +6.061176595053378e-01; -3.513636931834898e-02   +1.723376765050596e-01   +1.545636718510975e-01   +4.373075845072981e-01   +3.675907702226486e-01   +1.382501299124968e-01   +2.270688370425776e-01   +4.771564330369756e-01   +3.614019728285233e-01   +3.185188505848451e-01   +6.458492448564615e-02   +1.532684963268642e-01   -1.107821769893493e-01   -8.383438697086030e-03   -1.787885545344355e-01   +4.146055807340375e-01; +4.929270630885056e-01   +6.229835753945112e-02   +2.741317794851261e-01   -9.199263593511978e-02   +3.990040640649987e-01   +5.251972313484521e-01   +1.480407233627048e-01   -7.780297570320781e-02   +5.101878718167044e-01   -1.139279299306221e-01   +5.810609491015424e-02   +2.672741227788639e-01   -2.608980582429190e-01   +8.076604294760040e-02   +5.275270642382719e-01   +3.025955186239732e-01];
L2I_L2E_iAMPA_netcon = [-4.049614448092408e-02   +4.737420544172585e-01   +7.949931880856580e-02   +3.623663069808731e-01   +9.706099155249297e-01   +1.222383510300362e-02   +7.574499805666216e-02   +2.674822920474811e-01; +1.891151719368188e-01   +2.700581092333986e-01   +5.338642233867256e-02   +2.766806834031778e-01   +4.180948569874767e-01   +6.005524458718152e-01   +4.177478084328350e-02   +6.386267432625385e-01; -1.875914534353315e-01   +1.361356285141893e-01   -9.971059099411957e-02   +4.186279679729349e-02   +6.442454747524465e-01   -6.919957162311760e-01   -1.770868157389250e-01   +4.754386220617279e-01; +6.250019668249804e-01   +1.000000000000000e+00   +3.840064146527827e-01   +5.797738250027816e-01   +3.564680227678338e-01   +3.491746008024624e-01   -2.703693395078913e-01   -3.871570057455487e-01; -2.002107098748597e-01   +6.608746991081415e-01   -1.638734557955960e-01   +2.638752659498514e-01   +5.843393169101659e-01   +4.540388278721674e-01   +4.810605247530718e-01   -2.104213776746651e-01; +2.113749953283383e-01   -2.412664219069862e-01   +4.354537999995211e-01   +1.986196609576205e-02   -2.043177782991558e-01   +9.172089988509098e-01   +3.053868077173153e-02   +8.851388965712353e-02; -7.498378439159271e-02   +7.964800245377642e-01   +5.898721445052252e-01   +5.866660110330246e-01   +6.431657251226391e-01   -3.117710579586038e-01   -1.576601971992498e-01   -2.500426808530538e-01; +3.165894480869877e-01   +9.093989248530842e-01   +1.606381490437173e-02   -1.364173629296449e-01   +5.105999290568243e-01   +3.444494044097979e-01   +4.465576569534158e-01   +6.864637217293738e-01];
L2E_L2I_iGABA_netcon = [+5.969852383750419e-01   +4.197082316362489e-01   +3.670326579502643e-01   -1.031512576661319e-01   +3.307243847199952e-01   +2.822130406470197e-01   +6.457517198182757e-01   +5.662699929320093e-01; +6.465101434871858e-01   +8.327510814070177e-01   +3.279449718735336e-01   +2.977421180041737e-01   +1.286803104672626e-01   +6.480771362508114e-01   +4.508916720226407e-01   +5.493430097875762e-01; +8.360300297526655e-01   -1.532895070523774e-01   +7.011445861504486e-01   +7.181049495753411e-01   +7.988222871760795e-01   +1.000000000000000e+00   +6.984483639932526e-01   +3.104253898940125e-01; -2.698495260834194e-02   -1.358237248681520e-01   +9.240576324644804e-01   +3.300057112316820e-01   +8.928610719470825e-01   +3.888409737410355e-01   -2.092424507583558e-01   +2.797765435035934e-01; +1.946919925778431e-01   +5.062493189213570e-01   +1.903923685869798e-01   -3.791219434837906e-01   +6.701204328717911e-01   +4.988829536003070e-01   +7.264369703958291e-01   +6.576667810467830e-01; +4.728798758061907e-01   +4.373544611654607e-01   +1.624358722926786e-01   -1.029037272581890e-01   -1.586709187218072e-01   +5.164838380841862e-01   -5.662864281809823e-01   -2.628408153848498e-02; +5.025542895598691e-02   +2.524781946524687e-01   +4.129544630805261e-01   +4.891164870028736e-01   +4.549037446420620e-01   +4.151603383723370e-01   +4.886678202208783e-01   +6.563063501100148e-02; +4.921914712934630e-02   +1.679928030821023e-01   +4.068689548676760e-01   +2.418778915811737e-01   +5.830988878288447e-01   +2.575176037249426e-01   +2.274336752804939e-01   +3.799238779910507e-01];
L3E_L2E_iAMPA_netcon = [+2.270813266589178e-01   +2.090149060547851e-01   -2.089482465028143e-01   +1.851900752020712e-01   +8.304595577457082e-01   +8.204018052730903e-01   -5.852306068554669e-02   +4.086255106770498e-01   +3.729838653020598e-01   +2.789986758568973e-02   +2.319748030770342e-01   +3.580106325694803e-01; +1.813007564659938e-01   +2.674823398642147e-01   -9.767926081912717e-02   +4.059697362427993e-02   +3.163812747240499e-01   -9.542558219451105e-02   +5.572474740158510e-02   +1.814079998712421e-01   +5.321931689070458e-01   +8.602526732300535e-02   +2.940416529230646e-02   +5.821658273236542e-01; -1.673792452845910e-01   +2.340325194018625e-01   +4.351850076390909e-01   +6.215587836799067e-01   +6.705661843361176e-01   +6.190850089901675e-02   +7.656781902033245e-03   +9.558002735054173e-02   +3.506781173666443e-01   +2.765709101182400e-01   +3.006209620697501e-02   -6.139777100347465e-02; +2.090436497563385e-01   -1.280016436991239e-01   +6.540224685673593e-01   +3.303978842924470e-01   +5.442595005933677e-01   +6.311399750312744e-01   +1.185224285270620e-01   -3.428210680101624e-02   +1.750567629679998e-01   -4.095349980913468e-02   +5.141457559875542e-01   +4.184009853540205e-01; +3.563291016081320e-01   +2.772381406220144e-01   +2.706050807282328e-01   +2.263512559662208e-01   +4.147074495086933e-01   +7.967378055740012e-01   -2.899013916622867e-01   +6.986153283503571e-01   -3.425580568688657e-01   +6.578665252536048e-01   -1.517315372720687e-01   +5.603811397527552e-01; +9.175790104321371e-02   +6.498640914197204e-02   -1.219814067418149e-01   -3.800410990202585e-01   -3.387572666779591e-01   +1.313008647000333e-01   +1.961190374911240e-01   +8.139958554604269e-01   +3.377325223590861e-01   +9.038247027289976e-02   -4.546999623311079e-02   +6.064718973802179e-01; -1.771172709332217e-01   +3.993794562655754e-01   +2.277191327519842e-01   +1.000000000000000e+00   +3.283225354650446e-01   +4.742657106421871e-02   +6.049595672259351e-01   -1.715514195967576e-01   +4.781317732211709e-01   +4.397755909341796e-01   -2.377300082835141e-01   +2.316833082173824e-01; +1.517839683803099e-01   +1.864902197124473e-01   +1.855625681098422e-01   +4.858494975035540e-01   +5.158180677100728e-01   -2.602929286785341e-01   +1.188631684428604e-01   -3.801644971309908e-02   +1.791444262796127e-01   +8.059613546750354e-01   +2.958307255819541e-01   +2.823702477063613e-01];
L3I_L2I_iGABA_netcon = [+1.351886265458154e-01   +1.866712989886042e-01   +7.811619646645152e-01   +2.749439422801303e-01   +3.508298836497175e-01   +5.915795064693685e-01   +5.221593026073423e-01   -1.864261983984174e-01   +8.547471028324796e-01   -3.376590961588550e-01   +1.539282783894816e-01   +9.262669250839114e-01; +1.263025877084926e-01   +5.283470524052921e-01   +3.997233194522280e-02   +2.733238410722464e-01   +1.479272641179889e-01   +1.358015320100697e-02   -1.331898058802058e-01   +3.953666748807475e-01   +6.827852777065512e-01   +6.227982109027566e-02   -5.903531674494105e-01   +1.329536027674097e-01; -2.069055016792876e-01   +6.394414682431228e-02   -1.062987790550046e-03   +6.582180804233712e-04   +5.511298174714224e-02   -2.467911037181814e-01   +4.694254060778336e-01   +6.175995159736518e-01   +5.915981010793556e-01   +2.554165800610382e-01   +4.175616066094845e-01   +1.469829985067876e-01; +7.178407871314196e-01   +2.651239750324334e-01   +5.425713720235156e-02   +3.134104565864740e-01   -1.431394963865214e-01   +3.048772214866954e-01   +5.587184211591763e-02   +7.608636880525739e-01   -1.502532494344006e-02   -7.651471453394824e-02   +1.160143587785056e-01   +3.516837518752131e-01; -3.008131512957701e-01   +2.391232133995163e-01   -1.774780932231489e-01   -1.943583008838206e-01   +7.948115085857126e-02   +3.622845625970796e-01   -3.293382074736593e-01   +4.017062169905010e-01   +6.387112550735953e-01   +8.322931410546150e-02   +1.972144138637801e-01   -3.289872119065670e-01; -3.840935486983865e-03   -9.228150985505940e-02   +1.520548729059456e-02   +8.551493323678239e-01   +1.000000000000000e+00   +6.756626888603677e-01   +3.485662035085604e-01   -3.941972552895842e-01   +2.824425724334433e-02   +5.273424427052162e-01   +6.826803378426723e-02   +6.691583188090136e-01; +3.577496294282824e-01   +1.288997578208296e-01   +1.204168937316344e-01   +3.172502162816263e-01   +5.165736313635251e-01   +5.938824521033964e-01   -6.183573251846020e-02   -3.271543695983457e-02   +5.564790836590650e-01   +7.821246255191648e-02   +8.797398203428857e-01   +3.099408110180891e-01; +8.931988261161369e-02   +1.769294259976651e-01   +3.725729773219020e-02   +3.159477150568029e-01   +4.885920907058801e-01   +5.250840475291340e-01   +4.868686918716628e-01   +5.766076982684962e-01   +1.330616927383641e-01   +2.353333338546335e-01   +5.027641282900380e-01   -5.215233950066440e-02];
L2E_L3E_iAMPA_netcon = [+6.176011500146956e-01   -5.585789270869195e-01   +4.828576690362771e-03   +7.569785972137250e-02   +3.395869589379017e-01   +8.315303883214563e-01   +5.517335514102415e-01   -2.262453397176502e-02; +6.478828909509459e-01   +8.941708216779505e-01   -3.092526679717715e-01   +3.796663816328935e-01   +4.262770359686464e-01   +1.685420504900245e-01   +4.651656779631913e-02   -1.617992794762714e-02; +4.037747541657515e-01   +3.553217447443195e-01   -6.718523316152349e-02   +2.079934235151533e-01   +7.607483796631024e-01   +4.393807110994964e-01   +5.337273071043457e-02   +3.056815690964710e-01; +3.896160495560293e-01   +6.037320537451984e-01   +5.601605197703918e-01   +4.608244020907533e-01   +5.451341584031065e-01   +1.418427140146697e-01   +7.875914708949103e-02   +5.833101712890824e-01; +8.284636382965010e-01   +3.971150024809089e-01   +1.473446110269614e-01   +2.008723810458808e-01   +1.421996226669872e-01   +1.902957798484416e-01   +6.445525990926435e-02   +2.030887912623316e-01; +7.663674056354383e-01   +1.860264205925263e-01   +8.807534692832668e-01   +5.068171200653224e-01   +1.617488702767207e-01   +3.068099388955708e-01   -2.497896834142654e-01   +6.036255147191811e-01; +6.316169030226743e-01   -7.963320282686542e-02   +5.819727457476336e-01   +7.835898191228977e-01   +6.848046553453579e-01   +2.906760938283364e-01   +2.594309953834541e-02   +4.807245707989674e-01; +4.565467153210095e-01   +3.970162235074605e-01   -4.089356796005462e-02   +5.769726727563426e-02   +3.434130769070680e-01   -2.101545656100946e-01   -1.634947336316983e-01   +6.180404475008454e-01; +3.267642634934488e-02   +1.078485137437728e-01   +4.841794994286678e-01   +2.930048370574833e-01   +2.009582036235919e-01   +4.386049305278804e-01   +4.392249469540355e-02   -2.391430133299804e-01; +2.397310308416321e-01   -4.563268080612423e-01   +3.967696487513190e-01   +1.913200204459622e-01   +9.614602012876827e-02   +4.259321417801947e-01   +1.000000000000000e+00   +4.629165818896412e-01; +6.053922069155637e-01   +1.111817960557701e-01   -6.342646132507490e-02   -3.000920806346661e-02   +4.847056242125179e-01   -3.357302847962998e-03   -9.428736798714830e-03   +3.566197569491175e-01; +3.426973653467640e-01   -1.495942141604494e-01   +2.332462570224168e-01   -2.484453181663420e-01   +7.680386845433136e-01   +9.020825098991223e-02   +3.771956334099930e-01   +2.929071140476686e-01];
L2I_L3I_iGABA_netcon = [+2.813749931217440e-01   +2.039950117108550e-01   +5.950461832282320e-01   +6.670020785293299e-01   +4.789927831067406e-01   +1.559307704430840e-01   +6.158503567119093e-02   +6.109924585311608e-01; -3.167401175825098e-01   +4.042607571107188e-01   -8.739021867654830e-02   +4.211592958140412e-01   +4.653763970002925e-01   +3.353340658476257e-01   +1.467459537422819e-01   +4.700262506196279e-01; +5.871711641060340e-01   +2.934283603093275e-01   +5.903975517577165e-02   +1.789549940602339e-01   -2.681625420680476e-01   +2.774548628345092e-01   +3.061964292319444e-01   +4.545978477250183e-01; +4.331765614770287e-02   -1.743683458952916e-02   +1.127978252439461e-01   -1.853673268949173e-01   -6.805957888011352e-02   -3.047722298386102e-01   +4.421181081663357e-01   +6.760495225865272e-01; -9.729944243364934e-02   -3.223035766308092e-02   +9.488893851347829e-02   +1.713478855260100e-02   -1.363281048608130e-01   +4.744880056275206e-01   -3.175999947103875e-02   -4.228018938308519e-02; -1.211822377864627e-01   -8.549370662203257e-02   +3.967558458779332e-01   +2.030003119448188e-01   +4.658619168354410e-01   +7.954744770287515e-01   +5.562770242725659e-01   +2.614961577234329e-01; +7.493769831310634e-01   +5.340582721566403e-01   -1.324542553121577e-01   +5.004349648417625e-02   +3.517836195546766e-01   -5.981044012528502e-02   +8.909703654611512e-01   +1.580724884011660e-02; +5.744950420775174e-01   +7.022355113448006e-02   +7.936828345276040e-01   +7.440756223868745e-01   +1.701396007391991e-01   +6.741096320298036e-01   +2.110005015983523e-01   +4.999289296639561e-01; +2.740216710866745e-01   +5.176987904029492e-01   +3.333132475279458e-01   +3.161227201413992e-01   +7.716498457370315e-01   +2.809571942306140e-01   +1.000000000000000e+00   +1.629115991946672e-01; +9.907994331479482e-01   +6.540274938917318e-01   +5.143858785565169e-01   +1.379101336940770e-01   +6.484041442287377e-01   +6.229977993126259e-01   -1.622246543614919e-01   +4.678646095092638e-01; +1.885124174278883e-01   +1.094328391513488e-01   -2.505934018981101e-01   +4.482755798079086e-01   -1.021866790354795e-01   -1.951334190730661e-01   -2.356631864308970e-01   +3.358454459453240e-01; -3.216581441088043e-01   +6.366877221551277e-02   +3.194631379974477e-01   +5.550570603672389e-03   +3.970210091136263e-01   -1.208281768091532e-01   +1.167558925290897e-01   +7.916475567411498e-01];
L3I_L3E_iAMPA_netcon = [+3.143279033913698e-01   -3.014643654007399e-02   -5.216053846884049e-02   -1.788439032678860e-01   +1.948966217925871e-01   +3.994457721398240e-01   +2.315537124618362e-01   +4.473543079189749e-01   -2.185010130962698e-01   +3.889569360020940e-01   +3.121509814066825e-01   +5.538738870477885e-01; +8.175764786244293e-01   -3.358728052932056e-02   +4.572675047325481e-01   +1.683172157455420e-01   +6.233017034975594e-01   -1.889381792884446e-01   +4.674806688196762e-01   +7.715570419340788e-03   +1.584888198813126e-01   +5.606476498330852e-01   +2.014543987972562e-01   +4.200027108206509e-01; +3.033656175877182e-01   +8.102932818734444e-02   +1.487010408644475e-01   +1.377490551653390e-01   -9.121260911163627e-02   +2.950486434872481e-01   +8.151102129715746e-01   -1.292300430230045e-01   -3.157733902270906e-01   +2.277733398996576e-01   +2.070025928153593e-01   +2.685746220347390e-01; +7.017316990357609e-01   +1.454921952405832e-01   +4.566162490621746e-01   +2.328699730577393e-01   +3.829692628179827e-01   +7.838658149248631e-01   +9.393331066155503e-02   +6.127831637199034e-01   +5.582130852062803e-01   +1.712479648937773e-01   +9.170436882905351e-01   +8.807255381559832e-02; +1.315238614299408e-01   +3.152122812833393e-01   +8.081516053935352e-02   +4.106351658649644e-02   +5.524457994059222e-01   -3.886136446282667e-01   -1.037860192425641e-01   -3.342463775411663e-01   +2.551242731478244e-01   -2.983243465806092e-03   +1.571362546784038e-02   +3.002103189330657e-01; -1.713558766887165e-01   +3.529806739778852e-01   -2.236374119148829e-02   +7.263792828410486e-01   +1.225788943159952e-01   +1.250028335255481e-01   +2.016486246208539e-01   +7.823992968592099e-01   +4.382644062110591e-01   +3.350235232309454e-01   +6.129090608565655e-01   -1.676558170997526e-02; +5.759815165239742e-01   +4.012393808156502e-01   +4.341476217171916e-01   -2.037667547768453e-02   +3.813247173008269e-01   -9.870957191369178e-02   +1.851760668253511e-01   +8.775897696086445e-02   +5.075901290318528e-02   +7.838339574079483e-01   +6.298721985323680e-01   +4.548721856872590e-01; +2.502425126407559e-01   +1.875353513254071e-01   +6.047851820153261e-01   +8.694998380393992e-01   +7.040624816185870e-02   +6.018159423453090e-01   -2.260366429281898e-01   +5.058159571136808e-01   +6.307853137603739e-01   +7.274596165100985e-01   +4.742526831208882e-02   +2.303399553850519e-01; +4.400165721986671e-01   +4.977916279311341e-01   +1.000000000000000e+00   +1.657603466659004e-01   +2.132978342296038e-01   +3.045893278163595e-01   +2.250420415654721e-01   +7.375569168715468e-01   -4.092318283720703e-01   +4.842714216687300e-03   +2.139045851493162e-01   +3.746538305201506e-01; -2.368917456661982e-01   +5.569791138347576e-01   +2.308807384268688e-01   +1.190240993667416e-03   +7.045702935582724e-01   +3.817287787287414e-01   +3.433435095746522e-01   +1.193363841864345e-01   -1.428754977501879e-01   +7.030861843601239e-01   +5.222365402859277e-01   +6.122806107211559e-01; +1.725287669782422e-01   +2.353773206446826e-01   +7.965376981827103e-01   +5.864863449498625e-01   +2.145911593050089e-01   +1.025566322670712e-01   -2.121683266844285e-01   +8.157445554141342e-01   +9.288222262573060e-01   -1.486280917538500e-01   +8.182135861209838e-01   +7.195562908811465e-01; -4.730378011471867e-02   +3.173841855543288e-01   +7.146267843331737e-01   -9.858698203012721e-02   -1.974267373155802e-01   +5.502767366670991e-01   +6.735594464913497e-01   -7.478352845853226e-02   +2.676375772292032e-01   +2.706938387581047e-01   -2.439126240108900e-01   -5.723817351465813e-01];
L3E_L3I_iGABA_netcon = [+2.150993476074264e-01   +4.292425522244399e-01   +8.661562604936853e-01   +5.928389337435631e-02   -2.512964531229290e-01   +3.306331494909551e-01   +4.426731602015773e-01   +3.066780777105366e-02   -1.196036145000553e-01   -5.324084018334751e-02   +1.139087499506585e-01   +3.087300914302545e-01; +7.509086670996654e-01   +8.590792533673329e-02   +4.042003577009616e-02   +9.674310379621487e-01   +5.512075736280898e-01   +3.144270287267301e-01   -1.366026209424911e-01   +9.908197947709088e-02   +5.438920475110388e-01   +7.695603406543704e-01   +8.342172892337506e-01   +7.520920806277996e-02; +3.807729723721837e-01   +1.561117711603298e-01   +3.485432167994939e-01   +6.360758386709546e-01   +6.512355552738918e-01   +5.901159383041964e-01   +4.559000340908852e-01   +5.881054313048358e-01   -2.464275511280223e-01   +3.765040632748915e-01   +3.841670125711123e-01   +7.566564912651655e-01; -1.853753124964795e-02   +3.998712429929256e-01   +9.999558225952450e-01   +1.833297485715094e-01   +1.791095839490286e-01   +9.049615752569136e-01   +4.119451443194020e-01   +1.662071005690582e-01   +1.537125501857404e-01   +2.297671212802737e-01   +7.858283441607588e-01   -4.716046564243565e-03; +6.601938688180616e-02   +4.782683568541340e-01   +5.628616792177347e-01   +1.385805157010871e-01   +5.309686296270312e-01   +3.428785766417298e-02   -9.778414142025584e-02   +6.740429054584854e-01   +1.942645161968994e-01   +2.515481183860108e-01   -1.056203409431027e-01   +4.128354181001476e-01; +1.576321375533027e-01   +1.040684802354273e-01   -7.595707384672798e-02   +3.353960442458023e-01   +7.059381708577376e-01   -2.487282812366681e-01   -7.411411334231528e-03   +2.493339653355418e-01   +3.517684684063374e-01   +3.890382621470831e-01   +4.548299866640126e-01   +1.323011325779487e-01; +3.403423045902971e-01   -4.650205428154262e-04   +3.326120841737615e-01   +1.063823464878819e-01   -2.263781016912653e-01   +6.864331429817719e-02   -1.622361744074101e-02   +2.577595278463775e-01   +5.005376407520082e-01   -1.428653564847350e-01   +7.639760304630823e-01   +3.837552446894218e-01; +1.830567002967203e-01   +2.243089470702283e-01   -5.024017955218124e-02   -7.857614413099011e-02   +5.452420241331417e-01   +4.792866889372882e-02   +4.101774666000868e-01   +2.769947231465005e-01   +5.406411490515224e-01   -4.018016574388221e-01   -1.947604433734966e-02   +1.278420418675613e-01; +5.233314888471066e-01   -2.242346690917458e-01   +3.333782287501206e-01   +7.255132284112332e-01   -7.175221098902387e-02   +5.679288059915311e-01   +6.837139597342997e-01   +1.537378752952650e-01   -1.172389079634041e-02   +3.416259307617633e-01   +1.000000000000000e+00   +1.344267427196062e-01; -1.557561450045467e-01   +1.063491352070677e-02   +1.713741371512113e-01   +9.872577246511344e-02   +2.289309349218372e-01   +1.133237487418181e-01   -3.930297657826750e-02   +9.382133770738150e-01   -4.687522835588470e-02   +8.986819907580733e-02   +3.064573663518250e-01   +5.573079233266266e-01; +4.573325687769933e-01   +7.084747546641615e-02   +2.918294219663113e-01   +1.473218170361578e-01   +1.666866187086101e-01   +6.081409417288732e-01   -1.306191036000045e-01   +4.988599355500954e-01   +1.010174237357560e-01   +3.687389049929656e-01   +8.144276431389889e-01   -1.183149662099273e-01; +3.487863822377272e-03   +6.509089069572932e-01   +6.119998180736108e-01   +2.550177829196988e-01   -1.714183159956176e-01   +5.842330869081667e-02   +6.291880258831837e-01   +4.352808779621535e-01   +7.705763489512358e-01   +6.085360315745749e-01   +3.964215539523361e-01   +4.279377865565840e-01];
L2E_Input1_iAMPA_netcon = [+6.114563005337714e-01   +2.070262398802517e-01   +5.931709031930470e-01   +9.824690429751461e-01   +9.039329689123117e-01   +5.941046657692524e-01   +2.759396648664922e-01   +6.381648523281824e-01];
L2I_Input2_iAMPA_netcon = [+8.130725564340731e-01   +2.491578984958705e-01   +8.561529218878967e-01   +1.468911561023737e-01   +5.766501943409368e-01   +5.458411321018471e-01   +6.742198852139200e-01   +8.252729799040316e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
