function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.575035055238392e-01   +7.411252055068343e-01   +8.537820189198170e-01   +2.213172083455938e-01   +2.469521840569512e-01   +6.637944253710841e-01   -8.821725907080430e-02   +3.817308439954306e-01   +2.280917823622129e-01   +1.646680538265078e-01   +3.789415424783006e-01   +1.952422248505491e-01   +4.652780747013780e-01   +2.784137045364558e-01   +2.501292699319198e-01   +3.056231812467475e-02; +7.917412493042289e-02   +8.764675493789497e-01   +7.833462108735620e-01   +7.053593010325585e-01   +2.858703238895642e-01   +6.790667847386488e-01   +6.878524866628528e-01   +1.883848702349234e-01   +1.262619578041530e-01   +7.349953680706807e-01   +5.556632154690367e-01   +5.891599050111163e-01   +3.725147720780678e-01   +2.509705123471193e-01   +5.998845700334108e-01   +2.532717310923353e-01; +2.162183857643424e-01   +2.987252472521899e-01   +4.060925906852513e-01   +4.783540654409044e-01   +5.999754127078594e-01   +4.314840546632371e-01   +1.358111190765768e-02   +6.209350784416917e-01   +3.154248327384776e-01   +5.078335374610782e-01   +7.509334794423780e-01   +2.363288670113690e-01   +3.979736857694059e-01   -2.528734959706897e-02   +3.380152592256778e-01   +8.814470602052795e-01; +2.068332207801215e-01   +5.910071358799982e-01   +8.335561845038607e-02   +2.357140810107362e-01   +7.850596197781907e-01   +7.822229718480885e-01   +2.106428606264623e-01   +5.575204141935881e-01   +6.602899602549235e-01   +2.709662951482324e-02   +1.888441050143463e-01   +7.811592871958225e-01   +4.775114342290110e-01   +1.934411658437425e-01   +5.560459238711145e-01   +4.460049005814676e-01; +7.527474975572929e-02   +6.739679388399662e-01   +7.740231156911166e-01   +7.259035032048609e-01   +4.862269970510019e-01   +3.124840395355005e-01   +4.575164377742572e-01   +3.034865571508997e-01   +3.320283860624987e-01   +4.695824655704041e-01   +1.988570910080768e-01   +6.431583255715629e-01   +3.537804717158365e-01   +7.570941679490746e-01   +2.204784446914361e-01   +8.234195857075559e-01; +1.479471171969246e-01   +1.639677486546867e-01   +6.806729452066319e-01   +7.426885355367552e-01   +5.526480698453544e-01   +8.178334187160619e-01   +2.876997695267617e-01   +4.026162176509566e-01   +7.977235938169368e-01   +8.615389371862709e-01   +8.056604958237058e-01   +1.332124223795099e-01   +4.147800725145656e-01   +1.585036864756538e-01   +8.251214670006727e-01   +3.634473729602518e-01; +3.360794700307733e-01   +6.510160101114206e-01   +5.000625993701253e-02   +3.435099827748350e-01   +7.507758681575447e-01   +5.085263673978381e-01   +4.337182625927086e-01   +5.306790172157143e-01   +8.512540335553099e-01   +8.474534374187834e-01   +6.060035010030115e-01   +1.125779109256349e-01   +3.185817649938008e-01   +3.811734863854399e-01   +6.486568180654551e-01   +8.128277597739414e-01; +6.148644733463553e-01   +6.979924949815800e-01   +7.133388498971230e-01   +3.244999463420316e-01   +5.822173640156245e-01   +5.225546750778355e-01   +9.024721194245092e-02   +4.002979971946726e-01   +1.000000000000000e+00   +7.935457544758789e-01   +1.871877900710981e-02   +6.880718178177674e-01   +7.396700588501127e-01   +5.517885898151108e-01   +2.493421620053488e-01   +7.945405919992380e-01; +4.429788042909614e-01   +2.455109512527879e-02   +2.116429056243258e-01   +5.076681830615028e-02   +4.153064622774438e-01   +1.442863748141058e-01   +3.998677731844427e-02   +5.200679966985675e-01   +4.557818387361827e-01   +7.318247740387290e-01   +7.301010617020750e-01   +4.499302514643796e-01   +2.191619081842777e-01   +2.003777948033922e-01   +8.893351419900538e-01   +7.763945054773784e-01; +6.202760620782077e-01   +4.832650044690732e-01   +5.443963784450189e-01   +2.383281807446999e-01   +4.376279854516273e-01   +2.529879614136399e-01   +2.088142373533811e-02   +2.036283195659603e-01   +7.695626925512541e-02   +7.169221574153217e-01   +2.155575954086658e-02   +8.890146340113174e-02   +3.198950294468252e-01   +7.246015075648553e-01   +3.013343160252561e-01   +6.879997760838950e-01; +3.368383540142521e-01   +4.661385824931991e-02   -2.792703389040952e-02   +1.814085555036088e-01   +8.316425548637570e-01   +5.679920320453621e-01   +2.066263458031755e-01   +1.756273988303790e-01   +1.729502717006645e-01   +8.385871100402102e-01   +1.136664421590238e-01   +6.989555096427712e-01   +5.258152975543713e-01   +7.375549000148203e-01   -2.408678665094909e-02   +6.273512796135547e-02; +1.443539477340885e-01   +1.525443480125350e-02   +8.640665990267880e-01   +4.556709842655880e-01   +6.271486635874023e-01   +4.822776322036064e-01   +6.584299975238471e-01   +3.347806624583468e-01   +6.230851046887640e-01   +9.871010824736939e-02   +2.516439189678193e-01   +7.496064353122217e-01   +2.393086475021276e-02   +5.169701592599861e-01   +3.647598636262718e-01   +5.685453521690371e-02; +3.955876579491772e-01   +3.048230420790962e-01   +6.027164276827843e-01   +2.279608377708834e-01   +6.541553525460275e-02   +4.483582936552999e-01   +3.812777570547937e-01   +6.613215052682835e-01   +2.736276626911306e-01   +8.775349577558983e-01   +1.806166681221527e-01   +4.380558751794169e-01   +2.000449819903170e-01   +2.344905872019730e-01   +2.956090478811191e-01   +1.963901742034461e-01; +1.638362095311263e-01   +8.460662030661299e-01   +6.495265731235033e-01   +6.640084511209540e-01   +7.248246408659796e-01   +5.509135660456557e-01   +2.340947520015097e-01   +7.256233786651013e-01   +3.488069315270428e-01   +4.583151018943036e-01   +7.610306957148187e-01   +6.264536960941525e-01   +4.948262738520133e-01   +4.910422200141168e-01   +7.850457663464418e-02   +3.496956437956135e-01; +1.208550430233120e-01   +1.905325045727091e-01   +8.857834722890048e-02   +3.741401330726987e-01   +3.236284090282330e-01   +1.201261140545382e-02   +6.043269546972437e-01   +2.726759366804739e-01   +7.541462703553189e-01   +4.461028066390473e-01   +9.422705961051323e-02   +7.337747137127147e-01   +5.652914929063446e-01   +1.896636141413958e-01   +6.337998912193634e-01   +1.334936340783933e-01; +5.211809083865560e-01   +1.787679709334007e-01   +3.239524440660424e-01   +5.729955055915003e-01   +5.144160132967299e-01   +5.333250315225843e-01   +1.828615690402206e-01   +5.848985020670827e-02   +5.749547684735030e-01   +4.210767258183113e-01   -5.800012745908810e-02   +3.638014723385766e-01   +1.889714274064590e-01   +8.521831983640168e-01   +8.341728174916463e-01   -3.225704936416930e-02];
L1E_L1I_iGABA_netcon = [-1.525593259491448e-02   +2.448240992132146e-01   +8.756611339578019e-01   +1.664011085719802e-01   +4.100242864305198e-01   +9.333883973950509e-02   +2.683730488176638e-01   +5.151986654533575e-02   +1.870636217381773e-01   +8.400182531525077e-02   +4.107770530655038e-01   +9.088037098952971e-01   +1.887093903995998e-01   +7.715827335095674e-01   +8.296948845118579e-02   +3.772140991711843e-01; +7.654203160234312e-01   +7.359434076900612e-01   +5.189115666541309e-01   +7.974669363732056e-01   +6.809482569867270e-01   +7.851453810895617e-01   +5.837437971973466e-01   +7.829548811642904e-01   +8.659291826371885e-01   +9.208499514968865e-01   +1.784718455649086e-01   +1.130323043847193e-01   +5.893877479573700e-01   +8.692886317836458e-01   +1.000000000000000e+00   +2.551998352849388e-01; +2.556853156836587e-01   +8.168270500998021e-01   +1.240938789882590e-01   +1.091477203933431e-01   +1.268185389255284e-01   +2.601095974175462e-01   +5.692230362659174e-01   +1.944081249845210e-02   +2.379827321875984e-02   +9.478690623576251e-02   +5.146710506821423e-01   +4.185101566121992e-01   +7.338902901871053e-01   +7.741394788417904e-01   +7.668195019869760e-01   +7.458793679074158e-01; +3.691729933374358e-01   +5.248114363993071e-01   +5.908381706381427e-01   +7.029054029501133e-01   +6.691815040479440e-01   +5.830157498725966e-01   +5.547039797738254e-01   +8.505900686661410e-01   +9.153455994318078e-02   +2.913161640464096e-01   +5.000239495895876e-01   +2.918823699292348e-01   +8.022514824664488e-01   +4.145909868042285e-01   +8.772423678738595e-01   +5.139647465199858e-01; +6.720643428156197e-01   +5.791817861274104e-01   +8.414084814083109e-01   +3.367350441981807e-01   +8.822463260233724e-01   +5.177629055335242e-01   +3.696012000919249e-01   +4.377114009206421e-01   +3.080723702741096e-01   +4.046842303174855e-02   +4.654237829718700e-02   +5.433575027852283e-01   +8.989850088895036e-01   +7.982081063563653e-01   +4.270644704904069e-02   +1.437031636255622e-01; +2.227667212076011e-01   +2.915645242015890e-02   +3.065806280587984e-01   +2.084014519602427e-01   +6.154449138948745e-02   +4.773805575679432e-01   +8.350768340732277e-01   +2.911871861609153e-01   +5.278323762519108e-01   +4.285440189950091e-01   +8.498130590652200e-01   +1.582487010232131e-01   +2.106455775614400e-01   +2.268798663115353e-01   +7.083259432675241e-01   +3.176811251286818e-01; +6.754930920599651e-01   +5.416138144381542e-01   +2.793485542677288e-01   +7.866967619767944e-01   +2.983512347735591e-01   +8.362340767283826e-01   +6.118472937982857e-01   +5.099415022543671e-01   +7.953164930514313e-01   +5.735051540985948e-01   +8.123527645436218e-01   +2.134068444409632e-01   +8.265259041627342e-01   +5.562993326570337e-01   +9.514079289446873e-01   +7.451277638626869e-01; +9.097610642280695e-01   +1.231690170916248e-01   +6.241780251729427e-01   +4.751980258737661e-01   +6.686121966444304e-01   +1.801978910354465e-01   +3.667502217017555e-01   +5.598231020596224e-01   +2.010774929680058e-01   +8.058094910264785e-01   +7.290494036579002e-01   +8.280176111254540e-01   +2.719526713740830e-01   +6.505453261775717e-01   +4.741595499952634e-01   +5.484253475580354e-01; +5.455267637261469e-01   +9.385613375915220e-01   +3.707338289276281e-01   +9.056232300934054e-01   +2.453379651120457e-01   +6.563456746064034e-01   +5.513982093340547e-01   +8.880256439989040e-01   +8.600525240864960e-01   +1.158889194534152e-01   +1.788121089639155e-01   +1.846764406811784e-01   +8.600360852435694e-01   +3.374890405841260e-02   +5.667042991574948e-02   +4.766343448740186e-01; +2.050018507133018e-01   +3.338823767782367e-01   +5.072831423381449e-01   +2.073883774231535e-01   +8.827829775406966e-01   +3.817459225942520e-01   +3.001380921804018e-01   +8.825076142521819e-01   +8.822089911900558e-01   +8.417085901892633e-01   +8.034806209890776e-01   +9.409419353804379e-01   +4.670897088628753e-01   +3.695762553318460e-01   +3.043050167677134e-01   +7.667077751558858e-01; +1.571986788768282e-01   +2.090642581317485e-01   +7.597520976146397e-01   +8.399794591662990e-01   +1.703500353445716e-01   +5.896382376840685e-01   +6.840917515573933e-02   +4.596186280962251e-01   +4.141543073352171e-01   +6.154035225206023e-01   +3.341794304729206e-01   +8.857544823810027e-01   +1.049370161120826e-01   +4.537056880192576e-01   +4.341211672270729e-01   +4.141117728250909e-01; +1.659643597853765e-01   +8.968457752888694e-01   +6.952581738924251e-01   +5.057997210389901e-01   +4.513077995128506e-01   +7.257679330990970e-02   +2.008235813584726e-01   +3.543246060177569e-01   +1.632216036579105e-01   +4.986284035082042e-01   +1.841385186529664e-01   +3.842479115114203e-01   +3.615585483770917e-01   +8.796193694092592e-01   +3.786972901969408e-02   +4.550931957345710e-01; +8.741832824912217e-01   +1.705432332377481e-01   +4.725010468834724e-01   +4.833497721807932e-01   +5.958861543086584e-01   +5.666440668127953e-01   +2.109143100159346e-01   +4.547992633968948e-01   +4.268398105387964e-01   +3.560521009140929e-01   +9.216988604083348e-01   +9.541499082228959e-01   +7.992875912138426e-01   +5.633364775413523e-01   +2.560260785280496e-01   +7.355140499441469e-01; +4.399881451953212e-01   +8.125913534532193e-01   +3.424812606876891e-01   +4.091514033641311e-01   +7.123195177660384e-01   +1.818549789196831e-01   +2.845218894146612e-01   +5.692722010849303e-01   +3.462693801529663e-01   +4.547525575440129e-01   +1.991224971138900e-01   +1.702522771078784e-01   +2.572979128294513e-01   +2.536458723061259e-01   +5.384190226284817e-01   +8.745585439511808e-01; +5.603996762864057e-01   +5.756830455708111e-01   +7.124645363074220e-01   +6.522003921370343e-01   +6.863126356310296e-01   +9.273005240161523e-02   +8.025814178623185e-01   +2.354521179830840e-01   +8.496273678159817e-01   +4.879076915505833e-01   +7.281671472691027e-01   +5.269589854880623e-01   +2.935277859149533e-01   +4.692701283871081e-01   +8.540292731914046e-01   +4.321889089120054e-01; +3.682782537530231e-01   +5.716861421272802e-01   +5.992593561457715e-01   +2.424684048227469e-01   +4.529679330804138e-01   +2.801146987162618e-01   +5.069274180048055e-01   +2.179710320805615e-01   +8.198552123710763e-01   +2.724310554222630e-01   +2.845657133019182e-01   +1.359572056341134e-01   +5.824269368095987e-02   +4.371889565191781e-01   +9.298488178387246e-01   +9.106588923595595e-01];
L2I_L1I_iGABA_netcon = [+6.471191176327589e-01   +4.444606662491592e-01   +7.077218203322294e-01   +5.659411299306498e-01   +9.372699072755142e-01   +6.617733012785011e-01   +9.404774985045385e-01   +1.129722464149740e-01; +4.558961964382639e-01   +1.510564534287205e-01   +2.140398360889785e-01   +9.469128838087896e-01   +2.046394348960860e-01   +7.458311633002833e-02   +8.116917317019285e-01   +6.578354568487951e-01; +9.972651443640779e-01   +5.295215654423978e-01   +6.542132076946469e-01   +6.833419777918263e-01   +7.432391533090937e-01   +6.292774821996420e-01   +2.901552861961295e-01   +2.422053803050317e-01; +3.698747454798147e-01   +1.927275846069865e-01   +8.779390764491016e-01   +4.162961569129148e-01   +7.575747195896743e-01   +3.441235266323238e-01   +9.301810806368207e-01   +1.614698788897961e-01; +7.107246330415944e-01   +4.930138989218869e-01   +6.358467676878337e-01   +2.424071810599232e-01   +9.175973680144706e-01   +3.713472287449632e-01   +5.359434182556428e-01   +2.266457011202521e-01; +6.216772683858012e-01   +5.586007832485954e-01   +7.314137248631354e-01   +1.535030702100492e-01   +2.219291131448068e-01   +7.949099762656120e-01   +8.596674177603906e-01   +5.262535709272379e-01; +8.073925734416528e-01   +4.955614948678407e-01   +2.378014345872481e-01   +2.863641529502048e-01   +7.181024161423200e-01   +1.465470764863026e-01   +6.614035879940569e-01   +3.370071649194430e-01; +9.793750962008401e-01   +4.203718152911694e-01   +6.192804457890804e-01   +8.551558105808066e-01   +1.044245133202006e-01   +4.326754473642906e-01   +4.501264820070964e-01   +2.491963758456741e-01; +7.595646790963048e-01   +1.674650761966111e-01   +4.675973063821972e-01   +4.496361062926274e-02   +7.261493558457943e-01   +3.592611792411463e-01   +7.261022249846892e-01   +6.948361797140513e-01; +4.441714241196453e-01   +8.032796797776908e-01   +5.947493201278679e-01   +8.036342824238372e-01   +3.532903213679985e-01   +8.051845626448668e-01   +8.513304254368285e-01   +2.617001233878514e-01; +5.640729953261452e-01   +5.781131891464012e-01   +5.204433187315382e-01   +3.615746818639108e-01   +7.552055736510319e-02   +8.624101200358830e-01   +6.025567301050013e-01   +4.480579159356855e-01; +4.072935207195848e-02   +3.876819785934825e-01   +4.193602285648020e-01   +4.137502109525384e-01   +3.755176211989784e-01   +4.775783729813237e-01   +2.896645366663362e-01   +5.439366600407053e-01; +3.982026679186250e-01   +1.702894801823845e-01   +6.503542958275701e-01   +7.476113640212023e-01   +2.111474353659363e-01   +6.796786449078006e-01   +3.403917092270404e-01   +7.083423098927519e-01; +4.993484419214034e-01   +4.675467662284463e-01   +6.619858492812345e-01   +3.713828298735288e-01   +8.066753380819858e-01   +3.837731216403050e-01   +3.551493933118737e-01   +2.939549353250284e-01; +5.471458131431917e-01   +1.604277423820740e-01   +2.210515805487816e-01   +2.029003513129274e-01   +6.388571074978640e-01   +5.315851238782959e-01   +2.379877905981325e-01   +7.391149272668139e-01; +7.475844987022576e-01   +5.222590040464449e-02   +6.788796059043126e-01   +3.577556101301851e-01   +3.511740721396780e-01   +5.554669507826379e-01   +1.520449367441140e-01   +3.354973458410499e-01];
L1I_L2I_iGABA_netcon = [+4.800154375715202e-01   +1.720826473860771e-01   +8.420257089524166e-01   +3.093387951606593e-01   +5.286904882621070e-01   +2.867172433672040e-01   +8.613257649629557e-01   +2.504218505247581e-01   +5.013903485955302e-01   +7.969117749428636e-01   +3.900849456040857e-01   +3.602029955487873e-01   -8.721158158615756e-02   +6.851573528016122e-01   +5.990155341945413e-01   +4.860012856544376e-01; +4.521515886307521e-02   -1.543124536798831e-02   +2.983590066867460e-01   +2.626396481100828e-01   +8.606407565187915e-01   +4.177379263742181e-01   +3.238422288089332e-01   +1.518243633964215e-01   +4.818080748537465e-01   +1.930395242953351e-01   +2.993213068101676e-01   +2.496495232443987e-01   +9.675667049479448e-01   +2.216112056202725e-01   +7.727306964878504e-01   +2.407069452199515e-01; +3.570366460608030e-01   +6.335372039058634e-01   +3.138410222404064e-01   +6.509088506844507e-01   +2.392595705230776e-01   +5.607705021487301e-01   +7.387313913133221e-01   +1.032315761470973e-01   +7.474258478048709e-01   +4.726151508628269e-01   +5.989335707465885e-01   +8.898100496222144e-01   +9.650343955896418e-01   +6.669059603403633e-01   +3.958434790732788e-01   +1.859456129308751e-01; +8.251916609226223e-01   +5.615085156410685e-02   +6.415316478792569e-01   +9.245790082646174e-01   +4.545308155753859e-01   +8.586088807948220e-01   +6.649428718856512e-01   -1.092194786208352e-02   +2.388824322414754e-02   +3.074918014032554e-01   +3.959103499836443e-01   +4.213636719566249e-01   +3.133372100331150e-01   +5.024717654576722e-01   +1.660272040755923e-01   +3.950591883863680e-02; +9.074616862254059e-01   +7.906968602805727e-01   +7.517033252503597e-01   +5.851993519789839e-01   +2.738089398327734e-01   +6.412970007819460e-01   +6.623838464491086e-01   +6.117430849038916e-01   +8.969747974780505e-02   +6.927825329379775e-01   +2.082366299698383e-01   +4.686672728907945e-01   +5.817992405515753e-02   +2.244925392353230e-01   +6.642969648426542e-01   +9.258725271331846e-01; +5.513447861142876e-01   +4.426077085234244e-01   +1.074437878046987e-01   +3.301089384034859e-01   +8.957689513680316e-01   +1.579497878874768e-01   +7.053089230879577e-01   +6.058947484254125e-01   +4.907991145731529e-01   +7.430314341730199e-01   +2.687370617759296e-01   +5.201734779121728e-01   +9.075559562847775e-01   +9.276455916028710e-02   +2.274546952027591e-01   +2.846525759666167e-02; +8.577591701452508e-01   +1.350493354929655e-01   +3.900548892739074e-01   +3.146355136821061e-01   +5.388895176849363e-01   +8.391529704226545e-01   +4.864463461467450e-02   +2.874417128002830e-01   +7.424815119749920e-01   +9.482138901741870e-01   +8.725141587157967e-01   +8.215634688524113e-01   +1.320830211883684e-01   +2.451026882147025e-01   +3.180452458881349e-02   +5.827331963347194e-01; +9.096812008282806e-01   +3.867227334622308e-01   +2.043011415667718e-02   +8.818411926599765e-01   +1.792084020363441e-01   +9.487748536638541e-01   +7.729216585479685e-01   +6.600552324058671e-02   +7.873545926847778e-01   +3.459095487394105e-02   +8.657770146223924e-01   -1.440067257831739e-02   +8.122784278872407e-01   +7.581869818489821e-02   +9.475366592429398e-01   +6.746835198579220e-01];
L2E_L1E_iAMPA_netcon = [+3.230757082993667e-01   +9.239840425786329e-01   +6.342915560547632e-01   +4.002554151227864e-02   +3.145200614418615e-01   +3.528961656613632e-01   +5.563035217432045e-02   +5.871490530843602e-01; +1.918819281410905e-01   +1.235672822863936e-01   +7.538868000107588e-01   +8.580467931307838e-01   +3.820691423581448e-01   +5.313305434365837e-01   +2.375277232951785e-01   +1.188496913004455e-01; +4.864512377648942e-01   +8.998442083406051e-01   +7.721391826657813e-01   +4.277381522040383e-02   +6.802468992449350e-01   +2.424459725195414e-02   +4.383427924349509e-01   +8.479082310392869e-01; +4.539054443377776e-01   +6.682452060327155e-01   +5.818237685446589e-02   +5.467658054476593e-01   +2.498896948695843e-01   +5.695411269710293e-01   +1.625402757066340e-01   +4.854329076633653e-01; +8.353481544870622e-01   +7.074040236056411e-01   +7.841894354072503e-01   +5.177245336026830e-01   +7.475084708020667e-01   +4.027769026956356e-01   +4.105641281086085e-01   +5.192493459876772e-01; +5.008440582415843e-01   +6.405366470812554e-01   +2.936720767751331e-02   +6.328693221409527e-01   +6.618878079099365e-01   +8.257871703897250e-01   +2.897317044983143e-01   +8.110380182927029e-02; +4.380337487684436e-01   +3.079033977159025e-01   +2.732845769638820e-01   +3.687571668947341e-01   +4.104531000182966e-01   +2.460024735251158e-01   +5.832629369868075e-01   +2.682971262045991e-01; +7.118632205799923e-01   +1.942680534522736e-01   -7.704400488604521e-02   +9.815804722460508e-01   +5.143742889344570e-01   +3.719686317023173e-01   +6.055930064875455e-01   +6.149184701692934e-01; +7.788841278260915e-01   +5.744208837878535e-01   +6.505385720133193e-01   +1.285722263501967e-01   +3.795079008162116e-01   +2.709636016574867e-01   +8.163845232781596e-02   +9.831241688496503e-01; -5.882925975677373e-03   +1.570815840853495e-01   +1.794808199410809e-01   +1.750769713803712e-01   +1.358745799477805e-01   +5.548677834293537e-01   +8.186532848787774e-01   +8.462465961404507e-01; -1.460202884620980e-02   +2.298994874394472e-01   +5.381034174899120e-01   +3.957054585247465e-01   +1.623942359315442e-01   +4.377319318726707e-01   +2.083827818923635e-01   +7.279841578312257e-01; +3.250434692729879e-01   +5.788995692837735e-01   +6.143809081018718e-01   +4.619984542523423e-01   +6.726941735347182e-01   +2.734023956854875e-01   +6.967552816999721e-01   +4.875102247027283e-01; +6.696053332439318e-01   +7.042865996115434e-01   +5.809729082968412e-01   +2.049689161871140e-01   +1.970612598338085e-01   +1.178903520062263e-01   +5.866729841204277e-02   +5.254080993333123e-01; +7.085983862730857e-01   +8.173355681734962e-01   +5.409951892325682e-02   +9.203452157086638e-01   +5.231016205053615e-01   +7.794702667259017e-01   +1.245104415737202e-03   +1.601799114466075e-01; +9.544683086813450e-01   +2.011368705901511e-01   +4.951754425349733e-01   +5.841736641976375e-01   +3.001476471390186e-01   +2.159928196687910e-01   +6.411196450862986e-01   +4.282314317095999e-01; +7.938485288045614e-01   +6.043127452478334e-01   +7.115892825733078e-01   +3.873038296103872e-01   +4.633511168366930e-01   +8.255522163303249e-01   +7.248348038728339e-01   +1.586472435244561e-01];
L1E_L2E_iAMPA_netcon = [+8.108533387523088e-01   +4.512159065533284e-01   +5.990293429221292e-01   +1.844014685970607e-01   +9.548038607138346e-01   +2.454949606254085e-01   +5.036331080734009e-01   +4.772452859019650e-01   +9.595143431720892e-01   +5.280285742410064e-01   +6.128764616790056e-01   +4.790050003393218e-01   +5.391174540215827e-01   +3.413210647815597e-01   +5.871286020884970e-01   +3.043330218281800e-01; +7.922465690587497e-01   +1.661019509180908e-01   +1.491305898839437e-01   +5.276202198932437e-01   +7.802014822480347e-01   +5.708788820585030e-01   +8.948382188403086e-01   +2.708134158077624e-01   +3.757741822958596e-01   +3.171816843935332e-01   +6.368277955903658e-01   +6.574659523408362e-01   +6.510971244130883e-01   +8.593041760722291e-01   +3.424548424446316e-01   +5.559606950659959e-01; +7.769660784147365e-01   +1.401756419586204e-01   +1.513982611688596e-01   +9.755688554860317e-01   +2.189959465657508e-01   +3.555079664650402e-01   +8.513268273524063e-01   +3.262364907619259e-01   +2.110335754417657e-01   +6.223377197928980e-01   +7.691752554115088e-01   +4.825783186801038e-01   +7.963385088060264e-01   +9.558310805363796e-01   +8.281198499823366e-01   +6.493840142789142e-01; +6.614312058338842e-01   +7.645909142705733e-02   +5.661708819694308e-01   +3.369277783951358e-01   +3.917887600706494e-01   +7.833179330188066e-01   +1.882037231200332e-01   +1.540825588472521e-01   +5.892246578259303e-01   +5.046987921477879e-01   +4.114625088771037e-01   +9.370907824812306e-01   +7.417727711991935e-01   +3.401093666186407e-04   +7.792288048305025e-01   +8.229087972593292e-01; -9.369405111553186e-03   +2.264413065481011e-01   +1.307682979180800e-01   +7.618457618945226e-01   +1.592030880595670e-01   +4.342104986375879e-01   +9.395054099652895e-01   +3.308179107237405e-01   +1.362573645999118e-01   +7.539651995816364e-01   +1.134280891196227e-01   +5.438901666136982e-01   +5.217494617210177e-02   +6.563205582880177e-01   +4.362465432506192e-01   +1.359226037788572e-01; +6.417550476332817e-01   +3.941034744448819e-01   +4.091989758126852e-01   -1.406645964730638e-01   +8.948883907412581e-01   +1.288361821955006e-01   +4.864654468847782e-01   +1.688408289355516e-01   +7.653007750996953e-01   +5.475140860017689e-03   +7.639461132165413e-01   -1.697033845965640e-02   +7.325826068780522e-01   +5.232364966284764e-01   +6.890558532642628e-01   +3.302928906149863e-01; +2.680052591162608e-01   +7.305518088957094e-01   +3.181790921871838e-01   +3.992069468558975e-01   +2.792171720907629e-01   +8.814544957270909e-01   +9.449336945216883e-01   +4.424803267749558e-01   +6.822823961807177e-01   +7.454420444219245e-01   +1.169767996386977e-01   +1.082033833364146e-01   +9.089526248907719e-02   +3.281456880641266e-01   +2.887489541629184e-01   +7.666331349304011e-01; +1.442090433055742e-01   +4.287789003720183e-01   +2.736397618929240e-01   +4.737108097224037e-01   +9.694160983934210e-01   +4.877985433020334e-01   +9.287283023770893e-01   +8.271135365618347e-01   +4.074045806384523e-01   +5.319966660971871e-02   +4.004169703971484e-01   +4.075655392313281e-01   +3.200414354298271e-01   +7.019524353785083e-01   +4.285166402783667e-02   +5.490105221843079e-01];
L2I_L2E_iAMPA_netcon = [+3.303939650689859e-01   +2.934010612997174e-01   +3.522789298988964e-01   +5.618693841360768e-01   +1.662151215666643e-01   +8.069040997007079e-01   +6.872166361898293e-01   +2.201028665004899e-01; +4.552595206073876e-01   +1.490091593843644e-01   +6.606618818351443e-01   +2.558563397545476e-01   +6.748956790081286e-01   +8.378631050752375e-01   +1.115203445795835e-01   +5.061839291646432e-01; +6.605420561330738e-01   -4.005008065860089e-02   +7.290153591106932e-01   +5.751530349291859e-01   +1.480359501551489e-01   +6.169273642819715e-01   +7.695378640169553e-01   +1.641250734544827e-01; +5.152632532901983e-01   +2.333069224417949e-01   +3.044133103407693e-02   +9.452378024140516e-01   +3.782326620411458e-01   +6.432723166105841e-01   +9.305890393913501e-01   +1.963149502403444e-01; +1.289385695222734e-01   +4.230795401127503e-01   +4.879861493613410e-01   +8.302811672750321e-01   +8.600362827910139e-01   +5.466398319911195e-01   +6.846897254586568e-01   +2.498132791129224e-01; +8.509618924996228e-01   +4.893128550924897e-01   +9.105779137581090e-01   +8.932704929431073e-01   +6.817191998469168e-01   +8.204662298415327e-01   +8.448010261111726e-01   +4.959673537463034e-01; +7.861476913954854e-02   +5.418211144953312e-01   +8.874739812221498e-01   +8.084789002733579e-01   +6.765420123099972e-02   +6.766347959802235e-01   +2.322914900741495e-01   +1.323992709125486e-01; +5.618950237949778e-01   +3.940939321277725e-01   +1.615098648766510e-01   +3.233528717773195e-01   +6.553769643044606e-01   +4.153936459955148e-01   +1.000000000000000e+00   +6.785778683341440e-01];
L2E_L2I_iGABA_netcon = [+4.790796393970120e-01   +6.070714538045010e-01   +5.861860213463376e-01   +3.749716437318865e-02   +4.402313800825013e-01   +5.046565927914546e-01   +2.741268322642739e-01   +7.115600428269346e-01; +4.795539107406361e-01   +3.386838242695127e-01   +7.244161556660592e-02   +4.693485237964503e-01   +4.077666012084584e-01   +6.507152012321723e-01   +5.044963748981309e-01   +4.041414119539783e-01; +5.704171427242117e-01   +5.686147305889068e-01   +4.394223350844830e-01   +6.208164757542497e-01   +3.045826094417194e-01   +2.919735094118306e-01   +1.713535430587197e-01   +9.152381633948301e-01; +7.038352879043552e-01   +5.588040494140315e-01   +3.868288096169498e-01   +8.509954255486140e-01   +2.374882504584399e-01   +7.833875447408570e-02   +1.848356188647238e-01   +4.140309684581533e-01; +4.918841915209065e-01   +7.802681507862055e-01   +4.600759230608649e-01   +7.502656125690478e-01   +4.057723029626591e-01   +7.334451252455804e-01   +5.960156806815629e-01   +3.853394877958838e-01; +3.913388949422371e-01   +2.503028958904330e-01   +4.101821024090417e-01   +3.857507672319718e-01   +7.877005139568930e-01   +8.102008262716940e-01   -7.737500796307634e-03   +4.254709865427377e-01; +5.507884457412019e-02   +4.325293518673730e-01   +8.149793969166516e-01   +5.425375210849072e-01   +5.205418064410517e-01   +4.251855431457739e-01   +8.981405479146115e-01   -3.778537766521843e-02; +9.117942226824675e-01   +5.618857207613360e-01   +8.587727549183768e-01   +4.607275547691733e-01   +8.817736620097312e-01   +4.981315087829283e-01   +3.119066696215820e-01   +3.416002926065294e-01];
L3E_L2E_iAMPA_netcon = [+2.465099699157877e-01   +9.082731172171792e-01   +4.577622157511065e-01   +7.302752027733393e-01   +1.778346355997558e-01   +3.919718258515990e-01   +3.364402847163016e-01   +9.116004026043464e-02   +1.273174578225333e-01   +5.112406008176273e-01   +1.695518601677427e-01   +4.677863878317864e-01; +2.736194334601899e-01   +4.520538670941106e-01   +1.822875287253546e-01   +2.212938480241026e-01   +5.360186816952875e-01   +9.529527698958160e-01   +7.265698673176968e-01   +5.606784808474109e-01   +2.202843112886726e-01   +7.134327208882242e-02   +4.989958371460325e-04   +9.758882503515720e-02; +7.837546177976046e-01   +3.715531297420591e-01   +5.518219916626951e-01   +1.505690405229299e-01   +8.064166465232874e-01   +9.149821118141090e-01   +5.294910307838454e-01   +6.177243849451198e-01   +7.235397540771606e-01   +2.973686418917489e-01   +3.878188728856247e-01   +8.837493627272087e-01; +1.351660710188846e-01   +4.494557244839443e-01   +2.184282809576566e-01   +7.830995753031187e-01   +4.602736789602827e-01   +5.393122681831475e-01   +8.590696166401010e-01   +3.130703911195276e-01   +8.330445922777773e-01   +7.928042902976314e-01   +4.330824884019948e-01   +1.630893196616026e-01; +1.781024408052793e-01   +7.472194372362264e-01   +4.536946551009715e-01   -2.268380630040365e-04   +1.644457454794082e-01   +9.118106296506289e-01   -1.939773047312273e-02   +6.775929034914211e-01   +1.000596647152959e-01   +8.360113728593191e-01   +2.471383997187492e-01   +2.007712933488211e-01; +3.396591198678340e-01   +3.905975229752444e-01   +8.202004492965428e-01   +9.760550338805223e-01   +3.589128575095232e-01   +8.718027606857786e-01   +5.338881060576003e-02   +3.588103744612336e-01   +5.004241003526966e-01   +7.907451940774627e-01   +5.679887819798620e-01   +8.188847545349073e-01; +2.420884761758727e-01   +4.826705682803273e-01   +5.433870030350582e-01   +1.199579963533830e-01   +6.491392759981316e-01   +4.711986937440795e-01   +7.228100113773330e-01   +1.200887153515911e-01   +4.037808834589283e-01   +3.939528970820950e-01   +9.799261910285522e-01   +7.395458461630270e-01; +5.408015541971393e-01   -3.471331649144693e-02   +3.440519989496471e-01   +1.283138064596065e-01   +1.690371119940314e-02   +8.738065917777647e-01   +3.845228882182516e-01   +4.855487566555108e-01   +8.523531985743731e-01   +9.629808401857261e-01   +8.793392699172561e-01   +2.702267616084878e-01];
L3I_L2I_iGABA_netcon = [-4.582126531854747e-03   +3.107106026594489e-02   +1.141193642300830e-01   +6.040154264732778e-01   +3.121076899445921e-02   +4.775978369059784e-01   +7.603753658072839e-01   +4.032517393633195e-01   +3.903389545984763e-01   +8.639931923825521e-01   +8.297000733863683e-01   +6.403144740159794e-01; +4.292680288499110e-01   +4.239340671379739e-01   +2.691544939112677e-01   -7.419872961835608e-02   +4.747289554624168e-01   +6.439661723538176e-01   +4.698292242943234e-01   +9.098631307255871e-01   +1.441834921417560e-01   +9.061225588641849e-01   +2.542885244055255e-01   +6.148360738674461e-01; +3.581033704122751e-01   +6.599301715749140e-01   +2.956710995253376e-01   +7.899915291160038e-01   +3.223166096324732e-01   +8.255465624357716e-01   +9.033866186857830e-01   +5.654416290388459e-02   +6.414469509390464e-01   +4.289077268677517e-01   +1.235296872762629e-01   +5.754361375158794e-01; +5.947864833412471e-01   +9.758366261350565e-01   +3.054976885605088e-01   +2.124256258851235e-01   +1.632176077759403e-01   +5.741209938586326e-01   +2.037292165058867e-01   +2.582794401561052e-01   +3.198151643022756e-02   +3.329162707658356e-01   +5.417390242369530e-01   +7.792212601827473e-01; +9.597938224727806e-01   +1.264050513406816e-01   +4.458936087010226e-01   +8.500563530438379e-01   +4.527771726971869e-01   +8.777935892921628e-01   +1.015682184594973e-01   +5.149265526584405e-01   +5.684817851190666e-01   +7.489973646607736e-01   +7.156573857614352e-01   +4.963039445320966e-01; +8.788332370012968e-01   +2.126060591688290e-01   +1.737360530505521e-01   +7.096279275436922e-01   +8.702205784287842e-01   +7.700399197312856e-01   +9.517189433588390e-01   +5.812395241632277e-01   +9.812358349797090e-02   +8.135697164129578e-01   +3.363377502663202e-01   +5.698348906572608e-01; +1.099413364576146e-01   +4.713788631895998e-01   +9.049393729817496e-01   +5.997885020176359e-01   +1.000000000000000e+00   +7.353889722412044e-01   +8.485482102110851e-01   +7.127244356788643e-01   +5.591857463607559e-01   +3.849567454718137e-01   +3.579527182785877e-01   +5.225341285133648e-01; +4.165222420452154e-01   +3.034705711178094e-02   +7.237476027662161e-01   +1.768882203017870e-01   +4.002581600919059e-01   -3.068514143931124e-02   -3.692963534878462e-02   +9.202227720556602e-01   +4.684708757924694e-01   +1.142404415484987e-01   +7.316186253562894e-01   +2.326714011919965e-02];
L2E_L3E_iAMPA_netcon = [+9.699765570025730e-01   +2.360398788655644e-01   +5.229518298200843e-01   +7.444168149505479e-01   -4.315956734702719e-02   +6.797753695856945e-01   +8.277103311968943e-01   +1.142287094496219e-01; +3.770662443217671e-01   +5.006873111055559e-01   +7.040325037378640e-01   +6.502027154032521e-01   +3.068242170686355e-01   +1.756207782762155e-01   +8.529599032355611e-01   +9.715613220840891e-02; +6.377191851350188e-01   +5.441558495849462e-01   +8.697545798307885e-01   +5.793869100734748e-01   +9.576481347769075e-01   +4.983029672570473e-01   +9.666368688230083e-01   +4.285300194586194e-01; +2.264427684511505e-01   +9.333536262382156e-01   +8.951753418959500e-01   +4.419293465564966e-01   +3.572805432996492e-01   +9.618260356834081e-01   +2.530791226186271e-01   +4.746671215110533e-01; +3.303343590352387e-02   +2.023558626176116e-01   +7.286407221643708e-01   -3.243714896996262e-02   +2.387288846094251e-01   +5.448179671650425e-01   +4.658016960056508e-01   +6.298391573937714e-01; +3.839945927314101e-01   +8.086799307579254e-01   +1.994113584326678e-01   +7.729068105296268e-01   +7.005719988287962e-02   -4.758741085346418e-02   +5.368623572717074e-01   +2.142827554461889e-01; +4.565137279394064e-01   +7.482469267419377e-01   +7.642811001035860e-01   +2.366209042280355e-01   +7.734098506911293e-01   +1.836608588769082e-01   +6.794179638143188e-01   +9.391961817178784e-01; +5.454913474028723e-04   +5.300025090000664e-01   +8.946052288576879e-01   +4.551267501934927e-01   +9.835719548885492e-02   +7.505411729866635e-01   +1.051606788950592e-01   +3.537532576487279e-01; +9.977025752401969e-01   +9.188212966244351e-01   +1.223476010340179e-01   +1.245678995764958e-01   +6.660350548051397e-02   +9.284221947612248e-01   +2.755353231045670e-01   +9.091003443170351e-01; +1.438466958471060e-01   +4.217326157846609e-01   +8.450418565696283e-01   +2.940446038484701e-01   +4.132169479095473e-01   +8.839034614600204e-01   +7.375186574019893e-02   +8.940146231863600e-01; +6.676958514634509e-01   +3.358577281406359e-01   +2.769274524783468e-01   +2.731606632987492e-01   +1.691963319082423e-01   +3.530387206848378e-01   +1.750768932926739e-01   +1.513648727858053e-01; +1.577647063913025e-01   +6.512003610518911e-01   +8.546192702321327e-01   +4.317082159951458e-01   -2.923846742718350e-02   +7.177223061157851e-01   +7.919281750072364e-01   +7.451023089110558e-01];
L2I_L3I_iGABA_netcon = [+3.486865786881195e-01   +6.742007781428746e-01   +2.835577676358864e-01   +6.240060492777417e-01   +5.201066050625133e-01   +3.856967960315631e-01   +4.113403485588061e-01   +4.476004499205438e-01; +3.137102483403486e-01   +6.470522971030157e-02   -6.393212843421268e-03   +7.976125380419404e-01   +6.861975745287511e-01   +7.586154081976920e-03   +9.442216122062658e-02   +6.261527503675941e-01; +3.402824656746471e-01   +6.105144801002679e-01   +3.824576048885763e-01   +8.036439348401392e-02   +8.056953498291729e-01   +6.663829377484870e-01   +2.367277781800877e-01   +1.311194939823222e-01; +5.759308942409345e-01   +8.610050734721322e-01   +5.542675877395027e-01   +4.777636858225821e-01   +5.514015956382530e-01   +6.596370488972353e-01   +3.762777433734725e-01   +6.566242782186864e-01; +4.845326011377707e-02   -9.365584652539533e-03   +3.279656461575726e-02   +7.165308970468307e-01   +2.458339506137639e-01   +5.984488603310634e-01   +4.490210621770760e-01   +2.945309045898167e-01; +5.477417951422215e-01   +4.066997298812181e-01   +4.122938533720215e-01   +7.276706147676033e-01   +2.360717553966852e-01   +7.785128189225223e-01   +4.683357921377527e-01   +9.597433451385233e-02; +2.217673558696282e-01   -9.994145974437632e-03   +4.102924515055026e-01   +9.873649940724870e-01   +7.058664697657230e-01   +5.511034265757688e-02   +2.538513204941041e-01   +8.426031515791610e-01; +2.134683905941076e-01   +8.869419204720307e-01   +8.978475873004036e-01   +8.644855045560846e-01   +5.137563840789290e-01   +1.356552574890272e-01   +6.422939562367586e-01   +1.266902639373265e-01; +2.965912719660574e-01   +5.109092033311491e-01   +2.152881988565682e-01   +1.584775313301006e-01   +3.971283916683307e-01   +3.064819366885763e-01   +6.107244442728178e-01   +4.866352361226973e-01; +4.459668647789680e-01   +1.737931038898825e-01   +2.104678771745531e-01   +4.075671839541792e-01   +9.691833498930762e-01   +5.044885459895461e-01   +4.568049798950434e-01   +9.550162858659611e-01; +5.845952799948811e-01   +8.221224194035821e-02   +2.820236447580153e-01   +6.204099167663980e-01   +5.297840231874732e-01   +6.683240090911645e-01   +9.149642326157079e-01   +5.955118235224343e-01; +3.803541175627486e-01   +1.858106831868520e-01   +6.215375987606893e-01   +3.510222132995880e-01   +1.187566923143130e-01   -1.071791999851238e-02   +3.364467361911277e-01   +6.511228937913819e-01];
L3I_L3E_iAMPA_netcon = [+8.755240487204739e-02   +6.034212976057263e-01   +4.488666260192142e-02   +1.665041478321971e-01   +2.165915617063659e-01   +6.302177153775532e-01   +3.156134206418402e-02   +3.310312046371880e-01   +4.919615876012105e-01   +3.249076054239313e-01   +5.702165561284102e-01   +8.729185138088189e-01; +3.310603767619721e-01   +7.673520804505450e-01   +2.427668302096279e-01   +2.965925973268431e-01   +6.949409680066823e-01   +4.495459867773881e-01   +4.048982880265559e-01   +3.540031217814221e-01   +6.186352710901868e-01   +2.471781135933896e-01   +6.528152512136806e-01   +2.334269707885959e-01; +4.324860030752660e-01   +2.943130459449511e-01   +7.104775224721802e-01   +8.529324616924968e-01   +5.301988702635883e-01   +6.049121782101741e-01   +9.984730225393089e-01   +4.321892376656336e-01   +2.434302873979427e-01   +3.436297999302085e-01   +8.517307084926136e-01   +8.478903981007568e-01; +4.854907421235747e-01   +1.138457608984464e-01   +5.440369320593230e-01   +6.848392063939684e-01   +4.174126073045899e-01   +5.937708122669726e-01   +5.422527404277449e-01   +6.771559966044290e-01   +5.153872906545480e-01   +2.071017950756663e-01   +3.898910648084846e-01   +4.590100890237311e-01; +9.015010415946598e-01   +7.456808286709570e-01   +5.395784906429079e-01   +4.462785038966494e-01   +2.118039224055676e-01   +2.998126899684225e-01   -1.968103845000630e-02   +2.441675858429255e-01   +6.069316476736667e-03   +2.171122774182487e-01   +2.790398023420967e-02   +4.486147977799126e-01; +3.471380431757642e-01   +1.836254949815046e-01   +6.270571750442860e-01   +4.112241395203984e-01   +1.000000000000000e+00   +5.809748691969914e-01   +2.629916663120514e-01   +1.317891817960720e-01   +1.621005981295598e-01   +5.489143538757968e-01   +3.012322840203542e-01   +1.074974854124838e-01; +4.793373861293087e-01   +2.434000580030607e-01   +8.351061845475467e-01   +8.318709776251814e-01   +1.408459046552342e-01   +1.836879233337490e-01   +3.848820483363658e-01   +1.122500487606605e-01   +8.855683058134181e-01   +7.037957031207873e-01   +3.212348632062730e-01   -3.130884973639660e-03; +3.473156715581116e-01   +3.976025601939958e-01   +3.252572234304874e-01   +5.817654512649049e-01   +7.846709950374890e-01   +2.229576559641257e-01   +3.591302472158832e-01   +2.734280979863854e-01   +3.148464859848213e-01   +2.441354074652746e-01   +6.477229584748860e-01   +4.983960364125041e-01; +3.151323390106352e-01   +4.715759694215912e-01   +3.638428267887189e-01   +5.934868397615430e-01   +5.233471102068745e-01   -8.383838862081788e-02   +6.109034338191929e-02   +2.845004642331236e-02   +3.262107169750521e-01   +2.052146946179084e-01   +8.164542681362804e-01   +9.073554390839630e-01; +6.990163046928879e-01   +6.249889678129833e-01   +5.910023842206241e-01   +3.619854432986920e-01   +4.910732698638175e-01   +3.956222896184632e-01   +1.964731529240374e-02   +6.454001016585265e-01   +5.166307074262708e-02   +8.257980510990072e-01   +4.123694782415286e-01   +1.226386466388657e-01; +8.989052606290875e-02   +2.820247661778211e-01   +6.145547971912324e-01   +2.529232393890281e-01   +1.275449579943230e-02   +4.979204764726227e-01   +5.788444829174706e-02   +7.016519804534420e-01   +6.583283166410715e-01   +1.742451784077602e-01   +6.400979846941458e-01   +3.147090739851875e-01; +6.002771027948666e-01   +6.650376407966353e-01   +4.054652527624921e-01   +5.897511589227685e-01   +6.234725933549359e-01   +3.217864062688366e-01   +2.949153675383456e-01   +8.218098166122666e-01   +5.548703412310126e-01   +3.658313349266962e-01   +5.061026136230429e-01   +4.034875251183467e-01];
L3E_L3I_iGABA_netcon = [+3.347786786962381e-01   +7.057153299648169e-01   +6.700749876572701e-01   +9.006081655779100e-01   +4.862151042564097e-01   +5.154071553458445e-02   +2.876849217712280e-01   +6.718460514416109e-01   +7.125765990539147e-01   +3.174970589512489e-01   +4.849222328064431e-01   +2.541676392447939e-01; +8.545951336763478e-01   +3.614429449336481e-01   +5.625230238703248e-01   +8.275236104528516e-02   +8.502899879631456e-01   +3.696630274503269e-01   +8.419439776907682e-01   +6.800247076966728e-01   +5.862214218950569e-01   +7.465154390023563e-01   +2.862053496792675e-01   +4.564915127733413e-01; +7.468638203655532e-01   +4.039305883758301e-01   +4.415467631713174e-01   +5.291975914697276e-01   +5.577213407260168e-01   +5.483593600383698e-01   +2.817188326390844e-01   +8.451436971009476e-01   +4.692472516830966e-01   +1.908057678129109e-01   +7.991331347688161e-01   +8.828641754751438e-01; +1.204742802972933e-01   +6.727333320149166e-01   +2.926600511715631e-01   +3.423612954252601e-01   +7.334500575544033e-02   +5.983888239210727e-01   +2.757526559548070e-01   +6.986101516542567e-02   +3.166394867616056e-01   +5.219485835244336e-01   +7.557926264140524e-01   +6.247084877579645e-01; +2.969051052020059e-01   +6.287335194359991e-01   +6.123591075224033e-01   +2.997843242060269e-01   +9.868977526381371e-02   +6.657265133117058e-01   +8.282147494405779e-01   +2.967995768050847e-01   +2.216456802934814e-01   +8.201759415584314e-01   +5.899917979742006e-01   +1.770003403445099e-01; +4.395331991287789e-01   +7.897121829705481e-01   +6.956577219222579e-01   +4.968862870252111e-01   +7.468318767551971e-01   +7.657428603872907e-02   +3.282519064677731e-01   +2.123023075395673e-01   +9.076585837167844e-01   +9.172807960721610e-01   +8.200897295518691e-01   +2.292915493273650e-01; +5.724537909773368e-01   +7.723762149338363e-01   +2.353510724749082e-01   +4.596589303154858e-02   +4.167014221731781e-01   +5.549136081361306e-01   +5.938184955112863e-01   +1.695498119649906e-01   +9.538692188313876e-01   +5.670733470196954e-01   -4.305324117898746e-02   +3.195025683484942e-01; +4.960358118013405e-01   +3.368106343635388e-01   +8.966969710609100e-01   +3.980278658423409e-01   +1.172489260835329e-01   +6.104469012727907e-02   +5.536049706764524e-01   +1.477772352005682e-02   +5.619905899826941e-01   +7.626915681441654e-01   +2.061943498377737e-01   +9.869127866913032e-01; +2.691004710712321e-01   +5.473929650415582e-01   +2.817381394375104e-01   +7.779702548192002e-01   +7.918323793866231e-01   +9.736391224695440e-02   +4.110981636933048e-01   +6.336097631530204e-01   +5.947153453793917e-01   +8.244845048397811e-01   +6.978533231029178e-01   +6.705008004375209e-01; +5.479910727577547e-02   +6.184206626572434e-02   +3.322927180467689e-01   +5.628974021364330e-01   +7.473866646275722e-01   +1.970279570044443e-01   +4.032043398639362e-02   +3.275724230372725e-01   +7.191904982850680e-01   +2.695654309238695e-01   +6.212053384375210e-01   +5.426971281956711e-02; +8.874885210260302e-01   +7.325011616403491e-02   +7.491718397806515e-01   +5.098142404980274e-01   +3.820521108581204e-01   +8.459155426690548e-01   +1.685480236411795e-01   +8.253334883887012e-01   +3.180735931525284e-01   +8.694124351055081e-01   +5.222110467662899e-01   +6.988800601182688e-01; +6.876173574292656e-01   +8.163133682557184e-01   +4.813878091787044e-01   +8.423299498300767e-01   +8.182490120472664e-01   +5.257722269155172e-01   +8.791767070257994e-01   +8.642706581164143e-01   +4.860634733395387e-01   +8.320355615780614e-01   +5.068704174246045e-01   +8.898770243866981e-01];
L2E_Input1_iAMPA_netcon = [+9.527649419508988e-01   +9.722233875175520e-01   +9.047903088064791e-01   +9.368209385913150e-01   +8.808527478023971e-01   +1.000000000000000e+00   +8.794453811774686e-01   +9.153909452586277e-01];
L2I_Input2_iAMPA_netcon = [+9.369414580456092e-01   +9.597704355880231e-01   +9.428164298100083e-01   +9.222621475002551e-01   +8.473314435704281e-01   +8.987655800685367e-01   +9.398700190138182e-01   +9.183408687985749e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
