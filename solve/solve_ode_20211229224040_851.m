function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.412577869480703e-01   -8.574874158643174e-02   +1.662057496319962e-01   +6.048506649098331e-02   +8.221225577837618e-02   +2.616399152953234e-01   +8.227272959841270e-02   +4.270677047407435e-01   +8.604351793132528e-03   +1.100654700696791e-01   +2.268036674326946e-01   +7.909900083931592e-02   +8.518425653302855e-02   +1.986030290850626e-01   -6.883400812059064e-03   +3.270109710283697e-01; +1.119426463564780e-01   +6.348735648953627e-02   +3.370634946684038e-01   -8.419594208056633e-02   +2.416657951995391e-01   +6.478664274822062e-02   +3.511881001248586e-01   +2.853181651645044e-01   +4.742129808597385e-03   +1.235838754289127e-01   +1.674472087196354e-01   +6.420127189479295e-02   +5.092287188661550e-02   +1.548828019550128e-01   +1.858275838984277e-01   +1.160766676065535e-01; +2.454674937117120e-01   +8.488968546961678e-02   +1.403039238321947e-01   +1.905974639549110e-01   +2.079676146169722e-01   +1.566830350449739e-01   +3.721757672636529e-01   +2.331766728923195e-01   +1.100990308049851e-01   +1.125085262606415e-01   +7.785879311498953e-02   +9.974685675762358e-02   +3.492860670915478e-01   +1.867605678131334e-01   +1.036737852436416e-01   +3.113723367393133e-01; +2.004964031295057e-01   +3.388683868314533e-01   +6.348368581308782e-02   +3.235841068667974e-01   -8.024456762654174e-02   +2.413480887776349e-02   +1.910628445178312e-01   +5.844881517818248e-02   +4.105138737231036e-01   +2.955833638990132e-01   +1.462553554645223e-01   +1.048189121050110e-01   +6.454344603292603e-02   +3.792725048043696e-02   +1.749970228752174e-01   -4.034434184830707e-02; +1.662872632212587e-03   +4.472742098205006e-02   +2.146855843923570e-03   +3.582955672505364e-01   -1.224968455912642e-01   +1.220238195452494e-01   -1.475841433287014e-01   +1.414384218393182e-01   -1.025947200680682e-01   +2.857920843241826e-01   +4.160520174275363e-01   +1.406455794666749e-01   +3.150385142049584e-01   +1.528507747995746e-01   +3.395706228293510e-01   +7.885221030572452e-02; +3.255701924780209e-01   +1.703490237226302e-01   +1.110813155956230e-01   +2.790224653031365e-01   +1.078741731608656e-01   +4.209743512436645e-01   +3.010117917779871e-01   +3.929323691884050e-02   +3.267156318569418e-01   +1.467014654923059e-01   +3.359944493349274e-01   -1.884898466315275e-01   +8.589005184446302e-03   +1.826074974627675e-01   +2.300411267492149e-01   +3.418670722301551e-01; +2.669362632468073e-01   +2.758048278110262e-02   -1.605535515493348e-03   +9.120126239150175e-02   +2.945798946541975e-02   +1.859047298752012e-01   +2.001719390694873e-01   +3.629993190513818e-01   -5.477773135484277e-03   -1.747032710006099e-01   -3.843952591079506e-02   +3.859700621794982e-01   +2.629100802394210e-01   -1.026154141221119e-01   -8.078473288940929e-03   +1.380772912225987e-01; +2.598594839097712e-01   +3.159831076518879e-01   +6.551071755119475e-02   +2.236850280526624e-01   +2.497771686733992e-01   +3.899323739065089e-02   +1.749737890907533e-01   +1.604971156718544e-01   -4.102598139057322e-02   +2.930034209476707e-01   +3.308296276060984e-01   +2.136604127216768e-01   +2.111306924166580e-01   +2.789263838170188e-01   +9.792837304945518e-02   +3.937194953900602e-01; +1.747659837420996e-01   +4.357357419919093e-01   +1.254900386673742e-01   +1.367667312869803e-01   +3.700756063102104e-01   +2.809839026039237e-01   +4.332137816000182e-01   +2.861261728423854e-01   +9.587951490262198e-02   +1.806581242653789e-01   +2.468366496799590e-01   +3.553945138505881e-01   +2.659485943052041e-01   -5.084783913298074e-02   +1.886288395064114e-01   +1.785661239376755e-01; -9.204320440973128e-03   -3.088988425915693e-02   -1.012201999234813e-01   -5.460698644110872e-02   +1.232373399955883e-01   +2.209121589822293e-01   -1.352582476627240e-01   -4.269170811265328e-02   +3.732984509366740e-01   +2.855545080206908e-01   +2.636239129937123e-01   +1.632447211891706e-01   +4.007533132530062e-01   +1.124654135273786e-01   -1.686806401675056e-02   +2.404026665652745e-01; +3.349916633747955e-01   +1.513712456956882e-01   -7.180744530220305e-02   +4.867866697876915e-01   +2.111692240805715e-01   +5.939060067562140e-02   -5.937175449021515e-02   +1.883872341598035e-01   +1.988067310300328e-01   +3.849802150034693e-02   +2.723374880535667e-01   -8.298877386438969e-02   -1.297178664182048e-01   -1.264951545500935e-01   -6.615057355145243e-02   +1.577011821428879e-01; -8.235277592102033e-03   +9.217810195365640e-02   -1.608863620236502e-02   +1.448290735853004e-01   +3.097272900627133e-01   +1.042490510810557e-01   -5.847210374636402e-02   +1.576541532032442e-01   +1.242907054813549e-01   +3.137139469743776e-02   +2.466745797264295e-01   +1.826216024546517e-01   +3.220700192558548e-01   +9.481983163087918e-02   -3.159718247736878e-02   +1.358384724804245e-01; +3.245811256628844e-02   +1.420671639676918e-01   -8.443070683690003e-02   -2.062273117547959e-01   +1.781841820261620e-02   +1.805941260416993e-01   +7.791979754763283e-02   +3.174735121206070e-01   +1.992851058242593e-01   -1.249489036822939e-02   +1.071047509750923e-01   -3.835203581805688e-02   +2.252241560632262e-01   +2.135436385941446e-01   -8.438076572585214e-02   +3.521936052719464e-02; -6.333692350671333e-02   +5.889208750692843e-01   +2.564016167367180e-01   +1.336331135054634e-01   +1.111240130399391e-01   +2.452348388094021e-01   +2.041471801162327e-01   +2.686768088076057e-01   +2.228936987817673e-01   +2.820154859912840e-01   +1.987351776268158e-01   +2.823935930831922e-01   +2.444095423116062e-01   -6.855221434953573e-02   +1.030939916188100e-01   +1.284124728319923e-02; +4.091448357481874e-01   +3.076798794292466e-01   -1.473504832810416e-02   +2.404176530185828e-01   +3.891802003728724e-01   +9.503953721580138e-02   +2.385462411477920e-01   +7.514693817012717e-02   -7.529714634301994e-02   +3.351184305609990e-01   +2.185484730743664e-01   +5.026826268036745e-02   +9.948892287553068e-02   +2.849445541647099e-01   +1.123032053193585e-01   +1.165484657305231e-01; -7.170801205321968e-02   +3.419948393373221e-01   +4.315047581413799e-02   -1.177867161512883e-02   -5.227411510917365e-03   +3.687358167875258e-01   +1.335235383444675e-02   +3.018775775571542e-01   -2.597567172455932e-02   +2.637209656865245e-01   +1.120385518983340e-01   +2.559227424984967e-01   +1.549033679840754e-01   +2.518641659392873e-01   -8.172662527254210e-04   +2.533989774793273e-01];
L1E_L1I_iGABA_netcon = [+2.543407238654750e-01   -3.752946452918723e-02   +7.370904619476712e-02   +3.242637348508541e-01   +1.112983868933512e-01   +1.153724353959534e-01   +2.031684054949163e-01   +9.833101347738110e-02   +1.176100324774011e-01   +3.641267820572897e-01   +1.653533367688565e-01   -4.262158704250580e-02   +1.615136255749453e-01   +4.047573766175739e-01   +3.761094029300618e-01   +2.041497584402259e-01; +1.611754843398807e-01   +3.185796981173810e-01   +2.762341061025220e-02   +1.582525152670249e-01   -1.462119697899206e-02   +8.579777708471072e-02   +2.213345784212700e-01   +2.750138813483919e-02   +3.202951123582897e-01   +1.847555682127653e-01   +1.781439141506071e-01   +1.471157920130905e-01   +4.258078450738992e-02   +1.937246073363479e-01   +1.222666402499177e-01   +3.209422574684039e-01; +1.671731286343150e-01   +2.523328978563900e-01   +2.591099967142541e-01   -2.986008310437469e-02   +7.852937667253845e-02   -5.254542908878700e-02   +1.114625459605802e-03   +1.776990832721399e-01   +7.130522052200108e-02   +6.533893404195214e-02   +8.035996320906352e-02   -1.213078757215953e-01   +2.245071778806887e-01   +1.591391165668701e-02   +9.914020968310519e-02   +1.971181747723905e-02; +4.516001392993040e-01   +2.873746218250309e-01   +1.640480922649495e-01   +3.817736541953411e-01   +1.028354660034483e-01   +8.279384267346472e-02   +9.349530327298582e-02   +9.100320164409399e-02   +5.753875860058174e-02   -1.663583692715258e-02   -4.731372608254282e-02   +7.417403074652776e-02   +2.652841110470783e-01   +2.624060938086041e-01   +2.233732870101442e-01   +1.598521311195164e-01; -1.866406630217077e-01   +5.380812589516966e-01   +1.594534899352254e-01   +2.759938569831293e-02   +5.857517137788613e-02   +4.172869057659962e-01   +3.371389497268884e-01   +2.583099823766925e-01   +1.036032834617824e-01   +2.626801194209765e-01   +3.968513038805552e-01   +3.724477331200148e-01   -6.085739466344379e-02   +9.933299708668827e-02   +4.052669037057061e-03   +1.617823628250298e-01; +1.952645505531186e-01   +2.382261235937731e-01   +2.835260212427188e-01   -7.332048330022932e-02   -8.545315876555849e-02   +1.229779288628982e-01   +1.015001190314765e-01   +1.131773041593669e-01   +1.250434787508865e-01   +2.689901461898535e-01   -3.341660891827948e-02   +4.122308933665719e-01   +3.092420774429107e-01   +3.421461429739666e-01   +1.129132675726783e-01   +3.152556300469055e-01; +2.480701581993160e-01   +6.703854009206579e-02   +3.118289022154175e-01   +3.237772436813469e-02   +2.872107272052025e-01   +1.488608385787898e-01   +5.199421210882477e-02   +4.176906363784906e-02   +1.435958371554028e-01   +9.282300386827184e-02   -4.692573797101930e-02   +8.743372441888082e-02   +2.770719787063327e-01   +3.474283037979423e-01   -1.857782666942003e-01   +2.074966760288664e-01; +2.453778072643409e-01   +6.312795387190002e-02   -3.153214434297956e-02   +1.973809389444392e-01   +4.975439438074460e-01   +1.847990506437494e-01   +1.889787799885061e-01   +3.005133241719365e-01   +2.478266415866287e-01   +1.697608050238769e-01   +1.654365171716598e-01   +3.686745600526148e-04   -1.471911868657895e-03   -2.332197306864883e-02   +7.091703491573356e-03   +3.252636345975227e-01; +3.003767988757684e-01   +2.757328498145675e-01   +1.840169136112385e-01   +1.464032990385986e-01   -8.206003557880960e-03   +5.442252644985185e-03   +3.491032704809963e-01   +7.122416309109440e-02   +2.237917271512793e-01   +3.264409230236238e-01   +1.912581407554042e-01   +1.570557816499423e-01   +2.417938871354127e-01   +3.818081852248620e-03   +1.175496304336502e-01   +8.723920515196334e-02; -9.032235320868678e-03   +2.137627288055304e-01   +3.225921328987844e-01   +8.550258465132410e-02   +2.702927155270565e-01   +2.347067661857876e-01   +3.123083481803944e-01   +2.063379857387883e-01   +2.777675129033154e-01   +4.055915133253549e-02   +4.012038662732893e-01   +1.861240835831877e-01   +1.792474401731190e-01   +1.699394739370773e-01   -3.873874876747668e-02   +2.726039413726160e-01; +2.998047005126704e-01   +3.154054174065390e-01   +2.345909408405688e-01   +1.717316136328424e-02   +5.333860243588918e-02   +2.908487212816611e-01   -1.022250277144472e-01   +1.810767617171572e-01   +2.408946659846319e-01   +1.859847024384028e-01   +2.319923738716440e-01   +1.287273562807187e-01   +2.117222304509516e-01   -1.400052367209065e-01   +3.743644358008206e-01   +1.222068834338541e-01; -1.169583458154452e-02   +1.147771823978812e-01   +2.482523086847409e-01   -3.918726611383816e-04   +3.221371029339422e-01   +7.398965139399417e-02   +1.261734859739288e-01   +6.740849453637789e-02   +2.702394818046524e-01   +9.601626501495299e-02   +3.974695129901162e-01   +2.141228551742005e-02   -1.661263920062668e-02   +2.604394038441363e-01   +5.079107403279562e-03   -6.332365177612771e-03; -1.036441182077875e-02   +2.155964354112685e-01   +5.187277373327307e-02   +2.148824771788536e-01   +7.934375231230989e-02   -4.105800815128864e-02   +1.385957276003906e-01   +3.132559329301698e-01   +1.060276186205839e-01   +3.289856148225024e-01   +1.764608573453451e-01   +2.396731923922003e-01   +1.401995130501416e-01   +2.164507592022485e-01   +2.771947513744962e-01   -2.688093090586551e-02; +2.457577867341376e-02   +1.232988111166535e-01   +2.424434233769845e-01   +1.270080082586338e-01   +3.128580976271350e-01   +2.879222070082071e-01   -1.600201857884987e-01   -6.191797513030591e-02   -1.340432542748106e-01   +1.914319096916582e-01   +5.424575839491003e-02   +1.678811124391907e-01   +6.894060517051499e-02   +2.247230870704815e-01   +3.522197856633389e-01   +3.179613575310644e-01; +3.065269706776827e-03   +8.755330743043589e-02   +8.364357351052903e-02   +1.596445240000300e-01   +2.747622285455585e-01   +1.684377300874584e-01   +2.042660574224466e-01   -1.837961651347196e-02   +2.929188726298044e-01   -1.138195698549075e-02   +1.578938930655525e-01   +7.626017952161876e-02   +7.273990175609937e-03   +1.838659087744303e-01   +1.861343086493924e-01   +9.841768396094487e-02; +2.666984232261388e-01   +1.177342934946999e-01   +1.267077364542165e-01   +2.107753254531573e-01   +1.315942849486982e-01   +1.816143780606141e-01   -2.082285392662748e-01   +1.499866847936803e-01   +2.040988576665852e-01   +1.909838830174914e-01   +7.865423938374927e-02   +1.202696647850324e-01   +1.498414145462434e-01   +3.829473414189831e-01   +1.622179995890870e-01   +2.922675513510886e-01];
L2I_L1I_iGABA_netcon = [+4.509287246673216e-01   +2.749113241801407e-01   +1.386555672661106e-01   +3.796058066581754e-01   +1.241894376378619e-01   +2.268224783645385e-02   +8.480415211731332e-02   +1.747921103910577e-01; +3.465185437461923e-01   +2.695607580479197e-01   +2.833844691995725e-02   +2.250326721374915e-01   +1.786171134546149e-01   -2.196522885225029e-02   +1.232397449513486e-01   +2.672237015721102e-01; -1.087117302470398e-01   +2.711325909711392e-01   +2.324302804258471e-01   +3.372761354185513e-01   +4.647907960636551e-02   -1.355891440454496e-01   +2.086878195816292e-01   +2.126202524324140e-01; -5.596625621327656e-02   +1.082729849226403e-01   +2.823521441002700e-01   +2.354745523380952e-01   +9.793514392046326e-02   +4.263130559824675e-01   +8.455449740878754e-02   +1.509834653100669e-01; +4.357358637313957e-01   +2.893070184708987e-01   +1.007568138220565e-01   +1.544024396976462e-01   +7.476995003189622e-02   +3.213743919607349e-01   +2.018071882452587e-01   +2.134663112884872e-01; +2.258212365948944e-01   +1.311633029667042e-01   +3.090537815147848e-01   +6.710613810108196e-02   +1.265170506418392e-01   +7.655914139185802e-02   +1.533907785096368e-01   +1.328794563813540e-01; +2.177423627725997e-02   -5.933363719536353e-02   +9.545897392959699e-02   -1.452581270697062e-01   +6.399650301921089e-02   +2.632160127364369e-01   +2.562035925280040e-01   -8.518773632099071e-02; +3.206100561128902e-02   +1.810715695639360e-03   +2.993091355907462e-01   +2.334889314549855e-01   +3.247664666298052e-01   +7.260738268015748e-02   -4.591466486340948e-02   +2.942282372684024e-02; -6.926946390759436e-02   +1.365820898455595e-01   +1.742095159654782e-01   +1.244772803013447e-01   +1.398988251086882e-01   +4.795666282657582e-01   -8.207603344185455e-02   +2.070107900686126e-02; +8.172784980625922e-02   +1.620113626619020e-01   +2.188468371976441e-01   +4.120959065105234e-01   +1.506685172476587e-01   +4.446780539787552e-01   +4.290973522701851e-01   +2.883199759907442e-01; +5.131651743293573e-03   -5.867645386044974e-02   +3.604942470455793e-01   +3.921301758085356e-01   +1.725435275924987e-01   +2.508793092008143e-01   +2.138957312287593e-01   -1.193563176003865e-02; +1.512465251116160e-01   +1.954963618431277e-01   +3.668949074251923e-01   +4.537761244638855e-02   +2.649196430970063e-01   +2.345780231999192e-01   +9.762575094882320e-02   +1.236088209966167e-01; +1.301078306133531e-01   +1.800594688746928e-01   +2.992934835511744e-01   +2.445511135412308e-01   +2.012808390111606e-01   -5.900025616247204e-02   +1.624970921191654e-01   +1.653367717154664e-01; +7.289580647738206e-02   +4.200146255480512e-02   +2.924696885105375e-01   -4.931353052630170e-02   +1.545727064419150e-01   +2.643636174371629e-01   +2.395740956793801e-01   +1.701113223868735e-01; +3.328883446077579e-01   +4.147944534536980e-01   +1.711113688096637e-01   +6.136703407431308e-02   +6.709082524026554e-02   +1.093519078512549e-01   +3.771762066051419e-01   +1.411331500144216e-01; +3.630652343446711e-01   +1.412853452767705e-01   +7.860026131714191e-02   +8.321788363588412e-02   +3.347947354626504e-01   +7.238778863852030e-02   +1.007175882034574e-01   +8.580416465466531e-02];
L1I_L2I_iGABA_netcon = [+2.209680117894033e-01   +1.314256024893109e-01   +1.414845572153093e-01   +3.256797673667875e-01   +3.299243343391183e-01   +1.877361763469962e-01   +2.085117508006721e-01   +5.589912800126143e-02   +2.496551649683646e-01   -1.729724093556724e-01   +2.492305614876549e-01   +2.579378005464992e-01   +5.367716618285436e-01   +1.456855650340873e-01   -2.520079417910412e-02   +2.375813045721085e-01; +3.276730598113035e-01   +2.161244122770634e-01   +9.529875886826045e-02   +3.290431926201222e-01   +3.647753666405923e-01   +2.221792989567931e-01   -9.804088962391561e-02   +1.241418866355313e-01   +4.315915052915651e-01   +7.564518588455893e-02   +1.565740311266702e-01   +1.338555934064819e-01   +6.486871509839529e-02   +8.783304587639466e-02   +1.988217504684080e-02   +3.069953304422376e-01; +2.833113094817222e-01   -9.017938606178344e-02   +2.822633298464881e-01   +8.910779468359944e-02   +3.374225918247745e-01   +3.840920445826640e-01   +4.498326070805179e-01   +1.603773325178293e-01   +2.736374344883822e-01   +2.684191272850988e-01   -1.109667222628588e-01   +3.750610962243842e-01   +2.742976088165625e-01   +1.170275940203993e-01   +1.701901180425158e-01   +3.320051242433100e-01; +1.010976581507927e-01   +1.828215392671806e-01   -5.129035861808380e-02   +2.143146705912924e-01   +1.760785941021641e-01   +2.109889777651112e-01   +2.100265742220638e-01   +2.718755690492775e-01   -5.900841874641702e-02   +3.264233735065130e-01   +8.253009242615528e-02   +4.269321247057747e-02   +1.059222704062635e-01   -1.114314974593066e-01   +1.852197091625521e-01   -1.615453587103639e-03; +1.735016646339319e-01   +4.359218084073490e-01   +3.659648887947653e-03   +2.364122523566154e-01   +1.173041320184209e-01   +3.204668523647560e-01   +2.233967929762248e-01   +2.369826501657634e-01   +1.224457671838549e-01   +2.495558069222530e-02   +2.026858951751271e-01   +2.006274478271330e-01   +2.420041234635886e-02   +1.536007071371274e-01   +4.341185840338682e-01   +2.437610991296761e-02; +2.184881533865227e-01   +3.069296312413093e-01   +2.008345010801652e-01   +2.227822095649948e-01   +3.011618367312871e-01   +1.133022947953435e-03   +3.370448097745351e-02   +6.808912056875532e-03   +2.939729445572285e-01   +3.436764955532803e-01   +6.049884778669315e-03   +6.226395901196304e-02   +1.398506716629326e-01   +1.889097040566524e-01   -1.334543885907982e-02   -5.386650946277780e-02; +2.941427826536873e-01   +3.336921051583311e-01   +6.770736064192345e-02   +3.581838921594673e-01   +2.143376652864123e-01   +1.398181536784867e-01   +3.327497983724333e-01   +1.434717660009178e-01   -3.313920040879999e-02   +2.452653544697871e-01   +1.365008302243613e-01   +2.322653727175210e-01   -7.174944095299825e-02   +1.653174773162677e-01   +3.034724454882461e-01   -9.655144004087167e-02; +1.245091918733821e-01   +3.125636823664283e-02   -3.768714076647105e-02   +3.656776045886339e-01   +3.305207658645143e-01   +8.492629234944542e-02   +8.127266107786348e-02   -5.438499812029240e-02   +1.947598213711908e-01   +5.862754044227281e-02   +2.899457543965290e-01   +4.996440400241507e-02   +1.610701327464661e-01   +1.972405957067605e-01   +6.003195927068125e-02   +1.983532791441345e-01];
L2E_L1E_iAMPA_netcon = [+2.125826280179551e-01   +3.180451392406595e-01   +3.326809222996445e-01   +1.983528723198550e-01   +1.616837029961556e-02   +1.896870377121592e-01   +2.200974910976854e-01   -1.760296783511754e-02; +2.104326919307704e-01   +3.048807018925974e-01   +1.033443655973846e-01   +2.101684029999183e-01   +2.953312399186871e-01   +3.212669786442159e-01   +4.099744237305931e-01   +2.838605117858607e-01; +3.122781511099009e-01   +2.797273203238997e-01   +1.592929297452457e-01   +1.564309840598763e-01   -5.082851693643639e-02   +3.442272180219011e-02   +2.761251459023447e-01   +3.352327502994291e-01; +4.396632064863817e-02   +4.185638889064523e-01   +2.790939880355297e-01   +1.803795551891457e-01   +4.110055368986798e-01   -1.480659550977152e-01   +1.269546250962558e-01   +2.666038715291205e-01; +2.731542196173695e-02   -4.299492774361815e-02   +2.545439340567257e-02   +1.944210935852973e-01   +2.650566553458769e-01   +2.780131670699787e-01   +5.451057011204362e-03   +3.145326372931821e-01; +2.242365739361784e-01   -7.285610295057576e-02   +1.748808332664158e-01   +7.887968556867639e-02   +3.600098058061112e-01   +3.342079774269577e-01   +7.746713534098816e-02   -1.040769197706677e-01; -1.171117352691236e-01   +2.961740587619044e-01   +7.605452806108459e-02   +8.324692530027265e-02   +1.499628010107917e-01   +1.352243191299889e-01   +2.014432774012712e-01   +1.012695204532129e-02; +3.105299769634894e-02   +3.603573369600007e-01   +4.141551413910963e-02   +2.027365653867359e-01   +2.768329417524641e-01   +2.933084472611329e-01   +4.002911373396085e-01   +3.204172462619181e-01; -3.824119434835883e-02   +3.307366592806022e-01   -1.274729109067345e-01   +1.732374164643301e-01   +1.301994338382323e-02   +1.114932486557748e-01   +2.838743797262102e-01   +1.028446880302593e-01; +3.578154965905244e-01   +2.821723354205802e-01   +1.506444949091124e-01   +2.653275672506333e-01   +8.540143899981392e-02   +3.295434363968991e-01   +2.517890992483348e-01   -8.034200067471699e-02; +2.461937710828333e-01   +2.149855397895481e-01   +1.902005567537006e-01   +2.147835035188956e-01   +1.568270250400543e-01   +3.941899466246040e-03   +1.949337122520576e-01   +1.050618641444029e-02; +2.368205266602398e-01   +3.113832992752352e-01   +4.366120764492624e-02   +2.102464172430001e-01   +1.445448517906051e-01   -5.690128311604301e-03   +2.402496749901629e-01   +2.405624679401200e-01; +5.614616419455044e-02   +1.674837132455231e-01   +2.308752985203305e-03   +5.047568895151814e-02   +1.660688295560888e-01   +1.822406544974813e-01   +2.546444372933170e-01   +1.205779959444857e-01; +2.261203240824284e-01   +1.265930235693205e-01   +1.862954184248935e-01   +6.830816492759371e-02   +1.604485160524050e-02   +1.860405699916446e-01   +1.671997680986030e-01   +3.239666930943580e-01; +8.223662051612589e-02   +1.794613362719490e-01   -9.351906598007953e-02   +1.258252140122965e-01   -1.816152433372917e-01   +6.562853358061529e-02   +2.074898798775724e-01   +9.930634285220387e-02; +6.793260546776851e-02   -4.521598799552030e-02   +2.241576129880752e-02   +8.596726862228150e-02   -5.689431924883033e-03   -9.641418335232310e-02   -7.995709104842517e-02   +1.532944707191841e-01];
L1E_L2E_iAMPA_netcon = [-9.606702630411532e-02   +1.620538646616938e-01   +7.111942330412475e-02   +1.065007917251314e-01   +2.446089089640401e-01   +3.748083425207913e-01   +2.479717137243140e-02   +1.977072670923165e-01   +8.583295383307610e-02   +2.370890955059285e-01   +3.041964993350444e-01   +2.804173734138511e-01   +3.092081897885904e-01   +1.445332923554525e-02   +3.801524886257518e-02   +1.210777375001173e-01; +4.194328716056772e-01   +1.523677761983673e-01   +2.988081840309892e-01   +3.282839802599359e-01   +2.694970095087552e-01   +4.024470822928369e-01   +3.007970718706264e-01   +1.935801706136286e-01   +1.480310165859255e-01   +1.064921124283720e-01   -1.059881668123212e-01   +3.027803305596505e-01   +3.167661577509985e-01   +3.141953201290259e-01   +4.150650153189265e-01   +2.923501268755728e-01; +1.201343993103663e-01   +1.054920078423214e-01   +4.043470344770150e-01   +3.898977830752324e-01   +4.816165359362783e-01   -1.270028729613901e-01   -8.129267461464047e-02   +1.145207153736079e-01   +2.136975918936427e-01   +2.444248722417510e-01   -1.815927239040398e-02   +1.656013977386552e-01   +2.668138368810842e-01   +2.293645279219184e-01   +1.198036986552512e-01   +3.047146379321881e-01; +2.141715023275541e-01   +2.031167777480062e-01   +2.807014771116463e-01   +3.034129427600196e-01   +1.447413606846906e-01   +5.242879879655900e-02   +4.280852563389736e-01   +3.217393949795404e-01   +9.762476410713314e-02   -9.186680210871671e-02   +1.720059353644056e-01   +2.347181392936728e-01   +1.690749121519634e-01   +1.371363693809374e-01   +3.383215562296673e-01   +2.407016851359174e-01; +2.408311114051418e-01   +4.481940375182676e-01   -8.211195631886511e-02   +6.763716111490015e-03   +2.275053533410653e-01   -8.168449827744673e-03   +1.249849386722530e-01   +2.363616508283655e-01   +2.884382303553027e-01   +4.832361582682618e-02   +1.849228213789516e-01   +1.497401836231490e-01   +1.881482412862478e-01   +5.268847414008906e-02   +4.172954329541091e-01   +2.580895112703246e-01; +1.614301617741712e-01   +2.677888791689933e-01   +1.332175901800496e-01   +1.442093991175781e-01   -8.104858475979114e-02   +1.263852246324439e-01   +5.197110420763676e-01   +4.220144491811912e-01   +2.298305356848023e-01   +2.581433947898739e-01   +2.594487142981482e-02   +1.845690394589199e-01   +6.466344640867963e-02   +1.049824661525368e-02   +3.685043608982982e-02   +1.281270155429670e-01; +4.329363916373147e-01   +1.837850509547430e-01   +2.321845923327197e-01   +1.971838943899756e-01   +5.305125867774303e-01   +3.024442152161891e-01   +1.110972926462909e-01   +5.557966164489929e-02   -4.313934826727828e-02   +9.953304412332972e-02   -6.076981244730238e-02   -6.351957178471847e-02   +2.921660792543527e-01   -4.006158553228611e-02   +1.719729690785791e-01   +1.085713474333569e-01; +3.414260914915759e-01   +2.071075823664109e-01   +6.944868571299866e-02   -1.472216792701019e-01   +5.247951554335608e-02   +1.324010527200828e-01   +2.428010220900547e-01   -1.204551051276819e-01   +3.704690101792440e-01   +3.571049712920672e-02   +2.715596724499246e-01   +1.009051316198250e-01   +1.031333778667565e-01   +1.374230060337000e-01   +2.211714881292510e-01   +3.031618409406329e-01];
L2I_L2E_iAMPA_netcon = [+4.692499450463823e-01   -3.304841250330044e-02   +4.667601395751928e-02   +3.951823853157931e-01   +7.978805251977172e-02   +3.453865963753308e-01   +1.982222957815303e-01   +1.815100433197892e-01; -4.962650094189312e-02   +8.884771367577467e-02   +2.840799725658102e-01   +2.453351183938230e-01   +1.435342432140247e-01   +9.289868064745362e-02   +3.362250672937059e-01   +4.712707870415617e-02; +1.141203127747071e-01   +7.648332277533147e-02   +2.336199464142789e-01   -3.454562307039274e-02   +1.221354692819298e-02   +8.548633733280311e-02   +2.607392070039706e-01   +3.325750871026922e-01; +3.110677806703765e-02   +2.682924426409252e-01   +8.653602888832278e-02   +1.493787844371827e-01   +2.980920735626023e-01   +8.540895646201377e-04   +6.630889121984719e-02   +6.841997178039599e-03; +1.946869572270404e-01   +3.131416387804964e-01   +3.930262669693000e-01   +1.693515493069833e-01   +5.034384130291937e-02   +2.892114372519304e-01   +1.884169866700862e-01   +8.321719042285000e-02; +3.413612728970580e-01   +2.143633257750430e-02   +2.298217990765491e-01   -1.223557768408499e-01   +2.676035490767593e-02   -5.275280058251584e-03   +7.810863673217172e-02   +8.848614826310393e-02; +1.110739175176684e-01   +1.206794186239394e-01   +2.895541453900450e-01   +3.514725168398563e-01   +1.789738057549706e-01   +2.813303900981016e-01   +2.541355503757159e-01   +1.420549391834422e-01; +2.346285930792678e-01   +3.085493635797414e-01   +2.126471333636642e-01   +2.468902626022655e-01   +3.473343573854474e-01   +3.311645689132440e-01   +3.107894833828561e-02   -3.467255699018787e-02];
L2E_L2I_iGABA_netcon = [+3.242909938856964e-01   +1.557133776953212e-01   +1.466858179131812e-01   +5.491918044947912e-02   +8.758130068807737e-02   +4.546808893454175e-02   +2.363012139934425e-01   +8.711663905674154e-02; -1.031904076882505e-01   +2.475937623720177e-01   +1.334076252156366e-01   +2.092458364311652e-01   +7.155844903486069e-02   +7.371235994698239e-02   +6.023859938778078e-02   +3.690146017250204e-01; +5.152026805418960e-01   +6.322293725631351e-02   +1.768067714232381e-01   +3.807567414103392e-01   +1.760751248949465e-01   +3.107141717037779e-02   +1.629399072299345e-01   +2.023842067260616e-01; +2.124629824337618e-01   +3.596609940058941e-01   +3.886878284144882e-01   +1.911417760680429e-01   +1.780399094535655e-01   +2.757574424794339e-01   -8.319844139895921e-02   +6.677960285432318e-02; +1.993941445180432e-01   +2.249482460378202e-01   +4.077347610573863e-01   +3.884086240970737e-01   +2.903692434861178e-01   -1.032388426228204e-01   +1.772262032339475e-01   +1.534384943895140e-01; +3.144567309491514e-01   +2.448824283113306e-02   +2.130380859038298e-01   +2.240161901665824e-01   -4.887232485452983e-02   +3.898700939042785e-01   +7.462314852385908e-02   +2.847842036626786e-01; +2.530975953660718e-01   +9.837062641439881e-02   +2.024875767760598e-01   -3.964938939772165e-02   +2.053646186009680e-01   +5.003462988902439e-02   +3.745792667066743e-01   +3.435038448092668e-01; +1.122027221966697e-01   +4.703468442939174e-02   +2.141468656197991e-01   +2.720153902529120e-01   +5.236045625593383e-02   +2.083549074216772e-02   -5.672547328058637e-02   +2.707656319244316e-01];
L3E_L2E_iAMPA_netcon = [+1.842148221745320e-01   +3.112470255947817e-01   +9.659669057524732e-02   +4.282309325084013e-02   +3.116924485894546e-01   +1.279429589340619e-01   -7.903749027699901e-02   +1.357271161155152e-01   +1.148293130668084e-01   +2.734548950956455e-01   +7.128089040346207e-02   +8.052547393371662e-03; +1.563464769592750e-01   +1.652057546307213e-01   +3.321957843426501e-01   +1.208404252853257e-01   +2.176029003634202e-01   +2.891051954808652e-01   +1.000698464199481e-01   +1.884227665822905e-01   +2.052415567882479e-01   -2.001766756977927e-02   +9.202414720703286e-02   +3.732593902289155e-01; +1.111788667565176e-01   +2.216357201244071e-01   +9.604504698240121e-02   +4.448145588579639e-02   -3.013958080048285e-03   +1.703269025741504e-01   +1.452571238547506e-01   +3.105864043064583e-01   +1.898938811832537e-01   +1.849457521278239e-01   +4.437703563798293e-01   +1.123433231843521e-01; +1.762243639221128e-01   -7.324702568608833e-03   -3.476090985876632e-02   -4.250036007823345e-02   -7.250661288935170e-02   +4.344775006810949e-01   +2.678543672664575e-01   +1.203874224314097e-02   +1.723159004735591e-01   +2.694675033597417e-01   +2.384993773782775e-02   +2.426927238206152e-01; +4.739215863149578e-02   +1.708743076441283e-01   +2.607811780346016e-01   +1.591125556144926e-01   +2.133157108883008e-01   -1.219915463237158e-02   +1.375910343898548e-01   +1.654802957836670e-01   +2.255629058409974e-01   +1.380763405749212e-01   +1.529828203454981e-02   -7.248847430268729e-02; +1.141302344035264e-01   +3.887946120351245e-01   +7.974733078298131e-02   +2.401013705950097e-01   -4.802375451765360e-02   +4.521084650177902e-01   +6.260923758067910e-02   +1.829505149957741e-01   +2.088800623578485e-01   +1.322536514408684e-01   +5.514399439651599e-02   +2.535944912786031e-01; +2.968934945829385e-01   +2.169125484989915e-01   -9.940585394586401e-02   +1.815390618044743e-02   +3.677467981214917e-01   +1.913976551527571e-01   +2.616132121730562e-01   +1.357088098398478e-01   +4.720904639936530e-01   +1.688685194126962e-01   +2.372296430436053e-01   -1.263511242526276e-02; +3.158058233763264e-01   +3.683741777185800e-01   +4.754988566835002e-01   +9.228268184032459e-02   +6.775258515857600e-02   +1.010445203662092e-01   -6.740079700829162e-02   +1.681906969203336e-01   +2.522850990129163e-01   -7.178887762380927e-02   +2.917115752705972e-01   +1.461792536178089e-01];
L3I_L2I_iGABA_netcon = [+7.681820591734359e-02   +1.019647155613783e-01   +2.572066963466278e-01   +1.471141452875809e-01   +2.774165671682970e-01   +2.786360914679449e-01   -3.071691676284000e-02   +3.045384448767833e-01   +3.055787414484012e-01   +1.309942542668125e-01   -2.691868360333634e-02   +1.035401823813278e-01; -1.496728189807397e-01   +4.493033523235516e-01   +3.029596593817636e-01   +1.934919475660692e-01   +2.210249118754282e-01   +3.519318038493678e-01   +6.449342368824866e-02   +1.981995439208231e-01   +2.072537277407398e-01   +2.182861449100272e-01   +1.834792532108923e-01   +1.466018475947003e-01; -1.194547541405190e-01   +1.591612818654493e-01   +2.799901787143793e-01   +3.354362527225921e-01   +2.125764503477314e-01   +2.303628947742432e-01   +3.701212005797388e-01   +3.397952861709548e-01   +1.537066903963268e-01   -1.132735817112463e-01   +1.805921856303775e-01   +7.578368116420216e-02; +3.584205078989917e-01   +2.411896043329770e-02   +4.053820399676312e-01   -8.258478752611574e-02   +3.029662682781745e-01   +1.757530025870913e-01   +3.832761339789905e-01   +3.793449765406626e-01   +1.859397190285664e-02   +7.911139230675393e-02   +3.439485300079222e-01   +8.443234832936906e-02; +4.012654342112983e-02   +7.148927877756873e-02   -4.544616123089813e-02   +5.114094998942141e-02   +1.579583542989691e-03   +1.163911738484063e-02   +1.357285215212871e-01   +1.348930514311784e-02   +1.229541232003223e-01   -4.958905307945179e-02   +1.201238727181800e-01   -3.727717272888681e-02; +6.822495275917259e-02   -1.518545914415478e-02   +2.267080379459863e-01   +8.760505329695302e-02   +1.644750564107763e-01   +1.010005751541339e-01   +1.315975456182472e-01   +2.726747694214853e-01   +1.610844779265088e-01   +5.005678668701978e-01   +2.281704894500366e-01   +2.528691775183129e-01; +3.708358534637830e-01   +2.356990093533204e-01   +1.383763343465449e-01   +3.764119814463830e-01   +1.181917901477745e-01   +2.115799937885679e-01   +7.482652193692146e-02   +3.453592931630562e-02   +1.027755953844223e-01   -3.413849827618953e-02   +8.626568849324882e-02   +3.433741216505282e-01; +1.583844034363588e-01   +8.858047180344039e-02   -7.360063175221010e-02   +9.229668422297065e-02   -9.036564300062146e-02   +1.989799088330689e-01   +1.861718499209541e-01   +1.593446489277426e-01   +2.416595344230714e-01   +4.248547622689396e-01   +3.434036506714112e-01   +1.161788299600571e-01];
L2E_L3E_iAMPA_netcon = [+6.427885930257667e-02   +8.016320245794911e-02   +2.761180540661894e-01   +3.942940617443275e-01   -1.909984556091504e-01   +2.910429846193855e-01   +1.591923828781902e-01   +2.240840276495463e-01; -1.039513872394966e-01   +1.928720145350065e-01   +1.638553858578847e-01   +1.538076326402344e-01   +4.601665541504404e-01   +2.025452336052917e-01   +8.771692898105674e-02   +2.003258099278443e-01; +1.095113949846690e-01   +4.592053869270311e-02   +3.501766908220487e-01   +2.414756781152549e-01   +2.535424284954128e-01   -1.427665786610907e-01   +2.975248116718624e-01   -1.078910164680899e-02; -9.824571768504917e-03   +1.407554885427918e-01   +5.851698189593819e-02   -1.254450976330620e-01   +2.384887484410617e-01   -1.259474597893911e-03   +3.710748255567072e-01   +2.229587792163833e-01; +1.771033841138096e-01   +2.906707978252842e-01   -3.627722680689086e-02   +2.440798915141078e-01   +2.855232593446377e-01   +1.188307811619575e-01   +2.147235135928380e-01   -5.351558853859556e-02; +9.513628639999692e-02   +1.229662875589977e-01   +1.325579849132789e-02   -1.737265370092591e-01   +8.816943311097564e-02   +3.053016255613588e-01   +2.077122426937428e-01   +1.072851422623308e-01; +1.105337627095188e-01   +1.828768421200405e-01   +2.404130594529412e-01   +6.907094942355277e-02   -1.142735366864687e-02   +2.319124250444430e-01   +1.055806569153228e-01   +4.625346121078541e-02; +3.238665138539939e-01   -7.384728131027331e-02   +1.226498837748899e-01   +7.952482747924368e-02   -2.811334173615471e-02   +1.383642254729689e-01   +8.519196819878004e-02   +1.252366286691237e-01; +2.024705943715634e-01   +1.282042477815666e-01   +2.002027289412565e-01   +2.322308840901582e-01   +1.924232824667125e-01   -7.809397846464650e-02   +3.190316022514000e-01   +2.236537855886628e-01; +1.254755168420177e-01   +1.306986593830039e-01   +7.310023161311713e-02   +3.681184828501117e-01   +3.432887242593725e-01   +1.226365313604713e-01   +4.261952861828524e-01   +3.136006171680844e-01; +1.952879679195879e-01   -2.329779336861337e-02   +1.406857024838150e-01   +1.256165142353804e-01   +1.098168500162652e-02   +9.133256867878281e-02   +1.134895226241216e-01   -8.925274647070383e-02; +3.539611536096925e-01   +1.431622209123959e-01   +1.119176198105943e-01   -4.028545687577712e-02   -7.864371207317646e-02   -1.176682903568344e-01   +3.135995296931445e-01   +8.263609461581867e-02];
L2I_L3I_iGABA_netcon = [+1.097238596132337e-01   +4.443454879305069e-01   +1.591090082666351e-01   +2.550162553350673e-01   +6.237153857600569e-03   -1.107467527499305e-01   +1.832512899968934e-01   +2.468651424391423e-01; +1.398402845911905e-01   +3.041930439592510e-01   +1.489612811607512e-01   +2.336793157330412e-01   +4.285096322286212e-01   +2.256939072381044e-01   +2.957632023571246e-01   +1.649115261760260e-01; +1.140473816824690e-01   +1.861853618442703e-01   +5.193128645531180e-02   +3.674490604473236e-01   +3.720143203881444e-01   +2.146105424706605e-01   -4.140506531945894e-02   +7.938436860659967e-02; -5.333672186902389e-02   +1.547467727184221e-01   -2.250131738060139e-02   +4.686460297146068e-01   +2.306388072456225e-01   +2.852736749664517e-01   +2.147926410495499e-01   +2.083483940762014e-01; +3.212387497222934e-02   +1.129450102955292e-01   +4.454984266554003e-01   +1.971049004238567e-01   +2.248819394347978e-02   +2.891493022498813e-01   +2.315917460659022e-01   +1.497959905153321e-01; +5.898675481917567e-03   +1.107717581584640e-01   -6.406561577671302e-02   +2.143784860410944e-01   +2.748919214514582e-01   +2.132058918664815e-01   +2.494323429037918e-01   +1.408330478580014e-01; +1.152052276366084e-01   +9.255922758322510e-02   +2.987424489717013e-01   +2.928229639456436e-01   -5.996779772695374e-02   -7.171751327221258e-02   +1.385222994666270e-01   +2.665271541448759e-01; +1.492148295718008e-01   +4.318125248916431e-01   +4.926327771205141e-01   +1.346842510151753e-01   +4.882968708321034e-02   +3.347182055992891e-01   +1.216167074821162e-01   +2.686819112902545e-01; +4.465596097345154e-01   +2.806596717264790e-01   +5.699347662149715e-02   -8.651245054306422e-03   +2.390335898140630e-01   +1.475063714060654e-01   +7.626626419834721e-02   +1.991100693019610e-01; +2.486882271678682e-02   +1.355742760791887e-01   +1.957045293540736e-02   +2.283379257637569e-01   +1.713667104376569e-01   +1.542535176283435e-01   -2.260982542839512e-02   +3.742633322304664e-01; +2.905564055084458e-01   -1.125785204783986e-02   +4.432893453465988e-01   +5.533857116313415e-02   +3.890419943533123e-01   +3.602972116376420e-02   +1.778146439792272e-01   +1.303366268151153e-01; +2.187952456970366e-01   +4.214781683796778e-02   +2.433251802495556e-01   +3.777253253367802e-01   +1.859529688147635e-01   +6.749379443532122e-02   +1.787909915376762e-01   +3.360935542413790e-01];
L3I_L3E_iAMPA_netcon = [+2.804110379735649e-01   +2.153022716645941e-01   +1.104968002921927e-01   +2.337482016372292e-01   +9.682259395698123e-02   +6.689315582082775e-02   +2.351934729535956e-01   +1.958555704089255e-01   +1.380561362087391e-01   +8.826670829191538e-02   +1.160637570719700e-01   -4.332720370308333e-02; +1.999688182446251e-01   +2.770517651949336e-02   +2.087991385779444e-01   +4.044382986792764e-01   +4.723231967561331e-02   +4.138362368610847e-02   +8.314918271885824e-02   +1.343175566371300e-01   +2.446881026753610e-01   +5.937957081078553e-02   +1.332939173700747e-01   -9.520244068251200e-03; +2.481536000931205e-01   +4.550550942580000e-01   +3.341520547384739e-01   +8.438252666234958e-02   +2.080426428577743e-01   +1.304244665875812e-01   +2.867385051402216e-01   +2.235186435045930e-01   +1.278784629619378e-01   +5.856484196505200e-02   +1.463491429551668e-01   +2.560323224197935e-01; +2.801226014528013e-01   +1.754195865573537e-01   +1.185155116871189e-01   +1.629975959454856e-01   +2.108829797525963e-01   +3.145299526694357e-01   +2.947097870468739e-02   -3.670055393469309e-03   +4.646442400874197e-01   +5.123153652107965e-02   +1.874155752303941e-02   +1.455190497873737e-01; +1.947845807556520e-01   -7.540509447567563e-02   -8.159992281013782e-02   +4.020818298545568e-01   +2.218092755164453e-01   +2.813538964624569e-01   +4.734918971924530e-01   +3.790437342535556e-01   +1.810767435129678e-01   +5.456729107530656e-02   +2.278768282184358e-01   +1.434779715320067e-01; -1.199570921191555e-01   +2.028946306499566e-01   +4.552020321604787e-02   +2.122859374137830e-01   +3.329006526547738e-01   +1.705029925086458e-02   +2.573786545734889e-01   +1.611349362502892e-01   +2.781077842173482e-01   +2.410614257634199e-02   +1.769731574148504e-01   +1.820337660053563e-02; +1.422077535149386e-01   +3.093771516378733e-01   +1.746251273850531e-01   +2.262252618992000e-01   +1.666911743426888e-01   +1.004332723039443e-02   +9.083608304232781e-02   +8.123210081603165e-02   +1.489657896986599e-01   +1.802822081787518e-01   +2.805096639037316e-01   +4.642177381563454e-02; +2.351303654928505e-01   +1.382627835924841e-01   +1.398166361038315e-01   +2.941501465322419e-02   +2.764780339275443e-01   +3.187235519108838e-01   +1.298591702651825e-01   +2.327062322579521e-01   +2.632024106286835e-01   +8.248923247094293e-02   +1.227041071782291e-01   +1.397087084657998e-01; +1.837699354828571e-01   +1.780446192380962e-01   +3.709061558891671e-01   +2.107463988880045e-01   +8.496142234097984e-02   +5.028221870515508e-02   +4.888803057066705e-01   +2.009808561177069e-01   +6.312934554827329e-03   +2.329807216142094e-01   +1.567605701149740e-01   +1.193950639708490e-01; -4.030961828186756e-02   +2.234276639418417e-01   +2.423019723566427e-01   +7.903626983706255e-02   +2.090256163211461e-01   +1.503377336876585e-01   +2.739938741924237e-01   +1.721516361405694e-01   +6.814170364259219e-02   -9.602288041664357e-02   +3.290061266585948e-02   -1.822298596401150e-01; +9.958323474712698e-02   +1.988441175169068e-01   +5.645687694039306e-02   -4.916960890299379e-02   +7.536684996425715e-02   -6.532157852940546e-02   +2.577225970315270e-01   +1.533883912835563e-01   +6.564482770532920e-02   +1.870926321518564e-01   +8.989548093853528e-02   +3.879484424788622e-01; +3.799416225761162e-01   +5.878867989057612e-02   +1.009107309108261e-01   -1.697801942753792e-02   +3.628895312914887e-01   +2.372047426607366e-01   -1.127153248654942e-03   +2.364047828035531e-02   +2.988081331980549e-02   +5.495865009476766e-02   +2.686960408620951e-02   +1.001635215803355e-01];
L3E_L3I_iGABA_netcon = [+2.256568463066819e-01   -1.580810064038995e-01   -8.655821128428215e-02   +2.733290863925737e-01   -5.645537864288865e-02   +2.135232835637405e-01   +2.335838285400938e-01   +2.738097555004287e-03   -8.635116944097229e-03   +1.382845392629826e-01   +1.618187059927361e-02   -2.875529982000772e-02; +1.696716450765501e-01   +4.377040287956582e-01   +4.692865277599222e-02   +2.769570010326288e-01   +3.447990601094674e-01   +2.040859198114617e-01   +1.983641757909096e-01   -4.164452332359933e-02   +3.499343481641651e-01   +6.129892917252433e-02   +1.419579293319655e-01   +1.149410348079328e-01; +2.070042536652537e-01   +2.909643442517970e-01   +2.996302055718233e-02   +1.021326038616091e-01   +1.045060370235986e-01   +4.348566468519093e-02   +1.813919482656970e-01   +2.754942911415648e-01   +3.259560323909258e-01   +1.442097821254516e-01   +6.484386397340400e-02   +4.778901062826476e-02; +2.509274761905245e-01   +5.802801498646153e-02   +2.378322926133762e-01   -1.061084153059984e-01   +8.827816866784774e-02   +7.999054018208748e-02   +1.662238803174701e-01   +2.754244438700522e-02   +3.908348968503135e-01   +6.643669015512285e-02   -1.009383369263989e-01   +1.593057710192310e-01; +1.430671997793204e-01   +4.479208910882364e-01   -8.742709502035168e-02   +2.226558903011931e-01   +6.261160293277723e-04   +1.263224448455147e-01   +1.130958358892126e-01   -4.695131461561598e-02   +1.268356974844605e-01   +1.007806195149803e-01   +1.194259872001427e-01   +8.086546133661217e-02; +2.402016935823288e-01   +1.709909371767377e-02   +1.130793439706778e-01   +2.204789437840535e-01   -7.021088863858112e-03   +1.648971030576552e-01   +3.057863905041662e-01   +2.488459373084937e-01   +3.779232011757944e-01   +2.419156933005607e-01   +4.357983287317839e-01   +2.543868183813607e-01; +2.563623012999504e-01   +1.310222846082644e-02   +2.268522930682967e-01   -1.524427294004932e-02   +1.409627871636381e-01   +1.027495504104297e-01   +4.117797267745599e-01   +5.189787685565651e-02   +5.274816167212367e-02   +6.048061934466960e-02   +2.636133749199839e-01   +2.374384701825281e-01; +5.834358921077475e-02   +8.472097759960349e-02   +2.547628644866513e-01   +3.939949251350477e-01   +1.561745409498350e-01   +3.608490299057152e-01   +1.885421121032444e-01   +5.167492621079891e-01   +2.914255678080898e-01   -1.182058189621476e-01   +2.932003578776662e-01   +2.780673499364044e-01; +8.192129892532400e-02   +1.826351071574944e-01   +2.263568867913877e-01   +3.470168131304141e-01   +8.031951796244381e-02   +2.069088779123408e-01   -4.904350610842560e-02   +3.152151373827670e-02   +6.803381915024490e-02   +2.427255365129916e-01   -9.631428846027951e-02   +7.737273892285278e-02; +1.726673581990769e-01   +1.205009374897303e-01   +2.713324203810568e-01   +1.322713943165349e-01   +1.963969881651071e-01   -1.632608139400993e-02   +4.626180941586351e-02   +1.120296612757382e-01   -1.568182273933959e-01   +1.980282965856854e-01   +1.409801384261729e-01   +8.850854129983984e-02; +3.927680908705524e-01   +7.254114293454766e-02   +1.157455878606185e-01   +2.811368052949509e-01   +1.824254449868305e-01   +9.231974417482566e-03   +2.329592885078057e-01   +2.004316633473660e-01   -3.334518392097002e-02   +1.068676397158279e-01   +3.721660303288828e-02   +1.059934487953762e-01; +2.426511939800921e-01   +3.861790198464189e-01   +2.289959331871212e-01   +2.434934278355140e-01   +1.212296268957645e-01   -9.427771011485953e-02   +2.629384488765067e-01   +1.021207077707313e-01   +3.307187496508135e-01   +9.287000549205481e-02   +3.329293781345233e-02   +2.788362149551404e-01];
L2E_Input1_iAMPA_netcon = [+3.316871409697651e-01   +2.000541573971608e-01   +1.672748769249550e-01   +9.060048315104724e-02   +7.689203998057503e-02   +4.003646798629572e-01   +1.958755404420043e-01   +2.387620362813681e-01];
L2I_Input2_iAMPA_netcon = [+1.330516095081977e-01   +2.422099840978430e-01   +8.035961060770958e-02   +6.304690699280477e-02   +1.916490467012574e-01   +3.998904117335004e-01   +1.028646158383957e-01   -6.315015773265123e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
