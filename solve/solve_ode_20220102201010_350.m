function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.496838803759972e-02   -3.235130115304042e-01   +4.814980591725868e-01   +4.104078385009978e-01   -5.338644977889785e-02   +2.790353430197298e-01   -5.055180280896713e-01   +1.446594828604718e-01   +5.235873319888363e-01   +7.536587309025083e-01   +4.242633139023155e-02   +5.304946788149272e-01   +3.187283095728070e-01   -1.329372666657732e-01   -1.668776016183570e-01   +4.042688909803654e-02; +4.147155653292201e-01   +1.068221044413379e-01   -1.222342919290101e-02   +2.965060539450136e-01   -1.193499695119347e-01   +5.091218593266480e-01   -5.723609813463706e-01   +2.140157845317648e-01   +8.581044521411316e-01   +2.698538658930408e-01   +8.582208098894721e-01   +4.572624863318379e-01   +2.989066490385179e-01   -1.224239877535882e-01   +7.597284461317683e-02   -1.947660529870274e-01; +6.853207856736188e-01   +3.365954928402101e-01   -1.222095871604384e-01   +1.464193244290160e-01   +1.097811882996077e-01   +5.419193150632792e-02   +4.103460307518143e-01   +5.289805782390883e-03   +3.930935088731062e-01   +1.138089729454746e-01   +5.323523293706571e-01   +1.351581259733530e-01   +3.356604486705101e-01   -2.284477505441955e-01   -1.242099151744937e-02   +1.776170044526384e-01; +3.380042737079733e-02   -2.643795916276286e-01   -8.258733697934553e-02   +5.490050298318845e-01   -3.883701616123665e-02   +1.983239772470888e-01   +5.256976416436464e-01   +7.108530610178827e-01   +7.048628303999002e-01   +1.483405187673614e-02   +4.634026076933797e-01   +5.922647335293744e-01   +1.808125399188878e-01   +4.115638747699040e-01   -1.013410584828072e-01   +7.405754634489641e-01; +6.239613589880935e-01   +3.265874224570917e-01   +4.032726275276171e-01   +8.256509228578268e-01   +1.888861886753910e-01   +3.483373506131203e-01   +3.757488889529328e-02   +4.206085551936056e-01   -5.286395169093332e-02   +3.704668237594096e-01   +4.733543077650050e-01   -2.937257996869055e-01   +4.467670649663774e-02   +2.184202753876585e-01   +6.624553386591266e-01   +1.337071208743685e-01; -5.182797456245721e-03   +5.414984721528251e-01   +1.006478718389389e-01   +1.015423559762878e-01   +7.914016354528349e-01   +1.641487833602319e-01   +5.292586615984528e-01   +2.334314322663150e-01   +3.550221214735907e-01   +3.234656687252992e-01   +9.936174130545915e-02   -3.232967741963064e-01   +4.336038958452912e-02   +2.479705043288472e-01   -2.635108981782022e-01   -7.852201702077258e-02; +3.458496295627334e-01   +4.565858546926805e-01   +3.109623107082233e-01   +1.708055656962881e-01   +1.386968242239545e-01   +4.623144860193521e-01   +4.555992026870764e-01   +2.028994828408757e-01   +7.787044195056556e-02   +1.196334243270468e-01   -3.279203259150014e-01   +3.871896501181401e-01   +3.854846979924390e-01   +2.209212893517735e-01   +5.183618787216185e-01   +4.227747377944439e-01; +3.328223613270428e-01   +1.942350109832064e-01   -3.305230221748300e-01   +6.204684400120393e-01   +3.870224664041395e-02   +1.938519507332938e-01   +8.486568697578678e-02   +6.485195426127794e-01   +4.889017012035977e-01   +4.211591075634071e-01   +1.531771611728121e-01   +3.175123535635522e-01   -3.641938647109406e-02   +2.085256744387422e-01   -2.959461363032796e-01   +3.017002384364653e-01; +2.717124089107361e-01   +4.365956610619385e-01   -3.297618625058634e-01   +5.411081653706258e-01   +3.651118327150565e-01   +5.586201590233266e-01   +9.729392446079269e-02   -3.845381497606609e-01   +3.962296534323532e-01   +4.538863743766969e-04   +6.832870085185343e-01   -8.327958009484114e-02   +4.571555409845152e-01   +5.210134945041252e-01   +1.025594097024352e-02   +1.725796886286360e-01; +4.082364656369070e-02   +3.612872464779979e-01   +4.765314253976864e-01   +4.107288809568005e-01   +2.443179523424899e-01   +1.114357869847328e-01   +4.638105074204548e-01   -1.435351624026651e-02   +9.189345680987759e-02   -1.273313813273269e-01   +1.651671857944819e-01   +2.032251392369671e-01   +6.898629128003348e-01   -1.342517319732647e-01   +2.467476842997459e-01   +3.606483345959592e-01; +2.229259158924236e-01   +6.081345505555156e-01   +1.914650163919810e-01   +2.131175543942596e-01   +5.048059208859808e-01   +2.494282250135343e-01   +5.790516689816319e-01   +1.140541289405798e-01   -5.209511697379622e-02   +4.746296847435165e-01   -1.973086330206645e-01   +3.184269087905701e-01   -4.929329019368771e-01   +6.398639536985998e-01   +7.046959040478087e-01   +2.884512912348968e-01; +3.953597184843272e-01   +2.496199319151137e-01   +1.030054556391971e-01   -2.677364566641362e-01   +2.940880024320538e-01   +2.223616727562885e-01   +3.225426409927535e-01   +5.003536446651382e-01   +7.544554280699731e-01   +1.454805581433420e-01   +2.458013159337247e-01   +4.176142492595901e-01   +5.622413442095350e-01   +1.824328528169842e-01   -2.913429260400999e-01   +3.012041047292219e-01; +9.477924672116084e-02   +3.380071722374298e-01   +5.695828591851091e-01   +2.067961817002901e-01   +3.283367488557458e-01   +3.523140755454958e-01   +3.662644159052585e-01   +6.294748324707788e-01   +6.641754478684398e-01   -2.598562466067375e-02   +1.977843389538106e-01   +4.086474958741673e-01   -1.507403806856713e-01   +1.171924894535263e-01   +6.497222168788283e-02   -5.188020896261362e-02; -5.633697366366009e-02   +2.488863860557396e-01   +3.344176897392609e-01   -6.460295543138388e-01   +5.982787254293777e-02   +6.649182701853685e-01   +2.766358537209394e-02   +4.136317170565369e-01   -9.430370815991876e-02   -1.263667840373593e-02   +4.905600570587203e-01   +1.445963360740241e-01   +4.607203255958477e-01   +3.459799742826488e-01   -5.200852170775752e-02   +5.191783634670549e-02; +3.057536243530048e-01   -1.971203203482810e-01   +5.203484636678051e-01   +4.942526814598244e-01   -4.580899401430872e-01   -2.528456491947118e-02   +5.576572823457440e-01   -2.901366281935989e-01   +1.201542945102789e-02   +1.376819060146650e-01   -2.541840078594685e-01   +2.381640843044072e-01   +3.094781918708339e-01   +1.444395725916456e-01   +1.079259892300447e-01   -3.025988064467591e-01; -4.984802811790773e-01   +5.410085723890256e-01   -6.338629350919529e-02   +3.435654400821723e-01   +9.703156488444646e-01   +8.965048353081615e-01   -1.410400491784423e-02   +7.337124112883738e-01   -1.985055459246273e-01   +5.102964234671956e-01   +3.396233677109683e-01   +3.677907708950035e-01   +3.177787911663468e-01   +5.462323959539817e-01   +7.348810319131386e-01   +2.248193406172751e-01];
L1E_L1I_iGABA_netcon = [+5.112833115406076e-02   +1.283151891209740e-01   -4.892508815671054e-02   -1.752751453666709e-01   +5.308388202504605e-01   +2.770024928127814e-02   +2.316427203620571e-01   +2.713875270086428e-01   +1.652012650617285e-02   +1.863414808784957e-02   +5.181715219390494e-01   +4.666312086260633e-01   +7.123767197031378e-01   -4.655909055841121e-01   -4.225503517844113e-02   +8.623336693939524e-01; -2.055833153883225e-01   -2.025281878411200e-01   +5.055135434112507e-01   -2.928829492288784e-01   +9.623643956885003e-03   -2.662541517454066e-01   +5.949242172707007e-01   +2.124205299810731e-01   +4.531228795093659e-01   +1.745246027976345e-01   +5.927212569901062e-01   +1.105275496058345e-01   +6.411808463512095e-01   +3.005006539738153e-01   +1.751920732413235e-01   +4.315078780451627e-02; +3.085217611014750e-01   -4.096517931275975e-02   +1.233078054934647e-02   +5.650476208433972e-01   +2.070460887054333e-01   -2.304628269120496e-01   +3.636134770488435e-01   +8.904863678871837e-02   -6.693673674229904e-02   +8.750014880729993e-01   +3.810915051825412e-02   +1.212784508732233e-01   +2.617744879721888e-02   -7.135565798102401e-02   +5.070147950146310e-01   +5.218430440919486e-01; +5.770006515239600e-01   -1.111987114158310e-01   -6.760524471428370e-02   +3.107757857084023e-01   +6.882793994659406e-02   +3.386557877705753e-01   -2.798864795806542e-02   -1.638871607798905e-01   +2.064724080789751e-01   +2.983363511723686e-01   +2.683440643193596e-01   +5.933890277534162e-01   +1.509125922131774e-01   +3.173174649884678e-01   -2.595605543467563e-02   -3.286582211192127e-01; +7.449423632517510e-02   +5.047763250842684e-02   -3.777412122529250e-02   +1.682426509228679e-01   +3.851217957497515e-01   -2.325902192090362e-02   +1.225941476277765e-01   -1.253746124692198e-01   +4.439501259435755e-02   +2.939461899250662e-02   -3.313979636656988e-01   +7.272588939970499e-01   +1.795459413398545e-01   +1.667465779969860e-01   -8.455008910752694e-02   +3.998073849016421e-01; +1.391871393431644e-01   +1.157467946753058e-01   +1.728174216692680e-02   +4.363183155402248e-02   -6.671877671367232e-03   +6.218791268921640e-01   +1.883484288715648e-02   -3.370746988043105e-01   -1.363580737041924e-01   +2.092842550396509e-01   -9.639105574129858e-02   +3.113616433632645e-01   +1.499677782325222e-01   -2.379190119557733e-01   +5.318303804075647e-01   +1.880874145014609e-01; -1.056435929975212e-01   +4.659637228754399e-02   -2.240229130323039e-01   -1.862097471260234e-01   +3.918076006689881e-01   +1.713670551200095e-01   +5.908007652676552e-02   -8.809048488874277e-02   +2.055478243511602e-01   +2.103139671146425e-01   +4.484633026139222e-01   +3.428410273757813e-01   +7.911997116285598e-02   +7.985344091574351e-02   +8.871678783079273e-01   -2.549808973370689e-01; +1.813066429018021e-01   +3.228605002323742e-01   +2.830960933127384e-02   +3.807946867847750e-02   +1.870428092005205e-01   -3.626987248365374e-01   +4.540188094743800e-01   -3.610767143888439e-03   +4.787820068060203e-01   +2.558917582250790e-01   +2.558990056998698e-01   -4.092882889696655e-01   +1.848549919160064e-01   +3.204493599894390e-01   +3.993890784753078e-01   +1.034869270454015e-01; +6.031864615666989e-01   +7.672669281190709e-01   +2.952577559183360e-01   -1.444489895124881e-01   -2.742912441630831e-01   +2.958276036215677e-01   +1.804042275585921e-01   -3.959896193369823e-01   +1.306568784773151e-01   -4.675626837345905e-02   +1.479549890292213e-01   -7.242807164160334e-02   +1.402515450919937e-01   -1.340039228277236e-01   +6.225958786313259e-01   +7.773148459253722e-02; +1.090299845245959e-01   +5.156058409952873e-01   -2.417848275924874e-02   +8.940481460210917e-02   -2.112434494750388e-01   +1.199177449364745e-01   +1.119619967617301e-01   +1.700452485081588e-01   +3.111607265716371e-01   +3.205137822352831e-01   -3.275397438119306e-01   -1.326421019355619e-01   +2.212606272877710e-01   +5.669955138864037e-01   +2.884233792440454e-01   +1.612807303964169e-01; +2.571782487785347e-01   +2.829229771618662e-01   +3.760205614005772e-01   +4.068536966415089e-01   +2.207918567452580e-01   +2.812961590948415e-02   +2.259248155148760e-02   -1.246373892719410e-01   +3.252632928238873e-01   -3.324331241500807e-02   +3.086258792358806e-02   +7.276784846018317e-01   +6.320604061339543e-01   +5.653981243735824e-02   -1.763813546172158e-02   -1.689022930240672e-01; +3.475822001635063e-01   +2.846975391647566e-01   +9.866845057989292e-02   -2.510550285777889e-01   -4.145466354200447e-03   +2.834363089000754e-01   +7.844328991220513e-02   +3.689239784040784e-01   -3.031786827078412e-01   -5.824832314476881e-02   +3.296490799938203e-01   +3.236054975200842e-01   -2.022634444627017e-01   +2.076140312016403e-02   +3.379872555140875e-01   +4.372560876080117e-01; +1.589741980163398e-01   +2.952491304298420e-01   +1.587480304959353e-01   +6.340633084058603e-01   -1.900628304549802e-01   +3.305343764333639e-01   -4.628033396172287e-02   +3.760551354675888e-01   +4.644900530997159e-01   -2.989148727156439e-01   +2.059854039496881e-01   +1.790166688656026e-01   +2.584568509862064e-01   +2.516835232358196e-01   +5.199437164930127e-01   +2.492415631192749e-01; +5.294142492158874e-01   +1.482353742264697e-01   -5.490378010928726e-02   +2.098605346470181e-01   +1.448434421310808e-01   -1.389503951311001e-01   +7.986318932542323e-02   +1.881274734052029e-01   +2.770585010367934e-01   -9.672233176506585e-02   +3.890709883106821e-01   -2.983233941848418e-01   +3.094511413616224e-01   -5.983533235751828e-02   +9.389099758066419e-02   -3.508547310592889e-01; +3.482453293421321e-01   +2.914384102443805e-02   +1.198687903846131e-01   -8.977253971963750e-02   +3.451353989797755e-01   +2.449842791419840e-01   +3.462969425066289e-01   +3.165281737847185e-02   +3.686395267901033e-01   +4.854574992133959e-02   +2.287273415054297e-01   +2.129328676561196e-01   +2.431784463601079e-01   -1.840075554810396e-01   +5.292675092244122e-01   +4.750305316061472e-01; -3.355474723238715e-01   +2.239363523705261e-01   +2.329987816612745e-01   +8.921580520089692e-02   +4.131437371921390e-02   +5.169053217698261e-01   -7.186505099164685e-02   +1.216078829415504e-01   -1.882959589019740e-01   +3.878793557162370e-01   -3.409699879314158e-02   +3.922455265536441e-01   +8.886702264356630e-02   +2.350791350447015e-01   -1.586657536605748e-01   +3.613789315734640e-01];
L2I_L1I_iGABA_netcon = [+7.412873161551214e-02   -2.443175312690128e-01   +1.773909886710832e-01   +5.325500698075744e-01   -1.656136455230280e-01   -3.137866120904834e-02   +1.670401428673034e-01   -3.042399081636236e-01; +5.368910466419642e-01   +7.970672595099193e-01   -2.019434731557394e-01   +1.498176422828512e-01   +2.990346300674875e-01   +5.041532214070004e-01   +4.279557844104996e-01   -1.897071005117509e-01; +5.867979355966377e-01   +1.720515700754855e-01   +1.098254911009606e-01   +2.042413180968978e-01   +3.845425161808688e-01   +1.878579607088600e-01   -4.505414412473875e-02   -1.332077150507454e-01; +4.986787052923712e-01   +1.490518233146857e-01   +3.753865167130859e-01   +2.140250718813686e-02   +7.058121686325222e-01   +4.433027864061433e-01   +5.902548394220005e-01   +1.899535337480724e-01; +2.611799542843357e-01   +5.425795543843820e-02   +3.265342646987119e-01   +3.755822976346385e-01   +4.758347615316700e-01   +2.910304592999806e-01   +3.028392770762054e-01   -3.465161128172484e-03; -1.563260036206297e-01   -1.169058817312871e-01   +2.120220184223395e-01   +3.326042604264290e-01   -1.937625256047447e-01   +3.670885201630484e-01   +8.198160775119655e-02   +5.236090012709768e-01; +6.754498261819989e-01   +1.679844392953080e-03   +2.988298829005762e-01   -2.149177635034435e-01   +3.174071991406808e-01   +4.467468424662658e-01   +5.183461799664383e-01   +8.078876355090268e-02; +1.104095886639515e-01   +4.053360130987308e-01   +3.182704459664759e-01   +3.747030955089514e-02   +3.187119771652125e-01   +3.069985597582279e-01   -3.290707635085887e-02   +3.195992654999483e-01; +3.025908046930985e-01   +1.000000000000000e+00   -5.052618158914260e-01   +3.086420992202453e-01   -2.573337882409614e-02   +2.752707390122908e-01   +3.296398545741615e-02   +3.783461185477642e-01; +1.340833540097193e-01   -2.678876909502559e-01   +2.175553290196602e-01   +3.628156612313853e-01   +4.848536095639431e-01   -5.737387262299585e-02   -2.922324465692876e-02   +3.078450548111965e-01; +4.691224519502549e-02   +1.575873226240375e-01   +4.193888813211563e-01   +1.226591666795700e-01   -1.417809638894415e-01   +5.476455867625053e-03   +1.638449110106639e-01   +3.496136654186451e-01; +8.989164593650480e-02   +4.836418671056837e-01   +6.172265109468755e-01   +3.938644395918467e-01   +9.689416299217055e-02   +1.896037515853183e-01   +3.582610060497555e-01   +3.865812755696975e-01; +3.271611894678857e-01   +6.462375264998843e-01   +4.397161979445843e-01   -2.242752874742848e-01   +1.997579734447204e-01   +2.719370134697192e-01   -3.098439476812572e-01   +3.382872719337818e-01; +1.980150514797126e-01   -2.302260637864405e-01   +1.728573751200923e-01   +1.598683547305692e-02   +6.420685017090456e-01   +1.544751135814990e-02   +4.337240171737811e-01   -7.706921381836218e-02; +2.440597053855334e-01   +2.220801740612336e-01   +2.932392497365617e-01   +2.680728263357599e-01   +1.496802996235634e-01   +9.657929274216005e-01   +2.095469470091066e-01   +3.191511324900365e-01; -6.071242088435284e-02   -1.445416214470751e-01   +2.310033220863895e-01   +1.051669392311297e-01   +5.178546011180907e-01   +2.006298514272907e-01   +1.676294815403841e-01   +1.732234193819702e-01];
L1I_L2I_iGABA_netcon = [+3.042192447128549e-01   +1.887921299338236e-01   -1.054729586278694e-01   +4.919013271700477e-01   -2.079440523567264e-01   +1.508278710721354e-01   +1.095102961859134e-01   +3.781416980787258e-01   -2.431527059490587e-01   +5.879662501748418e-01   -1.972351159091185e-01   +1.055070856557339e-01   +3.476233630628404e-01   +3.196272486010839e-01   +2.632185779687540e-01   +5.460123199949679e-01; +4.642781537413715e-01   +3.118752648129526e-01   -1.254812250086237e-01   -1.309584455145006e-01   -3.392660167561182e-01   +1.539889551456940e-02   +5.320126673047759e-01   +4.520757015881682e-01   +4.936013006679592e-01   +8.179022148318126e-01   +2.094668557431559e-01   -4.059142324955278e-01   -9.739205043849948e-02   -5.532383938170151e-01   +3.837092244456418e-01   +4.304460423529101e-01; +3.977474922121386e-02   -2.379393265962789e-01   +5.531487802407168e-01   -1.673764695817080e-02   +1.181250666227723e-01   -2.157747243537980e-01   +7.344546846607477e-01   +5.424185461014832e-01   -3.614314913389731e-01   +2.304783699440631e-01   -1.542805945235166e-01   +4.478394987756827e-01   +7.786187576750426e-01   +5.048752287272954e-01   +7.893057387468784e-01   -2.209464453024808e-01; +3.955641707620521e-01   +5.016812381310752e-01   +4.467556128846716e-01   +1.525217421526028e-01   +6.112461834405468e-01   +4.142371266790421e-01   +8.771501195086459e-01   +5.628930076608102e-01   -2.961406429847303e-01   +7.009495240077946e-01   +6.733165429324878e-01   +3.543469882345981e-01   +4.131410151082373e-01   +1.709122813998854e-01   +2.509032262915407e-01   +2.627505112714244e-02; -4.149478691535629e-03   +6.987893600609953e-02   -2.948774901143001e-02   +2.195680311735263e-01   -1.579503936556184e-02   +7.726662793768599e-01   +7.551786736110059e-01   +2.083462546638702e-01   +5.775968741322169e-01   +5.800380777533322e-01   -3.311841919130595e-01   +1.670880789112254e-01   -5.532457648079168e-01   +4.283418506499757e-01   +1.873584016438814e-01   +8.005989496288070e-01; +4.993527468695921e-02   +3.604513782662269e-01   +3.696218339428032e-03   +6.248789733685182e-01   -1.343002391332886e-01   +3.877769562717446e-01   +4.915959284089129e-01   +5.732336918907410e-02   -6.230075858607044e-02   -2.379535281073310e-01   +3.196663391532926e-01   -1.865867809192387e-01   +5.460674847952456e-01   +1.000000000000000e+00   +4.618993358794628e-01   +6.698211534665833e-01; +4.544103880802500e-01   +6.079595864645174e-01   -6.630028021256190e-02   +1.720109995503982e-01   +4.223918329268037e-01   -2.999961224579815e-01   +4.864496373938977e-01   -1.910136135097730e-02   -4.525957585235528e-02   +4.429269639201961e-01   +5.418520389666445e-01   +3.044856544035269e-01   +1.547386147448462e-01   -1.734480701846115e-01   +1.161849229472944e-01   +5.206276824212349e-01; +4.658795552890376e-01   +3.005732575444455e-01   +1.495453265663001e-01   +3.040185677223662e-01   +5.341962315846023e-02   +5.246390738150227e-01   +2.435827580566097e-01   +1.365981953842856e-01   -1.311787657172515e-01   +3.644176841143960e-01   +7.958501189657838e-01   +5.892627777747877e-01   +4.038312618453607e-01   -1.362617516474241e-01   +4.189378050768884e-01   +2.455822596238622e-01];
L2E_L1E_iAMPA_netcon = [+5.537015137186847e-01   +7.285012664135052e-02   +1.013955543157346e-01   +3.358669291109992e-01   +1.000000000000000e+00   +5.412308866199227e-01   +4.842336720635844e-01   +1.417432731056259e-01; -3.469036930734612e-01   +3.062002210919846e-01   -1.663240691989879e-01   +9.176348408150357e-02   +5.544219469863109e-01   -7.769114256556371e-02   +3.760832383757513e-01   +3.453380808769230e-01; -4.049355368283235e-02   +5.093062833494005e-01   +4.510265048532418e-01   +3.351164034614081e-01   +1.507440715030151e-01   -8.122137988242177e-02   +3.579007678463360e-01   +2.491722938785599e-01; +2.853550077418311e-01   +2.349997256539642e-01   -2.505403942514454e-02   +4.660830783235876e-01   +3.099345007887053e-01   +1.338655328152964e-01   +1.515206802243859e-01   -2.405249341102803e-01; -1.871805879720293e-01   +2.716871457299843e-01   +4.982825205798959e-01   -1.716216141055897e-01   +1.295600962918619e-01   +8.200842025919687e-02   +3.366196579609041e-01   +5.437819716367114e-01; +4.082559843277753e-01   -2.500840248962077e-01   +1.710470532692423e-01   -5.104709803116226e-02   +5.500546323917060e-01   +7.499362720366929e-01   +3.894971475733395e-01   +2.857837992638932e-01; +9.182826354917957e-02   +4.348801028880450e-01   +3.004162601187383e-01   +9.788366268618430e-02   -2.933631060217989e-01   +2.394882922224687e-01   +9.903000924320122e-01   -1.411395788786883e-01; +2.365821413923291e-01   +4.003489878363365e-01   +8.237298932457072e-01   -2.388211358770667e-01   +3.541708990390340e-01   -9.567812516945084e-03   +1.960685186055714e-01   +1.877547684340412e-01; +4.801225164144901e-01   +1.699960828463134e-02   +3.554666143208832e-01   +6.857014036428473e-01   -1.254279353001224e-01   +4.608147471324496e-01   +2.849267905416332e-01   -3.150482524749802e-02; +3.157184848286170e-01   +4.509900530610544e-02   +2.596216706207382e-01   +3.654493260896297e-01   +1.994233760995094e-01   -1.912584080764900e-01   -1.482669276410609e-01   +3.589912157411320e-01; -3.206103694746474e-01   +4.607492865997412e-01   +3.995338317634707e-01   -1.631354120026887e-01   +1.504757817802890e-01   +7.672975850223957e-03   +2.235120694493604e-01   +1.772461707399651e-01; +4.683488169145105e-01   +3.575648309866452e-01   +6.080069123411784e-01   +3.656234328165288e-01   +8.714859084114454e-02   +4.139725432517218e-01   -1.316170954811280e-01   +1.508368069546021e-01; -2.035525337864444e-01   +1.988129535191245e-01   +2.553162374841168e-01   +4.246633797352983e-02   +3.400753185354380e-01   +2.145450269092408e-01   +1.901139773223275e-01   +4.593058691986154e-02; +2.570145281074827e-01   +5.800428104338171e-01   -3.905907114396011e-01   +2.635196696378214e-02   +4.814900617027364e-01   +2.717659375893905e-01   -1.849576445811827e-01   +2.919945057495824e-01; -7.317451098431473e-02   +1.738424935366391e-01   +3.336150764315433e-02   +5.507763823636939e-01   -1.033801056346558e-01   -4.904411063423130e-03   -4.581413031128741e-02   +2.785977032067850e-02; +5.560233610886859e-02   +1.950571973493096e-02   +1.734571590680968e-01   -1.284502376467417e-01   +2.136451589013408e-01   +2.625140419924595e-01   +4.115354103888010e-01   +6.622382339898153e-01];
L1E_L2E_iAMPA_netcon = [+2.660960306153031e-01   +2.609622271326588e-01   +2.071371575064864e-02   +7.094351551128818e-02   +4.322538853896672e-01   +3.544444158235815e-01   +6.940154198819999e-02   +2.375253477767718e-01   +7.579135899065821e-02   +3.808658911096801e-02   +4.602516087289343e-01   +1.519897151391345e-01   +2.808901674865812e-01   -4.826590692503215e-02   -3.306100843268928e-01   -6.788710476106406e-02; +2.097995752980046e-01   -3.780666439950618e-01   +8.473406409887773e-01   +4.472117753742465e-01   +2.290647613406357e-01   +7.886366781645515e-02   +6.166404227919936e-01   +3.140907602560565e-01   -1.441576783518204e-01   +1.974176687553737e-01   +3.465058207181704e-01   +3.025741408470819e-01   +4.394479755063765e-01   +4.252355182256859e-01   +4.854456933984220e-01   -1.622604367082605e-01; +6.072491225680831e-01   +3.025607939637575e-01   +7.053432785780579e-02   +1.488535082325720e-01   +1.392976096848709e-01   +4.125184965171103e-01   +2.009396891905603e-01   +3.497155335564532e-01   +1.277904140521984e-02   -1.148840642895127e-01   +4.803106639851803e-01   +6.986773382625810e-01   +1.186776896713090e-01   +4.252790707769491e-01   -9.502886405690229e-02   -1.352728162135474e-01; +2.921780037373109e-01   +2.550018920506434e-02   +1.509794264530178e-01   +1.997977743401964e-02   +1.724865011049876e-01   +5.223767318617514e-01   +1.000000000000000e+00   -9.272261885108610e-03   -9.066156858266272e-02   +7.350180544032923e-02   +2.207723568233800e-01   -5.623300032632157e-02   -1.184907269845215e-01   +8.053560869928175e-01   +3.065750112211063e-01   +1.190221752963573e-01; -1.245655056101862e-02   -3.672678502198272e-01   +4.620015084729440e-01   +1.315930393055004e-02   +4.547273393702870e-01   +1.005418123463689e-01   +3.479411441855860e-01   +1.347486641164351e-01   +3.641084811040301e-01   +2.694075583665696e-03   -1.231940466244177e-01   -4.140060361781244e-01   +4.179639772054827e-01   -1.610321624882698e-02   +8.489268959585511e-01   +2.956613731980511e-02; -3.873367753325251e-02   +4.052722163048440e-01   +1.326973518465686e-01   +6.734848762888966e-01   +4.370863043518739e-01   +2.446606278533990e-01   +6.129123421037082e-01   +2.647857407916851e-01   +4.278741116882794e-01   -1.622331632085925e-02   +5.065400492054700e-01   +1.653174378384100e-02   -2.566926312053468e-01   -1.844975304435218e-01   -5.205514517620683e-01   +1.870822613426260e-01; +1.873730786279543e-01   +1.432402744201917e-01   -2.609702595251371e-03   +4.742728392038191e-01   +3.109087559287961e-01   +3.705636925140673e-01   +5.093796898640821e-01   -1.928523716151700e-01   -1.328150004815462e-01   +1.216274140344601e-01   -1.803569732488873e-01   -1.048116424717688e-01   -2.667436031458187e-01   +5.814406044939278e-02   +4.816619088945259e-01   +3.217094470843762e-02; +3.275579936134373e-01   +4.556851347106611e-01   +2.567791137474472e-01   +4.759284990198759e-01   +3.953236515953831e-01   +8.643167062115796e-01   +5.733479579938175e-01   +1.538773685244109e-01   +2.386005381858047e-01   +1.597596009562890e-01   +4.558645171019065e-02   +1.548950275930804e-01   -3.274553896562152e-01   -2.011008756959383e-01   +3.301742752397452e-01   -6.288544228052441e-02];
L2I_L2E_iAMPA_netcon = [+2.417665016439337e-01   +7.687025512149600e-01   +5.401725006122083e-01   +1.615788579626863e-01   -1.079480968461714e-01   +5.338065230057056e-01   +1.766314087879738e-01   +6.344251520217048e-01; +7.350256636898640e-01   +5.940260093880909e-02   +9.989879149005276e-01   +7.046253808992409e-01   +5.499044422313442e-01   -1.138045314726096e-01   +1.264623551397647e-01   -2.452190122904268e-01; +1.435137896536475e-01   +3.671517610161724e-01   +1.861482680007037e-01   -2.014535655486751e-01   -1.737711526208052e-01   +1.323766771284870e-01   +4.696767276207541e-01   +2.014088041154821e-01; +1.951775849110179e-01   +3.065394866909511e-02   -3.219430789153068e-01   +6.145917944987711e-01   +2.729279280348430e-01   -4.708363431516437e-01   +4.144517643486378e-01   +1.670271023847040e-01; +3.776000722304853e-01   +8.619666775314777e-02   +1.572855615631241e-01   +5.580518164092917e-01   +2.585686054985370e-01   +1.073055255094145e-02   +5.529988371419552e-01   -1.311976695635528e-01; +2.878522714816280e-01   +5.255072455343740e-01   +1.202588640364433e-01   +5.543219602807706e-01   -8.189922462559934e-02   +3.602449492122637e-01   +2.557671154106975e-01   +1.348896678805445e-01; +5.281448161780755e-01   -1.606134379783797e-03   +5.347358892045060e-01   +6.144757954335254e-01   +4.098592865067342e-01   -2.332100515913830e-01   +8.629222832869353e-01   +8.580784074332026e-02; +1.650902224209132e-01   +7.551334611746807e-02   -3.288297324775786e-01   -1.307753007099177e-03   +7.025056047819514e-02   -1.186323308648544e-01   +4.498625203993669e-02   +5.276139320119376e-01];
L2E_L2I_iGABA_netcon = [-2.939654214563175e-02   +1.717044396989393e-01   +4.938375669775000e-01   -2.481591130680428e-01   -3.226070788305926e-01   -1.641667420578838e-01   -1.580442561543018e-01   +5.231732126791127e-01; +2.369226776643775e-01   +2.478415462022801e-01   +1.345135744670954e-01   +6.459083832270277e-01   +5.903090751851088e-01   +3.309536991270484e-01   -5.634622649343717e-01   +1.685051124353862e-01; +7.692348606825117e-02   +6.967577399416904e-01   -2.304859381887712e-01   -3.888333630281481e-01   +2.526881351758501e-01   +5.594733996117378e-01   +1.469461319861331e-01   +4.236613879551568e-01; -2.075904457346912e-01   +4.642177103772569e-01   -2.121523275818013e-01   +7.868323033897445e-01   +5.333818334224797e-01   -3.711361456534195e-01   -3.146293740044620e-01   +3.854816309734473e-02; -1.263625126911082e-01   -3.656377979539999e-01   -5.175716610105603e-02   +2.147408258013052e-01   +7.918939569014137e-01   +3.304938253632571e-01   -1.472533092941264e-02   -6.239580922890295e-02; +6.553140734753067e-01   +1.928112231125187e-01   +2.633219704743827e-01   +4.162611016114995e-01   +2.898695957027163e-01   -4.114781391009533e-01   +3.799814682667251e-01   -4.657953557303085e-01; +3.507973431639551e-01   +2.391916536964285e-01   -2.157997713451572e-01   +1.105631645111916e-01   -1.943184186425991e-01   -2.165981693154474e-01   +1.958005412577352e-01   +7.217232843629581e-01; -1.684587737270940e-01   +4.072525729169798e-01   +4.210438412712897e-01   -2.943601629759565e-01   +3.054823961444211e-01   +5.055468676314998e-01   +3.221072433649947e-01   +5.476536784404645e-01];
L3E_L2E_iAMPA_netcon = [+3.269717465907822e-01   -5.012529381392672e-01   +2.224748413541746e-01   +2.322881910954072e-02   +5.097259038417613e-01   +1.786588270658510e-01   +2.076796582917153e-01   +5.507769240753725e-01   +2.492135799888200e-01   -2.280475456472522e-01   +1.523235465928075e-01   -8.001811915373194e-02; +3.153783234342257e-01   +6.330738851579216e-01   +1.667910263872214e-01   +2.646917971598804e-01   -2.416613286781296e-01   -4.618619568040733e-01   +6.917625820304435e-02   +1.495294068270731e-01   -3.116572512854320e-01   +2.478844625520647e-01   -9.821871965992467e-02   +5.086377001110355e-01; -3.458511468145558e-01   -2.296896876611840e-01   +2.789489935585359e-01   +3.749270105826064e-01   +8.755337524552825e-01   +1.933484673894408e-01   +3.539220650576215e-01   +2.126024156585632e-01   +8.292706061322287e-01   -3.393188085706320e-01   +7.122898745234899e-01   +5.814222364985195e-01; +3.678712509539040e-01   +1.758071191175535e-01   +4.620014198347148e-01   +3.328757469521652e-01   +5.646290287935305e-01   +2.181378013260306e-01   +2.847026211784322e-02   +3.355579471462975e-01   +9.113096645544243e-02   +1.483926117321955e-01   -4.350170426492625e-02   +6.556290763812422e-01; +2.313020062396369e-01   +1.891253071230216e-01   +3.326976232284931e-01   +5.413483854492834e-01   +4.334554019981654e-01   +1.466497185536369e-01   -4.375009779518317e-02   -1.891728563920987e-01   +2.171959403532772e-01   +4.301841474641614e-01   +6.120659276165429e-01   +5.041678882642353e-01; +4.533991883541552e-01   +2.914334370028664e-01   +2.265163333022471e-01   -3.813258137070362e-01   +2.137354590098951e-01   +4.773841390477181e-01   +1.089878242592659e-01   -2.264967929046679e-01   +1.489340722395426e-01   +3.583494556156435e-01   -1.078535256973564e-01   +1.018236628774030e-01; +1.304078676935139e-01   +3.316992773358219e-01   +8.733805668605200e-01   +3.510241715936509e-02   +3.393864934956360e-01   +3.725152928354230e-01   -1.593071916718134e-01   +6.393625218978478e-02   +2.370741997605107e-01   +3.519978172227345e-01   +5.523345260386490e-03   +3.271111525402965e-01; -2.628967566090623e-01   +1.000000000000000e+00   +4.946587915982231e-01   -4.435544428723773e-01   +5.082865974844222e-01   +1.199717519455150e-01   -4.152868849467969e-02   +3.017060880215806e-01   +4.027602180546864e-01   +3.811920025404482e-01   +1.086775619547858e-01   -1.238143176727776e-01];
L3I_L2I_iGABA_netcon = [+7.605545891297156e-01   +3.683075776674938e-01   +1.807208614679052e-01   +1.393556318149646e-01   -4.288803870845733e-01   +6.622519089586185e-02   +9.801379061150980e-01   +6.274279111695825e-01   +8.012844947448933e-01   +1.980187724392812e-01   +3.002684778550636e-01   +3.183612603522167e-01; +2.919274288941904e-01   +2.024002434196165e-01   +1.627355404644362e-01   -1.054717685231482e-01   +3.671469595492893e-01   +2.495297308212736e-01   +4.981650799010184e-01   +3.171543308164132e-03   +2.510657684368650e-01   -1.244347264221871e-01   +3.805251371403593e-01   -2.042439825529859e-01; -2.079573272209632e-01   +6.335184293012844e-01   +2.722372522311847e-01   -2.203814198820535e-01   +4.647401879156153e-02   +1.861841599883149e-01   +2.067036296894731e-01   +2.036665651070035e-01   +2.222719413737410e-01   -2.955439046596067e-02   -2.761810131567281e-01   +7.636472615153357e-01; +4.927759742931298e-01   +4.217604657133370e-01   +5.201653882320866e-01   -2.039449684532705e-01   +2.784764282240502e-01   +1.164474952792658e-01   +3.284946996327623e-01   -2.361432330518748e-01   +5.327965039636079e-01   +4.189989673139564e-01   +6.644297278855766e-01   -7.408110967082354e-03; +2.956472135657847e-01   +4.438897786497527e-01   +2.649550648909046e-02   +9.430421079896673e-02   +6.338995720805667e-01   +5.081707288961382e-01   -1.378088631468647e-01   +8.479679251536261e-01   +5.478216313670641e-01   -1.149491160761218e-01   +2.296098087508812e-01   +1.795330178012475e-01; -7.994342381479692e-02   +5.470050832614108e-01   +2.918626064192475e-01   +1.658885536686124e-01   +6.033259199309896e-01   +4.368016803387763e-01   +1.617802305810838e-01   -2.214039226448022e-01   +2.759838940584709e-01   +4.242155218447362e-01   -1.082556802064070e-01   +3.084038052333387e-01; +4.800886616555118e-01   +3.253903428219182e-02   +4.502094526213947e-01   +8.335907054449915e-02   +3.592698179170105e-01   +5.621877095530521e-01   +4.716826301183815e-01   +8.753542376612161e-02   -5.340359297908489e-01   +8.140488295995344e-01   +3.626032654007971e-01   -1.058077062379688e-01; -1.077373815634299e-01   +2.555455799232548e-01   +2.956028005520846e-01   +3.034337245639556e-01   +6.475830524856048e-03   +5.768053291229527e-01   +5.346182674935930e-01   +6.455193443324914e-01   +4.448829911170134e-01   +4.539829958191840e-01   +3.320250454821131e-01   +4.615491333344203e-01];
L2E_L3E_iAMPA_netcon = [+5.973091552007285e-01   +2.760652931708695e-01   +4.504020003830005e-01   -4.558717553654840e-01   +1.254366741851583e-01   +2.624719469309630e-01   +4.097241337506148e-01   +4.224518185806322e-01; -4.647722633554666e-02   +2.619713642938784e-01   +9.713990437731251e-02   +2.770947870372106e-01   +5.722681736549083e-01   -2.380010473710583e-01   -1.788957015189769e-01   -2.810299209183197e-01; +2.985233363850311e-01   -2.411509772209265e-01   +2.767889063650842e-01   +4.883538902397146e-01   +2.457079751711400e-01   +1.403476636782791e-01   +2.099613617024381e-01   +2.148430917067181e-01; +3.057034144217549e-01   +3.227065735203278e-01   +7.653418155893564e-01   +6.434415483679068e-01   +1.736364035339961e-01   +7.235074427633104e-01   +1.666810052356091e-02   -1.563060938571620e-01; +2.580961573376565e-01   -2.817129192800718e-03   +7.030123939778193e-02   +5.507561438095118e-01   +4.254528800302373e-01   +7.849223267832896e-02   -9.898758495018850e-02   +1.904358869644665e-02; +2.300632513020223e-01   +6.636197833896733e-01   +5.667042800359927e-01   +7.129082381363219e-01   +3.651305520797101e-01   +2.026951587873476e-01   +2.996586123643774e-01   +1.652025198050555e-01; +3.262973245734622e-02   +5.375935865259307e-01   +6.898375825032543e-01   -1.903490836124368e-01   +1.012325136189629e-01   +8.939491421962165e-02   -3.619127239124696e-02   +5.042010730174138e-01; +3.302619090809956e-01   +3.684330426003771e-01   +1.962544840564114e-01   +1.438306202832982e-01   +1.762455389968652e-01   +2.242744632835112e-01   +2.573814532105479e-01   +8.375587915714511e-01; +3.728773728989315e-01   +6.609053030940749e-01   +3.478994479895532e-01   +2.048739367191376e-01   +1.894430381756348e-01   -3.883207395954835e-02   +6.266937968224249e-01   -8.143722254768448e-02; -5.133071581871622e-02   +2.775402764138691e-01   +2.529276953695084e-01   -6.531660005677990e-02   -1.129405297487306e-01   -2.069349347807738e-01   +2.729641794786699e-01   -7.308723958682883e-02; +5.245016499025864e-01   +1.013947540668180e-01   -2.314087237682040e-01   +9.542126563694489e-01   +2.148663371133165e-01   +3.672700854998069e-01   +4.593953104482459e-02   +3.431059941633899e-01; +1.515907347584386e-01   +7.606654956228086e-01   +3.887382629645518e-01   +5.418069454138122e-01   +1.009527437566476e-02   -1.214039737510092e-01   +1.252966179085742e-01   +2.554925465369197e-01];
L2I_L3I_iGABA_netcon = [-1.912471550440836e-01   -4.225714543844629e-02   +6.844632973587425e-02   +4.174585865717739e-01   +5.359096024785295e-02   +7.099777192562001e-01   +3.982977131862014e-01   -1.597545749715962e-01; +1.667275794253878e-01   +2.593988442081781e-01   -2.302377517183852e-01   -4.127789809930003e-02   +2.351248735989204e-01   -2.761376653672908e-02   +5.611337550533143e-01   +4.114389428999793e-01; +7.930986427990455e-01   +9.828521842342960e-01   +7.450908990594772e-02   +6.875333921155206e-01   -3.021301107377222e-03   +8.283331685056926e-01   +3.830323051496190e-01   -2.662666045104507e-02; -3.588950547128106e-02   +3.349963064909798e-01   +6.898340251490807e-01   -4.514000454956979e-01   -1.182980271607861e-01   +5.957849921562890e-01   +1.415466751025201e-01   +3.059716451254696e-01; +4.483760337910954e-01   +1.507213458149397e-01   +1.326844282694528e-01   +3.094822279071108e-01   -2.774026748686666e-01   +2.445370427925960e-01   +9.101717528750761e-02   +1.713849504652933e-02; -1.846785258027241e-01   +3.186657745882935e-01   +9.205166026136206e-01   -1.630535175972537e-01   +3.702403812356815e-01   +8.844534878491783e-01   -4.677584422729179e-01   +1.946391582621219e-01; +5.080433926469833e-01   +2.473130837208670e-01   +1.781230315607677e-01   +3.838104861266943e-01   +1.873235590766615e-01   +5.982666469089193e-01   +8.804163722377670e-01   +4.766762211780877e-01; -3.714181582213058e-01   +5.802209455552030e-01   +2.880667620811577e-01   -7.931403337984261e-02   +3.076269555493834e-02   +3.010215824735551e-01   -1.488889689277797e-01   +7.112173884024923e-01; -9.055561779514548e-01   +8.465041346303264e-01   +6.685058179931019e-01   -1.477278797345193e-02   +3.668703600268085e-01   +2.643497230946082e-01   +5.997393346885708e-01   +1.904093809578076e-01; +1.730200018531498e-01   -2.491129608815089e-01   +1.990822209251533e-01   +6.680838504805417e-02   +3.348533825138978e-01   +6.227561504222002e-01   +2.537101304209026e-01   +4.978918390213029e-01; +7.368839704876283e-01   +4.525645656215049e-01   -5.039465571537892e-01   +3.842378529018468e-01   +3.596772676493242e-01   +1.362147105140901e-01   +7.444081635555877e-01   +6.849919992738559e-01; -6.264818464369446e-01   +8.681914685529617e-01   -2.293113077586088e-01   +8.458850873766358e-01   +6.563505991197315e-01   +4.157803735159852e-01   -1.945440847042085e-02   -5.704122670569743e-02];
L3I_L3E_iAMPA_netcon = [+1.449079759218292e-01   -1.180457542597161e-01   +2.906963170826888e-01   +2.475844175050212e-01   -8.249731718407037e-02   -3.022079688777320e-02   +1.675888180321684e-01   +2.919425079195384e-01   -3.470673417856488e-02   +4.242233513141011e-01   -2.241867016140053e-02   +2.924818063375410e-01; +1.278516018603301e-01   -3.028841185392574e-02   +1.108117425193561e-01   +6.091396297684868e-01   +3.262723148357934e-01   -1.444724971153434e-01   +3.859294796480219e-01   +4.073244223226162e-01   +3.150188699958629e-01   +1.045016269208808e-01   -1.706194273110000e-01   -3.948632558528434e-02; +1.174422241195929e-01   +3.845956417828554e-01   +5.063165339874900e-01   +1.806198928806443e-01   +6.236755246178990e-01   +2.107942485395709e-01   +4.898665779807133e-01   +8.524991238502959e-02   +3.330701192704740e-01   +3.470833510075942e-01   +6.069866633265399e-02   +3.456858012856205e-01; +4.344528605954773e-01   +2.210257966837957e-01   +5.749568989896090e-01   -3.636024676773858e-02   -7.738369577414086e-02   +6.538770930372815e-01   +5.381973656501162e-02   +3.828781631684109e-01   +2.582398067823697e-01   +2.672000010303964e-01   -1.091237219685946e-01   +6.431621787912022e-02; -9.629760304834428e-03   -2.097336340474756e-01   +8.802793861678708e-01   +3.135164722087636e-01   +1.736470645072864e-01   +2.324211124076011e-01   -3.703005439108368e-02   +2.137502898180717e-01   +1.273732666998835e-01   +4.066545597894783e-01   +4.223195586993986e-01   +1.423012686416769e-01; +6.612301102831804e-02   -1.549484684547186e-01   +2.840744013862436e-02   +5.550337485552938e-02   -1.842169456696998e-01   -5.434800401034581e-02   +1.424903719900012e-01   +2.638134385215019e-01   +2.474732326393666e-01   +6.894104923647260e-02   +1.972984663047018e-01   +5.770431821015836e-01; -3.855888853191645e-02   +7.456839080409733e-02   -3.555667894243195e-01   -6.464051868546743e-02   +1.984904417367591e-01   -1.544085406766073e-01   +5.266338762331544e-01   +3.254426448972150e-01   +8.919397724570546e-02   +1.972438819511602e-01   +3.658767523820657e-01   +1.713763262350668e-01; -7.419026023525632e-02   +3.421530337417260e-01   +1.110234909470674e-01   +1.040228152125150e-01   +1.830914339668613e-03   -6.211522290553235e-02   +1.060158124236988e-01   +2.225105368306512e-01   +1.178440234796219e-01   -3.506472971306674e-01   +1.211459477717549e-03   +1.116076847610329e-01; -1.356325530865740e-01   +4.689110663615659e-01   +9.572769730786190e-02   +1.092319580201884e-01   +1.100969319426321e-01   +6.068743739637456e-01   +1.387011363594002e-01   +5.482745352014002e-01   +2.130860194187676e-02   +8.694845391065309e-02   +5.199571137761503e-01   +7.836646956048108e-01; +5.651547540345500e-01   -4.749014401997864e-01   +6.160021791210235e-01   +1.388081724679939e-02   +1.405769461577194e-01   -4.566908008181226e-01   +3.932672536335679e-01   +2.902019973072193e-01   +9.622072167465356e-02   -1.070992793157210e-01   +1.000000000000000e+00   -9.281656704017649e-02; -4.365543030417743e-01   +4.394200002313769e-01   +6.898076464440993e-01   +3.596832194985616e-01   +8.518575033244545e-03   +1.495673162345581e-02   +3.434070320504065e-01   +8.003002421812308e-02   +6.155135855192618e-01   -1.740346730224882e-01   -3.882317564437280e-02   +2.189717797933769e-01; -2.346506806384913e-01   +2.571585156297376e-01   +3.168463107302396e-01   +3.190414619475160e-01   -2.270213117254115e-01   -1.217530578103891e-01   -3.072136153674570e-01   +9.009113815142811e-02   +4.674405551451072e-01   -6.007191749641518e-02   +2.402791417818166e-01   +1.487815350499601e-01];
L3E_L3I_iGABA_netcon = [+2.995912295247731e-01   +7.451767050249182e-02   -5.260838306736133e-03   +2.775064328011186e-01   +2.413748216197336e-01   -6.056940465366853e-02   -1.317965718922436e-01   +2.457171414157892e-01   -1.626500557712055e-02   +3.961514382273753e-01   +3.966332201384603e-01   -1.456371192830580e-01; +2.838746147620099e-01   +3.606226173044841e-01   +2.973510558305462e-01   +1.245629333931553e-01   +4.183667399083705e-01   +1.163603020135541e-01   +1.002773154693186e-01   +1.746269508232246e-01   -4.443779879877677e-01   -9.465420859268201e-04   -3.746215645093127e-01   +1.752677557298911e-01; +2.538568842936779e-01   -5.620532200671471e-02   -1.706987874925881e-01   +1.591023964121391e-01   +3.091387786020169e-01   -6.697090743058647e-02   +1.925504689584920e-01   +3.041054669800502e-01   -4.592570933928052e-02   +1.316827654198403e-01   -1.057115951008001e-01   -2.423278085414565e-02; -8.349481835556825e-02   +1.271823542502107e-01   -5.098558989014715e-01   +4.934757033739002e-01   +7.832569699307891e-01   +4.085369499688089e-02   -4.869538140089712e-02   +1.322108757636752e-01   +6.319216402148731e-01   +3.153393674916934e-01   -3.788141511039036e-03   -1.416763040311532e-02; +3.839593111481386e-01   +4.194166900885092e-03   -1.573246188191109e-01   +4.226454542921999e-01   +1.499435354654779e-01   +1.639368178361862e-01   -2.016286031726089e-01   +6.039528528886866e-01   -5.000270166268517e-02   +5.644529650456334e-01   +2.532193839283693e-01   +2.754524587903588e-01; +4.079216166032791e-01   -5.537750662597867e-02   +4.987482735373394e-02   -1.826259166668701e-01   +2.425104259560873e-02   +1.951132659928826e-01   +2.256890008666899e-01   +2.675212149609536e-02   +4.877632450318077e-01   +3.737472495521841e-01   +4.203026493371283e-02   -1.222399779030068e-01; -1.300224539983834e-02   +3.295463001178377e-02   +2.823794216997083e-01   +1.000000000000000e+00   +1.045523285801203e-01   +4.114155510992812e-01   +6.095385232276557e-01   +2.012291019077480e-01   -4.534617865208138e-02   +2.665375234291827e-01   +5.525282009516717e-01   +1.610750369616754e-01; +1.670060589448793e-01   +2.112464348874302e-01   +3.942288224990298e-01   +6.147752358905117e-02   +1.453237434667480e-01   -1.524450850094003e-01   -1.780949371492245e-02   +6.397010819812540e-01   -5.642550804477079e-02   +3.875950629925495e-03   -5.472176531901871e-02   +2.906703806767472e-01; +3.323549451386477e-01   -1.175899700795507e-01   +4.734167916601201e-01   -2.395292669697708e-03   +1.259366161848062e-01   +1.843878652941993e-02   -4.597617897865547e-01   -2.349077637748750e-01   +4.960732699618138e-01   +3.277026024187886e-01   +1.730376623552962e-01   +6.100400737972027e-01; +1.079957349783683e-01   -4.738514536659608e-02   +3.874244949849560e-01   +6.476114671109891e-02   -2.743489571742264e-01   +3.121506949417579e-01   +3.354200759476392e-02   +1.061469479974478e-01   +9.963088890325528e-02   +1.338601756417092e-01   +2.798343577269301e-01   +7.946834058483605e-02; +4.117790380658695e-01   +1.151391039710986e-02   +2.959057353113371e-01   -2.374634093469030e-02   +1.772185861861881e-01   -2.551746747019534e-01   +1.612933850453617e-01   +8.211992562310276e-02   -1.620390216543726e-01   -2.699251840485277e-02   +3.490895716664791e-01   +4.357327306490276e-01; -4.052936743856952e-02   +3.153295031803141e-01   -6.844731541604909e-02   +1.535262628834024e-01   +7.734209350377489e-01   +2.959070623756475e-01   +3.015419941341331e-01   +2.842839894507923e-01   +1.735530302012719e-01   -1.445004084018375e-01   +3.312832378634282e-01   -1.724782892514999e-01];
L2E_Input1_iAMPA_netcon = [+8.252539379168450e-01   +7.029303809725342e-01   +6.548367647980239e-01   +8.389627978184823e-01   +1.000000000000000e+00   +4.890874905671588e-01   +3.982879365872947e-01   +6.681503882369371e-01];
L2I_Input2_iAMPA_netcon = [+6.332437060239318e-01   +8.496793500095736e-01   +8.321159829940713e-01   +6.588394380169805e-01   +2.829542205659563e-01   +9.646113877358319e-01   +1.882344795305754e-01   +1.962644430438947e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
