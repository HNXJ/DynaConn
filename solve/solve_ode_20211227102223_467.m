function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.745210666652666e-01   +1.499433162458101e-01   +6.361346297799580e-02   -3.237121513543811e-01   -2.904383067396862e-01   +1.562462413032380e-02   -7.930072131892590e-02   +1.735768667891173e-02   -5.378726754360590e-02   +2.428479619066486e-01   +7.015661552791763e-03   +1.746319654003867e-01   -2.359032850159956e-01   +1.293986666300589e-01   -1.034618560344478e-01   -3.700432706060044e-02; -5.113353192170100e-02   -8.802606861610041e-02   +1.120850470144832e-01   -2.291769981807996e-01   -3.690663722181520e-02   +3.571906726072081e-01   -4.196922010937040e-01   +2.796900656969405e-01   +1.157702312160972e-01   -2.384275740583468e-01   -4.793793802969158e-02   -3.065578400593483e-01   -1.706239250982248e-01   -2.277034502599734e-02   +1.750905887905755e-01   -1.957339168070136e-01; -1.481615861127233e-01   +1.114076536417781e-01   -1.034621711367854e-01   -2.614102651201174e-01   -9.320219229257318e-02   +8.266617596203035e-04   +2.177409479039065e-01   -4.026712598567361e-01   +2.996995083242673e-01   +2.064307384031871e-01   +3.652069708608918e-02   +2.485362160440358e-01   +1.726612470723697e-01   -2.824599744034416e-02   +1.653714479286605e-01   -4.165045680786369e-01; -6.261823244874620e-03   +2.313836413240435e-01   +2.081153787722196e-01   -2.217022824544546e-01   -2.148672154913455e-01   -1.270608242802058e-02   -3.745786045565246e-01   +7.700304675893951e-02   -1.172017800888191e-01   -8.115658127644404e-02   -4.041121370144150e-01   -2.068768307512761e-01   -1.826754506800704e-01   -4.702812983894315e-02   -3.422096940103783e-01   +3.782072631047004e-02; +8.533240419575720e-02   +7.885146355102002e-02   +4.514778922912421e-01   -2.364297633315735e-01   +4.714326552423741e-02   +5.181224132415464e-01   -1.636830408080778e-01   +1.516264946437099e-01   -2.452970455074187e-01   +9.188570968230708e-02   -1.728694564162714e-01   -3.132881611022809e-02   +1.354105568670052e-01   -5.084891457580112e-02   +2.932659351481431e-03   +3.512926167563813e-01; +8.666447946036836e-02   -1.821303085206278e-01   -1.732243253692320e-01   +4.188673385101926e-01   +2.487381512461091e-01   -6.461323981221295e-02   +1.955246275723703e-01   +3.470600217175288e-02   -1.734224393816225e-01   -9.721219935718631e-04   -7.494313368892717e-03   -9.494211639296027e-02   +4.426134986592858e-01   +3.252348960509330e-01   -3.636673957657809e-01   -1.015210704420611e-01; +3.516648905086608e-02   -3.606403971289503e-02   -3.803527643319547e-02   +1.466210554037969e-02   +1.881122004045623e-02   +4.295205196532257e-01   -2.971304043963479e-01   +4.100404601524213e-02   +1.260574979465819e-01   +2.743570924315655e-01   -5.801372906597101e-02   +5.552326613161129e-03   +1.917946952844535e-02   +1.692241066119499e-01   +9.270002249079963e-02   -1.059044515232141e-01; -6.246355619752628e-02   +2.305297737966526e-01   +1.198812649913159e-01   +2.943553371058220e-01   +1.118582909673326e-01   +1.693126033260829e-01   -3.058500173959067e-01   +2.427972216905371e-01   +1.159332447534508e-01   +4.840761915258344e-01   +2.063268433327392e-01   +1.740936080978464e-01   -2.624495070386491e-01   +4.842930653632506e-01   -3.631304651818024e-01   +1.466830634917631e-01; -2.311629348124796e-01   +2.445461873969326e-02   +5.362793161127435e-02   +2.098006202700693e-01   -2.642936552459570e-01   +2.546049910826541e-01   -1.162312414383657e-02   +8.803362654761693e-02   +5.101239126326414e-02   -3.346423982433783e-01   +1.946760166947309e-01   -9.289846562335929e-02   -4.326422191207684e-01   +3.465043720905132e-01   +2.738385169148457e-01   -2.562017848052886e-02; +3.518684841575768e-03   +1.210573330906806e-01   +4.341307857193830e-01   +2.542991716050486e-01   -1.428316400219908e-01   -1.580677837856073e-01   -1.691968562191778e-01   -3.454536368478098e-01   +2.743761614771892e-01   +3.452349059316259e-01   -3.303096863987005e-01   -2.724252092596943e-01   +1.825153944190350e-01   +2.163433831896772e-01   -2.423325024727927e-01   +1.886486121326875e-01; +1.864878669400127e-01   +1.459654411781425e-01   +8.203686588562437e-02   +1.523005357276516e-01   -4.425371186109354e-01   -8.600771027621218e-03   -1.556455894796328e-01   -2.403885320742778e-01   -1.081212426443781e-01   -6.169613096341281e-02   +7.636220812942851e-02   +2.251327982037151e-01   -7.430195671731596e-02   +2.337201962575433e-01   -1.314857210482097e-01   -1.265266412522593e-01; -1.140400713164293e-02   -1.716783578917513e-01   -4.704937708528398e-02   +1.323634445660651e-01   -3.151292366418210e-01   -1.696235734479389e-01   -1.897945703577084e-01   +2.409657486659564e-01   -3.611734228471196e-02   +3.578322206825110e-01   -2.510064678636661e-01   -1.909154652607104e-01   -9.163862293122227e-02   +3.123971927571972e-02   -5.290295402964857e-01   -2.761941034807673e-01; -4.123547273486485e-02   -1.323208637805195e-01   +1.407790339481073e-01   +1.323045742446430e-01   +3.049319360021452e-02   -2.093246342528723e-01   -2.623149138414615e-01   +1.064521430710975e-01   -3.822709647306682e-01   -5.764765189662440e-02   +2.201734886461826e-01   +9.928670622655808e-02   -9.861599976859320e-02   -3.368160888231962e-01   -3.374861336382712e-01   +2.393105988198438e-01; +6.591724860238027e-02   +4.114798403023259e-01   +3.026642778667334e-01   -1.061656849118533e-01   +2.432108615326471e-01   +1.167745241141269e-01   -3.809600973993837e-01   +1.635972401770766e-01   +1.445689957788365e-01   +1.782571165938367e-01   +1.389209938465161e-01   -1.571079279704922e-01   -5.717186589270791e-03   -5.061280532056465e-01   -1.794501238601220e-02   +3.188498236867801e-01; +2.232689090891019e-02   +3.077818340251173e-02   -7.193005471814828e-02   -1.499685677002809e-01   -5.187546657798560e-02   -1.054364337612432e-01   -1.708287292702683e-01   +1.801671730403852e-01   -6.376785333997673e-02   -2.971942837156248e-02   -2.052493139237948e-01   -9.714295663845618e-02   +1.854370167940666e-02   +1.322238384897308e-01   -2.563518220573868e-01   -1.466937565215272e-01; +4.673346967106720e-01   -3.989980821924415e-01   -3.593707713293769e-01   +2.120834253797961e-01   +1.424756968030977e-01   -3.314839049138049e-02   -3.381206245052323e-02   +1.075744539764605e-01   +1.935949889842022e-01   -1.575433772728386e-01   -1.530216311712978e-01   +1.204987888943130e-01   +7.767614408868861e-03   -9.439340352142597e-02   -3.511222627569411e-01   -3.932398685800739e-01];
L1E_L1I_iGABA_netcon = [+2.230305345339275e-01   +4.222005930296668e-02   -2.745437163043261e-01   +5.599784757751934e-02   +6.989916054041456e-02   -2.135889600470108e-01   -2.128873390251315e-01   -9.894687008895625e-02   +9.061784617882951e-02   +1.694378263904091e-01   +4.802886547723122e-02   +1.430794217624204e-01   +3.257443210860826e-01   -4.492182275945843e-01   -2.955874449162482e-03   +2.965405646483417e-01; +8.810750758287555e-02   +2.597895509356385e-01   +1.072283878159644e-01   -1.497377940311635e-02   -3.596077529197711e-02   -6.713882650064581e-03   +7.826624656568612e-02   +4.435978222719231e-01   +1.932303828550003e-01   -1.855867086548921e-01   -2.425460621832937e-01   -3.672657344415026e-01   +2.009410604913133e-01   +3.277237965856115e-02   -9.937478133005118e-02   -4.216805693303588e-02; -4.040081481030550e-01   +3.566704868928280e-01   +2.502659777305420e-01   -3.207825289845768e-01   -2.962740074556138e-01   +5.326919536454131e-02   +2.224986629670452e-01   -2.746634653296784e-01   -3.538441398868130e-01   +1.470106481668920e-01   +1.486836686427324e-01   +1.931349837217546e-01   -8.253156191512115e-02   +3.131475647320969e-01   -4.564647835968819e-01   -3.779147122754539e-01; -1.231396379511022e-01   -8.148660692257781e-03   +2.316589330732016e-01   +1.093197554607497e-02   +5.723284999872701e-02   +1.681772960253578e-02   -2.086943504801401e-01   -1.834194188376019e-01   +2.128789269217038e-01   -3.277895111140473e-01   +5.171593893353058e-02   +3.183427212372750e-01   +3.361155716558732e-02   -9.582181626409014e-02   -6.206618945272031e-02   +2.898618097819457e-01; +2.245717206045613e-01   +5.435672640840492e-02   -4.035439416419306e-01   -6.585902823381604e-04   +1.314821344788320e-01   +1.325471088766700e-02   +1.220484825610363e-02   -1.958880425136018e-01   -2.970950163228263e-02   +2.701988043958811e-01   -2.304812658788226e-02   +4.829282886435439e-01   +3.776783497575331e-01   +3.672513336337559e-01   +2.209208605233515e-02   -1.078793838479303e-01; -2.369112813385900e-01   +8.653000041994210e-02   -2.264817184362103e-01   +1.446932432280314e-01   -2.326961570672347e-01   -4.974160009939441e-01   -5.245946071051470e-01   -1.879732887512726e-01   +3.448448737591149e-01   +6.236183658688368e-02   -4.456828571315646e-02   -1.595645613230087e-01   -3.305962908465192e-01   -1.442868911044324e-01   -2.049780083393156e-02   -1.721723078255334e-01; +2.937985623606423e-02   -3.824563254133384e-02   +1.545615001955171e-01   -3.195083177572934e-01   +4.653590059478304e-01   +4.932231839149424e-02   +6.986350036572142e-02   -4.613722784095695e-02   +5.601937326641727e-02   -2.484286200164171e-01   +1.642978039957474e-01   -2.469484517033148e-01   +7.301353602042121e-02   +7.121827493661428e-03   +1.525988168636955e-01   +4.239115387530149e-01; -1.630736624171329e-01   -2.147593195394558e-01   -1.814499335324188e-01   +2.744133625556971e-01   +2.239933459381351e-01   -2.037366754711841e-01   +4.404709170888447e-01   -2.292827956171892e-03   -1.817916439314441e-01   +1.816135129775675e-01   -3.002176957456662e-01   -3.747171334438859e-02   -4.124220545358070e-01   -5.195004721472463e-01   +6.956271887478674e-03   +4.552978185301353e-02; +4.196066866928957e-01   -2.442783126073461e-01   +2.568929554726569e-01   -2.075566600459493e-01   +2.128649379220789e-01   -3.611970031528199e-03   -5.069862526301921e-02   +1.497197500329773e-01   -3.055347596085884e-01   -4.383334891208041e-01   +6.322476350205580e-02   -6.229991622762679e-04   +3.063536498036646e-01   +5.363082805870440e-02   +1.163075448989329e-01   -2.515929641340069e-01; -1.051595081387468e-01   -4.325195493193649e-01   +8.689379831714221e-02   +1.567053269103277e-01   -3.072557874817251e-02   +9.839905835317261e-02   -5.496433545284797e-03   +1.023953310037728e-01   +3.971021214250791e-01   +6.008624522659725e-02   -3.279260029130924e-01   +5.132491864251529e-01   -1.730305694263396e-01   -2.821873616927050e-01   -3.948620712776001e-01   +2.028090163715586e-01; +2.323436154812129e-01   -2.391548462964546e-01   +1.453628710584822e-02   -2.073538556483714e-01   -1.659051647847140e-01   +7.402907161061463e-02   -3.639641069193000e-01   -9.286536080489169e-03   -3.267568170045504e-03   +5.496400819228225e-03   -9.320173821776430e-02   -1.796204737188563e-01   +2.218714934736294e-01   -6.790406305388702e-02   -2.959278345652322e-01   -1.619285015752411e-01; +6.869259563237817e-02   -2.856297635543885e-01   -1.177695439727243e-01   -2.870978861925956e-01   +5.665456012760806e-03   +3.054856717656497e-01   +1.373848871726792e-01   +3.766357468848486e-03   -9.414979306240467e-03   +9.187739220739816e-02   +2.929537471762501e-01   +3.370268032767034e-01   +2.530389727981679e-01   +1.940054196337331e-01   +2.191095764260223e-01   -1.965546072356508e-02; -1.548011680025257e-01   -2.403763845714647e-01   -1.051411915024530e-01   +4.103991393120676e-01   -4.587007062359121e-01   -4.736194905883678e-01   +1.495502323878200e-01   -5.054686750055391e-02   -4.488228273341901e-01   +4.019760679272998e-01   +4.363764221573339e-02   -4.226529426806495e-01   +2.815229261726722e-01   +2.178683229467046e-01   +5.465135881316588e-02   -3.665959904515764e-03; +2.698932009550271e-02   +1.064706917649993e-01   +2.351486910774941e-02   +2.103665676129081e-01   -2.168259590525026e-02   +5.937348430575057e-02   -1.229857870268098e-01   +2.729112802386673e-01   +4.512734156051599e-01   +5.141524383002188e-02   +2.623305318468086e-02   -4.294709355753368e-02   +2.022291732756006e-01   +1.809133714018855e-03   -2.557409739392642e-01   -2.329876435670194e-01; +3.725188827304867e-02   +6.626628582233697e-02   -1.268307787774138e-01   -1.362242830418736e-01   +3.613695326430955e-01   +3.474966473808999e-01   +9.137871450728907e-02   +5.665763780523451e-01   -2.571011953034845e-01   +3.748772757876729e-01   -1.498090818798580e-01   -9.450032665817426e-04   -1.221115140703246e-01   +2.811280986657285e-01   -2.674027159056048e-01   -9.403634047803544e-02; -1.782969178612346e-01   -6.019321451456576e-01   +7.598640623308578e-02   +2.204991586876148e-03   -3.910900658677302e-01   +1.319885059652940e-01   +6.116093706862624e-01   -3.387853377798489e-01   -1.336335816339204e-01   -2.210764394901192e-01   +2.344053957431426e-01   -4.971435960303336e-02   +9.651168338430621e-02   +5.033287706127656e-02   -3.283573772435802e-01   -6.889104799982920e-03];
L2I_L1I_iGABA_netcon = [-1.811778401359719e-02   +8.419118641933579e-02   +1.402482710915947e-01   -1.233674129031471e-01   +6.509127443818392e-02   -1.604199364259920e-01   -1.665605264737079e-01   -9.461797841545506e-02; -1.995828697649185e-01   +9.138235325841404e-02   +4.401824685416201e-01   -4.444920707687694e-02   +1.423478847524101e-01   +2.837882299864702e-01   -1.618438591364980e-01   +7.200415988025261e-04; +1.001975449270006e-02   -3.827923599173215e-03   -2.433978834741746e-02   +1.175303678819413e-01   +2.863196765112266e-02   +1.140746841853888e-01   +7.414178960254775e-02   -1.506857956314856e-01; -1.215183626626178e-01   -3.832355542000191e-01   -1.822909577072427e-01   +1.665512511938684e-01   -1.057074548739731e-02   +2.258957220998096e-01   +1.343139365770198e-01   -2.735813092497095e-01; -1.186336057582892e-01   -2.962470808970956e-01   +2.604590415361321e-01   +3.092020770496720e-02   -2.970939811515643e-01   -3.199647377097202e-01   +1.762813667286346e-01   -3.461163539168786e-01; +2.281610087882176e-02   +1.342624588388373e-01   +1.443498160550855e-01   -2.166200434972821e-01   -3.231130454238506e-01   +3.826278561100242e-01   -2.871944061269717e-01   +1.507417011811184e-01; +2.590096917989235e-01   +1.626567604560539e-02   -1.802973612290222e-01   -3.634406077260976e-01   +1.692220240782613e-01   +1.718006360291222e-01   -3.436533227406393e-02   +3.002589292703023e-01; -2.863456147238749e-01   -3.658823203408143e-02   +2.143333738923114e-01   +3.268062720018407e-01   +1.972769438620969e-01   -1.627141804713651e-01   +1.666099977727132e-01   -2.356709775283043e-01; -8.477907583196859e-03   -2.774345574631705e-01   -2.247653599685955e-01   +2.646405617022413e-01   -9.926291658322629e-02   +2.861868200280915e-01   +1.166359204884598e-01   +2.354809914914121e-01; -1.061640276753385e-01   -1.744791103188454e-01   +3.368792443868011e-01   +2.985864214947096e-01   +1.794166170554633e-01   +2.291506667273588e-01   -1.721162988702357e-01   -4.270405514278751e-01; -3.711489190766994e-01   +7.562575188035639e-02   +1.849161145534765e-01   -1.544261644211964e-01   +2.848269741354203e-01   -3.148985426566476e-01   +3.254975652103259e-02   +1.817838959291789e-01; +1.740904646189269e-01   +1.825820777366052e-01   +3.004653982568719e-01   -3.189318454039918e-01   +3.172081701210970e-01   +9.866558093120253e-02   -7.736880790792722e-02   +2.664732441778514e-01; +1.062851376292352e-01   +2.481440792435192e-01   -2.520558776113828e-01   -2.124190506979542e-01   -9.401347129525540e-03   +2.581791483987371e-01   -3.322365106654833e-01   +3.098802075118852e-01; -3.157598394625405e-01   -1.641641502358679e-01   +2.770225908291131e-01   +1.830606384088359e-01   -1.083246038435942e-01   +2.057455558205135e-01   +3.013684598189264e-01   -1.075914774308462e-03; +1.593505222334886e-01   -6.745467659897825e-02   -3.488653859076164e-01   -5.657016408390758e-02   +8.730059649307614e-02   +3.145777596259522e-01   -6.573898713973522e-02   -1.653334504985143e-01; +1.383035025266171e-01   +8.550714921088960e-03   -2.011669756704571e-01   -6.519523168186908e-03   +2.305506187629945e-01   +3.445365944572760e-01   +2.823581271809015e-01   -2.466834652796077e-01];
L1I_L2I_iGABA_netcon = [+1.802651847748707e-01   -1.443993427847995e-01   -1.245761679110221e-01   +2.082916746067218e-02   +3.135052544130897e-01   -2.083227564986817e-01   -8.485273536165742e-02   +1.891741595907746e-01   -2.262056348383831e-01   -4.875388985182758e-02   +2.360635566024687e-02   -9.448903452270935e-02   +1.644355683643041e-01   +3.224068826800680e-02   +2.112523140925543e-01   -3.996067571932759e-01; +7.734550686670658e-03   +9.396356701251352e-02   +2.998386588868740e-01   +3.498102595528929e-01   +4.741783643502413e-02   -4.206580639904743e-02   -1.923650232512636e-01   +4.302215579350388e-01   -8.989811018055045e-02   -1.542007738347991e-02   -1.869421726518938e-01   +4.003057375255345e-02   +2.148013786567038e-01   -4.330122683754711e-02   -1.464562768746577e-01   -2.516728831118666e-01; +1.460652252608317e-01   +3.558854907951305e-01   +1.057655137069836e-01   +9.760525958053634e-02   -1.462898611722264e-01   -2.217082402179456e-02   +1.158853797292737e-01   -3.577199854929446e-01   -3.235252805622013e-01   -3.164633863282447e-01   -4.652667407201689e-01   -1.852533838958526e-01   +2.374416042568883e-01   -3.229119124828044e-01   -3.196778472295314e-02   -1.840728888367703e-01; -1.056538513966731e-01   -1.282489280137250e-01   +4.168001102719827e-01   -4.948361038745548e-01   -1.401394440206438e-02   -3.320949770664836e-01   -1.404128116658726e-01   -1.672366305187416e-01   +4.362075073036414e-01   +3.449703456934145e-01   -3.695447590018763e-01   -3.176164876120080e-01   +2.121427498157420e-01   -1.842587332230619e-01   -9.019263364751956e-02   +5.832955188628476e-02; +3.745478870048055e-01   -1.510909426498183e-01   -3.282103297772000e-01   -2.406932549565163e-01   +3.729354591043915e-02   +2.801329515147222e-03   +3.042808344921534e-01   +4.489389363939890e-01   +1.550653889099633e-02   +2.764142526741080e-01   +2.648715480874020e-01   +1.997952900156881e-01   +2.034036816553328e-03   -3.613611739784128e-01   +4.402204599108624e-01   -3.798019502740853e-01; +1.664297582634952e-01   +3.343472439660287e-01   +2.116950491167407e-01   +2.605608288446813e-01   -1.542275746177089e-01   +4.345044728983850e-02   +7.145735314150502e-02   +4.128829492333763e-02   +9.237162149968747e-02   -2.016359024547679e-01   -9.093847329771269e-02   +2.718272019077038e-01   -1.404184783985277e-01   +3.606103464625639e-02   -1.512522476336441e-01   -9.628313041301523e-02; -2.126783252177711e-01   -2.646520681041816e-01   +3.383713918487656e-03   +2.878168327607110e-01   -7.874495759022787e-02   -2.936894846366037e-02   +1.061767859691720e-01   -1.910621635788254e-01   -6.134917297989832e-02   +1.247858035534232e-01   +2.682469510135146e-02   +2.799416200528042e-02   -1.364592685934481e-01   -9.209079234357026e-02   +3.604088121059518e-02   -2.293432594911939e-01; -4.635549983359918e-02   -2.751855935608202e-02   -2.553907581643128e-01   -6.409928782329130e-02   -1.909696296014215e-01   -1.865025257884036e-01   -2.875086458648339e-01   +3.895249586591916e-01   +3.839442930171681e-01   +2.297435727083774e-02   -2.883462170493913e-01   +8.601091292147062e-03   +2.849116448220248e-01   +8.385782073224093e-02   -1.154085225917886e-01   -6.650499020571704e-02];
L2E_L1E_iAMPA_netcon = [-4.485059854184978e-01   -1.878808773082015e-01   +2.795182727852086e-01   +1.419931712116279e-01   -3.154494297403565e-01   -1.268616918050102e-01   +1.737486326210668e-01   -2.892970241780060e-02; +1.412457702013357e-01   -5.933454745984396e-02   -1.539240057334067e-01   -9.206649660767335e-02   +1.850212121285589e-01   -1.680942975316393e-01   +1.952118318380998e-01   -1.185559967635281e-01; -6.092511483769567e-01   +3.141242812013778e-01   +2.627253174352396e-01   +2.105435628115436e-01   +2.999190805793093e-01   +1.810346967559401e-01   -1.513667088506236e-01   +3.924910549010006e-01; -2.015172800480424e-01   +1.863820709327293e-01   +8.811532374953820e-02   +1.133430437369123e-02   +3.887488777947822e-01   +4.838595618395379e-01   +2.046598924617793e-01   +4.022438274633726e-01; +5.039078347256348e-02   -2.382557650694774e-01   +1.685812599739261e-02   +7.804129429665818e-02   -2.408735704266004e-01   +1.285519552735289e-01   +1.247816870809749e-01   +9.681235868843822e-02; +1.236046763654415e-01   +2.811929391430703e-01   +4.843668776636887e-01   -7.273155467830097e-02   +3.805398766076452e-01   -1.253372208652065e-02   -1.959422893597344e-01   -2.922227400669932e-01; -1.337315188235873e-01   -2.167369733562372e-01   +1.806424176979807e-01   +5.728077167482361e-02   -1.219452053094185e-01   +2.626531875775872e-01   -1.754117970577972e-01   -3.970773580268501e-01; +4.592608101460550e-02   -2.745747921531372e-01   +1.936948667510959e-02   -3.219473082404240e-01   +3.155661040410134e-01   -5.130961443630001e-01   +1.171274801902522e-01   +2.933590388744609e-01; -3.375728609773240e-02   -5.731071676975300e-03   -4.508840021878145e-01   -4.633318036026366e-01   +3.029539034588345e-01   -1.356703696729045e-01   +2.543323164947908e-01   +3.225345977130734e-01; -1.367099009481823e-01   -8.131069871041610e-02   +6.900101050775430e-02   +5.008841053008933e-02   +4.350871113552996e-01   -1.744782129068556e-02   +1.321333011216750e-01   -1.864492905849827e-01; -2.007702555138537e-01   -2.110931824191939e-02   +5.030876438645068e-01   +1.571062716927427e-02   +3.537393338789808e-01   +3.643257794431043e-01   -1.615582922893127e-01   +9.387147133439686e-02; +4.815842351431566e-02   -4.872554284521147e-02   +3.466474035933688e-02   +2.861088935333270e-01   -1.674675832456450e-01   -9.380791091057851e-02   -2.087237786912894e-01   -2.934770810837857e-01; -9.606757361888055e-02   +1.184190066218303e-01   +1.018885334343716e-01   -6.780050739615288e-02   +2.591596664922920e-02   -1.445929929485476e-01   +2.895709167912791e-01   +1.474318604621629e-01; -3.893196884638465e-01   -4.742708364235356e-01   +1.347019634093733e-02   +4.149169333331132e-01   +5.217052705316813e-02   -1.545818876794754e-01   +1.252187381065869e-01   -3.593639683118854e-02; +2.137712325097924e-01   -2.323044239278386e-01   +5.125269995359552e-01   +2.012764401106604e-01   +3.449268603254861e-01   -1.806202727413055e-02   -2.487677239287184e-01   -4.888070831776171e-02; +3.930113772330895e-02   +1.009394804668991e-01   -3.377968796485104e-01   -1.089035654682936e-01   +1.356098796495338e-01   +4.096918080983235e-01   -5.750497636931699e-02   +1.866239759823074e-01];
L1E_L2E_iAMPA_netcon = [+1.116276487034586e-01   -1.153663064675020e-01   -1.975169598323817e-01   -1.819958028792005e-01   -3.145759919708576e-01   -2.637664473825391e-01   +7.068187277785295e-03   -2.590851793682761e-01   -1.986983277826141e-01   +8.133733898939752e-02   +1.535897906536308e-01   +4.981421649297016e-01   -2.298764006141511e-02   -1.755078593468907e-01   +2.796745514228914e-02   +1.227847887316447e-01; +7.708296154566902e-02   +4.756930272422120e-01   +3.052695064596895e-01   +1.942561812538779e-01   +5.220027564346739e-02   -1.635851755206130e-01   -1.061859464067805e-02   +1.786728466233523e-01   +1.441403204262316e-02   +4.379196734169771e-01   -4.656148172111338e-02   -2.238813924611604e-01   -3.299385427518911e-01   -3.685024164886322e-01   -3.272598936709525e-02   +8.782104061224731e-02; -2.187951591397433e-02   -3.431442141148524e-01   -4.101640339302356e-01   -7.717489145116041e-02   -3.713724644156466e-01   +1.097823810747401e-01   +8.445907364567029e-02   -1.354365752398385e-01   -1.455687450909815e-01   -5.073046372307692e-01   +1.462875344043346e-01   +2.653217562303261e-01   -2.211827910170385e-01   -1.564144135854542e-01   -2.073741771814468e-01   -7.730442228528260e-02; +6.591568908212701e-02   -7.384100967589298e-03   +1.153203762971997e-01   +4.109512830423269e-01   -3.448156804318648e-01   +3.416549391923935e-01   +5.394491847363442e-02   +1.806429278935185e-01   -1.012483276994370e-01   +2.214881553129183e-03   -4.288875544392425e-02   -2.063438024397174e-02   -1.608137770698046e-01   +9.849151081017082e-03   -3.279901384245529e-01   +2.022739240166118e-01; +4.524740007000143e-01   +2.512977545313371e-01   -3.794586261103434e-02   -1.450159494158506e-01   +4.198254771809477e-02   +3.005431037726448e-01   +1.010659630282786e-01   -1.213694225849007e-02   -1.101730504689446e-02   +1.432731455111786e-01   -4.823298607978897e-02   +7.672279340384602e-02   -1.029742034480371e-01   +3.190317994688766e-01   +8.548944047478774e-03   +8.207647633624579e-02; -1.229261050860576e-01   -3.219110520630318e-01   -2.086909354047051e-02   +7.472986613888263e-02   +3.103300635273136e-01   +2.692580609921031e-01   +4.729157685930997e-01   -2.016867006274314e-01   +2.719880098185160e-01   +1.569861481947523e-01   +5.147368506643977e-01   +1.888027278433672e-01   -2.242713065721043e-01   +6.053113710132529e-02   +5.485102040329737e-02   +2.677678375309824e-03; -1.986631646547134e-01   +2.150181050886057e-01   +2.877077672247222e-01   +1.310974047975430e-01   -4.302891789664166e-02   +2.511611517716313e-01   -8.018047980355819e-02   +8.267382908170995e-02   +1.696951909539867e-01   +1.334143711080374e-01   +2.291374131668697e-01   +4.055580999293718e-02   +3.069981664892122e-01   -3.293299680863295e-01   -2.497718564543797e-01   +2.215048473887509e-01; +1.617096181180482e-01   -1.856233854283015e-01   -6.095275091171434e-02   -3.982052292385327e-02   +2.079860947099065e-01   -1.898254552956364e-01   +2.189816310372814e-01   +7.805651627498753e-02   -9.658964400306992e-02   +1.946642078669082e-02   +3.479142171311252e-01   -1.586921515082995e-01   -2.526902819143775e-01   -6.576249165956188e-02   -5.478548938394878e-02   -1.326245198687354e-01];
L2I_L2E_iAMPA_netcon = [+1.414690451106199e-02   +4.001451602577494e-01   +3.701553111179922e-01   -4.897708420195999e-02   -1.367331072554814e-02   -1.878271548146209e-01   -1.396934849457413e-01   +2.211942066219171e-01; -2.390426404068471e-02   +1.596088415274106e-01   -3.236793062034594e-01   -2.718477200142934e-01   +1.304475247965245e-01   +2.261424034027169e-01   +2.560541069292711e-01   -2.706061667984012e-01; -5.939632970306337e-02   -3.427114765102651e-01   -7.417589444303552e-02   +1.264028061923867e-01   +1.333549957916346e-01   +1.690661620978169e-01   +2.505292823858822e-01   -1.858985757771250e-01; -8.895274072971965e-02   +2.736926471421188e-01   -1.113943010743614e-01   -2.291464724466049e-01   -9.045814432110982e-02   +3.436451738076198e-01   -7.326795686411694e-02   +1.359517129656846e-01; -3.354935989272808e-01   -2.753893320423726e-01   -4.084433706279822e-02   -1.308465482207960e-01   +6.839760927462196e-02   -3.224419012476899e-01   -5.560467157859679e-02   +4.164188836099696e-01; +1.889370626777425e-01   -2.669506038470892e-01   -5.439710586590885e-02   +7.533611763500417e-02   +1.050487906615617e-01   +2.291651907006763e-01   +2.832469690585393e-01   -4.108139998946769e-04; +1.471622224203224e-01   -2.542874756469221e-03   +2.781657597856464e-01   +5.458982221171774e-02   +4.036648377991499e-01   -1.013949245775513e-01   +1.757664693505379e-01   -1.192568108254944e-01; +4.407179303281510e-02   -6.762382648731943e-02   -3.559779984170122e-01   -3.551396015495066e-01   -1.883513827325402e-01   -2.197205169806221e-01   +1.667800537618410e-01   -4.217858593108470e-03];
L2E_L2I_iGABA_netcon = [-6.359206180920646e-03   +1.456073746333275e-01   +9.129860017590317e-02   -4.201973069699357e-01   +3.140048806141708e-01   +2.946972609797961e-02   -3.149985576500738e-01   -6.519522591844384e-02; +1.083659024366838e-02   +6.499365845375620e-02   +3.683985070462439e-01   +3.640480724323506e-01   +2.292346824711702e-02   -4.438916372997495e-02   -5.737692621006676e-01   -8.620497109840425e-02; +2.802083145040235e-01   -3.017051542459944e-01   -1.826716960633362e-01   +2.596367427200867e-01   -1.100234201120911e-01   +2.878205449398727e-01   -1.254314639273915e-01   -5.255252496606155e-02; +1.750058511349618e-01   -1.504678507021670e-02   +1.490988879719669e-01   +1.618300584750713e-01   +4.172931767667513e-02   +3.942960659464038e-02   +2.188989546296750e-02   -2.312052419097343e-01; -2.030155983126198e-01   +3.383395535843391e-01   +5.979835646064058e-01   +1.194162598175553e-01   -1.755521176997383e-01   -3.101464736055716e-01   -1.029087094949628e-01   +2.996151007047593e-02; -1.542513438536020e-01   +2.447637885861842e-01   -1.949842323080735e-01   +3.545707420365241e-01   -2.932938277093229e-01   +2.047136921945614e-01   +9.699192443838831e-02   +1.973623816719910e-01; -1.810115076890709e-01   +1.488832416630751e-01   +2.421897182176800e-01   -4.686808370907828e-01   +1.658230879615847e-01   -5.162715956126293e-02   -5.130943606200484e-01   -2.374702424865552e-01; -2.207187520661819e-01   -2.939349520310787e-01   -9.143185027743704e-02   -1.022363367895792e-01   -5.220312854417002e-01   -8.255279112903979e-02   +2.452906956942132e-01   +4.293336132482988e-01];
L3E_L2E_iAMPA_netcon = [+1.088865207881741e-01   -7.231369566207194e-02   +4.258123222207127e-01   +6.621885914165050e-02   +2.602805564868990e-01   +1.370999023949754e-01   -1.941598694921134e-01   +5.053744284424552e-02   -1.672205270684299e-01   +2.079579029751394e-01   -1.542613027903817e-01   +4.621390929674729e-01; -1.891429534452742e-01   +1.998043840072480e-01   -1.542265621392398e-01   +2.697975991873777e-01   -3.532360793483098e-02   +2.604735381198051e-01   -1.593127503832746e-01   -1.024915411728184e-01   -1.331185482762819e-01   +5.449867881323986e-02   +1.755745306208345e-01   +2.433251491400600e-01; +1.549159528319674e-03   -8.438469399741880e-02   -1.555846808314100e-01   -1.223617090226825e-01   -4.031280721643535e-02   -1.382157359591526e-01   +1.467083616644373e-01   +9.503690329542704e-02   -4.002346837083688e-01   -2.330350954817410e-01   +1.098454619553993e-02   -9.889691217507918e-02; +4.208664704835687e-01   -3.156028455911697e-01   +1.755438018753873e-02   +9.460427210901036e-02   -3.825706601500520e-02   +1.200547855978279e-01   -4.337623560722145e-01   +9.719493263065132e-02   +1.609928736588006e-01   -8.109348604655198e-02   -1.033297314872384e-01   +3.664108403144178e-01; -1.103770445903628e-02   -5.201728425685424e-02   -2.703393351573914e-01   +2.266834975673798e-01   +2.288027940313911e-01   +4.917961867762137e-01   -2.199409122709019e-02   +1.928503786668220e-01   +2.387283341477077e-02   -1.479228122239149e-01   +6.762031066565778e-02   -9.045658526249792e-03; +1.195667499863191e-01   +2.027636693743408e-01   +4.640789737135391e-01   -1.783915723989012e-01   -2.686904070991767e-01   +2.597739631887885e-02   +2.271318000963786e-01   -2.178192993379884e-01   -4.315181744197200e-02   -2.619198854892314e-01   +4.780329654613363e-03   +1.187444810290605e-01; +1.230270569364950e-01   +2.466581194370592e-01   -1.710373504865342e-01   -1.270978175383921e-01   +2.648869603113981e-01   -3.853955690837101e-02   -1.124801003176523e-02   +1.313630316691094e-01   +2.573814531082708e-01   -3.763760377530422e-01   +2.088252799472334e-02   +1.132595376076808e-01; -4.043020780023482e-02   -1.968064781881679e-01   -1.013311972601303e-01   -1.542893100757109e-02   -4.464477319609088e-01   -3.325806822427562e-01   +9.842053635955475e-02   -3.204262161984920e-01   +3.917022530564794e-01   -2.670221908264197e-01   +5.770942550926392e-02   -6.891061422821952e-02];
L3I_L2I_iGABA_netcon = [-3.735002457617868e-01   -2.405127799051598e-01   -1.788192862857640e-01   -1.964542288551890e-01   +2.722514476228066e-01   -3.978733005597379e-02   +2.462167427592115e-01   +4.408042461153241e-03   +7.015516242901909e-02   +3.139134185127127e-01   -2.931073327520229e-01   +4.179327491283339e-01; -1.049078472054758e-01   -3.611588292403056e-02   -3.740898225633877e-01   -1.365856195922754e-01   +7.602400963144712e-03   +4.667571117205949e-01   -2.200968780546340e-01   -1.840604622273432e-01   +8.582315780323353e-02   +5.019508903509484e-01   -2.381599680303309e-01   +4.231714440224825e-01; +1.633817334836286e-03   -2.051707731467643e-01   -3.921764367791485e-02   -1.934264022527190e-01   +7.025885426088668e-01   -2.294299807729052e-01   +1.971322147036672e-02   -2.019303758641715e-01   +2.970487382338640e-01   +2.417876375356676e-01   -3.788290313448308e-01   -1.836792042810651e-01; -2.827219793036102e-01   -2.838041684545318e-01   -8.372403379111971e-03   +3.188791838887453e-01   +1.142985944547756e-01   -8.214149940492391e-02   -2.490362298757977e-01   +2.126908778831662e-01   +2.247359853224120e-01   +4.211944820061440e-01   +8.070889889522789e-02   +2.264595570607044e-01; +4.909838515542635e-01   +2.499151092262387e-01   -7.359929158268672e-02   +2.061028890655167e-01   -4.177941943009988e-01   +1.095473500280559e-01   -2.270913997650293e-01   -3.212055313589604e-02   +1.162937713225854e-01   +3.671361160846894e-01   -2.568626118456039e-01   +6.944599159957979e-02; -8.816410607536795e-02   -2.272025726331747e-01   -1.558584940341341e-01   +6.842157071380417e-02   +1.541251259432620e-02   -1.045803157542090e-01   +2.550995934799195e-01   +2.150363335059593e-01   -1.191456687553742e-01   +2.619909717393165e-01   -4.501045046356051e-01   +2.129126287531997e-01; +3.753429535022783e-01   +2.021196924250510e-01   -1.087239187925191e-01   -5.947074133750238e-02   +1.380188979421566e-01   -2.861566702923508e-01   +1.950543742413639e-01   +2.722331950054770e-01   -2.316734188141497e-01   +1.259411687229099e-01   +2.991469162864884e-01   -1.376307139062753e-01; -8.673428245357714e-02   -2.536738236057463e-01   -3.125360532028498e-01   +3.090965630578571e-02   +6.178807885647750e-02   -1.012254405764811e-01   -6.199204104798610e-02   -5.253343916859487e-02   +7.544010653272651e-02   -1.079392133196305e-01   -3.441784113532304e-01   -2.801624348821724e-01];
L2E_L3E_iAMPA_netcon = [-4.509338737545832e-02   -1.045013518632985e-01   +8.549768520995475e-02   +3.829257620943269e-01   -1.997128034057667e-01   +4.005435825207064e-01   -9.572440103666477e-02   -4.003304379398931e-01; +1.491899703698374e-02   +1.037864304016369e-01   -7.096115589432651e-02   +2.846835904486020e-01   +3.295152124551760e-01   -2.825518339507116e-03   -6.155307694164197e-03   +1.591513307298474e-02; -2.646957876064994e-01   +1.093748303979749e-01   -1.487520346878297e-01   +8.823802988513661e-02   -1.594176690480397e-01   -2.478678662145727e-01   +3.818434204140972e-01   -3.996608440632056e-01; +1.792677811469875e-01   -2.991844484417514e-01   -1.698756836793126e-01   -1.298330576837620e-01   -1.237587811358757e-01   +2.724459336450569e-02   -5.472703003271162e-02   +6.009614061694073e-01; -2.429402044924784e-01   +1.875456992572961e-01   -3.242908775418498e-01   +1.454311884673117e-01   +7.490725450504106e-02   -2.579481380613409e-01   -1.402030516368496e-01   -3.182039108337479e-01; +6.117141428314133e-02   +2.206030191617651e-01   +3.197494911651875e-01   +1.653509254011695e-01   -4.617460070602539e-02   +1.917379748690052e-01   -1.500930291576921e-02   -9.467454827211885e-02; +2.839272660369143e-01   +1.639980487286190e-01   -2.207637574850391e-02   -3.419174581520426e-01   -3.302050997335593e-01   -1.519270249500332e-02   -2.580420096624758e-01   -4.560992666155614e-02; -1.940741428007892e-01   +1.268505900167181e-01   +9.163249343782703e-02   -1.074057065304354e-01   +1.678284409170435e-01   +1.891218012525048e-01   +4.936551201768711e-01   +2.199690402766986e-01; +4.988108049025620e-01   -8.647608848371398e-02   +3.191504446748653e-02   +4.201381264594715e-01   +2.955787035434821e-01   +5.092017784114086e-02   -3.205762354853474e-01   +1.688206923902314e-01; +1.370912554982752e-01   -7.804430805194323e-02   +2.904952272337354e-01   -2.533142464389733e-01   -1.556541707365995e-01   +1.669872602027158e-01   +1.217362287647536e-01   +3.315669777809922e-02; +1.917357266588294e-01   +9.262803287470872e-02   -1.927234699063889e-01   +4.238299805054542e-02   -1.852227361068907e-01   -2.574442557559198e-02   +4.065978976300947e-01   -6.385072205349929e-02; +2.062760547932332e-01   +1.440562348847148e-01   -2.809352750790036e-01   -2.200945889212690e-01   -4.828998224709761e-01   -3.257412313214147e-01   +1.756497206181321e-01   -3.057384918323092e-01];
L2I_L3I_iGABA_netcon = [-2.644086762062584e-01   -2.227999805199911e-01   +3.023927118549304e-01   +8.642879773206175e-02   -1.425361246042805e-02   -1.382099770609870e-01   +2.283825240171330e-02   -4.465153260648010e-01; -1.344026463840234e-01   +4.335480391790978e-01   +1.100264209301936e-01   +4.490405029192545e-01   +9.074186714380553e-02   +4.946951531139833e-01   +3.191583969178977e-01   -3.845978851596566e-01; -1.078830591855231e-01   +3.531419222406840e-02   +2.484545533072212e-01   -9.223854227207809e-02   +3.259711789055575e-01   +1.928719069124489e-01   +3.228140306932961e-01   +1.408624181135766e-01; +1.805730144816665e-01   -3.713164824557255e-02   -9.668514819074826e-02   +1.534261442497522e-01   -3.653528066924130e-01   +1.206893588454949e-01   -2.947526414233115e-01   -8.966825796588870e-02; -1.580427867163516e-01   +2.578819110152787e-01   -1.604119770137468e-01   +2.128367813371168e-01   -2.870150280528299e-01   +1.232288590585136e-02   +6.621493872399370e-02   +3.544002313109891e-01; +2.692598900887376e-01   -3.687669576548928e-01   +1.169798654480937e-01   -2.052546448053079e-01   +5.023944056301390e-01   +3.748274811029739e-01   -1.197748508811405e-02   +1.428012857639369e-01; -7.189688491542381e-02   +9.209931559514034e-02   -1.577681095315205e-01   -5.344137098205191e-01   +2.053561683938767e-01   +9.066791310613334e-02   -1.708973768346831e-01   +1.271475040545625e-01; -1.638494328398604e-01   -2.490937158582539e-01   +4.017205720442928e-01   -1.447651593839274e-01   -9.062692777478543e-02   +2.951556025040099e-01   +1.957962506781219e-01   -2.011960888701237e-01; +2.891959830758660e-01   -2.892728479300706e-01   -8.738246452062892e-02   +1.016430131889844e-01   +1.823347225682227e-01   -2.963752955489493e-01   -7.359796927754576e-02   +4.285927081250086e-02; -9.554527405886837e-02   -1.132675493319281e-02   -7.654698181205642e-02   +1.686454656385268e-01   -2.766936067142372e-01   +3.931036737789793e-01   -2.221530574232647e-01   +2.012286688335960e-02; -1.283184329463016e-01   +1.794759226629827e-01   -9.829757466853829e-02   +2.360105055219294e-02   -3.462983752806469e-01   -3.300190167712789e-01   +5.056827079971499e-01   -3.079292380924702e-02; -1.888051877998602e-02   +3.333707492381738e-02   +1.631050155643134e-01   +1.669530677426403e-01   -2.294763221032948e-01   +3.033278462634588e-01   -1.609579622579116e-01   +1.752070100185636e-01];
L3I_L3E_iAMPA_netcon = [-2.224777247941776e-01   +1.745643245330793e-01   +1.055658742612923e-01   +3.612977890433040e-01   -5.112008101868284e-02   -1.071565760251547e-01   +1.344117120756605e-01   -1.381396386383313e-01   -4.119727678944168e-02   -2.722884308048682e-01   -3.243848501575612e-01   +5.422555041803377e-01; +5.773229304502351e-02   -1.813967584105698e-01   +7.335598054191303e-02   -3.964211395842258e-01   -1.896738015257897e-01   -2.455813045754617e-01   -6.832112754898549e-02   -1.217772520301185e-01   -2.422918805427307e-01   +2.532860568037369e-01   +4.870953211526136e-02   +3.677120663253290e-01; +2.292005115051335e-01   +4.709221824429606e-02   -2.083988281601368e-01   +1.242189167944119e-01   +9.513908407516594e-02   -1.584585952534717e-03   +1.430347659297160e-01   +6.375657648362612e-02   -3.665040653300697e-01   -8.900164659784583e-02   -1.926329479480729e-01   -2.245037256488062e-01; -5.000937788695679e-02   +7.187072538818456e-02   -6.956530965335807e-02   +3.973669663360762e-01   +1.941614187386536e-01   +2.228346334613890e-02   -3.304355025672459e-01   -4.152934496438502e-01   +2.788913129208209e-01   -8.068617679186744e-02   +2.683059034904374e-01   +2.967217842903563e-02; +3.021199652885281e-01   -1.226507800620824e-01   -2.735692238012367e-01   -1.315500486023257e-01   +2.640968537195711e-02   +4.223689227876994e-01   -2.662624507024744e-01   +1.856234215908495e-01   -2.747064364339512e-01   +1.625166232401738e-01   +2.393854426213022e-02   -2.695513544051842e-01; +6.457805811367025e-02   -2.507402070925465e-01   -1.970603998855919e-01   +1.311035344272902e-01   +4.007584203191113e-01   +1.065876526890308e-02   +3.357807119720476e-01   -2.257130281342043e-01   -3.350463405789053e-01   -3.997190222351594e-01   +2.481632198193562e-01   +2.811309889991960e-01; -1.840145625968034e-01   +1.303866543299582e-01   +6.946778694030134e-02   -3.589831556478402e-01   -2.792320734735632e-01   +4.969443811365662e-02   -8.721940240961300e-02   -9.189390904149021e-02   +3.624698334465489e-01   -2.698840993557107e-01   +7.315544668442100e-03   -1.905270928474064e-01; +3.896005846954511e-01   +1.514866800353448e-01   -4.291497284268209e-02   -4.509180732782660e-02   +1.084334774667819e-02   -1.466834027496021e-01   +2.544323970388038e-02   +1.801951675412370e-01   +1.515059369396619e-01   -2.726660058837179e-01   +3.544733327482266e-01   +2.240032108250875e-01; -6.679405788273926e-02   -7.242427292899109e-02   -9.650086673539116e-04   +2.928535399278044e-01   +1.530761348847686e-01   +3.235106599859865e-01   -8.255353686028068e-02   -4.863665536785604e-01   -7.938098292020401e-02   +4.092124041951728e-02   +6.098779558309303e-02   -4.036066856213213e-01; -3.676216839125258e-01   +3.283582103719740e-01   -1.300244153232752e-01   +2.132895290796173e-01   +4.380076952092679e-01   +5.943479902171431e-02   -1.484018239474552e-02   +2.196852059574817e-01   +2.317494929823760e-01   +2.142919540611400e-01   +1.180478884554013e-01   +4.853203472572066e-01; +2.800898979684781e-01   -1.042237251262673e-02   -9.805246129889301e-02   -1.858270424002716e-01   +6.746423415190106e-03   -3.912070038090760e-01   -1.177373232287920e-01   -1.731501154260018e-01   +1.713130572705829e-01   +4.576077564155827e-01   +7.369025340825594e-02   +1.378295740148447e-01; -1.658576122440852e-01   -2.929303348251119e-01   +3.409229188592261e-01   -1.481372107001064e-01   -1.116463214112138e-02   +3.548382884969253e-03   -4.960240774840618e-01   +1.086320764279546e-01   -1.719965180753615e-01   -3.343615437658529e-01   -4.692429193643710e-03   +3.894981173820091e-01];
L3E_L3I_iGABA_netcon = [+3.979994182220297e-02   -3.950864234466070e-02   -2.305736420738079e-01   -8.799681639971366e-02   -2.155353219972264e-02   +1.422274777160529e-01   -4.325000499141161e-02   +2.298696277411258e-01   +2.713014796126284e-01   +1.263535757451169e-01   +5.836491927067708e-01   +2.214370553721676e-01; -1.107898053285342e-01   -2.095600189790366e-02   -1.878809717572183e-01   +1.969967242957405e-01   -2.049873253780399e-01   +5.789135183112160e-02   -1.524144065433476e-01   -1.015488507882873e-01   +3.506532984486993e-01   +3.869978833569941e-01   -3.917116654633920e-02   -2.731101219368609e-01; -5.031310338106982e-01   -4.337148373541859e-01   -3.580358988255897e-01   +1.522116648884877e-01   +1.857888941285057e-01   -1.384882608994450e-01   -9.524188856298269e-02   -4.446786421209853e-02   +7.971571519925319e-02   +1.909844697755893e-01   +1.383807989861038e-01   +4.104522173588563e-01; +5.952578565484706e-02   -1.429122471523784e-01   -2.068933418157887e-02   -3.253974633953453e-02   -1.252398760973463e-01   +1.949899051829087e-01   -8.431792562721654e-02   +3.727209630118687e-01   +1.360397428259745e-01   -2.278643262720792e-02   -2.251476685893312e-02   +3.505803008200673e-01; +1.329084546337607e-01   +1.337636670360613e-02   -4.404380780272747e-01   +1.153990740650351e-01   +2.902148319310325e-02   +1.141051365481480e-01   +8.460510767798635e-02   -4.232955321357335e-01   +4.529274733862285e-02   -2.679488554635687e-02   -1.680501477237709e-01   -2.671296618273117e-01; -2.262917858876807e-01   +7.887370909887406e-02   -6.050354866188278e-02   +3.234480031103389e-01   -1.515478809910799e-01   -2.094334521467300e-01   -6.214000824962204e-02   -9.881384415949256e-02   +2.499067302915302e-01   -3.604985650903124e-01   -2.365307133075308e-01   +8.063708392374191e-02; +1.492031114233333e-01   -2.701488551790810e-01   -1.408506496080680e-01   +1.286581299114807e-02   -3.998910104164765e-01   -3.912858109613080e-01   +5.051885655378091e-03   +4.519467551009737e-03   -1.902108903565408e-01   -3.009703056667547e-01   -5.721195949303276e-02   -3.117318239071836e-01; +3.122223690650365e-01   -1.344911525605307e-01   +1.267459852143880e-02   +1.776330251176387e-02   +3.145618104477113e-01   -3.046224445673430e-02   -2.981612611030427e-01   +4.490261422007935e-01   -1.520368563806078e-01   +1.283043562476227e-01   -2.648302232299945e-01   +7.732412370620848e-03; +2.961266207789798e-02   -3.795002553282048e-02   +1.096200697854130e-02   +1.278532522274322e-01   +4.591652480118560e-02   +2.560670797068251e-01   +8.933966222084014e-02   +2.306797444745945e-01   -3.015430303725155e-02   +2.958379583567451e-01   -1.357847353650305e-02   -3.711406653270098e-01; +3.897565319175165e-01   -4.885386273590476e-01   +5.576873297957266e-02   -7.331855048993863e-03   -3.628553332943864e-02   +2.291929589002352e-01   -9.895643330681705e-02   -2.031733274545503e-01   -2.784149050411341e-01   +5.708149909335336e-02   +1.837565858991967e-01   +1.353710672319016e-01; -3.022974482659848e-01   -2.350877029480349e-01   +1.170293043621605e-01   -9.209971445924975e-04   +3.728685354002252e-01   -1.459628495396728e-01   +2.727285681474658e-02   -3.223531479131937e-01   -7.348999219064464e-02   -1.715268633969222e-01   +4.520701289820824e-01   +4.859554511777892e-02; +2.826809283581045e-01   -3.473854520866085e-02   -5.376013276971447e-02   -2.352028734509857e-01   +1.764938092646058e-02   +1.056100914992487e-01   -3.106855523324764e-01   -2.172038652405250e-01   +1.499955878417189e-01   -4.256090316433458e-02   +3.223660864438460e-01   -1.325054213130679e-01];
L2E_Input1_iAMPA_netcon = [+2.178183820853055e-02   +2.239584521671908e-01   -7.705232709845625e-02   -2.403080307295107e-01   +5.995568135104018e-03   -1.430419878760468e-01   -1.262192724589133e-01   -1.855882236146876e-01];
L2I_Input2_iAMPA_netcon = [-5.027913045864923e-02   -1.794926828429924e-01   +3.826086574325802e-01   -1.264826397096134e-01   -3.791358536399875e-01   -3.348007718419436e-01   +2.696196853592818e-01   -2.178450297164919e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
