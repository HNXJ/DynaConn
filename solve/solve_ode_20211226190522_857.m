function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.128554645766584e-01   -1.007731702105953e-01   -1.253617396720422e-01   +2.143414553942161e-02   +8.438350136525131e-02   +3.466593729356918e-02   +4.315102571328944e-02   -2.191255262872557e-01   -2.036274252512930e-01   +5.424021778308220e-02   +3.786423792218326e-01   -1.955257681518875e-01   +2.837416303779027e-01   -1.887364734500047e-01   +2.508323750690244e-02   +8.537029846768922e-02; -1.023343114855170e-01   -1.404384600200300e-01   -1.366941714799356e-02   +1.309762283156253e-01   -4.662643577832805e-01   -2.739032405509854e-01   +1.635615746315451e-01   -2.587018109342340e-01   -2.740449839829311e-02   -2.982859431125224e-01   +6.382939176947325e-02   -8.747632548465228e-02   -1.208167074816321e-01   -2.250064510638938e-01   -1.209821718984060e-02   +3.367863468411446e-01; +2.269669788188911e-01   -7.011894065546476e-02   -4.515247660555805e-02   -4.447497001705448e-01   +1.355167896651873e-01   +2.682804769574071e-02   -1.464170882109543e-01   -1.000843626943126e-01   +8.013374296960087e-02   -1.416777319396506e-01   -1.280795692833687e-01   -1.617230784387030e-01   -1.975981494740774e-01   -1.567596994121051e-01   +3.076743424750338e-01   +1.647966425492484e-01; +1.177522544230035e-01   +6.000525458894047e-02   +6.612235659607416e-02   +3.112866036017056e-01   +4.445258446231716e-02   +4.359431045437622e-02   +1.644718387899069e-01   -2.183432722486264e-01   -2.275478512403080e-02   +4.311536696042595e-02   -6.968306318014995e-02   +2.112272586233433e-01   +6.830613711566735e-02   +1.783902771423791e-01   -1.556837234367554e-01   -2.289817111261482e-02; +1.135268489986690e-01   +4.464012184584679e-02   +2.789288385094504e-01   +1.430282580173942e-01   +7.595919546577812e-02   -3.337468444909675e-01   +1.016677628832602e-02   +1.794072225956301e-01   -1.700082837801936e-01   -4.620875157286795e-02   +1.332429805767657e-01   -8.549637693370744e-02   +1.549468432439231e-01   +2.511897682966034e-02   +2.260143878672018e-01   +5.385026091242900e-02; -4.819453147171848e-02   -1.293787281129260e-01   +3.713741098154079e-03   +1.265610756987086e-01   -2.527774009937032e-01   +7.512226994928593e-02   +1.945402831877723e-01   +3.290118992000770e-01   +2.917594185485923e-01   -3.985352864457251e-02   +5.154109918029917e-02   -3.477323435597632e-02   -8.499573327564210e-02   +9.643968823385356e-02   -1.903484644839336e-01   -1.365015719235160e-02; -7.278487108392659e-02   +1.809411147037254e-01   -1.165411922445120e-01   -3.889661117467608e-02   +1.793794799342830e-01   +2.589535618266035e-01   +1.707374405486688e-01   +6.005015984856815e-02   -8.951153411056550e-02   -2.053405363952373e-01   +8.110805581108968e-02   -2.043012973577304e-01   +1.464435687643222e-01   +3.814150660752580e-03   -7.973100821546582e-02   -9.077900249906473e-02; +8.194807534972692e-02   +3.429568461626205e-01   +1.932037415853360e-02   +2.743093290192364e-01   -2.755622805587398e-01   -1.810827841915478e-01   +3.098986466395307e-01   -3.832334060675163e-01   +2.058494618510587e-01   -9.518388753766074e-02   -1.598585677733540e-01   +5.560400365196283e-04   +1.958010897955128e-01   -1.987399815643019e-01   -1.423270122359049e-02   +2.473301136861761e-01; -1.287126472267927e-01   -7.534235987491490e-02   +2.533747971545741e-01   +4.648921338320978e-02   -8.475048802947316e-02   -1.548952375835941e-01   -1.513890657232949e-01   -1.327964136152581e-01   +3.486671702308594e-01   +2.597593972672940e-01   +3.231457733065754e-01   -1.131092901408988e-01   +1.411098677271393e-01   +2.559605505116611e-02   -4.187067173573496e-02   +7.185617725156601e-02; -9.277361321362823e-02   +1.019483200078489e-01   -2.500197834684005e-01   +2.807542193261336e-01   -2.152796547224175e-01   -2.785664803089793e-02   -9.096714763676730e-02   +1.293945820366377e-02   +4.344976844612204e-01   -1.113502275127170e-01   +1.927763920079321e-01   -2.570927248891089e-01   +2.833977480131655e-01   +3.976880777509918e-02   -2.132688119959230e-01   -2.359583671665777e-02; -2.289353501381554e-02   +4.741029172948798e-02   +9.328258493873059e-03   +2.079461335049959e-01   -1.942212816526069e-01   +2.409375623666693e-01   +1.632804989424896e-01   -1.762264213988017e-01   -8.440878552568820e-02   -1.911230064777730e-01   +3.944590058809184e-01   -2.703269985872698e-01   -2.671322725683010e-01   +1.122506289682310e-01   -1.634606462946670e-02   -1.882168963710808e-01; +9.985894623568473e-02   +4.972173652982201e-02   +1.169456333557259e-01   +3.942361353073872e-01   +9.109937230803444e-02   +1.963543859251117e-01   -1.820142754233224e-02   +1.099556606610677e-01   -8.431209965863190e-03   +3.235253822837678e-01   -6.785278961756194e-02   +2.775760038242281e-01   -2.414296030606413e-01   -1.527884097692901e-01   +7.419045983083825e-02   -3.838588153703220e-02; -1.654145943777620e-01   +4.524037059186687e-02   +6.843700869223021e-02   +4.871171592758162e-01   +8.235974212632650e-02   -2.235391560517683e-02   -2.228402311144067e-01   +3.138785524680207e-01   +2.054570634650658e-01   -1.653379157780982e-01   -3.190823703335230e-01   +1.179403289465529e-01   +4.756118913633641e-01   +5.708820485749187e-02   +6.522295881443832e-03   -2.660892968174601e-02; +1.735409279890157e-01   -9.711505131046838e-02   -5.196062814041316e-02   -2.034638681610612e-01   +8.486387435497728e-02   -1.345037787456832e-01   -1.655208417982637e-01   +1.452896330056122e-01   -2.269926738458413e-01   +6.492347215883060e-02   -2.406924819191562e-01   +3.014423125501783e-01   +8.111350560301389e-02   +1.150150837999959e-01   +1.286035508318587e-01   +4.926345992443018e-02; -3.356065338157531e-02   -4.806736459772146e-02   -6.843375110339533e-02   +2.618595619727988e-01   +4.465589780407311e-02   +2.250924493268061e-01   +4.134402803630874e-01   -5.646948730410460e-02   -1.891838710589779e-01   +1.992963717866400e-02   +9.150911145122523e-02   +2.086890659034897e-01   -3.008770489710375e-01   +7.763945550354613e-02   +5.114166427682899e-03   +2.690667663953457e-01; +1.432943546656912e-01   +3.908806011456606e-01   -1.861123811989809e-01   +8.003858291293374e-03   +2.120585748712906e-01   -7.223875864279594e-02   -1.646940311746836e-01   -1.174829502307292e-01   -5.324114225480847e-01   -8.199953270493267e-02   -2.112024559895660e-01   -1.880348020979915e-01   +1.753274078379031e-01   +2.782677407203279e-02   -1.308695479810388e-01   +1.109773488385976e-02];
L1E_L1I_iGABA_netcon = [+8.430150686251442e-03   -4.104813317108955e-01   -1.037224644357845e-02   -4.713866053467124e-03   +8.339916220448125e-02   +1.542435500786802e-01   +3.207714262352466e-01   -1.442155932466274e-01   +1.286957360821007e-01   +2.104988085335164e-01   -3.103058405024152e-01   +4.319704941899976e-01   -3.917190049483578e-01   -7.623011115007314e-02   -7.395522664402364e-02   +7.817315598566510e-02; +2.288456993424972e-01   +1.044353995172238e-01   -1.962664484480330e-01   +9.457010444022966e-02   +1.509048074775928e-01   +7.922103202499545e-02   -3.636022093319091e-02   -5.087606394451828e-02   +2.318297328312950e-01   +2.448871148101798e-01   +9.686603698626102e-02   +1.673739212524636e-01   +1.121344865680730e-01   +1.950329683163052e-01   +2.634075052660909e-01   -1.949768266719883e-01; -2.080798411351117e-01   -1.915196035247338e-01   -6.059758928668267e-02   +2.135262619686133e-02   -9.664059439686976e-02   +9.686110743835158e-03   +1.219750496737480e-01   +6.489963510026998e-02   +2.332141044371819e-01   -1.136267343402032e-01   -1.657074824119439e-02   -1.297970035719253e-01   +2.543700655513952e-01   -3.265565692160634e-01   +2.373258069063188e-01   -5.509106674508903e-02; +2.944722262884076e-01   -1.704811704910169e-01   +1.632838379490420e-02   -1.937530636121152e-01   -2.946138135050609e-01   -1.268629961262696e-01   +1.798958309894683e-01   +1.977931180628593e-01   +2.987230167595809e-01   +2.572502085078206e-03   +1.978315909675259e-01   +1.921818872711707e-01   -1.308759574456466e-01   +1.217037851913278e-01   +2.206865828871319e-01   -5.929873716068976e-02; +4.408168010086064e-02   +1.961665338854531e-01   +5.085464045379914e-02   -2.178816840692388e-01   +1.039980093440174e-01   +3.354882998780833e-02   -4.643495556996195e-02   -1.211527161330785e-01   +9.214957819290936e-03   +6.505627073074871e-02   -3.480645170265707e-01   -2.153461394469376e-01   +6.941320256015047e-02   -7.606968402485509e-02   +6.432683050450888e-04   +5.071177370304487e-02; -1.755164154518984e-01   -7.634583334009784e-02   +2.012715764979146e-01   -4.017562929250288e-01   +1.412069602860079e-01   +5.305022013386197e-02   -1.381466135380041e-01   -1.644502880024732e-01   -2.933237600492812e-02   -1.436463720625127e-01   +1.366878835840370e-01   -4.205131720527869e-01   +1.978209063491459e-01   +3.086818295891861e-01   +1.971552666895742e-02   -3.151905044108310e-01; -1.449532173569640e-01   +2.267286048171077e-01   +4.024079222696991e-01   +1.088934337994087e-02   +1.141915924542418e-01   +2.318597414403695e-01   +5.488810801032191e-02   -4.435529114836887e-01   -4.381417506914944e-02   +1.336504498533604e-02   +2.618054008764870e-01   -4.147928584518805e-02   +2.309770391586387e-01   -2.327489746312002e-02   -7.372713273440099e-02   +2.726741625606943e-02; -3.573279196279206e-02   -5.425176297861843e-02   -1.628352965261200e-02   +2.109242519967802e-01   -1.743343353433082e-01   +6.140676342405199e-02   +1.885839147282740e-01   -2.442926987644368e-01   -8.567450870739773e-02   -2.020806791216710e-01   +1.900424314855647e-01   -1.349218507451106e-01   +7.430418917742321e-03   -8.563444208349409e-02   -2.077572546728965e-01   -7.687257162143843e-03; -3.552708778112306e-01   -3.024277633145173e-02   +4.285066853793177e-02   +7.552982035385541e-02   +4.778563894289725e-02   -9.908147096305121e-02   +7.231815540854557e-02   -2.814596686958107e-02   -1.135813040851764e-01   -3.248059588591347e-02   -3.395859542631638e-01   -1.240757839894967e-01   +1.578051184295873e-01   +2.177825951751939e-01   +3.053746289067852e-01   -1.273343940773647e-01; -4.366352231728059e-02   -2.219728331794052e-01   -2.961495880463903e-02   -7.085749750779941e-03   -4.893414264943173e-02   +1.234735953697693e-01   -1.675123877284100e-01   -1.671384327137285e-01   +2.314713154422274e-01   +4.178395301446976e-02   -1.547837900038148e-01   +2.021568629161372e-02   -2.663381483789024e-01   +5.217419408331352e-02   +4.745488958990356e-02   +1.080858385092944e-01; -5.920242433678916e-02   +8.027532358825409e-02   +2.289002496365102e-01   -2.175137533928252e-01   -2.311346165456127e-01   +8.926262378674842e-02   +2.062385733904076e-01   -4.605322488656281e-02   +3.341381185089667e-02   -8.895672516604838e-02   +2.267283410613423e-02   +2.468231930919278e-01   +2.287253780420621e-01   +1.544317253029997e-01   +2.500607617591828e-02   -2.368953606414397e-01; -2.537995697100651e-01   -1.388822068073595e-02   -2.525044914317451e-01   +8.513807852401226e-02   +8.221032502662627e-02   +2.173609445124824e-01   +2.410949301105092e-01   +1.538229609250323e-01   -1.320395455943796e-02   +1.376492726775775e-01   -2.564124695358860e-02   -2.252735227938522e-01   -7.059589346322871e-02   -7.342571609561765e-02   -1.799097430346850e-01   +3.312989144457194e-01; +6.134370538772596e-02   -1.709466962308294e-01   +3.500585506062339e-01   +7.988840964181353e-02   -3.424885851938491e-01   +1.401531367931415e-02   +4.898766400899142e-01   -1.581123860511160e-01   +3.328174167557715e-01   +2.381010862463885e-01   +3.201898528515881e-02   +3.707494268717306e-01   +2.306516495950959e-01   -6.528865713270703e-02   -1.417580569551778e-01   +2.666224882228113e-02; -1.806238716595052e-01   +9.231775938984223e-02   +1.368610059505097e-01   +2.221807730627529e-01   -9.594080575408968e-02   +1.067842560827009e-02   -1.473656704701609e-01   +2.139264997557152e-01   +2.171416763289412e-02   +3.390197201555896e-01   -2.369575633861519e-02   -1.556629911320543e-01   +1.106923034090527e-01   -2.423399614794579e-01   -5.298552383241113e-02   -3.875626493917611e-01; +3.081780257821401e-01   +1.884534702128571e-02   +4.704154108419739e-02   +3.937562455845230e-02   +1.421357781250285e-01   +2.350170524065998e-01   +1.481805759710596e-01   +7.957604909918074e-02   +1.429705141003847e-01   -3.459520847157270e-01   +2.164843385081114e-01   +2.251783830272679e-01   +1.333599045830903e-01   +8.758373670811082e-02   +1.591760197778244e-01   +4.155322977341658e-01; +1.203082745778213e-01   -1.793565536057438e-02   -1.984320381026558e-01   -9.368047425060458e-02   +1.936033490205414e-01   +1.050248826361977e-01   -3.554275254998940e-02   +5.359002264148190e-02   -6.545636125254323e-02   -2.620095495194385e-01   +2.980875960667479e-02   -3.140191852317681e-01   -2.152306087994744e-01   +2.028317446824841e-02   +1.193040445184862e-01   +2.883873893962658e-01];
L2I_L1I_iGABA_netcon = [-3.150108545847761e-01   +8.986144800882750e-03   +1.537483291651607e-01   -3.284986710454005e-03   +1.829894688697193e-01   -1.112092207043197e-01   +3.382272549294679e-01   +8.995935860868494e-02; +2.146581074133316e-02   +3.718140736379001e-03   +1.562985608163185e-01   -1.952969429102548e-01   +4.706853258153598e-02   +1.907525676429253e-01   +7.808880751518441e-02   +3.589369281143595e-02; -6.326897246485051e-02   -2.462568149573852e-03   +5.582072312396405e-02   -9.146555376553046e-02   +4.651335018749164e-02   +5.603165455145949e-02   -8.908346925368263e-02   +7.361700347724955e-02; +2.272992892228170e-01   -8.112540199078674e-02   -2.276849307564277e-01   -2.792788950514092e-01   +1.627687891579396e-01   -7.632440080863029e-03   -1.008611942584762e-01   +2.414563838009420e-02; -2.368011809587049e-01   -2.772076991219140e-01   -1.370534165622213e-01   +3.279222913451242e-01   +1.448092255528502e-01   -2.034580434916394e-01   +4.875032797510580e-02   +1.101256556009514e-01; -8.506266148490355e-02   +2.154417569512345e-01   -5.344412919261105e-03   +3.034255831405784e-01   -1.024531547758254e-01   +3.172783674037734e-02   +5.629260112688585e-02   -1.689612772598204e-01; -2.343600943069046e-02   +2.022075195309115e-01   -9.474779531196241e-02   +3.634201628042996e-02   -3.116995670092587e-01   +3.536141395393018e-01   -1.770474103822277e-01   -1.065746946096193e-01; -4.122589195476183e-02   -2.060618800348037e-01   -2.206568417308480e-02   +1.717564657070841e-01   +2.595635992936129e-01   +1.656391140220865e-01   -1.464297032446454e-01   -3.036909522181299e-01; -1.481304761646706e-01   +9.682172390579372e-02   +5.456623896373039e-02   -2.625558741575651e-01   +7.604227133839088e-02   -1.048264427328181e-01   +1.679033676554548e-01   +7.160383484987083e-02; -6.575740604419519e-02   -1.791013209058439e-01   -1.151973518347994e-01   +1.273462661435553e-02   +1.009566594748950e-01   +1.263438722170714e-01   -1.633732383264715e-01   +2.517121207006219e-01; -5.567575302872596e-02   -1.090576236466272e-01   +2.310714109823578e-01   -1.271860579956871e-02   +1.915734292643885e-01   +6.115965306565320e-02   +8.077590660941639e-02   -6.148272983749428e-02; +2.737503202228500e-02   +1.136694595743367e-01   +2.261549305177485e-01   -3.505494450231970e-02   +2.376237153199250e-01   +7.624298458503119e-02   -8.399089006703345e-03   +4.216881864627459e-02; +2.518665410797085e-01   -2.627652964477477e-01   -1.179162665149058e-02   +5.661808412180553e-02   -2.275536768740225e-01   +2.051098229738825e-01   +2.605669321312618e-01   -7.687562730786947e-02; -3.226254302852719e-01   -1.252622651447691e-02   -9.737629386786120e-02   +2.390250068318379e-01   -2.727727811167309e-01   +1.372742016681242e-01   -1.782615888423547e-01   +9.098433959045167e-02; +2.596252563932956e-02   +7.742239420551786e-02   -5.236208228395296e-02   +1.488661923240376e-01   -1.992443122604008e-02   +1.223862906758473e-01   -3.168115765878143e-01   -4.452675020763577e-02; -7.455965811272464e-02   -3.280849673894233e-02   -3.001721055254736e-01   +2.093709675924960e-02   +1.421299083148227e-01   +4.873046418197950e-02   +3.773758206189168e-01   -1.104710944959238e-01];
L1I_L2I_iGABA_netcon = [-2.877034521641373e-01   -3.902641559240966e-02   -6.358130732431536e-02   +2.849584938383192e-01   +8.225313614693169e-02   -7.591039317528003e-02   -8.154111356552646e-02   +2.366766633031733e-01   +3.428264722501910e-01   -1.532111778085578e-01   -2.340463267373372e-02   +1.333133953834779e-01   -1.512473777464511e-01   +1.498516612908685e-01   +7.233153895978778e-02   -1.497477252342017e-01; -1.190648996404248e-01   +4.016381794767430e-01   +1.962301776064685e-01   +3.696083338953432e-01   -4.917865415310847e-02   -2.189282141811308e-01   -2.591337380967330e-01   -1.619211020633526e-02   -1.771089880064433e-01   -1.105468679699780e-01   -1.025532863048458e-01   -1.285074558920365e-01   -2.149055036026020e-01   -2.185588755817809e-02   +1.856535244735805e-01   +3.889995245568861e-01; -1.074401061343259e-01   +2.353066046980465e-01   +1.434505362975545e-01   +1.852446552822645e-01   -3.015204921674195e-02   +4.956002423232794e-02   +2.736839385196741e-01   +1.212311451461290e-01   -1.854007626706887e-01   +1.841218169346306e-01   -2.614544761667406e-01   -2.984282726144907e-01   -5.538498329359577e-02   -6.664085678184953e-02   -1.208493498059122e-01   +3.904551478973781e-01; -4.164289438010430e-02   -1.435156246900251e-01   -2.188004517178900e-01   -9.003872440442132e-02   -3.280909763064180e-03   +1.642641388348231e-01   +2.978705746596939e-01   +1.146469313727903e-01   +2.101018216273408e-01   -7.914155014345960e-02   -2.098662117224179e-01   -8.206254427595804e-02   +1.868787588580059e-01   +1.364949038097930e-01   -2.945952886904064e-01   -1.781587528624113e-01; +6.243158296104241e-02   +3.361910291384758e-01   -1.630324125408897e-01   +6.982759572340874e-02   +1.224757630399474e-01   +1.310350973264873e-02   +1.680249753013553e-01   -3.463314415568818e-02   +4.372092669251026e-02   +1.958627502643227e-01   +2.063224006431222e-01   +2.155645393085202e-01   -2.541314298687239e-01   +6.483657420216697e-02   +1.861963986993231e-01   +2.411810319952094e-01; +1.264575785890862e-01   +3.489899224989020e-02   -3.258502448602547e-01   +3.482561146433576e-02   -2.956879745469129e-01   -1.600278497328518e-01   -2.518380581112157e-01   +2.452241038881540e-01   +2.738695947595351e-01   -2.473838627259403e-02   -4.357371298996132e-02   +1.555499135331896e-01   +2.247031499819160e-01   +2.707548151637484e-01   +1.403293313716873e-01   +3.215919266446488e-01; -1.392278726333205e-01   +5.182232130282147e-02   +2.401858735687968e-02   +4.927448298325231e-02   -5.795534249353215e-02   +2.851741248519650e-01   +9.773934571459134e-02   +1.277389282049071e-02   -2.851166380901992e-01   -1.258529772654536e-01   +7.038441044928741e-02   -1.069904666452957e-01   -1.024091870539005e-01   -1.017120407565992e-01   -3.617670371268873e-02   -1.980200029849101e-01; -1.519812973124829e-02   +3.963605100952293e-01   +1.966342716488192e-01   +1.541924776447341e-01   +7.120718308951075e-02   -2.488710787063236e-01   -7.369465930816897e-02   -2.342933493069396e-01   +4.555901106966446e-02   +1.113746711522622e-01   -3.894785336830811e-02   +2.167270672927425e-01   +1.957786460130849e-01   +8.529231721118158e-02   +1.055655954661696e-01   +3.786788849449951e-02];
L2E_L1E_iAMPA_netcon = [+2.424020655193886e-01   +6.028308793456465e-02   +4.061660001904429e-01   +2.711551531441416e-01   +3.580931938550955e-01   -5.250301971763169e-02   +3.116075628746964e-01   -1.602385681374004e-02; +3.072443414150076e-02   -2.402376209991254e-01   -9.537441613596775e-02   -2.706460239294677e-01   +4.501757704876962e-02   +2.343975295561510e-02   +2.294889580247190e-01   -3.337569732515631e-02; +1.678216178037897e-01   +1.573187716719625e-01   +2.573096945762666e-01   +2.577836779079734e-01   +1.331446387371418e-01   -1.108515764989589e-01   +4.980481530293916e-02   +3.124085418832270e-02; -1.999709932699245e-02   +2.355868674151327e-01   -1.967741365002182e-01   +4.280563785522731e-02   +1.128633604157927e-01   +7.106074926715136e-02   +1.119075258061200e-01   -3.890051745634671e-02; -2.758748207446673e-01   -8.176914838587801e-02   -2.261285187273914e-01   +1.972388116250469e-01   +1.941964045175726e-01   -2.967700772506582e-01   +1.288536022800414e-01   -3.137820660773432e-01; -1.411737078186752e-01   -6.175282703060278e-02   -2.776993546409124e-01   +1.261815344522798e-01   +1.197783941785648e-01   +9.104327348765179e-02   +2.651306094574478e-01   +1.486342271256064e-01; -9.958260729005500e-02   -1.817520038814878e-01   -1.615982202458034e-01   +1.502486962279548e-01   +3.131143050688736e-01   +1.207947103311999e-01   -6.378307366604929e-02   +2.487863083678359e-01; +2.472303300149363e-01   +1.812257682661887e-01   -4.208535770089282e-02   +9.590669616722716e-03   +1.284994385113144e-01   +3.056880250968261e-02   -1.227537672144609e-01   +1.557967152209100e-02; -1.362906266184566e-01   -4.843523147280976e-01   +4.812897925866540e-02   -1.033308638433422e-01   -4.707478210781565e-02   +1.657916024936650e-01   -2.265501177861347e-01   -9.703427050271282e-02; +7.303899475443042e-02   +1.634231349032090e-01   -1.884634332654026e-01   +2.260538464719659e-01   -2.584415852030610e-01   -1.184865241013041e-01   -2.604011841307312e-01   -1.468431528672376e-03; -1.084878097837853e-01   -5.585356075918738e-02   -3.558856068775879e-01   -3.038192265483614e-01   +4.210680490069884e-01   -5.820624642103029e-02   +3.006596316122374e-01   -2.506910187014567e-01; -3.695766428900544e-01   -1.322770276589506e-01   -3.493349809934893e-02   -3.086892061621650e-02   +3.356271294044826e-02   +2.213490081877036e-01   +3.984038384080174e-01   +9.620834355274091e-02; -6.910068539104747e-02   -1.766558065784991e-01   +2.872929602288098e-01   -1.622031907122735e-01   -9.855841418037059e-02   +4.660902610621621e-02   +1.362307462443544e-01   +1.382649586216617e-01; -6.944992538366050e-02   -3.897530319145069e-01   +3.114229737537789e-01   -1.026701409586284e-01   -2.241272029035374e-01   +1.557944150107690e-01   -2.464269270071729e-01   -1.667359445696971e-01; -1.011023367944948e-01   -1.171287659292119e-01   +3.396631543710996e-01   -3.177711995056977e-01   +2.120677454430789e-01   +6.902252932021304e-02   +8.421647231995721e-02   -1.523244346596012e-01; -3.445503946148417e-01   +1.582405657886624e-01   -1.711102547446717e-01   -2.538031857889350e-01   -8.319110708307154e-03   -1.369839242820591e-01   +2.782038410682415e-02   -5.840013259526859e-02];
L1E_L2E_iAMPA_netcon = [-1.667897491503416e-02   -5.907238930554543e-02   +4.341590416868710e-01   -1.877822053142792e-01   +3.754273966521272e-02   -1.057572528087636e-01   -3.279839752775906e-01   -4.087426599723841e-01   +3.791519519754767e-01   +3.800121799344622e-02   -2.163891400955787e-02   +4.280470929981560e-01   +4.622120250585757e-01   +2.521370102161587e-01   -1.884110654248350e-02   -3.628219437245713e-01; -3.577015283425364e-02   +3.008831939494226e-01   +1.206446445172284e-01   -1.309868151032703e-01   +2.013212290499020e-01   -7.822032045305044e-03   +5.283946729370530e-02   +8.233819430587272e-02   -1.996017590677404e-02   +1.129684229455250e-01   -1.103315605331065e-01   -1.865994246022392e-01   +2.359917334858110e-03   -3.554619440317931e-01   -2.663496110313826e-02   +5.965773931039073e-03; +1.978559269857325e-01   +5.997791078237082e-02   +3.728465189767372e-01   +2.096916451068352e-01   -4.636308504966642e-02   +1.161358022595742e-01   +7.539610415384440e-02   +3.690627911823499e-01   -1.096065561002443e-02   -1.001280193126946e-01   +1.054555848614878e-01   +1.721415816451190e-01   -1.086525083320883e-01   +1.413178180011954e-02   +1.852358733119886e-01   -9.769925630729007e-02; +1.584711677792698e-01   +7.570554401242720e-02   -7.944508180940113e-02   -2.510703245824315e-01   -1.594418784491782e-01   +1.856407965256390e-01   -2.032180377464293e-01   -3.964508771760203e-03   +1.046092088632841e-01   -2.561401679681001e-01   +1.237510524087461e-02   -2.734611594267065e-01   +3.585263020095306e-02   +2.046747841913921e-01   +1.292119561322318e-01   +1.284213004339536e-01; -1.591142257090768e-01   -1.327321819122221e-03   -2.204894624563373e-01   -1.937902095125505e-01   +3.797980877899069e-01   +3.706682841561500e-01   -1.227962570277867e-01   -1.572940089238716e-01   -3.957261565427684e-01   -1.588031264875067e-01   -1.062652720599381e-01   +2.645589600454902e-01   -1.048872642338192e-01   +1.429113056519648e-01   -1.991932234059628e-01   -1.787555493916681e-01; -3.392947629006116e-02   -5.927831355263785e-02   +1.769230480196767e-01   -3.092378612807150e-02   +7.571241260978344e-02   -2.314869277763112e-03   +5.777475925735708e-02   +4.161496614840149e-01   +2.366851962812995e-01   +7.715801591951074e-02   +1.475067155097046e-01   +2.716119032584745e-01   -2.505957977593102e-01   -2.751727217861016e-01   +1.403812925984009e-01   -3.702686986080131e-02; +2.597411284290214e-01   +2.091884312452191e-03   -2.574543838317256e-01   -1.273145713153082e-01   +1.523349130294043e-01   -3.656801967502385e-02   -4.931199474688831e-02   +2.447242132949133e-01   +6.892317768880592e-02   +1.916074998733092e-01   -3.950822603813267e-02   +1.309776012956826e-01   +9.134536655332083e-02   -2.396254989133461e-01   +1.958957362539938e-01   -4.207425254986091e-01; -7.946486692904639e-03   -1.679241634513713e-01   +3.246726884155426e-02   -4.338575448782782e-02   -6.482648377936337e-02   -3.108587027556588e-02   +9.038481900899384e-02   -1.675810460650225e-01   -5.657582239229027e-02   +2.027941112322486e-01   -4.913595766997407e-02   +2.049133783639800e-01   +2.149173622302483e-01   -7.290438581459741e-02   +3.009166108471528e-01   +3.477910685449850e-03];
L2I_L2E_iAMPA_netcon = [-9.594853044646559e-02   -8.320437379715957e-02   +2.451708101774010e-01   +2.163642644767781e-01   -3.786604472124794e-01   -3.037558249398715e-02   +3.491845555438583e-02   -1.786340796340544e-01; +2.046412656313823e-01   +3.115761781607133e-01   +3.919831288752756e-03   +2.705373217116712e-01   +9.624515882895932e-02   -1.178736043389396e-01   +3.329782934546132e-01   -1.396919985111326e-01; +1.170865505762694e-01   +2.896508899774701e-01   +2.085658930953960e-01   -8.959688679701412e-02   -8.187304436868270e-04   -3.411457257304314e-01   +9.794020816373405e-02   -1.136586218582373e-01; -2.345113288959532e-01   -1.175106497517972e-01   +1.164435457742610e-01   -1.219610177762169e-01   +4.965365382951671e-02   +8.771563710499336e-02   -1.089502484269054e-01   -1.813721188715311e-01; +6.499997396628922e-02   -1.795078953546495e-01   -5.042750487955224e-02   -1.660744253744915e-01   +4.536465044537311e-02   +1.466565116354026e-01   +1.111557525206987e-01   +3.714887235283452e-01; -3.204897367007956e-01   -6.860461017514614e-02   +2.216379753763479e-01   -9.600190359119549e-02   +1.189658494366226e-01   -3.736471475368153e-03   +1.849401987440899e-01   -8.255387525964215e-02; -1.474956062839669e-02   -1.368888755506549e-01   +7.768987016894141e-02   +9.698428951174658e-02   -1.064264314868647e-01   -9.485889033362456e-02   -2.280872078022438e-01   -5.333137855723420e-02; +3.726862110209890e-01   +1.026457312327281e-01   +1.389427188355246e-01   +1.144472195706162e-02   +2.006153059231076e-01   +8.693774479420820e-02   -1.652176565460791e-01   +2.277084159598530e-02];
L2E_L2I_iGABA_netcon = [-6.763188121439639e-03   -1.187364423082640e-01   -1.563421610285358e-01   -8.247911769500028e-02   +1.041411641643461e-01   +3.432633708133355e-01   +8.721451870701383e-02   +2.203809335302870e-01; +6.416945098256976e-02   -1.832819563114544e-01   -1.497100258552342e-01   +2.026384626493942e-01   +2.343865244323852e-02   +1.096163509217830e-02   +1.245205008311046e-03   -1.362479406492229e-01; +2.464630772672682e-01   +3.097258327254359e-01   -1.286603953481013e-01   +8.936458362652476e-02   +3.728631552931241e-02   +1.293510919700181e-01   +3.251643620634993e-02   +2.071569540757982e-01; +1.104597384691644e-01   -3.619710839777932e-02   -8.148948987153413e-02   -2.935006512402369e-01   +1.165362745510068e-02   +1.708751408469714e-01   -2.588363634988374e-01   +1.354829996792335e-01; +5.640850917729698e-02   +1.616531771808132e-01   +1.490154894582293e-01   -5.229012348348644e-02   +8.799259839828527e-02   -6.614627155177487e-02   +1.951007051381496e-01   -6.642515379652339e-02; +1.605691455111256e-01   -1.988740077775277e-01   -2.723402452393426e-01   -1.342312823306937e-01   +1.346492101325583e-01   +1.559992182311094e-02   -1.310328119178036e-01   -3.634415586543160e-02; +1.090818845184772e-01   -3.834669023075715e-01   -1.012440548161145e-01   +2.555773337869013e-01   -9.436262237152174e-03   -7.913562100307479e-02   +1.376136542951099e-01   -2.073159180671561e-01; -2.413774086302342e-01   -1.573197299304936e-01   -2.531729227917418e-01   +1.276063162886705e-01   +1.867097844088141e-01   -3.297235894275068e-01   +3.236261318788016e-01   +1.555089348696833e-01];
L3E_L2E_iAMPA_netcon = [+1.411878485500937e-01   -2.467520663652455e-01   +1.684548752384588e-01   +3.341859927572069e-02   +1.785539424419796e-01   -6.951400814385597e-02   +1.358587675121514e-01   -1.555262087763688e-01   +1.119194719573662e-01   -1.660891020922287e-01   -3.589872284765536e-01   -3.626943994462386e-01; -8.574763500505370e-02   +5.467981914926581e-02   +3.581569529133410e-01   -3.733247760807777e-01   +2.900917984989706e-01   +4.444923569133528e-01   -2.642785525784997e-01   -4.497943445323178e-02   +3.448320643283763e-01   -1.764677063951907e-01   +4.983555236051651e-02   -8.102515448028037e-02; -9.500186028905368e-02   +1.232556835493647e-01   +2.171164948120723e-02   +1.994026068736667e-01   +2.583989770713316e-01   -3.199234383324315e-01   +1.049811474505049e-01   +1.721494681449755e-03   -2.172619720895112e-01   +1.319929650055646e-01   -1.139230022226942e-01   -1.689776353280934e-01; -4.052234745587671e-01   +9.459044430945597e-02   -2.606359091228179e-01   +1.103338804322357e-01   +3.526590077532704e-02   +1.924219087351359e-02   +4.646353462414536e-02   +2.422960260152821e-01   +2.372294549307944e-01   -1.878450847889459e-01   -1.842642369403857e-01   +1.348424777115757e-01; -8.316985203195285e-02   +7.576487188689832e-02   +1.156592609781298e-01   +2.451885570361622e-01   -4.126327504319869e-01   -3.601230576919919e-02   +4.099107302015442e-01   -2.088514956189243e-01   +3.358842633013044e-01   +2.747088997238977e-01   +2.477785036539038e-01   +5.477695072192104e-02; -3.917678737297840e-02   +7.675646066022279e-03   -8.056613448722846e-02   +2.586002502811175e-01   -7.340954492536625e-02   +9.016081288683493e-02   +2.460276476026660e-01   +8.667734325485052e-02   +8.966656417057653e-02   -2.875381370738456e-01   -1.572669789398652e-01   -9.311955098121380e-02; -2.405291471956016e-01   +2.809880701925161e-01   +1.738944545991592e-01   -3.484350255264258e-01   +2.568344415751493e-02   -6.341990451783092e-02   +1.875974415660749e-01   -5.322166998804246e-02   -1.574345545484986e-01   +3.581473343735729e-02   -4.072520204875182e-02   +1.747078765953947e-01; +1.652099957564436e-01   +1.547184485298983e-01   -5.917250218160516e-02   -6.707451599335215e-02   +1.121709109585526e-01   -1.026147522668149e-01   +1.121274528886279e-01   -1.518825394066539e-01   -1.657974615811012e-01   +1.212235475979557e-01   +3.830609348706123e-01   +7.626480701233602e-02];
L3I_L2I_iGABA_netcon = [+1.679670156218477e-01   -1.536764850709581e-01   +1.704232047806190e-01   +3.393169320399875e-01   -3.654510589529728e-01   -1.808008881354801e-01   +7.357823380642102e-02   -6.719548244081801e-02   +8.296695378882535e-02   +5.381881566252131e-02   +2.872384543396559e-01   +1.455469229891976e-01; -5.280950481203700e-02   -1.181989485218962e-01   +1.708858861684760e-01   +3.500212878355785e-01   -1.418955434231310e-01   +1.907953510196695e-01   +1.458839534036061e-01   -1.509905086291546e-01   -3.671348605190919e-01   +1.848190111854852e-01   +2.816294746267787e-01   +2.798658994188076e-01; +2.699290590558168e-02   +3.433874070311185e-01   +1.852440545568228e-01   +2.298193870909468e-01   -1.695334029128941e-01   +7.248529351975766e-02   +1.230008887570478e-01   +1.234569547808994e-01   -1.811301792892809e-01   +2.704242970936140e-01   -7.942981825579350e-02   +2.340508799030042e-03; +1.340004057224046e-01   -1.231149277777094e-01   -6.537432281883676e-02   +2.111780672642015e-01   +8.533446005244272e-02   -1.794011628866887e-02   -1.845848314157610e-02   +4.623215156335950e-02   +4.369475400195644e-01   +2.071197565651639e-01   +1.715695446661684e-01   -2.267059694345721e-01; -2.052439382213238e-01   +1.033152385658379e-01   +1.619081296400688e-01   -2.286929007814023e-01   -1.202079206552961e-01   -1.172021902633143e-01   -1.137207710572586e-01   +3.627289223935766e-01   +3.154133535881417e-01   +1.574960705251757e-02   -1.331033863034167e-03   +2.270466866967013e-01; -2.651506410549692e-01   -3.346666342618210e-02   +2.079251261107980e-02   -2.436540023244955e-01   -3.670507980024437e-01   +1.671902340082350e-01   -1.270137682731380e-01   +4.665544190522236e-02   +6.768801501406342e-02   -3.686176815690742e-02   +4.138508244408001e-02   -4.258999402451534e-01; -1.746553313686567e-01   -5.068750130078803e-02   -6.304516187528057e-02   +4.844686097378564e-03   -1.860021614005864e-01   +1.529609671301936e-01   +1.786973900945340e-01   +4.192294699114667e-02   -3.556807252908396e-02   -9.461344533541929e-02   -1.182541874089102e-01   -1.794418878143700e-01; -1.771822393769160e-02   +2.722553503684742e-01   -5.554602837572922e-02   -5.446120819918568e-02   -3.885654994142074e-02   -2.288993344059199e-01   -1.298264593337489e-01   -1.423384764960568e-01   +2.348873445921335e-01   +1.238555999245298e-01   -3.221253624281152e-02   +1.751087431653266e-01];
L2E_L3E_iAMPA_netcon = [-4.329011746078341e-02   -1.178425679263287e-01   +9.566069296967522e-02   -5.623044033180517e-02   -1.913544227643362e-01   +2.878581539504616e-01   -6.268086076661081e-02   -1.061986227218027e-01; +1.598558193263233e-01   +1.516138161975942e-01   -1.927659610568856e-02   -7.033150376985722e-02   +2.333915103597559e-01   -1.608428604900880e-01   +2.642517625841706e-01   -1.829999873798756e-01; +2.438350051475440e-01   -2.808883105166422e-01   -1.638917938083700e-01   +2.305170795922012e-01   -2.477837145140640e-01   -6.953567823090205e-02   -9.346963635590241e-02   +7.915441159057826e-02; +5.007157373575387e-02   -1.612799982401110e-01   -1.584732292460357e-01   +2.063536587679758e-01   -1.305481078483697e-01   -1.929412071419508e-01   -1.916285297539269e-01   +1.012973664992080e-01; +3.894513425400521e-01   -2.367700664688644e-01   +2.874534945082324e-01   -6.289506389525738e-02   -2.155628201562796e-01   -1.347496882478507e-01   +4.750838107634936e-02   -1.523871047424201e-01; -4.372204489462264e-02   -2.400756307580846e-01   -2.067569430192026e-02   -1.338749856664521e-01   +1.422832700316536e-02   +9.682276867211609e-02   -1.817089723178937e-01   +1.742285189903898e-01; +2.130341700860607e-01   -4.018152251787407e-03   -2.314503656484838e-01   -5.040589810021679e-01   -1.550708982463315e-01   -2.382736694040936e-01   +3.302872488268499e-01   -7.721711850828906e-02; +4.615912058200756e-01   +1.077085430444521e-01   +9.604591784155912e-02   +3.239427007824365e-01   +2.392013987186882e-01   +1.870954282528704e-01   +4.123723246430720e-02   -1.453442712731759e-01; +3.627385786220104e-01   -1.859789686214089e-02   +1.176175727424235e-01   -1.948748356920230e-02   +6.238292233100962e-03   -7.890150619596484e-03   -3.797692987604789e-01   -3.181482389478712e-01; +3.337431816345872e-02   +2.099244415585284e-01   -1.724343251162364e-01   -1.099662750699851e-01   -2.981660403018134e-02   -2.210050176197308e-01   -3.055001368288869e-02   -9.932811796713330e-02; +1.934923411819301e-02   +4.728526638040879e-02   +1.630348993656772e-01   -1.314434372684077e-01   +8.991407860884429e-02   -7.012791014203157e-04   -3.832133990678255e-02   -8.015861027034948e-02; +3.261039810279808e-01   +2.809510518709242e-01   +1.016495259449609e-01   +2.051784955008559e-02   +1.461595132135430e-01   -9.975212765287876e-02   -1.635756006263151e-01   +1.645401800308487e-01];
L2I_L3I_iGABA_netcon = [-9.979563564203746e-02   -3.090533088032478e-01   +7.089455923665705e-02   +4.019966013929779e-01   -9.267189110468896e-02   +1.710321558677789e-01   -2.441382232946855e-01   -1.215373332170231e-01; +3.433597849442301e-01   -8.136905877380997e-02   -1.632859855786720e-01   +1.252411778384229e-02   +2.906131258331300e-01   +1.687494771929463e-01   +1.351973061483607e-01   -1.341721938038847e-01; -1.194355854494890e-01   +2.890214461356870e-01   -2.113038086131142e-01   -1.483293728621206e-01   +7.571921663605290e-02   -1.356185399492459e-02   -7.346919487405310e-02   +1.632453371794913e-01; -1.369358102735195e-01   -2.470824782432104e-01   -2.152389661013743e-01   +1.361983480773342e-01   +6.154052548951308e-03   +2.268320357902071e-01   +9.827913877719802e-02   +6.288573316852199e-02; +5.124779223788983e-03   +1.281663384745230e-01   -1.009628442292677e-01   -3.673557073937462e-03   +2.990406062094880e-02   +2.357049930775447e-01   -7.429727971675952e-02   +1.679407845217969e-01; +3.716379210221107e-02   +1.530302539909729e-02   +8.309617467446878e-02   +6.646743690857466e-02   -2.615590337919078e-01   +6.848233034205667e-02   -6.164071326972719e-02   -2.614328575096655e-01; -8.114123593716831e-02   +2.899580835540849e-01   -1.616678101001550e-01   +1.995343493834549e-02   -4.147364364024732e-02   -7.117558623138776e-02   +1.701592546168698e-01   +2.688737683699019e-02; +2.488410485368666e-01   -5.085926079052731e-02   -6.604715088401708e-02   -2.028182410021817e-01   -4.082031276352319e-01   +2.674983805337045e-01   -3.289186464687983e-01   +2.183282326203461e-01; -8.595837635163858e-02   -7.191261360998343e-02   +3.423074115837047e-01   +1.459701146143601e-01   +2.092768805048021e-01   +1.968162104113952e-02   +2.154514568869806e-01   +1.924699538286033e-01; +6.997459800299308e-02   -1.186335068923148e-01   +2.243484122452122e-01   +2.925653015227624e-01   +1.986519156945435e-01   +1.258395277430297e-01   +1.177290703898312e-01   -2.626870479381778e-01; -3.216616449451041e-01   -2.520363163371725e-01   -1.604722542370630e-01   +1.274874526658642e-01   -2.079334140669180e-01   +3.369404470195294e-01   -1.185378116523927e-01   -9.233943974425045e-02; -5.429636196006399e-02   -1.385708982438267e-01   +2.464113291500170e-01   +3.165042510081708e-01   +5.764248328460479e-02   +3.769160745943773e-01   +4.916719784300514e-01   -1.355587480997794e-01];
L3I_L3E_iAMPA_netcon = [-1.558925406916436e-01   -2.042483629915236e-01   -1.674938551160954e-01   +2.400047076039155e-01   -4.399025600117955e-01   -2.116429691759519e-01   +9.538124481439832e-02   +1.619073471855413e-01   +1.313428715007488e-01   -1.701752070802764e-01   +7.961603413897098e-02   +2.221135484742279e-01; -2.488772558990280e-01   +1.209762257758476e-02   +2.284037976372235e-01   -1.057105313451460e-01   -1.338368570313536e-01   -2.560954882480598e-01   -1.995804189164924e-01   -1.310333015994134e-01   +2.900695185496297e-01   +2.832449879318173e-01   +1.101633009596490e-01   +1.019685499980427e-01; -1.243981063371968e-01   -2.781203361136028e-01   +1.407028749676263e-02   -7.384117855354255e-03   -3.740468712143276e-02   +2.276162257118897e-01   +2.630253643697481e-01   +4.098943400985986e-01   +4.077905127463809e-01   +1.658800473934364e-01   -2.160903372406214e-01   -3.673962948126930e-01; +9.996633211608272e-02   +2.664476170147697e-01   +3.382661295353089e-01   -1.205840880778077e-02   +3.438788221210278e-01   +1.492476136782072e-01   -9.809764954281540e-02   +1.276226013092046e-01   +1.118980118356552e-01   -2.259643862891109e-01   +1.175291835000995e-01   +4.841357581594168e-01; +2.170293910625322e-01   -5.480287967274677e-03   -1.951066049358145e-01   +3.477458492865833e-01   +1.225855767040858e-01   -1.208051917390352e-01   +4.225758684831299e-03   +1.652961620972217e-01   +1.648268081794770e-01   -2.173753972634943e-01   -1.517809603319440e-01   -1.697255358389121e-01; +1.709049036917789e-02   -1.133313689551795e-02   +6.873316104979933e-02   -8.065428885858331e-03   +1.480810579164860e-01   +1.483260602101785e-01   -1.429699130340153e-01   -2.616703520556026e-01   +3.118691101319722e-02   -1.263264397177251e-01   +1.842891017290921e-01   -1.835083358316227e-01; +1.719617423552722e-01   -1.984026843803451e-01   +7.314305094868123e-02   +2.714142232410711e-01   +6.757753790720347e-02   -5.714159179520065e-02   +1.372877115825688e-02   +3.074001962528708e-01   +1.296029310450820e-01   +2.372059415916099e-01   -3.714210975129962e-01   -1.636652994333077e-01; +1.789427716588908e-01   -2.358003996351328e-02   -1.167686515941876e-01   +2.139877781793418e-01   +9.565307691980732e-02   +5.305765910250682e-02   +4.744230940575259e-02   -2.201392735923167e-01   +1.536858425683131e-01   -1.471424689214715e-02   +3.315770298500762e-02   -1.668520011529153e-01; +3.127001795104654e-01   +5.760043737491384e-02   +2.917374209733990e-02   -4.362635917923770e-02   -1.129790259006093e-02   -2.902214884055616e-01   -1.004917878308125e-01   +2.532082954505345e-02   +6.107533132931019e-02   +1.971739123437770e-01   +2.311974276655537e-01   +7.361425863055326e-02; -1.509789410483728e-01   -7.182752313975314e-02   +2.781008928358087e-01   +1.688284870773266e-02   +2.325627628713427e-01   +6.894712690771775e-02   -1.529336216264106e-01   +1.992587689597937e-01   +8.051786920240403e-03   -4.541099047820894e-02   +3.032231848549729e-01   -1.088252474147873e-01; +3.874910709901770e-02   +1.133002536523119e-02   -1.085681728621590e-01   -7.248383131483399e-02   +2.840779345075293e-01   +2.128447286427473e-01   +3.010245795873977e-02   -2.069228883291628e-02   -2.622217786232321e-01   +1.446493222594135e-01   +2.853364013519857e-01   -1.157693445119825e-02; -2.613679301308001e-01   -6.290634991556400e-02   -1.441695281872052e-01   +2.294282225958181e-01   -2.044454380385169e-01   -3.230456787910818e-02   -1.097571817106388e-01   -2.378275707486136e-01   -5.950745694606942e-02   +1.707278611159254e-01   +5.422594149467327e-02   -5.184845817979168e-02];
L3E_L3I_iGABA_netcon = [+8.208175135960448e-02   +2.460978456581699e-02   -1.307710068563745e-01   -1.913199466537117e-01   -9.530846705071719e-02   -8.654026219594596e-02   -3.085524842937815e-01   +1.917737789295721e-01   +3.658258126933815e-01   -1.447395280432026e-01   -1.735985649429700e-01   +6.101154553996803e-02; +6.215846922616554e-02   +1.913344084562574e-02   -6.026935821342543e-02   -1.265179150535644e-01   +7.381404267443681e-02   +4.758831240527170e-02   +2.896638518442584e-01   +1.714628294561804e-01   -9.620369652143637e-02   -2.747542821210276e-01   -1.768013420766504e-01   -2.334227598867744e-01; -2.817267744405519e-01   -1.401188756914711e-01   +1.339309786858994e-01   -2.096039844506939e-01   +3.496063867257996e-01   -7.330519397590732e-02   -2.408678892150153e-01   -1.209367782988275e-01   +1.812737418597217e-01   +7.675632614045393e-02   -1.127152731303677e-01   -1.616545738963503e-01; +4.871681596762763e-02   -4.517310110631669e-02   -9.209427805642037e-02   +3.395261180355041e-02   +1.137426817810436e-01   -1.894611080456805e-01   -2.293205115095800e-01   +1.949911026273344e-01   +9.867784939305137e-02   -3.231253680605095e-01   +8.055326942176894e-03   -2.066539498227020e-01; +9.975846988289405e-03   -1.475607697635542e-01   -7.416584478149534e-02   +2.294784667328995e-01   -1.912401957255857e-01   -1.764431209966230e-02   -1.519467139956820e-01   -2.074213616196943e-01   +2.589727481936637e-01   -1.846261938399988e-01   +2.924611418154782e-03   -6.199951257074260e-03; -2.854311470502444e-02   +6.163383569279161e-02   -8.613552974757396e-03   +2.594196433798256e-01   +1.350114574400954e-01   -8.739413373960954e-02   +2.165539505197114e-01   +2.540438846176660e-02   +9.747739529493706e-02   -3.034839039800542e-01   +2.683003495523092e-01   +1.412421191029703e-01; +2.536394088185162e-01   +6.631821692478923e-02   +3.139245643074938e-02   -3.381484445980618e-01   -5.953069029371765e-02   -2.302478992753075e-01   +9.119489068266265e-02   +1.496205158798731e-01   -2.615799179548715e-01   +7.255833064659994e-02   -2.203108130567818e-01   -7.667523721801525e-02; +2.005719780628941e-01   -1.287956994874206e-01   +1.654726984800446e-01   +1.850087839889803e-01   +8.578223932590133e-02   +1.699675408089391e-01   +2.804139519688867e-01   +1.346944787362764e-01   -4.914846985346291e-03   -5.761846108722533e-02   +2.187286684421503e-01   +9.210211134715685e-02; -7.600715899729282e-02   -7.476150331942155e-02   -2.347868079304596e-01   +7.598072211504009e-02   +8.126944113341339e-02   +8.067963439591257e-02   +1.703860439415435e-01   +2.385778635033210e-02   +1.907336036381900e-01   +2.937440710162686e-01   -3.028085008946865e-01   +5.100748775449263e-02; +2.930105194003303e-01   +2.311691628426723e-01   -3.546911816992501e-02   -2.191115859514566e-01   -5.497349900799103e-02   -7.056459220500992e-02   +5.229336038473517e-03   +3.653749871848079e-02   +4.538667759077315e-02   +1.308928726641320e-01   +2.537959177180102e-02   -5.276140751586069e-02; -5.575904602460069e-02   -3.723686002219787e-02   -4.635803189430490e-01   -1.724105215872460e-01   -2.844710618285104e-01   -4.622701517386749e-02   +2.051661676493629e-01   -8.567590626317532e-02   -1.559846710714496e-01   -1.821613398402739e-01   -7.271693160422454e-02   -5.823007252183802e-02; -1.603291897459603e-01   -3.405809241440291e-01   -7.069089758342462e-02   -3.266703106657406e-02   -2.489158197171751e-01   -8.231729393517540e-02   +6.917486096038082e-02   +4.548178316554780e-02   -2.035137907597541e-01   +2.049881373598471e-02   +1.926586866254879e-02   +1.967526081179304e-01];
L2E_Input1_iAMPA_netcon = [-2.230862086202519e-01   +1.271507156035087e-01   -7.814380982911921e-02   +5.562136761857244e-02   -2.086481450585146e-01   -5.911485865913349e-03   -2.773001322052936e-01   -1.949872256479827e-01];
L2I_Input2_iAMPA_netcon = [-8.034436206885073e-02   +1.731663894712713e-01   +3.939346679661238e-02   -1.135851166206121e-01   -1.766944983258461e-01   +1.941225244774805e-01   -3.228430201427928e-01   -1.222971502142525e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
