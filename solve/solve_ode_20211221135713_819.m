function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.018612842177404e-01   +1.000000000000000e+00   -3.355451187537360e-01   +5.801271903979662e-02   +7.753586240754075e-01   +2.438878413477418e-01   +1.029767004541567e-01   +4.202862291911993e-01   +7.288749298578737e-02   -8.464548407066494e-02   -4.329916713156036e-01   +7.470776130268033e-01   -2.411782829139588e-01   +4.797215823331561e-01   +5.350057462366258e-03   +2.248123447925393e-01; -1.680145148133502e-01   +2.037319171320179e-01   +1.736751828856803e-01   +6.819450232548193e-01   +4.768527913141828e-02   +6.007606651627106e-01   +5.977004304533345e-02   +3.030937214043244e-01   -8.100647316692633e-02   -5.076155013511748e-01   +4.910737232944081e-01   -1.069580326139979e-02   -2.544843855300665e-01   +6.961177877142554e-01   +1.422559014294589e-01   +6.999598614231100e-01; +1.514877812003338e-01   +4.058773577182714e-02   +6.486589162464831e-01   +3.146020435911263e-01   -4.464665496140297e-01   -3.370834958044007e-01   +7.297021675349187e-01   -2.861742074168536e-01   -3.958792516566446e-01   -4.864483083763610e-01   +4.607429292444165e-01   +2.796871695013174e-01   -5.786704742471115e-01   +2.299635206015827e-01   +8.349738451211003e-02   +4.556449316812883e-01; +5.599969000177640e-01   +7.946411208728646e-01   +5.868199233203145e-02   -2.957098590586499e-01   +7.056470311532875e-01   +4.690686615252052e-01   +7.290326168735337e-01   -1.008569884362399e-01   +6.230321629416620e-01   -1.611410032463101e-01   +2.415846038307516e-01   -2.582085261016273e-02   +1.829681459096761e-01   +1.718858021834040e-01   -1.796690816102519e-01   +8.804703978811788e-01; +2.473508366793403e-01   +2.453410390992531e-01   +5.709765233019569e-01   +6.198596321197825e-01   -5.247495207254587e-01   +7.870358821941335e-02   +7.609366281335671e-02   -4.065148703483015e-02   +1.820547751666125e-01   -3.302877717068140e-02   +5.222860698421159e-01   +6.336843878948248e-01   +6.447456733022421e-01   +6.130204744272322e-01   +6.166603055698627e-01   -1.549872526730629e-02; +2.185034624224373e-02   +2.110203721551713e-01   +1.540873532826599e-02   -2.710195594915347e-01   +2.994697690643639e-02   +4.979965402081696e-02   +6.167106865615511e-01   +1.216004083232826e-01   -1.460507184693326e-01   +1.959359525836191e-02   +2.894331092951019e-01   +8.409145706336033e-01   -5.396455985545083e-02   +9.119902216593019e-03   +8.992069225245843e-02   +4.143246284170614e-01; -1.760664072117568e-01   +5.854947008171666e-01   +3.056422892636144e-01   -4.040774003551856e-01   -2.458595429220049e-01   -2.466156084181360e-01   +4.516563218298519e-01   -4.725012285918943e-02   -4.497549906927754e-01   +2.343770188307188e-01   -1.280281464469979e-01   -9.619296981895732e-02   +4.493862964102293e-01   -3.294144226121198e-02   +5.538876947952871e-02   -3.833706540933145e-02; +5.374868566617038e-01   -2.638229545940888e-01   +5.784329561878346e-01   +2.369723890443067e-01   +5.697124082896851e-01   -1.030466562631365e-01   -4.796105002403946e-01   -2.204923639712155e-01   +2.499407425295202e-01   +5.339800312722175e-02   +8.725379931735219e-01   +5.650350901276124e-01   -2.111656277879826e-01   +2.877577502321898e-01   +3.290403419833002e-02   +4.112160807417814e-01; +5.284107878467816e-01   +3.111172599089819e-01   +2.184243089952264e-01   +3.105010633491046e-01   +5.308454737895895e-01   -4.389985354195401e-01   +5.821263217330644e-01   -7.693988482461933e-02   +5.971965694529585e-01   +3.660488810286766e-01   -1.047666788511361e-01   +4.079498203639524e-02   +6.763362362666212e-01   +7.740126435600134e-01   +5.266189834158462e-01   +7.899030103124018e-01; +6.475289662339981e-01   +1.164395074286712e-01   -4.073419022735007e-01   -3.302500243626392e-01   +5.215876889994338e-01   +1.052224424338257e-01   -2.247919431666840e-01   +4.473035589148743e-01   +9.487961213036714e-02   +6.387134611034925e-01   +6.515807480571143e-01   +5.894769447830616e-01   -1.791021903929959e-01   +5.053303162728486e-01   +7.179573123914752e-01   +3.748672591570942e-02; +3.619295677775266e-01   +4.600182815033724e-01   +5.888205031356349e-01   -1.445644869433777e-01   -5.751540008318056e-01   +5.448787788325895e-01   +7.398589732281651e-01   -1.824486720348163e-01   -1.870827298428114e-01   +6.568292826123269e-01   +2.767882753564493e-01   -5.973594232925139e-02   +2.990935087693498e-01   -1.395205490516179e-01   +4.500888009328375e-01   +6.464939587259573e-01; +5.841365594196458e-01   -4.973175321357691e-01   +4.377786389596918e-01   -2.342105953961769e-02   +1.366822163752099e-01   -6.484321865108436e-02   -2.810454755172886e-01   +1.229692490289395e-01   -2.728437975038578e-01   +4.056460749395270e-03   +3.796719231208841e-01   +4.042734245222093e-01   -5.120791006637370e-01   -4.460300363218526e-02   +3.796308009462612e-01   +7.413248569627068e-02; +4.778975367686015e-01   +1.463455437625735e-01   +3.587373470179468e-01   +4.840349606096389e-02   +7.177406215604732e-01   -5.094882552114134e-01   +4.750487065787029e-01   +1.266229047559724e-01   +9.083756730990025e-02   +2.736792344412914e-01   -3.375875939673715e-01   -2.941777551026341e-01   -4.892849221971862e-02   +8.444234871787426e-01   -1.863096179452369e-01   +2.430252089475220e-01; +3.593263590652825e-01   -1.054426157305337e-01   +3.234834122649968e-01   +5.454354665865079e-01   +5.405738952875673e-01   +1.606795221429415e-01   +1.897175161593661e-01   +4.949223666732107e-01   +1.416292862033589e-01   +3.060162197744687e-01   +1.827328033016671e-01   +6.711950538988851e-01   -4.192664597313265e-01   +1.311858267414941e-01   +3.217278909582811e-01   -3.956202448114464e-01; -7.470009571071841e-02   +7.085015020577436e-01   -1.358591849473952e-01   +1.213219890820681e-01   +1.495521410713496e-01   +8.731440728531600e-02   -1.494176910586657e-01   +1.485234381132557e-02   +9.717271967828577e-02   +1.278364310877960e-01   -3.890969202393853e-02   +8.600590432476410e-01   +4.986988710125876e-01   +2.000306330015074e-01   +2.110813742449001e-01   -6.329998403980081e-01; +2.483748683241436e-01   +4.598683206205900e-01   -1.275010392670018e-01   +1.596020073548056e-01   +2.511673632101656e-01   +6.445885176662040e-01   +3.488266739528609e-01   +4.394601875457011e-02   -2.028459230313500e-01   -4.680971345577489e-01   -1.519176564505157e-01   +4.707637798408715e-01   +4.936819825179150e-01   +3.222658799902398e-02   -3.301461500467485e-01   +5.532151787321899e-01];
L1E_L1I_iGABA_netcon = [+3.668884373283781e-01   -2.836179834735776e-02   +1.454975667478241e-01   +4.707132335183847e-01   +8.777236404448013e-02   +3.323626833334157e-02   -5.346158823750384e-01   -5.669304246326192e-02   -4.217402797703079e-02   +1.923302854410037e-01   +7.469708280280127e-02   +5.691344486860992e-01   -1.895051034447481e-01   +5.455029144534295e-01   +1.896268430355897e-01   -2.956952995179178e-01; +7.042897426829337e-01   +1.851206788767316e-02   +1.254320911441432e-01   +5.417314027707627e-01   -7.390301243277762e-02   -2.540736506826420e-02   -2.740590119365063e-02   +1.969309441070183e-01   +1.733332781832318e-02   -1.197839955812916e-01   -1.080879308197018e-01   +5.755774842641576e-01   -2.125439714489456e-01   +2.003541501170127e-01   +4.918619218885915e-01   +1.487483775782111e-01; +1.385847408557796e-01   +1.426918681612668e-01   +5.690216030906852e-01   +7.978121752443003e-01   -4.896661398329826e-02   -5.702842779364324e-01   +2.830465849940400e-01   +7.946194937501938e-01   +1.616020821253458e-01   +7.106266527248695e-01   +1.060496435410224e-01   -1.037124714518329e-01   +5.443134817094004e-01   -7.810833191551947e-02   -1.307759645127569e-01   +4.452437374455105e-01; +1.700012754748018e-01   +8.528718030708514e-01   -6.499855646236199e-01   +1.852908015071273e-01   +2.480159130612056e-01   +2.804677449265888e-01   +1.677581494632025e-01   -1.101445569031429e-01   -1.653098690992933e-01   -4.201686016978334e-01   +8.017201365348855e-01   +3.981891770693550e-01   -5.017660279445846e-02   -1.853731647271068e-01   +1.106509841686682e-01   +5.830370255208086e-01; +3.458998512760127e-01   +2.614225328143762e-01   -2.660194922581497e-02   +1.809397053375295e-01   +1.312007328952176e-01   +8.668593388130809e-01   -4.932033467830895e-01   +5.679779727644556e-01   +5.724543806081627e-01   +5.882351855214354e-02   +2.177436963198399e-01   -2.085915575890691e-01   +2.857583069268655e-02   -3.569101546146550e-01   -1.052882456724918e-01   +1.673410076481343e-01; -3.363675313980760e-01   +1.315036476370091e-01   -1.175401944606895e-02   +1.838595478702351e-01   -3.841239122495684e-01   -1.355824061993400e-01   +7.821445502045924e-01   +3.359979635921053e-02   +5.923759565478448e-01   +1.339573407646747e-01   +1.000000000000000e+00   +6.886267605296934e-01   -1.243409364380433e-01   -3.038553311863675e-01   +6.888315657597298e-02   -8.709724590009772e-02; -1.489162567809954e-01   +9.465580159973382e-01   +3.151137611714399e-02   +8.243483176374540e-01   -2.456890072214880e-01   +1.784767308212464e-01   -3.911038749181016e-01   +2.309666206280421e-01   +3.816087220632529e-01   -4.253721654901534e-01   +3.249549570444212e-01   +9.998382683366960e-02   -8.523940341781906e-03   +5.233270532916487e-01   +6.704662244591370e-01   +2.581752914297821e-01; +8.266705243663515e-01   +9.744215072063619e-02   +4.537210796964383e-02   +4.582494657199481e-02   +1.414480310776755e-01   +4.019407903793201e-01   +1.275613529277930e-01   +1.978385231450110e-01   -7.343091636425128e-02   +6.366638382999095e-01   -3.701803873413876e-01   +9.218049321358009e-02   +7.546026856208232e-01   -1.678117381421640e-01   -1.959029538701310e-01   +8.701108810015276e-01; +3.792415907944677e-01   +6.773045287951616e-01   -4.386245384074717e-01   +6.210227150206321e-01   -4.540348204177626e-01   -3.640512646522773e-01   +5.397561538214833e-01   -4.449311529186296e-01   +7.891130344424000e-01   +8.218714682573078e-01   -1.113734899817334e-01   +3.900635622790496e-01   +4.475842197171970e-01   +8.239318808215045e-01   -2.689741521904134e-01   -1.084783164586782e-01; +2.989741286932100e-02   +8.846562423293828e-01   -3.244407238284081e-02   +7.789501147911307e-02   -2.688760305995104e-01   -3.735891925514054e-02   +7.050474210443954e-01   +1.683110940823638e-01   +3.448828613412014e-01   +5.780852930508512e-01   +7.482799060113523e-01   +9.713482760338966e-02   +5.833826775977214e-01   +4.720357204436513e-01   +2.291698579722667e-01   +2.779950679006840e-01; +8.193644984821131e-01   +3.606144128763513e-01   +5.469481304933627e-01   +3.404550462013293e-01   -5.744457903776311e-01   +3.089308399695969e-01   -3.053027794125009e-01   -3.346838164696507e-02   +1.137765421938584e-01   +4.322737502576736e-01   +1.099340083737084e-01   +5.674022226203155e-01   +7.079255409961718e-01   +7.722203460329496e-01   +2.119026906879491e-01   -6.856568090997341e-02; +2.553436034710336e-01   +6.226296063807549e-02   +1.339792066645241e-01   +9.384361922618152e-02   +1.225532188610900e-01   +2.564113333266940e-01   +5.716990189277326e-01   +5.344528539455612e-01   -6.545021183268633e-02   +1.624710704331848e-01   +5.786455370659039e-01   +2.459540932751748e-01   -6.843897489845593e-02   +5.104470569564570e-01   +5.299638809579005e-01   +5.249569930585692e-01; +1.749153240648532e-01   +5.004081588007989e-03   +6.984414922131246e-02   +7.962596186477382e-01   +3.666671777593357e-01   +2.710134434861556e-01   -6.865351397774881e-02   -3.523485360250023e-01   +1.854780532129717e-01   -3.673583001977702e-01   -2.644615698047187e-01   +7.707474141496941e-01   +3.919522433580586e-01   +2.721184133751503e-02   -1.514731280948269e-01   +2.097802157643730e-01; +3.992306510750518e-02   +8.148990955120540e-02   +2.149010657764747e-01   -2.539555012449167e-02   -2.406875773597717e-01   +2.050128228130037e-01   +5.578695496508775e-01   +5.396760809265466e-01   +3.749223864369365e-01   -2.786287422432761e-01   +3.148396910886969e-01   +6.885061689535397e-02   +2.935974724954657e-01   +5.351348945956172e-01   +5.107846044035710e-01   -3.349068701020815e-01; -5.075606597413497e-02   +1.861175187207718e-01   +1.768560247392514e-01   +2.948367771899557e-01   -5.734356533264250e-01   +3.975679997446636e-02   +6.857337281548603e-01   +5.645218271086380e-01   +5.959274121048106e-01   -2.325381625768223e-01   -3.575693324830310e-02   +2.140221152077789e-01   +8.086883917128272e-01   -5.290959043694683e-01   +1.524516795941479e-01   -1.983860218518805e-01; +7.107572646448512e-01   +4.010514725948691e-01   +6.046465320771464e-01   +3.218163993828806e-01   +7.485679122766580e-01   -3.652328020078904e-02   +4.779470310692047e-02   +2.548588163192125e-01   -4.249224960502757e-02   +3.315738472101740e-01   +1.287860528329962e-01   +4.355734023243533e-01   +1.533367796084384e-01   +1.087501322880190e-01   -5.153891288593389e-02   +1.337150419810326e-01];
L2I_L1I_iGABA_netcon = [+1.271507853868612e-02   +8.053727204648350e-01   -1.645187548174666e-01   +2.624289991425393e-01   -3.578136266782983e-01   -6.513894820134794e-02   -2.511423173894393e-01   +1.261169608966554e-01; -2.892382469744702e-01   -1.911859985082873e-01   +1.263391786223821e-01   -7.968892701254222e-02   +4.497100127306543e-01   +6.780661077432317e-01   +6.265833619222639e-01   +1.735749497628779e-01; -6.500746845386819e-02   +2.990119328410575e-01   +4.098771377316481e-01   -6.732208613925199e-02   -2.709305223859946e-01   -2.010345051597116e-01   -1.169581872166722e-01   -1.641124432124819e-01; +1.000000000000000e+00   +3.185583783039736e-01   +4.369563272759681e-01   +1.668179062192747e-02   +3.053707452953069e-01   +5.159727739997758e-02   +4.485773962884166e-01   -1.032752789220585e-01; +5.663862691653259e-02   +5.090657856160700e-01   -1.352874959320220e-01   +4.218526122060058e-01   +4.824882844960751e-01   +3.257656089955288e-01   +1.365558625216814e-01   +6.502642510888349e-01; +6.562278247743356e-02   +7.305293844980711e-02   -1.270161523948168e-01   +1.368823924267221e-01   -2.151842405756897e-01   -4.349867780575641e-01   +3.226932771841416e-01   -3.280720865433059e-01; +1.877924874298807e-01   +3.243232656592007e-01   -6.307357527843234e-01   +4.361136903627823e-01   +1.226999592122096e-01   +6.277818397789946e-01   +5.452113236733135e-01   +2.494691398245359e-01; +4.040303014615579e-01   +3.315489133178067e-01   +3.238523189539625e-01   +1.952800056225055e-01   +8.661336732834141e-03   -2.784088407602953e-01   +3.239155371075115e-01   +5.418617001169105e-01; +7.216136888321292e-02   +3.373540269853653e-01   +1.665640821735407e-01   +6.265075612417725e-02   -9.794328908318234e-02   -9.865032671357618e-03   -1.875772283637245e-01   +4.526974199477743e-01; -1.625684505162329e-01   -4.585261429090052e-01   -2.066175405283364e-01   -1.990541304502324e-01   +3.726805802229718e-01   +8.803315868547767e-03   -3.819752906021943e-02   -4.677080234275101e-01; +4.851222548401741e-01   +1.970434716223159e-01   +2.673852533461795e-01   +9.110890471101595e-01   +3.792630641235552e-01   +4.566104818260262e-02   +5.316460437862097e-01   +3.514277629639008e-01; +3.444850117430975e-01   +4.578514503167347e-01   +2.758974413629559e-01   +3.919924600307557e-02   +6.562235931641217e-02   +2.073572096210229e-01   +5.179181255723476e-01   +6.321935683888785e-02; -3.910532032776547e-01   +4.120248965141067e-01   +3.232557294468646e-01   -9.021738416707972e-02   +4.194664334525183e-01   +3.545856398651366e-01   -3.297237143902143e-01   +3.868045707728904e-01; -2.823413573047799e-02   +3.745853313064191e-01   +2.414069450670960e-01   +1.926098224984675e-01   +2.825830640794609e-01   +1.043495372141918e-01   +3.920766094405881e-01   -6.778368104991239e-02; +2.712600899234790e-01   +6.533293377881536e-01   +6.008090991724546e-01   +3.240977394245987e-01   -3.833860898160191e-02   -3.801385945833511e-01   +2.179423862945153e-01   +1.674045957628205e-01; -6.867703829418739e-02   +1.899553433819417e-01   -9.636446911855705e-02   +3.458102704338263e-01   +3.252336273954530e-01   -1.958167318969591e-01   -2.941828078717630e-01   +1.326881869834215e-01];
L1I_L2I_iGABA_netcon = [+4.019107469981230e-01   -5.061726493001523e-01   +1.944010625083069e-01   -3.811017665035243e-02   +5.078274337415219e-01   -1.321539767295302e-01   -5.367843540431048e-01   +2.576073358905532e-01   +9.421082042812610e-01   +2.609160383395920e-01   -1.033979505521221e-01   +3.619534152829561e-01   +7.792774298187269e-01   +8.327458327727977e-01   +7.406096852583036e-01   +6.322499710973731e-01; +1.756082268707714e-01   -5.542952089826435e-01   -4.341400222872771e-02   +2.663797807807814e-01   +4.815681779052108e-01   -2.474487425891014e-01   +3.684287155683754e-01   -7.232792916671006e-01   -1.592528123042377e-01   +8.768462407843697e-01   +2.423125003618679e-01   +6.980808840676682e-01   +5.218293285330656e-01   +2.714837165341750e-01   +2.074638191796513e-01   +2.910841234058233e-01; +3.053591886364797e-02   -1.849244890588088e-01   -7.718754462029098e-02   -2.889033631322366e-01   -3.682767612659994e-02   +7.703522266909874e-01   +8.641365164812590e-01   +4.130161059537443e-01   -2.953269049339393e-01   +6.126933075501205e-02   +2.097307547744326e-01   +1.434279204866934e-01   +8.622647080065201e-01   -6.235607470626441e-01   +3.094111979156800e-01   -2.427517823496902e-01; +4.569353804115337e-01   -2.967529011351352e-01   +7.087064698982860e-04   -3.848466834310365e-01   +2.131973162403467e-01   -9.229452029541950e-03   +6.468289539524174e-01   +3.806305552049550e-01   +1.899615633104406e-01   +3.514178603158610e-01   +5.967424101759787e-01   +2.129951498149124e-01   +6.014441986384123e-01   -9.819382941133836e-03   +4.080349334320874e-01   +9.835834325232010e-02; +5.381357769119022e-02   +4.716396507801335e-01   -9.289717990771789e-03   +5.849946242888245e-01   -1.385777788769856e-01   -3.560057996464654e-01   +2.674720013030581e-01   +2.050428751631057e-01   +1.085966329569267e-01   -2.454600089991227e-01   -3.035039407655804e-02   +4.617392097270883e-01   +1.341762389599970e-01   +3.960720279705603e-01   -6.091108939689888e-01   +9.633860825691465e-02; -9.441578111106327e-02   +2.303039155937267e-01   -4.199828825030863e-01   +4.455467474729420e-01   +4.677164775083278e-01   +3.695186343404201e-02   +2.630875812615406e-01   -1.464145109298175e-01   -7.858396246748978e-02   -5.688804949444939e-02   +2.064024371908529e-01   +7.356018638857152e-01   +6.064101122166090e-01   +2.642310652076378e-01   -5.063778064820024e-01   -1.656190342797954e-01; +1.638471500357114e-01   +3.141538265788021e-01   +4.265612446987199e-01   -4.533094983556647e-01   +1.226925148574426e-01   +7.321851380804053e-01   +5.761915148470460e-01   +4.361808391837789e-02   -1.634080830708146e-01   +3.937572371576120e-01   -2.005085029021454e-01   +6.409657019195907e-01   +5.495109476329758e-01   +1.000000000000000e+00   +2.136511825422001e-01   +3.456107858211650e-01; -5.472100960669780e-01   +2.857453119041343e-01   -2.145183703114388e-01   -1.054187515727493e-01   +3.599378896853337e-01   +8.188000963871915e-01   -2.220059783659875e-04   +3.917160698241119e-03   +3.146638352799057e-01   +7.987787761979552e-01   +7.943315851251596e-01   +2.685565210904798e-01   +8.849115317105333e-02   +6.116046710398694e-01   +5.112077367768223e-01   +1.484978344278883e-01];
L2E_L1E_iAMPA_netcon = [+2.086077250844214e-01   +9.024105767412099e-02   -5.102730280282968e-01   +4.039028892901939e-02   +3.183192597234746e-01   -3.698506570344234e-03   +5.503103511614381e-01   +9.319963062778266e-02; -3.653387360624566e-02   +1.247939236824806e-01   +1.211854018007540e-01   +4.170718508962505e-01   -6.348817392411668e-02   +2.911350416218653e-01   +6.824011378370437e-01   +8.842762759408929e-03; +6.422269796771318e-02   +1.284955791986248e-01   +1.809398614904499e-01   +2.353182556643600e-01   +8.372791575885616e-01   -1.123558014372921e-01   +3.131412537406979e-01   +3.181938443957845e-01; +7.906213867751548e-01   +3.347872997928549e-01   +5.925360382231201e-01   +9.467146955724315e-02   +7.495039150244207e-01   +7.281195400207487e-01   -5.328500627323935e-01   +1.433499844309557e-01; +2.641679018967434e-01   -9.636103792952760e-02   +3.268774304198870e-01   +4.768561741672930e-01   +7.249533136214785e-01   +7.606609110185398e-01   +6.861173301902596e-01   -1.976888463224876e-01; -3.289415686836728e-01   +3.616878626623146e-02   -3.024070383007042e-01   -1.631354590001953e-01   +9.810468640029327e-02   -3.003583206101214e-01   +3.705600595835074e-02   +9.872559928162070e-02; +4.675948219568329e-02   +5.240124649237266e-02   +2.296290705628762e-02   +3.740323934691829e-01   -3.920985240940451e-01   +1.597680080731003e-01   +3.217133120968644e-01   +1.502520699619115e-01; +1.424402757507493e-01   +2.931922597473229e-01   +2.455713886750920e-01   +4.649196183652226e-01   +4.172616545966703e-01   +5.640624523980790e-01   +7.265675835841123e-01   +2.400102927972887e-01; +2.417601198517409e-01   -3.272661861367128e-01   +5.551325783525127e-01   +6.358343795587751e-01   +7.297197058889526e-01   +5.055338885735530e-01   +2.667318083501832e-01   +2.731468407080702e-01; -2.736146428654737e-01   +3.929939874311151e-01   +1.529053482686604e-02   +2.915183046473143e-01   +2.373345626255631e-01   +4.642120377492499e-01   +3.699016686339117e-01   +3.390607701171184e-01; -1.061826819802830e-02   +2.115411248232469e-01   +4.893788932668403e-01   +8.468292848569752e-01   -1.053940499475677e-01   +1.161134742378348e-01   -1.462378624270221e-01   +3.659222816425970e-01; -4.263146137307915e-01   +3.945696864647298e-01   -3.742443109362178e-01   +1.575099552144860e-01   +4.010146273219420e-01   +5.567872248509314e-01   +2.359927968738757e-02   +1.870783106311008e-02; +3.237196451758081e-01   -2.819977133143874e-01   +3.331455128617737e-01   -4.835003733205746e-01   +1.801737334059420e-01   +3.762846853515870e-01   -1.659805253169554e-01   +3.658635235049778e-01; -2.614466816297723e-01   +3.774282860006616e-01   +6.255025128197753e-01   +9.870070593793870e-02   +2.282580758186337e-02   -5.141728115641707e-02   +9.103341000707289e-01   +2.586268516247400e-01; -1.926048035795297e-02   +9.042005847596854e-02   -2.005143933993347e-02   +8.233830743593999e-01   +7.797986148130174e-01   -3.511404786203614e-01   +1.932478281610215e-01   +2.988622056333168e-01; -1.920312823622014e-01   -3.593433088232506e-02   +1.557919272206680e-01   +5.706501446402937e-01   +5.054638159280989e-01   +3.063017140611651e-01   +3.620480323725732e-01   +3.267798596456012e-01];
L1E_L2E_iAMPA_netcon = [+2.404905068911805e-01   -4.765710338210508e-02   -1.296644514145731e-01   +2.974721887138283e-01   -4.324053635668793e-01   -5.815469168198137e-01   -2.664091194388291e-01   +8.849543541994970e-01   -2.817986862370514e-01   +5.385574010561336e-01   +8.074169849089227e-01   +1.590593037835384e-01   -1.069636457909527e-01   -1.750924853485228e-01   +3.051419184816569e-01   +4.769927854663933e-02; -3.920419783842455e-01   +6.738451841982047e-01   +1.008235973808618e-01   +6.237920318727459e-01   -2.558705377950399e-01   -5.901817311712313e-02   +2.796343782873469e-01   +5.335483761977943e-01   +1.536389298370802e-01   +8.634352598877131e-02   +2.211475685754097e-01   +4.843314846331020e-01   +2.340845669149039e-01   -1.331898821485892e-01   +5.211120891767588e-01   +5.461002724093693e-01; +9.137901545469544e-02   -2.684949750300446e-01   +2.917932813491770e-01   -2.121443913577240e-02   +2.159208899965284e-01   -6.701222855323141e-02   +2.056619121688847e-01   -2.633406748330995e-01   +3.605872556836581e-01   +2.156861468738455e-01   +2.122750816919562e-01   +5.560669702848453e-01   +3.554682284379421e-01   +7.042714053094824e-01   -9.687880281906361e-02   -1.236575461833362e-01; -1.977173627974808e-01   +5.856520417719794e-01   +7.130716255060393e-02   +3.951280190746403e-01   +4.375946015325262e-03   +7.673404784693283e-01   +9.123911294986185e-02   +7.727772497402107e-01   +2.633320248606457e-01   -1.828404291427894e-01   +3.367889745970213e-01   +3.757362539027471e-01   +8.261401407039254e-01   +3.331793495210175e-01   +6.426121586074485e-02   -2.549452824213422e-01; +3.582536947840900e-01   +6.360264033768319e-02   +6.901984746117865e-01   +3.860802868441037e-01   +8.141090594976778e-01   -4.102460039438072e-01   +2.512232127682162e-01   +3.816744666654018e-02   +8.082873454436974e-01   -3.512722690688936e-01   +1.176828628560539e-01   +4.379944362682649e-01   +2.085677708501048e-01   +2.465878102823068e-01   +4.705142343910684e-01   +8.093626853176448e-01; +2.075741852333268e-01   -3.363342696163730e-01   -5.961653686840052e-02   +5.061792447116717e-01   +4.315599991807029e-02   +6.596078011835892e-02   -3.292159056580002e-01   -1.992848876307071e-01   +1.397454458785828e-01   +2.251733445127583e-01   +4.181344436102001e-01   +5.835671258339896e-01   +7.408380642438983e-01   +6.817938265176117e-02   +3.630376639524888e-01   +1.320610583374661e-01; -1.667301712435303e-01   -1.651632982101612e-01   +6.627964871153539e-01   +5.687707070554379e-01   +5.928868008558765e-01   -3.671802855864646e-01   -2.921180452620478e-01   +7.177691098357171e-01   +1.000000000000000e+00   -1.313512939212433e-01   -1.861673685712174e-01   -3.069761984027878e-01   +5.855154605300417e-01   -2.858430731964171e-01   +1.470114477291434e-02   +5.304017127051368e-02; +2.825386515696743e-01   +4.614374716875388e-01   +5.681296054908896e-01   -1.683677459317293e-01   +1.884364210420081e-01   +4.994364631722754e-01   +2.179306397753959e-01   +2.076510520682891e-01   +3.262939880580348e-01   +3.718044439275097e-01   +5.258306792046382e-01   -1.181757111700133e-01   -3.144930616424239e-02   +6.997440474535471e-01   -1.287272497864257e-01   +3.158096850269515e-01];
L2I_L2E_iAMPA_netcon = [-2.286358498465951e-02   -4.254181645497742e-01   -2.912328302701477e-02   +1.949249409518718e-01   +1.736241412870837e-01   +1.621324636755355e-01   -1.009945581094905e-01   +8.308634670250407e-01; -4.693056929944450e-02   +4.874298596036675e-01   +6.649790996367041e-01   +1.693268361639634e-01   +5.613353391589297e-01   +3.026154842591942e-02   +2.185538397201250e-01   +7.708265322178063e-01; +4.014044966488408e-01   -3.722972302896043e-02   -1.279763582371911e-01   +1.045907755219543e-01   +6.135895982846912e-02   +4.521143400656250e-01   +3.387674840267564e-01   +5.861790807641091e-01; +4.376657979643419e-01   -5.741100962351355e-01   +1.618367880489694e-01   +3.823413832114577e-01   +5.377633453341666e-01   -4.297752020316112e-01   -3.069771782682424e-01   +5.039005016008216e-01; +4.733731372580349e-01   -2.618169632320576e-01   -3.210880609148281e-01   +1.044870692848633e-01   +4.653494395820352e-01   +1.215645328520512e-02   -2.008849529644078e-01   +5.989666035443243e-01; +1.639229499723830e-01   -2.522926814154954e-01   -1.221857680224836e-01   +1.268188919701414e-01   -4.181810983965386e-01   -5.210577143581901e-01   -7.057261507051573e-01   +1.172745769087938e-01; +1.000000000000000e+00   +4.006655073090903e-01   +1.315739578765075e-01   +7.639331390344112e-01   +6.702022381733529e-01   +6.519706779758191e-02   -2.562400556018628e-01   +2.033466290318257e-01; +1.773611443098081e-01   +5.282284427637133e-01   -5.432040363940243e-01   +2.550759342669792e-01   -3.781327543661698e-01   -1.359754007134537e-01   +2.044772375014440e-01   +1.054021979112033e-01];
L2E_L2I_iGABA_netcon = [-2.251117253407813e-01   +7.244786974007200e-02   +5.431728986573807e-01   +1.892724554715829e-01   +7.149215814681448e-03   +2.760277380697412e-01   +6.645875174794380e-01   +2.178085968797686e-01; +4.891658215993732e-01   +1.200297788662720e-01   -9.782448365365216e-02   +3.225987728290917e-01   -1.833546989744970e-01   +3.322826547921081e-01   +2.346234125354890e-01   +7.897666521923050e-01; +4.942514095498458e-01   -2.845199024398022e-01   +4.084478620900358e-01   -3.648268291411402e-01   -5.958782664387854e-01   -9.316153842162729e-03   +3.329442726195946e-01   +3.266036988175282e-01; -4.548906223424612e-01   +3.453324255104656e-01   +4.051428854913819e-01   +2.566669578009259e-01   +2.127581639955678e-01   +2.986113749681358e-01   +9.998208524778862e-01   -1.274287218174310e-01; +3.589503482943769e-01   -4.260538642731329e-01   -3.048067677760715e-01   +4.973578249909939e-01   +1.570171892233546e-01   +1.802233747158299e-01   -7.958055439265366e-03   +3.457766250254311e-01; +4.268789277633380e-01   +2.926034100321604e-01   +7.893294492958969e-02   +4.152925566844776e-01   +8.562590475270377e-01   +4.365921930012777e-01   +2.334465589715273e-02   +1.961820024507853e-01; -3.168236095630128e-01   -1.226123609789794e-01   -5.927640917755525e-02   +6.784225104904968e-01   +3.705505378179841e-01   +7.999342510388368e-01   +6.166188206736791e-01   +3.484123330748606e-01; +4.204195448928199e-01   -3.586155081120458e-01   +4.748359974381303e-02   +6.644039596597959e-01   +7.617307343643372e-02   +2.676787839544478e-01   +5.980692173998129e-01   -1.149994747359478e-02];
L3E_L2E_iAMPA_netcon = [-3.847921567172599e-01   -2.408552103900814e-01   +2.876376553034870e-01   +5.655199988949604e-01   -3.505686134345392e-01   -1.241601422490910e-01   +8.501005054957066e-02   +1.366471956616766e-01   +3.153773831512548e-01   +2.606916526043306e-01   +7.493165327711194e-01   -1.715693379517814e-01; -3.826140730441602e-02   +3.622404654735404e-01   +3.446845499344530e-01   +8.073149322043518e-01   -1.556003160874290e-01   +3.055577635315666e-01   +7.598388346334872e-01   +1.224606311172463e-02   +2.948100800070599e-02   +4.840778879642041e-02   +7.830100783041782e-01   +3.226109574110396e-02; -4.691945113876960e-01   +6.217818909736204e-02   +6.625971055765012e-02   +9.476301367157540e-01   -3.113071618511545e-01   -8.250950970769623e-01   +4.070303371999942e-01   +9.699874273305589e-01   -4.693633448896539e-02   +8.031424284860351e-01   +3.636108368124700e-01   +2.886094478289473e-01; +3.472560710804705e-01   +8.612843763720556e-01   -1.813184587473425e-01   +5.666566963185735e-01   +1.523694584582849e-01   +5.276409791499730e-01   -5.516668221368363e-01   +5.924149569144308e-01   -1.756926466348397e-01   +9.221021844942295e-01   +3.594165606427047e-01   -2.448533002865081e-01; +8.068608360510215e-02   +6.342385315760406e-01   -5.670460889503064e-01   -1.705420197691549e-01   -1.219389860769597e-01   +1.467361337527797e-01   +5.537160066431974e-01   +7.769762859132262e-02   +7.942827015663291e-01   -1.535526073364666e-01   -2.658083940028422e-02   -3.676476475662172e-01; -5.328553873022105e-01   +4.486169178712762e-01   +6.702217961249670e-01   +1.310459444268602e-01   +2.320057282615096e-01   +2.179947480221129e-01   +2.225874164581056e-01   +7.788357861281081e-01   -1.615668150990032e-01   +5.283281935887927e-01   +6.709166324640198e-01   -2.073444808815814e-01; -2.581384723119055e-01   +2.989781001772482e-01   +6.557025546513791e-01   +9.011455311249914e-01   +2.072243672733697e-01   -3.278807132604656e-01   +2.879952905172529e-01   -5.348148742201393e-02   +4.922208266942676e-01   +9.517777732569672e-01   -6.694102697853316e-01   +8.222486979734704e-01; +5.271354991288459e-01   +5.787306703643229e-01   +6.424620671727773e-01   +4.947158383267591e-01   +1.399926616621622e-02   -2.008618355000767e-01   +4.222313140460229e-01   -6.303580383266372e-02   +3.984367955981238e-02   +7.722636463653922e-01   -3.159920218337903e-01   +1.673330481437500e-01];
L3I_L2I_iGABA_netcon = [+1.576654045740365e-01   +1.804914526728101e-01   +3.553555846040470e-01   +4.819325477555175e-01   +4.489057321760991e-01   -1.229147506512989e-01   -3.673347328242447e-01   -2.602311459935571e-01   -2.811815346496907e-01   +6.314965357061959e-01   +6.267725001001270e-01   +4.381563812613429e-01; -3.829858596660459e-01   +1.000000000000000e+00   -5.787732758664368e-01   +1.599283253508864e-01   +4.436023860995963e-01   +4.364611480207889e-01   +2.778300086212899e-01   +1.026927639493809e-01   +5.613465650828112e-01   +6.390544385471005e-03   +4.466619786319839e-01   -2.354072084495388e-01; +2.896183436273715e-01   +7.618868035542068e-01   -6.542952905115794e-02   +3.495255540909261e-01   +2.260306620289864e-01   +6.803201982409347e-01   +4.728854772422857e-01   +6.755750873280610e-02   +2.722827233812941e-01   +5.980080801764071e-01   +6.644056151712773e-01   +1.514408357034899e-01; +3.716481695688801e-01   +4.895259817823013e-01   +1.839070692351099e-01   +2.304135192856776e-01   -5.298408321168861e-02   +4.102344793243773e-01   -3.879672427180751e-01   +7.746518215696018e-01   -1.796435224367794e-01   +2.102975710465481e-01   +4.210096933837125e-01   +5.162869305636907e-01; -4.494719337890437e-01   +1.356429347922984e-01   -7.040777424075619e-01   +2.968301066603132e-01   -4.475470985093095e-01   +5.137863635208479e-01   +1.597560390703320e-01   +7.567218777488741e-01   +3.855898241508580e-01   +4.461096096707776e-01   +5.446436019904473e-01   -3.248672256072643e-01; +6.713767912801173e-01   +3.393571832218031e-01   +3.950295598041770e-02   +2.757159275547688e-01   +2.812627598105670e-01   -6.314775917809375e-02   +5.312360466134081e-01   +3.924140896376794e-01   -9.001146313934238e-02   +3.827270427206534e-01   +2.795205085692830e-01   -6.261832995640795e-02; -3.491496046644185e-01   +5.669216325381872e-01   +9.805939830478994e-03   +4.487401138080799e-01   +4.660985922294859e-01   +5.399421444461172e-01   -6.331743169288082e-01   +4.047006266815271e-02   +7.158362634595240e-02   +2.271550823858936e-02   +3.872896413307901e-01   +2.026204355321913e-01; -1.652843427691870e-01   -3.076306603175137e-03   +4.269389201295158e-01   +8.700606012890811e-01   +2.495175678010086e-01   +1.260750548956025e-01   -1.983911732781279e-01   +8.197717627584259e-01   +6.511847821656399e-01   +2.327836679166880e-01   +1.133777970903246e-01   +5.900805953378369e-01];
L2E_L3E_iAMPA_netcon = [+1.935437286630335e-01   +1.368972354636230e-02   +6.631010617140762e-01   +5.217629249706930e-01   +2.902466925717017e-01   +2.121348310893086e-01   +7.508224195341291e-01   +1.146503723720693e-01; -9.551170251368220e-02   +4.560981619304437e-01   -3.014392734680809e-01   +4.379788101053299e-01   -2.151969378557277e-01   +4.551465247430522e-01   +1.850003069959135e-01   +4.283252287635869e-01; +6.761781767502643e-02   +6.378525311986651e-01   +5.365128806348747e-01   -1.276292228596504e-01   -3.466631674853635e-01   +1.705254572464773e-01   +1.244122275251641e-01   +2.457055085671614e-01; -5.931367243392837e-02   +6.465373922881004e-01   +4.176352008356095e-01   +2.272209244647759e-01   +7.002179918663290e-01   +1.082100250966994e-01   +3.837044704658671e-01   +9.959279371941717e-01; +1.711787861820141e-01   +3.668640891072120e-02   +2.468799368827918e-01   +7.532196363030933e-01   +4.759216451974542e-01   +6.438683738745384e-03   +6.893802606400407e-01   +1.391198873839418e-01; -1.970623119324549e-02   +2.087126237637007e-01   +1.947300503281461e-01   +7.806464959790271e-02   +1.151621210890201e-02   +1.625772906485205e-02   -8.543636406049668e-02   -1.024767916111082e-01; +5.888804066964435e-03   +1.359569688078155e-01   -4.400410777349412e-02   +4.600796150993015e-01   -8.753780783674944e-02   +1.181030348537731e-01   -3.947392452399049e-01   -4.585348573554438e-01; +6.097190475133573e-01   +1.247009250494305e-01   +4.950284923287739e-01   +1.804269362448713e-01   +5.324817124238026e-01   +1.584796570117931e-01   -1.132962696720138e-01   +2.113782147337575e-01; -2.260677584702183e-01   +6.615900905835855e-01   -2.158463597144312e-01   -7.399299878120164e-03   +2.903099245052857e-01   +1.133803163660629e-01   -7.026810212044891e-02   +1.000000000000000e+00; +4.020333219174562e-01   +5.718707766127040e-01   -3.750676926901673e-02   -2.422911339702408e-02   +3.104216830688513e-01   +3.876618055433537e-01   -7.855666831515691e-02   +1.898146649479799e-02; +2.001901613849620e-01   +8.632180000720847e-02   -3.669269470651059e-01   +2.476612463537717e-01   -2.660737688210574e-01   +4.665098702795163e-01   +3.487582725840613e-01   -3.288800552094293e-01; +7.765092788169860e-02   +2.069699034008746e-01   +2.904904802489666e-01   +2.661778178626840e-01   +5.437015910505418e-01   +5.002774162552457e-01   +2.309426668098680e-01   -4.669994352875788e-02];
L2I_L3I_iGABA_netcon = [+2.508743166139678e-01   +3.470555408566897e-01   +7.929645708106158e-01   +2.950179615918714e-01   +2.784747707659813e-01   +7.081855883670509e-01   +5.005859663501009e-02   +1.802153800075146e-01; +8.804384606094305e-02   +2.258521096972100e-01   +2.337959280359147e-01   +9.020850981447091e-01   +4.838723588635817e-01   +1.525366246984162e-01   +5.022724132638574e-02   +3.757803902962524e-01; +6.041366350473685e-01   -2.970436156717455e-01   +7.423541729879669e-02   +1.156857879495887e-01   +2.529924855127543e-01   +5.022044015565967e-01   +2.942396332107753e-01   +5.015847243222634e-01; -2.709026656827032e-01   -1.466602065575723e-01   -2.819281439028156e-01   +3.422822226474163e-01   +2.325447976239285e-01   -3.714572342554258e-01   +2.598545047634153e-01   +4.150054619695066e-01; +1.110495768316134e-01   +6.156030946055032e-01   +3.395333004951795e-01   +7.078587619185538e-02   -5.021696845269110e-01   +1.898420908197240e-01   -2.702963072051756e-01   +4.352003431809161e-01; +8.949010340831026e-02   +9.871026956360566e-01   +9.182810618041576e-01   -2.823389729266412e-01   +5.517014537776949e-01   +4.840153974043896e-01   -2.059184512016292e-02   +1.607929673774403e-01; +1.965160184028619e-01   -4.869215353792137e-02   +5.230445381264976e-01   -5.797219723587497e-01   +3.485958658305021e-02   -3.733957652577742e-01   +1.658031377086614e-01   +6.818867339714610e-01; +4.364716461755240e-01   +6.062343560016076e-01   +2.310354172997849e-01   +4.539702311084088e-01   -2.257706720499204e-02   +4.587792018452694e-01   +5.819051801871074e-01   +9.151390442798489e-01; +5.420065429516751e-01   +2.370122569901027e-01   +4.787307973657219e-01   +5.805045584360745e-01   +1.496855977919209e-01   +4.586662083972603e-01   +4.417367728228810e-01   +9.669114818996733e-03; +2.838282087273317e-01   +5.626069802600034e-01   +1.241823048705314e-01   +9.605000327426035e-02   -1.435452557994659e-01   +1.000000000000000e+00   +7.087438465019350e-03   +7.580463203644976e-02; +4.991098482696629e-01   +3.161190089688683e-01   +1.790464979960954e-01   +1.226413410571425e-01   +4.504891322910795e-01   +3.492055995998666e-02   +1.918544533193475e-01   -3.605710014160438e-01; -3.919893334331790e-01   +4.988431288637627e-01   +2.370462873157908e-02   +1.529215056315699e-01   +3.771114210922415e-02   +2.540264015226437e-01   +6.468215314699037e-01   +7.820106338694363e-01];
L3I_L3E_iAMPA_netcon = [+9.515795646900480e-01   +4.123021425228576e-01   +1.177211546762983e-01   +3.809655812665930e-02   +4.670372680203501e-01   +5.858685869846451e-01   +4.546526755682859e-01   +5.076182192757656e-03   -5.833919553319955e-01   +4.527694177207141e-01   +4.371651143754042e-01   -6.649355841069220e-02; +3.146847261610151e-01   +9.256326479040616e-01   -6.776199107365623e-02   +6.235386893910002e-01   +5.949791164035825e-01   +3.471236470875890e-01   +3.558175585364248e-02   -1.257459354484479e-01   +2.679868346265692e-01   +3.690826296333355e-02   -1.508139493515378e-01   +6.598642070860677e-01; +3.215970521732284e-01   +3.942106764855380e-01   +4.623628242378503e-01   -4.151773639286678e-01   +4.146381685238030e-01   +9.848035644153030e-01   +2.216808765496828e-01   -3.547635761763243e-02   +4.414426370331946e-01   +4.711333787061346e-01   -5.668770727365551e-01   +5.932412790556097e-01; +6.964275057733185e-01   +3.283554854694324e-01   +9.560764951532981e-01   +8.801767660724323e-01   -1.143474245007953e-02   +3.384432147824376e-01   +8.145891972251915e-01   +6.210593168550835e-01   +9.472418114114964e-03   +2.653907734506002e-01   +2.825839056426047e-01   +4.064181264626064e-01; +2.073525125094832e-01   +8.813530039367291e-02   -4.157384449064193e-01   +6.954240183526994e-01   +1.179364851445987e-01   +3.364056966626563e-01   -3.271264809617311e-01   +3.266997102219159e-01   +6.027010946346413e-01   +2.300297896728345e-01   +2.321284809903618e-02   -2.885257333340981e-01; +2.486816903259201e-01   -5.900629399982172e-01   +2.145109829185076e-01   +4.469226686036908e-01   +4.042301125422423e-01   -8.034609232343122e-02   +2.290728340821059e-01   +1.838788060102073e-01   +8.400445765965083e-01   +8.727639973827894e-01   -1.613606439368953e-01   +3.305952087257708e-01; +2.395356862568358e-01   +7.824274170171608e-01   +1.360647336690922e-01   +5.894724226614659e-01   -3.880433238546870e-01   +1.663000154447419e-01   +4.616539406444710e-01   -1.719020040812704e-01   +1.745976385566874e-01   -1.533182156582938e-01   -9.220053225223279e-02   -4.154000307103659e-01; +6.250286386775584e-01   +7.764901972814563e-01   +4.313790758030844e-02   -2.722579543747684e-01   -3.289709189665891e-01   -6.164073587280108e-02   -3.064019794573282e-02   -5.327229453705318e-02   +2.797743359100920e-01   +7.631720483287770e-02   +5.215444858003346e-01   +2.826878180387437e-01; +3.316337309876553e-01   +3.725912729684037e-01   +5.382026723501089e-01   -2.096352910412516e-01   +3.208341090665496e-01   -6.167485854525175e-01   +1.908696853754051e-01   -1.554394955099640e-01   -6.517641879984781e-01   +7.342539331150786e-01   -2.314546630690182e-01   +1.754549430631344e-01; +4.529713146784642e-01   -6.823770236300816e-02   +5.140410430971936e-01   -4.928747595105948e-02   +6.311139543336874e-02   -3.301739565852713e-02   -1.753002684861537e-01   +1.595349631703678e-01   -2.600929842851585e-02   +1.502350854796050e-01   -9.135327144151112e-02   +9.334513115429200e-01; +7.113546122473066e-02   +9.740188136719747e-01   +1.320703866872384e-01   +1.094193358002993e-02   +7.775150250296137e-02   +1.849447148334715e-01   +1.520141125827305e-01   +2.818666780018741e-01   +5.811515159292253e-01   +6.552740975901074e-01   +8.397333940005285e-01   +2.505105980143659e-01; -4.392422838770506e-01   +1.387085586217934e-02   +5.315562690234303e-01   +6.470688495341952e-02   +4.704397266126318e-01   +2.346516774254356e-01   +1.626510682361992e-01   +6.335383621522375e-01   +3.455943231988726e-01   +2.347061714680797e-01   +2.828164116728016e-01   -5.374551421837963e-01];
L3E_L3I_iGABA_netcon = [+3.267300925867120e-01   -3.150041455780798e-01   +4.459524304896712e-01   +3.241459179791522e-01   +4.340191792129560e-02   -3.515516366621105e-01   +7.124964048173262e-04   +1.243734972018426e-02   -1.252747585062667e-01   +2.433579507846413e-01   +4.843885003096617e-01   -4.794667825788750e-01; -1.358540409969473e-01   -3.762402600479967e-01   +3.992206662115027e-01   +4.966864678595919e-01   +1.000000000000000e+00   +4.016245543890071e-01   -7.763984766771442e-02   +3.909884873570924e-01   +2.543395699355239e-01   +8.201837035532398e-01   +5.754587709157030e-01   -4.549104146540497e-01; +3.376394652425225e-01   +8.872472800805652e-01   +5.278395427445989e-01   +9.130091653486552e-01   -5.540599282917822e-01   +1.468003400843521e-01   +1.374691800911038e-01   +6.942209311447550e-01   +6.086230445552361e-02   +3.608486088379802e-01   +2.382297575246174e-01   +1.644206198623929e-02; -4.622444265205187e-01   -3.412983339518610e-01   +9.156740001435566e-01   +7.881159852864243e-01   +5.461663224804533e-01   +3.081394226316698e-01   -1.723646347760455e-01   +2.737626361759830e-02   +3.413471740968612e-01   +2.205224065897027e-01   -1.139334466515029e-01   +2.483122184944417e-01; +3.391762781958246e-01   +8.696977238266215e-01   +3.631841450849235e-01   +3.727717036480417e-01   +6.428988848624405e-01   +8.670105688319538e-01   +3.033949944541861e-01   -1.972812216860755e-01   -8.796364293238236e-02   +3.842426866339905e-01   +7.770678422464515e-01   +4.263932516509778e-01; +5.931662089215510e-01   +5.085492850193877e-01   +1.732228316934088e-01   -2.018119912466715e-01   -4.549476473454999e-01   +4.806122299759895e-01   -6.810272861141013e-01   +7.794164162508982e-01   +3.891772979350877e-01   +3.355973978310138e-01   +5.631869418972500e-01   +8.908023636628550e-02; +9.125313304950265e-01   +5.473956457126109e-01   -1.858209169122012e-01   +6.803820428843196e-02   +6.956245074242316e-02   -2.288738736485609e-01   +3.096596106193498e-01   +4.756278999245091e-02   +5.058303855729059e-01   +4.340242918768140e-01   +4.621404929694249e-01   -1.917924952545387e-02; -3.896356081264318e-01   +3.345420277485716e-01   +8.911414009295728e-02   -3.200226438178739e-01   +4.306981106489250e-01   +5.834541216607664e-01   +2.048250520268292e-01   +3.293433959745097e-01   -2.088059806744008e-01   +7.266911332162911e-01   -5.781787325807840e-01   -9.819729612566348e-02; +7.454515382102600e-01   +1.240506214079089e-01   -2.496854319362339e-01   +4.250015601858493e-01   +4.486118814670391e-01   -5.812930187927307e-01   +4.815677073486759e-01   +8.387121107375943e-01   +3.818785671770224e-02   +7.008455167182553e-01   +2.799773174905830e-01   -1.541855632549960e-02; +4.825974851776053e-01   -1.479926824130259e-01   +6.695444585574313e-01   +1.930242185089136e-01   +6.202390949053523e-02   +9.189820616288241e-01   +4.443996978246605e-01   +3.391884471657348e-01   +1.621795218189437e-01   +3.763137870017388e-01   +1.522076126643995e-01   +3.802882255538877e-01; +5.209646328070111e-01   +1.110819894510957e-02   -3.307201671839952e-01   -9.747660639256764e-02   +9.662913295754599e-01   +7.559727174321524e-01   -1.453799735840531e-01   +4.746032963269379e-01   +5.750048868432487e-01   +7.631611196043812e-02   +1.107919957702873e-01   +2.827092567925248e-01; -2.091194331457289e-01   +1.196103550650372e-01   -1.524521984168558e-01   +1.894863132936249e-01   +4.851819015477103e-01   -6.102043592865843e-01   -1.869718002886935e-01   +2.353942147535777e-01   +5.379105515827622e-01   +4.190615358024392e-01   +3.929980292227370e-01   +2.656378000806607e-01];
L2E_Input1_iAMPA_netcon = [+9.009722462455132e-01   +6.103819799201666e-01   -3.894506157210787e-01   -4.796402989804940e-01   +1.865185133592445e-01   +1.030692442993209e-01   +4.484871756488634e-01   -9.523103190464272e-02];
L2I_Input2_iAMPA_netcon = [-3.481134404849587e-02   -6.348692644978592e-02   +3.540116353902897e-01   -1.347903412729811e-01   -3.729316466297252e-01   +2.825379804964933e-01   +2.523851595224971e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
