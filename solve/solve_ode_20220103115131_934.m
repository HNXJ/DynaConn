function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.642572129148735e-01   +1.697941890019938e-01   +6.931717119931128e-01   -1.010741818037219e-02   +1.379341433590248e-01   +7.272801393573037e-01   +2.118741321407212e-01   +2.118532574942228e-01   +2.137681024392845e-01   +5.311974330338719e-01   +6.428364092138208e-02   +1.809268120279356e-01   +1.449923360896873e-01   +2.849487003123800e-01   +8.184631327490802e-01   +1.341607000530911e-01; +7.882818333617888e-01   +5.129759396555236e-01   -1.394821174783320e-01   +2.068584840700033e-01   +7.565770381485856e-01   +4.037143491644149e-01   +1.943469962518199e-01   +3.317410703695289e-01   +4.023267968920025e-01   +1.681213991425029e-01   +4.792464542806789e-01   +5.728870917665990e-01   +5.808632680738317e-01   +8.989412675581949e-01   +1.165135460761869e-01   +2.579866692589400e-01; +3.311695158715595e-01   +4.435692877555678e-01   +2.547078643130546e-01   +5.270346138022017e-01   +5.746685069011946e-01   +8.785864142342165e-02   +2.197033579906153e-01   +2.155140208781374e-01   +2.764478318097753e-01   +4.362617129761401e-01   +9.764967688010139e-02   +4.050215779966068e-01   +5.578675460833958e-01   +5.847589352936315e-01   +4.851751206265611e-02   +4.028037071537220e-01; +6.184726795328773e-01   +4.384528329121584e-01   +7.237258287007937e-01   +8.953704231349953e-01   +7.903637875835603e-01   +2.147316180951953e-01   +6.812361647465670e-01   +8.953819137774731e-01   +7.219117742211183e-01   +4.646822399191919e-01   +2.467672352026021e-01   +2.704315756662147e-01   +2.211964288080751e-01   +2.725168439421918e-01   +3.196675043710696e-01   +3.088572893363838e-01; +4.296666119957225e-01   +7.296772338015685e-01   +4.152153890757240e-01   +9.484410184888236e-01   +2.329143924295301e-01   +7.636821853936604e-02   +1.167444043318795e-01   +7.884939060448307e-01   +6.258281102301319e-01   +8.212256409272389e-01   +1.000000000000000e+00   +2.175103977016651e-01   +7.851489592923576e-01   +1.546739681428907e-02   +2.613343602948681e-01   +2.767244665589911e-01; +1.686058127173488e-01   +2.936147822179987e-01   +4.243933372970197e-01   -1.576940456838027e-02   +1.898250828478110e-01   +8.110663534092112e-01   +6.743889184808659e-01   +4.812062307064635e-01   +1.649264599108655e-01   +6.351889709433122e-01   +1.285567043206233e-01   +8.279278345450910e-01   +2.044896970046260e-01   +2.880083843294499e-01   +5.205204084271333e-01   +5.163056977766272e-01; +3.832805301515056e-01   +7.603370206223734e-01   +1.273297865939587e-01   +1.808042544290059e-03   +4.989293665492727e-01   +7.682430648244255e-01   +5.357906274784022e-01   +2.458513914853067e-01   +9.424159229093663e-02   +5.396582889088213e-01   +5.845897546283293e-01   +6.865459361386397e-01   +4.619393822693514e-01   +1.823232950206509e-01   -3.610208130665417e-02   +5.367932272421383e-02; +6.924425623744110e-01   +6.718628720646499e-01   +4.609984060792671e-01   -5.810673316245784e-02   +3.980127259972135e-01   +5.229349455235385e-02   +3.518560106498634e-01   +1.678059568230647e-01   +4.049356928392578e-01   +6.793922286328996e-01   +3.248988745819325e-01   +1.942397896239515e-01   +3.491679931931257e-01   +4.934639545357366e-01   +4.610743629386639e-01   +7.701239315979723e-01; +1.551933223158656e-01   +2.561485731972324e-01   +1.357738607053640e-01   +5.759828932617358e-01   +8.223636236137630e-01   -7.979512838379069e-02   +6.311007415815055e-01   +4.729094096520176e-01   +3.448771825416930e-01   +1.600161547346027e-01   +7.389427182140050e-01   -8.589503430496809e-02   +2.445670356849207e-01   +1.132583340613231e-01   +2.934785185787653e-01   +2.578582398533819e-03; +3.979249734519897e-01   +5.394505064045659e-01   +3.498310147647606e-01   +3.852491892907242e-01   +7.397012265256774e-01   +6.505491485096417e-01   +3.185772547288256e-01   +5.258966816835481e-01   -7.720579837157068e-02   +1.444212771168369e-01   +2.347080454620234e-01   +6.098474773009050e-01   +5.720663793600674e-01   +5.692548399984417e-01   +7.742345990154099e-02   +5.364706127477474e-01; +3.718682767329653e-01   +4.830967273131596e-01   +3.744164820525442e-01   +6.571578767857322e-01   +4.710783327820229e-01   +3.945079266370095e-01   +5.507720836443005e-01   +6.883439330916118e-01   +4.993037987984977e-01   +7.139429704636585e-02   +2.847548428137062e-01   +6.889666960015102e-01   +2.204523923502620e-01   +5.106977815048391e-01   +3.337158475431328e-01   +1.529945007420352e-01; +4.900297992477941e-01   +9.373340091737303e-03   +6.648578240486105e-01   +4.774755130716340e-01   +4.870518411710711e-01   +1.152216532496977e-01   +3.213647641473180e-01   +1.445687664959362e-01   +9.052359107926577e-02   +5.225835422874853e-01   +1.380166358405351e-01   +5.188093518409191e-02   +7.353399428856316e-01   +5.475766142901652e-01   -1.866386034620373e-02   +1.005416250093974e-01; +1.579302320575145e-01   +2.805171049391328e-01   +9.435411935094115e-01   +7.165097923675304e-01   +6.286525141645207e-01   +8.659737585543001e-01   +2.400415854499704e-01   +3.982695498517492e-01   +8.711190039280804e-02   +3.181124605809536e-01   +3.507674963985992e-01   +5.817790274051702e-01   +3.415794313047025e-01   +6.756347730629747e-01   +5.918015262217553e-01   +4.549412177459489e-01; +4.376779972389441e-01   +8.135009858039779e-01   +7.263542866724191e-01   +6.925022175620175e-01   +7.950933081919218e-01   +3.567304246106448e-01   +1.010698208752719e-01   +3.006468321272472e-01   +6.223192516912861e-01   -5.761950012929243e-02   +4.823044469529416e-01   +1.857510352342213e-01   +4.680984295946498e-01   -1.765971167909860e-01   +1.861505564343769e-01   +3.361770253533396e-01; +1.792746678745868e-01   +4.946179197578757e-01   +4.750946866524746e-01   +4.881771564703534e-01   +7.399804481476244e-01   +8.146654492634822e-01   -1.516033271901312e-02   +3.306158290305103e-01   -1.771026295481109e-01   +3.711980993563931e-01   +2.661343539262704e-01   +6.755390854128163e-01   +9.010302882266041e-01   +7.897847106289742e-01   +3.033714604623606e-01   +3.279953395275657e-01; +6.045940226513821e-01   +2.703675934008491e-01   -4.237943381126077e-02   +3.075032448277938e-01   +4.508276323453812e-01   +4.640091223984035e-01   -2.559964323998929e-02   +2.410101246680277e-01   +3.842266994854653e-01   +5.588541231182270e-01   +7.710798691470244e-01   +3.585248841156331e-01   +5.923797107457494e-01   -6.005717889164844e-03   +6.074977437880655e-01   +5.121425048325728e-01];
L1E_L1I_iGABA_netcon = [+5.847139554261390e-01   +5.944119225572899e-01   +5.048191646414674e-01   +2.594864263997590e-01   +1.851272851591229e-02   +2.890538008805292e-01   +4.798667374849008e-01   +1.065436965991994e-01   +7.271909728276329e-01   +5.580237380316044e-01   +4.642907598621739e-01   +2.754877909972535e-01   +8.184362140455366e-01   +2.001374835000135e-01   +3.631910449476159e-01   +1.278453257266603e-01; +5.108146890771010e-03   +1.920649042546335e-01   +3.969645593030071e-04   +3.476926019151265e-01   +2.129423325658808e-01   +4.530567623610360e-01   +2.455611822875229e-01   +1.342277325069720e-02   +6.909904440199208e-01   +3.651797249312127e-01   +4.229304418148849e-01   +9.684421318955880e-02   +5.269774831028282e-01   +4.433402775434015e-01   +2.016067615652834e-01   +3.699739337648166e-01; +6.182678328370222e-01   +6.292904463219038e-01   +6.109779780908958e-01   +1.650474143169401e-01   +6.006226786423764e-01   +7.038520244630043e-01   +3.427718618584478e-01   +1.483266788960844e-01   +5.664671021829696e-01   +4.218716668278976e-01   +6.310313578869375e-01   +7.087664476409479e-01   +7.407954575025173e-01   +7.902748435404437e-02   +2.998335429712783e-01   +4.528487491168255e-01; +2.053701321190049e-01   +7.124923548123578e-02   +1.468529681554515e-01   +4.303939113919333e-01   +7.063563216028852e-01   +5.935628396094599e-01   +8.169607593358206e-01   +3.486624891546698e-01   +1.736650108495179e-01   +8.533689778251801e-01   +1.976632080343408e-01   +2.239508485348839e-01   +7.404432522135129e-01   +8.299683445358925e-02   +5.355070108462943e-01   +3.582470151196272e-01; +2.373066840633022e-01   +1.191446654346515e-01   +1.461879581095185e-01   +3.796320236305912e-01   +1.548138823555611e-01   +6.027889729524768e-01   +7.308925983113070e-01   +6.960083288909539e-01   +1.845585538271036e-01   +4.636319623072074e-01   +5.694051781184672e-01   +7.494384303781858e-01   +3.727427588268282e-01   +4.018000446632013e-01   +6.110911631287634e-01   +1.596809365940050e-01; +4.562461140237543e-01   +3.476650945072550e-01   +4.380857148242150e-01   +1.858967828633574e-01   +1.843272088564719e-01   +3.550034460640333e-01   +6.721207525293970e-01   +3.262892528240916e-01   +1.332864504734993e-01   +5.846815100075157e-01   +2.692413803159769e-01   +2.779969173403412e-01   +1.804909728423583e-01   +4.797231399303986e-01   +4.409616786627332e-01   +6.624417070811756e-01; +9.648056979855055e-02   +9.739373044680045e-01   +2.422419973059806e-01   +3.941984248187501e-01   +6.613458763322622e-02   -1.556963555828564e-01   +6.513340979081355e-01   +4.484200489996491e-01   +1.836001692660402e-02   +1.149735706579317e-01   +3.971268186298174e-01   +6.050544030317456e-02   +1.578726744609969e-01   +3.541944976504974e-01   +6.938716601702332e-01   +1.049792835125605e-01; +8.804623206861441e-02   +1.000000000000000e+00   +5.678506640750451e-01   +2.600706935199140e-01   +4.623308778797688e-01   +7.176366769907579e-01   +2.609580479366167e-02   +5.740592614280753e-02   +4.737355678767124e-01   +6.002418918964300e-01   +4.927645863966988e-01   +1.535315044945624e-01   +3.829862051158234e-01   +5.497583765320638e-01   +5.975316424511610e-01   +2.456135540283462e-01; +2.685178122724679e-01   +8.207688186469644e-02   +6.260461606627669e-01   +7.540603577537868e-01   +8.715719662750204e-01   +9.545785034990674e-02   +8.503163015692591e-01   -5.950073639195302e-02   +2.811737460277187e-01   +1.119912082875710e-01   +2.266425476310958e-01   +5.704572178397408e-03   +2.813633567774247e-01   +3.506854324836569e-01   +5.877482611065310e-01   +1.551517264017185e-01; +2.528818588999596e-01   +7.938860738234191e-01   +5.308464482170226e-01   +2.341091083647200e-01   +3.173523631967625e-01   +7.470210640271668e-01   +5.739448219209743e-01   +2.967321926995048e-01   +4.760296082033866e-01   +8.215103334299112e-01   +2.955601928634356e-01   +6.211815449085519e-01   +5.774677383563905e-01   +2.918282682598144e-01   +5.383665297042730e-01   +2.009777002068047e-01; +4.256441466351212e-02   +6.095226555979624e-01   +7.807939240829129e-01   +4.854649516838976e-01   +6.296667736556955e-01   -3.185307895550064e-02   +1.408163692010434e-01   +5.060341828485477e-01   +6.016488378991302e-01   +3.642073439367902e-01   +6.436723262753544e-01   +6.334465327980221e-01   +4.081666893698404e-01   +7.174489768556762e-01   +1.133597565054100e-01   +6.152509130170869e-01; +5.845590721266347e-01   -4.984141651646044e-02   +2.677762046849507e-01   +8.433334958465181e-01   +5.773354772362408e-01   +3.360482286401646e-01   +7.572211228133317e-02   +3.410683822789248e-01   +9.171979940427001e-02   +1.477095753991822e-01   +4.455144036178426e-01   +4.817715499583258e-01   +5.872276440468492e-02   +2.035203195380361e-01   +5.521555574347665e-01   +7.513489191832250e-01; +4.779442090365180e-01   +7.868396834110573e-01   +8.546865090169355e-01   -1.766083668103016e-02   +4.169994704279107e-01   +8.429870104200136e-01   +4.566799468983183e-01   +5.774069201400760e-01   +4.224370398777829e-01   +3.374864727120760e-01   +6.837470660667815e-01   -3.023514029348907e-02   +6.646590779759846e-01   +4.308639332629549e-01   +2.636077846494407e-01   +5.336973256131139e-01; +4.930613902858673e-01   +4.370559354613624e-01   +1.827181781403685e-01   +7.096605056195570e-01   +9.468141075313669e-01   +9.014514969151052e-01   +6.602090274012856e-01   +2.416642066792054e-01   -1.533212865374071e-02   +4.417321983228760e-01   +1.665259536340069e-01   +8.289713857618929e-01   +2.772570681736654e-01   +7.209007982048350e-01   +6.498748937638710e-01   +3.962154924184224e-01; +8.967880371238133e-01   +7.188645128353213e-01   +2.863986073495011e-01   +1.572806596474417e-01   +6.539668055694128e-01   +4.367626354350260e-01   +2.535946652977025e-01   +1.704494909103986e-01   +5.148152265469981e-01   +2.440826548087983e-01   +4.414207056072786e-01   +3.935589759060225e-01   +6.629052731225432e-01   +5.375299361738207e-02   +2.043337478606662e-01   -1.370907225253971e-03; +1.747537866602656e-01   +3.935507108974021e-01   +6.864703170922964e-01   +2.448840417360491e-01   +2.556910908517497e-01   +4.743059478686387e-01   +4.333406561533043e-01   +6.656853410270765e-01   +6.526466291075638e-01   +2.121560376944805e-01   +1.651916851357660e-01   +7.530571149606149e-01   +8.700158007324865e-02   +1.066031678702591e-01   +1.447712853312701e-01   +3.902537438120795e-01];
L2I_L1I_iGABA_netcon = [+2.430266277780317e-01   +3.360905073280782e-01   +8.933728543872204e-01   +3.304806592302011e-02   +8.210019492247701e-01   +8.516971987606924e-01   +8.642155622614925e-01   +8.512886498537695e-01; +3.735254060857859e-01   +3.338043873866883e-01   +4.228943217594630e-01   +1.777455634770367e-01   +6.821688159354747e-01   +1.471749734696166e-01   +3.543606434676313e-01   +1.324397846756659e-02; +4.508147367365352e-01   +7.504846132831989e-01   -6.367856441764043e-02   +1.578242937414066e-01   +5.376483004270463e-01   +1.245770563535393e-01   +5.380209840566179e-01   +1.976949186008235e-01; +7.359202172557325e-01   +6.129983107833881e-01   +3.943048728601842e-01   +4.728921691091647e-01   +5.532187719787683e-01   +7.609942844263821e-02   +6.013073254178585e-02   +1.630089118803770e-01; +7.432161608944438e-01   +6.477471164045960e-01   +8.270613337193092e-02   +1.839563641438234e-01   +7.094942630540471e-01   +4.855499588100280e-01   +5.993317626386001e-01   +3.586354654578033e-01; +9.472350662775807e-01   +5.791109380455290e-01   +5.251202621714430e-01   +7.319180120481289e-01   +5.848261038966005e-01   +4.727479990975529e-01   +7.643452787911797e-01   +1.163379386971338e-01; +3.536811667527587e-01   +3.973241428647743e-01   +6.793118061480351e-01   +8.309078970662068e-01   +2.818295754387065e-01   +9.645630341716846e-03   +3.931105730840496e-01   +5.016510114025168e-01; +4.245707853959863e-01   +5.515636897030682e-01   +4.799136337978762e-02   +1.060366613626715e-01   -6.839686475958609e-02   +4.547033961907824e-01   +3.805181109876022e-01   +5.904198944442354e-01; +4.441353044475351e-01   +2.131804351794326e-01   +8.950506250792766e-01   +4.425337955224690e-01   +3.241565853272265e-01   +8.712671354215588e-01   +4.160030115514542e-01   +7.498557514573043e-01; +6.912252428566179e-01   +2.661362836094837e-01   +1.266318694232570e-01   -9.339063025051049e-02   +8.340922361354163e-01   -2.636034357133984e-03   +1.089130204841420e-01   +6.320618136165459e-01; +4.077219847334666e-01   +3.534556474841440e-01   +5.157038485914034e-01   +8.977725733958031e-01   +6.825633566679150e-02   +5.812381914203429e-01   +9.050194512830918e-01   +8.892514153448375e-01; +6.010078798273611e-01   +9.206783164786451e-01   -7.017335465438002e-02   +2.246607153132310e-01   +3.101811727470271e-01   +8.117439134693836e-01   +7.308077990704451e-01   +3.099972792119602e-01; +9.669568222510553e-01   +2.937269104391055e-01   +7.240814359812658e-01   +1.137945304500663e-01   +5.009692641447763e-01   +8.763337953921713e-02   +6.865740642468930e-01   +5.134714988652566e-02; +6.781880193097315e-01   +1.057843550678534e-01   +4.641246498254269e-01   -8.844168490116015e-02   +4.379467457682612e-01   +6.163828627776157e-01   +9.471460207114557e-02   +2.398330741876558e-01; +1.307614606906357e-01   +1.000000000000000e+00   +6.847083294812417e-01   +1.560428085607685e-01   +5.104514003620150e-01   +7.691850319433180e-01   +2.836392128864421e-01   +2.812228715022939e-01; +3.140637000115005e-01   +8.377592262120158e-01   +2.828044792506160e-01   +5.290289910563541e-01   +2.007908043584919e-01   +5.170965202690191e-01   +4.511658484492559e-01   +5.395072927598393e-02];
L1I_L2I_iGABA_netcon = [+1.454080265344052e-01   +4.237848824486312e-01   +3.194173839293739e-01   +3.360023377574293e-01   +6.444677430953819e-01   +2.224810759657922e-01   +7.734052823984680e-01   +6.893786314055217e-02   +2.991623849710490e-01   +6.395824301333488e-01   +4.112680249321520e-01   +6.454362680339764e-01   +3.094484640076611e-01   +1.820764236184391e-01   +1.576987377976746e-01   +6.106560354774696e-01; +8.139789750310694e-01   +3.285844189307928e-01   +5.222359251719131e-01   +4.224993006945066e-01   +9.341044256364627e-01   +8.638834631455101e-01   +4.742126038434264e-01   +2.790256931445640e-01   +5.390053728171219e-01   +1.753948843984528e-02   +2.896435732217086e-01   +7.392383516333066e-01   +5.043214398791431e-01   +6.663290397191735e-01   +3.816929288487521e-01   +8.578926385147411e-01; +2.821787783584348e-01   -4.413030601323920e-02   +2.478231896538643e-01   +3.257337016159548e-01   +2.743803721241344e-01   +6.171045608017454e-01   +5.028364050340265e-01   +6.094838374727427e-01   +4.262622900802982e-01   +4.107022268875015e-01   +1.611589755715821e-01   +6.010387697298268e-01   +3.386013143273455e-01   +9.412030945161440e-01   +3.834743808736637e-01   +1.106342653379247e-01; -1.712384392209547e-01   +7.455473033321172e-01   +3.359229909660381e-01   +4.514993449229768e-02   +6.036703657801032e-01   +7.496510583526235e-01   +1.000000000000000e+00   +3.302251610385957e-01   +9.012963133749381e-01   +2.885022931833376e-02   +3.037176065819767e-01   +9.771273865840320e-01   +5.987352879115127e-02   +4.286054617251810e-01   +5.735376389240393e-01   +7.825415055261580e-01; +7.607440183694724e-01   +8.799530728628883e-01   +9.309014790039951e-01   +3.212038684373388e-01   +1.348750999487609e-01   +5.387137096656823e-01   +7.966469397599492e-01   +2.626038129382965e-01   -9.658902692260591e-03   +4.401141330878808e-01   +4.460303639156016e-01   +7.695904924298009e-01   +3.065984794117139e-01   +1.218409733918721e-01   +5.376215579414811e-01   +5.169119598839607e-01; +8.182797626666405e-01   +6.595260562266470e-01   +1.363187531196572e-01   -3.258007417424743e-02   +3.203877945852167e-01   +1.720125061946982e-01   +6.777907921203977e-01   +3.992819043917699e-01   +1.999976347642578e-01   +8.344139244154217e-01   +9.548624016537127e-01   -7.009999804019397e-02   +3.404069080775184e-01   +5.149394778744509e-01   +4.421287807318662e-01   +4.196753848055644e-01; +7.940777844148333e-02   +7.651666768908230e-01   +5.930969636393719e-01   +6.208344755433228e-01   +3.898731879157854e-01   +7.545737529449815e-01   +6.422613644451961e-01   -6.756854214097175e-03   +3.362477545077674e-01   +1.803718398635717e-01   +4.544872106633512e-01   +3.126473958674682e-01   +8.031089437971786e-01   +9.136970123648920e-01   +1.464141536971283e-01   +6.853828717020795e-01; +3.408180112163726e-01   +5.716046312968933e-01   +4.770280771246006e-01   +6.372920543245537e-01   +9.300029669843308e-01   +5.193392900657223e-01   +3.395024939072661e-01   +1.563866366559798e-01   -7.804500843249897e-02   +1.179333942266346e-02   +1.736607294019949e-01   +5.354384806159117e-01   +3.085739733012308e-01   +8.703958375171030e-01   +5.017783253328733e-01   +3.557126885292750e-01];
L2E_L1E_iAMPA_netcon = [+7.786967952726721e-02   +6.564094305069388e-01   +9.160354077752029e-01   +7.202459987910792e-01   +5.227268583499056e-01   +3.552990577601766e-01   +5.394742587601274e-01   +8.500640794695928e-01; +8.592232193720059e-01   +1.254502990020737e-01   +4.647268878927830e-01   +6.219985786410678e-01   +3.965721904535977e-01   +4.463214947049828e-01   +3.311727449881746e-01   +7.675332028188062e-01; +5.074707395339935e-01   +1.189892189233342e-01   +4.009877046603818e-01   +8.529694316234224e-01   +2.302530715680308e-01   +7.142918247937735e-01   +4.869049739118385e-02   +9.756939908975096e-01; +6.022403491045245e-01   +3.304430183430639e-01   +3.569117430856917e-01   +8.989540079419852e-01   +4.461637659965406e-01   +5.662234297697470e-01   +7.109313168704086e-01   +5.858156238511861e-01; +9.466607115776573e-01   +8.578819651652108e-01   +3.790085135152565e-01   +1.559179805936186e-02   +4.223906420150286e-01   +4.038629730415033e-01   +1.119497119100124e-01   +6.051877968966615e-01; +1.000000000000000e+00   +3.232307878035198e-01   +8.500547990813964e-01   +7.437341610999176e-01   +8.487147458446409e-01   +7.360693446103853e-01   +6.020280364127560e-01   +8.943439703598143e-01; +5.207510066622403e-01   +3.255595267267719e-01   +2.630893146838622e-01   +2.709471626868808e-01   +9.074224381803752e-01   +6.025483864855694e-01   -4.873147601558180e-02   +6.717919401481184e-01; +8.761608456224782e-01   +4.316413069313253e-01   +7.941322993329673e-01   +6.433763251395669e-01   +2.111991767770188e-01   +1.502731523981175e-02   +5.216975783388973e-01   +6.340254686766051e-01; +4.484690450587080e-02   +2.730640400853547e-01   +6.125572236653024e-01   +1.609756123652693e-01   +6.800932870625457e-01   +8.734546615747009e-01   +3.418949566338980e-01   +1.420533591345816e-01; +4.763908322734173e-01   +3.869313767028441e-01   +2.652409221313419e-01   +6.711893180049658e-01   +6.818502844755150e-01   +1.199322031389044e-01   +8.700525530464360e-01   -6.300471736461333e-03; +8.410239890368403e-02   +1.818801743764741e-02   +5.274657514183791e-01   +6.008693114072301e-01   +3.071306074075177e-01   +6.872295974774626e-01   +8.203584615347724e-01   +1.134047243943428e-01; +7.040867882135529e-01   +2.978021192855801e-01   +1.242384358504188e-01   +7.301664821036808e-01   +8.147022391601658e-01   +1.334144750472172e-01   +2.586386177121497e-01   +5.672895781838235e-01; +4.217512537991639e-01   +6.649335908723022e-01   +4.907365573212402e-01   +3.696780229393807e-01   +7.385864206565473e-01   +4.023136036136457e-01   +1.177322585789172e-01   +3.703289700539952e-01; +1.477811290745046e-01   +8.851507423218896e-01   +8.364968789197198e-01   +5.493622859272582e-01   +5.727489933346269e-01   +4.054442001056770e-01   +4.512265242199937e-01   +8.210353606700199e-01; +7.600267836978857e-01   +3.703797050473311e-01   +2.517846517905053e-01   +5.823702756329380e-01   +8.053210342942984e-01   +4.805386573228159e-01   +5.253045098356117e-01   +7.008492567135808e-01; +3.331594959350840e-01   +5.440245904117623e-01   +3.284670459782679e-01   +8.734893691018102e-02   +8.480552862431479e-01   +2.049373738869214e-01   +1.720936697672009e-01   +2.138469753900373e-01];
L1E_L2E_iAMPA_netcon = [+3.280733089062325e-01   +3.971115756455279e-01   +8.406893769760436e-02   +3.167989092622673e-01   -8.183408400236973e-02   +6.449533769745882e-01   +2.781195824465300e-01   +7.801522863674175e-01   +5.893767379606720e-01   +4.420060538599859e-01   +1.670737423760318e-01   +8.377862680058820e-01   +6.079218167258170e-01   +2.053165742922990e-01   +1.059225366682107e-01   +4.227431403997876e-01; +3.116418871268145e-01   +4.509369492814671e-01   +1.000000000000000e+00   +5.876444888177915e-01   +4.808089870283276e-01   +7.277136539082549e-01   +4.637737888983550e-01   -9.351368907471480e-02   +5.297983902621751e-01   +3.048709532452937e-01   +2.511384349502299e-01   -7.944258892136478e-02   +5.309466938440099e-01   +3.480550619211235e-01   +1.284392043254313e-01   +1.102601641778334e-01; +1.898451622337628e-01   +3.247165770020127e-01   +5.164387713854368e-01   +7.146231879787555e-01   +4.041321364912171e-02   +4.541139207380261e-01   +1.193698345477193e-01   +1.967511868215393e-02   +5.336812467450938e-01   +4.038935659589440e-01   +8.953160080630163e-01   +2.324263305700578e-01   +2.004661400942550e-01   +8.455591956584387e-01   +3.942741242611275e-01   +3.678897620213533e-01; +2.143979840707547e-02   +6.481277942630381e-01   +4.317492235567406e-01   +5.345233031957670e-01   -7.446982770284434e-02   +5.218742455716280e-01   +4.544559825061117e-01   +2.090737591689816e-01   +5.389972079127090e-01   +4.969437995822248e-01   +5.728378441584236e-01   +2.106276044293501e-01   +4.256341747392409e-01   +1.706282689961168e-01   +2.732110086759951e-01   +4.086260013610835e-01; +3.690029544374894e-01   +6.466427841552678e-01   +7.902110530555403e-01   +2.040619045145062e-01   +2.761082355337929e-01   +6.823275629516293e-01   +4.005980803179093e-01   +3.978623535354864e-01   +6.937020687604849e-01   +6.834277119730945e-01   +8.998958946751616e-01   +1.166695138435870e-01   +7.682395350836003e-01   +6.720156439366196e-01   +3.575222419179541e-01   +3.051201757848536e-01; +5.294235145192568e-01   +1.145195093669877e-01   +4.044349991493113e-01   +3.075973471290992e-01   +5.214236604440355e-01   +5.463348655842019e-01   +6.355613048005323e-01   +1.321385932280876e-01   +4.052391155099410e-01   +4.059581679883653e-01   +3.362640471888377e-01   +6.505392697190621e-01   +3.872795133515599e-01   +5.591831396424592e-01   +6.130650137803922e-01   +5.186371445800050e-01; +5.836795127420491e-01   +3.462606905383172e-01   +3.743069027170627e-01   +4.522641281028506e-01   +1.816173894578584e-01   +6.261255831449883e-02   +8.802481054620827e-01   +6.668866003643126e-01   +3.766492405833677e-01   +6.783766032175551e-01   +3.199446008743226e-01   +6.436307388973416e-01   +1.344776547662341e-01   +3.852002234566466e-01   +1.766302612501577e-01   +2.333589185610500e-01; +6.093193822052029e-01   +5.763605289888056e-01   +5.056934643442899e-01   -1.300677045709582e-01   +6.960989613778068e-01   +5.727640618959979e-01   +5.084779179977316e-01   +2.464464625649966e-01   +4.820560094246253e-01   +2.010358565425814e-01   +6.666091500288962e-01   +3.130894124597380e-01   +1.443564458648854e-01   -4.892169676126803e-02   +6.276971070402853e-01   +7.793571746125755e-01];
L2I_L2E_iAMPA_netcon = [+2.277759354683371e-01   +7.217109742311762e-01   +7.177036263545340e-01   +7.256852715027408e-01   +4.272438220424323e-01   +4.717308737753382e-02   +1.000000000000000e+00   +6.954583787622736e-01; +5.630068491810459e-01   +9.572710809604250e-01   +5.197260990002414e-01   +2.624851793588530e-02   +7.783594350932420e-01   +1.491631280684777e-02   +4.025349267802903e-01   +1.554879640462156e-01; +5.020495123460834e-01   +4.223058712129790e-01   +7.541649234082993e-01   +1.679764962831494e-01   +2.302920136893503e-01   +6.223477844456400e-01   +8.739162799249447e-02   +1.733668654687684e-01; +5.251496820129936e-01   +8.080528585916931e-01   +3.314311185903298e-01   +2.573120412722930e-01   +8.283634324821315e-01   +6.388843186952424e-01   +7.111307257780782e-01   +6.532508066495746e-01; +7.764897241951054e-01   +3.864515032681357e-01   +6.203583130031646e-01   +1.660679847989139e-01   +1.843886063120290e-01   +6.137076490858896e-01   +5.218130190496355e-01   +2.577165616576149e-01; -3.778456713396938e-02   +1.395342076281769e-01   +8.652082106913817e-02   +5.077681863456011e-01   +1.748830170185480e-01   +6.584005373948866e-01   +6.932667434849599e-01   +4.311947238831734e-01; +7.789572615075522e-01   +5.004780617071732e-01   +7.740030090122592e-01   +2.833523879710514e-01   +1.973483148761697e-01   +2.185350038813406e-01   +7.766970057189829e-01   +4.489893179563876e-01; -1.824982805173812e-02   +4.265663105260777e-01   +3.076652437776220e-01   +1.658283859501415e-01   +7.668657222778806e-01   +6.674365586353654e-01   +9.286602089932101e-02   +1.531260000378439e-01];
L2E_L2I_iGABA_netcon = [+8.688645987279628e-01   +6.747068359979085e-01   +6.404296322741904e-01   +4.832835497488455e-01   +3.487688504756898e-01   +1.210072619483475e-01   +3.359022150183526e-01   +2.671774578947980e-01; +4.784593423093381e-01   +9.146217867428613e-01   +7.241594981156558e-01   +7.972924151019848e-01   +1.583925805289333e-01   +3.871356209739455e-01   +1.884549717201499e-01   +7.172231102903903e-01; +3.307031931196433e-01   +8.135173082403112e-01   +9.522707262970733e-01   +7.507287104030664e-01   +4.034003384927564e-01   +5.995934790722582e-02   +5.164299639936464e-01   +1.620980910275744e-01; +3.007647741966646e-01   +3.754896188004272e-01   +7.652443097787039e-01   +1.819587097186672e-01   +7.829336199941189e-01   +5.095291137121885e-01   +5.418081889142891e-01   -5.998168490056468e-03; +5.922329315219940e-01   +1.000000000000000e+00   +4.036046013181543e-01   +4.336095886757819e-01   +5.988098151607683e-01   +5.472750987071887e-01   +7.155173089590957e-01   +7.649993728078741e-02; +5.282697005134376e-02   +5.479318040742706e-02   -8.515032690314439e-02   +6.464993752410686e-02   +6.473206797759236e-01   +5.833331828462180e-01   +5.091512479567750e-01   +2.550725305763021e-01; +3.925876432726833e-01   +8.385066682141337e-01   -1.232297608040576e-01   +4.981415084866572e-01   +5.811748902678909e-01   +7.146180233365312e-01   +7.483151140737754e-01   +5.920741937671635e-01; +2.588413681662960e-01   +2.757560519185045e-01   +3.236523151172139e-01   +8.049448650918428e-01   +5.235802573742865e-01   +4.597220287095778e-01   +2.972139149997156e-01   +2.685813544251552e-01];
L3E_L2E_iAMPA_netcon = [+3.136297734162533e-01   +4.211603315399009e-01   +7.041241068004684e-01   +3.809158022617182e-01   +5.583529026636812e-01   +8.321514576654492e-01   +4.345996618914130e-01   +7.143120399231749e-01   +6.929565861152148e-02   +8.597012905567007e-01   +7.949063237631154e-01   +5.718274590650412e-01; +3.416826311972574e-01   +5.760817119834654e-01   +8.478090231875552e-01   +5.197703157687410e-01   +3.803222186893842e-01   +2.870983418500810e-01   +3.558068347757843e-01   +8.578122977262268e-01   +1.264710944606811e-01   +6.941200959121273e-01   +4.003125163915886e-01   +2.296616644375086e-01; +1.826368136568550e-01   -7.147053431625719e-02   +2.176842394612192e-01   +4.570401828039233e-01   +1.390773319857605e-01   +5.504396549927399e-01   +2.321790193407149e-01   +1.721789829491686e-01   +2.682774404711188e-02   +4.891368053846650e-01   +2.871222061572065e-01   +3.070467810664263e-01; +5.913952675037094e-01   +7.693648197118333e-01   +1.289060282367096e-01   +6.286445128712698e-01   +4.485530570882897e-01   +1.577359442740001e-01   +3.667104505104319e-01   +4.585415973903362e-01   +8.321266684178019e-01   +1.546805085760766e-01   +3.933940010691425e-01   +5.570589569246417e-01; +7.565899274238107e-01   -4.125105873604074e-02   +7.782202842320141e-01   +4.237335226988708e-01   +7.196588005252339e-01   +9.372545176411957e-01   +4.649333324527857e-01   +7.864042841045865e-01   +1.371173310603001e-01   +9.731977892249968e-01   +5.909745683833053e-01   +1.776804225163430e-01; +6.359062989374534e-01   +6.820140983540692e-01   -6.003099892674368e-02   +3.533440678301375e-01   +2.760990906237465e-01   +8.329783982843163e-01   +6.428791083888571e-01   -7.541432412608577e-02   +2.579989716919657e-01   +8.748884705176472e-01   +3.340342783073041e-01   +5.349868884306886e-01; +1.270719160933131e-01   +2.683865509528338e-01   +3.486916166119630e-01   -9.482960895827404e-02   +1.000000000000000e+00   +2.495960687000369e-02   +8.206308357689889e-01   +7.113732989174922e-01   +1.941423251112588e-01   +2.857101507100741e-01   -9.325355973708715e-04   +5.857688109562761e-01; +4.669325233805706e-01   +3.285974165806751e-02   +3.151350419255244e-02   +5.250473048563876e-01   +7.243699254611883e-01   +2.756524849406221e-01   +6.200822398037671e-01   +3.901204271970823e-02   +1.643406786597492e-01   +4.966722679931807e-01   +5.149708155129593e-01   +1.101979817568033e-01];
L3I_L2I_iGABA_netcon = [+8.900544778952575e-01   +5.397593782840266e-01   +6.606649167558519e-01   +9.659059895962677e-02   +3.799183603427882e-01   +6.967773760209804e-01   +5.742984414388451e-01   +4.432304000288032e-01   +4.677931118347137e-01   +5.872796454863910e-01   +4.999952445242625e-01   +7.685538991169036e-01; +5.173879241866196e-01   -5.993808847061076e-02   +1.547338074872191e-02   +6.604205061931810e-01   +2.243595176437777e-01   +4.302126802785289e-01   +3.659002622574250e-01   +2.259453327414082e-01   +7.366272677865864e-01   -1.925175024874000e-02   +7.665562800689438e-01   +1.504105216666814e-01; +3.039020705595575e-01   +4.450999163368292e-01   +7.805924122500661e-01   +8.169927035901490e-01   +9.690049065416078e-03   +4.326394531851683e-01   +1.238435229388308e-01   +6.398423883241775e-01   +4.581793576491534e-01   +4.246419229044597e-01   +9.531696529988389e-01   +8.720858656178186e-01; +1.015942559541992e-01   +3.141341535118612e-01   +8.409441560288490e-01   +3.089186530094802e-01   +5.560770819576190e-01   +6.911446471896368e-01   +3.475886328386226e-01   +5.262235137642278e-01   +3.167683097400879e-01   +2.891729292255402e-01   +1.750060772953345e-01   +5.542429889214018e-02; +1.701852291250013e-01   +3.457237650507458e-01   +1.621942929164200e-01   +4.860272892306147e-02   +5.782456542884253e-01   +2.044649060227793e-01   +5.469215497916590e-01   +3.664823290664109e-01   +2.734465559465948e-01   +7.214186524486698e-01   +8.718384112666463e-01   +7.191192781382187e-01; -5.639423944072994e-02   +7.911553376006341e-01   +3.876970056251701e-01   +3.432066728156641e-01   +1.448919682327329e-01   +9.841438183914868e-02   -8.185224120383390e-03   +4.555893315608955e-01   +2.009715040769968e-01   +5.400361161857600e-01   +6.292706672831360e-01   +6.834435273162698e-01; +5.879913396944445e-01   +6.077109477101779e-01   +7.267018534741567e-01   +3.569477691103435e-01   +4.359909806591337e-01   +3.035726712903277e-01   +3.330206162936730e-01   +4.439787263420892e-01   +4.778611490130157e-01   +6.004791055674830e-01   +4.096685547809508e-01   +7.253521957975327e-01; +5.094904588149426e-01   +1.000000000000000e+00   +4.744414138853272e-01   +1.192575028117908e-01   +5.855827080008288e-02   -6.705472331079143e-02   +8.980722059617283e-01   +7.187894591038189e-01   +7.154423367852990e-01   +5.777323754392206e-01   +2.721274677930204e-01   +6.092343682292711e-01];
L2E_L3E_iAMPA_netcon = [+1.982301880151345e-01   +2.382103321036073e-01   +3.487025990000581e-01   +7.659003765891256e-01   +6.806506324157559e-01   +1.636790582110710e-01   +1.940076404815695e-01   +5.386681636774091e-01; +4.691558755741161e-01   +7.748774124576189e-01   +9.642092654698725e-02   +6.288002002289054e-01   +1.798839224338881e-01   +5.169301349447272e-01   +1.976408004318630e-01   +6.272251052693066e-01; +9.073421565503405e-01   +3.291631448965259e-01   +5.969445819263609e-01   -2.338365148567724e-02   +8.292206764926502e-01   +1.599508753586982e-01   +3.266593091967269e-01   +3.408639902616203e-01; +4.045552011278503e-01   +6.801205250933140e-01   +8.635063083711715e-01   +4.826823556729289e-01   +7.130380441331449e-01   +4.482805949166440e-01   +5.477359488044262e-01   +6.809729948466249e-01; +2.714265128440053e-01   +3.090512714998563e-01   +9.085002401219097e-01   +7.600770784604606e-01   +4.836093056843664e-01   +2.332126276440775e-01   +8.336905576211622e-01   +2.139785661750281e-01; +2.557782247307444e-01   +6.350585924983212e-01   +1.361183119282233e-01   +8.557447346597170e-01   +5.445712188902890e-02   +6.548720794520719e-01   +1.524235149178725e-01   +8.043837818665479e-01; -1.179488120592760e-01   +6.605497360645483e-01   +5.051629389779464e-01   +1.662546836915414e-01   +3.377128641636928e-01   +1.241800837850797e-01   +8.340304806217593e-01   +7.214410519519288e-01; +4.115252792668722e-01   +8.378337981964852e-01   +1.621414505319687e-01   +7.923383492697975e-02   +4.287733965216229e-01   +5.132810725971424e-01   +7.051266795086540e-01   +8.856663774159949e-02; +4.664308334997720e-01   +8.859791740614396e-01   +6.842679132118140e-01   +8.643451153999898e-01   +3.629688151106540e-01   +6.266562250447982e-01   +5.344299538575435e-01   +8.333715311915288e-01; +6.326040272517548e-01   +1.399829761004296e-01   +2.407813445166588e-01   +7.523875343364974e-01   +3.800473547819964e-01   +1.051050262618272e-01   +9.278108121049796e-01   +6.885060884971697e-02; +2.879191752091518e-01   +4.960636426795796e-01   +2.823223408595712e-01   -1.783607279784146e-01   +3.652792777624244e-01   -4.335325648034272e-03   +6.567007133212650e-01   +8.145315111282988e-01; +5.007770294705166e-01   +3.907303512171922e-01   +3.063307539061319e-01   +1.000000000000000e+00   +9.943710599777346e-01   +1.434858435442238e-01   +2.945933975727734e-02   +2.771448139317701e-01];
L2I_L3I_iGABA_netcon = [+5.675197993323837e-01   +1.705585540127555e-01   +1.422121839053258e-01   +9.957832119763812e-01   +6.949586617253993e-01   +2.357503333520256e-01   +9.206547859251281e-01   +1.615051946355470e-01; +5.393719575356283e-01   +4.454092366134390e-01   +2.319747916709988e-02   +9.165521174100785e-03   +5.337053317436727e-01   +8.194525427478192e-01   +9.801110423071081e-01   +4.355231792253940e-01; +4.607616001782450e-01   +6.566715178679394e-01   +1.508713962500850e-01   +1.000000000000000e+00   +3.043134660944926e-01   -2.251875175743856e-02   +5.930882690460606e-01   +6.876373503131018e-01; +1.488227440663038e-01   -1.242283776865884e-01   +6.641025356628042e-01   +6.708951682271898e-01   +7.546257585109061e-01   +1.732270870529271e-01   +7.157512767292971e-01   +4.415732701682049e-01; +4.111755848729147e-01   +7.280819320995501e-01   +3.802824409263243e-01   +8.668786171138189e-02   +3.282038945766854e-01   +4.881255772659082e-01   +8.685884520230303e-01   +7.431328322301999e-01; +1.240225358287221e-01   +5.123566660145714e-01   +3.092373281492782e-01   +5.059033007443710e-01   +3.448221816059547e-01   +6.871453128893732e-01   +1.565182473203011e-01   +4.847937251726759e-01; +8.879715742633121e-01   +2.813720927875260e-01   +4.105255076871739e-01   +7.964864509212425e-01   +3.363411657751021e-01   +7.816303916534716e-02   -2.907909720699762e-02   +5.039854431781174e-01; +7.415971538844054e-01   +6.910366035587381e-01   +7.920011902563951e-01   +3.319006590879085e-01   +4.461943527399568e-01   +8.710236913614772e-01   +3.918560694368217e-01   +2.130199286156068e-01; +3.869192767849138e-02   +1.537629875772078e-01   +3.792966366048490e-01   +2.587015863158152e-01   +7.714462212020492e-01   +7.524550468174407e-01   +6.966605906540538e-01   +4.927121977909997e-01; +8.173101616129917e-01   +4.528926209416767e-01   +8.850037914271401e-01   +1.495203069890116e-01   +3.024528012251560e-01   +2.883706899031445e-01   +1.296926979560015e-01   +1.938109969196018e-01; +5.673548675028476e-01   +7.568510630381916e-01   +3.010734133061413e-01   +7.785078127834155e-01   +1.398384900375841e-01   +2.964294108635249e-01   +3.288698948431267e-01   -6.209555094794703e-02; +4.425854308417736e-02   +4.231013267229908e-01   +2.932134706285032e-01   +4.763506014483758e-01   +8.712987625347081e-01   +8.503479806669181e-01   +9.737565156362434e-01   +1.313812915401435e-01];
L3I_L3E_iAMPA_netcon = [+5.392230894604855e-01   +7.233218029115565e-01   +2.307543900825048e-02   +5.109392072152239e-01   +8.781232091227121e-01   +1.320513919190623e-01   +5.751274358223690e-01   +4.786831290553221e-01   +2.430137987663162e-01   +3.006904071856290e-01   +3.840519901278915e-01   +6.015433566413027e-01; +5.098531203950599e-01   +7.171108605669910e-01   +7.135365363799795e-01   +2.803655971194864e-01   +1.355854935855669e-01   +4.995193515992177e-01   +8.111549832832027e-01   +9.668292658997327e-01   +1.991806427495675e-02   +7.361801110069738e-01   +4.004188749706448e-01   +7.223631615016513e-01; +4.941237243132043e-01   +5.964896033772328e-01   +5.286885462031656e-01   -1.446976949027929e-01   +6.784622346978624e-01   +6.092804589025751e-01   +4.801531133866231e-01   +8.754162221066832e-01   +5.350438129677264e-02   +5.220525326127786e-01   +1.000000000000000e+00   +4.881917485961746e-01; +6.836339984706964e-01   +4.699898598540862e-01   +4.358266796982199e-01   +8.739285342709838e-01   +8.663609180380425e-01   +8.027224047654218e-01   +7.455487331757624e-01   +7.111403059488567e-01   -6.474926714900089e-02   +7.105685375543667e-01   +3.485951900241392e-01   +6.604951512890578e-01; +7.366342087771391e-02   +2.694787822693911e-02   +3.017418335097469e-01   +1.101370337713088e-02   +4.704140346641529e-01   +9.084714697180855e-01   +7.084164644038814e-02   +6.531689063228867e-01   +5.073267942844141e-01   +4.042943640054054e-01   +7.560662970544686e-01   +3.475400387664853e-02; +4.076905028764986e-01   +7.270630347564251e-01   +1.811878517120241e-01   +8.043270736813408e-01   +4.547874070879651e-01   +1.757280846483357e-01   +5.833268818404280e-01   -1.014701108067628e-02   +3.819537297936181e-01   +2.188124334039704e-01   +4.039090686532291e-01   +4.692727582283913e-01; +4.971782861155324e-02   +3.106157044838780e-01   +2.993914363389348e-01   +3.869428447213668e-01   +8.911314683515353e-01   +1.873457440614244e-01   +5.417977081856546e-01   +8.486528016673145e-01   +3.372106227005560e-01   +2.774463181929142e-01   +5.828018570863301e-01   +4.316394666544016e-01; +1.252270541341338e-01   +6.230004344017771e-02   +1.763086225615984e-01   +8.979092570541736e-02   +7.433183819274368e-02   +1.451123163164849e-01   +4.365790476485754e-01   +4.355712257429234e-01   +1.769001887155782e-01   +8.766745305901957e-01   +2.748285014120957e-01   +2.954734003633742e-01; +2.621517956734790e-01   +2.742341895060978e-01   +5.452145710331059e-01   +5.591914867415412e-01   +3.610111048579959e-01   +1.338867578345258e-01   +3.464031067101878e-01   +3.746003701631270e-01   +5.401163679775423e-01   +6.887020494334452e-03   +2.161337991708833e-01   +3.284955997482668e-01; +5.718969035703830e-01   +7.397129778333297e-01   +5.903730379242323e-01   +4.944647353973947e-01   +3.458888101828689e-02   +3.145135472176807e-01   +7.970953764396590e-01   +5.905589329274530e-01   +5.094009044881692e-01   +2.268897881382690e-03   +5.801768279383045e-01   +2.624051221220181e-01; +3.200048787705852e-02   -1.324504544404025e-02   +5.243578243677851e-01   +9.115474619276685e-02   +2.763808469409444e-01   +5.731518625219488e-01   +2.911548578688918e-01   +2.474492886117958e-01   +8.931261477115200e-01   +8.347825968610195e-01   +1.305853792458366e-02   +8.786099383619139e-01; -1.107486728677514e-01   +3.049148409443559e-01   +4.741435474204261e-01   +7.322434154179492e-01   +9.529316330553170e-01   -2.831030659764560e-02   +2.000841019241463e-01   +5.097914964773702e-01   +6.805497022860442e-01   +4.481047568932947e-01   +4.425224004065462e-01   +5.027431479926334e-01];
L3E_L3I_iGABA_netcon = [+6.469199895056147e-01   +1.767832019371273e-01   +3.266783651863566e-01   +8.262387877275056e-01   +4.988261806103708e-01   +9.681033722849498e-01   +8.454098129220803e-01   +6.546228612632412e-01   +7.083234245896344e-01   +2.221315850832897e-01   +1.502860283718029e-01   +5.731076185197304e-01; +5.035225931298156e-01   +3.635721452186918e-01   +7.669444414943046e-01   +4.996971563819821e-01   +7.125590218617507e-01   +6.061038317915992e-01   +9.642779468291125e-01   +1.927747072575174e-01   +6.225335616371495e-01   +2.984568650154720e-01   +2.684770851678028e-01   +3.524586777032421e-01; -1.030643799893104e-01   +1.671625822242321e-01   +1.094367571090384e-02   +5.190718632913375e-01   +4.267997048358990e-01   +6.311835982027022e-01   +7.502743460490977e-01   +6.623527598454715e-01   +4.963332858371397e-01   +5.478087989704661e-01   +5.895361492256386e-01   +4.448797480704791e-01; +6.361970047469211e-01   +8.954206086049404e-01   +7.618965148110985e-01   +1.762155088152513e-01   +8.397201080041982e-01   +2.170423531992861e-01   +5.457565877971365e-01   +5.429355903233269e-01   +5.758415623627040e-01   +1.879348525576765e-02   +7.247896048299188e-01   +6.351168943305239e-01; +1.583976471672892e-01   -1.208835637487736e-01   +3.540572823175762e-01   +3.891431253767100e-01   +4.258827922082221e-01   +3.019643038753623e-01   +6.513800687278462e-01   +3.876739951384711e-01   +4.680370222774488e-01   +1.917558779871240e-01   +4.283753482299145e-01   +8.723424852905166e-02; +2.603902808922287e-01   +1.324471696221435e-01   +7.723130970656737e-01   +7.914570245301779e-01   +3.966381384248309e-01   +1.383188645147593e-01   +1.152602348090147e-01   +2.976834142275609e-01   +4.470284324583352e-01   +8.952476769687924e-01   +7.347417040937254e-01   -3.823893270399337e-02; +3.201195621393978e-01   +4.679137963285596e-01   +8.088502431198207e-01   +2.829171131831945e-01   +5.149173820651926e-01   +7.250080997999218e-01   -1.935019711649324e-01   +5.556959738037990e-01   +7.022360028852175e-01   +4.442082584863185e-01   +4.955311527942524e-01   +4.838007854472236e-01; +5.176192895499374e-02   +4.025751214985904e-01   +1.078954246181526e-01   +8.680092305857571e-01   +7.444239677618270e-01   +2.978792570219934e-01   +4.429861695603714e-01   +1.912700378141054e-01   +2.855625482154479e-01   +3.238481106049402e-01   +4.758664579455201e-01   +9.810588390993367e-01; +4.526320866606487e-01   +8.538268840048223e-02   +6.064805717665351e-01   +6.302306079742068e-01   +6.626258458316610e-01   +4.604577833844903e-03   +3.809571875402714e-01   +7.129653726591121e-01   +3.290955550982702e-01   +1.615287897517107e-01   +4.542215952667615e-01   +6.836014398784506e-01; +1.317398449962169e-01   +6.615709586766129e-01   +9.039991993713913e-01   +7.287289831974858e-01   +3.391411209589120e-01   +2.797949810764586e-01   +6.623141574847629e-01   -1.260046815071304e-02   +1.000000000000000e+00   +6.819435615219547e-01   +4.310613382904900e-01   +9.731779460082425e-02; +1.067175009331581e-01   +7.569987069855465e-01   +2.756162213070821e-01   +5.605210002564298e-01   +7.696023045229655e-01   +3.763242585618531e-01   +7.110033637482268e-01   +7.838240463560405e-01   +5.273420357027012e-01   +5.374858218562674e-01   +1.994793779130891e-01   +8.415551785914154e-01; +6.835587065987259e-01   +1.340149200342973e-01   +5.845520734629628e-01   +7.525493592424420e-01   +6.716102982268324e-01   +7.617997610665457e-01   +4.137810354998420e-01   +4.149783980830436e-01   +6.623489969041306e-01   +4.232059657268222e-01   +1.823638700793813e-02   +1.792677525594733e-01];
L2E_Input1_iAMPA_netcon = [+9.796663600625944e-01   +8.891868600114536e-01   +9.660898683813612e-01   +9.659759673067392e-01   +9.978399913742525e-01   +7.995106149259524e-01   +9.485339783926771e-01   +8.189058691238583e-01];
L2I_Input2_iAMPA_netcon = [+9.405147051898601e-01   +9.404616637855916e-01   +8.342076447041452e-01   +1.000000000000000e+00   +9.594358246035540e-01   +9.362134092971557e-01   +8.102687573680595e-01   +8.696341666741781e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
