function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.907666974227734e-03   -4.944428830580465e-03   -4.133188671676063e-04   +2.310049734249778e-03   -3.040010116498000e-04   +5.057155040871807e-03   +8.498541990101470e-03   -3.872011998670728e-03   +1.494573030853567e-04   +6.666026261455011e-03   +3.382668729621928e-03   -2.257016324467126e-03   +8.553729356703683e-03   +3.567576168954169e-03   +6.280741783850768e-03   -1.930220996983337e-03; +4.450613797642771e-03   -3.119923215181043e-03   -4.430496918877719e-05   +6.658653763784963e-03   +3.094154789890684e-03   +2.660466676741450e-03   +8.549023897418406e-03   -2.949683045190526e-03   -1.802186795638329e-03   +8.882416169865693e-03   +2.799572985265263e-03   +1.658774231442153e-03   -5.195465189857641e-03   -4.804832998782777e-03   +6.365947808290705e-04   -7.042756709799158e-03; +4.299603456575870e-03   -1.462957432833272e-03   -2.978705864963277e-03   +5.865194498642561e-03   -2.343526430159702e-03   +5.755197127259418e-03   +3.892325922737183e-03   -4.387172740744623e-04   +6.417263373573049e-03   +9.376497267794288e-03   +2.566797523583303e-03   +3.872763558489691e-03   +6.371061019455754e-03   -6.111913072800844e-04   -1.604332299197820e-03   +1.240293164736197e-03; +1.584405460701682e-03   +7.360880128238867e-04   -1.069195511142410e-03   -3.369907334233529e-03   -1.136711537567342e-03   +7.443885076047489e-05   +1.550899716169557e-03   -3.864976789948633e-04   +3.555012695838747e-03   +6.350212310121517e-03   +8.958491028117601e-03   +3.803538374433839e-03   +2.820973178296897e-03   +1.551037079064911e-03   -6.533303951736302e-03   -6.215921776615802e-03; +4.026947093209230e-03   -1.337605084441207e-03   +4.452875832791504e-03   +5.715684007619669e-03   +1.047022923704658e-02   +1.016030440460497e-03   -5.599432027126833e-03   +5.641210048583301e-03   -3.852386985853025e-03   +8.205304313434407e-03   -1.559864250787972e-03   +1.593574827546494e-03   +6.103700371123123e-03   -6.766294269258868e-04   +3.491874426301236e-03   -1.216934679488835e-03; +5.684784447895759e-03   +1.267750792342031e-03   +5.505560235966462e-04   +3.348710570146926e-03   +2.047735985960156e-03   -2.785258782257024e-03   -3.556744282522969e-03   -4.340482113049052e-03   +2.277633804001590e-03   -6.545835834156252e-03   -1.496988779772932e-03   -3.693858275310406e-03   -5.226010461544857e-03   +1.247229354835670e-03   -2.378413439644203e-03   +3.151435519863411e-03; +9.438810342633141e-03   +2.031643613381695e-03   +1.823276677625012e-03   +8.846050938644842e-04   +2.965018450530154e-05   +6.724865319155642e-03   +2.639459892197021e-03   -2.720018010336818e-03   +6.818427754671228e-03   -4.192274197629240e-04   +5.586696145286003e-03   -2.817867456864568e-03   -2.928080140992692e-03   +8.822407704380143e-05   +3.117757207365302e-03   -3.243009823255301e-03; -5.020775189098103e-03   -5.945360054814285e-03   +4.591027302583544e-03   +2.407065800679090e-03   -1.693736046621180e-03   -1.495251515000712e-03   -2.448972815438350e-03   -1.556343694468610e-03   +5.286802696473521e-03   +1.832145358641861e-03   +8.084157618166022e-03   +8.906501735348781e-03   +2.989251041725542e-03   -9.489850159526796e-04   +3.178651300739081e-03   +3.539604686124841e-03; -1.719672623516178e-03   +6.686661869855590e-03   +1.223898516388517e-03   +2.404589911980871e-03   -8.129012434612943e-03   +6.513502491554073e-03   -1.827825777332985e-04   +6.112306549722630e-06   +3.077979242940132e-03   +7.693190609213042e-04   +3.882789121445501e-03   +8.685211337062348e-03   +4.153900552046573e-03   +3.816753335269106e-03   +1.993276378581847e-03   -1.838082494495550e-03; +1.892014037331916e-04   +9.626102122581137e-03   +5.899199203399374e-03   +2.322983874256953e-03   -4.063089993666329e-03   -2.669008794862535e-03   +3.606484737179708e-03   -7.946790605030309e-05   +1.029091319234479e-02   +1.023830415974555e-03   -6.741858934193180e-04   -1.668474481791642e-03   +5.371177722891386e-03   +7.159164714642612e-04   +4.956308959510793e-03   -5.933928294298133e-04; +7.044828972700404e-03   +8.582821144782840e-04   +2.303961598241133e-03   -1.482016353735642e-03   +5.527701565809561e-03   +3.264856400713053e-03   -5.680571189548218e-03   +4.446017233594229e-03   -1.332549812584385e-03   +1.088396130924445e-03   +8.772942965169728e-03   -3.770520643358003e-03   +8.188887558430814e-03   +1.163091238358796e-03   +2.935611827073954e-03   -1.068260075323119e-03; +3.001731996952143e-04   -4.630319727283454e-03   -5.565072198997829e-03   +2.697281910998847e-03   +3.914273505054982e-03   +5.958103769834731e-04   -3.258972482951325e-03   +2.344182020229432e-03   +3.851872047148069e-03   -3.099889089831950e-03   +4.189843866616817e-04   -1.373843917461763e-03   -4.543558663017440e-04   +1.563678032504470e-03   -2.111092065547774e-03   +4.074451439726286e-03; +8.705516478562179e-03   +3.996953402993334e-03   +5.911957074343492e-03   -1.750717515314571e-03   -1.213765692127311e-04   +1.082195271347408e-03   +6.678722144632475e-03   +7.925096356840858e-03   +8.471304820117185e-03   +1.180560460208019e-03   +3.643585008862784e-03   -2.132306583051698e-03   +3.746535240677275e-03   +1.225693699832488e-03   +4.638134864173440e-03   +3.379083150863509e-03; +1.050273247530256e-02   +8.266940106983174e-03   +5.283845121168251e-03   -1.808220326053483e-03   +3.105577179633731e-03   +3.280691383917607e-03   +1.900635661624777e-03   +1.031839100491050e-02   -3.995572583237466e-03   +5.607216549604418e-04   +2.228743325699606e-03   +6.898244067243532e-03   -7.118792355241045e-04   -5.704652122708463e-04   +5.409014179814940e-03   +2.427891207898550e-03; -1.987212167090596e-03   -3.398241558572131e-04   +1.317896521745662e-03   +3.842883193492105e-04   +1.152735482206132e-03   -1.430873086870855e-03   +4.779350119460825e-03   -3.077733690113191e-03   +4.055611487752337e-03   +7.229401841824117e-03   -3.794454058868422e-03   +7.875377261422886e-03   -8.055361834467475e-04   +3.133784137295869e-03   -2.173447296715648e-03   -7.316216647788758e-03; +6.699330258472715e-03   +5.336847943285294e-03   -2.065805634853356e-03   +9.207267387864839e-03   +1.037131864890333e-02   +4.460917481909598e-04   +3.991265644761466e-03   +1.197821096163576e-03   +6.069895020729430e-03   +8.444430374358779e-03   +2.462615094896050e-03   -4.976849074075056e-03   -2.271980694831875e-05   -4.602891790764791e-04   +4.687877831030956e-03   +3.132026579084715e-03];
L1E_L1I_iGABA_netcon = [+4.017989111479102e-03   +8.761474558281707e-03   +5.390720254736615e-03   +7.117964287811645e-03   -1.683851940682934e-03   +4.314755242729913e-03   +1.276997862072410e-03   -5.978804608031734e-03   +7.996686408111204e-03   -2.525147899817659e-03   -1.385395863116095e-03   +8.685354849855748e-04   +9.040216238223896e-03   +2.232823528138752e-03   -4.221835195686662e-03   +6.368852182051965e-03; -2.752520462855424e-04   +3.700556154545216e-03   +9.145535403792648e-03   +4.741304214197103e-03   +2.629483763112908e-04   +1.608201279015633e-03   -3.261102659828631e-03   +5.092031762041460e-03   +3.807335864496182e-03   -7.707901685662388e-03   -5.430931523428509e-04   +8.310578094107622e-04   +1.357910478790816e-03   +3.859814842264866e-03   -1.168608099667070e-03   +5.466195943721542e-03; +1.116621248552786e-02   +2.258337046803004e-03   +5.630956805152273e-03   -2.745637690965089e-03   -2.431657254976651e-03   -1.788997402710889e-03   +4.252672173917999e-03   +1.226134606833190e-03   +3.300431014885683e-03   -2.687662431310808e-03   +9.183889437029422e-03   +1.847684126171736e-03   +1.406444135859161e-03   +7.445393435878340e-03   +6.332199018589581e-05   -5.790997153834753e-03; -4.973735100242078e-03   -1.564222335278940e-03   -1.252850954388310e-03   -2.833822289919192e-04   -3.753694946258827e-03   +3.679451629032308e-03   +1.826160288383176e-03   +1.204752559858379e-03   +3.549791998063690e-03   -3.818396525053310e-03   +9.448789590014873e-04   -2.316056076576377e-04   +1.068333169158019e-03   -4.810090510920554e-03   -1.323892646851473e-03   +7.628391399346783e-03; +6.746870537629778e-04   +1.303025159933239e-03   +4.878944347827997e-03   +1.160725863507629e-03   -5.729960053574316e-03   +5.370712273483256e-03   -3.558992064782403e-04   +8.741387979307264e-03   -5.837092060576341e-03   +3.829975926390360e-03   +1.355685550537123e-03   -4.778742461969337e-03   -4.030109306771212e-03   -2.651359654183577e-03   +6.787039429675768e-03   +3.991195277542610e-03; +4.910612045535162e-03   +4.915011790677986e-03   -2.302763922939390e-03   +3.339446544016570e-03   -2.104351328984714e-04   -5.166670945760590e-03   +6.820235810982161e-03   +2.001221093038202e-03   +6.924659118198279e-03   +1.864787322800199e-03   +4.411178625052959e-03   -1.227958498844269e-03   +1.859008120398629e-03   -4.570085715678837e-04   -2.550403280428400e-03   -5.610395594122977e-03; +3.600131036109502e-03   +4.668554203577682e-04   -2.186512180014192e-03   -1.961835699369522e-03   +4.010268594351132e-03   +2.593710252300990e-03   +4.771864914398059e-03   +4.083235830897871e-03   +3.902664503994886e-03   +4.438481745928787e-04   +1.128004381907284e-03   +7.019766173154481e-03   +7.753522161161615e-03   -8.179048800494551e-04   +2.462272850486734e-04   +3.503843008615265e-03; +1.120380801718191e-03   -3.552059058407151e-03   -4.105531182866157e-03   -5.497021694614520e-03   +3.240732434225728e-03   -1.180903069174178e-03   +5.989368672960023e-03   +2.158911171155203e-03   -6.676332602795886e-04   +4.614773228902586e-03   +2.677514421012021e-03   +6.589541516664586e-03   +2.739754775727985e-03   -3.492434150781505e-03   +1.564577735836710e-03   +4.800093300059772e-03; -6.156943566627501e-05   +5.275115734557222e-03   +4.845144017402710e-03   +2.480977403290115e-03   +4.652646755260526e-03   +5.238619473194980e-03   +4.845667025079522e-03   +2.382150481894059e-03   +3.463780084049431e-03   +3.461675587401927e-04   +1.243951584315407e-04   +3.871718319949148e-04   +3.678564304360639e-03   +4.807839329914066e-04   +1.764450628978118e-03   +2.227821915486491e-03; -2.735836680596030e-03   +6.365704786476037e-03   -1.543987456731049e-03   +9.661952006057774e-04   +5.392601202762391e-03   +1.532412574824381e-03   +1.429620468869898e-03   +3.101948757420793e-03   +1.006854184250184e-02   +3.494391378199735e-03   +2.163032778443396e-03   +1.907582303429428e-03   +2.712264963542236e-03   +6.483278864181583e-03   +5.856989611223455e-03   +1.277938197252477e-03; +3.752601611594132e-04   -5.572469020785953e-03   +1.791872446006266e-04   -4.890898393895038e-03   -9.712645058267425e-04   +1.726097831663366e-03   +5.515955322784575e-03   +9.066586407049012e-03   -1.494859714350404e-04   +1.355348417427586e-03   +4.013228423836589e-04   +3.285974249514053e-03   +1.707181903073529e-04   +1.231777881888285e-03   +3.752811282375921e-03   +2.173953183963644e-03; -5.569690882005753e-03   +8.855970543981176e-04   +2.931177539330916e-03   +3.187485263870396e-04   -3.533934986031825e-03   +2.725613776117869e-03   -7.044080275215314e-04   +7.843784454980579e-03   +2.794229366395116e-03   +2.708537379431219e-03   -3.908883441725909e-03   -7.705911794304665e-03   -7.732811884037217e-03   -1.516068236411246e-03   +1.206453472945046e-03   -1.443279951028217e-03; +1.206849811040238e-03   +3.274908850164282e-03   +1.777250723140975e-03   +3.746917136501660e-04   +2.228642838920645e-04   +1.534969726232230e-03   +4.297938884849276e-03   -3.187750790248478e-03   +4.815762651551963e-03   +6.318828760046801e-05   +3.451490804237011e-03   +4.622529321516599e-04   +1.230131821704548e-03   +1.669924265129680e-03   +7.867258128914501e-03   -5.107982679621066e-04; +2.657037620855365e-04   +7.678394227299860e-03   -1.349197423971226e-03   +1.660483022260348e-03   +4.729211669413372e-03   +8.745380160674198e-03   +7.467421111934507e-03   +9.847942653925423e-03   -1.507959689121055e-03   +2.960177629042497e-03   +3.054727793239025e-03   +4.476121224421072e-03   +6.778001976123905e-04   -1.652428794431899e-03   -2.696595073017291e-04   -2.337080380981571e-03; +3.402817868279184e-06   -5.840281061893157e-03   +1.747297701878283e-03   -1.613584341350347e-03   +2.187933741320690e-03   +6.566714971172070e-03   +3.923910540735246e-03   -1.241192503943952e-03   +2.849198493548783e-03   +3.671553730797384e-03   -2.237189214667086e-03   -1.670640776181264e-03   -3.787851963309397e-03   +2.054484303416691e-03   -2.412807417580486e-03   -2.811213325461394e-03; +2.540802979180332e-03   +5.377750642813142e-03   +3.930006860663228e-04   -3.757054912185907e-04   +3.937498223743666e-03   +1.156310515266078e-02   +9.471566594731087e-04   +2.006393803495548e-03   -4.580269827504880e-04   -2.454098507342618e-03   -2.908006984452662e-03   -3.076160077278810e-05   +1.059120417004354e-03   +8.917203403657009e-03   +1.781226476061092e-03   +1.158052024666514e-02];
L2I_L1I_iGABA_netcon = [+2.091072077148929e-03   -2.944393335057408e-04   -6.693420433035492e-03   +4.337351495069336e-03   +6.724599189727886e-03   +2.738284730173085e-03   +1.921045649872351e-03   +5.119566367096241e-03; -2.340942948000343e-03   -9.759353055245495e-04   +5.326373320602096e-03   +7.225738832260796e-04   +1.963527183131903e-03   -3.072924109795234e-04   +2.631680248167004e-04   -2.393079809488090e-03; -1.945142502191297e-03   +4.457856491541244e-04   -2.802361499666866e-03   +5.802488422231467e-03   +1.797077149627430e-04   +1.020853494139910e-02   +5.132224994891564e-04   +2.364519518663732e-03; +3.090714075479491e-03   -5.408200842375942e-03   +7.017956146520625e-03   -2.871027965893345e-03   +1.421534562227320e-03   -2.618804107101259e-03   +1.400091422644151e-03   +1.707300582589667e-03; +2.608101216520683e-03   +6.439777480446956e-03   +7.703658824657788e-03   +1.523538076736000e-03   +4.175359676101326e-03   +6.911995596804029e-04   -7.918412741167429e-04   +1.010195944886305e-03; +2.628679456048952e-03   +1.782531093057000e-03   -2.698596644600725e-03   +4.374597297031158e-03   +2.117450006622213e-03   +4.136983556319019e-03   -1.290937829499784e-03   +5.428055216071031e-03; +9.569484729610228e-04   -6.859101376900076e-03   -1.188642795343582e-03   +7.689243051085903e-03   +2.225151375932775e-03   -1.448815116044854e-03   +2.550352420913476e-03   -2.269579242010963e-03; -1.109398721621788e-03   -1.161527437999741e-03   -3.625670168786200e-03   +2.748718186826571e-03   +4.104553901087955e-03   +8.170197991559658e-03   +7.283969336252376e-03   -2.274209614444320e-03; -1.639279347773223e-03   +4.290048954677338e-03   +7.300659916149981e-03   -2.064547133476630e-03   -1.265260187811457e-03   -1.199773136260564e-03   +2.523045261286690e-03   +8.112190659184724e-03; -3.819043320326902e-04   +4.195844166332030e-03   +6.554306857944618e-03   +2.438775924846682e-03   +1.645849777617791e-03   +2.000311688080298e-03   +2.299537281705258e-03   -1.515223872509844e-03; +1.251409751388702e-03   -6.980403666856168e-04   +5.145808676637606e-03   +4.288942689429302e-03   +2.103331784254419e-03   +6.152905163958653e-03   +5.045306653751444e-03   -2.838301444886028e-03; +7.379091873522988e-03   +4.828288603895971e-03   +2.671670758316147e-03   -1.136678554465470e-03   +3.005822258362188e-03   +2.192008301725006e-03   +2.183229349249607e-03   +4.736746081876318e-04; -8.120614654574699e-04   +5.162160607443195e-03   +6.969798724109142e-03   -4.259583652466731e-03   -3.682647712733711e-03   +4.590236762733590e-03   +5.634954170041452e-03   +2.586913589287003e-04; +9.585936434097727e-04   -2.666196288531660e-03   +1.803423740128606e-03   +1.260842710375487e-03   +5.769137852594123e-04   -1.555482214914543e-03   -2.316367671380212e-03   -9.686808101045547e-04; -2.276787157119442e-03   -3.081000491000595e-03   +4.306513328038165e-03   +3.140467807555492e-03   +1.587754079112152e-03   +3.823388664216935e-03   +6.385381366541668e-03   -1.823482958461901e-03; +6.113467968054110e-03   +7.248529616012468e-04   +5.964797128762970e-03   +8.233977833810049e-03   +5.058437109556151e-03   -4.559795532559125e-03   -1.265035732944068e-03   +2.855589746088487e-03];
L1I_L2I_iGABA_netcon = [+2.608639904161556e-03   +2.049561881217204e-03   +6.542166119119443e-03   -2.235111960489080e-03   -3.955241845270482e-03   +4.475014815257548e-03   +2.102893688261896e-03   -2.325434493833255e-03   +5.969413643202687e-03   +1.218368106304016e-02   -6.540853715205333e-03   +1.151573856951895e-03   +3.623969038033775e-03   +7.418019922364742e-04   -3.767993885181126e-03   +3.012036114341502e-04; +1.225035690096119e-03   -4.340462699840817e-04   +4.497471295224062e-03   +2.214654288279461e-03   +4.641252102143179e-03   +5.447816710867895e-03   +3.844806776665584e-03   -6.290286900309102e-04   +6.210929351804462e-03   -3.918189473196223e-03   +3.567460919557820e-03   +3.578360523265096e-03   +6.739471468377053e-03   +1.012973693395677e-03   -3.025983542996834e-03   -2.523120550236219e-03; +7.772720913270539e-03   +2.078346086178217e-03   +1.212171071651816e-03   -8.440404161673612e-04   +1.188466684159744e-03   +4.506146031156432e-03   +2.037091665807876e-03   +1.813059358701226e-03   +2.653247328427903e-04   +5.287668707772728e-03   +6.225684368344106e-03   -4.713596750580069e-03   -2.780991931701039e-03   +8.819113399080383e-03   -1.900385268973676e-03   -8.909742099655474e-04; -3.187009821715853e-03   -3.036716976669882e-03   +7.331025415387493e-03   +5.665939923784735e-04   -8.060479615352965e-03   -6.761960388520459e-03   -2.637349128065814e-03   +4.785203299629016e-03   -2.188351341960668e-04   +7.120827047267235e-04   +4.177656430742773e-03   +2.021385123220291e-03   +5.556682232720531e-04   -6.219400716691846e-03   +3.070339154061651e-03   +5.448338347011311e-03; -3.182569963828682e-03   +7.154613301371415e-03   +1.283335740974189e-03   -8.469242104382207e-04   +4.283688492394636e-04   +2.365130425846395e-03   +2.978186660760958e-04   +8.471594069562868e-03   -6.676877830499535e-04   -1.011657482295392e-03   +2.948371039979618e-03   +1.546492927085378e-03   +7.520259575627054e-03   +1.164004344735476e-03   -2.920134790775773e-03   +7.765501852499806e-04; +6.015916263739752e-03   +1.143902131857303e-03   -1.953328141100537e-03   -9.787866285219122e-04   +1.237146861838960e-02   +3.263924241430367e-04   +5.729182184556689e-03   +6.978195507440709e-04   -5.345050631968416e-03   -2.892994997106108e-03   -1.031097827488105e-03   +7.479531043204195e-03   +3.198263580234395e-03   +3.581435910192258e-04   +7.830552767214258e-03   +3.389544335225398e-03; +3.892051934573267e-03   +1.020458928274859e-02   +4.931048997113848e-03   +3.729176937199095e-03   +3.028964693464523e-03   +2.837433343630897e-03   +4.484748524708133e-04   -2.724351763299608e-03   +7.483759189180865e-04   +6.290041021856221e-03   +3.451927225936439e-03   +5.523784942104949e-03   +1.660703242101557e-03   -1.216935537892768e-03   +3.784727867254879e-03   -3.290348049066744e-03; -2.670863014458011e-03   +5.276937555681017e-03   -8.667782010300879e-04   +5.866576191844142e-04   -5.194595834090992e-03   +3.341611665890045e-03   -4.290099185191095e-03   +7.101958917388806e-03   +2.097692232850853e-03   +3.389211751456901e-03   -1.554179037253773e-03   +1.781791589073595e-03   -2.979211372555519e-03   +1.579714022132697e-04   -3.308794303037948e-05   +3.697968382858543e-04];
L2E_L1E_iAMPA_netcon = [-3.590736570002956e-04   +3.375564132675530e-03   +5.232620100447229e-04   +4.681322219110395e-04   -1.932551783513340e-03   -4.222150656997505e-03   +1.245732621435875e-02   +8.834801390596307e-03; +5.345547312364959e-03   +1.901280041730556e-03   +1.635255314265749e-03   +5.084520313105426e-03   +7.878407418785194e-03   -3.965115521648925e-03   +3.594935349795290e-03   -5.755182344884691e-03; -2.953422928209814e-03   -1.282734093011450e-03   -2.060993749325627e-03   +2.849737383142610e-03   -4.658390408111860e-03   +4.016995947733875e-03   +8.140825899590582e-04   -1.896279572578654e-03; -5.080516858675263e-03   +2.814285905055542e-04   -1.938423720184269e-03   +2.079782747328275e-03   +7.517795514368175e-03   -2.523803778323374e-03   +1.845885680561068e-03   +4.825524414893883e-03; -1.097212414500936e-03   +5.810386067365196e-03   -1.070015007329692e-03   -1.521878968520655e-03   -1.771954544657923e-03   -6.283908555128311e-04   +1.959321112749949e-03   -5.940120606089680e-04; +5.558973629013900e-04   +2.352044929583129e-03   +6.134169443938631e-03   +3.498856332522406e-03   +2.647007239384328e-03   -2.346583565001884e-03   +3.791788294473094e-03   +3.149134658417021e-03; +1.871032659702850e-03   -2.719584498395809e-04   -4.280349635301396e-03   +5.030071524868417e-03   -9.791506383914769e-04   +6.953439171622870e-04   -4.061903583206150e-03   +9.096816367856610e-03; -5.226953048762820e-03   -3.577850643511233e-03   -3.843120514108881e-03   +1.745450935583435e-03   +3.402788677291441e-03   +8.584119261822766e-04   +7.802816633478612e-03   -3.448914877025818e-04; -9.422528460737796e-04   -3.437699021324726e-03   +4.405742636018443e-04   -3.803256973085698e-03   -9.423350037446307e-03   +1.049953404489356e-02   +1.470543719408604e-03   +4.993891594886292e-03; +5.013109970817398e-03   -3.491161025064030e-03   -4.740253427514929e-04   +3.685135481343905e-03   +6.042756915830250e-03   +1.646395496079928e-03   -3.865943715341872e-04   +1.214778727661843e-03; +4.400620942539523e-03   +2.387006723464326e-03   +3.101364523142510e-03   -4.546978424834725e-04   +6.398398104707829e-03   -7.579246869835541e-04   +2.706642842643788e-03   -1.673676949352913e-03; -4.972870941220152e-04   -2.251597188376972e-03   -1.881603098050257e-03   +2.401836782072975e-03   +6.251693300382337e-03   -2.798725772327770e-03   +6.225068962650990e-03   +3.335338825984166e-03; +3.684716720494228e-03   +2.553933579139994e-03   +3.819617373217170e-03   +3.410979372579356e-03   +8.097879012885308e-03   +2.967690542192967e-05   +4.378483735301901e-03   +7.656453369171993e-03; +5.808230113056998e-04   +1.330118997301709e-03   -1.506589174102280e-03   +1.490850656696037e-03   -2.663974938811627e-03   +2.083076432162775e-03   +2.696009212557943e-03   +5.998415050499030e-03; -4.372022363696344e-03   +1.369258683058973e-03   -3.980933826833586e-03   +3.566728654169751e-03   +9.273114925873723e-04   -7.918195631340117e-03   +2.821006365461529e-03   +2.189024932760334e-03; +2.544028576090848e-03   +3.206091447505625e-03   +2.070331642022835e-04   -5.483963536987529e-03   -2.576038482820291e-03   -4.287342422790375e-03   +5.669576394959498e-03   -3.816272967396925e-04];
L1E_L2E_iAMPA_netcon = [-6.464532114347076e-03   +9.248740798025466e-04   +9.346207788574351e-04   +1.009630612542884e-03   +3.692680375066090e-03   +1.062518572119522e-02   -7.556973318960190e-04   +5.459545254295859e-03   +3.682497069970999e-04   +4.379698381589929e-03   +2.390537388171192e-03   -2.200657655640230e-04   +7.109781253480129e-04   -7.743634134038488e-04   +2.721786457128124e-03   +3.079559213651424e-03; -1.327478188696624e-03   +6.635198335859026e-03   +5.743082982848646e-03   -5.252755178603320e-03   +3.987860829647678e-04   +4.426204088343660e-03   +3.493993643108010e-03   +6.200417279866345e-03   -7.037869235443936e-03   -2.578397051125275e-03   -1.685536689536825e-03   +1.619228587794646e-03   -2.158960591841256e-03   +2.458473890604185e-03   +5.260173773046329e-03   -2.253318849014060e-03; +2.550947543865457e-03   +2.229307788903037e-03   +7.076716981463340e-03   +9.070232428015438e-03   +3.233844559674103e-03   -2.315775059430330e-04   -3.373190982262957e-03   -2.760864902804299e-03   +8.216306700668627e-04   -3.699920500851909e-03   -3.451083246193515e-03   +1.441918699961108e-03   -5.037150226081850e-03   +1.506396504553302e-03   +2.385938450729835e-03   +2.039329800881341e-03; -4.536724228585060e-03   +5.546906616519639e-04   +4.447312346893028e-04   -1.662934926535846e-03   +3.456153928046824e-03   +6.374038094439505e-03   +2.089994468870811e-03   -2.349273201214874e-03   +2.364252287234446e-04   +1.487981791335781e-03   +3.634317569605789e-03   +6.288363143528255e-04   -3.501508371116178e-03   +3.721121563369586e-04   +4.686947673091850e-03   -2.680039176550931e-04; +7.622169053148950e-04   -2.766902063646983e-03   +6.651781926420479e-03   +4.068334889707037e-03   -5.365869120389045e-03   +1.251795512590992e-03   +3.745342712149443e-03   +1.632487968347598e-03   +2.011975364796151e-03   -5.886063075311143e-03   -5.790333575690408e-03   +8.023526402040649e-03   +3.842943771833422e-05   -3.628060481143786e-03   +8.077959686729294e-03   +9.758948927782324e-04; +1.305692763031008e-03   +6.675976954135755e-03   -1.426488848395913e-03   -3.776426404137652e-03   +6.788728262221154e-03   -3.736271639298007e-03   +3.252807750084725e-03   +6.717438080130434e-03   -6.023859549109096e-03   -3.851951542280080e-03   +8.778068968076799e-03   +2.922690387017908e-03   +5.293252330728001e-03   -4.274815687964005e-03   -1.153005218739647e-04   +3.311850309540669e-03; +3.425267090761052e-04   +4.820557348382339e-03   -3.238563478695318e-03   -1.164823604069484e-04   -1.533140512510324e-03   +1.309255991682641e-03   +6.529438956076822e-03   +3.136292969765268e-03   -1.571299343068916e-03   -4.031796681567345e-03   -5.898590343581324e-03   -8.291257873491321e-04   -2.596300208349063e-03   -8.281582651136989e-04   -3.990586331722333e-03   +2.912321505188812e-04; -6.844048442904064e-03   +3.658664302525661e-03   -6.787121812896101e-03   -3.072301105524584e-04   -1.707400210208387e-05   +5.982501754864165e-04   +5.773138698940279e-03   +5.916495741062847e-04   +6.722273919094650e-03   +1.478854916827161e-03   -2.649145054045085e-03   -1.256700458012096e-03   +5.208311452132758e-03   +5.254371099931317e-04   +3.465071333918992e-03   +5.742001772958659e-03];
L2I_L2E_iAMPA_netcon = [+4.098290919083545e-03   +8.723462942760184e-03   +6.999050318407482e-04   +5.177356685470137e-03   +3.446727738680226e-03   +3.026789960436496e-03   +2.481284930382681e-03   +1.822949249692148e-03; +2.570909658138457e-03   +2.655537812867123e-03   -7.943214631705520e-05   +7.616954018541246e-03   -2.729944942110860e-03   +2.893798418388376e-04   +9.757274407728679e-04   -1.798434644504280e-03; +6.716188404924037e-03   +5.167472525177104e-04   +3.823731630146489e-03   -1.631980406129462e-03   -6.501101043409111e-04   -3.404194086347090e-03   +3.913991027466145e-03   -7.634503006872209e-04; -1.641705907661547e-05   +3.678227409231949e-03   +6.246402038005755e-03   -1.786021665905138e-03   +6.425087241633926e-03   +2.569788752593041e-03   +4.617704003916952e-03   +1.301790263556708e-02; +4.001249579637028e-03   +4.375434930036760e-03   +1.279230337078037e-03   -5.523299328122818e-03   +3.867485814726868e-03   -8.535456158836850e-04   +2.939645593749835e-04   +9.395440418601027e-04; +1.486882845351244e-03   +4.901335766784661e-05   +2.638670933211157e-03   +1.694022877866088e-03   +1.272258524523897e-03   +6.225636865750055e-03   -5.270914461998767e-04   +5.928634669859568e-03; +3.234718991818345e-03   -1.011830554672479e-03   -1.625853877082913e-03   -2.521304141895292e-03   +3.020595688037225e-03   +5.762240958205015e-03   -1.062026627534361e-03   +7.984331845979745e-03; +3.941261864395373e-05   -1.074031411939507e-03   +1.608642707276091e-03   -6.163309648676325e-03   -2.556908056745459e-03   -1.597024275534106e-03   +3.128197408001193e-03   -3.338978057922701e-03];
L2E_L2I_iGABA_netcon = [+6.234315387360401e-03   -3.670626450327005e-03   +7.529177027604423e-03   +2.909469666017532e-03   +5.077848112706636e-03   +6.574356833501166e-04   +4.198920164208517e-03   +2.055670203588504e-03; -4.252748502974427e-03   +7.687687641938043e-03   +3.942650459379372e-03   +3.182715984308133e-03   +2.962314058579679e-03   +7.874147272722433e-03   +6.179390033249380e-03   +1.016064503181303e-04; +8.776802757818732e-03   -1.681082957556524e-03   -6.597397932405940e-04   -2.409613041597885e-04   +4.133975093155340e-03   -6.527930294619537e-03   +1.028128445629754e-03   +7.325293539421582e-03; +6.867777372835943e-03   -4.671587332466573e-03   +2.925904165890502e-03   +6.716985080686229e-03   +3.332810012522855e-03   -3.464501171245839e-04   -4.988166257538082e-03   +3.704575434492500e-03; +5.142772794654438e-03   +4.218655102688982e-03   +7.320579103954197e-03   +9.306984704617619e-03   +6.562239488104542e-03   -2.732759530522034e-03   +2.774356470490701e-03   +3.723102752151661e-03; +5.233304280780749e-03   -3.656332390908024e-03   +2.801840086084422e-03   -3.289902796357338e-03   +1.177516473244327e-03   -9.969793348181333e-04   +5.528599067423970e-03   +1.056068317723246e-03; +6.434579572371322e-03   +1.211914846845605e-03   -3.149332503864333e-03   +4.443309712135130e-04   +8.595874478697298e-04   +3.298294862061763e-03   +1.729173903726787e-03   +3.912861530209134e-03; +5.317043823789403e-03   +2.892665092240524e-03   +5.433693994916384e-03   -2.633817975314112e-03   +2.463714183800498e-03   +4.145556143031894e-04   +2.834254074788671e-03   -9.092120816370215e-04];
L3E_L2E_iAMPA_netcon = [+2.049499727460028e-04   +5.829132464347208e-03   +1.694575567177506e-03   -3.690431196760167e-03   -3.124133167928106e-03   +7.690913107565832e-04   +2.280515808552872e-03   +5.856920348682382e-03   +5.478497744880445e-04   +1.890531025141596e-03   +2.595915650049803e-03   -6.400883693219853e-04; +2.544047026375923e-03   +8.394206405604903e-03   +4.931782846882100e-03   +8.471792500979691e-04   -1.231848985069834e-03   +2.267713153131135e-04   +2.127561912706387e-03   +4.152688833588544e-03   +6.312270776644735e-03   -9.989779912373507e-04   +1.280730710753556e-03   +3.357559112017757e-04; +1.940793904306794e-03   +2.146151182688174e-03   -4.062962032300032e-03   -1.016576213139326e-03   +3.591518828071488e-04   +1.887570592189287e-04   +3.043012290785359e-03   +8.563350697760402e-03   +8.110396069807332e-03   +1.785046722543936e-03   +3.511300978591932e-03   +2.364994469892117e-03; -1.550402191540504e-03   -1.450929467136690e-03   +1.810263551151380e-03   +7.908661130632790e-03   -9.376841022225124e-04   +1.715794662059178e-03   +3.741607047671896e-03   +2.859158773108559e-03   +2.757360023813371e-03   +7.604521920327022e-03   +6.437003522046653e-03   +4.127094538263635e-03; +1.267183699705258e-03   +1.755409299953986e-03   -2.479195913355162e-03   +4.714290652504678e-03   -2.609252137490942e-03   +2.587480987681186e-03   +2.215161849224320e-03   +9.144397553293398e-04   +1.347439684032888e-03   +8.770513148562550e-03   +2.379720825694741e-03   +3.229731609466460e-03; +6.269993339355723e-04   -1.990496585797877e-03   -4.833435819033866e-03   +1.099373852273873e-03   -4.798370510982316e-04   +8.334342581686322e-03   +5.001482550679758e-03   +6.754729290097793e-03   +8.301486298761810e-04   -3.035275566554669e-03   +6.627484997618331e-03   +5.159206619709373e-03; +4.774843505787387e-03   +2.987676853716802e-03   +7.051678062994794e-03   +3.128424207913203e-03   -1.530800429413464e-03   +6.730006191112458e-03   -4.766809416156892e-04   +1.045012985050643e-02   +2.170211768967097e-03   -1.047031482182184e-03   +2.578079846900704e-03   -1.588596505667102e-03; -2.952298221021717e-03   -2.435709343265574e-03   +6.340413614511112e-03   +1.717802206144274e-03   +4.384185403048886e-03   -3.541928216999523e-03   -2.037414785047792e-03   +2.673408065056635e-03   -3.853990797606621e-03   +3.359221350454903e-03   +9.773283010402422e-04   +1.041787671146808e-03];
L3I_L2I_iGABA_netcon = [+5.937143803196017e-03   +2.089592372732508e-03   -2.242606680218358e-03   +2.223977712417399e-03   +3.691555738146111e-03   -5.574135860702572e-03   +4.122334221139340e-03   -4.851741029776765e-03   +9.158376840381907e-04   +3.286321533951708e-03   -1.705318693240058e-03   +2.148630745567706e-03; +4.528366251836948e-04   -3.450217933767209e-03   +1.995826459949968e-03   +3.631006377042723e-03   +4.573851681445801e-03   +2.185387605447219e-04   +6.446156569643841e-03   -5.197324634019708e-03   +8.541249450427165e-03   -1.747689625247491e-03   -4.548525403821075e-03   +1.074870713441787e-03; +2.322648397154228e-03   +4.167563224357396e-03   +2.732379054783562e-03   +2.000954833270145e-03   -1.723671225206495e-04   -7.122184131317950e-05   +1.167512095019541e-04   +6.135938018627964e-04   +7.119859491720563e-03   +1.292899893152989e-03   -7.057907979210932e-03   -8.624701817054189e-04; +5.062460689275991e-03   +3.362575860960697e-03   +5.579303539706539e-03   -3.433857181156017e-03   +3.689498850889851e-04   +7.684866581671685e-03   -5.120095305450502e-03   +2.195661274591568e-03   +3.447117962080762e-03   -5.611662153400830e-03   +3.516562454680455e-03   +7.122942991213129e-03; +3.571784391728703e-03   -5.924255955817596e-04   +8.289011860865160e-04   +4.137481296214110e-03   -1.135902191533286e-03   +2.109142026797502e-03   -2.688016952646471e-03   +4.966402707384931e-03   +3.475375126293650e-03   +5.847141096200629e-03   -2.638329879591758e-03   -3.583861843583682e-03; -6.534720712069310e-04   -4.057875100135102e-03   +3.930350219137520e-03   +5.258635974315774e-03   +4.233963678565943e-03   -4.931363590518142e-04   -1.167586838021202e-03   +5.228096322770175e-03   +5.216449826890264e-05   +4.798965697767317e-03   -2.641450986485184e-03   +2.613050263286606e-03; +1.315118268726886e-03   +4.514456156400524e-03   -2.185072383717127e-04   +2.309429579669621e-03   -1.683203719255988e-03   +5.506905693118718e-03   -2.258852542038175e-03   +4.750506126805930e-03   -4.174744482890789e-03   +6.206610225804276e-03   +4.366129091144328e-03   +1.618309408065185e-03; -1.133433940958067e-03   -2.677151494676080e-03   +2.127981605949601e-03   -1.339988318625203e-03   +7.497001651722276e-03   +4.431111103413727e-04   -5.603878093049790e-03   +1.938188475420887e-03   +1.963817698519286e-03   +2.131244534119990e-03   -5.455727703462790e-03   -1.578837466386086e-03];
L2E_L3E_iAMPA_netcon = [+2.651078657781364e-03   -3.269147330033171e-05   -5.200489695747271e-04   +1.933391713458951e-03   -1.816216367582172e-03   +3.415323001110727e-03   +1.623925067695043e-03   +7.792618015345863e-03; +3.037879715404770e-03   +4.368892071260206e-03   +6.832628811196382e-03   +6.245831070545460e-03   +2.018981912583598e-03   +1.213996525513077e-03   +2.499064155778202e-03   -1.420356489727115e-03; -1.887087189026120e-03   +8.734593677501032e-04   +4.788822999599017e-03   +3.508972146875863e-03   +3.292845841688843e-03   +8.661190779326632e-03   +3.439873281539752e-03   +9.886149529751710e-03; +9.142281816066035e-04   -3.700039876744855e-03   -1.949699501971077e-03   -2.064628946486349e-03   +5.724516787415937e-03   +7.078742787601966e-03   -2.793852374255015e-03   +7.348934796744595e-03; -5.777607867069213e-04   -4.860675702132154e-04   +1.361421559634109e-03   +4.679535153265905e-03   +3.491076480008644e-03   +3.919144712408242e-03   +2.853519728525895e-03   -1.028895757863407e-03; +5.847222364610760e-03   +5.610316494309058e-03   +4.454294167559357e-03   +2.337681453294611e-03   +3.277155027134629e-03   +8.552227213451762e-03   -2.122149950890170e-03   +4.949372701092723e-03; +6.423161056585365e-03   +3.706689130774017e-03   +4.434988957104759e-04   -5.011145556898800e-03   -2.094801979706178e-03   +4.019726386833629e-03   +1.152453807393469e-04   +6.189421774729514e-04; +1.076250028011132e-02   -3.941890478671925e-03   +1.135143170891175e-03   +3.864007563749170e-03   +7.648679341712305e-03   +5.037017730023909e-03   -4.137854485838395e-04   +6.335447283382051e-04; -3.826800936576842e-04   +5.677909825498384e-03   +5.414604473237283e-03   +3.291220525134995e-03   +3.506622094630037e-03   -3.650658893835273e-03   +1.688941422027778e-03   -2.567330748449395e-03; -6.888744175853004e-04   +1.176159138984829e-03   +4.660090874754173e-03   -2.535829300460512e-03   +4.503637478665842e-03   -5.533159104690374e-04   +2.279512356007173e-03   -1.431200742130756e-03; +2.441402827695423e-03   -2.417930182629062e-03   +4.131299455815053e-03   +2.483032288397229e-03   +1.497661439670728e-02   +2.257553429042144e-03   -8.229788377539877e-04   -5.205696907221601e-03; +8.028816432656688e-03   +7.231624889049236e-04   +5.756968617799411e-04   +3.378419341356982e-04   +4.634774816352076e-03   +2.641400800222672e-03   +7.330112590096876e-03   +2.100391632715912e-03];
L2I_L3I_iGABA_netcon = [+5.101072091542033e-03   -7.337136612782152e-04   -7.915246765787887e-05   +3.545342958220973e-03   +9.317670605843462e-03   -2.409493851752401e-04   -1.362720003747676e-03   +2.250784465532184e-03; +2.207734814467235e-03   -5.492864331490665e-04   +3.082848570917080e-03   -4.721818725233696e-03   -5.821208318081235e-04   +4.302550848418501e-03   -3.396827012694580e-03   -1.043448766455527e-03; +4.048367135786622e-03   -2.731080284803315e-03   +3.992148071046509e-03   -5.430358975339198e-03   +5.683694976383370e-03   +8.649696747577564e-03   +8.152899873317833e-03   +4.984189564175829e-03; -1.800899866480798e-03   +7.927688224582634e-03   -2.756217701978912e-03   +7.528596615759610e-03   -2.751260675418829e-03   -3.894110128895451e-03   +1.747951128456117e-03   -1.041822355725109e-03; +2.628563996734556e-03   -7.289693668565047e-03   -5.062896337124952e-03   -4.598016852102682e-03   +3.893245264961801e-03   -7.298199825422924e-04   +4.430646909162785e-03   +6.010278315106242e-03; -3.968221644546408e-03   -2.208779654226207e-03   +6.842236987695042e-03   -2.014777421015920e-03   -1.376406394815453e-03   -2.668777947399667e-03   +2.226370650892473e-04   +1.230325699706004e-02; -5.336471024714564e-03   +3.883666277413043e-03   +3.594547686862124e-03   +3.142922151753411e-03   +5.264378884724321e-04   -2.079238367658557e-03   +3.078499814293118e-03   +5.319999091060514e-03; -4.466721759261147e-04   +2.588310896332181e-03   +5.007249233757958e-03   +2.251469775086568e-03   +1.021236214248786e-03   +7.548822876644600e-03   +4.469195307065127e-03   +3.408234757174145e-03; +4.051973074333241e-03   -2.692076215527580e-03   +2.508698279540381e-03   +3.401128599008120e-03   -1.543025051392282e-05   +7.696219582284617e-04   +4.810620419912214e-03   +4.438976067776797e-03; +4.678564920198960e-03   -2.289124512984708e-03   +5.808034801275930e-03   -1.300112002254064e-03   +5.431934982269140e-03   +3.181764027326074e-03   +1.048433968371329e-03   +1.737319781853331e-03; -1.092421428971137e-03   +2.965742743690636e-03   +2.672929473815725e-03   -2.428830399471534e-04   +3.205635045312157e-03   +9.690359294073581e-03   +3.289472096376633e-03   +5.416999620765091e-03; +2.546237858008463e-04   -3.917768599406971e-03   +3.607549513980745e-03   +1.164541575097843e-03   +7.877698026608902e-05   +6.899351125243543e-04   +1.872827540355108e-03   +2.875762882310997e-03];
L3I_L3E_iAMPA_netcon = [+3.235725524170190e-03   +1.892271834509704e-03   -6.173959863134712e-04   +3.278410702404200e-03   +5.925480749720630e-03   -6.909808490463170e-04   -3.231117514657472e-04   -2.051497311754348e-03   +1.710085673638276e-03   +1.742121149791778e-03   +6.049297894292396e-04   +1.447927741349137e-03; +1.592145846134813e-03   +4.186374221937278e-03   +2.007198926919153e-03   -4.244809820134012e-03   +2.144127814402782e-03   -9.899972028978201e-04   +5.433646098414598e-03   -1.971067659334663e-03   -1.003621708727358e-03   +3.065853087468621e-03   +1.014263420563349e-03   +8.457757316057754e-03; -6.681714068752513e-03   +3.467382916020282e-03   +1.985539883468410e-03   +3.477352003530207e-04   +1.274029919376790e-03   +5.238358720756326e-03   +5.842768289198969e-03   +1.441371997756720e-03   -3.350956795945121e-03   +4.487136050814462e-04   -3.473961897448783e-03   -5.708067105419344e-04; +4.129564473710635e-03   +4.991496463029034e-03   +6.638570011026036e-04   +5.999224534563951e-03   +7.885808177417691e-03   +1.690658408997941e-03   +1.165410965546355e-03   +5.322794253130122e-04   +2.991179570533353e-03   +6.526255204424526e-03   +4.953992858723696e-03   +7.365575548734604e-03; -4.664755757705499e-03   +3.508252413017800e-03   +2.266654765363159e-03   +1.658919881546706e-03   +4.472828345096481e-03   +3.729077976396006e-03   -2.385972851561928e-03   +3.215982911970814e-05   +2.852772197524184e-03   +3.176636159676607e-04   +1.543006838900327e-03   +7.205491362489436e-03; -2.688781368886826e-03   +1.889130592524710e-03   -6.696278466202499e-04   +4.180991281436635e-03   -2.296213923192622e-03   -2.542489397669269e-04   +9.247503658250259e-03   +1.539330038533921e-03   -6.501354160867083e-04   +4.263451251204172e-03   -2.822419029893442e-03   -2.973884179641562e-03; -2.032996035990198e-04   -2.054897710585397e-03   -3.152193394430629e-03   +3.127033994302511e-03   +8.360934325918709e-03   +1.134044285006644e-03   +7.147698806662752e-04   +5.005008736086460e-03   +4.434254817804500e-03   +5.581483301826260e-03   +5.128889729666176e-03   +1.009141309521763e-02; +4.818915266188562e-03   -4.218042617140215e-03   +9.483541367395138e-03   +3.129831656217830e-03   +5.781967461249994e-03   +2.512134164140934e-03   +6.205691522836031e-03   -8.831843783156203e-04   +3.040894001591760e-03   -2.089271909872686e-03   +5.489738637014881e-03   +1.791709367277854e-03; +1.234258793090338e-03   -1.203949377999757e-03   +7.977771081515236e-04   +2.069535247034696e-03   +2.803787142018864e-03   +4.577906422822058e-03   -3.173465672064531e-03   +4.560048622093568e-03   +5.110490145600981e-03   +9.091629012091273e-04   +5.710178050672561e-03   -7.799428895795687e-03; -7.894919822065402e-04   +4.702324024805589e-03   +3.240636759424065e-03   +2.794470026727153e-03   +3.565671146095849e-03   -8.880721569542033e-04   +2.753281693022017e-03   +2.712438072394972e-03   +3.206281819932839e-03   +2.593182213773794e-03   +4.138434265355142e-03   -2.617220574370348e-03; +2.258676158619096e-03   +1.183262698180502e-03   +5.228254888839744e-03   +4.839231033962794e-03   -5.610762974465306e-03   -3.511542538066754e-03   +1.477506446896725e-03   -3.518145507543422e-03   -3.822850518484921e-03   +2.760314043062902e-03   +6.601527832412141e-04   +3.532831746841696e-03; -2.794557131565290e-03   -3.056090871426102e-03   -4.220590415383224e-03   -1.449077471214206e-03   +2.816565049670387e-03   +1.278683431254035e-03   +5.698857663920479e-03   -4.706510522216973e-03   +8.103681134151032e-04   -1.962027436627481e-03   +1.053945991090466e-03   +8.709485225486068e-04];
L3E_L3I_iGABA_netcon = [+2.131637105850249e-03   +6.555957514459225e-03   -2.668445646685551e-03   +3.322061256120758e-03   -1.637307453382978e-03   +8.280812571746765e-03   +9.122482642189749e-05   +6.010975734912524e-04   +4.863705646361537e-03   -3.463589576362281e-03   +2.591200371655069e-03   +1.741791168714656e-04; +1.140050715534272e-04   -8.348159624089196e-04   +2.345630411987198e-03   -2.859179122782244e-03   +2.341536806405983e-04   -2.266956656800284e-03   +7.889831867533973e-04   +3.936264091272967e-04   +2.068744750558921e-03   +1.111834565930821e-02   -1.217711301235548e-03   +1.413734082201372e-03; +3.050694221768094e-03   +1.829925792170885e-03   +5.081073591611827e-03   -1.175996470515702e-03   +3.659708432150470e-03   +5.062505917812148e-03   +2.688549994044284e-03   -2.191012890397770e-03   -1.390954715047547e-03   -1.997898789163734e-03   +3.457780580345324e-04   -3.080504962546221e-03; +7.815447958408779e-04   +4.182663024435048e-03   -1.872792912956504e-03   +1.181461033892999e-02   +2.393219550804411e-03   +7.907664473030753e-04   +3.948694463029408e-03   +1.029333536856713e-03   -3.868609935122142e-03   +7.845685156697408e-03   -1.663455681359895e-03   +7.159777082526655e-04; +3.016904569955474e-03   +1.257576309651406e-04   +1.204611290577731e-03   +2.129609133865730e-03   +2.401649798179337e-03   +5.031662822572867e-03   +4.617186655876719e-03   +3.450674768590642e-03   +5.330423083873269e-03   +2.645477148515533e-03   -1.314990164094848e-03   +5.448836795750167e-03; +3.795934165043942e-03   +5.881413390049454e-03   +6.052634965362343e-03   +8.936284832726992e-04   +4.387544971090206e-03   +6.952054196233353e-03   -3.330156563140715e-04   +1.849038894141829e-03   +4.158587881478945e-03   +4.335005344424390e-03   +1.482282578310002e-03   -4.989333851038519e-03; +3.723601911997517e-03   +5.255714692129646e-03   +2.732165555101330e-04   +3.357354355155085e-03   +6.776080954620773e-03   +6.599564005372486e-03   +1.087335318993203e-03   +4.356779992763723e-03   -2.059711210106414e-03   +1.227892495426889e-04   -2.810597914223916e-03   +6.586816570269287e-03; -6.036721103942304e-03   -1.350323772271051e-03   +4.651996654436259e-03   +5.108579386958626e-03   -4.729649778685769e-03   +3.680323009193252e-04   +5.242087634977195e-03   +2.339916692051435e-03   +2.458433982618777e-03   +3.415975910385174e-03   -6.664242921360495e-04   +2.162132781748304e-03; +6.216447929761300e-03   -1.314153132952058e-03   +6.285412081361916e-03   -1.363580029560401e-03   +3.093306008858372e-03   +4.380790475401497e-03   -2.050763912099615e-03   +8.725657813685393e-03   -2.155006121908832e-03   +5.253689402220596e-03   -1.792521987376368e-03   +6.455319112033037e-03; +3.625334918225695e-03   -3.714612215227530e-03   +1.733289604978143e-03   -6.559473435906864e-03   -1.642705187521692e-03   +1.606806171156332e-03   +4.762120926601970e-03   -2.083394487883321e-04   +6.402981379102800e-03   -1.931079266956793e-04   +2.676760258545331e-03   -2.907000025543060e-03; +4.395193218855755e-03   -7.466177760089032e-04   +5.451420257038155e-03   -2.850471197234933e-03   +5.827157441744964e-03   +1.806538121251056e-03   +5.305165877911430e-03   +5.460859136464297e-03   +8.968184774898197e-03   +6.471011314560447e-03   +1.546315361765439e-03   +2.937090518506374e-03; +3.781035201977032e-03   +9.394187457871492e-03   +2.300381695136086e-03   +2.221390416977785e-03   -5.661276964644702e-03   +2.633665244140879e-03   +7.270869416323159e-03   -5.633812514133610e-03   +7.898574083959158e-03   +4.175048383766011e-03   -2.890134919054933e-03   +7.085160336143626e-04];
L2E_Input1_iAMPA_netcon = [-1.654710292002324e-04   +4.632031423276024e-03   +7.649854451267761e-03   +3.166738389473035e-03   +9.749745855644034e-03   +8.618874955656978e-04   +3.713669189199745e-04   +2.946530135683040e-03];
L2I_Input2_iAMPA_netcon = [+9.634136491043291e-03   +1.440813588537763e-03   +2.564910360130478e-03   -2.045050740283537e-03   +6.807067911552713e-03   +1.119158033001339e-03   +4.419124768281905e-03   +5.537925891734125e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
