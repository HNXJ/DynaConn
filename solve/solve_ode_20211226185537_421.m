function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.697153188305987e-01   +1.197119392728889e-01   -3.678908274835790e-02   +1.849761482349896e-01   +2.574160477723562e-01   +1.904594875030632e-01   +2.146765495893700e-01   +3.827408797062769e-03   +3.096622701392571e-02   +4.301502616628713e-03   +2.703503202537928e-01   +8.297737203600880e-02   +2.800369369225366e-01   +2.815676626291045e-01   +1.461439850364970e-01   +1.713731863819506e-01; +2.240821581396316e-01   +1.497529109205310e-01   +1.163499673215133e-01   +2.273014794107308e-01   +1.333934989256877e-01   +1.639783544651436e-01   +2.369431416722726e-01   +8.384655963162768e-02   -1.802836198319466e-04   -1.590000934541657e-03   +4.598442958874371e-02   +1.060913412773870e-01   -7.694616355611845e-02   +2.859820832517532e-01   +4.758974323055354e-02   +2.361631923939440e-01; +1.780809233896283e-01   +4.779767366679424e-02   +2.894197148377036e-01   +1.447193734181038e-01   +1.945757827592844e-01   +9.213698603932381e-02   +3.066784507696807e-01   +6.066011514926926e-02   +1.156069525148522e-01   -1.426890822633533e-02   +1.242632903872201e-01   +3.399254823341863e-01   +1.318118762553703e-01   +4.841893274081895e-02   +2.175713125832587e-01   +5.863680348346084e-02; +1.572060314582100e-01   +1.779430809254126e-01   +6.316216832891031e-02   +1.330882575146431e-01   +3.097439279186069e-02   +2.197385490669910e-01   +1.826675895985450e-01   +2.085828676862962e-01   +2.627735770474967e-01   +6.918685811647109e-02   +1.394808053501416e-01   +1.197793103144901e-01   +2.635581984220985e-01   +2.101128680115432e-01   +2.191002847709339e-02   +1.405995906692368e-01; +5.682472573734333e-02   +1.776631468049207e-01   +9.032652264820908e-02   +2.239763524183225e-02   +1.456509662163140e-02   +1.330659403933181e-01   +4.288491671421624e-02   +2.646154484057587e-02   +2.078197060162278e-01   +1.190032600397900e-01   +1.289625391226313e-02   +2.430220965628857e-01   +1.843495938128724e-01   +2.853773440233469e-01   +1.643604015680515e-01   +2.838437728063223e-01; -1.088591582385443e-02   +4.239837019035166e-02   +1.230077983104722e-01   -3.175621531364222e-02   +2.653073765956581e-01   +2.905020339383742e-01   +1.836275033231400e-01   +1.622438520290602e-01   +1.338695438743622e-01   +8.347522149854363e-02   +6.027540965055571e-02   +1.262078704740195e-01   +7.268507170473464e-02   +1.258768743582898e-01   +7.548742028440288e-02   +3.465298442578824e-01; +2.420389621975949e-01   +1.221737421629413e-01   +2.273550546253370e-01   +2.257474542321168e-01   +1.685599666911405e-01   +2.558157860985287e-01   +1.304794328093628e-01   +7.422797944762019e-02   +1.705350201259312e-01   +2.574703697122182e-01   +4.836600163806180e-02   +2.691637297961207e-02   +1.321990348175783e-01   +1.000592728681643e-01   +2.079031669697368e-01   +1.159806495389848e-02; -4.333256991512270e-03   +2.676497012156620e-01   +1.545273985578549e-01   +1.269019588074579e-01   +1.538897229435234e-01   +2.889062226663516e-01   +2.381222127170552e-01   +1.887251938435425e-01   +2.448480492271323e-01   +9.010539919755778e-02   +6.820405761410625e-02   +1.168768507898651e-01   +2.135511599525298e-01   +1.144261542613313e-01   +9.163896806591526e-02   +4.353345748748451e-02; +3.492909874872301e-01   +2.604962886510451e-01   +1.665058069048522e-01   +3.445842265099324e-01   +9.630545694355211e-02   +6.302495237641133e-02   -8.623731965061718e-02   +1.099065570952108e-01   +2.277678967292369e-01   +5.617375402127146e-02   +8.513102750200541e-02   +2.057413696525164e-01   +1.285755271927464e-02   +3.080091208930931e-01   +6.461682686170837e-02   +1.352682402199579e-01; -2.611378583229173e-02   +1.999257887389032e-02   +3.003760636827034e-01   -5.562365522734889e-02   +2.760826226949117e-01   +2.086495796908945e-01   +4.379981427969078e-03   +9.501330203766684e-02   +4.508854753338642e-02   +1.917495558198020e-01   +2.036061184847550e-01   +1.489082960278309e-01   +7.157680261000765e-02   +1.424836199276171e-01   +3.584034660107059e-02   +2.110684469433134e-01; +8.429064792555188e-02   +2.719125568782626e-02   +8.695765427332836e-02   +1.684086785470106e-01   +1.975858825754983e-01   +1.811216327932923e-02   +1.603312489924650e-01   +1.769670645611164e-01   +1.662864475340523e-02   +2.115684350618147e-01   +1.095975378884379e-01   +2.452800568429854e-01   +1.367395612843579e-01   +7.789984050508479e-02   +7.136905753520727e-02   +7.358470944875804e-02; +1.796845992468435e-01   +1.783954819595842e-01   +1.865564829880303e-01   +7.482807518465490e-03   +2.097387098152912e-01   +1.188424090200175e-01   +1.692475456780934e-01   +4.440842798430968e-03   +2.357561357136316e-01   +7.609004979690649e-02   +1.939124276927662e-01   +1.878972229051706e-01   +1.913221193536349e-02   -3.889054634285598e-02   +1.768240977600271e-01   +1.739754563885724e-01; +3.140444046183588e-01   +2.694848661723734e-01   +1.511545400114950e-01   +1.227717056162332e-01   -5.722402159669652e-02   +1.498469723150526e-02   +7.136419299390202e-02   +1.795647718716401e-01   +1.312912688371904e-01   +1.851158994681500e-03   +1.170849926604598e-01   +1.751601361362116e-03   +7.998923690912046e-04   +1.475841316164856e-01   +2.638060253902350e-01   +1.310484219553798e-01; +1.794487737536457e-01   +1.305579608085540e-01   +1.648368716512467e-01   +2.488630304414694e-01   +8.246963828741501e-02   +4.688186256246330e-02   +2.816619513114927e-01   +2.816572174980168e-01   +9.129799102978471e-02   +5.273631689809646e-02   +2.160415545991509e-01   -6.326739368090231e-02   +1.654003320144102e-01   +1.473379040564180e-02   +1.621634563862066e-01   +2.934804625637247e-01; +1.025551395322152e-01   +1.739225565355512e-01   +1.296194614045463e-01   +1.640203975405767e-01   +1.331351746860439e-01   +6.774624098010734e-02   +1.546490844468697e-01   +1.918406298085086e-01   +8.120258940786673e-02   +1.189286931919221e-01   +4.600379899146165e-02   +9.984553447004166e-02   +1.534377134839520e-01   +2.088964844660312e-01   +1.656082509740744e-01   +8.629739495007670e-02; +1.828996161833909e-01   +9.611137389514335e-02   +7.878775929729592e-02   +2.991232924152040e-01   +3.186551287891495e-01   +1.350387985234631e-01   +8.836192404755962e-02   +8.474472777738402e-02   +8.915817519706791e-02   -8.719180396360388e-02   +4.588765910458532e-02   +1.668200240610977e-01   +3.075427281453438e-01   +1.337844435749241e-01   +1.691885924942311e-01   +1.331866325165283e-01];
L1E_L1I_iGABA_netcon = [+6.756647189365694e-02   +4.419422738414553e-02   +1.247605427686274e-01   +1.182631029818831e-01   +1.916252474311462e-01   +8.822594463615342e-02   +1.307228012778442e-01   +2.174220159327692e-01   -6.285363659411797e-03   +2.217428438737130e-01   +1.980896637169573e-02   +8.305716967234557e-02   +2.345979854100348e-01   +1.047717425261664e-01   +5.904140679805439e-02   +2.093931069416982e-01; +1.354959503948878e-01   -5.420227996095994e-03   +6.418243075916547e-03   +1.759579899033720e-01   -7.658888168664469e-03   +6.440486672054514e-02   +4.508084779702295e-02   +9.616277740509459e-02   +2.033222022102230e-01   +2.018276644660231e-01   +1.397562859252745e-01   +7.036094804980848e-02   +9.626837131573911e-02   +2.222971088479782e-01   +1.905356429027183e-01   +1.772185992109005e-01; +1.475115131350148e-01   +3.119467320643756e-01   +1.221065118609122e-01   +2.091154539426196e-01   +2.380325837984647e-01   +1.090739020874755e-01   +4.100540350501140e-02   +2.942680333749555e-02   +1.302119882710852e-01   +1.401027220177932e-01   +1.227126904055427e-01   +1.485490207845652e-01   +1.880422825834586e-01   +9.081257397723749e-02   -1.017557658173764e-02   +3.529503628652885e-02; +1.239752180429141e-01   +1.840719633050703e-01   +4.395099945472221e-02   +4.129394832329501e-02   +1.884943349335063e-01   +7.216801229217898e-02   +2.328731001427347e-01   +2.449245447304280e-01   +1.560101708545363e-01   -1.443204567727355e-02   -1.146604073246373e-02   -6.219962585322271e-03   +3.383406144291738e-02   +2.534442986696601e-01   +1.018228496222688e-01   +1.598635891920158e-01; +2.789800680110979e-01   -7.568484194536611e-04   +1.334935383092933e-01   +8.301712357894739e-02   +2.652519693529196e-01   +1.413323097266629e-01   -6.553027194690557e-02   +9.111358241150463e-02   +9.286168395517885e-02   +1.307462573707339e-01   -3.952896619576516e-02   +6.816087193243733e-02   +2.210433690405443e-01   +5.937945565266138e-02   +6.068095374635053e-02   +4.473149627768400e-02; +4.408117421433411e-02   +2.370795154445878e-01   +6.056069625959212e-02   +5.983240041198251e-02   +8.439340240786009e-02   +1.858050714112521e-01   +1.232658692230410e-01   +2.374443427239597e-01   +1.703428575966517e-01   +1.574681842459129e-01   +2.377046465198827e-01   +2.813656396341786e-01   +5.296917361891673e-02   +1.427234367274373e-01   +6.037572911058819e-02   +2.123549008876855e-01; +1.006407179570384e-01   +6.311454062726096e-02   +1.359855318621679e-01   +3.022745497502016e-01   +2.827101809237786e-01   +9.868696044196720e-02   +1.382354401558833e-01   +2.509687338575820e-01   +1.173066222400899e-01   +1.338612822132534e-01   +1.380918398744586e-01   +3.279983459578001e-02   +1.825950958303736e-01   +7.720510190042487e-02   +1.146551862074407e-01   +6.520820186164356e-02; -2.258658164934173e-02   +1.271667940894844e-01   +2.423524086790102e-02   +4.302818558224317e-02   +7.166197369440473e-02   +1.617979530308924e-01   +2.487920700018760e-01   +1.013367362800922e-01   +3.295484273208389e-02   +5.259410469726646e-02   -2.426583275993587e-02   +8.776957715867569e-02   +1.675546534101142e-01   -5.349918572706291e-03   +3.113096267187684e-02   +9.470962493429991e-02; +1.716976203972742e-01   +2.760039232683772e-01   +1.421271109561585e-01   +2.182824985669788e-01   +2.367924837394760e-02   +2.130840976508798e-01   +2.194040134369472e-01   +1.379544639326575e-01   +1.113709707768869e-01   +1.303726432480393e-01   +2.149999192168931e-01   +1.109959475586954e-01   +9.234236588333387e-02   +3.318674684234477e-02   +1.421549529289584e-01   +2.592370848797200e-01; +6.647240982113725e-02   -6.297316712520504e-02   +1.717310789196520e-01   +8.173703708038293e-02   +5.170699395153849e-02   +7.140546968944102e-02   +1.394037863777043e-01   +2.074622829191045e-01   +5.431918398178462e-02   +2.614698221781859e-01   +1.179567409307637e-01   +2.889488574023548e-02   +1.385494178481601e-01   +1.082549445951317e-01   +7.272850973553104e-02   +1.203436389751715e-01; +1.719459163362776e-01   +1.862726110439755e-01   -5.326903182192849e-02   +2.294911967163449e-01   +1.132669740306249e-01   +2.892637580196684e-01   +7.631114777079551e-02   +3.453782375568628e-01   +1.459172243099366e-01   +2.988958121672803e-01   +2.398197083829931e-01   +2.619964856425724e-01   +2.569582603882210e-01   +6.226722170931532e-02   +2.487671626314744e-01   +1.803282329184133e-01; -7.437454841065602e-03   +2.952588132700576e-01   +1.905243762711773e-01   -2.427756568030855e-02   -2.543741989143317e-02   +1.043913758410576e-01   +2.312246225849684e-01   +2.621812897543443e-01   +1.515689158166763e-01   +5.371436105736948e-02   -7.837824154396734e-02   +1.180614308029731e-01   +1.918028689345193e-01   +1.821761859680471e-01   +1.096797070004199e-01   +8.415990128249208e-02; +1.101969036870479e-01   +2.892921304685442e-01   +1.574368716250408e-01   -2.423090482810566e-02   +1.586330950688869e-02   +1.406430284685651e-01   +1.546735027745716e-01   +1.879376639427001e-01   +6.094788682891589e-02   +8.276868561880862e-02   +7.850560240162137e-02   +2.256937647759244e-01   +1.633037279475711e-01   +1.870333565317202e-01   +3.682180722768050e-02   +9.954726786952939e-02; +2.251231161802146e-01   +8.205482643668570e-02   +1.221189042971649e-01   +1.116374381769991e-01   +6.906677873089066e-02   +1.179910795084613e-01   +3.103226851721007e-01   -3.594737519833556e-02   +2.109921087423331e-01   +2.365716239276171e-01   +1.848579882330053e-01   +2.442278651931929e-01   -4.881727070432656e-02   +1.497191253550599e-01   +1.865866379882461e-01   +1.927109254856685e-01; +1.167750136753553e-01   +5.351445946801918e-02   +1.651153387960958e-02   +6.260055652745031e-02   +1.503960716586945e-01   +6.869012965121606e-02   +3.977613306264125e-05   +5.913582427560559e-02   +4.132347132409728e-02   +1.703760343549375e-01   +1.178222223644099e-01   -2.252096534123870e-03   +1.466278368786572e-01   +2.363244875481632e-01   -3.174359280543362e-02   +2.297939067029278e-01; +1.794165711286820e-01   +7.585925818637948e-02   +7.731809389662167e-02   +1.855678194452710e-02   +1.661389738093312e-01   +3.150020347504169e-01   +8.011237281575752e-02   +3.237874998403192e-02   +1.083616551836551e-01   +2.262618814041087e-01   -6.426783985073422e-03   +6.611676104458612e-02   +2.334116775834387e-02   +2.096580568600404e-01   +2.224767462108434e-01   +8.405321284446711e-02];
L2I_L1I_iGABA_netcon = [+1.819116968152461e-01   +9.705220719404112e-02   +1.113257774641633e-01   +1.449609169593858e-01   +5.311023079299044e-02   +1.792365745380568e-01   +2.887677350589984e-02   +2.564543688396620e-01; +1.826608000185342e-01   +1.379847845697774e-01   +1.199051257764030e-01   +5.474084712582897e-03   +2.510287511832437e-01   +2.474049845665825e-01   +1.829906407386149e-01   +1.520846430599025e-01; +1.414000865993484e-01   +1.945509254766871e-01   +7.649637837341897e-02   +1.238545869705179e-01   +1.611726687161379e-01   -2.331349683398218e-02   +1.944928945379004e-01   +1.656589509900174e-01; +4.518309238571277e-02   +1.475639895735606e-01   +6.795207608486059e-02   +8.341346685246186e-02   +5.875615914840294e-02   +1.756514900041115e-01   +3.064609760206584e-01   +3.109453965322670e-01; +2.663365442087813e-02   -5.041927643460464e-03   +1.847800041850063e-01   -1.316513665482367e-01   +8.937631907902663e-02   +1.743665025621445e-01   +2.172904969177703e-01   +2.071950114044198e-01; +8.445590095051210e-02   +1.349973768596251e-01   +3.083135145313363e-01   +2.166865432725883e-01   +1.167394261595729e-01   +2.057171293644506e-01   +7.021596595739446e-02   +1.142761923591882e-01; +3.249164541626474e-01   +9.938140568647426e-02   +2.633208316077630e-03   +1.092957326990101e-01   -3.480854037427184e-03   +3.260099739900439e-01   +7.996214284870051e-02   +2.878404054774348e-01; +7.641957287344282e-02   +2.134358223417756e-01   -9.207621683745067e-03   +2.394982925118160e-01   +1.600443238042399e-01   +1.683814145525755e-01   +1.839506403978287e-01   +9.858634561784750e-02; -8.366367559514906e-04   +1.085427181671116e-01   +2.328301158116707e-01   +2.184376027938086e-01   +2.172631040206529e-01   +1.065923947739713e-01   -5.018650922698238e-02   +2.325536143503909e-01; +1.472399537581889e-01   +1.367711987766529e-01   +7.316958380653954e-02   +1.076638882721612e-01   +2.698531648194117e-01   +2.147414412736548e-01   +5.483371317136481e-02   +2.068450711845038e-01; -4.101763867600054e-02   +7.205421566507519e-02   +2.332935135000151e-01   -5.046895238576344e-03   +2.141620600249038e-01   +9.797991755757426e-02   +2.697079324027848e-01   +2.839613182057865e-02; +8.461559107122224e-02   +1.328951535855335e-01   +1.553826287613609e-01   +7.058096861293936e-02   +1.624616739031763e-01   +4.472670174631116e-02   +1.991284547986915e-01   +2.668130295568567e-01; +1.589942763209369e-01   +7.880177180245403e-02   +1.157156691580487e-01   +1.719527181007202e-01   +1.053257627290919e-01   +2.243190337684695e-01   +1.034430954599992e-01   +1.135948395897320e-02; +1.289689304489662e-01   +2.374906245228397e-01   +1.131990280727628e-01   +9.967611457972700e-02   +7.439240436423811e-02   +1.617193611652695e-01   +2.216350765962097e-01   +1.560978966362027e-01; -4.833105989169270e-02   +1.366547144458996e-01   +1.156048446044879e-01   +9.171343795090514e-02   +1.613494254129188e-01   +1.138235981429367e-01   +2.728736268517509e-01   +2.734771642541967e-01; +2.788177332961745e-01   -1.428222765015701e-02   +1.332234184404957e-01   +2.662012859540003e-01   +2.737312503505827e-01   +2.000302777868707e-01   +1.225197340858104e-01   +3.057630910550552e-01];
L1I_L2I_iGABA_netcon = [+2.845754684270801e-01   +2.050390473241984e-01   +2.994015924740947e-03   +1.275786579571712e-01   +2.375453029688913e-01   +5.432455216394132e-02   +2.001676634514257e-01   +9.997229707144697e-02   -1.316774764473048e-02   +2.611205103211280e-01   +2.185328184978455e-01   +9.882773446390726e-02   -2.230690905220230e-02   +1.162622627086966e-01   +1.922067157217373e-01   -1.043200232620307e-01; +2.629199672654784e-01   +1.879469703734344e-01   +4.905092534339299e-02   +2.126360201578752e-01   +2.238345279129496e-02   +2.759761675428415e-01   +8.259205558124898e-02   +2.847283690556001e-01   +2.272376883089516e-01   +2.488448980995797e-01   +1.254446667845314e-01   +4.837397620076031e-02   +1.803325358843266e-01   +2.986505601895715e-01   +2.785354864890452e-01   +6.560306432157328e-03; +1.068654240763834e-01   +1.064270758891468e-01   +2.562447040313755e-02   -3.581449735398401e-02   +1.614739329495970e-01   +1.845253987383811e-01   +1.945662206506276e-01   +2.415446357481011e-01   +1.115687574091801e-01   +1.111030908781153e-01   -8.864464757245718e-03   +7.785550570129358e-02   +2.310203367874726e-01   +3.346272543126501e-01   +1.074147114998832e-01   +7.363197988720742e-03; +1.352624245659163e-01   +1.900322685543833e-01   +2.222545841103728e-01   +2.060039212842115e-01   +1.289629869272857e-01   +3.049157751085748e-01   +1.594823814288226e-01   +1.557052133392664e-01   +2.425578624875262e-01   +2.132654459224863e-01   +3.469693887676050e-01   +1.497534689132390e-02   +1.884630161913811e-01   +1.991345174436448e-01   +7.922622555586024e-02   +3.879232758001568e-02; +1.684240594124709e-01   +6.925831602151496e-03   +1.381186149652906e-01   +1.407683299162392e-01   +6.050890821798991e-02   +6.644875614565775e-02   +2.646566353887666e-01   +7.030684920453741e-02   +8.692460645764040e-02   +1.860150726537309e-01   +1.533759049586180e-01   +9.219247710776859e-02   +9.539795882538553e-02   +1.072193379268551e-01   +6.030564878693268e-02   +3.281224849760825e-02; +6.707371514426626e-02   +3.999528441300671e-02   -1.099011674824384e-02   +1.073163386553786e-01   +2.954079818093627e-01   +2.585420768103561e-01   +1.127300169851686e-01   +3.274015132677328e-03   +1.532260579827533e-01   +1.022211946115504e-01   +1.973675269770892e-02   +2.206343888358021e-01   +1.821975132164000e-01   +1.575358655177835e-01   +2.360047274595319e-01   -2.694324525616296e-02; +2.595063627040602e-01   +3.017439669550677e-01   +6.343109247685177e-03   -5.328328023629985e-02   +1.097202486914867e-01   +1.821596328137721e-01   +5.215574610415287e-03   +9.977539914272766e-03   +2.115415143017804e-01   +1.050172230356838e-01   +2.311378893596845e-01   +1.337424943666262e-01   -4.226972777856995e-02   +1.369282085362563e-01   -3.790614127370294e-02   +2.908058489888626e-01; +2.810966387737242e-01   +1.281209416470683e-01   +6.475909060802633e-02   +1.373603175479399e-01   +2.388699455580084e-01   +1.400629879919861e-01   +1.188672609414389e-01   +1.522268361811817e-01   +2.744947986400479e-01   +1.570975967714585e-01   +2.216521678553152e-02   +1.206322227794594e-01   +2.045976666957510e-01   +1.626749308140579e-01   +2.530582865971752e-01   +2.850029680789586e-02];
L2E_L1E_iAMPA_netcon = [-2.103248477634802e-02   +2.525281141560077e-01   +1.506898223713520e-01   +1.203354852130824e-01   -1.283981793047440e-02   +1.615300538638146e-01   +6.815180251804948e-02   -2.202095384718540e-02; -4.988312710216784e-02   +4.516002581918976e-02   -1.033766661133075e-02   +3.006597785123813e-01   +2.291834285855785e-01   +1.424559196260765e-01   +2.538469224583882e-01   +3.147064830115552e-01; +2.321691131592381e-02   -1.463417947241221e-02   +3.004590481567103e-01   +1.935448187314519e-01   +1.135959307864305e-01   +1.702048991704384e-01   +2.555445044126992e-01   +8.365448568062875e-02; +1.208609470787576e-01   +2.260908022432830e-01   +4.040292590049390e-02   +6.566723557336258e-02   +3.043597444842874e-01   +1.226163270962331e-01   +1.821992255821655e-01   -1.233024430142086e-02; +2.227603253953575e-01   +1.134102820293870e-01   +1.607389048330597e-01   +2.253167347690646e-01   -2.030896843113929e-02   -7.980038071413644e-04   +5.123401382750615e-02   +2.888603602637915e-01; +2.506380949727877e-01   +2.498732594432570e-01   +8.777990762133676e-02   +9.235892246807914e-02   +1.912956291123090e-01   +1.842967374659844e-01   +1.506063166189849e-01   +2.299945498282274e-01; +8.970556321939081e-02   +1.552777422742787e-01   +9.028941271923333e-02   +2.055639960666680e-01   +9.934667865251043e-02   +2.541143501124468e-01   +3.304148949604604e-01   -1.098494632451404e-01; +1.847340668257765e-01   -1.724295443472704e-02   +1.426073744561079e-01   +2.673822991262484e-01   +1.596510043216066e-01   +6.752093464524384e-02   +9.033324616322762e-02   +5.011952956414975e-02; +3.210957063772240e-01   +4.946007500932432e-02   +1.626323795529936e-01   +1.832969418311975e-01   +1.720227298470682e-01   +1.874343086804868e-01   +1.943929993666283e-01   +1.317603625515655e-01; +2.397229964170680e-01   +1.663774429731567e-01   +1.731998110982095e-01   +2.859795821776294e-02   +2.633397083662041e-01   +5.785328360441749e-02   +1.826186899809590e-01   +1.411616778432259e-01; +1.010671780632924e-01   +1.480110817431141e-01   +1.591809368428945e-02   +1.614192347129031e-02   +3.135578397008078e-01   +2.583094727527079e-01   +6.217440819956047e-02   +1.249805985383737e-01; +1.819844761727511e-01   +3.657580633500675e-02   +4.072768238399768e-02   +1.385935051728099e-01   +8.937959817253495e-02   +1.476519961248732e-01   +2.409964063584212e-01   +1.042715750230317e-01; +2.409291619838159e-01   +2.946451587578554e-02   +1.755986316828982e-01   +7.752202846624019e-02   +2.473047689892440e-01   +8.099579715480065e-02   +1.895764518056200e-01   +1.425951769564650e-01; +2.073913552792175e-01   +3.073453803220527e-01   +1.354380878623299e-01   +7.897618752638977e-02   +1.605184574275837e-01   +2.055839765164265e-01   +2.419422594042879e-01   +5.229022770992247e-02; +3.623236492005028e-03   +2.280312624208097e-01   +2.284770215994360e-02   +2.893869597114848e-03   +9.390647891969567e-02   +2.358037341339586e-01   +5.907118456091240e-02   +9.535482398610627e-02; +9.079456025718453e-02   +2.534461018202301e-01   +1.629216665538152e-01   +1.320411971441567e-01   +1.648706020502483e-01   +1.513540320063122e-01   +1.341313359580818e-01   +1.035853555163595e-01];
L1E_L2E_iAMPA_netcon = [+1.271148621765963e-01   +2.015050154416821e-01   +1.497679425861684e-01   +9.044976675784838e-02   +9.728950540517650e-02   +2.058185534628505e-01   +5.721931738751195e-02   +2.885950770686599e-01   +1.213652425078218e-02   +2.586672211252475e-01   +6.595420273687437e-02   +6.782497949404903e-02   +1.035274410133585e-01   +1.084239058186315e-01   +2.404289403172972e-01   +6.021235746898965e-02; +2.380494828279897e-01   +3.143049183592213e-01   +2.063673332395215e-01   +2.324891598272014e-01   +1.682962279403695e-01   +2.104258313109157e-01   +1.550287155781586e-01   +5.974014901418800e-02   +1.923251119469291e-02   -1.231749442817756e-02   +1.787732657771626e-01   +1.336388419612551e-01   -1.552702376588624e-02   +4.954444498246650e-02   +2.699998585642221e-01   +1.234468178548476e-01; +1.239643695312556e-01   +3.238585624795758e-01   +3.745170263421186e-02   +1.415205370924016e-01   +9.067746281694321e-02   +2.613741555388465e-01   -5.836606111794897e-02   +1.778958193871657e-01   +6.935771545693759e-02   +2.096876323350942e-01   +2.039426148930442e-01   +8.905085648449154e-02   +9.848875644459562e-02   +2.476505111760871e-01   +2.888336609657270e-01   +1.910873216597659e-01; +2.335858417416569e-01   +5.803502757424108e-02   +1.547878362931132e-01   +7.600161824331228e-02   +2.067967002403187e-01   +1.107451548076770e-01   +2.366652519021821e-01   +1.880870072234366e-01   +1.954855767021030e-01   +3.152960798393916e-01   +1.430478094296651e-01   +5.987033478568524e-02   +2.980562041882304e-01   +1.300808328575775e-01   +2.284982103262320e-01   +3.064091870554377e-02; +7.398851880223090e-02   +7.029454483459892e-02   +1.422256121234770e-01   +2.436937137768476e-01   +9.054328459487740e-02   +1.773207367146575e-01   +1.545902670324949e-01   +3.277257446391327e-01   +1.188646485202107e-01   +1.620210776604305e-01   -1.070629800816213e-02   +1.602001787381542e-01   +1.736881996145541e-01   +1.028935667082234e-01   +1.911462721110026e-01   +3.112890020204477e-01; +2.231084032722358e-01   +2.688342816508933e-01   +1.393719063783492e-02   +3.381535520675271e-01   -5.600756222677961e-02   +1.037033444859709e-01   +1.269339048328077e-01   +1.924163676841643e-01   +2.317035485669918e-01   +1.590607932547214e-01   -3.214461489494842e-02   +5.460788043714437e-02   -1.568220445762303e-02   +1.128727316270624e-01   +1.951748089711141e-01   +3.163082447875919e-02; +1.857297354310788e-01   +6.921289554163973e-02   +1.109173560630390e-01   -9.612635192000443e-02   +2.820689054590454e-01   +2.668855154004280e-01   +2.065200537284913e-01   +7.099909953523524e-02   -5.953387920798859e-02   +2.223479834847648e-02   +3.644820207443339e-01   +8.883726557691528e-02   -1.000906065727302e-01   +4.411890828895297e-02   +1.062353921206066e-01   +1.609096608134467e-01; +6.685571046501500e-02   +1.819801194689133e-01   +8.008899091888969e-02   +1.785459325499673e-01   +8.700372538079802e-02   +2.456765822619965e-01   +1.875919950405731e-01   -1.307545277570205e-02   +1.975415102921156e-01   +2.063843948703080e-01   +1.789305279516908e-01   +4.989244843402507e-02   +3.010626758512015e-01   +1.826238237226681e-01   +2.225034920185418e-01   +2.083668278154501e-01];
L2I_L2E_iAMPA_netcon = [+2.768507473034326e-01   +1.284345910094691e-01   +1.846846459806561e-01   +1.850399689736200e-01   +2.418845376789034e-01   +3.713271209127576e-02   +8.574495014835751e-02   -1.402391861795032e-02; +3.114411606748617e-01   +6.052255194606974e-02   +8.093338671210568e-02   +1.908417826457802e-01   +2.286610676566097e-01   +1.164645235976697e-01   +2.067903205821469e-01   +1.127305472616273e-01; +2.316929714905982e-01   +3.195518302031942e-02   +3.932440289220310e-02   +1.319971636866630e-01   +2.393147963274139e-01   +1.782548513804620e-01   +1.800683156536350e-01   +1.996195660417124e-01; +1.746551431366443e-01   +1.991637650695594e-01   -2.812927261640355e-02   +1.242670745711314e-01   +2.699488004608141e-01   +2.869837692837638e-01   +1.190157030933747e-02   +6.375842814080811e-03; +1.377012987378368e-01   +6.457479598906536e-02   +1.085881559350804e-01   +7.948941170495713e-02   +1.695545092200989e-01   +1.434593688294126e-01   +1.051116351743689e-01   +1.290335876517339e-01; +1.620912722561369e-01   +1.513401067249992e-01   +3.123838274790264e-02   +1.250805571640671e-01   +2.223798707856941e-01   +1.912723105892166e-01   +1.842866412189809e-01   +9.357943208351907e-02; -1.469369243932642e-02   +6.361381692292359e-02   +2.443745546111073e-01   +1.258928919889588e-01   +1.528298551036667e-01   +1.335585767307216e-01   +2.659827588632213e-01   +1.101536145951522e-01; +2.588933495469803e-01   +3.264199603199205e-01   +2.406612900729904e-01   +1.181732471456071e-01   -7.239510835080291e-04   +4.220998437149219e-02   +8.000973538747025e-02   +2.474799882390806e-01];
L2E_L2I_iGABA_netcon = [+2.727603935125015e-01   +1.638739469158344e-01   +2.194458822573390e-01   +2.815583137170301e-01   +1.977999633552146e-02   +3.058940757330063e-01   +1.637960010806262e-01   +6.197602524052000e-02; +2.105501899210325e-01   +2.668418953931077e-01   +2.180871743711792e-01   +7.198200383352370e-02   +2.265609402756596e-01   +1.819650044058042e-01   +8.529921093757127e-02   -1.030335349522810e-01; +3.124144200670471e-01   +9.844217351296602e-02   +1.584818938758395e-01   +1.971639043023560e-01   +1.589633777914259e-01   +1.685921133132386e-01   +2.192358158067954e-01   +2.009087166805026e-01; -8.329005385291750e-02   +1.958926389240535e-01   +1.767193993399068e-01   +1.286864115151584e-01   +2.011869217040453e-01   +8.533231687220699e-02   +1.613549094196000e-01   +1.640903126356060e-01; +1.820417154523591e-01   +1.058866210683937e-01   +2.121049143470675e-01   +2.081258229618842e-01   +1.129335465015757e-01   +1.732036966413460e-01   +1.527508860321112e-01   +1.679791292936607e-01; -5.022214296550360e-02   +2.967938173699777e-02   +1.667280814678742e-01   +1.707328409448369e-01   +2.152129688284279e-01   +2.968596799846697e-01   +2.518980513736414e-01   +1.924154292598655e-01; +2.614282681704165e-01   -2.529612230842302e-02   +1.872080178950398e-01   +1.200850387473805e-01   +1.814529487510927e-01   -2.055784450247395e-02   +2.393404020463999e-01   +1.376420094020236e-02; -4.618054584577645e-02   -6.071819706403874e-02   +1.579294310663810e-01   +1.608382878742003e-01   +1.372346751873602e-01   +1.630792361285430e-01   +2.250790247105180e-02   +1.942183314546932e-01];
L3E_L2E_iAMPA_netcon = [+1.483049926669546e-01   +1.738715257422334e-01   +2.383579284118033e-01   +8.268929185168628e-02   +3.305091165349927e-01   +1.519726953251701e-01   +2.627172463081555e-01   +8.511218383000163e-02   +1.054951065195802e-01   -6.152590124931727e-03   +1.174619813152401e-01   +1.943174257549329e-01; -8.553479721500810e-03   +1.731014862775152e-01   +6.359489262706315e-02   +1.044266391513943e-01   +1.856402460297971e-01   +8.918888834163462e-02   +2.197364224535449e-01   -5.298526420629445e-02   +2.872142354488336e-02   +1.172008095005234e-01   +1.089011376124668e-01   +2.154990189305339e-01; +1.313583963211365e-03   -9.335280102354473e-02   +2.390583674254809e-02   +6.947552222810320e-02   -2.853403428283376e-02   -4.340007827362864e-03   +2.804283596850217e-01   +1.397803455486339e-01   +1.166956746622913e-01   +1.853532412556300e-01   +3.329577155324911e-01   +1.071070192123110e-01; +1.657512501668808e-01   +1.152107204312000e-01   +1.338722845683379e-01   +1.606449676423688e-01   +1.228508589066938e-01   +5.185182783819586e-02   +2.496134310747885e-01   +2.932767443845770e-01   +1.680359601372921e-01   +2.447853242971149e-01   +1.805349264165155e-01   +1.385494688956412e-01; +1.770285443283364e-01   +1.469824550896763e-01   +1.901422589533819e-01   +1.764356634503395e-01   +6.750530345175769e-02   +1.779999468996409e-01   -1.208141790743645e-02   +2.407748252718113e-02   +3.283623171895292e-02   +8.131017539448111e-02   +1.573729274074019e-01   +2.371795139685987e-01; +2.721417889232055e-02   +1.151791247716443e-01   +4.298249786711164e-02   +2.766282704518855e-01   +1.420812012585485e-01   +5.716921686734801e-02   +7.828677957487880e-02   +2.521637996093758e-01   +1.871291447267888e-01   +1.308517108709140e-01   +2.415464640788450e-01   +3.145205099518308e-02; +1.368877373291306e-01   +1.864538396539565e-01   +2.151498608147333e-01   -1.112478175473302e-01   +2.047693508182554e-01   +2.686805638978259e-02   +2.753103850380079e-02   +1.838627797235675e-01   +1.446719455815739e-01   +6.755152071074236e-02   +3.230746458127715e-02   +7.062112683856070e-02; +1.494243988891254e-01   +1.429338853492154e-01   +1.327788322091372e-01   +2.052697246336577e-01   +1.858511218571381e-01   +2.274471404551087e-01   +1.864600797926217e-01   +1.189109755189832e-01   +2.312789158945844e-01   +2.497040052566767e-01   +8.975318435571164e-02   +1.831145479817009e-01];
L3I_L2I_iGABA_netcon = [+1.002350784530138e-01   +1.373690101114412e-01   +2.623798221701654e-01   +7.013080009445818e-02   +2.120501034057876e-01   +7.654410142622385e-03   +1.493563975159498e-01   +1.395348604663950e-02   -8.122240988532804e-03   +7.364683631741199e-02   +3.653700410691892e-02   +2.467769809665399e-01; +1.341429408548155e-01   +3.688660082031215e-03   -1.514099806089494e-02   +3.061671293453115e-02   +8.721579114611859e-02   +2.125651373956713e-01   +1.295985026432282e-01   -3.473947661163306e-02   +1.570242947584700e-01   +2.065739292274339e-01   +7.643899637696888e-02   +2.059812943621782e-01; -2.744969805746341e-03   +1.490389726619134e-01   +9.401072863620354e-02   +2.894613545327991e-02   +1.853706065305781e-01   -2.750583315894308e-03   +1.547515179969083e-01   +2.370889873831513e-01   +4.236500415348235e-02   +6.279599843420712e-02   +1.631139073228121e-01   +2.502988112432664e-01; +1.799876343733122e-01   +1.177178635073845e-01   +2.327648511200643e-01   +1.755547781528531e-01   +1.438497777357446e-01   +2.716780467564312e-01   +4.363549802027949e-02   +2.109722144184520e-02   +1.640263263938451e-01   +2.418200758882985e-02   +2.265344841342464e-01   +3.393107699657615e-02; +1.012170738145533e-01   +1.841540927119557e-01   +5.060342214425155e-02   +2.525581327998149e-01   +1.932208926457318e-01   +1.127516202677419e-01   +1.555846273941755e-01   +2.786864112373835e-02   +2.956000249250150e-01   +6.713572719862067e-02   +1.191825749683115e-01   +6.664852456370887e-02; +1.718233693424156e-02   +5.783041708409931e-02   +2.721935148374360e-01   +1.022263283538146e-01   +8.359960119551024e-02   +7.111115101047472e-02   +9.338475668214362e-02   +1.103232765499901e-01   +2.346314957560274e-01   +1.335228841246127e-01   +1.908663365925494e-01   +7.402990393670651e-02; +2.027181151793115e-01   -3.903129810391902e-03   +1.384105601798703e-01   +2.186787881072827e-01   +1.795996733307658e-01   +6.214596670229002e-02   +3.265815658638102e-01   +1.903010463806022e-01   +9.275592005286638e-02   +1.726408185370130e-01   +1.837439704619928e-01   +1.424865840911256e-02; +1.170712216553888e-01   +2.097643386729022e-01   +5.975074047652518e-02   +1.664789275702783e-01   +9.707384342438845e-02   -4.958918398142426e-02   +5.660637137744537e-02   +8.415642055849094e-02   +6.034978372224005e-02   -8.418180408844657e-02   +8.045944939007200e-02   +7.366341450852211e-02];
L2E_L3E_iAMPA_netcon = [+2.095298138818679e-01   +1.143362605195803e-01   +2.873545552745390e-01   -6.552088685545450e-02   +7.799077279587140e-02   +1.450920826121213e-01   +8.602999062741282e-02   +1.382499608132765e-02; +2.567318841295610e-02   +1.746409800585792e-01   +2.897083061110349e-01   +1.360970297900295e-01   +2.817918589360583e-01   +1.577792366736331e-01   +1.113467974480730e-01   +2.562971146389593e-01; +1.789511216380815e-01   +1.718970793948975e-01   +1.877867139481419e-01   +2.127678520746195e-02   -4.960119553316010e-02   +3.002001678460972e-01   +1.959577605555732e-01   +2.688116412347409e-01; +1.094404769473706e-01   +1.567904497133099e-01   +6.351088519033345e-02   +2.464761142506726e-01   +7.182294297787052e-02   +6.121221908611196e-02   +2.088368486540375e-01   +2.877179712389706e-01; +1.435697143015723e-01   +1.087142370548514e-01   -4.293897507557569e-03   +7.795299036563475e-03   +1.468503584172192e-01   +1.319001548161374e-01   +1.643062401574095e-01   +2.142928401448973e-01; +9.650823678093695e-02   +2.314253531005057e-01   +1.963516760546165e-01   +8.142658666925517e-02   +1.750585423232207e-01   -5.962762638231914e-02   +2.577940054364955e-01   +1.103173311424674e-01; +2.014525922207588e-01   +1.916729009365424e-01   +9.619286109578561e-02   +1.349625841764230e-01   +4.278876388086139e-02   +1.795553119287603e-01   +1.469756838815894e-01   +9.711118351925936e-02; +1.620655170423416e-01   +7.788778189054463e-02   +1.130534234631795e-01   +4.813168302661422e-02   +5.993859648047366e-02   +1.140101227320861e-01   +1.587612135325339e-01   +1.317614865581930e-01; +1.948723968181138e-01   +2.013936025348481e-01   +2.226878578516559e-01   +2.480184232345576e-01   +1.407319883479473e-01   +1.246929706475271e-01   +2.299810497399834e-01   -4.061739230232303e-02; +2.072586855690179e-01   +2.123983530188971e-01   +1.609997561967604e-01   +2.389110138269203e-01   +1.049856002206351e-01   +9.843988505288961e-02   +2.568753008540032e-02   +6.239165736255358e-02; +2.126302409366422e-01   +1.587188428281213e-01   -5.561951987474392e-02   +6.920000749208552e-02   -1.732931854599892e-02   +1.848025319952170e-01   +1.457174377400381e-01   +2.828356639147414e-01; +2.221229911384177e-01   +2.551098507022304e-01   +1.495450808423005e-01   -3.179107591590111e-04   +1.508235461482539e-01   +1.660966819445160e-01   +1.302786871672338e-01   +2.372073929495077e-04];
L2I_L3I_iGABA_netcon = [+8.955767849190627e-02   +1.050382784893478e-01   +1.496975519477759e-01   +2.197365439336194e-01   -3.655600853486535e-02   +1.518803557737613e-01   +1.700876995845153e-01   -3.832969762597948e-02; +2.705530244209999e-01   +1.197240607404897e-01   +1.007699012325793e-01   +1.212875157859360e-02   +2.435746242544891e-01   +4.090970118363633e-02   +1.524443098955271e-03   +1.263463367325036e-01; +9.820826063619005e-02   +7.596050780760207e-02   +5.051635652130854e-02   +9.859204347915475e-02   +1.193923955611494e-01   +2.279347211743650e-01   +1.817061247087339e-01   +1.817365486003583e-01; +2.555244491780539e-02   +1.149429992173896e-01   +2.405563874829860e-01   +2.578983313171527e-01   +4.222784391924463e-02   +1.590710882508838e-01   +1.732001461902469e-01   +2.237746431313593e-01; +9.608402154070192e-02   +7.489859544128208e-02   +1.152700489004831e-01   +4.418554095180464e-02   +6.699050186495464e-02   +1.872184936144580e-01   -4.314740234399154e-02   +3.896793481864989e-02; +1.602389962811473e-02   +2.059350728001714e-01   +2.414753909062169e-01   -4.253288896996046e-02   -4.945508642407557e-03   +1.017335809093063e-01   +7.180303350898318e-02   +1.526033623975962e-01; +4.921950317995531e-02   +1.995616003734424e-01   +2.418765084999375e-01   +1.119554413108965e-01   +8.081595952083717e-02   +1.253067595532939e-01   +1.716376910965217e-01   +3.406964055117733e-03; +2.199181114651232e-01   +2.189324855150605e-02   +7.732708657180863e-02   +1.372205514543457e-01   +2.387448588220503e-02   +1.152814189164950e-01   +8.901737032743104e-02   +1.668868510220508e-01; +1.210427168395204e-01   +3.944529489860864e-02   +1.499835548926777e-01   +1.394914811944454e-01   +7.157531966753788e-02   +4.280146035119475e-02   -1.338889388336932e-02   +1.635194526498665e-01; +1.490046064057265e-01   +3.331255922102883e-02   +2.646604968012772e-01   +1.281906419551571e-01   +1.379068645938682e-01   +2.713708966229765e-01   +2.847051523589316e-01   +1.234634811784952e-01; +1.430556203330593e-01   +3.870306073986441e-02   +1.416002366296289e-01   +2.790467614789584e-02   +8.393334937879959e-02   +7.699721871049600e-02   -1.092015114522604e-01   +9.222683407230677e-02; +1.757414646999834e-01   +1.361948887458186e-01   -1.683275073494803e-02   +6.720333986218441e-02   +1.355899679882236e-01   +1.758534137831612e-01   +2.527939206651122e-01   +2.134974945434601e-01];
L3I_L3E_iAMPA_netcon = [+1.253802597630563e-01   +1.321102601280633e-01   +1.806900635485126e-01   +1.469792101945012e-01   +2.648023755800067e-01   +4.602507730486566e-02   +2.199994964063401e-01   +2.014641083538498e-01   +8.460761095733448e-02   +2.447642351392609e-02   +1.396515844437871e-01   +1.138335819160951e-01; +1.523266385667582e-01   +8.871225490854947e-03   +9.939846147457630e-02   +2.342356534146884e-01   +3.016619754577651e-01   +7.334363598716029e-02   +6.281343947255172e-02   +5.040154085803298e-02   +1.465222856025586e-01   +1.191670292695756e-01   +3.067267033074270e-01   +2.261665880366086e-01; +1.973835037543905e-01   +1.034394323389526e-01   +4.907277536475552e-02   +1.451634011512227e-01   +8.140506961462284e-02   +3.029886141016030e-01   +2.087175746193644e-01   +1.476713938020246e-01   -6.067309864802547e-02   -3.256540184029436e-02   +1.045108023462341e-01   +3.279657775710264e-02; +6.501291804999111e-02   +1.299641002753263e-01   +3.064240967616979e-01   +2.660369418075312e-02   +1.190129474074291e-01   +1.197649962543347e-01   +1.868395638327201e-01   +1.260279470698976e-01   +2.122825528391637e-01   +1.789354375427485e-01   +4.558118808317416e-02   +4.288002758943816e-02; +1.828969184737492e-01   +1.908185590220982e-01   +1.249703714665239e-01   +1.561488678542537e-01   +1.306969394104152e-01   +2.388324596192399e-01   +1.835697930274875e-01   +1.960961924383998e-01   +1.473145899104374e-01   +1.160936677120902e-01   +7.410374148233072e-02   +1.170670802788429e-01; +8.461575679833667e-02   +1.646079528846415e-01   +2.581937611049238e-01   +1.589071903835812e-01   +1.023736800803698e-01   +5.169093149711607e-02   +1.161835695626719e-01   +1.440075520148914e-01   -3.962030500517175e-04   -1.489710164544799e-03   +1.808198355689080e-01   +1.050926466772983e-02; +7.285483105931527e-02   +1.239319422864370e-01   +2.953947267499127e-03   +1.684093058456698e-01   +2.326874567680555e-01   +1.772964754483592e-01   +4.896165412224347e-02   +1.708783400886891e-02   +2.303197612186842e-01   +7.540474900495926e-02   +2.555807850596234e-02   +1.774476398517609e-01; +6.173738239468853e-02   +2.259110508201058e-02   +2.516113648007191e-01   +1.818813202049875e-01   +1.174286482260879e-01   +1.556723112046791e-01   +5.092618331645347e-02   +1.785806561527216e-02   +1.303320426224291e-01   +2.444189664998762e-01   +8.536373882522211e-02   +9.256345650511584e-02; +5.535841871307100e-02   +1.715784817199854e-01   -3.726060773410641e-02   +7.425092560920166e-02   +1.795865841750592e-01   +7.078249490145710e-02   +2.781997804724141e-01   +1.371209637543995e-01   +2.112694047685483e-02   +1.435673219226953e-01   -5.271825144594693e-02   +1.726369806659013e-01; +9.898697082276657e-02   -4.263415180919619e-02   -5.119658855147831e-02   +5.075028777157235e-03   +1.768855237918568e-02   +4.430664855572463e-02   +9.340619763381865e-02   -7.550992326567486e-03   +1.066656318927911e-02   +2.350404957121081e-01   +1.780430929605988e-01   +1.228881428202142e-02; +1.412129412062990e-01   +1.654681686099590e-01   +5.859616935923925e-02   +1.945682768139336e-01   +7.214815412792187e-02   +1.428491248742841e-01   +1.338783438547919e-01   +3.321331335301785e-01   +1.541064502132632e-01   +6.405850299460648e-02   +1.717648555483359e-02   +1.583349401257339e-01; +9.222437840288038e-04   +1.289040694846202e-01   +7.510700320594020e-02   -2.012352314066986e-02   +1.339598696909685e-01   +1.185437197776795e-01   +5.834476531084690e-02   +1.953939747856267e-01   +1.086055639869680e-01   -3.495193738576195e-02   +1.807295021812140e-01   +5.808032892562352e-02];
L3E_L3I_iGABA_netcon = [+1.702579495664425e-01   +5.306208490431531e-02   +6.466054426581273e-02   +8.772236393113907e-02   +1.125105825275315e-01   +1.270957612217292e-01   +1.502817498764714e-01   +4.551513548553118e-02   +2.367785895679350e-02   +2.611713057406261e-01   +2.044241471252752e-01   +2.260937480609581e-01; +7.999256839301656e-02   +1.230041262712768e-01   +1.100034046631303e-01   -3.343060445058358e-02   +2.177208457036850e-01   +2.289060695394328e-01   +2.583723394959369e-01   +1.321233217404025e-01   +2.702977851804223e-01   +9.785054934703932e-02   +3.009983939824705e-01   +1.879627488327257e-01; +1.050621375684582e-01   +1.767952956257476e-01   +2.618674824420540e-01   +1.456941284864604e-01   +2.813696443101762e-01   +8.407023065068592e-02   +6.242994534777274e-03   +2.264382714467597e-01   +2.031075566373338e-01   +2.280718000720127e-01   +6.368136646900935e-02   +7.839473093087787e-02; +2.358565331492873e-01   +2.526900949113033e-01   +1.890654332345354e-01   +1.159248197805249e-01   +2.450925587548567e-01   +2.329314760747156e-01   +2.110029682888136e-01   +1.196371805912536e-01   +1.813246623267064e-01   +1.436104091056909e-01   +2.182003621227508e-01   +7.970374851467825e-02; +1.970565600896338e-03   +2.076328713991974e-01   +2.262390903724399e-01   +6.954156131460831e-02   +8.927386316531571e-02   +2.592502310480236e-01   +9.685984955865705e-02   +1.849929132006747e-01   +7.140912631715028e-02   +1.794378361220558e-01   +2.565584228623634e-01   +2.209883008601764e-02; +1.137690961673288e-01   +5.709449257767533e-02   +2.406960230910654e-01   +2.980891328558053e-01   +1.683542289914900e-01   +6.983299545738500e-02   +9.132437699957989e-03   +2.271995354471726e-01   +1.018617685298749e-01   +6.277606587931268e-03   +7.750173079580902e-02   +5.975230088295646e-02; +2.461512278982832e-01   +9.105076298600630e-02   +3.001162580308216e-01   +7.695155831336557e-02   +1.252529258433411e-01   +8.252240629178852e-03   +1.934799134966935e-01   +5.862195798092590e-02   +3.818378044199967e-02   +1.399842296031270e-01   +1.283996568588668e-01   +1.433494397349806e-01; +2.063380331106179e-01   +8.890043861621955e-02   +1.062337642990051e-01   -3.189264863986339e-02   +1.215149438932814e-02   +3.014553439385828e-01   +6.058900984707573e-02   +2.436342651376801e-01   +1.064408617085755e-01   +3.076546888488040e-01   +2.380532731395598e-01   +6.269120072241451e-02; +8.761389203284289e-02   +3.175817043282032e-01   +1.358126738077786e-01   +2.008737546020781e-01   +1.409169756597985e-02   +4.827574150073145e-02   +2.790415676811837e-02   +2.099611268605246e-02   +1.653329151203541e-01   +2.156903644306344e-01   +1.944333865408981e-01   +9.118581810583898e-02; +1.608762846581756e-01   +2.666275890171413e-01   +9.777987794381590e-02   +4.385475788445825e-02   +6.163763276516796e-02   +6.197591073273206e-02   +1.392968826213736e-01   +9.679645914247755e-02   +1.647605920372379e-01   +1.223486362919535e-01   +1.313315728086155e-01   +3.400951400308908e-01; +1.987986583538834e-01   +2.525209810510065e-01   +1.720301230961041e-01   +1.547891008570461e-01   +8.702712661835345e-02   +2.505832512030035e-02   +1.593805328140816e-01   +7.979638829665741e-03   +3.099338986344375e-02   +5.402884190441311e-02   +2.826408478586020e-01   +6.986248866692386e-02; -7.783661206129448e-03   +1.807173008151045e-01   +1.852765650212471e-01   +2.121170762961243e-01   +2.422378316755763e-01   +2.203085539168996e-01   +4.733746799048263e-02   +8.552923975105947e-02   +1.804621274261609e-01   +2.113926761858909e-01   +2.985611927075115e-02   +5.449485403532780e-02];
L2E_Input1_iAMPA_netcon = [+2.089039118946332e-01   +5.870676367513487e-02   +5.666327926141537e-02   +1.707456554076990e-01   +9.396370573868663e-02   +1.674963745553230e-01   -1.061418245524952e-02   -4.320698250181434e-02];
L2I_Input2_iAMPA_netcon = [+1.796009546082316e-01   +8.080609598394484e-02   +2.646457303350489e-01   -3.450806016313447e-02   +2.394636054027421e-01   +2.467971708247614e-01   +1.789800191682155e-01   +1.834307529742838e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
