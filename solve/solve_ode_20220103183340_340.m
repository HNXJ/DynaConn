function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.131930683383639e-01   +9.475189329814629e-01   +7.005495392126956e-01   +1.617020337481971e-01   +9.215933728621556e-01   +2.117876275683259e-01   +7.422287997575477e-01   +3.050312484125567e-01   +5.353767879399917e-01   +8.343680788128861e-01   +9.705639970004252e-01   +9.705450972438214e-01   +6.991630973656576e-01   +3.701976102685548e-01   +2.969047607185395e-01   +3.819325601062853e-01; +3.504681633677492e-01   +1.173576454451441e-02   +1.397415250256230e-01   +1.713273413769478e-01   +7.746012835698558e-02   +8.116195237376232e-01   +7.982955895397609e-01   +7.574500208503967e-01   +7.913053899936482e-01   +1.862039972704870e-01   +4.747930917740077e-01   +6.661696802288224e-01   +3.698367199509391e-01   +2.771492696840581e-01   +6.854105311613804e-01   +9.600051391186378e-01; +2.017155481190798e-01   +4.762523445464362e-01   +8.121649346222591e-02   +7.097224632977064e-01   +3.131472615639649e-01   +3.817796734433178e-01   +6.602931329225478e-01   +9.542344553910775e-01   +4.758123399235822e-02   +9.260214620352075e-01   +8.721804449621935e-01   +2.031044603268615e-01   +5.462955032831092e-01   +7.199788377960324e-02   +7.785815760140045e-01   +8.117225918573414e-01; +2.335583137677613e-02   +4.888304076984000e-01   +4.331015543561225e-01   +8.415719850891163e-01   +6.351688443009061e-01   +8.667280843265956e-01   +4.416745543661446e-01   +7.968996160766430e-03   +4.639783339360243e-01   +4.225519195103967e-01   +9.435189150095811e-01   +8.970227769806248e-01   +5.137342066694928e-01   +1.541694517714221e-01   +7.188264928262799e-01   +8.933924701219095e-01; +7.655255841432461e-01   +5.192423789036205e-01   +9.021636515791666e-01   +8.089289515535805e-02   +9.094368189616934e-01   +3.208905646366814e-01   +5.806198244450690e-01   +4.046313447284411e-01   +9.425184352361514e-01   +2.992578196121294e-01   +2.378909325317144e-01   +4.839714335109681e-01   +7.677721523486996e-01   +3.670398895343593e-01   +2.761706720027544e-01   +7.220621254024130e-02; +5.739078066065448e-01   +2.853744583630546e-01   +7.260523314344653e-01   +8.375890144831314e-01   +7.989961053396402e-01   +3.809575276256921e-01   +5.173884641834217e-01   +1.549905518446491e-01   +4.749446209819376e-01   +3.509111504799273e-01   +9.236354753631627e-01   +6.635978063237936e-01   +7.492282963426564e-02   +7.153728919602211e-01   +1.798762172522978e-02   +9.045603534291392e-01; +5.807056181273614e-01   +5.637710146903245e-01   +6.839491572209830e-01   +5.486941671937530e-01   +6.466576989305293e-01   +6.432574278348483e-01   +7.256160669867571e-01   +8.270950587883931e-01   +7.786965678489763e-01   +9.745665525629372e-01   +6.341008194939697e-01   +5.260933276245694e-01   +5.332385006992991e-03   +5.361744003086492e-01   +1.620418705761256e-02   +6.715869854145948e-01; +3.886363542200601e-01   +5.135299077352919e-01   +2.064794065870978e-01   +9.655811790625718e-01   +4.430001584460748e-01   +3.895849612502109e-01   +2.191401839848802e-01   +2.857220911989819e-01   +1.115956356383570e-01   +5.368264355574082e-01   +2.897414091577126e-01   +7.034799900071804e-01   +4.081301949449163e-01   +2.330760320866369e-01   +9.335157937676815e-01   +3.469842204290237e-01; +5.545792811987287e-01   +6.708802143184506e-01   +5.268081468553544e-01   +6.748227416656044e-01   +7.502235133829120e-01   +7.317018577308340e-02   +9.985208040125518e-01   +9.780907039625670e-01   +5.191173965203769e-01   +7.919138622054939e-01   +8.502777171803724e-01   +7.203457965512970e-01   +6.608793332902816e-01   +4.733402336172430e-01   +9.353141813279208e-01   +8.429018163011454e-01; +1.859180860483774e-01   +6.172897728265830e-01   +8.264570092850041e-01   +3.358977733643650e-01   +8.307624014574542e-01   +1.823295550033884e-02   +6.225315980399904e-01   +6.251086091176723e-01   +6.388596730449360e-01   +8.002745470149181e-01   +1.613732275940194e-01   +2.933856289538631e-01   +3.758362182359373e-01   +7.198195885871576e-01   +3.757669005338933e-01   +1.959066061761414e-01; +1.191618380550996e-01   +5.655199861931045e-01   +1.798766954134461e-01   +2.183900827399339e-01   +3.469266064345044e-01   +8.751886110398185e-01   +9.858019766787637e-01   +7.476990411447523e-01   +5.789601708681017e-01   +1.403513703190958e-01   +8.270190553256863e-01   +1.153727603862528e-01   +3.962325798234601e-01   +5.217589092815914e-01   +1.043348662515618e-01   +8.441443015295582e-01; +5.547357113541661e-02   +5.058692295271832e-01   +5.148026671094296e-01   +5.708015809364572e-01   +1.469820512244487e-01   +1.563761885640253e-01   +4.954710755491516e-01   +8.820579339977705e-01   +8.379355884613655e-01   +4.558461103118567e-01   +2.175713119157742e-01   +3.277856784461676e-01   +1.349997981806342e-01   +5.171869517965839e-01   +7.228439963061700e-01   +4.252371319746955e-01; +9.401345630015073e-01   +6.613365435817371e-01   +3.556311894509804e-01   +3.882076737299631e-03   +5.030358726973924e-01   +9.228727667428321e-01   +5.214963742807628e-01   +3.309223317800966e-01   +1.168254604018796e-01   +4.530559741483071e-01   +2.685860469858489e-01   +4.639237846464574e-01   +3.395738963638482e-01   +3.898790684278071e-01   +4.535251587048576e-01   +5.596698585136816e-01; +7.448511541238665e-01   +6.394588796570708e-01   +6.520182948365066e-01   +5.933363173789444e-01   +4.151198230872354e-01   +5.629433111170100e-01   +8.557542157623819e-01   +9.402312927031553e-02   +5.246235481800757e-02   +9.627062720492890e-01   +8.980134312375573e-02   +7.163201919005131e-01   +1.242100429115871e-01   +4.818379992269541e-01   +1.353723625917638e-02   +4.479142964809304e-01; +2.395779215910147e-01   +1.415837684009928e-01   +2.778699003396378e-01   +8.972309161829928e-01   +1.760218844105647e-01   +9.238441953272349e-01   +2.506226212973227e-01   +4.477869187078209e-01   +5.250510370165170e-01   +5.273522859694752e-02   +9.166598032077564e-01   +4.004972792042304e-01   +3.694914136819361e-01   +7.436529170409678e-01   +1.195472267956317e-01   +7.608463696976006e-01; +2.019237317252822e-01   +1.784388555232810e-01   +4.329323125173306e-01   +2.591582930003095e-01   +4.955103927247853e-01   +5.990018915357546e-01   +5.768317312333906e-01   +2.362224404036864e-01   +7.024471034998803e-01   +3.878904100317129e-02   +7.302386897706095e-01   +2.402752774011584e-01   +2.483050381527565e-01   +7.063886392591003e-01   +6.582053476663615e-01   +9.620943131852935e-02];
L1E_L1I_iGABA_netcon = [+8.391470082205228e-01   +7.495034865867917e-01   +8.741754304281925e-01   +4.375389161700214e-01   +9.220005820545455e-01   +7.690902887904930e-01   +3.205851152598156e-01   +6.394745887191634e-01   +9.367402119486880e-02   +2.943181725615246e-02   +1.337836487728635e-01   +5.218419705034715e-01   +8.728913620016624e-01   +5.741796376449764e-01   +1.708406296181385e-01   +6.307306199255921e-01; +6.146440047879604e-01   +9.939100695081907e-01   +3.116961791704315e-01   +1.470789614443939e-01   +8.849836151273495e-01   +2.751974995256670e-01   +9.662865696169671e-01   +4.356505498740437e-01   +2.931456066049198e-01   +5.084554454875380e-01   +4.297089497750656e-01   +2.032025758933129e-01   +8.049323250770775e-01   +2.890030759517732e-01   +5.836589641952156e-02   +3.408952166371013e-01; +6.665952749999595e-01   +3.725777771032702e-01   +4.327340278012368e-01   +6.503924431289788e-01   +5.894430424696551e-01   +5.240067092563730e-01   +3.534415640728287e-01   +4.846355297782652e-01   +3.295050597942182e-01   +8.647531966552729e-01   +4.821712775026987e-01   +7.708973151038218e-01   +6.401091937067661e-01   +1.380408142353670e-01   +2.138717544600332e-01   +1.547674790234469e-01; +7.810349125803615e-01   +5.030794060750630e-01   +3.794658897241832e-01   +7.255449108690347e-01   +8.375519654144793e-01   +4.075837882073329e-01   +3.205940098614962e-01   +1.003669412957405e-01   +4.797502430988934e-01   +5.820842312020854e-01   +6.715336952323507e-01   +3.861937104624246e-01   +7.330379287393916e-01   +4.443745991735652e-02   +2.092860347881275e-01   +4.014934441367030e-01; +3.121445257142450e-01   +7.526345385078191e-01   +6.552572589349155e-01   +1.681799190269171e-01   +7.786172100699782e-01   +7.836721150088997e-01   +9.128003516720425e-01   +8.074664964643428e-01   +2.428635301450869e-01   +4.254373710667995e-01   +3.530503174025433e-01   +6.646561407123595e-02   +6.681417763306415e-01   +6.232052489277530e-01   +2.181368478397014e-01   +9.129935965534915e-01; +3.284734282212806e-01   +1.334696691718584e-01   +2.442023086907761e-01   +3.419827643308980e-01   +7.881484147882513e-01   +2.565710476466658e-02   +8.837145264494121e-01   +6.060433508377943e-02   +4.584333987603493e-01   +7.181061349322615e-01   +4.825757803799308e-02   +7.559846319343460e-01   +8.898575486647730e-01   +6.058393404536055e-01   +5.783250262004904e-01   +1.577660838931353e-01; +6.323971034313958e-01   +5.138941866308299e-01   +6.860953123280854e-01   +1.061943642759659e-01   +6.957566129741312e-01   +4.076760696877684e-01   +3.584623666709755e-01   +9.565488172448897e-01   +7.577847418391800e-01   +2.289124752647531e-01   +2.926872784082233e-01   +4.562478612978090e-01   +8.538433108749998e-01   +3.716806332845559e-01   +3.563836586229992e-02   +4.668320695173674e-01; +9.019408887053496e-01   +9.059639437102753e-01   +3.299435069430974e-01   +4.341365574281402e-02   +1.990885320355243e-02   +8.277552699191874e-01   +7.453594330608001e-01   +7.709246757695657e-01   +7.138230444205362e-01   +5.678349116890887e-02   +7.975580033509994e-01   +3.176624733618481e-01   +4.089329764497051e-01   +8.347409132249322e-01   +7.957375446832499e-01   +7.680422490090996e-02; +3.740857301202913e-01   +1.021606086150912e-01   +8.753929639312383e-01   +4.747383660134120e-01   +3.248669855399370e-01   +5.908445735882232e-01   +1.266434679420759e-01   +4.430489516296894e-01   +2.298416606805707e-01   +9.794450561886060e-01   +6.518103495698170e-01   +2.749884164445665e-01   +1.099495146907409e-01   +5.176967782040413e-01   +1.346242920067716e-01   +3.377346768757720e-01; +8.825655828190481e-01   +1.794857085645913e-01   +9.980422111038798e-01   +4.780053250842562e-01   +9.450065456227661e-01   +2.127690075510116e-01   +5.938684096817878e-01   +1.648523245725743e-01   +7.025950783931555e-01   +9.711308864399028e-01   +7.067592085083158e-01   +5.742668723136363e-01   +4.074386754182140e-01   +8.080538925068450e-01   +5.778802427534401e-01   +4.918839468212575e-01; +1.186252791245340e-01   +1.782996922829676e-01   +6.842841950684182e-01   +5.500708700458903e-01   +4.062898672436841e-01   +2.959125525999237e-01   +4.394981054942560e-01   +8.301969476413949e-02   +3.051617515349692e-01   +1.344901474219314e-01   +7.578382202421465e-01   +9.092877025339812e-01   +3.375603478450096e-01   +5.736207243053294e-01   +8.555652000012179e-02   +4.973237576649934e-01; +9.284654937627228e-02   +5.395417544214646e-01   +3.449046937563641e-01   +6.506820478762624e-01   +6.302655020939061e-01   +2.673403581676446e-01   +9.619912977790808e-01   +7.394827843053594e-01   +4.659579454340649e-01   -5.012349988304582e-04   +3.887667788688510e-01   +4.512008426474554e-01   +1.133284962796565e-01   +7.122069784922170e-01   +2.252198454090657e-01   +1.286753061260070e-01; +5.444076212539622e-01   +9.745694225159131e-01   +5.628393649886306e-01   +3.481816787773975e-01   +8.535404653032507e-01   +9.336838305333734e-01   +9.721795303471029e-01   +5.356363821865150e-01   +4.422633741511537e-01   +9.292929620100109e-01   +3.645296366568363e-01   +9.800835882031343e-01   +8.569895653308329e-01   +7.358796612554945e-01   +4.486367171547272e-01   +7.977095147394649e-02; +6.035888341050099e-01   +8.443964442132162e-01   +8.928781004818575e-01   +2.538913073775808e-01   +3.712664926557018e-01   +5.529437136066223e-01   +2.483629311578586e-01   +4.868199937139208e-01   +7.317611804290953e-01   +7.379087657489509e-01   +8.141619339647396e-01   +1.063389247436451e-01   +8.943866036217955e-01   +4.469686997952925e-01   +1.784551579561523e-01   +6.748752641515846e-01; +7.272915966715124e-01   +6.702458622572560e-01   +6.486649728932181e-01   +1.817414235758753e-01   +2.030057986573319e-01   +4.322655583475267e-01   +7.739043367083241e-01   +8.883903431631297e-01   +8.743370904415865e-01   +4.286172178108673e-01   +3.909466628764207e-01   +4.215089473991514e-01   +6.887601291645311e-01   +2.826426593641795e-01   +4.142788726248765e-01   +1.196202375592664e-01; +9.911999602564486e-01   +1.284287022468849e-02   +3.767709984511889e-01   +4.749816370596519e-01   +9.072458261946784e-01   +3.249798488855511e-01   +7.096220318473985e-01   +5.843771341454097e-01   +9.114288545064129e-01   +9.468245785591932e-01   +8.723797665256625e-01   +3.865215153189888e-01   +7.486141379560467e-01   +1.532004009356059e-01   +9.664202580522721e-01   +9.901494014454473e-01];
L2I_L1I_iGABA_netcon = [+5.756047896807741e-01   +5.639306040215395e-01   +1.051724349105512e-01   +4.540886626243326e-01   +7.952018859197919e-01   +9.775990122426343e-01   +2.232492194656056e-01   +7.598249542945372e-01; +5.634095252240677e-01   +9.534684663900040e-01   +1.247517150389433e-01   +5.682623222287850e-01   +5.465058187451307e-01   +4.261473582742411e-01   +6.582533950441129e-02   +4.979999432235919e-01; +6.111515228546195e-01   +1.020986925127962e-02   +4.332997141172963e-01   +8.177335149165518e-01   +2.603909559082032e-01   +3.949724468216854e-01   +8.294365419202178e-01   +8.274164260303616e-01; +4.672701579037342e-01   +1.277443052638512e-01   +9.290553504836263e-01   +3.589279436439200e-01   +7.801990531293153e-01   +4.588450321320658e-01   +4.140694445292504e-02   +9.190547569346703e-01; +4.362622342911814e-01   +8.534208675083332e-01   +1.358778958637079e-01   +2.449876570883925e-01   +7.754727327754782e-01   +1.263782969839089e-01   +9.102627581637136e-01   +7.087746990912350e-01; +6.738713896912336e-02   +2.183666834035298e-01   +8.244241017304886e-01   +7.638011536731942e-01   +1.459746553732782e-01   +4.580393544575274e-01   +4.555585290733749e-01   +8.003659646424336e-01; +6.387350860125007e-01   +7.050558108943338e-01   +9.304090043261291e-01   +3.019490377265641e-03   +8.259067457652214e-01   +2.647115205818132e-01   +2.820465141534126e-01   +9.584334408777437e-01; +4.263826483442694e-01   +7.731860082257219e-01   +5.715058861309822e-01   +2.741700932125921e-01   +6.243555504321199e-01   +1.024591255488835e-01   +7.580044818243576e-01   +9.505684318783918e-01; +7.514226297013618e-01   +4.224293108943609e-01   +4.983809730548425e-01   +3.253398861992686e-02   +4.576254780058595e-01   +6.588142259056363e-01   +9.275290607434222e-01   +2.983911956887251e-01; +3.069959163069029e-01   +7.296031004917566e-01   +9.295748334079487e-01   +6.718361207525347e-01   +4.846210827343589e-01   +9.409088266969623e-01   +1.412057859585887e-01   +3.549169109024718e-01; +5.995799423221817e-01   +4.555782029919457e-01   +8.621851637207366e-01   +9.717807755502474e-01   +2.207579134156180e-01   +7.644964793628183e-01   +9.476668289554567e-01   +5.444824267188668e-01; +3.334221092886044e-01   +8.050617775693593e-01   +2.552032060211541e-01   +9.453281164626276e-01   +8.583004806075197e-01   +4.183928373170867e-02   +3.109672505624544e-01   +2.129651772850312e-01; +6.481604311451686e-01   +4.316744289022835e-01   +4.575824806081221e-01   +4.823641427987868e-02   +8.772906589071066e-01   +2.623350163223270e-01   +2.084069743359569e-01   +8.036339693953864e-02; +5.606083171481358e-03   +1.482997131355092e-01   +7.359144459427008e-01   +2.894024952569365e-01   +8.424615414893185e-01   +6.428648707840594e-01   +4.622793720940313e-01   +5.130124182750988e-01; +1.461719925934405e-01   +8.034518761163171e-01   +7.516276373809674e-01   +4.835449695615823e-01   +4.405155572998153e-01   +9.188888711480586e-02   +5.955178488866090e-01   +1.996349538719236e-01; +2.472554155598463e-01   +3.760279276042913e-01   +2.366629717511704e-01   +8.875254154965595e-01   +5.457828883253197e-01   +7.468143702013977e-02   +5.506391408707788e-01   +1.432076503645281e-01];
L1I_L2I_iGABA_netcon = [+7.068388715827667e-01   +8.683910489605035e-01   +6.134023843858231e-01   +4.957278698871084e-02   +1.437364399845893e-01   +2.359462570077379e-01   +8.418774229881724e-01   +3.697336218047402e-01   +7.114878745769873e-01   +3.860611641247336e-01   +2.439059648906276e-01   +6.694979551441814e-01   +1.620415784475213e-01   +5.738443579346271e-01   +4.179143713303964e-02   +4.334902501782208e-02; +6.043658927363288e-01   +8.011673750672695e-01   +6.161990339780509e-01   +5.765365567365863e-02   +7.496003028497152e-01   +5.548788151217211e-01   +2.011794894133735e-01   +5.596604194153910e-01   +1.871461936498207e-01   +7.254653573480639e-01   +5.079470440901611e-01   +3.356937388683749e-01   +1.094034293920982e-01   +8.098239700584233e-01   +4.366996008099674e-01   +9.209406410752277e-01; +1.644215237323985e-01   +6.225114400204299e-01   +3.097285215131393e-01   +5.971223693653329e-01   +9.554660180460647e-01   +1.127138462997115e-01   +6.171865174568077e-01   +8.314710308495431e-01   +2.313748355054328e-01   +6.346628621751330e-01   +7.345934569868087e-01   +5.482200005479624e-01   +7.410734707113076e-01   +6.739850780284965e-01   +9.244034914135831e-01   +1.763143131940143e-01; +4.802151231183774e-01   +4.734664114010327e-01   +1.341208788423940e-01   +6.610236106266544e-01   +2.663953531354828e-01   +8.208437070385417e-01   +1.597679514930194e-01   +7.142971193455436e-01   +9.987894679564133e-01   +1.006600555086799e-01   +7.798217055542530e-01   +5.382319631477681e-01   +2.173042033007706e-01   +4.412183452451638e-01   +8.822112607337005e-01   +7.442858293894707e-01; +2.902740837977481e-01   +1.924672936568092e-02   +6.025568313737579e-01   +4.848175877469921e-01   +8.992517652400316e-02   +6.554407685153064e-01   +5.838643270612601e-01   +1.162932832982244e-01   +9.025901861567958e-01   +4.925214347061761e-01   +6.811993004983030e-01   +9.034447495114052e-01   +4.862553752584179e-01   +8.913813797905593e-01   +9.513885326486866e-02   +4.736605227409311e-01; +4.038118370658860e-01   +1.219164140089171e-01   +8.938660598542063e-01   +9.820664085167694e-01   +2.325483091811767e-01   +2.364510297707071e-01   +5.439646301414937e-01   +7.387016560406847e-01   +1.515195205988735e-02   +5.575389488884104e-01   +8.178125727654492e-01   +2.797761787308637e-01   +5.020846466107455e-02   +7.862894996800203e-01   +6.798276694388010e-01   +2.514553485680570e-01; +4.915875650698941e-01   +7.200358299877972e-01   +5.652403189515456e-01   +8.668433973723635e-01   +8.910570822519420e-01   +3.032984829376114e-01   +6.860682495974149e-01   +9.252456137871941e-01   +8.327868718098976e-01   +5.386697391889036e-02   +4.200770206352621e-01   +1.428718263702095e-01   +5.773213357558457e-01   +5.870145499519237e-01   +1.000771111231863e-02   +6.669327420529574e-01; +8.621994457496385e-01   +6.716947088752615e-01   +6.327078080926967e-01   +9.555874365471666e-01   +1.988407409370217e-01   +3.297750785389592e-01   +7.004853829378241e-01   +9.212855168963375e-01   +2.506412068561278e-01   +8.316001580018098e-02   +4.949767773317831e-01   +9.584659069051752e-01   +4.976142406275195e-01   +6.213778388463451e-01   +1.240654896182185e-01   +6.092820093772674e-01];
L2E_L1E_iAMPA_netcon = [+3.720936889760242e-01   +5.636796704906993e-01   +2.020083011140556e-01   +5.168308576087938e-01   +2.924663549009103e-01   +7.002203975032316e-02   +2.807592718842681e-01   +2.656276383343902e-01; +4.358759529095761e-01   +1.845303307456408e-01   +1.357085563401936e-01   +6.862324447547110e-01   +6.235234267767690e-01   +5.882764866625917e-01   +9.311332285623538e-01   +9.017037564550066e-01; +7.181184412805094e-01   +6.062801010660036e-01   +8.378364190179717e-02   +2.065620490649932e-01   +8.684535806737054e-01   +7.782752658543693e-02   +7.597904043347888e-01   +1.550993339420657e-01; +1.907286452742323e-01   +7.369237702411483e-01   +9.315510716985388e-02   +9.733377456674336e-01   +8.161759994227119e-01   +3.991698189882084e-01   +2.620708655118435e-01   +5.520662482928665e-01; +4.145317502953287e-02   +8.347479838635538e-01   +5.508254527306783e-01   +3.516793182134988e-01   +2.096072017286162e-01   +5.794706145945901e-02   +2.452371742691039e-01   +4.227859683912621e-01; +3.174959528176450e-01   +2.748561206850745e-01   +7.327366271568256e-01   +1.813158441036075e-01   +7.501018917387080e-01   +1.273959945815605e-01   +1.634642823395563e-01   +5.490965281339818e-01; +7.913854414121019e-01   +6.098775781231738e-01   +5.470699625171080e-01   +2.432306595196003e-01   +1.983493708631047e-01   +2.428930612275857e-01   +2.893178271262514e-01   +7.477011627363520e-01; +4.492172884882218e-02   +5.491780507770043e-01   +4.699581590117116e-02   +2.566808363190992e-01   +5.785163598847782e-01   +9.442409051331626e-01   +5.642539980695496e-01   +9.831971702575645e-03; +2.151091464682697e-01   +2.783671371000522e-01   +6.373724574766451e-01   +2.207270621599860e-01   +8.770692085861324e-01   +2.053072381706641e-01   +3.997808961920349e-01   -1.647351819633137e-03; +2.701634972418714e-01   +3.374850911515095e-01   +9.931197415962816e-01   +3.581682923536776e-02   +7.168870285319896e-01   +3.300702597546699e-01   +9.886455252095953e-01   +2.092831301693797e-02; +7.898197371129969e-01   +5.699717980453147e-01   +9.111726762151267e-01   +3.562465697215337e-01   +7.008493886022912e-01   +8.640499064297388e-01   +5.474131425023193e-01   +3.524292656109995e-01; +9.839229838441041e-01   +7.395782163830031e-01   +7.736388037431463e-01   +8.974689586118618e-01   +4.619647679036896e-01   +9.206233483860108e-01   +9.291933341522198e-01   +4.282769683355278e-01; +9.785185856815531e-02   +7.675069145858587e-01   +1.937912796642564e-01   +1.371748013714021e-01   +5.033025199432762e-01   +1.876251195744642e-02   +9.898450490239272e-01   +5.454002762015396e-01; +1.981725322806359e-01   +4.030450981421742e-01   +3.106304102704686e-02   +9.543033229851705e-01   +8.024723767635428e-01   +3.600026328634600e-01   +8.353526209611084e-01   +4.845997534045741e-01; +1.200754788290123e-01   +1.517473205676387e-01   +3.804182872779201e-01   +9.029297918599515e-01   +9.359585754212900e-01   +5.310174849660217e-01   +1.775296454730922e-01   +9.160983911412017e-01; +6.385458288275387e-01   +2.026796304255102e-01   +5.777689584690947e-01   +4.108958640007653e-01   +7.887597276200339e-01   +4.033543004488679e-01   +3.097717442190432e-01   +4.170279513950534e-01];
L1E_L2E_iAMPA_netcon = [+4.989308952706091e-01   +4.519445419398165e-01   +6.129653025830123e-01   +4.928517143617498e-01   +2.329164821314266e-01   +7.160225109989592e-01   +6.883077137484070e-01   +6.343188499527908e-01   +5.229952937151255e-01   +2.420386911627944e-01   +8.739043314652332e-01   +1.774803318062279e-01   +1.379198560385499e-01   +2.479787783174474e-01   +1.857571399472602e-01   +2.548927744129229e-02; +8.349129754764874e-01   +3.647431206049380e-01   +1.074461430528361e-01   +6.612890456489787e-01   +8.366108472155774e-01   +3.811458432798631e-01   +9.744752569098415e-01   +6.208963149574128e-01   +6.712028155875573e-01   +7.252761062255565e-01   +6.619631713045997e-01   +3.003594329951866e-01   +2.841313448935949e-01   +7.493871304538551e-01   +1.509030484316556e-01   +2.455643168956722e-01; +1.847468542686211e-01   +2.988292325426183e-01   +7.573891583832438e-01   +1.790439852468844e-01   +7.362195262010228e-01   +3.794064537461302e-01   +7.560904925378793e-01   +4.093389244002321e-01   +7.729252848596428e-01   +1.298035074532153e-01   +5.421899289310780e-01   +1.075407055688834e-01   +5.430260471644494e-03   +9.309680173016363e-01   +1.351498671825135e-01   +9.865647690488792e-01; +3.408802662034736e-01   +2.360526867861881e-01   +5.407708673185591e-01   +4.776213787430132e-01   +4.889208636742839e-01   +7.161936615374810e-01   +5.560414165235956e-01   +4.273429719844948e-01   +4.630221372969769e-01   +4.486599374085583e-02   +2.523227262497472e-01   +4.502664223893539e-01   +3.083745577879690e-01   +3.013726414630265e-02   +1.619016098965702e-01   +6.320818462383683e-01; +6.934007449768997e-01   +1.391689254000174e-01   +4.447978726336939e-01   +5.013246645392682e-01   +8.504173944448044e-01   +8.347111682195675e-01   +2.856266864756280e-02   +5.087754806742768e-01   +9.059833284758774e-01   +6.504734420199566e-01   +1.082780980678419e-01   +5.891492212172809e-01   +9.058283177527272e-01   +4.316448655005666e-01   +9.196773127333874e-01   +3.575751253668337e-01; +6.967099895593858e-01   +1.039250567913496e-01   +7.429820390191055e-01   +6.025662784695328e-01   +7.206717516398045e-01   +6.670699738066801e-01   +1.917029290122973e-01   +2.639106872722413e-01   +2.365160081220218e-02   +2.001390223274146e-01   +9.713819190430322e-01   +2.213559694312245e-01   +2.940424856193654e-01   +8.294664000033108e-01   +2.630124359302297e-01   +9.447546976532362e-02; +3.686243279312140e-01   +2.293449509358498e-01   +3.853680190696949e-01   +2.462162254586334e-01   +5.218899397491752e-01   +6.516074815091826e-01   +9.387340611204901e-01   +4.229535219401261e-01   +4.846874161038619e-01   +9.759608714803807e-01   +5.911562416618978e-01   +1.100805656138478e-01   +8.259190043765623e-01   +9.963046552383504e-01   +2.068807741530730e-01   +4.121227027935609e-01; +3.243681091290748e-02   +3.439726783685251e-01   +5.333266023073918e-01   +5.174768428242223e-01   +9.375051961034191e-01   +5.601981616152641e-01   +3.956670781925546e-01   +5.210039637179477e-01   +2.763793273679938e-01   +8.217453089254275e-01   +8.203911007778809e-01   +5.592973303101999e-01   +7.430413646810213e-01   +9.209208359455052e-01   +6.170267726032880e-01   +9.311171216911560e-01];
L2I_L2E_iAMPA_netcon = [+6.712855563550711e-01   +6.083156110750686e-01   +3.947783034755206e-02   +8.002140222735484e-01   +5.208954877878856e-01   +8.236052044186798e-01   +6.476242875665446e-01   +3.869752611631913e-01; +2.384572135083142e-02   +9.443347191388051e-01   +5.404858590346277e-02   +9.360836048781253e-01   +6.562821835874373e-02   +1.093462023035374e-01   +3.612954571160468e-02   +1.733226841857745e-01; +7.390341019082001e-01   +9.625322694958536e-01   +4.049711115068110e-01   +9.403317404747030e-01   +2.872926171593558e-01   +2.131649956731276e-02   +5.619716470683582e-01   +4.466727058525749e-01; +2.165638690439883e-01   +3.699243070848144e-01   +9.808056825062438e-01   +1.415241613429313e-01   +7.136975190227947e-01   +8.189755578405686e-03   +3.069439983704563e-01   +8.750524896119144e-01; +8.565212335033919e-01   +8.021246417269261e-01   +7.128973970527145e-01   +3.254743031832475e-01   +8.838759866303427e-01   +3.362101463543368e-01   +2.615470239679683e-01   +4.050336850536891e-01; +1.602538966453282e-01   +7.269608532878008e-01   +9.876080907328507e-01   +4.310461996135082e-01   +3.631496665952149e-01   +6.668243997376353e-01   +7.194024756756761e-01   +1.651822568495261e-01; +6.722782608174033e-01   +9.545379059107332e-01   +6.476262010963687e-01   +7.066654022747766e-01   +5.651243195859182e-01   +5.943837809272958e-01   +3.095257711133000e-01   +6.619328715422180e-01; +9.352406294283219e-01   +1.473707612105049e-02   +5.062626507300301e-01   +6.164580991173663e-01   +8.789696991708195e-01   +7.675936659543868e-02   +8.996583878823686e-01   +9.299828863589442e-01];
L2E_L2I_iGABA_netcon = [+6.266621347066383e-02   +5.240890330588781e-01   +3.517802839413727e-01   +2.569106093095739e-01   +4.615339599361161e-02   +8.966304238403082e-01   +3.418510766649593e-01   +4.514307572532859e-01; +3.555147040624693e-01   +6.947168998184440e-02   +5.615292960413218e-01   +9.826093165331677e-01   +3.628944328549575e-01   +5.457204439992713e-01   +9.308122521340481e-01   +6.738523006769100e-01; +9.323688801371506e-01   +1.802831752761939e-01   +6.910346690654997e-01   +3.485285956521981e-01   +3.636048910557846e-02   +7.151143996777722e-01   +9.155280006170665e-01   +7.696166018387157e-01; +2.415668451102277e-01   +3.149069708144104e-01   +3.017450514568946e-03   +3.965445729113186e-01   +4.861407824426094e-01   +7.159370993430494e-01   +7.252151178341519e-01   +9.242457775144629e-01; +1.055346057463962e-01   +2.473189503053628e-01   +4.635350465799271e-02   +7.519729656847089e-01   +7.256858690291180e-01   +1.701868112026393e-01   +4.455822291661228e-01   +6.540958610925510e-01; +7.117991373497421e-01   +3.227159797001629e-01   +3.038569673357162e-01   +1.065994242516871e-01   +1.360113661215232e-02   +3.543671418647943e-01   +1.514888787916978e-01   +5.024547830557015e-01; +5.891231616083542e-03   +8.749658229217703e-01   +8.708159140812060e-01   +5.945376295556879e-01   +5.137540403202497e-01   +3.799212390469577e-01   +8.281259659946298e-01   +3.466706375690118e-01; +1.762213573110262e-01   +3.055746178974738e-01   +6.243086294556517e-01   +1.223246158577083e-01   +2.403866464129491e-01   +7.606049207983647e-01   +2.524069047784228e-01   +9.479225917790077e-01];
L3E_L2E_iAMPA_netcon = [+7.708629031896298e-02   +1.730668147194417e-02   +3.692810425387892e-01   +4.944404184734064e-01   +2.113804993803252e-02   +9.600951454110073e-01   +3.580236453621173e-01   +2.147135480189031e-02   +2.048608160169438e-01   +6.820536709762186e-02   +2.449106555200192e-01   +9.975981756271061e-01; +9.513630049994732e-01   +9.794537787796421e-01   +1.145507208437421e-01   +6.453664039931645e-02   +8.066904997829664e-01   +3.904960802463727e-01   +2.281835921923223e-01   +1.275594824435419e-01   +3.559077563154681e-01   +7.417040065362390e-01   +5.361139145180055e-01   +3.432052484638964e-01; +6.642499446121845e-01   +7.199303770817740e-01   +5.120728040473154e-01   +8.692794857313995e-01   +7.956531047684259e-01   +6.621782131440833e-01   +7.269019276023549e-01   +6.638736889565928e-01   +8.903367627847709e-01   +9.937290024139541e-01   +3.340669332814130e-01   +8.264104697414891e-01; +1.688000445635307e-01   +8.740150125310364e-01   +9.051787364941992e-03   +9.984930688994696e-01   +4.199455019137787e-01   +5.845175008807052e-01   +7.716002849132515e-01   +5.076899517865012e-01   +8.190841859017585e-01   +7.673722675585798e-01   +6.694238080928482e-01   +1.109266191082614e-01; +1.974146269831360e-01   +8.181111390583922e-01   +8.703886740146536e-01   +1.209302014308711e-01   +6.314492066073936e-01   +5.171679846442422e-02   +3.422353081293554e-01   +7.892619550451767e-02   +3.184308759633825e-01   +8.871728807299802e-01   +8.768006301743045e-01   +7.806921971965960e-01; +9.918342005316670e-01   +3.353807354097214e-02   +9.101204827203222e-01   +1.064630315270909e-01   +5.669027953097378e-01   +7.118560426795845e-02   +5.719042104384506e-01   +5.386923410538272e-01   +5.997655297530038e-01   +4.160874860932933e-02   +9.836421195906879e-01   +1.517128119997372e-01; +9.275951901423548e-01   +9.536292399566239e-02   +1.094250818101701e-01   +1.480461698351135e-01   +9.022147260881405e-01   +2.322179941730939e-01   +6.394654098290606e-01   +6.813471508264933e-01   +7.002411102364838e-01   +7.956294709093668e-01   +1.418511720071350e-01   +7.311042503093371e-01; +9.773564057420064e-01   +9.273323817341639e-02   +4.427623564199269e-02   +1.274606064871475e-01   +7.485024076052129e-01   +4.147797291109154e-01   +3.705889491225082e-01   +5.902269638992387e-01   +1.796906589172383e-01   +7.111182357341027e-01   +8.801305145675713e-01   +1.157757067326478e-01];
L3I_L2I_iGABA_netcon = [+7.709719800894284e-01   +5.369515274669330e-01   +5.964487314326501e-01   +3.059800248502064e-01   +9.667456117018659e-01   +1.149110540419001e-01   +2.944707697531621e-01   +7.960907332349796e-01   +9.217481923854002e-01   +9.927789133281847e-01   +3.123552289331455e-01   +9.931687470087838e-01; +6.354769707284659e-01   +4.488132479241868e-01   +5.605950792709667e-01   +7.561079460799783e-01   +5.481494556320455e-01   +6.426817843653558e-02   +1.646412943443374e-01   +5.106475231991426e-02   +3.858031014164917e-01   +2.911978854042102e-01   +4.467166196212042e-01   +9.181350166115719e-01; +7.992048095747880e-01   +1.163157104342314e-01   +7.347171038424430e-02   +6.516980069005315e-01   +9.804927688975492e-01   +4.486086531915977e-02   +7.222115560674323e-01   +1.791099946177090e-01   +7.497686773400536e-01   +5.207075460697116e-01   +2.036145110371684e-01   +6.901624576062777e-01; +9.620177773114021e-01   +7.170315429423573e-01   +7.711851282244045e-01   +3.330563367425918e-01   +1.256373187489888e-01   +1.334074180832143e-01   +2.990077388685227e-01   +2.447995991420517e-01   +8.769170571753326e-01   +3.592839330535236e-01   +9.420379568781982e-01   +2.178611813583987e-01; +7.120873753224102e-01   +1.815631859258746e-01   +8.621304542081779e-01   +9.749684781349943e-01   +1.647769219229494e-01   +4.907869840654989e-01   +6.771912655962224e-01   +2.572166387566928e-01   +3.959944144141352e-01   +5.192881108156404e-01   +2.900010680843103e-01   +3.151648875104835e-01; +6.448049762139065e-01   +3.250106833927653e-01   +7.037712089245879e-01   +5.301899644621004e-01   +3.365704152293457e-01   +4.689016976548046e-01   +7.471877433551158e-01   +6.520423553719056e-01   +1.683527730759810e-01   +4.947059124312763e-01   +1.183270918481178e-01   +2.279321717054543e-01; +5.148624625273478e-01   +9.663164725769842e-01   +1.077376751241493e-01   +7.510727244179287e-01   +5.356925053694294e-01   +1.549981713885934e-01   +7.464979783179876e-01   +1.007129419958485e-01   +4.382453074461090e-01   +1.838592367793926e-01   +6.948377535047449e-02   +7.074480089300247e-01; +9.493487951580413e-01   +6.999086046513523e-01   +6.595404445100284e-01   +2.656233475555819e-01   +6.919067358413454e-01   +1.376932377259847e-01   +7.791655735234992e-01   +4.685539115441311e-01   +8.532212403627818e-01   +4.793079992087938e-01   +7.285609698314782e-01   +3.718768574021902e-01];
L2E_L3E_iAMPA_netcon = [+6.595818645907257e-01   +3.864530129837380e-01   +2.354036534872613e-01   +4.635463800008987e-01   +9.038563494376397e-01   +9.550487726754489e-01   +7.666346699715552e-01   +3.577663114707385e-01; +3.810623774467183e-01   +2.120430027995229e-02   +9.129059810932374e-01   +2.898508782071776e-01   +6.841725388911912e-01   +1.908900287306373e-02   +8.988660306772291e-01   +6.606528613893099e-01; +3.059351982651510e-01   +3.303660526492840e-01   +4.866498934606013e-01   +2.765691727502282e-01   +8.451520915110124e-01   +4.987126620049841e-01   +7.907201076387784e-01   +5.901039079517760e-01; +1.552550334990385e-01   +4.884855782496971e-01   +5.913730262550554e-01   +1.429828396069719e-01   +9.607977134157361e-02   +3.361630688861629e-01   +9.512923553080780e-01   +5.459283742302812e-02; +7.733995914805983e-01   +2.629699378207176e-01   +9.536816148189912e-01   +1.449024455075900e-01   +7.385233091123531e-01   +6.669108573536204e-01   +5.352100508048285e-01   +2.119974634687478e-01; +7.110682548476165e-01   +5.279159179846842e-01   +8.019870751019992e-02   +2.650354978086923e-01   +5.479557414782851e-01   +1.663660521348879e-01   +1.613043722836517e-01   +6.023260068232005e-01; +1.705755776648688e-01   +4.139667828606256e-01   +2.229722838371556e-01   +6.078865545178638e-01   +2.541330015976832e-01   +2.264810646141319e-01   +1.368510069522759e-01   +2.692768170461172e-01; +4.504491633952256e-01   +2.122789063649699e-03   +1.580599636539975e-01   +1.014508624857998e-01   +7.145110337978240e-01   +1.145094970670205e-01   +2.531281634189304e-02   +1.130690447327682e-01; +8.410487849750873e-01   +8.904962432860615e-01   +3.949487186430006e-01   +4.879563472276118e-01   +3.591322122161744e-01   +9.902604524547871e-01   +6.844152957008246e-01   +2.176687765622555e-01; +7.017047576542110e-01   +2.387297351717931e-01   +1.844519296116138e-01   +8.966134554817321e-01   +8.450715890667975e-01   +1.381192607339505e-01   +5.856095115096770e-01   +8.801947837097748e-01; +7.633393846763250e-01   +7.985819494288687e-01   +7.633501240094045e-01   +1.898527146749332e-01   +8.208968356435655e-01   +7.659132456398542e-01   +2.937363177037730e-01   +4.608216899647167e-01; +9.771217225375521e-01   +5.817196087761877e-01   +2.285496820058448e-01   +5.300727402611539e-02   +6.168201921941426e-01   +6.268202197839666e-01   +7.446175201621788e-02   +7.330952103198936e-01];
L2I_L3I_iGABA_netcon = [+5.913546855002243e-01   +1.432257704864814e-01   +3.456865957112582e-01   +3.706823176116682e-01   +5.984672583141709e-01   +5.094098005608946e-01   +7.703821601599781e-01   +2.677512276226784e-01; +8.390475382263287e-01   +9.929937631449616e-01   +4.298640386500586e-02   +5.358004349725273e-01   +4.742357250013305e-01   +2.420641755525427e-01   +1.788939807588092e-01   +5.941768921298946e-01; +6.075934751623521e-01   +4.841235921838052e-01   +9.468882528352855e-01   +9.716149432539826e-01   +3.788200021674294e-01   +2.748322705790573e-01   +4.535525185025874e-01   +6.806466753368881e-01; +7.471188448381710e-01   +3.941543706023826e-02   +8.627942946060460e-01   +9.984376045986122e-01   +9.820317927256773e-01   +4.110260433451283e-01   +3.010545123792069e-01   +4.170788971982001e-01; +8.515872713551297e-01   +2.689029303427087e-01   +1.367176896246025e-01   +4.128298196694810e-01   +1.397145554750896e-01   +2.619177704095531e-01   +3.866136146813184e-01   +5.132406745158471e-01; +1.455679323648371e-01   +6.698305008563858e-01   +5.893984251524503e-01   +4.469633065297318e-01   +2.718629732401175e-01   +8.512504961852935e-01   +7.988729954066318e-01   +8.160701179374419e-01; +7.405325133582281e-01   +1.472518543158240e-01   +6.752051381227384e-02   +2.468744026489333e-01   +2.240295256775501e-01   +4.808796023383995e-01   +7.812693958262521e-01   +5.385701687348199e-01; +1.896778339104431e-02   +7.725508094121525e-01   +9.514919021569961e-01   +5.978888572978671e-01   +7.959116857363582e-01   +3.404851476357143e-01   +6.464684023386419e-01   +5.892204666008197e-01; +2.275211142287925e-01   +2.670376519224265e-01   +4.977293569169165e-01   +7.494435732726606e-02   +8.222183624219005e-01   +6.349333846966368e-01   +2.438396746825358e-01   +5.380391249179417e-01; +5.343481686876835e-01   +8.830758703472104e-01   +2.644832229434368e-02   +9.076628642750539e-01   +7.989741813797150e-01   +4.153593000752211e-01   +6.049605789798947e-01   +5.402260496800663e-01; +7.166896537717262e-01   +3.657477120440914e-01   +5.377652593226365e-02   +4.785048870771749e-01   +1.145968817659856e-01   +5.474240383323425e-01   +4.185781758588963e-01   +1.533676068011414e-01; +4.340310580631701e-01   +1.316943841613874e-02   +2.992999809330936e-01   +5.035511637014437e-01   +6.369914263781697e-01   +3.411429292955235e-01   +2.978149160495919e-01   +6.986351070945487e-01];
L3I_L3E_iAMPA_netcon = [+5.917702644482922e-02   +7.753256974850419e-01   +5.522084778857612e-01   +5.715650626028278e-01   +9.136097551829403e-01   +8.319530975788196e-01   +8.438289152864733e-01   +8.608945268184883e-01   +5.282247299298690e-01   +9.916377320756795e-01   +4.816131900893478e-01   +3.487210964147315e-01; +9.238266108449802e-01   +8.374261969268386e-01   +8.496274374157821e-01   +9.350365389917896e-01   +5.900263885601593e-01   +3.997080466449031e-01   +6.306566232474906e-01   +8.568265092913681e-01   +5.623496734894154e-01   +7.004168790712995e-01   +7.396406869066077e-01   +3.961181332645111e-01; +1.848706475594100e-01   +5.912699839104383e-01   +9.693405970132400e-01   +7.810565110280695e-01   +5.756917008158939e-01   +6.842559776721339e-02   +4.406873825819719e-01   +9.522558350056244e-01   +9.837244190804332e-01   +8.428915645523644e-01   +5.910538661913252e-01   +9.901744212795370e-01; +5.423487505745275e-01   +7.643681151079955e-01   +4.617725485939230e-01   +5.953085497336944e-01   +6.523287025235666e-01   +3.791074179420788e-01   +2.307268894196360e-01   +6.967716496327919e-01   +9.617060464481362e-01   +7.322917263548783e-01   +2.560852170740281e-01   +2.925293118754773e-01; +4.000881038583526e-01   +6.662901495263418e-01   +7.708222401467995e-01   +6.149888870602241e-02   +4.299267486269486e-01   +8.562839667084947e-01   +5.002087652758959e-02   +3.595910073301108e-01   +5.595426295556714e-01   +9.968753629697940e-01   +6.104495474150239e-01   +2.286913762512063e-01; +1.055196912925565e-02   +5.858051038465032e-01   +2.580330870517164e-02   +5.414266410037862e-01   +9.376286613781987e-01   +2.365703412378353e-02   +7.039636621333728e-01   +3.750587826449659e-01   +5.259073906189456e-01   +5.053126952086314e-01   +2.305143446532391e-01   +3.255749738308146e-01; +1.066876772870357e-01   +2.280978952953240e-02   +6.757752755565665e-01   +8.608664882443740e-01   +1.007352785603018e-01   +4.236818710594060e-01   +8.500288945677088e-01   +8.462677271498620e-01   +4.733173606221638e-01   +1.908120419412905e-01   +1.975709049892819e-01   +1.655551493253107e-01; +8.524207750648201e-01   +6.843508364683903e-01   +8.415409332948789e-01   +3.398523752934579e-01   +4.072774284460679e-01   +2.530655124098233e-01   +4.066914177867885e-01   +3.838941200323804e-01   +9.027859904525012e-01   +9.524980877275825e-01   +3.149547687473163e-03   +3.796899093889078e-01; +3.357645469202434e-01   +3.241508148331645e-01   +6.895876112781277e-01   +1.787365382936830e-01   +8.935897252019094e-01   +7.290136780992845e-02   +2.913350098290716e-01   +7.739317554790297e-01   +4.812253948408348e-01   +4.512969468080089e-01   +6.539774219177316e-01   +5.294953323129377e-01; +1.476626440492518e-01   +8.026829342706762e-02   +8.994703209792758e-01   +8.765429020576518e-01   +7.350696515975327e-01   +9.161591086490150e-01   +2.584285645417874e-01   +7.777545525193710e-01   +4.893002292913572e-01   +6.071341116710183e-01   +3.996454287642188e-01   +5.960754813763786e-01; +8.011444829925318e-01   +7.437875446729822e-01   +9.595163440431315e-02   +8.416668103714632e-01   +9.585619799133310e-01   +2.652425182547614e-01   +5.113086116638605e-01   +4.312076876797739e-01   +3.105325227441138e-01   +6.434791001112437e-01   +2.706686839530189e-01   +1.690285368507354e-01; +6.534451597322160e-01   +9.677950843468887e-01   +7.771676792418807e-02   +8.295900023172847e-01   +9.762852079066727e-01   +1.067210572361869e-01   +1.159900050995974e-01   +4.842506285061747e-01   +8.534054434169230e-01   +7.634476110683865e-01   +2.166951230460723e-03   +6.804319998823705e-02];
L3E_L3I_iGABA_netcon = [+4.434686966563509e-01   +6.447748292999037e-02   +4.363161043481107e-03   +4.916019261348230e-01   +5.450399584062394e-01   +2.518930973804739e-01   +7.179795579130868e-01   +7.595692419554372e-01   +3.789212122457681e-01   +4.483820902566831e-01   +1.993452258064502e-01   +6.550090083817219e-01; +5.959653382856742e-02   +8.084640318949384e-01   +1.297050309573502e-01   +1.914212087887535e-01   +2.171019197150264e-01   +3.322357400893698e-01   +2.238976093326978e-01   +8.888874032700950e-01   +6.084402466128238e-01   +3.942235111265769e-01   +8.273973856762783e-01   +9.048844400983258e-01; +6.267219198302313e-01   +9.135334571043822e-01   +3.079625007140200e-01   +6.447289868340843e-01   +2.693043680688541e-01   +6.001781790907846e-01   +4.997553135324753e-01   +7.328047233145593e-01   +1.669254195803480e-01   +6.754633399114084e-01   +4.395548582492783e-01   +8.362054776482013e-01; +8.052646109432415e-01   +4.244146383895760e-01   +2.360661062771749e-01   +2.549872536642324e-01   +1.362275129829577e-01   +4.813047864747217e-01   +4.751781997637246e-01   +6.947024936959481e-01   +1.010532863177382e-01   +3.390844953606562e-02   +4.147261433525559e-02   +1.724805129576151e-01; +4.037450413012810e-01   +1.905122907736925e-01   +6.494634917909170e-01   +9.434579198842244e-01   +1.672420284415087e-02   +8.960538397605390e-01   +4.286841185044621e-01   +6.424342536130209e-01   +6.201924532928534e-01   +7.849216392479863e-01   +7.657272302835275e-01   +1.622772109907104e-01; +8.823606331198973e-01   +1.843287328293014e-01   +8.113250829017271e-01   +2.914310476862332e-01   +1.178689971895377e-02   +2.902385368556986e-01   +5.541992012298231e-01   +6.166078209317979e-01   +9.610852413493073e-01   +3.732718649860929e-01   +9.417560605162378e-02   +1.379692873489881e-01; +7.204028829953163e-01   +6.705812776366011e-01   +7.398385085436370e-01   +1.438280463633134e-01   +9.831010345749249e-01   +7.488431414468169e-02   +2.092760217008116e-01   +7.652516810859944e-02   +6.709958082879828e-01   +6.407834092238813e-01   +6.569635501794540e-01   +1.581830170105381e-01; +1.995432833084221e-01   +5.266262075333896e-01   +1.197430823857995e-01   +8.647576900576720e-01   +6.471610163746763e-01   +3.870110472060992e-01   +2.768949089388630e-01   +5.481147535719531e-01   +4.722470382774236e-01   +4.951776570505950e-01   +2.675870131753246e-01   +3.987151851891249e-01; +3.731878900747237e-01   +7.746557234974606e-01   +1.729817593929278e-01   +8.827973126703329e-01   +8.162754524817541e-01   +1.925119896136713e-01   +8.088006518661918e-01   +8.791842020770523e-01   +3.387549859092453e-01   +2.181703431752496e-01   +4.369329734769262e-01   +6.620443575040172e-01; +2.084769230472425e-01   +3.013905766515459e-01   +2.681422165593630e-01   +6.629582944763418e-01   +2.796924885403433e-01   +7.278204769812061e-01   +9.806707950941496e-02   +9.856330522599870e-01   +5.900414319382887e-01   +2.116001132384509e-01   +8.502867479505050e-01   +2.234299413256912e-01; +2.618413775479850e-01   +4.756836755336927e-01   +8.129239950842782e-01   +9.976720125294660e-01   +1.242279980658775e-02   +4.233028498480278e-01   +3.476794667163485e-02   +7.067199434299422e-02   +5.423983901531675e-01   +4.524681978873232e-01   +9.047158084715085e-01   +6.419142746933267e-01; +9.916306712214994e-01   +7.098866086278668e-01   +5.928682217256371e-01   +2.678518241486020e-01   +1.026838712245198e-01   +2.687599168740821e-01   +7.242237440365862e-02   +2.936660258229843e-02   +3.830544563047727e-02   +6.339657951038757e-01   +2.866272446884144e-01   +6.096441040457112e-01];
L2E_Input1_iAMPA_netcon = [+9.991905722607415e-01   +9.922156035941827e-01   +9.974621850760176e-01   +9.906277069371596e-01   +9.877402958089512e-01   +9.985588545474176e-01   +9.854186206859337e-01   +9.999615559605104e-01];
L2I_Input2_iAMPA_netcon = [+9.976175920630275e-01   +9.972446634122840e-01   +9.887188463025680e-01   +9.898250487095867e-01   +9.897526086027622e-01   +9.893323259105050e-01   +9.916201190629271e-01   +9.954725172908110e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
