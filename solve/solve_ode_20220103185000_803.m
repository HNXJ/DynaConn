function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.147785397875877e-01   +9.462837091624262e-01   +6.992643793451739e-01   +1.554718181357593e-01   +9.217833860114296e-01   +2.195266511364092e-01   +7.404351429578075e-01   +3.018399990283845e-01   +5.327773419675157e-01   +8.294979402918399e-01   +9.688717389105552e-01   +9.644520699828047e-01   +6.958877950436680e-01   +3.711987414419620e-01   +2.973942097034754e-01   +3.786760427243087e-01; +3.447550565880764e-01   +1.361375205535981e-02   +1.413651691725215e-01   +1.751829698664815e-01   +7.157661479408901e-02   +8.072290766224278e-01   +7.948815453607920e-01   +7.579849720977224e-01   +7.844652158081041e-01   +1.814721363930122e-01   +4.662115010052166e-01   +6.563130693318474e-01   +3.755685613580099e-01   +2.748928848755995e-01   +6.854294694772404e-01   +9.531734770897172e-01; +2.078850364041384e-01   +4.675054958915598e-01   +8.351126138211612e-02   +7.033571258496926e-01   +3.141369115500504e-01   +3.823105935623685e-01   +6.636818033505104e-01   +9.526790222174590e-01   +4.878530081164650e-02   +9.266095725184195e-01   +8.695012621670698e-01   +2.090993436783769e-01   +5.414393273511279e-01   +7.524007002666984e-02   +7.723582336566136e-01   +8.113936007840411e-01; +2.502854724988306e-02   +4.897304937050136e-01   +4.330380268939383e-01   +8.318115834925478e-01   +6.273380270736053e-01   +8.564469689475959e-01   +4.420509383672084e-01   +8.165779607468939e-03   +4.628278958463232e-01   +4.205486122222775e-01   +9.459575683812126e-01   +8.977798239906634e-01   +5.180828835655737e-01   +1.511075699548696e-01   +7.204830402814968e-01   +8.914283367338256e-01; +7.658326052695252e-01   +5.155024795795160e-01   +8.948383367502361e-01   +8.151714766774808e-02   +9.053410538110092e-01   +3.242700361967099e-01   +5.749694192473574e-01   +4.073936363728360e-01   +9.382886582206166e-01   +3.011446339339809e-01   +2.325418223211971e-01   +4.880170488379636e-01   +7.639587723816704e-01   +3.649284408851036e-01   +2.785651370018387e-01   +6.812703097747876e-02; +5.708922903981672e-01   +2.872114512603195e-01   +7.323359931712792e-01   +8.353355122415610e-01   +7.969935482600741e-01   +3.791484517215270e-01   +5.179317069360976e-01   +1.510478617356373e-01   +4.725383260413448e-01   +3.484204961232947e-01   +9.184751539413589e-01   +6.613432687905835e-01   +7.964185304669090e-02   +7.183094731454226e-01   +1.362831809424169e-02   +9.030872669761969e-01; +5.764165636149196e-01   +5.646755942425796e-01   +6.800502811830293e-01   +5.409254967806981e-01   +6.428220912063748e-01   +6.371986201035708e-01   +7.246634548485666e-01   +8.211432686449045e-01   +7.789231448986431e-01   +9.723880731191222e-01   +6.348715691069284e-01   +5.261963588483327e-01   +5.084732323852459e-03   +5.327245669662797e-01   +1.485003172369113e-02   +6.680671836761428e-01; +3.907337404483429e-01   +5.098068930882231e-01   +2.010602900376155e-01   +9.627262505258113e-01   +4.403509840711020e-01   +3.881248965521016e-01   +2.227551639340794e-01   +2.874865177973727e-01   +1.092626777807638e-01   +5.309920821121912e-01   +2.835839134975465e-01   +7.083797385230808e-01   +4.001738831067890e-01   +2.325518272747512e-01   +9.367965614865381e-01   +3.468333120532378e-01; +5.564734416176302e-01   +6.782401951540058e-01   +5.293266775320147e-01   +6.774783072589712e-01   +7.480434764608138e-01   +6.714701412178277e-02   +9.980607681796856e-01   +9.784401738722599e-01   +5.226489257726343e-01   +7.902881308565400e-01   +8.552053997947877e-01   +7.188074499838800e-01   +6.620467161716352e-01   +4.706268127268939e-01   +9.336595098782761e-01   +8.365826706667258e-01; +1.834734796904527e-01   +6.154586591670040e-01   +8.301371495512231e-01   +3.365844987075840e-01   +8.254259719859099e-01   +1.690957749912298e-02   +6.202349326778591e-01   +6.253308321689067e-01   +6.363910663178590e-01   +7.934745677873996e-01   +1.656083968145991e-01   +2.949788394888089e-01   +3.679117285943163e-01   +7.170838810565580e-01   +3.743450151900174e-01   +1.988865352276587e-01; +1.185288358601783e-01   +5.652707510482261e-01   +1.746448596644624e-01   +2.208017651042819e-01   +3.410942793761762e-01   +8.792341997808596e-01   +9.798323088295416e-01   +7.439204898565389e-01   +5.783322057729012e-01   +1.453529620778057e-01   +8.285375207096335e-01   +1.168941968686794e-01   +3.919686446479919e-01   +5.144029496575349e-01   +1.092017080030370e-01   +8.419271033690684e-01; +5.857447495542357e-02   +5.046704021887957e-01   +5.186848686403870e-01   +5.693842911126544e-01   +1.396189398853712e-01   +1.574507446148063e-01   +4.951267595260067e-01   +8.729720905880021e-01   +8.351518225331728e-01   +4.559285228048626e-01   +2.168220783062266e-01   +3.250336016265220e-01   +1.345612545633864e-01   +5.144821582707380e-01   +7.193343897573339e-01   +4.253605032471116e-01; +9.327666180808493e-01   +6.679989841832932e-01   +3.556455028183647e-01   -2.682517762288661e-04   +5.038055902629723e-01   +9.141881678354732e-01   +5.232694074466486e-01   +3.288802522765782e-01   +1.158176494061045e-01   +4.585622466540684e-01   +2.682542379491122e-01   +4.565995077900882e-01   +3.382994368763190e-01   +3.857133542556524e-01   +4.492891306097230e-01   +5.587840348356009e-01; +7.454460402077633e-01   +6.327689715346841e-01   +6.446682418663606e-01   +5.886555160803113e-01   +4.135992536504793e-01   +5.558577454514319e-01   +8.550403907475016e-01   +9.883295575579504e-02   +5.252456484593745e-02   +9.538266605286532e-01   +8.635582327146155e-02   +7.171500796416607e-01   +1.221609417052683e-01   +4.797331659496427e-01   +1.240768675760549e-02   +4.482695975071882e-01; +2.428193790502522e-01   +1.454580418463444e-01   +2.821304819616698e-01   +8.913468444797155e-01   +1.716603403015816e-01   +9.221797409738496e-01   +2.537461836848128e-01   +4.506842092364948e-01   +5.172596648154106e-01   +5.364756293184227e-02   +9.162770469406422e-01   +4.050668847720253e-01   +3.691662949047407e-01   +7.398941016895020e-01   +1.239494781915674e-01   +7.598935347292509e-01; +2.041972873895845e-01   +1.791732758217165e-01   +4.369187164051269e-01   +2.546325117786788e-01   +4.941010615587687e-01   +5.974509331527377e-01   +5.825688968382651e-01   +2.396129600936038e-01   +6.973243828818060e-01   +3.646484844205988e-02   +7.265492161707487e-01   +2.415889821359762e-01   +2.508909995079030e-01   +7.017846439247198e-01   +6.586763229510627e-01   +9.600524003836064e-02];
L1E_L1I_iGABA_netcon = [+8.437308179579194e-01   +7.528981980910181e-01   +8.743385627204916e-01   +4.354015898258958e-01   +9.177974309676904e-01   +7.792347799066695e-01   +3.218314445374424e-01   +6.411888630176422e-01   +9.406274704644990e-02   +2.646346858849264e-02   +1.292267163423551e-01   +5.205178622361100e-01   +8.699818602738415e-01   +5.762703868838357e-01   +1.655961121288201e-01   +6.270905790391477e-01; +6.216422846190420e-01   +9.951133579900954e-01   +3.089583427288258e-01   +1.471488836390443e-01   +8.830021683238478e-01   +2.730035597336311e-01   +9.631363549122206e-01   +4.292025891169092e-01   +2.926341911787063e-01   +5.146492537543739e-01   +4.247643590302361e-01   +2.038979719539468e-01   +8.030405798743265e-01   +2.881490898222254e-01   +5.478842866904660e-02   +3.364493968450042e-01; +6.717315940043501e-01   +3.708159121292236e-01   +4.338222840149448e-01   +6.542112759017360e-01   +5.857964740454423e-01   +5.266142481983110e-01   +3.528563565012261e-01   +4.779389552064164e-01   +3.258653143535511e-01   +8.630655314108583e-01   +4.807885263781879e-01   +7.753348526114764e-01   +6.465906649801924e-01   +1.319693604942220e-01   +2.109528187247282e-01   +1.563045834606201e-01; +7.819180431623572e-01   +5.019311107714564e-01   +3.814836646573037e-01   +7.213741889086187e-01   +8.351315790780709e-01   +4.030328610575639e-01   +3.198393629843042e-01   +1.005495279547811e-01   +4.829962155501610e-01   +5.811081727896829e-01   +6.737386802130586e-01   +3.909934944591580e-01   +7.344936354000519e-01   +4.946009213032613e-02   +2.043568934482912e-01   +4.022033085676881e-01; +3.091924498243192e-01   +7.587093977053557e-01   +6.567189318701789e-01   +1.616627748207001e-01   +7.763160877049622e-01   +7.787860076024600e-01   +9.082505894865958e-01   +8.074798257809580e-01   +2.419541433028894e-01   +4.223609302901780e-01   +3.574567416246174e-01   +6.691747612940373e-02   +6.673218656122831e-01   +6.244092577576387e-01   +2.174874056507242e-01   +9.130393793183473e-01; +3.305863418544562e-01   +1.269987199284432e-01   +2.371092886623676e-01   +3.425430913194805e-01   +7.846059592272738e-01   +2.562796690419709e-02   +8.848974238617913e-01   +6.500055366269013e-02   +4.539413311120736e-01   +7.134468627044495e-01   +5.046133242227685e-02   +7.558772879087003e-01   +8.810385100935466e-01   +6.061849921760228e-01   +5.782100549448940e-01   +1.487863502379102e-01; +6.339731604189869e-01   +5.180768058644953e-01   +6.857327926922089e-01   +1.066268052858581e-01   +7.012001022200292e-01   +4.121780209415485e-01   +3.520182073767482e-01   +9.543091988426187e-01   +7.586253895333532e-01   +2.337020476228782e-01   +2.905301456110791e-01   +4.531360514854227e-01   +8.528501361790674e-01   +3.713734638753895e-01   +3.333444917234833e-02   +4.638954330289861e-01; +9.017045344051130e-01   +9.062253064404339e-01   +3.266657447746782e-01   +4.092658002489128e-02   +1.861002835723316e-02   +8.260831193418825e-01   +7.499048993785769e-01   +7.729394536861699e-01   +7.187822604850832e-01   +5.866538647992880e-02   +7.941987672713882e-01   +3.187915461409188e-01   +4.037333455492807e-01   +8.320469478891744e-01   +7.952577313035868e-01   +7.892684440311205e-02; +3.714387466888376e-01   +9.907133059185987e-02   +8.814128793003499e-01   +4.784085964290146e-01   +3.303886695199956e-01   +5.925595828862616e-01   +1.264009047320832e-01   +4.402528839388651e-01   +2.375923667120611e-01   +9.765290499877596e-01   +6.517538959267720e-01   +2.778173400852847e-01   +1.056762942200982e-01   +5.198213235037892e-01   +1.344139620048818e-01   +3.423687163430369e-01; +8.816178086021192e-01   +1.792199399054955e-01   +9.990073534123894e-01   +4.769389036840968e-01   +9.479675963566111e-01   +2.131791966286598e-01   +5.992023351952570e-01   +1.658918391440182e-01   +6.995981674479833e-01   +9.697855990567920e-01   +7.100820989954369e-01   +5.836825471013503e-01   +4.031301032670936e-01   +8.006425476217870e-01   +5.822739150020187e-01   +4.968721150606055e-01; +1.245429205011487e-01   +1.729273004207610e-01   +6.807428957501076e-01   +5.461444707734381e-01   +3.989105629924675e-01   +2.961552932495792e-01   +4.366844801087708e-01   +8.105457892120754e-02   +3.051263619058528e-01   +1.367510631617611e-01   +7.654561371055533e-01   +9.117083628468314e-01   +3.408200359194351e-01   +5.705591118379988e-01   +8.577330848189918e-02   +4.892172671167668e-01; +8.878210246302209e-02   +5.339841818030069e-01   +3.447172608899534e-01   +6.511904915880394e-01   +6.323327790954819e-01   +2.677428981888910e-01   +9.592221079784562e-01   +7.422101349534266e-01   +4.702841800212620e-01   -5.495718569687587e-04   +3.835561146660552e-01   +4.507515337529189e-01   +1.143150576648474e-01   +7.147810300146836e-01   +2.291518202442810e-01   +1.276808210186846e-01; +5.459871952773943e-01   +9.794414735224777e-01   +5.607305356614444e-01   +3.489527881003623e-01   +8.591025828986473e-01   +9.285138133292870e-01   +9.643731725750135e-01   +5.439799976602819e-01   +4.442653426936071e-01   +9.365381619687093e-01   +3.619527769446316e-01   +9.802427817113027e-01   +8.519153772205860e-01   +7.329424379050868e-01   +4.516939367989586e-01   +8.578516746420600e-02; +6.107798732444847e-01   +8.434715516283315e-01   +8.906868097673831e-01   +2.561677727323108e-01   +3.769975907682459e-01   +5.528016324516560e-01   +2.425381272502400e-01   +4.859765236758934e-01   +7.341489447606430e-01   +7.411289763803941e-01   +8.100590267825837e-01   +1.108645670544530e-01   +8.926897350738409e-01   +4.548474690460319e-01   +1.784781997170725e-01   +6.738854216693780e-01; +7.275576197549288e-01   +6.728221027341292e-01   +6.465839421464137e-01   +1.764675245931490e-01   +2.046033111058355e-01   +4.323335194278259e-01   +7.703884603261703e-01   +8.957878248986231e-01   +8.763573998050024e-01   +4.323629633977165e-01   +3.861126524554699e-01   +4.156657593273687e-01   +6.857893340522421e-01   +2.833762664826011e-01   +4.139647078404317e-01   +1.220505034905629e-01; +9.918098444940762e-01   +9.288427991577664e-03   +3.771771195539251e-01   +4.785319267707636e-01   +9.118139515994566e-01   +3.276783573395312e-01   +7.126630541922410e-01   +5.826914527045398e-01   +9.136618611807508e-01   +9.441072561932824e-01   +8.715176367387019e-01   +3.830383535276277e-01   +7.431426099342245e-01   +1.513129956653650e-01   +9.650657932055365e-01   +9.890496920076663e-01];
L2I_L1I_iGABA_netcon = [+5.738894875752032e-01   +5.645719264143622e-01   +1.081078387540449e-01   +4.598376533800613e-01   +7.969603844154046e-01   +9.783081969692123e-01   +2.240257043061191e-01   +7.585000487107670e-01; +5.583381947759098e-01   +9.531663344221952e-01   +1.186602509490179e-01   +5.667941221516866e-01   +5.421671181066253e-01   +4.223097766433745e-01   +6.638493133469107e-02   +5.064738295151522e-01; +6.111843399958040e-01   +8.725225467312227e-03   +4.338395244544660e-01   +8.168407191409406e-01   +2.574247053944693e-01   +3.932183485997163e-01   +8.357224975965946e-01   +8.285680267333624e-01; +4.668876340136691e-01   +1.261877428470674e-01   +9.320805401699941e-01   +3.556815656821300e-01   +7.811545264680725e-01   +4.611350316116938e-01   +4.125597598608197e-02   +9.274594557608904e-01; +4.343471182007630e-01   +8.538039419429750e-01   +1.399596919310305e-01   +2.483872063750568e-01   +7.795149950790589e-01   +1.215869362454249e-01   +9.096791547066246e-01   +7.107065978082241e-01; +6.271111226687705e-02   +2.181856328352669e-01   +8.258720038297533e-01   +7.708999575682686e-01   +1.444239722387086e-01   +4.542492232648098e-01   +4.494482771391261e-01   +7.978489366717887e-01; +6.469110525329960e-01   +7.101040514202092e-01   +9.329275970581202e-01   +1.877641465259080e-03   +8.237052152262769e-01   +2.646601989973445e-01   +2.845921940029789e-01   +9.588993496115816e-01; +4.262324488136990e-01   +7.747457443975284e-01   +5.729043570178758e-01   +2.763374233576051e-01   +6.232792163770436e-01   +9.270177847585653e-02   +7.556852765074017e-01   +9.517564246848416e-01; +7.562537436952543e-01   +4.215725979089573e-01   +4.988026167052191e-01   +2.307116574350249e-02   +4.565902416761671e-01   +6.620753119015841e-01   +9.267859229785006e-01   +2.953923115730825e-01; +3.062524689137707e-01   +7.256489947271924e-01   +9.311515470363068e-01   +6.700399350756545e-01   +4.835387636688366e-01   +9.448826932066186e-01   +1.408955474409522e-01   +3.522248469356989e-01; +5.972200155282079e-01   +4.579429604575785e-01   +8.626454969805223e-01   +9.670328086416612e-01   +2.191310959628244e-01   +7.649303140149398e-01   +9.554524302339287e-01   +5.413604434906352e-01; +3.344170367863936e-01   +8.052561623278252e-01   +2.538710227024354e-01   +9.456580439084871e-01   +8.576200505102312e-01   +4.323425052436032e-02   +3.044993542580449e-01   +2.127170424248792e-01; +6.432251365770227e-01   +4.280543413478071e-01   +4.583764386627550e-01   +4.601761852411721e-02   +8.801336667375449e-01   +2.607503089668829e-01   +2.094770522903141e-01   +8.092117524204340e-02; +7.445042546818135e-04   +1.490202665377346e-01   +7.408751721106305e-01   +2.867102769182587e-01   +8.459816540474425e-01   +6.346512225581467e-01   +4.639422736517521e-01   +5.067142047036111e-01; +1.442630087613882e-01   +8.050130113255781e-01   +7.526586212229471e-01   +4.875896852580540e-01   +4.430379576206485e-01   +8.935855198765998e-02   +5.974133470443882e-01   +1.948190792280337e-01; +2.477412038749071e-01   +3.815993986619117e-01   +2.297999568754573e-01   +8.877720392156652e-01   +5.429180793059518e-01   +7.516653023777384e-02   +5.518766940624257e-01   +1.455728108805837e-01];
L1I_L2I_iGABA_netcon = [+6.989817583375977e-01   +8.670456928490751e-01   +6.141778029686579e-01   +5.519724275705914e-02   +1.433609351317901e-01   +2.344105256120821e-01   +8.384341079282331e-01   +3.704916847464674e-01   +7.068674770964463e-01   +3.840751458988255e-01   +2.397077492585363e-01   +6.667671554449315e-01   +1.684239394083147e-01   +5.694358329852331e-01   +4.325410909941440e-02   +4.872980694389016e-02; +5.982976934490098e-01   +7.976595630660780e-01   +6.100708857144410e-01   +5.786608728375132e-02   +7.447572581488712e-01   +5.564637780268421e-01   +1.974654308097033e-01   +5.587464476930882e-01   +1.870488406334511e-01   +7.195262348700641e-01   +5.136787485955162e-01   +3.291246168422401e-01   +1.148511222740093e-01   +8.095994693105257e-01   +4.420901111743034e-01   +9.217790434741345e-01; +1.630773749505433e-01   +6.270734749957728e-01   +3.144567304548427e-01   +5.971328363683486e-01   +9.512540851907557e-01   +1.137821234295778e-01   +6.172632435191144e-01   +8.298084727110195e-01   +2.313462682752331e-01   +6.419811884034742e-01   +7.322786417546773e-01   +5.513838782570589e-01   +7.356973255957753e-01   +6.742880088142004e-01   +9.169647157467135e-01   +1.742855296720550e-01; +4.837668959945355e-01   +4.726007409515968e-01   +1.421587344742058e-01   +6.575356476274643e-01   +2.657820791552347e-01   +8.177821786437856e-01   +1.551918172401442e-01   +7.067006095317870e-01   +9.983763809509819e-01   +1.017225285294291e-01   +7.703209596085641e-01   +5.326452345667988e-01   +2.111298053970722e-01   +4.435848217431009e-01   +8.847750792445070e-01   +7.438816128800159e-01; +2.857380233252514e-01   +1.828254775078574e-02   +6.050489554296694e-01   +4.807641685180534e-01   +9.486593796862965e-02   +6.506061334342250e-01   +5.832526958319755e-01   +1.156136737759398e-01   +9.057785841357827e-01   +4.916456095794260e-01   +6.770972275509173e-01   +9.010421459154283e-01   +4.839830353934807e-01   +8.937608693573925e-01   +9.285754527276972e-02   +4.752652540357113e-01; +4.040678776937001e-01   +1.177659564298498e-01   +8.894262547770942e-01   +9.781008285316404e-01   +2.315000669786223e-01   +2.376914645390068e-01   +5.448794769533473e-01   +7.407159566161396e-01   +1.163565358709545e-02   +5.611850665710592e-01   +8.132344974602824e-01   +2.839211026951844e-01   +5.087070211152010e-02   +7.826670712746411e-01   +6.753546593482362e-01   +2.462794721891429e-01; +4.913935891830157e-01   +7.194006595424741e-01   +5.624228456681416e-01   +8.638751773339320e-01   +8.958359376385527e-01   +3.021273603950718e-01   +6.813176264258723e-01   +9.240576029428008e-01   +8.338636966966089e-01   +5.534509768263918e-02   +4.185862747824508e-01   +1.388318904878186e-01   +5.715591092842335e-01   +5.815143719070262e-01   +9.445786332706690e-03   +6.634623453418079e-01; +8.627324524194313e-01   +6.822660901590161e-01   +6.328251903529949e-01   +9.543661945484537e-01   +1.998416545989340e-01   +3.305123136741768e-01   +6.986718416903316e-01   +9.233432233352644e-01   +2.533219127950771e-01   +8.907323687687675e-02   +4.978876086923408e-01   +9.572701582817159e-01   +4.912257093225923e-01   +6.159304666003794e-01   +1.217175527166410e-01   +6.090378777544510e-01];
L2E_L1E_iAMPA_netcon = [+3.678221808606111e-01   +5.616431584509570e-01   +2.005432346723971e-01   +5.136690663947662e-01   +2.898632692467231e-01   +7.403005962347903e-02   +2.788209726386196e-01   +2.670333325534294e-01; +4.375137418599415e-01   +1.933922739540186e-01   +1.371436952452333e-01   +6.852662560870291e-01   +6.199345319381883e-01   +5.934991407227931e-01   +9.292358316285515e-01   +9.048739290118242e-01; +7.183908494246625e-01   +6.127695733092502e-01   +8.180893126485576e-02   +2.069515765683419e-01   +8.628059005248274e-01   +7.569455880680991e-02   +7.640164823955750e-01   +1.594048166459658e-01; +1.916556383847329e-01   +7.409892171094303e-01   +9.060001044213697e-02   +9.715510184101339e-01   +8.201272453841788e-01   +3.971804361551476e-01   +2.616503455150549e-01   +5.537304872320420e-01; +3.984412913952627e-02   +8.314143527386452e-01   +5.509721262937610e-01   +3.504043209406392e-01   +2.056628603002971e-01   +5.903853152669732e-02   +2.430417509083021e-01   +4.224252388273406e-01; +3.147664318199169e-01   +2.767220954993031e-01   +7.321676815729167e-01   +1.851468093575457e-01   +7.509861295704647e-01   +1.287259436926508e-01   +1.657905490932393e-01   +5.467409382280050e-01; +7.900520310814204e-01   +6.086103227160835e-01   +5.443513034817464e-01   +2.380055285676287e-01   +1.986085178317044e-01   +2.446305066947783e-01   +2.873029663593725e-01   +7.543177736658337e-01; +4.746135642006619e-02   +5.480463632584018e-01   +5.479420401488499e-02   +2.534977638019011e-01   +5.776365128909368e-01   +9.439502896885534e-01   +5.643636090140504e-01   +1.406764824958899e-02; +2.158931254241857e-01   +2.741325625459213e-01   +6.325493381342012e-01   +2.224248384025607e-01   +8.767752466101999e-01   +2.029558556236465e-01   +4.048186775111254e-01   -1.453422038639042e-03; +2.740546671004055e-01   +3.396424122686908e-01   +9.943061489812614e-01   +3.593025730065913e-02   +7.144384102236271e-01   +3.275013226381194e-01   +9.874017706844643e-01   +2.112611429050612e-02; +7.893397517787030e-01   +5.668880472669344e-01   +9.149451619805392e-01   +3.570352091929540e-01   +7.004231491663716e-01   +8.670009333496489e-01   +5.448243917386590e-01   +3.595512818481127e-01; +9.903526242119481e-01   +7.440776933993897e-01   +7.687457578538905e-01   +8.984134471433466e-01   +4.679368374324224e-01   +9.222576332814258e-01   +9.290925112016506e-01   +4.268295637638871e-01; +9.440366134505364e-02   +7.720368235497594e-01   +1.909465238656428e-01   +1.403218459345660e-01   +5.041650963452803e-01   +2.335885681776782e-02   +9.925918933821605e-01   +5.446571411240837e-01; +1.964082756602296e-01   +3.980293901969645e-01   +3.188218500843758e-02   +9.559347644751945e-01   +7.960855413300287e-01   +3.647483311835512e-01   +8.364795235023058e-01   +4.921604981159406e-01; +1.165119390649838e-01   +1.486256780328110e-01   +3.733274402467393e-01   +9.022210886786012e-01   +9.400652903810600e-01   +5.280964175934246e-01   +1.805575266031761e-01   +9.201201349664937e-01; +6.472120621345923e-01   +2.077575679536620e-01   +5.756484029202519e-01   +4.104295776633629e-01   +7.819304739027496e-01   +4.066998419017642e-01   +3.134948494367289e-01   +4.162691774900742e-01];
L1E_L2E_iAMPA_netcon = [+4.969793118396932e-01   +4.492424402783458e-01   +6.161513411335794e-01   +4.905780568889630e-01   +2.302571460841743e-01   +7.205236410751580e-01   +6.942184437969934e-01   +6.327465384221149e-01   +5.221958069947530e-01   +2.412234278925239e-01   +8.764224611470617e-01   +1.740309637666091e-01   +1.382599459267039e-01   +2.435663427495713e-01   +1.833693519261652e-01   +2.404311360766664e-02; +8.381866315158916e-01   +3.694481313799637e-01   +1.042158684802570e-01   +6.611840307299525e-01   +8.359506022645966e-01   +3.805901585078590e-01   +9.788559716915542e-01   +6.265991402906343e-01   +6.728670337860956e-01   +7.288666551105152e-01   +6.587829715298636e-01   +3.022644359103952e-01   +2.824344397913865e-01   +7.488180111088322e-01   +1.462542690985097e-01   +2.507653895603988e-01; +1.849010754469332e-01   +3.007910612765548e-01   +7.522818489254597e-01   +1.789136787011812e-01   +7.339038433368229e-01   +3.839113894064314e-01   +7.502896366397566e-01   +4.070485903433879e-01   +7.777015901916925e-01   +1.366936485348090e-01   +5.381123915383252e-01   +1.094696136236716e-01   +7.177059409468084e-03   +9.373082256190249e-01   +1.322462793687142e-01   +9.892557118249332e-01; +3.370887978651553e-01   +2.328720382223920e-01   +5.360648099928406e-01   +4.798602322376246e-01   +4.885919625190705e-01   +7.156488108043648e-01   +5.538986608909962e-01   +4.253440619840842e-01   +4.640490841743338e-01   +4.126562584549003e-02   +2.523022527336348e-01   +4.516225527386427e-01   +3.057330541850589e-01   +2.951039436035214e-02   +1.719413475096027e-01   +6.296165449725457e-01; +6.924861366832572e-01   +1.368469236475038e-01   +4.434215414767474e-01   +4.984447792509142e-01   +8.489812807353148e-01   +8.388972851094262e-01   +2.965682634469141e-02   +5.101807907780226e-01   +9.076666053065039e-01   +6.496438067469050e-01   +1.048545444041952e-01   +5.840554868214148e-01   +9.050280181164198e-01   +4.351927903402595e-01   +9.227284290117491e-01   +3.574755340535320e-01; +6.928604007639153e-01   +9.941374614250187e-02   +7.426635638883939e-01   +6.001456828781672e-01   +7.151563884134423e-01   +6.678912453081659e-01   +1.948912088554836e-01   +2.594871464802460e-01   +2.564523590127471e-02   +2.001106844803413e-01   +9.718299890831902e-01   +2.246031002562625e-01   +2.946337940999977e-01   +8.310589819933482e-01   +2.590744068681474e-01   +9.380519978548685e-02; +3.684360744936050e-01   +2.269546045106275e-01   +3.875941624264157e-01   +2.410245309349086e-01   +5.215701005532077e-01   +6.512321242086664e-01   +9.418114146872580e-01   +4.229659075717452e-01   +4.794749939909161e-01   +9.736847069537207e-01   +5.969429930784419e-01   +1.101469600173075e-01   +8.330264009195036e-01   +9.997245401021631e-01   +2.055849183327668e-01   +4.096859460814671e-01; +3.492312014210946e-02   +3.465343139952335e-01   +5.260025448078756e-01   +5.170955103707179e-01   +9.377154222624662e-01   +5.633690216443993e-01   +3.974519521002185e-01   +5.235865055563848e-01   +2.715946437812238e-01   +8.206198509134844e-01   +8.191481490530029e-01   +5.601643602925187e-01   +7.453050126189920e-01   +9.205692533278925e-01   +6.129166663751989e-01   +9.309970844868575e-01];
L2I_L2E_iAMPA_netcon = [+6.774780642085584e-01   +6.146346847790524e-01   +4.182813988779729e-02   +7.928758892343756e-01   +5.240427067459160e-01   +8.261205558160958e-01   +6.439396791399135e-01   +3.860163955911977e-01; +2.296702114718315e-02   +9.453806332106400e-01   +5.450134188753504e-02   +9.294369372426199e-01   +5.437680833850893e-02   +1.074701619046048e-01   +3.932641173755131e-02   +1.670957267689677e-01; +7.334928331761418e-01   +9.636940704720445e-01   +4.013532081910031e-01   +9.364698756985358e-01   +2.872062663383713e-01   +2.336827300517480e-02   +5.683590590288377e-01   +4.440205877872491e-01; +2.124080018479856e-01   +3.687167111539902e-01   +9.835219463665552e-01   +1.462680539400527e-01   +7.097986029405702e-01   +1.167518469915521e-02   +3.042067296852842e-01   +8.732674628040547e-01; +8.603440432513364e-01   +7.947528558556204e-01   +7.121994118104467e-01   +3.188368495739012e-01   +8.781967361122225e-01   +3.364698792563103e-01   +2.611565733381576e-01   +4.114532207227437e-01; +1.569646228451647e-01   +7.285104371132188e-01   +9.884794606688110e-01   +4.280261815543966e-01   +3.664269716221578e-01   +6.635939337725625e-01   +7.215048456949866e-01   +1.623742768645823e-01; +6.687173137103440e-01   +9.538710580315959e-01   +6.459051783412424e-01   +7.010928789703089e-01   +5.605894335729942e-01   +5.952523447401274e-01   +3.057732274771801e-01   +6.621770641688840e-01; +9.361738981215614e-01   +1.110604004297502e-02   +5.027020541519193e-01   +6.153253126022987e-01   +8.838148623258811e-01   +8.055362750209868e-02   +8.953362251087823e-01   +9.255717117903345e-01];
L2E_L2I_iGABA_netcon = [+6.021655512879780e-02   +5.190989302036129e-01   +3.527834142024352e-01   +2.620553979621396e-01   +4.228734661170672e-02   +8.907998966207141e-01   +3.442998567577825e-01   +4.512642355778830e-01; +3.537603470677143e-01   +6.943999121560630e-02   +5.571216541381274e-01   +9.846132639682437e-01   +3.604985274446367e-01   +5.406628808856978e-01   +9.354455778369329e-01   +6.715209750357751e-01; +9.318303682283560e-01   +1.844612588591852e-01   +6.923700314877456e-01   +3.495425870331029e-01   +3.574175657477639e-02   +7.171554087802910e-01   +9.183923906931599e-01   +7.689138469676017e-01; +2.418311394133317e-01   +3.171760007825364e-01   -6.517567033612502e-03   +4.025045179866089e-01   +4.856300882172508e-01   +7.113195455688882e-01   +7.248198679444247e-01   +9.271720082604352e-01; +1.022649942997947e-01   +2.440358176893601e-01   +4.733864030884961e-02   +7.522699825924420e-01   +7.234472401928544e-01   +1.695077281993158e-01   +4.428745401145031e-01   +6.582185830780862e-01; +7.164894829703651e-01   +3.226975242826842e-01   +3.080408084359716e-01   +1.013719929446892e-01   +1.406258063321351e-02   +3.523436078717436e-01   +1.512741600588522e-01   +5.016698526859551e-01; +5.731916155898422e-03   +8.791379953808359e-01   +8.690081675377025e-01   +5.908193833225349e-01   +5.170919833748315e-01   +3.790861130902003e-01   +8.315403446448567e-01   +3.420739469847898e-01; +1.851325180063551e-01   +3.010381465415451e-01   +6.272642366286163e-01   +1.238622263862526e-01   +2.389313948975010e-01   +7.576842719338994e-01   +2.568514163420257e-01   +9.462347052931973e-01];
L3E_L2E_iAMPA_netcon = [+7.963006320293566e-02   +1.527111648472475e-02   +3.684058295200222e-01   +4.964084772874024e-01   +1.748849560127214e-02   +9.558412828308740e-01   +3.592444342110012e-01   +1.389927661799168e-02   +2.037916775114098e-01   +6.186331207047090e-02   +2.431966707076582e-01   +9.989199426158725e-01; +9.524799314270882e-01   +9.770867454718324e-01   +1.166367721747470e-01   +6.581891834939453e-02   +8.061351579782484e-01   +3.870925425978650e-01   +2.243711983644932e-01   +1.211794754714845e-01   +3.566888933526319e-01   +7.415086258867823e-01   +5.339732308715814e-01   +3.446940325639035e-01; +6.624747610990830e-01   +7.243116167496810e-01   +5.143264661442608e-01   +8.622692821170879e-01   +7.917066809179721e-01   +6.642683864883016e-01   +7.247850416046288e-01   +6.699237866603006e-01   +8.878163699745104e-01   +9.906663550468205e-01   +3.335639248878812e-01   +8.222923532668571e-01; +1.691423307664637e-01   +8.720115715958585e-01   +6.820773492594982e-03   +9.967026166697954e-01   +4.237671207643243e-01   +5.855442302544306e-01   +7.722116320273722e-01   +5.083395843531781e-01   +8.083553127404672e-01   +7.673847143220615e-01   +6.747457817124504e-01   +1.090982123037220e-01; +1.971647127075600e-01   +8.148573671401097e-01   +8.688529053849982e-01   +1.224242498501327e-01   +6.307245643220082e-01   +5.908718880751159e-02   +3.423904056845516e-01   +7.017831941262692e-02   +3.196389385731447e-01   +8.818815691943758e-01   +8.752057073342511e-01   +7.735576158623075e-01; +9.956146948558544e-01   +3.004335108032862e-02   +9.040156970020669e-01   +1.000318856883557e-01   +5.681967996077503e-01   +7.593925927245762e-02   +5.761522923477465e-01   +5.353310850532377e-01   +6.010135686409753e-01   +3.626039692614262e-02   +9.830902161622546e-01   +1.503315340458370e-01; +9.259721050421470e-01   +9.678600530973318e-02   +1.131668231428051e-01   +1.492028849169109e-01   +8.958430207478684e-01   +2.277994002767178e-01   +6.430856093459608e-01   +6.776023584006897e-01   +6.984311386999112e-01   +7.943498003402960e-01   +1.459023268843109e-01   +7.311417522129936e-01; +9.819952963089404e-01   +8.525531604501223e-02   +4.407216146397833e-02   +1.288206097765197e-01   +7.488781122482159e-01   +4.209972202317601e-01   +3.662197156427154e-01   +5.884356393520889e-01   +1.781323770166364e-01   +7.066413526286651e-01   +8.770155300097696e-01   +1.089398272845007e-01];
L3I_L2I_iGABA_netcon = [+7.683598534555202e-01   +5.352765900253276e-01   +5.968730149693751e-01   +3.036556533782775e-01   +9.653791866285160e-01   +1.150048428667192e-01   +2.981028651522450e-01   +7.952132849158882e-01   +9.140188969209481e-01   +9.956389439970165e-01   +3.099844007170380e-01   +9.965838896347892e-01; +6.368092640223323e-01   +4.531054575553011e-01   +5.630930624064561e-01   +7.630236849430297e-01   +5.438572577368261e-01   +7.085725495159398e-02   +1.676310125271688e-01   +5.269300868652158e-02   +3.854976081995916e-01   +2.877325787064688e-01   +4.422121079598954e-01   +9.154079320583475e-01; +7.963622486454621e-01   +1.144767142040149e-01   +6.805742272118356e-02   +6.479711945448566e-01   +9.820062245585446e-01   +5.046772761635257e-02   +7.246509698705274e-01   +1.809274330325691e-01   +7.512064085152109e-01   +5.158615251005286e-01   +2.092564804666222e-01   +6.905035085920289e-01; +9.595901456809275e-01   +7.204173633435075e-01   +7.680589828837905e-01   +3.324470445592904e-01   +1.247706864778955e-01   +1.301168298769037e-01   +2.988604417983973e-01   +2.461640394768864e-01   +8.784095183886323e-01   +3.586597274748237e-01   +9.413717619100128e-01   +2.209650359755407e-01; +7.171059289199169e-01   +1.856504754994289e-01   +8.680691767323568e-01   +9.709074146562410e-01   +1.684550912997901e-01   +4.910492236938923e-01   +6.781807250370334e-01   +2.616026208873191e-01   +3.922411252222408e-01   +5.168751195883587e-01   +2.900133613660201e-01   +3.137525477922134e-01; +6.440471557133279e-01   +3.248491376340694e-01   +7.091098819347819e-01   +5.318039935264153e-01   +3.339303639259547e-01   +4.679787503690576e-01   +7.463360250288890e-01   +6.476870274093499e-01   +1.669687322390585e-01   +5.008083733875812e-01   +1.220225166403676e-01   +2.370848170172533e-01; +5.117722692951699e-01   +9.670954589879162e-01   +1.083454865646697e-01   +7.518005005402839e-01   +5.312666447368196e-01   +1.586074038291934e-01   +7.453628687340299e-01   +9.749753965786190e-02   +4.367513019408493e-01   +1.888057411764520e-01   +6.975868297312735e-02   +7.081913591613844e-01; +9.517562557953411e-01   +7.006486402860806e-01   +6.655905192052504e-01   +2.706339130419353e-01   +6.924476552298867e-01   +1.385560606077230e-01   +7.847968651480981e-01   +4.690190786758375e-01   +8.585604014569643e-01   +4.771803350790349e-01   +7.292989333644649e-01   +3.754555538221378e-01];
L2E_L3E_iAMPA_netcon = [+6.562626332066483e-01   +3.871764935251794e-01   +2.348005099347429e-01   +4.634494890472655e-01   +9.048310205878929e-01   +9.502198461101883e-01   +7.622197230330056e-01   +3.545228909552057e-01; +3.846225581907377e-01   +2.293198772721850e-02   +9.045491254845929e-01   +2.832201034844081e-01   +6.794509893780831e-01   +2.636822027724980e-02   +9.033150637366407e-01   +6.636929954064057e-01; +3.083038237176031e-01   +3.299048131898467e-01   +4.872998829285679e-01   +2.764738384700411e-01   +8.425797379668323e-01   +5.015516958942848e-01   +7.963266909387344e-01   +5.924165990295553e-01; +1.574875705417044e-01   +4.846799479041248e-01   +5.959786564260789e-01   +1.422052058128710e-01   +9.475811206779915e-02   +3.390079515865220e-01   +9.564298162392220e-01   +5.445042925926482e-02; +7.780825550798569e-01   +2.618974819096504e-01   +9.548721071257353e-01   +1.394596605042653e-01   +7.354940900972858e-01   +6.720817993516834e-01   +5.350714224438715e-01   +2.165246459671749e-01; +7.091586172188010e-01   +5.264335748214459e-01   +8.510759976676452e-02   +2.654639884574854e-01   +5.435163695251489e-01   +1.677627134871959e-01   +1.638589121316661e-01   +6.023135973892396e-01; +1.728462835808481e-01   +4.163893842677849e-01   +2.223379076343294e-01   +6.103262268025655e-01   +2.566935548568615e-01   +2.267761116042768e-01   +1.347374335783899e-01   +2.691082754400742e-01; +4.481075599788713e-01   -4.703900942548465e-03   +1.517274170765793e-01   +1.061296237320797e-01   +7.146977058656664e-01   +1.179337590179598e-01   +3.402526424229076e-02   +1.093338613975516e-01; +8.380111990679470e-01   +8.937453552554716e-01   +3.893316474141167e-01   +4.847596521326274e-01   +3.603988596603184e-01   +9.928559132258279e-01   +6.807624587301979e-01   +2.112848872578514e-01; +6.974872884556850e-01   +2.386964983659701e-01   +1.848517746618928e-01   +8.933641359265805e-01   +8.545821047936857e-01   +1.398270628484498e-01   +5.873378741337167e-01   +8.731384855096285e-01; +7.654281449385677e-01   +7.923788302534912e-01   +7.633363181007657e-01   +1.882083471959492e-01   +8.186152611121520e-01   +7.691642516491694e-01   +2.985946785870645e-01   +4.594247330602131e-01; +9.801817258006144e-01   +5.787239459638313e-01   +2.286362807054999e-01   +5.170810195316534e-02   +6.108169838075198e-01   +6.343713401417518e-01   +7.371876190446792e-02   +7.273078668683720e-01];
L2I_L3I_iGABA_netcon = [+5.894848393598759e-01   +1.476849662497767e-01   +3.444961529460712e-01   +3.697297105566539e-01   +5.994349250926555e-01   +5.071789701330781e-01   +7.729974889363366e-01   +2.647904179387001e-01; +8.457564770378968e-01   +9.903667715266139e-01   +4.659752930735152e-02   +5.374050663618817e-01   +4.785473868928994e-01   +2.368534909220116e-01   +1.792852581922625e-01   +5.852772599911725e-01; +6.048804142530920e-01   +4.806574403101152e-01   +9.420584150171235e-01   +9.748540150747252e-01   +3.766515391156317e-01   +2.721835068445443e-01   +4.544762124493165e-01   +6.790224700199726e-01; +7.441593939087241e-01   +3.507354822118886e-02   +8.674668878614471e-01   +9.969110107383098e-01   +9.784216804400618e-01   +4.050067444776757e-01   +3.055549179154770e-01   +4.153554555037485e-01; +8.493768023075016e-01   +2.694605321063084e-01   +1.333837916092634e-01   +4.150760136426040e-01   +1.383784724426102e-01   +2.601967027178322e-01   +3.875801774251449e-01   +5.117504054152133e-01; +1.466689857980325e-01   +6.758788921628094e-01   +5.911608674837568e-01   +4.512237961660963e-01   +2.709290332860486e-01   +8.537687786481488e-01   +8.034699458962371e-01   +8.142706341612038e-01; +7.416829938605420e-01   +1.473077593431675e-01   +6.214581114640829e-02   +2.551833447430774e-01   +2.253850302890842e-01   +4.791478417379770e-01   +7.779227104487257e-01   +5.446087068754301e-01; +1.689470692859120e-02   +7.739943904679335e-01   +9.469548126371534e-01   +6.013669223925585e-01   +7.909611024448825e-01   +3.413574621812775e-01   +6.454790953147456e-01   +5.894138019989315e-01; +2.281460433132941e-01   +2.671422889989452e-01   +4.967295284800487e-01   +7.780313469542952e-02   +8.174153971355103e-01   +6.390038288978569e-01   +2.418006680812692e-01   +5.352759765435560e-01; +5.374703994767518e-01   +8.807864028476672e-01   +2.622821043447782e-02   +9.122316242011959e-01   +7.919459557409074e-01   +4.155116909681680e-01   +6.093344726630118e-01   +5.415380743454906e-01; +7.207794437385235e-01   +3.689216932869494e-01   +5.748046080208432e-02   +4.727583164686195e-01   +1.127949558609372e-01   +5.431371764456694e-01   +4.201757311146995e-01   +1.517473846635268e-01; +4.340059953248832e-01   +1.018584414709865e-02   +3.005940700898292e-01   +5.083482890507961e-01   +6.326235441594312e-01   +3.392934123426596e-01   +2.942713137001212e-01   +7.027982171023699e-01];
L3I_L3E_iAMPA_netcon = [+6.434098015204261e-02   +7.736108582923815e-01   +5.552505961108383e-01   +5.732425071724072e-01   +9.197805411289472e-01   +8.350765349090771e-01   +8.490448395241281e-01   +8.624511104756687e-01   +5.341552461035464e-01   +9.884429622146995e-01   +4.816012636996013e-01   +3.506821374281592e-01; +9.225118701983408e-01   +8.390781327715193e-01   +8.442325953809972e-01   +9.352630654955997e-01   +5.923369584382103e-01   +3.926019155925455e-01   +6.278051507099339e-01   +8.558802720103068e-01   +5.668499972230949e-01   +7.010376493529443e-01   +7.396471686568676e-01   +3.996535990665974e-01; +1.804553527743764e-01   +5.928417139647670e-01   +9.691678601896944e-01   +7.785519752862694e-01   +5.751753180740474e-01   +6.979160911390118e-02   +4.448125788838811e-01   +9.495932433465886e-01   +9.799655426798680e-01   +8.442305802614014e-01   +5.952429951906533e-01   +9.877595035365069e-01; +5.435296211024816e-01   +7.673095406716545e-01   +4.666878434057802e-01   +5.973281125258383e-01   +6.585695342128293e-01   +3.736473440380893e-01   +2.346856166960689e-01   +6.937976029184885e-01   +9.675106047831142e-01   +7.377577726196409e-01   +2.627547289998610e-01   +2.969736522869885e-01; +3.968793227873837e-01   +6.586817490453825e-01   +7.760753023543752e-01   +5.811442611808124e-02   +4.354346248830644e-01   +8.495108393373000e-01   +5.094090961023550e-02   +3.631556243777849e-01   +5.600888859823239e-01   +9.961358475488201e-01   +6.073873809046026e-01   +2.245894754368244e-01; +9.524561120031099e-03   +5.889280424477894e-01   +2.147893997072114e-02   +5.438208550246144e-01   +9.353566513255491e-01   +2.437266768096505e-02   +7.129101808944441e-01   +3.736204236157121e-01   +5.325623020806182e-01   +5.080491931333924e-01   +2.323437821740364e-01   +3.305697645546712e-01; +1.025434231292032e-01   +2.653173602897973e-02   +6.776443139188117e-01   +8.647717410923704e-01   +1.022600764624104e-01   +4.219111706182617e-01   +8.485475706975604e-01   +8.427100108397343e-01   +4.787714209281719e-01   +1.893829505220378e-01   +1.948890271229053e-01   +1.647416907326840e-01; +8.561451580623256e-01   +6.929752754585249e-01   +8.355916277752451e-01   +3.382327146891689e-01   +4.094769253150726e-01   +2.550947516087744e-01   +4.047877477786356e-01   +3.838187666661000e-01   +9.009893676003422e-01   +9.596765420571650e-01   +2.174370050469908e-03   +3.841173346753970e-01; +3.382292003254292e-01   +3.271933730077755e-01   +6.843358183795177e-01   +1.787744441394208e-01   +8.927203573245449e-01   +7.426057140760668e-02   +2.865262340018883e-01   +7.698619431064905e-01   +4.822226551067035e-01   +4.524438527533620e-01   +6.462323671459456e-01   +5.255273425903323e-01; +1.499925248802788e-01   +7.567484115810443e-02   +8.959789153471243e-01   +8.813944649870259e-01   +7.386614079542031e-01   +9.206114640752625e-01   +2.626787113596716e-01   +7.722097853899992e-01   +4.874672217185876e-01   +6.056018341523394e-01   +3.999848641024127e-01   +5.951292054808672e-01; +8.074973012877561e-01   +7.441290190648260e-01   +9.557084370106597e-02   +8.416133697898972e-01   +9.587046055819720e-01   +2.680401248719062e-01   +5.050314708846357e-01   +4.333856330662919e-01   +3.138480242896824e-01   +6.437351355296308e-01   +2.722088154091891e-01   +1.702575638078549e-01; +6.559437424599383e-01   +9.649260680733750e-01   +7.090065848232553e-02   +8.337213308002706e-01   +9.698987343577014e-01   +1.010163248290070e-01   +1.168474456378399e-01   +4.875413950962812e-01   +8.596099860137294e-01   +7.664784353501364e-01   +4.132606436251276e-03   +7.261354045865229e-02];
L3E_L3I_iGABA_netcon = [+4.373125908099438e-01   +7.092370802960174e-02   +5.163109901215903e-03   +4.952565443089971e-01   +5.435228167343172e-01   +2.519820552274911e-01   +7.178012849228353e-01   +7.613092188122547e-01   +3.784708349531450e-01   +4.487912408817837e-01   +2.000737332705798e-01   +6.493683165786337e-01; +5.794817143904051e-02   +8.080037358072595e-01   +1.327998445904112e-01   +1.937917104217122e-01   +2.116032225663965e-01   +3.341417738988218e-01   +2.222821055876896e-01   +8.885006353583482e-01   +6.110834337442548e-01   +3.945403841687885e-01   +8.280840853398899e-01   +8.985886075853916e-01; +6.251563270227593e-01   +9.097192031078549e-01   +3.087188186901153e-01   +6.421259793799969e-01   +2.696257199275855e-01   +5.918008408351721e-01   +4.988966254670449e-01   +7.312875743941704e-01   +1.678493236812997e-01   +6.682446082535084e-01   +4.468844333279014e-01   +8.386472958799759e-01; +7.986448772697317e-01   +4.259385579852437e-01   +2.383559192839355e-01   +2.554926128084367e-01   +1.325514986424728e-01   +4.815777139959469e-01   +4.754163371823997e-01   +6.978167526621813e-01   +1.052607110378328e-01   +3.321379271551757e-02   +4.249635234821479e-02   +1.704471897242524e-01; +4.011248940388727e-01   +1.840743694006330e-01   +6.492696241775451e-01   +9.484673801380187e-01   +1.633821606169238e-02   +8.972311363471746e-01   +4.312371956096820e-01   +6.465073214924111e-01   +6.257449882959973e-01   +7.872222450845013e-01   +7.688762609270895e-01   +1.609525334343437e-01; +8.845115897381149e-01   +1.834449282492599e-01   +8.081907085983854e-01   +2.879556554561309e-01   +1.562597062919258e-02   +2.947348418434091e-01   +5.570673314446628e-01   +6.205050313140379e-01   +9.526714519658350e-01   +3.786155569277886e-01   +9.803911447878297e-02   +1.357736277376510e-01; +7.221682171909588e-01   +6.721977308571889e-01   +7.398363552558087e-01   +1.492462227039936e-01   +9.790515823244580e-01   +7.926517660004570e-02   +2.070133404765789e-01   +7.821685488908282e-02   +6.652864778619898e-01   +6.513400184047549e-01   +6.523372778742447e-01   +1.588489799590715e-01; +1.967599228727816e-01   +5.241234036771381e-01   +1.224568660106228e-01   +8.703134122201737e-01   +6.472972582698732e-01   +3.921545470018862e-01   +2.772190729875172e-01   +5.480620389504477e-01   +4.731094939456565e-01   +4.969751451279280e-01   +2.706445153445677e-01   +3.942422708475051e-01; +3.744613754514329e-01   +7.763886970668589e-01   +1.727155279661063e-01   +8.867696761549088e-01   +8.157089756643766e-01   +1.984342894521898e-01   +8.122461604228618e-01   +8.839860650252803e-01   +3.405906310001433e-01   +2.130035243870292e-01   +4.369610701301337e-01   +6.667464753812148e-01; +2.116820032835158e-01   +2.991041970649430e-01   +2.737780003393497e-01   +6.684526991245680e-01   +2.756290720172750e-01   +7.224407390933270e-01   +9.570384232269009e-02   +9.877045374697936e-01   +5.914176076408181e-01   +2.166604947640474e-01   +8.488392941435600e-01   +2.226909337607184e-01; +2.594923809146806e-01   +4.742798370317955e-01   +8.148053497609246e-01   +9.971321192823100e-01   +1.543976463984232e-02   +4.214814266843426e-01   +3.298213940633784e-02   +7.088915076409397e-02   +5.456983315857585e-01   +4.520318344276001e-01   +9.023241998350857e-01   +6.436487675076032e-01; +9.918262995720570e-01   +7.064614257978730e-01   +5.914833595401274e-01   +2.678508714069029e-01   +1.013632116624313e-01   +2.680798940126132e-01   +6.502548012351145e-02   +3.277207102940263e-02   +3.957736525857017e-02   +6.290924489738022e-01   +2.848876027822175e-01   +6.117440331582695e-01];
L2E_Input1_iAMPA_netcon = [+9.920264884961630e-01   +9.897085184620650e-01   +9.998946651600403e-01   +9.876491558144722e-01   +9.853229815251577e-01   +9.993061596768782e-01   +9.833080265441539e-01   +9.968365625584436e-01];
L2I_Input2_iAMPA_netcon = [+9.920718299389143e-01   +9.985020445098262e-01   +9.854042863431854e-01   +9.943101730282964e-01   +9.891476562258724e-01   +9.902697410142925e-01   +9.953192123415286e-01   +9.968885829217708e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
