function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.758790665396070e-04   -2.524153025264725e-02   +1.183590032945807e-02   -4.653264867168307e-03   -1.947671469581872e-02   -5.706050722296689e-02   -2.613368992915646e-03   -6.677439264181739e-02   +9.241786141592479e-03   +1.033887187857233e-02   +1.534029029658198e-02   +2.303223288246760e-02   +3.279005726068765e-02   -7.197635789152701e-02   +1.509270167200365e-02   +5.657751507522754e-02; -6.956532573011426e-02   +2.381497954614983e-02   -1.634687621910010e-02   +2.602324290831670e-02   -4.556888249097034e-02   +4.572066319276175e-02   +2.918173090897361e-02   +3.722562780202553e-02   -6.767323826491106e-02   -5.114572692870976e-03   -4.802997444008936e-02   +1.049691340232789e-01   -3.336770895242493e-03   -1.145306528474274e-02   -5.290860046948540e-02   +6.810524816606214e-02; -9.719313216546004e-03   -3.587426786713984e-02   +3.546485470592969e-03   +9.780022924407375e-02   +4.095190363255221e-03   -5.181438338789620e-02   -1.233688535716571e-01   -9.548665448535246e-02   -1.142470629950141e-01   +3.138706576532825e-03   +3.809377778262538e-02   +8.060037157974183e-03   +7.975978626246882e-02   -6.856485815864624e-02   +6.343939574594266e-02   +1.090925204604317e-02; -2.242662245792991e-02   -3.737784505582717e-02   +3.225989404425039e-02   +4.120948784236498e-02   +1.575428813724829e-04   +8.226935005515766e-03   +2.689684912968177e-02   +2.280011960629430e-02   -1.142007186552810e-01   -9.411716118333462e-02   +4.489241497519118e-02   +6.146779898450404e-02   +6.813763023468300e-02   +6.903297513283660e-02   +2.652324799132843e-02   +2.026506414025035e-02; -5.081607191159390e-02   -7.584303065794609e-03   -4.683749315540393e-02   -3.083470685606464e-02   -1.138175414370883e-01   -1.033728228671045e-02   +2.879076835740962e-02   +7.087054832522263e-02   +5.177858974373280e-02   -6.830536078142746e-02   +4.800440146623881e-02   +6.781596320122536e-02   -7.129033084855544e-03   +4.521531059557719e-02   -2.222710009050128e-02   -1.620859942840557e-02; -1.085409970614891e-01   +6.754294095431300e-02   +8.048652412449105e-02   -4.821160807007793e-02   +8.752723440983805e-03   +5.195523472886494e-02   +2.540280834037981e-02   +5.004572917766704e-03   -1.278966178410052e-02   +2.154187359040494e-02   -2.240446666728139e-02   +2.189661496559242e-02   +5.825982808510945e-02   -3.086968429815059e-02   -7.986743243876503e-02   +2.816044651625004e-02; +1.857242122866550e-02   +9.047092523655319e-02   -4.406952421876958e-02   -1.012212254095662e-01   -8.595888523790543e-02   -4.235240033153224e-02   +1.344682708041658e-03   -3.489471466386377e-02   +4.247772762975432e-02   -3.695741827744328e-02   +8.420731710125303e-03   +4.182105149109206e-02   +7.121319742526848e-02   -6.700432302764872e-02   +7.424364670721827e-02   +9.238333355295419e-02; +1.443236134550423e-03   +7.230144208809024e-02   +1.323811902129453e-01   -1.056388190604437e-01   -6.511052366282519e-02   -7.434899475385984e-02   +8.503157359267938e-02   +9.919924827604246e-02   -5.005148360249353e-02   -3.919038109535335e-03   +9.622827811551607e-02   -5.605362388037702e-02   +2.306807425003292e-02   +1.951670571271357e-02   +6.129126737053771e-02   -4.926409068424058e-03; -1.642814317937125e-02   -3.685103968573564e-02   +8.026524883118491e-02   +2.406608363594610e-02   -3.278204662727769e-02   +6.515939130576186e-02   +7.158367225176300e-02   -5.392253281562201e-02   -8.901152316279229e-02   +2.903930601868567e-02   +3.598613998585178e-02   -3.748582508706431e-02   +1.022011571261522e-01   +1.159973594130842e-01   -2.902786586438431e-02   -2.691228078724356e-02; +1.959016853650471e-02   -4.279409839653874e-02   -3.986307639927498e-02   +9.938803062078723e-02   +1.363150892757658e-01   -7.140853314872677e-03   +6.451124190909055e-03   -1.961033928791196e-02   +4.904387636383272e-02   +1.558668750606444e-02   -2.767458794326950e-02   +9.366157578126319e-03   +4.115493612829783e-02   +8.434273775258974e-02   -5.135915497394724e-02   -1.221020687984186e-01; +3.917727364034564e-02   -1.667927215471646e-02   -5.481967902479315e-02   -2.254984778165414e-02   -1.383301485849494e-02   +1.099381311543139e-01   -4.075738256689787e-02   -3.160530888862866e-02   +6.985028818174968e-02   -3.765291460854586e-02   +2.206196198895835e-02   -3.663513422292573e-02   -9.525317557651920e-02   -2.541614644852721e-02   -7.769310072404152e-02   +1.052781288104220e-02; +1.479813466877211e-02   -8.564579823582555e-02   +4.730719050755356e-03   +8.724406028674501e-03   -6.120621354516950e-02   -3.314264622051342e-02   +1.424617327446894e-02   +4.682791328498154e-02   -8.067156801426349e-02   +6.670876121681664e-02   +1.624307851139085e-03   +2.122790076975675e-02   -1.574634695761329e-02   +1.067116760226623e-02   +4.775090659677685e-02   +2.178199078571418e-02; +3.513876340840011e-03   -4.454433099526971e-02   +2.281063407672874e-03   -1.685624259785698e-02   +2.814866023219646e-02   -6.224218298157447e-02   +3.199967326199944e-02   -7.479562472163993e-02   +2.959102089830392e-02   -6.952118739670875e-02   -1.867513576763342e-02   +8.491502470585163e-02   +1.030798705855308e-02   +7.473264763956650e-02   -2.481544222476960e-03   -3.002734613052003e-03; +3.630877672698300e-02   -3.536165635445101e-02   -3.807484247759927e-02   -1.624224028448430e-02   +4.832831813308411e-02   -1.185777354067360e-01   +4.524972250223471e-02   +4.708490990219277e-02   +3.321118468047726e-02   +1.342039525678804e-02   -6.926841559143458e-02   -3.638095390079217e-02   -4.535651896092477e-02   -7.110186522857553e-02   +8.194465649012708e-02   +2.092005520593334e-03; -4.390945866441562e-02   +2.498899060400406e-03   +3.931544465416596e-03   +1.895825772139754e-02   +3.527795334986549e-02   -8.050922100453274e-02   +4.795416141359390e-02   +5.758368663111005e-02   -4.864837580137551e-02   +6.347251887590735e-02   +3.448800526134806e-02   +1.387166706383552e-02   +6.189619769563706e-03   -6.860992192708334e-02   -9.505307135560587e-02   -1.596038203147881e-01; -4.097254754383866e-02   +1.076767399344186e-02   +3.913897704859282e-02   -1.513035109546813e-02   -8.019620397924472e-02   -2.203831188157597e-02   -5.083801472915719e-02   -1.186675344643082e-01   -1.176824354386583e-02   -2.192914194648354e-02   -6.748156261277531e-02   +2.241103399484776e-02   -1.069441313930352e-03   -3.541420289503716e-02   -3.134757469434673e-02   +9.049322636279233e-02];
L1E_L1I_iGABA_netcon = [-3.303537289482212e-02   +5.391537061334055e-02   -5.602412624090505e-02   +1.018580507910606e-01   -4.488327615982500e-03   -6.119612800072884e-02   -6.520120794841358e-02   -2.160899957566122e-02   +5.967199644780625e-02   -1.016380867474182e-02   -2.324824370778920e-02   -8.624947732622283e-02   +2.891334253202165e-02   -3.458389725617982e-02   -4.998182068171094e-02   -1.024908921370168e-01; +2.941169118079175e-02   -4.510490092764163e-02   -1.788133325259848e-02   +2.141994339948635e-02   +1.501880116030229e-01   -7.357533180305340e-02   -9.973921014513869e-02   -4.516991415536092e-02   +6.116654956127997e-02   -6.228640731356150e-02   -2.479795392073654e-02   +6.104657726176441e-02   +1.953740884774032e-02   +3.181422913913019e-02   -4.637643057777862e-02   -3.652420511439589e-02; +7.376804488462477e-03   +8.587684707173604e-02   -1.632133408460763e-02   +4.073204209547241e-02   -8.462625532864484e-02   +3.214804862938602e-02   -4.433818399558767e-02   +4.652751051251302e-02   -9.514548910191353e-02   -6.984965583830503e-02   +1.003817239127924e-01   -1.020923455354981e-01   +2.105666426661962e-02   -2.941028501086847e-03   +5.300776283992145e-02   +2.917226843373954e-02; +2.503067145741132e-02   -3.798993671145244e-02   -2.201597009720152e-02   -4.024041838372896e-02   +1.640157251529617e-02   -1.539292494620577e-02   -3.260272902807452e-02   +4.158602094003530e-02   -4.922640124901016e-02   +1.388530497763062e-02   +1.104702903783091e-01   +1.625734469957880e-03   -7.175436455936697e-02   -1.515246070260536e-02   +5.990874814428560e-03   -5.824651261545005e-02; -1.296751365861822e-01   +8.238360234778782e-03   -3.839842819042476e-02   -2.655091131963463e-02   +3.192355425723083e-02   +3.028568628891302e-03   +6.425181650442083e-02   +1.154207588221135e-01   +1.286692169309757e-01   +2.670592516918921e-02   -5.529031849368074e-02   -2.119936759059082e-02   +8.306814478134367e-02   +4.062979730378350e-02   -5.208113078004440e-02   +2.845403419242169e-02; +8.127041450204400e-02   +2.215868234879283e-02   +3.391351758259941e-02   +6.344758888894424e-02   -7.860287033682925e-03   -2.129995758194701e-03   +5.681723975581005e-02   -2.242368660087386e-02   -1.196537577938530e-02   -1.070001378981116e-01   +1.474890168387620e-02   +1.365433725959270e-03   +1.843896261070873e-02   +3.279431842618122e-02   +6.023506547797454e-02   -2.228934070828284e-02; -1.027515462528026e-02   -4.669690308052073e-02   -1.143940747336241e-01   +4.752921958125468e-02   -1.091586718073017e-01   +1.609199747931878e-01   +2.642657900403191e-02   +9.125126648308662e-02   -4.239684275329793e-02   +6.195612673441232e-02   +2.153233009336567e-02   -1.157514348397868e-02   +1.539162192787675e-02   -7.448472554331187e-02   -5.826800707166700e-02   +5.796665091456263e-02; +6.205687279722275e-03   -8.107047855401371e-02   -3.559301677916426e-02   -2.712700283979299e-02   -4.146921488266549e-02   -1.034173976241246e-01   +3.188013217640630e-02   +9.572028224302541e-02   -2.342457425797868e-02   +5.793952558967298e-03   -1.068657014787010e-02   +3.203103232455259e-02   +1.899866342519752e-04   +1.915269580938400e-02   +5.600529627540822e-02   +1.113786677016628e-01; -3.297170160998858e-02   -2.612332067640352e-02   +8.793618002793877e-02   +8.010639066373297e-02   +7.772784145609073e-02   -3.418356989057483e-02   +3.979625415754789e-02   -6.046145483791549e-03   -5.814489981969759e-02   -9.629874669149245e-02   -2.486154815458240e-02   +1.512843871080036e-02   +1.398335729823000e-02   +1.016132122810720e-01   +3.056781707427309e-02   +3.851324457740109e-02; -4.896483315771766e-02   -6.026950098000324e-02   -4.913737771038666e-02   +1.458060659310310e-01   -3.779626955090809e-02   +1.223822261275030e-01   -4.381186940706269e-02   +2.527930344670122e-02   -7.506897559782928e-02   -1.834765923140935e-02   -6.532023167295385e-02   -7.351550629727060e-03   +9.147456160533285e-03   +6.749128502597568e-02   +7.750043904774470e-03   -7.414202875255406e-02; -1.041215598932937e-01   -1.296154131493504e-01   -3.821982144055371e-02   -1.028579812439434e-01   -3.384111565024674e-02   -9.495635588628368e-02   -2.073562907763265e-02   -7.167687576562791e-02   +6.194166087171531e-02   -6.941220809961852e-02   -2.422717948657824e-02   -4.834024601427118e-02   -9.078511760949284e-03   +5.570603715403881e-02   -5.440069538950847e-02   -1.575313861777138e-02; -2.605871753447687e-02   +9.439067437682762e-02   -2.046774851005990e-02   -5.697319229221867e-02   +1.019493692683244e-02   -1.398957616121446e-02   -4.980528575000642e-02   -3.434099084095000e-02   +1.038904800031130e-01   +2.922232738617154e-02   -8.960164664252471e-02   -5.597037700477667e-02   +4.503958668627478e-02   -4.488559925725653e-02   -1.948944015393861e-02   +3.942978332918819e-02; +1.213168316831613e-02   -2.157149033989395e-02   -2.203389996028245e-03   +2.150978437016124e-02   +5.318843206121095e-02   +9.945249068471740e-02   -6.417157985542771e-02   +8.651731985751471e-03   -6.020631628046424e-02   -4.685417865012329e-03   +7.530607307191526e-03   -1.452873177650266e-03   -1.070795531622725e-01   -4.010672314047544e-02   -1.127990107018758e-01   +1.437888565898942e-02; +5.374356483755599e-02   -8.250841938449809e-02   +2.642960311151123e-02   +2.728891558502732e-02   -7.588343126677861e-02   -1.519889723983327e-02   +2.738351903489423e-03   -7.481726060389869e-02   +6.106166262421761e-02   +2.534996581490539e-02   -7.224872544674023e-02   +4.102287605859804e-02   -1.952352022508970e-03   -4.328208810376577e-02   -2.035154091614855e-02   +8.071787249845756e-02; -6.759503561821457e-02   -1.074216413866522e-01   -1.717661332680648e-02   +4.464808439779345e-02   +1.760977500526674e-03   +3.358972046302395e-02   +1.059370944245530e-01   -3.791735809387865e-02   +7.854584433846643e-02   +5.008959437794577e-02   +7.670873396503616e-03   -1.043187994613299e-02   +5.759225291655677e-02   -1.020627581219159e-01   -2.066864302891142e-02   -1.108786402398151e-01; +2.597870917002498e-02   +1.238008449208516e-01   +8.867048541078931e-02   -7.881665291804525e-02   +5.836857274565509e-02   -1.031342419106450e-01   -2.948083782416063e-02   -3.980930165170316e-02   -7.789473719284348e-02   -1.248536831312008e-02   -3.715595564776576e-02   -8.359720563145981e-02   -2.472203853875545e-02   -2.096022622793555e-02   -6.926058793965618e-02   -2.561686909642481e-02];
L2I_L1I_iGABA_netcon = [-2.380295914558566e-02   -3.598474098613461e-02   -4.011478528570640e-02   -1.093659225941530e-01   -8.565233510800521e-02   -1.270875715783883e-02   +7.446414651070282e-02   -5.640925970113535e-02; -6.903154728918598e-02   -2.200966758807314e-02   -8.014422317159920e-03   -1.347379604802849e-02   -2.143603610156498e-02   +1.098299466428913e-02   +2.635956177568387e-02   +2.680601869449809e-02; -6.512353179065379e-02   +2.108935638219457e-02   -9.565321341275158e-02   +4.231382067471125e-03   +1.450561219972688e-01   -6.235597626178732e-02   -2.345305034515058e-02   -1.074644832680733e-01; -6.250622054652788e-02   +3.671770632784475e-02   -1.648080117572833e-01   -5.689868305704625e-03   -4.622501950869799e-02   +7.767260500036695e-03   -4.008903219004433e-02   -2.915892292752370e-02; -6.360763140914219e-02   -2.999414458289359e-02   -6.684451237194844e-02   +5.067442580253063e-02   +7.356699981361042e-02   +3.001199813291518e-02   -4.485350686494760e-02   +5.524169117908249e-02; +6.083030385265680e-02   +5.446038068150238e-02   +5.058179336813196e-02   -1.574381279516363e-02   +1.044975666839452e-01   +1.375183309674684e-02   -9.840576019178277e-02   -9.612395004621101e-04; -3.590759902917218e-02   +8.697087142726327e-02   -6.583236756264828e-02   +4.490456607131935e-02   +1.154292449390260e-02   +3.537147057163119e-02   +2.988017264109961e-02   +5.101407512426719e-02; +2.075749510471684e-03   -2.074186868534739e-02   -6.711498305287242e-02   +6.414745337066444e-02   +5.796743800292398e-02   +4.969344997380671e-02   -3.629021228069303e-02   +5.208315399475393e-02; -5.453347367733794e-02   -6.560090454803058e-02   +8.095611796581192e-02   +4.690805332080029e-02   -6.625868623946242e-02   +5.131093040290301e-02   +6.282051668859558e-02   +7.697969891671161e-02; +3.379362111585447e-02   -5.419413951196808e-02   +3.792433483203834e-02   -1.440369366062680e-02   -9.265267799689597e-02   +1.025883239653001e-01   +2.580350785068209e-02   -7.696770867429423e-02; -7.815040028676097e-02   +1.053128961140326e-01   +3.230260910451463e-02   +8.206359253202740e-02   -7.176687295272324e-02   -1.016752443747329e-01   +4.261671855787981e-02   +7.782221286180796e-02; +4.802725199383390e-02   +2.673230755617249e-02   -3.848597727174487e-02   +2.004083500357779e-02   -2.858284131255898e-02   +3.632709596181505e-02   -1.343130155303362e-02   +8.475706054796926e-02; -2.141205279071638e-03   +3.258171424697186e-02   -3.061129664072448e-02   +1.768605600485381e-02   +3.773769717337205e-03   +1.119974492012447e-01   +2.037533147525395e-02   -2.089269511505430e-02; +8.653268815430161e-02   -2.192324225685570e-02   +4.941042063702854e-02   +1.089278908959067e-01   -8.518419803551838e-02   +4.432737563660608e-02   -5.989841809510262e-02   -8.733744601358024e-04; -3.785759819251498e-02   -8.230962161867149e-02   +3.391748428947865e-02   -4.397778868252659e-02   -6.364583419272231e-03   +5.712350128016382e-02   -5.678881715843558e-02   -4.022426056804247e-02; -1.298824254472492e-01   -4.141856827510889e-03   -8.686322257747313e-02   -3.582216428708135e-02   -1.235353532641321e-02   +2.157763184038042e-02   -1.041957195753016e-02   -1.578037367949019e-02];
L1I_L2I_iGABA_netcon = [-6.878571005968562e-03   -4.041113617038022e-02   +4.952193174211608e-02   -9.685011310804412e-03   -6.209691193088947e-02   +3.216087126531403e-02   +3.752976914117672e-02   +9.812902976691741e-02   +5.653965009331599e-02   -4.245377377347115e-02   +4.686165445457620e-03   +1.404123810053147e-02   -2.509946334828406e-02   +7.008109742496879e-02   -3.637229992016653e-02   -1.026650829566293e-02; -1.451457846236601e-01   +8.434696062313524e-02   +3.472726044853912e-03   +7.437643006411997e-03   -4.050468602320422e-02   -6.129817468333955e-02   -6.201373566240814e-02   +8.710685657126950e-02   -2.205342533519723e-02   +2.269491629912913e-02   -6.321188047649048e-02   -1.086274695798953e-01   +3.788746740188063e-02   -2.973440092352093e-02   -5.860168160005456e-02   +2.952868312604678e-02; +2.609911542008502e-02   +2.362155400742360e-02   -4.928610029248836e-02   -9.709724446543197e-02   +1.465385193220030e-02   +4.428709214360616e-02   -1.270002358664045e-02   +8.332604689426574e-03   +1.915371103172133e-02   -7.483931953756684e-02   -3.432974245342002e-02   +8.076940711008863e-02   -4.288976585731148e-02   +5.999863783283747e-02   -4.605291862010368e-02   -1.814560602886605e-02; -6.841003166593851e-02   -8.715351036049068e-02   -1.985412523888501e-02   +4.751655541857848e-03   -1.763730628690424e-02   +7.162563251696286e-02   -7.934116952965826e-02   -2.621009413027239e-02   -3.359950436349400e-02   -7.341580377920492e-02   -6.594842949017421e-02   +3.629417992445153e-02   -5.274978133735458e-02   -2.779734229797231e-02   +4.086054295081237e-03   -1.121537543926509e-01; +8.959690681824174e-02   -4.880662655176885e-02   +1.604006550021014e-02   -2.845205669149256e-02   +4.844240598682660e-02   +7.948049975463765e-02   +6.046058779616876e-03   -5.252916737170848e-02   -3.063378846023801e-02   +1.877794615741445e-02   +2.005644912521738e-02   -8.139749081072452e-02   +3.454793187807112e-02   +6.080792775914778e-02   +2.896067451792698e-02   -2.105235800377996e-02; -1.364387637062741e-01   -1.320300433112759e-02   +3.646552951405133e-02   +7.789715440915518e-02   -3.933979862247854e-02   +5.521003134855364e-02   -2.684755200670508e-02   +6.352721429281347e-02   -3.417952502489192e-02   +6.393425064995503e-02   +2.054360078935182e-02   -1.772581385630660e-02   +1.386173620747615e-02   +1.556535624342646e-02   -6.139314448310010e-02   -1.564810166758474e-01; -1.743909728070145e-02   +3.023350522754640e-03   +2.061222655771330e-02   -7.532308725999849e-02   +1.493512231077229e-01   +1.322861667770160e-01   +3.525687143739198e-02   +1.110170002936911e-01   -3.839381899248381e-02   -1.065654440539667e-01   +4.783534646588690e-04   +6.347933678913079e-02   +5.833934760799350e-02   +3.434891626016937e-02   +3.195548571269272e-02   +8.202858904146945e-03; +1.032921193719968e-01   -9.443551340415479e-02   -7.710987442781063e-03   -1.760244526112152e-03   -1.618861162039060e-02   -6.177492406221189e-02   +3.580882135428916e-02   -1.905733312457202e-02   +3.246682259648234e-02   +5.037468724200058e-02   -3.188967528109372e-02   +2.371370408216976e-02   -2.913642148087269e-02   -2.383734423504548e-03   +4.047159456904426e-03   -6.288045894332661e-02];
L2E_L1E_iAMPA_netcon = [-8.506864599142848e-02   +4.507509412533725e-02   -5.891190601889312e-02   +3.400995409182446e-02   +1.175440621482584e-02   -1.210762289975098e-01   +5.283346481426993e-02   +3.408601479900673e-02; -3.601206769498046e-02   -7.855451652665640e-03   -5.247179348377680e-02   -1.069709006394718e-02   -3.382239189890587e-02   -9.146194838561149e-02   +4.850639468827274e-02   -4.286856949952064e-03; +4.250809879629962e-02   -8.878179302921328e-02   -9.110759211237836e-02   -9.879577622978828e-04   -3.320513006309696e-02   -6.105988295123251e-02   +8.155876921831544e-02   +7.102925680800967e-02; +6.428075338212670e-02   +9.702994939003352e-02   +1.451015041482083e-03   +1.557691943820703e-02   -3.152528024689649e-02   +1.013687909473946e-01   +3.442119891707007e-02   -1.654171287514251e-02; +7.002029371187410e-02   +2.774182833402993e-02   +2.398756873106482e-02   -5.081465567221050e-02   -6.648678172189211e-02   -5.228939737367045e-02   +3.993366654965960e-02   -3.865614723916732e-02; +8.387822503913282e-02   -8.089645985012327e-02   +8.532187267637437e-03   -4.032139051861545e-02   -5.274723854779750e-02   -5.326171398430000e-02   +7.038765544698114e-03   +1.056811495928181e-01; +2.675683323785671e-02   -3.582339107076116e-02   -7.958002093398973e-02   -5.340072809408807e-02   +5.016580990231535e-02   -3.593458865980316e-02   +1.666868522085217e-03   +1.051158114529134e-01; +1.035952714566273e-01   +1.659917772766361e-02   +6.953156302824391e-03   +6.435329454493134e-02   +2.854374447171595e-02   -2.754042056929980e-02   +9.764461644226570e-02   +2.264167485224928e-02; +3.360331377897657e-02   -1.184464605640544e-01   -3.754976915027067e-02   -8.098637822203809e-03   +4.111699526858455e-02   +2.771532667672958e-02   +7.408761550842488e-02   -9.280701567463859e-02; +8.530479220814549e-02   -1.016270615771633e-01   -2.650378010058805e-02   -2.563856324552200e-02   +2.985713102494848e-02   +3.571127154509558e-02   -2.018126588394920e-02   -3.161190180487344e-02; +2.334852675170076e-02   -1.671400565584319e-02   -2.135564821050482e-02   -4.941560592019662e-02   +7.521232869755411e-02   -4.083058861866157e-02   -8.641554217111231e-03   +2.996126331381378e-02; +2.779381876589569e-02   -5.917934801159330e-02   -1.415336260113619e-02   -4.592384978615426e-02   -7.605962579202390e-02   -6.979430782870815e-03   -1.845157524795251e-02   -5.408998618670452e-02; +2.835920444765939e-02   +2.243521506134008e-02   +4.075263212427394e-02   -8.247726473551509e-02   -4.860247476884785e-02   +2.433801291984942e-02   -3.312668467233615e-03   +7.508463741651020e-02; -8.079851507769850e-02   +3.155513303753988e-02   -1.549211271879397e-02   -5.321962593532189e-02   +2.126221474862503e-02   -3.640738641945628e-02   -2.603972790354357e-03   -7.591868604678113e-02; -3.573598511561249e-02   +6.815937328793281e-02   +4.726556481815537e-02   -3.180562753573410e-03   +3.318049704446337e-02   -4.912900543080349e-02   -1.211865865284978e-02   -8.847513712398227e-03; -5.433218988705581e-02   +1.659279451226839e-02   -2.632792891669922e-02   +1.335354821784860e-02   +2.338276017546045e-02   +8.840813206047839e-02   +5.879643057988975e-03   -5.411429146830230e-02];
L1E_L2E_iAMPA_netcon = [-2.361562649298482e-02   +6.294008998197488e-02   -6.277810797869754e-02   -1.712439313731562e-02   +1.391734081082515e-02   +7.399083563126697e-02   -1.788915989564144e-03   +3.214292453018144e-03   -6.567405200889966e-02   +3.798898654810536e-02   +1.184575429926687e-01   -5.069674999310180e-02   -6.637719933727658e-03   -4.933786769592042e-02   +5.146125717115209e-02   -6.226982276267540e-02; -4.484425028373576e-02   -1.639943450301736e-02   -4.746679941096838e-02   +9.359856372474251e-02   +8.088148105154175e-02   +5.591810207254983e-03   -8.847141154775891e-03   +1.793263051623976e-02   +3.150012101865995e-02   -3.586367064818131e-02   +6.207903350591663e-03   +3.958174852769883e-02   -1.437019286629243e-02   -3.174162960666127e-02   -6.403937085843779e-02   -4.479522232124937e-02; -6.456286691585891e-02   +4.395794997181534e-02   +1.047788948061479e-01   +2.884040473293394e-02   +2.356996079600417e-02   -1.594923172025009e-03   +1.096810666368940e-03   -2.725093734870553e-02   -1.014161494291447e-01   -4.743638205741769e-02   +2.468547479978487e-02   -5.064379351239708e-02   -2.198014544250510e-02   +1.346830885375206e-01   +4.795655267878029e-02   -8.554964350192563e-02; +6.602261258817051e-02   -3.843736156591401e-02   -4.638735850746647e-02   +2.982329432796946e-02   -8.700639973105394e-03   -2.460177820961203e-02   -4.533767144726404e-02   -7.811382255011239e-02   -1.678412635490577e-04   -2.734984690889901e-02   +7.187477547156643e-03   +1.880972393966880e-02   -1.523238325874865e-02   -2.047967962509405e-02   -2.744895535790637e-02   +5.596377622242083e-02; +1.643216961083707e-01   -7.267191377132048e-02   +4.094748443990386e-02   -3.799386073955061e-02   +3.172095974653408e-03   +4.272313494377313e-02   -7.837254512057398e-02   -6.279052829024689e-03   +2.084511691032676e-02   -4.620300940034335e-02   +4.659808864622902e-02   -1.840871218409161e-02   -3.554673755033512e-02   +3.227932941628156e-02   +2.493619288284114e-02   -3.201289536064825e-02; +3.194002892801825e-02   -6.216254720088571e-02   +3.701217433031394e-02   +6.124254767611588e-02   -1.588069981935979e-02   +1.122926778494632e-01   +4.724434823343831e-02   -3.515122334218279e-02   -1.210472009998971e-01   -6.341202022293324e-03   -7.970996866931068e-02   +1.035907615785084e-01   +7.720361446119832e-02   +4.490631604602841e-02   +9.679752704168101e-02   +6.388872106158174e-03; -1.384235210126721e-02   +2.310842155110561e-02   +3.327882151607425e-02   -6.351595083387991e-02   -8.756286748035440e-02   +2.220771812971715e-02   -5.475118682651572e-02   -8.294546758154010e-03   -2.244630625371460e-02   -2.012895068906711e-02   +4.941037607929826e-02   -4.079922053483341e-02   +1.316031899272974e-02   +6.499334445290689e-02   -4.472101162503041e-02   -3.965560181530570e-02; -8.599948203020996e-02   -3.959750982757450e-02   +2.179063953366014e-02   -1.341078718079307e-02   +2.082429068133107e-02   -2.016984801763654e-02   +2.283677026721017e-02   -2.260920839643118e-02   -2.074643860185119e-02   +3.058606579600168e-02   +8.902142789970043e-02   +5.978201816451330e-02   +3.442866972131071e-02   -6.266503293848961e-02   -2.092026026081397e-02   +8.538349988183438e-02];
L2I_L2E_iAMPA_netcon = [+1.196270264073080e-01   -8.364280401290083e-02   -1.880796812262233e-02   -3.722106269892923e-02   +3.724403138782126e-02   -4.284659499306499e-03   +3.860949346899972e-02   -9.690843584854336e-02; -3.803886003912936e-03   -5.832188011383495e-02   -6.409397591220727e-02   +1.085436044717133e-01   -2.793005680533858e-02   -2.246878418555842e-02   -9.446652751882426e-03   +1.157405822754958e-02; -5.973346932569903e-02   +5.673557842985224e-02   -6.899842761803310e-02   +2.920244911246173e-02   -7.178808441459351e-02   +2.698998223965082e-02   +2.571543261809779e-02   -4.408142910937250e-02; +5.375826198772039e-02   -2.227071825740394e-02   -2.652803057343916e-02   +7.164548406913376e-02   -1.184874278786619e-01   +6.421868015205048e-02   -3.768987479588800e-02   -3.117368939402679e-02; -6.135415167648985e-02   +6.813985146377359e-02   +6.376148667902985e-02   -3.547529323827400e-02   +4.015255803833412e-02   +8.515369213246403e-02   +9.318902834483417e-02   +1.016483162395116e-01; +2.219262926847628e-02   -6.497176256913742e-02   -3.126969951478747e-02   +9.700615742181852e-02   +5.453490520672677e-02   -4.469681133714090e-02   -1.388806684203256e-01   -4.520632107337116e-02; -7.902403755685888e-02   +1.371911605642692e-02   +1.882635551565040e-02   -5.961852892699352e-04   -6.571500741479851e-02   +7.227969857527108e-02   -3.552418061903419e-02   -1.415221153153801e-02; -5.271762360787634e-02   -3.112927618592801e-02   +1.823557382057905e-02   -1.587404061413505e-02   +5.474648951201641e-02   -5.348180622123385e-02   -4.736665507230517e-02   -9.748995689264294e-04];
L2E_L2I_iGABA_netcon = [-1.413165493221907e-02   -5.059568218214427e-02   +7.896427733518415e-04   +7.341684442246511e-02   -1.682922649119098e-02   -5.027976618777855e-02   +2.334879857372760e-02   +3.568817219351439e-03; +3.422727144223840e-02   -1.060272428401970e-01   +8.251543451274392e-02   +1.406668109745544e-02   +7.904135782831648e-02   -1.860122101507760e-02   -1.281579276495649e-03   +1.170406170780779e-01; -1.067862289176360e-01   +1.372102903351786e-01   -2.398624263103414e-02   +5.743653892468034e-02   +6.373818646952642e-02   -1.980450268603267e-02   +5.920252260004438e-02   -6.245004699521498e-02; +6.031530953652950e-02   +1.013291463605577e-02   +6.394901906248743e-02   -4.929165773162088e-02   +4.566332365101259e-02   -4.746398127879198e-02   +1.864099088664042e-04   -2.433319997069622e-02; -5.724453949090468e-02   -1.778898230806144e-02   -2.902042626194394e-02   +5.689339931476890e-03   -5.419053014801774e-02   -1.647501158940237e-02   -3.297256501044253e-03   +7.227812165057565e-04; +3.015359545465173e-02   -4.620839823124002e-02   +5.365781168960890e-02   +6.489648747443266e-02   -2.713596228090796e-02   +2.262692438112421e-02   +6.970624431127809e-04   -2.040486416459162e-04; +8.417953524523068e-03   +2.681412624998065e-02   +3.442428163964981e-02   +1.260529418476546e-01   -3.013219850729835e-02   +6.602283414778602e-02   +8.730322059944212e-02   +4.142915499903013e-02; -6.602781255395979e-02   +1.257670978254967e-01   +3.726880840138978e-02   +1.624446802133584e-03   -4.425092299263245e-02   -2.233086990050382e-02   -2.792156995294243e-02   -4.474818188908487e-02];
L3E_L2E_iAMPA_netcon = [-5.060553057671322e-02   +1.713371405345952e-02   +4.379822508389070e-02   -1.868817229833198e-03   +7.022256063568309e-02   -1.111173581846895e-02   -3.333104912309204e-02   -4.097735106024698e-02   -6.447698626396180e-02   -5.565539367514964e-02   +4.338511045336215e-02   +7.339958534924558e-02; -1.928165267523969e-02   -9.299917821141580e-04   +7.304553451599162e-02   -1.739521784850657e-02   +9.075274417126260e-02   -7.440624881649055e-02   -1.042143199952457e-02   -5.608471357590661e-03   +7.307252837184303e-02   -2.662283896444443e-02   -1.246903057544696e-02   -8.627414328994858e-02; +7.574917464751255e-02   -9.561222198714098e-03   -8.559694920601917e-02   +1.054544144270924e-02   +8.638359790808024e-02   +4.629728001558415e-02   -3.357293848025708e-02   -4.133066575326995e-02   -5.986770877238590e-02   -4.392277640429446e-02   -7.648370267242818e-02   -1.675153596673724e-02; -1.510767480212903e-02   -2.684699992261290e-02   +4.252035530893952e-02   +3.189464807521220e-03   +2.353440525479220e-02   +5.418907730898590e-02   +3.389056854369844e-02   +8.155576494384414e-02   +5.969416145857584e-03   +6.666973295729713e-02   -3.784383000697776e-02   +3.615311959854432e-02; +9.187855040313160e-02   +5.654265333911074e-02   -5.758847095738619e-02   +9.609564154151092e-03   +1.539880315389779e-02   -2.348036732083230e-02   -1.787653513130521e-02   -4.904543062971248e-02   +1.173721705733456e-02   +6.821081055464238e-02   +2.112794713386702e-02   +4.743607087167925e-02; -9.492896261862147e-02   +3.359099225175348e-02   -1.526716780440227e-02   +6.323967815073386e-02   +2.631198338805100e-02   +8.307751320755621e-02   +3.019569333002256e-02   -5.026870613585411e-03   +4.041153145303124e-02   -1.641374065916522e-03   +1.020605116612787e-01   -5.892009977443873e-02; -1.904428137996117e-02   -3.354699743500873e-02   -1.052571558727481e-02   -6.690730722706845e-02   +5.376104166452515e-02   -7.748286721620118e-02   +1.532370348646755e-02   -1.672482020512334e-04   -4.480144347829638e-02   +6.240139835797148e-02   +1.440047122886391e-02   +7.676860068080328e-02; -5.075153551804697e-02   -9.315519474946135e-02   -2.077574618304622e-02   +5.017264123528833e-02   +2.557068676174958e-02   -2.975638097609525e-02   +4.544745074157063e-02   +6.793764977604910e-02   +1.213653711778803e-02   +2.516637509842558e-02   +3.314679234763210e-02   -9.555474294235300e-02];
L3I_L2I_iGABA_netcon = [+2.446253866727460e-02   -7.974112787025731e-02   +3.367820629824934e-02   +8.498759483390357e-03   -3.192237550879402e-02   +1.950781483756014e-02   +3.350975782078315e-02   +4.010534236116073e-02   +3.837306657493076e-02   -8.196561223865888e-02   +3.123286844328097e-02   -5.255130580448131e-02; +8.758841806659684e-02   +4.394897433814669e-02   +3.852461899205484e-02   -2.309289184753412e-02   +5.585122167421712e-03   +1.851533609331998e-02   +6.199568621310555e-02   +5.158288859813023e-02   +4.721425443316427e-02   +2.535202417723470e-02   +3.927631755250612e-02   +3.554280530667468e-02; -9.194788202491833e-02   -9.042933464805365e-02   +2.820836680141209e-02   +8.782805238035084e-02   +5.547317502121470e-02   +3.811833840796330e-02   +2.104229228681514e-02   -6.758021096817143e-02   +8.095839159795762e-02   -1.726625204977218e-02   +8.830793578867280e-02   +1.580756237433714e-02; +3.437562820608616e-03   +9.336283989647082e-02   +6.929845542987039e-03   -1.335408981650264e-02   +6.302210198627875e-02   -5.168461883091444e-02   +7.213442256663692e-02   +2.979181783329445e-02   +4.582544416498581e-02   -1.762730068154229e-02   +5.572076640634198e-02   -2.520070463949143e-02; +6.389821599973429e-02   -8.019670426213312e-03   +3.693723456189192e-02   -2.445853908503596e-03   -2.120334529939201e-02   +7.866201822107520e-02   +7.484886193771405e-03   +2.452639565303521e-02   -8.122024930781094e-02   +5.653181972666754e-02   -5.927370279791696e-03   +3.412894880183481e-02; +2.329759739650389e-02   -6.487765798403741e-02   -1.031593646362056e-01   -2.357548203347287e-02   -5.901689722550502e-02   -5.833166297751759e-02   -1.986750875485961e-02   +6.659133512216685e-02   -1.001976094331175e-01   -3.366830074338331e-02   +2.589745311406512e-02   +7.300530980917343e-02; +1.714918601598102e-03   +2.377307466699091e-02   -1.764484611839201e-02   -2.801643568842545e-02   -8.069896676393828e-02   -2.277915672491743e-02   -4.449932908695130e-02   -4.659940991005509e-02   -4.738548056985918e-02   -1.144899575317166e-01   -4.056479954973496e-02   +5.187117850140982e-02; -3.262422276724339e-02   +2.661643418709427e-02   -2.718147759220231e-02   -3.648531496111388e-02   -2.042957374165610e-02   +3.859456090360112e-02   +2.639710663862951e-02   +5.381126471262836e-02   -7.459887245336391e-02   -7.825563107304651e-02   +7.248326981838675e-02   -3.472389071754092e-02];
L2E_L3E_iAMPA_netcon = [+7.165964634754726e-02   -1.164031259591421e-02   -6.585243868099144e-02   -1.873987031000961e-02   +4.676601360393241e-02   -4.957124698134976e-02   -1.072600693378895e-01   -5.093010162594147e-03; +9.420974657814463e-02   -2.311190765099711e-02   -1.857619529667634e-02   -9.860452779476855e-02   -4.774183641495273e-02   -1.052208406579260e-02   -1.861243069101833e-02   +1.330208023816342e-01; -7.027846665467639e-02   +8.646316705398180e-02   +6.280421802436189e-03   -2.549295716307888e-02   +5.795729795431184e-02   -5.266269809557220e-02   +5.761774671018025e-02   +3.134876024735411e-02; +1.206890065049057e-01   +8.067241016382579e-02   -1.080982112373147e-02   +3.205704445136982e-03   +7.561389217171016e-03   -4.010123943970872e-02   -2.748880880335503e-03   +1.817154766776450e-02; -5.306013796232758e-02   +5.913378407573618e-02   -6.596739272818934e-03   -3.108663921744771e-03   -4.044762601962126e-02   -3.046618412626285e-02   -1.274431357628210e-01   -3.168762669096718e-02; +3.213907937250116e-02   -7.902967509569180e-02   +3.502045431400368e-02   +7.702239821144964e-02   +2.512542043176021e-02   -4.405618193583696e-02   -6.085225043284061e-02   +7.869667675208357e-02; +1.779069107606478e-02   -6.213877554056146e-02   +4.845087633259276e-02   +1.017386729064269e-01   -1.489318849953791e-02   +3.053451281550352e-02   -4.189943831705997e-02   +2.328195888484639e-02; -1.782259067843764e-02   +3.695019424193224e-02   +1.373215941407232e-03   -6.971217553964399e-03   +1.992487395171821e-02   -7.725543601859183e-02   +3.196791227225595e-02   +4.672597879183572e-02; +5.392146855752394e-02   -9.671090865581457e-02   +4.857329901718939e-02   +6.500579532045073e-02   +5.753859196604594e-02   +1.901674134686031e-02   +5.910727334702962e-02   -3.893957996888576e-02; -6.060278244934832e-02   -5.018566567160248e-02   +1.763124879629579e-02   -1.600952737356932e-02   -2.620631981270671e-02   -7.470887265754789e-02   +5.468667672102485e-02   +4.091044289975468e-02; -1.230796347658684e-02   +1.896815006965434e-02   -4.955434906165558e-02   +7.018819131241659e-02   +5.199847615086468e-02   +2.765425523953514e-02   -3.328854252627481e-03   -2.949432040630046e-02; -3.584402294468136e-02   +8.403060639401265e-04   -6.311084094603443e-03   +5.739994848070956e-02   -1.009356148233353e-02   -4.228772522999624e-02   -1.211176666651970e-02   -1.096647748410953e-01];
L2I_L3I_iGABA_netcon = [-1.476474203701109e-02   +9.496969321893053e-03   +3.995827400045994e-02   -1.185413330402636e-01   -5.089758657831980e-02   -7.460699113156655e-03   +5.089629949032873e-02   -5.341917608952964e-03; -3.501778435854259e-02   +5.026049813285034e-03   -1.527530747388567e-02   +4.612779630816518e-02   -4.150685468058169e-02   -3.051473088790182e-02   +1.154184081317643e-01   +6.579184980134791e-03; +7.561319461642702e-02   -1.323701768951203e-02   -7.222487556013425e-02   -9.762168067361392e-02   +3.161887107469044e-02   +2.634795498955624e-02   +1.960289587392808e-02   +6.060874743060667e-02; +2.524230954394083e-03   +3.743452501777374e-02   -1.803361961616926e-02   -4.222239902833262e-02   +3.478034978204782e-02   -6.048931533786433e-02   +5.883168793001053e-02   -1.094671734313392e-01; -7.721024268922738e-02   +2.739182306267033e-02   -1.077266564295435e-01   -1.270582498883068e-02   +3.617738052864872e-02   +1.094050320691963e-02   -4.693471775001266e-02   +3.977836106320172e-02; +4.407023623395012e-02   -5.272261453322901e-02   -3.629310659872453e-02   -1.623276176424671e-02   +8.216822706848349e-02   +8.362653961045635e-02   +7.380297578592725e-02   +1.040097245395699e-02; +3.069559584793105e-02   +1.289761627318821e-03   +5.559237906834828e-02   -7.769588681907962e-02   +2.632244883275529e-02   -5.804568999452248e-02   +1.635696752520733e-02   +4.109691546948860e-03; -1.455205629023252e-02   +9.043335125853209e-02   -1.168588059429481e-02   +3.759057298325269e-02   -5.214829470423829e-02   +3.973738290609694e-02   -4.236545045167350e-02   -6.870217184582704e-02; +5.393554376563145e-02   +5.834056872848094e-02   -3.329460244026478e-02   +3.675290137652744e-02   +5.713109076549182e-02   +3.554702841792750e-02   +1.253016054576904e-01   -2.204576331499641e-02; -1.114278282638922e-03   -1.778119511753284e-02   -3.941109048131297e-02   -1.914949253431155e-02   -1.246733013444932e-02   -9.557086876901959e-02   -3.007963089586855e-02   +1.004329709223806e-02; -3.568059833283211e-02   -1.014055685304822e-02   -4.848284441393074e-03   +5.268542753458517e-02   +6.413285434715459e-02   +4.695711446313344e-02   +1.481639414034669e-03   -1.451357674012974e-03; -8.272787731207883e-02   +1.252356355327942e-01   +1.572272441182519e-02   +1.238993501802493e-01   -9.277814478430671e-03   -4.256371194623410e-03   +5.055884239730119e-03   -6.169775916319251e-02];
L3I_L3E_iAMPA_netcon = [+8.336410215537333e-02   -1.475556309653450e-02   +1.581044584070170e-01   +3.063981599529552e-02   -1.112466860879359e-02   +5.525495271339369e-02   -9.430163776487678e-02   +1.734948348574318e-03   -8.531819943396426e-03   +3.724007359568411e-02   -3.128745642161332e-02   +2.102716783552581e-02; -4.025338165385307e-02   -7.736156064539829e-02   +1.084349128057720e-01   -1.156234266134668e-02   -1.298426015123110e-02   -1.640229202247858e-01   +6.161989698884998e-02   +1.294278282732799e-01   +1.183573227708610e-01   +4.948482657012779e-03   -6.512303004298825e-02   -2.655484952952931e-03; +5.064740827772900e-04   -3.365780186370423e-02   -9.002812605809975e-02   +8.101703199257765e-03   +6.604155275432795e-02   +4.682592401187492e-02   +1.296546074720068e-02   +4.183523671931257e-02   +2.693082802902477e-02   -6.193461750558520e-02   -4.187265651960649e-02   +6.750587978115319e-02; +7.672251215454429e-03   +2.892356254064377e-02   +6.317086959002471e-02   +1.136240462753891e-02   -2.853513436428116e-02   +4.077600705740018e-02   -9.138065408493910e-02   +1.134629504524167e-02   +3.934595252880145e-02   -1.474684412533425e-02   -6.715551520082415e-02   +1.148880984634175e-01; -5.109648835890790e-02   -1.496969145452844e-01   -9.055444046340477e-02   -1.154811289782814e-01   -2.754037035222448e-02   -4.491347809901992e-02   +5.789752355644680e-02   +2.288052997887884e-02   -3.093386508343917e-02   -1.051981127023779e-01   +1.642009325697919e-03   -4.533573249653355e-02; +1.559367789349635e-02   +2.295351301329236e-02   +3.100037507102790e-02   -3.153414704488169e-02   -3.933695205894036e-02   +4.850805402910616e-02   +2.993819712644309e-02   +2.036370073330400e-02   -4.476897705586880e-02   +6.933003130991426e-02   +8.628496104036461e-02   +1.388059195474992e-02; +6.555451801845001e-02   -4.717776013620365e-02   -6.452299002991119e-02   +3.882913916733435e-02   +2.524336099529584e-02   -9.427713032523185e-03   +2.645607150754764e-02   +1.598486940353848e-02   +2.646208335474533e-02   -4.331323126857243e-02   +1.680094087062615e-02   +9.383065610863978e-02; +1.832761474265521e-03   -1.657727243783878e-02   +6.143961030893935e-02   +5.872679942004182e-02   +6.037700714678003e-02   +4.726950196875339e-02   +7.363019600085092e-03   +4.300618875645122e-02   +2.119279292794467e-02   -1.295981928101493e-02   +4.879246756271796e-02   +2.500254285227440e-02; +9.711270965692620e-02   -6.020434269160003e-02   +6.972527429919340e-02   -1.578990842631858e-01   -3.905359981520662e-03   +6.740971299953766e-02   +4.298529666967148e-02   +2.125016663594718e-02   -6.094552832644074e-02   +1.101290203600042e-02   +6.893627872534804e-03   -1.179213835511656e-01; +5.591457627404829e-03   -3.236334632121003e-02   -5.445332227360722e-02   +5.268619926807971e-02   -4.861457144752673e-02   -1.894489541592456e-02   -3.440483330762711e-02   -1.690443514738711e-02   +2.851133680574345e-02   +4.101974288066867e-02   +5.724770299963147e-02   -1.721267502562854e-02; +2.567351713002220e-02   +3.166227253189663e-02   -7.772926148061896e-02   -6.315283100110416e-02   +8.559088056464785e-02   -1.367940946349410e-01   -4.641738476823072e-02   +3.470375030535967e-02   +6.240457761178986e-02   -1.893684152168518e-02   +9.979297751499532e-02   +5.207657198151258e-02; -8.131480193240294e-02   +1.130666176121190e-01   +2.564022765309073e-02   +3.905465851051933e-02   +3.495178064695337e-02   -1.142618859786938e-01   +5.179781448022871e-02   -5.930031839977927e-02   -4.899938245807731e-02   +8.508965021103587e-02   +9.672289966532516e-02   +6.677322653878425e-03];
L3E_L3I_iGABA_netcon = [-7.141783793681035e-02   +5.921944495176087e-02   +6.502851471950137e-02   -2.916833024700908e-02   -8.532951910408794e-02   -7.321872533705275e-02   +4.746109840520804e-02   -3.209213073122523e-03   -8.315149484236135e-02   -1.284184205774670e-02   -2.328447207707983e-02   +2.302485319787531e-02; -4.267280121388290e-02   +9.364652355444111e-03   +3.982802318281635e-03   -1.624398562021245e-02   +1.071971573992840e-01   +4.690312604431162e-03   +5.251969117989593e-03   +1.390227155800057e-02   -5.639841432585243e-02   -5.192792682151642e-02   +1.308327416042041e-01   -3.167532307187081e-02; -8.821394328501145e-02   +7.153341176740890e-04   +5.280543635209786e-02   +2.270523115867179e-02   +4.684230949078435e-02   -3.586642215601399e-02   +2.479155621887622e-02   +1.220235400216452e-02   -7.764495229068319e-02   -6.058535642557810e-02   -3.692075296084055e-02   -3.066467164337471e-02; -2.549408205195640e-02   -2.924469083826288e-02   -4.969659456802808e-02   -5.607045128423298e-03   +3.030860749395464e-02   +8.253602429123331e-02   +5.762794599796280e-04   +1.804168529332192e-02   +9.180636447821611e-02   -1.398660158351706e-06   -4.374346151333186e-02   +4.947486571444444e-02; +2.115566880126723e-02   -4.676573149535207e-02   +3.670660691125770e-03   +5.666873862340684e-03   +1.789778636935727e-02   +2.314264603447379e-02   -3.156845666476760e-02   -1.075119023090625e-01   +3.829915957049294e-02   +2.643577203595678e-02   -1.183328280135265e-02   +1.315608767827014e-01; -3.311556965504480e-04   -3.753566049482210e-02   +1.029285180859615e-01   -3.210273840486850e-03   +3.455775760497286e-02   +8.410948250655217e-03   -2.068787076173674e-02   -9.238796801122660e-02   -6.027231684306208e-02   -3.253648495362704e-02   -4.576570837607772e-02   +2.399929959601469e-03; -9.329058772619485e-02   -1.975807550984281e-02   +6.725450231899839e-02   -1.164625797676650e-01   -5.343886764210236e-02   -8.456084522227218e-02   -2.936228725977956e-02   -3.388701675078071e-03   +4.359226692822903e-02   +1.173039141372387e-01   +4.956740282516010e-03   -5.234793477054327e-02; -1.353909732133696e-02   +2.008336368923250e-02   -7.040897121700226e-02   -1.885823714165474e-02   -7.280992859250129e-02   -6.427055844250180e-03   +4.088772492091573e-02   +5.436433446850789e-02   +6.098452829854903e-03   +4.390790416994961e-02   -3.536940420528499e-02   -5.758420175989234e-02; -4.967899738770939e-02   +1.081810633304197e-01   +3.347223761908836e-02   -6.056991870044193e-02   -1.060503456075621e-01   -1.549942058362407e-01   -6.703170768298961e-02   +4.614962723380990e-02   +9.688924323158124e-02   +5.407707313915094e-02   +6.055891986757362e-02   +2.833767396164290e-02; -9.110650350881004e-03   -6.232119458674182e-02   +1.792928838195624e-02   -6.494307124603358e-04   +5.119347191059981e-02   -7.174758819534115e-02   -5.406980137711141e-02   -1.665152773740899e-02   -1.726455498011016e-02   +4.554344962197253e-03   -1.339731585795259e-02   -5.383128228566181e-02; +8.200755632854401e-02   +1.958746695996019e-02   -4.451101619112929e-02   +4.721413210224454e-02   -3.085302265168448e-02   +1.311511520637470e-01   +1.455276979209735e-02   -4.525535096415437e-02   +4.397636479204734e-02   +3.741378229655706e-02   -1.799070062849633e-02   +3.278449929624214e-04; +2.193298923075399e-02   +1.344325908593014e-02   +5.744247052489768e-02   +1.762865794815127e-02   +6.762524204811758e-02   +1.508897112037651e-02   -3.699751822512649e-02   +5.630322425891530e-02   -6.546188195113618e-03   +9.916457789707038e-02   +3.559840446133943e-02   -4.423147530621634e-02];
L2E_Input1_iAMPA_netcon = [+1.428644563540952e-02   -3.157258750860941e-03   +6.094336424694836e-02   -5.497750995951659e-02   +4.411897229675465e-02   -6.020123692056148e-02   +5.088684780440182e-02   +8.336818314202643e-02];
L2I_Input2_iAMPA_netcon = [-7.471741871468258e-02   -3.506585705941787e-02   -3.120367336810061e-02   -1.314007271764281e-01   +4.609022543013250e-02   -7.112685716664487e-02   +1.128669726677994e-01   -5.141440105768558e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
