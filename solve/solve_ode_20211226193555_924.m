function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.805536731580738e-01   +5.525564889042339e-01   +3.155100434989118e-01   +2.005863566161435e-01   +6.408025342473483e-02   +1.001691599894471e-01   +2.537036089036904e-01   +1.038235653794145e-02   +5.017605753311674e-01   +3.346038378444064e-01   +5.321414771610177e-01   +4.297536420027577e-01   +2.587599387028987e-01   +6.195364185530507e-01   +1.963696331584321e-01   +1.445280908084820e-01; -1.179673049456085e-01   +4.253376437528259e-01   +1.843128895198267e-01   +1.303707196240808e-01   +2.229424170740909e-01   +6.751996044239425e-02   +5.952500343329175e-01   +5.291601502018396e-01   +4.934250970607034e-01   +3.383774461164244e-01   +2.206884717672355e-01   +5.895770298318372e-01   -2.201914720239972e-01   +1.337034056541122e-01   +4.437166988318393e-01   +6.223116292941495e-01; +3.381032060823100e-01   +1.377642115138854e-01   -3.451421574243689e-02   -8.092062732061850e-02   +2.207146487024023e-01   +5.357334826387939e-01   +8.984614164948483e-02   +2.668955980555824e-01   +2.232978020009852e-01   +2.290835588958958e-01   +2.684654487993633e-01   +8.506762382936219e-02   +8.372081844181338e-02   +6.930312801302002e-02   +3.672694403836415e-01   +5.501492080867720e-01; +3.607865012205250e-01   +3.375810949065119e-01   -1.065015457404737e-02   +4.203307539071172e-01   +3.752317856630252e-01   +8.074407237453297e-02   -1.919125356710502e-03   -6.142651500123349e-02   +5.114445234927529e-01   +1.039606518735283e-01   -1.747855011881073e-01   -2.492074222367840e-01   +3.710410334615195e-01   +2.238585190213422e-01   +4.004728614710564e-01   +3.365894424087628e-01; +9.367270806429114e-02   +2.039382400861973e-01   +4.455537931542839e-01   +4.914731824608595e-03   -3.252742370826675e-02   +1.655524241143222e-01   +1.797288199694089e-01   -5.456492624574019e-02   +5.037129098822982e-01   +3.072935255231367e-01   -6.220900463844152e-03   +9.428128666919638e-02   +9.254987697294730e-02   +4.658378581925104e-01   +3.967142933493656e-01   +4.298908299110340e-01; +3.684658669260212e-02   +5.713133281424932e-01   +9.471109750502543e-02   +2.175209958103749e-01   +1.052963711109184e-01   +5.466243171255857e-01   +1.783785438538799e-01   +1.982058254715888e-01   -2.368767834323854e-01   -1.319534411510624e-01   +1.357453851916675e-01   +3.933495185508436e-01   -2.356363440162854e-01   +6.230063900867024e-02   +2.731095115555209e-01   +3.658805380359061e-01; +3.983083664849439e-01   +1.051832670901574e-01   +3.096542622855576e-01   -5.920238655578350e-03   +8.924219334151663e-02   +1.724971895054856e-01   -7.176469380373375e-02   -1.669218759790722e-01   +4.998874916985085e-01   +4.115781274180711e-01   -1.955443463008880e-01   +1.963672759073979e-01   +1.551480158905040e-01   +1.694290609802928e-01   +2.519378665989195e-01   +3.705085838682837e-01; +5.167456648467285e-01   +2.271168839288442e-01   +2.880552805528426e-01   +4.592173058248892e-01   +3.935337147679132e-01   -1.783916348525995e-02   +2.442700041596761e-01   +5.425639791532069e-01   +3.899791167938879e-01   -6.393266360622804e-02   +4.451617720304317e-01   +2.103209359336232e-01   +2.872355738394224e-01   +3.467895015104873e-01   -1.014175853775183e-01   +2.732260592863437e-01; +3.880655461483547e-01   +4.866458575782977e-01   +2.111790486905404e-01   +2.653416013288694e-02   +1.708022667993112e-01   +2.148802744389183e-01   +6.176026994499949e-02   +4.269016767939797e-01   +3.051334092959542e-01   +3.570922970423427e-01   -1.695428998625513e-01   +3.615078154693625e-01   +6.208081687971521e-02   +7.539955768927543e-02   -8.093041569862811e-02   +2.093049795320475e-01; +1.919658774393251e-01   +2.642981561796011e-01   +4.653848767984921e-01   +4.736294684976157e-01   +3.972398598026303e-01   +2.920105113544419e-01   +2.240495883432567e-01   -4.813224500852378e-02   +1.776222497590564e-01   +3.992585336038122e-01   +1.424942172296010e-01   +4.973862280632757e-01   +3.013137112744038e-01   +3.899143769678678e-03   +2.389262763539985e-01   +3.322916446890543e-01; +4.188318332539309e-01   +3.609655064487567e-01   +3.837947164868634e-01   +2.750662792258080e-03   -2.579666817324466e-04   +5.112694155915141e-02   +2.448348969858317e-01   -8.863427573253072e-02   +4.145777503628355e-01   +2.821342362417484e-01   +3.594021034784647e-01   +1.377750575533241e-01   +9.006048557253050e-03   +5.725688893288986e-01   +4.157271254120323e-01   +5.874572942893498e-01; +1.525815082089834e-01   +4.042465388669891e-01   -1.443301103863959e-01   +2.473536148286031e-01   -1.437223556463577e-01   +5.274467461760738e-01   +3.672455444113170e-01   +3.124531896259966e-01   +4.494174956084929e-01   +3.613968802439600e-02   +6.325468505560113e-01   +4.288508401517482e-01   +4.412449423876248e-02   +3.923388670800092e-01   +4.032500843172395e-01   +1.115596743606829e-01; +5.545362925277336e-01   +6.754013772365664e-03   -1.055294556708028e-01   -9.681957634892703e-02   +1.545094419579046e-01   +5.774355962961669e-01   +3.440132760017222e-01   +3.738445519307619e-01   +1.845514849308916e-01   +4.161058368962723e-01   +4.898953173684736e-01   +2.765586881648321e-01   +3.184823766043435e-01   -1.519602907982996e-03   +2.181847780996460e-01   -6.505300079477522e-02; +2.857913136695402e-01   +9.273467440611448e-02   +1.281835072215474e-01   +1.877304489626161e-01   +3.536151840699391e-01   +6.286146474903302e-01   +2.566223050667474e-01   +5.943254558790745e-01   +5.536967054056260e-01   +2.493622975421318e-01   +1.449331175996204e-01   +2.627296889494761e-01   +7.474259362041194e-02   -8.816822720053882e-02   +5.014534425081838e-01   +2.938578409500285e-02; +5.868015783644992e-01   +6.399367870752972e-01   -1.142079110794288e-01   +1.961821834165514e-01   +3.197690324166959e-01   +1.031632022762191e-01   +1.298851013983178e-01   +3.448518962014242e-01   +4.462305818229081e-01   +7.218373760167427e-01   +3.156133459544806e-02   +3.548453657219907e-01   +2.477279032906178e-01   +6.695934722893244e-02   +5.855399852750399e-02   -1.439204197128161e-02; +5.347096344270976e-02   -6.791675877514394e-02   +3.756554616816347e-01   +4.871075288696586e-02   +2.929738182783693e-01   -1.456695922505633e-01   +2.659296458415369e-01   +3.222205839150004e-01   +4.165024727594787e-01   +2.261992358360822e-01   +2.040084257613915e-02   +2.469927811963062e-01   +3.699936247376232e-01   +1.502704416451338e-01   +6.732035921140904e-02   +2.040297997337181e-01];
L1E_L1I_iGABA_netcon = [+5.794944054319714e-01   +1.891903021628074e-01   +6.090909375953023e-01   +2.652312812905083e-01   -1.909449417757300e-02   +7.687319507798851e-02   +2.534346929918836e-01   +4.457200201175842e-01   +1.869308332002422e-01   +1.934399521136239e-01   +1.208468067256736e-01   +4.544501926659574e-01   +4.247184100347920e-01   +4.041910675654019e-02   +2.196211311988689e-01   +3.402047925111376e-01; -6.934201532763908e-02   +2.506227865187392e-02   +2.905877844292004e-01   +1.788752280753496e-01   +2.854563207753443e-01   +1.467473080803124e-01   +1.340463795042041e-02   +9.132843922628733e-02   +2.897343830915663e-01   +2.458346003593424e-01   +2.496666340913196e-01   -1.341701629444348e-01   +5.178085837435451e-01   +4.168163963343610e-02   +2.610276332165500e-01   +1.817071610268183e-01; +7.074261283087331e-01   +8.833698918808618e-02   -1.452538628484684e-01   -3.263049286227819e-02   +2.768638391126963e-01   +2.059057722581148e-01   +3.236965324819039e-01   +1.295342235102085e-01   +1.276150770454214e-01   +2.473998514148287e-01   +5.015216939200251e-01   +1.083314956131712e-01   +8.351266380186395e-02   +4.955421398433187e-01   +1.908358703582891e-01   +7.452549378830420e-02; +2.922178025440353e-01   +1.450071525893641e-01   +1.087069619094634e-02   +1.726248404067366e-01   +5.747495839581370e-01   +9.096546396710677e-02   +3.124812050795372e-01   +3.258072991626278e-02   +1.252211413021331e-01   +6.619383885084384e-02   +2.819125813307741e-01   +5.327645198080679e-01   +3.952536606759167e-02   +3.896792710796566e-01   +3.818953856725101e-01   +3.331124780875985e-01; +1.985629195090850e-01   +1.087766820398171e-02   +5.781677911956329e-01   +4.960394182748339e-01   +2.655090226025513e-01   +3.239261323809298e-01   +1.856006884225572e-01   +8.500072854802945e-02   +3.033067100163449e-01   +3.399305285695187e-01   +5.883030639569230e-01   +3.814854226147172e-01   +2.862687093869104e-01   +4.043865859819996e-01   +4.051334098689265e-01   +7.601535453976699e-02; -3.436321006235696e-02   +3.268555194595384e-01   +3.786526154584868e-01   -3.623378078589206e-01   +2.275969017931297e-01   +4.133871367946531e-01   +1.941080051233973e-01   -1.282030739122769e-01   +7.361962040134618e-02   +6.084528946974743e-02   +3.179007775726901e-01   +4.147738259033130e-01   +1.307650563499931e-01   +1.949307737556827e-01   +4.005884002439573e-01   +3.295563861400037e-01; +1.493498630887769e-01   +3.146833016594812e-01   +5.060349527857994e-02   +3.692618108508540e-01   -1.073421864413455e-01   +2.253487401837393e-01   +3.679139434129486e-01   +5.357728797767088e-02   -2.097527056020118e-01   +8.711349732922981e-02   +4.086423095513753e-02   -3.350992249198470e-02   +1.859450503547010e-01   +2.130911019348059e-01   -4.031642943668108e-02   -8.411897334439708e-02; +3.130366064492821e-01   +3.127486370016312e-01   +2.435864475539968e-01   +4.598777437204762e-01   +2.125724488411155e-01   +1.868507790659250e-01   +1.413534370591365e-01   +5.956736989979103e-01   +5.137516330764655e-01   +1.259371239234492e-01   +5.920546125644238e-01   +3.178827256161633e-01   +3.590104270048785e-02   +2.424954224312737e-01   -9.437364648970820e-02   +1.865312520394238e-01; +2.680472442818863e-01   +9.620872369279314e-02   -4.028091765767715e-03   +3.578871962043135e-01   +2.343816436071176e-01   +3.460476880841700e-01   -1.890955408546878e-02   +1.880395312235847e-01   +6.549033801846560e-01   +4.607241617692122e-01   -3.616476977848882e-02   +1.667756132635617e-01   +2.152736148542590e-01   -1.648322903524444e-01   -1.366652107610770e-01   +3.875730516177516e-01; +1.597376794146571e-01   +2.344924316629776e-01   -1.576110051263678e-02   +2.158628839364572e-01   +2.457715706731807e-01   +4.890524234844902e-01   -1.491881534044030e-01   +3.700637332780107e-01   -7.075119569750175e-02   +4.836058625668607e-01   +4.028838660553062e-01   +1.637858174419166e-02   +3.083093606347042e-02   +1.084488354252655e-01   +5.449743742944070e-01   +4.132313890967160e-01; +7.311651648828134e-03   -1.626597552815029e-01   +2.255089406944334e-01   -2.635428319688121e-01   +3.008626228601454e-01   -1.042183382659491e-01   +8.023406108014904e-01   +3.461662388934935e-01   +3.402574122099657e-02   +1.152558717132119e-01   +4.776211614623626e-01   +1.863326512442660e-01   +2.731178060992621e-01   +1.239766027049666e-01   -2.036453582243821e-01   +3.569517478438006e-01; +3.089023504333583e-01   +9.409747416798742e-02   +4.387031541942329e-02   +2.345690300508917e-01   +2.696041308959428e-02   +4.131627818995003e-01   +2.703739549970803e-01   +2.999191986211574e-01   +5.838766579228963e-01   -1.140256048124307e-01   +3.485508906749558e-01   -8.672387409579510e-02   +6.701683584114305e-02   +1.811640117171754e-01   +8.460506964817552e-02   +3.875753246583425e-01; +8.420551785380298e-02   +7.710058017379448e-02   +4.392790575221692e-01   +4.495705386493968e-01   +2.894843577329406e-01   +3.339477815319165e-01   +3.020887372748622e-01   +1.416503530325154e-01   +1.392723210455030e-01   +3.282907470441083e-01   +4.870262152784510e-01   +2.596891484663463e-01   +2.630965123113719e-01   +3.959979363798775e-01   +1.301479925843173e-01   +2.840520344360380e-01; +2.258898566148821e-01   +2.725724618419325e-01   +2.505022961790480e-01   -6.696110752144016e-03   +6.513371361159074e-01   +1.851229199374214e-01   +4.344926412673274e-01   +8.044869060382168e-01   +4.082426575145320e-01   +4.546210662163302e-01   +1.663253527127180e-01   +3.950885730413481e-01   +2.541966697708172e-01   -5.706618908232851e-02   -8.834800809823906e-03   -8.730656186791509e-02; +8.672334652304550e-02   +3.248295913220703e-01   +2.831220353739786e-01   +4.243921306599678e-01   +7.770177423166565e-02   +9.222419953313249e-02   +1.147618139386105e-01   +9.733139283010231e-02   +9.073389920011155e-02   +3.059188338860618e-01   +2.854074510557759e-01   +2.928186664317707e-01   +2.673566763219242e-01   -3.936103293579366e-02   +2.605227245671564e-01   +3.264019814217074e-01; +2.424933974294730e-01   +6.399450331314296e-02   +1.801628002634716e-01   -3.232094091380336e-02   +3.829913449153233e-01   +2.974122520200169e-01   +4.612498010698106e-01   +1.007341764676617e-01   +3.547863389662952e-01   +4.063247703287940e-01   +7.174213819174569e-02   +4.354558590907280e-01   +6.153340052453145e-01   +2.340448564673878e-01   +2.739607478401902e-01   +2.995801074602869e-02];
L2I_L1I_iGABA_netcon = [+3.336848066784857e-01   +1.154725303705581e-01   +2.212984716649879e-01   +6.776818528747262e-01   +3.617927123500703e-01   +1.223565754872192e-01   +9.520054737395242e-02   +1.399197133840302e-01; +2.324458253938438e-01   +2.749615498264365e-01   +2.053077660796930e-01   +1.212799858269757e-01   +3.675051734962012e-01   +4.094908272683866e-01   +1.842798093739923e-02   +1.185486249743734e-01; +5.310241734381669e-01   +1.888778035726103e-01   +1.364382378666723e-01   +1.744495035833597e-01   +7.204783140877465e-01   +1.399060126838080e-01   -1.892273004840336e-01   +4.783328890414402e-01; +1.371930813750708e-01   +2.439554609324214e-01   +6.631582929632031e-01   +2.011527867230800e-02   +3.005220230479135e-01   +5.674520295892189e-01   +3.493870859547196e-02   +6.340151284239716e-02; +4.270592045847198e-01   +2.622053454348113e-01   +4.984568965613427e-01   -3.135050542185560e-01   +5.076458107947116e-01   +3.639377111659992e-01   -2.153042315976030e-01   +6.826332059917218e-01; +4.675001538369791e-01   +5.317161371750705e-02   +4.309651020052332e-01   +2.610372356857449e-01   +5.393309235480943e-01   +2.106235905998270e-01   +9.169227679950694e-02   +6.019351207321297e-01; +1.812915552351028e-01   +4.526211350272521e-01   +7.294152055851168e-02   +3.532871967661088e-01   +3.886753168535359e-01   +7.361163932787966e-02   -1.564994360419444e-02   +3.348210016264173e-01; -1.788330125698582e-01   +3.353894564291963e-01   +1.076435761376560e-01   +6.926391185638714e-02   +3.793505840139849e-01   -2.320139478949665e-01   +2.234978756222477e-01   +1.711431481354651e-01; +5.380006350373649e-01   +5.673701621531652e-01   -2.193759314191299e-01   +2.040875566645700e-01   -1.071254515949321e-02   +1.815323743059090e-01   +2.536888460239558e-01   +5.428496755475436e-01; +2.294858124156665e-01   +2.688198573301355e-01   -9.985156625158098e-02   -1.468093079867229e-01   -3.108808556091921e-01   +6.352530237510086e-01   -7.239465910954047e-02   +8.753432519065957e-02; +3.641176820603110e-01   +3.559764090970002e-01   +7.986071498378720e-01   +3.604136722363824e-01   -1.281783855495788e-02   +1.178206068583074e-01   +2.159845577111256e-01   +3.822905588730838e-01; +2.511614716416246e-02   -1.590804013946368e-01   +1.890413148764042e-01   +6.594312231335269e-01   -1.272189590661332e-02   +3.298255231329715e-01   -1.164609066518902e-01   +6.704772615022720e-01; +5.100197471583254e-01   +4.623940810645031e-01   +3.073018913658165e-01   +6.369822251020608e-02   +5.336741918556897e-01   +3.771077034686562e-01   +1.538089880037686e-01   +2.866660786791221e-01; +2.435051908270086e-01   +4.045923551251429e-01   +8.358423319286581e-02   +3.870600576941436e-01   +1.798360940077054e-01   +2.951222512828772e-01   +3.849872251816767e-01   -1.262726681618976e-01; +5.881426233795204e-01   +1.964158287186683e-01   +5.488946495157941e-02   +7.768375743619973e-01   +3.087481638233346e-01   +4.284776731593110e-01   +3.088972838700417e-01   +4.792841660397197e-01; +1.303925372627194e-01   -6.756154422226830e-03   +1.578978284949822e-01   +3.568202608850833e-01   +6.989498009947492e-02   +1.029336722650131e-01   -1.212333395873987e-01   +9.904313867388517e-02];
L1I_L2I_iGABA_netcon = [+3.159164761047402e-02   +1.428507562992272e-01   +2.960838527465572e-01   +5.750112287883014e-02   +2.473091779609388e-02   +6.220570796894238e-01   +1.910726737465843e-01   +2.421787756237615e-01   +2.736058191530240e-01   +7.058462453847042e-01   +1.669092257054396e-01   +1.436911472159717e-01   +4.484088970343141e-01   -1.974400322006049e-02   -1.214643554197863e-02   +3.295047685613104e-01; +3.637646279002408e-01   +4.475806059094924e-01   +9.253368767751349e-02   +4.945284739839295e-01   +5.777715660163900e-02   +2.055400952550803e-01   +3.618888930703780e-01   +2.809228208510123e-01   +1.479727737646238e-01   +4.140185143219388e-01   -1.226694389921673e-01   +2.923046813368318e-01   +2.610765479691232e-01   +2.291456795214976e-01   -2.961399271015168e-01   +1.203987658739672e-01; +2.943173556245202e-01   -9.145413696999298e-02   +1.120744290661307e-01   -8.619079639767317e-02   +5.855945547988448e-01   +7.141647668798486e-02   +1.700972392936092e-01   +2.433975880078477e-01   +3.393142190135977e-01   +5.115409952106420e-01   +5.912610920804103e-01   -2.111022553946109e-01   +3.409357613994285e-02   +3.439423708837209e-01   +2.230999923397384e-01   +3.105691440367540e-01; +4.232415958527246e-01   +1.943725535619845e-01   +1.523466941116793e-01   -1.939185413775182e-02   -6.168044477287028e-02   +5.010540559414280e-01   +3.591847659751379e-01   +1.757268736206699e-01   +1.997794358181889e-01   +3.644729665739014e-01   +2.555656258939650e-01   +5.325119207570713e-01   +2.493387548043469e-01   +9.064732784540196e-02   +2.259599107812954e-01   -1.696837992803614e-01; +4.548754248507137e-01   +3.739539525791281e-01   +2.648853665126647e-01   +4.657232353526109e-01   +2.448902617095740e-01   +2.747966479598767e-01   +1.368416789228964e-01   +8.631491156766932e-02   +4.524460970198476e-01   +2.328883031319781e-01   +4.648469671074157e-01   -3.486981824991026e-01   +1.098923947683622e-01   +2.985275253357557e-01   -6.042942579769223e-02   +5.852936425916224e-01; +6.948119571340642e-01   -9.822787006143741e-02   +2.450915868192810e-01   +2.669344396012414e-02   +2.606754309695067e-01   +1.436713610957422e-01   +2.903275956837446e-01   +2.983186495589241e-01   +4.664625796429842e-01   +2.906670655629977e-02   +2.558572597501435e-01   +5.843268100881326e-03   +2.359810990215248e-01   +5.621839957057563e-01   +8.270412454111706e-02   +1.742348567404060e-01; -3.440029735587077e-02   -3.430100365299307e-02   +1.683441531998605e-01   +3.633189291417621e-01   +3.847420020713527e-01   +1.580289349896007e-01   +4.028566201897721e-01   +2.777053530824617e-01   -1.039480443910336e-01   +7.458557010681874e-02   +2.660810756329302e-02   +2.846164741932540e-01   -2.212162705448018e-01   +2.906766993809216e-01   +3.575096718384917e-01   +3.231855103261865e-01; +2.369499137419923e-02   +2.844012619102205e-01   +4.736280678909793e-01   +4.126534877284243e-01   +2.777144231373199e-01   -1.178902859079560e-01   +5.265078241696441e-01   +6.289973693407225e-03   +4.278328542501721e-01   +1.753347346167698e-01   -2.092482032186011e-02   +1.755536104626236e-01   +2.912591928874776e-01   +1.836628627053997e-01   +5.594773400830189e-01   +5.644328672609421e-01];
L2E_L1E_iAMPA_netcon = [+1.894514620677599e-01   +4.112204563435241e-02   +6.761643027651342e-01   +1.556783464151450e-01   +4.377722233059546e-01   +4.047206019023002e-01   +4.093461129690431e-01   -1.234324601382365e-01; +3.268873720586613e-01   +2.643269902812447e-01   +4.554604254054824e-01   +4.785982596739372e-01   +5.872245927988257e-01   +1.069556301868230e-01   +7.615300691219493e-02   +4.655991947995987e-01; +6.376352523096346e-01   +6.365622830599615e-01   +3.392209449692672e-01   +1.727429896751625e-01   +3.170357483539106e-01   +3.770914904785048e-01   +4.865152974216317e-01   +3.194590022490215e-01; +4.275176388296905e-01   +3.061183605980509e-01   +2.579625996119028e-01   +3.246381289321113e-01   +5.538504895932624e-01   +1.980824605375480e-01   -1.568082261110050e-01   +5.198530325663215e-01; -4.633168585668913e-03   +6.731182109192894e-01   +3.477841601281483e-02   +9.442839785826418e-02   +1.201251216473759e-01   +1.548472750497518e-01   +1.912717355288319e-01   +3.972854464453208e-01; +5.199767114680142e-01   +1.683169512027919e-01   +5.373480678939496e-01   +9.966456943303212e-03   +7.753694938498309e-02   -1.024450671049904e-01   +3.524785399313574e-01   +6.317861718747977e-01; +3.751182134503971e-02   -5.188398366172284e-02   +4.099966358841431e-01   +6.678997924737832e-01   +4.532637538255206e-01   +4.547587869310212e-02   +1.100973195931507e-01   +2.237220364708560e-01; +2.656107011228397e-01   +3.297999185184149e-01   +2.355672930216286e-01   -2.835694194216818e-01   -1.299660588853867e-01   +5.263153310870242e-01   +4.602038265408983e-01   -1.815157541472079e-02; +2.310881923099703e-01   -3.361706457927519e-02   +2.500887792713293e-01   +3.766774112987805e-02   +3.807549293737976e-01   +2.106836876400421e-01   +1.930509744025258e-01   +3.788114331623500e-01; -1.793503212797424e-01   -1.762785083570915e-01   +3.366748531802191e-01   +6.088865449463159e-01   +3.692863075111899e-01   +3.157016845496836e-01   -2.901470906832170e-01   +4.313798141465813e-01; +8.310409886634861e-02   +4.628319927035522e-01   +2.115882443740864e-01   +5.265971002363269e-01   +1.203986449076238e-01   +4.105889649641546e-01   +3.209289502042609e-01   +3.237298800301257e-01; +2.723974622315005e-01   +3.177040271868403e-01   +2.898565103440206e-01   +1.449874853301893e-01   +2.919246052072452e-01   +2.693554881627952e-01   +2.375861793856567e-01   -1.534067355696543e-02; -2.357429559618166e-01   +7.583756942797535e-01   +3.524178191595680e-01   +5.232009611125048e-01   +2.974265040974438e-01   +5.387687018979180e-01   -4.934125133629749e-02   +1.862242642490529e-01; +1.783893338076182e-01   +5.041788862757852e-01   -2.804757073258979e-02   +5.674968922492762e-01   +5.057824819586733e-01   +4.073315052233468e-01   +5.705911988410719e-02   +1.317390315536888e-01; +3.167573340225619e-02   +4.410170917356891e-01   +1.633572097470268e-01   +5.025892136021983e-01   -2.727870879008287e-01   +2.034732142010362e-01   -3.840919105292322e-01   -3.173944341595004e-01; +3.095584798226858e-01   +1.184989218303800e-01   +5.369162897110330e-01   -2.091393575019599e-01   +4.801374645225259e-01   +1.296927127330656e-03   +4.440015405882746e-01   +3.526776368981493e-01];
L1E_L2E_iAMPA_netcon = [+2.974783656170652e-01   +5.778505074350926e-01   +7.839951374310515e-01   +3.343678574098388e-02   +5.695758428264519e-01   +1.827886337720508e-01   +3.622321215738366e-01   +5.916633748635440e-01   +1.148576608347338e-01   +2.082584422450509e-01   +4.716354586303420e-01   +6.559766292385805e-01   +2.762058685161610e-01   +6.000778961569823e-02   +1.582053222190771e-01   +2.897132999051515e-01; +4.907856098861076e-01   +4.610631862740899e-01   +3.443519282492739e-01   -8.468200956039310e-02   -2.679868727186860e-01   +5.665649801509995e-02   +5.016961379303987e-02   +3.166362301678199e-02   +1.725860049138798e-01   +6.621916018656379e-01   +2.324391228420462e-01   +6.718204423802894e-01   -1.893496504613465e-01   +4.055717991373027e-01   +2.020501753260611e-01   +1.041623647796238e-01; +2.281004194303061e-01   +4.759405166404534e-01   +2.471321397184595e-01   -5.323213217246570e-02   +3.496661032546123e-02   +3.496700040723352e-01   +7.735286552523347e-02   +4.236641950830055e-01   +2.017553915049429e-01   +4.410921232132434e-01   -1.688048807586941e-01   +1.036257719956987e-01   +2.505458265920849e-01   +2.218102714814063e-01   +6.456292301728657e-01   -1.032397918574925e-02; +4.154849331934920e-01   +2.155062901709730e-01   +2.490918586556208e-01   +2.079061828308838e-02   +7.768619905061079e-04   +2.014843128749770e-01   +4.080960156540747e-01   +3.632864065050890e-01   +2.155219110915560e-01   +6.453923864620897e-01   +2.038524078421003e-01   -3.875073381329990e-02   +3.118987050959240e-01   +3.297916586644169e-01   +2.193020533926691e-01   +1.446103578339246e-01; -4.016897177672683e-02   +5.448969670155101e-02   +5.224425586360133e-01   -2.479038614537537e-02   +4.840483415114877e-01   +2.897235394599161e-01   +4.168531248758982e-01   +5.307213115624268e-02   +2.368935854836196e-01   +3.598855222134087e-01   +2.115358247671756e-01   +2.023459376541055e-01   +2.055068775578651e-01   +1.500059615349261e-01   +4.567623238328785e-01   +3.125428809214831e-01; +1.445471270899790e-01   +2.877418287737071e-01   +4.249515230399483e-01   +1.763042120672022e-01   +4.294748495678257e-01   +5.446353469563181e-03   +6.153586022852317e-02   +3.416884860120374e-01   +2.053297645081912e-01   +2.576247989605190e-01   +5.481303061784185e-01   +2.398690841175820e-01   +4.149699903082152e-01   +3.209672659571006e-01   +6.401764463399854e-01   +6.864787732084762e-02; +3.869840715835087e-01   +2.508621228731448e-01   +1.145709524574160e-01   +2.454953964741725e-01   -1.798018546195945e-01   -1.003336494879506e-01   +3.337977385935718e-01   +1.244753806858886e-01   +6.785688614071231e-01   +3.538689772793345e-01   +4.811340662236628e-01   +3.593901963925866e-02   +3.679260873453179e-02   +4.204596865676170e-01   +2.943416713073613e-01   -1.851008692383107e-01; +3.250854070820806e-02   +5.043356695624032e-01   -2.482236784028330e-02   +5.843951176908731e-02   -2.107199439807060e-01   -1.397141723595343e-01   +6.158812099842984e-01   +1.600616065351137e-01   +3.479456784905033e-02   +1.518393666959212e-01   +5.509288805278835e-01   -1.127149402419583e-01   +5.145682904002716e-02   +3.358229635810864e-01   +5.135176310290007e-01   +4.551688587682321e-01];
L2I_L2E_iAMPA_netcon = [+6.206509082616806e-02   +1.465941279202675e-02   +2.826926088096451e-01   +3.809056938065060e-03   +2.817584991308364e-01   -4.243634695078980e-02   +3.745679304019032e-01   +1.564975737053617e-01; +4.184814921589983e-02   +2.339718323645723e-01   +5.980952978697156e-03   -8.053222933095414e-02   +1.905567443786667e-01   +3.777011860647594e-02   -5.752479625560926e-02   +2.084706852955617e-01; +5.792563851138561e-01   +5.796114651086726e-02   +4.265403192101609e-01   -7.977440321189441e-02   +4.448151367574892e-01   +3.551581961237226e-01   +7.198580320972053e-02   +8.372438016927783e-02; +5.719981465884170e-01   +1.958756009502612e-01   +2.014765005936327e-01   +1.924072751623993e-01   -2.663544462483490e-01   +1.337273894556361e-01   +1.938841950471771e-01   +1.142958379702920e-01; +3.389416199934612e-01   +1.095873550073714e-01   +3.985794443616378e-02   +5.586583001917538e-01   +3.457379223968468e-01   +2.555236279145641e-01   +6.257294236155022e-01   +3.783925184305403e-01; +1.052817735962681e-01   +1.043231921291984e-02   +2.089106925795572e-01   +4.415572741138469e-01   +1.608124738013890e-01   +4.082058560193553e-01   +2.979759025453939e-01   +4.706794157184652e-01; -1.991761866298189e-01   +3.532837135531395e-01   +3.187392632001361e-01   +1.948375004115173e-01   +2.185781644577525e-01   +2.213013146272745e-01   -2.369804957742311e-02   +8.262403128901492e-02; -2.682686339180487e-02   +1.766221908065956e-01   +8.472340286000213e-02   +3.459144125430620e-01   +1.063446811201676e-01   +5.019502506348275e-01   +2.762694589695172e-01   +1.405050083436665e-01];
L2E_L2I_iGABA_netcon = [+2.474660245127978e-01   +4.446426788253924e-02   +2.786710630685172e-01   +2.905133017503638e-01   +2.914930541291093e-01   +1.930596846182404e-01   +2.542824733316954e-01   +4.452783888901652e-01; +3.810380786504635e-01   +1.009682475840238e-02   +3.062399776386038e-01   +6.065521930667779e-01   +3.950985604394161e-01   +4.733653360232767e-01   +1.763438192980969e-01   +1.301922858490948e-01; +3.484474686859962e-01   -1.676617882207522e-01   +2.571771079445764e-01   -1.349973665328119e-01   +7.040881160119360e-01   +3.162315064803399e-01   +3.849184239632278e-01   +2.800665424329874e-01; +4.557216282847870e-01   +5.542463830723063e-01   +2.614159691002041e-01   -2.252066076502490e-01   +1.603466811507729e-01   +4.173626570270285e-01   +1.942710430298185e-01   +2.765245521094573e-01; +2.447811767967363e-01   +6.231293446282750e-01   +2.585671954175867e-01   +2.314518044678261e-01   +2.469165935324027e-01   +3.277872927886389e-01   +9.093709356472568e-02   +2.201888609872013e-02; +5.774545242852709e-01   +3.044802212348937e-01   +4.606647432335833e-01   +2.189354536457895e-01   +4.372725601433344e-01   +5.841708649187315e-02   +1.575934226741997e-01   +2.456656291723002e-01; +4.672499348669650e-01   +5.441084606037619e-01   +1.849249965680339e-03   +1.921796756498727e-01   +5.309689189072594e-01   +1.121082717578544e-01   +2.043833555542119e-01   -1.345791388419829e-01; +1.071986198695143e-01   +3.306305715010280e-01   +4.628388127847934e-01   -5.332523854734861e-02   -3.500572037332114e-02   +1.863905058974368e-01   +3.697289016166885e-01   +2.557431186439793e-01];
L3E_L2E_iAMPA_netcon = [+1.520995309710592e-01   +4.386462754095954e-01   -1.319934172275339e-02   +2.011207203126042e-01   +4.662114656771653e-01   +2.192628566023074e-01   +2.414251065620769e-01   +1.439982372953374e-01   +1.668133346079241e-01   +1.093035452087934e-02   +6.227794405020616e-01   +2.976933453533106e-01; +2.267394289378054e-01   +4.891346530194584e-01   -1.338636786324788e-01   +3.707291577460284e-01   +3.931007555699384e-01   +3.481056344316259e-01   +1.900715980336064e-01   +9.245690015797983e-02   +3.305433420202610e-01   +4.173541889704059e-01   +5.099066157924111e-01   +3.911344906979912e-01; +2.760884066151583e-01   +5.488179622925641e-01   -1.006021539159280e-01   +4.125593543237721e-01   +3.689439407795839e-01   -1.569534049131868e-01   +1.525134594926024e-01   -3.296813714552545e-02   +2.394215954780988e-01   +4.224927595392972e-01   +2.123348925328798e-01   +1.967347313142785e-01; +1.581037731707067e-01   +2.009797120653841e-01   +3.740153408362181e-01   +3.132316431891717e-01   +3.107252906859772e-01   +3.157017390437706e-01   +2.919535283110674e-01   +5.882585477719702e-01   +4.367268282439221e-01   +4.059131200432289e-01   +1.236789757138892e-02   +2.227805149188953e-01; +1.999740631190177e-01   +2.810711724977816e-01   +2.270437327751211e-01   +3.710010255732498e-01   +3.308173984001562e-01   +8.046564623074038e-01   +4.856285637789772e-01   +3.237426402444809e-01   +3.733718077310267e-01   +3.933326082722793e-01   +6.153815433871799e-01   +4.984019135802130e-01; +2.358841919034535e-01   +1.438762184922832e-01   -1.514889602300746e-01   +1.004174613235644e-01   -1.055891338457673e-01   -1.610400604256401e-01   +3.006883352458850e-01   +3.554270330212018e-02   +1.446126307489941e-01   +2.540540395415132e-01   -1.289772943248832e-01   -3.610079144737270e-01; +3.326853230280829e-01   -2.855310505014414e-02   -5.813903908298576e-02   +4.320564913715381e-01   +3.844197228243583e-01   +2.149102726604783e-01   +5.095865015234567e-01   +1.538782615124368e-01   +1.620627653127240e-01   +6.005534226237874e-01   -2.551801998381255e-01   -5.851817206690314e-02; +3.570066588612701e-01   +4.615606880045404e-01   +5.138230083452987e-01   +4.527758050611796e-01   +2.618297469682900e-01   -1.080400780108731e-02   +2.807465821212000e-01   -1.341977125129634e-01   +5.620434031724412e-01   +1.346475732939991e-01   +3.791037151061761e-01   +5.304712097546176e-01];
L3I_L2I_iGABA_netcon = [+2.275680814065243e-01   +2.337152823988319e-01   +6.364483994563411e-01   +3.084330564449777e-01   +1.949198918629931e-01   +2.608468248271593e-01   -1.043397740572486e-01   +8.925831152713237e-02   +5.408068000901212e-01   +3.138182369624876e-01   +3.644239811157986e-01   -5.854541032599359e-02; +4.718801079270922e-01   +2.600839181358930e-01   +1.980340615224422e-01   +1.734156281293350e-01   +4.925460723103866e-01   +3.127362866130047e-01   +3.419520786363901e-01   +3.187930549968939e-01   +4.867262419634277e-02   +2.819887215046756e-01   +9.504558674391141e-02   +1.149943089395251e-01; +4.122329715296794e-01   +5.616250953471984e-02   +1.425538171421511e-01   +3.596731894377115e-01   -8.272959140365198e-02   -1.360216612900657e-01   +4.391372508227702e-01   +5.867337237576553e-02   +1.931504174414988e-01   -9.926202570746039e-02   +7.750513845226226e-02   +5.999635377177205e-01; +2.676133563941386e-01   +2.918301496282364e-01   +2.403863556675956e-01   +9.575893143214012e-02   +2.747808466053260e-01   -2.359487212655084e-01   +5.388307326434312e-01   +5.407331630161872e-01   +8.558515395913777e-02   +3.188027222511517e-01   +2.974374458574640e-01   +2.662751171771451e-01; +1.916230884934181e-01   +5.388027487150017e-01   +4.027494569067201e-01   +1.769664416586318e-01   +1.910734619282100e-01   +1.085258176777807e-02   +5.993218685958869e-01   -1.232044699327456e-01   +1.650731199832126e-01   -1.521620666103267e-02   +4.085083794275278e-01   +5.836854852814488e-01; +4.576796866248312e-01   +5.307729397275587e-01   +3.229283050612589e-01   -3.073096888725060e-02   +3.276288007952305e-01   +3.020000193915837e-01   +4.057348679235600e-01   +3.005384019899191e-01   +2.857490503976055e-01   +3.866095244505232e-01   +4.247071585471598e-01   +5.837214058208849e-01; +6.532806370766263e-02   +1.589831094020910e-01   +2.180664152158918e-01   +2.521203115549923e-02   +2.805447411561747e-01   -1.879172096576244e-01   +5.097214496775105e-01   -9.221523993351523e-02   +7.049751078870898e-01   +3.402896109067782e-01   +3.466116312032317e-01   +4.209682076572364e-01; +2.985127681150704e-01   +3.675789591179351e-01   +1.629054458298233e-01   +5.043468878012735e-01   -8.144057184102474e-02   +3.556346820231298e-01   -2.054697583825663e-01   +1.668532810254291e-01   -1.662076706722009e-01   +2.391467555344706e-01   -1.773087235656755e-01   +2.232489420949928e-02];
L2E_L3E_iAMPA_netcon = [+4.412784723979063e-02   +2.870340140722165e-01   +7.926161379418796e-02   +1.947043189539355e-01   +1.141521699040781e-01   +1.183695403099290e-01   +2.986645695339943e-01   +6.200445185988220e-01; -1.231127723548455e-01   +5.959835524567994e-02   +8.913830023732215e-02   +9.584271916176801e-02   +5.728654639264108e-01   +1.795276210430333e-01   +3.461131458801940e-03   -4.101818246527975e-03; +1.368843788402005e-01   +6.550607247602128e-01   +3.016660536347652e-01   +1.745303478451817e-01   +5.484486326435434e-01   +1.490069695944556e-01   +6.249612677701941e-01   +3.617021904139826e-01; +2.875138193262392e-01   +5.707280288571615e-01   +1.209822752121813e-01   +3.143484398764802e-01   +2.624328077426139e-01   +2.576974726368083e-01   -1.538892987147214e-01   +2.895376482887758e-01; +5.249400206649339e-01   +6.110373911309305e-02   +4.787071091080071e-01   +3.439400750097463e-01   +6.792576804848702e-01   +3.820580313191586e-01   +4.199708122507088e-01   +1.224174357107267e-01; -8.147308339714487e-02   +8.031742461670446e-02   -2.059353459603736e-02   +1.569089276209424e-01   +1.703903667842621e-01   +1.215218376074837e-01   -1.768067336686174e-02   +5.449817900426093e-01; -2.976260917238113e-02   -6.985451632709386e-02   +1.764860679883317e-01   +2.700882653739828e-02   +1.613207721528453e-01   +6.112432649804160e-01   -1.221316498318827e-02   +5.553770932989691e-01; +3.278456682675159e-01   +3.464490689356539e-01   +7.677101337287947e-01   +5.385090819725024e-01   +2.599275001662508e-01   +2.610010811434025e-01   +7.066832555440086e-01   -1.450101017560939e-01; +4.793531015172106e-01   +2.429445737249065e-01   +3.515787612467208e-01   +1.931599291864136e-01   -5.214970720102178e-02   -2.335566649879709e-01   +2.383853646273885e-01   +4.536137707507273e-01; +4.075800692446321e-01   +6.362482049700977e-01   +1.996757153261631e-01   +1.489633193773155e-01   +9.863974571604343e-02   +4.045115563407627e-01   +1.920459230613334e-01   +2.630003173870647e-01; -4.901747231837410e-02   +1.304911245476291e-01   +2.752203344069325e-01   -5.341673678029064e-02   +4.492232223935860e-02   +2.105050651021483e-01   -3.007558711859162e-02   +6.538031870293132e-01; +3.309669178512820e-01   +4.344659308875493e-01   +6.655725830868916e-01   +2.925580137384262e-01   +2.510625747037137e-01   +2.353785276567650e-01   -9.078172562983192e-02   -9.799288206883175e-02];
L2I_L3I_iGABA_netcon = [+5.892345427392852e-01   +3.996695002053610e-01   +3.838367423659314e-01   +7.243740119477882e-02   +4.281477807108666e-01   +2.884271095213797e-01   +3.619236465621347e-01   -1.238945898738164e-01; -1.106045622692987e-01   -3.123642096776075e-02   +5.283705531465650e-01   +3.488162252959177e-01   +2.386519136648611e-01   +1.868732323684365e-01   +2.991491516169808e-01   +6.354056271940215e-01; +1.904806648022288e-01   +1.268995651891114e-01   -4.794120461732961e-02   +1.989036650582852e-01   +1.850633870057308e-01   +2.539743143826365e-01   +2.805693936998119e-01   -2.554839710885488e-01; +1.188190936020185e-01   +2.830719841839314e-01   +1.921967669052794e-01   +1.947334562273662e-02   +3.356923912510916e-01   +1.875460980482798e-01   +9.043644213052418e-02   +1.791428991334521e-01; +4.138165645060610e-01   +1.414435649121746e-01   +2.753989766516490e-01   +3.907296857355192e-01   +7.980111633316854e-02   +2.186949689954098e-02   +4.581220712947628e-01   +1.855426928691269e-01; +1.737752520446722e-01   +2.804181970110731e-01   +3.108814267100330e-02   -1.156177665472599e-01   +9.488849709941689e-02   +4.827980391599226e-01   +3.814869015357182e-01   +3.769410537776162e-01; +3.485435051036479e-02   +1.899812795241534e-01   +4.840344974711051e-01   +1.399568748312907e-01   +6.214764535060534e-02   -2.347525318965045e-01   +1.396739883000980e-02   +3.046906212039851e-01; +2.087476110713316e-01   +4.954640670809263e-01   +4.830190087893447e-01   +2.518958343718105e-01   +5.024544591270826e-01   +2.998688139257598e-02   +6.313768633027278e-02   +6.183208891004539e-01; -1.636580197198849e-02   +4.179098535258161e-01   +1.706040300695488e-01   +9.008415027442371e-02   -1.097801443300184e-01   +2.944834253690508e-01   +4.094099169603588e-01   +3.100750336560675e-01; +3.806710695729592e-02   -1.293019491870872e-01   +1.466097086706648e-01   +6.723110929267586e-01   +2.266276596813383e-01   +5.135249026635952e-01   +1.650365335345580e-01   +8.937038440612172e-02; +1.092419792388531e-01   +4.486311152060131e-01   +3.556021040487275e-01   +4.009653302671625e-02   +7.242803872446173e-01   -4.311300481861018e-02   +3.932199154439988e-01   +5.893691598893561e-01; -3.222326444010971e-03   +5.860214600829181e-01   +2.039568118220499e-01   +2.510733848474897e-01   +3.423681454954624e-01   +2.650742041590597e-01   +2.756518537010478e-01   +6.835997476325616e-02];
L3I_L3E_iAMPA_netcon = [+5.004099839740801e-01   +2.046631548875761e-01   -2.665099562147869e-02   +4.295866029295895e-02   +2.151161610396017e-01   +4.059011989766857e-01   +1.924906719483793e-01   +2.725109774299462e-01   +1.950542058610402e-02   +3.743866004562024e-01   +8.738283255063665e-02   +4.040620497688849e-01; +1.640372808232937e-01   +3.166393808040572e-01   +4.110230326604601e-01   +6.386844456174122e-01   -3.755355647528708e-02   +6.143260158808874e-01   +2.933059174765993e-01   +3.246784847943832e-01   +2.137194596511419e-02   +4.612764622838697e-01   -4.965527189062287e-02   +8.073545531016777e-01; +2.540076076867400e-01   +7.690873943981258e-02   +1.065248002819872e-01   +2.823668455131435e-01   +2.369066155836468e-01   -2.505177151018747e-01   +2.065105919879014e-01   +1.928894864225861e-01   +4.176098470836102e-01   +3.021855470460021e-01   +2.553766749649873e-01   +2.514515156794805e-01; -1.475938383510041e-01   +1.303534313021836e-01   -3.119267291626275e-02   +1.703472107209718e-01   +5.646090953842472e-01   +3.241986479107516e-02   +2.760929561417606e-01   +4.586168501079965e-01   +4.467937322261304e-01   +4.403808424089546e-01   +3.351512145608228e-01   +7.696898801330185e-02; +1.359396730594365e-01   -5.169689228339898e-02   -3.391589229886575e-01   +2.804690606509510e-01   +1.601711035774194e-01   +5.156836449007691e-01   +3.525248742811286e-01   +3.010847761374196e-01   +3.006089882426142e-01   +4.331622803756858e-01   +3.370173340353694e-01   -3.065206141670387e-02; -1.234759756311596e-01   +1.456363314999729e-01   +3.239308265685816e-01   +2.129105033457441e-01   -7.026628203650112e-02   +3.414294286809919e-01   +2.376917908157988e-01   +5.928959655828294e-01   +2.798891578123513e-01   +2.411790485230459e-01   +3.408124692995410e-01   +5.481536244571594e-02; +8.191367253269582e-02   +3.927062082406926e-01   +4.987870076960459e-01   +2.264340172515678e-01   +8.231111692896456e-02   +5.944071759231594e-01   +1.950507270056386e-01   +5.331810225738286e-01   +1.287494129893155e-02   +5.427380406873692e-01   +4.438373293233541e-01   +5.083786860201599e-01; +1.031114677452783e-01   +1.909337743768746e-01   +2.648970516452306e-01   +3.046083032707854e-01   +4.054363660905159e-01   +4.028315468724508e-01   +1.559663674579595e-01   +4.876366454397775e-01   +4.003059178993771e-01   +4.986624659939252e-01   +4.391424721865330e-01   -9.868877521431341e-03; +3.560517413474511e-01   +5.224016939574071e-01   +6.152929658937166e-01   +9.305940537325098e-02   -1.275802936280613e-02   +6.578037174323981e-02   +2.185270975386179e-01   +2.328681246442522e-01   +4.371292451779547e-01   +1.605447497790815e-01   +1.062225189290440e-01   +5.301697091405750e-01; +3.373214591112009e-01   +3.653056396189840e-01   +3.718326399406627e-02   +2.718977274666677e-01   +2.205929365597296e-01   +7.326110979394822e-03   +4.301102211618595e-01   -1.795862174687925e-02   -6.412116306420929e-02   +4.175256145446429e-01   +7.425474431961611e-02   +4.936978940254050e-01; +6.326814826319785e-01   +5.923065154501683e-01   +2.959528859962617e-01   +3.956807126718569e-01   +3.685386073924742e-02   -2.116011761560589e-01   +1.655804728025784e-02   +2.301011877584951e-01   +7.875258047370087e-02   +3.948500639628295e-01   +2.966812562763879e-01   +3.193303690284258e-02; +3.189855643929911e-01   +2.433994090377653e-01   +4.908038190120265e-01   +1.573889970892984e-01   +4.036868223492087e-01   +1.093496543005384e-01   +1.622008379425129e-01   +7.040938186282858e-01   +1.107719123859368e-01   +4.879523903614300e-01   +1.308239333808907e-01   +6.803050564161773e-01];
L3E_L3I_iGABA_netcon = [+3.682191067470328e-01   +1.399360749131323e-01   +7.211678173138099e-02   +5.775092312189017e-01   +3.696643898565730e-01   +1.620313248202560e-01   +2.368957398340332e-01   +2.074345808631937e-01   +6.390408995770737e-02   +9.342559621720391e-02   +3.633954278196293e-02   -9.993084338261415e-02; +2.628590637267958e-01   +4.354697970220145e-01   +3.706499214712566e-01   +5.798933194748648e-01   +2.023141899652477e-01   +3.379652691934240e-01   +5.878423125095347e-01   +2.536862658670287e-01   +1.675408068918296e-01   +4.439928237650901e-01   -6.133519586017414e-02   +9.137291735959824e-02; +1.851770926149388e-01   +4.276951757489714e-01   +5.165239589379288e-01   +3.282947483645333e-01   +4.857364710445911e-01   +6.702161928160685e-02   +1.062115274889721e-01   +2.594789866130043e-01   -2.779622590319596e-02   +1.208445992535698e-01   +2.224975669947510e-01   +2.863646551430053e-01; +7.451825733883287e-01   +2.648280517483182e-01   +5.920116108736569e-02   +3.884372334402768e-01   -3.210964058516717e-02   +2.944616922547221e-01   +3.290420746110572e-01   +1.630667995645219e-01   +7.540367437322364e-02   +2.746452764192006e-01   +7.854372408384488e-02   +2.953642355001712e-02; -7.307240773722162e-03   +4.772873661563802e-01   +5.004727853875518e-01   +4.085356110215606e-01   +3.002556882785722e-01   +2.796569497519548e-01   +2.187186611440681e-01   +2.934394428405903e-01   +4.140646904872987e-03   +1.615734683737646e-01   +1.420216192678606e-01   +3.900295123830387e-01; +1.186104024268610e-01   -1.611159185292385e-01   +3.283460557034945e-01   +3.050205018666626e-01   +4.930173322049569e-01   +1.046871164227024e-01   +9.945687567978558e-02   -1.063474631647402e-01   +1.035158461447303e-01   +4.703679374586103e-02   +4.254853749330467e-02   +2.929142977110359e-01; +1.360674449227472e-01   +4.114127466166469e-01   -1.138298940522202e-01   +2.657018338850946e-01   -7.433378563953172e-02   +1.963708958452304e-01   +3.923250443447374e-01   -7.053198688439404e-02   +3.122966605967643e-01   +5.695020940331825e-01   +4.497551568517832e-02   -7.685509645351733e-02; +3.631205848113729e-01   +6.928914633622300e-02   +4.672031668121152e-02   +4.098023279328295e-01   +4.598473210977971e-01   +4.627770066805312e-01   +5.831593138515265e-02   +4.891576957405250e-01   +3.829552483684944e-01   -4.778129148943398e-02   +4.427654200802523e-01   -2.242942673049647e-02; -1.303509547793121e-01   +3.349155445346530e-01   +4.034747408896916e-01   +4.459021632827476e-01   +3.152381199454131e-01   +2.172566548023085e-01   +3.784055506065780e-01   +2.763890612081585e-01   +1.032217407677948e-01   +6.457264661356648e-01   +5.163431243344380e-02   +1.848550443210124e-01; +1.033453238938516e-01   +4.455556987259676e-01   +3.761374692727434e-01   +2.957318203507140e-01   -5.576192839450415e-02   +3.660855550045555e-01   -1.498078230163534e-01   -7.925012436808952e-03   +3.707819091040424e-01   +4.742109314033540e-01   +1.460141695598349e-01   -1.888337323556836e-01; +3.625508704145953e-01   +5.987922831915411e-01   +9.311199779528323e-02   +6.166758949972040e-01   -8.543602628118428e-02   +3.493412889624154e-01   +2.490090098215874e-02   +2.285387203913281e-01   +1.155213511667239e-01   +4.822551001364215e-01   +1.050651606246281e-01   +1.985575408076045e-01; +1.665076010144035e-01   +3.391795301341646e-01   +1.136592342620441e-01   +2.810157970788082e-01   +4.365259698175312e-01   +2.100356663584181e-01   +1.478581747411550e-01   +2.982889299811984e-01   +7.962384459354099e-03   +2.956936232087368e-02   +2.341458191488937e-01   -1.038171473418732e-01];
L2E_Input1_iAMPA_netcon = [+2.337421957335120e-01   +1.951755264929682e-01   +4.478357605697051e-01   +2.188570214191628e-01   +1.821298012187468e-01   -3.359284923540797e-02   -2.448531793800454e-01   +6.492409952662866e-01];
L2I_Input2_iAMPA_netcon = [-1.816830949161738e-01   +5.467775646651056e-01   +7.515527786234845e-02   -2.818847409351864e-02   +3.763666725110031e-01   +2.107894832118629e-01   +2.474126724359822e-01   +4.997224984301555e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
