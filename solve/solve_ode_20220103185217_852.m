function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.148668847113865e-01   +9.463391106856870e-01   +6.999158738644042e-01   +1.548964473517648e-01   +9.223141133017321e-01   +2.187071722064491e-01   +7.404183346093688e-01   +3.012405310104664e-01   +5.326112220598874e-01   +8.297902040779845e-01   +9.681366519999922e-01   +9.649234353460781e-01   +6.965689507399065e-01   +3.716235249961936e-01   +2.969659897470465e-01   +3.785787002578349e-01; +3.454899344379345e-01   +1.395274423553118e-02   +1.412290449181821e-01   +1.753099783937281e-01   +7.215174257994160e-02   +8.075298262163807e-01   +7.952089160423766e-01   +7.584830680657378e-01   +7.851662352471989e-01   +1.817325377300274e-01   +4.657209224826959e-01   +6.553258962367371e-01   +3.755420928554444e-01   +2.748780895397121e-01   +6.846782163446443e-01   +9.542198272094308e-01; +2.077637184529025e-01   +4.664039773186717e-01   +8.361500357210160e-02   +7.036707636649486e-01   +3.139210167152733e-01   +3.820112701042356e-01   +6.629298615092158e-01   +9.523152796941912e-01   +4.853430238363982e-02   +9.260768508230888e-01   +8.687257151043491e-01   +2.087732374945137e-01   +5.420272094772992e-01   +7.460018368999427e-02   +7.718423805922782e-01   +8.120789303868096e-01; +2.477767611947495e-02   +4.893973157029015e-01   +4.326394086254270e-01   +8.326491139340058e-01   +6.273401836092817e-01   +8.552449073705253e-01   +4.422384012746458e-01   +8.538253364800227e-03   +4.625503708272719e-01   +4.204205718606972e-01   +9.454628083927339e-01   +8.983978804283225e-01   +5.183536386794328e-01   +1.514239539973490e-01   +7.196740803526384e-01   +8.912018851807496e-01; +7.660903936043436e-01   +5.154719004035468e-01   +8.943841060305412e-01   +8.124936348173566e-02   +9.052875214505527e-01   +3.242176423375914e-01   +5.748063834284547e-01   +4.073020701537180e-01   +9.379803110944019e-01   +3.022098484412697e-01   +2.332080988256419e-01   +4.884700565271272e-01   +7.636069733215498e-01   +3.645309790251242e-01   +2.793155171442435e-01   +6.739305413952083e-02; +5.714919803763795e-01   +2.878907407912047e-01   +7.324614332593434e-01   +8.352276473350497e-01   +7.971790199635199e-01   +3.790239168783443e-01   +5.180326148399771e-01   +1.519512798271044e-01   +4.721861261806137e-01   +3.487959827742865e-01   +9.191288712383152e-01   +6.613052183215494e-01   +8.004541107989541e-02   +7.193854436009690e-01   +1.335497002451623e-02   +9.036066796859916e-01; +5.761394523146172e-01   +5.651392304339260e-01   +6.804437284696603e-01   +5.417689488153467e-01   +6.432989150322298e-01   +6.375410322953056e-01   +7.249627337610912e-01   +8.205406541628240e-01   +7.798608725130183e-01   +9.728449115140628e-01   +6.344799509938929e-01   +5.258792315019832e-01   +4.651318773029695e-03   +5.320133854428787e-01   +1.430469369545360e-02   +6.681658297431994e-01; +3.901727779205870e-01   +5.101094279483671e-01   +2.001148895628445e-01   +9.624374796928695e-01   +4.413688070485890e-01   +3.888336510872583e-01   +2.225471657251645e-01   +2.879031594746926e-01   +1.090084177185379e-01   +5.303559714306388e-01   +2.840271341146088e-01   +7.076098438279423e-01   +3.998665417311086e-01   +2.322345639084564e-01   +9.369957792265332e-01   +3.478606377174578e-01; +5.560716902464133e-01   +6.789679854982517e-01   +5.287928210142799e-01   +6.775984207286000e-01   +7.473821535382859e-01   +6.619114896203640e-02   +9.972526090115430e-01   +9.784338172494578e-01   +5.222761064999266e-01   +7.891915050274859e-01   +8.547686370143071e-01   +7.190751504314719e-01   +6.618147123638838e-01   +4.702431445843687e-01   +9.330086114526632e-01   +8.360978924508784e-01; +1.822705380136912e-01   +6.146381533249946e-01   +8.295407601216922e-01   +3.363708941944210e-01   +8.257998748282267e-01   +1.604349410837555e-02   +6.204224507097851e-01   +6.241152126167050e-01   +6.363466171545892e-01   +7.938573677022057e-01   +1.656614477112159e-01   +2.941992380409916e-01   +3.682813075304622e-01   +7.166257532494233e-01   +3.754877965872461e-01   +1.993428055772301e-01; +1.179447131169084e-01   +5.660789570707735e-01   +1.743895811844208e-01   +2.215479936254814e-01   +3.411621168840382e-01   +8.784049677047898e-01   +9.800164956228645e-01   +7.435385610655320e-01   +5.781232919873474e-01   +1.458618155011036e-01   +8.288871653339949e-01   +1.170719130061046e-01   +3.919754324337318e-01   +5.144984634244179e-01   +1.096171176068823e-01   +8.414166494670976e-01; +5.839541639617324e-02   +5.042231393839869e-01   +5.187555724149038e-01   +5.697181487972157e-01   +1.391097589875159e-01   +1.586554072318830e-01   +4.942570576525077e-01   +8.737283515350958e-01   +8.350681816811936e-01   +4.556984958654693e-01   +2.165249063789109e-01   +3.242227338534119e-01   +1.349895397967994e-01   +5.141753800869789e-01   +7.192072391290671e-01   +4.251056427634529e-01; +9.329702721548014e-01   +6.677448676682813e-01   +3.561165436043176e-01   -1.485413332571692e-04   +5.037901833517089e-01   +9.140602392434478e-01   +5.231771503966345e-01   +3.295961864472342e-01   +1.158352922169679e-01   +4.582440272190129e-01   +2.673364180315159e-01   +4.562032763251538e-01   +3.388916515789445e-01   +3.854071277936713e-01   +4.487971738401179e-01   +5.580331211462198e-01; +7.460973631258527e-01   +6.327813377600574e-01   +6.445589171657009e-01   +5.877337030646355e-01   +4.133069632024223e-01   +5.561379705724323e-01   +8.557368935618281e-01   +9.897070603370245e-02   +5.270677499903161e-02   +9.529308408840739e-01   +8.578662079467618e-02   +7.170701934570153e-01   +1.231479048858245e-01   +4.799842526754411e-01   +1.243708186099178e-02   +4.473583224427124e-01; +2.429152243084894e-01   +1.458408944838520e-01   +2.813981224938120e-01   +8.918772926918604e-01   +1.710198369864839e-01   +9.232549163965212e-01   +2.537849973212729e-01   +4.510740684728990e-01   +5.171674758322117e-01   +5.270946371587557e-02   +9.166921369224537e-01   +4.055509028193530e-01   +3.691192944005517e-01   +7.403636831291963e-01   +1.243875741028044e-01   +7.593972585653090e-01; +2.046604213853140e-01   +1.786695494883742e-01   +4.368912654595547e-01   +2.547191575345971e-01   +4.948156777477696e-01   +5.966214263547563e-01   +5.827688720410489e-01   +2.391572575680939e-01   +6.971615464454198e-01   +3.656240731412307e-02   +7.261259551275839e-01   +2.424753944759995e-01   +2.505659722354244e-01   +7.016176506281178e-01   +6.584540422635843e-01   +9.568273654802698e-02];
L1E_L1I_iGABA_netcon = [+8.435483157808237e-01   +7.527709034300867e-01   +8.734876131134169e-01   +4.357016798046767e-01   +9.174332265492943e-01   +7.789862537736084e-01   +3.212650101403797e-01   +6.405137756861824e-01   +9.446051199479591e-02   +2.629812262748911e-02   +1.286681775068856e-01   +5.212610598559541e-01   +8.704356820275746e-01   +5.765795843322383e-01   +1.650439180355193e-01   +6.278580852907856e-01; +6.211758609050118e-01   +9.955748791967439e-01   +3.095842398144764e-01   +1.470929632485555e-01   +8.834039890843894e-01   +2.731517448499519e-01   +9.634246552342669e-01   +4.293445422484586e-01   +2.917840325033651e-01   +5.151505644358709e-01   +4.254206024301484e-01   +2.034549488940748e-01   +8.033276422162479e-01   +2.890246135726010e-01   +5.490688817865181e-02   +3.366759485537090e-01; +6.723179940640267e-01   +3.702060865601013e-01   +4.326675356780768e-01   +6.538609030136543e-01   +5.856181757943927e-01   +5.268214646215488e-01   +3.534404610813668e-01   +4.786108218498932e-01   +3.253944601451273e-01   +8.630184381708115e-01   +4.799219221453864e-01   +7.748601780469836e-01   +6.463911688332443e-01   +1.322650779339084e-01   +2.108753413676276e-01   +1.562235629786329e-01; +7.825962253837488e-01   +5.020520170192706e-01   +3.819200820001853e-01   +7.219274338830348e-01   +8.348199454649736e-01   +4.030232136537578e-01   +3.195833991727869e-01   +1.007796822485890e-01   +4.829921637949737e-01   +5.819205194847515e-01   +6.743216846799727e-01   +3.909730595393950e-01   +7.346859604441200e-01   +4.917543874866986e-02   +2.035097297688451e-01   +4.029438551693794e-01; +3.095062023323794e-01   +7.590225471392907e-01   +6.568716916233501e-01   +1.619184185040395e-01   +7.766376875167932e-01   +7.791893409210181e-01   +9.082232680517615e-01   +8.066461363149947e-01   +2.425827248156052e-01   +4.228627308679818e-01   +3.566597560078087e-01   +6.649792556992534e-02   +6.664647107148995e-01   +6.255467914240863e-01   +2.171576087919860e-01   +9.127929331046912e-01; +3.298678847802328e-01   +1.268612549945635e-01   +2.374063092224198e-01   +3.425373312695745e-01   +7.849615679641476e-01   +2.567264193729019e-02   +8.850655730503535e-01   +6.587687047057007e-02   +4.540548184847649e-01   +7.126619137200855e-01   +5.031856751725421e-02   +7.555565793368068e-01   +8.810906752297356e-01   +6.056613285916047e-01   +5.778903320008016e-01   +1.484151301861431e-01; +6.332667262880148e-01   +5.173275471407732e-01   +6.861000172203734e-01   +1.068303893031699e-01   +7.009698607321335e-01   +4.116014962892752e-01   +3.512627893814508e-01   +9.540099817510925e-01   +7.588232759818714e-01   +2.339914529482028e-01   +2.899877825491669e-01   +4.527770810796394e-01   +8.531934550945112e-01   +3.711889219071015e-01   +3.343073597213225e-02   +4.639678412282789e-01; +9.011261154138459e-01   +9.059811378237302e-01   +3.268257157268786e-01   +4.071066424363989e-02   +1.874955745242245e-02   +8.268237452519376e-01   +7.500300927617172e-01   +7.726056983044035e-01   +7.183604444812031e-01   +5.862354165061238e-02   +7.940617390628845e-01   +3.180214020798738e-01   +4.036429895592932e-01   +8.312217536194531e-01   +7.943933155726339e-01   +7.999271787044260e-02; +3.708274986321040e-01   +9.968380012480905e-02   +8.805817085792731e-01   +4.782252383357677e-01   +3.310813644070177e-01   +5.928408857915476e-01   +1.268542154955507e-01   +4.402102209865950e-01   +2.376432638598938e-01   +9.764667321757039e-01   +6.507923885819547e-01   +2.781319765387273e-01   +1.057606501927824e-01   +5.195783863425461e-01   +1.351723014149951e-01   +3.427716068079744e-01; +8.814795994972462e-01   +1.791111243492198e-01   +9.990899115377068e-01   +4.770514177989247e-01   +9.478616023978652e-01   +2.132220649033066e-01   +5.990632862527481e-01   +1.655169930342220e-01   +6.992064687322870e-01   +9.688236827630342e-01   +7.110242007583050e-01   +5.838420723895967e-01   +4.033037870038157e-01   +8.004060951439710e-01   +5.829079902719927e-01   +4.965978787144366e-01; +1.250344335959682e-01   +1.724489105496113e-01   +6.808376054247979e-01   +5.464531806434513e-01   +3.977580424967139e-01   +2.964190173029491e-01   +4.364971159321279e-01   +8.008219911430460e-02   +3.050418546679075e-01   +1.361356644099518e-01   +7.653664611404423e-01   +9.119456623053364e-01   +3.406704348187076e-01   +5.698698109908178e-01   +8.511473132143374e-02   +4.897790744407678e-01; +8.877046048977337e-02   +5.341767842555935e-01   +3.434700217284221e-01   +6.504245487363949e-01   +6.315412120116984e-01   +2.686416907715357e-01   +9.593798059188922e-01   +7.424828060636676e-01   +4.691829578373170e-01   -7.120172317709343e-04   +3.838389951022101e-01   +4.503509878298252e-01   +1.152772966213833e-01   +7.144091055548676e-01   +2.294956401464264e-01   +1.265802914260085e-01; +5.461754707789657e-01   +9.784400018152718e-01   +5.609401069705513e-01   +3.488426946727601e-01   +8.595680704738036e-01   +9.287025668263258e-01   +9.650686018198438e-01   +5.437724532700118e-01   +4.439513600137143e-01   +9.364906307796643e-01   +3.622802304105830e-01   +9.797012031006657e-01   +8.523467358076636e-01   +7.326419011641928e-01   +4.516538169426422e-01   +8.492622472201172e-02; +6.112929097992104e-01   +8.443869707776303e-01   +8.907669065798421e-01   +2.568120513696781e-01   +3.775237207208689e-01   +5.524812003608931e-01   +2.421673053483915e-01   +4.851484880301611e-01   +7.337866495153307e-01   +7.402109178145757e-01   +8.098239010293262e-01   +1.106101333858569e-01   +8.930099447282704e-01   +4.550243577941301e-01   +1.781225384128144e-01   +6.736960355667031e-01; +7.275753473456409e-01   +6.719941245415663e-01   +6.465300903927951e-01   +1.765599817647179e-01   +2.055145794828944e-01   +4.320026120379140e-01   +7.710784003909543e-01   +8.954036224036819e-01   +8.770422261953561e-01   +4.324933781873990e-01   +3.866242181909710e-01   +4.160487250824764e-01   +6.858421880684572e-01   +2.838815701513900e-01   +4.137007584156740e-01   +1.223124542608896e-01; +9.916444405130777e-01   +1.021274902340802e-02   +3.767270184403730e-01   +4.785452647607929e-01   +9.122830247287754e-01   +3.278861437794005e-01   +7.123184264416439e-01   +5.820823461621488e-01   +9.129511482895447e-01   +9.439174426698673e-01   +8.713052266521852e-01   +3.835604934997138e-01   +7.434907161993433e-01   +1.512508063254505e-01   +9.654385373258281e-01   +9.883463905964815e-01];
L2I_L1I_iGABA_netcon = [+5.730946801325758e-01   +5.650344043321391e-01   +1.078503225080562e-01   +4.602626460741985e-01   +7.961595881289257e-01   +9.784867326590405e-01   +2.245169671969930e-01   +7.582314288455133e-01; +5.591061303488839e-01   +9.542027710994012e-01   +1.185462079326741e-01   +5.673092010921210e-01   +5.414137220802808e-01   +4.219675175606382e-01   +6.694901323660209e-02   +5.065299966036012e-01; +6.110931743803893e-01   +8.627195148782041e-03   +4.336663334437051e-01   +8.163969051278867e-01   +2.571951149368095e-01   +3.931519423071924e-01   +8.351961913782764e-01   +8.279961217317031e-01; +4.670327058584994e-01   +1.266774896624168e-01   +9.322331247064100e-01   +3.553852351409660e-01   +7.808141562734393e-01   +4.607979354501920e-01   +4.071230856408875e-02   +9.277023230856816e-01; +4.335433220383114e-01   +8.536423206313428e-01   +1.399260491368673e-01   +2.483627901736617e-01   +7.791291126428705e-01   +1.209690096412692e-01   +9.100054119704125e-01   +7.113093413236038e-01; +6.242773767082622e-02   +2.173048211669434e-01   +8.268166712556095e-01   +7.708453330822573e-01   +1.438979983777881e-01   +4.546036361235512e-01   +4.490512685850125e-01   +7.978736388117480e-01; +6.466540904096322e-01   +7.094211333861837e-01   +9.324777666406235e-01   +2.239212327595721e-03   +8.231793267837992e-01   +2.646702343095523e-01   +2.847899594782414e-01   +9.597393196466927e-01; +4.262584195358336e-01   +7.737218531168838e-01   +5.728307853000955e-01   +2.773425858970425e-01   +6.242595597585653e-01   +9.295443079925646e-02   +7.559265327196616e-01   +9.523192970996502e-01; +7.557054710571237e-01   +4.209573137688376e-01   +4.987191012647941e-01   +2.265308340608346e-02   +4.557025594850345e-01   +6.622004303969589e-01   +9.271662713368124e-01   +2.955420648262778e-01; +3.054943270968380e-01   +7.255878567979710e-01   +9.307836034711682e-01   +6.709049653720370e-01   +4.833396665963819e-01   +9.443091333724221e-01   +1.415984927585683e-01   +3.521605214249516e-01; +5.970743815673696e-01   +4.584592486458245e-01   +8.624218065712319e-01   +9.668457635826002e-01   +2.191929394505477e-01   +7.652649783216974e-01   +9.561686888184932e-01   +5.408080872625429e-01; +3.346109721009431e-01   +8.052559922219299e-01   +2.535319680656496e-01   +9.454815669140124e-01   +8.570638292131845e-01   +4.310619661016410e-02   +3.046143232283675e-01   +2.124776924406821e-01; +6.428784968865816e-01   +4.286677717421362e-01   +4.574868546500094e-01   +4.485401473392542e-02   +8.804515128517902e-01   +2.614376615131284e-01   +2.102491326390813e-01   +8.125180433934129e-02; +1.116596068060493e-03   +1.495433324720892e-01   +7.409631069695813e-01   +2.869423754578930e-01   +8.462976929937106e-01   +6.334673555219150e-01   +4.633219142290425e-01   +5.065236702094609e-01; +1.445810246209503e-01   +8.042991026058545e-01   +7.524886828974947e-01   +4.868270046694538e-01   +4.426099457241550e-01   +8.900572150946100e-02   +5.970907216672108e-01   +1.949546377973384e-01; +2.470523721310050e-01   +3.811979971331931e-01   +2.305283894049031e-01   +8.874080920167337e-01   +5.434159252403009e-01   +7.507980278492958e-02   +5.513285199635800e-01   +1.461675969945543e-01];
L1I_L2I_iGABA_netcon = [+6.992703714227382e-01   +8.670078523131609e-01   +6.153245883631797e-01   +5.429258618373601e-02   +1.429735456148937e-01   +2.338191322427288e-01   +8.375804403489064e-01   +3.708817883885595e-01   +7.071141441435874e-01   +3.839919689786457e-01   +2.390311266167784e-01   +6.662080278793099e-01   +1.676424323788930e-01   +5.700661658510560e-01   +4.413003372059066e-02   +4.807288114922266e-02; +5.982526682763407e-01   +7.976599857530640e-01   +6.109877620613897e-01   +5.735833929780795e-02   +7.440562014075938e-01   +5.563467082433433e-01   +1.981340550927989e-01   +5.587064498234618e-01   +1.873121623848387e-01   +7.198167404710164e-01   +5.133169219308181e-01   +3.283933405005566e-01   +1.136799872743720e-01   +8.097888415654105e-01   +4.420207506669891e-01   +9.217585902956048e-01; +1.631488672582929e-01   +6.278902349018928e-01   +3.147600375727279e-01   +5.971788138682090e-01   +9.508872173840877e-01   +1.143998118480479e-01   +6.171225978690832e-01   +8.298607795760897e-01   +2.308763986981698e-01   +6.423024362149429e-01   +7.322585121157322e-01   +5.515370649806413e-01   +7.360846241577867e-01   +6.738739293646362e-01   +9.170349778736723e-01   +1.736585479605728e-01; +4.834419089937116e-01   +4.718853288978340e-01   +1.429527482967853e-01   +6.582715102104215e-01   +2.663547046320743e-01   +8.183440932003094e-01   +1.556878457364431e-01   +7.066490033114297e-01   +9.981939190955483e-01   +1.013043700622013e-01   +7.699735505805796e-01   +5.322825757858909e-01   +2.110804412010256e-01   +4.430334648152087e-01   +8.844411663453292e-01   +7.447514328562267e-01; +2.862420575001210e-01   +1.790884379585002e-02   +6.048230491561665e-01   +4.812336702963424e-01   +9.545738242561416e-02   +6.511786903069546e-01   +5.832551943336556e-01   +1.153352659606259e-01   +9.060345964880390e-01   +4.926378802688918e-01   +6.765739968591615e-01   +9.014216027308004e-01   +4.843563688770479e-01   +8.947457275913747e-01   +9.299856148835023e-02   +4.742496174900526e-01; +4.035257738226211e-01   +1.182667075787056e-01   +8.895538270029237e-01   +9.789729702236520e-01   +2.326175552414052e-01   +2.386281195907277e-01   +5.448344353267679e-01   +7.414043431261748e-01   +1.077578631217971e-02   +5.608132969873597e-01   +8.135074725920418e-01   +2.842390325551933e-01   +5.091806724322898e-02   +7.838777569378451e-01   +6.751794187574575e-01   +2.462152130544263e-01; +4.912740413720287e-01   +7.200833388934728e-01   +5.627899635052535e-01   +8.634145281101182e-01   +8.960987326338167e-01   +3.011131845032897e-01   +6.808532567132995e-01   +9.240823013996959e-01   +8.330436557812336e-01   +5.607655972796036e-02   +4.189272449211320e-01   +1.386643800445450e-01   +5.706947076649604e-01   +5.818149282101606e-01   +9.319710592323692e-03   +6.636127117321551e-01; +8.627686411864347e-01   +6.823817125165836e-01   +6.334951578352351e-01   +9.545759887388513e-01   +2.004850195420153e-01   +3.309728393715167e-01   +6.986283942075850e-01   +9.240045277311235e-01   +2.536539387146357e-01   +8.926598090334893e-02   +4.976246944906451e-01   +9.576203726499584e-01   +4.912179991660563e-01   +6.161572447561660e-01   +1.216825573409068e-01   +6.088165043322449e-01];
L2E_L1E_iAMPA_netcon = [+3.681350265147710e-01   +5.612312215205815e-01   +2.003865573829142e-01   +5.128031316157199e-01   +2.904215033326585e-01   +7.436234875386753e-02   +2.786002442284082e-01   +2.663032266907865e-01; +4.377937567637387e-01   +1.922568106804950e-01   +1.374339228926871e-01   +6.852823326853368e-01   +6.194860186796362e-01   +5.929825689360441e-01   +9.291338827400755e-01   +9.051820001319514e-01; +7.180170936168366e-01   +6.128595990848029e-01   +8.175521993221159e-02   +2.072141296463723e-01   +8.623076031241237e-01   +7.495918352271601e-02   +7.641209949800449e-01   +1.593502647857617e-01; +1.913886029652046e-01   +7.414224823820177e-01   +9.102226918481307e-02   +9.716180475876417e-01   +8.202027044338031e-01   +3.964871450085074e-01   +2.622286074530894e-01   +5.533700183794156e-01; +4.047555335008043e-02   +8.315986313168651e-01   +5.514245018804530e-01   +3.497962999248652e-01   +2.050755301780560e-01   +5.862090305978306e-02   +2.435428832954858e-01   +4.228371735504267e-01; +3.155506744760317e-01   +2.765133818428819e-01   +7.319662986680615e-01   +1.851307598249582e-01   +7.498959614750337e-01   +1.288114379251974e-01   +1.658172434265143e-01   +5.473948109890526e-01; +7.893877403692916e-01   +6.083123844061856e-01   +5.438813621342988e-01   +2.377811532946363e-01   +1.987431736539157e-01   +2.444763880970219e-01   +2.880603329990864e-01   +7.550827666778304e-01; +4.633138558943588e-02   +5.478683181968960e-01   +5.482533051129963e-02   +2.537933256215487e-01   +5.784610802834916e-01   +9.441503786000685e-01   +5.636801843065929e-01   +1.418711322647794e-02; +2.159187317898234e-01   +2.738880346350203e-01   +6.328909637077992e-01   +2.229068443756607e-01   +8.762964678512732e-01   +2.025392876212038e-01   +4.053400369418430e-01   -1.345376009276247e-03; +2.743278574868611e-01   +3.393639481578470e-01   +9.937342371992304e-01   +3.580183738580209e-02   +7.153161152776555e-01   +3.272362665989141e-01   +9.874160700004116e-01   +2.093773876656866e-02; +7.904748067046017e-01   +5.662696331699814e-01   +9.159436719476154e-01   +3.566212617575439e-01   +7.010617277541739e-01   +8.672147531261639e-01   +5.440551593773701e-01   +3.593319069231845e-01; +9.896978088285915e-01   +7.434655778081962e-01   +7.687943723948338e-01   +8.992437226381050e-01   +4.683158666487275e-01   +9.227199352325208e-01   +9.285631652955345e-01   +4.264115302219552e-01; +9.397889388398405e-02   +7.727413281261113e-01   +1.910597222161510e-01   +1.413084459249886e-01   +5.044711078873909e-01   +2.454082999280388e-02   +9.924255442094648e-01   +5.438687946795590e-01; +1.961255776945378e-01   +3.978778168119989e-01   +3.104583282835631e-02   +9.554160080183851e-01   +7.968257948281330e-01   +3.646195347010587e-01   +8.360401158400198e-01   +4.917822522732094e-01; +1.168009278460980e-01   +1.489187323289000e-01   +3.729890620351597e-01   +9.018458890641810e-01   +9.394827029707783e-01   +5.277106719880712e-01   +1.811768934683501e-01   +9.212851109074290e-01; +6.465804421134985e-01   +2.079070425482802e-01   +5.758989678898598e-01   +4.105620510071188e-01   +7.828830012594901e-01   +4.077989254412307e-01   +3.141561241367369e-01   +4.158060384601936e-01];
L1E_L2E_iAMPA_netcon = [+4.957890599794489e-01   +4.490513229264300e-01   +6.156751834604938e-01   +4.907097756442313e-01   +2.292562072259652e-01   +7.211046922422141e-01   +6.946234698224869e-01   +6.334257023876713e-01   +5.226427779034981e-01   +2.423647350162643e-01   +8.759778457974537e-01   +1.739449375011880e-01   +1.383927700283872e-01   +2.439831749121642e-01   +1.832103874070139e-01   +2.335064574574616e-02; +8.382615841109096e-01   +3.686722262031417e-01   +1.043669283714971e-01   +6.606622660122322e-01   +8.353032008755320e-01   +3.797851354596943e-01   +9.793982730831573e-01   +6.267860373210028e-01   +6.730851569558599e-01   +7.285511148366803e-01   +6.588257538324581e-01   +3.027090853536912e-01   +2.823672895861246e-01   +7.483454977410610e-01   +1.458539063745152e-01   +2.501721724678272e-01; +1.848017904838223e-01   +3.011671886262668e-01   +7.533018953481646e-01   +1.795132858075640e-01   +7.337364487995208e-01   +3.836827321581429e-01   +7.505389063054163e-01   +4.071410826829445e-01   +7.782952354556654e-01   +1.369259397256196e-01   +5.376575686950742e-01   +1.090885699890589e-01   +6.825919407107165e-03   +9.374088121690723e-01   +1.316916484896897e-01   +9.891986109023549e-01; +3.368427053659394e-01   +2.322359714827093e-01   +5.366526390215874e-01   +4.795425422136524e-01   +4.884053723890999e-01   +7.155734182438523e-01   +5.537899666993519e-01   +4.248336064290026e-01   +4.644940798170226e-01   +4.145957829668209e-02   +2.523257391145463e-01   +4.510240820419298e-01   +3.060705492621927e-01   +2.943710808444780e-02   +1.719352610438206e-01   +6.291610629559977e-01; +6.918376090430265e-01   +1.369668838876427e-01   +4.443458613432310e-01   +4.984828018541888e-01   +8.484140107289621e-01   +8.392480212419008e-01   +2.954371297434967e-02   +5.113248415268630e-01   +9.074619456316380e-01   +6.497351723843363e-01   +1.048739633378272e-01   +5.843709086504547e-01   +9.055562868985694e-01   +4.349192165457423e-01   +9.231005677712658e-01   +3.584802528222691e-01; +6.920736367508610e-01   +9.925056150434962e-02   +7.428040862528992e-01   +5.995979295177676e-01   +7.162137352773391e-01   +6.685506398393621e-01   +1.954332705864333e-01   +2.591169997208028e-01   +2.610938269019124e-02   +2.005025249951252e-01   +9.713226127835130e-01   +2.236712042228647e-01   +2.941025682474806e-01   +8.306699950072880e-01   +2.580517419175574e-01   +9.440225281524543e-02; +3.673463410830467e-01   +2.274151241983227e-01   +3.884727393103283e-01   +2.404552833042209e-01   +5.211540020930056e-01   +6.516596752386258e-01   +9.411451143851788e-01   +4.230439793089870e-01   +4.792316286595225e-01   +9.728028223158699e-01   +5.971360582496771e-01   +1.107593814296408e-01   +8.328732965864484e-01   +9.993480214250635e-01   +2.053399885818626e-01   +4.096621645766939e-01; +3.479429497142231e-02   +3.455470290597423e-01   +5.267786930663174e-01   +5.163551278218920e-01   +9.376317221644993e-01   +5.635516773415672e-01   +3.979827049050166e-01   +5.239205160263294e-01   +2.717875926956439e-01   +8.203564102107366e-01   +8.195366453760921e-01   +5.598826491841397e-01   +7.454439203130545e-01   +9.206553033965622e-01   +6.126221969434124e-01   +9.307703031687377e-01];
L2I_L2E_iAMPA_netcon = [+6.784150680426072e-01   +6.141666076355029e-01   +4.133311679198434e-02   +7.932405407861953e-01   +5.252638274517795e-01   +8.261043375363644e-01   +6.441110199614640e-01   +3.864244078273483e-01; +2.300997929952295e-02   +9.453065052336972e-01   +5.460505874258265e-02   +9.294676090602969e-01   +5.440519374175459e-02   +1.084558095093670e-01   +3.924510052056671e-02   +1.676885495111959e-01; +7.330679310669201e-01   +9.637938604137042e-01   +4.014930993973793e-01   +9.364790846056242e-01   +2.865630289642129e-01   +2.369665590941653e-02   +5.678649008540901e-01   +4.436839587830569e-01; +2.132421568763018e-01   +3.677214281714852e-01   +9.838019097418645e-01   +1.467779997490399e-01   +7.107764369849461e-01   +1.225180734047836e-02   +3.045165017038506e-01   +8.729250242490409e-01; +8.598417904537903e-01   +7.956669372490609e-01   +7.118947062672981e-01   +3.194590059544580e-01   +8.791612102838339e-01   +3.361383321598806e-01   +2.614811697917681e-01   +4.114456004251678e-01; +1.568182383508472e-01   +7.280078416644584e-01   +9.880400737296610e-01   +4.272668936628553e-01   +3.658496533005278e-01   +6.630952328234270e-01   +7.214972804948571e-01   +1.632548891215814e-01; +6.684866657586034e-01   +9.538732542168097e-01   +6.455055599950593e-01   +7.009134348928150e-01   +5.615106181566829e-01   +5.955789533709753e-01   +3.048742445630925e-01   +6.629654996265951e-01; +9.355823301903511e-01   +1.206529297904847e-02   +5.028765073872973e-01   +6.152313433708055e-01   +8.835588127387696e-01   +8.128951441696609e-02   +8.945436418667170e-01   +9.255257189273751e-01];
L2E_L2I_iGABA_netcon = [+6.087549399732755e-02   +5.185743159544829e-01   +3.529306134002276e-01   +2.615442828968569e-01   +4.334842070541949e-02   +8.904091244832226e-01   +3.448974904521506e-01   +4.514641736149840e-01; +3.542117509026451e-01   +6.939274320475075e-02   +5.565471998190701e-01   +9.844622092934077e-01   +3.602856537664021e-01   +5.411855127500697e-01   +9.351188914028132e-01   +6.718544048473745e-01; +9.313959327976751e-01   +1.837022801470821e-01   +6.920680573450957e-01   +3.491744268199142e-01   +3.551883087624703e-02   +7.177869643976584e-01   +9.181117540699597e-01   +7.682670929207541e-01; +2.425879758635205e-01   +3.171690797869077e-01   -6.038170928848711e-03   +4.033012457884355e-01   +4.862327311406495e-01   +7.117458629026269e-01   +7.249346073174671e-01   +9.269421406488975e-01; +1.031113337589490e-01   +2.436093343628159e-01   +4.745221077940693e-02   +7.514379702122806e-01   +7.230867656922561e-01   +1.691020042910991e-01   +4.426657197177636e-01   +6.586244016385505e-01; +7.163191425410930e-01   +3.218168253114454e-01   +3.078776134220909e-01   +1.013449794473331e-01   +1.433225379443718e-02   +3.528532487142593e-01   +1.508688112617640e-01   +5.024916275372542e-01; +5.096371563106687e-03   +8.789177378586435e-01   +8.687530474156606e-01   +5.903741061193172e-01   +5.172515943299797e-01   +3.785199226354621e-01   +8.314608205520568e-01   +3.421147653926850e-01; +1.862398554544711e-01   +3.011190703609244e-01   +6.277928965124352e-01   +1.239202155666972e-01   +2.397026043962558e-01   +7.576543555190400e-01   +2.571076236272339e-01   +9.451462752560844e-01];
L3E_L2E_iAMPA_netcon = [+7.964840254110631e-02   +1.422399873491745e-02   +3.688758299293177e-01   +4.962912673161381e-01   +1.672894685511093e-02   +9.553826728388116e-01   +3.601241456768637e-01   +1.326329667167440e-02   +2.037010630546905e-01   +6.228066738257796e-02   +2.437977186707815e-01   +9.977528311422900e-01; +9.522245381924338e-01   +9.771063706595207e-01   +1.162899893101805e-01   +6.580824182898559e-02   +8.065272653623465e-01   +3.882460146790300e-01   +2.246219912763515e-01   +1.200698682168446e-01   +3.559767768405314e-01   +7.409041793641915e-01   +5.343793792826950e-01   +3.436030787588201e-01; +6.622596108065171e-01   +7.245548734779100e-01   +5.137974224066602e-01   +8.620559085727499e-01   +7.910808662065626e-01   +6.651218584631405e-01   +7.248980702974419e-01   +6.688952092709384e-01   +8.880551151538653e-01   +9.899213802595929e-01   +3.332335464308338e-01   +8.219530080501882e-01; +1.683349772014238e-01   +8.728493444457657e-01   +6.649091930300208e-03   +9.971891162887845e-01   +4.235102328690387e-01   +5.859503051460599e-01   +7.716633089061422e-01   +5.081143339934615e-01   +8.074721182230947e-01   +7.668764605540339e-01   +6.739728953479358e-01   +1.082611243669907e-01; +1.966552670430551e-01   +8.147246305669293e-01   +8.687699358515429e-01   +1.223431522457706e-01   +6.306154751058465e-01   +5.867793290268406e-02   +3.416294464524526e-01   +6.946228047725060e-02   +3.199721161102856e-01   +8.817001794343428e-01   +8.752470237396108e-01   +7.731072571024722e-01; +9.950738328624843e-01   +3.008145622102422e-02   +9.040109953884541e-01   +9.956057385167108e-02   +5.684460261227027e-01   +7.585939406542025e-02   +5.764011009680630e-01   +5.353462069233887e-01   +6.004918576426328e-01   +3.669112483784129e-02   +9.822961593231856e-01   +1.506212488035536e-01; +9.252689661171627e-01   +9.605935987673724e-02   +1.122704187944709e-01   +1.496365896003119e-01   +8.966080260814024e-01   +2.278950282408206e-01   +6.435408037705506e-01   +6.783602221969316e-01   +6.982256945885921e-01   +7.945567331057305e-01   +1.450917283485010e-01   +7.315373703212862e-01; +9.819795961514182e-01   +8.591968827763624e-02   +4.464191655934331e-02   +1.284794723529708e-01   +7.487467920428524e-01   +4.207286743594682e-01   +3.658831784967702e-01   +5.879262323368063e-01   +1.773490975479299e-01   +7.067574809775656e-01   +8.761296351390933e-01   +1.088022155422098e-01];
L3I_L2I_iGABA_netcon = [+7.685411094265341e-01   +5.343741326602645e-01   +5.963766424708883e-01   +3.039144772620755e-01   +9.648170902613711e-01   +1.143480893058390e-01   +2.969709583978813e-01   +7.955041033919173e-01   +9.138944753282581e-01   +9.959276324192236e-01   +3.098724735183198e-01   +9.964341527754869e-01; +6.365133003119214e-01   +4.537699097739775e-01   +5.633543043600451e-01   +7.631657709553773e-01   +5.434411406794933e-01   +7.023760563825884e-02   +1.678025841322161e-01   +5.230010132901265e-02   +3.862263902946762e-01   +2.878195405889995e-01   +4.426245175811200e-01   +9.147989861767779e-01; +7.956362153528640e-01   +1.142844502218812e-01   +6.833955876126509e-02   +6.480045865111879e-01   +9.814293803952465e-01   +4.980610782691335e-02   +7.243378378199971e-01   +1.817864411134335e-01   +7.516474154632701e-01   +5.154688693627281e-01   +2.095263104703293e-01   +6.915197526196221e-01; +9.587199496146027e-01   +7.207705490872701e-01   +7.677973334759197e-01   +3.317980297333945e-01   +1.247300782941920e-01   +1.301517038755079e-01   +2.986811958434080e-01   +2.457313549892402e-01   +8.775450507440977e-01   +3.579808565739653e-01   +9.411701106337367e-01   +2.204499458129238e-01; +7.170888766154750e-01   +1.847600844778615e-01   +8.675127253036886e-01   +9.710404167938784e-01   +1.686411292060254e-01   +4.912553332219299e-01   +6.781822054387173e-01   +2.620364644445619e-01   +3.926056401132493e-01   +5.169344108940925e-01   +2.897498098824343e-01   +3.143133464175656e-01; +6.431491462463489e-01   +3.251890007721236e-01   +7.093312602961841e-01   +5.320802049107499e-01   +3.346362289446814e-01   +4.685714765435454e-01   +7.464172208754086e-01   +6.473633615551979e-01   +1.671602046742985e-01   +5.001652408864883e-01   +1.228327497531888e-01   +2.366929854354321e-01; +5.121106296230449e-01   +9.675215245173729e-01   +1.082303652727188e-01   +7.515816195346298e-01   +5.307298350999297e-01   +1.581143874273938e-01   +7.452313832811384e-01   +9.793019350929352e-02   +4.376193012204946e-01   +1.889632440333062e-01   +7.023816339632502e-02   +7.092483523672036e-01; +9.518136304998727e-01   +7.012112764179668e-01   +6.660458000200679e-01   +2.708576617533593e-01   +6.931973243991265e-01   +1.389705759597613e-01   +7.844566634426496e-01   +4.696210866380053e-01   +8.581427700547114e-01   +4.777786683352258e-01   +7.290615716914448e-01   +3.751245174460045e-01];
L2E_L3E_iAMPA_netcon = [+6.566835708557009e-01   +3.867892523178885e-01   +2.352288373551850e-01   +4.636205460707125e-01   +9.052970361812047e-01   +9.497229376667691e-01   +7.623957902533016e-01   +3.545819951590152e-01; +3.841740056562917e-01   +2.264773938376329e-02   +9.040158291827561e-01   +2.828603907861652e-01   +6.799492027327981e-01   +2.661734932404603e-02   +9.029815870462017e-01   +6.634884719595968e-01; +3.075271650045378e-01   +3.306906903260852e-01   +4.869808721399816e-01   +2.767390142102950e-01   +8.418654123391822e-01   +5.011215406505259e-01   +7.961176418693451e-01   +5.919196811954226e-01; +1.570681781650315e-01   +4.841908486898860e-01   +5.958986331387244e-01   +1.423425624551178e-01   +9.440928791191887e-02   +3.390080975666595e-01   +9.559700753358392e-01   +5.451902479688426e-02; +7.782039278353756e-01   +2.616281304901079e-01   +9.546854621074076e-01   +1.395523789013051e-01   +7.346848277347647e-01   +6.718966272236022e-01   +5.346085110967032e-01   +2.160615913900750e-01; +7.093173352460289e-01   +5.270295910894522e-01   +8.520777690311576e-02   +2.650584379462357e-01   +5.427131278234928e-01   +1.680591489721815e-01   +1.644297018305686e-01   +6.025625351344149e-01; +1.731953579575480e-01   +4.167866154805648e-01   +2.225721120250967e-01   +6.103273774877007e-01   +2.559505023221808e-01   +2.271207931232005e-01   +1.355531234843264e-01   +2.687655415258369e-01; +4.478924848801649e-01   -5.116081378155272e-03   +1.505363795249168e-01   +1.063000668055067e-01   +7.149163684251697e-01   +1.180555472775019e-01   +3.359827087765551e-02   +1.097705605140803e-01; +8.381663909692290e-01   +8.935318730395553e-01   +3.894105992098182e-01   +4.848181716611747e-01   +3.601520173991199e-01   +9.925358019327246e-01   +6.812836756420116e-01   +2.120945104322872e-01; +6.968203519559818e-01   +2.390993323082483e-01   +1.846809097493880e-01   +8.927466279065142e-01   +8.548471340465553e-01   +1.393957959271199e-01   +5.875516347666854e-01   +8.735102937518983e-01; +7.645969727549345e-01   +7.935430878993145e-01   +7.626068331019202e-01   +1.880997325115234e-01   +8.195347230057334e-01   +7.688771271848451e-01   +2.986523591985005e-01   +4.586175322281038e-01; +9.797998125150433e-01   +5.787654433294881e-01   +2.288932437712164e-01   +5.239828223177492e-02   +6.103385334908064e-01   +6.347449453991952e-01   +7.315210593407832e-02   +7.271244168627585e-01];
L2I_L3I_iGABA_netcon = [+5.891256145955632e-01   +1.473202994987260e-01   +3.441473747651444e-01   +3.695343027595963e-01   +5.985844224161960e-01   +5.069331820674526e-01   +7.731099808580609e-01   +2.648501854195086e-01; +8.453472075396642e-01   +9.900229348574113e-01   +4.615045727243936e-02   +5.374037382359365e-01   +4.786829683890682e-01   +2.368053652218471e-01   +1.794614173495902e-01   +5.856917767935738e-01; +6.043594123414986e-01   +4.809031307203078e-01   +9.426113118058935e-01   +9.747500437140729e-01   +3.769886536956902e-01   +2.720853630232600e-01   +4.549416064292845e-01   +6.794745605614618e-01; +7.442439769969593e-01   +3.552455201837574e-02   +8.675210865490155e-01   +9.975116475510272e-01   +9.786329830232958e-01   +4.061880862988668e-01   +3.057368129020663e-01   +4.146532480893491e-01; +8.490583638146226e-01   +2.694158194073445e-01   +1.335810718723731e-01   +4.153592700610734e-01   +1.389521829135251e-01   +2.605070591615482e-01   +3.878240331372260e-01   +5.119450933592357e-01; +1.459085784627664e-01   +6.761622124953419e-01   +5.909139669453638e-01   +4.506535143024831e-01   +2.709878391460841e-01   +8.543792673731329e-01   +8.033541015143475e-01   +8.143097595198502e-01; +7.412780821742329e-01   +1.472038462550959e-01   +6.263586133199033e-02   +2.542214774928448e-01   +2.260293254822597e-01   +4.798411630708660e-01   +7.782489673597458e-01   +5.451812959380256e-01; +1.786518246447485e-02   +7.748952950182985e-01   +9.467112773839002e-01   +6.020867415957907e-01   +7.913012487627331e-01   +3.407748946695375e-01   +6.444802117693439e-01   +5.892720946658780e-01; +2.285861430072953e-01   +2.671462412023500e-01   +4.962238162433457e-01   +7.870783716804458e-02   +8.176955786805510e-01   +6.399187137676861e-01   +2.417537235177021e-01   +5.349794032960851e-01; +5.371996071725392e-01   +8.811262047826154e-01   +2.714740913117166e-02   +9.114893938936534e-01   +7.920604851024423e-01   +4.155761648061432e-01   +6.094375594321931e-01   +5.427352766063708e-01; +7.204168939124145e-01   +3.684558329822164e-01   +5.750646685616419e-02   +4.727726217894199e-01   +1.132538299870841e-01   +5.435300529912583e-01   +4.201520213423408e-01   +1.517861925595849e-01; +4.328413402280627e-01   +1.043627609512689e-02   +2.995479455148112e-01   +5.079079952704282e-01   +6.331909979666460e-01   +3.389505438512004e-01   +2.937422923335692e-01   +7.020854826476158e-01];
L3I_L3E_iAMPA_netcon = [+6.502034372627083e-02   +7.740638477511945e-01   +5.557144738492675e-01   +5.741912210898192e-01   +9.199021689658997e-01   +8.353439941428402e-01   +8.490410797221596e-01   +8.624649122363139e-01   +5.347081815655061e-01   +9.890856312392359e-01   +4.815074182533105e-01   +3.514018956437103e-01; +9.227045120598117e-01   +8.396325122781794e-01   +8.437171548985856e-01   +9.348583733022940e-01   +5.921138869648582e-01   +3.925163798276621e-01   +6.284215610043693e-01   +8.556660272665207e-01   +5.661191590471630e-01   +7.009672280056716e-01   +7.390811186203444e-01   +3.999240188447277e-01; +1.800818426826240e-01   +5.925726412344332e-01   +9.695374226535464e-01   +7.793406580947291e-01   +5.747737615032917e-01   +6.981744765288689e-02   +4.443247597648379e-01   +9.489343861226703e-01   +9.811509261557602e-01   +8.436322782944017e-01   +5.947946232149035e-01   +9.874412246972781e-01; +5.441603848900044e-01   +7.682196305730330e-01   +4.663312256397226e-01   +5.982516301643508e-01   +6.591851488360803e-01   +3.729649632191506e-01   +2.339180130529103e-01   +6.941208732247437e-01   +9.676421394029664e-01   +7.378738144560854e-01   +2.636233940841406e-01   +2.964247330267572e-01; +3.962770755355139e-01   +6.583699549061707e-01   +7.762030312937482e-01   +5.873434965248998e-02   +4.347969688845295e-01   +8.500827566320153e-01   +5.073989916282925e-02   +3.629485818999444e-01   +5.602770363630649e-01   +9.955331096526643e-01   +6.081215069025666e-01   +2.239097808466321e-01; +9.226705411451198e-03   +5.883842016032522e-01   +2.109371941933192e-02   +5.439204067985621e-01   +9.360493404476402e-01   +2.501109046796166e-02   +7.138507477195999e-01   +3.738560834763104e-01   +5.327575209864381e-01   +5.075098517859005e-01   +2.321878685355542e-01   +3.310305474096022e-01; +1.022920957627301e-01   +2.692556959406708e-02   +6.774234520910768e-01   +8.646884943967111e-01   +1.016867022577738e-01   +4.227094540990038e-01   +8.479909362303616e-01   +8.422981940672214e-01   +4.789531939792468e-01   +1.903291386989593e-01   +1.955378953261424e-01   +1.656971295059744e-01; +8.561752985542964e-01   +6.933248455103671e-01   +8.349678068204019e-01   +3.382552755909872e-01   +4.095617462723669e-01   +2.554311644295418e-01   +4.043214277515700e-01   +3.830529994871860e-01   +9.000641975903854e-01   +9.591553851446616e-01   +2.356214329733319e-03   +3.841423614453856e-01; +3.388496752010826e-01   +3.274869941674262e-01   +6.842810796540761e-01   +1.783994367770613e-01   +8.921930224218823e-01   +7.413809218539608e-02   +2.869609813583997e-01   +7.687679194944652e-01   +4.814171617353440e-01   +4.533914142605699e-01   +6.467230906828070e-01   +5.263081750438097e-01; +1.501095313164197e-01   +7.587536837648347e-02   +8.964320724065982e-01   +8.811148087235980e-01   +7.389023542226210e-01   +9.209496270466982e-01   +2.623759160084921e-01   +7.730260071219355e-01   +4.879989333041574e-01   +6.056076927710583e-01   +3.995759494281487e-01   +5.941786140592156e-01; +8.073575792471809e-01   +7.434962073003187e-01   +9.527725090275993e-02   +8.417241168456486e-01   +9.579240779066923e-01   +2.673112273338093e-01   +5.052937589160366e-01   +4.345228891638051e-01   +3.144212922750094e-01   +6.428734813689956e-01   +2.711172660112641e-01   +1.706795754742854e-01; +6.554467577150858e-01   +9.645867068697801e-01   +7.140100523329722e-02   +8.332284880890212e-01   +9.702470800643993e-01   +1.001952435295449e-01   +1.163583657176996e-01   +4.887106286778460e-01   +8.587517972926069e-01   +7.673776787300520e-01   +3.885672041374767e-03   +7.340129424856971e-02];
L3E_L3I_iGABA_netcon = [+4.380435144452749e-01   +7.198798017205303e-02   +4.110161498100970e-03   +4.944845724600886e-01   +5.440804365790296e-01   +2.514805913417044e-01   +7.177253932602066e-01   +7.604172739213156e-01   +3.781795066745416e-01   +4.491524219248477e-01   +2.004786518175913e-01   +6.494810224939940e-01; +5.855903878846110e-02   +8.074084053060928e-01   +1.320082857899779e-01   +1.944527512342214e-01   +2.116401333675997e-01   +3.348805916795772e-01   +2.228331147748981e-01   +8.887454017299664e-01   +6.110893051110481e-01   +3.946790381607948e-01   +8.280850076762242e-01   +8.984916969606378e-01; +6.256362672030118e-01   +9.097513440216641e-01   +3.086934096935357e-01   +6.419376539205025e-01   +2.695620695808327e-01   +5.910095319914124e-01   +4.983094957831883e-01   +7.306943306437435e-01   +1.684388304245246e-01   +6.685316000385160e-01   +4.464253081635463e-01   +8.387246241359138e-01; +7.981327649741945e-01   +4.249350702459269e-01   +2.387522891959923e-01   +2.547491586449433e-01   +1.322445242965991e-01   +4.821600723795716e-01   +4.747077007123967e-01   +6.970892994963277e-01   +1.048641664245862e-01   +3.343793567783571e-02   +4.261128155160225e-02   +1.700769527194309e-01; +4.006881421671982e-01   +1.841048922969883e-01   +6.494459616114985e-01   +9.480191024820959e-01   +1.716504734294073e-02   +8.969723226009610e-01   +4.314595018503520e-01   +6.473407413047503e-01   +6.259671698795500e-01   +7.864463406863393e-01   +7.692770079173287e-01   +1.610164433085699e-01; +8.847741933293259e-01   +1.837604329495031e-01   +8.085565696788877e-01   +2.886829586316280e-01   +1.584735198491717e-02   +2.955191892780877e-01   +5.568843129366301e-01   +6.212351606274759e-01   +9.526769158065196e-01   +3.781814439258944e-01   +9.900924931411659e-02   +1.350982598661700e-01; +7.229196494559422e-01   +6.725038718623921e-01   +7.396273064822825e-01   +1.496096790469341e-01   +9.790032818634811e-01   +7.871137782227987e-02   +2.063113861854531e-01   +7.798691963948366e-02   +6.649461356184588e-01   +6.512748811625346e-01   +6.525101598610992e-01   +1.590064385472054e-01; +1.976121666363448e-01   +5.245690990952327e-01   +1.235332153819202e-01   +8.697837776506375e-01   +6.466573329913383e-01   +3.923984046616920e-01   +2.776513880024140e-01   +5.479671903572956e-01   +4.729757413547633e-01   +4.977088628461622e-01   +2.700243241786212e-01   +3.942566465699764e-01; +3.739109162696110e-01   +7.769572572698723e-01   +1.733141514802463e-01   +8.868621029290061e-01   +8.154795930358998e-01   +1.981796722176523e-01   +8.124103271863991e-01   +8.840500498376028e-01   +3.412690448596475e-01   +2.131717722810737e-01   +4.363460123345140e-01   +6.673833263140316e-01; +2.111463558663997e-01   +2.989377461337986e-01   +2.743192531322033e-01   +6.680707504862343e-01   +2.761146899054151e-01   +7.226708238605600e-01   +9.523902477376714e-02   +9.867057587991701e-01   +5.903380689962325e-01   +2.168390052561447e-01   +8.484460371435901e-01   +2.219804287133587e-01; +2.595085586382886e-01   +4.734300563128880e-01   +8.144985210552507e-01   +9.972035275981650e-01   +1.551281056348415e-02   +4.213494135649804e-01   +3.362408975358621e-02   +7.178798080827603e-02   +5.458574045835537e-01   +4.523714687839399e-01   +9.022636142862314e-01   +6.440224789545272e-01; +9.921871014420923e-01   +7.067370520157984e-01   +5.921874044982322e-01   +2.683623227485331e-01   +1.016668505407461e-01   +2.680006938597987e-01   +6.422370239549399e-02   +3.260009618260585e-02   +3.905057323933384e-02   +6.287972990346193e-01   +2.854594405737523e-01   +6.112665104922315e-01];
L2E_Input1_iAMPA_netcon = [+9.909664886681268e-01   +9.888539862865628e-01   +1.000000000000000e+00   +9.865542726508021e-01   +9.849548332057168e-01   +9.984020318385730e-01   +9.818921146006298e-01   +9.961781374937542e-01];
L2I_Input2_iAMPA_netcon = [+9.927311893144330e-01   +9.991864284713097e-01   +9.845673717550542e-01   +9.939174089738683e-01   +9.889048434549101e-01   +9.903985904212348e-01   +9.944140062232660e-01   +9.957278402343215e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
