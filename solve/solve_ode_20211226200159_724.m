function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.333971829674935e-01   +8.467182247794583e-02   +2.732847649279179e-01   +2.794851704674034e-01   +5.383876174017033e-02   +2.284109240975998e-02   -2.566959686457966e-01   -4.518440546452842e-01   -3.344344984475907e-01   +5.116348792493305e-02   -2.175787779162009e-01   +1.327602940456660e-01   +4.273487454212087e-01   -2.688317076953575e-01   +1.538909756852982e-02   +6.343394002381915e-01; +1.708619114126159e-01   +4.435304167778714e-02   +1.412688959501230e-01   -5.506408083865949e-02   +1.027020817157554e-02   -4.113936619254034e-01   -2.112949434681718e-01   +3.186162674618426e-02   -2.087053552179693e-01   +1.449624953780841e-01   +1.182102345610775e-01   +1.181735339212077e-01   +1.052253169946928e-01   +1.043175602021882e-01   +2.776662896942880e-01   +2.714000980412449e-01; -2.939630482895748e-02   +9.047457405587248e-02   +4.859068699274233e-02   -1.895046778406334e-01   +2.398843270915782e-01   -1.032565583104232e-01   +1.130074154484903e-01   +5.956456857245238e-01   +4.086341134439883e-01   -2.477940551450518e-01   -1.494869198330306e-01   -1.404671982287897e-01   +1.548452206963501e-01   +2.960494704916709e-01   -1.472399019951511e-01   +3.824600091693112e-01; +7.255703542909761e-02   -1.357220383404351e-01   -1.749405129740180e-01   +1.933719808404144e-01   +2.935544121025228e-01   -4.152237881766650e-01   -6.981706018433723e-02   -6.601258404903330e-02   +4.443050909951009e-01   +2.278279746043744e-01   +3.326235181733319e-01   +1.213820461358117e-02   -1.987087300577648e-01   -3.352373168504178e-01   +1.927632660509880e-01   +1.690111176416093e-02; -3.740845849159471e-01   +2.991000377528065e-01   +2.675084385876865e-01   +1.678894484667205e-01   -4.671017565330495e-01   +2.525008636673561e-01   -4.782396681753777e-01   +5.902834234185753e-01   +4.177886899088139e-02   +2.441888302224108e-01   +2.838541156366927e-01   -2.029061723483112e-01   +1.688546456021383e-01   +1.726059787399699e-01   -2.859196745073072e-01   -6.714300227495004e-02; -5.908127520693379e-02   -5.523425007366441e-01   +1.304542222705902e-01   -2.842284070335043e-01   +5.727728690303527e-02   +3.162623186999895e-01   +1.829410719352629e-01   +3.470479152119903e-01   -3.756343034944579e-01   -3.481864550755854e-01   -4.936038598379101e-01   -1.905319836230267e-01   -4.984706981489022e-01   -1.263589319081582e-01   +3.986569708632798e-02   -2.247529993353864e-02; -7.236368654660021e-02   +9.323478395658541e-02   -8.482216961577307e-02   -3.827885970976207e-01   -5.335084465608075e-01   +7.892687683779077e-02   +4.364390356445484e-01   +1.342575811389381e-01   +3.967548625366091e-02   -1.103791135512883e-01   +7.905844446949697e-02   +3.952273262831985e-03   +2.367272449907503e-01   -2.581358261117903e-01   -1.349745982061881e-01   -5.875052655776189e-02; +1.551757358469775e-01   -4.116087933995256e-01   -1.011987384621066e-01   -3.604128344291996e-01   +6.102357347561363e-02   -1.406320951216517e-01   -4.211901145640112e-02   +1.362352438243717e-01   -2.489513388730610e-01   -6.739281444095599e-02   -1.491388447913080e-01   +1.718963587652330e-01   +1.774505194296850e-01   -4.573128787971922e-02   +8.815572652869297e-02   +4.471222091336322e-01; +3.676284418443794e-01   +3.487798537422069e-01   +4.842155912840176e-02   -1.230567102796087e-02   +8.374667424241256e-02   +2.544363213036502e-01   +1.352446141835555e-01   +1.383820147915270e-01   +4.585652377204413e-02   +2.265086465542285e-02   -1.047459434894064e-01   -2.566809673752609e-01   -9.026093456488832e-02   +2.141130433710473e-01   -3.904906622888972e-02   -4.313646940583702e-01; +9.397824212081773e-02   +1.141630791061346e-02   -1.539578307001636e-01   -4.006480854631687e-02   +4.735919994116664e-02   +2.007144170400625e-01   +3.842009646191102e-01   +1.752558371824381e-01   -1.743451472618849e-01   +1.362314986188367e-01   +5.717763000615708e-01   +1.220694976773052e-01   +3.308197551541290e-01   -1.983750401642574e-01   +3.453828497128789e-02   -4.628808207773141e-02; -1.419844238820901e-01   -3.249395562537619e-01   -4.058398174771725e-01   -5.379728422811197e-01   +5.140641235154644e-02   +3.500472920226413e-01   +2.631722003914899e-01   +1.642536251954443e-01   +1.999585039897166e-01   -1.748012462264843e-01   +1.109954134529084e-02   -2.974551045718279e-01   +1.607238487722394e-01   +1.036701288501239e-01   +4.006177508823118e-01   +5.174167539279390e-02; -5.596595728897651e-01   +2.069751285805779e-01   -2.832939393997669e-01   +5.300112810649921e-02   -1.831749554981003e-01   +5.786138159680682e-01   +2.419561727485522e-01   -2.433356751446777e-03   -9.169725701053894e-02   -3.189067913286120e-01   -1.020252216100412e-01   +3.072733360898868e-01   +2.288399259909965e-02   -4.060717651490410e-01   +3.532701073516258e-01   +5.021141729935462e-01; +1.522718621849464e-01   +2.149034696456513e-01   -1.376046674662563e-01   +2.208833239498577e-01   -3.780076908983945e-01   +1.193459841506935e-01   +2.902879655271430e-01   +1.735142627793579e-01   -8.893293592618659e-02   +4.261733838432041e-01   -5.486042073217773e-01   -1.791987588323323e-01   -1.831996884453719e-01   -2.318813816882045e-01   -4.264750451105546e-01   -1.748887868397978e-01; +6.618667913885005e-01   -7.785575977885771e-02   -3.551110773516897e-02   +1.300126533043636e-01   -2.115912047377076e-01   -2.828422867551557e-01   +3.734942457975268e-01   -3.454506739517673e-01   +3.913051834236043e-01   -6.527298852608654e-02   -3.674200813802610e-01   +2.959421042194565e-02   +2.826992789353280e-01   +6.493962111510912e-02   -4.897929161321884e-02   -1.378084183799962e-01; -2.600826532409161e-01   -1.954447937136792e-01   -3.937563977574824e-01   -2.593282797781558e-01   -1.628352642760374e-01   +3.667608259287768e-01   -3.403093690095003e-01   +2.388375057660491e-01   +2.023546150368958e-01   +1.012233705983900e-01   -1.642517557272548e-01   -4.179685406466360e-02   +6.521194999639632e-01   -7.547810790523785e-02   +3.804789208817475e-02   -2.050792679077960e-01; -2.277229983549486e-01   -6.430554043233652e-02   +5.656459333116690e-02   +4.321967559911527e-02   -2.081873780301182e-01   -5.958460832952389e-02   -3.113763972486738e-02   -2.537533468082261e-01   +5.103390913830688e-01   +8.679655527244448e-02   +2.061408887591955e-01   +2.676166273865680e-01   -1.940337705329860e-01   +1.901726620452992e-01   -9.149026928183562e-02   +1.316384365936715e-03];
L1E_L1I_iGABA_netcon = [+2.120424409930010e-01   -1.621723358374544e-01   +1.225022777168090e-01   +3.780932786183258e-01   +5.768876579405968e-02   -1.928404954584086e-01   -5.385332631150967e-01   +1.058365489194321e-01   +5.067407036322515e-01   -2.641342724503329e-01   -8.123923756739446e-02   +2.583807291476154e-01   +1.772810931396714e-01   +4.387826789971995e-01   -3.873409661313856e-01   -1.016648042648333e-01; -2.460160851735393e-01   +9.161871170958939e-02   +1.105929796989845e-01   -4.439484466552446e-01   +4.461796457836419e-02   +2.836590784666970e-01   +2.780731893217863e-02   +2.901066113382104e-01   +1.607364486306587e-01   -2.336029179253155e-02   +9.670014829820953e-02   +5.986995855071157e-01   -3.308863306232643e-01   +9.535725462842756e-02   +3.667672067733491e-01   +1.676415676488164e-01; +2.294869957055016e-01   +3.816337698028807e-01   +1.520925912348279e-01   -3.619884366408042e-01   +6.603458463524342e-02   +1.165724631442620e-01   -5.447832054279374e-02   -1.131811851837980e-02   -1.086235140914539e-01   +2.544115330895370e-01   -3.666785162597276e-02   +2.977043568212192e-01   +2.059396820116293e-01   -2.002862622394651e-01   -1.120272406694149e-01   +2.221701921564145e-01; -1.757566415765598e-01   +2.980717461083334e-01   -3.059226381099120e-01   +4.336231073015862e-01   -6.578785535146039e-02   +3.751653112792792e-01   -2.679797470678607e-01   +2.839553434178717e-01   -3.259498344413946e-01   -4.655074898140528e-01   -4.858429267955872e-01   -1.821008922564676e-01   +5.451757130715815e-02   -3.240270981589733e-01   +1.968236374375839e-01   +2.021486453753654e-01; +3.878207058575934e-01   +5.528571914447844e-02   +2.426440192630471e-01   -3.502930428406958e-02   +2.993233630348907e-01   +4.190476323619444e-01   -2.151435216159324e-01   +5.977888154360745e-01   +4.256830253463895e-01   +9.209904120682426e-02   -1.587295216801411e-01   +2.565731974270783e-01   -2.220009304175041e-03   +2.555485830346925e-01   -3.509167406429409e-02   +4.180525506228145e-01; -5.714623578059777e-02   +1.801286896673402e-01   +4.904220604073836e-01   +8.758055051023808e-02   -8.125006215046712e-02   +1.971180230084988e-01   +3.649676055533454e-01   -7.881019035075887e-02   +2.052758270009672e-01   +3.867321131125614e-01   +4.103818506830688e-01   +2.237128360513417e-01   -3.410659492983140e-01   +8.285321053615757e-02   -3.281838805852725e-01   -4.340213455110199e-01; +2.298432089436428e-01   -4.808681750535511e-01   +4.076145043641622e-01   +4.403901494943580e-01   -2.959392855513742e-01   +2.392838061938786e-01   +1.894822935676778e-01   +1.111438071839083e-01   -2.523471701706345e-01   -4.015161616723026e-01   -2.855689199336846e-01   -1.009560715455498e-01   +4.903149712259358e-01   -2.855895975429554e-01   -4.437937473729047e-01   +3.680043004024934e-03; +5.376133024374147e-01   +3.237383534361227e-01   +5.879795667748624e-01   +2.217396034642520e-01   +2.504549243513215e-02   -2.650943008022479e-01   +2.631448973993638e-01   -1.968815559791724e-01   +1.615877655223660e-01   +7.869464304213342e-02   -1.345254562146075e-01   +5.345945384295617e-02   +2.395356318607220e-01   +5.147853579243138e-01   -1.783694984964593e-02   +3.370840252158506e-01; +2.500470762230358e-01   +1.182752193192791e-01   -2.005935092834073e-01   -1.973137978961438e-01   +3.155488922244400e-01   +2.268717258595863e-01   +4.115875805078142e-01   -4.548736194630064e-01   -7.121110488072582e-02   +1.021571289132215e-01   -3.162754075936304e-01   +2.603587951111486e-01   +3.710136951456247e-02   +2.897894392613393e-01   +4.747113177443814e-01   +3.115488893293562e-01; +4.847720374396788e-01   -1.458745838785838e-01   +1.872136315301599e-01   +1.183417636167380e-01   +4.606653737358433e-01   +6.250209676961055e-02   -9.438106876249797e-03   +1.018582406333050e-01   +2.524649824956542e-01   +2.034994658861491e-01   +8.996453814707338e-02   +8.848046323796249e-02   -5.159723393719607e-01   +1.298698667277924e-01   +5.077841754325586e-01   +4.252037755798987e-01; +7.108246979436718e-02   +3.392207342986615e-01   -5.343108300406882e-02   -5.513254173837981e-02   +1.524537352528941e-01   -2.847718857217126e-01   +1.480400926480022e-01   -8.821012004566135e-02   +2.206419874695260e-01   +7.195526669337578e-02   +2.970278263679316e-01   +1.275714100826208e-01   +1.249179074886527e-01   +3.718395873120052e-01   +4.530110417263189e-01   +3.735179409295111e-01; -3.926338310389392e-01   +4.097659830665545e-02   +4.302471150595061e-02   +2.537730557107276e-01   -9.675743840043520e-02   -9.965570981890384e-02   +6.956421177897074e-02   -7.696872781204198e-02   +4.276251651693095e-02   +1.212162859394091e-01   +2.796769027392049e-01   -1.677981262485090e-02   -2.259724961119819e-01   -2.178121535151840e-01   +4.321127574320725e-01   +1.582558668133789e-01; -2.629637910257207e-02   -2.229992689972098e-01   -5.807545113111284e-02   -5.243755125560969e-01   +4.905675946401780e-01   -5.457183876010638e-02   -1.648715182212128e-01   -2.918575301168373e-01   -3.723950690043443e-01   -2.821835118910795e-01   +5.737615825875731e-01   -2.509246706835167e-01   -1.333841182242720e-01   +1.790313535294009e-01   -3.975090875058030e-01   -2.750313644123463e-01; +3.529909045683310e-01   -3.675268940689626e-01   -2.194057744765751e-01   +1.777102775036385e-01   +2.535858398702412e-02   +3.421075707255155e-01   +1.460369113896235e-01   +2.051295207229457e-01   +1.275068877797842e-01   +4.604325644948047e-01   -1.581809405963579e-01   -3.146215846818484e-02   -1.976427941933458e-01   -2.357479049862660e-01   +4.819826825560936e-02   -9.439666807520974e-02; -1.169313435497024e-01   +2.873100027197059e-01   -3.513426810860126e-01   +3.013966771803777e-01   -7.281069220491573e-02   -1.562279244622791e-01   -1.782482864480050e-01   +3.242652661332427e-01   -3.112705798240447e-01   -1.122858594773024e-01   +1.320952544981406e-01   -9.176518627613788e-02   +2.595178479377863e-01   -2.647040905912760e-01   +4.820945680353411e-02   +3.857523494051551e-01; -1.598612545660076e-01   +3.928162513506461e-01   -4.074505543306718e-01   +3.442571958862309e-01   +4.129250270599710e-02   +1.870997189069810e-01   +5.791848474962918e-03   +5.008394339207802e-01   +1.617667016117801e-01   +1.914923767185113e-01   +2.198128141560674e-01   +4.332984908345071e-01   +1.585915789927696e-01   -3.519875462879399e-01   +2.962913462731275e-01   +3.471348542014431e-02];
L2I_L1I_iGABA_netcon = [-1.217733106521601e-02   +1.490731655025670e-01   -1.789190728766564e-01   +1.555040997742757e-01   +4.102925673550298e-01   +8.341357730163665e-02   -3.949386067162454e-01   -1.986706620238152e-01; -1.056835366423245e-01   +6.506233887321001e-01   +7.548507660630421e-02   +3.180814928090368e-01   +3.738180203979874e-01   +6.868707145561774e-02   +1.752397162766505e-01   +1.555314893897247e-01; +3.522271058425696e-01   +1.594041027724987e-01   +2.827457451258195e-01   -5.475251168765508e-01   +5.719001700833960e-02   +4.921109925201357e-01   -5.599031098722529e-01   -2.340668811311265e-01; -6.044685271266897e-02   +2.462786945428434e-01   -6.645169273809651e-02   +1.139480831893881e-01   +1.183806259920210e-01   +5.280688713461579e-01   +5.185094119607411e-01   -2.430636134208754e-01; +1.742554037206799e-01   -1.859596570213279e-01   -2.329618232077306e-01   -3.038742925536767e-01   +3.534230178255319e-01   +7.180096192386504e-02   -2.132110817747540e-01   +9.004286932105322e-02; -1.553357670814380e-01   -1.169378426943925e-01   +2.201359412765879e-01   -3.186742202176795e-02   +1.054015103163258e-01   -1.368658666788113e-01   +1.833338646850892e-01   -1.227564929980585e-01; -1.199926460549997e-01   +2.542874116129680e-01   +1.052829322574363e-01   +2.308654858249417e-01   +1.716716318020242e-01   +7.552792027913660e-02   +9.295537569299153e-02   -3.138983875367662e-01; +4.244078005550553e-02   +3.467078358889492e-01   +3.480744373552282e-02   -2.829703804575495e-02   +1.464373164657060e-01   -5.007420208215349e-02   -2.150920290873546e-01   +2.960370572125637e-01; -2.705011761409855e-01   +1.661741803426783e-01   -1.794183987462517e-01   -2.538839976799943e-02   +2.856201210810594e-01   -1.729245197044237e-01   +1.425313635716272e-01   -7.432221382318210e-02; +2.652922156932511e-01   -2.904858123304309e-01   +6.718552325313554e-02   -1.945171666187663e-01   +2.576943199751878e-02   +8.681519585675646e-02   -2.361871656400725e-01   -3.517098740294407e-01; +4.069454464630172e-01   -5.313844597447320e-02   +3.673215293597480e-01   +2.613002770228930e-01   +1.436444910425828e-01   +1.811756849373874e-01   -3.873707597235171e-02   -5.394158585640518e-02; +1.088639629497927e-01   +4.422970529236239e-02   +1.482649672498172e-01   +9.781330521214049e-03   +4.425647336502080e-01   -1.640916275406340e-01   -2.651182876996219e-01   -1.472496388870499e-01; -1.810630869673632e-01   +1.461475870776380e-01   -5.264198113352060e-02   +2.148677794434738e-01   +2.068629530125891e-01   +3.317567918133920e-01   -4.560209996335166e-02   +3.134207667941937e-01; +7.004107269166998e-02   +3.525647586818536e-01   +1.602015698437702e-01   -2.775470630563826e-01   -6.715779823799420e-02   +4.251842326331000e-01   +7.676353538191549e-02   -4.854044663128279e-02; -2.744600142971949e-01   -2.217155184006981e-01   +1.616032498035231e-01   +3.686899084565102e-01   +2.987501309320258e-01   +7.997052694961636e-02   +4.209935503615422e-01   +5.455729643383422e-03; -1.764220002690962e-01   -1.345342375215719e-02   +2.884173098185779e-01   -2.839822148422932e-02   -2.542035917968115e-01   -5.318323873029274e-02   +2.768559164197362e-01   -4.263891962910448e-01];
L1I_L2I_iGABA_netcon = [-1.480869948155746e-01   -4.887929317903413e-01   +1.048528722418298e-01   -2.072908751660046e-02   +1.061934874053979e-01   -3.457745181355446e-02   +2.676876364579720e-01   -3.067991344878659e-01   -4.151957558699638e-01   +3.535736864590535e-01   +2.894041059976045e-01   +1.959667297150689e-01   +2.513808411776449e-01   +5.894867379226673e-01   -3.959665376419319e-01   +1.234122200371402e-01; -9.484505098132806e-02   +1.132861459994238e-01   -3.977238776537907e-01   -9.005960173591301e-02   -2.752793941887016e-01   -3.512108941379710e-01   -8.356015132200380e-02   -8.680416535930630e-02   +1.242481150475778e-01   +1.365966728157175e-02   -2.140645314591767e-01   -4.814453198694071e-03   -1.159826788807510e-02   +1.786446703458012e-01   -1.584759679525844e-01   -1.377375730270890e-01; -4.997811357716547e-02   +2.097088086341928e-01   +3.190786861304860e-01   -4.506306816920098e-01   +4.519390711972943e-01   +2.201395497959582e-01   -3.712974519259882e-01   -5.612257489992384e-02   +2.627052059611088e-01   -2.144749980450542e-01   +1.793778581662037e-02   +2.925482915262241e-01   -1.879387031482882e-01   +4.668642758152695e-02   -1.728758286082595e-01   +9.373883012086358e-02; -1.475227011413399e-01   +5.349444701474491e-01   +3.991748411050746e-01   -4.092637065934131e-01   +2.945316962470235e-01   -1.540947679216212e-01   -1.982965755853943e-01   -4.185890044749180e-01   -4.059068975966440e-01   +9.384990306012628e-02   -2.273744011499512e-01   -1.531076187588085e-01   -5.212111077695172e-02   +1.647409232556943e-01   +1.609878825776915e-01   +1.515277800354781e-02; -3.051143958123342e-01   +7.912941149598601e-02   +2.123933813311148e-02   -1.208480681302815e-01   +1.521755945926817e-01   -4.395094891357160e-01   -3.671417001283924e-01   +5.121947907305387e-02   +3.357230700059369e-01   -4.657995876193292e-01   +6.082943209676943e-01   +1.025298658688334e-01   -3.928516741924420e-02   -1.004118549812688e-01   +4.746741536696232e-01   +6.041196071006415e-03; +8.006145488403726e-02   -1.610350036880738e-01   -1.391226953954242e-01   +2.112627427173014e-01   +3.767492610315006e-01   -4.414589956418747e-01   +2.441382912757256e-01   -1.946772058696275e-02   -1.263047562622040e-01   -3.943308809377689e-01   +5.068784731481794e-01   +3.032584193595345e-02   +3.359439839696713e-01   +2.971915205048554e-01   -5.812340515159653e-02   -3.753603158164147e-01; -1.527414805809058e-01   +4.969366579715340e-02   -3.078118629328495e-01   +2.586913502228972e-01   +3.159793027468021e-01   +4.733943807628871e-03   +3.092028239257578e-01   -7.935265186399698e-03   +3.011211056193452e-01   +2.718266158912865e-01   +9.265282857562820e-02   -5.345668836362052e-02   +3.745385393230325e-01   +3.548455488578784e-01   +4.209879918380676e-01   -1.546084459447023e-01; +1.245980690358537e-01   -1.074993278402462e-01   +1.838142114135704e-01   +2.035457465598123e-01   -2.164473817968787e-01   -2.982482286232985e-01   -5.521386116720908e-02   -2.562988643864691e-01   +2.775587150503167e-01   +1.971164674848785e-01   +4.318962248782801e-01   +3.263538059274855e-01   -3.425478049620992e-01   +3.612156457651464e-01   -6.439479714664648e-02   +1.963583098060215e-01];
L2E_L1E_iAMPA_netcon = [+4.243092911169463e-01   +3.580980860829491e-01   -2.104363416119957e-01   -4.131683935138699e-01   +5.397963837153247e-01   -1.176558587268133e-01   -9.808650573038484e-02   +1.088061498323382e-01; -1.882364936026713e-01   -4.449027771650186e-01   -2.228408435239440e-01   +1.071375011528578e-01   +4.665808038637381e-01   -1.552210786511808e-01   +2.911223792593919e-01   -8.658781369421448e-02; +3.893188437531857e-01   +3.221143926975914e-01   +1.395468653907308e-01   -2.497460299707022e-01   -5.630678158817903e-02   +1.542221251935694e-01   +5.310884697891788e-01   +6.090133437000101e-02; +1.727042424069601e-01   +1.028896051739405e-01   -3.703232179074406e-01   +2.608936592583139e-01   +2.428106920425831e-01   +3.218999695786359e-01   -3.968988678851785e-01   -3.960737443439992e-01; +3.823933170577106e-01   +3.722604821597321e-01   -2.208039214125177e-01   +2.437783355547440e-01   +3.792965869987363e-01   -4.774100804103552e-01   +2.095629681570924e-01   +8.990648342035520e-02; +1.890352459785756e-01   +4.818483248816660e-03   +2.936121202045862e-01   +5.913604443109532e-02   +2.650201360329594e-01   +2.014373642374538e-02   -1.346505165779500e-01   +2.657190734053163e-01; +1.280272234428208e-01   +3.752459271864499e-01   +1.686492581544152e-01   +5.893315162964051e-01   -1.370204401386038e-01   -2.474402466258270e-02   +2.303039890919965e-02   +3.987790704234486e-01; -1.969514900692164e-01   +2.329126032986664e-01   +9.656725940321145e-02   -2.887588001383739e-01   +1.062718687155691e-01   -4.538191117050480e-01   -3.252640401135612e-01   +2.640233532796612e-01; +1.577786089223650e-01   -6.920189347522088e-03   +2.274249451355425e-01   +6.158091831909444e-02   -9.262087822118613e-03   -2.028132765993113e-01   -3.816049146657292e-01   -2.439412258909381e-01; +8.572991390804321e-02   +4.699566626926354e-01   +3.816739750412593e-02   +1.656994938535617e-01   -2.956118806498954e-01   +3.264027040820525e-01   +2.296128235289786e-01   +3.302897446270270e-02; -3.275592827966269e-01   -1.299169784878585e-01   +2.838960760380618e-01   -4.266169037696722e-01   -2.081093999589640e-01   +1.610052981755654e-01   +1.486661307166703e-01   -1.960108829139800e-02; +1.081693499724597e-01   -3.256258212149872e-01   +1.650000422763213e-01   +3.548401810252018e-02   -4.029309566750131e-01   +2.846378075120167e-01   +4.856935650044702e-01   +1.716096811141239e-01; +5.745501976847429e-02   +9.241200692108280e-02   +7.023674707169228e-02   +3.198751560531470e-01   +5.318707842053907e-01   +3.630028217415409e-01   -1.900612748514696e-01   -3.022468839902495e-01; +1.977013569936311e-01   +8.761075971655588e-02   -3.625066816881508e-01   +3.974728411984799e-01   -2.270536589532151e-01   +3.952054774041761e-01   -2.527841578461615e-01   -2.211624640857830e-01; -2.359746244865944e-02   -2.094409223026058e-01   -4.813179587154121e-01   +8.470674459347904e-02   +3.686335678104691e-01   +2.962961909265590e-01   -2.072461320928143e-03   +2.907800858846097e-01; -1.592459087667133e-01   +1.369392317535958e-01   +1.758363226830197e-01   -1.156306684315840e-01   -1.926262244516439e-01   +4.005697370232874e-01   +2.154909414624934e-01   -1.161758522015943e-01];
L1E_L2E_iAMPA_netcon = [+2.802204178217040e-01   +6.243692053988378e-02   -2.025198710391954e-01   -4.268302407720507e-01   +1.893446031916633e-01   +3.215554683001329e-01   -6.511497187515937e-02   -4.199882866353249e-02   +2.443766897409962e-01   +4.923486519458239e-01   -1.124034736591148e-01   +9.361358225887641e-02   +5.936170492402861e-01   -4.953987709032419e-01   +1.233595008956860e-01   -4.245633297018653e-02; +9.760366677517793e-02   -2.330470861420000e-01   +3.274802853103547e-01   -1.073739554415060e-01   -3.822341132943330e-01   +1.294700965739613e-01   +4.187322104401270e-01   -4.927701772413491e-01   +2.131076516190226e-01   +4.786456085942466e-01   +7.610755344465625e-02   +2.082910678520808e-01   +5.784367650278524e-01   -3.006288163478539e-01   +1.912032590744537e-01   -4.919385931949591e-01; -6.985188191535632e-02   -4.295412798845380e-02   -1.459146124409886e-01   +1.080367652466081e-01   +1.840414690134063e-01   +1.044300264866907e-02   -6.158174914888692e-02   -1.108053243530724e-01   +1.563613110708179e-01   -1.483361728545508e-01   -2.192226935620776e-01   -4.754129389562222e-01   +1.701192888976313e-01   -4.312447570165339e-01   +3.130724989645134e-01   +5.577385161688839e-01; +3.957004266741423e-01   +8.395180584200160e-02   +4.961698320954787e-01   -3.307677717102196e-01   +1.714999029931197e-01   +6.181359832943228e-02   -1.346452055171762e-01   -1.043042524903020e-01   -3.848126600259458e-01   -9.257450351880386e-03   +6.404122596386042e-02   +1.795939705972269e-01   -2.965807379761440e-01   +1.201795675738600e-02   -6.197478585831154e-02   +7.048322130750642e-02; +5.168052376294498e-02   +1.284321007554596e-02   -5.345699373408802e-02   -3.388819294368661e-01   +5.244628464282626e-02   +1.996835426534860e-02   +2.566567802559264e-01   -2.090009193390557e-01   +3.448798331799401e-02   +1.573077401425482e-01   +1.433681128271345e-01   +1.861136690304637e-01   -1.265084026854597e-01   +2.421092667966577e-01   +2.728654963537409e-01   +1.380968182915378e-01; +4.169638733898832e-01   -8.277970735330309e-02   -1.089176413940008e-02   +2.237888699984825e-02   +6.143484460720531e-02   +1.107195451929474e-01   -1.677702784832524e-01   -3.133938216966213e-01   +1.209378948999208e-01   -1.994012050837984e-02   +3.327304413042296e-01   -4.485666393123713e-01   +7.361383438846527e-01   +8.015558659887789e-03   +1.524115256885561e-01   +3.454569134365609e-01; +3.480562208219968e-01   +2.348954412277592e-01   +1.762360505422032e-01   -9.333307485450276e-02   -4.712796438847917e-01   +7.422134220913829e-02   -2.493079651202343e-01   -4.431107863986665e-01   +1.823240178457835e-01   -2.154306149211716e-01   -2.133379964443937e-02   +3.229266695344034e-01   +2.923605294209322e-02   +4.310164913899366e-01   -2.723284003442005e-01   -1.746680424956033e-01; +3.459189593462456e-01   -4.560496163492679e-01   +2.186640960118486e-01   -2.563152847838381e-01   +4.460833991968784e-01   -1.301698674647445e-01   -6.783677219286310e-02   +4.942811400553644e-01   -4.296211478706941e-01   -2.417549337257488e-02   -2.597037297056157e-01   -5.307410056465318e-02   +1.165037466983323e-01   +1.065041405970307e-01   -1.907453380788901e-01   +3.660566638124742e-01];
L2I_L2E_iAMPA_netcon = [+3.067833708821787e-01   +3.104836751675474e-01   +3.310581932020829e-01   +6.719314912161836e-02   -1.753857227077475e-01   -1.508255223902624e-01   +7.033923127820382e-02   -8.185531247723440e-02; -5.780499220092522e-02   +6.796669800842727e-01   +7.994884862727096e-02   -1.400797312346042e-01   -4.472982005849922e-01   +2.428614146262836e-01   +2.298874229349932e-01   +5.088143476093463e-01; +8.135206113533910e-02   +4.802630982268398e-01   +2.145401805715539e-01   +5.193288869036271e-01   -1.506032002257009e-01   +1.131149686890485e-01   -2.377177654242871e-02   -2.415200201498451e-01; -2.252522417662201e-01   -2.190402824587645e-02   +3.806871470636369e-02   +1.260268600580353e-01   -2.793785126901645e-01   +1.444591116106757e-01   +1.878095485019786e-01   +2.313035225211646e-03; -1.340031783838769e-01   +1.302928856214008e-01   -2.212129036102931e-02   -7.301527036704566e-02   +9.483339546929634e-02   -5.673621314717558e-02   -9.821160343321281e-02   +3.942917810198281e-02; -5.228285909581787e-02   +8.713560558260461e-02   +2.846858386113668e-01   -1.859470127745744e-01   +9.030470841083114e-02   +2.578072671011119e-01   +1.697803930624369e-01   +2.006544462936932e-02; -2.682416810356065e-01   +1.828710205199484e-01   +3.736799633588427e-01   +1.500624658564705e-01   +5.190069106370196e-03   -3.223179474598323e-01   +1.150786379967470e-01   +1.593486015952238e-01; +4.834282176082357e-01   +4.100665744230729e-01   -3.072976025914113e-01   +1.250224687958282e-01   -1.303379651171393e-01   +6.453402465325710e-02   -1.187741527682015e-02   +3.647375086952789e-02];
L2E_L2I_iGABA_netcon = [+6.844173950030064e-02   +3.727419598867059e-02   +4.512941481321899e-01   -2.142011507563845e-01   +2.739218724772048e-01   +2.121149191277377e-01   +1.548445950732706e-01   -4.558742842063646e-01; +1.781721195840905e-01   -2.499423195721059e-01   +1.277690847150219e-01   -3.628161806722263e-03   -1.026466230033873e-02   +6.481687491305789e-02   +4.091103320881273e-02   +2.836633505352182e-03; -1.653078242340280e-01   +1.984314831475540e-02   -1.660298884570714e-01   +4.704781799699936e-01   -3.900335657028212e-01   +6.043698913587151e-01   +2.601687822850082e-01   -4.047022268208901e-01; +1.999929935786117e-01   +2.118828066360138e-01   +2.129049371922147e-01   -8.651530614595301e-02   +4.005381292269538e-01   -1.054365167812425e-01   -8.632107183115342e-02   -2.649649284259801e-01; +4.039489825549886e-01   -3.325864059179617e-01   +1.344945647825036e-01   +1.434553011590043e-01   +1.884185310773504e-01   -3.897549451599237e-02   +5.447625580513591e-01   +2.689701326215497e-01; +8.576928107451427e-02   -3.422167786513615e-01   -3.663765146597678e-01   -2.226595102654002e-01   +4.341329275887454e-02   -8.403277136315020e-02   -1.526356256863750e-01   +5.918209198637711e-02; +3.897189553505266e-01   -2.213304313897404e-01   +4.507707828600712e-01   +1.836713334993312e-01   +7.023100609418434e-02   +1.227224833373974e-01   -2.932424123509166e-01   -3.534886006239878e-01; +7.230955055008748e-02   +3.726788070237060e-01   -4.090713473494464e-02   +2.703025037668897e-02   +7.041364954877286e-02   -5.504601135308380e-02   +2.923276786003459e-01   +4.507137103876999e-01];
L3E_L2E_iAMPA_netcon = [-2.712033389975165e-01   -7.244618019715085e-03   +1.238670960742080e-01   +7.488555258198581e-03   -3.479674948285184e-02   +2.237422069816582e-01   +2.225568848769653e-01   +4.412161097551894e-01   +4.543482744027660e-02   +3.976746561416843e-01   +2.580142459403586e-01   +1.505890064376275e-02; +6.151794553043571e-03   +2.892693780160707e-01   +6.213425212261191e-01   -2.877809379422633e-01   +1.696144342112464e-01   -8.220232201424832e-02   -1.812799836903472e-01   +4.306501360347448e-02   -2.518212010774325e-02   +3.656206101659753e-01   +2.145319459270953e-01   -1.026133388340295e-01; -3.482649234694581e-01   +7.593388385521965e-03   +1.994805036323026e-01   +2.654494413229321e-01   -1.997724607730170e-01   -2.777347170642023e-01   +3.694325891567879e-01   +8.822003182290293e-02   -6.987710533697140e-02   -2.760015111198735e-01   -1.212188731327575e-01   -3.021895786900680e-01; +3.053330535911216e-01   +2.044296706551392e-01   +1.050722881347857e-01   -1.982526864988164e-01   +2.804926083419919e-01   -1.369680746080552e-01   +9.238172932480690e-02   -1.645978218944924e-03   -2.163851018377261e-01   +2.151273458099778e-02   +1.161060299148240e-01   +1.852060758554177e-01; +8.069828963684397e-02   +2.882135087443586e-01   +1.357039142057142e-01   +1.711745614843604e-01   -2.984575416758309e-02   +4.021707002139747e-01   +2.066644265756176e-01   +4.883975373253867e-01   +1.140784156431860e-01   +4.663995457441200e-02   +1.906770766136429e-01   -8.451498296140508e-02; +1.255220944544238e-01   +2.505690925978540e-03   +2.194609760484798e-01   +2.205155515800066e-01   +3.687178508402411e-01   +6.770542898505182e-01   +3.776027350717354e-01   +9.403820086020431e-02   -5.322433027340512e-01   -8.505152974811719e-02   +6.021800099999487e-02   -2.882431725258601e-01; -2.369016497473121e-01   +7.999150864638455e-02   +1.816884516114090e-01   +2.800931833658011e-01   +6.635026720679527e-02   +2.850662981655433e-01   +5.483859646942058e-02   -3.435854815660184e-01   +1.219990853376295e-01   +1.783473659802435e-01   +2.599362941591053e-01   -4.184659541936931e-01; -1.970842884782417e-01   -8.610083618972789e-02   -8.721923140422849e-02   -2.468162362727939e-01   -1.094545066282308e-01   +1.792502113291195e-01   -1.674028981364225e-01   -3.365596917377692e-01   -4.591161597752910e-01   +2.236836666342561e-01   +3.047398582599872e-02   -8.802955822297126e-02];
L3I_L2I_iGABA_netcon = [-5.178585692709439e-02   +6.429320415913963e-01   +2.904012947286237e-01   -3.363730407287836e-01   +1.442230869936632e-01   +2.596520876165825e-01   +6.271537986097439e-02   -2.271003986872989e-02   +1.683450517976957e-01   +3.199285424187402e-01   -3.163449535205863e-01   +1.643014623920599e-01; -2.568952012988270e-01   +1.115462065095434e-01   -1.849205209807997e-01   +3.485836522019691e-01   -2.507903183432368e-02   -3.156763253851716e-01   -3.562605464606525e-01   -5.678853190056172e-02   +1.802935686939730e-01   +2.532680612463542e-02   -1.093543694132687e-02   -3.672615899794075e-01; +6.595325439192772e-01   -2.967168770774163e-01   +4.167460222457434e-02   +2.874557771858784e-01   -5.768464509127453e-01   -5.697501846174020e-02   -1.291885277849630e-01   +3.001489606480191e-02   +2.535321927494064e-01   -1.688979665299450e-01   +9.845457972291349e-02   -3.855045377538978e-01; +6.070657153082836e-01   +2.364774956487366e-01   -2.934651285207024e-01   -3.572123333550983e-01   -4.373389513015155e-01   +4.923916650196881e-01   +3.728751105724084e-01   +1.816778615026744e-01   +5.135947054606120e-01   -1.175131255012146e-01   -8.184461046545177e-02   +3.029125807328685e-01; +3.542553090076513e-01   +3.187426139725101e-01   +1.011645162025374e-01   -5.015668089457020e-02   +1.121300038876379e-01   +3.354906770714643e-02   +8.390583155773453e-02   -9.148420445836755e-02   +2.673818464772268e-01   +1.920651637278711e-01   -5.755649451794544e-02   +3.917095693811099e-01; +1.848580113577486e-01   +2.259093724307900e-01   +2.612176033347354e-01   +1.489858821329487e-01   +2.589527724003634e-01   +2.579712737121201e-01   -2.106256750779304e-01   -4.382438565429220e-01   +4.007662096622109e-01   -1.100190215750760e-01   +1.109369846372029e-01   +8.457586977911981e-02; -9.793614552812793e-02   -2.916938071719816e-01   -1.295960554034981e-02   -2.038993549878498e-01   +3.859997658811583e-01   -1.409795772561229e-03   +1.280652864497956e-01   +1.136721200636773e-01   +6.811758034458473e-02   -3.294043698604218e-01   +3.036474411899037e-01   -2.459806201205594e-01; +5.052266296258281e-01   +7.644180120927374e-02   -6.488896831419141e-02   -3.099745268129594e-02   -4.715367563382500e-01   +9.805373348091423e-04   -5.533247737715971e-02   +1.449190627582191e-03   -4.928839508705601e-01   +1.017893639448060e-01   -3.839963194878729e-01   -2.941469928565786e-01];
L2E_L3E_iAMPA_netcon = [-1.940119237387323e-01   -1.847313501294941e-01   +2.327395403298388e-02   +3.629152172853241e-01   -5.589240358034731e-02   +1.530233290019649e-01   -2.454991898379303e-01   -5.230049639887172e-01; +1.283350664120756e-01   +9.430402043139191e-02   +3.997883086960421e-01   -4.104245509745291e-02   -1.655322369619574e-01   +2.214375495994130e-01   -9.648709745916068e-02   +6.827543985930576e-02; +2.750922677930124e-01   +3.322831186240508e-01   -3.107166241893604e-01   +2.450676190809644e-01   -1.908508268374185e-01   +9.740297086377876e-02   -2.668279459923562e-01   -1.258390262555197e-01; -2.626397169355509e-01   +4.216710080869851e-01   -1.331583929368564e-01   -3.733422290308643e-01   -6.663905494673761e-02   +5.791031518543435e-01   -1.885767458460154e-01   +2.450320250497159e-01; -4.066739889172709e-01   +3.756527401749125e-01   -5.505483648924607e-03   -4.470890873298363e-01   -2.628306791011323e-01   +6.231658995881263e-02   -1.833265586561330e-01   -3.911519841276442e-01; +2.290907695047127e-01   +1.399461777466350e-01   +2.072465445094301e-01   -1.559719637143874e-01   +6.202941506572823e-01   -3.052045857003803e-01   -6.428875783676755e-02   -5.772290704907508e-02; -2.650876736585698e-02   +3.720332541211556e-01   -4.265385103081885e-01   +2.325546262574547e-01   +2.934645370828745e-01   +6.279840781566978e-02   -3.007166743502278e-01   -1.821009648575411e-01; -2.319086420939106e-01   +1.658996572667721e-01   -3.005561763847094e-01   +3.057448011156493e-01   +2.667391404063404e-02   +3.009963306407847e-01   -1.418904596983956e-01   +2.663551253012778e-01; +2.369013616575786e-01   -2.711720718166142e-01   +1.395494287272704e-01   +8.124934059773883e-02   +2.212301456185672e-02   +8.023921097992387e-02   -3.182617380142635e-01   +1.631934994488635e-02; +4.972344861496361e-01   -1.495677555070584e-01   -3.452438637272577e-01   +9.443588499020826e-02   +1.747646557936239e-01   -2.043833474066400e-01   -1.874003144492274e-01   +4.479517774209162e-01; -1.323540601893361e-01   -1.724385423906102e-01   -1.242003438729832e-01   -5.748227667869293e-03   +6.671931813474939e-02   +3.309947574640822e-01   -2.919705786210952e-03   -7.915037430021032e-02; -2.105074131663328e-01   -9.953732179175698e-02   -1.790683152817226e-01   +4.892327185453831e-01   +3.608049961985658e-01   -4.742806465149197e-01   +5.561091741311566e-01   -5.790382681717698e-01];
L2I_L3I_iGABA_netcon = [-1.837483937056521e-01   +6.941433770884010e-02   -1.059851671268439e-02   -7.520089450289313e-02   +1.920870394897501e-01   +6.812412754646209e-01   -2.047356263695187e-01   -3.687943162497528e-03; -1.074786417672916e-01   -5.138631560745271e-02   -3.597069392882729e-01   -2.441962497172612e-01   -2.346906528957901e-01   +5.002926665891116e-01   +2.410505351503007e-01   -4.823159479445251e-02; -2.234723101143771e-02   +3.316302454957839e-01   -1.535618900165188e-01   +4.944719250065699e-01   -1.991375780045222e-01   -2.830832994037945e-01   +1.437743286684907e-01   -2.329365694692816e-01; -9.815846047080740e-02   -5.990959768767139e-02   +3.866277881696880e-01   +2.802025858567627e-01   -3.044542933017760e-01   +4.732019258077338e-01   +3.226918898579773e-02   +4.374619354007727e-01; -1.169134321468766e-01   +3.149203738736872e-01   +2.663702062975934e-02   +2.336195270384614e-02   +3.128173061089669e-01   -3.113582486497289e-01   -2.229679184331870e-01   +4.655374040428872e-03; +2.283990140353471e-01   -3.411760964801233e-02   +8.641545759776753e-02   +1.516049806741803e-01   -1.626815671697263e-02   +3.159024185761334e-01   +1.455386846130018e-01   +2.958051051361071e-02; -3.529595797005834e-01   +2.522073727848881e-02   -4.061571079669928e-01   +2.511398216556369e-01   -2.278396950376978e-01   +8.652210486557024e-02   +1.256203295538108e-01   -5.188524516702898e-02; -4.313351645804042e-01   -1.329357846953511e-01   -2.470443399530407e-01   +1.892429723199032e-01   -3.581126249069775e-01   -2.346239686804272e-01   -1.767166550177227e-01   -1.520034504091005e-01; -1.661304075566630e-02   +2.607384135836575e-01   +8.375852363481825e-02   -4.722454705082476e-01   -6.428011337663439e-02   +1.942520332918374e-01   +1.979414655791292e-01   -2.808373311525653e-01; +4.294480635804213e-01   +5.835596720044953e-01   +1.028870092491971e-01   +4.292179463148085e-01   +1.267227910556251e-01   +1.934263429584733e-01   -4.602652198301331e-01   +4.769502663411362e-01; -1.497719108720684e-01   -2.051626193000430e-02   -3.385431995098246e-01   -3.613214257502534e-01   +1.683667103171050e-01   -3.951028729989473e-01   +2.068428324733251e-01   +1.566481500273971e-01; -1.361926522313203e-01   -2.657997174576563e-01   -2.569192465265931e-01   -7.198556199232506e-02   -2.505162806038245e-01   -3.749314790931558e-01   -9.420785722618638e-02   +6.164295764357156e-02];
L3I_L3E_iAMPA_netcon = [-1.370953342271181e-01   -6.214011312744699e-02   -2.951309740230690e-01   -1.360637892379600e-01   +2.991758725521403e-01   +2.827931847664458e-01   +7.771064058799132e-02   +4.492362620473926e-01   +2.270925994068226e-01   +3.800733358973888e-01   -3.192026219447796e-01   -4.210705883381805e-02; +9.300897128664384e-02   +2.083916994230224e-02   +4.841676462547256e-01   +5.283035208745702e-02   +2.280930916437295e-01   +1.920390226908372e-02   +3.188401814342668e-01   +1.185885304270121e-01   -6.497513683738620e-02   +1.191206818451796e-01   +2.303065049585840e-02   +1.066018872059963e-01; +3.635722862645474e-01   -1.867892527736086e-01   -1.189408521584618e-01   -2.395331642390920e-01   +1.473655433927123e-01   -1.009870525000364e-01   +2.719254811949712e-02   -9.150367666782193e-02   -1.893199660548347e-01   +1.008165150557438e-01   +1.051046659960764e-01   +4.996702367344529e-01; -2.786095272082340e-02   +6.538716993610139e-02   -3.570261940591918e-01   +2.536592307159664e-01   +1.932867593442066e-01   -2.037717013014373e-01   +4.560009199852366e-01   -2.773844719983714e-01   +3.252051807875560e-01   -3.676812671813361e-01   +2.954131635997488e-01   -8.803415809836057e-02; +3.392113877625817e-01   -1.709459396913237e-01   +1.424171731640894e-01   +1.526113155984310e-01   +2.893701576458119e-01   -3.931059443788470e-01   +4.700515435636413e-01   +3.760560409034436e-01   +3.798221180560659e-01   +2.945560317483760e-01   -3.533150472010933e-01   +2.142269650067985e-01; +4.834021500438089e-01   -1.744926135443197e-01   +4.740323260265377e-01   +1.568133669484338e-01   +7.585758348065810e-02   -1.861690969242981e-01   -1.881453573888727e-01   +1.964915071995771e-02   -4.595567017601343e-02   +6.211179385111945e-01   -2.704868156622582e-01   +2.774293652265524e-01; -4.171737030534417e-02   +5.533743281020577e-02   +7.559076207906321e-02   +1.862816487775992e-02   +3.169789510367218e-01   +1.942345553882915e-01   -4.737549026486643e-02   -4.340628896396881e-01   +1.484340960727282e-02   +2.193192171547738e-01   +4.687554510934684e-01   +2.677978465560515e-01; +6.420569898953107e-02   -8.716977609837642e-02   +2.950024670750144e-01   +5.447903906110965e-02   +4.142181918429202e-01   +1.094856513628482e-01   -1.533687250672963e-01   +5.520591694858539e-01   -8.987851164039849e-03   -4.360500447621879e-01   -2.620213819691323e-01   +5.243040637367056e-01; +2.323277820523516e-01   -2.224922617963437e-01   -5.820850392638760e-02   +5.213726271308420e-01   +3.105956918505126e-01   -1.869476707361090e-01   -3.084033628490691e-01   -3.262282760541647e-02   -1.477707274025746e-01   +8.103782997269493e-02   +4.979605343509272e-02   +1.627054022097848e-01; +2.249632892858735e-01   -6.951229691026881e-02   +1.574991245554573e-01   -4.151548136043854e-01   +2.627468017522399e-01   +3.142467784038661e-01   +1.393191333212646e-01   +6.663301233384003e-02   +1.583104389872048e-01   +1.747156544441110e-01   -1.252207614092615e-01   +2.996284002379743e-01; +2.826772721012513e-01   +3.462042328997175e-02   -9.586566152553372e-02   +3.653871686674897e-01   -1.278311724294570e-01   +7.535331589729002e-02   +4.137220003902299e-01   -2.749325286115405e-01   +2.373297742850241e-01   -4.062915211164718e-01   -4.406871329250717e-03   +4.189679770336617e-01; +5.357351680484141e-01   -1.196447089207240e-01   +2.542415995828758e-01   +1.264336015507335e-01   -1.093788170164666e-01   -2.691629547168788e-01   +1.041422979357954e-01   -2.176343543066668e-01   +1.928385560192858e-02   -3.960834578460640e-01   -1.619261661557486e-01   +2.817806134289594e-01];
L3E_L3I_iGABA_netcon = [+3.284872495924318e-02   -4.074038065105798e-02   -1.402070599809285e-01   +1.201412307887082e-01   +3.998552348223573e-01   +1.706948711987831e-01   +2.837446815952100e-01   +5.165722986733757e-01   +3.563932699259987e-01   +2.854616220631666e-01   +2.721795069961436e-01   +1.819396427523552e-01; +1.331585705474603e-02   -3.076556547566638e-01   +1.007447520146217e-01   -2.526096966651417e-01   +1.724371547482395e-01   -5.052856864273561e-01   +6.989650684249477e-02   +4.285676267017156e-01   -1.743943095050739e-01   +3.574978030565927e-01   +9.636511727521230e-02   -7.524583030252885e-02; +1.204378903158377e-01   +1.202275992050709e-01   -4.715146611548238e-01   +2.570163561450888e-01   +1.801550986158381e-01   +8.192043987030797e-01   -4.049364414203881e-01   +2.120431797969679e-01   -3.803092199516334e-01   +3.845228936599279e-01   -2.279032914814061e-01   -2.515337975120164e-01; -8.459191060956475e-02   +6.554740250474989e-02   +2.165739229311017e-01   -6.142468923207216e-01   -4.849856692862367e-01   -4.433186901499784e-01   +1.497071408520236e-01   +4.683372985715736e-01   +6.795161425755353e-02   +2.994316818878059e-01   +4.585047818456675e-02   +1.051317693614669e-01; +3.131392977174812e-01   -5.286311229731870e-01   +3.076126983777230e-01   -5.786130044356784e-01   -8.023383479230192e-02   -2.453848812128025e-01   +5.055346480343200e-02   +2.230580556296583e-01   +3.022968438765769e-01   -2.968062533619038e-01   -2.802871001229997e-01   +2.686060783386051e-01; +3.881476554684035e-01   +1.393632522788673e-01   +3.130927580318432e-01   +1.601241531170967e-01   -2.048835223064802e-01   +2.410994715563620e-01   -2.078156762706811e-01   -4.463048759171317e-01   +2.804249813582481e-01   +1.623186299302158e-01   -8.615834065639454e-02   +2.199294111770239e-01; -1.354952244939314e-01   +2.754723764178781e-01   -1.809338630245584e-01   -4.497448742673654e-01   +3.060137644277058e-01   +5.296744143641030e-01   +8.968065137128624e-02   +1.940091201797205e-01   +2.591597369223699e-01   +1.646492271670214e-01   +4.128714989732437e-01   -3.119357175510717e-01; +2.933269381443499e-01   -1.442351542499329e-01   +2.069798150207953e-01   +3.706260389263162e-02   +1.830360156672907e-01   +1.005396610887649e-01   +2.497279586409672e-01   +4.780060908265344e-01   +6.694652172821003e-03   -1.487264859511301e-01   -3.897529706878734e-01   -2.090842121881675e-01; -1.774693865759312e-01   +7.002005295380541e-02   -4.473551264469166e-01   -6.213441895964075e-02   -1.609633732427334e-01   -1.953856649714317e-01   +3.253716901427904e-01   -4.258760625795254e-01   +5.439093805458350e-02   -4.063295021634857e-01   +2.537391511663855e-01   +1.286632041994862e-03; -2.254876375316108e-01   -2.898989611067523e-01   +3.143197960407669e-01   +2.272510214419163e-01   -4.677430950368913e-02   +3.089827940139422e-01   -3.146460440877799e-02   -3.051864582299307e-02   -2.044905145693669e-01   +1.191211881560383e-01   +2.427393122364048e-01   +4.327213243008974e-01; +3.548023767252877e-01   -4.836316426279261e-02   -2.300528340980363e-01   -1.846198380339441e-01   +3.362507740304803e-01   +1.694169720494021e-01   +4.923921103080939e-01   +1.046886147888702e-01   +1.943875559549255e-01   -5.669577957961811e-02   +3.237043319812803e-01   -2.614183837131821e-03; +4.697214274988576e-02   +1.720816430670186e-01   -1.840759553945658e-01   -1.677326343666920e-01   +2.454993877729038e-01   -3.967797608115414e-03   -4.220790486375259e-02   -5.672688795739329e-02   +2.215177909073612e-01   -2.358642981027279e-01   +2.104668932235791e-01   +2.609518779368207e-01];
L2E_Input1_iAMPA_netcon = [+1.621406912765112e-01   -3.862829256425566e-01   -1.650499986691891e-01   +4.932148340971660e-01   -4.753984431841161e-03   -3.550168246720068e-01   +5.998717005881593e-01   -1.200884126831023e-01];
L2I_Input2_iAMPA_netcon = [+2.571005298923211e-01   +1.110706761808397e-02   -3.165635764407014e-01   -3.564001676696628e-01   +3.747654311932391e-01   +4.453304398168624e-02   -5.823638071248514e-01   +2.121368862009805e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
