function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.141394233174497e-01   +9.462985239569485e-01   +6.981219806152038e-01   +1.549657704361417e-01   +9.209352780390855e-01   +2.186964494816525e-01   +7.406066722785835e-01   +3.023201660122850e-01   +5.327862279077606e-01   +8.288099582473889e-01   +9.685758139203833e-01   +9.644397817080144e-01   +6.962221174150743e-01   +3.716441678888508e-01   +2.973569951515183e-01   +3.775621879907707e-01; +3.459348935018960e-01   +1.330694851817289e-02   +1.417782990168916e-01   +1.762678983176192e-01   +7.104154539572635e-02   +8.087655203261690e-01   +7.944609514674839e-01   +7.583501927689059e-01   +7.840867861879528e-01   +1.816107485408604e-01   +4.654336954494146e-01   +6.553956832461292e-01   +3.760235063591733e-01   +2.758044475067214e-01   +6.850614852422998e-01   +9.537511093535399e-01; +2.077163621953913e-01   +4.671129628447366e-01   +8.354142096874141e-02   +7.019745838448566e-01   +3.129460557068928e-01   +3.820400043991640e-01   +6.635196398127807e-01   +9.537938628908308e-01   +4.928521403310023e-02   +9.257278733339830e-01   +8.701654370170444e-01   +2.089164632079276e-01   +5.416528361803749e-01   +7.575794356373286e-02   +7.734290001255529e-01   +8.120404690741007e-01; +2.421545809224740e-02   +4.899501111857028e-01   +4.331641156129312e-01   +8.332432422494205e-01   +6.287665751652933e-01   +8.565266595459415e-01   +4.406955328156820e-01   +9.088230008500130e-03   +4.622079340491690e-01   +4.199116651787230e-01   +9.466006072932375e-01   +8.974260603126297e-01   +5.184709208260456e-01   +1.504863793788886e-01   +7.203373289461809e-01   +8.914294177896052e-01; +7.654807314170536e-01   +5.161464708103566e-01   +8.947667812320448e-01   +8.138424787001887e-02   +9.054484861291467e-01   +3.226092170268313e-01   +5.755401697618995e-01   +4.064052168314066e-01   +9.385129406212611e-01   +2.996002699422377e-01   +2.327920055359505e-01   +4.881109462021067e-01   +7.630986937812306e-01   +3.653132451589541e-01   +2.784386922484814e-01   +6.816534002273562e-02; +5.718747214035369e-01   +2.878522767814502e-01   +7.324193283278386e-01   +8.352414005783273e-01   +7.961691149808018e-01   +3.789673709496173e-01   +5.187130589972645e-01   +1.528885884991888e-01   +4.734469575761814e-01   +3.479395870683940e-01   +9.186181845753068e-01   +6.625548740337929e-01   +8.017658951567944e-02   +7.169547531631123e-01   +1.369056101848931e-02   +9.028428382065162e-01; +5.766880920031775e-01   +5.655615325283897e-01   +6.805474264966789e-01   +5.419342895087215e-01   +6.431035672019444e-01   +6.367845866202101e-01   +7.246011595919937e-01   +8.214227123575311e-01   +7.789086745743140e-01   +9.710427529056950e-01   +6.338040932603919e-01   +5.263374907405459e-01   +4.788392684533895e-03   +5.321054751329525e-01   +1.481142594802538e-02   +6.672488496047083e-01; +3.895630859912504e-01   +5.101222217036306e-01   +2.027640461309905e-01   +9.627259150141014e-01   +4.393656522203225e-01   +3.865601593009755e-01   +2.220960527437642e-01   +2.882683161971696e-01   +1.096078065561780e-01   +5.305184097330359e-01   +2.848013164705567e-01   +7.083531668860444e-01   +4.014741956209808e-01   +2.321006756430828e-01   +9.364074264662422e-01   +3.466876249119435e-01; +5.562834747288349e-01   +6.785271467611591e-01   +5.301848078762917e-01   +6.775869207703134e-01   +7.486246687147359e-01   +6.759466376416105e-02   +9.981920490963482e-01   +9.774170423427976e-01   +5.212768552025072e-01   +7.905017451348667e-01   +8.556139772888121e-01   +7.191817917401986e-01   +6.622742216588922e-01   +4.716835575739850e-01   +9.334143805365736e-01   +8.368175855716845e-01; +1.831076381020708e-01   +6.159798374359179e-01   +8.313766261918006e-01   +3.357979113635378e-01   +8.260643483320633e-01   +1.688338887994133e-02   +6.191417826683581e-01   +6.257102512119510e-01   +6.360225323380425e-01   +7.936958556724001e-01   +1.659518333263199e-01   +2.945146902558824e-01   +3.681750412329954e-01   +7.162694459671743e-01   +3.728751779209101e-01   +1.984367152693730e-01; +1.181171179608652e-01   +5.650340581552741e-01   +1.756637788354437e-01   +2.209601394632080e-01   +3.415396686430353e-01   +8.794865604290116e-01   +9.801162358940692e-01   +7.432509136727244e-01   +5.790332750778985e-01   +1.435353839247921e-01   +8.274111935820889e-01   +1.174673356580828e-01   +3.928386340615596e-01   +5.140271996518286e-01   +1.091538906244335e-01   +8.404812668745121e-01; +5.891938225203946e-02   +5.048560047669065e-01   +5.174384683903692e-01   +5.682753511909800e-01   +1.399205800409700e-01   +1.573216705843203e-01   +4.958097356663138e-01   +8.723023836910808e-01   +8.353871008222449e-01   +4.564143735979328e-01   +2.166944473984179e-01   +3.254055498739397e-01   +1.340482801017279e-01   +5.131944315935357e-01   +7.198596241356725e-01   +4.248487076107059e-01; +9.327806867962699e-01   +6.674934089257369e-01   +3.557881586288328e-01   +2.741838236847555e-04   +5.043922062811546e-01   +9.134891439582520e-01   +5.225305716238010e-01   +3.295297366906921e-01   +1.153652592629304e-01   +4.577051361918920e-01   +2.667940378382795e-01   +4.570640425638302e-01   +3.382425303718249e-01   +3.856489687769832e-01   +4.481327383196584e-01   +5.589339800005220e-01; +7.453425389193216e-01   +6.330993221584998e-01   +6.465262591960079e-01   +5.884370751483359e-01   +4.138192778203707e-01   +5.566066509477305e-01   +8.546662880619830e-01   +9.781607910824570e-02   +5.091420562216992e-02   +9.550172054807521e-01   +8.774308828516723e-02   +7.161540625489524e-01   +1.225711445104552e-01   +4.784591005156988e-01   +1.230692182385944e-02   +4.471820197062236e-01; +2.433282871974447e-01   +1.437700537878178e-01   +2.811759707614016e-01   +8.909237213205036e-01   +1.716969464212413e-01   +9.224859730596937e-01   +2.536516922760557e-01   +4.505776678486386e-01   +5.176103333888870e-01   +5.316552370536308e-02   +9.166412319056373e-01   +4.057334507258870e-01   +3.687010062560557e-01   +7.401303137801531e-01   +1.235237090192638e-01   +7.605369784975233e-01; +2.041295988404614e-01   +1.788874982499631e-01   +4.356097875905936e-01   +2.548576010815923e-01   +4.934132322404327e-01   +5.970812849948010e-01   +5.817960592874503e-01   +2.407694266521298e-01   +6.960993464158763e-01   +3.573808047295884e-02   +7.257697589070989e-01   +2.427317554168437e-01   +2.513786048521103e-01   +7.020436685132236e-01   +6.588739265562553e-01   +9.606767146547143e-02];
L1E_L1I_iGABA_netcon = [+8.426262044128685e-01   +7.525048756215728e-01   +8.737384236151131e-01   +4.364318829228833e-01   +9.188069319943094e-01   +7.792693720481348e-01   +3.220480591675867e-01   +6.411709994919218e-01   +9.445347009090511e-02   +2.595448716237815e-02   +1.285143473725819e-01   +5.195503072922956e-01   +8.699821005232363e-01   +5.761561490737171e-01   +1.657781979704211e-01   +6.276721341388669e-01; +6.208726648656198e-01   +9.957338879685248e-01   +3.097763600953849e-01   +1.473670407235446e-01   +8.825921121572247e-01   +2.728879139833577e-01   +9.627679722917653e-01   +4.303694119961541e-01   +2.927451487515146e-01   +5.146048405745923e-01   +4.237358423450940e-01   +2.037806559643444e-01   +8.035664846561201e-01   +2.881298655417229e-01   +5.389210486754999e-02   +3.367727905929714e-01; +6.710657297277067e-01   +3.706667961492117e-01   +4.332768879809025e-01   +6.544751298232925e-01   +5.857597903347743e-01   +5.272156539289453e-01   +3.522405804793888e-01   +4.785528826991883e-01   +3.265838860747786e-01   +8.623107664356916e-01   +4.812527868602721e-01   +7.758371998052086e-01   +6.464236165177130e-01   +1.316176851386315e-01   +2.114825681140978e-01   +1.568844423378063e-01; +7.821892525610735e-01   +5.024682744339874e-01   +3.815251343311515e-01   +7.216052739800121e-01   +8.349344140373702e-01   +4.039312683494692e-01   +3.205710672774871e-01   +1.006866843490695e-01   +4.825722076995385e-01   +5.825562488414882e-01   +6.737469304943934e-01   +3.912834287298935e-01   +7.339771601691251e-01   +5.094935090610236e-02   +2.037946431069752e-01   +4.016652679026080e-01; +3.095690124211733e-01   +7.573142596488281e-01   +6.567932221001389e-01   +1.621020614524158e-01   +7.761791036689505e-01   +7.796861593832751e-01   +9.087703139661826e-01   +8.062629889079178e-01   +2.409686886120263e-01   +4.216374265672820e-01   +3.566701393125016e-01   +6.691394075133245e-02   +6.669436206869607e-01   +6.230570989334414e-01   +2.177256964990505e-01   +9.131994882520363e-01; +3.297038659774965e-01   +1.269009001323593e-01   +2.379288444676836e-01   +3.427849401893027e-01   +7.859814860359671e-01   +2.576155343852413e-02   +8.849700790552737e-01   +6.404023361166171e-02   +4.533990863447667e-01   +7.143533583718487e-01   +4.980548477391668e-02   +7.571210768231873e-01   +8.811130518853170e-01   +6.046144765657698e-01   +5.792263791259107e-01   +1.486726729247996e-01; +6.340426580969732e-01   +5.175149618370259e-01   +6.867504852545321e-01   +1.059462947945181e-01   +7.014002259513220e-01   +4.119504150897676e-01   +3.536329058130684e-01   +9.545605543130532e-01   +7.590093990708795e-01   +2.333814985420422e-01   +2.899626799065773e-01   +4.541026965433236e-01   +8.531661930473735e-01   +3.713503321727378e-01   +3.314880849743179e-02   +4.646649255358986e-01; +9.021188051175411e-01   +9.054433592116392e-01   +3.262866951211141e-01   +4.109107200812034e-02   +1.776092624077187e-02   +8.257626870851600e-01   +7.497747547198792e-01   +7.728067024252679e-01   +7.171138695086312e-01   +5.944922910426986e-02   +7.942798053444624e-01   +3.196131325738772e-01   +4.037142921466677e-01   +8.314020386363136e-01   +7.954609846462956e-01   +7.702644311248445e-02; +3.709885563713203e-01   +9.889712112168551e-02   +8.810655021301079e-01   +4.783985938148281e-01   +3.305253378544596e-01   +5.921743883862729e-01   +1.264367189246981e-01   +4.415492216389019e-01   +2.374949465187355e-01   +9.759668003682362e-01   +6.508347995280513e-01   +2.779739302508693e-01   +1.043925409703772e-01   +5.197767695514890e-01   +1.353885612228503e-01   +3.422744522957505e-01; +8.818133797169754e-01   +1.783943095017720e-01   +9.995975615383877e-01   +4.774810417190886e-01   +9.476205939546963e-01   +2.127645127028507e-01   +5.999879056056164e-01   +1.652345038781341e-01   +6.997123198728494e-01   +9.694804169757925e-01   +7.098421214243619e-01   +5.839632546476381e-01   +4.037347747845736e-01   +8.007297111648681e-01   +5.827596172757652e-01   +4.960921294885007e-01; +1.244432006406577e-01   +1.733116871349324e-01   +6.810797341954978e-01   +5.461698901772476e-01   +3.990793900910187e-01   +2.958264466253524e-01   +4.368377338284269e-01   +8.084669365358368e-02   +3.055737515791929e-01   +1.366475497284566e-01   +7.644059951660132e-01   +9.122780302830762e-01   +3.407217732736229e-01   +5.702716950299622e-01   +8.571101000353873e-02   +4.898499483019224e-01; +8.838014637714989e-02   +5.339667731539108e-01   +3.456454037161101e-01   +6.528170586957603e-01   +6.315202559460027e-01   +2.685443515800691e-01   +9.587202751063340e-01   +7.418233573793236e-01   +4.692199999273062e-01   +5.023493185503902e-04   +3.846971120675132e-01   +4.502594759261508e-01   +1.150912236315710e-01   +7.146132838214037e-01   +2.283320483820594e-01   +1.277502592794770e-01; +5.462184196752343e-01   +9.783200736880198e-01   +5.604895229996586e-01   +3.491828326397599e-01   +8.588757238323386e-01   +9.279368716312123e-01   +9.639762224350568e-01   +5.433863707333271e-01   +4.436974518701486e-01   +9.365425506291128e-01   +3.615200621834767e-01   +9.803802586710586e-01   +8.526686144126117e-01   +7.333573173822064e-01   +4.520680868985738e-01   +8.537677709685279e-02; +6.105674144901289e-01   +8.439556872683730e-01   +8.900667393040641e-01   +2.566181909583228e-01   +3.765545533738121e-01   +5.535202632401597e-01   +2.420317362703422e-01   +4.861271000816217e-01   +7.340648109374571e-01   +7.402576097973661e-01   +8.110335213864859e-01   +1.110311935562679e-01   +8.916857271102311e-01   +4.549619979490189e-01   +1.788932080927653e-01   +6.741703052356202e-01; +7.281855906301892e-01   +6.721290831799946e-01   +6.463753861952182e-01   +1.766254208253091e-01   +2.035139866713861e-01   +4.333335913569223e-01   +7.707636430445239e-01   +8.955446144381218e-01   +8.757255943922703e-01   +4.324431948864155e-01   +3.857536725400346e-01   +4.158939650246324e-01   +6.861481578534034e-01   +2.822963073814322e-01   +4.148579090778099e-01   +1.219428594819464e-01; +9.908107326976560e-01   +8.245127910802610e-03   +3.770286908565623e-01   +4.777824120449520e-01   +9.119209083058020e-01   +3.284568781579097e-01   +7.125721081338592e-01   +5.828797459591165e-01   +9.130242720294507e-01   +9.438324708599062e-01   +8.713542525484937e-01   +3.833993152792466e-01   +7.426992090812288e-01   +1.517526351553714e-01   +9.663131593820051e-01   +9.897575108808871e-01];
L2I_L1I_iGABA_netcon = [+5.744604267970492e-01   +5.642749251747097e-01   +1.087456822979514e-01   +4.589742227107866e-01   +7.968313300919178e-01   +9.784607205556941e-01   +2.240391229419196e-01   +7.583945373889495e-01; +5.572016778688231e-01   +9.533970278995419e-01   +1.192435072003238e-01   +5.677917371225287e-01   +5.416021222929832e-01   +4.230833375209340e-01   +6.623068216377831e-02   +5.058056284274500e-01; +6.114196415871842e-01   +8.988150900313158e-03   +4.326602602206829e-01   +8.182485220422697e-01   +2.576102518653661e-01   +3.937688325541894e-01   +8.352525651330704e-01   +8.272853356296710e-01; +4.673006614867254e-01   +1.273620567983919e-01   +9.332818522126266e-01   +3.548254314076880e-01   +7.814349267686672e-01   +4.609942762132696e-01   +4.202556146813077e-02   +9.277515278856192e-01; +4.349143872344937e-01   +8.534000119246331e-01   +1.404158432556922e-01   +2.487720121665575e-01   +7.783044518074065e-01   +1.217780703449483e-01   +9.094845258450422e-01   +7.100037678306179e-01; +6.355452450161200e-02   +2.178298998341988e-01   +8.256049077609435e-01   +7.706927274533814e-01   +1.444925108502482e-01   +4.553802108258244e-01   +4.501539036130442e-01   +7.973125633485357e-01; +6.465060845991235e-01   +7.096893573547113e-01   +9.319723631148276e-01   +2.427653802162358e-03   +8.233458692647827e-01   +2.662021939348013e-01   +2.853815926893161e-01   +9.583586519307827e-01; +4.254020766213397e-01   +7.745609977744794e-01   +5.727326215667797e-01   +2.757917672968242e-01   +6.226221835702349e-01   +9.330094620935418e-02   +7.546505970749706e-01   +9.515744270871216e-01; +7.564387303972411e-01   +4.206445762436862e-01   +4.985076638699316e-01   +2.319207281037630e-02   +4.574198085420985e-01   +6.615441370547482e-01   +9.267798137504037e-01   +2.964016607834252e-01; +3.077797479232998e-01   +7.249914411741701e-01   +9.312948634257404e-01   +6.696197312173704e-01   +4.834228337006473e-01   +9.450255642672786e-01   +1.415029388127292e-01   +3.515768293187762e-01; +5.989358869897511e-01   +4.573558395354604e-01   +8.619151548327170e-01   +9.670238532282578e-01   +2.186839384601308e-01   +7.643993673352821e-01   +9.561652317711379e-01   +5.409467468774938e-01; +3.351134795845421e-01   +8.045970621650587e-01   +2.525560462653583e-01   +9.457697752398964e-01   +8.579224750260316e-01   +4.217903147299624e-02   +3.039682439764292e-01   +2.135849946175616e-01; +6.442894506661493e-01   +4.276203238030374e-01   +4.587611548052312e-01   +4.774655188968938e-02   +8.793882118671725e-01   +2.619867658804405e-01   +2.093278025707232e-01   +8.131101839347180e-02; +1.583964009756909e-03   +1.493889468638233e-01   +7.408280038523885e-01   +2.861049475906589e-01   +8.455776795509736e-01   +6.343618531552193e-01   +4.630326082560834e-01   +5.058946725523252e-01; +1.439536193211386e-01   +8.044610664533671e-01   +7.525053591102245e-01   +4.876103923232971e-01   +4.429122634307841e-01   +9.003314114425437e-02   +5.968811062664946e-01   +1.945275101330436e-01; +2.479520363571894e-01   +3.808806386352267e-01   +2.303053762992622e-01   +8.873571409712415e-01   +5.437248171253802e-01   +7.445846733319667e-02   +5.526852098815165e-01   +1.451287260644869e-01];
L1I_L2I_iGABA_netcon = [+6.986222492213895e-01   +8.670966946439403e-01   +6.145370195597305e-01   +5.483595733988920e-02   +1.432443872879426e-01   +2.355836950985742e-01   +8.396424971698837e-01   +3.697044022959173e-01   +7.065878891419777e-01   +3.836105519901077e-01   +2.392922102312142e-01   +6.661384924897327e-01   +1.677373115972967e-01   +5.697859788094776e-01   +4.333748611347931e-02   +4.906619002540314e-02; +5.979762483597925e-01   +7.979457642285193e-01   +6.099548815818487e-01   +5.795761680800436e-02   +7.444543241533812e-01   +5.562770925528188e-01   +1.980009791440658e-01   +5.585693837733466e-01   +1.875204005020971e-01   +7.199561003182977e-01   +5.124842315227948e-01   +3.299272215408240e-01   +1.154308263597996e-01   +8.096566101478412e-01   +4.426954399831559e-01   +9.213121571506617e-01; +1.633654987105444e-01   +6.275824430530571e-01   +3.130097163282682e-01   +5.970702319715816e-01   +9.513579496725840e-01   +1.143425749907130e-01   +6.170040589795455e-01   +8.304055032236661e-01   +2.308309516668099e-01   +6.411365858753029e-01   +7.322121539883361e-01   +5.522174518381693e-01   +7.369522693226934e-01   +6.742721125451856e-01   +9.175986461509585e-01   +1.740167824741531e-01; +4.831896628906994e-01   +4.720345024027937e-01   +1.426977622495798e-01   +6.569610586045634e-01   +2.660721352876825e-01   +8.192542104942834e-01   +1.545897956593404e-01   +7.081604225744486e-01   +9.985449691339641e-01   +1.008318946762470e-01   +7.714847148192298e-01   +5.321381557325633e-01   +2.098913022579320e-01   +4.443030571549197e-01   +8.846459635774776e-01   +7.435397645201333e-01; +2.853898994303857e-01   +1.969757153396752e-02   +6.046438486926043e-01   +4.796897786319122e-01   +9.586852647149137e-02   +6.508423833029607e-01   +5.836632003283116e-01   +1.153487615430491e-01   +9.047955851685285e-01   +4.917481256688374e-01   +6.770690153850569e-01   +9.011642475625358e-01   +4.832619142075699e-01   +8.942107611613457e-01   +9.225065478488043e-02   +4.766983561851479e-01; +4.027879236100936e-01   +1.183311858830821e-01   +8.894775683007136e-01   +9.784389173700091e-01   +2.304351449138274e-01   +2.373823483186617e-01   +5.455222122245543e-01   +7.401940773612286e-01   +1.132217080149817e-02   +5.621936496339131e-01   +8.133083041981205e-01   +2.841624305428241e-01   +5.034224427319695e-02   +7.834834830323951e-01   +6.751878751995924e-01   +2.466234301928442e-01; +4.909009066232216e-01   +7.190779355436187e-01   +5.618393741145091e-01   +8.639618623508094e-01   +8.956434841413802e-01   +3.021946701635719e-01   +6.823963055958816e-01   +9.243760612460329e-01   +8.339782171043325e-01   +5.641694368773444e-02   +4.182581618202659e-01   +1.390362500638520e-01   +5.720743031619518e-01   +5.813051822673450e-01   +9.062912091605972e-03   +6.629850652209198e-01; +8.618651844933540e-01   +6.818816418548862e-01   +6.325013501569312e-01   +9.536371430265934e-01   +1.990661778033575e-01   +3.312292541294183e-01   +6.980965402114231e-01   +9.226856356421134e-01   +2.521232348845989e-01   +8.868695614378910e-02   +4.978471583966512e-01   +9.560222063620464e-01   +4.916264046907656e-01   +6.161123065352727e-01   +1.209738954014938e-01   +6.078642351552855e-01];
L2E_L1E_iAMPA_netcon = [+3.684755311615961e-01   +5.623699828185438e-01   +1.999520893563653e-01   +5.147095323684200e-01   +2.895017986918865e-01   +7.478612431499636e-02   +2.779586172066566e-01   +2.663370501560580e-01; +4.369241643918729e-01   +1.928463010405858e-01   +1.372820813799385e-01   +6.846030755325051e-01   +6.196830011092718e-01   +5.947572649799685e-01   +9.282706848275962e-01   +9.045931020939125e-01; +7.183031314259248e-01   +6.128531191497716e-01   +8.151796219213543e-02   +2.069493494983488e-01   +8.636424617622565e-01   +7.789273176064825e-02   +7.641756837050243e-01   +1.594648951510445e-01; +1.911169825049424e-01   +7.404797428664529e-01   +9.101513709246546e-02   +9.719262510726501e-01   +8.210386168496607e-01   +3.970035809494395e-01   +2.628146655933833e-01   +5.539874669107360e-01; +4.049427737854921e-02   +8.331063386895986e-01   +5.523169467327210e-01   +3.508363810604203e-01   +2.058687365979808e-01   +6.056663370280840e-02   +2.421720992225784e-01   +4.231152131202788e-01; +3.155014980233440e-01   +2.787641706800432e-01   +7.319230624830547e-01   +1.835374461080219e-01   +7.504345947287622e-01   +1.288257834528874e-01   +1.659723919620563e-01   +5.473054401754542e-01; +7.900808672825766e-01   +6.078133909624492e-01   +5.443387829057466e-01   +2.385908271426630e-01   +1.985802079483459e-01   +2.440152071354146e-01   +2.878268857325159e-01   +7.535681813523764e-01; +4.729321825877534e-02   +5.472447050532186e-01   +5.408175210103237e-02   +2.547579760309732e-01   +5.784323635116243e-01   +9.442929166146131e-01   +5.645916905815132e-01   +1.226077883125753e-02; +2.156993877655309e-01   +2.743757241018485e-01   +6.326352452266393e-01   +2.220246430927241e-01   +8.766034785304453e-01   +2.038454638410168e-01   +4.051794184035182e-01   -9.573515635701516e-04; +2.746134359072958e-01   +3.400259818822987e-01   +9.945390641793049e-01   +3.537543471780185e-02   +7.129295710186246e-01   +3.268486311412126e-01   +9.869105097946622e-01   +2.140211319298308e-02; +7.892785063394907e-01   +5.664820697212901e-01   +9.143437811417561e-01   +3.568398098126349e-01   +7.010528623721822e-01   +8.662925133416811e-01   +5.445146999618473e-01   +3.592123104739744e-01; +9.910848770356863e-01   +7.439651818578310e-01   +7.681544980396311e-01   +8.990448602046255e-01   +4.679212142907979e-01   +9.229015977985559e-01   +9.280975498977798e-01   +4.262457234307998e-01; +9.474694807660629e-02   +7.717227620880612e-01   +1.923674721432246e-01   +1.398482540275734e-01   +5.051552052713748e-01   +2.314528966603740e-02   +9.924942717769043e-01   +5.453040902233476e-01; +1.956387624879782e-01   +3.985716120547526e-01   +3.165227890685212e-02   +9.551364952109817e-01   +7.972502805349047e-01   +3.644001164190059e-01   +8.353588139677233e-01   +4.919617533029009e-01; +1.159946839424212e-01   +1.490892741194523e-01   +3.733932409632655e-01   +9.025306657685591e-01   +9.391926003167560e-01   +5.289035591495580e-01   +1.799754113352807e-01   +9.206321941781198e-01; +6.466586476225200e-01   +2.077595703449784e-01   +5.759932568003919e-01   +4.102346330055989e-01   +7.826042816810207e-01   +4.067942515828475e-01   +3.134199336620064e-01   +4.160678971659180e-01];
L1E_L2E_iAMPA_netcon = [+4.977774613219292e-01   +4.502181482527903e-01   +6.157841471619566e-01   +4.903377656939935e-01   +2.296660681557354e-01   +7.217145784639810e-01   +6.949044507743430e-01   +6.329375407001162e-01   +5.222410137090503e-01   +2.408058402293357e-01   +8.770857883909712e-01   +1.741948626258540e-01   +1.369565898696941e-01   +2.427724076319911e-01   +1.843270900593697e-01   +2.380570803131729e-02; +8.389938762242991e-01   +3.691853602318373e-01   +1.034021198712635e-01   +6.610255165854947e-01   +8.365991346111927e-01   +3.812016076009069e-01   +9.802314084785091e-01   +6.273216017042111e-01   +6.734653943674649e-01   +7.298559212370155e-01   +6.592756685247894e-01   +3.028368018639166e-01   +2.831887947948470e-01   +7.481565237464430e-01   +1.460017996990589e-01   +2.510538219119702e-01; +1.847168235080448e-01   +2.999944218060485e-01   +7.527014516761233e-01   +1.785973263891212e-01   +7.342105609289745e-01   +3.840003706211811e-01   +7.510324802721905e-01   +4.080152505643113e-01   +7.773296291777709e-01   +1.355065561723625e-01   +5.364893605319271e-01   +1.097698297430801e-01   +6.820411450145477e-03   +9.363525278824500e-01   +1.328217735371552e-01   +9.893148096462577e-01; +3.363427951325926e-01   +2.325936631025260e-01   +5.371810005412855e-01   +4.781498546162301e-01   +4.896738260191261e-01   +7.156242959398340e-01   +5.537863363582284e-01   +4.246310847421279e-01   +4.642438207916834e-01   +4.123406578936732e-02   +2.525495640964747e-01   +4.516821355706919e-01   +3.058289925665054e-01   +3.028628543432819e-02   +1.726490481735377e-01   +6.292805730478724e-01; +6.932775358938659e-01   +1.375879346126050e-01   +4.433114320298175e-01   +4.989428117312238e-01   +8.491143478426266e-01   +8.390361257615560e-01   +2.988568966287707e-02   +5.110075571826390e-01   +9.080137517012619e-01   +6.496222186939516e-01   +1.062134089223138e-01   +5.839902464908667e-01   +9.041846004462897e-01   +4.358839936640355e-01   +9.227117256319554e-01   +3.576797817987471e-01; +6.925026474052829e-01   +1.001547897084857e-01   +7.433228481333751e-01   +6.001358001535542e-01   +7.143673787677366e-01   +6.685220842427152e-01   +1.958056692549440e-01   +2.588237687381500e-01   +2.464928465588986e-02   +2.006585419151807e-01   +9.711631468543919e-01   +2.241036585119632e-01   +2.940843684521990e-01   +8.316531294587571e-01   +2.598161516101206e-01   +9.381793502027437e-02; +3.674957199555888e-01   +2.263717635712739e-01   +3.874732700366696e-01   +2.402916878841728e-01   +5.225964292824703e-01   +6.501367156826513e-01   +9.413494809643566e-01   +4.226348400772282e-01   +4.805236603223936e-01   +9.731155114507782e-01   +5.978297168231321e-01   +1.111243833712735e-01   +8.334905583875372e-01   +9.988227542640911e-01   +2.059268911785217e-01   +4.093683291203473e-01; +3.361666224546922e-02   +3.462297885177838e-01   +5.269725389454309e-01   +5.169574543072438e-01   +9.381436934574982e-01   +5.633947834397339e-01   +3.970513501278562e-01   +5.236544677857784e-01   +2.709018962636199e-01   +8.209780384234893e-01   +8.196810550983699e-01   +5.610162389061516e-01   +7.454199652747648e-01   +9.200828316102616e-01   +6.133289064487352e-01   +9.311564900945993e-01];
L2I_L2E_iAMPA_netcon = [+6.767019334951228e-01   +6.149634076873235e-01   +4.128678723831562e-02   +7.931245661845338e-01   +5.238044148192192e-01   +8.251827438630278e-01   +6.449289978400528e-01   +3.862165609992496e-01; +2.299458851873851e-02   +9.445664711905608e-01   +5.479264320624518e-02   +9.302568143515331e-01   +5.377531851118880e-02   +1.083178776099197e-01   +3.993009636626714e-02   +1.664303783310357e-01; +7.340173192812099e-01   +9.641983719011026e-01   +4.011526509511900e-01   +9.365731700683684e-01   +2.872056133749729e-01   +2.325018166937482e-02   +5.675560376900267e-01   +4.438533388874568e-01; +2.138272408157554e-01   +3.696383390799388e-01   +9.835501434281884e-01   +1.466136889419926e-01   +7.092002989768490e-01   +1.197828935906238e-02   +3.047894775761242e-01   +8.734861303447508e-01; +8.604232755196081e-01   +7.955068019105694e-01   +7.124834193711840e-01   +3.188407440572599e-01   +8.787839132452235e-01   +3.364646336375758e-01   +2.606502419230142e-01   +4.105026486178106e-01; +1.569335319956294e-01   +7.290435218525092e-01   +9.884168068360812e-01   +4.287295229272534e-01   +3.662645174621870e-01   +6.631728795831365e-01   +7.218429432671873e-01   +1.629973202201253e-01; +6.688659843357121e-01   +9.540442518178709e-01   +6.457961952659091e-01   +7.017484974082586e-01   +5.606030839570069e-01   +5.947166291340097e-01   +3.050364521482888e-01   +6.619808056876467e-01; +9.346480618633916e-01   +1.093897261171498e-02   +5.014562987205389e-01   +6.146749926683542e-01   +8.846075020645636e-01   +7.982424136987908e-02   +8.957215773113432e-01   +9.256262863656270e-01];
L2E_L2I_iGABA_netcon = [+6.043777216210747e-02   +5.205178574554479e-01   +3.525916004703878e-01   +2.611636776636967e-01   +4.168559829172106e-02   +8.905746899465389e-01   +3.436098779320733e-01   +4.516256697770846e-01; +3.545953198846710e-01   +6.913957596927618e-02   +5.579559010638191e-01   +9.846216747321156e-01   +3.608602554343543e-01   +5.404503973988252e-01   +9.349191256977806e-01   +6.714273981543467e-01; +9.323235211049429e-01   +1.845143309207122e-01   +6.911661145198079e-01   +3.489936935546499e-01   +3.576631707750715e-02   +7.175623912882049e-01   +9.183767382163366e-01   +7.691710319390611e-01; +2.404493288389817e-01   +3.163697026100104e-01   -6.852022276802940e-03   +4.018407227513740e-01   +4.857205764522661e-01   +7.102490099306631e-01   +7.251081007613319e-01   +9.274199621022090e-01; +1.034908837912742e-01   +2.443072534227896e-01   +4.800838465187598e-02   +7.520311331103814e-01   +7.225641564185962e-01   +1.682206647759068e-01   +4.433111769178444e-01   +6.587019899937945e-01; +7.155892970294176e-01   +3.214524914800642e-01   +3.081145240958895e-01   +1.019962686278843e-01   +1.396553162843662e-02   +3.517016226153410e-01   +1.525809248152820e-01   +5.016312573211738e-01; +5.888681587737446e-03   +8.801100196264418e-01   +8.693746374561905e-01   +5.909861682763345e-01   +5.172071356948449e-01   +3.790359875779389e-01   +8.322614191283294e-01   +3.426613821475228e-01; +1.851965819343732e-01   +3.014448982313658e-01   +6.272437616599702e-01   +1.224409445526237e-01   +2.398764664395388e-01   +7.580076792888267e-01   +2.575411472211976e-01   +9.462880619583378e-01];
L3E_L2E_iAMPA_netcon = [+7.939853548169572e-02   +1.618334658175294e-02   +3.678087565609125e-01   +4.972732656024920e-01   +1.784933019133749e-02   +9.549623401592194e-01   +3.603976183453274e-01   +1.413191101208802e-02   +2.042563789513690e-01   +6.145703045631948e-02   +2.431605724873719e-01   +9.990850991618567e-01; +9.516963886080747e-01   +9.767115823038981e-01   +1.153345408000519e-01   +6.510704398752094e-02   +8.067791667607542e-01   +3.874253076020120e-01   +2.234090099569159e-01   +1.226299254286451e-01   +3.557185302470401e-01   +7.410830252091977e-01   +5.329267303099767e-01   +3.449904238711030e-01; +6.631896207935927e-01   +7.256963015052517e-01   +5.137434337161038e-01   +8.616637493187853e-01   +7.926165045222702e-01   +6.638199055834102e-01   +7.246043737628299e-01   +6.695100388750003e-01   +8.882547314316367e-01   +9.907318848129252e-01   +3.334184592989134e-01   +8.226599217119295e-01; +1.690311757098557e-01   +8.710698856850885e-01   +7.122863084090586e-03   +9.966237054624008e-01   +4.231926511836161e-01   +5.842618681855125e-01   +7.730236059561686e-01   +5.076155509280978e-01   +8.095590197799104e-01   +7.674597442403698e-01   +6.740776705766731e-01   +1.104029937727356e-01; +1.959936416574444e-01   +8.146498586549351e-01   +8.696243715931797e-01   +1.226860018373140e-01   +6.298302755655315e-01   +5.945541427377643e-02   +3.429227258013456e-01   +7.087072847949866e-02   +3.189189138167070e-01   +8.815249098298023e-01   +8.749209173186078e-01   +7.737453757687397e-01; +9.943752925461635e-01   +3.135882836203340e-02   +9.046395095100168e-01   +1.003238255885485e-01   +5.678032164616479e-01   +7.630957808538240e-02   +5.774469330352582e-01   +5.357565658297087e-01   +5.996042472796991e-01   +3.616045862973500e-02   +9.824393156892055e-01   +1.498787730732291e-01; +9.249282758248851e-01   +9.609900905727226e-02   +1.126726215594572e-01   +1.490959515852369e-01   +8.957601025139089e-01   +2.266095757028955e-01   +6.427562953069170e-01   +6.787884821499276e-01   +6.981634954359318e-01   +7.934887326286277e-01   +1.447088980743357e-01   +7.324004807986442e-01; +9.817047187908031e-01   +8.550957758631607e-02   +4.509769556485811e-02   +1.288900351559955e-01   +7.490439371323401e-01   +4.194977592391301e-01   +3.658742291713710e-01   +5.881730682701541e-01   +1.785544448286368e-01   +7.067174092122640e-01   +8.775119949229536e-01   +1.096191003121725e-01];
L3I_L2I_iGABA_netcon = [+7.675905979923113e-01   +5.353274048123705e-01   +5.975149215331409e-01   +3.052458023960796e-01   +9.664208250409827e-01   +1.152955245136509e-01   +2.980286043518555e-01   +7.956739144555192e-01   +9.143250856033787e-01   +9.942870277271441e-01   +3.093590709081265e-01   +9.967637767964802e-01; +6.373107736877616e-01   +4.524262422918158e-01   +5.623786802875802e-01   +7.623047366812008e-01   +5.441389459402578e-01   +6.949611896623907e-02   +1.693343408485505e-01   +5.187830078243975e-02   +3.861996476507298e-01   +2.867240243962912e-01   +4.422220528049220e-01   +9.142550183441952e-01; +7.970770179010808e-01   +1.140275596924554e-01   +6.829567149868068e-02   +6.474865697511252e-01   +9.808055830818510e-01   +5.140297248342857e-02   +7.241496603404576e-01   +1.811012298019584e-01   +7.501483360923024e-01   +5.160229008049640e-01   +2.088035371915868e-01   +6.917615585973370e-01; +9.600539016879064e-01   +7.207311793508414e-01   +7.682697819432869e-01   +3.318971187637752e-01   +1.245555873545092e-01   +1.296853981122369e-01   +2.985109678741407e-01   +2.468115472131305e-01   +8.797172099381205e-01   +3.595169565840741e-01   +9.405614413935206e-01   +2.211599279703302e-01; +7.168628395185248e-01   +1.864986879203286e-01   +8.681734244027921e-01   +9.709013665436054e-01   +1.681602426542289e-01   +4.918103866988081e-01   +6.774090885783476e-01   +2.616083541723097e-01   +3.925541417053966e-01   +5.179186027392588e-01   +2.899376405079624e-01   +3.157600206988018e-01; +6.432788957557246e-01   +3.246347287320673e-01   +7.082968963035682e-01   +5.323121497976421e-01   +3.339408269592763e-01   +4.676709324324916e-01   +7.460941442525456e-01   +6.477543008073441e-01   +1.676472892318964e-01   +5.015095091679269e-01   +1.221290217562908e-01   +2.366311743951214e-01; +5.123760892668621e-01   +9.662942946673455e-01   +1.076999438882017e-01   +7.514217924063822e-01   +5.314804422948017e-01   +1.582515039599169e-01   +7.457571024510911e-01   +9.754608696722479e-02   +4.367041003668700e-01   +1.882223359174243e-01   +6.946809603651009e-02   +7.081455556498448e-01; +9.515472933068343e-01   +7.012603373960311e-01   +6.662164218790815e-01   +2.686497765406258e-01   +6.929745302012541e-01   +1.385427090123196e-01   +7.846073545546578e-01   +4.696330616939463e-01   +8.575335647385247e-01   +4.779215466477642e-01   +7.288100582684057e-01   +3.761950834983081e-01];
L2E_L3E_iAMPA_netcon = [+6.571001008543615e-01   +3.870133835470426e-01   +2.357105340508274e-01   +4.649277712831197e-01   +9.039027670672960e-01   +9.503478954002882e-01   +7.619994473892872e-01   +3.549328521149896e-01; +3.832705146337655e-01   +2.286700620694544e-02   +9.055903816479542e-01   +2.841272222433015e-01   +6.797896220087336e-01   +2.554929581689411e-02   +9.038139949870110e-01   +6.633858841985114e-01; +3.084751541189465e-01   +3.296461936132038e-01   +4.869848876640260e-01   +2.761260065618638e-01   +8.430692155468613e-01   +5.016104175157985e-01   +7.964133739252712e-01   +5.920745495388631e-01; +1.568069032907862e-01   +4.851036094736337e-01   +5.949382209966078e-01   +1.429120029048639e-01   +9.483253735092914e-02   +3.399592870116297e-01   +9.560236429493798e-01   +5.371784857597365e-02; +7.771676167316449e-01   +2.632393410306407e-01   +9.555465102730384e-01   +1.400738272514381e-01   +7.344665109553797e-01   +6.724005563227994e-01   +5.353290070452583e-01   +2.160924904660564e-01; +7.088114953744973e-01   +5.250925137594502e-01   +8.512838142944805e-02   +2.639956345221741e-01   +5.438683544070794e-01   +1.674003593971256e-01   +1.632711419208284e-01   +6.011370297126586e-01; +1.723238200544235e-01   +4.158382973110558e-01   +2.220067161373301e-01   +6.111210978905188e-01   +2.566447644291822e-01   +2.257748340137392e-01   +1.341486764713036e-01   +2.696126856950841e-01; +4.484902655483964e-01   -4.160164128573987e-03   +1.526420933003464e-01   +1.062790035568821e-01   +7.144607044082378e-01   +1.178562273406523e-01   +3.298427896670474e-02   +1.089389836747991e-01; +8.372884207133259e-01   +8.934644938519486e-01   +3.903672176131325e-01   +4.843547261357148e-01   +3.602808899341632e-01   +9.932513727231238e-01   +6.812242491635462e-01   +2.112851430843759e-01; +6.985123790580308e-01   +2.398867275242433e-01   +1.852854456708065e-01   +8.937089865974007e-01   +8.532166656818007e-01   +1.398884342330778e-01   +5.870884529966776e-01   +8.728905277185738e-01; +7.650449491493018e-01   +7.917599185643325e-01   +7.635743166747236e-01   +1.890561355543789e-01   +8.187091905937813e-01   +7.697451413718160e-01   +2.983273155050100e-01   +4.589401124608342e-01; +9.810526545723276e-01   +5.780729560182992e-01   +2.284468681037815e-01   +5.238349128387552e-02   +6.101978043694376e-01   +6.339773465299535e-01   +7.421210912051239e-02   +7.264642728348956e-01];
L2I_L3I_iGABA_netcon = [+5.893043464346375e-01   +1.469166695338139e-01   +3.442278385243491e-01   +3.695157768858961e-01   +5.990736504217580e-01   +5.066684779081988e-01   +7.729152777603473e-01   +2.647487435261061e-01; +8.455862624053082e-01   +9.903999387807956e-01   +4.614793253101652e-02   +5.369804386893885e-01   +4.780752052573471e-01   +2.375787192261543e-01   +1.790207482788748e-01   +5.853851776328945e-01; +6.046601381633704e-01   +4.804530492787638e-01   +9.419349239472866e-01   +9.751148156146681e-01   +3.767512759101138e-01   +2.726285081364108e-01   +4.544520248423218e-01   +6.797840650370751e-01; +7.443552051683253e-01   +3.670311173316496e-02   +8.667403046523573e-01   +9.969282063424546e-01   +9.793962439539576e-01   +4.053685279754755e-01   +3.063776664418207e-01   +4.155852367312849e-01; +8.493838676627168e-01   +2.699452382227638e-01   +1.333541934456359e-01   +4.143580078586808e-01   +1.388000810831769e-01   +2.611398091777697e-01   +3.877132354250440e-01   +5.112454006064251e-01; +1.457238044648386e-01   +6.754748259745178e-01   +5.905286786900805e-01   +4.501452666170978e-01   +2.711170004470936e-01   +8.543504172709142e-01   +8.037468365846969e-01   +8.138750932235851e-01; +7.427794378716414e-01   +1.457955640468134e-01   +6.265536766669905e-02   +2.543661299076674e-01   +2.267536114911793e-01   +4.789042474900757e-01   +7.773804285929808e-01   +5.446987435669663e-01; +1.733025904622913e-02   +7.728138405666567e-01   +9.468394270451446e-01   +6.002937218122050e-01   +7.921467717243562e-01   +3.419462615452877e-01   +6.469534143699311e-01   +5.899028907177801e-01; +2.284133148516373e-01   +2.673569593767074e-01   +4.973898268917078e-01   +7.752572032534938e-02   +8.182068799384768e-01   +6.390378098373399e-01   +2.424383174647795e-01   +5.353496183560668e-01; +5.377269709044350e-01   +8.801862500123573e-01   +2.686143176112189e-02   +9.124852263365566e-01   +7.931568560388523e-01   +4.152807419196191e-01   +6.080507533275056e-01   +5.406849379255297e-01; +7.203345763228004e-01   +3.694087271486050e-01   +5.789281867795429e-02   +4.729929697748332e-01   +1.125702207459156e-01   +5.440126983213890e-01   +4.188123711367328e-01   +1.509927702901740e-01; +4.348472998967538e-01   +9.997032692640864e-03   +3.008721430259588e-01   +5.080034879727736e-01   +6.327346766523246e-01   +3.399574088673748e-01   +2.945934534600680e-01   +7.039253137941928e-01];
L3I_L3E_iAMPA_netcon = [+6.400769339210360e-02   +7.721857202167071e-01   +5.545685462811356e-01   +5.734217215556183e-01   +9.201249462551435e-01   +8.356006813700844e-01   +8.506220348147022e-01   +8.627947415905413e-01   +5.329801879608153e-01   +9.880238702991649e-01   +4.826784857409794e-01   +3.503109954955279e-01; +9.224942002893926e-01   +8.388402941025823e-01   +8.441210771731925e-01   +9.360543497045926e-01   +5.924308524630032e-01   +3.921764079270670e-01   +6.293470028896545e-01   +8.569813076923418e-01   +5.678870366754444e-01   +7.009051117088084e-01   +7.395953542569934e-01   +4.003091801940372e-01; +1.802086676702710e-01   +5.935884673228825e-01   +9.693615856006903e-01   +7.791660939793709e-01   +5.753164534658783e-01   +6.965642635076731e-02   +4.445347400529231e-01   +9.488672449122488e-01   +9.795319313926022e-01   +8.444291375032076e-01   +5.942489027691050e-01   +9.872337341547566e-01; +5.428387905215445e-01   +7.665289979840413e-01   +4.653309764785428e-01   +5.960146122496430e-01   +6.581262509719762e-01   +3.740002944991288e-01   +2.348903567602708e-01   +6.944678433079948e-01   +9.680929277088002e-01   +7.387527620264462e-01   +2.631230944770979e-01   +2.972305643162921e-01; +3.988169979029118e-01   +6.591281423473618e-01   +7.759441845549458e-01   +5.780479370867436e-02   +4.350310834371773e-01   +8.495741707014599e-01   +5.065527095795356e-02   +3.627767633049904e-01   +5.607812224564651e-01   +9.954736273716210e-01   +6.067752825737797e-01   +2.243551669558525e-01; +9.800384450979928e-03   +5.894153443535226e-01   +2.182075559290518e-02   +5.443687598973745e-01   +9.353603418017248e-01   +2.576954738589762e-02   +7.120912182019213e-01   +3.731702243912635e-01   +5.321922397155184e-01   +5.070438941957904e-01   +2.316110609469582e-01   +3.307446454313036e-01; +1.025225354398327e-01   +2.550483949605549e-02   +6.778823767344178e-01   +8.652144679135694e-01   +1.036203358629455e-01   +4.217039988717219e-01   +8.481631897038773e-01   +8.417887920886831e-01   +4.793389474323510e-01   +1.895472531864721e-01   +1.955061037018669e-01   +1.645742780540546e-01; +8.563576664063640e-01   +6.930773631414383e-01   +8.349503853723210e-01   +3.379478455228120e-01   +4.092773041461423e-01   +2.542468783964053e-01   +4.054703528312318e-01   +3.841860466567330e-01   +9.016308071991739e-01   +9.594914483178854e-01   +2.234123273788144e-03   +3.836162554272997e-01; +3.376974873196067e-01   +3.276171635490646e-01   +6.840445706546232e-01   +1.785374813105325e-01   +8.920785423700317e-01   +7.354421130728662e-02   +2.865137598145236e-01   +7.699944126392786e-01   +4.818789658999559e-01   +4.513358427470999e-01   +6.462699062555141e-01   +5.254912174182694e-01; +1.496281603114131e-01   +7.662553953326189e-02   +8.956212784077477e-01   +8.809270206712628e-01   +7.387643088914004e-01   +9.196933160809632e-01   +2.619712146827696e-01   +7.736123831304410e-01   +4.860944865367647e-01   +6.060599253746971e-01   +4.005553205801534e-01   +5.963273987413608e-01; +8.078071398065820e-01   +7.443644885727964e-01   +9.584366048290408e-02   +8.420658803204043e-01   +9.587358782825496e-01   +2.691186950716106e-01   +5.056087309004338e-01   +4.325830290496703e-01   +3.137627159024437e-01   +6.443957067629950e-01   +2.713024129810014e-01   +1.691005419760422e-01; +6.545088256604925e-01   +9.647926315969204e-01   +6.984688418440230e-02   +8.342489552551201e-01   +9.701417879839165e-01   +1.018850462918933e-01   +1.167347413264951e-01   +4.868817279129277e-01   +8.595305987620047e-01   +7.657721087695006e-01   +2.988478536807736e-03   +7.322463340871176e-02];
L3E_L3I_iGABA_netcon = [+4.375614560762611e-01   +7.117752696320157e-02   +5.837722347654335e-03   +4.957287601247891e-01   +5.432270094919595e-01   +2.524719092211642e-01   +7.176086825523851e-01   +7.623153531113879e-01   +3.781969596022233e-01   +4.485024622144990e-01   +1.997765179673296e-01   +6.499894870899385e-01; +5.744865665499593e-02   +8.071257819571714e-01   +1.320581516740408e-01   +1.927538286001670e-01   +2.108604200399281e-01   +3.338001172801526e-01   +2.215864249343394e-01   +8.882163662048776e-01   +6.100593003813967e-01   +3.937318418997675e-01   +8.281952837222947e-01   +8.993490661912991e-01; +6.262539998177017e-01   +9.091432553186679e-01   +3.086930447403959e-01   +6.418947648338793e-01   +2.704116684102474e-01   +5.918086765567144e-01   +4.982271072241182e-01   +7.322274396660859e-01   +1.679432737473283e-01   +6.685995355527340e-01   +4.465656210039688e-01   +8.377494869276055e-01; +7.988603756486895e-01   +4.252841779131312e-01   +2.387418430731018e-01   +2.560280522601420e-01   +1.322398922710665e-01   +4.815360494022946e-01   +4.754286931831734e-01   +6.970326372224803e-01   +1.050531798131768e-01   +3.279667821011507e-02   +4.233701725057726e-02   +1.706873443969993e-01; +4.011491979303615e-01   +1.839964357252531e-01   +6.485197617461572e-01   +9.493803876819433e-01   +1.640559778533300e-02   +8.978438286137933e-01   +4.313758679395516e-01   +6.458706981344281e-01   +6.253332982285151e-01   +7.874236236035114e-01   +7.685630329130351e-01   +1.601265841071042e-01; +8.833653245139415e-01   +1.826857421992658e-01   +8.078744376587237e-01   +2.877801886961400e-01   +1.512420232115080e-02   +2.947539629880725e-01   +5.558971974616251e-01   +6.192584171261643e-01   +9.512062962953853e-01   +3.787805041256394e-01   +9.711449697747868e-02   +1.359062783378038e-01; +7.234518257510727e-01   +6.725129941587458e-01   +7.410981567092128e-01   +1.491164187110111e-01   +9.792356102852392e-01   +7.886269455331346e-02   +2.067953460687045e-01   +7.775149339636590e-02   +6.658863107824741e-01   +6.509076393111376e-01   +6.527742065903389e-01   +1.596458275602449e-01; +1.970124098137129e-01   +5.240175077100216e-01   +1.221739576676429e-01   +8.709121948645462e-01   +6.468905712717696e-01   +3.921807982818872e-01   +2.766390222059565e-01   +5.483806986323181e-01   +4.718184772572772e-01   +4.975913304998766e-01   +2.708552538913011e-01   +3.937776232953582e-01; +3.744434614279155e-01   +7.770100645525501e-01   +1.720037364946189e-01   +8.863523977601696e-01   +8.166982120412409e-01   +1.984914896721096e-01   +8.133555871800433e-01   +8.845454433136419e-01   +3.405643704831294e-01   +2.128276658584326e-01   +4.372351949252526e-01   +6.662396887197689e-01; +2.129158042512555e-01   +2.997133791801611e-01   +2.732124896745569e-01   +6.686358522111362e-01   +2.765054237820858e-01   +7.221312045818188e-01   +9.519829848176657e-02   +9.869967230894232e-01   +5.904104819543586e-01   +2.158461532354603e-01   +8.493501290626884e-01   +2.231881066521475e-01; +2.587605483459123e-01   +4.733788243452767e-01   +8.138870382594834e-01   +9.977554139528645e-01   +1.458146944384952e-02   +4.211976260769445e-01   +3.266786337197699e-02   +7.154641965210219e-02   +5.465792671059302e-01   +4.511059168703135e-01   +9.020774636080244e-01   +6.434352947270713e-01; +9.923120034983810e-01   +7.071897950233794e-01   +5.913103731737862e-01   +2.681297197738691e-01   +1.019081684527547e-01   +2.672575757349400e-01   +6.455233691995819e-02   +3.278187653608516e-02   +3.894607041392879e-02   +6.290153076953988e-01   +2.851740019697238e-01   +6.123221786461981e-01];
L2E_Input1_iAMPA_netcon = [+9.929881117534357e-01   +9.901058740749638e-01   +9.992936633884276e-01   +9.872450347475449e-01   +9.855193608034980e-01   +9.996102555508496e-01   +9.838006991806342e-01   +9.976661210404103e-01];
L2I_Input2_iAMPA_netcon = [+9.914514093348117e-01   +9.995105723395772e-01   +9.852250187218584e-01   +9.956801024258189e-01   +9.891310458490450e-01   +9.889417506163964e-01   +9.966676453012063e-01   +9.970759688996009e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
