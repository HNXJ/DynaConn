function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.239023033605645e-01   +4.510769477528986e-01   +3.970836071713403e-01   +4.046136081697378e-01   +3.215227843067473e-01   +5.667808390522417e-01   +1.834527620107083e-01   +3.496389760182246e-01   +7.117030742105974e-02   +2.374914504154770e-01   +2.500340906297050e-01   +6.156641814013120e-01   +5.317302036412275e-01   +4.318086900470760e-01   +3.690814081336758e-01   +1.798040005188915e-01; +8.603174653746906e-02   +2.132541396932231e-01   +7.660036803222470e-02   +2.884345145542122e-01   +5.727133650381598e-01   +3.057466344197555e-01   +1.044513357107324e-01   +1.893636829368122e-01   +1.790070006044175e-02   +1.569681368025851e-01   +3.441966856656398e-01   +3.409394096023433e-01   +9.461727437263358e-02   +4.586760958693425e-01   +1.965651502182965e-02   +7.402973724687582e-02; +4.247186048667447e-01   +1.699140300644722e-01   +3.181648105351321e-01   +1.367526168043621e-01   +4.109919947999123e-01   +6.059923712024586e-01   +4.936560292338538e-01   +9.887865388664996e-02   +1.672571136312102e-01   +9.674624453878369e-02   +6.263307015775320e-01   +3.965111298284497e-01   +2.683832444774719e-01   +2.144429834397966e-01   +3.167310466704704e-01   +4.059136019518077e-01; +4.488699151599027e-01   +1.378510455380376e-01   +1.543376570839190e-01   +1.296200431722505e-01   +2.498427115371178e-01   +4.817714463613539e-01   +7.153443632997582e-02   +5.721483371024083e-01   +4.970928965975494e-02   +3.237667142123636e-01   +6.985972583398434e-02   +6.245961151185666e-01   +2.217821022393559e-01   +6.371348136143891e-01   +3.673289662863247e-01   +3.319595399157435e-01; +2.704349757485895e-01   +2.308089223701945e-01   +6.087950741938672e-01   +2.891202113976016e-01   +6.095690969690224e-01   +5.238649922368496e-01   +5.451091162230306e-01   +4.559610752227762e-02   +2.991155052558330e-01   +1.130221625043545e-01   +4.711531405413342e-01   +3.228101329192971e-01   +3.795841522181828e-01   +1.076234342504645e-01   +2.032425258884764e-01   +3.002676353451081e-01; +2.588319859384545e-01   +1.282564795145858e-01   +3.717368805541289e-01   +1.207587634898875e-01   +4.555225751543066e-01   +2.202158863681431e-01   +1.038354677913549e-01   +2.000573887452718e-01   +1.181154271590271e-01   +4.166449526299392e-01   +1.826460634579891e-01   +1.572421296013868e-01   +4.695925774589428e-01   +3.273071816935222e-01   +1.206678161167231e-01   +5.984459597055459e-01; +2.381855527864146e-01   +5.083718095538998e-01   +2.078515413707243e-01   +2.157644447051548e-02   +6.205681592340581e-01   +2.502498218370446e-01   +2.699129715418347e-01   +4.810109334178177e-01   +4.176023127179825e-01   +2.181672667513221e-01   +6.299676826402306e-01   +1.648898798771118e-01   +1.544333643105291e-03   +1.123062240658981e-01   +4.480744298771815e-02   +4.751439306867725e-01; +4.309245448728518e-01   +2.805156427973892e-01   +6.285389766991737e-01   +3.111988880914568e-03   +2.423442502766306e-01   +5.867814520541323e-01   +9.147235870105201e-02   +4.328151343072087e-01   +1.321397889210149e-01   +2.285765247164684e-01   +5.346509456211265e-01   +3.417984100665376e-01   +3.757609211777341e-01   +3.940027820331546e-01   +3.441524493378505e-01   +4.931563872483273e-01; +5.464905521256508e-01   +2.270301392480100e-01   +4.965603013191139e-01   +1.163944576263486e-01   +3.756258481546686e-01   +4.296729030919776e-01   +5.034172806950840e-01   +2.025845395842431e-01   +4.841251979055131e-01   +2.145503483529577e-01   +9.078826404047190e-02   +5.627873381116495e-01   +5.992615002867627e-01   +4.864565984747348e-02   +3.760845509524777e-02   +5.304490068871690e-01; +5.424478547942548e-01   +3.999938957888135e-01   +1.847140028589283e-02   +3.258821668511805e-01   +2.335833823487062e-01   +3.034068441746263e-01   +2.952207040794909e-02   +5.957117705853603e-02   +1.953172298913683e-01   +4.849872606058492e-01   +1.847720173549863e-01   +5.387256579028252e-01   +3.694789545491944e-01   +2.500309850098250e-01   +1.679098560694344e-01   +2.349233280783432e-01; +4.926035682561648e-01   +4.075552741117410e-01   +4.490130302368939e-01   +4.728388018485225e-02   +5.491322513354506e-02   +5.327752965412137e-01   +4.242653231068435e-01   +6.025072100635850e-01   +2.160026382259546e-01   +4.792473118479318e-01   +5.634523280649375e-01   +1.475407925324107e-01   +2.829476468125430e-01   +5.182075834679184e-01   +2.985855474242898e-01   +1.852082366412811e-01; +1.662169534579833e-01   +2.856416475443930e-01   +5.594775612605438e-01   +2.335688143863712e-01   +1.063159991533802e-01   +6.246696247149363e-01   +1.509747478207827e-01   +2.285098202414446e-01   +4.208056364476986e-01   +6.013649354817713e-02   +5.303013739970239e-01   +3.178097809657945e-01   +5.968446408178248e-03   +2.912757666979393e-01   +3.707681433791040e-01   +5.327329915067965e-01; +1.936371002561461e-01   +5.905044621264138e-01   +3.190653567576269e-01   +2.229935777153658e-01   +3.795510211624423e-01   +4.569657511606154e-01   +4.977024335452194e-01   +6.204029187176729e-01   +1.336620278373691e-01   +5.155571380250857e-02   +3.763609120809032e-01   +6.606328395451562e-02   +3.551831853512025e-02   +2.046273523588839e-01   +6.231819031682704e-01   +5.224998527100421e-01; +1.887436562613220e-01   +1.539707616466647e-01   +6.160598561228666e-01   +3.187746540237804e-01   +6.376018151584663e-02   +7.662790511300833e-02   +2.236658199494538e-01   +4.394423739067349e-01   +4.274320513604575e-01   +8.431135947757316e-02   +2.531683056700071e-01   +4.330014062650879e-01   +5.445288913673931e-01   +8.924850922447310e-02   +5.743995758729322e-01   +5.681357733626220e-01; +3.499324034624937e-01   +2.817128186541361e-01   +8.340457745170035e-02   +6.246810954375965e-02   +3.834278678112719e-01   +3.069328569637567e-01   +1.013323528883991e-01   +1.518098608510578e-01   +4.052377049115134e-01   +8.731257317613995e-02   +5.431951007629190e-01   +3.035693031758758e-01   +2.051916371920701e-01   +3.929032937507353e-01   +5.092241315775299e-01   +3.001414195487543e-01; +6.144782534577179e-01   +1.799096046028077e-01   +1.741129177317879e-01   +5.436665968677352e-02   +2.571530020638092e-01   +2.684959454805240e-02   +2.770638804560662e-01   +1.752291736886990e-02   +8.062978935489679e-02   +4.152046226967493e-01   +3.436401072623460e-01   +5.599643163415778e-01   +3.952235806308961e-02   +3.625337100766022e-01   +6.348474532804306e-01   +3.897427741912274e-01];
L1E_L1I_iGABA_netcon = [+6.033907976931885e-01   +4.545702937955484e-01   +4.659687170474417e-02   +2.931690255472268e-01   +5.725906405773892e-01   +2.817528537848713e-01   +2.737162955904336e-01   +8.176699611977170e-02   +1.250774601994710e-02   +3.768994566077974e-01   +1.034037907967370e-01   +3.725647075984543e-01   +3.222599197274366e-01   +4.542345712402626e-01   +1.564378496255959e-01   +5.694496581162120e-01; +6.044887640488601e-02   +4.144858729768259e-01   +2.833128477542886e-01   +4.669203272925311e-01   +5.165894762300053e-01   +1.788195848503845e-01   +4.284825285993214e-01   +2.031299912895839e-01   +5.249169516933133e-01   +1.949415837215715e-01   +3.730417488429162e-01   +6.097124780660848e-01   +3.121162477463883e-01   +5.470829402419564e-01   +1.693746827235716e-01   +4.748703040704785e-01; -2.907084895191734e-04   +3.079604183995125e-01   +2.763521111926546e-01   +1.480866969506185e-01   +4.159285701444713e-01   +2.870563576133860e-01   +7.794183197582946e-02   +2.394846032295258e-01   +2.787065976674644e-01   +3.381264428054424e-01   +1.842240527089753e-01   +3.725481115911520e-01   +2.734903986651919e-01   +3.874964685388246e-01   +6.037442636851841e-01   +1.475379206885698e-01; +1.147499675685714e-01   +2.756536870410728e-01   +1.602729726243419e-01   +1.775330164237279e-02   +5.521914986340865e-01   +3.509851805864168e-01   +3.374116865333987e-01   +2.498345788456493e-01   +4.172842679306341e-01   +1.044782769596338e-02   +3.372313295889187e-03   +3.851173697099305e-01   +4.274711806540345e-01   +5.146920181476587e-01   +5.905681855228494e-01   +4.131756620013360e-01; +2.582390802379395e-01   +1.814714746968096e-01   +4.581648668779917e-01   +1.583232801442181e-01   +4.384127757411111e-01   +5.797834713337081e-01   +3.856203229616184e-01   +1.147911234337213e-01   +3.031864747193404e-01   +4.906791933295556e-01   +3.507422835161378e-01   +5.159657743225664e-01   +9.194849743349745e-02   +2.458212798428162e-01   +3.202220359064508e-01   +5.029806050460515e-01; +6.606350757855059e-02   +7.256813010988558e-02   +5.599048532959379e-01   +6.111302456470687e-01   +4.265044899085750e-01   +1.080576133092743e-01   +4.401027241060630e-01   +3.932787763454061e-01   +1.357642128858993e-01   +2.894864782657338e-01   +7.558005613340252e-02   +8.606467904433486e-02   +9.387206945465012e-03   +6.310765627984909e-01   +3.863121779409853e-01   +1.897844807565545e-01; +4.626630259824230e-01   +3.900626876480494e-01   +7.437534615603275e-02   +3.152077754056307e-01   +5.798365701233356e-01   +1.969468949732777e-01   +1.387768732481239e-01   +2.995501264545885e-01   +7.043811753728062e-02   +2.861524804110211e-01   +4.718362846028229e-01   +5.935161516613442e-01   +5.275992379648472e-01   +1.940701869239239e-01   +1.019901009738915e-02   +6.006988999320358e-01; +5.065226161342989e-01   +6.171372367896714e-01   +4.418516501473405e-01   +4.405781444974281e-01   +6.991742150577646e-02   +2.530895596980495e-01   +4.314593475496888e-01   +1.982902161667545e-01   +4.902060630233053e-01   +1.423681538111895e-01   +3.862207884920445e-01   +2.106691914007510e-01   +9.801157764810295e-02   +3.426869266882986e-01   +2.174066516886740e-01   +4.271757940085309e-01; +1.733804589001502e-01   +9.217687050208026e-02   +2.890400535410552e-01   +5.133312361082535e-01   +2.673874946700947e-01   +6.115644075007282e-01   +2.027454452059477e-01   +5.925603939513813e-01   +1.947986986433794e-01   +2.082533750886224e-01   +1.983278856163861e-01   +4.395429992868161e-01   +4.089023790216949e-01   +3.022320103948401e-01   +3.750089563808345e-01   +3.671110567334884e-01; +6.272658248266613e-01   +3.251320136920212e-01   +6.189627780625891e-01   +6.271760423806017e-01   +6.015875405610464e-01   +9.925649140071965e-02   +4.608379411517348e-01   +6.176522702427218e-01   +4.540349055640240e-01   +2.686104747506393e-01   +4.110182297437535e-02   +1.740087494927880e-01   +1.989100308949794e-01   +1.285502497370454e-01   +5.862258757726069e-01   +3.563805062327672e-01; +4.479086107025448e-01   +4.242414222929244e-01   +1.604676113696516e-01   +3.689721231794618e-01   +1.919013973059289e-01   +1.874869249948282e-03   +4.627532838226963e-01   +3.421470298266286e-01   +6.121166264553766e-01   +4.449667169135100e-01   +2.228346595003839e-01   +5.159069437133131e-01   +2.146456476522560e-01   +1.126647386861217e-01   +4.148132625966661e-01   +1.596135366480861e-01; +5.215131969620390e-01   +4.966168540451897e-01   +1.339502086569402e-01   +5.590740925272513e-02   +2.924068043792373e-01   +5.963590103889133e-02   +8.578010197551211e-02   +4.788680616214755e-01   +4.571489147695666e-01   +5.187700845870830e-02   +1.011890786921563e-01   +3.995448891787027e-01   +3.747808034862267e-01   +5.289767851264489e-01   +3.196948165354817e-02   +1.891926360880110e-01; +2.688750438020155e-01   +6.065063572959145e-02   +3.633757980450839e-01   +6.194171976293280e-01   +3.474728309651738e-02   +6.861818506058825e-02   +6.392130889045549e-01   +5.693494120752607e-01   +1.748913674270261e-01   +5.520481676571377e-01   +4.048412463122354e-01   +5.135099105643007e-01   +1.263207698841362e-01   +4.931916144172132e-01   +6.368359576948162e-01   +4.359601336331116e-01; +3.509162008250808e-01   +3.690528450444988e-01   +5.116378432550817e-02   +2.304082458281380e-02   +8.101518532383649e-02   +7.236077795989643e-02   +1.097442712707078e-01   +7.719223356636436e-03   +1.015620150698664e-01   +3.001812742407457e-01   +2.042680282706031e-02   +1.889843833638007e-01   +6.074821196317856e-01   +5.373372446170001e-01   +5.563257476989774e-01   +4.363540797015698e-01; +1.398295189779559e-01   +5.971813526074936e-01   +3.449599798801020e-01   +3.051916053311258e-01   +3.478064924389373e-01   +2.966564478448603e-01   +6.310992291586209e-01   +1.788573422623452e-01   +1.326855114747484e-01   +5.484870340950139e-01   +3.206503326709104e-02   +1.597304267292530e-01   +3.295032908481334e-01   +1.517625692728873e-01   +1.828237447853065e-01   +1.680145413894844e-01; +1.133243289409537e-01   +4.596753872708345e-01   +5.001533035855342e-01   +2.840314319338235e-01   +1.569212336847933e-01   +3.932861998501256e-01   +4.382967074055032e-01   +4.236197902327019e-01   +4.204106082351606e-01   +5.149811131680392e-01   +2.812144815003321e-01   +2.223524625676345e-01   +1.426854941021023e-01   +5.521171741089121e-03   +5.895435589823591e-01   +3.659532967092851e-01];
L2I_L1I_iGABA_netcon = [+4.840501984692296e-02   +4.727755327502377e-01   +1.306062463617506e-02   +5.206055165688912e-01   +3.143748336965551e-02   +4.921684882481276e-02   +2.224760976160766e-01   +1.983271556388028e-01; +4.528842449099016e-01   +3.084895554595207e-01   +2.577382007541560e-01   +3.574742791455808e-01   +5.698185741284872e-01   +3.539749013908991e-01   +2.015260608538869e-01   +2.627565322654256e-01; +3.490141705631176e-01   +5.262114233337704e-01   +3.519956333546264e-01   +1.249978002639015e-01   +3.643673841136824e-01   +1.886569153909410e-01   +6.340752032397191e-01   +1.605846422240279e-01; +5.030339371965794e-01   +4.510676200296770e-01   +4.014982684326630e-01   +3.706021159588035e-01   +1.270821404959700e-02   +2.954771111298904e-02   +5.011780999489772e-01   +8.644504565992453e-02; +1.136608115536794e-01   +2.479581264883659e-01   +1.451234167069362e-01   +4.622411710602022e-01   +5.850227685819509e-01   +4.479070176483426e-01   +2.925194379020756e-01   +4.963122001834431e-01; +3.086120812449982e-01   +1.462242770322127e-01   +3.960982751625635e-01   +3.216724878697801e-01   +2.565705287457424e-01   +3.087738629367012e-01   +4.232843370014822e-01   +4.410059879861274e-01; +1.438664360393003e-01   +9.434897177180593e-02   +5.771823368848162e-01   +2.703539866227676e-01   +4.997530068681895e-01   +1.838814053447478e-01   +4.038789592962834e-01   +6.855756332075598e-02; +5.496414096002669e-01   +2.641752618641636e-01   +4.667508577752065e-01   +2.650142497330891e-01   +1.958935953774009e-01   +5.793446324335114e-01   +2.179428717824521e-01   +6.441122820305450e-02; +4.370640508303090e-01   +8.773720373998940e-02   +3.635208222823729e-01   +2.199610874845429e-02   +5.318973900036923e-01   +3.531921483840304e-01   +2.878613882057118e-01   +4.042612454466948e-01; +2.455052865410305e-01   +3.849213069041338e-01   +6.338111925191889e-01   +2.381109242414894e-01   +5.160879970077403e-01   +4.259163560550852e-01   +4.723527852970945e-01   +4.017417783793596e-01; +5.887295380785733e-01   +1.345489671533232e-01   +4.661342864832798e-02   +4.740342995789024e-01   +3.001981526761072e-01   +3.418127451775176e-01   +5.597403436979915e-01   +4.300534234100277e-01; +1.498655731301383e-01   +2.682507813229219e-01   +1.492877085220932e-02   +4.445206516180577e-01   +1.856474143989152e-01   +1.456549962680588e-01   +2.969178966592696e-01   +3.537536376158453e-01; +3.798072606535412e-01   +2.430305399075847e-01   +5.707293701471046e-01   +1.319378460046494e-01   +2.317946784811253e-01   +2.377029641423465e-01   +5.024804379704798e-01   +1.023731053460225e-01; +3.829400947274943e-01   +1.095735964893022e-01   +4.684698534088119e-01   +4.770904778888393e-02   +4.611249978700888e-01   +3.629204304563134e-01   +4.364967246865795e-01   +4.051567303955375e-01; +2.254995041571503e-01   +5.129410495660586e-01   +2.379482785650649e-01   +1.174793272388774e-01   +2.385060804869266e-01   +5.056716186934208e-01   +1.778323292843469e-01   +1.968913815727699e-01; +5.132944556428904e-01   +3.581042809478233e-01   +4.200669418805806e-01   +5.389748060847519e-01   +7.389323568185745e-02   +3.159040714901844e-01   +4.202257798056260e-01   +2.667462264534067e-01];
L1I_L2I_iGABA_netcon = [+4.749186724987071e-01   +2.651039376190005e-01   +2.320101301207755e-01   +5.500325412300635e-01   +5.589237382011846e-01   +3.218290545370266e-01   +1.870563210161642e-01   +2.239943125725921e-01   +6.253963261660697e-02   +2.527085304314690e-01   +5.101856002827122e-01   +4.546091967913180e-01   +6.260034181602895e-01   +4.932452093008813e-01   +4.366663567369750e-01   +8.651750912418831e-03; +3.145810737264110e-02   +1.590990732038763e-01   +2.858211749877951e-02   +2.018628620283731e-01   +2.184376848410830e-01   +8.665170757976454e-02   +3.658510163708252e-01   +1.810985640934666e-01   +1.705515272052230e-01   +2.500670030383449e-01   +2.800032354919664e-01   +1.703907662851253e-01   +1.873974848235472e-01   +6.459699500812595e-02   +1.503841415430993e-01   +4.219624489178661e-01; +1.455957928075043e-01   +4.164988994593777e-01   +3.038259818803667e-01   +4.463103282396748e-01   +3.273380172690389e-01   +4.399284027202270e-01   +1.038998813789603e-01   +7.242696436245719e-02   +6.173043539403426e-01   +3.966256135815820e-01   +2.259167026321848e-01   +2.215682515192643e-01   +4.449469433703870e-02   +2.497401621206106e-01   +8.109643896473744e-02   +5.682221499715439e-01; +7.066800278290149e-02   +4.232493563552873e-01   +6.488564001052709e-02   +1.104185382823570e-02   +2.263324626162782e-01   +5.172823268956768e-01   +3.101707758279099e-01   +4.403450559939819e-01   +1.196472755046065e-01   +6.577709036882307e-02   +5.635314684294626e-01   +2.226663058244366e-01   +5.568062915553162e-01   +1.768593008749079e-01   +6.214919351712193e-01   +1.958219447769370e-01; +1.957087811308529e-01   +6.058597699196354e-01   +6.092735807971706e-01   +4.486937210522047e-01   +4.747251979245998e-01   +3.252358031314999e-01   +4.983249627149706e-01   +5.939019008497979e-01   +5.963814591540518e-01   +8.879324322610356e-03   +5.422337695981203e-01   +3.670067477402847e-01   +3.718049881480949e-01   +1.000990508775485e-01   +1.464893476483340e-01   +6.803435555257026e-02; +5.805274588135160e-01   +6.114430212505092e-01   +6.106371701720215e-02   +1.793460207492179e-01   +3.978063766427816e-01   +2.711823391823399e-01   +6.197957899649591e-01   +3.445503453267080e-01   +3.701399210012747e-02   +1.719474337408506e-01   +2.934990353790484e-01   +2.085910570169796e-01   +5.531673222675801e-01   +5.584807340467682e-01   +3.166125117628864e-01   +1.972544732269606e-02; +4.047475764529718e-02   +6.034804183660001e-01   +2.517191705776698e-01   +1.712852657722041e-01   +3.655321841012318e-02   +2.980019317252053e-02   +5.915474198507679e-01   +5.183682355882918e-01   +4.009768911243837e-02   +4.875416597328628e-01   +1.121456281664231e-01   +3.172254435035808e-01   +5.630946130589869e-01   +2.410553063746544e-01   +6.346295219616366e-01   +4.251563660381807e-01; +5.126798045948230e-02   +1.695737968234333e-02   +3.180282301723182e-01   +5.918887071397523e-01   +6.569690338924770e-02   +3.748917088239967e-01   +3.967658245421358e-01   +1.843059847301108e-01   +1.022540875655529e-01   +3.099221686416740e-01   +5.262642049092734e-01   +2.823976994707079e-01   +3.861307427519278e-02   +4.131431041913688e-01   +3.296036251062776e-01   +2.301435617935965e-01];
L2E_L1E_iAMPA_netcon = [+5.283098227348210e-01   +3.627715124406676e-01   +3.663700382073390e-01   +4.683232716719398e-01   +2.867523009166969e-01   +2.966262875941713e-01   +3.366014754028469e-01   +3.425251998992483e-01; +4.307447522434023e-01   +3.704809951352434e-01   +4.850169412038138e-01   +2.392268082170251e-01   +4.482701584278552e-01   +4.820000848487864e-01   +1.878429856353110e-01   +6.137227432022661e-01; +3.597909350936184e-01   +1.460057023776248e-01   +4.027793195862651e-02   +6.321187371812973e-01   +2.361516774686695e-01   +1.299304459253711e-01   +2.626139611793289e-01   +4.137969470545157e-01; +3.172820217996957e-01   +1.279088870569140e-02   +3.644284786390016e-01   +1.195799690616377e-01   +2.659996084663638e-02   +3.026334940514510e-01   +3.941687001242424e-01   +3.323203234702744e-01; +6.390984161699244e-01   +4.514435551214110e-01   +4.971635895093805e-01   +3.296682826600555e-01   +2.871429350104114e-01   +6.010647354664723e-01   +3.632446582113230e-01   +1.602680200988248e-02; +3.708572356704585e-01   +1.838517193470591e-01   +5.100845573449316e-01   +5.279826970978544e-01   +2.713380499470359e-01   +1.780908365054565e-01   +2.387539392969641e-01   +2.282911547401268e-01; +2.953413981998946e-01   +3.747594158701395e-01   +2.671989471580332e-01   +5.264743733080594e-01   +1.954338761459984e-01   +5.582519048248176e-01   +2.063265025789940e-01   +4.544273261508923e-01; +4.888973102541066e-01   +4.670823186371108e-01   +5.935282369478275e-02   +1.675350585594843e-01   +4.713362836987479e-01   +2.779875463081813e-01   +3.635666751437936e-01   +4.629098348389541e-01; +3.650662250691702e-01   +1.478916916961430e-01   +4.663946802765733e-01   +1.198991391066510e-01   +4.767583799554747e-01   +4.101126399135525e-01   +3.133505978605178e-01   +1.245926898331160e-01; +6.693519955799905e-02   +3.208794741540281e-01   +1.620745884539732e-01   +5.162346624832944e-01   +7.981112414870345e-02   +3.663405457793605e-01   +5.275018456649100e-01   +2.671809765465781e-01; +2.138015187289004e-01   +1.449809311275686e-01   +9.419009749514150e-02   +6.830056692870091e-03   +2.631608981688398e-01   +3.991680749968863e-01   +1.499115901731369e-01   +4.556575857580443e-01; +7.328110509716836e-02   +2.424601030734711e-02   +5.214248289229029e-01   +5.786494581204735e-01   +2.274950808457310e-01   +4.960637368191680e-01   +2.346300789093624e-01   +4.611109568017706e-01; +1.855965384899527e-01   +2.968291079681969e-01   +5.331360419154175e-01   +3.094855741240912e-01   +5.912206328587661e-01   +1.927505175689998e-01   +4.332199802532220e-01   +3.359173427923909e-01; +5.898251601553050e-01   +2.653051080852592e-01   +2.358336675421392e-01   +5.973946249247489e-01   +5.824325330663389e-01   +7.725889760063036e-02   +2.944471811470769e-01   +8.581570146975923e-02; +3.028331507343784e-01   +3.076870653099257e-01   +5.483222080919236e-01   +3.286407623071653e-01   +8.004323145331536e-02   +1.268250577656876e-01   +2.545408533760656e-03   +1.286406277919045e-01; +5.385775994714004e-01   +5.105434538952731e-02   +1.594079388119814e-01   +4.980017661728943e-01   +2.504540250303531e-01   +2.254967678967978e-01   +5.193453549668956e-01   +1.774611023816920e-01];
L1E_L2E_iAMPA_netcon = [+3.672760123312668e-01   +2.064667049299249e-01   +1.603181017243394e-01   +4.732293625689103e-01   +1.638915569103860e-01   +6.183291265380947e-01   +5.342526516265718e-02   +3.855839670412374e-01   +2.669987193587305e-01   +5.743721826170527e-01   +2.792844847792388e-01   +6.188172626205537e-01   +4.920819971126129e-01   +1.900502973371037e-01   +3.351953102770725e-01   +4.473511855432469e-01; +9.003783964219621e-02   +1.654706776337732e-01   +5.802383252520559e-01   +6.119725557724671e-01   +4.786154663402665e-02   +2.681941525331742e-01   +4.782838708406181e-01   +2.967174941166851e-01   +5.866860657704241e-01   +1.387169041665028e-01   +5.122636284554365e-02   +2.540292987593479e-02   +5.954430098545499e-01   +6.362964039785328e-02   +4.227019134910102e-01   +4.555161423645665e-01; +5.384224032739376e-01   +2.501915563456869e-01   +4.551684596668212e-01   +3.224419656454035e-02   +6.227002836020740e-01   +5.912381582824812e-01   +1.950637271618900e-01   +5.564058480321914e-02   +6.012352937162413e-01   +1.398332321024425e-01   +4.277228813930546e-01   +3.715866936008702e-01   +3.953413332530087e-01   +3.027682255152869e-03   +5.315216984999667e-01   +2.194435687585140e-01; +2.122760735841605e-01   +4.542354544851749e-01   +4.352239659543128e-01   +3.563040465727964e-02   +3.128503588005868e-01   +3.405718930639234e-01   +2.145040507971570e-01   +4.755286886148097e-01   +5.038838185482336e-01   +2.456491130827113e-01   +5.746564286298703e-01   +1.794612043680797e-01   +6.284589066786437e-01   +2.055624789096216e-01   +3.529501614464366e-01   +5.907610659131552e-01; +4.679266726391210e-01   +6.361052850962809e-01   +1.001850942983009e-01   +1.155315284039543e-01   +1.762373010218514e-01   +4.953374525085301e-01   +1.405657921204578e-01   +9.010498114053954e-02   +4.431846146363089e-01   +3.501720821023511e-01   +3.057478994958480e-01   +2.300951580545873e-03   +4.191200265035806e-01   +5.417640620328703e-01   +1.885110231419337e-01   +4.902149220956803e-01; +7.457660543950504e-03   +2.402487700405617e-01   +6.742372203462328e-02   +5.286191180198925e-01   +4.726983826259978e-02   +2.857370707332922e-01   +5.565837042115488e-01   +3.743141957749523e-02   +1.177225422553379e-01   +5.173001686780874e-01   +4.886422463683888e-02   +1.011856419416901e-01   +5.290520254496500e-01   +3.091167175599490e-02   +5.779323666017147e-01   +1.286897970101785e-02; +2.181470322789374e-01   +1.490575543847513e-02   +5.749819809387132e-01   +3.128822025767443e-01   +1.672177470838684e-01   +5.055073489088594e-01   +4.525506202386430e-01   +2.059573782759474e-01   +5.592466288143526e-01   +1.949161641040068e-01   +2.073464478901799e-01   +2.987411058178548e-01   +9.220811695254663e-02   +4.933443189700594e-01   +2.085571431013566e-01   +4.858441258125992e-02; +4.689766522571624e-02   +4.919384031376042e-01   +3.076771056319929e-01   +6.137510765973510e-01   +7.857540561576976e-02   +5.297909811129980e-01   +3.872207753528553e-01   +2.700075468356268e-01   +4.501053346548817e-01   +6.089170138712228e-01   +3.156021062500602e-01   +7.154386455983011e-02   +2.701756160391231e-01   +1.181854890690759e-01   +2.275614463660201e-01   +1.644968190981253e-01];
L2I_L2E_iAMPA_netcon = [+2.318188476398566e-01   +2.565352879288194e-01   +2.230902916566026e-01   +3.195485758991415e-01   +1.037731318077674e-02   +5.147001321753468e-02   +4.433680247178586e-01   +3.178505476876143e-01; +3.145486654951238e-01   +4.562641908027675e-01   +6.207370266646796e-01   +4.834141048588839e-01   +5.030867267469146e-01   +4.070093609137983e-01   +4.879165341234021e-01   +2.824103794931765e-01; +4.888589518270778e-01   +6.175641553815595e-01   +3.487325783658980e-01   +1.498922407341199e-01   +1.646760581470966e-01   +3.011133325875021e-01   +4.134923414994837e-01   +4.734095068667324e-01; +6.307781369389349e-01   +3.111863815691172e-01   +1.843467147056718e-01   +7.345843407285674e-02   +5.636584531583018e-01   +3.215844336193011e-01   +3.611079208116316e-01   +2.365810292965984e-01; +2.839867503810166e-01   +5.721144543959578e-01   +1.905814216581281e-01   +4.695506592350581e-01   +6.367496940978934e-01   +5.860901279195732e-01   +4.433415086419942e-01   +4.000633847416696e-01; +4.731246366567466e-01   +1.300391692175402e-01   +1.741391509418586e-02   +2.130632888837866e-01   +2.132783171721691e-01   +3.185628006911254e-01   +9.556426128551132e-04   +3.949259806329167e-01; +4.319024199980887e-01   +2.360132445190390e-01   +3.455045690710368e-01   +6.046437718028819e-01   +5.906512477636726e-01   +5.955965448493560e-01   +1.292479106079259e-01   +5.980802371286604e-01; +4.228458300443127e-01   +4.553242210097825e-01   +1.125322862345861e-01   +5.493391486419608e-01   +3.154928787955754e-01   +3.344726747597533e-01   +2.114526241820187e-01   +1.556689820262757e-01];
L2E_L2I_iGABA_netcon = [+3.858866353145954e-01   +8.438559331416347e-02   +2.682317393211761e-01   +2.918031688368108e-01   +5.237614459170133e-01   +3.395894970462937e-01   +8.585919386708512e-03   +4.470614620159524e-01; +2.790368769744815e-01   +5.708515497565052e-02   +5.098641589815048e-01   +5.273035356626256e-01   +1.540630424989788e-01   +3.115918219402521e-01   +6.100993708984764e-01   +2.400833280082112e-01; +6.005009303075828e-01   +3.352690901656299e-01   +3.065194156716678e-03   +1.739230441909398e-02   +4.509062689630702e-01   +3.681279198612773e-01   +4.312033739257500e-01   +1.794035292654166e-01; +1.347028013673081e-01   +6.377490694671059e-01   +4.714055903682635e-01   +5.169772982020899e-01   +3.981079079928889e-01   +4.596208890813799e-01   +3.387949208171632e-01   +3.841672141145670e-01; +5.580158629230424e-01   +5.116401806246578e-01   +9.258740216775797e-02   +4.250714197328133e-01   +4.416211262196644e-01   +2.114283895433107e-01   +2.218183039289316e-01   +3.428011639377173e-01; +2.182406678690711e-01   +5.652962282656915e-01   +3.250327572052141e-01   -4.142874511508804e-04   +1.550633496988840e-01   +7.708264857097250e-02   +2.728294426278763e-01   +3.510954606336478e-01; +5.385332648008030e-01   +5.216818516822811e-01   +6.018632931395347e-01   +4.498359027036018e-01   +3.430261232005483e-01   +4.214286514449045e-03   +1.484475931536602e-01   +3.155556700167494e-01; +5.202168404907815e-01   +3.570581057064304e-01   +6.139402039574171e-01   +2.084303861809394e-01   +1.015094594958815e-01   +4.352829815057486e-01   +2.668633078241473e-01   +3.443442799370497e-01];
L3E_L2E_iAMPA_netcon = [+3.547686982906970e-01   +4.592917259956708e-01   +5.326568785641863e-01   +2.029578989648080e-01   +3.095200798443019e-01   +3.786977923579672e-01   +5.470131474153429e-02   +8.180846199757400e-03   +6.296195116965629e-01   +4.249394336503640e-01   +3.815679921051599e-01   +1.473005785171852e-01; +5.895184889929539e-01   +4.648061794840341e-01   +2.473004739105183e-01   +3.063479162444182e-01   +3.117706995218759e-01   +7.346700469961105e-02   +5.981110426556986e-01   +5.192780888680703e-01   +3.105629690579300e-02   +5.404745379376995e-01   +6.128899471241224e-01   +4.252545595156312e-01; +4.943612680326104e-01   +4.797749893247685e-01   +3.487490237736638e-01   +6.309305723666958e-01   +2.109042972448563e-01   +4.481750820521391e-01   +3.006410820629254e-01   +6.031002120348845e-01   +2.506426432402823e-01   +2.688636931660698e-01   +5.150125595902313e-01   +3.900578352387860e-01; +2.905616919613092e-02   +5.041144436908496e-01   +4.482379728744262e-01   +3.604329649440696e-01   +4.642661204263470e-01   +4.954227550819553e-01   +4.013013645321701e-01   +4.624887485061092e-01   +3.323536793744207e-01   +1.738198902322158e-01   +3.701374936725867e-01   +3.574332596722113e-01; +1.783441025132463e-01   +3.795444192049628e-01   +4.358567699454729e-01   +3.753481432430717e-01   +5.002827223926443e-01   +4.546563706683967e-02   +5.479483418865533e-01   +3.435945984823717e-01   +3.971620899091637e-01   +2.049775812878961e-01   +4.464784601378511e-01   +4.059040996712197e-01; +2.416872701590950e-02   +5.162693636950720e-01   +3.081964986968798e-02   +4.907028938676600e-01   +3.039420214592526e-01   +5.496046743628314e-01   +1.869603878518147e-01   +2.084809489845244e-01   +2.858110736994821e-01   +4.869161557840912e-01   +2.788924449319621e-01   +8.523289894920787e-02; +1.002477367058709e-01   +1.883397765096525e-01   +3.914872131650106e-01   +2.556501036930381e-01   +4.842860453555579e-01   +5.378370826365342e-01   +2.054545622909011e-01   +2.264363811071829e-01   +1.418044339549330e-01   +5.639956144315895e-01   +2.338336972337826e-01   +1.694666421628240e-01; +2.264862388255297e-01   +4.345829188986967e-02   +3.844847802902847e-01   +5.076690555966391e-01   +3.332873835564393e-01   +5.276289387336697e-01   +5.456595978864893e-01   +4.117873314800253e-01   +6.186734473101042e-01   +2.977203181390826e-01   +5.645191916714906e-01   +5.576245945215745e-01];
L3I_L2I_iGABA_netcon = [+4.782178249888676e-01   +5.907468665712963e-01   +3.559937047420825e-01   +1.962938166641416e-01   +2.181571286860188e-01   +1.532221904898499e-01   +5.750330924671708e-01   +3.118291148619924e-01   +2.478980539332235e-01   +1.688992261988814e-01   +3.589410439841258e-01   +6.205256463542163e-01; +4.691096220241398e-01   +4.544089362507839e-01   +6.589151794147569e-02   +1.950512807934208e-01   +4.610218262525942e-01   +2.279535591935564e-01   +1.892190673539584e-01   +2.182981873759906e-01   +3.889557614118633e-01   +5.586370847512956e-01   +3.199904795994333e-01   +1.733359077379188e-01; +1.894435593407044e-01   +2.838050466885945e-01   +1.154497663634210e-01   +5.212474446353342e-01   +1.353051290669341e-01   +2.856633837757280e-01   +6.398833326144820e-01   +6.051860978453405e-01   +6.289480753176462e-01   +3.427746488072621e-01   +2.008616612683420e-02   +2.348695035780069e-04; +1.234757084454844e-01   +7.308493214736039e-02   +5.580659754856763e-01   +1.941682725311170e-01   +4.848647370518263e-01   +4.495328024546557e-01   +5.923818119053599e-01   +4.337475696164963e-01   +5.716324564413653e-01   +6.735156852783129e-02   +6.072078809818721e-01   +2.902089223158228e-01; +2.973602110698994e-01   +5.564525489268957e-02   +6.232761653204115e-01   +3.518012995157366e-01   +6.389873894357128e-01   +5.856153686496331e-02   +1.264350482967527e-01   +3.758468829991007e-01   +9.662180011292416e-02   +4.678486926709783e-01   +7.454570071943026e-02   +5.889804379673307e-01; +2.161966857290454e-01   +1.035625250710325e-01   +1.972880839833439e-01   +5.033714094315945e-01   +4.554154503892645e-01   +3.098951739577396e-01   +1.723043414760543e-01   +3.636347930020128e-01   +2.363848985287633e-01   +6.122224196153759e-01   +5.073954838047472e-01   +5.600341538487098e-01; +4.419812808197613e-01   +2.495965126841250e-01   +9.045792821994497e-02   +4.727807887807756e-01   +3.035402403925988e-01   +3.810661730296108e-01   +8.972341694667189e-02   +1.130012019372295e-01   +4.701823660543972e-01   +5.001597107115439e-01   +5.244891577901672e-02   +2.652036081230227e-02; +2.074821973232603e-01   +4.833131922144440e-02   +5.049075194111979e-01   +3.364684485633982e-01   +4.218900492553911e-01   +1.026010085077825e-01   +3.105830485849195e-01   +2.616290177467874e-01   +2.755005215748491e-01   +1.926174053840745e-02   +1.334873530764140e-01   +1.972991635567592e-01];
L2E_L3E_iAMPA_netcon = [+2.046992125681673e-02   +3.938537515936907e-01   +2.757589436809599e-01   +2.099823348645345e-01   +3.552598398224650e-01   +3.466831418890509e-02   +6.410518362351728e-01   +9.829522144492860e-02; +5.158263867280318e-01   +4.624421012552727e-01   +4.733585317658183e-01   +4.341302934256469e-01   +5.340099327417497e-01   +9.035392175460844e-02   +3.011014437990470e-01   +2.808972765224445e-01; +8.558724489650328e-02   +3.041620505046906e-02   +3.855736352390398e-01   +5.511071404546323e-01   +3.760902031909870e-01   +1.342662020298242e-01   +3.851174689478042e-01   +1.146208647406663e-01; +3.349814369475824e-01   +3.308771429427377e-01   +5.188710402140497e-01   +5.479809829072565e-01   +2.647098642785384e-02   +1.908505282669510e-01   +4.348102168405193e-01   +5.768293347036040e-01; +3.453384913568245e-01   +6.264442693426328e-01   +5.907441775484596e-01   +3.630209134547600e-01   +4.941280740489430e-01   +2.215710918559479e-01   +6.050364815300647e-01   +7.642362449123752e-02; +5.164523815117289e-01   +4.686466283714935e-01   +3.034638131041127e-01   +2.662191547999893e-02   +9.056034207905220e-02   +2.911765760109445e-01   +6.157388102783127e-01   +5.192899502737174e-02; +1.566640774883130e-01   +2.619163730205964e-01   +1.830459388324762e-01   +5.043651442996390e-01   +5.893403051447115e-01   +4.192278304822865e-01   +4.858268837108703e-02   +5.252662604963361e-02; +3.652617077029802e-03   +7.150260716985553e-02   +5.041875438742960e-01   +3.624181109991526e-01   +3.128833505156264e-01   +4.871895261267672e-01   +7.666811989361240e-02   +7.086493625022219e-02; +1.401456770747556e-02   +5.435589433427338e-01   +9.477016936558386e-03   +1.915214025267049e-01   +2.282679181928977e-01   +1.600308576633450e-01   +1.892916959985386e-01   +2.226496068114720e-01; +5.039339524799685e-02   +2.222994245742082e-01   +1.997506759287757e-01   +4.567824512630750e-01   +5.225748396480638e-01   +1.449307961030912e-02   +5.757976420100763e-01   +5.466547089539836e-01; +1.370569422790976e-01   +3.764898752536002e-01   +4.325594587453436e-01   +4.336802448183342e-01   +5.407179785310130e-01   +5.608798840285579e-01   +4.239760975733755e-01   +5.507141021793054e-01; +3.864026531870811e-01   +2.230111300982313e-01   +5.703392799325206e-01   +3.618879725597165e-01   +1.955914483251111e-01   +4.032588672797255e-01   +1.712683631592145e-01   +5.793370919073091e-01];
L2I_L3I_iGABA_netcon = [+2.681940757359364e-01   +3.041424042703031e-01   +4.830144817988591e-01   +3.990226451270911e-01   +5.190010552337739e-01   +4.728332753903008e-01   +3.341742803992129e-02   +9.451138608383279e-02; +1.119329831402133e-01   +1.544982538605434e-01   +2.306762578419381e-01   +3.880492901199529e-01   +1.601082420161466e-01   +5.068297814786072e-03   +1.991169957339435e-01   +3.701465703357385e-01; +3.608996510107273e-01   +1.906284265351882e-01   +2.308523388783536e-01   +4.365462916859053e-01   +2.222317372397759e-01   +5.344741258556434e-01   +5.484793526018648e-01   +2.355862835137497e-02; +1.907097901925721e-01   +2.023095130806660e-02   +2.574175000662953e-01   +6.155220208711687e-01   +1.485665453805554e-04   +4.348846082160358e-01   +2.272292947499381e-01   +3.898708854270425e-01; +4.538994072787049e-01   +2.996178882009454e-01   +4.401120298346861e-01   +2.203621871927885e-01   +2.130573030993104e-01   +2.615416778794221e-01   +2.574464071138741e-01   +6.192311141180024e-01; +9.118243373391073e-02   +3.243124697826636e-01   +2.525598332664921e-01   +4.065943979402828e-01   +1.206766668910394e-01   +5.271839121529908e-01   +4.909678196874021e-01   +1.475064684695323e-01; +6.964871644759879e-02   +4.328855611973110e-01   +6.769866985304623e-02   +2.394236758126481e-01   +6.027691194867399e-01   +1.805146594872955e-01   +2.538953859197146e-01   +4.638647525534783e-01; +4.407337219947875e-01   +1.362222584962167e-01   +3.979835898092672e-01   +5.815267244639084e-01   +1.486620517885265e-01   +3.363049195777464e-01   +3.927657875054032e-01   +5.876999877379955e-01; +5.853226156011845e-01   +5.844936125901627e-01   +5.955506973210935e-02   +5.380207651588924e-01   +2.213444891749872e-02   +5.407676315140207e-01   +1.567567693240981e-01   +1.651891663731664e-01; +3.397010920122415e-01   +1.172155682104551e-01   +1.750763206291483e-01   +2.047636803087850e-01   +4.163655106722167e-01   +4.981420491134427e-01   +2.073465449106265e-01   +3.939509368339768e-01; +5.887635090266056e-01   +4.507040534910626e-01   +1.777336399221991e-01   +2.920935295468505e-01   +1.672242904483715e-01   +3.796592734674445e-01   +6.125557030914565e-01   +3.670712210881833e-02; +3.913773952074032e-01   +4.992794646895048e-01   +6.178284413243527e-02   +3.014061508291658e-01   +4.413268932242215e-01   +1.545488966753728e-01   +3.546216135781518e-01   +3.833412751507827e-02];
L3I_L3E_iAMPA_netcon = [+5.675129569380622e-02   +4.349623120000456e-01   +2.045172438369675e-01   +3.335457537130987e-01   +5.457194124376391e-01   +3.202112372938152e-01   +2.159332817065181e-01   +2.879507274692136e-01   +3.198598426677383e-01   +3.635716974684626e-01   +2.940215813640642e-01   +2.866800042948977e-01; +8.705990220859938e-02   +5.634164353070634e-02   +4.882385968709279e-01   +4.264690476011663e-01   +2.517161880394079e-01   +4.370879135998186e-01   +5.255526329863396e-01   +8.020282277446097e-02   +3.118484020111408e-01   +4.004442309756367e-01   +5.326502705844636e-02   +4.285860415288815e-01; +5.316707560995581e-01   +1.990338183223211e-01   +5.922981186290027e-01   +4.874133739578199e-01   +1.625196248423129e-01   +6.281948604208820e-01   +5.518246560826496e-01   +8.462216695489932e-02   +2.585350074504328e-01   +9.772190101307630e-02   +6.114466839561189e-01   +2.426339339347530e-01; +6.195005767993835e-01   +5.269254871109342e-01   +1.612224910710746e-01   +4.240650634860657e-01   +1.229982638243252e-01   +2.785107739634156e-01   +1.639746245756632e-01   +2.354485012637937e-02   +6.067696828960336e-01   +2.181280178922371e-01   +6.276636883289829e-01   +4.171691610033798e-01; +2.178242568003348e-01   +2.676315535577837e-01   +5.639065483561311e-01   +4.968059943150569e-01   +6.340121728508056e-01   +5.412539009349923e-01   +4.549945665804530e-01   +3.618704811787611e-01   +3.418864234476248e-01   +1.591518672606247e-01   +3.625684785613577e-01   +4.674766250502678e-01; +5.628350084010476e-01   +4.895737790863784e-01   +6.319241952099236e-01   +5.431827263097810e-01   +1.400916721637672e-01   +3.840896832430263e-01   +3.678631567297542e-01   +6.374380052131240e-02   +5.111909088689456e-01   +5.519795736235544e-01   +1.757294981329705e-01   +1.306082374214217e-01; +3.726494022221365e-01   +5.777906241924206e-01   +1.246556067437967e-01   +1.015121514333921e-01   +4.124740785498034e-01   +1.852789263154491e-01   +1.491665385548555e-01   +4.861426473589152e-01   +6.297774395015858e-01   +2.972224884331958e-01   +1.182327438796886e-01   +2.499178309811308e-01; +1.686491153591591e-01   +2.848109997040544e-01   +4.769919922834662e-01   +2.846954202649143e-01   +3.564410001244601e-01   +3.491067168606345e-01   +1.185442189206928e-01   +4.313642123660791e-01   +2.650333365814737e-02   +4.248390701959327e-02   +3.344136754617908e-01   +2.820263666261694e-01; +1.937502254026914e-03   +5.775437971730619e-01   +3.376051684765747e-01   +4.135264387123604e-01   +1.619257674471860e-01   +1.672652400707412e-01   +3.511659908714868e-01   +5.587269130606096e-01   +2.346635082230700e-01   +3.506470270057013e-01   +6.014320544690376e-01   +4.616633649939916e-01; +6.470000655426227e-02   +4.298041970563504e-01   +1.649027119380260e-01   +5.002464105263041e-01   +2.584648414276877e-01   +2.216837478676223e-01   +4.320912933361785e-01   +5.522618201370785e-01   +3.115492308469870e-01   +3.421523345075154e-01   +1.246454090682493e-01   +6.316662396992846e-01; +4.412178356851102e-01   +2.037746959641682e-01   +2.573572327878405e-01   +6.397711185831678e-01   +8.351000583620699e-02   +3.886593669868773e-02   +4.487479544920327e-01   +6.161863620782223e-02   +3.580413204294241e-01   +5.624175714305446e-01   +5.104338451240166e-01   +2.834318012049526e-01; +2.782942311626946e-01   +6.199921177354423e-01   +4.375708942508089e-01   +2.048980691622068e-01   +3.586349471402769e-01   +4.316268363787588e-01   +5.068738791258210e-01   +1.088134015005898e-01   +5.638711345339018e-01   +4.029632121842870e-01   +4.642471983725645e-03   +5.784496908994425e-01];
L3E_L3I_iGABA_netcon = [+8.032347643003982e-03   +2.586026417438964e-02   +3.441577937490242e-01   +5.550630967155122e-01   +1.304866463008946e-01   +4.330044649198328e-01   +4.645521080272398e-01   +8.525220569258803e-03   +2.348554491387725e-02   +1.414443472456748e-02   +6.279098231067760e-01   +4.862846894799376e-01; +5.838631641965857e-02   +6.253869542181871e-01   +2.256199074759084e-01   +3.976456324036158e-01   +4.659851776821602e-02   +4.295139620543477e-01   +1.512957804514660e-01   +4.206624703398655e-01   +1.273908306165416e-01   +3.995561024449197e-01   +1.251167021755729e-01   +3.568093881646716e-01; +1.002979478218468e-01   +3.614677549320334e-01   +9.481768704227266e-02   +1.573056513984782e-01   +2.788284771431113e-01   +5.743617530794615e-01   +3.812278397526382e-01   +5.960135296951919e-01   +4.041070968111421e-01   +2.227298940661419e-01   +4.681883116289070e-01   +2.637479481111690e-01; +6.253648105227979e-01   +4.453982397961239e-01   +9.162473152624355e-02   +5.404526324455237e-01   +5.352849640896579e-01   +5.201103814068246e-01   +4.918588378866877e-01   +1.165588450890696e-01   +4.438617440428572e-01   +5.779510114810560e-01   +1.358604485059281e-01   +4.640609088193879e-01; +9.875330344291933e-03   +3.641016520720933e-01   +2.379238613578663e-01   +5.776961431005122e-01   +4.535438661532706e-02   +4.958076026248667e-01   +4.457388238157936e-02   +5.728038240539719e-01   +4.534947987583295e-01   +2.973074743759464e-01   +2.000564179931666e-01   +4.340424781697203e-01; +5.496352445339251e-01   +9.888813311373207e-02   +3.532809740786922e-01   +4.412102389813694e-01   +3.394615217806660e-01   +9.926706545550282e-02   +3.768364953559463e-01   +5.902026245238464e-01   +7.977568948870145e-02   +4.641682753338158e-02   +5.433750470433740e-01   +1.019057586326967e-01; +1.946917217140611e-01   +5.300128531323739e-02   +2.524408143127083e-02   +2.771940299707929e-01   +2.789458059527403e-01   +3.592234696311747e-01   +1.636259139135741e-02   +5.943501393364977e-01   +3.641516841421830e-01   +4.976618850359718e-01   +4.363608187395018e-02   +3.356680453971004e-01; +1.862840638710371e-01   +5.716769849262221e-02   +3.083993690696356e-01   +2.425047272887859e-01   +3.893372455250868e-01   +5.663455501302553e-01   +3.951438970830918e-01   +3.593158351521113e-01   +4.054855025727873e-01   +6.269045923013491e-01   +1.361549625641517e-02   +9.898143375435858e-02; +1.296050400317541e-01   +8.183321634541720e-02   +5.336715525824536e-01   +4.836403544326381e-01   +2.093003286356517e-01   +2.087467766515592e-01   +5.417326901841679e-01   +3.282869495941019e-01   +2.268118915206927e-02   +4.472773910785984e-01   +1.501913018417395e-02   +5.081109026863443e-01; +1.584001628123864e-01   +2.737433288286616e-01   +1.400391959557832e-01   +6.440675233222319e-04   +4.300372852216911e-01   +5.730563600392180e-01   +3.862878801272302e-01   +5.343922918723707e-01   +1.537827743403611e-01   +1.227018029491865e-01   +5.710711545084961e-01   +9.997621647728060e-02; +4.426556913805477e-02   +5.402289446685035e-01   +3.008724876692424e-01   +1.438534738443766e-02   +6.172930776968865e-01   +2.646868310936067e-01   +3.437678706186715e-01   +3.117816581593408e-02   +4.545048442553707e-01   +3.357879442336116e-01   +1.745433799140458e-01   +2.946813380157240e-01; +1.847785800451281e-01   +6.633114059759387e-02   +4.045151466347078e-01   +4.716115043051893e-02   +2.484608852091628e-01   +1.993631435800833e-01   +1.509823718122346e-01   +3.696008283776359e-01   +4.040111891182622e-01   +2.764699866522597e-02   +1.773422754563298e-01   +6.153935727497768e-02];
L2E_Input1_iAMPA_netcon = [+5.700844051379041e-01   +2.930071150170314e-02   +1.807335339053687e-01   +2.916942930714013e-01   +1.987001556925125e-01   +1.081704358752658e-01   +4.814989941890413e-01   +4.937818158295378e-01];
L2I_Input2_iAMPA_netcon = [+6.335080095124257e-01   +6.370363157463068e-01   +8.284345855910748e-02   +4.281009516719397e-01   +4.846803894629566e-02   +4.446002057690183e-01   +2.530632920100082e-01   +1.728435057533993e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.1*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.1*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 30*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 30*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
