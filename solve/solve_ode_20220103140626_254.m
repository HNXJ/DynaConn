function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.614424054245669e-01   +7.436543495998903e-01   +8.623224645396327e-01   +2.438963492010397e-01   +2.800679695718735e-01   +6.622889468372601e-01   -7.709038972382688e-02   +3.882417336183236e-01   +2.660475801101745e-01   +1.479042820471027e-01   +3.929163643607554e-01   +1.803559018494624e-01   +4.466477715658531e-01   +2.668860603096811e-01   +2.344182861989399e-01   +1.792173418342210e-02; +8.313085508183339e-02   +8.896733588353861e-01   +7.826543239732371e-01   +7.036811663032126e-01   +2.975943844946493e-01   +6.511809512007517e-01   +6.616207821392569e-01   +1.880448010648188e-01   +1.224200059719888e-01   +7.234256770972718e-01   +5.254161986672470e-01   +6.076834560548329e-01   +3.938759670906057e-01   +2.440307606721826e-01   +5.762056005088378e-01   +2.917606405808004e-01; +2.242979046618763e-01   +2.663641328199030e-01   +4.132877890611034e-01   +4.716300594681093e-01   +6.162840716586913e-01   +4.097261784222775e-01   -3.705251558851177e-03   +6.268912433926269e-01   +3.014107606958373e-01   +4.917648697050432e-01   +7.525978491700825e-01   +2.482909996800887e-01   +3.628351797684464e-01   -5.311957053277560e-02   +3.011457023399779e-01   +8.550383359989646e-01; +2.112606909873513e-01   +6.403985156747675e-01   +1.281694353416785e-01   +2.197055404771164e-01   +7.849523974320153e-01   +7.816518683574915e-01   +1.999158597972291e-01   +5.435864365399936e-01   +6.705009946001288e-01   +3.729705373174137e-02   +1.786848913275746e-01   +7.776980347358159e-01   +4.982451069736008e-01   +2.403405568729394e-01   +5.627024774473687e-01   +4.368813157069144e-01; +6.907086665586594e-02   +6.541635710048480e-01   +7.701877202228455e-01   +7.199263396732170e-01   +4.850061318322028e-01   +3.170684184517009e-01   +4.415862473026659e-01   +3.491068207033080e-01   +3.443438937590406e-01   +4.524818663830345e-01   +2.089047324590859e-01   +6.091485722009629e-01   +3.446956366433558e-01   +7.210814456848780e-01   +2.113447660342754e-01   +8.399049074196157e-01; +1.477320288300279e-01   +1.747991979684402e-01   +7.006494546716160e-01   +7.783529393255175e-01   +5.405779231984998e-01   +7.761517949860678e-01   +2.666828520248042e-01   +3.975356160234559e-01   +8.221526110104215e-01   +8.272944811501598e-01   +7.929494386772086e-01   +9.560114678705457e-02   +3.902002977201595e-01   +1.100814934794985e-01   +8.294935303926302e-01   +3.668659746899117e-01; +2.990456124142600e-01   +6.447629400813099e-01   +8.487883925226462e-02   +3.412660951170460e-01   +7.240626973859866e-01   +4.942966214114474e-01   +4.072598950411978e-01   +5.462418501464036e-01   +8.672190986030938e-01   +8.519453079736060e-01   +5.672575743106385e-01   +1.456648072955303e-01   +3.227756433146082e-01   +4.166461289062597e-01   +6.438731655394977e-01   +8.112091668915774e-01; +6.124802790137265e-01   +6.660248155192496e-01   +7.449961557801046e-01   +3.536786049168086e-01   +5.334342199893192e-01   +5.105374549846468e-01   +1.016219792453760e-01   +4.359653121053206e-01   +1.000000000000000e+00   +7.897235251436601e-01   -6.271999814392272e-03   +6.875755451885874e-01   +7.277962924801475e-01   +5.247201513765948e-01   +2.620362589913775e-01   +8.164525450465060e-01; +4.234626112532539e-01   +1.242648231009156e-02   +2.218506921542903e-01   +2.818337763549583e-02   +3.923104624333416e-01   +1.486859527912316e-01   +1.701809745043898e-02   +5.016197155941011e-01   +4.799884003665700e-01   +7.127212759949363e-01   +6.859429316056392e-01   +4.636629453512026e-01   +2.195520671551838e-01   +1.647608534755607e-01   +8.838936709130728e-01   +7.697176444600433e-01; +6.251840306803801e-01   +5.108727171816301e-01   +5.446692188588965e-01   +2.349548885690402e-01   +4.469798205590061e-01   +2.362790465858880e-01   -1.245511132144336e-03   +2.308122109711110e-01   +5.292542242777761e-02   +7.248955893817052e-01   +1.596364308087136e-02   +1.182952783866199e-01   +3.409386285423792e-01   +7.205237041883578e-01   +3.026443351414533e-01   +6.872232233277117e-01; +3.230160515143837e-01   +6.280383063838516e-02   -1.570692702660133e-03   +2.024856940446283e-01   +8.246949719424326e-01   +5.761206786490862e-01   +1.888787649293771e-01   +1.744365070328780e-01   +1.587804924673867e-01   +8.060230484589356e-01   +1.162651663666098e-01   +7.284169332525977e-01   +4.844890656241418e-01   +7.565339621741566e-01   -3.022805699549388e-02   +5.459892773503996e-02; +1.323383758060772e-01   +5.605685212854099e-02   +8.719469840431092e-01   +4.479008743899989e-01   +6.083825044583430e-01   +4.814182310268025e-01   +6.299244164232952e-01   +3.223362820972850e-01   +6.212945346408517e-01   +1.183870617333962e-01   +2.373349948925597e-01   +7.196054070570003e-01   +1.766021748193478e-02   +4.947400977491988e-01   +3.423177045623310e-01   +3.997930285234994e-02; +3.545485420938028e-01   +3.039470027282202e-01   +5.985816555974760e-01   +2.367847515780042e-01   +1.041144787501223e-01   +4.438899926797464e-01   +3.690067028563346e-01   +6.166209930167313e-01   +2.927155243124830e-01   +8.717650273239861e-01   +2.014446453207475e-01   +4.246664929103565e-01   +2.044533997490912e-01   +2.299362642217986e-01   +2.706410418463599e-01   +1.758891560747484e-01; +1.359720411503486e-01   +8.602742933093557e-01   +6.543064510963631e-01   +6.587256974017696e-01   +7.533209262503437e-01   +5.361633536662216e-01   +2.242180650465564e-01   +7.431932586121915e-01   +3.629580983222002e-01   +4.414691324157204e-01   +7.171331424272861e-01   +5.919882532375141e-01   +5.255736871320532e-01   +4.592803468048642e-01   +7.105769945601985e-02   +3.895068593069572e-01; +1.424853025721076e-01   +1.894022258280008e-01   +1.118453599034681e-01   +3.675894429671270e-01   +2.803814519850162e-01   -2.197245650040338e-02   +5.876292904316532e-01   +2.728683573652694e-01   +7.621133336168685e-01   +4.227903857525369e-01   +6.401694167879340e-02   +7.045047579639264e-01   +5.452998633509657e-01   +1.494534714766641e-01   +6.533781425588395e-01   +1.148251994268024e-01; +5.241424403379710e-01   +1.853308868825221e-01   +3.221361175724293e-01   +5.770008022119997e-01   +4.871058791739834e-01   +5.747676572359764e-01   +2.100957173806536e-01   +1.016947283882639e-01   +5.584727178696048e-01   +4.065948010438593e-01   -3.301603557631744e-02   +3.608666900033168e-01   +1.628538940384119e-01   +8.620534288990811e-01   +8.507550177576418e-01   -1.740222343958669e-02];
L1E_L1I_iGABA_netcon = [-1.440600572520001e-02   +2.867897478608205e-01   +9.115805067615670e-01   +1.509283213639488e-01   +4.317650472194793e-01   +1.183917696149185e-01   +2.623144104646773e-01   +3.137882503764698e-02   +1.893629139788332e-01   +1.184653306966320e-01   +4.239857893964704e-01   +9.399021254387712e-01   +1.940075322101316e-01   +7.231072950811487e-01   +1.150330201457888e-01   +3.603928181836042e-01; +8.058758878863569e-01   +7.514340228433857e-01   +5.387324029501380e-01   +8.343945740359804e-01   +6.406614513103220e-01   +7.767796795090485e-01   +5.766744218491331e-01   +7.543868803450462e-01   +8.685787974508028e-01   +9.250936806361626e-01   +1.764176061179056e-01   +1.084541303605744e-01   +5.592194232787042e-01   +8.694662920983732e-01   +1.000000000000000e+00   +2.148818445461262e-01; +2.202339420630827e-01   +8.326439802124771e-01   +8.791340831421035e-02   +8.577725857565011e-02   +1.271015041761117e-01   +2.323768114393393e-01   +5.667705800351709e-01   +5.540466636262600e-02   +3.733799188986183e-02   +1.444145339512902e-01   +5.121201001598359e-01   +3.947063166053889e-01   +7.568610854795713e-01   +7.685919271981323e-01   +7.527524325734031e-01   +7.433944963091066e-01; +3.592450737891614e-01   +5.719583179433465e-01   +6.221533385749535e-01   +7.289989043766829e-01   +6.475668412390004e-01   +6.188656526589136e-01   +5.917967902020563e-01   +8.405265592032590e-01   +1.366742548217370e-01   +2.575756797205442e-01   +4.709628282157650e-01   +3.293943800266347e-01   +7.814963812786789e-01   +4.449996888405842e-01   +8.845607226359767e-01   +5.115073256120979e-01; +6.911466479633872e-01   +5.777302962295271e-01   +8.436376736835099e-01   +3.594701821351826e-01   +9.144090488314685e-01   +5.267243293429440e-01   +3.455863235088217e-01   +4.453663952673791e-01   +2.784987553661927e-01   +2.423178526363004e-02   +3.970143049166328e-02   +5.652575388962172e-01   +8.581135703401767e-01   +7.923093370145492e-01   +4.406078375857101e-02   +1.258403281680868e-01; +2.159477146525807e-01   +4.534761141232484e-02   +3.363461711068232e-01   +1.850706225461854e-01   +6.954683373318646e-02   +4.456217237260214e-01   +8.114118102278893e-01   +3.336644495246258e-01   +5.357843858500521e-01   +4.488653041995546e-01   +8.788028057418730e-01   +1.431894934945306e-01   +2.337838677003601e-01   +2.098926252524248e-01   +6.750385806122302e-01   +3.082431070049457e-01; +6.571844655668427e-01   +5.283060165665184e-01   +2.946477579917343e-01   +7.527087960029295e-01   +2.965302635410687e-01   +8.220672518374376e-01   +6.103343224990224e-01   +5.262002902329905e-01   +7.779920859738323e-01   +6.009607459797428e-01   +8.022486667608155e-01   +2.269704435074000e-01   +7.938273665376206e-01   +5.560889959959142e-01   +9.234042585903877e-01   +7.642458405749373e-01; +9.112790298536424e-01   +1.389431712873588e-01   +5.936742649125458e-01   +4.675366070110050e-01   +6.823741844710938e-01   +2.123400582535635e-01   +3.351147866843296e-01   +5.487119621551266e-01   +1.808192161481703e-01   +8.051229727185722e-01   +7.131783690710816e-01   +8.022411371091227e-01   +2.351007194611419e-01   +6.576608663226846e-01   +4.938183794429057e-01   +5.677831820555276e-01; +5.734993302692433e-01   +9.686215588594713e-01   +3.642074638354642e-01   +9.106545699295042e-01   +2.086433795936150e-01   +6.388129398348277e-01   +5.491460623797034e-01   +8.872230974598552e-01   +8.707586994427783e-01   +7.266698844884151e-02   +1.579046126117445e-01   +1.880119084824081e-01   +8.640946498459361e-01   +1.413072328838587e-02   +7.144766720743605e-02   +4.400782025012215e-01; +1.940087946148122e-01   +3.380795738952380e-01   +5.326505058447130e-01   +2.070259693618361e-01   +8.769424315478808e-01   +3.946155076645281e-01   +2.999428936710505e-01   +8.968476287082494e-01   +8.601249877570786e-01   +8.676775741490445e-01   +8.082294503971390e-01   +9.304041272962659e-01   +4.875815462624569e-01   +3.913778772551373e-01   +3.169669716774040e-01   +7.494182170862370e-01; +1.835882075921414e-01   +2.051016008607529e-01   +7.304281571359611e-01   +8.202328038853050e-01   +2.075371580873809e-01   +6.196003691236976e-01   +4.865763744300109e-02   +4.562749789915081e-01   +3.840430293789584e-01   +6.197781764378971e-01   +3.747612654960335e-01   +8.636744624714475e-01   +9.432207024806966e-02   +4.717184724120257e-01   +4.427456743492239e-01   +3.878336726622970e-01; +1.773136849308246e-01   +9.313074121889416e-01   +7.297768278475857e-01   +5.309218849778171e-01   +4.503337616276077e-01   +8.022288936028983e-02   +1.495057491467199e-01   +3.624317937924875e-01   +1.491837969934973e-01   +4.855688446573684e-01   +2.042596958617797e-01   +3.748277525290199e-01   +3.673200143180801e-01   +8.793025364794158e-01   +3.315922882741393e-02   +4.755733556124032e-01; +8.791280106413288e-01   +1.481097893593483e-01   +5.001307236724614e-01   +5.032309572573642e-01   +5.787614903755556e-01   +5.619678761644762e-01   +1.720269267574394e-01   +4.629978317574260e-01   +4.354534031064097e-01   +3.259338376290465e-01   +8.805634275837001e-01   +9.226115003769610e-01   +7.697061969754427e-01   +5.378806733349066e-01   +2.462971335232225e-01   +7.231674253416009e-01; +4.611481227301438e-01   +8.035093538213752e-01   +3.366952675083615e-01   +3.700935720754846e-01   +7.078506899831490e-01   +2.264513397338578e-01   +2.767597686869936e-01   +5.643839103198914e-01   +3.338286802235290e-01   +4.638123903572988e-01   +1.872464976727231e-01   +1.636094303461558e-01   +2.738369548205707e-01   +2.440995461151628e-01   +5.402526438124028e-01   +8.822186649144538e-01; +5.665075871151550e-01   +5.956884943171288e-01   +6.964777192691159e-01   +6.228092184250286e-01   +6.842485326843252e-01   +1.192352818118199e-01   +8.517224865089712e-01   +2.407332545865288e-01   +8.113416154565991e-01   +4.948917453752519e-01   +7.220531257322372e-01   +5.181594090660915e-01   +2.869004708433171e-01   +4.906590131653773e-01   +8.164789244851318e-01   +4.128303382888969e-01; +3.297091949454497e-01   +5.713273427318393e-01   +5.714443841771445e-01   +2.402489618765123e-01   +4.337688264480915e-01   +2.952130904413356e-01   +5.106221356851404e-01   +2.186837238321644e-01   +8.163889294589398e-01   +2.459681871238215e-01   +2.430907863210129e-01   +1.639191692901091e-01   +4.543109411345458e-02   +4.390904585870475e-01   +9.717809640922581e-01   +9.084016671524343e-01];
L2I_L1I_iGABA_netcon = [+6.479293943587733e-01   +4.297140482155058e-01   +6.656073929814713e-01   +5.715111769620083e-01   +9.189902540469573e-01   +5.935330192857844e-01   +8.853405625029083e-01   +9.928173358204363e-02; +4.572063628818337e-01   +1.597592292995897e-01   +2.253581025874270e-01   +9.168502056021947e-01   +2.368112608909747e-01   +2.216994386035305e-02   +8.039376722394557e-01   +6.244685479585800e-01; +1.000000000000000e+00   +5.074386195386403e-01   +5.935951755778515e-01   +6.865602503919020e-01   +7.191324100454777e-01   +6.407967276086257e-01   +2.799242637966322e-01   +2.518236690489696e-01; +3.582181412395561e-01   +1.735269026773298e-01   +8.538983684382032e-01   +4.545422936099704e-01   +7.463099308582014e-01   +3.316728489560299e-01   +9.237000554071541e-01   +1.649062194497255e-01; +6.722425205603078e-01   +4.663905733227712e-01   +6.459938619439174e-01   +2.024328113279320e-01   +9.281147783705962e-01   +3.236410244096701e-01   +5.239142096676079e-01   +2.343223367577339e-01; +5.708471409025873e-01   +5.597857554313258e-01   +7.360306763505550e-01   +1.438747466761715e-01   +2.139646860715459e-01   +7.914137186365894e-01   +8.709362954259502e-01   +5.040344010643238e-01; +7.637865265878822e-01   +4.922328380036609e-01   +2.144838495996456e-01   +2.656977789221356e-01   +7.133235075595714e-01   +1.680806988064496e-01   +6.503548729187667e-01   +3.723175072384920e-01; +9.334956143224575e-01   +4.270341183101173e-01   +6.237616879107605e-01   +8.446157057482659e-01   +1.107885007958291e-01   +4.425433900885166e-01   +4.439910533124991e-01   +2.652274054885222e-01; +7.405791018568527e-01   +1.370539753143677e-01   +4.405053570390243e-01   +9.775021580933949e-03   +7.205372047056530e-01   +3.382612799386559e-01   +7.036765681122874e-01   +6.957696226926415e-01; +4.250012350526115e-01   +7.448628183254058e-01   +5.907525843919754e-01   +7.730617042208650e-01   +3.636963997212565e-01   +8.136766576808659e-01   +7.779253153826857e-01   +2.426534578250571e-01; +5.498370289229884e-01   +5.434163167254102e-01   +5.277040214154147e-01   +3.349913746973636e-01   +5.538893354242648e-02   +8.399275368420170e-01   +5.657272221773106e-01   +4.362597930641686e-01; +7.627211900080988e-02   +3.753504380135124e-01   +4.097400783953739e-01   +4.151930107884564e-01   +3.489165070598098e-01   +4.546971225686137e-01   +2.468175482515174e-01   +5.231498714453957e-01; +3.734074542303567e-01   +1.390217836402981e-01   +6.549892196712438e-01   +7.231148748906029e-01   +1.827522099676521e-01   +6.736702818560260e-01   +3.587179742068204e-01   +6.993171435206407e-01; +4.772296587516245e-01   +4.621186901485178e-01   +6.251714640830555e-01   +3.459176457509763e-01   +7.773086912946652e-01   +3.721661881882473e-01   +3.591271271027302e-01   +3.101113712681061e-01; +5.505464273515916e-01   +1.441707162722042e-01   +1.960842583648902e-01   +2.084427709755443e-01   +6.023463973676364e-01   +5.427349371843884e-01   +2.554054863881705e-01   +7.013936047770611e-01; +7.500766909637884e-01   +8.362777179082527e-02   +6.592453290816886e-01   +3.597908478933856e-01   +3.467137829656204e-01   +5.094160016306976e-01   +1.852954229756063e-01   +3.331526092048298e-01];
L1I_L2I_iGABA_netcon = [+4.841219149703020e-01   +1.693032333677067e-01   +8.357947042606826e-01   +2.874852175980016e-01   +5.181987764656513e-01   +2.564778743381550e-01   +8.518846689711610e-01   +2.236511030083548e-01   +4.935729818150348e-01   +8.293606339254019e-01   +3.496054905401280e-01   +3.961446803338686e-01   -5.071035809286110e-02   +6.923628613131192e-01   +6.193477805935326e-01   +4.721926257859902e-01; +4.650442940154663e-02   -1.297991492424246e-03   +3.175182737128991e-01   +2.664692486439797e-01   +8.662955347610172e-01   +4.030757552580487e-01   +2.923178186587275e-01   +1.607575625594610e-01   +4.460023153627551e-01   +2.281845452563438e-01   +3.055254883035633e-01   +2.602424705140455e-01   +9.901728599649979e-01   +2.111155436220257e-01   +7.859981099720785e-01   +2.650118341706327e-01; +3.619136821700116e-01   +6.237385322176362e-01   +2.886039512990134e-01   +6.566221765236234e-01   +2.677622879408529e-01   +5.666493999718527e-01   +7.535616104047711e-01   +8.241626170285578e-02   +7.542547141077977e-01   +5.008552817647424e-01   +5.651541958044735e-01   +8.618886506817479e-01   +9.692190944444135e-01   +6.608550834823430e-01   +3.848206277042319e-01   +2.101782645945308e-01; +8.593278593047432e-01   +7.919458564747980e-02   +6.663274143009129e-01   +9.371243998870848e-01   +4.502535220743302e-01   +8.660833957199753e-01   +6.380767707801933e-01   -2.700224996002207e-02   +2.991845584042492e-03   +3.145103673181529e-01   +3.877874872960296e-01   +4.266831042694617e-01   +3.029828723019082e-01   +4.989232531442859e-01   +1.840972071072507e-01   +1.944817351792862e-02; +8.993459265371989e-01   +8.043932678757605e-01   +7.726146521811671e-01   +5.733277246825913e-01   +2.882649597718177e-01   +6.472916335931220e-01   +6.360642959403021e-01   +5.962238097839749e-01   +1.035398968915987e-01   +6.623662947268214e-01   +2.215243476235093e-01   +4.645283496956807e-01   +5.515369773306856e-02   +2.319435462190560e-01   +6.877673728122328e-01   +9.380867404550862e-01; +5.476729136928500e-01   +4.865344512962925e-01   +1.206753395802207e-01   +3.112263567097521e-01   +8.944061354516565e-01   +1.547212467107497e-01   +7.260864783032108e-01   +6.021714608720400e-01   +4.762702311485891e-01   +7.098409991799192e-01   +2.980056427382992e-01   +4.889211904192814e-01   +9.071480337920824e-01   +1.135677144795416e-01   +2.351927690642337e-01   +6.993431452654636e-02; +8.805566208306547e-01   +1.033763152814388e-01   +4.252760181305881e-01   +3.316385581874680e-01   +5.413038895027733e-01   +8.541389213770683e-01   +7.630834927996145e-02   +2.647056663049329e-01   +7.709909016790263e-01   +9.438907559341874e-01   +8.932785926849521e-01   +8.207484926184654e-01   +1.581577986126927e-01   +2.295394355007933e-01   +5.264881229857845e-03   +5.475585261143402e-01; +9.243638210967158e-01   +3.658639450479895e-01   +8.399476909477330e-03   +8.800059962354377e-01   +1.780012803583198e-01   +9.595713751298763e-01   +7.703904223506898e-01   +7.438096560603649e-02   +7.906810207320792e-01   +1.194024263102248e-02   +9.009391628692647e-01   -9.732411014695590e-03   +8.440137187105823e-01   +7.143905719086828e-02   +9.370662597711403e-01   +7.058914953537858e-01];
L2E_L1E_iAMPA_netcon = [+3.294340218103893e-01   +9.250590573228803e-01   +6.383196768348851e-01   +1.607944545334434e-02   +3.600672882696952e-01   +3.286772636382859e-01   +5.800332510126849e-02   +5.945837944411611e-01; +1.951483614244479e-01   +1.604059098798959e-01   +7.589378088365818e-01   +8.511459564688024e-01   +3.659117033808035e-01   +5.392955384132199e-01   +2.037298401245551e-01   +1.167680560596318e-01; +4.897887983209243e-01   +8.721479879989210e-01   +7.373275937906653e-01   +4.808335415074545e-02   +6.344679710865844e-01   +3.696354935903060e-02   +4.268961699454680e-01   +8.408721878093008e-01; +4.309844823200470e-01   +6.423670018518538e-01   +4.503597570711929e-02   +5.572246188032134e-01   +2.430776885377264e-01   +6.008300879782513e-01   +1.457456445444408e-01   +4.594497036005717e-01; +8.246826732807909e-01   +6.685102134361582e-01   +7.617133877361313e-01   +5.255430926478432e-01   +7.165393567334040e-01   +3.814056205925858e-01   +4.007977282867584e-01   +5.231289713655668e-01; +4.769024868343288e-01   +6.464528233641483e-01   +1.617364997895997e-02   +6.308993440845260e-01   +6.616025590779075e-01   +8.429047107552540e-01   +3.194952043716908e-01   +1.002813940845924e-01; +4.283790911321237e-01   +3.331523659880171e-01   +2.358647590356107e-01   +4.063483762821188e-01   +4.135490533620992e-01   +2.587269029598045e-01   +5.487837056474497e-01   +2.525677882494593e-01; +7.288021601211806e-01   +1.856387238244092e-01   -7.159993055585565e-02   +9.728327704274156e-01   +5.517195711270598e-01   +3.691737121674302e-01   +5.976775292123381e-01   +6.464250900092597e-01; +7.911613167365160e-01   +6.025780816674774e-01   +6.652261867128878e-01   +1.075619693418398e-01   +3.688137754335608e-01   +2.266001672303666e-01   +7.260885557170302e-02   +9.792335934806966e-01; +2.506706874761279e-02   +1.694230403411592e-01   +1.556641540045569e-01   +2.026601837501557e-01   +1.542356246060429e-01   +5.550813813847151e-01   +8.741510385128365e-01   +8.676908918926715e-01; -1.167890016325040e-02   +2.303961755482063e-01   +5.533114343817150e-01   +3.999553506367128e-01   +1.686986559765748e-01   +4.522970745684647e-01   +2.376090558656626e-01   +7.107866778185313e-01; +3.369891488894462e-01   +5.965561601144725e-01   +5.899064963527756e-01   +4.576555953200829e-01   +6.716114932305101e-01   +2.924334274732627e-01   +6.912734387569917e-01   +4.738034740921392e-01; +6.955896459142291e-01   +7.186079868728737e-01   +5.492314653175804e-01   +1.761513587934230e-01   +2.340878094663975e-01   +1.233071537460484e-01   +5.976207103659370e-02   +5.238582615290835e-01; +6.914033314804842e-01   +7.954750720052370e-01   +7.539758602913053e-02   +9.124327859303083e-01   +5.180320074314242e-01   +7.868534629461910e-01   +1.325411694440207e-02   +1.790150996779699e-01; +9.442251139311306e-01   +2.062751618329486e-01   +5.117996335705848e-01   +6.058595101787417e-01   +3.101002382040736e-01   +2.062907056690295e-01   +6.508750035201518e-01   +4.555076893394018e-01; +7.806666425799881e-01   +6.051757578555000e-01   +7.402744344002156e-01   +3.764691370416634e-01   +4.633738256813544e-01   +8.233046679444744e-01   +7.020864855273503e-01   +1.533777000314548e-01];
L1E_L2E_iAMPA_netcon = [+8.336497458793517e-01   +4.115088772011283e-01   +5.648905156710045e-01   +1.775164828663335e-01   +9.328328238573610e-01   +2.104426107185610e-01   +5.107801429233518e-01   +4.500697624012534e-01   +9.786885696336245e-01   +5.003648285995411e-01   +5.732085306445989e-01   +4.432183788912838e-01   +5.561731518852990e-01   +3.281259142474488e-01   +5.935981742809442e-01   +3.112864291458138e-01; +7.909752179448829e-01   +1.731402438414694e-01   +1.607824918542011e-01   +5.503874448897670e-01   +8.065114143512422e-01   +5.589358537457139e-01   +9.045898608940376e-01   +2.568133335010638e-01   +3.542767097245888e-01   +3.092615405249761e-01   +6.234187624896633e-01   +6.555100436208515e-01   +6.361499542176869e-01   +8.802750421501062e-01   +3.774585353614037e-01   +5.395007087499627e-01; +7.507245996060882e-01   +9.239844185053457e-02   +1.335303821836109e-01   +9.748051798047130e-01   +2.388084165949911e-01   +3.491551239245345e-01   +8.632480070086924e-01   +3.406356999633232e-01   +2.038687751255610e-01   +6.221705898272829e-01   +7.797703671993220e-01   +4.808171450435739e-01   +7.733523532918037e-01   +9.113212887852211e-01   +7.799584501707567e-01   +6.096253292795017e-01; +6.481172107257518e-01   +9.782022484347931e-02   +5.085709223408719e-01   +3.386194708811268e-01   +3.800201221077822e-01   +7.818551228388668e-01   +2.237873150191696e-01   +1.660218431091163e-01   +5.857214212229105e-01   +5.183861769161711e-01   +4.066952120699781e-01   +9.558997179459960e-01   +7.010067611394493e-01   +1.646379894582060e-02   +7.700455803325920e-01   +7.846709214212706e-01; -2.749417908594221e-02   +2.204588254777781e-01   +1.357221275478834e-01   +7.197854548411363e-01   +1.444951111673291e-01   +4.293688083566863e-01   +9.398954511571233e-01   +3.360694540280140e-01   +9.884622109588380e-02   +7.752763236178768e-01   +1.000300454013235e-01   +5.264212724948822e-01   +5.587501455305915e-02   +6.172275707033619e-01   +4.535443809942398e-01   +1.842580011227691e-01; +6.617180574442312e-01   +3.571567695474431e-01   +4.023034147807766e-01   -1.749067720178644e-01   +8.816437207504818e-01   +1.180575092432918e-01   +4.826507682302300e-01   +1.899518636072428e-01   +7.393275660426863e-01   -1.451232410415846e-02   +7.292745514169960e-01   +2.885695933072396e-02   +7.181583366514507e-01   +5.230638813784340e-01   +6.780261355001790e-01   +3.119628858132536e-01; +2.579274400173924e-01   +7.203862993807537e-01   +3.269400056358071e-01   +4.067330268277483e-01   +2.400946595577139e-01   +8.391082448118461e-01   +9.445563244850727e-01   +4.271257877935351e-01   +6.686093154732052e-01   +7.392156129337982e-01   +1.403640234121976e-01   +1.341990190737902e-01   +1.009726421880454e-01   +3.252932086216336e-01   +2.989180037201381e-01   +7.624973674780200e-01; +1.562982930316123e-01   +3.937189392891199e-01   +2.572841118414973e-01   +4.565992223792641e-01   +1.000000000000000e+00   +4.411256352868064e-01   +9.148948720492645e-01   +7.920652309307580e-01   +4.070716727456138e-01   +3.832087007702938e-02   +3.729949992798233e-01   +4.101341225511182e-01   +3.227262225344006e-01   +6.720352941802553e-01   +6.333409753456268e-03   +5.198555145106653e-01];
L2I_L2E_iAMPA_netcon = [+3.298962652009764e-01   +2.834290818960854e-01   +3.188523298167505e-01   +5.622054752219210e-01   +1.573867811205513e-01   +8.151133143961111e-01   +6.845872662203516e-01   +2.331796550900804e-01; +4.606468411793633e-01   +1.465540389233959e-01   +6.844260302408433e-01   +2.721976222693060e-01   +6.659462701970871e-01   +8.496166181447916e-01   +8.589635756646459e-02   +4.921155513710854e-01; +6.347272517644015e-01   -5.574325172635075e-02   +6.984811153332019e-01   +5.671757923292539e-01   +1.718729276591826e-01   +6.006925566049288e-01   +7.636602214710668e-01   +1.943829781849058e-01; +5.028533986543060e-01   +2.470542903509264e-01   +4.809082958407423e-02   +9.425061822274765e-01   +3.492988887947958e-01   +6.254522410715242e-01   +9.499384056959496e-01   +1.760827273563029e-01; +9.724764655204908e-02   +3.967910465268485e-01   +4.983790877010018e-01   +8.282989865282263e-01   +8.389014764312298e-01   +5.383752228107038e-01   +6.831513974227331e-01   +2.060403726447406e-01; +8.029455935534625e-01   +4.333410296016147e-01   +8.924791553685576e-01   +9.011600545851186e-01   +6.783150967138454e-01   +8.044945302295203e-01   +8.342889670406872e-01   +4.854987963942821e-01; +8.412024093501025e-02   +5.478435756759995e-01   +8.760282663376774e-01   +7.872491484395236e-01   +9.161068276452713e-02   +7.173894911357718e-01   +2.072649957835032e-01   +1.107896365593544e-01; +5.784217806109393e-01   +4.160986594686577e-01   +1.632656259907485e-01   +3.000922379942565e-01   +6.655646926505485e-01   +4.154085562224884e-01   +1.000000000000000e+00   +6.666544470854926e-01];
L2E_L2I_iGABA_netcon = [+4.401336574156058e-01   +6.140709489742362e-01   +5.774289758884450e-01   +3.121527501252646e-02   +4.212447974369969e-01   +5.054161189062856e-01   +2.546836866412472e-01   +6.736890806895691e-01; +5.033363932564308e-01   +2.926454723575668e-01   +5.993208668156933e-02   +4.770144221775526e-01   +4.534322148593641e-01   +6.489938070651488e-01   +5.055196130880411e-01   +4.021166496849682e-01; +5.584138159002540e-01   +5.598612331398485e-01   +4.223616486058341e-01   +6.398197644587961e-01   +3.387139663824535e-01   +3.037328288098822e-01   +1.303091328379413e-01   +9.346589217160217e-01; +6.861444608456168e-01   +5.437213065667739e-01   +4.004451676496887e-01   +8.630100770314286e-01   +2.039605771770608e-01   +6.425050487045450e-02   +1.507044331975489e-01   +4.307857082697363e-01; +4.763935975485430e-01   +7.957684847575454e-01   +4.979477578249352e-01   +7.336218916643434e-01   +4.106523493547147e-01   +7.513826405083146e-01   +6.062651443571297e-01   +4.080390205255044e-01; +3.443031277768228e-01   +2.572259216738315e-01   +4.100186077150456e-01   +4.195811690823802e-01   +7.640400518418216e-01   +7.915177512426429e-01   -1.171655786084656e-02   +4.418471743065765e-01; +7.985378151644582e-02   +4.631621753356169e-01   +8.078404908526033e-01   +5.381536114166471e-01   +5.005467101497127e-01   +4.329883553202563e-01   +8.925037374841569e-01   -7.077720006122305e-02; +8.678939906857612e-01   +5.654941155338925e-01   +8.330237945596353e-01   +4.803572041657795e-01   +8.856783079757029e-01   +5.338882844268038e-01   +3.007101549023170e-01   +3.266087013180525e-01];
L3E_L2E_iAMPA_netcon = [+2.289230385714356e-01   +9.075295142177981e-01   +4.582897678546681e-01   +7.069131974525793e-01   +1.775689788187625e-01   +3.877903097336327e-01   +2.797162696319834e-01   +1.007932939882847e-01   +1.277262237157799e-01   +5.339161031199701e-01   +1.516792074956034e-01   +4.858066126356271e-01; +2.711684441110767e-01   +4.491906355388566e-01   +1.520431880635937e-01   +2.045400293079986e-01   +4.859702298256113e-01   +9.043742105586643e-01   +7.132677430164290e-01   +5.625458713906583e-01   +2.464241386196043e-01   +5.592498437845546e-02   -1.597711179659993e-02   +7.664655234307245e-02; +8.101141876297202e-01   +3.622303295450124e-01   +5.358233584154503e-01   +1.255931006223186e-01   +8.180213932363518e-01   +9.022702187846653e-01   +5.344138870477069e-01   +6.459587604685969e-01   +7.232154774535841e-01   +3.194133355719277e-01   +3.788175303376514e-01   +8.971812379421059e-01; +1.134474963214626e-01   +4.590840107864237e-01   +1.862457422116741e-01   +7.613557935385601e-01   +4.768657522739874e-01   +5.501993981570409e-01   +8.585381845497861e-01   +3.106421750623244e-01   +8.127499313754427e-01   +7.726203745139183e-01   +4.182327077752174e-01   +1.345565704888318e-01; +1.706459530528512e-01   +7.292419634496594e-01   +4.419564378374042e-01   +3.470999972619025e-02   +1.373175559292253e-01   +9.018912242706929e-01   -3.667863873989236e-02   +6.584918345938051e-01   +9.821855592735487e-02   +8.512156714188742e-01   +2.602308496627926e-01   +1.995416621710034e-01; +2.983872054857458e-01   +3.861845623300012e-01   +8.196689864408133e-01   +9.933172771046760e-01   +3.877187976147712e-01   +8.587936901471015e-01   +2.051311608968224e-02   +3.329613464913407e-01   +5.043058509601731e-01   +7.724781945861383e-01   +5.824189721936452e-01   +7.991142836943437e-01; +2.547547667133571e-01   +4.707500796640703e-01   +5.721086969671015e-01   +1.389057822755874e-01   +6.528027786452131e-01   +4.723804404242539e-01   +6.996752664812779e-01   +1.261259908346606e-01   +4.025578483054211e-01   +4.207688054578319e-01   +9.590908449062301e-01   +7.225849603350057e-01; +5.368686850636978e-01   -3.603172240660669e-02   +3.414858224947355e-01   +1.292768080756424e-01   +7.992681482005437e-03   +8.768424893406174e-01   +4.125222156290462e-01   +4.568030428688934e-01   +8.499459965009628e-01   +9.933671360281958e-01   +8.838290701140680e-01   +2.681110240290101e-01];
L3I_L2I_iGABA_netcon = [-1.767890934403961e-02   +1.778683964378557e-02   +8.671025139673755e-02   +6.398523903794849e-01   -1.598012125926368e-02   +5.002055184985328e-01   +7.735209522760073e-01   +4.139227699767210e-01   +3.696237580843093e-01   +8.769553105968194e-01   +8.203175142440498e-01   +6.622394972132725e-01; +4.286123475510918e-01   +4.002692344381982e-01   +2.688572949457007e-01   -8.472229993281978e-02   +4.821657475124569e-01   +6.093472450226574e-01   +4.697083123094208e-01   +9.006748244422833e-01   +1.468294186187375e-01   +8.977539591034185e-01   +2.197640479952755e-01   +6.023528160117345e-01; +3.495524867308910e-01   +6.334765712779500e-01   +2.825106252289151e-01   +7.707274145312939e-01   +3.231414474392059e-01   +8.161919361927169e-01   +8.811547269683592e-01   +1.017233246729138e-01   +6.631940895728562e-01   +4.401429940774427e-01   +1.026177575502338e-01   +5.606088896143092e-01; +5.762179453182181e-01   +1.000000000000000e+00   +2.685071163153236e-01   +1.928374504277124e-01   +1.584360759106168e-01   +5.967318255175718e-01   +1.920220519807156e-01   +2.135302232288359e-01   +5.154807003460087e-02   +3.610250197656219e-01   +5.562471488727823e-01   +7.706422345962141e-01; +9.235030844780427e-01   +1.048753307556718e-01   +4.365628358461054e-01   +8.604964691250808e-01   +4.604613086667769e-01   +8.308078636881191e-01   +1.003912205811247e-01   +5.154425711301941e-01   +5.292470059994696e-01   +7.170938212685996e-01   +7.059067790588943e-01   +4.605379322240157e-01; +8.464951890974624e-01   +2.016369635050720e-01   +1.647007224719750e-01   +7.206451767090418e-01   +8.874152391438982e-01   +7.687147646452760e-01   +9.490320553217662e-01   +5.891003251054067e-01   +1.077888502189212e-01   +7.923399529852794e-01   +3.379248048111115e-01   +5.599696674335415e-01; +1.053197925785122e-01   +4.573742782574486e-01   +8.836683893966265e-01   +5.697083633479396e-01   +9.665390501830440e-01   +7.314031135842010e-01   +8.240490444079871e-01   +6.869013705817809e-01   +5.715349595399427e-01   +3.742767226435010e-01   +3.163339999643595e-01   +4.684241900253029e-01; +3.915206103601193e-01   +3.963160088886195e-02   +7.174344540563805e-01   +1.915897458683152e-01   +4.192745426407787e-01   +4.496781167869950e-03   -2.584088706618330e-02   +8.779442572538452e-01   +4.416840456109301e-01   +9.732786446049253e-02   +7.238546589639427e-01   +4.219551245748972e-03];
L2E_L3E_iAMPA_netcon = [+9.455380937848764e-01   +1.995400451467524e-01   +4.867637797383575e-01   +7.095581734675506e-01   -3.090989182286347e-02   +6.597579250420128e-01   +7.689867071018061e-01   +1.389698062657356e-01; +3.419465726698301e-01   +5.035969709116875e-01   +6.883650423893117e-01   +6.076390094648944e-01   +2.662085298263408e-01   +1.731782262901762e-01   +8.524729603717144e-01   +1.012006797406125e-01; +5.862574581805750e-01   +5.230916975079910e-01   +8.371576576108659e-01   +5.329698585580276e-01   +9.083098690258670e-01   +4.615262628054115e-01   +9.482797275217949e-01   +4.067229549592976e-01; +2.247309611271219e-01   +8.847207846511879e-01   +8.582787182052328e-01   +3.854360370649217e-01   +3.080381861927912e-01   +9.734070876653639e-01   +2.542194873355333e-01   +4.716570356682681e-01; +5.087604381734726e-02   +1.765487113531712e-01   +7.237836769242763e-01   -7.555929761403641e-03   +2.410347756213395e-01   +4.879452257117554e-01   +4.371538239015019e-01   +5.864992601053524e-01; +3.544579433107735e-01   +8.099162541833269e-01   +1.855449028377254e-01   +7.723191283578856e-01   +8.858880411706047e-02   -6.968222302100088e-03   +4.673562849976313e-01   +1.944460959027773e-01; +4.234703965697689e-01   +7.235750521747507e-01   +6.952148436192785e-01   +2.115836832991710e-01   +7.300574445109015e-01   +2.017473741121407e-01   +6.665327452586909e-01   +9.048472752800688e-01; -1.961579041685766e-04   +4.934546795576136e-01   +8.767938096229410e-01   +4.089004289583462e-01   +1.227884622771748e-01   +7.127596119389485e-01   +1.038139530107507e-01   +3.318977704017634e-01; +9.937820043825507e-01   +9.018469359144710e-01   +8.895390141148815e-02   +1.107297940481667e-01   +1.069728223484285e-01   +8.934607626034778e-01   +2.536540659419339e-01   +8.620112372594164e-01; +1.424530244734172e-01   +3.798734468808110e-01   +8.079103004387346e-01   +3.183769499652329e-01   +4.018448771997700e-01   +8.484078042199437e-01   +5.900907021698561e-02   +8.495506598436628e-01; +6.497401870826758e-01   +3.529280936598985e-01   +2.850577290277484e-01   +2.888317754127336e-01   +1.418148084409712e-01   +2.917034800099035e-01   +1.648473318734859e-01   +1.398669460481118e-01; +1.243598536911647e-01   +5.930951626742821e-01   +7.946477567461437e-01   +4.435052627700657e-01   -4.618266608863278e-02   +6.926551729984048e-01   +7.595275390784100e-01   +7.361133289076330e-01];
L2I_L3I_iGABA_netcon = [+3.637973743951195e-01   +6.837991542354170e-01   +2.956314696866534e-01   +6.506934748381811e-01   +5.254767710001089e-01   +3.496269760771702e-01   +4.027173473157139e-01   +4.431936408231663e-01; +3.580186434273484e-01   +6.727349453397824e-02   +3.094504649466964e-02   +7.880666580945196e-01   +7.233502841404259e-01   +2.455751296057260e-03   +7.445548931007809e-02   +6.323507932667183e-01; +3.131721019897685e-01   +5.888456954683056e-01   +3.469247617762704e-01   +6.653279157722423e-02   +8.008344711157483e-01   +6.669392382642121e-01   +2.387107310328883e-01   +1.022611426281076e-01; +5.855386052785171e-01   +8.369533967725131e-01   +5.381837388279996e-01   +4.823569811383499e-01   +5.399845016549571e-01   +6.509222264499670e-01   +3.849774415101018e-01   +6.803406950251282e-01; +7.583937227304351e-02   -4.376365405732187e-02   +3.852302610267527e-02   +7.262419395787356e-01   +2.193490687932342e-01   +6.399409888814187e-01   +4.447677806824510e-01   +2.721923768635283e-01; +5.706311932427918e-01   +3.798956025326327e-01   +4.293675035818950e-01   +7.249147958907670e-01   +2.587890320699048e-01   +7.878470292092918e-01   +5.164453786543283e-01   +1.329317182626493e-01; +2.558384852338799e-01   -3.609856152151348e-02   +4.101448294739592e-01   +9.634077012661967e-01   +7.379731076366415e-01   +7.352189919196679e-02   +2.398152455302167e-01   +8.197288454669930e-01; +2.046006173579774e-01   +8.902333968886492e-01   +8.938670703686371e-01   +9.136345863421171e-01   +5.051714106275228e-01   +1.180746766890670e-01   +6.301725103337864e-01   +1.120746713959699e-01; +3.211575652799981e-01   +5.214750177980909e-01   +2.237882887310669e-01   +1.440983683706904e-01   +4.215647125841266e-01   +3.422618434065757e-01   +6.174336994232609e-01   +4.842252844105491e-01; +4.178750309163458e-01   +1.604381823499478e-01   +1.917406159490351e-01   +4.244578264685968e-01   +9.418509527373180e-01   +5.241146427726262e-01   +4.786450165833106e-01   +9.445634659234914e-01; +5.524304215350251e-01   +9.697459798946925e-02   +2.707536222674824e-01   +5.943558576852528e-01   +4.984108260450253e-01   +6.850981674879139e-01   +9.203797993536175e-01   +5.952702000673705e-01; +3.684232661652966e-01   +1.663212425463668e-01   +6.463277405593137e-01   +3.579263732748068e-01   +1.219774983870964e-01   +2.928195929888596e-02   +3.526997194141275e-01   +6.078799710488476e-01];
L3I_L3E_iAMPA_netcon = [+1.192129458465085e-01   +5.817723900936278e-01   +5.273144578645067e-02   +1.418697540196173e-01   +1.860363171980473e-01   +6.633234871662740e-01   +1.875795341286636e-02   +3.557543371331793e-01   +4.865699595411564e-01   +3.256616213543301e-01   +5.338813978029642e-01   +8.576365260402156e-01; +3.375948725441445e-01   +7.396809937128276e-01   +2.551672205922977e-01   +2.986530531047321e-01   +6.974352434381785e-01   +4.410942494126397e-01   +3.531513288352495e-01   +3.667809771279766e-01   +6.287664912582817e-01   +2.393019004528659e-01   +6.546633433982491e-01   +2.214552348393018e-01; +4.288344669788697e-01   +2.652074007081450e-01   +6.987202484788477e-01   +8.353966024207288e-01   +5.192715552906664e-01   +6.144231265998508e-01   +9.761504035627209e-01   +4.380861233577804e-01   +2.591790538296750e-01   +3.591855364265118e-01   +8.159735014906873e-01   +8.458379926750509e-01; +4.665737885741480e-01   +1.053915144936916e-01   +5.428872209873087e-01   +6.873165557175632e-01   +4.187179688757641e-01   +5.874233142393546e-01   +5.283186788382792e-01   +6.404771059949090e-01   +5.116176171479819e-01   +2.071225572328657e-01   +3.633365618673157e-01   +4.688586672488969e-01; +8.803341213435926e-01   +7.442452292580519e-01   +5.220320201468852e-01   +4.257756242686195e-01   +2.006302192470469e-01   +2.596166496870019e-01   -4.095251513176907e-02   +2.407123970117868e-01   -9.062936766700830e-03   +2.014623187115579e-01   +3.351643702642068e-02   +4.382173463917234e-01; +3.507737133457602e-01   +1.586042532624730e-01   +6.105668677766076e-01   +4.380887801828273e-01   +9.639595531558256e-01   +5.981043055255072e-01   +2.392151536997822e-01   +1.460246535679375e-01   +1.858122423035387e-01   +5.519447915151302e-01   +2.703795506546200e-01   +8.951295606006239e-02; +4.862449089941848e-01   +2.452110412851314e-01   +8.008616683172873e-01   +8.269597288095680e-01   +1.672618128926212e-01   +1.443620797348915e-01   +3.704205893082710e-01   +7.565777431221894e-02   +8.905912831037235e-01   +6.985621079797218e-01   +3.431947836010762e-01   +3.027742656383303e-04; +3.432133409427905e-01   +4.205734018002214e-01   +3.328248058854672e-01   +6.020192633168319e-01   +7.881275795039642e-01   +1.973712832966580e-01   +3.244881517455443e-01   +2.767391627239144e-01   +2.916944000612182e-01   +2.562170910422910e-01   +6.125739764177924e-01   +4.894496773938891e-01; +3.518810114015037e-01   +4.504669916015756e-01   +3.805188285104664e-01   +5.865786596138026e-01   +5.581371933308524e-01   -8.708935726623976e-02   +8.371551875385427e-02   +2.964383774526900e-02   +2.992908029743385e-01   +2.312471397345844e-01   +7.963995003478658e-01   +9.130435608156174e-01; +6.887625210222957e-01   +6.073151576858984e-01   +5.710223683489890e-01   +3.998730757043358e-01   +4.847399976621577e-01   +3.763718019867320e-01   +3.754581603453428e-02   +6.673573575145323e-01   +4.307292356695989e-02   +7.994786178372150e-01   +3.838733128764178e-01   +1.156126165941430e-01; +1.093783614951729e-01   +2.505528624919066e-01   +5.923775640144247e-01   +2.342463591344048e-01   +2.916230578058535e-02   +5.004446139829029e-01   +3.532753534094357e-02   +7.232124046848956e-01   +6.701558603053339e-01   +1.910301854040420e-01   +6.488854388110108e-01   +3.107088580639390e-01; +6.364205644463955e-01   +6.895435203335538e-01   +4.010648046858007e-01   +6.067788825651582e-01   +6.324183562124284e-01   +3.277781702240853e-01   +3.144646675409716e-01   +8.621257055934167e-01   +5.444493056967679e-01   +3.205459496553686e-01   +4.661084966077955e-01   +4.237903720765691e-01];
L3E_L3I_iGABA_netcon = [+3.596060197730011e-01   +7.465700160721352e-01   +6.499066380455482e-01   +9.331290331322637e-01   +4.932801163326377e-01   +6.199391004905250e-02   +2.734295067529298e-01   +6.616995554039644e-01   +6.803614847374301e-01   +3.263047051839228e-01   +4.572896237409468e-01   +2.925330454993377e-01; +8.581615188372931e-01   +3.653910620778081e-01   +5.713817252538621e-01   +9.106031713794187e-02   +8.196411008914435e-01   +3.804823506505931e-01   +8.725672817411775e-01   +6.558053113724664e-01   +5.701097940600933e-01   +7.438874445261346e-01   +2.747872505068026e-01   +4.544338480407401e-01; +7.507635750348480e-01   +4.061946882092812e-01   +4.468526717041579e-01   +5.578103343099292e-01   +5.629176977979923e-01   +5.209597317644659e-01   +2.752922559943349e-01   +8.604958010981151e-01   +4.766210432522123e-01   +2.124878332438519e-01   +7.818948390202312e-01   +8.763789266767582e-01; +1.652233492661457e-01   +6.413561337986673e-01   +2.944550319370363e-01   +3.427102290638049e-01   +9.823069435741318e-02   +5.752303408895917e-01   +3.077811036239992e-01   +9.714522227830988e-02   +2.763662954147603e-01   +5.122553819358030e-01   +7.773286758130511e-01   +6.172451042711509e-01; +2.839407343643199e-01   +6.193329850536218e-01   +5.945438517858320e-01   +3.215254506893767e-01   +1.083404897810278e-01   +6.706217508221446e-01   +8.273376139221235e-01   +2.938575471036748e-01   +2.384293899499413e-01   +7.739129732163066e-01   +5.565707374747014e-01   +2.202773858165084e-01; +4.175663227240325e-01   +7.838902264805424e-01   +6.907788763969941e-01   +4.515208973904739e-01   +7.015288354375084e-01   +8.993635548076701e-02   +3.238065221541549e-01   +2.066369325050256e-01   +8.746357976829654e-01   +8.751182548010865e-01   +8.341179033630756e-01   +2.355166229516314e-01; +5.859715217988933e-01   +7.516499662196561e-01   +2.205360746636416e-01   +7.173153990040311e-02   +4.385124109670566e-01   +5.834893773166182e-01   +6.124285599441409e-01   +1.816901791776864e-01   +9.301976884703924e-01   +5.976317620660138e-01   -3.654017239959718e-02   +3.162012477414121e-01; +5.126849051686360e-01   +3.775982477492389e-01   +8.898927465931354e-01   +4.206395342713234e-01   +1.362288318609755e-01   +5.139718552015578e-02   +5.596244370061311e-01   -5.989549474007913e-03   +5.958951320381847e-01   +7.702837742971824e-01   +2.436558105956880e-01   +9.879033395753406e-01; +2.731420529243936e-01   +5.599987182761706e-01   +2.816017990833568e-01   +7.833180560246514e-01   +7.681099406072186e-01   +9.561816123123576e-02   +3.703848248361435e-01   +5.988291424094920e-01   +5.649500246346827e-01   +7.912924744598530e-01   +6.721524604615616e-01   +6.529360812422261e-01; +5.434306958358282e-02   +8.808928014280604e-02   +3.005744008479082e-01   +5.756099721345110e-01   +7.077198717103874e-01   +2.069829175667838e-01   +6.729818260667586e-02   +2.969150974513455e-01   +7.279332950925138e-01   +2.307526642056633e-01   +6.119444056993227e-01   +4.580470765875583e-02; +8.832894224048367e-01   +1.036712739450471e-01   +7.195272840922844e-01   +5.252302065830815e-01   +3.705054621356897e-01   +8.443101012057258e-01   +1.673339704393283e-01   +7.969236709500120e-01   +2.949326455984146e-01   +8.977462858081060e-01   +5.366713142780978e-01   +7.307221725419855e-01; +6.512486869369057e-01   +7.946197955335196e-01   +4.869679447782845e-01   +8.399572179212679e-01   +8.087171024937950e-01   +5.438492360340784e-01   +8.866136221284312e-01   +8.762776342144628e-01   +5.258609270128867e-01   +8.010324232115138e-01   +4.709666721029054e-01   +8.987800530386558e-01];
L2E_Input1_iAMPA_netcon = [+9.292870355948448e-01   +9.570928002697484e-01   +8.772410188040787e-01   +9.232052722117265e-01   +8.323016690545066e-01   +1.000000000000000e+00   +8.750372069547353e-01   +9.245682811674943e-01];
L2I_Input2_iAMPA_netcon = [+9.304648918556556e-01   +9.309999687232710e-01   +9.677954954336820e-01   +9.094759720528984e-01   +8.320170293760772e-01   +8.659753443893475e-01   +9.478120988207313e-01   +9.342863819253848e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
