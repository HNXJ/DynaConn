function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.843593503665833e-01   +6.923002859009337e-01   +8.066685357403826e-01   -5.190792294547667e-01   +6.608953713769631e-01   +1.725391713678558e-01   +1.176029689607558e-01   -9.257865548116507e-01   -4.685245683366419e-01   +2.598494637340303e-01   +5.697120531666818e-01   +3.365372773253815e-01   +2.416792606016115e-01   -5.666080064984453e-01   +1.028947278671798e-01   -7.298626614848096e-01; +1.906212052313996e-02   -2.479488355076103e-01   -2.707970131180812e-01   -4.652345714410549e-01   -1.094297374986996e-02   -7.650088983139811e-01   -5.797328688628495e-01   -5.590174229581751e-01   +4.665787868909783e-01   +2.159737569985179e-01   -3.942288836462185e-01   -3.667886776579012e-01   +3.448905676334467e-01   +2.677855554636787e-01   -4.110805773298126e-01   +2.971148237685079e-01; +3.533620725163257e-01   +2.638754175945353e-01   +1.985704117939424e-02   +7.497128356285022e-02   +2.624842128721093e-01   -7.715280293377770e-02   +2.590584511034481e-01   +6.397546787078517e-01   -6.623594619839770e-01   -8.418936628385484e-02   +3.625934429736363e-02   -8.295390229463247e-02   +6.833250127421474e-01   -7.417375887404805e-01   -2.306089069711173e-01   +2.634938656894281e-01; -7.816064933660678e-01   +4.382044705351704e-01   -1.918917411013443e-01   +1.677036174800556e-01   +7.053938209269682e-01   +6.224852839321429e-01   +3.370396931190489e-01   +3.392128005769669e-02   +1.361347682011510e-01   -9.169361325069818e-02   +2.695187552732953e-01   +2.753377698084613e-01   -5.674335154027769e-01   +3.767956138544631e-01   +7.453546036986655e-02   +2.983790222729418e-01; +2.119286891710680e-01   -1.487377280139796e-01   -5.197071961109396e-01   +6.193627514063655e-01   -9.225126854750756e-01   -3.018418121350185e-01   +2.348509826872511e-02   +2.071555584393771e-01   -2.175653313969805e-01   -1.243510985803114e-02   -6.164912867151756e-01   +3.967888712533570e-01   +4.894366228561657e-01   +4.876745477580023e-01   -2.011003104062267e-01   -5.114522385401853e-01; -8.327217643078791e-01   +1.244302226862682e-01   +4.170515661500128e-01   -6.190298786842459e-01   +1.282401796293813e-02   +3.250048190647460e-01   -3.824972701673952e-03   -2.125888709964386e-01   -3.523033180030472e-01   -4.549790241207044e-01   -2.017341528287111e-01   -1.126389115308336e-01   -2.823866131363587e-01   -6.885203942790077e-01   +1.565337918252742e-01   +4.043447558228026e-01; +5.012586805332041e-02   +1.000000000000000e+00   +3.440162574098735e-02   -3.624488568253553e-01   -1.410527212734604e-01   +4.555774702454620e-01   +3.186927824386566e-01   -8.627173185740719e-01   -1.333889867469379e-01   -5.065234793621395e-01   -4.209640958411764e-01   -1.802763603066034e-01   -3.257326555715310e-01   -7.740533154648274e-02   +3.154274587664350e-01   +2.819502232236068e-01; -6.910596665412516e-01   +4.062858224664570e-01   -2.421561365037402e-01   +3.172512979459720e-01   +4.890081863188144e-01   +1.142854937544442e-01   +6.812371629611292e-01   -8.335987417259676e-02   +1.040597902795183e-01   +5.366696655184180e-01   +5.780765688504930e-01   +3.628565345642286e-01   -1.647623012063970e-02   +5.105942452031748e-01   +4.647768548822763e-01   -4.293535842013843e-02; +8.203484265735191e-02   -3.984080609639574e-01   -1.214457403653846e-01   +4.364879026429859e-01   -2.487622689076686e-01   +1.192526821232474e-01   -3.242418368748085e-01   +7.093773690550588e-02   -5.567334731855093e-01   -3.252958201467133e-01   +8.391350974740142e-01   +1.014292054383645e-01   -4.545207810823120e-01   -8.729635903088770e-01   -3.510106979765306e-01   -2.855783249489467e-02; +7.037732868402619e-01   -9.095956557552161e-02   +6.953918846893525e-01   +4.153162109035470e-01   -4.572231887349336e-01   -3.071609064730916e-01   -4.845519907317803e-01   -3.931807585714212e-01   -2.721000901123973e-01   -7.814219381496660e-01   +2.483133990601074e-01   -4.180181652892684e-01   +3.898726809702402e-01   +3.135006101775053e-01   -3.248399730494068e-01   -3.272784913004625e-01; +8.183024066109282e-02   -7.329389515321948e-01   -4.448968373014671e-01   -3.796683164569231e-01   +4.234546565350873e-01   -2.101044945289118e-01   -4.236906987190946e-02   -7.007461528052721e-01   +5.826499062326700e-01   +3.163252943417766e-01   +1.931337115780346e-01   -2.775036002120515e-01   +5.458328589058203e-01   -5.689125610409855e-01   +6.661372354614812e-01   -5.578138179575381e-01; -4.101763879941575e-01   -1.489100498768809e-02   +9.132602696541017e-01   -2.217259252731560e-01   -4.514168056121582e-01   -5.376610566691127e-01   +5.096276073727469e-01   -3.667083874529504e-01   +5.483529373727553e-01   +4.244979242783475e-01   +4.480775587949555e-01   +6.601947059803150e-01   +1.916364159963617e-01   -3.301412190351747e-01   +8.456596067420838e-02   -3.205918405562045e-01; +1.408012056752136e-03   +4.522129112309305e-01   +2.500797089393606e-01   -4.551530431315504e-01   +1.203508747382316e-02   +1.053065951868046e-01   +9.801456041485883e-02   +2.226940497669359e-01   -1.677906782553211e-01   +3.981939049416769e-01   +3.861618078902554e-01   +2.378941411411080e-01   +8.629680251391916e-01   +6.066861314892442e-01   +4.503011934420275e-01   -6.129804488765215e-01; -1.286249232830517e-01   +6.089009872373481e-01   +3.646543672864771e-02   -2.910198089344515e-01   +1.007414032927053e-01   +7.632432560322253e-02   -5.785775688022828e-01   -5.902303325379933e-01   -2.098074015712177e-01   +8.053274262810775e-01   +5.769598112429423e-02   -2.322608630917387e-01   +5.179825224689775e-01   -6.798582802817861e-02   -4.441310133200646e-01   +1.490079554720327e-01; -2.413944514675154e-01   +2.806467513274456e-01   +2.303768730028344e-03   +4.126701778327822e-01   -6.430197763491302e-01   +5.610171955934675e-01   -5.128849280019657e-01   +3.159155399576872e-01   -2.346911653940801e-01   -9.677808462943274e-01   +2.915479530169407e-02   -3.765372998804055e-01   +5.442806460188768e-01   +3.194087365665705e-02   -4.538145445238568e-01   -3.378221321584341e-01; +9.167098358889719e-03   -5.613461624352376e-01   -1.997526745515752e-02   +6.223088241808583e-02   -4.492416339321721e-01   +2.785766911500584e-01   -7.425022107684592e-02   -4.330360697922765e-01   -4.511427124685599e-01   +7.471914269860980e-01   +6.030355240163309e-01   +3.914858954250767e-01   +2.080834094266975e-01   -9.106513585652823e-01   +6.155368065169834e-01   +3.928365368717750e-01];
L1E_L1I_iGABA_netcon = [-8.939106955780017e-02   +4.396520443558876e-01   -1.803891187469481e-01   +5.500798812239843e-01   +2.630773249446149e-02   +3.371755059878942e-01   -1.362704598035718e-01   -9.432334524014144e-01   -2.839166933523166e-02   -6.315504169707976e-01   +4.719369421103777e-01   -1.606609255490998e-01   -6.261860517797856e-01   +8.255150075284297e-01   +1.212100305736516e-01   +7.208112449489537e-01; +2.947947452910325e-01   -3.983590348746459e-01   -1.938634763468339e-01   -4.879340576455754e-01   -1.746689971627745e-01   +1.621406313628905e-01   +2.832430011032110e-01   -4.623493111952548e-01   +2.563632407454813e-01   -4.219751800506396e-01   +6.768127850955009e-01   -1.406083629772953e-01   +9.414281018871239e-02   -7.743279449250728e-02   +2.748098508773014e-01   +2.272207876573793e-01; +2.193599007189954e-01   +2.027038161579057e-01   +8.092506490791325e-03   -2.872105085317249e-01   -6.218961689865642e-03   -5.762955372656637e-01   -1.979698316835268e-01   +4.050589217997919e-01   +8.397882105864833e-01   +1.931920684143816e-01   +2.847196804089077e-02   +9.375495295004672e-02   -3.470933656374683e-01   +6.613438118538797e-01   -1.518935982295256e-01   +7.301931482301443e-01; -5.205596534282554e-01   +4.498789897061738e-01   +5.436143470045198e-01   -4.475910205472204e-01   -6.900546359911055e-01   +4.841218930555027e-01   +4.507152717942999e-01   +4.573305404650849e-01   -6.245057258138207e-01   -3.467971219451780e-01   +3.273178881446970e-01   -1.316948515988793e-01   -2.174383713684516e-01   -1.862349765404214e-01   -4.737387593060925e-02   -4.810623716615242e-01; -2.068619668097029e-01   -1.098336787984145e-01   +2.542284608281262e-02   -5.790522891687615e-01   +5.089718359543312e-01   -4.736863338855250e-01   +2.215524705440601e-01   -5.005108092338429e-01   -1.017501212156225e-02   -8.158667322272941e-01   -1.216716752371182e-01   +1.846295699114892e-01   +2.894161480394821e-01   -1.769631678853861e-01   +8.748663481788531e-01   -2.507096957176436e-01; +5.127417607684056e-01   -5.339534117115267e-01   -6.116058932766971e-01   -6.089885538107476e-02   -3.845783354489726e-01   -5.418665099338315e-01   +5.227388014559019e-01   +1.524387609868460e-01   +1.668816923435481e-02   -1.311295920923859e-01   +7.112686754765328e-01   -9.354044956383735e-02   +2.180449372301546e-01   -4.564073189461790e-01   +6.642360953294636e-01   -2.728112455963073e-01; +7.290931175323027e-01   -3.084850649990913e-01   -4.400306176412954e-01   -1.208593215857027e-01   -3.172461232836818e-01   +3.707009887588174e-01   -5.713355769423106e-01   +1.079447833594874e-01   +4.431447293359560e-01   -5.504759390696869e-01   -2.230929779940716e-02   -2.338151581472422e-01   +1.238925329496166e-01   +5.151896343560837e-01   -1.746885120197155e-01   -5.385776949109138e-01; +2.357733344605048e-02   -3.986340950039092e-01   +2.102469745087651e-01   +2.130767747012491e-01   -4.104606563528246e-01   -2.553120233956965e-01   +2.648689909443740e-01   +3.580016126638988e-01   +1.959808305157840e-01   -4.271856940817532e-01   +6.751722067554280e-01   -6.459947031103725e-01   -6.621423791132993e-01   +2.670978793835752e-01   +5.397483399885854e-01   +3.755293873904050e-01; +3.832971169195384e-01   -5.591721395142402e-01   +1.390810730521820e-01   -3.636767258221528e-01   +3.557716476236847e-01   -7.918448264965541e-02   +5.931907496951516e-01   -3.232074767155697e-01   +3.058729028752720e-01   -4.395010674801974e-02   -4.236988173384077e-01   +4.997352411967310e-02   -8.277486983340002e-03   -4.652391277868500e-01   -3.687754149881936e-01   -4.956048135456412e-01; -3.531490223517596e-01   +3.253807390578052e-01   +4.162899950689861e-01   +2.030434016509636e-01   -2.168563826682599e-01   +3.682362294134559e-01   -8.361422232729407e-02   +3.913978596825291e-01   +6.088231984374080e-02   -1.287168197600995e-01   -3.782163920013902e-01   -7.372082721740057e-02   +2.310904533546267e-01   -5.770669367765395e-01   +7.679131745388731e-01   +3.611136149185342e-01; -6.564404651557199e-02   +6.129812058619617e-01   +7.958749578997778e-01   +1.892624598876307e-01   -9.435128491176381e-02   -7.312127981773417e-02   -4.350747240446616e-01   +1.618309635540128e-01   +6.865123669462186e-01   -4.476381614389172e-01   +3.701022157876702e-01   +3.022155994715076e-01   -1.316329286537172e-01   -1.694416201170843e-01   +3.707874399660566e-01   +5.907487735357483e-01; +2.205757696348553e-01   -9.285290668972617e-01   +4.841758153402616e-01   +4.473021036978176e-01   +1.579213820098299e-01   -3.369759281258629e-01   -4.636797617284117e-01   +2.238621547483837e-01   -4.606169885758655e-01   -2.388689927561851e-02   +1.187587105383178e-01   +1.000000000000000e+00   -7.104842851830846e-02   +3.641903165163088e-01   +3.368849768830859e-01   +4.564252875335613e-01; -9.624337078538198e-02   -3.578092625770112e-01   -7.429669578359509e-03   -6.840365636958048e-01   -5.769682262041935e-01   +4.784705960619247e-01   -4.182390076805203e-01   -4.342914445513563e-02   -3.880196000779728e-01   -2.059985903436248e-01   +4.251620348432159e-01   +3.135163963941050e-01   +3.386803007216061e-01   +8.177403492005305e-01   -1.893282520572275e-02   -8.831916791471647e-02; +5.026534266566112e-02   +5.029970225002418e-01   -1.403526571767908e-01   +7.665048135762815e-01   +2.770527939113953e-01   -3.833440369571925e-01   +2.653461955261902e-01   -8.768036757349779e-02   -1.953698084535117e-01   +1.310731775767224e-01   -7.243633203115437e-03   +5.281709351920639e-01   -4.224937460239326e-01   -1.738431782861828e-01   +1.225996210854499e-01   -6.430882981100955e-01; +5.463818260220940e-03   -7.755905121381124e-02   -3.166863953618581e-01   -5.975650376739511e-01   -4.989746976352235e-02   +3.211190605021647e-01   +2.973030566753866e-01   -5.861384544559406e-01   -4.846452382085026e-01   -1.469172723427784e-01   -1.998639347224480e-01   -8.961168492941051e-01   +5.171154853013646e-01   -5.096058617240499e-01   +9.428531921642678e-01   -3.131297857482180e-01; -2.492144280932115e-01   +6.887088210852257e-01   +8.660903637020828e-02   +5.194560063328895e-01   +2.941792334379632e-01   -6.610394894445090e-02   +2.974728301740118e-01   -5.975845336559692e-01   -2.786234143267258e-01   -4.637353600412707e-01   +6.580368199330272e-02   -5.086615993690483e-01   +3.589396353807011e-02   +3.113562969359934e-01   +4.783063744138592e-01   -2.517137911631386e-01];
L2I_L1I_iGABA_netcon = [+2.820644059076419e-01   -7.739145180875695e-01   -7.461165872237223e-02   -7.249869184986093e-01   -1.706770036262745e-01   -4.555838187220732e-01   -3.857362284196286e-01   -3.407636686586848e-01; +3.848103792046811e-01   +1.633917226934864e-01   +2.888363258255764e-01   +2.869138628954782e-01   +5.912499958111642e-01   +1.114817985234596e-01   +4.252855840451991e-01   +7.485222140992474e-01; +5.207808035924719e-01   -5.279935545762445e-01   +1.107010751139430e-01   -4.637142636056041e-01   +5.005543737901403e-01   +5.247179314252608e-01   +3.476657004762597e-01   -2.513212558556475e-01; +2.981660302317379e-01   +4.756533780509544e-01   +2.602467552434625e-01   -2.542535944641771e-01   -3.931431149849310e-01   -5.587660701472519e-01   +4.094776993123854e-01   -4.316808173551576e-01; -1.217984317866223e-01   +4.449736841070035e-01   -3.636863129921826e-01   -4.171634241931733e-01   +3.589150514666197e-01   +7.588972627181994e-01   -5.747921516703566e-02   -3.015745313591034e-01; +7.527883042163340e-01   +1.643898294020099e-01   -5.925694944566580e-02   +2.845151232619393e-01   +1.044989565650976e-01   +5.239244247245087e-02   +2.632605574615439e-02   +2.896431809485582e-03; -1.000000000000000e+00   -3.249452047307276e-01   +3.796263353331109e-01   -3.184089164116555e-01   -3.167048354493178e-01   +9.999852979408344e-02   -1.961286025869503e-01   +2.168620061886783e-01; -1.836655713054653e-01   -5.429174649232594e-01   -1.374805091153488e-01   +3.765421826385263e-01   +7.768520253696138e-01   +2.701332377338172e-01   +2.109908385415165e-01   +3.864981811905520e-01; -3.434689626579743e-01   -6.807170770157394e-01   +7.021375915458287e-01   -6.161006486939483e-01   +4.472780197621775e-01   -7.554820512386944e-02   +8.623311771414841e-02   -3.411889636529564e-01; +1.112364254546262e-01   -7.514688336228516e-01   -3.468508845184047e-02   +2.981944531704423e-01   -3.997498996976003e-01   +1.796392156332943e-01   -3.175305183764727e-01   -7.954521171633474e-01; +4.987982063073088e-01   -3.277290374380738e-01   -2.549302465083304e-01   +5.128487724413082e-01   +2.891487765476797e-01   -2.302725375627191e-01   -3.680851984003879e-01   +2.797715791687053e-01; -3.257085692636325e-01   -1.637342733781320e-01   -1.557911813059793e-01   +4.125654555167313e-01   -4.141384169441263e-01   +6.687877358703136e-02   -3.219530895543339e-01   +8.606804762251717e-01; -5.102847138886806e-01   +6.402883065199136e-01   +5.360601432461575e-01   +1.559874187848147e-01   +8.135612209499241e-01   -4.248360860506821e-01   +2.938931773163244e-02   +9.019852450410819e-01; +2.808220772899023e-01   +7.767886867534880e-01   +4.944570371905189e-01   -1.926790180787297e-02   +8.250799219141851e-01   +4.500978511849200e-01   -1.834899292459422e-01   -5.341443580300177e-02; -3.339968503380809e-01   -9.453031433195434e-02   -2.506208898517309e-01   +3.946332610740974e-01   -1.645111202568784e-01   -2.751462826370530e-01   +4.936962408075967e-01   -4.011437453598032e-01; +3.627967129525292e-01   -7.961340735248736e-01   -6.986148411257060e-01   -2.739531172084104e-01   +6.731268913357114e-01   -3.459643354135732e-01   -5.696076697471610e-02   +4.626377537227955e-01];
L1I_L2I_iGABA_netcon = [-6.376221501334575e-01   -3.640321537968553e-01   -4.926867455949800e-01   -6.091214388290064e-01   +3.098558631766227e-01   -3.544461795116847e-01   -8.660964858848151e-01   -5.696356837882232e-01   +7.230981023053427e-01   -4.094693157134631e-01   +1.165281264336434e-01   +2.057477594040455e-01   +9.798197783608286e-01   -8.625228328788009e-01   +6.817405855876331e-01   +4.430638167550667e-01; +5.020493975868714e-01   -4.729332617275470e-02   +5.736975192216168e-01   +9.336424739917741e-02   -9.403150631504928e-02   -3.942917866037747e-01   -5.699809022746080e-01   -7.025369665851683e-01   +4.113248699256520e-01   +2.077452927627176e-02   -2.802073118367439e-01   +1.173418346133821e-01   +2.927325806096924e-01   -4.615486055013469e-01   -4.489252020633089e-01   +6.113215343822859e-01; -4.156426232398570e-01   -2.815657954966721e-01   -1.886347711389020e-01   -3.107686125496946e-02   +6.194707851628095e-01   -6.313342610475161e-01   +3.863431151722456e-02   +5.786009249201354e-01   -2.971483087813606e-01   +7.839118353554374e-01   +1.000000000000000e+00   +3.400214421100908e-03   +4.653752865368998e-01   -2.259946280461954e-01   -3.861878822491872e-01   +8.002991633142061e-01; -8.652414288541657e-01   -2.708808309270150e-01   +2.032497675300751e-01   +7.713762708033246e-02   -8.987442454927442e-01   -4.083114885680965e-01   +4.723084563381426e-01   -7.840235081604319e-01   +4.185623469051058e-02   +3.502760200843043e-01   -8.639411741930555e-01   +3.663810900331920e-01   -5.850862014768897e-01   +1.125382251990022e-01   -1.100762888326402e-01   +2.761190759645571e-01; -2.409294033627181e-01   +6.155339413475621e-01   -4.763416313099273e-01   +5.109408311458520e-01   +3.884590926439049e-01   -5.747270155321798e-01   +2.894241531752174e-01   +4.947506579449107e-02   +3.011579947477816e-01   +2.441973011097211e-01   -7.836717195308470e-01   +1.853593357024223e-01   +4.411578995287735e-01   +6.674055468060806e-01   +8.119043017829884e-02   -1.051169509125658e-01; -7.512695171779450e-01   -2.890187211634064e-01   -1.212023726014992e-01   +2.340731666356398e-01   +3.185040261261723e-01   -2.391895748440253e-01   -3.027131289374511e-01   -7.592233218642402e-01   +1.463933845738566e-01   -1.134560999173352e-01   -3.541818412261128e-01   -2.152393587864621e-01   +3.547108500707956e-01   -2.202706750139012e-01   -2.387397139576393e-02   +2.188582486335434e-01; -6.814703221670994e-02   +2.366374314860312e-01   +4.675118419581459e-01   +8.255819393081493e-01   +1.904583019501802e-01   +4.349660362776441e-01   -2.098617132447410e-01   -5.234000280224337e-01   +6.379998119973121e-01   -4.052359128708686e-01   +4.547814412757307e-01   -5.532624395757120e-02   +3.260433575262640e-03   +8.508398227104381e-01   -1.521810389221566e-02   +9.335666235302223e-02; +3.068346760118146e-01   +6.771268953973408e-01   +5.122004053828817e-02   -2.638106220763490e-01   +7.564527344225329e-01   +4.800619089228487e-01   +5.103374664427831e-01   +5.879563354235795e-01   -1.436995648015721e-01   +8.110498885307784e-01   +6.546210649993673e-01   -4.955340897461907e-01   +6.174898166573317e-01   +9.998032990223325e-02   +3.438799668428188e-01   +5.916117522487314e-01];
L2E_L1E_iAMPA_netcon = [+7.136552305806562e-01   +4.165281368613253e-01   +7.803914373816582e-01   -2.190630479983775e-01   -3.470369672966056e-01   +7.245146205874816e-01   +1.146345847430313e-01   -1.294473986824476e-01; -2.422355014349560e-01   -3.327820955749773e-01   -5.739431044110187e-01   +7.225517961092418e-01   -5.907587082275065e-01   +5.737550260541564e-01   +2.536713431990733e-01   +1.808578639729561e-01; -6.550634778295371e-01   -1.114577263640396e-01   +3.031779703651282e-01   -5.244056746054803e-01   -3.642878556183476e-01   +9.295904297633552e-02   -2.601680905130471e-01   +6.353899632074208e-01; +1.605938921797390e-02   -4.589891813352842e-01   +7.092917885494265e-02   +7.118607220477944e-01   +1.309102064959329e-01   -6.099750454568662e-01   -3.910343957952656e-01   +8.318793857015337e-02; -1.581002744605770e-01   +4.940750702795742e-02   +5.746717467188680e-02   -2.568230138165055e-01   +4.954539850492438e-01   +2.105728336725867e-01   +8.891983419801361e-01   -5.603966275302579e-01; +1.407407440570803e-01   -4.142874498715229e-01   -2.463075130717840e-02   +9.514382414169976e-02   -3.002519590021931e-01   -3.037847884844683e-01   -1.000000000000000e+00   -3.531039785939044e-02; +2.937526651511592e-01   -4.167747878934795e-01   +4.027142104899120e-01   +1.527468800145097e-01   +2.602103728180798e-01   +7.407747269458283e-02   -2.374058656168795e-01   +9.443847865300292e-01; -7.076575784299496e-02   -5.363194718907165e-01   +7.436560640487322e-01   +2.206374764056259e-01   -4.548596787543160e-01   -4.663829787366195e-01   +5.121029461397355e-01   -5.034548914100473e-01; +4.579733456162356e-01   -5.763683274291213e-01   -4.554797014121483e-01   +6.991981443652806e-01   +1.266606917414201e-01   -4.725647029191445e-01   +2.058560897308940e-01   -2.311303186255837e-01; -4.073009965350503e-01   -5.820246580507420e-01   -5.417747412288589e-01   +2.813988197905524e-01   +7.783327589893440e-01   -9.397150706934322e-02   -6.167399265789517e-02   +3.584208514103753e-01; -8.211805352042629e-01   -5.848753174531314e-01   +4.031890247832840e-02   -1.083277423298246e-02   +4.762050073585669e-01   -2.402210323094459e-01   -4.461863525005373e-01   -1.583357608872787e-01; -4.096729805383474e-01   -1.815340250197640e-01   +4.116069539434447e-02   +5.316473551629484e-01   -3.130229911554475e-02   +1.765114451557380e-01   -2.033790728527026e-01   -4.527757204245186e-01; +2.472931672793871e-01   +2.075668027133274e-02   -4.753961967873218e-01   -3.897292446062932e-01   -4.870959606381500e-01   +8.132554437282119e-02   +8.559582638756028e-01   -5.146228356740814e-01; +4.174540810546118e-01   -3.085766540585045e-01   +1.237866841785459e-02   +5.386256547158000e-01   +1.934409376368232e-01   -2.684517319215918e-01   +3.886751747966699e-01   +4.360076375214852e-01; -6.208356440404512e-02   +5.636181070477309e-01   +2.743887584451787e-02   +1.927413125702329e-01   +1.718114351801137e-02   +9.474620992620082e-02   +4.637105678476798e-01   -2.613294292524475e-01; +3.484762732466748e-01   +6.421695387233686e-01   -1.381947606379958e-01   -1.065337882745143e-01   -9.834370329684110e-02   -2.301017266556369e-01   -5.098878253750505e-01   +3.536990563564888e-01];
L1E_L2E_iAMPA_netcon = [+6.405255146080490e-01   -5.072149927718087e-01   +9.655790423318689e-02   +2.759926609019235e-01   +4.897859952305638e-01   +5.949618421986603e-01   -3.919660056553087e-02   +4.474521881861822e-01   -5.396618146311241e-01   -9.574398222672750e-02   +6.225376088719400e-01   -6.415389698939165e-01   +2.194910068588956e-01   +4.471109134709622e-01   +6.495381220558761e-01   +1.352425490989370e-01; +1.722468887805481e-01   +7.012708116084716e-02   +1.134354034656142e-01   -3.087457677627091e-01   +2.516341636405796e-02   -5.220044429911070e-01   +6.800187050524715e-01   -6.822156216500987e-01   +1.678482412693170e-02   +2.134272366061511e-02   +1.248499889163620e-01   +2.730957871832937e-02   +7.095284766952823e-01   -1.297801420490736e-02   +5.791648825423078e-01   -5.390465751613950e-02; -1.100695665956615e-01   +4.688427827541955e-01   +1.240503279281752e-01   +5.421613856220303e-01   +4.563083095050890e-01   +8.852850630014246e-03   +8.568002325633151e-01   -2.722566012342563e-01   +6.460916168672365e-02   -5.626308633374836e-01   +4.496923522896540e-01   +1.083825911964154e-01   +2.987566125085715e-01   +3.348367047179302e-01   +2.920359827522090e-01   -5.152756159704864e-01; +2.951583588821917e-02   -1.747356315130059e-02   +3.362377021292864e-01   +4.761164911919426e-01   -2.695771858260704e-02   +1.044007477658347e-01   +6.569988277463723e-01   +7.345302147722833e-01   +4.759577001773314e-01   -1.908442964319318e-01   +2.330922687273451e-01   -4.163994092318619e-01   -6.417668133926308e-02   -3.768952382687256e-01   -1.079865521706677e-01   +3.320347444993112e-01; +5.745936049179821e-01   +1.261547087569411e-01   -3.540651089112792e-01   -6.516853292751558e-01   -3.397614404389026e-01   +6.604762588719315e-02   +1.411508490484126e-02   +3.448657359282229e-01   +1.195111635329876e-01   -1.057898418412201e-01   +5.831579084752396e-01   -4.068569596305616e-01   +5.691550952397553e-01   -5.086650793735787e-01   +2.866199079565146e-01   -9.323669412181202e-03; -2.495245979606970e-01   -3.235776253039093e-01   -1.062065526518005e-01   -8.724795665726250e-02   +1.607549696631424e-01   +1.130687186494029e-01   -1.602179020440559e-01   -5.144454628810677e-01   -2.481654373797591e-01   +2.610613487911501e-01   +1.680698337044642e-01   -3.564343635096075e-01   -3.699563733080089e-01   -2.348961805909027e-01   -1.977681414564302e-01   -2.727136024368933e-01; +3.527189479901219e-01   +1.000000000000000e+00   +4.518142828571586e-01   +4.934252872533829e-01   -6.039765001140038e-02   +1.577419801949248e-01   -1.887099955497299e-01   -6.137291637981594e-01   +3.657502949833994e-02   +2.629714242955273e-01   +3.830779244553381e-01   +6.381762869127598e-01   +4.408129933675412e-01   +4.844094520210274e-01   +1.967523994173094e-01   -3.068960682859733e-01; +5.520295060348189e-01   +2.944906555348527e-01   -4.981709614554291e-01   -3.549653917164068e-01   -8.069334354781620e-02   +2.647866044553157e-01   -3.302277248309640e-01   -3.483462279990241e-01   +4.955610857528637e-01   -6.117855663771844e-01   +4.706400136610056e-01   -6.827006629709528e-01   -1.616184437454883e-01   -9.512926008317744e-02   -2.759347603297080e-01   +1.022271315293909e-01];
L2I_L2E_iAMPA_netcon = [+1.091792703912511e-01   -9.763405333371404e-01   -3.950829539385030e-01   -4.046254176142724e-01   -3.046370629817658e-01   -5.970103151474919e-01   -4.645928304613973e-02   +4.545055544321238e-01; -3.406632007747727e-01   +2.532656646393912e-01   +3.607020133516726e-02   +2.816854336459264e-01   +1.925521625360127e-01   +1.000000000000000e+00   +2.719282234887171e-01   -6.454046963483389e-01; -1.484539806115037e-01   +5.359081213191618e-01   -4.518128501652378e-01   -1.563163885723456e-01   -7.125908051003256e-01   +3.825239554774805e-01   -2.260534791353404e-01   -2.447898488017409e-01; -8.742158057137381e-01   -4.541552811280929e-03   -3.586195762026843e-01   +4.922801410422292e-01   +4.320395863408679e-01   +2.888068844323476e-01   +2.399160413179670e-01   +1.627094781012141e-01; -7.337684036421095e-02   +1.819943590558118e-01   +5.871103569328463e-01   +3.758139407235334e-01   +4.741803094550382e-01   -2.278896608588239e-01   +4.328458644466430e-02   +8.542462541917943e-01; -2.558066449599227e-01   +5.389772633591254e-01   -3.020120506513422e-01   +1.339121874607577e-01   +2.127813665183500e-01   -2.101784899986363e-01   +5.360701114753005e-01   +8.200081433207628e-01; +3.224674337185325e-01   -1.486532416208922e-02   -4.210800108369172e-01   +1.893066735719894e-01   +4.778003306913964e-01   +2.447854356333815e-01   -2.212746454648810e-01   +6.372418295465087e-01; +3.407768176101731e-01   +8.803621373971841e-02   -5.097419061052348e-01   -1.887186672466147e-01   +3.312081380222570e-01   +8.573248686749827e-01   +3.254131051770324e-01   +8.254461026747566e-01];
L2E_L2I_iGABA_netcon = [+3.713795254005472e-02   +1.000000000000000e+00   -7.039662629279181e-01   +1.119038362708454e-01   -8.111223293581482e-01   -6.205434613583880e-01   -2.558762190246770e-02   +3.167990894558497e-01; -3.622063042018115e-01   -4.867181251875593e-01   +4.957315194495452e-01   +4.033290413083109e-01   -7.554267608750773e-02   +1.349767064854635e-02   +5.695089795134842e-01   +4.363000789405042e-01; -7.613315565252906e-01   +6.701082146877022e-01   +1.489653768240250e-01   -3.298832249319644e-01   -5.998892605071349e-01   +1.875109544413832e-01   +2.867139419467951e-01   -3.327382501612748e-01; +6.763290837915055e-01   +6.573574752921627e-01   -2.355743929484725e-01   -2.070891148472480e-01   -1.848944542335189e-01   -2.838014174153274e-01   +8.294120043755235e-01   -3.715070487619474e-01; -2.179049955837143e-01   +4.074999082735621e-01   -2.786965371330011e-01   -4.070766203087304e-01   -4.246906761599333e-02   +4.112947450317299e-02   +3.979852443365066e-01   -6.850190544642240e-02; -2.283808220189636e-01   +6.142112259170998e-01   -1.426180920850408e-01   +1.765700490811144e-01   -7.382967712127784e-01   -6.390923993924685e-01   +7.203994881929324e-01   -4.682097970211044e-01; +5.864014460207846e-01   -7.848479578926258e-02   +6.291341690916506e-02   -4.470064607313069e-01   -7.197240441500083e-01   -5.390290506649391e-01   -2.795092341750539e-01   -3.719292317949282e-01; +6.661184619859893e-01   +8.447331296041951e-01   +3.021691907277821e-01   +1.501266782423785e-01   +2.022460670135607e-01   +8.058013698851636e-02   -7.898939959595368e-02   -3.062351934810898e-01];
L3E_L2E_iAMPA_netcon = [-4.875239046224624e-01   -3.235917249417025e-01   +7.396714364500351e-01   -1.000000000000000e+00   +6.161906779490900e-02   -5.383176440486585e-01   +4.107261795178062e-01   -7.720053003928181e-01   -3.651440913620041e-01   -4.142463906012869e-01   +4.039622028006591e-02   -7.246275030433925e-01; -4.900120107783282e-01   +7.844610707073695e-01   +6.364130960385220e-01   +4.287476895007490e-01   -1.183613371953729e-01   -3.608971078839336e-01   +6.413377420750836e-02   +3.415746380863621e-01   +1.302787427188128e-01   -8.565924882603753e-01   +3.736420857457328e-01   -3.305382540253516e-01; -1.338967615287567e-01   -3.953728500880654e-01   +7.266672754507354e-01   -6.792797507354069e-01   +6.137002382489603e-01   -7.533493450583287e-03   -2.111087521588479e-01   +1.577093719312424e-01   -4.660216665465292e-02   -6.536828914635052e-01   +8.540847278664948e-01   -7.910612242068552e-01; -5.263359000762861e-02   -2.650723136866520e-01   -5.690809118727702e-01   +5.689743191059108e-01   +1.712775628704782e-01   -2.738851517247904e-01   -6.322399565067225e-01   +1.659027385908062e-01   +2.109787220132035e-01   -6.022360839629304e-01   +3.724408270095046e-01   -3.340907262732286e-01; +3.272465993415299e-01   +1.239486921923905e-01   +6.033172371255126e-01   -4.067806011477559e-01   +2.248325272138062e-02   +5.131217365638656e-01   -3.900780637582276e-01   +4.766478995092616e-01   +7.912705594228842e-02   +6.813575918227764e-02   +1.914003147973637e-01   -3.892068584955004e-01; +6.073454563527824e-01   -1.080735169233175e-01   +3.630224039851029e-01   -5.363065149270647e-01   -2.789089251314218e-02   +4.502319610225117e-02   -3.079386956694375e-01   -2.746307868293310e-01   -3.424052323625172e-01   +1.588840646981392e-01   -9.996136425011924e-02   -8.892460619697686e-01; -5.697868197652030e-03   +4.401415266324930e-01   -3.473341613385968e-01   -8.616218140331228e-01   -3.908828744270552e-01   -4.803555527398098e-02   -7.345724019448427e-01   -6.031924906966560e-01   -4.812979299932149e-01   -4.709610962755914e-01   -4.421288627208305e-01   -2.096519300915361e-01; +3.261319530062526e-02   +5.814055586142149e-02   -2.945738308049065e-01   -1.855579821369685e-02   +2.017976856182885e-01   +5.971029857218055e-01   -7.651815617131515e-02   -4.463309787090894e-01   -4.198067243570005e-01   -4.320615431806070e-01   +6.136588277271808e-01   -2.259029967725567e-01];
L3I_L2I_iGABA_netcon = [-8.707044106271163e-02   +2.409464591022947e-01   -5.370292053060887e-01   -3.894015260413015e-01   -4.883267080434602e-01   +6.555507457635789e-01   -1.609289117447767e-01   +4.350311285828296e-01   +2.342005464426219e-01   +5.979246525458496e-01   -4.763548392248365e-01   -1.022688047202061e-01; -5.829435233323023e-01   +5.317617522444735e-01   +1.162542309968037e-01   +1.368459612857204e-01   -3.876989746072118e-01   -1.849715934033399e-01   +6.237776983010838e-01   +2.513184763026055e-01   -1.133873224856122e-02   +5.011846457782531e-01   +4.556307397473681e-01   -2.750584390341435e-01; +6.140918900592230e-01   -6.201973070907593e-01   -4.718005460411412e-01   -4.870809241567493e-01   -4.980257544016353e-01   -1.763949710804420e-01   -7.496637150243746e-01   +4.607098713159461e-01   +3.105766073167434e-01   +5.172396317850191e-01   -5.317919552911685e-01   -1.000000000000000e+00; -8.187519178890555e-01   -2.134764453519714e-01   -6.783382472294095e-01   +2.680169509366258e-01   -5.952621526669128e-01   -7.876428137570577e-01   -2.701597624643450e-01   -1.880072460599321e-01   -6.608884585386763e-01   -2.436619619112725e-01   +9.389497787904974e-02   -5.916615915808939e-01; -2.995098316798089e-01   +3.062404471897651e-01   +4.876205371491787e-01   +6.295574398633104e-01   +4.954707122634487e-01   +2.214780098657415e-01   -4.884400365275363e-01   +1.818786745187628e-01   -4.354401325031412e-01   -8.201446325336817e-01   -5.838437434130835e-02   +1.596287951400645e-01; -2.930996860756223e-01   -1.050466238097695e-01   +5.723348301849703e-01   -5.728091934468271e-01   -3.422451886193030e-01   -3.344569798022914e-01   -5.566509802649361e-01   +8.360705770476772e-01   -8.913301628775729e-02   -4.189655851957603e-01   -3.900615152457729e-01   -8.213516053080375e-02; -1.582760714354812e-01   -2.283620743734822e-01   -8.506949624498800e-02   +5.952562033497183e-02   +4.287810596760914e-01   +5.169159188828674e-01   -4.408878677776396e-01   -4.799924952315300e-01   +3.934629734551151e-01   +7.812773182337295e-02   -2.176646499214215e-01   -1.432738111771659e-01; -1.223037363717715e-02   -9.988746710153143e-02   -4.174994749990284e-01   +4.359823681737051e-01   +5.770889028233236e-01   -3.170590736339344e-03   +5.328680535457278e-02   +8.021328943521787e-01   -4.472920777733272e-01   +5.205830132814082e-01   +6.998146493821564e-02   -3.242634054688103e-01];
L2E_L3E_iAMPA_netcon = [+2.599519751895631e-02   -2.990872907272794e-02   -3.338517847779256e-01   +5.239701451541823e-01   +6.312990178451202e-01   -4.185691548536601e-02   +2.166970987087792e-01   +3.611755563351767e-01; -2.508742189599449e-01   -2.112566705717911e-01   +1.745092458365658e-01   +7.280887515226729e-01   -1.473343284801536e-01   +4.036877451608260e-01   -5.604796010233308e-01   +2.822862257161071e-01; -3.792536579445303e-02   -1.375533818562278e-01   -4.014273976134799e-01   -4.298653752418036e-01   +8.799458552214590e-02   -1.716457490683212e-01   -7.298206283389510e-01   +6.726526238681070e-02; +3.104676749308886e-01   +1.777990755744694e-01   -4.172969222836214e-01   +6.469803933068108e-02   +3.719848304621164e-01   +2.671998339690737e-01   -3.001427740952671e-01   -5.258116922573249e-01; +2.597037584035406e-01   -1.965975460299348e-01   -4.935167146822667e-02   -5.518392306044718e-01   -1.005432446070431e-01   -1.790244910709735e-01   +8.353941875026653e-01   +2.663334945369372e-01; -8.916842507119073e-01   -3.184696871583933e-01   -3.478338562856129e-01   +2.223741584294078e-01   +2.418468656904423e-01   -4.976460126974639e-01   +1.425206533548442e-02   +1.099459043520010e-01; +4.828291716408207e-01   -4.044773515137242e-01   +7.456742251210775e-01   -5.294447824634700e-01   -1.307108088184811e-01   -2.689466588905575e-01   +3.637002336600054e-01   -4.279729035372107e-02; -6.221115776900108e-01   +4.101056424108608e-01   +1.390428826439762e-01   -1.154297721824740e-02   +4.006363902600902e-01   +5.695328980063099e-01   -6.356826334781648e-01   -4.187989142543975e-02; -1.527058729666217e-01   -4.011397527599559e-01   +9.540282409287021e-02   +2.013853726784693e-01   +1.838740768393451e-01   -3.537543165877186e-01   -5.405285929547827e-01   +6.072526196531651e-02; -1.255401360346787e-01   -1.000000000000000e+00   +4.767126946103608e-01   +6.089561906655647e-02   +4.893408571568214e-01   +3.000132893224372e-01   -8.853212817318105e-02   +3.621438271350700e-01; -7.187326699239192e-01   +1.177039511197921e-01   -6.579552467336305e-01   +2.842338966765733e-01   +3.817338740406184e-01   +7.715271824174295e-01   +4.993471027537821e-01   +1.408861529579358e-01; +4.811876958621399e-01   +3.104730386011483e-01   -1.569681396520427e-01   -6.852501256292733e-01   +5.090903258665541e-01   +5.803502004955211e-01   -5.625148291820115e-01   +3.822581379820397e-01];
L2I_L3I_iGABA_netcon = [+4.492321639431304e-01   +5.603131669489943e-02   -3.833726195253771e-01   -3.323038866596234e-01   +3.061439206003107e-01   +3.447068764485817e-02   -7.542707465658072e-01   +2.746718975376078e-02; +3.417672460707127e-01   -6.019564677237550e-01   -2.247565608030141e-02   +6.202039745505542e-01   +3.148054955360136e-01   -3.303168322495528e-01   -1.521836268085826e-01   +2.450635022442976e-01; +2.761060535628776e-02   -1.052464306338344e-01   -3.442266909626404e-01   +2.388537521071259e-01   -2.207762233890215e-01   +4.781506014379840e-01   +1.244715467122756e-01   +1.305413755943894e-01; +6.175636879502985e-01   -4.783527891578318e-01   +9.567135249427351e-01   -1.162163568408946e-01   -5.438125157758057e-01   -1.975133911319737e-01   -1.499724021601733e-01   +3.955610949071744e-01; +7.925651875656360e-02   +2.795686811563296e-01   +4.583303587178874e-01   +2.833115805176241e-01   -3.979068169548290e-01   -6.736344506765343e-01   +3.017461514565156e-01   +4.448222681452169e-01; +2.172422308030071e-01   -4.527185602143050e-01   -7.046905227073863e-01   +1.507930737769257e-01   +4.686824147476087e-01   +4.543819404398350e-01   +4.421773121406780e-01   +3.829535473179733e-01; +1.268224205054504e-01   +1.428366276786691e-01   +3.918334943288961e-01   -6.498942356630520e-01   +9.434138795687490e-01   +1.215787384070225e-01   +6.494437152168836e-01   +3.883688097831522e-01; -2.733001473921836e-01   +3.824483738023413e-01   -1.895508657058711e-01   -2.678953544651241e-03   -1.380839568613644e-02   -7.829018623831415e-01   -4.829211377059288e-01   -6.463557160506788e-01; +7.550402946134078e-01   +4.855892824862129e-01   -3.949837255032331e-01   -6.294155642345038e-01   +1.841475056112406e-01   -4.498961314791176e-01   -6.290332140873933e-02   +2.678859781798144e-01; -3.560735768605693e-01   -2.642852646312309e-01   -1.728156448857732e-01   -2.668657570417214e-01   +6.458541503873277e-01   -5.666455270741942e-01   +4.671840118736960e-01   +4.219621145745365e-01; -1.441475919288988e-01   -4.199807541457477e-02   -2.969072939638602e-01   +2.092817730952268e-01   -3.845444946963853e-01   -4.697573222360641e-02   -2.091840092370333e-01   -5.552622329494830e-01; +3.753176687070491e-01   +1.651079028103647e-01   -1.000000000000000e+00   +4.132669005311492e-01   +1.633843665717701e-01   +3.452085344169102e-01   -1.675943715921785e-01   +2.353660392504186e-01];
L3I_L3E_iAMPA_netcon = [+2.590864292079906e-01   -4.665920344537055e-01   +4.063089151026059e-01   -8.751997206200515e-02   -2.663757390532644e-01   +3.338494171570432e-01   +1.446701180021102e-01   +3.990676086113201e-01   -6.442265582875051e-02   -8.368867315556805e-02   +9.692037255240669e-02   -1.251002327180871e-01; -9.389180610417386e-02   -6.017327160158871e-01   +2.338500031828253e-01   +3.030482441384943e-01   +1.282677045439560e-01   -4.492517873725883e-01   -3.623114261831884e-01   +5.036806653256826e-01   -2.135352669756045e-01   -6.179736073812214e-01   -6.304244153421110e-01   +6.474845311923987e-02; -9.312615109183743e-01   -6.528280141538573e-02   +8.567146127069565e-01   -4.242833484053259e-02   -4.616008787266666e-01   -5.881633444707045e-01   -1.304667792473875e-01   -3.299448461057796e-01   +7.948126849790138e-02   -5.551585005541811e-02   +3.965242328783412e-01   +9.239575102188331e-02; -9.862048367664450e-02   -4.960092712180668e-01   +2.377397222461661e-01   -1.075519524132881e-01   -3.790748370776497e-01   -6.994146955059518e-01   -3.103992880536977e-03   -2.658536013515127e-01   +4.966181527456379e-03   +3.225703028431468e-01   -4.088167342629865e-01   +1.000000000000000e+00; -5.755567054150004e-01   +4.308747152008934e-01   +1.679471748315910e-01   -4.053015699674926e-01   +4.657531408824964e-01   -3.833561412427953e-01   -6.809806986753102e-01   +4.610511895139848e-01   +4.456609172738617e-01   +3.643935981582889e-01   -2.422998851539554e-01   -4.195239510702524e-01; -7.619793012631985e-02   -8.130641847043178e-01   -6.374622552817621e-01   +6.841548998080206e-01   +2.867858342625883e-01   -9.576153981770040e-02   -2.679303176665641e-01   -1.615952181606433e-01   -4.295429269750795e-01   -3.249174692053417e-01   +6.292837696671046e-01   -5.120366207400857e-02; +6.155091647971935e-01   -1.340097686356422e-01   +4.991337066703659e-01   +1.916064260776880e-01   -1.541541936346268e-02   +1.994068731443178e-02   -2.053454864395055e-01   +6.597745226968098e-01   +6.372813643398231e-01   +1.788088598130205e-01   -5.375171629735288e-01   -1.593687184665253e-01; +6.293648600489673e-01   -2.069504458801136e-01   +9.354350892438005e-03   -6.312829374640452e-01   +6.785696358518473e-01   +1.239706147195423e-01   -2.113759264329066e-01   +8.680721232057622e-01   +6.796645418762597e-01   +2.948299307874267e-01   +2.874828253890834e-01   +3.835713595431057e-01; +7.292074852557184e-02   +1.304721059267054e-01   +6.175981624051855e-01   +6.136375443729766e-01   +8.265121773238593e-01   +1.356581010073316e-01   +5.089663469031486e-01   +2.272311140619076e-01   +4.312616234710113e-01   +1.490670881820245e-01   +3.938752184956717e-01   -2.144762566867155e-01; -6.664020118553465e-01   +6.898688926024140e-01   +4.756624160642525e-01   -1.791437694828022e-01   -7.226276642333970e-02   +3.904426148892165e-01   +4.239965163779905e-01   -2.654341791437848e-01   +4.810926825348003e-01   +3.043570208298444e-01   +6.841661511728754e-02   +1.217196842470690e-01; +2.633359429925387e-01   -5.609051395163231e-01   -5.543111868071193e-01   -6.834875262820201e-01   -7.355210658843788e-01   +1.485251984611041e-01   +1.932982746816283e-01   +1.043162540166060e-01   +3.509774799960402e-01   +5.499709631930668e-01   +7.755733404791797e-01   -5.790869202927242e-01; +3.079973010700523e-01   -2.650396765771448e-01   +1.164604773551346e-01   +6.928402731118065e-01   -7.587186312210259e-01   +2.756708682266022e-01   +1.742090536193731e-01   -9.252945296527658e-02   +3.881892540048242e-01   -4.513972875507237e-01   -5.255576353712669e-01   -1.799686609598233e-01];
L3E_L3I_iGABA_netcon = [+7.218265543105707e-01   +1.991526998944125e-01   -5.043548387172772e-01   -4.056906281310143e-01   -4.885026189684102e-02   -2.266581936868264e-01   +6.174748897226241e-01   -2.031823134781349e-02   +7.032517196247957e-01   -5.259839101122988e-01   -4.013873285387209e-01   -8.010361771191048e-02; +7.889539621235435e-01   +6.598807288464419e-01   -5.510414954769829e-01   -6.047091162795412e-01   -1.779046590266293e-01   -1.732077768994705e-01   -5.343532624414268e-01   -6.961364295620587e-01   -8.679699432208543e-02   +6.040776866897248e-01   -7.285187177686639e-01   -6.539235365417019e-01; +2.639504854654637e-01   -2.112290555948313e-01   -7.344285525116687e-01   -4.368166365976797e-01   +2.108519518785790e-01   +5.129417791893596e-01   -5.367834689534214e-02   -3.721070754473225e-01   -5.972270432189692e-01   +5.730421831387194e-01   +8.837821705656287e-02   -2.973569672131118e-01; -6.731321865777918e-01   -2.586159460611537e-01   +5.039455541126175e-02   -2.575973788155691e-01   -6.541515109686550e-01   -4.863475831404029e-01   -1.385697996866037e-01   -2.669545698421354e-01   -2.682820716620269e-01   -7.369459881962397e-02   +5.347030419259619e-01   +5.919868740985951e-01; +6.652846845390988e-01   +1.899998057589386e-01   -2.884747687113493e-01   +4.896389382018078e-01   -8.124048133857434e-01   -4.490180717160165e-01   +9.335166608568456e-01   -7.877740338303514e-01   -1.411222657850034e-01   +2.010612346530687e-01   -3.143815792210156e-01   +6.419787672592066e-01; +8.148685397982700e-01   -1.487267636083259e-03   +4.494248406768476e-01   -1.578855674760461e-02   -4.459951014205452e-01   -8.696804803603803e-01   -7.398771060367402e-01   +5.195906641675344e-01   +4.010441543587260e-01   +8.268899027118883e-01   +3.943926619986576e-01   +6.233410117858953e-01; +3.679903490708201e-01   +5.479078146854890e-01   -2.389888611183192e-01   -6.762079498465497e-01   -1.135399948970436e-01   +5.919710238337319e-01   +2.185948263862011e-01   +3.119805182011771e-02   +2.855382811306280e-01   -7.830987261797044e-02   +4.025225738463080e-01   +2.588213372187805e-01; +6.731917473398917e-02   -2.072788705368772e-01   +3.417206773200181e-01   +6.190515018723711e-01   -1.229389700193771e-01   -3.689172438329386e-01   +8.176412749007260e-02   +6.762690640481214e-02   -1.709123531640764e-01   +4.027757695809966e-01   -3.096590757594577e-01   -4.109499952543680e-01; +2.597761976057107e-01   +3.849384300964174e-03   +4.897127585532562e-01   +7.458242208894219e-01   +5.794588349008728e-01   +3.450084148667603e-01   +1.370528645974048e-01   +5.282659220275502e-01   -5.162353943268317e-01   -6.314666205060391e-01   +5.401307278368848e-01   -5.294294544957059e-01; +5.744911461213754e-01   +4.762725237755204e-01   -3.017489809729629e-01   -9.063506364893862e-01   +1.809307699397892e-01   +5.747445291602001e-01   +4.238081781007426e-01   +5.927616597413844e-01   +2.127838127224293e-01   +2.224699427671651e-01   -9.295410963880424e-01   -5.670114681546896e-01; +6.181745983879351e-01   -5.247504066155731e-02   -5.488835880122903e-02   -4.293640088763087e-01   -7.943978801144329e-01   -6.704351099801493e-01   -6.905981921676544e-01   +7.963500488898536e-01   -6.639861783451876e-01   +8.080031469422946e-02   -6.040692687843190e-02   +6.824954540962281e-01; +1.921363127033721e-01   +7.424859427861726e-01   +6.848157168384621e-01   -4.644888029998608e-01   +4.843488958326136e-01   -3.453060527690895e-01   -6.278884721532242e-01   +1.469598837573561e-01   +1.000000000000000e+00   -2.744137621273353e-01   -9.065013595494410e-02   +2.813866979636603e-02];
L2E_Input1_iAMPA_netcon = [-9.462298858508394e-01   -2.105605807544981e-01   +7.221119157546991e-01   -4.814235975714984e-01   -1.725069031838838e-01   +6.144339518112332e-01   +1.000000000000000e+00   +2.103251883892888e-01];
L2I_Input2_iAMPA_netcon = [-3.374662034089024e-01   -4.922784718539068e-01   +1.000000000000000e+00   +2.498805789225545e-01   -7.851516222458421e-01   +7.656261112966030e-01   +1.721362130043987e-01   +6.390702787647360e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
