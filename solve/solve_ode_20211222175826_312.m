function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.518819679874209e-01   +1.594446809039231e-01   +5.067795126981480e-01   +3.676612057894436e-01   +5.898030350996325e-01   -3.426271967651490e-01   +2.562183134702164e-01   -4.728991172002629e-01   +4.661994958211224e-01   +3.309842609810515e-01   +3.366920157446224e-01   -1.473387859357291e-01   +4.480922424429292e-02   -3.620693745327302e-02   -1.798720546191481e-01   +1.422623949369382e-01; +8.355840512217282e-02   -1.484404504573763e-01   +5.551977367130924e-01   +2.056498745614622e-01   +6.060358944523558e-01   +3.483580589751304e-01   +5.430065903060809e-02   -3.970842737437977e-01   -2.750292756172662e-01   -1.325463479242645e-01   +4.981119460631248e-01   +8.403957704308082e-02   +6.525465009409759e-02   +3.999316174585359e-01   -1.749214899836282e-02   +7.985627707853364e-01; +6.231448103007312e-01   +6.465649478979479e-01   -8.202011574498719e-02   -2.871256288897147e-01   +5.214253219083103e-01   +1.060083434590901e-01   -1.109576281780935e-01   -1.778988644897455e-01   +2.948970320719377e-01   +4.420210443834516e-01   +2.242977715560207e-01   -3.874947693041093e-01   +2.553925688335942e-01   +1.727376127235879e-01   -4.489008487812354e-01   +5.346939929114104e-01; +5.713932127149660e-01   -2.167869576585460e-02   +7.703232880277920e-01   +2.254169989518334e-01   +6.356367821919319e-02   +6.567294577350365e-01   +1.000000000000000e+00   +1.948135953398195e-01   +6.422257776046091e-01   -3.351670529446680e-01   +1.272411296543897e-01   -1.503451274388858e-02   -9.707501809525219e-02   -1.257723128211943e-02   -1.910419567402641e-01   +8.844499229641012e-01; -1.782299727217463e-01   -2.639502752311572e-02   -6.446034905740086e-02   -8.875748929484123e-02   -3.745906358712636e-01   +4.234527511136775e-01   +3.756387213384781e-01   +1.088188476891906e-01   +2.071706946601135e-01   +6.288458751876159e-01   +4.692473253471692e-01   -1.824264707246176e-01   -1.189731928679425e-01   +4.815645559541342e-02   +5.162624110557877e-01   +3.673436276315324e-02; +1.740364663985044e-01   -4.007516725354246e-01   +1.026916778394837e-01   +3.560153470714300e-01   +4.615597718851916e-01   +6.730412325550051e-01   +1.806804185897918e-01   +5.276623857938229e-01   +2.684064528795042e-01   +8.105197930772874e-01   +1.113834996200855e-01   -1.073154770103854e-01   -6.424703867652645e-02   +3.937027872050872e-01   +8.103821015692755e-02   +5.848995851091272e-01; +4.678173326407198e-01   -2.515042459254504e-02   +6.326462092769121e-01   +2.429968046692970e-01   +3.028329248372550e-01   +2.070157075705873e-01   +3.310710474069807e-01   -6.761575449123464e-02   +2.788162832565336e-01   +3.945995840858419e-01   +8.814236580892505e-01   +7.713837320873443e-01   +1.089495196849946e-01   +5.333200678704378e-02   +3.666890445362375e-01   +8.412081321403482e-02; +1.216917566839012e-01   -4.537818035269902e-01   +2.964085448789974e-01   +4.996498789759915e-01   +3.402303038125557e-02   -1.710951413967911e-01   +6.964679925863608e-02   +4.246287462902859e-01   +4.380849360188633e-01   +3.994868141383954e-01   -8.779881113029812e-02   +1.217153619775504e-01   +1.978144395519988e-01   +3.951208177446288e-01   +6.751843781840116e-01   -4.545161770836964e-01; +4.853460573292338e-01   -9.993938012490089e-02   -1.462752627656403e-01   -2.483347014660151e-01   -3.643638729395904e-01   +7.002201802762468e-01   +3.173887589143458e-01   +2.357371261633197e-01   +5.155614117747063e-01   +1.015886109999796e-01   -3.717021489982386e-01   -3.207457064827913e-01   -5.619787753172578e-01   +3.084894504952830e-01   -1.102039732981129e-01   -6.777072965680887e-02; +1.178110383797525e-01   -2.449177389847125e-01   +1.719205093285229e-01   +4.614973267270408e-01   -8.145375959511057e-02   +4.471466833531474e-01   -5.737842948570947e-02   +2.829021771239611e-01   +4.424325445502347e-01   +1.627944385609042e-01   +4.017129888769074e-01   +2.144770255627286e-01   -1.911701936941787e-02   -4.874151576317890e-02   -9.243392337016859e-02   +1.625583197375077e-01; -1.601266211208739e-01   +2.217334953189358e-02   +5.148484267906516e-01   +5.512314845231772e-01   +9.942913748554309e-02   +1.449810159912583e-01   -1.201514057083561e-01   +9.631113100877509e-02   -9.035427444998190e-02   +3.876814442159243e-01   +3.680559870531928e-01   +2.302901156371098e-01   +2.680659724905997e-01   +5.334141962120382e-01   -9.102024489999692e-02   -3.605237693066781e-01; -2.637196884132261e-01   -2.778225612477439e-01   +3.217513813203040e-01   +7.230348029465863e-01   +7.431226041262745e-02   -4.133348159251394e-02   +7.961856148108142e-01   -4.665086806127281e-04   +7.190978457650823e-01   +4.425046955660962e-01   -2.496966616646573e-01   +3.237016348647686e-01   +6.792846931882899e-01   -1.539022059146923e-01   -3.244844197935106e-02   +7.581713157294928e-02; +1.035240364073078e-02   -2.018184900250041e-01   +1.092658757676130e-01   +6.971619156716244e-01   +8.290063295146238e-01   +1.133405207825560e-01   +3.361824994563086e-01   +3.058859047267850e-01   -1.779838501173664e-01   +1.698636128026263e-01   +1.485765584110079e-01   -1.975673669661890e-01   +3.855377101628988e-01   +3.402332081046379e-01   +9.249638987519662e-01   -2.441647239531273e-01; +2.436868281653750e-01   +3.199639440837941e-01   -4.657898891347313e-01   +5.434601817369641e-01   +9.826852979435714e-02   +2.211509896923393e-01   +2.023417729909602e-01   -1.842589791579282e-01   +5.124112358838255e-01   -6.489626013231738e-02   +5.803884445310801e-01   -1.452212471026450e-01   +6.536256642400862e-01   +3.668476739777706e-01   +7.902184623371875e-02   -2.004140112818599e-01; -1.697295775575835e-01   -2.925150321613037e-01   +7.476092244124913e-01   +5.744367868846502e-01   +3.090280666552038e-01   +1.589576653435013e-01   -1.948333916233130e-01   -1.099208953541417e-01   +6.958152076966799e-02   +3.719130647090150e-01   +4.248008935493992e-02   -9.890079236796290e-02   +1.543917490311204e-01   +6.311114627900569e-01   -2.062125044678702e-01   +3.550283972044611e-01; +7.085729482602850e-03   -6.016594453165625e-02   -3.216611681874938e-01   -2.420035255178835e-01   +5.017530749001960e-01   -2.057381617501796e-01   +3.480351431457138e-01   +1.440752789861929e-01   +3.897134573873863e-01   +5.426924943872348e-01   +7.311585050260655e-02   +1.249161028404678e-01   -2.058877718534866e-01   +4.423174525713429e-01   +1.944653885933844e-02   -4.848329582732632e-01];
L1E_L1I_iGABA_netcon = [+6.559433064560964e-01   +3.166509071432100e-01   -5.169710463262107e-01   +8.564465728811279e-01   +1.065732895221466e-01   -3.287312355703253e-01   +6.841994084217939e-01   -1.795013556319201e-01   +8.152940621027626e-01   -4.876616176097802e-01   -3.097096382592009e-01   +3.264336135253005e-01   +5.044591032989990e-02   -3.231069533619212e-01   -1.363772220215006e-01   +6.757180353530378e-01; +4.427202289966832e-01   +3.860031901621903e-01   -9.986260741472221e-03   -1.165686676458841e-01   +6.632940718945480e-01   +1.514441394421564e-01   +4.063468932458687e-01   +6.901192698866696e-01   -7.030732386542226e-01   +2.146036135123748e-01   +7.448147631857613e-01   -1.551026456097903e-01   -8.531157241343433e-02   +1.848073875136879e-01   +6.423839453263774e-01   +3.389316533414042e-01; +7.245236374427761e-01   -2.470005080277161e-01   +2.284018238121267e-01   +6.298736412436701e-02   +5.015858202242657e-02   +3.819144347534428e-01   -1.106174057218635e-01   -1.291202286770264e-01   -1.908360204361589e-01   +1.869684732739553e-01   +3.778592688555058e-01   -1.590660940823791e-01   -1.858378723654014e-01   +2.784928258171560e-01   +4.567637868233150e-01   +9.436390621967032e-02; -1.232592452443536e-01   -3.019059771808373e-01   +7.379165293912804e-02   +4.142599572791675e-01   -1.383230613972307e-02   +1.317098568126801e-02   +2.690304894353698e-01   +9.087264351649205e-02   +3.131119175579152e-01   +6.000463421875252e-01   +2.759755069265393e-01   +1.498912651059805e-01   -1.494321565306606e-02   +2.651978479135870e-01   +6.146937593432072e-02   +7.689251179089140e-03; -5.896588183144182e-01   -3.808062436674823e-01   +4.269004191318291e-01   +2.217787272162486e-01   +8.052867568080313e-02   +1.919877033704490e-01   +4.194494917713348e-02   +2.465714757790252e-01   -1.693624837382361e-01   +3.318307609058945e-01   -7.451077007341023e-02   -3.439839914174360e-01   -1.793591312786174e-01   +4.011864302835952e-01   +2.709042291603506e-01   +7.457059938860268e-01; +5.427000093698096e-02   +2.795953769914530e-01   -2.229341710711464e-01   +3.536544211589473e-01   +5.506506402341254e-01   -1.097224041826153e-02   +1.890969206341807e-01   -4.108606805619908e-02   +4.909333372343838e-01   -5.734807617440201e-01   -3.272937222004446e-02   +6.332556501632310e-01   +6.798580525433713e-01   +6.899022673873522e-01   -1.299602218234587e-01   +1.834518043752402e-01; -4.464556661863392e-01   +1.763027861533469e-01   +9.297743405728491e-01   +6.440008672737698e-01   -4.500208887143569e-01   +8.517426470766196e-01   +1.510499084377776e-01   +4.186979217355827e-01   -2.167030435653904e-01   -5.145652907825197e-01   +3.387327760785114e-01   +9.050623792855098e-01   +6.384163086387301e-01   +2.547365664683041e-01   +3.295500499847470e-01   +2.943664959713821e-01; +9.968643483367683e-01   +3.432006502034635e-01   +4.586382592940583e-01   -1.775376993977997e-01   +7.017372172633773e-01   +4.768870461409512e-01   +6.465399890499390e-01   +6.309126507902150e-01   +4.250440846093245e-01   -9.412743546810606e-02   +5.400609047545341e-02   +3.282830877500518e-01   +1.102517517668819e-02   -1.220712124387133e-01   -2.421412946834778e-01   +6.378579424179119e-01; +2.241646233052528e-01   +1.345995853083214e-01   +2.964117624680778e-01   +7.886501136318838e-01   +4.527013345315017e-01   +1.633803331432418e-01   -2.245160650673329e-01   -2.793431137347733e-01   -1.291622949989406e-01   +7.590339934609279e-01   +6.024304901180646e-01   +1.035523374635889e-01   +6.578604260737266e-01   +4.138243532162554e-02   +2.999010087607698e-01   -4.000051442810776e-01; -3.273040455972829e-01   +4.318385185385826e-01   +1.795205689625053e-01   +6.430232348115986e-02   +3.000351771253145e-01   -3.974005212985748e-01   +3.077214723646641e-01   +3.865294639870401e-01   +5.376397003779804e-02   +8.985980076497710e-02   +8.710106133498430e-03   +1.316687181887746e-01   -2.708835809417158e-01   +3.537022728217747e-01   -4.441320309716659e-01   -4.606265445741404e-01; +8.358352367023925e-03   -3.820757527355230e-01   -2.921406556307532e-01   +4.169626264987725e-01   +6.494600812630178e-01   +9.432540657483388e-01   +5.728947413849453e-01   +7.767859286779568e-01   +2.384811944723303e-01   +5.506998652600171e-01   +3.175116940838313e-02   +4.610031265112305e-01   +2.365251009138450e-01   +4.693265832160106e-01   +4.372877912565132e-04   +5.510696863196052e-02; +7.474725428951905e-01   +5.335934110490370e-02   +3.760697416481709e-01   +9.459203930253413e-01   +8.783179617431671e-01   -8.253458583687065e-02   -2.518559516325867e-01   -3.912959298375495e-01   +3.499824565999665e-01   +1.780784015523028e-01   +1.028112228474261e-01   -4.909105121916888e-01   -7.646903287337656e-02   -5.175695103421815e-01   -5.334997326671962e-01   +5.081264403465888e-01; -7.602937160177903e-03   +9.997231460815184e-02   -1.023876488733191e-01   +4.916566137706929e-01   +3.907775349421221e-01   +1.311523679877110e-01   +3.674875371746267e-02   +2.775667604523852e-01   +5.538845929612521e-01   +3.456399592794677e-01   +6.441187465818573e-01   +4.091569777847908e-01   -3.218825390206728e-01   -9.151414608057204e-02   -6.024505474328498e-01   +3.148335343622427e-01; +9.564736287964365e-02   +1.514160445338254e-01   +2.726785307130071e-01   -1.646133581325717e-01   -4.129660036465906e-01   -3.847812777599968e-01   +1.437769216197267e-01   +7.151730821368433e-01   +4.649148995961356e-01   +6.004883093417250e-01   +8.309156040440975e-01   +2.205927200881907e-02   -3.299744912190877e-01   +5.082552366616618e-01   +2.917827535918286e-01   +1.657209260941797e-01; +5.216764696414911e-01   +4.582685944714076e-01   +8.713534311578078e-02   -2.133717374065450e-01   +5.659527583814070e-01   +2.341521922392347e-01   +1.112613821270716e-01   -2.017261420184923e-01   +4.917097072117073e-01   +5.545585462284653e-01   +3.809697319868957e-01   +8.721671093881906e-01   +1.980752634085380e-01   +1.227579695811296e-01   +4.641345555392912e-02   -1.707625334751550e-02; +1.043109483914214e-01   +6.813672355987195e-01   +5.090709750433625e-01   -4.211751268294857e-01   +1.429572527630785e-01   +1.217202493927831e-01   +5.994285189741628e-01   -3.560309372275089e-01   -3.684186587610149e-01   +2.369215529804577e-01   +1.241644758988226e-01   -9.947187036468169e-02   -2.906547061526586e-01   +2.776126285430153e-01   +3.721495195307455e-01   +8.700055260762563e-01];
L2I_L1I_iGABA_netcon = [-6.604987652752649e-01   -1.438851430280477e-01   -1.759885316486293e-01   -3.680396133939581e-01   +3.022977829414096e-01   -3.250319768062225e-01   +6.384255595487794e-01   +5.007816729378821e-01; -3.051194060284110e-02   -3.680285294781534e-03   +5.283541468945772e-01   +5.829705313538630e-01   -2.685341368696319e-01   -1.149465536755495e-01   -2.506261016260269e-01   -6.029745776735556e-02; -2.650841549692636e-02   +3.140366421037248e-01   +6.173369660683156e-01   -1.682869426119223e-01   +1.588557233253001e-02   +1.969021772260428e-01   +6.213683595588841e-01   +4.127880058789692e-01; +5.986427431315586e-02   +2.418243023057656e-02   -4.669190811884469e-01   -1.834563152898611e-01   -6.671811715141111e-02   -3.075253145456425e-01   +1.117613043925567e-01   -1.263652756822890e-01; +3.213040004190765e-01   +2.626749089061896e-01   +8.810316846751899e-01   -5.685622396767023e-01   -4.470147363093416e-02   +1.549691219427612e-01   +4.401729235627879e-01   +3.780039523846443e-01; +2.438928420741737e-01   +6.504629334653160e-01   +4.120931304689813e-01   -3.090406036677592e-01   -3.066021487029507e-01   +5.563876150924099e-01   +6.592806628342758e-01   +4.110620048253526e-01; +4.399022520814149e-01   +4.363006081626714e-01   +8.689461953750523e-02   +3.587335273074342e-01   -2.720209888394155e-01   -2.125382910905316e-01   -2.787465821067408e-01   +6.682450255585576e-01; -1.613091419165472e-01   +1.999210986593857e-01   +1.489470610535455e-01   +3.726771941824337e-01   +4.685299722976451e-01   +3.578393638260584e-01   -4.877937445304616e-01   +1.000000000000000e+00; +1.942978662639017e-01   +2.640562991542077e-02   +3.538771483400793e-02   +1.538072357696607e-01   +3.022239989484571e-01   -1.796895276798540e-01   +1.861205437474593e-01   +5.755318777560462e-02; -1.491419457947166e-01   +5.829008928707964e-01   +1.225367366842821e-01   +2.320431178154870e-01   -4.944908171350496e-02   +2.403192794168760e-01   -3.787534655826061e-01   +4.405189747017219e-01; +5.579998190936438e-02   +1.585689675318175e-01   +3.280028098999715e-01   -1.019518370355511e-01   -1.944566648247038e-01   +3.349483433459403e-02   -3.228337468762714e-01   +1.581362629990476e-01; +3.684568497629145e-03   -4.313719838485387e-01   +5.869363620934174e-01   +2.432172742800232e-01   -3.420979031026906e-02   -1.313165792542273e-01   +4.720604376866905e-02   -4.785832512995546e-01; +4.692597634185137e-01   +7.644539256461132e-02   +1.197305014412891e-01   +4.044454992730525e-01   +6.134023126539051e-01   +1.054219670641384e-01   +8.752272435906679e-02   +6.346760889713313e-01; +4.912278855573313e-01   +1.927021614212225e-02   +7.708871868048053e-01   -1.188477174340122e-01   +1.085094855451397e-01   +2.392699398480123e-02   +4.005164217901481e-01   -7.046857604904663e-02; -1.713297875983515e-01   +4.120170479838615e-01   +3.690396446933120e-01   +4.392851962117236e-01   -6.737760380750833e-02   -6.225097303557231e-03   +3.487235389078003e-01   +6.012098061165013e-01; +2.936222058448481e-01   +1.978882264872671e-01   +9.233326345831337e-02   +3.200920810115756e-01   +3.852260909205341e-01   +4.072340371986297e-01   -5.091359640631260e-01   +2.600895725472600e-01];
L1I_L2I_iGABA_netcon = [+6.755198047179301e-01   +7.505617540551163e-01   -2.555069079352291e-01   +6.706128245096064e-01   -5.299708780393750e-01   +8.789728393244047e-01   -1.154914177053347e-01   -6.749324780492683e-02   -2.213735240108712e-01   +2.340875411995296e-01   -1.310538047730844e-01   -3.065071166297466e-01   +4.001283154085413e-01   +1.991459535063256e-01   +2.608143392945327e-01   -7.238633682116006e-03; -3.125376394583610e-01   +4.490882943209775e-01   +3.324044544854241e-01   +1.797777387339652e-01   -2.004597535394430e-01   -5.959470797258004e-02   +2.262628126145517e-01   +1.001794681621561e-01   -4.370711529492490e-01   +5.930492936581847e-01   -3.229364713616221e-01   +2.323945660638735e-01   +6.417737519423962e-01   +3.441623860127710e-01   +1.636451990113545e-01   +2.990594070997383e-01; +5.313343986677123e-01   +3.693494123142612e-01   +2.598972257870429e-01   +6.744150550129963e-01   +5.062003749414754e-01   +4.943350102385419e-01   +4.173670838673098e-02   -4.260151684782160e-01   +1.446095578234193e-02   -1.099865330961039e-01   -4.139471128155539e-01   +4.825833606097609e-01   +2.753834555785849e-02   +5.056252972162423e-01   -7.365933187440625e-02   +5.437271809258827e-02; +1.508552583824218e-01   -2.434629346187549e-01   +9.371228711892944e-02   +3.234279326180236e-01   +6.415330375922234e-01   +2.650010171924185e-01   +3.242081117256498e-01   -2.296821012653351e-01   +7.347873716348516e-01   -2.219029164314488e-01   -3.143582670419724e-02   -1.115470698149606e-01   +7.921448628792058e-02   -1.476009898975233e-01   +2.836794228247078e-01   -3.111887261487071e-01; -2.196621021470413e-01   +6.286156918010264e-01   +4.974701584814170e-01   -8.333004902517502e-02   -1.629880950443754e-01   +7.698428963605185e-03   +5.104005768874612e-02   +2.456495627000155e-01   +1.858849761648852e-01   -1.929189546197250e-01   +1.000000000000000e+00   +1.630455825599393e-01   +2.316760283742846e-01   +5.404345388202429e-01   -2.094762748481338e-01   +3.833961785169862e-01; +2.961223934046878e-01   -3.944376556704736e-01   -2.758145990109437e-01   +2.496327443722748e-01   +1.432015892334859e-01   +3.563646764580053e-01   -2.615907951287949e-01   +8.925717710510401e-01   +5.814070720899014e-02   +4.551980065405388e-01   -1.349416045141579e-01   +8.990971894433582e-02   -2.180912215873430e-01   -4.965252749154497e-01   +4.754341378596268e-01   -1.486594295401407e-01; +1.215630108876831e-02   -3.305686859800774e-01   +4.518604302274385e-02   +3.965059395771793e-01   +7.872812661132286e-03   +2.413633443790028e-01   -3.588701128871122e-01   +8.138096334705885e-02   +5.068184690629036e-01   +1.175145150195130e-01   +1.982654137321170e-01   +2.799555366251865e-01   -4.506413481477823e-01   +4.425018057356145e-01   -5.138707254233184e-01   -4.406903177937883e-01; +4.280150074019678e-01   +2.748848026480356e-01   +2.338512714084668e-01   -1.655212632802756e-01   +2.715710512962618e-01   -2.764583858736099e-02   +1.713177866315896e-01   +2.142301206740868e-01   +2.448573790024433e-01   +2.493871033859614e-01   +1.223098495141187e-01   +2.623799416325395e-01   +1.901528771961156e-01   +1.315159288286971e-01   +7.194705110416973e-01   +1.786130094944305e-01];
L2E_L1E_iAMPA_netcon = [-1.337062027734098e-02   +3.114324616576117e-01   +8.260530084307194e-01   -4.170834387698136e-01   +1.119208314313823e-01   -1.449977375439864e-01   +2.987673926380081e-01   -1.007840058582836e-01; +2.837306292831974e-01   -3.951874719457911e-01   +3.627874023134234e-01   +1.970112419110497e-01   +8.944604139686282e-02   +5.412294711088139e-01   +3.028698633190505e-02   +5.576362686487613e-01; +4.108961653641222e-01   +5.340918260187770e-01   +9.935301766384719e-02   -4.528594846684660e-01   +1.466849417977492e-01   -1.682321091556474e-01   +4.803631360168547e-01   +2.200861710269640e-01; -5.096264019940970e-01   +3.545996803467358e-01   +3.597873438346335e-01   -6.384600892296414e-01   +3.482235739072428e-01   -9.657382558104199e-02   +4.256380050683974e-01   +2.498697664364466e-01; +3.412551842623822e-01   +5.776155382628650e-01   +2.680929567383044e-01   +3.111509542436989e-01   +2.235514111455053e-01   -1.904358891959372e-01   +3.367755950306328e-01   +4.843718939668562e-01; +3.948462687825265e-01   +3.758198969688644e-01   -4.425070569218721e-01   +5.264692510798142e-01   +7.697591479228771e-01   +8.695399793260561e-01   +3.289798791745192e-01   +1.774173830454160e-01; -1.044495451151277e-01   -1.615790302893235e-01   -4.999208715459993e-01   -1.169251144098593e-01   +8.943310101109105e-01   +9.413100316043191e-02   -1.899040349967495e-01   +6.649442312955508e-01; +5.559680855725366e-01   +1.346334254964867e-01   +6.087693128324301e-02   +3.991824419587161e-01   +3.494268704451550e-01   -5.165241747248590e-01   -2.387076038045354e-01   +7.114170887153388e-01; +1.544854955393364e-01   +3.492952944862998e-02   -1.227964148186876e-01   +1.848042780385870e-02   +6.490013110791235e-01   -1.805707770966904e-01   +7.165482605663667e-01   +2.983520355887695e-01; +4.101064497489353e-01   +2.832158537121987e-01   +6.486586887434476e-01   -3.087007539830864e-01   +8.506936947312870e-01   -3.408577816223373e-01   +4.538492153428194e-01   -4.755206964486616e-02; +8.278456788390712e-02   +9.943581273778682e-01   +5.853404810975573e-01   +6.127929076194554e-01   -3.521557837950199e-01   +2.034794225971390e-01   +6.477360073826623e-01   +6.734958412104020e-01; +3.453859323033612e-01   +4.307386194435660e-01   +2.350278114199635e-01   +1.059331412611196e-01   +4.973318043876204e-01   +2.366348888297038e-01   +3.595097311790603e-01   +3.928761383231143e-01; -1.083492883962942e-02   -1.176692853749055e-01   +8.802140998686224e-01   +3.619865585531424e-01   -1.887048910277778e-01   +2.580015069963080e-01   +7.667530239370650e-01   -2.491128984920313e-01; -3.652293142020079e-01   +5.671212985014820e-01   +2.884461133518976e-01   +4.145414364939846e-01   +1.931390424326837e-01   -1.359149390305317e-02   +9.178355894167248e-01   -2.024629278226797e-01; +4.522246473203777e-01   +1.011089867579484e-01   +6.224651100251160e-01   -3.788515637320276e-01   +9.407484851063705e-02   -1.960426364687261e-01   -3.786272627898964e-01   +5.396237484283749e-01; +1.607522834876103e-01   +1.461177494814125e-01   -3.097453716082831e-01   -2.478609958197063e-01   -3.158494289322140e-01   +4.279168874422844e-01   +4.706071357322376e-02   +7.908339332441825e-01];
L1E_L2E_iAMPA_netcon = [+8.835353394266017e-01   +4.582590090153523e-01   +1.104307059583776e-01   +4.217626518800630e-02   +7.415188399121646e-01   +6.086805608463415e-01   +6.120138747401110e-01   +2.418019146007678e-01   +4.295309258989980e-01   +4.949669896516173e-01   +5.835310248029220e-01   +6.561194469559972e-01   -1.583881530072626e-01   -3.508737138740312e-01   -1.339459275629030e-01   -2.790313683447200e-01; +3.798493666333574e-01   -3.138519137915194e-01   -1.679356204787273e-01   -2.672597506185317e-01   +6.644384189646336e-01   +7.112231777957223e-01   -1.202192170051547e-01   +3.207309260553377e-01   +2.659976729305290e-01   +3.410048398810741e-01   -4.444731464160631e-01   +7.086021276700871e-01   +9.110428645449874e-01   +5.949539206785592e-01   +4.661426021990044e-01   +6.646521910707293e-02; -4.060343807582293e-01   -1.105694523724863e-01   -3.663936582056836e-01   +3.443921550807335e-01   +3.784955063327130e-01   +2.236116809452743e-02   -2.221369959415488e-02   +7.204115061716838e-01   +2.923491511191934e-02   +7.432492267756033e-01   -2.637050888862404e-01   +2.634758490767646e-01   +1.947810229222312e-01   +2.226832227317077e-01   +3.332917672270185e-01   +1.331196557881166e-01; -2.287919970457951e-01   -2.331656620616846e-01   +1.120935917337658e-01   +2.204272232296168e-01   +4.383643225332616e-01   +1.223593758693455e-01   +9.228040951753377e-03   +5.763494615176123e-01   -4.398519569989937e-01   +7.842158871485272e-01   +2.084842139604817e-01   +1.465070045405608e-02   -5.841924947271713e-01   +5.448185004042631e-01   -2.590768221709023e-01   -2.922994213794857e-01; +1.375103650157830e-01   +1.883170173287275e-01   -2.536327496523905e-02   -5.370056381395698e-01   +4.076131204415806e-02   +3.615243020893348e-01   -3.298149922947121e-01   -1.192192373016183e-01   +2.055303281711794e-01   +8.524290621857331e-02   +1.483004190196909e-01   -4.016611112589978e-01   +2.910992145576915e-01   +7.615890910875306e-02   +6.693504308566000e-01   -1.606387937601229e-01; +7.859717664091563e-01   +2.895079139637602e-01   +7.583748452314482e-01   -2.788626878173183e-01   +3.342171921002324e-01   +1.930397510992522e-01   -1.787418215899315e-01   +1.698917212034163e-01   +4.174540995574251e-01   -2.069766490302740e-01   -7.046709202016249e-03   +3.498293975422770e-01   +8.195774435437122e-01   +4.738056142048723e-01   -4.012870147028202e-01   +7.776969112801839e-03; +5.193001864821220e-01   +6.383337582556040e-01   +1.936360794832829e-01   +5.511233740910785e-01   +9.461264861561705e-02   -8.091242029018125e-02   -2.013634950480062e-01   +6.183340594267219e-01   -6.678304271250562e-02   -2.284050474151168e-01   -1.367167320397403e-02   -2.028559051443758e-01   -3.169102933724300e-01   +6.527729869516558e-01   -1.939187996906840e-01   +4.932830149467779e-02; +8.941861452274455e-02   +2.367550779241481e-01   -1.867977166197280e-01   +3.065331226488560e-01   -3.215442550131242e-02   -4.064325128916996e-01   +3.199282303119089e-01   +4.132491720384601e-02   +2.814811862593234e-01   +4.097821460130821e-01   +2.261215750977161e-01   -4.307662460300968e-01   -2.820691273274963e-01   -3.348904487147725e-02   +8.350200381535998e-02   +1.458223403657746e-01];
L2I_L2E_iAMPA_netcon = [+3.195882123561908e-01   -2.967878944911795e-03   +7.280196553308670e-01   +1.292004366093915e-01   +2.033106121318944e-01   +5.907440342284038e-01   +7.950051060349783e-01   +6.120093443557683e-01; +5.784606492395322e-01   +7.855897671112428e-01   +2.327956927202033e-01   +1.846225910925565e-01   +3.690353697671629e-01   -4.066352409866639e-01   -2.247170231477691e-03   +3.453731239252482e-01; +2.144833716168488e-01   +3.284462539971353e-01   -1.042049754924354e-01   +5.707070753591857e-02   +2.683849879331109e-01   +2.408999495258661e-01   +4.037691762735537e-01   +4.331011371944611e-01; +3.886760200635621e-01   -3.091537450451168e-02   +3.738216675851360e-01   +3.977453437525761e-01   +8.699035955887152e-02   -1.690643899712422e-01   -4.391709304473120e-01   +4.817994857955608e-01; -5.060556569881889e-01   +6.014967620621177e-01   +3.416778281003658e-01   +1.572426298113984e-01   -2.268869096534721e-01   +4.184380180210530e-01   +6.582712159466624e-01   +5.796787619139342e-01; -9.447533074129433e-03   +9.147447257188882e-02   +3.738711968740894e-01   -1.514414945376150e-01   +7.622868421334150e-02   +4.575194346644259e-01   +1.278438920399127e-01   -5.794336399350850e-01; +8.877436405908436e-02   +6.298217880082477e-01   +3.522298597088996e-02   +6.435606363444751e-02   +1.457387326017818e-01   -2.180148750770725e-02   +2.273584430095372e-01   +6.510760668020282e-02; +2.280779049486260e-01   -2.279075977518789e-01   +1.793842105739177e-02   -1.790660571205167e-01   +7.296369607966169e-02   -2.411071782978239e-01   -6.075350451784278e-01   -7.034508543591181e-02];
L2E_L2I_iGABA_netcon = [+3.381363303466731e-01   -5.126712410687275e-01   +3.927319311870083e-02   +3.904558425865459e-01   -9.159830224656990e-04   +5.516952699815727e-03   +1.699907841641038e-01   +3.970186276422799e-02; +7.405302264942026e-01   +2.905398064975463e-01   -6.642899014515991e-02   +6.010080774853487e-02   +6.237581152762698e-01   +4.324741001780084e-01   -1.809992074928028e-01   +6.634254605678206e-01; +1.328994015778927e-01   +6.492204103535012e-01   +1.946171986712002e-01   +2.408202623987905e-01   +5.088053986914992e-01   -2.380303125934554e-01   +1.858389620973938e-01   +6.854589672545186e-02; -6.104500699446113e-01   -2.498786410112695e-02   +7.061926940755673e-01   -1.982374836416683e-02   +1.631168980391831e-01   +1.781900192375254e-01   +2.573085122205307e-01   -6.703471326945092e-02; +1.113854970537229e-01   -4.292067833122587e-01   +5.801978896959907e-02   +2.325104198640479e-01   +1.102805615703515e-01   -2.390916794376646e-01   +1.000000000000000e+00   +2.225474511620374e-01; +4.538487638714664e-01   +5.309751326439029e-02   +1.120069509379163e-01   -1.594203222999339e-01   +3.902939032360186e-01   +5.091887841552187e-02   -2.203027970639487e-01   +3.522608267520660e-01; +3.978926661377082e-02   +3.294823455582334e-01   -3.238057418339481e-02   +4.483261494925424e-01   -1.546574572504258e-01   +5.170358492991334e-01   -1.690873143289567e-01   -2.257927742423856e-01; +3.183152578951121e-02   +7.034873439319951e-02   +4.280503108545113e-01   -1.284995471229427e-01   +5.306403510146197e-01   -1.767095060040574e-02   -8.202409984417389e-02   +3.469939769166228e-02];
L3E_L2E_iAMPA_netcon = [+8.002331620007614e-01   +2.994969281402704e-01   +1.000000000000000e+00   +3.475046934305780e-01   +2.726232175252418e-01   +2.209519891735345e-01   -1.465777640594128e-01   +5.635253793659627e-01   +3.044991671611814e-01   -4.932968272913515e-01   +1.326088433113371e-01   -1.575639016826351e-01; +4.193331360439976e-01   +3.070832132211156e-01   +8.095344840772518e-01   +8.173387722192622e-01   -4.288384413252426e-02   +4.128118281189463e-01   +5.177636693230238e-01   -6.894998108115888e-02   -1.331650270292758e-01   +6.251405028082213e-01   +4.887968882425335e-01   -1.444843370672406e-01; +5.823816721572592e-01   +4.489152637461994e-01   +6.627916731618853e-01   +2.756223403959532e-01   -1.869044998286618e-01   -8.130583970634571e-02   +3.371148854301049e-01   +3.118267132789911e-01   -4.125924227289253e-01   +3.851226832759239e-02   +5.061823199823755e-01   -3.467471397056874e-01; +1.096418123953975e-02   +3.295713555327517e-01   +9.351887168099514e-01   +7.862379989221079e-01   +5.750186163769844e-01   +6.502029113608296e-01   +2.365624739139864e-01   +7.780835395971274e-02   +6.475214277550637e-01   +2.681851125361469e-02   -8.935445377186607e-02   -3.505654225584202e-02; +4.012833257065072e-01   -9.302887145704522e-02   -2.556759027398014e-01   +5.319590036359449e-01   -2.884363588119730e-02   +4.083216689463549e-01   +4.164841863203074e-01   +9.273415845687501e-03   +8.585993985083390e-02   -2.422560000185068e-01   +2.868711210547787e-01   +1.883851418384593e-01; +6.980108330784106e-01   +4.592512517387861e-01   +2.878050458581324e-01   +2.623818472777253e-01   +8.275217700012787e-01   +7.111847325749221e-01   +1.836748498289366e-03   +3.864861770040155e-01   +7.619073956317118e-01   +8.885099731676745e-02   +8.203194092863264e-01   +8.668582876408679e-01; -3.001352205013598e-01   -6.690166228623949e-02   +4.227454387842184e-01   -4.732194157037190e-02   +2.227274065715547e-01   +3.708222962091124e-01   +2.666446929541018e-01   -1.917543029895301e-01   -3.270962414657437e-01   +3.080887017225508e-01   +3.489272371256503e-01   +6.659281228033451e-02; +4.621888116491440e-01   +1.380084194167522e-02   +8.204752569902733e-01   -4.913319471268318e-01   -1.833058185812386e-01   +5.013739414077646e-01   -3.439571695795512e-01   -3.073216968328691e-02   +1.800102903104571e-01   -5.405881358420041e-02   +4.231724099291053e-01   -4.405028513205643e-01];
L3I_L2I_iGABA_netcon = [-6.617739222786570e-02   +5.598952442112535e-01   -4.318122060224597e-01   +1.842081772246798e-01   -5.568137854725352e-01   +4.435818965016970e-01   -3.297393136392182e-01   +4.301604964074586e-01   +2.335302992277317e-01   +2.696583336215994e-01   -3.350173361988472e-01   +7.212608658165424e-01; +2.006048813581952e-01   -2.065523369390067e-02   +1.000000000000000e+00   -1.724736222206213e-01   +6.057987912066756e-01   +5.149279216290268e-01   +2.446769911918059e-01   +8.476158658837604e-03   +4.315703960298407e-01   +3.913525084774472e-01   +4.367632893414655e-01   -2.805748253010695e-01; +1.509559685165383e-01   +8.862951889433514e-02   +6.109884464544766e-01   +4.351560959268818e-01   +7.549702003621954e-02   +1.829121660051635e-01   +2.262121857725017e-02   +3.526995944042560e-01   +5.364111493088984e-01   -3.991032600025058e-02   +3.652384619903393e-01   -1.719260092545224e-01; -3.891649179922582e-01   +8.066183847637313e-01   +4.187754182412094e-02   +7.315208022701192e-01   -2.167086227786290e-01   +2.018435176085467e-01   +3.510074447110827e-01   +2.693361230043418e-01   +4.720747109111039e-01   +6.643408039858387e-04   +6.605168512936039e-01   +3.028442314652384e-02; -1.942269915625005e-01   +8.397641917272207e-01   +6.491168421222058e-01   +7.549366161028823e-02   -6.779003179990142e-02   +6.319394600150101e-01   -7.800896589295023e-03   +1.470439368333664e-01   +5.270748709381353e-01   +1.902082579946197e-01   +3.096656541818408e-01   +3.231798262228334e-02; -1.144774362597763e-01   +9.403912436703857e-02   -2.135136492084170e-01   +2.414003202403663e-01   +3.341140913729298e-01   +7.115299536403081e-01   +5.008333312390711e-01   -4.408949421891193e-01   +2.117579797342557e-01   +5.086525251840194e-01   +2.384380827744778e-01   +8.523497104367360e-01; +3.842685379037772e-01   -1.314852786484003e-01   -1.762912279068424e-01   +9.515180253648650e-02   -3.494135415631798e-02   +1.222848444851397e-02   +4.064853839285086e-01   +5.272547256193967e-01   +3.295724277801207e-01   +6.289019569326985e-01   -3.318554744038874e-01   +3.096106377540679e-01; +6.543993246464951e-01   +3.029493609372334e-02   +1.227836047597970e-01   -6.625883189222287e-02   +5.188273023154862e-01   +5.988537246734305e-01   +1.705528528265252e-01   -9.259261782025613e-02   +2.488893701162347e-02   -4.234187291418071e-01   +4.193103999171381e-01   -2.286695589070005e-01];
L2E_L3E_iAMPA_netcon = [-6.748654168858197e-02   +2.804200567499063e-01   +4.384039925494859e-01   +1.000000000000000e+00   +5.316116660993422e-01   -4.888041569839948e-02   -1.276410997753549e-01   +3.501502065714528e-01; +3.276335722265172e-01   +5.345419760126809e-01   +4.152514105329703e-01   +2.217219760135486e-02   +3.971475497920862e-01   +1.131723100400650e-01   -4.528583552166592e-01   +4.215670405180691e-01; +3.278325426099537e-01   -2.650784489071834e-01   +1.510217190904853e-01   +9.849156612292791e-01   +9.455090679835161e-02   +8.677116113335714e-02   +1.703076801638750e-01   +8.861714368517479e-02; -1.692886267984293e-01   -1.657224741514962e-01   -5.443355500864500e-02   -4.372310756570353e-01   +2.341718302672696e-01   +4.365233847119516e-02   +3.172432016100679e-01   +2.658094092302243e-01; +7.869262847750156e-01   +2.117007844764996e-01   -7.657751146918700e-02   +1.013034831211066e-01   +7.816613256020704e-01   +3.863130341797436e-01   +5.197507810103589e-01   +6.966631880413469e-01; +3.521213835647363e-01   -7.307197931198822e-02   +3.952931677507651e-01   +7.699086261206107e-01   -2.476352892702928e-01   +1.732752916219999e-01   +1.999240210576574e-01   +8.382976730599161e-02; -5.254013223484334e-01   -2.425272963480425e-01   -3.789298809250635e-01   +8.191406156546939e-02   +4.047478273229182e-01   -1.492193499148702e-01   -8.609715464154066e-02   +7.184073414020159e-02; -4.609187989759580e-03   +1.868532409400527e-01   +7.085267925835079e-01   +3.557675116469279e-01   +8.085900101854812e-02   +3.271178175629492e-01   +1.689009471806700e-01   +6.056744297200096e-01; +7.790207521722797e-02   +2.857740968527990e-01   +2.475299423993400e-01   +1.736914342245454e-01   +4.282321201674980e-01   -1.309059169002035e-01   +3.362323980241790e-01   -1.320118314245451e-01; +4.249415675471702e-01   +2.386674621296966e-01   +6.898890815634227e-01   -9.045831759385425e-02   -1.724147153369453e-01   -2.037645789808073e-01   +1.010236633964666e-01   -1.455290453581736e-01; +7.557233022302731e-01   -4.317930456710304e-01   -1.767157899000215e-01   +1.285571455656835e-01   +1.010234180669723e-01   +4.510561402422901e-01   -3.380303523809060e-01   +3.163515223243704e-01; -3.624535802455944e-01   +7.517637393165849e-01   +3.723919785283056e-01   +2.883037645216125e-02   +1.963842851012187e-01   +7.296833820841472e-01   +1.678542792885592e-01   +1.282435839782065e-01];
L2I_L3I_iGABA_netcon = [+3.904133786457910e-01   +6.144971508567162e-01   +2.478587464986361e-01   +2.739061909609835e-01   +1.833752163122440e-01   +6.244899082701550e-02   -3.717514174727676e-02   +8.872035947736917e-01; -5.168700734669106e-02   -6.294019829444334e-01   +6.691414280420370e-01   +7.544165899659404e-01   +1.468575269189983e-01   +3.200450966255115e-01   +1.685262271737738e-01   -1.333645081821898e-01; -9.336791376505021e-02   +6.646914173275310e-01   +7.093794182236863e-01   +6.419898284704447e-01   +5.713015247722210e-01   +6.521362883904985e-02   -4.032660883827665e-01   +5.018248299725345e-01; +1.517775248957210e-01   +1.556286948843975e-01   +1.027836162367315e-01   +1.112614645627000e-01   +6.270218501969638e-01   -2.476102757793572e-01   +4.450465446870695e-01   -4.283474312117913e-01; +3.504801110316947e-01   +8.189414431957789e-01   +1.235796267006170e-01   -4.850269996764190e-01   +9.303345258291129e-01   +3.796428176617060e-01   -4.162891949703966e-01   -1.968897587417326e-01; -2.335272578449722e-01   +9.887405924003412e-01   -3.367482070031198e-01   -2.458217968097211e-01   +8.803706038196462e-01   -4.474599897809697e-01   +5.746259221743976e-01   +6.883812522333693e-01; +2.191435631847068e-01   +6.821758783337524e-01   +5.748253499871355e-01   -4.948706230991897e-01   +5.590991855100782e-01   -1.404756735965682e-01   -4.959364397111642e-02   +6.565875545201563e-01; +4.507435995336333e-01   +2.855787006523240e-01   +1.986513532586191e-01   +6.127497311412261e-01   +2.066319615399633e-01   +8.171440768657746e-01   -6.751791408280885e-01   +1.660439557776480e-01; +8.885690638686402e-01   +2.574830287817859e-01   +2.681988528490316e-01   +5.327943853712336e-01   -2.879398058127897e-01   +1.000000000000000e+00   +7.007921771781699e-01   +3.407252059883869e-01; +5.795372887301065e-01   -4.137227728166628e-01   -1.670646215105598e-01   +4.920754056539333e-01   +8.106088712790710e-01   +4.501173992598037e-01   +4.572492698660383e-01   +2.319999054497858e-01; +6.972602661998357e-01   -4.049943223007388e-02   +1.726389588313892e-01   +2.623259088422137e-01   +2.134978667280474e-01   -7.714207578504861e-02   -3.618121567010371e-02   -1.541382413682533e-01; -3.862267161831252e-01   -1.935726263993095e-01   +4.623881177226746e-01   +4.393630446911013e-01   +1.420928428640692e-01   +4.093246640535336e-01   -2.296161810534030e-01   +7.753181580317381e-01];
L3I_L3E_iAMPA_netcon = [+6.387021754794351e-01   +6.510930960902056e-01   +2.418289499220070e-01   -2.151917738086108e-01   +1.725283554340766e-01   -2.387266687704090e-02   +2.336595649999521e-01   -2.085364127332249e-02   -7.193381794591286e-02   -2.364373718201905e-01   +2.128682691955987e-02   -1.311290345749374e-01; +5.459872115152301e-01   +6.341625480024102e-01   +7.691048053042924e-01   -1.177613163087083e-01   +4.515999746597895e-01   +4.531930442676864e-01   -4.216732321317245e-01   -1.832928643602402e-01   -2.846518110045410e-01   -5.350744220345321e-01   -9.795464640082992e-02   +1.225973010100383e-01; -8.846477623559347e-02   -1.597198096523256e-01   -2.972692289685598e-01   +9.303532176819383e-02   +3.045566430663215e-01   +5.370228485243991e-01   +1.907980226342975e-01   +7.939827502728494e-01   -2.975377868351722e-01   +2.057728339235060e-01   +5.199704259944806e-01   +3.708313112268634e-01; -3.540850195368424e-02   +4.156259516497742e-01   +1.423100281470787e-02   -2.999349331488763e-01   +1.388824232450035e-01   -3.042312748381201e-01   +2.658073571772495e-01   +3.693807410957691e-01   +7.224083318216564e-01   -2.217690812705136e-01   +1.040131858526062e-02   +2.633408907846036e-01; +2.084567937824143e-01   +1.012740794909014e-01   +4.556407187098777e-01   +2.904661938883036e-01   +8.947841123964049e-03   +1.918293885454260e-01   +6.177315372344867e-02   -5.152676433353121e-01   +3.056571848012787e-01   +2.979153091863398e-01   -3.256683344811177e-01   +5.142153582550768e-01; +3.685170855962214e-01   +4.248724024556839e-01   -2.530295703003952e-01   +7.778377791387941e-01   +3.161296630110693e-02   +2.985351429153844e-01   +4.488454564751819e-01   +6.123246278678204e-01   -1.852828351443827e-01   +1.692412865103964e-01   +2.510223944145500e-01   -1.104850776734910e-01; +1.000000000000000e+00   +2.249290917728242e-02   +4.628879511739076e-01   +9.143151441947155e-02   -1.103414061150867e-01   +4.969458912723046e-01   +1.205161219399999e-01   +7.452692682425458e-01   -4.673939170048525e-02   +5.986636624107126e-02   +4.309406991713456e-01   +3.694829792958779e-02; +7.142666307953519e-01   -1.335123640525443e-01   -2.579633915835570e-01   +1.133156754163944e-01   +1.066044205063788e-01   -2.245569135837746e-01   +5.102885680387075e-01   +3.826661701950429e-01   -2.884522811681688e-01   -9.727322228296403e-03   +1.895103555672956e-01   +1.325655110899469e-01; +6.121343822185581e-01   +1.044008922232040e-01   +1.037746305936073e-01   +3.069373009055003e-01   +4.345382758322920e-01   -1.819824386331016e-01   +2.210438643216358e-01   -2.020320862862565e-01   +3.974575598225687e-01   +3.410630189626135e-01   +3.875386540036075e-01   +5.120003410940404e-01; -1.011549102141866e-01   +3.510028250457166e-01   -3.949410857783742e-01   +4.654306230517033e-01   -9.881418049646735e-02   +1.092158737721918e-01   -2.863831528699871e-01   -2.186265353805367e-01   +3.465692888207573e-01   -1.622518294750438e-01   +6.414940723796051e-01   +5.190225561741115e-01; +1.532485574745961e-01   +4.637036870480156e-01   -2.628447470204813e-01   +6.193190876082438e-02   +3.969082802469922e-01   +5.433244080994962e-01   +6.195533028118505e-01   +2.859571135125271e-01   +2.061384576744847e-01   -7.551587035573488e-02   +2.511604519462921e-01   +5.182692697587225e-01; -7.646469478613321e-02   +6.210832238883741e-01   +3.484142123359186e-01   +4.092439033111801e-01   +8.593526462278972e-02   +4.189830586007069e-01   +2.770728328560224e-01   +2.416539269960852e-01   +2.533185060446745e-01   +4.599961752939232e-01   +7.825092141843287e-02   +2.218541172748248e-01];
L3E_L3I_iGABA_netcon = [+1.106701658120141e-01   +1.041516537896247e-01   -1.556061264776242e-01   +2.983403841342761e-01   +3.677008786161440e-01   +8.115592136573108e-02   +2.223705003870969e-01   +7.099753617159049e-01   -3.609738959144974e-01   +4.540947138682987e-01   -1.651784866532848e-01   -1.849000469866663e-01; +5.744029544834585e-01   +5.970742408597661e-01   +6.374374155444881e-02   -3.258861956829576e-02   -1.551655773021734e-01   +4.904549229198713e-01   +2.350492315950942e-04   -1.753658584339406e-01   +6.802944633801000e-01   -1.128588410422480e-01   +6.986078156633929e-01   +1.343353885459277e-01; +1.000000000000000e+00   +3.300026941432125e-01   -1.729554325265045e-01   -1.202357007942016e-01   -7.949220252572953e-02   -5.148067499026571e-01   +8.880895824468057e-02   -1.120025301016293e-01   +5.666149692031744e-01   +2.287762025524284e-01   +2.766546825085009e-01   +3.599260047943476e-01; -1.286264214230659e-01   +7.138288701394414e-01   -2.651865983902479e-01   +3.919888807281856e-01   -6.145279628103548e-02   +5.467258424927119e-01   +1.734667532207432e-01   -1.301742342983766e-01   +1.438753734251942e-01   -4.017199582723791e-01   +1.928807172675512e-02   +2.689602122454225e-01; +7.230122952148302e-01   +4.189132329849203e-02   -4.347927914361763e-01   -2.423610291716782e-02   +5.182788540030702e-01   +2.851825470069999e-01   -3.930244028229177e-01   -7.666474561250446e-03   +4.456135633363499e-01   +1.087856168435119e-01   +3.248771081389443e-02   -3.572808904715009e-01; +2.993066555705486e-01   +3.193080876491496e-01   +6.736091415814923e-01   -3.015625534021208e-01   +1.954903067976330e-01   +4.886965967549624e-02   +1.316414902617933e-01   -3.411040069388805e-01   +1.687585806583851e-01   +2.299448147544607e-01   -1.963767108055007e-02   -3.182704111368533e-01; +2.032716228077354e-01   +3.914143585361849e-01   +3.330906646761522e-02   +4.119950791135537e-02   -7.330397558796932e-03   +6.568696203819602e-01   -8.932061298941714e-02   +4.948100283742321e-02   -3.594953827782426e-01   +1.920982685074434e-01   +4.226482464899904e-01   +1.995030697058336e-01; +2.754128580424241e-01   -2.572291748622775e-01   +4.769447760481091e-01   +3.436196674107012e-01   +4.952234911627902e-01   +3.334402203424163e-01   +6.231796894082638e-02   +1.101901797352595e-01   +4.267774386111652e-01   -3.293713317601052e-01   -4.230479974414084e-01   +9.272308159091626e-02; +5.704562747752622e-01   -2.716993254365320e-01   -1.150390676437825e-01   +1.698908299652570e-01   +1.499695419080631e-01   +1.409479119302137e-01   +1.370627321584891e-01   +9.339623683133810e-01   -1.687360300243428e-01   +1.133318054544758e-02   +4.534533492137764e-01   +2.428377489184397e-01; -4.953750021267279e-04   -2.365512212780150e-01   +3.627642724900117e-01   -2.193944113811816e-01   +6.887894209905709e-01   +2.084565664227765e-02   +1.354153228103012e-01   +1.137321059246796e-01   +5.549107500766964e-01   -2.699099986771572e-03   +5.907527401768992e-01   +3.242392745875739e-01; +6.809729450227615e-01   -1.597396419814877e-01   +1.335493785539290e-01   +1.355580086897006e-01   -3.371835356468730e-01   -3.903799325490290e-01   -2.132122133513880e-01   +1.894813328871516e-01   +1.406147181442986e-01   +2.514966264699330e-01   -3.821175259049296e-01   -1.069036892171061e-01; +2.606422588470637e-01   -5.258407937955541e-02   +5.659276703515853e-01   +8.257120325918897e-02   +1.216808801902162e-01   +4.521559916371077e-01   +4.344551403871806e-02   +3.769156054720395e-01   -3.498814353704041e-01   +1.618226684109882e-01   +2.840260828010704e-01   +5.233358679929092e-02];
L2E_Input1_iAMPA_netcon = [-2.674067352148886e-01   +8.497376521149942e-01   -1.246748100302276e-01   -8.678502964851162e-03   +3.283670127241359e-01   -2.135529469753408e-01   +5.999924580080185e-01   -8.400183607695827e-02];
L2I_Input2_iAMPA_netcon = [+1.091004196351883e-01   +1.146587909377035e-01   +1.000000000000000e+00   -2.127232324290728e-03   +5.296204069918715e-01   +9.773733196949350e-02   +3.152009560435223e-01   +3.470815871745599e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
