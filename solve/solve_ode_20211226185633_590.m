function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.910267696518145e-01   +4.659663916521461e-02   -8.141693968720104e-02   +1.170450820757724e-01   +2.183415955369656e-01   +1.149104399593126e-01   +1.651457758715774e-01   -1.883671764065812e-02   -4.460325055824160e-02   +2.925363745655541e-02   +2.093139291410735e-01   +2.443350044200213e-02   +1.216175919174823e-01   +1.612731773607627e-01   +1.469443050236473e-01   +8.923128848591806e-02; +1.778148759214377e-01   +1.003913191148353e-01   +8.341987622453519e-02   +1.200205366633801e-01   +3.885082086200534e-02   +9.353218160079296e-02   +1.542192159743770e-01   +1.368555573270435e-02   +1.162570533768719e-02   +6.694957457425205e-02   +4.488927153143667e-02   +1.065151609755134e-01   -2.286852132960550e-02   +2.280045172025295e-01   -5.105517857359312e-02   +1.865313296953014e-01; +1.504195202267166e-01   +2.389934104872928e-02   +1.981919646976542e-01   +1.171697572451588e-01   +1.427903184144045e-01   -5.693685364693633e-03   +2.309717025063487e-01   +5.725449464682798e-02   +8.809667551911560e-02   -5.667027539985121e-02   +6.564439226018327e-03   +1.425359535271984e-01   +4.481130771814295e-02   -2.139391343660776e-02   +1.909500553997385e-01   +7.399758435399972e-03; +1.130048609097133e-01   +6.023264819528969e-02   +4.850230325256667e-02   +8.723234712718758e-02   -8.232080325592967e-03   +1.534841234856756e-01   +1.612825278099535e-01   +6.346070440415917e-02   +1.925036934281101e-01   +2.535223384115412e-02   +1.334615688147429e-01   +1.583910839949867e-01   +1.716919135506816e-01   +1.634757082082334e-01   -2.103493323746931e-02   +3.548924168007205e-02; +6.808551317530817e-04   +1.188957303468441e-01   +5.665510173479674e-03   +2.771166854017371e-02   +2.145421532412583e-02   +1.194234639846978e-01   +5.772521883053517e-02   -8.171228805978970e-03   +1.475996316181996e-01   +1.019456377675802e-01   +7.063280000963668e-02   +1.998462807532763e-01   +1.137778806980291e-01   +1.289313952096376e-01   +4.697103581667914e-02   +1.604247516655531e-01; +8.048624412987298e-03   +8.700006080798381e-02   +1.264994750706095e-01   -5.546210479363101e-02   +1.938322909003675e-01   +1.859291495046546e-01   +1.075984189576365e-01   +1.181848161646603e-01   +7.360828859098192e-02   +1.608494685592162e-02   +7.980578924534511e-02   +4.889607407671065e-02   +8.457832320818998e-02   +1.366722391803643e-01   +1.228825886914997e-01   +2.412337647923798e-01; +1.637754658557165e-01   +3.010934184355180e-02   +1.695569742932499e-01   +1.210471650346977e-01   +1.093037316502210e-01   +2.244836947884964e-01   +1.447374546518815e-01   +2.890812432195667e-02   +7.841255487582686e-02   +2.044455627259897e-01   -4.232156324583243e-03   +7.331906485428433e-02   +9.219936761086486e-02   +5.786410314160194e-02   +1.201982400872039e-01   +4.547063517116937e-03; +2.424735950178931e-02   +1.320014333990886e-01   +8.151668375207684e-02   +8.337581749762792e-02   +1.226298178343906e-01   +1.291586500611335e-01   +8.427626666226609e-02   +6.278425169346646e-02   +1.562652477482240e-01   +3.977705703002915e-02   +1.403745829042798e-02   +9.676389621253155e-02   +8.867489178174125e-02   +3.178356413064739e-02   +5.385716198257454e-02   +1.746102049878754e-02; +1.717118930678720e-01   +1.913220945241088e-01   +9.212449641839346e-02   +2.554623273461179e-01   +4.790220488612443e-02   -4.429679767002336e-04   -2.066001326171553e-02   +5.479219975211442e-02   +1.282628357324983e-01   -1.671812766987834e-02   +4.593250166438788e-02   +5.120858452277479e-02   -6.410660789585147e-02   +2.049564949457483e-01   +4.456234025446042e-02   +7.364459723623457e-02; -2.686376541511466e-02   -2.308721221967904e-03   +1.978258930831104e-01   -8.086129289005982e-02   +1.198321722798133e-01   +1.716873147419438e-01   +6.870027238462459e-03   +1.093724672360090e-01   +4.460001457635143e-02   +1.094352415240721e-01   +2.124103246093951e-01   +6.538830931125222e-02   +6.840174749180518e-02   +8.153067364481455e-02   +9.564666639674095e-02   +1.325060044670527e-01; +9.689478689648780e-02   +4.365374978201132e-02   +4.365431391532186e-02   +1.159626924401226e-01   +1.402401904045835e-01   +1.662656382936940e-02   +1.414999741372602e-01   +1.129704450207409e-01   -1.400712403766804e-02   +1.205017865318942e-01   +1.991360824903583e-02   +1.680028057976024e-01   +1.382978169634656e-01   +1.047768302309782e-01   -2.598638137633713e-02   +8.645833180098786e-02; +9.035547799747021e-02   +7.751927381955540e-02   +1.279374879718155e-01   +5.929800703425826e-02   +1.826008602336399e-01   +8.805310145771414e-02   +1.227773836796301e-01   -2.080448099336242e-02   +1.602171951321664e-01   +5.303714175089982e-03   +1.153018732811405e-01   +1.142273882953977e-01   -2.510455879910794e-02   -3.985761353515978e-03   +1.153996492000046e-01   +8.180551512373548e-02; +1.870634116196178e-01   +1.242946027095849e-01   +1.136078174540970e-01   +8.914161295000772e-02   -4.083471455419506e-02   -1.165165211721755e-02   +9.348613962765541e-02   +5.388287502793904e-02   +9.811060878896234e-02   +1.132588408052830e-02   +8.426476689316184e-02   +8.243427176836796e-02   -6.237248148627621e-03   +2.735392882687084e-02   +1.972325200019931e-01   +9.770304246108646e-02; +3.860746446603561e-02   +5.405131276698853e-02   +8.234722660197397e-02   +8.553772125219011e-02   +5.160216429705328e-02   +5.850853895473114e-02   +2.086221332455340e-01   +1.801428672564606e-01   -1.010108936165910e-02   +3.491719666138311e-02   +2.180359119576807e-01   -2.466477016448402e-02   +4.369080585952295e-02   +2.543312559535404e-02   +1.294145659607398e-01   +1.509437139535829e-01; +1.386799418235349e-01   +1.102580974147306e-01   +2.869568122286955e-02   +1.732504574171992e-01   +5.111824274700684e-02   -2.868289083358133e-02   +1.347755719146208e-01   +1.460913822957653e-01   +3.957062860576078e-02   +1.146107417491066e-01   +4.169516098347192e-02   +3.274627641263472e-02   +9.564072750467963e-02   +1.130220724849991e-01   +1.283301425200547e-01   +1.235167787175645e-01; +9.994313235239971e-02   +8.955665949406498e-02   +5.410809547631226e-02   +1.597111816593980e-01   +2.177017362547770e-01   +8.705998025254004e-02   +6.960005589756490e-03   -6.685247078187739e-03   +3.640857499466337e-02   -7.260006130957398e-02   +9.377011262379331e-02   +1.637328053454492e-01   +1.879582040879416e-01   +5.257772235798579e-02   +6.463096328291584e-02   +1.242082671594293e-01];
L1E_L1I_iGABA_netcon = [+4.097342845583073e-02   +2.558545636724058e-02   +9.369830898008569e-02   +1.012082563944541e-01   +8.810207109471591e-02   +1.280271358905441e-01   +8.093887567589766e-02   +1.221140123780095e-01   -2.728743483843752e-02   +1.772215736814290e-01   -5.377988446640616e-02   -5.059833856928013e-03   +1.731152604939428e-01   +7.578182389640158e-02   +1.341454122955023e-02   +1.562160486242258e-01; +8.154873753736375e-02   -4.004681508568799e-02   +3.058260902584792e-02   +8.827526173666894e-02   -1.292364154283014e-02   +8.667285002747920e-02   +3.662181693576394e-02   +7.534090965039972e-02   +1.440397151303194e-01   +1.351018429400130e-01   +1.024280902416985e-01   +5.094326756569613e-02   +4.330831841918593e-02   +1.183596127379430e-01   +1.161335655822269e-01   +8.714934132009200e-02; +3.967177855762627e-02   +1.578286128817415e-01   +5.692254405973009e-02   +1.825187675879162e-01   +9.030183051076972e-02   +5.560455254634787e-02   +3.605400923844560e-02   +3.452670526055725e-02   +5.010863473311538e-02   +1.422443777246374e-01   +8.598400157890300e-02   +7.924579590286789e-02   +1.710673462418825e-01   -3.734508149926374e-03   -2.249774437250071e-02   -2.888522920566272e-03; +3.437010914943538e-02   +6.944807254420213e-02   +2.828142089992922e-02   +4.747348005113056e-02   +1.529895967417577e-01   +2.004464211846364e-02   +1.412403065073107e-01   +1.958292802401745e-01   +5.452451985517312e-02   -2.793105328722261e-02   -2.362882104880103e-02   -3.722034273999867e-02   +1.180172146362868e-02   +1.876451052060685e-01   +7.721711876609259e-02   +1.242294099342767e-01; +2.300437744732199e-01   +5.345610156883484e-02   +8.464815141350332e-02   +5.377901652764415e-02   +1.507335596419212e-01   +4.072653671148980e-02   -4.774632522872840e-02   +5.758855403772313e-03   +6.255346351660676e-02   +1.078757449327619e-01   -1.590334437094029e-02   +8.746438486719441e-02   +2.099664624236719e-01   +4.225295454883867e-03   +7.394658003150748e-02   -1.155090964021326e-04; +4.841497594524845e-02   +1.772826120394773e-01   +1.051304733526033e-01   +3.705779303973669e-02   +2.632877456223088e-02   +5.864098638760148e-02   +1.081610050776669e-01   +1.206251139378255e-01   +1.029905602515807e-01   +9.583298487838017e-02   +1.033734814486985e-01   +1.579128617044175e-01   +2.416113524032796e-02   +5.361349329909771e-02   +5.979504733670143e-02   +2.000029913375654e-01; +3.705185187321275e-02   +1.051258798517089e-02   +1.235669511176089e-01   +1.488587585793075e-01   +1.826839656496062e-01   +5.778293846131495e-02   +1.030519552963588e-01   +1.446311380915395e-01   +2.599430947829234e-02   +9.983470585420109e-02   +8.829400110262181e-02   +3.663042332113638e-02   +1.117969381519852e-01   +8.039102935417036e-02   +6.630511132700474e-04   +4.783833284634312e-02; -4.826218911122730e-02   +9.777270163840918e-02   +1.184258633404985e-02   +4.518460179035384e-02   -1.299791710267168e-02   +1.218142516219855e-01   +1.653053771386872e-01   +3.775466967289193e-02   +9.564397252264686e-02   +6.687797790276728e-02   -1.257758052115011e-02   +9.443280623250122e-02   +6.070353420143802e-02   -3.589812578552056e-03   +1.018561823759810e-02   +3.132268600905473e-02; +7.178081210446512e-02   +1.375254329627692e-01   +2.950150895458809e-02   +9.658847139066101e-02   +7.309768045743398e-02   +1.679978852424398e-01   +1.786536551977867e-01   +1.094319575714155e-01   +1.045213702069211e-01   +8.426982710925821e-02   +1.826813824215873e-01   +3.718483844967491e-02   +6.977727839388441e-02   +3.981847175648285e-02   +1.081270358262119e-01   +2.194525970827886e-01; +5.812860681589964e-02   -9.245152743574352e-02   +1.407190419541220e-01   +6.056895874684254e-02   +3.947045619129402e-02   +9.348816630807943e-02   +8.789060466660140e-02   +1.324102937519889e-01   +1.017327209488339e-02   +1.569861687490609e-01   +2.040663430612608e-02   +5.621068765755664e-03   +1.008175577729530e-01   +5.265343333132484e-02   +5.539151715321766e-02   +8.082845069945918e-02; +9.987719279862520e-02   +5.379341022642861e-02   -5.825766982672627e-02   +1.180660044961261e-01   +8.798806904473618e-02   +1.876453141197531e-01   +7.032951208305946e-02   +2.447825631181954e-01   +1.047859738434130e-01   +2.160883113372833e-01   +1.405149654283633e-01   +2.164120359439649e-01   +1.750714257246533e-01   +2.981685436257426e-02   +2.268305735211746e-01   +1.035509080993393e-01; -3.722149386663132e-02   +1.479644356167522e-01   +1.230330770669779e-01   -2.184571672642120e-02   -4.460175972559034e-02   +1.043080608483599e-01   +6.580041270068776e-02   +1.440511187454816e-01   +4.624090140274154e-02   -3.555545116255772e-02   -4.723202879918624e-02   +4.938742476938485e-02   +1.036587999590771e-01   +8.364382869644738e-02   +4.735409700574546e-02   +2.826476168607929e-02; +4.047551605406116e-02   +2.244430954417310e-01   +8.140118127678350e-02   -4.935795614179127e-02   -2.691841583698024e-02   +1.077977307979722e-01   +8.124891490432136e-02   +1.510635898107537e-01   +8.040172485411895e-02   +8.814273968206768e-02   +1.044028409266322e-01   +1.298104707341446e-01   +7.357704339909468e-02   +1.701322107807662e-01   +3.203420103572060e-02   -1.678997705825063e-02; +1.612759921221808e-01   +1.734475842671293e-03   +1.141855495309635e-01   +6.686440670425653e-02   +7.244305679157766e-02   +1.580395884607656e-03   +2.043439168683473e-01   -5.734935072159733e-03   +1.166932828005289e-01   +1.453163960948416e-01   +8.575443483309193e-02   +1.382775890000924e-01   -6.300107403489437e-02   +9.582979436610085e-02   +1.138643012766179e-01   +1.113218570069327e-01; +1.085215011932160e-01   -1.506392481853819e-03   +6.837173227877259e-02   +1.164672203387541e-02   +1.105976477985246e-01   +1.003786818466690e-01   -2.291509651649858e-02   +4.555210685439660e-02   +1.948526257333924e-03   +5.333237154039905e-02   +6.210458494843509e-02   +1.902663456566538e-02   +1.287524875486824e-01   +1.661511599426717e-01   +2.750294947598164e-02   +1.517165860512798e-01; +7.065137929492403e-02   +4.294271470303753e-03   +1.128442267569862e-02   +7.747434716411889e-03   +4.026908304642848e-02   +1.726822252755685e-01   +7.412899426224120e-02   +4.596247965382686e-03   +1.985481589946226e-02   +1.903298938511723e-01   +4.850652480245419e-02   +4.222283801508532e-02   -3.122237692626577e-02   +1.569908002740830e-01   +1.298835313345276e-01   -6.540725133578822e-03];
L2I_L1I_iGABA_netcon = [+7.573278569537042e-02   +8.699522297321041e-02   +1.529114686462527e-01   +6.616918185873895e-02   +1.099004820893539e-02   +6.386767026779100e-02   +1.980018548768709e-02   +1.475642330638311e-01; +1.312535565161791e-01   +1.016987425789688e-01   +2.680577880563919e-02   -1.705784738090832e-02   +1.488222724511474e-01   +2.099268183350447e-01   +1.157011669528492e-01   +7.616045037605783e-02; +9.001154897129096e-02   +6.931554236251233e-02   +5.606140060529671e-02   +3.894981351811681e-02   +1.056832080172804e-01   +2.729398159790136e-02   +1.547917720705662e-01   +1.243061512229886e-01; +6.165155436612080e-02   +9.752140221946962e-02   +2.612202789650217e-02   +1.237307377154987e-02   +7.606599208611156e-02   +1.425764746796047e-01   +1.440696661087881e-01   +1.898348733647102e-01; +2.536607496590055e-02   +8.194302133963969e-03   +1.836389072923682e-01   -2.692495891075180e-02   -1.138334336407572e-02   +1.791870526272125e-01   +1.888883580327096e-01   +1.453632577924940e-01; +8.408416645312936e-02   +1.255790686214370e-01   +1.710248501436463e-01   +1.565365873601119e-01   +9.529519554013220e-02   +9.965002807955653e-02   +6.963567170063485e-02   +1.424349735617595e-01; +2.502165500630802e-01   +8.035788923608236e-02   +7.613792429032525e-02   +9.023920961117324e-02   -1.468557369153726e-02   +2.543393297692066e-01   +5.350602623823562e-02   +1.533424897251357e-01; +4.611388705865233e-02   +1.438070238019473e-01   -1.481432798383943e-03   +1.856195426734251e-01   +1.566573918308159e-01   +9.800044865253826e-02   +1.177236490069306e-01   +5.915216355696751e-02; +2.856007928123378e-02   +3.931853955893239e-02   +2.166097378045154e-01   +1.440256769607134e-01   +6.628843139284131e-02   +7.185241945558007e-02   +2.557689879990069e-02   +1.193075393821108e-01; +1.413869634253637e-01   +6.779059917500449e-02   -7.103563266058419e-03   +2.564485696291750e-02   +2.043883351231444e-01   +1.386958243783628e-01   +8.156091909333345e-02   +1.265221638597682e-01; -1.426506810782658e-02   +2.656957970905122e-02   +1.574077064453507e-01   -2.196533701855083e-03   +1.244510030593636e-01   +9.111384957825959e-02   +1.649530179391781e-01   +4.523544319460437e-02; +4.686634987667146e-02   +1.298340127509073e-01   +5.170507597144879e-02   +1.035770417699559e-02   +1.198670821397368e-01   -1.993159769153137e-02   +1.891709533202142e-01   +1.432703979252851e-01; +6.496689913552443e-02   +4.483528928992778e-02   +4.156919032204821e-02   +1.399435837426024e-01   +7.575385037723703e-02   +1.099230857802273e-01   +7.842837571227161e-02   +1.601089359633762e-02; +7.327392971561542e-02   +2.052788685768263e-01   +2.157725781485026e-02   +5.029429961783806e-02   +1.538656897882843e-02   +1.038652947547470e-01   +1.786693406984686e-01   +5.774396783821398e-02; -2.294608795122085e-02   +1.151970866783910e-01   +5.329131501131312e-02   +7.158743680639443e-02   +3.537577960388807e-02   +7.852356857521953e-02   +9.953973453351531e-02   +1.682155069717704e-01; +2.580039761276046e-01   +4.746860212569925e-02   +3.047083222202267e-02   +2.118899146044768e-01   +2.408430453961267e-01   +1.684395809970314e-01   +8.456675663129912e-02   +1.642718873685497e-01];
L1I_L2I_iGABA_netcon = [+1.183242109659721e-01   +1.078893354765536e-01   -5.333348511485963e-02   +1.109918655123957e-01   +1.094889460314374e-01   +8.961556064295557e-02   +8.790194146499075e-02   +2.911917434110731e-02   +3.571067280710680e-02   +1.865774284776943e-01   +1.220081474276204e-01   +4.684192226618651e-02   -4.960276559595114e-02   +1.352229750088619e-01   +7.919880455226253e-02   -1.155403532567266e-01; +1.733548988768896e-01   +1.745777919215827e-01   +5.546151942779026e-02   +1.359859963986973e-01   +1.614201364236997e-02   +1.707749616208235e-01   +4.368444682690503e-02   +2.316056959560946e-01   +1.482833749488063e-01   +1.729123027918936e-01   +2.919656627061644e-02   +3.480459853646808e-02   +1.289708414900020e-01   +1.663151946877585e-01   +2.047392212881991e-01   -1.151981667175575e-03; +4.770569215540460e-02   +6.960099823455687e-02   +1.604585440627006e-03   -1.127750346069038e-02   +1.281138245565839e-01   +1.389529430701499e-01   +8.392312849912896e-02   +1.037670680927353e-01   +8.577934679905891e-02   +5.925839923000262e-02   -1.029134552614016e-02   +1.451064061738867e-02   +1.050689508839295e-01   +1.957383758445631e-01   +5.731944310960801e-03   +1.172677585491725e-02; +9.501447477770580e-02   +1.533448926314817e-01   +1.627573843974139e-01   +7.801941105817237e-02   +6.147560817644161e-02   +2.253204599492129e-01   +9.534412368923337e-02   +1.253071252195308e-01   +1.811709562050076e-01   +1.067193078226261e-01   +2.617280213262707e-01   +3.415834363658582e-03   +7.819818877407993e-02   +7.682972758208356e-02   +6.537170040181185e-02   +7.771992387107071e-02; +1.059939689115237e-01   -5.732217596588294e-02   +1.246228897877197e-01   +8.522609288613725e-02   +2.174712374778754e-02   +4.228628999613204e-02   +2.169696826554639e-01   -4.648658771978393e-03   +1.034355494071746e-01   +5.576113407098424e-02   +8.091611668733782e-02   +8.620978815463361e-02   +3.336998728182293e-02   +3.889490504535195e-02   +5.964965226049133e-03   -3.423543337630004e-02; +8.703680767141370e-03   +4.001262253555336e-02   -2.720463413344063e-03   +2.335381684736574e-02   +1.569294408777945e-01   +2.032514667376448e-01   -1.095180813021350e-02   +2.995071490327222e-02   +9.478277651978541e-02   +4.147236066282842e-02   +1.424132895483324e-03   +9.922866908759355e-02   +1.422648500805729e-01   +1.334911298210348e-01   +1.756948513166329e-01   -1.884927652493763e-02; +1.727379091581611e-01   +1.762116592136608e-01   +3.627433004183361e-02   -7.435789223781940e-02   +5.344592798739327e-02   +9.526573908266234e-02   +3.859063086284206e-02   +2.580128845625015e-02   +1.270881629982411e-01   +5.137258868275964e-02   +1.719703193675259e-01   +7.706185093712159e-02   +5.480981047006427e-02   +8.129201756611333e-02   +3.916078633758354e-02   +1.577753842497794e-01; +1.418586336193264e-01   +7.932434366196915e-02   +1.233985595623372e-02   +1.004996305691836e-01   +2.318795974585225e-01   +1.008607854623583e-01   +1.060988897538341e-01   +1.269419250945664e-01   +1.856257737267771e-01   +4.112099212588352e-02   +6.061024952431384e-02   +1.156731132590563e-01   +1.261052784523243e-01   +1.821097389825452e-01   +1.461510077291842e-01   +4.932583538037976e-02];
L2E_L1E_iAMPA_netcon = [-1.979869749722291e-02   +1.232520076619442e-01   +1.308038907391766e-01   +4.615681755412347e-02   +3.321743234702654e-02   +7.935336693676595e-02   +9.464802050171282e-02   -4.304238628312483e-02; +2.052442688780336e-03   +1.188637363005592e-02   +1.593656260983928e-02   +2.031432203140276e-01   +9.037649088443150e-02   +4.711571232845907e-03   +1.146554561694177e-01   +2.387199704984078e-01; -1.108555152608809e-02   -1.601053064900086e-02   +2.280455259100424e-01   +9.642325383133273e-02   +9.641043312526165e-02   +1.160042099081442e-01   +1.625287049689162e-01   +3.381615706483247e-02; +1.855026550788962e-02   +9.824132876294144e-02   +9.731443064503234e-02   +2.505192128292622e-02   +1.702336637564372e-01   +7.614353398409729e-02   +1.538581040746981e-01   -1.225723702376606e-02; +1.828504356733995e-01   +1.467470910912141e-01   +1.505614144566828e-01   +1.452409856165564e-01   -5.756004232647807e-02   -4.227458752614481e-02   +1.619060169387690e-02   +2.203255040657108e-01; +2.055145431522804e-01   +1.803617343570252e-01   +4.188983240181572e-02   +6.179162037841707e-02   +1.055101101516398e-01   +1.577001939484345e-01   +1.074101019612404e-01   +1.138189809862014e-01; +5.895471667836868e-02   +1.120252896099162e-01   +7.377324705093029e-02   +1.173936623133075e-01   +8.392555046724928e-02   +2.158339562203465e-01   +2.605643253789914e-01   -3.569071065668478e-03; +7.646511609037154e-02   -2.539448977808406e-02   +1.961416241846402e-02   +1.954444665521175e-01   +1.013081895076093e-01   +6.074255002512539e-02   +4.764180479207383e-02   +6.196027632144657e-02; +2.785076551570131e-01   +6.188727525204402e-02   +1.514552766949595e-01   +1.149574898435389e-01   +9.638780682782823e-02   +1.139555792373724e-01   +9.833781307866507e-02   +1.529940056067836e-01; +1.095214796811692e-01   +8.267681548858666e-02   +1.376638548247164e-01   -9.464326559880575e-03   +1.709402333363441e-01   +5.693927188092469e-02   +1.374167450189099e-01   +4.237204474615612e-02; +2.074454165138488e-02   +1.425342447877101e-01   +1.510747441277688e-02   +3.640205134824552e-02   +2.510689329781767e-01   +1.536299005263780e-01   +7.714575494541989e-03   +3.432810348779766e-02; +1.090148993201554e-01   +2.995824579626172e-02   +4.116315663449253e-02   +1.097820836940659e-01   +5.940070096244504e-03   +3.987866805899106e-02   +1.280336163020259e-01   +9.170750123713742e-02; +1.470867148450856e-01   +6.489704744881293e-02   +1.574392108219924e-01   -3.769959306608702e-03   +1.208361444438872e-01   +2.632492365203595e-03   +1.161329423539514e-01   +6.379964668185674e-02; +1.664594219215221e-01   +1.397101351191936e-01   +1.543315576442176e-01   +5.281193408832262e-02   +1.183191659791512e-01   +1.570593549365494e-01   +1.281560726598351e-01   +1.106480705330737e-01; -7.698351688403021e-03   +1.510713077544173e-01   +5.555914865813724e-02   +1.532619028974902e-02   +1.139244388844593e-02   +2.130442060108027e-01   +1.108579159010837e-02   +8.614230858035768e-02; +1.081265327827642e-01   +1.568510654455998e-01   +4.928004461709237e-02   +8.942682361813256e-02   +4.873020644331977e-02   +9.427114760600284e-02   +8.719399614858245e-02   +6.132648567861172e-02];
L1E_L2E_iAMPA_netcon = [+1.000351706587903e-01   +7.605069506052464e-02   +9.544980243835952e-02   +4.452871367682951e-03   +1.026308285074959e-01   +1.759144880369140e-01   +9.811365900080485e-02   +2.537458899232805e-01   +5.657473478578935e-02   +1.049068217578154e-01   +5.544210759310753e-02   +1.037872106363148e-01   +4.784589604978187e-02   +2.268081975172132e-02   +9.895462976388324e-02   +6.173886318773825e-02; +1.655149337421225e-01   +2.690980825537197e-01   +7.668374645806708e-02   +1.667217791070670e-01   +8.129904501053065e-02   +1.459270290644076e-01   +9.446409426001108e-02   +2.639557419870319e-02   -1.578595223746703e-02   -5.223203120753998e-02   +8.878647290434860e-02   +1.309546089503748e-01   -4.226072353083641e-03   +5.597472736819850e-02   +2.162887593196721e-01   +1.033509724193237e-01; +1.659406008387517e-02   +2.076313584686802e-01   +2.049246796677984e-02   +9.804332676176056e-02   +4.765432871272495e-02   +1.120911453026837e-01   -9.547330378862200e-02   +1.824454252468388e-01   -3.418886204066291e-04   +1.382606339762319e-01   +1.244684763874546e-01   -8.553952753206730e-03   +1.092801329063420e-01   +1.490557698112162e-01   +1.630240473734444e-01   +1.696580037612260e-01; +1.601587142612869e-01   -3.030979767101536e-02   +1.069055933402926e-01   +4.496858303534030e-02   +1.586906319920626e-01   +3.810221947939076e-02   +1.205258897023262e-01   +1.654365661651251e-01   +9.076564504386889e-02   +2.350417228521869e-01   +1.065893179110826e-01   +3.843489881638062e-02   +1.656158573610021e-01   +1.055274684531549e-01   +7.957025370300630e-02   +3.385780614656611e-02; +9.673408854046585e-02   -2.385416169394891e-02   +4.454099770598834e-02   +1.563089116636192e-01   +1.143349405984787e-01   +9.713692107174034e-02   +5.596236280775883e-02   +2.620965922180242e-01   +2.372704985002329e-02   +1.475504458543171e-01   +4.064461217877566e-02   +1.666981549173404e-01   +1.448289426642009e-01   +4.997332200360369e-02   +6.155947695245459e-02   +1.556576454172378e-01; +1.491523228755008e-01   +2.269180894962745e-01   -2.119919358653792e-02   +1.788010856038305e-01   -1.859363312892584e-02   +7.010204724577014e-02   +1.476178614931236e-01   +1.141748965834388e-01   +9.094548658665466e-02   +5.230335490667334e-02   -3.945114330307884e-02   +3.794414288232322e-02   -6.964783894753700e-03   +8.369583454982452e-02   +1.301624481949833e-01   +5.452815901806964e-02; +1.519872984343643e-01   +9.968065148150543e-02   +1.015458244959847e-02   -1.099064278424517e-01   +1.569136322664643e-01   +2.053719675761583e-01   +1.255191723265257e-01   -1.381487311637340e-02   +3.356891247556924e-02   +2.574233527344944e-02   +1.813954104696981e-01   +5.340271730007842e-02   -3.553114967980797e-02   +2.422941780370484e-02   +1.270704409798901e-01   +4.665607386134048e-02; +2.078547021808265e-03   +1.004468236221756e-01   +9.589498542083498e-03   +9.656095858344899e-02   +7.334786320827724e-02   +1.607401615751176e-01   +1.117722941404874e-01   -2.226807674885315e-02   +1.374512725956593e-01   +7.125128287299258e-02   +8.733584412486216e-02   +4.786873069329285e-02   +1.584703193485665e-01   +8.093160405472574e-02   +1.282726183880480e-01   +1.414044769652533e-01];
L2I_L2E_iAMPA_netcon = [+1.403116779518176e-01   +6.563653987569740e-02   +1.191992946167638e-01   +1.156460234883974e-01   +1.712809762756664e-01   +2.039734123683007e-02   +7.068376395911032e-02   +4.974550438374759e-02; +1.361920339271654e-01   +1.031643437537820e-01   +3.305514469623769e-02   +8.037680106371267e-02   +1.593942949712204e-01   +4.055986922782334e-03   +9.693311271584740e-02   +1.204773681849471e-01; +1.856994177263973e-01   +3.407043307332241e-02   +2.915827380362194e-02   +6.644712434940001e-02   +1.330754177581018e-01   +1.206824225130663e-01   +1.154087965898591e-01   +1.467110504607027e-01; +5.089537913882869e-02   +1.334215714967373e-01   -6.197718481554943e-02   +4.852032594555142e-02   +2.201866887461565e-01   +1.862090106181722e-01   +4.014542925467461e-02   -5.319861180341529e-03; +7.774976061763871e-02   +8.911274718218844e-02   +7.087965847550949e-02   +3.687764141492766e-02   +1.268352646267775e-01   +3.771460306578646e-02   +5.148868646329140e-02   +7.474545632998542e-02; +1.710669152766915e-01   +1.018220707825675e-01   +6.072616808752978e-02   +8.147472494608479e-02   +1.793555586798345e-01   +1.903214518239795e-01   +1.539152251773010e-01   +5.065193557927776e-02; +4.048357138977883e-02   +1.279545650144718e-02   +1.486319290719218e-01   +8.567026228787232e-02   +6.735333278035593e-02   +1.286358806443940e-01   +2.047981919756842e-01   +2.655735443124967e-02; +1.422723562361829e-01   +2.505393582794439e-01   +7.748692214726494e-02   +9.335907231572835e-02   -6.321605364514234e-02   +3.281242555037825e-03   +7.138377370502955e-02   +1.537843059420063e-01];
L2E_L2I_iGABA_netcon = [+1.774553773577653e-01   +8.625804216981695e-02   +1.855334122680964e-01   +1.412887315144747e-01   -6.820208045387005e-02   +1.894113580385307e-01   +9.476001953416997e-02   -1.197263619734820e-02; +1.676250407271359e-01   +2.063252381454470e-01   +1.507716606526676e-01   +6.058957393813506e-02   +1.306474425011546e-01   +1.047737365990386e-01   +5.579792225350359e-02   -1.393568143531019e-01; +1.608788739766530e-01   +3.477383049567968e-02   +1.262303706201797e-01   +1.479643833849566e-01   +1.703694338764700e-01   +6.407008512286945e-02   +1.292461778849261e-01   +1.424260549631675e-01; -8.968139264069463e-02   +1.402553584575753e-01   +9.140584792763899e-02   +3.907879420634455e-02   +9.530150496637607e-02   +7.360741467908781e-02   +1.473749862253797e-01   +1.464544040600773e-01; +1.119919428693529e-01   +2.224165088593045e-02   +1.495203990412220e-01   +8.248748190589553e-02   +7.372128258079118e-02   +5.085082599910139e-02   +8.921878546961153e-02   +1.205866807713981e-01; -1.117389354849249e-01   -2.784218277364910e-03   +1.287996618051973e-01   +1.427667644212725e-01   +1.408459580169104e-01   +1.709523527463370e-01   +1.488747538628936e-01   +8.771427285177660e-02; +2.209573202722366e-01   -6.306733600692274e-02   +8.537097043796363e-02   +1.080852042349119e-01   +1.503725400629654e-01   -6.338941397837446e-02   +1.037386106626026e-01   +7.118593183012112e-02; -1.836256049254987e-03   -1.684678968855505e-03   +1.565601184135777e-01   +1.146903371190991e-01   +7.678605684018315e-02   +3.450284661187416e-02   -2.169686097885215e-02   +8.984182017483863e-02];
L3E_L2E_iAMPA_netcon = [+1.222274338052547e-01   +1.623388814579245e-01   +1.192786818978638e-01   +4.277104637504061e-02   +1.992708753728861e-01   +8.198560456813252e-02   +1.632206136203104e-01   +2.348247429487842e-02   +8.103518922384496e-02   -6.686213307037215e-03   +3.827597982714667e-02   +1.256492423984081e-01; +2.458630097523428e-02   +7.321068782791154e-02   +1.532836181268980e-02   -8.358706877836249e-03   +1.222074097902215e-01   -1.502055426455089e-02   +1.780416901013609e-01   -3.686174881005083e-02   +3.155939011541051e-02   +9.860528810218486e-02   +5.067901113147442e-03   +1.158738480883507e-01; -2.582235884645214e-02   -6.450316784624528e-02   +7.960123177207193e-02   +9.138825773304160e-03   -5.745293308156473e-02   +4.231664562655771e-02   +1.281705200905579e-01   +9.247515935573937e-02   +3.536115371922668e-02   +9.402323946049979e-02   +1.513398066745731e-01   +1.126775416394903e-01; +9.381943941727708e-02   +1.485075651770901e-01   +9.486754604760148e-02   +1.560048970661627e-01   +8.911329117786115e-02   +1.519998365705935e-02   +1.089578380295275e-01   +2.259539050804781e-01   +1.309579619533001e-01   +1.474849036245481e-01   +9.528762274158226e-02   +1.033275946598970e-01; +1.551835767366324e-01   +8.604668105165447e-02   +1.639366034283009e-01   +1.143928107705818e-01   +7.004565233789858e-02   +1.498526931066393e-01   -4.294992491225877e-02   -9.300350900338473e-03   -6.343234252919648e-03   +7.612388460873075e-02   +1.045927500416386e-01   +1.168892534539208e-01; +3.685853877515100e-02   +9.299239339498204e-02   +3.442760023669703e-02   +1.899463860093286e-01   +1.242160935383248e-01   +2.459397244076178e-02   +7.705759781312997e-02   +1.724927126699686e-01   +6.551518721410564e-02   +6.661578428688235e-02   +1.195698924598511e-01   -1.847861841520917e-02; +1.233029438110835e-01   +1.435980422102971e-01   +1.247375078967934e-01   -4.638557209526754e-02   +1.349100060478542e-01   -1.660916211084677e-02   +1.393368318520649e-03   +1.166595383331335e-01   +1.628486983819572e-01   +9.385466574122819e-02   +4.797059659865438e-02   +1.222763942576018e-01; +1.172963163359310e-01   +1.469614711636218e-01   +7.300587537772985e-02   +1.202087249387629e-01   +1.117634787182298e-01   +1.393534177447953e-01   +7.130506031965214e-02   +7.124303274190388e-02   +1.132263097906281e-01   +1.169270511131318e-01   +5.431227739573723e-02   +1.335330888396633e-01];
L3I_L2I_iGABA_netcon = [+6.724663269715286e-02   +6.789627653763643e-02   +1.178802995210938e-01   +5.680244241481978e-02   +1.612274617863387e-01   +4.375365672962138e-02   +1.507264605411564e-01   +1.185669233618796e-02   -2.413804445039053e-03   +1.086253759776766e-01   +5.206702177198767e-02   +1.614754740450536e-01; +8.943600964089193e-02   +7.328061788725854e-02   +3.129684492121219e-02   +5.541815451737601e-02   +6.956821369197641e-02   +7.874795084576783e-02   +1.480095341206491e-02   -2.751228975258747e-03   +8.224932913132629e-02   +8.760841366353270e-02   +1.175544623142257e-01   +1.269188779219751e-01; -5.811271424846168e-03   +6.061793253060660e-02   +1.006587112514385e-01   -2.613878078547829e-02   +1.245578481162566e-01   -7.199211251445001e-02   +7.680104550314402e-02   +1.596841239147108e-01   -2.279315387194619e-02   +5.798279340928864e-02   +8.283886759597126e-02   +1.937643947715217e-01; +1.138604217339170e-01   +1.227451866096670e-01   +1.773946223820930e-01   +1.010396345991385e-01   +6.834641685461422e-02   +1.581957315247373e-01   +4.602286532776113e-02   -1.415288488979996e-02   +1.658188761848247e-01   +2.960344165796189e-02   +9.333476201159512e-02   +5.625334616478438e-03; +2.111027412327161e-02   +6.423204835584073e-02   -1.489719231500491e-02   +2.261184503090924e-01   +7.097663891894879e-02   +5.313359821613887e-02   +1.165236244212212e-01   +1.236153433020645e-02   +2.263298151258751e-01   +5.096640044664828e-02   +1.205029392502849e-01   +7.348034980362959e-02; -2.788304970454641e-02   +1.930117248220551e-02   +1.714364188726973e-01   +1.476450780213279e-01   +8.838634383762883e-02   +8.762543646312333e-02   +8.623034970765429e-02   +6.905788705455738e-02   +1.369814941441160e-01   +9.616903124272587e-02   +7.916869224865677e-02   +5.976487266636948e-02; +1.373660228918928e-01   -2.860161541306776e-02   +7.199344751634498e-02   +8.506437110281032e-02   +7.612649916557110e-02   +5.169913988241956e-02   +2.081451807494978e-01   +1.568254597083305e-01   +1.945029354771758e-02   +6.545122200417269e-02   +1.844983458203753e-01   +7.863376291135502e-02; +1.149329128042477e-01   +9.389604910450532e-02   +4.758209285568825e-02   +1.166004747838007e-01   +4.947463490168344e-02   -5.651462651774437e-02   +2.447895955135261e-02   +5.555789797914422e-02   +3.556911159060475e-02   -1.318153522514965e-01   +8.233911636867081e-02   +2.528180514793526e-02];
L2E_L3E_iAMPA_netcon = [+1.274042767309841e-01   +1.720876058357041e-03   +1.188805663995541e-01   -2.925782670568004e-02   -1.019561059925028e-02   +1.336199353040898e-01   +5.878401387155277e-02   -4.060780455268977e-02; +6.807188401933463e-02   +1.081941070140524e-01   +1.943390354678397e-01   +9.241631327647840e-03   +1.796668490285948e-01   +1.061997584161717e-01   +1.320841437807383e-01   +1.634212006425523e-01; +1.442262986177566e-01   +1.509796068991524e-01   +1.482526576781147e-01   +5.217807691657564e-02   -1.959111344644538e-02   +1.378663557676848e-01   +1.090506138897263e-01   +1.714265216854133e-01; +7.634101064109736e-02   +1.134054024357523e-01   +2.364957461102485e-02   +8.066101481843800e-02   +3.484193239471041e-02   +5.190817108774289e-03   +1.131943973504130e-01   +1.783423318753500e-01; +1.049410444635801e-01   +3.287893872424635e-02   -3.626629239435210e-02   -1.771942936619549e-02   +6.385486525815143e-02   +1.106246614643691e-01   +1.085966937901482e-01   +1.642305421085140e-01; +5.316628268007050e-02   +1.873304140818952e-01   +1.937740963468580e-01   +5.502095458632523e-02   +9.992580247974010e-02   -7.434574046496835e-02   +1.488936557031345e-01   +4.596412115856918e-02; +1.238011629009145e-01   +4.913984109004293e-02   +9.191584484071280e-02   +5.227392284656842e-02   +7.109832986575321e-02   +7.901136905799243e-02   +8.709482787565979e-02   +9.434776504149278e-02; +7.456329674970194e-02   +4.521294174016363e-02   +4.978582550039900e-02   +2.011196496170798e-02   +1.760192258125780e-02   +9.870064480972396e-02   +1.003559050666709e-01   +1.115685475637984e-01; +1.827733021304893e-01   +1.342458056171940e-01   +1.213571041452260e-01   +1.685949772104836e-01   +1.729410927332067e-01   +9.809208472070836e-02   +1.782384298346092e-01   -2.352386031049808e-02; +1.485845779679006e-01   +1.869905760373058e-01   +9.021553859076806e-02   +1.356915182436148e-01   +1.438949333802925e-01   +3.607857902905421e-02   +1.542586779273919e-02   +5.676299978957552e-02; +9.498306770059617e-02   +8.867412831654739e-02   +1.375022336833628e-02   +3.447203615182166e-02   -5.225570905729899e-02   +1.615969469826728e-01   +1.386994323519846e-01   +1.603394468193400e-01; +1.863230068682314e-01   +2.076151225851147e-01   +5.185279611935299e-02   +6.520749969383025e-03   +1.176800834836077e-01   +1.676232357604403e-01   +7.916406303607240e-02   -1.921492907880072e-02];
L2I_L3I_iGABA_netcon = [+6.332913821870448e-02   +4.801309049874521e-02   +5.209445437223484e-02   +1.867075158793414e-01   +2.405427212338952e-02   +3.671542422083382e-02   +4.522905517551905e-02   -2.032058907248419e-02; +1.837636917140641e-01   +1.104320342315329e-01   +7.477688339279157e-02   +3.966977367690955e-02   +1.631023079915851e-01   +6.276136260996180e-02   +2.231881063851372e-02   +5.762044837870579e-02; +1.089773158143695e-01   +2.170353008529037e-02   +4.670195014332988e-03   +4.243159830481577e-02   +6.384538558173970e-02   +1.795312182367273e-01   +7.363760514136332e-02   +1.095606649943026e-01; -1.693167363288929e-04   +8.489770743089119e-02   +1.664992849228571e-01   +1.186638191176359e-01   -9.572651534604010e-03   +1.178321347295595e-01   +3.479617917553752e-02   +1.600528668809901e-01; +4.825480971911018e-02   +4.189750824124849e-02   +4.350286692506900e-02   +5.920130999584557e-02   +8.624953726403432e-02   +1.070517890884428e-01   -5.909475924936532e-02   +1.084850980277541e-01; -2.033803319664710e-02   +1.211864546387208e-01   +1.269557988168243e-01   -4.377451069529543e-02   +1.061236952433344e-02   +5.067829639100620e-02   -6.143096907775002e-03   +1.641860612211451e-01; -2.129158310488112e-02   +1.114347587930977e-01   +1.646099404626041e-01   +8.910157985181896e-02   +6.837318047877701e-02   +7.140734872012471e-02   +1.082868748378120e-01   +4.314299134535964e-02; +1.214371480122778e-01   +1.187274712213294e-02   +3.565191344047321e-02   +1.094880534771791e-01   +1.574836770621509e-02   +2.032978943421745e-02   +3.025702721090510e-02   +1.176701351868333e-01; +1.182046780488649e-01   -5.312559360598929e-03   +1.003833906247401e-01   +5.559737593974898e-02   -3.401662322184308e-02   +2.762378232274078e-03   +5.562683717481512e-02   +9.865304291216902e-02; +1.381075495982644e-01   +2.762559720309826e-02   +1.875851231866099e-01   +1.274520369883776e-01   +1.642355448998435e-01   +1.761266649585507e-01   +1.718035521371263e-01   +1.066851716518029e-01; +8.476017865846164e-02   -2.355784238017910e-02   +7.745262569618279e-02   +8.532982400098922e-02   +1.095039948434430e-01   +4.676849515553411e-02   -6.108992524658015e-02   +7.661839969407858e-02; +1.728710536264234e-01   +1.345966659825247e-01   -4.280030870466593e-02   +7.639179181493874e-02   +1.285862494461407e-02   +9.472358775520177e-02   +1.691033020913681e-01   +9.807656771141540e-02];
L3I_L3E_iAMPA_netcon = [+1.362909159953888e-01   +1.133298760698328e-01   +5.865993210607062e-02   +1.129311776311055e-02   +1.910533763213096e-01   +6.937938605812199e-02   +2.010660847061143e-01   +1.459587730459201e-01   +8.328160255065177e-02   -2.129745046282328e-02   +3.923847557694424e-02   +3.966384777319581e-02; +6.744506838085126e-02   +6.303825239350855e-02   +6.300702430312756e-02   +1.392009139257786e-01   +1.505767947392011e-01   +5.412802097958601e-02   +5.755938427388586e-02   +3.014521378771900e-02   +7.023357274873912e-02   +9.308096187532860e-02   +1.846118757043552e-01   +1.111216731161661e-01; +1.082177204616623e-01   +1.152098832479876e-01   +2.718625768860452e-03   +1.432775164732580e-01   +3.167670711570257e-02   +1.855906634459235e-01   +1.522391215307892e-01   +1.472127380514983e-01   -4.648626681939355e-03   -5.121920625634244e-02   +1.255372176598421e-01   +4.387445862845966e-02; +7.731500339533784e-02   +1.173162586054664e-01   +1.877768726633292e-01   -1.536006662310657e-02   +2.369501648904726e-02   +1.040123175166005e-01   +1.899219293416660e-01   +9.573124950545153e-02   +8.992958216632170e-02   +3.131645810862583e-02   -2.461120175766158e-02   +6.908642912250129e-02; +6.696220857178484e-02   +1.777870865814162e-01   +2.373484953588445e-02   +1.576273273917249e-01   +1.188783253520006e-01   +8.992702050430010e-02   +1.300391760083672e-01   +9.726192145607740e-02   +1.480529186842933e-01   +8.991586470282670e-02   +3.689506583922122e-02   +1.443558576415342e-01; +5.254775928763589e-02   +5.799444109372572e-02   +1.981691918051027e-01   +1.419820890489117e-01   +1.320494107426915e-01   +1.033694963051793e-02   +1.029507755651080e-01   +2.332259962909396e-02   -1.998211138509937e-02   +2.319940897568641e-02   +9.024410947370577e-02   +2.922992563133619e-02; +9.496470701785212e-02   +7.570591965839453e-02   -1.519451605850944e-04   +1.289613874477682e-01   +2.021150141502771e-01   +1.534214089167699e-01   +3.511985595428311e-02   +6.705231823501258e-03   +1.706128554356292e-01   +6.726997753995038e-02   +6.487775488219050e-02   +4.786971793898391e-02; +2.275355133046535e-02   -3.010550996469601e-02   +1.494125475767842e-01   +1.217826295098232e-01   +8.937600469319912e-02   +1.255394870053660e-01   +8.062413425353826e-03   -4.929674130339283e-02   +1.544443631304041e-01   +1.272659812607345e-01   +1.949688524681642e-02   +7.557056684889497e-02; +8.492158930303845e-02   +8.441093079365881e-02   -2.849862102699412e-02   +7.756932961949543e-02   +1.531471156030936e-01   +1.128786022413530e-02   +1.669356103820630e-01   +1.409030490269096e-01   +3.992461991027482e-02   +9.511035495696431e-02   -7.627788219932438e-02   +1.004142121090794e-01; +1.086772096299077e-01   -4.575652063915002e-02   -6.473496025419589e-02   +3.094416734568660e-02   +4.480858925949265e-02   +3.976893477064571e-02   +7.159050581008518e-02   -8.885405330214709e-04   +1.117737633302142e-02   +1.142840130979334e-01   +1.441624323278168e-01   -7.282625523422517e-02; +1.209256498202182e-01   +1.005354457880210e-01   -3.665858864863020e-02   +1.793550895739942e-01   +7.599140424988804e-02   +5.857612327937663e-02   +4.582659496644108e-02   +1.376698380901638e-01   +9.343732516867750e-02   +5.979347557011558e-02   +3.516282914301394e-02   +1.187150063884898e-01; -1.464205305627371e-02   +3.463583555904076e-02   +3.223098683596810e-02   +6.836528973164622e-03   +8.155113857927307e-02   +8.690527376908956e-02   +3.838099928411307e-02   +1.148980135065195e-01   +5.317590684914422e-02   +1.632855267583902e-02   +5.487652755162015e-02   +5.450095430782412e-02];
L3E_L3I_iGABA_netcon = [+1.049550954431086e-01   +2.407624835655064e-02   +9.390690827368246e-02   +4.469297381564064e-02   +3.545002615711601e-02   +1.399771365932782e-01   +2.411957690758669e-02   +3.514854720555515e-02   -3.730650934038856e-02   +1.522108163118732e-01   +1.041315848888469e-01   +1.047542958042995e-01; +9.348548494162229e-02   +2.100465758062895e-02   -7.666044843787512e-03   +4.418276381177418e-03   +1.098813508148658e-01   +1.795472868508521e-01   +1.746314751441523e-01   +8.786170586904166e-02   +2.433266954750939e-01   +9.505351686119805e-02   +1.871877360175241e-01   +1.485022540151052e-01; +1.429847269140022e-01   +5.522388626003701e-02   +1.857632554503275e-01   +1.093191549675569e-01   +1.552729830166426e-01   +5.869900314708867e-03   +3.920488531054862e-02   +1.543076642304529e-01   +1.670189983671799e-01   +1.393102810622567e-01   -3.548246085072657e-02   +5.832492883680714e-02; +1.325200995709325e-01   +2.251219090284282e-01   +1.941661373630689e-01   +1.217453580832339e-01   +1.340420295771558e-01   +1.117962239684289e-01   +2.111310389331774e-01   +7.053547902449242e-02   +1.090617226493610e-01   +1.029822495787321e-01   +1.069913527343504e-01   +2.843699028578369e-02; -2.617948720691203e-02   +1.816181570683124e-01   +1.406415638523616e-01   +5.341159488814066e-02   +1.423861528281432e-01   +1.354072580007899e-01   +1.225317235370497e-03   +8.750008055237957e-02   +1.989246052241801e-02   +8.735586341985190e-02   +1.728370010109886e-01   +3.031123446220337e-02; +1.607472010131541e-02   -1.657640447960990e-02   +1.313875398077202e-01   +2.604637349771624e-01   +1.770005190986168e-01   +3.167657225179570e-02   -4.983657176573629e-02   +1.802389874353787e-01   -3.781885176827548e-03   +1.087599354763803e-04   +7.716772903109557e-02   +2.937498468495675e-02; +1.949001756992668e-01   +9.017102286677986e-02   +1.446299076549317e-01   +3.816138459418516e-02   +1.476592229079208e-01   -2.884205961874187e-02   +1.692189653980711e-01   -1.371358633005626e-02   +5.003350383322872e-02   +5.882962867727497e-02   +1.086003508746657e-01   +1.501365847841678e-01; +1.030193333750688e-01   -8.130781163961544e-03   +3.428359040682190e-02   -2.186802184277906e-02   +5.503422621885157e-02   +2.223218774797866e-01   +8.118300094826154e-02   +1.206120507167248e-01   +8.316938327017169e-02   +2.140147542095106e-01   +1.948295937322785e-01   +1.565722177515531e-02; +2.148530266227073e-02   +2.043007683492241e-01   +6.435952119533385e-02   +1.008942972941949e-01   +5.274763015791382e-03   +3.451681681959919e-02   -3.844070781441154e-02   -1.021700022916087e-02   +9.985064755655111e-02   +1.501182945815062e-01   +1.211578954961344e-01   +5.460438780237839e-02; +8.565651793074705e-02   +2.181743630479553e-01   +7.636186118790790e-02   +3.086394580174559e-02   -1.391361423936558e-02   +5.565312828635285e-02   +1.646263857233111e-01   +1.029961559224940e-01   +1.401437220071801e-01   +1.138830884007362e-01   +3.087922263361401e-02   +2.109085601650541e-01; +8.935492957528041e-02   +1.742058081564725e-01   +8.495217044708780e-02   +1.076872210124192e-01   +4.573670978692779e-02   -2.240662874170941e-02   +5.361402745273233e-02   -8.342729092072843e-03   -3.728130841029949e-02   -1.713208893956501e-02   +1.870187638565828e-01   +3.022224410487291e-02; -3.008183539346245e-02   +1.393894921261010e-01   +1.061713199346259e-01   +1.344357925342226e-01   +1.289904191989027e-01   +1.405122137868396e-01   +4.745682696570402e-02   +8.077058519633838e-02   +1.589752597231890e-01   +1.967960375930350e-01   +4.076586283592304e-02   +5.268639294293678e-02];
L2E_Input1_iAMPA_netcon = [+1.713469876065408e-01   +7.547287226108337e-02   +4.783399721493299e-02   +1.280455848563346e-01   +3.833320302951603e-02   +1.124430900614325e-01   -6.073900826381071e-02   +2.887804000475195e-02];
L2I_Input2_iAMPA_netcon = [+1.055382258709509e-01   +7.191402283402898e-02   +1.426186950236486e-01   +1.663627485754153e-02   +1.243008137573347e-01   +1.828712341411887e-01   +7.824309765842176e-02   +1.136186403751750e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
