function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.657885711226375e-01   +4.055928997347579e-01   +7.372911558263254e-02   +3.886267853379328e-01   +4.162032872249898e-01   +5.630338351590645e-02   +2.064714346004731e-01   +6.396995804478004e-01   +2.864482240061361e-01   +3.538774908554867e-01   +3.026702831408493e-01   +2.677841783629200e-01   +2.498921366723319e-01   -1.598875513596469e-01   -1.530874558998442e-01   +3.394202696919082e-01; +9.384190402445785e-01   +2.959869565148101e-01   +6.034176094124707e-01   +2.436340068529865e-01   +1.368952859840995e-01   +4.489059280924829e-02   +1.244452291117628e-01   +2.676821048312406e-01   +4.862925042967005e-01   +5.438718354363704e-01   +1.575071440314022e-01   +5.106432095713064e-01   +6.179154479923047e-01   +7.153969014756147e-01   +3.655975231233898e-01   +6.706962030146543e-02; +1.142511166186620e-01   +1.860094821614540e-01   +2.145892905807543e-01   +7.004920381814782e-02   +5.199305726978376e-01   +1.292308761523485e-01   +1.945021131187159e-01   +5.756278731607377e-01   +3.230511403179150e-01   +5.053580743961036e-01   +6.559029535882626e-01   +6.451392174083114e-01   +8.362181148791481e-01   +6.774580135077319e-01   +2.098256339888219e-01   +4.624786450412610e-01; +4.193203250670665e-01   -3.962404472496221e-02   +4.371152918705009e-01   +8.838226857062685e-01   +3.678224883707911e-01   +7.679139699525162e-01   +4.664348859271881e-01   +3.896983875699190e-01   +1.546416233900028e-01   +1.002775636599593e-01   +5.907587278221532e-01   +4.384292603116955e-01   -8.091003807454866e-02   +3.807505902751701e-01   +4.120585392683043e-01   +1.300092675334560e-01; +4.262651120501061e-01   +5.531115148109751e-01   +3.691710225978603e-01   +1.467586995904398e-01   +1.950656495046883e-01   +5.475591305929294e-01   -9.091752213123631e-02   +2.073277317484092e-01   +4.718185946229285e-01   +6.797227888388674e-01   +3.901042970830298e-01   +2.639945532521961e-01   +6.450294188172423e-01   +3.013591608846058e-01   +8.005017170371906e-01   -8.531929381990591e-02; +2.287935112168261e-01   +8.207321403790314e-02   +6.040330290909007e-01   +2.409071672076420e-01   +4.384085631783782e-01   +1.351801916639680e-01   +2.961842542855630e-01   +1.654623161050414e-01   +5.006584480383427e-02   -4.726351389090960e-02   +3.572018048195206e-01   +6.826535646179605e-01   +3.514270666336469e-01   +6.172605830592626e-01   +5.749928421907836e-01   +2.948986594595138e-01; +3.761683629748693e-02   +4.865775860867015e-01   +2.230045274871052e-01   +2.963642585620760e-01   +2.662847479127328e-02   +4.240621406538323e-01   +3.709181301430424e-01   +5.216367443672812e-01   +5.955479691141069e-01   +3.747658879311987e-01   +6.344669126537253e-01   +5.181639154033660e-01   +8.684889614893683e-02   -3.141876461014242e-03   +1.240198280644998e-01   +1.781210080144990e-01; +2.065040523470789e-01   +4.681545165134176e-01   -1.173797971267184e-01   +7.651446414616846e-01   +4.560181846863472e-01   +2.926935541978781e-01   +9.422022657680205e-02   +1.224125872168990e-01   +4.637560490443848e-01   +3.067512293387640e-01   +5.537604668734422e-01   +5.602554392683143e-01   +3.467303003628502e-01   +1.851239401771796e-01   +6.514708951723307e-01   -9.639047010050387e-03; +2.803250774692314e-01   +3.708254303583934e-01   +2.948238336349900e-02   -2.535741750221968e-01   -1.430918537232954e-01   +5.254518953012604e-01   +4.320356935174349e-01   +5.643287760733417e-02   +3.075810232985996e-01   +1.146888749570608e-01   +4.177019913151152e-01   +1.981574347051594e-01   +6.146479756557215e-01   +7.016471094425969e-01   -1.747075218671347e-01   +4.759895723446247e-01; +4.581776537928824e-01   +1.814112447393921e-01   +6.603202693355625e-01   +7.562911944982440e-01   +1.515547476594732e-01   +5.372017468823156e-01   +1.390721380324446e-01   +6.659584478119345e-01   +3.087087353086017e-01   +5.553366535602421e-01   +3.614958473743729e-02   +6.448514955023954e-01   +5.401426794307091e-01   +4.150969810489101e-01   +2.565220059647911e-01   +1.254454282093715e-01; +2.841242405565291e-01   +8.904207080169244e-01   +6.762131440303214e-01   +2.017734042078405e-01   +7.538752083080253e-01   +6.606999744363071e-01   +1.865462501309189e-01   +3.372836098290673e-01   -4.495233980049147e-02   +7.224320400147746e-01   -1.135732040366522e-01   +6.116765839511256e-01   +5.293970494353252e-01   +2.450169832108685e-01   +3.398368227418950e-01   -2.139952868514848e-01; +3.766119581635419e-02   +2.849548402947361e-01   +5.912131579565042e-01   +1.000000000000000e+00   +2.709258715646680e-01   +5.911498535007619e-01   +2.605082396425923e-01   +2.550958565446114e-01   +3.182200552713879e-01   -1.060797946936018e-02   +8.329229263003231e-01   +1.399615678524074e-01   +9.561511555995619e-02   +3.165366281668942e-02   +4.378098590668852e-01   +5.463771126740383e-01; +4.251403263135495e-01   +6.353699066672934e-01   +6.455063165295500e-01   +5.859291339469567e-01   +2.762945555842105e-01   +5.453519388101541e-01   +5.513518848064175e-01   +3.634673070574748e-01   +2.970244626904585e-01   +4.815396910374251e-01   +4.583546041363242e-01   +4.996160116182833e-01   +2.220065542452545e-01   +4.206832634239401e-01   +7.493892116345529e-01   +3.653005686167103e-01; +4.549143941266374e-01   +9.030980245294602e-01   +2.799732864086398e-01   +5.334870105054125e-01   +5.155238998991446e-01   -1.215469516517347e-01   +4.897792215424585e-01   -1.586069636426488e-01   +3.713338173918946e-01   +4.414516222049936e-01   +1.053765863205269e-01   -1.140183760346356e-01   +4.893041095601327e-01   +4.503424323422365e-01   +2.333674465631304e-01   +5.782313576427847e-01; +6.201846636452677e-01   +3.698683355489022e-01   +5.685237595603714e-01   +1.366388656845149e-02   +1.564527426206282e-01   +5.033766692174680e-01   +3.537589750634334e-01   +3.134454387559703e-01   +1.931273613303266e-01   +3.515511277748000e-01   +4.351935304425085e-01   -7.543799000510241e-02   +5.976528016749139e-01   +4.123457939275721e-01   +5.636062457650834e-01   +4.789743414154079e-01; -2.601035510047174e-02   -1.108580314663191e-01   +1.908538512547935e-01   +2.859726645769439e-01   +4.761247838150965e-01   +4.928470450398919e-01   +4.335000104428740e-01   +5.474573632207208e-01   +2.409620632243343e-01   +1.740914502107602e-01   +2.537168129402385e-01   +5.742106038896300e-01   +6.601091635113684e-01   +6.028560834759705e-01   +2.288193237972063e-01   +1.315311313805623e-01];
L1E_L1I_iGABA_netcon = [+4.477161833258104e-01   +5.362250704336021e-01   +4.206979836842550e-01   +3.342611627377758e-01   +4.152561327261621e-01   +6.053645382394681e-02   +1.993844020376462e-01   +4.671456266342474e-01   +2.864682393409637e-02   +3.369964458976187e-01   +1.211597782563094e-01   +5.701652296214114e-01   +3.787510312720367e-01   +4.316545464700525e-01   +4.419322681688432e-02   +7.374779141960967e-01; -3.874314348574497e-02   +1.279048881650770e-01   +5.180975922344259e-01   +9.353591570190957e-02   +4.393406484059415e-01   +5.125564064814728e-01   +7.415588004314826e-01   +5.556576260674674e-01   +3.662946300114835e-01   +2.619985929181755e-01   +3.414210721468341e-01   +5.937001603723961e-01   -1.086619746249496e-01   +7.730243743449837e-01   +3.661431161717806e-01   +4.715819005958165e-01; -2.393346270129409e-01   +7.784177067426983e-02   +1.839226971902777e-01   +5.702372032060380e-01   +2.485312427750915e-01   +4.102574334496674e-01   +4.247713982883305e-01   +3.985970552962081e-01   +5.982328079071572e-01   +1.795121364030431e-01   +5.058043636704674e-01   +1.759228633148890e-01   +8.643829826474705e-01   +3.840850241587171e-01   +7.057990088373918e-01   +8.727730299812156e-01; +4.607937512606818e-02   +5.754895861478070e-01   +7.220299375859055e-01   +3.290205993178614e-01   +2.495221659367231e-01   +3.476626323655503e-01   +1.762580742158681e-02   +2.501695301196503e-01   +3.525769634979291e-01   +2.489478653670319e-01   +5.857015375125765e-01   +3.321789570160462e-01   -2.163462029795797e-01   +5.336330590327965e-01   -7.797429054416302e-02   +1.587505080762185e-01; +4.068769479721552e-01   +2.583136008791884e-01   +1.885153758720033e-01   +5.810098722036913e-01   +7.491848424762646e-01   +5.765666046589256e-01   -7.804297266678746e-02   +2.253801419471041e-01   +2.678003462407498e-01   +3.703672190496236e-01   +6.158697464600241e-01   -1.055906162828993e-01   +4.245456329790859e-01   +5.799125571130556e-01   +3.061160695821167e-01   +5.568004586526181e-01; +1.342133351452497e-01   -5.448266262835508e-02   +5.466254199207106e-01   +1.723742302172329e-01   -2.130534461064499e-01   +8.096485668909882e-02   +6.182100799956225e-01   +2.475279483614397e-01   +4.304511890051779e-01   +4.705662024781913e-01   +4.405837737920678e-01   +4.063389203365080e-01   +1.123678513002553e-01   +1.451707055224019e-01   -1.670490359329807e-01   +7.485071387449492e-01; +1.835047633271820e-01   +1.619379563760072e-01   +3.885476343245445e-01   +5.517434078903778e-01   +5.451447335571726e-01   +1.552883810911650e-01   +2.025074717308568e-01   +1.673287726676074e-01   +6.933787127233597e-01   +2.158617695721922e-01   +1.762352890671589e-02   +1.345055440593848e-01   +6.235703433709157e-01   +4.864103955306827e-01   +5.875634287654630e-01   -1.541544576188692e-01; +4.396731022574938e-01   +3.869997804289175e-01   +2.701497884949826e-01   +1.952360859740678e-01   +1.749117220685216e-01   +2.917799425495450e-01   +3.780180846754307e-01   +5.108703741128654e-01   +1.243934495230834e-01   +6.102486902720866e-01   +8.533463949020845e-01   +5.086634545528048e-01   +5.153581532586313e-01   -3.257261051788869e-01   +4.968647214509960e-01   +5.794027103042870e-01; +4.100138512707703e-01   +6.044559960592608e-01   +5.651962824883773e-01   +2.936566676481058e-01   +8.828289492878599e-02   +5.716058415371165e-01   +3.061637098791865e-01   +1.927223604007390e-01   +8.484363827068109e-01   +1.141272384793662e-02   +4.720612244423149e-01   +2.792813448634836e-01   +5.014097198218451e-01   +5.023740416521193e-01   +3.065875206509339e-02   +4.533910004279053e-01; +5.552756801993251e-01   +2.404283667262495e-01   +7.340003787504393e-01   +4.956377074373586e-01   +3.017409173215713e-01   +5.424324123133101e-01   +2.269512458820732e-01   +5.464695660516341e-01   +5.135019349450054e-01   +3.180044484732363e-02   +3.656825348248178e-01   +2.626593161645570e-01   +5.532895271713071e-01   -1.581282371528741e-02   -6.144738078555073e-02   +2.688512682494513e-01; +8.221234005175572e-02   -1.068506916656022e-01   +6.446469482949927e-01   +5.002989761544448e-02   +1.643039987431238e-01   +3.061505566205130e-01   -3.440024014031304e-02   +1.902818105759224e-01   +7.606186429818289e-02   -4.992076501436295e-02   +3.574013846641512e-01   +1.711964521249169e-01   +6.961328271373096e-01   +6.364750219779688e-01   +1.765118731087106e-01   +6.479763618896354e-01; -1.815844402567138e-02   +9.303693988492231e-01   +7.026230945006726e-01   +7.677064934361906e-01   +6.927649557258917e-01   -1.427085221074858e-01   +1.554078880703363e-01   +1.917680892306862e-01   +5.254051891152322e-01   +7.526041587511448e-01   +6.100759303681736e-01   +7.821456939552074e-01   +5.348153298642182e-02   +6.759656413159862e-01   +2.980624481787495e-01   +1.462589376009706e-01; +4.923930648817884e-01   +5.317892138662998e-01   +6.629790053200953e-01   +6.608779281604926e-02   +7.163776968452522e-01   +3.227564269330181e-01   +6.228516331249019e-01   +6.203099331331460e-01   -1.441263981195068e-01   +1.512380323302944e-01   -1.083779767472280e-02   +4.036156753119117e-01   +4.833401850641010e-01   +2.707819757466496e-01   +2.976489712490583e-01   -1.008975040580165e-02; +2.824127660203796e-01   +1.503383425882309e-01   +4.127818622388720e-01   +1.132188025789232e-01   +2.149773053930572e-01   +5.784406753233899e-01   +4.765615677022568e-01   +4.711705032387689e-01   +2.235161254613245e-01   +9.389521672623213e-01   +4.720795438263559e-01   -3.988991637522412e-02   +5.539257744492188e-01   +1.762871530657972e-01   +2.150868411325604e-01   +6.909511031708182e-01; +5.362487169672636e-01   +5.941173362046297e-01   +9.143032847613066e-01   +8.165562589539008e-01   +2.095313664270640e-01   +3.845794260663203e-01   +2.802769417347215e-01   +4.386277731278124e-01   +4.699512758783528e-01   +2.437998245524306e-01   +6.360576562098890e-01   +2.101885270005553e-01   +4.311890690741658e-01   +6.304828537908338e-01   +2.723910520064196e-01   +7.983822442467572e-01; +6.913526450240051e-01   +3.523358143263752e-01   +6.720023578017070e-01   -6.799388038521108e-02   +3.315189568628650e-01   +5.640034650374608e-01   +1.034567269978720e-01   +3.221313366344075e-01   +4.279227025377975e-01   +6.660233656364731e-01   +4.703531748432692e-01   +2.449455517942454e-01   +4.394137584833172e-01   +2.747274952160035e-01   +6.358895762775993e-01   +1.208955245803973e-02];
L2I_L1I_iGABA_netcon = [+2.945678671302144e-01   +6.014116745707861e-01   +5.997191826880414e-01   +1.000000000000000e+00   -1.834145111142832e-02   +3.356854395082828e-01   +6.882059028093712e-02   +1.432086268152958e-02; -4.781493965617796e-02   +2.367164482227402e-01   +4.223490733227988e-01   +5.692205062725009e-01   +3.791720354367020e-01   +7.830813437410529e-02   +1.893079290454822e-01   +2.345249278382453e-01; +1.139942654278970e-01   -1.243392955211457e-01   +5.648915856586830e-01   +5.806948723985912e-01   +3.840268261858506e-01   +6.986951431004400e-02   +2.570575036569682e-01   +6.851562570612442e-01; -2.036651628287981e-01   +4.365382459095770e-01   +2.170977071538606e-01   +4.747220658881752e-01   +3.770116621270478e-01   +3.176404707832510e-01   -2.655665204478959e-03   +3.821213901559797e-01; +6.651951122394703e-01   +4.878696897723364e-01   +3.660225137722401e-01   +3.582717612981328e-01   +2.839951112325174e-01   +6.758570044364696e-01   -2.456789145832400e-01   +6.316843764091901e-01; +1.901393487369251e-01   +2.450176171903118e-01   +3.721409719051236e-01   +7.070835651174662e-01   +4.619983359301425e-01   +3.849586449054190e-01   +5.852078364567598e-01   +3.375434506333989e-01; +1.141058826102632e-01   +3.413321314752391e-01   +6.395616866271728e-01   +9.126314586780117e-01   +2.694767263464981e-01   +5.265927150854255e-01   +2.014884693837306e-01   +2.835117620184096e-01; +6.413385698161479e-01   -2.229532561813081e-02   +5.011529469354881e-01   +1.015587667424021e-01   +5.347699168618656e-01   -3.475834440146029e-02   +3.801155016451887e-01   +6.172504890337511e-01; +5.234262909475597e-02   +2.433550419184678e-01   +3.202693712632686e-01   +3.532875557518221e-01   +8.273223740253530e-01   +4.233536815181494e-02   +3.300870585114680e-01   +2.538931393123826e-01; -3.963840160888919e-02   +6.977930992132040e-01   +4.691725185343592e-01   +1.157130003779883e-02   +3.883662254981252e-01   +3.700540045337202e-01   +6.527006296894970e-01   +4.934284007808198e-01; +4.119567588338156e-01   +1.971303278294371e-01   +2.422669349125451e-01   +3.312706836598268e-01   +6.570235674701592e-01   +3.094735108482481e-01   +3.364107303925733e-02   +6.254350989980287e-01; +4.349991882290660e-01   +4.233652094685063e-01   +7.697199221743125e-01   +1.774697285918445e-01   +4.426788436976990e-01   +1.268664407468881e-01   +4.029934911986814e-01   +8.525781522177873e-01; +3.414241787775347e-01   +1.092840212129197e-01   +4.501764504999209e-01   +6.263891965346569e-01   +2.024120607040758e-01   +6.475565915105150e-01   -2.033898808713009e-01   +5.259385561797956e-01; -3.132117479778255e-02   +5.621337571193815e-01   +5.807786431179556e-01   +5.096148083822217e-01   +3.157749791945872e-01   -4.440250375003157e-02   +1.834523331885888e-01   +4.098562396081404e-01; +1.532483579211944e-01   +4.069978948720642e-01   +4.412124928162354e-01   +2.427523297071451e-01   -1.110871386923138e-01   +5.999598431715215e-01   +6.236192285405395e-01   +5.895887747545967e-01; -1.141323937432431e-01   +1.944356377159512e-01   +3.300877255494755e-01   +7.421511070323101e-01   +8.345313047170652e-02   -1.225486645889137e-01   +8.778503816018306e-02   +3.848510032272846e-01];
L1I_L2I_iGABA_netcon = [-2.564535865873398e-02   +2.154641789070462e-01   +4.778499153433709e-01   +3.330139102074579e-01   +7.434433742593448e-01   +4.119118642109077e-01   +6.425111890005650e-01   +6.658233438192807e-01   +4.574660956543361e-02   +3.968453958045211e-01   +5.485386762242768e-01   +4.396069328416733e-01   +7.478560733045467e-01   +2.805672401133008e-01   +9.733547216946797e-02   +5.045259121379215e-01; +3.258927223167559e-01   +4.354110837785679e-01   +4.476778899072655e-01   +7.126816773868906e-01   -1.703135213638426e-01   +7.858450963716776e-02   +2.519298977187046e-01   +3.100180239116221e-01   +9.678722764421725e-02   +1.017410510926088e-01   +6.583824051758936e-01   +3.327021289697989e-01   +7.581443244245387e-01   +6.579178336201796e-01   +6.975882625550952e-01   +6.404940073242676e-01; +2.439805608988245e-02   +4.801287264120978e-01   +5.107227865155851e-01   +5.084325450257887e-01   +5.340241597316826e-01   +5.223038224871684e-01   +4.558560532481336e-01   +3.177961712472179e-01   +2.677812880285224e-01   +6.145762626286897e-01   +5.041742529264074e-01   +4.159339472163443e-01   +3.097941762534912e-01   +6.154203178698139e-01   +1.676345782845577e-01   +3.561135528235088e-02; +4.227176936984888e-01   +8.090487901699188e-01   +4.185299941654963e-01   +2.235885983368634e-01   +2.772337677765730e-01   +1.660607552766745e-01   +4.700822670803569e-01   -3.795116462313285e-03   +4.178462744708996e-01   +4.422663302232003e-01   +4.319987581042315e-01   +7.814563778684300e-01   +9.430848029953204e-02   +7.807879711990993e-01   +5.241797785151890e-01   +7.315693780344319e-01; +4.398772699231384e-01   +6.832752580824026e-01   +8.739446554930818e-01   +1.340527327829604e-01   +5.318235453894695e-01   +3.034997768880797e-01   +4.326425449765739e-01   +3.075548745595528e-01   +9.664715038285220e-03   +6.907622956335703e-01   -9.150689856371749e-02   +5.281650755074830e-01   -2.889161691497877e-01   +1.643898006512625e-03   +2.721737410394250e-02   +6.520362913089253e-01; -3.309136824658408e-02   +2.552195651940226e-01   +3.017222278404802e-01   +4.362358090852068e-01   +7.232701422222799e-01   +9.824293942792751e-02   +4.010526419526355e-01   +3.344912547804083e-01   +2.074421112119895e-01   +7.375108994244522e-01   +2.244607981001157e-01   +2.492771264074598e-01   +6.242358108273542e-01   +1.506099053733942e-01   +3.728576970051811e-01   +4.995765599918574e-01; +4.541648335879672e-01   +7.839160842160477e-01   +5.132116588478243e-01   +9.149815552039665e-01   +1.253356407298056e-02   +1.000000000000000e+00   -4.282138269353452e-02   +3.906066748406478e-01   +2.717888061007186e-01   -1.615747298410633e-01   +7.267030027953167e-01   +8.039321664336805e-01   +3.595657005784202e-01   +4.426622508810421e-01   +4.646527622111621e-01   +5.102880184419606e-01; +2.484834453094915e-01   +7.402994083642942e-01   +4.107472936921432e-01   +5.409297724780529e-01   -1.149312230923981e-01   +1.851811870173715e-01   +3.582995107267113e-01   +2.844512332805365e-01   +6.460999201790323e-01   +3.030719137080377e-01   +2.345133116424425e-01   +2.389468166441480e-01   +2.883950727690407e-01   +7.367602921771994e-01   +4.543769525349236e-01   +4.231199325069573e-01];
L2E_L1E_iAMPA_netcon = [+6.793431411106404e-01   -2.057632719274660e-01   +1.831842299197397e-02   +6.100929386115110e-01   +4.043391764611244e-01   +5.142464749014451e-01   +1.959763445139364e-01   +5.018272459458657e-01; +2.938713746816762e-01   +4.217379163301674e-01   +3.246019791759833e-01   +9.437860585370490e-01   +2.833690015853495e-01   -1.052637795597898e-01   +3.148936762435253e-01   +2.725836109379879e-01; +3.421031042058001e-01   +2.676509730999160e-01   +4.174311253226290e-01   +5.815263305818905e-01   +6.543173127345556e-02   +7.303921357754485e-02   +2.853370273508042e-02   +4.772449259780480e-01; +9.289249079853897e-02   +3.173903371942074e-01   +4.701001330489266e-01   -1.508341336828261e-01   +4.787971025752451e-01   +3.808604228595590e-01   -9.782342311731448e-04   +2.548854319782858e-01; +1.405349450331368e-01   +2.507238210989647e-01   +4.819041840206008e-02   +8.165896297307597e-01   +5.695325171297134e-01   +5.129354673468887e-01   +1.810323145769424e-01   +5.956200801280599e-01; +4.714586128117536e-01   +5.580161004747324e-01   +6.107337476223818e-02   +5.599861723377976e-01   +1.086452203429280e-01   +4.307119492846942e-01   +4.350899629030420e-02   +3.627320267342615e-02; +7.470499742843874e-01   +1.436973729224774e-01   +3.771507851509978e-02   +5.247202772042140e-01   +2.968879659802500e-01   +1.959742905602827e-01   +2.031687913041045e-01   +4.113915825894576e-01; +2.024183625978437e-01   +3.664809188885838e-01   +3.961336459727529e-01   +1.651797038109916e-01   +6.904822183825157e-02   +6.378282523593175e-03   -9.741959763197913e-02   +1.274668041185187e-01; +7.006839124434890e-01   +4.278027639451161e-01   +3.829499204260517e-01   +2.431037409097027e-01   +2.953084253788095e-01   +3.730489003741342e-01   +1.068929431369911e-02   +5.391571909270864e-01; -1.202675509657648e-02   +3.327900593637095e-01   +3.435372823743623e-01   +7.676424553778424e-02   +3.730444982548061e-01   +3.506163768807791e-01   +4.951982268429457e-01   -3.080608896186802e-03; +2.100458948375478e-01   +4.885399727931258e-01   +8.710314893549732e-01   +1.457223600702187e-01   +6.120741948422607e-01   -4.720680113363143e-02   +8.654643475872769e-01   +4.420138443109473e-01; +8.420553531521797e-01   +3.380299886890894e-01   +3.196304443158284e-01   +3.858763977079722e-01   +5.694672165932751e-02   +3.577776669261107e-01   +2.625972585392033e-01   +5.234718274413548e-01; +3.961374724610158e-01   +4.256183304524314e-01   +1.805974654711699e-01   +7.210545254373818e-01   +5.340468519287699e-01   +3.890966637477514e-02   +1.158801047051608e-01   +3.885095913016761e-01; +1.935346724403322e-01   +4.101486363039444e-01   +3.091475726819296e-01   +3.009364396581224e-01   -1.764222275845599e-02   +6.308406135896186e-01   +1.000000000000000e+00   +4.283688916795252e-01; +2.943895166517537e-01   +2.338797177387226e-01   +5.019576986290832e-01   +7.793091665505180e-01   +3.469297875604954e-01   +1.781936393133878e-01   +4.369359581588798e-01   +4.919896033152345e-01; +2.067298650579395e-01   +4.863746744761678e-01   -1.121072618757091e-02   +3.814434575940180e-01   +2.563572558894069e-02   -2.622323461406250e-02   +4.029502942460844e-01   -1.546019766967172e-01];
L1E_L2E_iAMPA_netcon = [+1.993027765592947e-01   -4.396131174958911e-02   +5.976187909709879e-01   +5.837292319104717e-01   +7.493148214083524e-01   +3.951191124291792e-01   +6.178458497108000e-01   +1.656561918234372e-01   +3.727276267339660e-01   +7.402817232522092e-01   +2.678410516904509e-01   +3.333644781271862e-01   +6.435897029063153e-01   +5.336262108286145e-01   +3.309854286685008e-01   +5.204277317205563e-01; +4.124754152284973e-01   +6.500784572315091e-01   +9.985560835244864e-02   +1.939679504185984e-01   +3.794813145215614e-01   +5.302594361961854e-01   +1.100254214634994e-02   +5.042072227115565e-01   +4.893111501161005e-01   +4.802781862070544e-01   +4.118502096707918e-01   +3.165451634431900e-01   +4.980598750831836e-01   +4.396090965629830e-02   +6.849136383625819e-01   -1.734847378808852e-01; +5.243135783833712e-01   +4.932390070311997e-01   +8.035563105787281e-01   -9.817127475425494e-02   +3.522380765291687e-01   +3.272097539568100e-02   +3.321387380557507e-01   +5.354217082927195e-01   +2.963203375687909e-01   +4.308441414493059e-01   +6.471947088754367e-01   +8.672781109949467e-01   +7.605729716951548e-01   +2.490003871725693e-01   +6.437895419887942e-01   +9.148800728025511e-01; +4.823760904198049e-01   +6.327857526525621e-01   -1.031220543896632e-01   +2.622750037686778e-02   +3.191249627847428e-01   +5.679495325575319e-01   +4.448689733756244e-01   -1.370216602022661e-01   +9.712668798438466e-01   +2.968086503674098e-01   +3.035422260254665e-01   +3.659653678751679e-02   +4.432476258588234e-01   +6.542639716776910e-01   +1.683757089563853e-01   -8.269162097738091e-02; +5.549498113361664e-01   +4.643060396552184e-01   +2.775406012800748e-01   +1.729945352635450e-01   +2.250968980197853e-01   +1.933972720987381e-01   +7.207094982361748e-01   +8.275399157320750e-01   -1.200307704019310e-01   +3.369082094794981e-01   +1.210935798025409e-01   +7.685259798139005e-02   -4.036284159772859e-02   +2.021029838318335e-01   +6.003514372071085e-01   +2.189199421816244e-01; +5.454318511661175e-01   +5.621373043902771e-01   +5.508108833796228e-01   +9.833787964120378e-01   -2.340054624246675e-01   +3.023158854614870e-01   +9.947675285834545e-02   +3.494850296753650e-01   +2.760277305858804e-01   +3.163780127930708e-02   +2.754433942773078e-01   +2.177661663898739e-01   +9.438944694402842e-01   +1.183732627499005e-01   +2.851947637997608e-01   +7.218131040280140e-01; +3.050422913982851e-01   +1.284943920774972e-01   +6.910046638951763e-02   -5.100925111034767e-02   +3.496271421356742e-01   +1.943181418208330e-01   +2.559221189895199e-01   +8.029316753476978e-01   +5.595390947857956e-01   +9.539643972447942e-02   +5.451754739365013e-01   +3.698813644958217e-02   +1.401898343210138e-01   +5.917184528776585e-02   -2.425932030994923e-01   +1.581220190462052e-01; +5.118521341476261e-01   -2.114467058947458e-02   +7.736520668654191e-01   -3.338795295214440e-02   +5.974806871802038e-01   +8.490844102663520e-01   +2.545469271573703e-01   +6.241810496831204e-02   +4.284725173053861e-01   +5.014558210618261e-01   +5.048619320084560e-01   +1.446174455258730e-01   +5.752721443827852e-02   +8.963987703040558e-01   +7.657558751726732e-01   +3.706379784245497e-01];
L2I_L2E_iAMPA_netcon = [+1.540984511757184e-02   +4.168852777043469e-01   +3.470960798291400e-01   +3.106674190023393e-01   +9.414598379993533e-01   +4.922070168252835e-01   +2.551709550563938e-01   +6.170523971081115e-01; +3.577476913331620e-01   +2.016018294912442e-01   -7.810139573594908e-03   +4.199646817827600e-01   +3.006188111494708e-01   +3.184923820847135e-01   +1.795685148580294e-01   +7.733898578459321e-01; +1.926536932559238e-01   +5.938911190070227e-01   -2.141075642024109e-01   -7.432012071322600e-02   +7.635519379011177e-01   -2.214480725022654e-01   -1.898026286523416e-01   +4.347645969652425e-01; +6.174274907874525e-01   +7.509434408084218e-01   +2.038339548827142e-01   +8.995844477062378e-01   +6.701415592394040e-01   +5.262966766576732e-01   +1.750008491431271e-01   -1.797753923018729e-01; -8.797341953697012e-02   +3.846122757845929e-01   +1.561086935590157e-01   +6.666200401896930e-01   +8.435547193641211e-01   +4.925696688171380e-01   +5.152350367720020e-01   +1.648927146666740e-01; +9.891224300212520e-01   +2.134023756956763e-01   +1.005257165854757e-01   +1.232437532013400e-01   +8.114938343059989e-02   +9.252320476716698e-01   +1.275356698307687e-01   +2.333857326773757e-04; +3.177646448572535e-01   +7.350904147645906e-01   +7.291886777519618e-01   +7.745813051756794e-01   +6.059766685959819e-01   -2.678399381056259e-01   +8.668990537740300e-02   +2.993543419351767e-02; +1.000000000000000e+00   +6.269840816088028e-01   -6.287700804687220e-02   +4.641799320294348e-02   +5.854031882512366e-01   +3.059114180785399e-01   +4.941744163226278e-01   +3.965862516974647e-01];
L2E_L2I_iGABA_netcon = [-4.969773018128771e-02   +2.929619430665232e-01   +2.135749164534350e-01   -9.344419409190427e-02   +7.654465785151183e-01   +7.382393452584570e-01   +3.660143909897727e-01   +4.268293394759736e-01; +7.860685978453419e-01   +7.286945156668758e-01   +1.056412897205211e-01   +1.301890511809364e-01   -1.684677502633697e-01   +9.320967565413294e-01   +5.290582296277360e-01   +4.218582717855244e-01; +9.108719250414424e-01   -2.655901162070465e-02   +8.343515774223786e-01   +1.489261257415479e-01   +8.172667773961163e-01   +9.192804823982066e-01   +9.526540292812382e-01   +3.074155273851210e-01; +1.084624674087564e-01   +6.632346987237456e-02   +8.433726344502679e-01   +6.813244871860134e-01   +6.213618068678192e-01   +7.223474089433428e-01   +4.100065980956592e-02   +6.302178622331788e-01; -6.144742656303785e-02   +6.122422584389668e-01   +8.077131084372760e-01   +1.299022341452742e-01   +4.190534818519894e-01   +1.268453192889827e-01   +7.577114446553924e-01   +1.567408172408432e-01; +7.392004888917001e-03   +6.523300856227559e-01   +5.792307430973618e-01   +3.639782102384005e-01   +2.535761041758400e-01   +1.000000000000000e+00   +2.733962559347502e-02   -1.743575871140314e-02; +7.831935875312789e-02   +7.242142489263756e-01   +4.410577454650679e-02   +9.787501419238811e-01   +2.254341005143496e-01   +7.952968852804174e-01   +6.478901997800400e-01   +5.351724669576642e-01; +1.374334030695090e-01   +2.807622206140000e-02   +6.619980742083603e-01   +6.032218354368841e-01   +5.440568276129039e-01   +2.977673383421381e-01   +5.468269465374412e-01   +7.044399521283036e-01];
L3E_L2E_iAMPA_netcon = [+2.685620045674723e-01   +9.698870250352355e-01   -1.010293489917564e-02   -6.651906665385038e-02   +7.514784094214843e-01   +3.523287364638000e-01   -2.589444308396584e-02   +7.190315719230118e-01   +5.456403537681216e-01   +3.037758726576445e-02   +3.080142231699459e-01   +6.178376810063153e-01; +3.106953213552927e-01   +2.442744322173103e-01   +3.040095442701057e-01   +2.239550815328033e-01   +2.733198058182159e-01   +3.935372777490769e-01   +2.841994553286751e-01   +5.553885452189988e-01   +3.049310809245220e-01   +3.280786694748029e-01   -1.188073849144237e-02   +7.645687643124075e-01; +4.108402022347551e-01   +5.805766624847070e-01   +4.286460602703746e-01   +4.605293717928075e-01   +6.019167122401926e-01   +2.945697019173490e-01   +5.958243498242638e-01   +1.771819737923942e-01   +5.414316706459635e-01   +4.035938142371361e-01   +2.112456599236938e-01   +3.751911890357399e-02; +7.516226339098024e-01   +1.678102122417523e-01   +8.388579891451259e-01   +3.607329425347199e-01   +6.593226784391328e-01   +3.332561076504567e-01   +1.058541910132744e-01   +2.609553311338600e-01   +3.538844690300412e-01   +4.499662134362971e-01   +4.146404558375916e-01   +6.540586892947676e-01; +3.130380381815798e-01   +1.348288627437856e-01   +4.686682655504872e-01   +3.507293687547572e-01   -7.220237664549420e-03   +4.677075382254563e-01   -8.447119068361258e-02   +5.665534592658290e-01   -3.357445365815684e-02   +8.354080833057953e-01   +9.348376880874337e-03   +6.076143689256933e-01; +1.149117674819612e-01   +3.991286385821091e-01   +1.043684311690239e-01   +1.504238144633143e-01   -1.108765223215006e-01   +3.682241612263378e-01   +1.694615118465892e-01   +7.647011911722398e-01   +5.298590308407748e-01   +7.590359978257130e-01   +6.628832804245170e-02   +4.169576129035030e-01; +2.832703663790853e-01   +4.476388772749681e-01   +1.820230772619257e-01   +8.967938174204453e-01   +2.568082577154111e-01   +5.429493944738633e-01   +6.226831713431009e-01   -2.085758187499376e-01   +1.630875435420814e-01   +6.638235356925217e-01   -2.421211083446949e-01   +2.717771602745315e-01; +8.181515667155674e-02   +2.454730386022918e-01   +7.927111082807849e-02   +5.544026844132165e-01   +1.972510787346010e-02   +2.567520152070040e-01   +2.009207109730795e-01   +2.802760165607455e-01   +2.339169822341510e-01   +6.637502521158058e-01   +6.496578319176809e-01   +2.068532054674765e-02];
L3I_L2I_iGABA_netcon = [+8.193097227477839e-01   +5.820127153127266e-01   +5.472794457784957e-01   +2.945020937779064e-01   +4.193387000454535e-01   +9.475135095927795e-01   +4.705677052664478e-01   +2.617679431700194e-01   +6.045374696025630e-01   -1.969250853425833e-01   +5.038758715253188e-01   +7.258362224018189e-01; +6.441831233999925e-01   +3.490509972098901e-01   -8.528667217606017e-02   +8.258458184628762e-01   +6.527136615512649e-01   -1.969202684076083e-01   -1.954163299131989e-01   +3.563485306190087e-01   +3.787154677644497e-01   -1.094212552289769e-01   -2.950540341844569e-01   +4.828371000133452e-01; +2.617692733034975e-01   +1.861011282032682e-01   +2.318298888181625e-01   +1.656060901185424e-02   +4.123470481843874e-01   +2.027374807909119e-01   +5.727523753416164e-01   +5.878670559915958e-01   +2.898855079755650e-01   +5.030991032350824e-01   +5.965231059970738e-01   +4.539923140173915e-01; +7.445258689832472e-01   +1.937353214211941e-01   +5.430380189557955e-01   +6.240149662913634e-01   -2.478769855077667e-03   +7.150156250759814e-01   +6.390964543429904e-01   +8.763925840281723e-01   +5.803930386019941e-01   +7.339847181168244e-01   +6.644824285971039e-01   +7.481510333259311e-01; -1.089979955032217e-01   +4.515977814590611e-01   -7.645924417074956e-02   +5.756853429613515e-01   +4.056611646256959e-01   +3.368378950416329e-01   +2.727331842523317e-02   +2.815584894801078e-01   +4.625457093102742e-01   +5.223105836797041e-01   +6.253045139343868e-01   +1.250691900989061e-02; +2.552437178650411e-01   -1.411279948996755e-01   +1.260310632427828e-01   +6.996206443212223e-01   +8.596173592830912e-01   +9.630384911326805e-01   +6.607561110179146e-01   -1.015660036034447e-01   +1.319224681471855e-01   +7.074580396195256e-01   +2.172096749196101e-01   +3.107597396574241e-01; +4.338563345963655e-01   +2.939833171765215e-01   +2.927426217769253e-01   +2.701161355376555e-01   +6.077004052851048e-01   +5.353529800534080e-01   +9.841071879454663e-02   +3.216414132919510e-03   +8.248228659259884e-01   +1.976913293371562e-01   +5.995217807595057e-01   +7.843577942803852e-01; +4.309164381395947e-01   +5.332304322261712e-01   +3.106983212168823e-01   +3.735721915787665e-01   +4.920768576513442e-01   +5.393619359071782e-01   +7.087961869897043e-01   +5.848947049391847e-01   +5.797312403318249e-01   +1.983355488648305e-01   +4.524989575522215e-01   -4.447269601475271e-01];
L2E_L3E_iAMPA_netcon = [+8.111697616504542e-01   -3.294286887077267e-01   +2.698249103048803e-01   +1.700591648511218e-03   +5.896346169220199e-01   +6.148831951235179e-01   +5.036158374373395e-01   +3.155674348414915e-01; +2.331143704848016e-01   +6.403486127552601e-01   +1.607226122682706e-02   +5.070223713508005e-01   +3.174009872583591e-01   +2.215970071905725e-01   -2.543394285595849e-02   +3.278833014175068e-01; +3.568474549389658e-01   +6.408612830280899e-01   +4.611639777444861e-01   +8.333546886530019e-01   +6.080355410043470e-01   +7.873499837043493e-01   +4.771011554804006e-01   +1.572795089544086e-01; +5.199605479926258e-01   +4.363864886521688e-01   +8.402563167602145e-01   +5.643399328766345e-01   +7.640509672894994e-01   +3.963768834208098e-03   +4.074300375374659e-01   +3.641939684998539e-01; +9.649993508548504e-01   +8.773218360446285e-01   +3.356453802215622e-01   +1.355644482807948e-01   +7.389946571473309e-02   +8.515832925482978e-01   -1.479092095870449e-01   +6.561969476841080e-01; +6.490779441227695e-01   +4.216068263676387e-01   +7.413594042166812e-01   +2.859548605256066e-01   +8.787172067311786e-01   +7.102936013672142e-01   +8.885332235060239e-02   +9.254497696567706e-01; +7.508618427770968e-01   +2.113500576095891e-01   +1.368267880366386e-01   +5.456985590689087e-01   +5.953984270503632e-01   +2.360566057961574e-01   +3.212090697758127e-01   +5.191939061581714e-01; +2.262379826160949e-01   +2.927347696713737e-01   +2.955890056695004e-01   +1.838076115138537e-01   +3.832311538178824e-01   -1.783838135453009e-01   +4.061048684826276e-01   +8.317575758623319e-01; +5.474385659644855e-01   +5.088374787874747e-01   +6.620213298566032e-01   +3.944424796894443e-01   -5.558985646834665e-02   +8.055151143996732e-01   +3.931734078671084e-01   +2.970901981650182e-01; +7.641864277069993e-02   +1.245442423151364e-01   +5.581697437264339e-01   +3.444537591236793e-01   +3.330102784015636e-01   +9.771262915670708e-01   +8.212525224134600e-01   +5.001296612395423e-01; +5.908201867447727e-01   -2.078457179622232e-01   +7.539107851576576e-01   +1.019970567312546e-01   +3.457834890198204e-01   +3.164405337905835e-01   +1.755181191108390e-01   +5.186778119084857e-01; +1.795897587449531e-01   +1.604095263478451e-01   +2.716528983435684e-01   +7.992555220202978e-02   +6.232607631532373e-01   +2.131031497518202e-01   +9.476211017955743e-01   +6.342354893444161e-01];
L2I_L3I_iGABA_netcon = [+3.650279955539286e-01   +2.594249963817321e-01   +6.235413574366493e-01   +6.120206894804596e-01   +3.794625172655532e-01   -1.272094918477868e-01   +4.497404761836584e-01   +5.783783843031688e-01; +2.668973088943212e-01   +4.231184906369925e-01   +5.647653469701460e-01   +8.796485615964869e-01   +2.640374490014779e-01   +7.285793962112507e-01   -1.362018122434596e-01   +6.345318462896273e-01; +1.391552472244616e-01   +8.627715816765172e-01   +5.913035430417556e-01   +3.080000704822672e-01   -8.072583171248879e-02   +2.347280409671104e-01   +5.644968575364699e-01   +1.268642822056810e-01; +3.059212513103621e-01   -3.150761694600386e-01   +5.077319181162722e-01   +1.424190860595902e-01   +1.908772395896206e-01   +2.763991637826722e-01   +4.642461745155335e-01   +6.621261201504177e-01; +5.165033151662387e-01   +5.303274692749718e-01   +3.218520937848932e-01   +3.228962590657858e-01   +4.363099500155193e-01   +8.123679205194878e-01   +1.898814673633986e-01   +1.742301045751291e-01; -2.904417951751147e-02   +3.131152751845594e-02   +3.971205879669202e-01   +1.528181500845361e-01   +5.874624658654308e-01   +6.279103142282678e-01   +8.925425922119016e-01   +1.843691004834487e-01; +9.697706620507920e-01   +1.461132603160211e-01   +6.209676369634860e-01   +6.990554310619781e-01   +4.552666976563753e-01   +2.161666725943359e-01   +7.996454407620058e-01   -1.018348970196481e-02; +5.339270095419354e-01   +3.637019916924375e-01   +8.205638268072964e-01   +5.542021989631519e-01   +8.511838343677525e-01   +7.770915275971599e-01   +3.463662124384022e-01   +2.260175289039741e-01; +2.906502805415330e-01   +6.849002973721789e-01   +6.192974277053566e-01   +5.314681773672337e-01   +7.413734091617552e-01   +3.486854495611625e-01   +1.000000000000000e+00   +6.354539054067228e-01; +9.830288536918926e-01   +4.342483586642044e-01   +7.165526872385314e-01   +4.051848203884424e-01   +2.615804203785419e-01   +3.681625971658149e-01   -2.667920327949122e-02   +3.086533443172524e-01; +5.355563548209747e-01   +6.504316593670976e-01   +1.383277281324876e-01   +4.948745595526030e-01   +3.684261678368890e-01   +4.678164202288522e-01   -2.942115413127019e-01   +2.530824792963132e-01; -1.014006374198825e-01   +4.374332744651553e-01   +2.233477939485659e-01   +2.936066704848589e-01   +6.257740125703785e-01   +2.333278986748837e-01   +2.128118166766538e-01   +5.978912428286440e-01];
L3I_L3E_iAMPA_netcon = [+2.726925569499737e-01   -7.234345505308964e-03   +7.376330259811932e-02   -1.384292812092202e-01   +3.974966114610089e-02   +3.297377503571162e-01   +2.048994802724782e-01   +2.294303149952499e-01   +3.283395956714483e-01   +6.980674327499096e-01   +4.888274100781556e-01   +4.887328259137948e-01; +5.767187542249493e-01   +3.223934717964376e-01   +5.963670362409413e-01   -1.482463905418653e-01   +3.721511337570071e-01   +5.649777083901861e-01   +4.384047189786477e-01   +2.124938595493004e-01   -6.805474791863095e-02   +1.440278773726862e-01   +4.638945303222129e-01   +3.109664764446227e-01; +6.916302426521880e-01   -3.658410505710295e-02   +3.770859510589755e-01   +4.559220518486142e-01   -5.409170146350827e-02   +4.517374368910201e-01   +6.689352331173835e-01   +2.145433146404592e-01   +2.947511660121934e-01   +3.818838371802616e-01   +4.321024709122300e-01   -2.928167860602869e-02; +7.958424742293662e-01   +2.676606477168864e-01   +8.099321259442441e-01   +6.921355571303894e-01   +1.026905903763108e-01   +6.119276528432535e-01   -1.846226430220438e-02   +4.526360622622977e-01   +4.594949026350011e-01   +9.321586691539034e-02   +6.635604506719377e-01   -2.072796056437274e-02; +1.093602489101657e-01   +3.719195931237219e-01   +1.894142408614547e-01   +4.143779106027027e-01   +6.045160419273889e-01   -5.416517808823849e-02   +2.410817740560866e-01   +1.049765618143631e-01   +5.636084131410172e-01   +3.302868088557755e-01   +3.480041914272902e-01   +5.584465441040345e-01; +3.187080662434087e-01   +2.046353950026971e-01   +6.216940353696775e-02   +5.485854081394681e-01   +2.044710716495715e-01   +6.758269299540821e-03   +6.365693940288283e-02   +7.075360342097974e-01   +3.110040715833320e-01   +3.096771490532106e-01   +3.958894324935803e-01   +1.353298982326082e-01; +2.012323737436977e-01   +7.141575663473617e-01   +6.542672378471337e-01   +3.537369410563122e-01   +3.312301750914021e-01   +2.512962267436214e-01   +1.757378523591170e-01   +2.327105510693583e-01   +1.736584888440992e-01   +4.939405082854941e-01   +3.599573497792540e-01   +6.561909452268602e-01; +3.505670936577545e-01   +6.640728501795207e-01   +1.600292011217020e-01   +6.137615474300901e-01   +6.406983723645686e-01   +4.201433362413234e-01   -3.138958386834478e-02   +2.784918566919298e-01   +6.825584507783699e-01   +5.720756222537300e-01   -3.857718304310116e-02   +6.227131940563925e-01; +3.696137057627936e-01   +8.733004552510187e-01   +7.565411511742333e-01   +5.885486557471724e-01   +3.818122404791016e-01   +5.813666165375116e-01   +3.121560903619845e-01   +5.880740142147287e-01   +3.827522271558401e-02   +3.313432616475578e-01   +6.038629502883578e-01   +4.662144080860712e-01; +6.212589316489896e-02   +4.470362776036334e-01   +4.092261641409406e-01   +6.043850392907807e-01   +4.277252336713973e-01   +5.736682299119545e-01   +5.519994231178498e-01   +2.127522281172954e-01   +1.804549985707730e-01   +5.484376194927635e-01   +3.995105078442225e-01   +6.248588304922349e-01; +6.778329773935874e-01   +5.126510175552830e-02   +7.181772053359124e-01   +8.855290603411519e-01   +2.112271967898532e-01   +2.587169426116959e-01   -4.125324291583519e-02   +7.836523775367720e-01   +8.532707977076188e-01   -3.153075165230394e-02   +6.564778426890633e-01   +7.015042831709789e-01; +4.660808872324073e-01   +4.704812794497530e-01   +1.194577173253142e-01   +1.592621280947624e-01   +3.681867249614506e-01   +2.747199843226074e-01   +1.000000000000000e+00   +2.497544622996658e-01   -2.916529217394822e-02   +1.109617098935297e-01   +2.863426587150630e-01   -1.243404092159636e-01];
L3E_L3I_iGABA_netcon = [+2.245899511350268e-01   -1.022715449422028e-01   +8.011653183854655e-01   +2.655792949737810e-02   +1.266005707858903e-01   +3.300871386093561e-01   +5.473808658329395e-01   +3.906060676641711e-01   -2.535584553912465e-02   +3.291794948352301e-01   +1.287455056697491e-01   +3.625126905770840e-01; +3.872937556356812e-01   +1.628430057686902e-01   +4.437263440173845e-01   +7.385334180121347e-01   +6.118127120799419e-01   +1.991841159747772e-01   -5.346434637193219e-03   +1.962052713327951e-01   +1.829960682441327e-01   +6.663786057085106e-01   +9.112168878992556e-01   +2.975721815911802e-01; +3.088316721175312e-01   +1.427788945566565e-02   +4.636299929661618e-01   +4.211035792258191e-01   +6.875034007296725e-01   +4.984564036565557e-01   +4.900805946769172e-01   +3.247431061110425e-01   +3.043168489339937e-01   +3.402720234443914e-01   +7.057582443879690e-01   +9.565670568323981e-01; +3.923790848190943e-01   +3.792343510784768e-01   +8.965955291492131e-01   +2.613092982475065e-02   +1.963953915012739e-01   +4.356324889182355e-01   +4.965369190285957e-01   +3.073270944462527e-01   +1.123453156501639e-01   +3.352415890352710e-01   +6.878878923932004e-01   +3.303761077095925e-01; +1.972380824250941e-01   +2.984217020899509e-01   +3.441392060581758e-01   +3.113765172948844e-01   +5.690954232105951e-01   +3.100634805122782e-01   +4.209639400586597e-01   +5.927128486332045e-01   +2.543749177293252e-01   +1.320435576209640e-01   -1.879876099161198e-01   +5.706114436336637e-01; +4.895702253764441e-01   +2.951792277589567e-01   -1.205254985512631e-01   +4.683574401507499e-01   +7.643339757378207e-01   +1.633055930714458e-01   +2.827366117174518e-01   +9.797766735403609e-03   +1.892972468138397e-02   +3.987139939772187e-01   +1.963530189833951e-01   +7.207020986921435e-01; +2.425504412236865e-01   +1.699469065951161e-01   +1.946724897196140e-01   +4.160013404574299e-01   +3.132139293037395e-01   +3.714817179606641e-02   +1.316354102486093e-01   +5.378267761260236e-01   +4.045231759958823e-01   +4.154757879716570e-01   +4.310131635172004e-01   +2.316376511967227e-01; +3.565758531807211e-01   -1.438538725617948e-02   +5.190982057202517e-02   +1.160069913074266e-01   +6.251159856348324e-01   +5.116717873214026e-01   +3.702976865931210e-01   +2.529833668253965e-01   +2.746663390550913e-01   -1.369315925765291e-01   +4.910672496133406e-01   +5.037087534581371e-01; +4.203801579277980e-01   -1.239076113974397e-02   +9.397972899730143e-02   +4.335208098946319e-01   -8.222356182384362e-02   +5.814371642692858e-01   +6.034430101409870e-01   +1.506929968473341e-01   +1.548965158643229e-01   +3.303887796870680e-01   +5.951880247689519e-01   +1.705698698111527e-01; -1.413103035481467e-01   +2.312996649988475e-01   +3.889464404934082e-01   +4.326708037692201e-01   +2.025142737752784e-01   +3.368887312249976e-01   +3.100251996492993e-01   +7.223731277769270e-01   +1.482635884288819e-01   +1.466014057111960e-01   +2.265155034299283e-01   +4.765097352602692e-01; +6.853872679028804e-01   +3.959952376498762e-01   +7.531866833194583e-01   +2.278191318518617e-01   +8.510067589328238e-02   +3.170634496065173e-01   -4.279480350708646e-02   +6.017293919595282e-01   +4.292015986835002e-01   +3.892786881201141e-01   +7.628278332303587e-01   +3.098566907035799e-01; +2.181388914307134e-01   +5.106889565473854e-01   +2.233862657954270e-01   +4.741658111136857e-01   +3.318553994660535e-01   +2.781985548849653e-01   +1.000000000000000e+00   +3.645431545661117e-01   +8.292792112975382e-01   +5.732795110427079e-01   +3.875486109686481e-01   +1.267057242971253e-01];
L2E_Input1_iAMPA_netcon = [+7.573576588103893e-01   +7.129982336444289e-01   +6.659917736882628e-01   +1.000000000000000e+00   +7.301071068015969e-01   +9.221202548322514e-01   +7.496121607804788e-01   +7.160977803845552e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +4.948544858389827e-01   +9.762457625547977e-01   +5.384098817004327e-01   +2.563695683819389e-01   +8.355958340940367e-01   +2.994365458704294e-01   +6.097911724359731e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
