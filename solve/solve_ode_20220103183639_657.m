function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.156464317958001e-01   +9.488387889163477e-01   +7.031079805961109e-01   +1.592857803814699e-01   +9.260000482560752e-01   +2.169615913834669e-01   +7.433184403357678e-01   +3.077901778864624e-01   +5.345751229103868e-01   +8.327175388298450e-01   +9.715400478550493e-01   +9.694090627377820e-01   +6.994401333114654e-01   +3.704367817304748e-01   +2.980894060768614e-01   +3.805286097363256e-01; +3.498044484542636e-01   +1.323325300198805e-02   +1.407852742736329e-01   +1.748186539744479e-01   +7.624638112685923e-02   +8.132721398486249e-01   +7.958500692450300e-01   +7.571858182690685e-01   +7.899637434307645e-01   +1.860525116146450e-01   +4.721342660306119e-01   +6.612955019872703e-01   +3.718545642017782e-01   +2.771570751545739e-01   +6.865521742302991e-01   +9.558017162527415e-01; +2.052975169090845e-01   +4.744360009278500e-01   +8.243396438825948e-02   +7.093126072276619e-01   +3.106650875653283e-01   +3.852030934012400e-01   +6.632822983681023e-01   +9.548913647355493e-01   +4.781563520938147e-02   +9.269198370901949e-01   +8.703043497972687e-01   +2.053769749833978e-01   +5.442913372431722e-01   +7.599443193706837e-02   +7.769641123884561e-01   +8.141148140070078e-01; +2.412297310660124e-02   +4.910007743768432e-01   +4.332429905471538e-01   +8.370392814698082e-01   +6.333485457971373e-01   +8.637876600546848e-01   +4.392097338731413e-01   +8.191860990823084e-03   +4.611131121229307e-01   +4.251645628187883e-01   +9.457822523863493e-01   +8.968882791317592e-01   +5.140913890717216e-01   +1.523044778179179e-01   +7.228102187594229e-01   +8.942863692289628e-01; +7.650125553877913e-01   +5.174949288237874e-01   +8.997665957919756e-01   +8.171716824035793e-02   +9.086428392476915e-01   +3.224359819020312e-01   +5.783542635967283e-01   +4.042896537962706e-01   +9.432093611293281e-01   +2.978369288887758e-01   +2.360073447722665e-01   +4.856281618003900e-01   +7.678878422923744e-01   +3.674403912083027e-01   +2.777841555395580e-01   +7.230541078289418e-02; +5.730977360753252e-01   +2.875076218754112e-01   +7.295370457752266e-01   +8.409287833585725e-01   +7.984178726547171e-01   +3.800778043622127e-01   +5.210384706317740e-01   +1.548383405512672e-01   +4.729631105847064e-01   +3.524834757132900e-01   +9.220038047229495e-01   +6.652676234328216e-01   +7.905598039693271e-02   +7.135396809234865e-01   +1.717095928270750e-02   +9.046458643710978e-01; +5.794082500021891e-01   +5.637447621645023e-01   +6.816336752291203e-01   +5.459930039914225e-01   +6.450138007367417e-01   +6.398030674555576e-01   +7.251310751159559e-01   +8.246403324702583e-01   +7.804853831891289e-01   +9.747305912826458e-01   +6.314873882569070e-01   +5.275477294760649e-01   +6.136008234081673e-04   +5.376224962110352e-01   +1.564824807638185e-02   +6.682526467787152e-01; +3.872593071349020e-01   +5.097167559650289e-01   +2.024979709909986e-01   +9.703940816690727e-01   +4.453804228316646e-01   +3.898206513076292e-01   +2.218441248114454e-01   +2.897682069360947e-01   +1.093198318756443e-01   +5.366153885499871e-01   +2.886355782844466e-01   +7.066543043765412e-01   +4.066361056314531e-01   +2.314900475813988e-01   +9.354559982017771e-01   +3.468356688864652e-01; +5.546294064951086e-01   +6.747898370617690e-01   +5.299454362268844e-01   +6.772748017910962e-01   +7.489605695380662e-01   +7.384104020567599e-02   +9.981657623097921e-01   +9.787490967536635e-01   +5.208275447542150e-01   +7.905978973397648e-01   +8.522841221739577e-01   +7.214363990212628e-01   +6.627921365938066e-01   +4.745491638338322e-01   +9.364082187664025e-01   +8.389319394538659e-01; +1.867182360582646e-01   +6.168325430592742e-01   +8.291260372830144e-01   +3.345015207527107e-01   +8.289666706081382e-01   +1.832550785085994e-02   +6.240113247407162e-01   +6.249977925491389e-01   +6.372288787370533e-01   +7.986272569049512e-01   +1.652643588936364e-01   +2.948023175526415e-01   +3.719371539366444e-01   +7.181292273533557e-01   +3.785751673200399e-01   +1.935100214338319e-01; +1.191367132461685e-01   +5.631569735027069e-01   +1.753837521874423e-01   +2.184411190592092e-01   +3.431521114079298e-01   +8.787780378212728e-01   +9.838470460624215e-01   +7.477689318952764e-01   +5.775007847321006e-01   +1.425133444883870e-01   +8.276415009448209e-01   +1.138428830617278e-01   +3.961152073085854e-01   +5.199076702277362e-01   +1.081543388932109e-01   +8.434123227608152e-01; +6.016011256976789e-02   +5.038071354521185e-01   +5.172001937859950e-01   +5.709402838952284e-01   +1.429249972173429e-01   +1.564150707895978e-01   +5.001323138106042e-01   +8.788468290957296e-01   +8.376786712081635e-01   +4.527849994005420e-01   +2.147946690870630e-01   +3.277491244315560e-01   +1.342324404472273e-01   +5.176182535008035e-01   +7.250777396061413e-01   +4.272164704364077e-01; +9.370582054063958e-01   +6.649766162227514e-01   +3.580649696454469e-01   +3.154588203997885e-03   +5.028754197276962e-01   +9.210979338537237e-01   +5.236314284117330e-01   +3.288923942057144e-01   +1.138946562232371e-01   +4.572038011401420e-01   +2.672699313012429e-01   +4.600131679400435e-01   +3.418987848217878e-01   +3.895243464107278e-01   +4.538665861797196e-01   +5.601013123739687e-01; +7.446009168568639e-01   +6.382749497459183e-01   +6.506616612308888e-01   +5.914371078872845e-01   +4.129719831491019e-01   +5.632290037022519e-01   +8.563950734574762e-01   +9.766582971860981e-02   +5.055617965932264e-02   +9.598383633222439e-01   +9.016187705072920e-02   +7.148003312147633e-01   +1.190341106176107e-01   +4.834161226086942e-01   +1.395259708335641e-02   +4.495728581370023e-01; +2.401918008958514e-01   +1.422002516244633e-01   +2.831771057862119e-01   +8.962179460623985e-01   +1.756346948215999e-01   +9.252881884779928e-01   +2.515563056991195e-01   +4.496341628230785e-01   +5.222680475902799e-01   +5.416581338327809e-02   +9.173190785135146e-01   +4.049758955708975e-01   +3.721517242590933e-01   +7.451286547287577e-01   +1.206313110908080e-01   +7.582673551431504e-01; +2.035507121977073e-01   +1.769524640007407e-01   +4.329424974505406e-01   +2.562370216784706e-01   +4.943154972403260e-01   +5.965757442321175e-01   +5.797355325420905e-01   +2.383382944049315e-01   +6.995293649958740e-01   +3.399419466271941e-02   +7.307334401416564e-01   +2.405710718738447e-01   +2.496653461750063e-01   +7.059192163626931e-01   +6.600486755390800e-01   +9.614838466695841e-02];
L1E_L1I_iGABA_netcon = [+8.403752339364932e-01   +7.484774207154592e-01   +8.738300129095122e-01   +4.381347499572308e-01   +9.223035522393043e-01   +7.736099713633969e-01   +3.208627345353392e-01   +6.394345704142254e-01   +9.529861929162808e-02   +2.642342753741043e-02   +1.331072129582702e-01   +5.233242608077612e-01   +8.687859916078370e-01   +5.751775028324458e-01   +1.689642929860216e-01   +6.278394988042479e-01; +6.191356244626799e-01   +9.923160895940627e-01   +3.113674335145299e-01   +1.517682399338076e-01   +8.829582273718989e-01   +2.754161289029191e-01   +9.654791638239166e-01   +4.325402721108794e-01   +2.926263852643020e-01   +5.126274523083005e-01   +4.270214130484172e-01   +2.034767401957597e-01   +8.075038465414659e-01   +2.906298959697192e-01   +5.806675090546669e-02   +3.377838406376056e-01; +6.676268081639153e-01   +3.713406816989641e-01   +4.337814382328724e-01   +6.510815324897515e-01   +5.861432657426573e-01   +5.263038615127795e-01   +3.545499683750533e-01   +4.836829883650279e-01   +3.272946023346966e-01   +8.628908037161477e-01   +4.820363618860787e-01   +7.739559319645694e-01   +6.413088174010425e-01   +1.373282561959119e-01   +2.143061257898145e-01   +1.545498427111439e-01; +7.813875067544925e-01   +5.038568683886017e-01   +3.788651347744247e-01   +7.246226652869273e-01   +8.384637212769548e-01   +4.075239725424586e-01   +3.198921699264707e-01   +9.937567338748662e-02   +4.813609981990040e-01   +5.845066832103942e-01   +6.718569074487356e-01   +3.881330190601945e-01   +7.332732164575140e-01   +4.547549921726855e-02   +2.053588122572471e-01   +3.975645636566069e-01; +3.125578641514696e-01   +7.553687917078360e-01   +6.572107771529194e-01   +1.654583049397311e-01   +7.784415464527834e-01   +7.802059232601939e-01   +9.107096186989374e-01   +8.086617914669441e-01   +2.418897309100868e-01   +4.212526265138460e-01   +3.553187943790752e-01   +6.575267193185398e-02   +6.684271716926127e-01   +6.209072456567820e-01   +2.179270378252399e-01   +9.108429948639720e-01; +3.279987138045788e-01   +1.324404208785890e-01   +2.427792820022320e-01   +3.393360750032022e-01   +7.888443234540453e-01   +2.673896744528248e-02   +8.826530413351007e-01   +6.038281139691160e-02   +4.557085904465724e-01   +7.188151057788710e-01   +5.094128632614244e-02   +7.562499226366873e-01   +8.839724205249024e-01   +6.061721682219701e-01   +5.821557055190321e-01   +1.521526758472723e-01; +6.339917855436357e-01   +5.153866693652503e-01   +6.872553799950344e-01   +1.050226739350960e-01   +6.959811109138478e-01   +4.086573553111803e-01   +3.544668201565387e-01   +9.554301542442194e-01   +7.542256473122066e-01   +2.290554336523127e-01   +2.913490633760079e-01   +4.565577466993783e-01   +8.549621461664212e-01   +3.700621539579784e-01   +3.640015944871747e-02   +4.663853241847276e-01; +8.981485665099772e-01   +9.079403175783631e-01   +3.310959115750022e-01   +4.075078245645432e-02   +2.166654308463032e-02   +8.268288427901536e-01   +7.461832120682156e-01   +7.742205592179032e-01   +7.193785606406645e-01   +5.743170547588073e-02   +7.978817850306489e-01   +3.199039130508460e-01   +4.090842779275479e-01   +8.350099427579353e-01   +7.932100820230686e-01   +7.471483679095839e-02; +3.738777075140453e-01   +1.015735527369397e-01   +8.789175699227628e-01   +4.792341546206870e-01   +3.242506491718753e-01   +5.925648841502584e-01   +1.238067189973266e-01   +4.407331192647319e-01   +2.328397627226017e-01   +9.782621020769405e-01   +6.536473489152275e-01   +2.750700226788345e-01   +1.082643806199428e-01   +5.205116328369294e-01   +1.340181702686057e-01   +3.408013857065355e-01; +8.849025801929173e-01   +1.789789145310144e-01   +9.999383278898638e-01   +4.778312181360198e-01   +9.430121275425669e-01   +2.120394603813121e-01   +5.953877595569691e-01   +1.626402100016206e-01   +6.993767985606300e-01   +9.718077702755080e-01   +7.077643048912614e-01   +5.794731773343326e-01   +4.064470168747563e-01   +8.043840159156226e-01   +5.830198880577536e-01   +4.938957860440858e-01; +1.227095898889014e-01   +1.770253757746896e-01   +6.828932813885220e-01   +5.498616454328233e-01   +4.039433167265099e-01   +2.954512963005271e-01   +4.393438513362797e-01   +8.301774319982280e-02   +3.069062168865760e-01   +1.339427175464728e-01   +7.629895577362020e-01   +9.077457412092731e-01   +3.418367043607290e-01   +5.721096592069820e-01   +8.618875397210274e-02   +4.933844761809714e-01; +9.046441037133370e-02   +5.353887880675523e-01   +3.458421722582773e-01   +6.545294088170525e-01   +6.316841559931518e-01   +2.672181006138032e-01   +9.621294103591239e-01   +7.414372990092386e-01   +4.635400164666398e-01   -2.292032483993176e-03   +3.854737818049218e-01   +4.501346630978769e-01   +1.139374986809992e-01   +7.169968014769218e-01   +2.243384772898068e-01   +1.309227048708290e-01; +5.482896841074753e-01   +9.755086610875591e-01   +5.604830627535062e-01   +3.484573167589701e-01   +8.545419763836839e-01   +9.284645776601389e-01   +9.679521793005029e-01   +5.391894977980025e-01   +4.403986863932939e-01   +9.328693634301383e-01   +3.630747128338969e-01   +9.777463876486273e-01   +8.553077465591968e-01   +7.359938038164993e-01   +4.514304108536459e-01   +7.870329940295136e-02; +6.077244315469449e-01   +8.471941245713034e-01   +8.917943803552915e-01   +2.527499179924889e-01   +3.717342911316520e-01   +5.511956622997443e-01   +2.440663495313631e-01   +4.860120809846452e-01   +7.334378966997690e-01   +7.349247298215201e-01   +8.105093936953355e-01   +1.069310678257928e-01   +8.893499520776800e-01   +4.491733637972662e-01   +1.779669761445024e-01   +6.727881668655661e-01; +7.268155303187896e-01   +6.721678393795215e-01   +6.481577023625907e-01   +1.788529590649303e-01   +2.022205005140730e-01   +4.336256331709193e-01   +7.718339926657926e-01   +8.904270068364971e-01   +8.766231786200606e-01   +4.300927034937304e-01   +3.909856199924898e-01   +4.176675960964298e-01   +6.879955614299093e-01   +2.800917998496836e-01   +4.134901919671953e-01   +1.209409218164498e-01; +9.943594438585674e-01   +1.120833973527230e-02   +3.737603320950939e-01   +4.763844720649985e-01   +9.095388774278598e-01   +3.246777444216067e-01   +7.090432222419346e-01   +5.841973126742106e-01   +9.112970713290164e-01   +9.462794375875947e-01   +8.755206264916806e-01   +3.876470489165534e-01   +7.456937528152415e-01   +1.543915468559382e-01   +9.682066855049046e-01   +9.909920013703638e-01];
L2I_L1I_iGABA_netcon = [+5.720718550239227e-01   +5.634254822715564e-01   +1.056430049540895e-01   +4.562322036704831e-01   +7.968459901135712e-01   +9.785985826812132e-01   +2.249355023757647e-01   +7.613743849320317e-01; +5.595861381532002e-01   +9.500121515485360e-01   +1.211885894054809e-01   +5.646055246799059e-01   +5.445697503044004e-01   +4.236864526385225e-01   +6.529388362965409e-02   +5.015727574675043e-01; +6.114136030101055e-01   +1.131958633307556e-02   +4.346923316825795e-01   +8.186977093149536e-01   +2.609654764774957e-01   +3.914027607759902e-01   +8.330907294601233e-01   +8.291099843118100e-01; +4.672799661304002e-01   +1.281048143374953e-01   +9.317655396662138e-01   +3.563756877080169e-01   +7.859510270831498e-01   +4.625085322255660e-01   +4.447103720505074e-02   +9.220210086669415e-01; +4.340632762025652e-01   +8.560814624719316e-01   +1.376614238609950e-01   +2.485796991752992e-01   +7.796306168506987e-01   +1.229629965180564e-01   +9.088867555622047e-01   +7.104444859378033e-01; +6.464378865679334e-02   +2.171096840713132e-01   +8.260531025832613e-01   +7.665271140344770e-01   +1.430415178305946e-01   +4.590954395323975e-01   +4.546017983966916e-01   +8.009897014386846e-01; +6.432420737996827e-01   +7.065288591026272e-01   +9.305226203413940e-01   +3.673390619581073e-03   +8.247128907000113e-01   +2.622308602994076e-01   +2.825059064157530e-01   +9.588289176312299e-01; +4.225806512011356e-01   +7.759019395292225e-01   +5.736168869916614e-01   +2.726940023657625e-01   +6.241158724121514e-01   +9.798877673316973e-02   +7.588909428204869e-01   +9.522064028870725e-01; +7.540012479883488e-01   +4.232105867152579e-01   +5.010721032952313e-01   +2.898505674072505e-02   +4.567926586075084e-01   +6.598707717559447e-01   +9.236985968076556e-01   +2.992511524176554e-01; +3.085442073893472e-01   +7.293345686917955e-01   +9.338972908910125e-01   +6.663972598549285e-01   +4.838392573774494e-01   +9.444693623731581e-01   +1.387090818267388e-01   +3.515447667400337e-01; +5.981323352086746e-01   +4.588790390457561e-01   +8.596163631115239e-01   +9.694135489417722e-01   +2.202050136153294e-01   +7.602530305989528e-01   +9.510986337243527e-01   +5.446889437540721e-01; +3.341994925395253e-01   +8.075155179527674e-01   +2.531013708654700e-01   +9.452214174195558e-01   +8.585026230425258e-01   +3.995985707222419e-02   +3.075088249810328e-01   +2.129727745019951e-01; +6.442121705870436e-01   +4.325028686694955e-01   +4.584259165099471e-01   +4.706835485826541e-02   +8.794749096080569e-01   +2.637902262725881e-01   +2.081781176155107e-01   +8.395558094880880e-02; +2.983630622290816e-03   +1.495963725681181e-01   +7.404509944770045e-01   +2.902866017564300e-01   +8.417048269122681e-01   +6.383021700619045e-01   +4.639575145068623e-01   +5.078363803077137e-01; +1.465879473952266e-01   +8.033677664665380e-01   +7.536405831542653e-01   +4.874738983635483e-01   +4.403926186591564e-01   +9.351931445351758e-02   +5.954119670338117e-01   +1.976953379432544e-01; +2.485575742823084e-01   +3.807356538046270e-01   +2.351139384367359e-01   +8.847152210953555e-01   +5.427638818489177e-01   +7.853242030922322e-02   +5.525140485743766e-01   +1.461496591131190e-01];
L1I_L2I_iGABA_netcon = [+7.017706250603736e-01   +8.680454042026884e-01   +6.133315200238303e-01   +5.239923039752584e-02   +1.443760964348395e-01   +2.345602463510555e-01   +8.401661804751700e-01   +3.684669778667563e-01   +7.104039680207330e-01   +3.834197464264431e-01   +2.410547531508994e-01   +6.667038637904632e-01   +1.657557809920795e-01   +5.729481701234264e-01   +4.049813447542699e-02   +4.458537585109817e-02; +6.025794674395146e-01   +8.005068618081917e-01   +6.129282199239828e-01   +5.613091804980481e-02   +7.449284276882610e-01   +5.557916231247828e-01   +1.987753931035348e-01   +5.595433499529759e-01   +1.844261583900192e-01   +7.226386005228330e-01   +5.079268646263730e-01   +3.339247777183090e-01   +1.097286436078405e-01   +8.094048119305262e-01   +4.374533624049791e-01   +9.236403989480768e-01; +1.654736682116565e-01   +6.221253472447750e-01   +3.107165164655190e-01   +5.967620816537487e-01   +9.520680049821664e-01   +1.111316715429178e-01   +6.190694082207987e-01   +8.280384683338452e-01   +2.326956561356963e-01   +6.371921679520439e-01   +7.334628212572991e-01   +5.485485526105199e-01   +7.401257933524659e-01   +6.769422574988024e-01   +9.204096768035711e-01   +1.740447062556128e-01; +4.845231688391765e-01   +4.742363955186448e-01   +1.377270326003408e-01   +6.621756350621825e-01   +2.617218060694174e-01   +8.179629634231104e-01   +1.551708405861371e-01   +7.124612707511883e-01   +9.999979716168717e-01   +1.006479658641603e-01   +7.747049944420735e-01   +5.359987001404730e-01   +2.151960339078112e-01   +4.387077147561403e-01   +8.813126008184220e-01   +7.431120404404293e-01; +2.884109741812119e-01   +2.031180601687624e-02   +5.994338404973322e-01   +4.820125213331325e-01   +9.228579011350242e-02   +6.545430721522063e-01   +5.796422591191138e-01   +1.182531338456312e-01   +9.062578581011901e-01   +4.915359036406733e-01   +6.792438945058834e-01   +9.001567988707055e-01   +4.835548774130278e-01   +8.937526459143962e-01   +9.447947731848862e-02   +4.733515363295246e-01; +4.025775503576983e-01   +1.206059450005076e-01   +8.925220191952836e-01   +9.781319538535070e-01   +2.337136603166026e-01   +2.368254056597834e-01   +5.405392253422726e-01   +7.385122101793461e-01   +1.109462611177362e-02   +5.599905979671699e-01   +8.176811770533546e-01   +2.841954653186048e-01   +5.406271880281655e-02   +7.845448647857970e-01   +6.758880853727506e-01   +2.513338731071162e-01; +4.946510334167810e-01   +7.161889452513573e-01   +5.600095012601997e-01   +8.636664750177337e-01   +8.925411176171353e-01   +3.029430437904550e-01   +6.848725277935320e-01   +9.216179283775766e-01   +8.315358054565102e-01   +5.426842569597794e-02   +4.166432928063999e-01   +1.389503231334620e-01   +5.740635773773004e-01   +5.849121620154329e-01   +9.733828089484520e-03   +6.676818870594644e-01; +8.620489788907351e-01   +6.762084093920064e-01   +6.336728158492058e-01   +9.515416591746111e-01   +1.950353825493947e-01   +3.303634203994379e-01   +6.963512233288331e-01   +9.214953932828754e-01   +2.514713747198808e-01   +8.770791967986712e-02   +4.950005785340032e-01   +9.560981396834936e-01   +4.941157044798441e-01   +6.190707075505808e-01   +1.204433621372039e-01   +6.090536067962263e-01];
L2E_L1E_iAMPA_netcon = [+3.686775817442290e-01   +5.603936994405212e-01   +2.028714064723052e-01   +5.133128208641211e-01   +2.892318547161459e-01   +7.314969370448522e-02   +2.777812078333235e-01   +2.645463035501079e-01; +4.343469475656991e-01   +1.900961350354343e-01   +1.347558791811011e-01   +6.836956689919296e-01   +6.211071703751480e-01   +5.914965207096795e-01   +9.294223944390890e-01   +8.999612776553757e-01; +7.150022451373016e-01   +6.086677105866171e-01   +8.279595813099104e-02   +2.053499877396180e-01   +8.683102325258391e-01   +8.156228577697883e-02   +7.654498598641032e-01   +1.547643333086381e-01; +1.936147741104213e-01   +7.370956444268761e-01   +9.375947840706407e-02   +9.737634328895867e-01   +8.182870629874416e-01   +3.989120552369976e-01   +2.628501461943210e-01   +5.525823472492940e-01; +4.237164360118270e-02   +8.335316151549224e-01   +5.515741226985689e-01   +3.510826228810098e-01   +2.072774850689761e-01   +5.707068587546432e-02   +2.425371215699792e-01   +4.202691041658980e-01; +3.165164610810715e-01   +2.771564681240004e-01   +7.296748612800215e-01   +1.827223357319290e-01   +7.529788880114044e-01   +1.259386701215544e-01   +1.644118530325898e-01   +5.491279493442059e-01; +7.877213521370268e-01   +6.106511584593369e-01   +5.449515460967217e-01   +2.414798356763746e-01   +1.990846889951796e-01   +2.455594863619912e-01   +2.890591005182805e-01   +7.499803862338132e-01; +4.623745800197941e-02   +5.491034154950044e-01   +5.268367790917250e-02   +2.569893233133259e-01   +5.779332643021901e-01   +9.475165757872459e-01   +5.646525405202761e-01   +1.163981315468800e-02; +2.159324913791921e-01   +2.779299802203593e-01   +6.332833479614595e-01   +2.236607552897434e-01   +8.763971507993517e-01   +2.027738489861421e-01   +4.001382322841278e-01   -3.650197550266543e-03; +2.716332063375375e-01   +3.401125154771203e-01   +9.919608150655996e-01   +3.647641561929487e-02   +7.148873772079236e-01   +3.267254094987110e-01   +9.865466856597115e-01   +2.371965040661740e-02; +7.899467677109004e-01   +5.686832212877275e-01   +9.131659604222953e-01   +3.557248809101389e-01   +7.024077007879584e-01   +8.628240816938306e-01   +5.462066619365029e-01   +3.573379091802260e-01; +9.864565107885813e-01   +7.403788798347747e-01   +7.713564234215308e-01   +8.998401171916676e-01   +4.654589045592888e-01   +9.233269392697175e-01   +9.324837647797436e-01   +4.284347012507710e-01; +9.708537900267998e-02   +7.670286009306182e-01   +1.927546247106978e-01   +1.406068865142364e-01   +5.038597052526698e-01   +2.106890846513256e-02   +9.918934286525497e-01   +5.455969856883055e-01; +1.989016173763562e-01   +4.002848329836229e-01   +3.364612790125212e-02   +9.569216126421262e-01   +7.993851018252168e-01   +3.631932991279090e-01   +8.316119793943858e-01   +4.878969089157373e-01; +1.192886423587621e-01   +1.489793927489582e-01   +3.765221396201406e-01   +9.047175934315533e-01   +9.349967257314635e-01   +5.304711580037341e-01   +1.806323404346521e-01   +9.194378204668398e-01; +6.439503550840799e-01   +2.063092057623498e-01   +5.752376647942380e-01   +4.115746751065950e-01   +7.856251192476333e-01   +4.062940246243239e-01   +3.087634689087058e-01   +4.169942875103956e-01];
L1E_L2E_iAMPA_netcon = [+4.994669009223096e-01   +4.507274960867009e-01   +6.157577711073084e-01   +4.900762373161183e-01   +2.327717055256011e-01   +7.180153377056965e-01   +6.905330238983244e-01   +6.359391443841469e-01   +5.225942451256356e-01   +2.436941828495592e-01   +8.778693501707030e-01   +1.762786935395414e-01   +1.366877920381022e-01   +2.455044941024289e-01   +1.867492600895900e-01   +2.184302645629626e-02; +8.363342488451578e-01   +3.640640951797519e-01   +1.053234458048019e-01   +6.620974795304728e-01   +8.375568343563680e-01   +3.825067389018806e-01   +9.764343165299102e-01   +6.209715424445502e-01   +6.725445013337252e-01   +7.288275443782365e-01   +6.575279707821470e-01   +3.028546736187507e-01   +2.859988595991519e-01   +7.495021655534650e-01   +1.498111698987634e-01   +2.462679888204543e-01; +1.864912408939683e-01   +3.031149297854123e-01   +7.545162304671034e-01   +1.771950233953979e-01   +7.333025686993218e-01   +3.820287440609928e-01   +7.546384436893038e-01   +4.085807225372176e-01   +7.728962897075099e-01   +1.322710244692525e-01   +5.382990850345730e-01   +1.088145211098590e-01   +4.930457390847715e-03   +9.342238781904741e-01   +1.337651401676473e-01   +9.871494977586918e-01; +3.379178698970344e-01   +2.371602918388193e-01   +5.410088493175337e-01   +4.760518540168694e-01   +4.903995015410028e-01   +7.144482548954475e-01   +5.542307360009433e-01   +4.277399557850041e-01   +4.617322427000118e-01   +4.149208557970785e-02   +2.516500490461293e-01   +4.485681242297009e-01   +3.067219311253234e-01   +2.736411437453373e-02   +1.679202342011059e-01   +6.324898935038596e-01; +6.949199169709244e-01   +1.362450932424807e-01   +4.428637693660059e-01   +5.009829044592391e-01   +8.489295813629432e-01   +8.362233790328989e-01   +2.786627799652960e-02   +5.068631669145526e-01   +9.047340932754511e-01   +6.505811897260796e-01   +1.048712372772496e-01   +5.857140486062401e-01   +9.035779150937617e-01   +4.377740894701259e-01   +9.214006173865347e-01   +3.575964422653490e-01; +6.972514876961315e-01   +1.044120551176246e-01   +7.408689980841473e-01   +6.029766391751331e-01   +7.158437067410147e-01   +6.677917341254984e-01   +1.941395664968935e-01   +2.605262226007379e-01   +2.617820369727248e-02   +2.000959833177358e-01   +9.736355271230204e-01   +2.254367628356902e-01   +2.930816824894886e-01   +8.297069391021841e-01   +2.632910683433383e-01   +9.582091709001221e-02; +3.661010850414266e-01   +2.312879524664957e-01   +3.887231699373779e-01   +2.437361812006686e-01   +5.227107658413320e-01   +6.490018664577437e-01   +9.400563550947385e-01   +4.210904618948596e-01   +4.822296379554569e-01   +9.758517301492169e-01   +5.932172282497457e-01   +1.097547177614029e-01   +8.280012771889288e-01   +9.964703195235707e-01   +2.078121802140611e-01   +4.070104182276379e-01; +3.022925000031467e-02   +3.447777048152988e-01   +5.284120684612551e-01   +5.149768049720824e-01   +9.399779289294798e-01   +5.621278742013457e-01   +3.955803372814677e-01   +5.247329940227479e-01   +2.749401577595606e-01   +8.198541026157429e-01   +8.183181911950267e-01   +5.579751292436868e-01   +7.462000644794030e-01   +9.183615254747709e-01   +6.145397922735717e-01   +9.326957888042939e-01];
L2I_L2E_iAMPA_netcon = [+6.756850914691511e-01   +6.118617925570503e-01   +4.031727116444717e-02   +7.961593315634670e-01   +5.223687342570583e-01   +8.232798852094564e-01   +6.465204224760048e-01   +3.871611022494924e-01; +2.399393661138675e-02   +9.439831484760298e-01   +5.552590313968001e-02   +9.328435883033291e-01   +6.037705027736389e-02   +1.124770432871457e-01   +3.847701968151269e-02   +1.691959807458335e-01; +7.411292312689317e-01   +9.632451514921714e-01   +4.040554280258778e-01   +9.404180335300938e-01   +2.839173774027557e-01   +2.166696278935595e-02   +5.651410238411085e-01   +4.445863967488908e-01; +2.134265977344739e-01   +3.717646772070967e-01   +9.818507577076483e-01   +1.418438129475326e-01   +7.103974740146208e-01   +8.814426431607091e-03   +3.066002890533814e-01   +8.763397175476614e-01; +8.583063098873843e-01   +7.991153643860999e-01   +7.133051459584018e-01   +3.223158385787604e-01   +8.819869719517398e-01   +3.340925908804812e-01   +2.642146531925441e-01   +4.086187657010332e-01; +1.581491447882932e-01   +7.300782659038445e-01   +9.864421303575812e-01   +4.305856156853738e-01   +3.637285281108574e-01   +6.686003103204664e-01   +7.205405187312013e-01   +1.656453286201608e-01; +6.701586101082251e-01   +9.559040681446053e-01   +6.464631019264983e-01   +7.081470016174221e-01   +5.619741931174618e-01   +5.982863825271071e-01   +3.081636415681093e-01   +6.629895454598226e-01; +9.337280293224859e-01   +1.314902550295915e-02   +5.013495814049362e-01   +6.183121798252323e-01   +8.811104120305672e-01   +7.882772431005235e-02   +8.992080097745259e-01   +9.284762474054703e-01];
L2E_L2I_iGABA_netcon = [+6.352368021495126e-02   +5.215247633330882e-01   +3.522153601610781e-01   +2.562149587594490e-01   +4.420496323901120e-02   +8.952871820444397e-01   +3.433275466806376e-01   +4.550650304109803e-01; +3.545868546707592e-01   +6.666768870474933e-02   +5.578371899092550e-01   +9.837371611898736e-01   +3.609417325934142e-01   +5.439391122370454e-01   +9.309601122321176e-01   +6.754615658876858e-01; +9.322598553290120e-01   +1.816110405065180e-01   +6.924808327031583e-01   +3.512559917645097e-01   +3.817932803149944e-02   +7.169483445668708e-01   +9.122895160277178e-01   +7.693331598037274e-01; +2.386537067379253e-01   +3.121787893596556e-01   -5.561810338992161e-04   +3.979361344220286e-01   +4.840189181228423e-01   +7.143130695801259e-01   +7.248856584064927e-01   +9.270331847897233e-01; +1.053067930607524e-01   +2.462880415650965e-01   +4.445436357897917e-02   +7.524935673937022e-01   +7.264485927715961e-01   +1.707104118863481e-01   +4.430020958766238e-01   +6.554611956663694e-01; +7.157583192830608e-01   +3.263896930426120e-01   +3.043299205726278e-01   +1.052516352804688e-01   +1.434601642870132e-02   +3.542691457349089e-01   +1.545112117663587e-01   +4.990710456080815e-01; +6.031656001064863e-03   +8.755146391519282e-01   +8.705588605768549e-01   +5.928204702623783e-01   +5.131819096601022e-01   +3.812103623943392e-01   +8.316451013475067e-01   +3.411580154129047e-01; +1.800084958823443e-01   +3.026328872611305e-01   +6.279374919687415e-01   +1.229239753297915e-01   +2.391019254053122e-01   +7.558453837608947e-01   +2.541452387830390e-01   +9.462010831388383e-01];
L3E_L2E_iAMPA_netcon = [+7.779475224732063e-02   +1.690381680446718e-02   +3.701255973173039e-01   +4.953623662663650e-01   +1.990264918544616e-02   +9.601638520480561e-01   +3.586016538955086e-01   +1.744272316257331e-02   +2.047165431945593e-01   +6.421035550646745e-02   +2.454681447163057e-01   +9.972292621349083e-01; +9.524940909003236e-01   +9.777312374288191e-01   +1.176263200004232e-01   +6.653031094890062e-02   +8.092640348210682e-01   +3.880030522085297e-01   +2.275628128135169e-01   +1.226193085725853e-01   +3.596379671320331e-01   +7.416031854355761e-01   +5.342701661536864e-01   +3.448740702793825e-01; +6.641936394784892e-01   +7.219815233635678e-01   +5.132783821497827e-01   +8.627407219633281e-01   +7.946847818155583e-01   +6.635826912086443e-01   +7.271023544647585e-01   +6.669650274650989e-01   +8.913147209721859e-01   +9.893412865202327e-01   +3.333260600282830e-01   +8.238026024871771e-01; +1.683053267676050e-01   +8.740869817952646e-01   +6.119131905515962e-03   +9.973443449113147e-01   +4.201191592903375e-01   +5.858537907083448e-01   +7.724662864115723e-01   +5.071530500354733e-01   +8.166905697332133e-01   +7.691691708384926e-01   +6.724109832853512e-01   +1.083566701618540e-01; +1.958622091379082e-01   +8.196382220232222e-01   +8.712439249587947e-01   +1.228111943926133e-01   +6.311634048521451e-01   +5.617842143872066e-02   +3.404495131430285e-01   +7.443944664032420e-02   +3.182106912854115e-01   +8.839895083221261e-01   +8.751688062731442e-01   +7.774690957946230e-01; +9.951626994643872e-01   +3.479814505408747e-02   +9.078027220642801e-01   +1.016995635566969e-01   +5.695435809254096e-01   +7.240059645850717e-02   +5.740621645808019e-01   +5.364830356762710e-01   +5.976798669925423e-01   +3.851593815774378e-02   +9.854355140064344e-01   +1.528140700512301e-01; +9.253131794086684e-01   +9.311617039645544e-02   +1.104096540199111e-01   +1.481300816156454e-01   +9.013282271902052e-01   +2.293321658920570e-01   +6.428671826594461e-01   +6.813873249754312e-01   +6.994928727076171e-01   +7.928446218172046e-01   +1.422186162195651e-01   +7.329101457643721e-01; +9.806319719256599e-01   +8.943804122097207e-02   +4.310799878911949e-02   +1.266260318355654e-01   +7.474095150163198e-01   +4.188939936933383e-01   +3.674528102344234e-01   +5.874318524442830e-01   +1.761346249692334e-01   +7.104210446545947e-01   +8.762012499279218e-01   +1.143661503129749e-01];
L3I_L2I_iGABA_netcon = [+7.693047892212782e-01   +5.355019366995573e-01   +5.967967502322794e-01   +3.068008461729429e-01   +9.675504947255704e-01   +1.163956078259766e-01   +2.966159433952968e-01   +7.957890623886703e-01   +9.189004539205503e-01   +9.935621308651250e-01   +3.119331851170726e-01   +9.936557514231171e-01; +6.393093770669874e-01   +4.499439501981676e-01   +5.610260085167822e-01   +7.593872853148769e-01   +5.473934399659257e-01   +6.486703379103446e-02   +1.689157852676945e-01   +4.983732892803951e-02   +3.874292630799445e-01   +2.905122213327624e-01   +4.463138412607252e-01   +9.165394063243624e-01; +7.969182761784184e-01   +1.136486803350307e-01   +7.255708630081943e-02   +6.497077497625431e-01   +9.825634236791104e-01   +4.917861129498417e-02   +7.236553453325497e-01   +1.799332974680135e-01   +7.486607551883868e-01   +5.195227025704242e-01   +2.071321869889411e-01   +6.884383006335483e-01; +9.612047018929060e-01   +7.190687072521255e-01   +7.697993876320236e-01   +3.316391712517146e-01   +1.280353324057244e-01   +1.314337023678273e-01   +2.987234605890535e-01   +2.432078191759456e-01   +8.805336568252897e-01   +3.559542757321424e-01   +9.422462640454486e-01   +2.183143332583415e-01; +7.126388604880731e-01   +1.836123757878978e-01   +8.679146890913558e-01   +9.748113498250771e-01   +1.680823374669282e-01   +4.927713560513147e-01   +6.775899383280786e-01   +2.598160239884414e-01   +3.928253109465817e-01   +5.223028004920930e-01   +2.914375944100526e-01   +3.122941475122888e-01; +6.438642485920136e-01   +3.211238026338906e-01   +7.045866736534470e-01   +5.318155294936224e-01   +3.359551035016434e-01   +4.673115444375067e-01   +7.467555178203327e-01   +6.514091423199403e-01   +1.712283129776722e-01   +4.976076222598699e-01   +1.221460519586018e-01   +2.322599897919700e-01; +5.145807538915196e-01   +9.690353992291512e-01   +1.057330076249807e-01   +7.498765010500776e-01   +5.347574216827820e-01   +1.569605669045824e-01   +7.481110187718902e-01   +9.927291116833262e-02   +4.358871539582012e-01   +1.873132766375646e-01   +7.235703796776954e-02   +7.076414024273043e-01; +9.496179737662266e-01   +7.015243126101794e-01   +6.643293218557043e-01   +2.661757911177072e-01   +6.954562414444040e-01   +1.342199388090432e-01   +7.821892371104341e-01   +4.716639838465979e-01   +8.569426810788321e-01   +4.818698273536537e-01   +7.265140937317375e-01   +3.745156253245026e-01];
L2E_L3E_iAMPA_netcon = [+6.567914563121946e-01   +3.875344813746092e-01   +2.344967712199922e-01   +4.652823378249851e-01   +9.043053303830377e-01   +9.550912513857381e-01   +7.658051765017131e-01   +3.554400547586442e-01; +3.800193481237609e-01   +2.419141955877641e-02   +9.079109965655138e-01   +2.885252701666366e-01   +6.804999358428222e-01   +2.385506636020240e-02   +9.000375267396081e-01   +6.637032790947001e-01; +3.086924643922260e-01   +3.312153561522508e-01   +4.880973767556585e-01   +2.797351178545561e-01   +8.435904931551137e-01   +4.996967468693602e-01   +7.931583119928344e-01   +5.903146068828895e-01; +1.539453233217861e-01   +4.858589456097053e-01   +5.955603995656307e-01   +1.423509801724498e-01   +9.663604835600000e-02   +3.375802322343975e-01   +9.551773352124620e-01   +5.365489993995248e-02; +7.762671563616020e-01   +2.648833290791615e-01   +9.530646138610314e-01   +1.451238260569206e-01   +7.366671120683839e-01   +6.689968439998731e-01   +5.354956879870391e-01   +2.128298389209214e-01; +7.099892502021135e-01   +5.274992562207269e-01   +8.144227266263245e-02   +2.625033410689392e-01   +5.450275763838134e-01   +1.663368257835436e-01   +1.638486431384338e-01   +6.034238398658368e-01; +1.717307489361893e-01   +4.142434047498734e-01   +2.250797135320988e-01   +6.094245075062475e-01   +2.540047522937980e-01   +2.255959729276828e-01   +1.365085534887633e-01   +2.725005719506778e-01; +4.498624404623105e-01   -9.589187729273471e-04   +1.562097320905571e-01   +1.044032418085241e-01   +7.128062325120933e-01   +1.162163543362382e-01   +2.795279584065899e-02   +1.123354892513679e-01; +8.422515606574287e-01   +8.907251037401881e-01   +3.927615098354669e-01   +4.877266110315698e-01   +3.580743561584140e-01   +9.911119366712230e-01   +6.859872330658456e-01   +2.131653174045913e-01; +6.996892939176793e-01   +2.374029742468403e-01   +1.849084982836816e-01   +8.958716977573916e-01   +8.486597833757478e-01   +1.415492999045413e-01   +5.858633700270764e-01   +8.772692020888445e-01; +7.655075349019643e-01   +7.953541164230045e-01   +7.663683704604562e-01   +1.917677973702004e-01   +8.195842733575407e-01   +7.680665995848935e-01   +2.949971766224495e-01   +4.622972355285163e-01; +9.767016564116449e-01   +5.789203072053380e-01   +2.316174823051758e-01   +5.020772513606488e-02   +6.135903891482180e-01   +6.293865161604401e-01   +7.551666427513376e-02   +7.299813127080700e-01];
L2I_L3I_iGABA_netcon = [+5.929989227479003e-01   +1.457174729905045e-01   +3.446491294734985e-01   +3.685467380554245e-01   +5.961780164152671e-01   +5.068244462245486e-01   +7.712641283151462e-01   +2.668966188238787e-01; +8.420941729065151e-01   +9.902885593267911e-01   +4.479293869916807e-02   +5.373036376607376e-01   +4.757840211414852e-01   +2.397396846427565e-01   +1.794141135977847e-01   +5.900114858380595e-01; +6.036234338938503e-01   +4.811873289805006e-01   +9.455277377467918e-01   +9.742056098111604e-01   +3.816180656278537e-01   +2.702687964439323e-01   +4.541680607560271e-01   +6.814015573356463e-01; +7.448463411903720e-01   +3.831822290876320e-02   +8.666136474830380e-01   +9.960698328904434e-01   +9.801594294564803e-01   +4.083090391196750e-01   +3.021310439269564e-01   +4.154728658034527e-01; +8.502326586697839e-01   +2.693064309825913e-01   +1.338379862232731e-01   +4.124100048814212e-01   +1.377820165136744e-01   +2.605865216917289e-01   +3.828945776994939e-01   +5.104730047537692e-01; +1.464019192383582e-01   +6.725813210365039e-01   +5.912839235232030e-01   +4.455698264763492e-01   +2.735726939665452e-01   +8.525462518835251e-01   +8.006932096030488e-01   +8.147266843832813e-01; +7.435412326506963e-01   +1.451526259646883e-01   +6.759836914530284e-02   +2.503808893604519e-01   +2.228479118000242e-01   +4.798100670611664e-01   +7.802451707575904e-01   +5.392953374521769e-01; +1.397303892106680e-02   +7.699495004189172e-01   +9.497557760410885e-01   +5.965641511798531e-01   +7.974217921909780e-01   +3.395175746526605e-01   +6.444070162173685e-01   +5.893260053270075e-01; +2.242796917087392e-01   +2.703300099228859e-01   +4.968413182760567e-01   +7.264314796691317e-02   +8.204495373325836e-01   +6.390352625017047e-01   +2.434783811837979e-01   +5.344535167863184e-01; +5.334645979049688e-01   +8.804116449880983e-01   +2.808528119061610e-02   +9.102563001627259e-01   +7.950518258010412e-01   +4.137628314800826e-01   +6.085156874971202e-01   +5.401803041475529e-01; +7.197301923184555e-01   +3.677455503410250e-01   +5.516370389567182e-02   +4.787976224638217e-01   +1.110824275832297e-01   +5.487393206146282e-01   +4.175671185404869e-01   +1.505242363580995e-01; +4.333823065424581e-01   +9.433228552284893e-03   +3.018652577760860e-01   +5.053401999611058e-01   +6.332217019317432e-01   +3.394269516356891e-01   +2.968793255065727e-01   +7.003022641181920e-01];
L3I_L3E_iAMPA_netcon = [+6.048939573860168e-02   +7.718515327364567e-01   +5.520951968364737e-01   +5.706624358444218e-01   +9.168545077821353e-01   +8.346085114464702e-01   +8.479622994550974e-01   +8.586895452644204e-01   +5.312640033686568e-01   +9.908029991329794e-01   +4.806917118268870e-01   +3.519838686157674e-01; +9.204615538213441e-01   +8.418519357955819e-01   +8.468922778109925e-01   +9.354909599553992e-01   +5.945631531986268e-01   +3.975301896957589e-01   +6.291216359988945e-01   +8.556113958089753e-01   +5.643943655509314e-01   +6.977825699814163e-01   +7.412734892957159e-01   +3.993679145139580e-01; +1.847132929003048e-01   +5.946556141617958e-01   +9.701200622447718e-01   +7.782955030617844e-01   +5.749714261449599e-01   +6.921733036939376e-02   +4.421639053047913e-01   +9.483589045628882e-01   +9.834066046179206e-01   +8.418093549434054e-01   +5.938837078499208e-01   +9.878287174898049e-01; +5.432516545094018e-01   +7.639064990069546e-01   +4.615890919622769e-01   +5.955597291035745e-01   +6.554705056588731e-01   +3.756060472377030e-01   +2.327025878265442e-01   +6.958378064610395e-01   +9.630521010963476e-01   +7.366215520787988e-01   +2.583356329420719e-01   +2.964477115469031e-01; +3.990431991424128e-01   +6.620737421118073e-01   +7.724889848824619e-01   +5.737498935223852e-02   +4.321040548769126e-01   +8.519953880426718e-01   +4.852893011574373e-02   +3.628774090094448e-01   +5.605149372626375e-01   +9.971466108940011e-01   +6.070392771862663e-01   +2.299885247811887e-01; +8.390490092327564e-03   +5.858948081949098e-01   +2.565707346830067e-02   +5.413548465978330e-01   +9.375629653087014e-01   +2.548637914940345e-02   +7.070795157928486e-01   +3.753901573284194e-01   +5.275613031762366e-01   +5.058037119595303e-01   +2.296439044717551e-01   +3.287493067543196e-01; +1.038557072762619e-01   +2.284814219397303e-02   +6.750134994299579e-01   +8.638507713041199e-01   +1.013610034776066e-01   +4.232601565941051e-01   +8.494854585726820e-01   +8.422862225097899e-01   +4.784011254084953e-01   +1.908980319670849e-01   +1.927059401382779e-01   +1.662500803316052e-01; +8.576814274906431e-01   +6.873816336578373e-01   +8.363369650891733e-01   +3.374331282319732e-01   +4.044319423592644e-01   +2.515135189025330e-01   +4.061579167618846e-01   +3.848858188570223e-01   +9.008110283584230e-01   +9.567180576491595e-01   +3.282900354003648e-03   +3.811886665528353e-01; +3.384310511480704e-01   +3.251134189184753e-01   +6.861628499933974e-01   +1.789822697474642e-01   +8.952472353870429e-01   +7.176201421157732e-02   +2.900973247228804e-01   +7.721765354078536e-01   +4.829375160967149e-01   +4.523992442871838e-01   +6.511931444516391e-01   +5.283941156472648e-01; +1.499941296768965e-01   +8.013902024707686e-02   +8.984495983857661e-01   +8.807436245489352e-01   +7.343008089473896e-01   +9.186100115125531e-01   +2.592672329703302e-01   +7.754537497923312e-01   +4.877102355832169e-01   +6.063759568758416e-01   +3.982229136903717e-01   +5.945668165196520e-01; +8.039735348219212e-01   +7.434157805116317e-01   +9.440839206700706e-02   +8.410312782091739e-01   +9.586847236222386e-01   +2.668346084595333e-01   +5.095761194302503e-01   +4.341728253974668e-01   +3.131743240077412e-01   +6.435445876379139e-01   +2.703536705740097e-01   +1.704495961139575e-01; +6.517765459708600e-01   +9.694883506404794e-01   +7.673650071319538e-02   +8.305982400419479e-01   +9.733408177620103e-01   +1.049593146236478e-01   +1.182149321420832e-01   +4.851250101265454e-01   +8.535526523086974e-01   +7.607975167139229e-01   +9.218911134776201e-04   +6.909002403811768e-02];
L3E_L3I_iGABA_netcon = [+4.433991235877610e-01   +6.938697191839119e-02   +8.135021453698151e-03   +4.937447444049370e-01   +5.478834991532865e-01   +2.539803698149331e-01   +7.157696473121354e-01   +7.613154227616299e-01   +3.809216530587700e-01   +4.509796282876417e-01   +2.007676600701646e-01   +6.542304191268487e-01; +6.105046811001492e-02   +8.069406405033567e-01   +1.307899689233947e-01   +1.901541451370389e-01   +2.152769267226897e-01   +3.334532447636758e-01   +2.236856636970737e-01   +8.924380524256068e-01   +6.113418183648875e-01   +3.940439855265006e-01   +8.282752301002955e-01   +9.025333262461179e-01; +6.258930569071182e-01   +9.137130024086180e-01   +3.085407329536939e-01   +6.446850436142489e-01   +2.719002482550740e-01   +5.944634193749084e-01   +5.000938696367555e-01   +7.355117796148383e-01   +1.665738049971343e-01   +6.742386782550528e-01   +4.446830312695647e-01   +8.332838179780324e-01; +8.034222800376890e-01   +4.261484065636377e-01   +2.382475843528053e-01   +2.527365017689560e-01   +1.332521880739988e-01   +4.834825575994076e-01   +4.774246346794365e-01   +6.926100223377887e-01   +1.013891806219025e-01   +2.890418922710398e-02   +4.230636816178686e-02   +1.730564915940456e-01; +4.003231698569834e-01   +1.890646062483267e-01   +6.504373706935633e-01   +9.465764111075076e-01   +1.648228001685327e-02   +8.968097450842305e-01   +4.305705032597107e-01   +6.421125095003632e-01   +6.215255882553201e-01   +7.874542151472163e-01   +7.654214860476993e-01   +1.601416532785377e-01; +8.833829539224545e-01   +1.832561569326630e-01   +8.084091945454975e-01   +2.902848429411073e-01   +1.017551991994175e-02   +2.938833602230488e-01   +5.519367063333109e-01   +6.171333454160840e-01   +9.585557964606652e-01   +3.779188857074215e-01   +9.596050203264889e-02   +1.333512401191094e-01; +7.198773089192653e-01   +6.690657320692173e-01   +7.437446850900771e-01   +1.463153425116656e-01   +9.835199904627238e-01   +7.814714881585946e-02   +2.094524301695464e-01   +7.774185467375222e-02   +6.695860943644336e-01   +6.460354154704425e-01   +6.533719427515919e-01   +1.613774722216562e-01; +1.951515756757387e-01   +5.241115662026450e-01   +1.211373411431173e-01   +8.690741455465859e-01   +6.459822527831267e-01   +3.915079467172492e-01   +2.754760176878547e-01   +5.510976337629182e-01   +4.715988752976265e-01   +4.976758930166783e-01   +2.720036400189503e-01   +3.950982106745904e-01; +3.758129207043325e-01   +7.749948532677721e-01   +1.690232630686505e-01   +8.861091092456355e-01   +8.139401405867039e-01   +1.945473457778485e-01   +8.132733147162461e-01   +8.802041169040298e-01   +3.380620086644637e-01   +2.149705258366463e-01   +4.389076017742147e-01   +6.626877077554481e-01; +2.120636559465017e-01   +3.001510699284440e-01   +2.696606319538409e-01   +6.664096097643573e-01   +2.760536049282521e-01   +7.263723111923260e-01   +9.948133629296939e-02   +9.865707622233327e-01   +5.914608568122505e-01   +2.128837075664698e-01   +8.493510292836481e-01   +2.226961952191877e-01; +2.641908267368207e-01   +4.751193233115260e-01   +8.137888242546387e-01   +9.985348922419701e-01   +1.319431506775321e-02   +4.216765264580896e-01   +3.312970465548156e-02   +6.994248241644622e-02   +5.478339859185428e-01   +4.501126933316523e-01   +9.042524601303245e-01   +6.432419697902222e-01; +9.948448951397123e-01   +7.100229059918243e-01   +5.931029606165107e-01   +2.676315778594237e-01   +1.030839121847534e-01   +2.661658711850397e-01   +6.922385840136251e-02   +3.389530598715330e-02   +4.161900677157265e-02   +6.332221906696975e-01   +2.836095382749496e-01   +6.093621718262625e-01];
L2E_Input1_iAMPA_netcon = [+9.977139988339767e-01   +9.893814882116687e-01   +9.998787755846757e-01   +9.871220766958044e-01   +9.887938282762837e-01   +9.971355138610412e-01   +9.849062952703916e-01   +9.935830656149274e-01];
L2I_Input2_iAMPA_netcon = [+9.941811205345904e-01   +9.983669432313790e-01   +9.897553320812291e-01   +9.898559951646930e-01   +9.891427895109266e-01   +9.889062294991371e-01   +9.951207431924468e-01   +9.935917473480103e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
