function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.130498606760450e-01   +9.510433220539700e-01   +6.968403006261905e-01   +1.672462345997369e-01   +9.164891673999285e-01   +2.160887893149681e-01   +7.414027529731229e-01   +3.092718504704534e-01   +5.414350631862422e-01   +8.430327626893678e-01   +9.753475381311094e-01   +9.712125801809662e-01   +6.983162802881105e-01   +3.656683277382204e-01   +2.972313850018973e-01   +3.846472633557038e-01; +3.470420112201657e-01   +9.595873034012450e-03   +1.397968300801475e-01   +1.708601214239719e-01   +7.508655885478718e-02   +8.135238801872248e-01   +7.958236618080580e-01   +7.578708624297982e-01   +7.924680428421440e-01   +1.929409364963633e-01   +4.708352299728249e-01   +6.654747557795820e-01   +3.683945721879893e-01   +2.755970778203888e-01   +6.910063811227827e-01   +9.676215366231438e-01; +2.046892157509836e-01   +4.767663321048313e-01   +8.644028951108239e-02   +7.049897373015337e-01   +3.189051568468932e-01   +3.814852459022523e-01   +6.570280581577869e-01   +9.570884613351458e-01   +5.231330726361094e-02   +9.257454531213211e-01   +8.692808991086206e-01   +2.025898875308967e-01   +5.490088938734456e-01   +7.484338423692623e-02   +7.845168413598488e-01   +8.106651328655868e-01; +2.610161884279200e-02   +4.879002894046638e-01   +4.263345933733949e-01   +8.370595141158513e-01   +6.369607945229803e-01   +8.583700228052012e-01   +4.391006412027451e-01   +5.038269898497840e-03   +4.641155933029700e-01   +4.225516356083053e-01   +9.439941667328355e-01   +9.017865560891126e-01   +5.124511135238817e-01   +1.590685554087037e-01   +7.133400961788481e-01   +8.923254882045872e-01; +7.699377150119781e-01   +5.145414781369031e-01   +9.014731160948655e-01   +8.497393717412860e-02   +9.043441298187721e-01   +3.219867849279612e-01   +5.808823842043738e-01   +3.987064823745995e-01   +9.372346196108442e-01   +3.035510067746229e-01   +2.446950760741953e-01   +4.802101713103348e-01   +7.702504949080909e-01   +3.617010811337507e-01   +2.715454298864682e-01   +6.741431867537151e-02; +5.698017024627799e-01   +2.921649638358508e-01   +7.156093260020266e-01   +8.359916105386372e-01   +8.002134326847513e-01   +3.785835102345287e-01   +5.131135796724616e-01   +1.577203668579537e-01   +4.824135817677241e-01   +3.543435354166138e-01   +9.237145310652977e-01   +6.714770047466041e-01   +7.597863385607194e-02   +7.159234971421944e-01   +1.774294695265041e-02   +9.013409039767919e-01; +5.797143864859187e-01   +5.578969889571084e-01   +6.869683555503817e-01   +5.527565690509578e-01   +6.475734866720061e-01   +6.434535428115717e-01   +7.297850566329872e-01   +8.294358985369202e-01   +7.822676783463025e-01   +9.784474725229793e-01   +6.361576508386961e-01   +5.317666555293007e-01   +4.497737020110175e-03   +5.416942828157850e-01   +1.379968661111253e-02   +6.751902027310531e-01; +3.897163680873121e-01   +5.221951953958833e-01   +2.037895083018592e-01   +9.654340511452123e-01   +4.475668191266433e-01   +3.940985389561526e-01   +2.228565559666112e-01   +2.854054315546352e-01   +1.120198125705447e-01   +5.367015326330509e-01   +2.872043283342230e-01   +7.073390024977481e-01   +4.004138013673604e-01   +2.322936011152594e-01   +9.281438965766712e-01   +3.461156122316405e-01; +5.511177909107174e-01   +6.734380234177986e-01   +5.252518021301663e-01   +6.710944881237666e-01   +7.483530045422767e-01   +7.268364397352454e-02   +9.986271619176964e-01   +9.837226133628320e-01   +5.233667833460466e-01   +7.991145183673379e-01   +8.508778008076634e-01   +7.157158102985871e-01   +6.638544996624507e-01   +4.656781992235052e-01   +9.349648037091869e-01   +8.410910411013850e-01; +1.862042000796138e-01   +6.195268528296698e-01   +8.204147803617524e-01   +3.409001735412758e-01   +8.288607939418168e-01   +1.435335149817479e-02   +6.213818389670858e-01   +6.266427690019853e-01   +6.392695283962780e-01   +8.023427900310542e-01   +1.643912906449953e-01   +3.007100685554691e-01   +3.742713486877936e-01   +7.211041577425793e-01   +3.695161068822824e-01   +1.963358792601166e-01; +1.158461722645805e-01   +5.672874001765229e-01   +1.835683943851493e-01   +2.117817986322178e-01   +3.481983765967773e-01   +8.762693531877479e-01   +9.956406642271842e-01   +7.425530651190845e-01   +5.802036561772130e-01   +1.382324345897459e-01   +8.262094738580696e-01   +1.071240474538489e-01   +3.986672565784142e-01   +5.192609013472813e-01   +1.029160278769253e-01   +8.469153421926260e-01; +5.560553653194603e-02   +5.073434325380205e-01   +5.153303055926519e-01   +5.684428199543113e-01   +1.540785487557630e-01   +1.621150511397489e-01   +4.940628374521901e-01   +8.837929202498060e-01   +8.390815134391141e-01   +4.535261916922549e-01   +2.179430982635659e-01   +3.339714087560613e-01   +1.405482219547916e-01   +5.108193722335919e-01   +7.201915900691831e-01   +4.266297782558284e-01; +9.362905681077035e-01   +6.689958560725876e-01   +3.542834461569363e-01   +1.900482915483776e-03   +5.031356601095418e-01   +9.205441500925231e-01   +5.323497416741531e-01   +3.346213199507924e-01   +1.137528402389013e-01   +4.550785613943392e-01   +2.762026673604007e-01   +4.607842011264557e-01   +3.413899778634021e-01   +3.986496035628591e-01   +4.556621939935429e-01   +5.576350171298038e-01; +7.449768822115445e-01   +6.347131249676027e-01   +6.537618168357477e-01   +5.922179594132182e-01   +4.089263136896203e-01   +5.643830826078847e-01   +8.619812808165139e-01   +9.490849241960454e-02   +5.454153857625978e-02   +9.633424200800996e-01   +9.199903896252085e-02   +7.196530333197578e-01   +1.233894176983693e-01   +4.780154249670293e-01   +1.133709277475941e-02   +4.458338664500358e-01; +2.373708215346732e-01   +1.468790204377705e-01   +2.846529307434252e-01   +8.980308862380887e-01   +1.736833793509982e-01   +9.257014510634457e-01   +2.531371292269116e-01   +4.454540720100050e-01   +5.189846389863759e-01   +5.054039132157109e-02   +9.192378261145918e-01   +4.025795690013631e-01   +3.713931752114472e-01   +7.466495885103810e-01   +1.189051835876736e-01   +7.631531732502128e-01; +2.031368402401796e-01   +1.838139694735639e-01   +4.356233211519097e-01   +2.575660138226086e-01   +4.965070354716959e-01   +5.978533738981291e-01   +5.772453845420757e-01   +2.398263337500978e-01   +7.031451405171623e-01   +3.720516638779559e-02   +7.299622137764233e-01   +2.448541540598805e-01   +2.459061531541235e-01   +7.043414205418521e-01   +6.641686662275461e-01   +9.682393272470279e-02];
L1E_L1I_iGABA_netcon = [+8.464760754404907e-01   +7.543010614628546e-01   +8.719301075581559e-01   +4.369152263390215e-01   +9.219238649738825e-01   +7.734994433616096e-01   +3.251003546705755e-01   +6.421460437992926e-01   +9.346697341569002e-02   +2.814348848711121e-02   +1.285803526918841e-01   +5.193565023557261e-01   +8.819707773629391e-01   +5.738071856929475e-01   +1.722020947087201e-01   +6.435571897456454e-01; +6.198574620413975e-01   +9.976037235030408e-01   +3.138621436980429e-01   +1.415194192546704e-01   +8.971316862883503e-01   +2.797004406559956e-01   +9.687634453111876e-01   +4.440268561525433e-01   +2.961783678939764e-01   +5.106826929733997e-01   +4.381873621516704e-01   +2.053471435214121e-01   +8.065401200866734e-01   +2.942787442217156e-01   +5.224080809624611e-02   +3.393075939402322e-01; +6.686207896959017e-01   +3.711416463012647e-01   +4.297809547319967e-01   +6.567645272626269e-01   +5.876505593740257e-01   +5.214807887507213e-01   +3.556338113938314e-01   +4.843661866377668e-01   +3.326572887453312e-01   +8.701085099141285e-01   +4.825813121689382e-01   +7.777145743143489e-01   +6.501034079950176e-01   +1.450277012070237e-01   +2.252055588215098e-01   +1.523289922757050e-01; +7.855000087252211e-01   +5.096298592881731e-01   +3.801158251103036e-01   +7.332641333669355e-01   +8.378494743486666e-01   +4.158916467412336e-01   +3.208556205873732e-01   +9.785060687389821e-02   +4.796127504042906e-01   +5.805226011811560e-01   +6.811070933072717e-01   +3.881830105208645e-01   +7.370194808032061e-01   +4.729000769901039e-02   +2.009373532925167e-01   +4.018391735220209e-01; +3.156559299663173e-01   +7.607219627765103e-01   +6.576437638835504e-01   +1.721020669320558e-01   +7.861653148470601e-01   +7.856260370529090e-01   +9.170334150551650e-01   +8.080845795789271e-01   +2.418395607997151e-01   +4.235979812061913e-01   +3.507341857253124e-01   +6.628237997504335e-02   +6.684605705965668e-01   +6.209949370554806e-01   +2.096985740456156e-01   +9.200627500750621e-01; +3.248451317609522e-01   +1.365359494065316e-01   +2.464211165470292e-01   +3.400362664710488e-01   +7.942403313247476e-01   +2.679119480026036e-02   +8.851397644625700e-01   +6.316021707717499e-02   +4.597110975099178e-01   +7.262622078165382e-01   +4.763145141589978e-02   +7.525091585432794e-01   +8.883568343116305e-01   +6.079330111384827e-01   +5.856085796985392e-01   +1.570895292785419e-01; +6.270825517811888e-01   +5.187270198365548e-01   +6.894998268539406e-01   +1.013692845019525e-01   +6.989986267078045e-01   +4.065368530237088e-01   +3.630983114064213e-01   +9.559591889404222e-01   +7.572184948437209e-01   +2.271657977126404e-01   +2.928757535275235e-01   +4.604185321114061e-01   +8.551126657933533e-01   +3.736725639439477e-01   +3.383089993909772e-02   +4.645071261641345e-01; +9.045459945433382e-01   +9.114819905452114e-01   +3.293220830865869e-01   +4.394484646516915e-02   +1.429446451712530e-02   +8.327295075047864e-01   +7.421747639835151e-01   +7.773874341753375e-01   +7.170793041565964e-01   +5.822440470447451e-02   +8.094043008979054e-01   +3.103671602358477e-01   +4.088901358088128e-01   +8.367096545714359e-01   +7.980845179150368e-01   +8.122712224514934e-02; +3.713753857686785e-01   +9.877416737434087e-02   +8.813272927685238e-01   +4.783538198563086e-01   +3.305275508351087e-01   +5.921072430249428e-01   +1.209142489532530e-01   +4.493875570401267e-01   +2.357411530747156e-01   +9.777639632320270e-01   +6.530655989297220e-01   +2.710072399961338e-01   +1.137715277828550e-01   +5.183709915872584e-01   +1.430162581003396e-01   +3.392072818906067e-01; +8.892847031610333e-01   +1.871936258651156e-01   +9.998412578993651e-01   +4.774148187828469e-01   +9.555203974560226e-01   +2.117329111499398e-01   +5.976556070531577e-01   +1.686827533043120e-01   +6.997318763146791e-01   +9.774733308279675e-01   +7.150625342381968e-01   +5.770853721611285e-01   +4.109983035954936e-01   +8.181081369618958e-01   +5.792967565242004e-01   +4.917775961678547e-01; +1.139987899095629e-01   +1.743540331653794e-01   +6.893880325017592e-01   +5.542764154073949e-01   +4.075456994467396e-01   +2.944125579860640e-01   +4.353052849429314e-01   +8.001800670536617e-02   +3.040617763682884e-01   +1.270438168335301e-01   +7.584613556207335e-01   +9.147676709924375e-01   +3.343397019105354e-01   +5.845026322177597e-01   +8.388589770882085e-02   +5.039419175850155e-01; +9.116394992469708e-02   +5.373988163965910e-01   +3.519687584585909e-01   +6.451063569847544e-01   +6.292699024939923e-01   +2.706060767754882e-01   +9.684672673558676e-01   +7.459126409922171e-01   +4.729893571608152e-01   +4.963833102777181e-03   +3.926646362752305e-01   +4.509612755673501e-01   +1.077952012299258e-01   +7.135525615982981e-01   +2.268330411367867e-01   +1.296057154090537e-01; +5.434231952636784e-01   +9.771953142206524e-01   +5.613600245953098e-01   +3.514763155810799e-01   +8.534466120275050e-01   +9.417946060789529e-01   +9.810695005519243e-01   +5.348597143548655e-01   +4.343465065158348e-01   +9.362952323985884e-01   +3.648410561771256e-01   +9.817081515698006e-01   +8.638735924330784e-01   +7.340175692876787e-01   +4.395581726470591e-01   +7.626349654846640e-02; +6.024097193450518e-01   +8.435473172416569e-01   +8.964605565416550e-01   +2.554421362213564e-01   +3.720540713812758e-01   +5.585522799408544e-01   +2.503012812465867e-01   +4.890843414885881e-01   +7.327252017678092e-01   +7.420351961725260e-01   +8.123462030136956e-01   +1.048633040320648e-01   +9.039435299971886e-01   +4.474247503289434e-01   +1.768019704735586e-01   +6.716316650550282e-01; +7.286546377110792e-01   +6.698829953547475e-01   +6.524305245757435e-01   +1.837876539490372e-01   +2.058410706156250e-01   +4.378842981991505e-01   +7.813452571280258e-01   +8.905127934520247e-01   +8.771643373493926e-01   +4.287512241177162e-01   +3.902238129282413e-01   +4.208395018010258e-01   +6.956761615736055e-01   +2.801925216507595e-01   +4.169213194584038e-01   +1.170856555121270e-01; +9.936848616860496e-01   +1.443197412048659e-02   +3.847753123279389e-01   +4.801111922393459e-01   +9.113482109260962e-01   +3.239668162900652e-01   +7.129031418399109e-01   +5.899156460400645e-01   +9.127601796883484e-01   +9.486726118944565e-01   +8.748539243275947e-01   +3.942711718130578e-01   +7.500885703248394e-01   +1.585196747909846e-01   +9.708924943296354e-01   +9.858714780926486e-01];
L2I_L1I_iGABA_netcon = [+5.728966687549115e-01   +5.672222644836010e-01   +1.037707765464209e-01   +4.542009935537111e-01   +8.002829756690567e-01   +9.690278484393129e-01   +2.243153219535989e-01   +7.548779133842829e-01; +5.568715773327149e-01   +9.493376285428322e-01   +1.387415285533029e-01   +5.693043936554737e-01   +5.434156810562125e-01   +4.238884330162304e-01   +6.300922854736495e-02   +5.000953646667716e-01; +6.047845884504942e-01   +1.593972538229440e-02   +4.362478563181882e-01   +8.180494988662830e-01   +2.589017783604354e-01   +3.910240362779545e-01   +8.330386663648670e-01   +8.239365157152747e-01; +4.680294366633120e-01   +1.214105650932795e-01   +9.305119450758748e-01   +3.615947977290567e-01   +7.777471845013544e-01   +4.569736167123015e-01   +3.948443261857905e-02   +9.137882739726467e-01; +4.367688752883375e-01   +8.565796089402351e-01   +1.367429162379283e-01   +2.409452874452501e-01   +7.814550698762164e-01   +1.303649778756331e-01   +9.103447859096642e-01   +7.061048025873774e-01; +7.143094611223752e-02   +2.198538334034884e-01   +8.192969069310414e-01   +7.666328248403154e-01   +1.511489167171916e-01   +4.664656048675188e-01   +4.545961148809474e-01   +8.056896519461736e-01; +6.363370649292751e-01   +7.002792300873283e-01   +9.333481921899437e-01   +2.191040333705244e-03   +8.283728786992669e-01   +2.680503423391676e-01   +2.830002017567747e-01   +9.643362070881979e-01; +4.279939762535772e-01   +7.771820867966717e-01   +5.759108259058078e-01   +2.771021565293900e-01   +6.225404998311166e-01   +1.024880316699122e-01   +7.556013781753754e-01   +9.476123200730692e-01; +7.522348348301987e-01   +4.265328648139172e-01   +4.957060818290119e-01   +3.253117754250963e-02   +4.632418145284086e-01   +6.577371471300352e-01   +9.290300511695340e-01   +2.950145130333380e-01; +3.064918525635407e-01   +7.316390258600886e-01   +9.271664321293620e-01   +6.677063798319054e-01   +4.905952808463450e-01   +9.344204416265179e-01   +1.402811853977790e-01   +3.587331250770820e-01; +5.991882754918076e-01   +4.504196347610134e-01   +8.608061507966114e-01   +9.765935986228238e-01   +2.203476791614414e-01   +7.712937569077571e-01   +9.477612991183408e-01   +5.450134114826461e-01; +3.299645764670983e-01   +8.042594674903389e-01   +2.479814222373727e-01   +9.456717607012158e-01   +8.560763494223734e-01   +3.998387339098328e-02   +3.145991119957710e-01   +2.115435565850613e-01; +6.469447383628313e-01   +4.326614616122492e-01   +4.553742285350317e-01   +5.173996284912644e-02   +8.810482068934941e-01   +2.595901918949338e-01   +2.033667510083776e-01   +7.747463863449157e-02; +3.805541045338435e-03   +1.502273689365648e-01   +7.353027850165204e-01   +2.895940552139110e-01   +8.368257266345887e-01   +6.456725872082598e-01   +4.656740807482074e-01   +5.068578935130263e-01; +1.468138198536645e-01   +8.018375252296526e-01   +7.501684060165175e-01   +4.780492540102950e-01   +4.414058175029540e-01   +8.721061559058491e-02   +5.978376671785730e-01   +1.928426758936392e-01; +2.520854864335180e-01   +3.748831019781962e-01   +2.369109162029006e-01   +8.860093720100986e-01   +5.441718101233520e-01   +7.428107012281469e-02   +5.464446939589731e-01   +1.394997932364848e-01];
L1I_L2I_iGABA_netcon = [+7.135152353629992e-01   +8.741037100801411e-01   +6.154905760711445e-01   +5.146293748202308e-02   +1.508260401645468e-01   +2.358543790720068e-01   +8.474662195892692e-01   +3.729687570280811e-01   +7.165070222402133e-01   +3.909464277084059e-01   +2.458060620770494e-01   +6.819304490596204e-01   +1.651458775075207e-01   +5.746925100856619e-01   +5.034484329842578e-02   +4.829543904490467e-02; +6.111773550711884e-01   +8.016968325433164e-01   +6.203391424450698e-01   +5.337319650765996e-02   +7.498209069345796e-01   +5.561268326497257e-01   +1.981944468775849e-01   +5.702147932702591e-01   +1.954504927705965e-01   +7.295175831081057e-01   +5.095784644187332e-01   +3.401482421007920e-01   +1.151762148547003e-01   +8.157211398201312e-01   +4.350763378864316e-01   +9.274652763298851e-01; +1.610484843427566e-01   +6.232426390504325e-01   +3.134341678768400e-01   +6.041256381916595e-01   +9.532341048343165e-01   +1.158772081724062e-01   +6.140155450391257e-01   +8.398051881415072e-01   +2.375656186471720e-01   +6.365141621771707e-01   +7.381842420506721e-01   +5.515959837109690e-01   +7.486617278516875e-01   +6.778549629441615e-01   +9.260034479062881e-01   +1.778116373646413e-01; +4.857900076851546e-01   +4.813349007762246e-01   +1.326115957867200e-01   +6.641170992105473e-01   +2.638399665170029e-01   +8.260326754224273e-01   +1.586637746444643e-01   +7.182239491509533e-01   +9.958792657138981e-01   +9.648109646578648e-02   +7.846734497249046e-01   +5.375028870305693e-01   +2.165792723595703e-01   +4.436920217188933e-01   +8.858269474019580e-01   +7.497940157730555e-01; +2.863723798582148e-01   +2.081077576250263e-02   +6.060552102244221e-01   +4.890271884209406e-01   +9.177527460558339e-02   +6.561255699070997e-01   +5.840489515700685e-01   +1.127562412899386e-01   +9.086926911419192e-01   +5.029086846848628e-01   +6.824981873945133e-01   +9.063793107203394e-01   +4.879061102417730e-01   +8.982532213563328e-01   +9.466758282594630e-02   +4.713361968654733e-01; +3.994458926142551e-01   +1.279718129426686e-01   +8.986096180784172e-01   +9.853591555900811e-01   +2.327588628806849e-01   +2.298959133558062e-01   +5.446655122178968e-01   +7.456425511717450e-01   +1.175548397804735e-02   +5.594278371953063e-01   +8.171706206850122e-01   +2.853182260052688e-01   +4.383466875488167e-02   +7.890549888698151e-01   +6.880977794597950e-01   +2.489882695466717e-01; +4.927313204198908e-01   +7.246519816163740e-01   +5.712324102742884e-01   +8.673926718779811e-01   +8.987243493210276e-01   +3.041368998494800e-01   +6.933642718687556e-01   +9.248149976501118e-01   +8.391945221637478e-01   +5.373545054827267e-02   +4.278908541000757e-01   +1.365661848301685e-01   +5.819476395680515e-01   +5.901754761693083e-01   +1.445178489192780e-02   +6.638554481630080e-01; +8.643186448036956e-01   +6.719565409226926e-01   +6.402780160781313e-01   +9.610331395245729e-01   +2.001111126409152e-01   +3.270987270249676e-01   +7.018774371318567e-01   +9.314619951907964e-01   +2.541542922356186e-01   +8.391233639673393e-02   +4.928041960273162e-01   +9.590031378742021e-01   +4.978913332153385e-01   +6.255776960632136e-01   +1.258483243451891e-01   +6.188611297331033e-01];
L2E_L1E_iAMPA_netcon = [+3.705608177695389e-01   +5.650529657029407e-01   +1.990553400002644e-01   +5.198671250022140e-01   +2.933721765888252e-01   +7.016581948940957e-02   +2.829031545261101e-01   +2.628869369490732e-01; +4.370419010795691e-01   +1.880520415520038e-01   +1.457647821993971e-01   +6.844110278319591e-01   +6.130579184259952e-01   +5.900763192797809e-01   +9.322641413598263e-01   +8.990399742763286e-01; +7.255355170477293e-01   +6.027234014761746e-01   +7.445174205665063e-02   +2.143406034539193e-01   +8.656987809715250e-01   +7.878209935690800e-02   +7.571856988703647e-01   +1.583035132709118e-01; +1.986561988914655e-01   +7.301608167373389e-01   +9.415115801682801e-02   +9.699776743138321e-01   +8.141849058400947e-01   +3.938352750731371e-01   +2.591570001941605e-01   +5.500443158111616e-01; +4.669609459446021e-02   +8.355999817502954e-01   +5.503683968304676e-01   +3.438500418300098e-01   +2.091949196852282e-01   +5.345095166761524e-02   +2.431696126553798e-01   +4.254870906306937e-01; +3.114072167400473e-01   +2.770390887864231e-01   +7.310728257140173e-01   +1.847486211513110e-01   +7.542153322660013e-01   +1.285174760271147e-01   +1.634568181151239e-01   +5.453594467681647e-01; +7.926363889708924e-01   +6.085191660399729e-01   +5.494846230833524e-01   +2.438950513611605e-01   +2.036346132457015e-01   +2.354340788996910e-01   +2.939041400954143e-01   +7.497354851685160e-01; +4.220430315085539e-02   +5.480966723700911e-01   +4.461932516064228e-02   +2.617601448905723e-01   +5.825189762513270e-01   +9.437524537940483e-01   +5.688590974479928e-01   +1.562326802159782e-02; +2.134875329404488e-01   +2.804501341878709e-01   +6.388719997248063e-01   +2.175159945106598e-01   +8.739062642729771e-01   +2.077888644202667e-01   +3.977267563056077e-01   -3.337512469026297e-04; +2.677181566238550e-01   +3.397458127361561e-01   +9.873773836649037e-01   +3.659241389632138e-02   +7.169805374622615e-01   +3.278615653072084e-01   +9.828317441033643e-01   +2.063354310310743e-02; +7.913706993111549e-01   +5.725933358772365e-01   +9.141314646108185e-01   +3.511819479129191e-01   +6.954805240058574e-01   +8.674455831794329e-01   +5.476883991871450e-01   +3.463955603380844e-01; +9.787602325032349e-01   +7.488063705818514e-01   +7.765630172807176e-01   +8.989722916829522e-01   +4.609147307727363e-01   +9.265570832501959e-01   +9.327569580043269e-01   +4.259721380528567e-01; +9.149979914898665e-02   +7.666053632610327e-01   +1.922819415857714e-01   +1.394798816667949e-01   +5.019219488026795e-01   +1.961061884362431e-02   +9.885658575055239e-01   +5.412730997000667e-01; +1.960767862047836e-01   +4.005852274506945e-01   +3.119741320821950e-02   +9.500446081543003e-01   +7.972600418949395e-01   +3.658846510335111e-01   +8.306257661380771e-01   +4.817279802465209e-01; +1.181258400773606e-01   +1.564016554699118e-01   +3.812541218791767e-01   +9.040296082716615e-01   +9.398675503741778e-01   +5.356375433251699e-01   +1.781721453634271e-01   +9.121837705670517e-01; +6.444777145889440e-01   +2.057443855567467e-01   +5.756511127896773e-01   +4.116944702227354e-01   +7.934437705919924e-01   +4.104852153070153e-01   +3.140145045398401e-01   +4.188776422081933e-01];
L1E_L2E_iAMPA_netcon = [+4.974438279233971e-01   +4.602062713712886e-01   +6.156697226094783e-01   +4.938632539568839e-01   +2.367159213460155e-01   +7.173455142993976e-01   +6.840010350475214e-01   +6.357690277097833e-01   +5.206541468364393e-01   +2.416550851401984e-01   +8.735422242946183e-01   +1.739016609474391e-01   +1.367834839829535e-01   +2.433031244373693e-01   +1.859888171209944e-01   +3.262641019412752e-02; +8.405870523773005e-01   +3.669987506639064e-01   +1.017445025841052e-01   +6.611531305281911e-01   +8.367259312927867e-01   +3.761977429376687e-01   +9.756551790977013e-01   +6.227102362682094e-01   +6.726960700377353e-01   +7.292819461952850e-01   +6.628059294419140e-01   +3.001829289671126e-01   +2.891519716141968e-01   +7.435562877882139e-01   +1.549332197804812e-01   +2.496519050130295e-01; +1.825413298334294e-01   +2.949505289371420e-01   +7.582232748734316e-01   +1.746677580833398e-01   +7.306678301521642e-01   +3.801502093191517e-01   +7.556181312942429e-01   +4.091580832270367e-01   +7.750526345507533e-01   +1.250928271826382e-01   +5.451321334063609e-01   +1.031977030424996e-01   +4.395557742435208e-03   +9.328871371011417e-01   +1.345733755861094e-01   +9.899799863813832e-01; +3.426039587013853e-01   +2.382115303055653e-01   +5.397242987173628e-01   +4.769990761509351e-01   +4.892356970360479e-01   +7.132005057825451e-01   +5.510963601061504e-01   +4.335282468277707e-01   +4.614079453630396e-01   +3.644743239689143e-02   +2.430583645864836e-01   +4.577407718238614e-01   +3.094562218451112e-01   +3.695961146095577e-02   +1.625981750658174e-01   +6.350404567779576e-01; +6.937891084950795e-01   +1.362942265046924e-01   +4.444948160582908e-01   +5.041798527712470e-01   +8.489370147715519e-01   +8.306370090973282e-01   +2.444790146930715e-02   +5.116210409444699e-01   +9.087993264922971e-01   +6.474431146675980e-01   +1.111626031617461e-01   +5.865432303113777e-01   +9.078897857016015e-01   +4.280576124970185e-01   +9.227465184118223e-01   +3.527983255733341e-01; +6.869646012399301e-01   +1.015885631103562e-01   +7.422511263199585e-01   +5.997447480876414e-01   +7.183991483299844e-01   +6.676912312317823e-01   +1.927727152884715e-01   +2.617418615861088e-01   +2.433890208429741e-02   +1.972469572567933e-01   +9.699777701729162e-01   +2.158826719752017e-01   +2.951786003269525e-01   +8.219579590648743e-01   +2.633241657017446e-01   +9.906047584684884e-02; +3.690053078159435e-01   +2.377165447180218e-01   +3.875084757485218e-01   +2.440893947108055e-01   +5.174522683102635e-01   +6.482397571015165e-01   +9.423858175377422e-01   +4.223610366176397e-01   +4.875567523565780e-01   +9.765267355268205e-01   +5.873666932327928e-01   +1.064435970124937e-01   +8.249459353889372e-01   +9.969874497217874e-01   +2.033445202813417e-01   +4.140423110890737e-01; +3.153376392981776e-02   +3.501168772302796e-01   +5.321178665950645e-01   +5.221967464383597e-01   +9.388621859490628e-01   +5.602017195673055e-01   +3.925979139844015e-01   +5.147094761731587e-01   +2.705931555421252e-01   +8.285319935539341e-01   +8.166019923162186e-01   +5.612470419418153e-01   +7.340167668719969e-01   +9.205559632928433e-01   +6.205034978526223e-01   +9.292260167947013e-01];
L2I_L2E_iAMPA_netcon = [+6.795302204913456e-01   +6.174461788307809e-01   +3.930636574083617e-02   +7.998724186406305e-01   +5.177970110883477e-01   +8.239189545910357e-01   +6.490671246701224e-01   +3.870343927286479e-01; +2.041531712565956e-02   +9.440969180819528e-01   +5.601747905244042e-02   +9.384893765858039e-01   +6.445433868672699e-02   +1.091417432233052e-01   +3.178474844514016e-02   +1.703221231821513e-01; +7.291470200367525e-01   +9.617994489941791e-01   +4.074764579685384e-01   +9.419210539192318e-01   +2.917874949239568e-01   +2.350450489756357e-02   +5.634918489285775e-01   +4.451900582742726e-01; +2.166541056182534e-01   +3.681889437547546e-01   +9.789418448108521e-01   +1.431039711545684e-01   +7.141882265760422e-01   +7.296186016500326e-03   +3.103072274714619e-01   +8.751028960314349e-01; +8.522802154035670e-01   +7.937327088320305e-01   +7.110934121346159e-01   +3.260009126497936e-01   +8.853872589040995e-01   +3.374999026317211e-01   +2.610768962308528e-01   +4.042277926625775e-01; +1.572005945656464e-01   +7.212952185250268e-01   +9.961776623293325e-01   +4.232742174513602e-01   +3.697429872320183e-01   +6.641902555935917e-01   +7.188756963511241e-01   +1.697213562320803e-01; +6.681797613056635e-01   +9.490102169333484e-01   +6.517120786884782e-01   +7.069318386017580e-01   +5.592280366016541e-01   +5.923878864942390e-01   +3.065943311518112e-01   +6.639125312501716e-01; +9.310891503465665e-01   +1.373641906196804e-02   +5.032545271948010e-01   +6.188535442835497e-01   +8.780135633371610e-01   +8.151151460136727e-02   +9.007658644172217e-01   +9.278977085534683e-01];
L2E_L2I_iGABA_netcon = [+6.578812018822734e-02   +5.229604561093500e-01   +3.409374326799517e-01   +2.585579048046873e-01   +4.247734266708509e-02   +9.043076208956219e-01   +3.425946329857371e-01   +4.555916085100769e-01; +3.580035561081746e-01   +6.313060606222799e-02   +5.548869991501133e-01   +9.808800092152539e-01   +3.628468719946562e-01   +5.566583811918970e-01   +9.389103334183211e-01   +6.686666681829171e-01; +9.278516887189245e-01   +1.788571239214964e-01   +6.838938292295776e-01   +3.489792759897132e-01   +4.110491759670945e-02   +7.096782706099239e-01   +9.090991650500696e-01   +7.689907154283599e-01; +2.392295969884875e-01   +3.162990803866759e-01   +2.440464746818151e-03   +3.934110267967519e-01   +4.883810840585168e-01   +7.151967606392026e-01   +7.303980338365077e-01   +9.285912171310490e-01; +1.135246261818198e-01   +2.438158543406017e-01   +4.867045852315677e-02   +7.510745599774123e-01   +7.301303667096394e-01   +1.759561574723538e-01   +4.455552978328752e-01   +6.497540475544743e-01; +7.114014676806504e-01   +3.205535641357576e-01   +3.068344063565425e-01   +1.077932084553922e-01   +1.415465401417452e-02   +3.509119290615037e-01   +1.471625603120000e-01   +5.019759883019990e-01; +2.851224160565671e-03   +8.722977342274379e-01   +8.740775600174362e-01   +5.974082958466315e-01   +5.068316068706791e-01   +3.690740292961149e-01   +8.298919387244774e-01   +3.418554040654241e-01; +1.772288927182122e-01   +3.005570368603991e-01   +6.276713385597571e-01   +1.246938415758090e-01   +2.528682935565381e-01   +7.601846448854119e-01   +2.511574581563415e-01   +9.424420249160969e-01];
L3E_L2E_iAMPA_netcon = [+7.522854698832905e-02   +1.648685621369643e-02   +3.705571957418531e-01   +4.938521658052909e-01   +1.768283273055790e-02   +9.644269675305367e-01   +3.616397139647534e-01   +1.836724233592138e-02   +2.036492147404070e-01   +6.740587799714051e-02   +2.431682078371485e-01   +9.983822314230897e-01; +9.527116258964045e-01   +9.823469786864641e-01   +1.243235691592471e-01   +6.397466845532954e-02   +8.090148884666850e-01   +3.839500451727766e-01   +2.321549899400588e-01   +1.261149790054731e-01   +3.550559130349040e-01   +7.515766172361992e-01   +5.390189239636600e-01   +3.403240967700410e-01; +6.655840399474170e-01   +7.254302943487756e-01   +5.068372417270901e-01   +8.729668137488116e-01   +7.955940722418354e-01   +6.622761938998597e-01   +7.226916903815831e-01   +6.677616794802618e-01   +8.962377349119875e-01   +9.989645549327025e-01   +3.347188429507333e-01   +8.323421782247963e-01; +1.698425041357527e-01   +8.790877832720388e-01   +7.288460622998235e-03   +9.970471353089341e-01   +4.138476247183336e-01   +5.843967470187648e-01   +7.761343127605583e-01   +5.094701930617340e-01   +8.199272124172320e-01   +7.715181635921065e-01   +6.693521624462414e-01   +1.134469108220169e-01; +2.023327508081862e-01   +8.124382798223450e-01   +8.699226710918438e-01   +1.235383895615649e-01   +6.397302149505439e-01   +4.791953488384870e-02   +3.348651613547407e-01   +7.702161389305796e-02   +3.145501476806191e-01   +8.911875159896020e-01   +8.771281567974205e-01   +7.812755050923917e-01; +9.893340609668901e-01   +3.818745338949393e-02   +9.100928120295785e-01   +1.035813606830379e-01   +5.651612042413090e-01   +7.616477699803637e-02   +5.692785350753033e-01   +5.358920666952464e-01   +5.982209206516129e-01   +4.070555731334528e-02   +9.754271873137904e-01   +1.566544205837800e-01; +9.370982784164207e-01   +9.614692050032181e-02   +1.115911386737040e-01   +1.465408650778324e-01   +9.125834931055280e-01   +2.312345070600183e-01   +6.363101671138673e-01   +6.868324154765085e-01   +7.021967598389802e-01   +7.957810432386714e-01   +1.324304831299162e-01   +7.301303991332840e-01; +9.830275925058080e-01   +9.557350153115723e-02   +4.142727272333617e-02   +1.310277685112021e-01   +7.517071012051724e-01   +4.150610624492875e-01   +3.634738699179846e-01   +5.872551302219520e-01   +1.770856470104654e-01   +7.152228711356725e-01   +8.848850375374325e-01   +1.183985691507732e-01];
L3I_L2I_iGABA_netcon = [+7.680791662919694e-01   +5.391982263797159e-01   +5.988790916423353e-01   +3.092313928081779e-01   +9.613471992391333e-01   +1.126713560866408e-01   +2.937648986788513e-01   +7.929331428599802e-01   +9.163305419131849e-01   +9.932730092257649e-01   +3.095353197374019e-01   +9.970357660706304e-01; +6.386634505077484e-01   +4.529586943168001e-01   +5.631415833720883e-01   +7.612545961167870e-01   +5.475634901769635e-01   +6.598444592007721e-02   +1.648705953837510e-01   +5.037935057152961e-02   +3.870454340204943e-01   +2.921903834990464e-01   +4.428473030919445e-01   +9.206686500208929e-01; +8.021206150928644e-01   +1.154458089214136e-01   +7.178762668433268e-02   +6.523877930151660e-01   +9.780363483423468e-01   +4.568827678528688e-02   +7.249270650975939e-01   +1.873337459857710e-01   +7.509080460843341e-01   +5.228811568021802e-01   +2.035070928647525e-01   +6.925443540525200e-01; +9.649932899829566e-01   +7.187535733698491e-01   +7.631460639108656e-01   +3.312712884183456e-01   +1.225494674358611e-01   +1.262099791252928e-01   +2.979753181410966e-01   +2.470627714609072e-01   +8.756336345573900e-01   +3.645154337717765e-01   +9.405261136783952e-01   +2.194283004601645e-01; +7.129172600429912e-01   +1.868076053545299e-01   +8.685420080245843e-01   +9.785997524457600e-01   +1.580419983492778e-01   +4.924495252504987e-01   +6.743018773306538e-01   +2.571380369216635e-01   +4.009946400472179e-01   +5.227960264118306e-01   +2.875098585133344e-01   +3.112609277984976e-01; +6.466004265798835e-01   +3.238668361674691e-01   +6.985103979569409e-01   +5.317319891856962e-01   +3.354471130289435e-01   +4.686860529060605e-01   +7.549513504264894e-01   +6.503218338298897e-01   +1.698557203390510e-01   +4.974283699324004e-01   +1.139010795263725e-01   +2.272878206461994e-01; +5.186153785119357e-01   +9.706544648265822e-01   +1.145113385390966e-01   +7.543332299159284e-01   +5.281218140449394e-01   +1.570389378739786e-01   +7.453841904106332e-01   +1.018254152255030e-01   +4.435656253899778e-01   +1.846310576091970e-01   +6.548317681638889e-02   +7.018107104936280e-01; +9.527652228717394e-01   +6.945118155555280e-01   +6.604526684714571e-01   +2.614362761362751e-01   +6.903926517828330e-01   +1.309820095259530e-01   +7.782476131109702e-01   +4.718214552823520e-01   +8.543565666236603e-01   +4.894221803761834e-01   +7.273028558741471e-01   +3.737447737808897e-01];
L2E_L3E_iAMPA_netcon = [+6.517561115731664e-01   +3.801052223337467e-01   +2.343203796247244e-01   +4.673450135718957e-01   +9.125614516928076e-01   +9.505364827542488e-01   +7.628138087326004e-01   +3.546848088465023e-01; +3.758471494303324e-01   +2.911464489718892e-02   +9.108660176772517e-01   +2.891229137750538e-01   +6.830439027321532e-01   +2.032938767298118e-02   +8.919955380184997e-01   +6.619436822130341e-01; +3.038757514335192e-01   +3.281106632872963e-01   +4.892541615237807e-01   +2.725274567081283e-01   +8.427146159943432e-01   +5.041426151992542e-01   +7.891892008583549e-01   +5.942857360294728e-01; +1.574672731720126e-01   +4.978873157184840e-01   +5.892368619256599e-01   +1.449876192261607e-01   +9.157891921121102e-02   +3.350507165024965e-01   +9.419804013671734e-01   +5.378208907479359e-02; +7.791160447358981e-01   +2.703576209439832e-01   +9.542757351801984e-01   +1.421805409598406e-01   +7.341093956942539e-01   +6.663078561489304e-01   +5.353014464160077e-01   +2.099387030361327e-01; +7.140585658463049e-01   +5.325042356659951e-01   +8.427936425692623e-02   +2.642715988246243e-01   +5.534180032076658e-01   +1.593332805849702e-01   +1.572073292104458e-01   +5.950508990291075e-01; +1.787848102252478e-01   +4.184178065715053e-01   +2.210953054441700e-01   +6.054149349837133e-01   +2.493503166413638e-01   +2.214165651483373e-01   +1.318617854992034e-01   +2.654317379494853e-01; +4.480040063717873e-01   +7.317617027738494e-03   +1.580596568472093e-01   +1.029640588203638e-01   +7.229493376749794e-01   +1.126114845166288e-01   +2.646947598206808e-02   +1.173979165571536e-01; +8.403578246950025e-01   +8.967436400697943e-01   +3.868213817111564e-01   +4.912777660193336e-01   +3.639215417848707e-01   +9.921858286098604e-01   +6.852564440913707e-01   +2.124756431398436e-01; +7.007122707479728e-01   +2.397653568608313e-01   +1.856433389116358e-01   +8.965249060194616e-01   +8.475275896451115e-01   +1.453734125035637e-01   +5.804710080164739e-01   +8.762684828275499e-01; +7.629810231073990e-01   +8.044119918616133e-01   +7.630737001151856e-01   +1.843023232801856e-01   +8.267242974162635e-01   +7.662094143454029e-01   +2.950536949282943e-01   +4.631245812061512e-01; +9.786206518547361e-01   +5.808833566721029e-01   +2.331023087881052e-01   +5.461776944339170e-02   +6.197617710244677e-01   +6.287922919354185e-01   +7.264101033714840e-02   +7.326925943671680e-01];
L2I_L3I_iGABA_netcon = [+5.884115684289993e-01   +1.447870533485022e-01   +3.448606477258875e-01   +3.724706626825754e-01   +5.985002667587276e-01   +5.132017085477207e-01   +7.736692710208353e-01   +2.607207728914612e-01; +8.402484408013497e-01   +9.903601438485430e-01   +4.548261955571695e-02   +5.374806265465181e-01   +4.770754336356708e-01   +2.414868049631241e-01   +1.814806413513493e-01   +5.947972048676425e-01; +6.045023310487512e-01   +4.819212855200488e-01   +9.497221082485171e-01   +9.737600070957501e-01   +3.771250005859084e-01   +2.650767489236948e-01   +4.526177416923877e-01   +6.824549373603853e-01; +7.468216807183862e-01   +4.181959395246996e-02   +8.596146854602704e-01   +9.980221063331185e-01   +9.803777171722913e-01   +4.118960817436741e-01   +3.049486834082896e-01   +4.187977860382628e-01; +8.543678897798668e-01   +2.727754495108651e-01   +1.399766058145542e-01   +4.073886710875687e-01   +1.361749788797739e-01   +2.664147401659813e-01   +3.808314610130117e-01   +5.190280858940770e-01; +1.449924925223781e-01   +6.712659136072389e-01   +5.797807284763632e-01   +4.506871140526817e-01   +2.707518398439423e-01   +8.555354327514871e-01   +7.957095056618091e-01   +8.162616817869603e-01; +7.343914418084810e-01   +1.398508129413943e-01   +6.167563631886266e-02   +2.416332305517598e-01   +2.250410911627439e-01   +4.854111999745569e-01   +7.829325129661513e-01   +5.431591317141548e-01; +1.554616874631835e-02   +7.743599229472060e-01   +9.505119814252662e-01   +5.951102261743092e-01   +7.925752105731272e-01   +3.322746563287055e-01   +6.440179476933006e-01   +5.932829033458992e-01; +2.353290839888588e-01   +2.668975662212871e-01   +4.994435882805054e-01   +7.627295637306686e-02   +8.193808514446425e-01   +6.328963943504305e-01   +2.394341095418721e-01   +5.389077661901689e-01; +5.380947727055133e-01   +8.804781618122377e-01   +2.763237390223898e-02   +9.088521767629908e-01   +8.033563418824935e-01   +4.185611780278772e-01   +6.016987362222611e-01   +5.480597928050182e-01; +7.077855917355756e-01   +3.633959513985947e-01   +5.202432143528481e-02   +4.712882110661308e-01   +1.191170529113755e-01   +5.427621661377170e-01   +4.182347225288177e-01   +1.536195959696566e-01; +4.343773518666561e-01   +1.596472923746021e-02   +3.111012625021444e-01   +5.010508254390613e-01   +6.424525819046992e-01   +3.389260083612339e-01   +3.022344067345197e-01   +7.017207471719524e-01];
L3I_L3E_iAMPA_netcon = [+6.184555642270086e-02   +7.789344239929366e-01   +5.595663345349950e-01   +5.659613931799791e-01   +9.170306247288976e-01   +8.332345860650451e-01   +8.518563054113991e-01   +8.699061998993005e-01   +5.316185798228927e-01   +9.905851618145894e-01   +4.806820985070976e-01   +3.501401517407086e-01; +9.209759004684420e-01   +8.314962599532901e-01   +8.514775628092768e-01   +9.376079606102344e-01   +5.911076649923446e-01   +3.999251496284078e-01   +6.301230978452463e-01   +8.591498168672770e-01   +5.730268767122111e-01   +7.022087705951767e-01   +7.396216567521881e-01   +3.958339118599308e-01; +1.832775876268547e-01   +5.959144250683006e-01   +9.738769145535624e-01   +7.746572486528976e-01   +5.795657228783099e-01   +6.731471554991023e-02   +4.410216002144515e-01   +9.461456174554054e-01   +9.792051169444473e-01   +8.393317410010920e-01   +5.910161771742936e-01   +9.969687344234812e-01; +5.360382318158986e-01   +7.603285070046355e-01   +4.693889308487241e-01   +6.030996844272706e-01   +6.530076858136189e-01   +3.789136002722673e-01   +2.305970913956583e-01   +6.955283758304769e-01   +9.595431193432177e-01   +7.288456673210769e-01   +2.534950642833432e-01   +2.873238404389670e-01; +3.953408291224925e-01   +6.611881367563442e-01   +7.748837764301691e-01   +6.428943574899111e-02   +4.328982965259734e-01   +8.606376385120080e-01   +4.901478803399865e-02   +3.649558482832513e-01   +5.616084503192268e-01   +9.968140009985944e-01   +6.148472923569197e-01   +2.330478196712713e-01; +7.100514495849731e-03   +5.888128644232263e-01   +2.304433718006941e-02   +5.335099047003116e-01   +9.411604837510641e-01   +2.670439646459074e-02   +7.040196135669095e-01   +3.832582018511575e-01   +5.228276542600477e-01   +5.071297478447169e-01   +2.262532978733765e-01   +3.350850693480437e-01; +1.082100746893497e-01   +2.217545585183963e-02   +6.749528941003687e-01   +8.594063496855152e-01   +1.025371816765545e-01   +4.265089773035139e-01   +8.526016427623466e-01   +8.535660618660234e-01   +4.745125704573274e-01   +1.977491811627290e-01   +1.906538789255112e-01   +1.650757008780248e-01; +8.558763558058422e-01   +6.905101031974952e-01   +8.371356772129241e-01   +3.426143724823773e-01   +4.122787864910806e-01   +2.469246755326208e-01   +3.987884691282254e-01   +3.830720574893112e-01   +8.987233736897621e-01   +9.545907560553872e-01   +5.097670297106741e-03   +3.864085297722064e-01; +3.336528080438982e-01   +3.268457461537267e-01   +6.925237674955715e-01   +1.833366838920690e-01   +8.950726581881144e-01   +6.894698643748631e-02   +2.937217586498954e-01   +7.701743189839418e-01   +4.824507293243957e-01   +4.508846453365604e-01   +6.504963416688301e-01   +5.289276561725231e-01; +1.424203836859424e-01   +9.033231185824295e-02   +8.996285086684259e-01   +8.846544775949181e-01   +7.366295849883731e-01   +9.198453182298877e-01   +2.522421817889797e-01   +7.823997391678016e-01   +4.941751100190420e-01   +5.997462307933065e-01   +4.014908804172462e-01   +5.936209577589386e-01; +7.970678347188754e-01   +7.467049212978121e-01   +9.226810027079470e-02   +8.442949275321594e-01   +9.624377786441878e-01   +2.667505013219598e-01   +5.089870612278494e-01   +4.255045350128119e-01   +3.101453028198179e-01   +6.450622582727567e-01   +2.666675355503348e-01   +1.698971905558418e-01; +6.552284320235828e-01   +9.734004056242151e-01   +7.723983971281784e-02   +8.268305465567365e-01   +9.754190841251279e-01   +1.062382455414390e-01   +1.143676993161885e-01   +4.907597864674363e-01   +8.560355361475352e-01   +7.524741810299690e-01   +6.530219868685768e-03   +6.160148233984083e-02];
L3E_L3I_iGABA_netcon = [+4.425547334539048e-01   +6.245756671236641e-02   +5.864849822560175e-03   +5.023956733367693e-01   +5.391383085823556e-01   +2.503335563027413e-01   +7.217628306152213e-01   +7.583930192950739e-01   +3.811451785893741e-01   +4.459188627037335e-01   +2.034419418364671e-01   +6.547043499199479e-01; +5.545684972442274e-02   +8.051756368136369e-01   +1.299273520828777e-01   +1.911471717214089e-01   +2.201286112747342e-01   +3.349686401811195e-01   +2.207993813340432e-01   +8.851226279621071e-01   +6.083501429479692e-01   +3.911803578897711e-01   +8.290793864169618e-01   +8.996645181801978e-01; +6.292837709734226e-01   +9.143190941138818e-01   +3.061082491203432e-01   +6.456751519286440e-01   +2.656730712694512e-01   +5.975755808774421e-01   +4.924847284803924e-01   +7.297973800273668e-01   +1.593194841263564e-01   +6.789082865042776e-01   +4.428231591729255e-01   +8.362480553760400e-01; +8.069430426543156e-01   +4.205081978891950e-01   +2.341997797675560e-01   +2.532919711816523e-01   +1.344289732897251e-01   +4.772520590390286e-01   +4.737672284978995e-01   +6.860345548838351e-01   +1.016527701588388e-01   +3.336700798726096e-02   +4.451219034032499e-02   +1.646626552159569e-01; +4.007575845682870e-01   +1.902163839412610e-01   +6.557854478953065e-01   +9.426760992584517e-01   +1.111454732656177e-02   +9.027868685376825e-01   +4.356041459198047e-01   +6.538007730675883e-01   +6.174111750075476e-01   +7.826411619544859e-01   +7.633723513854523e-01   +1.597679218212911e-01; +8.879882784807465e-01   +1.827341583118144e-01   +8.052821816864962e-01   +2.950962381658409e-01   +1.587936053525721e-02   +2.863042282107077e-01   +5.581279569364562e-01   +6.228996559754402e-01   +9.610444471395803e-01   +3.722331650369113e-01   +9.472795173778675e-02   +1.336261975111672e-01; +7.171195654184782e-01   +6.701280586129434e-01   +7.383163118757525e-01   +1.453991398581473e-01   +9.872652590611695e-01   +8.058604026057332e-02   +2.071968383572185e-01   +7.607967992539227e-02   +6.699808846493552e-01   +6.377934823656182e-01   +6.584107169148197e-01   +1.527835380672506e-01; +2.045871904883628e-01   +5.195170378222955e-01   +1.188884384501645e-01   +8.660415237622425e-01   +6.511246452107851e-01   +3.839542951306735e-01   +2.780547451972030e-01   +5.486238571719299e-01   +4.756142304010404e-01   +4.949649696949153e-01   +2.620135104502821e-01   +3.984189205900206e-01; +3.743294597954100e-01   +7.822451351554834e-01   +1.711130613202391e-01   +8.827501851818566e-01   +8.081703682839916e-01   +1.870491484927164e-01   +8.043791431311365e-01   +8.774866953786256e-01   +3.340066655824151e-01   +2.295922354059968e-01   +4.440192102884206e-01   +6.621678746137447e-01; +2.103990492795371e-01   +3.002346807205198e-01   +2.642332292742303e-01   +6.593703350927403e-01   +2.786309842738821e-01   +7.285631809877595e-01   +1.017653273754828e-01   +9.816597016086404e-01   +5.875008402149866e-01   +2.141543288937109e-01   +8.472303708456381e-01   +2.207133499117337e-01; +2.584878607660987e-01   +4.684352915656955e-01   +8.181246356328994e-01   +9.975618363993588e-01   +1.823406369216031e-02   +4.289735271136877e-01   +3.596446789198993e-02   +6.505506595963549e-02   +5.469890664817548e-01   +4.521375175395426e-01   +9.050215191102333e-01   +6.400738555435233e-01; +9.924578040603835e-01   +7.096680864155096e-01   +5.865864219011689e-01   +2.564289961208190e-01   +1.020597791427986e-01   +2.631545475127806e-01   +7.396497376336714e-02   +3.025384276176568e-02   +3.881072523993915e-02   +6.292188666210701e-01   +2.824376504767097e-01   +6.105021534721207e-01];
L2E_Input1_iAMPA_netcon = [+9.991178934514426e-01   +9.990570040694907e-01   +9.977474249631225e-01   +9.988636010254763e-01   +9.958004926897537e-01   +9.999989963394982e-01   +9.965158870502251e-01   +9.962629340281346e-01];
L2I_Input2_iAMPA_netcon = [+9.961501781346711e-01   +9.975079247184324e-01   +9.975171426765718e-01   +9.960945578898854e-01   +9.963060721130387e-01   +9.976429593475113e-01   +1.000000000000000e+00   +9.961034624963526e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
