function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.886503465545226e-01   +5.372443234619682e-01   +3.080138624992601e-01   -1.099816313351485e-01   +2.251819978945858e-01   +1.782379547467623e-01   -6.037395075974422e-02   -4.744411065899241e-01   -3.104623214835643e-01   +1.485363031689654e-01   +9.460027483508558e-01   +2.219304498140089e-01   +6.950632543967012e-01   +8.631125503837946e-02   +9.499869868295323e-02   -4.544277478269005e-01; -7.260261890200374e-02   -9.193428579501342e-02   -3.079389710050539e-01   -3.671166495832431e-01   +4.219817132218751e-01   -2.910909052081920e-01   -4.764298073432938e-01   -4.086440835915687e-01   +4.412064839698044e-01   -3.465224456483091e-01   +3.777247491621261e-02   -6.504498764636357e-01   +5.570980057998703e-01   -2.477974663052515e-01   -7.485586071299589e-01   +4.508235364092705e-01; +2.432511736804953e-01   +3.202798615904427e-01   +8.401820923419883e-03   -8.100086100291574e-02   -3.707478160842867e-02   +1.610600981401145e-03   +1.725008674226855e-01   -5.002606456521508e-03   -3.940903940132907e-01   -1.057954275241233e-01   -3.783305289860517e-01   -1.133244624371806e-01   +4.493171300132330e-01   +1.131517030456564e-01   -3.479115132656639e-01   -3.255038760772767e-01; -7.488878473610737e-01   +4.231541413378634e-01   +1.855359726889046e-01   +6.645579931729614e-02   +1.942255298035036e-01   +3.755904414468296e-01   -3.690017098944044e-01   -1.300171375770440e-01   -1.881034436995072e-02   +1.070576947013175e-01   +3.447765785797972e-01   +4.550925738905059e-03   -3.970132015535881e-01   +2.166438598473787e-01   +5.844424959273127e-02   +4.046298287463815e-02; +2.461731503587579e-01   -3.532797001170395e-01   -8.027010567392605e-01   +4.474896237659773e-01   -3.638507212115885e-01   +3.703981521007048e-01   +1.073763106476332e-01   +3.813676167242380e-01   +1.746223150453401e-01   -1.105025679336588e-02   -1.516494983026383e-01   +2.975285623057590e-01   +7.100510143362697e-01   +4.316914753369400e-01   +2.688615429160235e-01   +1.223735617030822e-01; -4.762494727759528e-01   +1.961775390547250e-01   -9.453934478038524e-02   -2.756507455732975e-01   -5.987590029262537e-02   -8.982725615069026e-02   -4.173327195332918e-01   -4.285511910760694e-01   -1.354898798657658e-01   -7.254408310684445e-02   -4.068514772612272e-02   +2.885587356460720e-01   -1.699846030661074e-01   -4.691703933419870e-01   +1.746419781357336e-02   +3.204396255333015e-01; +3.725495030530774e-01   +4.692072300988754e-01   -1.974964843230459e-01   -2.149618438743812e-01   -1.811594230473666e-01   +4.267366358645202e-01   +2.699532957053161e-01   -5.568455967682550e-01   +4.295361660734345e-02   -5.679116791037255e-01   +1.925137572433812e-01   -1.127095858478191e-01   +1.624248635624977e-01   -2.710709191975616e-02   +4.355929439407139e-02   +5.389357815105112e-01; -4.236262445750227e-01   +3.817674487803111e-01   -3.606089405948038e-01   +4.542423528307150e-01   +2.226487896263371e-01   +4.973396784323064e-01   +2.875482891731400e-01   +7.340402927460302e-02   -1.721741821202329e-02   +6.234302254399230e-01   -1.323327414196641e-01   -2.587298258668409e-01   -1.763112413867281e-01   +5.650890320713631e-01   +7.058399431421405e-02   +4.925285537139454e-02; +1.925126765781422e-01   -3.914993345010522e-01   -3.267747615334071e-01   +2.498527029346812e-01   -1.938939562981274e-01   +2.929354727214784e-01   +1.775014188002945e-01   +6.143836932208292e-02   -1.038417497929652e-01   -1.373755960651873e-01   +3.706324038423751e-01   -4.607667809705345e-01   -2.592661704026384e-01   -3.653389756841923e-01   -5.729100199594878e-01   +1.648745052576890e-01; +4.228454101169852e-01   +2.698058325217465e-01   +5.794508145248466e-01   +3.248438398815853e-01   -1.259400946873063e-01   -3.504762060468131e-01   +3.548812002521084e-02   -3.250752803275914e-02   -4.933066740621088e-01   -3.917357514162301e-01   -2.083488739443976e-02   -4.095757679792592e-01   -3.403870281133166e-01   -3.046863238252303e-01   +4.188495182637638e-01   -4.270135648489646e-01; +3.586561626980481e-01   -2.346262018083358e-01   -9.450592131716348e-02   -4.427579136157671e-01   -1.388448174985738e-01   -2.872078075054621e-01   +2.141502612526414e-02   -5.835906582771907e-01   +1.343145771150294e-01   +8.436815394699418e-02   +5.362686246548328e-02   +6.769301018859222e-02   +2.320719487015681e-01   -2.500228839221125e-01   +6.801483682804461e-01   -1.632292420923674e-01; -4.184478573207306e-01   +1.707775791493679e-01   +6.746264620296899e-01   -5.929754314303456e-01   -8.318930292778567e-02   -5.816298160578818e-01   +7.353063699900237e-01   -3.302939083497103e-01   +6.043444144925512e-01   +4.479864297774865e-01   +2.324059208124134e-01   +6.197661764019342e-01   -4.131482498562176e-01   +1.855886923289599e-03   -3.258459345031942e-01   +1.675881432272453e-01; +1.312687146184213e-02   -2.205617496053021e-01   +3.686174630571604e-01   -8.412633774936823e-02   +1.969014036778636e-01   +2.572262118800898e-01   -1.193118398743262e-01   -2.579752264514959e-01   -1.450374544244258e-01   +2.406507555402887e-01   +1.126487732135350e-01   -5.547719701826317e-02   +1.369542975631644e-01   +1.581245756930639e-01   +2.076912115837489e-01   -8.290086018435422e-01; -1.690952434161174e-01   +1.523297046866859e-02   -3.982553624139964e-01   -4.828982179678910e-01   -1.172378207325496e-01   +2.514514220558419e-01   -3.832049207792160e-01   -8.665347785856869e-01   +3.678424119309504e-02   +5.877192282759673e-01   -3.819811529207353e-01   +3.562583985994849e-01   +5.912196163026860e-01   +3.083896564014031e-01   +2.124773335290888e-01   +4.436589282020047e-02; +3.807430792430457e-02   +2.518098048598582e-01   -1.403182869146327e-01   +3.139557568006724e-01   -8.063109279149875e-01   +3.723304293439033e-01   -2.040859665007483e-01   +4.897475909551166e-01   -2.613490308890496e-01   -6.066033608916492e-01   -9.119996616727705e-02   +6.068098004098192e-02   +3.909520942050721e-02   -1.388727445097480e-01   -3.523329883613568e-01   -3.997373895670957e-01; +1.561902500387420e-01   -2.130667011892695e-01   -4.165573848991744e-01   +6.014144872704244e-02   -5.186885667006224e-01   +6.870985460417667e-02   +1.138457727122753e-01   -5.028193249793131e-01   -2.833591524817326e-01   +4.838490578678020e-01   +1.389842357968398e-01   +6.422009994975991e-02   +1.868619648238654e-01   -3.791571912643854e-02   +6.617155979295862e-01   +3.631647273010561e-01];
L1E_L1I_iGABA_netcon = [+4.118385322595548e-01   +1.845826219662128e-01   +2.842795416168410e-01   +2.926924427049813e-01   -6.002204279631573e-02   +5.752704787527202e-01   +2.552736671225097e-01   -4.329354461218583e-01   +3.280358274687242e-01   -4.012365107447662e-01   +3.415039997224287e-01   +1.608072895404395e-01   -5.995428080755916e-01   +1.096896681926304e-02   -3.103212196899159e-01   +7.492919533387314e-01; +5.921874092076190e-02   -4.096353491199967e-01   -1.688683887622864e-01   -6.329881437676931e-01   +9.023707921322163e-03   -1.584145185896426e-01   +1.731038093336957e-01   -5.343040299761402e-01   +8.237301545971257e-02   -5.770664185743404e-01   +1.779905417277445e-01   -3.105528169010264e-01   +1.641604919200069e-01   +5.976849187148484e-02   +2.040348088426752e-01   +1.360716316090143e-01; +1.931412932629898e-01   +3.573762832068223e-01   -4.178932113912354e-02   +4.161756767668598e-02   +8.545688430841505e-02   -5.942295420849891e-01   +2.367193955033518e-01   +5.551240964599303e-01   +4.080680641897142e-01   +4.287773087047549e-01   +1.005558591667552e-02   +4.222679764756143e-01   -3.699287467071092e-01   +2.794583131946154e-01   -2.824706019751724e-01   +8.954158714690051e-01; -2.267348227324472e-01   +2.416535347132466e-01   +3.658002173531143e-02   -5.052310703275599e-01   -2.705739172793233e-01   +3.764653490415926e-01   +5.409423617978516e-02   -1.419449458294070e-02   -6.241622417350299e-01   -7.313326682704926e-02   +2.709279534336062e-01   -3.887724674658507e-01   +5.844666995384807e-02   -1.112928136504751e-01   -2.000818827341548e-01   -4.362425124196881e-01; +4.577122311190735e-01   +3.543995537738994e-01   -3.089552345803446e-01   -3.283214808220413e-01   +1.425716942309955e-01   +6.947405939653586e-02   +3.259291966067531e-01   -7.911597873274340e-02   -4.714102197155895e-02   -5.656657075535143e-01   -4.997880824160684e-01   -2.003403772297977e-01   -5.157365782091688e-02   -1.894975614861995e-01   +6.631379379966942e-01   -2.041905023670337e-02; +3.874776478703278e-01   -3.210084574435096e-02   -2.386550757878066e-01   -2.852807983635650e-02   -3.070621625728381e-01   -2.582124780909089e-01   +4.023835757300052e-01   -2.750504671435032e-01   -9.945571671370415e-02   -2.369680906793095e-02   +6.065093168286131e-01   -2.470228057917845e-02   +2.778710270778294e-01   +4.497722839066166e-02   +4.946224622063073e-02   -4.867460284033607e-01; +1.731734432031403e-01   -2.505697435259659e-01   -1.600509532734238e-01   -1.377709619939386e-01   -2.420847380006619e-01   +1.557235414224070e-01   +1.544068258139963e-04   -1.800908906955483e-01   +4.091392868668500e-02   -2.826499199200203e-01   -1.790273166394555e-01   +7.989974486721674e-03   +3.852117892415926e-01   +3.465026337634988e-01   -4.015017966870574e-01   +1.209266772516818e-01; +1.228627705254881e-01   -2.889521304675977e-01   -1.563976640207544e-01   -3.480686875365154e-01   -2.275471365528257e-01   -1.340666782348665e-01   -5.176065995426311e-02   +1.466070847210999e-01   +1.636191738024589e-01   -6.254421216778743e-01   +3.650086370224667e-02   -1.355643822841215e-01   -2.843126725439644e-01   +3.891320902975854e-01   +3.216567028125764e-01   +5.569074692984079e-02; +3.306502181751643e-01   -4.790255627098821e-01   +1.315571832439963e-02   -4.095559175204130e-02   +5.846441151763057e-02   -2.104472366995390e-01   +6.949282245308154e-01   -6.939778364841465e-02   -1.234323927347870e-01   -1.752975576867311e-01   -1.989162136915839e-01   -6.837445796445751e-02   -1.765890168056403e-01   -1.649253354584299e-01   -6.161659899049373e-01   -2.553509072537768e-01; +2.538292315236495e-01   -2.401591352961890e-01   -5.373868312703545e-02   -2.662778160241044e-01   +1.118967614971779e-01   +6.906274900243298e-01   -3.518085080448849e-01   +3.641295530758217e-01   +2.950809497137508e-01   -2.202389573893525e-01   -5.505600010711184e-01   +2.732750431418485e-02   -3.449705151847497e-01   -3.717921337365765e-01   +4.817028042663321e-01   +2.210207065354728e-01; +2.000367939306151e-01   +3.424249395006532e-02   +6.314996902813852e-01   -1.410694481478599e-01   -5.908931415157401e-03   -1.856544585920141e-01   -5.295870478964818e-02   +4.188675249415472e-02   +2.087880860578580e-01   -4.031446048596782e-01   -4.432968228316972e-03   +2.694730422354267e-01   -1.583022668490822e-01   +1.928946149762863e-01   -2.313251479172094e-01   +1.882587783590409e-01; +2.458450694459928e-01   -9.250989163123209e-01   -1.382107291786843e-01   +5.906386734936381e-01   -3.108584735706261e-01   -6.848030060401218e-01   -1.827595281228049e-01   -3.288332516030184e-01   +1.932067895523764e-02   +4.433759315113246e-01   +4.549376834669663e-02   +7.231417917634000e-01   +1.952100353658380e-01   +5.276745545476472e-02   +6.583556852239635e-01   +1.372477680572455e-01; +2.223186526255515e-01   +1.568957506247897e-01   +1.051379265036363e-01   -1.227786011162619e-01   -2.938282176677999e-01   +7.371468645778388e-01   -3.668726032797975e-01   -1.966316964049244e-01   +1.129580777447509e-01   -4.267675097702994e-01   -9.755097141179862e-02   +2.729284172740351e-02   +1.490592193320316e-01   +4.514489764810737e-01   -1.142551910632280e-01   -7.136064185765126e-02; -2.493766965550437e-01   +5.879266282036595e-01   -4.454873638321055e-01   +5.735972186286629e-01   +2.917073633225407e-01   +2.845427722699972e-01   -1.555114666348568e-01   +4.405130522323003e-01   -5.431168781907330e-01   -2.939133162357864e-01   +1.329638676264211e-01   +6.738541925910577e-01   -3.181136154445943e-02   +8.260551265793571e-02   +1.369925302719326e-01   -4.117816117105492e-01; +3.651817071199343e-01   -2.146608334888644e-01   -8.151759879486059e-02   -7.278663776974921e-01   -1.958207914022473e-01   +1.331353238781715e-01   +3.909260322730989e-01   -7.462629304174116e-02   -5.305247123701282e-01   +7.233937260043855e-02   -3.166676271224885e-01   -6.806902109944457e-01   +7.055180632495196e-01   -7.202726882311251e-01   +9.068885981346858e-01   -4.698963180794137e-03; -1.244179053602154e-02   +3.470110393635798e-01   +4.029610180065104e-01   +4.045016530692314e-02   -3.557106918931064e-01   -2.418617166370969e-01   -2.404461749349361e-02   -3.795539190662730e-01   +2.122717608545932e-01   -5.490851625267065e-01   -3.852163303958533e-01   -2.957833398070745e-01   +8.311224384037910e-02   +8.802639239565696e-02   +6.768768554425438e-01   -3.231732159275940e-01];
L2I_L1I_iGABA_netcon = [+2.890989641855028e-01   -2.893308322178461e-01   +9.631165355985266e-03   +3.111708323447926e-03   -3.879129555681261e-01   +8.389268602855680e-03   -8.884707104309407e-02   -2.723783347558729e-01; +3.946159452605383e-01   +1.537186231546036e-01   +4.630464851754679e-01   +2.982278394499031e-01   +2.687707206068898e-01   +2.149132715550051e-01   -1.164068951407017e-02   +5.076454372102905e-01; +5.865799920350910e-01   -2.867111586344298e-01   -3.766207941043156e-01   -3.008754445796429e-01   +4.122466902538027e-01   +4.551595158106969e-02   +9.918283608201368e-03   -6.624854137432516e-01; +2.283427404795726e-01   +4.783910283052295e-01   -6.704808594844716e-02   -5.507400914558862e-02   -9.241729107959003e-02   -1.335388112358815e-01   -7.445322243165314e-02   -3.673218667373050e-01; -4.941529458341786e-01   +2.288524607014484e-01   +8.127824330068381e-02   -1.275740164591059e-01   +8.286922604050954e-02   +3.754859570866526e-01   -1.643508082657967e-01   -4.618838986061126e-01; +1.834140211730951e-01   -5.132250017532675e-02   -1.460606412860698e-01   +3.710094914175074e-02   -3.459384501211784e-01   +1.494345862533955e-01   -2.906288257975616e-01   -5.340505471908968e-02; -5.163816754097060e-01   -5.635993429566315e-01   +2.292849476694947e-01   -1.171615113685646e-01   +2.466281411893250e-01   -2.309484994331628e-01   -1.139320483193963e-01   +5.036497751264585e-02; -5.107758346694322e-01   -6.782951251695082e-01   -2.937579638389681e-01   +3.663959212804572e-01   +7.649647055002945e-01   +5.477236839879692e-01   +4.239065007581123e-01   +4.497534425511953e-01; -3.053324752625126e-01   -1.536514577858311e-01   +4.800597110201933e-01   -5.295252554730122e-01   +4.924750119120802e-01   +1.199594923870620e-01   +2.830576372006026e-01   -3.842700849815024e-02; -2.706880359877020e-02   -4.939575085203285e-01   +2.297062564325654e-02   +3.893809108570198e-01   +2.639703508803089e-01   +5.194472236323775e-01   -2.105956185443489e-01   -5.306167507086106e-01; +2.932691601280657e-02   -6.295152241107331e-01   -4.597181574221720e-01   +5.425603754705073e-01   +8.945198334106974e-02   -3.118665918960454e-01   -1.566419202613369e-01   +2.758150181781125e-01; -1.693517199865671e-01   -3.293897362501526e-01   +1.174117741991526e-01   +3.752144995529055e-01   -2.422310072718845e-01   -1.507205377797569e-01   -1.346171180671834e-01   +8.254329701331304e-01; -4.693527028886629e-01   +6.131767751672553e-01   +4.483351442958752e-01   -2.573122159140996e-01   +6.054076383773128e-01   +9.789104966941961e-02   +1.652721902484089e-01   +5.448630805995328e-01; +3.415139905438448e-01   +8.684687070654366e-01   -5.645752403190846e-02   -3.976542685376728e-01   +2.632497013280720e-01   +1.339392705958758e-01   +2.328442944813178e-01   -9.795982575407469e-02; -4.965945600220970e-01   -4.215397502477165e-01   -6.476699643417327e-02   +5.556253391298942e-01   -8.335395242226540e-02   +1.265472910159247e-01   +3.339957270442615e-01   -3.926753109571071e-01; +2.147791736661952e-01   -6.205749262843625e-01   -2.522373569949230e-01   -2.745039648640857e-02   +5.213663684851970e-01   -1.025440466769880e-01   -5.197391189217027e-01   +5.935055074141563e-01];
L1I_L2I_iGABA_netcon = [-6.049638515336845e-01   -3.043010979490476e-01   -4.871666514191911e-02   +2.828848402519617e-02   +4.191414347268997e-01   -2.857263808456543e-01   -4.911492353186505e-01   -2.810903589865834e-01   +5.424247993497656e-01   -3.818300902083019e-01   -1.319166355593206e-02   +3.328588802502569e-01   +9.486151998992810e-01   -4.460582265811901e-01   +8.297406278590166e-01   +1.507670233719316e-01; +7.018109260897487e-01   -3.202331659603479e-01   +1.962553299316190e-01   +1.723156195050823e-01   -7.690477200709492e-03   -1.308369766608667e-01   -3.864523096037111e-01   -5.894170722196374e-01   +7.513985901883710e-02   -4.384660134914237e-01   -2.223540331843037e-01   -9.473333516715451e-02   +5.418838533090358e-01   -2.732497302839419e-01   -8.177298501642144e-02   +1.359927583377434e-01; -5.470697580680707e-02   -4.843767020470297e-01   -2.043964686267554e-01   +2.308202495506214e-01   +1.215255537074979e-01   +1.091136430828295e-01   +4.058765999121999e-02   -9.177954517060041e-02   +3.038626778595168e-01   +7.348392264368546e-01   +8.437154731457799e-01   +1.777491650862712e-01   -1.026947579948490e-01   -5.672171733490671e-01   +2.350012439502697e-03   +7.261785551587485e-01; -1.559925854181243e-01   +2.252974683947076e-01   +1.297761547816988e-01   +1.991079482742582e-01   -1.204724232799335e-01   -3.398082450277837e-01   +8.139997253370821e-01   -8.311799577998051e-01   +1.674562585813923e-01   +2.949088106525706e-01   -1.574042678681994e-01   -2.293889808898116e-01   +7.753918523469316e-02   +4.942266458015807e-01   -7.347976876476903e-02   +6.009939432811571e-01; -1.892988334604545e-01   +4.748985212623598e-01   -2.978372503996883e-01   -8.686609014120314e-02   +1.829768423383225e-01   -1.949840048889632e-01   +5.485989127895563e-02   +1.590865017471853e-01   +1.880699411913888e-01   +1.777666609293649e-01   -6.124758442326006e-01   -4.521792126221671e-02   +1.623618972990221e-01   +2.969983800573834e-01   +2.026050234671625e-01   -3.958751136288265e-01; -4.282163349982278e-01   -5.771860257446346e-01   -4.075763900579328e-02   +1.788216830643625e-01   +1.935709338566081e-01   -2.109189214538469e-01   -2.746635074567254e-01   -9.496591019786074e-02   -3.013163190976677e-01   +7.663098332569077e-02   +3.595187186189868e-02   -5.052484264026262e-01   +5.712145800753389e-01   +2.112594041898246e-02   +5.030760520080099e-02   +2.172968007609435e-02; -3.669761610093911e-01   +4.096728969069903e-01   +2.005764930051389e-01   +9.580015763242462e-01   -2.316563557504175e-01   -1.380220694341407e-01   -4.566226486896144e-01   -1.275238743337940e-01   +3.803994033702031e-01   -6.057963722297615e-01   +5.439248723068056e-01   +1.103393725209411e-01   +2.587296494043091e-01   +7.325135688168966e-01   +7.405841982050604e-03   +2.174082183800474e-01; -1.475417444009794e-01   +5.183315502510816e-01   -3.235900085458135e-01   -5.193689663440756e-01   +6.669215267231430e-01   +5.070507299010651e-01   +7.516195157530348e-01   +3.622971628623348e-01   +5.946179338430425e-02   +7.892440203688675e-01   -7.646207832360848e-02   -3.072603418491275e-01   +2.630213846404563e-01   -5.238074668444337e-02   -1.734751311915408e-01   +7.259176674865798e-01];
L2E_L1E_iAMPA_netcon = [+4.897090019101031e-01   +1.098151504772168e-01   +8.784026030546743e-01   -7.678682681440467e-01   +1.200648551376493e-01   +6.594513413643188e-01   -1.817764516779938e-01   +2.487302063838197e-01; +4.053493881336540e-02   +5.897035253684917e-02   -3.961323117352234e-01   -3.968708646807721e-02   -6.701690628258713e-01   +7.923018928820716e-02   -1.191727875505921e-01   +3.595125897569731e-01; -3.835251738791573e-01   +7.940253512178863e-02   -5.827527829414340e-02   -8.439589112838958e-01   -3.229420033337697e-01   -6.469001080144859e-02   -3.809639086733084e-01   +3.129076312083878e-01; -1.600393068231429e-01   -8.292700531192815e-02   -1.041746809836367e-01   +1.686423158742523e-01   +2.070828427236539e-01   -2.221574214349144e-01   -4.715662193545914e-01   +4.924882063089797e-02; -1.069304333611684e-01   +1.290876277629123e-01   +2.275193379861999e-01   +1.474540668540947e-01   +2.909195380334656e-01   +1.650867280604445e-01   +5.686520756097940e-01   -4.516044999396607e-01; -1.345442713896426e-01   +8.763006544031646e-02   +1.229473896746683e-01   -5.260517720439040e-01   -5.514321078829381e-01   -3.508553716923964e-01   -6.849811214424857e-01   -1.591342597916765e-01; +3.177671372361034e-01   -6.061705350352465e-01   +3.983232030402314e-01   +3.172146512999497e-01   +6.247818952392286e-01   +2.691344313890495e-01   +2.434229195207115e-01   +3.869865832655200e-01; -3.334592720485682e-01   -1.555761018734827e-01   +6.590500022506647e-01   +1.562706039094447e-02   -2.517955776163792e-01   -4.377312485583702e-01   +2.820544505621820e-02   -5.300424077746703e-01; +5.064518414864898e-02   -1.507582104113919e-01   -4.030255338108768e-01   +3.981646255100578e-01   -4.488120739579751e-02   -7.103387810959532e-01   -1.028643073448990e-01   -1.670533597359373e-01; -3.115295158680228e-01   -1.011067677171758e-01   -2.634390515338000e-01   +2.917363191003562e-01   +3.695268600696313e-01   -3.804553515076683e-01   +9.840564528950602e-02   +6.023614051537423e-01; -5.595839050082008e-01   -5.056319607287639e-01   +5.205277616309488e-01   +1.640603306463717e-01   +3.100682873240733e-01   -4.329818736907603e-01   -5.490744840617325e-01   +1.095057901065738e-01; -1.894145856451615e-02   -2.419124002396453e-01   -4.222996281855758e-01   +3.912553596270171e-02   +1.968847712789683e-01   -4.188904848815456e-02   -1.710271598812818e-01   -1.902306614258592e-01; -1.503608395799333e-01   -1.924573191361406e-01   -3.233876000963487e-01   -3.851424204444710e-01   -7.907306334753741e-01   +6.484262635175833e-02   +9.278866066618081e-01   -6.664909144586787e-01; +3.825929981104356e-02   -5.302133601107361e-01   +3.653325833819240e-01   -3.705909515660780e-02   +6.827640353239924e-02   -4.065507302703939e-01   +7.311406584843297e-02   +6.921001974307507e-01; -2.006885848757353e-01   +3.694111830828874e-01   -3.378289087073778e-01   +1.271440165858997e-01   -1.021367716844837e-01   -3.402464070715949e-02   +4.822453617936603e-01   -6.353809998368976e-01; +4.776730637073950e-01   +3.666138789207037e-01   +2.805303758453156e-01   +2.649224490368668e-02   -3.928294379710401e-01   -2.398930247148517e-02   -6.226884714129534e-01   +2.953222643316488e-01];
L1E_L2E_iAMPA_netcon = [+3.443393301574433e-01   -5.246905494607075e-01   -1.722120712615078e-01   +3.004708156998754e-01   +1.545638705848996e-01   +3.993836569432513e-01   -5.076195195053520e-01   +4.199363970790685e-01   +2.265538335753599e-01   -3.457890269553788e-01   +6.530422413302196e-01   -2.480304601174761e-01   +4.647540601572456e-01   +6.916685461127881e-01   +7.723410112109660e-01   -2.435305006869366e-01; +5.477543590666882e-01   -2.872136790394624e-01   +2.154244929559240e-01   -2.245081631116479e-01   +4.657891341674393e-01   -1.079496668830927e-01   +1.812894544954867e-01   -7.329694196733962e-01   +1.585361551724722e-01   -4.191245059394391e-01   -3.263807305116540e-01   +7.333900508660006e-02   +3.115982584630618e-01   -6.293562099937634e-02   +2.946083632928244e-01   +6.261361014028491e-02; +3.945394371181475e-01   +5.967182152389942e-01   +1.902601328926775e-01   +1.658052009033642e-02   +1.150989522003356e-01   -1.924379963610467e-01   +4.220888328766289e-01   -2.900548980248961e-02   -8.609222163621683e-02   +3.256610882592909e-03   +6.005727037334346e-01   -3.973589002743295e-01   +2.776965224737551e-01   +3.319728277552048e-01   +2.342705156985147e-01   -9.103969628128755e-02; +2.473794460101649e-01   +7.973270103067506e-02   +6.274510979666692e-02   +7.740059987201499e-01   -3.031591988071000e-02   +2.046974297559050e-02   +4.966470971017099e-01   +3.914593730065509e-01   +3.727770573061265e-01   +3.070907519290595e-01   +6.249223987236782e-01   -6.651953352083673e-01   +5.559980160470590e-02   -2.554713512467474e-01   +5.337285856868691e-03   +5.643227050494444e-01; +6.201179066036985e-01   +1.665690530178587e-02   -5.690142888705892e-01   -1.898362229948899e-01   -3.129308575213854e-02   +9.078356780804156e-02   +2.498866717288382e-01   +2.917457820938744e-01   -3.105225411937100e-01   -2.176032946590753e-01   +4.664569789572198e-01   -3.531188295685416e-01   +4.444410212633451e-02   -3.434287030976663e-01   +2.125416427326372e-01   -1.976628044592953e-01; +1.541786462276642e-01   -7.860181519162492e-01   +2.548719631568258e-01   +1.317746584758116e-01   +3.524649937184293e-01   -1.392208504976300e-02   -1.941935308548982e-01   -2.221832085449771e-01   -1.502590741862767e-01   +2.727531910481946e-01   +4.653632456237521e-01   -7.106082899262193e-01   -2.537979844197368e-01   +3.771724750891615e-02   -1.162274929155935e-01   -6.487439342101048e-01; +1.762583057401697e-02   +8.643164789516943e-01   +3.471514813670532e-01   +2.294719099468782e-01   -1.050393728209518e-01   +2.367468381603086e-02   +1.374728456086379e-01   -8.304146610922873e-01   -3.165682451224232e-01   +4.346263150815571e-03   +5.427464436633119e-01   +6.133326280822230e-01   +3.250636435869831e-01   +4.410625577082632e-01   -1.053905699540259e-01   -6.512765364496211e-01; +1.771172738981333e-01   -1.183575233423304e-01   -5.626022108334544e-01   -3.028685214404111e-01   +1.366794316455790e-01   +1.000162570935281e-01   -2.372955746558539e-01   -7.513828436309497e-02   -3.624945033766468e-02   -3.447926797739544e-01   -1.252197340667175e-01   -6.743835071162884e-01   +1.646351854132546e-01   +8.617048762717854e-02   -4.562659384509578e-01   +1.058852588012039e-01];
L2I_L2E_iAMPA_netcon = [+5.118186779373621e-01   -5.885792968371131e-01   -1.294825984548743e-01   -1.391640921006417e-01   -6.435386676104147e-03   -2.132116752969567e-01   +3.123321456912108e-01   -1.485460061121159e-01; -6.764179676129209e-01   +7.363130967718400e-01   +2.259013179329065e-01   -4.517922195725550e-02   -3.390634272397561e-01   +6.879810375052008e-01   +1.853021037366411e-02   -2.471340606863075e-01; -3.067908998427185e-01   +3.064474582364781e-01   -9.376435552363671e-02   +5.480977590622329e-02   -6.107452820112279e-01   +6.423347831873918e-01   +5.076238395789922e-02   -2.061159841413400e-01; -3.339024178153052e-01   -5.647186284789161e-01   -5.241089836990569e-01   +5.062082733555120e-01   -1.693996223805379e-01   +8.195540544793509e-02   -1.986494396478742e-01   +9.172008473939353e-02; -5.246290511837941e-01   +1.127501537054719e-01   -1.201011119309136e-01   +1.316802613998307e-01   -2.102078176167888e-01   -5.096383338331499e-01   +2.990411235372161e-01   +1.000000000000000e+00; -2.323883325784409e-01   +3.126309166583087e-01   -4.080053901552897e-01   +1.572148510972250e-01   +3.487434682328125e-01   +1.135589938270487e-01   +3.553172296793805e-01   +2.924325874439376e-01; +2.193157412213635e-01   +4.079402087883254e-01   -6.567271734559469e-01   +1.035943576287811e-01   +2.478711406355995e-01   +2.183571308011473e-04   -2.016458565960538e-01   +2.545808069486212e-01; -1.378491893163585e-01   +6.602379984658248e-02   -4.564297528691533e-01   -7.958663615601991e-02   -6.070474034847503e-02   +4.626524135839566e-01   +3.471023237091302e-01   +9.246077563228096e-01];
L2E_L2I_iGABA_netcon = [-6.178226769692138e-02   +1.000000000000000e+00   +4.173830953758247e-02   -2.323095272310441e-01   -7.505376090662542e-01   -3.447647836986438e-01   +2.075528710439422e-01   +2.281772540296736e-01; -3.948686756840994e-01   +1.394549964369094e-01   -2.273184118870402e-01   +7.999512602974905e-02   -4.854484093423490e-01   -9.023918552188327e-02   +4.539107314968145e-01   +2.793533092288064e-01; -3.312012638239277e-01   +3.215107395333008e-01   +2.424354843783058e-01   -5.768932368186047e-01   -1.386064067388867e-01   -2.197960604193748e-04   +4.304798720790682e-01   -3.739402594166744e-01; +5.141727784775481e-01   -3.186278058468220e-02   +3.030567409939841e-01   -4.664131143559499e-01   -1.859982088646198e-01   -1.318217267749519e-01   +2.735529842541040e-01   -8.991228736004178e-02; -1.139581830067180e-01   +3.869411631374151e-01   -1.295944430645194e-02   -2.379534166311082e-01   +3.087636079120596e-01   +6.229659709721870e-03   +2.363014249952727e-01   +5.197215416471070e-02; +7.717779346352825e-02   +2.702178121554383e-01   -2.020980195057513e-01   +1.762782682765308e-01   -4.631331567426247e-01   +1.703243817720082e-03   +4.006198748179297e-01   -3.492235427220772e-01; +5.869239584907057e-01   -1.452652685573051e-01   +2.231084279765902e-01   -3.398680594304456e-01   -2.052688574333884e-01   -1.198804236622748e-01   -2.549456288466215e-01   -1.766022692659370e-01; +4.516487957497812e-01   +7.987690730430848e-01   +1.542768963127130e-01   +3.151809424575394e-01   +1.165457737105288e-01   +3.852929087699535e-01   +1.185963321125410e-01   -4.000877583197986e-01];
L3E_L2E_iAMPA_netcon = [-1.161938596225004e-01   -3.422797468866941e-01   +3.650135600514249e-01   -8.647891116586143e-01   +2.997320114227160e-02   -3.444584892912854e-01   +2.445676134419817e-01   -2.826822868218761e-01   -7.229725451536556e-01   -3.093942282953007e-01   +2.818389991572168e-01   -2.657514198828303e-01; -5.909541478579236e-01   -1.394144147561409e-01   +6.514539827519674e-01   +4.155977309887260e-01   +1.980256803041028e-01   +1.794424878361831e-01   -1.536676726203327e-01   +5.386713210022662e-01   -3.254724855491986e-02   -3.232294126864514e-01   +2.074388219286288e-02   -1.436630287715682e-02; -2.680247344139994e-01   -4.407241109041788e-01   +1.960497439132642e-01   -4.604934268543619e-01   +1.694419437257616e-01   -3.515129804896877e-04   +1.182610956465436e-01   +2.010383834634347e-01   +4.499828781235968e-01   -2.405523172706560e-01   +7.365775736421757e-01   -2.677357026489277e-01; -3.834664750108637e-01   -2.727625803607344e-01   -4.951077966317814e-02   -2.283804374156723e-02   -2.137848722904706e-01   -3.718478743349971e-01   -1.206448885970509e-01   +4.347115840660149e-02   +1.823597722970838e-02   -6.246751199417736e-01   +5.028720859132900e-01   -5.509751673632809e-02; -3.051029129883459e-02   +2.080774589251847e-01   +4.063696140657375e-01   -9.352187625423547e-02   -1.552946963615949e-01   +7.131408209497362e-01   -1.344925169893850e-01   +5.026451174488128e-01   -1.097618872105239e-01   +1.651478500958144e-01   +6.938960308996639e-02   -7.410770279213284e-02; +6.398156049418727e-01   -1.096216523906970e-03   +1.213037316320978e-01   -4.100140688562226e-01   -4.993195189758354e-01   +1.442236240397057e-01   -1.991187375424911e-01   -2.173694046110028e-01   -4.171169839581051e-01   +4.601850967944310e-01   -1.710810549072503e-01   -8.736722463701638e-02; -1.391046120996771e-01   +7.100714426757928e-01   -2.890645891089051e-01   -7.507481926226688e-01   -3.896457131441762e-01   +1.888212449221244e-02   -3.074823220950049e-01   -3.398419556384239e-01   -3.934232704562117e-02   -3.302489558743673e-01   -8.066443013571954e-02   -1.960308753923598e-01; -1.853170981102952e-01   +7.598320333186802e-02   -2.732495519697593e-01   -4.053765217138517e-01   +2.421233799154720e-01   +6.782473195424110e-01   -3.136508439584622e-01   -4.093804011477483e-01   -5.534606218245599e-01   -1.738860634107428e-01   +7.337631157737442e-01   -1.513667227050174e-01];
L3I_L2I_iGABA_netcon = [-5.356316754205765e-01   +1.163908592516167e-01   -4.783237224541997e-01   -1.585626205150630e-01   +9.446762836650524e-03   +6.222544542497516e-03   +1.644981929167865e-01   +4.371819401233930e-01   +7.275909434003602e-02   +5.294063915242780e-01   -7.050576216151864e-01   -1.774215087031631e-01; -6.209368879161870e-01   +1.915570089659460e-02   -2.390782209858121e-01   +2.138150198861966e-01   -2.161538148120023e-01   -2.479305228050006e-01   -1.434047769073421e-02   +6.570414259185614e-01   -2.049565101224153e-01   -2.087885796627378e-01   -1.121222246177210e-01   -2.994600349572663e-01; +1.151776288035933e-01   -1.679932815187669e-01   -1.354173490034271e-02   -4.881735264387344e-03   -3.413294352164186e-01   +1.293245513981637e-01   -3.772147348967981e-01   +1.810138926830930e-01   +5.062847707032265e-01   +4.472125071854608e-01   -2.432608630517846e-01   -5.433113178816055e-01; -9.303115561181902e-01   +9.074697858612207e-02   -3.992341891289939e-01   -2.874323475801163e-01   -9.987437856906131e-02   -4.006559802670039e-01   +2.156106549702234e-01   -4.638383796232612e-01   -2.933664168505992e-01   +7.189357421726068e-03   +3.613118999620122e-01   -5.192722918645993e-01; -4.401163502127016e-01   +2.768996760224581e-01   +4.165017863875234e-01   +5.464663501728930e-01   +1.549441071918402e-01   -7.239779990630288e-02   -3.586772276533353e-01   +1.235484275624210e-02   -5.980740743138840e-01   -4.182644248398237e-01   -4.680035848955406e-02   +1.135678325907450e-01; -2.244076078424567e-01   -1.541534127185905e-01   +7.114002374423940e-01   -7.540703830090016e-01   -1.644919111206817e-01   -4.965549833399036e-02   -2.873284468712106e-01   +3.133725983850525e-01   -3.108160154795760e-01   -2.205043174159924e-01   -4.576263441760937e-01   +4.532457564938941e-02; -3.705327384065733e-01   +1.136861901763413e-01   +5.450179023540578e-01   -1.061125840488167e-01   +7.988807204881830e-02   +5.550378813648480e-01   +9.886168753064510e-02   -3.780666969275974e-01   +6.661100207263365e-01   -1.024414258687768e-01   -3.906764711565157e-01   -1.878727072315781e-01; -7.946269916560428e-02   -1.596412941937559e-01   -4.143889153141057e-01   +4.051656403658224e-01   +2.871375348291627e-01   -1.009366808833948e-01   +1.285754097224244e-01   -9.971603127857404e-02   -4.609025245353178e-01   +3.663436067271432e-01   +3.162305527734420e-01   -1.850026021605894e-01];
L2E_L3E_iAMPA_netcon = [-2.403969570803952e-03   +2.138571367331607e-01   -3.295034910729636e-01   -1.180264100056681e-01   +7.292353353619911e-01   -1.151149360103748e-01   -4.747349625824906e-02   +7.871329527570077e-02; +5.935364918159097e-02   -6.559693799669211e-01   +3.647941655818693e-02   +4.623535487873862e-01   -4.025640149577880e-01   +1.674573366931282e-01   -3.066839309626054e-01   -2.269817357943061e-01; -2.260812015721477e-01   -5.404680416496233e-01   -1.724914870851553e-01   +6.545818444922155e-02   -3.813078794724489e-02   -4.887035879021080e-02   -1.822262252072470e-01   +5.494415262227109e-02; -7.021424374414775e-03   +7.518995444278559e-03   -1.632612597148149e-01   +1.187692091543725e-01   +2.331531932475446e-01   +3.002515031093519e-01   -9.485741758970533e-02   -3.902876789579518e-01; -1.044579503794736e-01   -1.035495822612070e-01   +1.861462964696563e-01   -4.431707276977290e-01   +4.169402912893499e-01   -4.788895210754401e-03   +9.677243391034330e-01   +4.417050122633902e-01; -4.521746650336936e-01   -5.600972359579456e-01   +8.300081825890634e-02   -2.337460353020976e-01   +1.154964338275908e-01   +2.241259240804855e-01   +2.998826947620034e-01   -9.819169101757716e-02; +3.887675950012557e-01   -4.171710939913839e-01   +5.545806718338817e-01   -2.817419147439226e-01   -2.783777170093155e-02   -2.278714378908906e-01   +2.393449773963187e-02   -2.760078996213956e-01; -5.494228060458772e-01   +1.255056406484556e-01   +2.807120948730591e-01   +2.141756872942283e-01   +1.289933779874061e-01   +2.465577917673246e-01   +1.405558752814604e-01   +3.626587687026138e-01; -2.467071466431596e-01   -2.488753890673462e-01   -2.829084474108749e-01   +1.863378930150563e-01   +4.312913042031539e-01   -2.266676853045607e-01   -3.333325014519627e-01   -3.896527196568764e-01; -1.817557491126948e-01   -7.468949424726260e-01   +4.678836379213527e-01   +3.077138196970934e-02   +2.082068914232002e-01   -4.815898236046327e-02   -2.867219758411944e-01   +3.205291802948863e-01; -2.697647754791191e-01   -2.770508740171440e-02   -6.817168334932707e-01   -2.637728599576390e-01   +6.346608463158084e-01   +6.933983555633476e-01   +8.066747077554422e-02   +3.287817501997816e-01; +2.410281819500956e-01   +6.230215561092629e-01   +3.910799526951457e-02   -6.614547052225120e-01   +4.199975674856800e-01   +4.615891386787577e-01   -8.313286466595016e-03   +3.085496312822988e-01];
L2I_L3I_iGABA_netcon = [-9.897180673736045e-03   +2.559822670206426e-01   -3.092459173370147e-01   -6.951887301113910e-02   +3.244952336230581e-01   -1.434690773686708e-01   -3.108170497754699e-01   -2.010692276749970e-01; +5.686664118377829e-02   -4.113487377183704e-01   +3.375043933152198e-01   +3.272821932777688e-01   +4.565973208959572e-01   -7.763304889058417e-01   -5.783828268313040e-01   -6.985913834844777e-02; +8.937249996395652e-02   -1.871146164769836e-01   +3.717645556344645e-01   +5.831605877134294e-02   -2.623078461089036e-01   +2.230408477921267e-01   +6.893271514749096e-01   +8.432146185872727e-02; +5.365924953445685e-01   -9.219825645570720e-02   +5.096914581523353e-01   -5.246127725016654e-01   -7.654707298663599e-01   -5.281106057668759e-02   -4.732602149839494e-01   +1.270988251722373e-01; +1.621404621622121e-01   -1.473713332791331e-01   +1.622167423794248e-01   -2.469044453569977e-01   -1.067267118796585e-01   -1.094986645303894e-01   -6.355960484862705e-02   +6.240740149919085e-01; +5.668250257549814e-01   -1.822475339301182e-01   -5.692361968375463e-01   -1.048403199319041e-01   +5.284911675755004e-01   +4.605502871884320e-01   +6.932458870914748e-01   +9.251488289381098e-02; -1.053338930153451e-01   +1.980815542571169e-01   +4.484479248590476e-01   +1.682985391553675e-01   +7.118396358576218e-01   -3.918587473671134e-02   +6.685684018301552e-01   -7.415984619497964e-03; +5.277739527302061e-02   +3.049753955370966e-01   +1.835093326247066e-01   +3.276772507927125e-01   -5.665864528433755e-01   -5.732676649960367e-01   -7.402566991581847e-01   -4.392390664445373e-01; +5.120209450829635e-01   +5.932983000635509e-01   -3.985040696306792e-01   -2.606200051928690e-01   +5.861869587511406e-01   -1.361261555235084e-01   +2.034045086006209e-01   +1.607593629716008e-01; -3.578643162769357e-01   +3.416336523587989e-01   -1.596901005791622e-01   -2.989677892586874e-01   +2.565459008789180e-01   -6.176003281761583e-01   -3.592703387032889e-02   +3.661048698409974e-02; +2.833149785977391e-01   +5.266746929725584e-01   -4.529379002685561e-01   +1.997830066566361e-01   -2.123406674936086e-01   -2.449604694981577e-01   +1.452913063358671e-01   -1.300032772284104e-02; +3.993902192250977e-01   -2.371890131761522e-01   -3.707789425770230e-01   +7.700847199939960e-01   +4.321176601221169e-01   +7.118066899629653e-02   -6.578783718386868e-01   +1.772903079939310e-01];
L3I_L3E_iAMPA_netcon = [+6.849506157529330e-01   +1.206632314369370e-01   +5.556971733910643e-01   -2.384483655447374e-01   +5.891168964566678e-02   +3.202444629924531e-01   +1.966278203395514e-01   +2.869662415358899e-01   +8.177603888065557e-03   -9.877738872381595e-02   -3.595320497646762e-02   +6.705313234778951e-02; -1.459538082648964e-01   -3.128489603213528e-01   -1.316603036253546e-01   +3.454903754900759e-01   +4.678358498687837e-02   +1.566735657178589e-01   -5.743910604911521e-01   +2.419884043570956e-02   -3.208565703972014e-01   -5.658361889735181e-01   -9.526800327321261e-02   +4.539052173255530e-01; -2.658691774148605e-01   +2.396020099602841e-01   +3.890775373860449e-01   -4.494114217718409e-01   -4.602092088154056e-01   -5.792420270204760e-01   +5.047063629703482e-01   -5.439365225321102e-01   -1.562440560660263e-01   -1.690627937251385e-01   +3.602941870134567e-01   -4.953423390504225e-02; -4.538597285796512e-01   -8.246521045364885e-01   +5.413229378371980e-01   +3.708429284697156e-01   -1.640963465237098e-01   -8.590440707650839e-01   -8.938761051351204e-02   -4.846705846829598e-01   -1.412996445014961e-02   +2.388842939912981e-01   -4.548304064463049e-01   +7.084773461443127e-01; -4.567321831950083e-02   +2.666779199586212e-01   +1.980452220399984e-01   -1.854428335855860e-01   +1.465514525346968e-01   -1.218590013036650e-01   -8.949473842038218e-01   +1.963970827525945e-01   +4.892974412648774e-01   -2.124784418980729e-01   -4.827566268177855e-01   -5.300472715940330e-01; +4.849621609065261e-01   -5.169445417362555e-01   -3.668202742554577e-01   +3.376917050095609e-01   +5.389645145605895e-01   +2.774644094430344e-01   -1.221944092138698e-01   -3.653310810976514e-01   -5.696081154012476e-02   -4.604168424964356e-01   +4.506176193465908e-02   -8.191887087534502e-02; +8.512895196227035e-02   +1.057343017926420e-01   +8.336119423032060e-01   -8.415083612651006e-02   +6.485592102545426e-02   +1.450454980691253e-01   -1.469353998691114e-01   +4.377432947390234e-01   +8.258244077294878e-01   +5.696541482762287e-01   -2.314548926450489e-01   +1.734607920806819e-01; +3.133337019756734e-01   -3.448295027090477e-01   -2.912815788713355e-02   -1.526158018187578e-01   +2.206407013705854e-01   -1.397907805178607e-01   +2.386153116339786e-01   +5.969960476722143e-01   +1.037513772557587e-01   -2.347678945751094e-01   +5.038232325422893e-01   +7.825130548335135e-02; -2.066453128010330e-01   +4.188969620699234e-02   +3.781820419326289e-01   +3.614671813475935e-01   -2.357662414084333e-03   +1.794432844358022e-01   +4.172763790476829e-01   +8.192021459737728e-05   +3.146733638395955e-01   -3.031238747814960e-01   +7.750275492203877e-01   -2.367877748940816e-01; -5.322628640092489e-01   +6.377882307585668e-01   +7.498423773934286e-01   -9.720095769869097e-02   -6.671942380093785e-01   +4.567257489506255e-01   +6.811111273643276e-01   -2.602896294845905e-02   -8.669259531881138e-02   -3.765709438959691e-02   +9.766640569522209e-02   -3.090980105416758e-01; +6.046253603032322e-01   -1.688383030598235e-01   -1.750056854903378e-01   -4.172508004427749e-01   -5.856871307185453e-01   +3.138915547894177e-01   +4.380575501021304e-01   -6.950700343334190e-02   +4.608611034657262e-01   -2.206623988809944e-02   +6.259357249410876e-01   -6.235523011097868e-01; +7.490010286752058e-03   -2.300829370024053e-01   +3.338374346284239e-01   +1.323692666894749e-01   -5.099867733808848e-01   -4.219264705233140e-02   +3.046294038805559e-02   -7.010589694360686e-02   +5.601632001675383e-01   -4.324702517225457e-01   -1.373000113098545e-01   +2.297582035723172e-02];
L3E_L3I_iGABA_netcon = [+4.205707407982708e-01   +2.617306828583064e-01   -8.291753518647571e-02   -3.768089260575056e-01   -1.481183562165210e-01   +2.318666628784502e-01   +1.807635642762854e-01   -3.831124678711556e-01   +5.809702305078415e-01   -2.501525960479625e-01   -2.627485869256119e-01   +2.696830788814770e-01; +4.078667827329407e-04   +2.830843715642107e-01   -3.788653061601714e-01   -2.402104346980399e-01   -2.662879306270655e-01   -4.513295375305869e-01   -1.780669030928832e-01   -2.947761099417407e-01   +5.589608363974263e-02   +6.899680664185927e-01   -4.291241991275832e-01   -1.703466591145153e-01; -4.136423425332377e-01   +6.148970279986286e-02   -3.142109901294691e-01   -7.426562529969480e-02   +2.394071204243383e-01   -1.783256647924678e-02   +2.571056429603109e-01   +6.476441071437236e-02   -4.628229591389752e-01   -5.096105715820101e-03   +7.848735992745803e-02   +3.473285665208377e-01; -2.475506680890748e-01   +3.582743012807707e-02   +1.308720669807338e-01   -4.102538536238676e-01   -4.745702090919659e-01   -1.809890710916852e-01   -1.613239896497590e-02   -2.453115275707758e-01   +1.749600999579799e-01   -4.484000922425272e-01   +8.067393546171229e-01   +2.688094478861933e-01; +5.275114626533096e-02   -4.635080987652909e-01   -3.143486217030330e-01   +3.845544567132874e-01   -6.912459113878844e-01   -3.349462800732227e-01   +2.473663917213040e-01   -5.012509439597095e-01   -4.861568109576780e-02   +5.868084988838233e-02   +7.179734927420865e-02   +2.581098760175766e-01; +9.442840720967121e-01   +1.384643423540742e-01   +1.026940848130093e-01   +1.125343488242611e-01   -6.848968033548219e-01   -2.347355237471344e-01   -6.502480019770082e-01   +1.904487311836444e-01   +3.703602556915266e-01   +2.042459957151569e-01   +1.101664558144619e-01   +2.044179877640473e-01; +4.057124355301146e-01   -6.831241431439569e-02   +8.941402098346291e-02   -6.042639122494617e-01   -1.954958909823798e-01   +4.888931306169175e-01   +1.615452724094663e-01   -1.740201617863933e-02   +2.268193955759461e-01   -6.253181087111495e-02   +7.623980520262199e-01   -1.775111773801444e-01; +1.642092111215668e-01   -9.794461651494266e-02   +1.003189850551743e-02   +6.395166706064356e-01   -4.752416887588497e-01   +7.316835739361707e-02   +7.576935865978726e-02   -2.168442983709555e-01   -4.351833935348590e-01   +5.799901408505003e-01   +2.554201463571018e-01   +7.923029584101193e-02; +2.963652569293752e-01   -1.446071380492743e-01   +6.021159677448278e-01   +3.469956506854395e-01   +1.101272393047318e-01   -1.254509775905914e-01   +4.750385307535928e-01   +2.107632750335914e-01   -2.669433136849533e-01   -4.985460555807237e-01   +5.408073461113548e-01   -2.494015488418662e-01; +8.486913739997001e-02   +2.322752312955173e-03   +1.708236800041845e-01   +1.426415349721852e-02   +3.731399205472234e-01   +6.833391785228737e-01   +6.058385754157735e-01   +3.505705567031291e-01   -7.171679305211676e-02   +1.886173210347298e-01   -9.190684812012039e-01   -3.592118922684502e-01; +7.225124660660559e-01   -2.477384284717135e-01   -1.850132058551617e-01   +8.276118088016741e-02   -7.158531910429781e-01   -6.432419583463914e-01   -2.891279174283529e-01   +3.710873621572634e-01   -1.961354341528276e-01   +1.289267467013095e-01   +1.394761248279748e-01   +2.522011051735181e-01; +2.038228075199709e-01   +3.576255523419402e-01   +2.245117947160856e-01   +5.159196449538442e-02   +4.646974847193246e-01   -1.888011524920979e-01   -8.088208051813666e-01   +4.971079548515893e-02   +7.103134900449009e-01   +1.988140579097898e-01   -3.332776760835114e-01   -1.557307197201912e-01];
L2E_Input1_iAMPA_netcon = [-6.640231494306961e-01   -2.208734219996575e-01   +2.498526582528919e-01   -7.205872738373802e-01   +8.469964805866997e-02   +2.997364827637861e-01   +3.134241948744944e-01   +4.370218976540715e-01];
L2I_Input2_iAMPA_netcon = [+2.529653608833844e-01   -4.724312814732857e-01   +6.932548044176156e-01   +2.815276278555531e-02   -6.947033370565694e-01   +5.095325097416008e-01   +2.110217530940100e-01   +6.562426704286977e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
