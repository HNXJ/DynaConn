function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.471248119011458e-03   +1.469097767728321e-01   +2.601361505597046e-01   +1.988601517920683e-01   +1.749646319361460e-01   +2.756695225066177e-01   +1.412574175602833e-01   +5.422030819514333e-02   +5.321135745268916e-02   +1.291232521824001e-01   +1.669965143612477e-01   +5.932841795226869e-02   +1.166116123371221e-01   +1.912583188945061e-01   +1.243600834262601e-01   +2.120179093286262e-02; +1.068868208193506e-01   +1.907834962492173e-03   +1.508009310886779e-01   +1.775485428366157e-01   +8.112908868251777e-02   +9.047778154901689e-02   +2.607792555977556e-01   +2.809540988464418e-01   +1.936570480880422e-01   +5.702402911511208e-02   +2.838784579197018e-01   +5.974839078709832e-02   +5.829841497514994e-02   +3.661105984862184e-03   +1.520290443584537e-01   +9.250981811300950e-03; +1.930986126029011e-01   +2.006771654054540e-01   +2.410627854528938e-01   +1.321042245929445e-01   +2.747298667053319e-02   +2.413484665722699e-01   +2.535910764796442e-01   +1.229853546165389e-01   +1.340437305788358e-01   +1.177992159767056e-01   +1.320484396686280e-01   +4.423644133613414e-02   +1.858043374600400e-02   +3.913235042886025e-02   +2.322966154248051e-01   +1.669964402335004e-01; -1.125812389612396e-03   +8.085300496622245e-03   +1.325622880211685e-01   +1.805296359035308e-01   +6.044420659677050e-02   +2.239907399151158e-01   +1.275670874279985e-01   +2.738746440117708e-01   +1.383163358714622e-01   +8.504967258358402e-02   +2.528418703974256e-01   +2.499193344590228e-01   +3.604566318752523e-02   +2.631543397684479e-01   +6.155981620676480e-02   +8.525583048100804e-02; +1.323995488956803e-01   +1.836011657000037e-01   +1.781676472310708e-01   +2.016405669551093e-01   +1.085396689430910e-01   +2.375431066170505e-01   +1.413029221131361e-01   +7.453539676752698e-02   +1.593129488523497e-01   +2.426976193147271e-01   +1.057658015764219e-01   +1.938515982279433e-01   +7.215125410258903e-02   +9.623758204006436e-02   +2.546948531191144e-01   +4.468778947908193e-02; +1.394119991107181e-01   +4.173852765262441e-02   +2.367852954927023e-01   +4.924896070684551e-02   +1.798980257523634e-01   +9.229864759387775e-02   +1.232239071684216e-01   +5.607111685665310e-02   +1.361804610958024e-01   +1.387425652313980e-01   +2.092958268395494e-01   +7.219766152208471e-02   +1.383109066085518e-01   +1.528711203770898e-01   +1.317495841418400e-01   +2.050786272090796e-01; +9.006879751046284e-02   +1.864390887763868e-01   +2.642862324327432e-01   +1.847250902452435e-01   +1.115258762592597e-01   +1.718188282466365e-01   +1.068788472140102e-01   +2.363455783621468e-01   +2.746070560858632e-01   +1.112194733366260e-01   +4.370768882630054e-02   +4.862882271944163e-02   +1.241744862670160e-01   +2.693851361359851e-01   +1.188060128507904e-02   +6.967667450977703e-02; +1.612641440551134e-01   +1.002610323320910e-01   +2.150293404478338e-01   +1.734747381456650e-01   +1.683001088432727e-01   +4.153310277865215e-02   +1.875382929343378e-02   +1.278389517985462e-01   +2.196876393924555e-01   +1.894794793518967e-01   +7.802485124098786e-02   +2.156734102521634e-01   +8.463862642485113e-02   +3.088734557428407e-02   +2.025675048233017e-01   +1.709424179147528e-01; +5.879226924422631e-03   +1.899395279155827e-01   +1.918675362649348e-01   +1.939779865462636e-01   +2.817733370149822e-02   +2.525690758071686e-01   +1.259784294947956e-01   +1.277476906977162e-01   +1.375538615107381e-01   +1.362261362553888e-01   +4.713700348427784e-02   +2.558497048433214e-01   +3.418415132842746e-03   +2.154309606797489e-01   +1.041641848211293e-01   +1.429873833646615e-01; +2.032127719888687e-01   +3.445089405709653e-02   +2.505411516457351e-01   +2.298302429769689e-01   +1.740374011715103e-01   +5.154952857211705e-02   +2.738643465791708e-02   +1.061562816859558e-02   +2.108012154195044e-01   +1.111509089665224e-01   +2.889532014917771e-02   +1.570599138069572e-01   +2.369833674408858e-01   +7.191683254057527e-02   +2.474241168479702e-01   +1.824008261797685e-01; +1.131441820662734e-01   +1.384334406747663e-01   +1.409729219314422e-01   +2.248127103229599e-01   +2.487461123902644e-01   +5.611584459151348e-02   +1.792124517920746e-01   +1.630067536876564e-01   +6.361558487602663e-02   +7.911096773303883e-02   +2.084708220973321e-01   +2.697185709278020e-01   +3.704947437576261e-02   +2.021083183288883e-01   +2.162398927524277e-01   +5.660378356505674e-02; +1.484825613085021e-01   +8.276108893659989e-02   +3.042261760271663e-02   +2.935133479983707e-03   +2.742019735598905e-01   +2.574441743509868e-01   +1.416727237697160e-02   +1.947414454519289e-01   +1.968997631205816e-01   +8.689313042973185e-02   +3.419960332354629e-02   +3.920281480617111e-03   +2.641497958439341e-01   +1.949142395097073e-02   +1.533577439162228e-01   +1.156246365388741e-01; +1.821114104611047e-01   +2.095881934051786e-01   +2.473117780825911e-01   +4.094460866879692e-02   +1.838961873408860e-01   +1.984797759389612e-01   +1.985256419625017e-01   +1.828926660186431e-01   +2.537052207784116e-01   +1.233770421757730e-01   +1.161804379250671e-01   +2.458888955489734e-01   +2.340670275387907e-01   +2.038087023640273e-01   +1.290076554668035e-01   +2.528250542342553e-01; +2.392747735284419e-01   +1.867197959576899e-01   +8.875656645680044e-02   +1.721755430914757e-01   +2.899401919806685e-02   +6.889120664932709e-02   +1.760126446065049e-02   +6.730748159424926e-02   +9.600164387105733e-02   +2.039881355559063e-01   +5.854790724652262e-02   +2.290730905226691e-01   +1.605151188431193e-01   +1.759997463054170e-01   +1.133024233418218e-01   +9.191898967942379e-02; +1.154180277319897e-02   +1.527308410132386e-01   +2.418857551631692e-01   +1.462665002000245e-01   +8.014192243199633e-02   +5.476017810365363e-02   +7.872503871789506e-02   +1.104541299450727e-01   +6.520338244180535e-02   +2.812303501112521e-01   +9.904751952680116e-02   +1.336878981062069e-02   +5.079377666134322e-02   +2.069792066977978e-01   +5.382739180938448e-03   +1.952304274412195e-01; +2.232721970360311e-01   +1.059624111143886e-01   +5.662883228766329e-02   +2.712892778520761e-01   +3.415452592491568e-02   +4.204190322982865e-02   +2.490744380714233e-01   +4.201979014243348e-02   +1.711695381022014e-01   +2.156154912978696e-01   +1.854137705890863e-01   +4.263143296615239e-02   +2.096712723095794e-01   +2.223526405482435e-01   +2.655724224057203e-01   +2.493488834607155e-01];
L1E_L1I_iGABA_netcon = [+1.426129139992389e-01   +1.802269910155490e-01   +1.545619767639314e-02   +9.107391605953612e-02   +2.365641205876377e-01   +1.076944107215316e-01   +1.042661722571627e-01   +6.552210028036146e-02   +2.620326292275780e-02   +1.041967152929484e-01   +1.041376127864745e-01   +1.664604699246366e-01   +8.910257890212279e-02   +2.546525293604764e-01   +6.354948123689833e-02   +1.390835090295633e-01; +3.720744591052621e-02   +2.573087106171371e-01   +1.388328420182977e-01   +2.497356080667666e-01   +1.252902787350107e-01   +1.180038949326095e-01   +4.658468457500128e-02   +1.388712774861351e-01   +1.377478762067940e-01   +4.235047484704278e-02   +5.584410878497818e-02   +2.035374613914935e-01   +1.410100875739719e-01   +2.079148035808643e-01   +1.386449800784860e-01   +2.035091350968328e-01; +1.780996619319737e-01   +2.866610242439349e-01   +2.219504291028336e-01   +1.833151582951386e-01   +2.624191415009319e-02   +1.656658779384752e-01   +1.874366803037179e-01   +2.436507853422292e-01   +2.463935314477825e-01   +2.663617966034165e-01   +1.880360090505573e-01   +1.466913884723341e-01   +2.763485150393129e-01   +2.361858870077465e-01   +1.214670049983555e-01   +1.628010245890409e-01; +1.756613298624831e-02   +4.218785868756943e-02   +2.552494997806506e-01   +1.497294390534730e-02   +4.811163139081895e-02   +2.041303519264662e-01   +2.054000616441940e-01   +1.599023567261242e-01   +1.468785916919499e-01   +2.716827887005547e-01   +1.813300530869003e-01   +2.131294788948665e-02   +1.037577340436022e-01   +5.463786983153137e-02   +2.924650140668904e-02   +2.749200502566858e-01; +3.497018892067421e-03   +2.483682385838391e-01   +1.451691319073648e-01   +2.898345747308329e-02   +1.144305697614907e-01   +2.390659033700663e-01   +2.024120464640002e-01   +1.148371716173576e-01   +6.820719732511045e-04   +4.783194606078642e-02   +1.995419977533945e-01   +3.082023790961026e-02   +2.336935892022158e-01   +1.292522332892435e-01   +1.823333331200620e-01   +1.555482930826257e-01; +2.190704144167930e-01   +2.628261377921715e-01   +3.741963721115526e-02   +1.913452100470110e-01   +1.011591002287156e-01   -8.089431912708816e-04   +1.955650996176785e-01   +8.325463666523336e-02   +2.363525336673213e-01   +4.438855598979745e-02   +2.687166250283675e-01   +4.064884075416163e-02   +1.020944335128324e-01   +3.971050282168832e-02   +1.511777456007342e-01   +4.098418007941464e-02; +1.414360379242793e-01   +5.895116862684413e-02   +4.097999519982361e-02   +6.936161097499995e-02   +5.658642391262334e-02   +1.054243831045283e-01   +8.579800676761681e-02   +1.500605526637031e-01   +2.446824536035649e-01   +4.528483042297245e-02   +2.150082933734399e-01   +2.828674539252537e-01   +2.839892815797467e-01   +1.399077839875152e-01   +1.456334528624037e-01   +8.140859315550496e-02; +8.360691757642115e-02   +6.163060074393116e-02   +3.537007278529015e-03   +4.275858534249588e-02   +2.049168747739434e-01   +1.434096173870415e-01   +1.391532621724562e-01   +1.764108884695326e-01   +5.807152164624586e-02   +1.196069633820379e-01   +2.383760901504542e-01   +2.679369219738705e-01   +1.472501102848738e-01   +1.330927771026392e-01   +5.100856640022207e-02   +1.998326531147613e-01; +8.251057106598514e-02   +1.749650173414058e-01   +8.402516508892616e-02   +6.383067341677698e-03   +4.883516708030241e-02   +1.962244229067290e-01   +2.294088992398362e-01   +2.505627051039682e-01   +1.033721487789553e-01   +3.106688053444038e-02   +2.113540443970475e-01   +9.779479850655559e-02   +2.476741676936391e-01   +2.664089962274234e-01   +1.717003580720989e-01   +2.125535742052512e-02; +1.234735445769135e-02   +1.146865802280552e-01   +4.523999618613763e-02   +1.577914459301301e-01   +1.084553340808334e-01   +2.374080788069683e-01   +8.889833264246756e-02   +6.167343638515232e-02   +2.607859796343021e-01   +2.154003689121227e-01   +6.526074738169776e-02   +1.737873882462026e-01   +2.144496478108006e-01   +5.403828338286119e-02   +2.195592173338364e-01   +5.718447930125120e-02; +2.415120863557825e-01   +2.967858752478112e-02   +8.920453491184696e-02   +1.149426465590052e-01   +1.486539757228007e-01   +1.889739008822341e-01   +1.300445208028095e-01   +2.722024361539314e-01   +8.889395816735543e-02   +1.152339551263489e-01   +1.630520331006474e-01   +1.342995699249643e-01   +7.065020280108797e-02   +2.711721289138116e-01   +2.503516080975956e-01   +9.325875287061225e-02; +4.925062435411674e-02   +2.570723110608042e-01   +1.561185455298460e-01   +2.561820922188249e-01   +2.750653723379752e-01   +1.857375048159291e-01   +1.363064133695938e-01   +4.082683894867675e-02   +2.002558673395351e-01   +1.349578576190243e-01   +9.314026449185592e-02   +2.359753342096725e-01   +1.950914072110696e-01   +1.357273312189591e-01   +2.248481767710506e-01   +6.920310798929644e-02; +2.025852709142047e-01   +2.845746477018733e-02   +1.534386739278211e-01   +3.767380374895240e-02   +1.530879691466218e-01   +1.630847066015632e-01   +1.682841355460986e-01   +6.083071755549638e-02   +2.139003600917888e-01   +2.467656868262971e-01   +5.379096251699787e-02   +2.179537009636145e-01   +2.762648377590705e-01   +1.772666251900243e-01   +1.022938931451609e-01   +3.603773607082424e-02; +7.283517452553782e-02   +7.343911350827380e-02   +7.308712465851486e-02   +2.960950289677429e-02   +5.768843436828519e-02   +2.438298873792224e-01   +2.604011059385256e-01   +2.147184209193336e-01   +1.220893029202248e-01   +1.826666301333670e-01   +2.842629870991928e-01   +2.122897522285112e-01   +1.791401659561031e-01   +2.419013003649230e-01   +1.849422389629468e-01   +2.097388738762614e-01; +1.227678968017030e-01   +4.699097563625181e-02   +1.277133873987823e-01   +2.463113302527588e-01   +1.753685220328803e-01   +1.478065813104629e-01   +3.776561665172970e-02   +9.932985641488480e-02   +5.443542688202421e-02   +1.469876417092289e-01   +7.336014051722348e-02   +1.252671232879451e-01   +1.039164468928250e-01   +6.191366270872931e-02   +4.590866250556031e-02   +8.636775354296272e-02; +1.266160989306219e-01   +1.514979030181366e-02   +5.107167678053032e-02   +2.569855658933846e-01   +2.688110142974073e-01   +1.963666963358136e-02   +6.121847793117997e-02   +2.260575965518817e-01   +2.263047638011353e-01   +3.761897233286323e-02   +1.499473790065670e-02   +1.717066830105021e-01   +1.872787381404100e-01   +1.479560284677557e-01   +1.105848539687040e-01   +1.274329344043878e-01];
L2I_L1I_iGABA_netcon = [+2.789538859439819e-01   +1.373262845235562e-01   +8.129578233263365e-02   +2.481399363798390e-01   +2.626206609625293e-01   +2.637267650012461e-01   +1.017791517603893e-01   +2.204241205526428e-01; +2.219459169862457e-01   +2.472249439973462e-01   +2.000944386756604e-01   +8.078396174122873e-02   +1.252726387596262e-01   +1.884018668016397e-01   +2.557510480975692e-01   +6.476936469846629e-02; +6.106302888405790e-02   +6.351376605281840e-02   +7.440754932279198e-02   +1.183175866127897e-02   +2.277613069106939e-01   +2.731148295542463e-01   +3.145474125499613e-02   +1.708853301994117e-01; +1.094838485150502e-01   +2.225712504973417e-01   +1.900030205014293e-01   +1.746063077538877e-01   +1.750159813140098e-01   +1.724480502647309e-01   +1.433490354667886e-01   +2.264298472237510e-01; +9.293121480141711e-02   +5.026879570551063e-02   +1.738113428356671e-01   +1.641705982489046e-01   +1.321762417009088e-01   +2.186704169105990e-01   +1.446321940056872e-01   +1.639820363252960e-01; +2.176286638450000e-01   +2.066024352793399e-01   +2.556773541793003e-01   +1.230433717829511e-01   +8.167467452280153e-02   +1.953865781175133e-01   +7.900581255355075e-05   +1.905745224423410e-01; +3.729893950029041e-02   +1.022691422810109e-01   +1.016050366527777e-01   +6.915986895852635e-02   +1.984257231231299e-01   +7.866811170504920e-02   +6.319119868310441e-02   +1.830691642217835e-01; +1.635496006665518e-01   +1.010497172409925e-01   +2.281679451648766e-01   +1.107167428185963e-01   +8.351317818042368e-02   +1.964639536322699e-01   +1.272091083561750e-01   +8.820773244267581e-02; +1.145682455528414e-01   +1.948987830179142e-01   +5.803789858046765e-02   +7.306109859209275e-02   +9.361390634793493e-02   +4.666283907068539e-02   +1.184156768375525e-01   +2.727012421629934e-01; +1.521164484960204e-01   +1.859766788746601e-01   +6.558817281696010e-02   +1.537360137734522e-01   +9.171142717977386e-03   +1.995358785384692e-01   +2.535271520222544e-01   +1.914462753098664e-01; +1.483291945472582e-01   +2.253247479962613e-01   +2.363923524705964e-01   +1.003924052264771e-01   +2.009578293565888e-01   +2.787714450832312e-01   +5.462536690985646e-02   +7.662779353480617e-02; +2.197562226651117e-01   +1.465685944850094e-01   +1.689491975684285e-01   +1.167217252091691e-01   +2.764119234523635e-01   +7.659007242811572e-02   +1.779995459903319e-01   +9.550422019737653e-02; +8.553478475600787e-02   +2.711272985872177e-01   +2.565097602099950e-01   +5.299922861060386e-02   +1.563912635475017e-01   +8.771123357041678e-02   +8.860521387207675e-02   +1.456142078136932e-01; +1.978735948967183e-01   +7.401362530015694e-02   +2.837413207604324e-01   +1.436418594802036e-01   +2.357239417576010e-01   +5.235289177040625e-02   +2.675235105056905e-01   +6.641771380451336e-02; +2.728286689743261e-01   +5.905494695226448e-02   +7.294347081527712e-02   +2.609633818038265e-01   +1.849411566367621e-01   +3.681351383714412e-02   +1.136293122635652e-01   +2.006276227368504e-01; +5.475234084100142e-02   +1.977603689322618e-01   +1.979080849525982e-01   +1.747678526473971e-01   +2.332203123351994e-01   +3.650947641800491e-02   +2.812582843639935e-01   +7.830778176786600e-02];
L1I_L2I_iGABA_netcon = [+1.633592889771700e-01   +1.929800521208627e-01   +8.552640628608336e-02   +2.072523740061443e-02   +1.447333981308125e-01   +1.072535312708004e-01   +2.745755247054862e-01   +1.994881859763264e-01   +1.167840928080252e-01   +2.164520547204399e-01   +3.958891581458289e-02   +8.752860568392096e-02   +2.884688114312602e-02   +3.849245661468394e-03   +5.743571869803973e-02   +2.223206729238167e-01; +2.259528366468861e-01   +1.684522895512957e-01   +1.114420480739513e-01   +1.333824110703937e-01   +2.618133770706215e-01   +1.248463175973609e-01   +1.899965076193272e-01   +2.729760859060480e-01   +1.228801135110998e-01   +2.729411702444027e-01   +1.894742541125002e-01   +1.039623717517045e-01   +1.393504681282570e-01   +1.926134031880842e-02   +8.799591486007254e-03   +2.507485786258232e-01; +2.445729194034167e-01   +1.608554299801009e-01   +5.874033739037803e-02   +2.363758437985218e-01   +9.359952476467091e-02   +2.440402640223128e-01   +2.103114283315033e-01   +1.853122756248476e-01   +1.080190557520728e-01   +9.947335639106909e-02   +1.931297816046292e-01   +1.097954278698518e-01   +9.215851037005027e-02   +5.106927505918533e-02   +1.713589936840720e-01   +3.736039195477444e-02; +1.139491171469714e-01   +8.595562880442397e-03   +1.633569738678379e-01   +2.413296224097279e-01   +2.546534525570073e-02   +2.174939683834236e-03   +1.021350229086777e-01   +9.764012364224066e-02   +2.003011704569842e-02   +1.868666337828392e-01   +1.563614827330469e-01   +1.388177216213988e-01   +6.872724697811863e-02   +1.461201533654749e-02   +2.222695954207866e-01   +1.465848700180850e-01; +2.011713286676334e-02   +2.322408190161389e-01   +2.242516875236163e-01   +1.866146584641070e-01   +1.749102685063811e-01   +1.423803203917763e-01   +1.758373182200212e-01   +2.396766217717754e-01   +1.681220289164866e-01   +6.924291109013286e-03   +8.974009751606249e-02   +5.622043416754667e-03   +6.910323228374425e-02   +2.514675069642451e-01   +5.698196721207473e-02   +1.351785000977481e-01; +1.751473111225368e-01   +1.997035466467304e-01   +3.916338255688011e-02   +2.497721434781136e-01   +1.637312759991000e-01   +2.710046286661967e-01   +2.017733166868272e-01   +2.323888672406006e-01   +1.550341030446439e-01   +1.629506506096072e-01   +2.868555429845744e-01   +2.313373717420287e-01   +4.366847290033950e-02   +2.552851385255788e-01   +2.028684137642312e-01   +2.587659495106088e-01; +2.166125340510363e-01   +3.652419227720471e-02   +2.427435885157689e-01   +2.772966477226111e-01   +1.092023934085473e-01   +2.745679708904633e-01   +1.501722736040823e-01   +1.312828798003456e-01   +1.007916400462020e-03   +1.664816564482294e-01   +8.274373743604262e-02   +9.801579095113069e-02   +2.187414376743793e-01   +1.171149973104028e-01   +2.353577365552455e-01   +1.637412675524189e-01; +2.075807443290864e-01   +2.526166917272112e-02   +2.527299350716954e-01   +2.005779269802185e-01   +2.772721063518729e-02   +2.211688136332344e-01   +1.657691819998741e-01   +2.188098682315974e-01   +1.002379122525691e-01   +2.468037743428779e-01   +7.864582547312450e-02   +1.433070286807663e-01   +1.441336522164206e-01   +1.388320826125576e-02   +2.580059203518236e-01   -4.669909326106527e-04];
L2E_L1E_iAMPA_netcon = [+2.245763891264792e-01   +8.559237672723133e-02   +3.616134090491438e-02   +2.821993833982039e-01   +3.296653664784952e-03   +1.398453905080979e-01   +1.895271178993955e-01   +2.491503521153776e-02; +2.625024801500886e-01   +2.447456333717167e-01   +1.539447380069155e-01   +1.041269678497683e-01   +1.431991892175183e-01   +5.335064161399472e-02   +2.569489035720133e-01   +1.170602317937165e-01; +2.953721564457253e-02   +3.591500843299001e-02   +8.743569676657179e-02   +3.976875912528931e-02   +1.790467304735491e-01   +2.396530687603327e-01   +8.819231625252481e-02   +9.194744071506288e-02; +7.917380595606027e-02   +2.062510982885738e-01   +6.163840324195154e-02   +1.927144104456407e-01   +2.114407295985335e-01   +9.139276850841573e-02   +2.520939520650174e-01   +2.338153169933419e-01; +5.288283558159784e-02   +2.773092781716604e-01   +4.006977735778950e-02   +9.581669318474550e-03   +2.596776742534139e-01   +2.708631279610673e-01   +1.917973992941709e-01   +1.271281343260512e-01; +1.997238773133758e-01   +1.478102359796777e-01   +2.679981988596213e-01   +2.189944508357864e-01   +1.927867540221667e-01   +6.797352016163261e-02   +2.199960812401282e-01   +1.932345628922974e-01; +2.816749303234927e-02   +9.337918512698813e-02   +7.998209018642674e-02   +1.289974459288997e-01   +2.579148823511824e-01   +1.338484440801737e-01   +5.243139921803734e-02   +9.748212249844135e-02; +1.653129725245342e-02   +3.709356564150688e-02   +1.515629619198650e-01   +1.877937092042998e-01   +1.071910687371711e-01   +2.584924752740977e-01   +2.748975692272412e-01   +2.572769121085349e-01; +1.046678338129621e-01   +2.549322044206401e-01   +1.541982160654804e-02   +7.127767034892345e-02   +4.278549186250725e-02   +2.722740484238014e-01   +1.564492966957323e-01   +1.987898896005192e-02; +7.828014031847823e-02   +8.388733889453856e-02   +2.387544005568948e-01   +1.136155177157817e-01   +2.306361054553804e-01   +2.656485803599944e-02   +3.918967132890770e-02   +2.672572746201735e-01; +1.612936614534232e-01   +1.403839843674467e-01   +5.378238962330581e-02   +1.778135650323022e-01   +1.143523031617655e-01   +1.186261220178502e-01   +1.704301386070334e-01   +2.546776048635628e-01; +7.193412947221223e-02   +1.241528651983203e-01   +2.334357699535695e-01   +2.099107984153222e-01   +1.841103920296829e-01   +5.088991300987298e-02   +2.836244329219079e-01   +6.478252762458818e-02; +1.665717935407764e-01   +2.380514984968152e-01   +7.043390898154560e-02   +1.159399405973630e-02   +2.746648385565498e-01   +1.907017320096384e-01   +1.269397821995662e-01   +2.291695284641856e-01; +1.165983580357133e-01   +1.245090392616756e-02   +3.287102526650602e-02   +1.896312447203264e-01   +2.875664727985011e-02   +8.187437909891589e-02   +1.815212726187313e-02   +2.126428080454271e-01; +7.622067830474342e-02   +5.837385649347854e-02   +2.243423644187855e-02   +2.177151067194457e-01   +2.873301848925166e-02   +2.434287070472531e-02   +1.168933183870061e-01   +5.894791154821393e-02; +4.191702900960306e-02   +1.253134931718122e-01   +3.857282155683237e-02   +1.539064051281358e-01   +6.905263680181141e-02   +1.514103252300081e-01   +2.748195871229594e-02   +2.322696898103035e-01];
L1E_L2E_iAMPA_netcon = [+1.061057225168321e-01   +3.917096544896460e-02   +2.675039337704333e-01   +2.667064439074143e-01   +9.304477618795334e-02   +2.701631352085009e-01   +1.413998016595310e-01   +2.763350181301443e-01   +3.931919460266971e-02   +1.869627220568010e-01   +1.786575999778904e-01   +2.160171733176472e-01   +1.080120368576325e-01   +1.877337671203056e-01   +1.601162415733933e-01   +1.388325090085217e-01; +1.081512111788912e-01   +1.484660545219024e-01   +6.030505491316163e-02   +2.595363072067517e-02   +1.530882422028400e-02   +1.867767074683267e-01   +1.950315416280181e-02   +9.272362858373476e-02   +6.409515673987826e-02   +9.204309084283822e-02   +7.754853742141317e-02   +2.680590763218058e-01   +4.111710001751036e-02   +7.171035063120997e-02   +1.695266230627421e-01   +7.271779092497005e-02; +9.424064377513455e-02   +1.627595329566415e-01   +2.527130385818500e-01   +2.568413072737663e-01   +2.715225540500640e-01   +3.183791516123272e-02   +8.526223462298192e-02   +1.945244057990056e-02   +1.264042444701635e-01   +1.658997810298277e-01   +9.039599428999463e-02   +2.907745402686441e-02   +2.078336923049178e-01   +1.753920249714299e-01   +2.488392806323851e-01   +2.214377100151885e-02; +2.209082752738760e-01   +8.488751971207877e-03   +6.357250139619020e-02   +5.755897129569505e-02   +2.027067257100497e-01   +9.201957993403985e-02   +2.577553953288965e-01   +2.487296483515588e-01   +2.195199767108438e-01   +2.201777825165765e-01   +1.256503096297622e-01   +1.564161843384559e-01   +2.608843702189922e-01   +9.586338340589491e-02   +2.591161147680783e-01   +2.770197903404651e-01; +3.971565130365103e-02   +2.446319520050981e-01   +2.469083918708433e-01   +8.386951092934089e-03   +4.708487221825101e-02   +2.306557817303981e-01   +2.580722847294711e-01   +5.124644965801017e-02   +1.647731195239256e-01   +1.219021378623509e-01   +1.619217318651682e-01   +2.176882038030373e-01   +6.846781653184199e-02   +1.497703246675430e-01   +2.813797735872179e-01   +1.977282471977455e-02; +1.057966541686403e-02   +2.473093697269032e-01   +7.679577004379354e-02   +2.285907451291526e-01   +2.761935748592091e-01   +2.474096068779948e-01   +1.487047556946450e-01   +2.599102209756985e-01   +9.250009293498337e-02   +1.152441789425355e-01   +2.427347265366058e-01   +2.590520617592786e-01   +2.397671701547138e-01   +1.746738483218586e-01   +5.494385130890810e-02   +1.612280544472605e-01; +9.029679779016309e-02   +5.709855098949373e-02   +1.639048090313418e-01   -2.226079393973809e-03   +1.050846577138838e-01   +1.482472679335196e-01   +2.105526442264443e-01   +1.640896285378803e-01   +1.684517360861683e-01   +2.235257764292479e-01   +1.808186034978523e-01   +3.876306764784573e-02   +1.046688384698555e-01   +1.622819000509643e-01   +6.997474661705019e-02   +9.612072977953660e-02; +2.278442361092422e-02   +1.525888325620285e-01   +1.366994536178928e-01   +1.125222397740154e-01   +2.049085952534810e-01   +2.726813889181896e-01   +2.768036078371231e-01   +1.826214073973511e-01   +2.474415604568843e-01   +1.148010591570395e-01   +9.751447050776776e-02   +2.762212083391519e-01   +1.871006720542198e-01   +2.591086892198328e-01   +9.363845586418473e-02   +3.106144916663459e-02];
L2I_L2E_iAMPA_netcon = [+1.800776519432662e-01   +6.728611248008200e-02   +2.575776675694808e-01   +1.362256145096740e-01   +2.142803933839773e-01   +8.763682786825280e-03   +6.335091218321879e-03   +2.587348921474178e-01; +4.195922092164708e-02   +3.309437594734527e-02   +4.789173139486781e-02   +2.388417558177151e-01   +2.170125699801786e-01   +1.096237147904696e-01   +1.987583526809389e-01   +1.381863600500748e-01; +2.422825487554123e-01   +2.128401676397409e-01   +2.349204223668655e-01   +2.116115148338929e-01   +1.475949368694316e-01   +1.411874066818811e-01   +1.425501608885068e-01   +2.044150144888188e-01; +1.097903467008075e-01   +4.356980847315457e-02   +2.553344509681878e-01   +1.249219974069944e-01   +2.699981413912276e-01   +4.324255007241397e-02   +1.265130202904886e-01   +2.407541942141487e-01; +1.937989727711617e-01   +2.442196732819152e-01   +1.802020936424426e-01   +1.733540822686232e-01   +2.611788785234465e-01   +2.104878181029317e-01   +1.096727823368391e-01   +2.073805562727422e-01; +1.698112458834344e-01   +5.408837552241771e-03   +2.466758238528989e-01   +2.078076680735475e-01   +1.525039500889646e-01   +5.955699732323551e-02   +3.034830027541740e-02   +1.988388997113722e-01; +2.726849752898523e-01   +1.358481677680931e-01   +5.011186466742242e-02   +1.128757850975277e-02   +3.831925733224235e-02   +5.936267896766684e-02   +4.324353447324459e-02   +5.118877823621653e-02; +2.571180300889774e-01   +8.868013151992268e-02   +1.542291361916020e-01   +1.361168225735720e-01   +2.463883279120726e-01   +7.002286671799338e-02   +3.080267972908104e-02   +8.842223336910355e-03];
L2E_L2I_iGABA_netcon = [+2.628705797870674e-01   +6.579361445943492e-02   +5.383942458876551e-02   +4.744202666867040e-02   +1.891735845006775e-01   +1.053842466988348e-01   +2.375201554387970e-01   +2.633593533820682e-01; +7.285065869864558e-02   +1.178626841329887e-01   +3.697420982708143e-02   +2.393525456923376e-03   +2.817320617342987e-01   +1.981673141642852e-01   +2.136477700358874e-01   +2.397381114451060e-02; +1.850843478193304e-01   +9.812333030957951e-02   +1.591259494605317e-01   +1.790573454822068e-02   +1.121465632624058e-01   +2.318240005679545e-02   +2.733578920924318e-01   +2.339712781470356e-01; +2.400306946245358e-01   +2.504923827559251e-02   +7.738999206140293e-02   +2.023343131896174e-01   +2.604436465029498e-01   +1.819867238945024e-01   +1.221269969504457e-01   +1.885170381593943e-01; +4.538348822850283e-02   +2.544968361690826e-01   +1.993217157653471e-02   +2.340173071799322e-01   +8.817815393978008e-02   +1.029158722512012e-01   +1.427210252904911e-02   +7.607626270870629e-02; +2.106837626115151e-01   +8.967204284566484e-03   +1.536022623849829e-01   +2.208712849913280e-01   +2.528569195637177e-01   +7.458694020151151e-02   +2.644761959225634e-01   +2.138280886201599e-01; +4.312608353808639e-02   +2.763678319710840e-01   +8.234871360622674e-02   +9.793128548185195e-03   +2.011041058950940e-01   +1.472716232716516e-01   +1.661378001147977e-01   +1.749634212141402e-01; +2.443220085922301e-01   +8.619916302243268e-02   +1.439246048455032e-01   +5.870985880089574e-02   +1.305367754603914e-01   +2.235681236719344e-01   +2.690949970687235e-01   +1.812482562763381e-01];
L3E_L2E_iAMPA_netcon = [+9.846831009540093e-02   +1.828628918940447e-01   +4.251938234289466e-02   +1.840177211832933e-02   +1.249417015107598e-03   +2.796537714153269e-01   +1.078510020055070e-01   +2.444916640972994e-01   +3.290401850108707e-02   +8.445355515938156e-02   +7.853371891813336e-02   +1.876568052515269e-02; +7.619881866102192e-02   +2.562021500453138e-01   +8.531565620088462e-02   +1.042025156921646e-01   +1.287709110168309e-01   +1.591313775416065e-01   +2.554904023004639e-01   +2.805813942041121e-01   +1.615439368922261e-01   +2.713102974259187e-01   +9.267421280927438e-02   +7.296496843115877e-02; +2.343792113024373e-02   +2.154989737440434e-01   +3.242653947496005e-02   +2.105546818227884e-01   -3.101289595471509e-04   +3.202162823526017e-03   +1.485849089615926e-01   +2.726868658072036e-01   +1.669120080977028e-01   +1.727474416282793e-01   +7.146420314306011e-02   +1.942944912330063e-01; +1.039080299492199e-02   +5.604361568761966e-02   +2.304448623901774e-01   +7.476224675079120e-02   +8.326312762257571e-02   -1.925629358773718e-03   +9.682676333571377e-02   +2.220148441793416e-02   +5.941471619986514e-02   +9.314496685383686e-02   +5.814397978804074e-02   +9.207684568212507e-02; +2.591062081930893e-01   +1.077136362338489e-01   +9.283561106917736e-02   +2.783222092357272e-01   +1.955751081406195e-01   +9.821548310549495e-02   +2.774465130711271e-01   +4.988480355722107e-02   +2.399434967420445e-01   +1.330850940286610e-01   +1.958671313376479e-01   +1.120492583926604e-01; +2.467357498065942e-01   +1.688936815136654e-01   +2.497982013876582e-02   +1.380774512724229e-01   +1.773815616904484e-01   +2.613708803441752e-01   +2.533813958751989e-01   +1.087872883052358e-01   +1.293584846872315e-01   -8.052257094612314e-04   +1.828388364379142e-01   +7.237433305940863e-02; +1.784125370918544e-01   +1.448694599879744e-01   +1.809573278854450e-01   +5.936375008486605e-02   +1.853073349996468e-02   +1.041651911320362e-01   -9.160927696278242e-04   +1.008491110401347e-01   +7.979889989793054e-02   +2.390592573801267e-02   -1.016718117772411e-04   +1.288158858451928e-01; +2.406627000973087e-01   +3.159806634504404e-02   +3.243354414955841e-03   +7.374784900278543e-02   +1.561662430915826e-01   +2.773642484168017e-02   +8.198232113313051e-03   +1.350604143775313e-01   +1.367027099964858e-01   +2.369209977123419e-01   +2.646497124592608e-02   +1.690382523939671e-01];
L3I_L2I_iGABA_netcon = [+2.760157498290476e-01   +1.415160384226421e-01   +1.871206757983198e-01   +7.317130353506993e-02   +2.696465441899030e-01   +1.218029450370976e-01   +1.300526341868917e-02   +1.902804613487965e-03   +2.428771893085737e-01   +1.245002740366052e-01   +3.160231478827234e-02   +2.084602243475620e-01; +2.512767150180280e-01   +2.734425796090996e-01   +2.479564812191052e-01   +4.220681110330991e-02   +1.389483731192380e-01   +2.344396275174910e-01   +1.373290472658537e-02   +6.329447677490048e-02   +1.382701642221098e-01   +1.894812119988541e-01   +3.612739020547481e-02   +1.796791627516461e-01; +3.131065868147546e-02   +2.423067830369645e-01   +2.569115426861818e-01   +6.847133142631167e-03   +1.965363045335169e-01   +3.294769266279136e-03   +1.771501029929388e-01   +2.672705394794211e-01   +2.006880290610002e-01   +5.330130303371707e-03   +1.762712361183324e-01   +3.181156960783067e-02; +2.717744127095712e-01   +1.485640206212921e-02   +1.502766362415415e-02   +1.814662170972267e-01   +2.512503697435727e-01   +1.552522561682646e-01   +7.001755862013524e-03   +8.839473535527827e-03   +2.421684632327840e-01   +2.311737811567086e-01   +2.812931549088479e-01   +1.543792182884283e-01; +4.646494516838699e-02   +2.693467486786356e-01   +1.155684340188350e-01   +1.258063870865722e-01   +1.638485599165704e-01   +2.617623766486440e-01   +1.110169475473021e-01   +5.021578217798450e-02   +2.875211556379278e-01   +1.407901442351081e-01   +6.184794441432904e-02   +5.499652661821507e-02; +1.285519163435047e-02   +1.957612554508296e-01   +5.894498182173248e-02   +3.430539833813499e-04   +4.266942051322263e-02   +1.819408837883979e-01   +1.966844149348634e-01   +7.019867103571452e-02   +1.631454814779838e-02   +2.128234169815634e-01   +2.514418831724148e-01   +2.173744767851461e-02; +1.748086952654296e-01   +2.442370392855985e-01   +1.608533555961191e-01   +1.850580665201068e-01   +1.209405088782207e-01   +8.640279308527771e-02   +1.922870406247696e-01   +4.250930131496622e-03   +2.429650774210445e-01   +1.042845965439713e-01   +1.386979793226729e-01   +1.998524555305435e-01; +1.423260441089130e-01   +5.722295670847538e-02   +9.398765974709621e-02   +1.692133404624864e-01   +9.972058184129916e-02   +3.430720619492918e-02   +6.413688607209857e-02   +7.532162534678652e-02   +1.555861591586279e-01   +2.720069001347890e-01   +7.860307924385126e-02   +8.064987515295294e-02];
L2E_L3E_iAMPA_netcon = [+1.937308632818275e-01   +1.880368488567121e-01   +6.536103195610146e-02   +2.420966800029813e-01   +1.420253177017896e-02   +1.444021922806904e-01   +1.929024275477281e-01   +2.655434740615326e-01; +1.560680610907310e-01   +2.086479068357820e-01   +2.059415362576777e-01   +2.230411512766087e-01   +2.548369119175438e-02   +1.487774019901978e-01   +2.405415050711081e-01   +1.972042936443344e-01; +2.373055423614514e-01   +2.491775161351147e-01   +2.367068307202390e-01   +2.541563751502435e-01   +1.641953145993439e-01   +1.841305596734815e-01   +2.501997401112717e-01   +1.641280881991065e-01; +1.129251235457495e-01   +2.693274366333920e-01   +2.386036559505746e-01   +1.714552165713991e-01   +1.448156761097992e-01   +1.427316675713188e-01   +7.815428315821932e-02   +5.075305952675662e-02; +3.880951170623443e-02   +1.601683827996315e-01   +7.305467265257548e-02   +2.509328381429867e-02   +5.088917969255832e-02   +1.558225966929987e-01   +2.509027738723514e-01   +2.165084842898873e-01; +1.351770242407042e-01   +2.804700194157497e-01   +2.581374904118730e-01   +1.560528829430468e-01   +1.417193526625680e-01   +2.773258288905771e-01   +2.032640927346482e-01   +2.775212092322978e-01; +1.347263590197778e-01   +3.235707080424915e-02   +1.429321651562875e-01   +5.421722420741177e-03   +1.022639393121345e-01   +2.250306085756342e-01   +9.703618949925930e-02   +2.180892167393710e-01; +2.636164495019763e-01   +1.941473220646078e-01   +1.279943889549052e-01   +2.197218144025386e-01   +9.807998055759511e-02   +2.115637223318154e-01   +1.442821366876519e-01   +1.187092117830915e-01; +1.344511445183647e-01   +1.547517289004504e-01   +2.538423449575046e-01   +1.745674926328262e-01   +1.640356602148662e-01   +9.763041341204397e-02   +1.670334181750099e-01   +1.877740579959722e-01; +7.407504465949169e-02   +4.613515761390757e-02   +2.224722803159569e-01   +2.465343290772580e-01   +2.530629908635562e-01   +2.209932883380403e-03   +3.843478919933153e-02   +1.828352606837212e-01; +1.665183736903403e-01   +9.379897526847887e-02   +2.074046219070520e-01   +2.328980420638555e-01   +2.635327337581173e-01   +2.715582318743470e-01   +7.215949049702119e-02   +1.022430407034189e-01; +3.300556408259914e-02   +1.667886123572889e-01   +1.218816565685264e-01   +2.456355668518581e-01   +1.384409975333823e-01   +5.905717079014990e-02   +1.818642834684226e-01   +2.464476146546814e-01];
L2I_L3I_iGABA_netcon = [+2.676950628975567e-01   +1.194642746469683e-01   +8.031069282114051e-02   +1.984804198026727e-01   +2.105136254103256e-01   +2.382720382675048e-01   +8.570688660696608e-03   +1.522598912479015e-01; +1.510447983138061e-01   +1.353392252606904e-01   +1.962364434007772e-01   +4.767738065790750e-02   +2.548940578842946e-01   +2.319618822305486e-01   +1.282407383290029e-01   +7.340448231893729e-02; +2.195911600506684e-01   +2.050057262207337e-01   +2.695255358559986e-01   +1.704130056768329e-01   +9.830907560936152e-02   +1.699405058264699e-01   +1.130182743274618e-01   +4.468071963038540e-02; +5.996309527715943e-02   +2.335639076295961e-01   +6.101871110290186e-02   +1.382165671320632e-01   +1.513892010245407e-02   +9.851017957249797e-02   +1.092870357152557e-01   +2.777252755888719e-01; +8.669539817597977e-02   +1.077761371100393e-01   +1.457715576749012e-01   +1.288198447766275e-01   +1.058389245787628e-01   +1.813664949470422e-01   +2.665125595756914e-02   +4.272620901900514e-02; +7.560698961229184e-03   +7.448471581610686e-02   +1.165482228038333e-01   +5.043368514336163e-02   +9.911667120508910e-02   +1.154048813077267e-01   +1.469464438138671e-01   +1.991043890527266e-01; +1.018055985037773e-01   +1.276247220801328e-01   +2.680111055953288e-01   +1.793529328381245e-01   +2.091048695073073e-01   +8.630807138514586e-02   +8.774208846042872e-02   +8.694734865887424e-02; +8.514237165702002e-03   +2.802630822469135e-01   +8.691714929043828e-02   +2.488986676571982e-01   -1.922162104103422e-03   +2.144902450433067e-01   +1.596380457501160e-01   +2.154307799831601e-01; +2.497584696249370e-01   +8.462996548247774e-02   +2.361657232837540e-01   +1.549236369017033e-02   +1.450194676408951e-01   +8.163793762719698e-02   +1.187468624842287e-01   +1.276984075582487e-01; +2.126317835946615e-01   +1.438545348554293e-01   +7.346784586990654e-02   +1.401366829487412e-01   +1.766416221687948e-01   +9.586691021864713e-02   +6.052564193929180e-02   +8.786367946342183e-02; +2.041844262115420e-01   +2.760291036413785e-01   +1.509048605208298e-01   +1.922391622874155e-01   +7.895560908338178e-02   +1.044061308816841e-01   +2.668547743639420e-01   +3.569183367810735e-02; +2.108366599182664e-01   +1.937887751306381e-03   +9.727103851296168e-02   +3.818784503629941e-02   +4.194381059406728e-02   +2.762007994163290e-01   +1.423889615139240e-01   +1.558502818166007e-01];
L3I_L3E_iAMPA_netcon = [+1.236787087259931e-01   +2.840198790554398e-01   +7.491011950166235e-02   +1.729097867929203e-01   +2.189549304618622e-01   +9.479156383829136e-02   +8.419731234988841e-02   +6.683499567395854e-02   +9.611843309807422e-02   +7.592571893882476e-02   +7.563861627240093e-02   +1.622326667717040e-02; +1.077838967142480e-01   +2.390969027656613e-01   +6.039600250828078e-02   +3.939796024952316e-02   +2.429951637539124e-02   +1.552385800016032e-01   +1.565832669897758e-01   +1.540251370704255e-01   +6.440426129596052e-02   +1.366987087087200e-01   +2.125012221378517e-01   +1.557771284311567e-01; +1.312353084607627e-02   +1.710387153980780e-01   +1.368855316335948e-01   +1.651495543179757e-01   +1.386514636951265e-01   +1.249248599015978e-01   +1.462695834906460e-01   +1.293280508015122e-01   +1.006037492228841e-01   +1.613898017825351e-01   +1.305029981310364e-01   +1.536857499182544e-01; +1.086316248788103e-01   +2.050384584123183e-01   +1.764967889123969e-01   +1.203419591533754e-01   +1.289055946974649e-01   +2.475701900520916e-01   +2.155220871411920e-01   +3.775159134530956e-02   +2.660409142084388e-01   +2.538544712386328e-01   +4.486231288563679e-02   +2.085972852902049e-01; +3.193912946427768e-02   +9.409116668862832e-02   +6.550894587702569e-03   +2.364076914972093e-01   +2.149787449082834e-01   +1.573032029754344e-01   +2.702607531537534e-01   +1.606591324758991e-02   +2.520250598678556e-01   +1.629156078580397e-01   +1.027584863305374e-01   +3.489497784990014e-02; +9.522035722864773e-02   +1.870986516772887e-01   +2.324491426638659e-01   +1.194801167138624e-01   +2.814535065322767e-01   +4.894529524112354e-03   +2.514961188227910e-01   +7.541698113707687e-02   +1.897061915242552e-01   +8.454098538765231e-03   +9.813717220663498e-02   +4.604954165523376e-02; +2.254208357902611e-01   +1.044629130911086e-01   +1.091414373877682e-01   +7.882992959157495e-02   +1.894560768528045e-01   +5.755751489389251e-02   +1.533584727620684e-01   +2.583645458554376e-01   +2.354602901629639e-01   +2.755953024451105e-01   +1.530713320652059e-01   +2.044382032492184e-01; +2.119780237696322e-01   +5.836805250955097e-02   +2.016431855570284e-01   +1.708637183869747e-01   +2.787400349435174e-01   +1.657550404660657e-01   +3.022037373055692e-02   +1.403135456478052e-01   +1.258718170547262e-01   +8.841117118093884e-02   +7.084488345028866e-02   +2.650850567050149e-01; +2.353218534485384e-02   +2.370683176134233e-01   +2.056348558855358e-01   +2.290359922340765e-01   +1.034019009225625e-01   +2.057741568118996e-01   +5.257668572989185e-02   +2.244799535657185e-01   +2.377720160701835e-01   +1.302262863414596e-01   +6.157276929806722e-02   +6.385746619019719e-02; +2.594557099489051e-01   +2.242966582881997e-01   +1.127120405733355e-01   +6.241657896377947e-02   +1.607714961427278e-01   +2.226851510258550e-01   +1.399372056727759e-01   +2.514156922397029e-01   +1.916875970077075e-01   +9.229679641158320e-02   +2.534539438641444e-01   +5.943201054899480e-02; +1.215182780437135e-01   +1.006472394742255e-01   +2.816680920802769e-01   +2.682593849901693e-01   +6.452609542574058e-03   +1.727135657072101e-01   +2.084930477004374e-02   +7.116310636750445e-02   +9.768700562683414e-03   +2.709873315563115e-01   +2.074808497780793e-01   +1.038394285962030e-01; +2.691615910700255e-02   +4.624595424728594e-02   +1.390828097128196e-02   +1.269218939067219e-01   +1.221917825605834e-01   +6.504256974605721e-02   +2.224506700505789e-01   +5.137900798712598e-02   +9.247091923749971e-02   +6.740869956478646e-02   +2.140706713774395e-01   +7.991805687896039e-02];
L3E_L3I_iGABA_netcon = [+5.381746786158073e-02   +1.275146408444541e-01   +9.479278256724860e-02   +2.571614625180101e-01   +2.307124642568900e-01   +1.558747394708433e-01   +8.988971282682401e-02   +2.125316465333168e-01   +1.812725302767415e-01   +2.077490962248290e-01   +1.700021085787702e-01   +6.882623846975794e-02; +2.193590324057028e-01   +1.818178286303053e-01   +8.599237266279625e-02   +4.432498692653074e-03   +1.037333907979862e-01   +2.021746036318622e-01   +1.820773239973723e-01   +2.780919788893070e-01   +2.405598245235413e-01   +1.298527790680578e-01   +3.452303313435842e-02   +2.209349729374304e-03; +1.607396960223456e-01   +2.704309126315065e-01   +2.715790001721207e-01   +2.397375861149942e-01   +4.671304301769737e-03   +2.116650890932668e-01   +1.654177642873317e-01   +1.969292183434027e-01   +1.116995459244986e-01   +1.146891633606498e-01   +7.791699411110753e-02   +3.957571732063109e-02; +1.218585351721743e-01   +1.784006122537732e-03   +4.334572752118587e-02   +2.004353416881590e-01   +2.012796453339026e-01   +7.556686324734919e-02   +1.176820152754260e-01   +1.048221943064522e-01   +2.764968094529246e-01   +1.278366246821875e-01   +1.139837079169173e-02   +1.664286536173635e-01; +1.229791423051347e-01   +1.121445454982799e-01   +2.803076370388060e-01   +7.659932736373956e-02   +1.514881243278412e-01   +2.142854755772899e-01   +2.743728610370967e-01   +2.618874378989122e-01   +7.576785759388302e-02   +1.627366498579858e-01   +2.362208455849965e-01   +1.665381872330641e-02; +1.901052756256274e-01   +1.305996541054018e-01   +2.391211940162508e-01   +2.680515121202530e-02   +1.383494312839045e-02   +2.798871560671307e-01   +2.279592425667108e-02   +1.703111707886105e-02   +2.333485890650016e-01   +1.714928412216621e-01   +7.382922561636235e-02   +5.957903714302750e-02; +1.598657206385772e-01   +9.998138521705682e-02   +1.371431173147152e-01   +1.629000715842474e-01   +1.914941521779903e-01   +1.360027745555648e-01   +9.269277174527808e-02   +8.764377226076368e-03   +9.565997814126188e-02   +4.668947343889981e-02   +8.637888028052976e-02   +2.004076305564388e-01; +8.940000295945759e-02   +4.534152583483211e-02   +3.452412869958191e-02   +2.572960341033953e-01   +1.254937702453641e-01   +2.160851467521425e-01   +1.483353580684403e-01   +2.159708403456642e-01   +2.213237216774080e-01   +2.396713336734380e-01   +4.375675850550001e-02   +1.649805303028922e-01; +7.922582854321582e-02   +5.555240887071094e-02   +2.158175496203606e-01   +9.805290123148215e-03   +2.672073985000761e-01   +2.542744922190769e-01   +4.831685892976718e-02   +2.014259828485088e-01   +6.644592036151693e-02   +1.149870056425097e-01   +1.201930363522061e-01   +1.706193020858827e-01; +2.298500997444153e-01   +8.869007067298645e-02   +2.390792941403633e-01   +9.061331521060657e-02   +9.975089313517886e-02   +2.773101650160432e-01   +2.157982559080762e-01   +1.588490633615528e-01   +2.609443172511756e-01   +2.754716125514477e-01   +4.746287992916587e-02   +8.153931629407828e-03; +1.559149542336811e-01   +4.422611230073103e-02   +6.093727266310351e-02   +5.602114136183425e-02   +2.199988453160581e-01   +1.438648133001713e-01   +2.470548737009647e-01   +1.750553206768586e-01   +1.598801932060434e-01   +5.186842636248811e-02   +2.375716757476607e-02   +2.250356655595637e-01; +1.795610140350917e-01   +1.434813483888754e-01   +2.829874605523310e-01   +2.000987170622732e-01   +7.289369867885169e-03   +1.464624670331683e-01   +2.774039466511274e-01   +2.127931790296508e-02   +2.209133423758668e-01   +1.101234375526613e-01   +1.332498292464414e-01   +1.247502035489833e-01];
L2E_Input1_iAMPA_netcon = [+2.839698382144752e-01   +2.843132380683682e-01   +2.843457279835428e-01   +2.862253131051286e-01   +2.874127841710301e-01   +2.908501654496176e-01   +2.872014901777211e-01   +2.763990178787216e-01];
L2I_Input2_iAMPA_netcon = [+2.881591059622024e-01   +2.884725045378421e-01   +2.829702151457675e-01   +2.808734926843788e-01   +2.810466016343304e-01   +2.834805455718959e-01   +2.816514874365240e-01   +2.824547811643871e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
