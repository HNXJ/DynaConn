function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.502421874393966e-03   -1.815874011283286e-03   -1.148546132417592e-04   +7.045757629575839e-03   -3.214323781715954e-03   +7.198898217155811e-03   +5.099897698571687e-03   +3.233749409369474e-04   -2.204345160159800e-03   +7.900723438808313e-03   +3.694357987274829e-03   +3.363598260165184e-03   +5.996211953935118e-03   +2.162191018752906e-03   +1.189098959139570e-03   -5.589807291510331e-04; +1.879678828343035e-03   -5.413224410632483e-03   +6.953927240008281e-03   +9.451640838307979e-03   +7.248112358820883e-03   +4.769112140353158e-03   +8.685518358648697e-03   -4.661991271666953e-03   +2.676939940320848e-04   +9.687211815782854e-03   +4.900707773623287e-03   +5.996622653077046e-04   -2.897325076050428e-03   -4.993110404592883e-03   +1.545249247160650e-03   -3.400416521261340e-03; +5.226896565859422e-03   +4.345124236464684e-03   +1.791308595364815e-03   +3.420123301878937e-03   -3.108937754276376e-03   +3.521325001675300e-03   +3.923567626263620e-03   -3.704085686921798e-03   +2.625758438487460e-03   +6.767775838325145e-03   +2.266102930124231e-03   +3.019314529382582e-04   +7.520181023006477e-03   +2.369857880126188e-03   +2.458890271986613e-03   +3.583660735461866e-03; +1.966653620370257e-03   -1.674897781725280e-03   -2.291160310842302e-03   -1.810592129658178e-03   -1.907454926564138e-03   +1.092741456595009e-04   +4.849475407193588e-03   -2.833243587996546e-03   +3.947002457205711e-03   +8.336879065716101e-03   +6.418795745265988e-03   +5.526757444405667e-03   -3.904652406747592e-04   +7.725497733157813e-03   -4.108519308417547e-03   -2.265042566177573e-03; +4.045917826861875e-03   -5.372090709199652e-03   +7.148021789811715e-04   +4.565594266550458e-03   +7.992264108728456e-03   +2.252936599012168e-03   -2.090175332060447e-03   +3.111742299835096e-03   -1.318935768196040e-03   +4.867198644192262e-03   -2.461558619400750e-03   +7.383706373433329e-03   +2.670718105939067e-03   +3.044819311046739e-03   +1.355201798388488e-03   -1.445032822019314e-03; +1.129135517280244e-02   +9.018334411076826e-04   +1.096921570507290e-03   +5.770923993969996e-03   -5.710860838933690e-07   -1.177552378608834e-03   -1.164785237066586e-03   -7.607464411580780e-03   +1.567133930091756e-03   -2.464149608373007e-03   +4.426817529338818e-03   -2.954344124533070e-03   -7.315307967051383e-04   +3.439524691778132e-03   -1.771882052912399e-03   +3.496550545626581e-03; +9.018083311917899e-03   -8.273006085570732e-04   +2.745123499231413e-03   +9.048896461696238e-04   +3.486327279330521e-03   +5.541710102510783e-03   +1.928168856766267e-03   +1.384690790903649e-03   +6.567980414549099e-03   -3.801904938777566e-03   +3.632226488664942e-03   -1.509197470005720e-03   -5.292105979714922e-04   +1.955049284649186e-03   +3.487293417058479e-03   -3.699441887213707e-03; -4.821631563231596e-03   -1.129445931185890e-02   +2.524415781908554e-03   +2.215246593935236e-03   +1.926634282472816e-03   -2.851678888320385e-03   -1.680980900027238e-03   +1.838484807484237e-03   +5.273870881340889e-03   +6.802597531027294e-04   +6.382340810238594e-03   +7.923090674038328e-03   +7.582636577283400e-03   +3.324895938288035e-03   -1.883445897508168e-03   +4.673524555584953e-03; +7.119658669353618e-04   +5.121032174413721e-03   +5.232990609624119e-03   +9.142942639158238e-03   -6.404809572459896e-03   +5.773490960549413e-03   -3.816226026444932e-05   +1.345275104247682e-04   +6.746641588595857e-03   +1.077479902738678e-03   +2.038303807263023e-03   +7.845860692355008e-03   -2.424493052226497e-04   +7.815889930204982e-03   +1.101667929966607e-03   +1.903846209884442e-03; -3.206428231223130e-03   +8.847585405736047e-03   +8.574702388841301e-03   +2.741182565719740e-03   -5.244799283175216e-03   -1.645023134233285e-03   +4.923651517929338e-03   -1.811288670340617e-03   +8.409719714836100e-03   -2.850348064896421e-03   +2.163161103229994e-03   +2.499720469541599e-03   +3.509535263853971e-03   +7.795595434705438e-04   +8.494406607486368e-03   +2.136893484136133e-03; +8.116982387800710e-03   +2.303814468683094e-03   +5.617412023658344e-03   -2.458574608008835e-03   -3.539896592405192e-04   +2.678644048149106e-04   -1.039579989112613e-03   +9.564030681964580e-03   +3.579532454134605e-03   -7.446842824162179e-04   +1.055852285860759e-02   -8.071173505958072e-05   +7.823728188074794e-03   +5.739624529361781e-03   +4.346308160234206e-03   -1.135469492168579e-03; +7.452197118587560e-03   -2.970161583547941e-03   -5.001945610889943e-03   +1.361023608335492e-03   +8.813637658287040e-03   +5.060996430322890e-03   -1.800052759775267e-03   +2.058091892899847e-03   +3.984800126975545e-05   +5.737102164296019e-04   -2.323854509021491e-03   -2.806481537629584e-03   -4.095435737845439e-04   +1.151158387819100e-03   +1.034028195985889e-03   +1.653771996117795e-03; +7.493610351500382e-03   +2.157294064124700e-03   +2.874490180337796e-03   +2.962884831583777e-04   +5.433518423358114e-03   +1.247000809761557e-03   +3.416569706641358e-03   +5.227021151538220e-03   +7.653655570704019e-03   +4.681559071672001e-03   +4.665250550173201e-03   -3.325511880298456e-03   +1.685767320526365e-03   +9.140695413521443e-04   +5.286966024243321e-03   +2.497644363774692e-03; +8.292047581794826e-03   +7.753101189615225e-03   +9.224923086159093e-03   +8.503405117871170e-04   +5.236691978932010e-03   +5.713991518379194e-03   +1.788698620850681e-03   +1.073849636686943e-02   -1.042464496522288e-03   +2.648970404364175e-03   -1.742694773652372e-03   +7.101896944007036e-03   +4.287656180493227e-03   +2.396420945177330e-03   +1.889583627563774e-03   +2.026271354948857e-03; +1.475912193109935e-03   -3.163242306300606e-04   +4.283484911270174e-03   +8.793373124375372e-04   -2.836519362348039e-03   +8.916418904185795e-04   +4.857032206473737e-03   -1.809984185798893e-03   +2.713285095581395e-03   +7.878590587421012e-03   -7.494173168380112e-04   +6.976353515261029e-03   -2.532164866328347e-03   +3.364621595427392e-03   -5.520077635232588e-03   -4.571499479446430e-03; +2.807046870418859e-03   +1.551746323156598e-03   -2.726754867803037e-03   +7.968127700394703e-03   +9.400889996095101e-03   -2.325791014320769e-03   +7.382270066671431e-04   +2.712339104867537e-03   +4.780601894844470e-03   +4.252863600466509e-03   +9.116394334860185e-03   -7.172975297642395e-03   -2.012725097811425e-04   +1.635114615600342e-03   +8.626132230737563e-03   +7.110154863687386e-03];
L1E_L1I_iGABA_netcon = [-1.109255024507766e-03   +1.215101371855161e-02   -1.305369712288567e-03   +3.512936907130812e-03   -1.672044667408481e-03   +8.202762627945471e-03   +6.315888732056927e-03   -3.779812240496782e-03   +3.193567843868275e-03   -5.752699846114201e-03   +3.395848001570135e-03   +2.526879739683469e-03   +6.035987970346122e-03   +4.407475353301246e-03   +1.125758362500326e-03   +5.325580820073261e-03; +3.792606813283072e-03   +4.069342668144787e-03   +9.372635034836443e-03   +4.610121808762002e-03   -1.513474605401668e-04   +1.678555281875530e-03   -4.963063049716014e-03   +3.986160791846287e-03   +3.472870188235990e-03   -6.156560244813571e-03   -2.320602813076072e-03   +1.782366982972772e-03   -2.906990883685208e-03   +1.166797076763037e-03   +1.564794367082895e-03   +3.009482315003692e-03; +6.813982941931266e-03   +6.702840897994674e-03   +1.489814807421923e-03   -1.847609703974185e-03   -3.342745737050551e-03   +3.504503730780146e-03   +2.498864883556695e-03   +8.243044412798926e-04   +1.337333868204908e-04   +1.035485305317921e-03   +7.471810515856450e-03   +9.875913676194246e-04   -4.250571172980471e-04   +8.500821367100488e-03   +3.571454557379263e-03   -2.434784115074355e-03; -3.424617015394065e-03   +2.289916994806171e-03   +3.469904922654420e-03   -2.175840066465558e-03   -4.802250541442783e-03   +1.002420084958810e-02   +1.883030592106964e-03   +2.867838816574116e-03   +5.917715794263687e-03   +7.668076646890688e-04   +7.803074757242085e-03   +3.828399516055135e-03   -3.984511252668080e-04   -3.784328737388386e-03   -3.638543412191681e-03   +1.150637269094848e-02; +2.852356987229990e-03   -6.695572839583285e-05   +1.348820696972573e-03   -1.198979941299861e-03   -4.826664931967375e-03   +1.035011574166133e-02   +1.846024207394175e-03   +6.464166349743049e-03   -2.526330675606914e-03   +2.959995512000445e-03   +6.874854924103571e-04   -5.303111896995578e-04   -1.126338145616099e-03   +1.394784169604884e-03   +5.748317520025845e-03   +4.250513240640443e-03; +1.905078033991298e-03   +2.368246919964834e-03   -5.041000485475197e-04   +4.660838852196905e-03   +1.993338993855765e-03   -4.941428005515429e-03   +6.941484345500459e-03   +3.335070338550023e-03   +4.801661853412962e-03   -2.565530155660825e-03   +6.651662982997758e-03   +3.069053836326592e-03   +3.661344871011610e-03   +2.632082257421706e-04   +2.538685735516242e-03   -4.407908842520785e-03; +4.018314332863716e-03   +3.432123299639005e-04   +1.654892514480386e-03   +1.183755637805802e-03   +2.724902878375306e-03   -1.075225341360765e-03   +5.585033852541769e-03   +3.417434432691526e-03   +3.289209268721292e-03   +1.360266888610116e-03   +6.357738109349453e-03   +4.619855761487887e-03   +6.338820542178459e-03   -8.675848980666269e-04   +1.825501072762672e-03   +1.992247154717062e-03; +2.552787423114889e-03   -4.090868787922407e-04   +1.787568752127776e-03   -4.688176671844181e-03   +3.917212917538891e-03   +1.786714951780957e-03   +9.624679474299076e-03   +6.274656662048889e-03   -6.332269115126319e-03   +1.851247948460086e-03   +2.449508799655448e-03   +4.737303923491270e-03   +2.205565946034733e-03   +1.860708453276808e-03   +2.104189757373493e-03   +1.265809876110706e-03; +3.527587080989388e-04   +5.723545909985281e-04   +3.749515642631474e-03   +3.856768366218829e-03   +7.291259011999756e-03   +8.333064016008852e-03   +7.680042288460235e-03   +4.184161907790042e-03   +4.570976573152240e-03   -1.414099583955887e-03   +6.782317862716888e-03   +5.297881906821600e-04   +4.300205316521669e-03   -5.461318984325472e-04   -2.180985161854094e-03   +4.187690596780961e-04; -4.979034638203447e-03   +2.481748875183289e-03   -3.645095937231547e-03   +9.470707742669627e-04   +4.335711366914581e-03   +8.049741866957328e-03   +4.644532313235943e-03   -6.681990971122770e-04   +7.066244453744952e-03   +5.181902074400719e-03   +2.502913330226352e-03   +7.686427284801763e-03   +5.718048197753995e-03   +4.784226120823911e-03   +1.629397324512763e-03   +6.299301248343781e-03; +6.179543936139162e-04   -7.579693456668427e-03   -2.104202430619902e-03   -4.468642919777684e-04   +2.071186176463036e-03   +3.665017203574460e-03   +7.397938762317926e-03   +6.570506306642401e-03   +2.166214748973874e-03   -1.858077904640230e-03   +2.587274576273401e-03   +7.201829595532856e-03   +3.331359081861359e-04   +1.628542349167440e-03   -5.625827833644595e-04   +2.849388436835982e-03; -5.815527978154360e-03   -7.026744462206280e-04   +7.509960720702093e-03   -2.611408173990204e-03   +1.338725529166374e-03   +3.355582144918845e-03   +7.707214862441741e-04   +7.399903652199832e-03   +3.619629402864834e-04   +2.011048011939838e-03   -1.644226159451671e-03   -1.745671127534429e-03   -3.053137286619431e-03   +7.566085604599915e-04   +5.843627126530984e-03   -2.977063134582999e-03; +3.695709682310157e-03   +2.212377430000250e-03   +5.262439997420926e-03   -3.471239762652955e-03   +1.756960713336973e-03   +6.992773774811244e-03   -1.890940541025416e-03   -2.303092725117700e-03   +6.287329943599981e-03   -1.107924520099927e-03   -4.751210337881702e-04   -3.860050330082205e-04   +7.220408211088956e-03   -2.150372560571697e-03   +7.938649466382596e-03   +2.381575316735858e-03; -2.078498370392612e-03   +5.452520425492614e-03   -2.933573193382147e-03   +1.555265477989994e-03   -1.609789366174604e-03   +6.288619706250812e-03   +1.159861906379592e-02   +5.592417503783182e-03   -7.754127073304341e-04   +7.005283863711030e-03   -4.182267647823016e-04   +4.307218763996112e-03   +6.209756039100785e-03   +1.207675992140571e-04   +5.477600844229462e-03   -6.254150520979228e-03; +2.063936683377774e-03   -5.937090153266478e-03   +3.263922654412173e-03   -1.297751068974910e-03   +7.976272867233687e-03   +8.876964142679187e-03   +2.553608275930540e-04   -2.605312587546741e-03   -2.667333105092484e-03   +1.388691481724953e-04   -3.268228170612600e-03   +6.015477061876684e-03   -1.255366435168033e-03   +2.576302102770399e-03   -2.611668493752130e-03   -1.754213783471617e-03; +3.636025042257214e-03   +3.043577763730981e-03   -3.927508520862052e-03   +1.171734174664223e-03   +8.810259602154690e-03   +1.213344883158075e-02   -1.336013536804177e-03   +3.154742008802295e-03   +5.156947568029307e-03   +3.859535963032894e-04   +1.373592818909151e-03   +2.642543875843915e-03   +5.920377241415903e-03   +6.195924125115534e-03   +3.639351099202346e-03   +9.324358990503108e-03];
L2I_L1I_iGABA_netcon = [+6.397707799669050e-03   +1.347735004688000e-03   -5.445586384502888e-03   +8.103699209954591e-03   +6.615484592453681e-03   +3.778477362575160e-03   -1.220964796247511e-03   +1.392619141981122e-03; -2.124448194775294e-03   +3.287587318390397e-04   +2.426754801163513e-03   +9.352396045136119e-04   +1.744288372989278e-03   +5.769182528814715e-04   +3.794395665582951e-04   +1.237585425401978e-04; -1.379869074764749e-04   -1.243936105406968e-03   -6.775842809009146e-04   +5.807113294841007e-03   +5.846653730547199e-03   +1.153756025543315e-02   +1.787864829426197e-03   -5.785980091534051e-04; -1.543643267110333e-03   -3.972603841407636e-03   +4.918322756298585e-03   -1.596479982960151e-03   -1.172044742151115e-03   +1.245456757448375e-04   +3.165242282992592e-03   +6.408470015637859e-03; +2.587291411759036e-03   +7.396536752933816e-03   +5.932849090714129e-03   -1.025059036241170e-03   +7.429115299358297e-03   +3.804672608106133e-04   +3.208605474639943e-04   +3.662297926236296e-03; +8.496563727621056e-03   +8.896528518784188e-04   +6.359136602082459e-04   +5.699196835943159e-03   +3.043795738710004e-03   +1.899403997279882e-03   -4.539889686309600e-03   +1.040896212284551e-03; -1.604958595181546e-05   -5.797536634083993e-03   -5.380063485408932e-03   +3.915988139118051e-03   +3.215560761080343e-03   -5.253368847618314e-03   -2.674396929739742e-04   -2.036596230507224e-03; +3.820590749154833e-03   -3.740094712079887e-03   +1.989261628739089e-03   +5.685212646606302e-03   +4.409829780063105e-03   +1.154065341112485e-02   +3.691347431317247e-03   -1.266831742812912e-03; -3.088925152933727e-03   +5.131789162121529e-03   +5.596661060400325e-03   +3.561021454696963e-03   -1.374966910917444e-03   +2.187122267594405e-03   +9.092236837360461e-04   +1.173011397531408e-02; +1.597315555385825e-04   +3.972644975932648e-05   +2.292559277418093e-03   +5.753675855938131e-03   -1.134210034277615e-03   -7.274148091680696e-04   +4.725268759060916e-03   +4.040535992177473e-03; -3.735336712910500e-03   +3.292900213932914e-03   +8.632842199159866e-03   +4.358752823527131e-03   -3.104184555014411e-03   +3.121668297398931e-03   +3.287270797290123e-03   -1.946997063212363e-03; +9.689540189253687e-03   +2.242751453092945e-03   +2.232511340678490e-03   +3.485142530408091e-03   +6.144436948721778e-03   +2.145105830902904e-03   -9.767418575022200e-04   -2.097384117367629e-04; -2.900828749281362e-03   +6.708457974908957e-03   +5.237008172386043e-03   -2.225071162543989e-03   -1.005005173269996e-03   +1.472335812386349e-05   +6.446050635876581e-03   +1.426085292728413e-03; +5.452129020231128e-03   -2.125396989415901e-03   +6.573503807565523e-03   +4.937851457468604e-04   +1.209127850416717e-03   -2.987010237330227e-04   +1.669093562147099e-03   +1.044958683168255e-03; +1.663344703685112e-03   -1.454537952915211e-03   +6.266311741203621e-03   +3.464394777065543e-03   +3.496089564531536e-03   -5.331385911037643e-04   +5.200634731069101e-03   -5.927230835375279e-03; +2.386188754655974e-03   +4.726260183795273e-03   +6.712326598066200e-03   +9.313349423311541e-03   +2.558553029812868e-03   -3.948514203930826e-03   +4.160797062681999e-03   +1.172567516749979e-03];
L1I_L2I_iGABA_netcon = [+3.436238228609426e-03   +5.189229324662735e-03   +4.175347609022134e-03   +1.212752180959064e-03   -5.656527264453109e-03   +5.197592134357736e-03   +9.482853322257413e-03   -2.840109445757782e-03   +1.133737061933686e-02   +9.046303184667356e-03   -4.830555227216834e-03   -7.946968243905598e-05   +5.900507057584127e-03   +4.497807754494971e-03   -4.274095880232521e-03   +4.459499952727531e-03; +5.011246872652586e-03   +4.052154726579011e-03   +1.737456343264315e-03   +3.268250406909844e-03   +3.380707189184891e-03   +1.122436238100468e-03   +5.462270993863167e-03   +4.889109869853276e-03   +3.023680297558435e-03   +1.275530857363582e-03   +6.363594565645002e-03   +5.159856709332866e-03   +6.143263871486723e-03   -1.113470708324100e-03   -4.417186941963786e-03   -3.873436096486292e-03; +5.089129020786418e-03   -3.014219570275473e-03   -2.333855439357713e-03   -3.912474605163715e-03   -3.261320234082836e-04   +5.696270061591737e-03   +7.741981203189243e-03   +2.469456964120634e-03   -1.111662912276281e-03   +8.496176270714660e-03   +4.927815018598335e-03   -2.869979407237674e-03   -2.919525759886700e-03   +3.642519162259219e-03   +1.408903967200546e-03   +3.973702277641699e-04; -2.904414806613473e-03   +2.385024582689747e-03   +6.685967337291055e-03   +1.298262680321984e-03   -3.442144826164110e-03   -1.825603518507870e-03   +2.747641735202792e-03   +3.123639438985282e-03   +2.037521645358452e-03   +1.215834949123374e-03   +4.469734584894931e-03   +5.822328080599874e-03   +5.302395857613913e-04   -2.522179022296063e-03   +6.217041275733729e-03   +4.536407827614540e-03; -5.150071985415236e-04   +9.279049444859133e-03   +5.194273029482630e-03   +4.598845497533977e-03   +1.769843614905456e-03   +6.518803055798663e-03   +4.662332393832648e-03   +1.101943001037037e-02   +1.232537004565297e-03   +2.986796280769014e-03   +5.357826645270868e-03   -3.569291324973382e-03   +6.178195843438457e-03   +3.352091484047381e-03   -2.326689634165457e-03   -3.184428269809636e-04; +4.669285838716737e-03   +4.451938421404253e-03   -2.639532026318842e-03   +2.924294982646392e-03   +1.077361614665668e-02   +6.558339932162220e-03   +9.210985084753936e-03   +2.327408785574069e-04   -4.601301684459226e-04   -1.040102405988335e-03   -1.454440934481589e-03   +7.750862664942060e-03   +5.488809859810212e-03   +1.971449457276934e-03   +9.951426034621872e-03   +1.442598790479705e-03; +3.989654550028268e-03   +8.130679610215073e-03   +5.372417848326276e-03   +2.337384880950965e-03   +2.693651235405427e-03   +4.986318574246177e-03   +4.691495904171053e-03   +1.260666196182371e-03   +6.965855806706099e-03   +8.440690847473719e-03   +5.434837358389855e-03   +2.164445452510143e-03   +3.579952169796455e-03   -3.880714069526773e-03   +4.383925989370466e-03   +3.136048956516946e-04; +2.386916915565692e-03   +3.599516917029833e-03   -3.204281839857441e-03   +3.171136720932305e-03   -2.530217262016026e-03   +3.624986757408697e-03   -1.418634635227360e-03   +4.728905828734475e-03   +1.344757638865083e-03   +2.627659268059982e-03   +1.676182156570291e-04   -8.379558615967931e-04   -2.445906839470352e-03   +1.566618104250825e-03   -1.670227689119956e-03   -1.251671182236151e-03];
L2E_L1E_iAMPA_netcon = [+2.288325711078152e-03   +5.857029043109712e-04   +2.671003077114845e-03   +4.984824406793940e-03   -3.081532098082466e-03   -2.807486264240606e-03   +9.473676480272147e-03   +4.138909651702907e-03; +4.730871935660555e-03   +1.843304186144549e-03   +2.213658723683296e-03   +2.466838282329271e-03   +2.228037380568930e-03   -9.266775919388446e-04   -2.903100793138305e-04   -3.664438089820662e-03; -3.428224937726176e-03   +1.664345076369703e-03   +4.362848305770398e-03   +2.817943905361535e-03   -5.294365081354954e-04   +9.804593698868999e-03   -2.105574643413037e-03   -1.209355008593246e-03; -8.576590085445320e-04   +5.505098793904463e-04   -1.027443527971850e-03   +5.693946911342134e-03   +8.889149147045080e-03   -1.250682952957601e-04   +2.119191458965678e-03   +5.280506852152695e-03; +2.772441733307023e-03   +8.333523716994936e-03   -3.729444071936315e-03   -8.524596939044114e-04   -7.412628176630407e-04   +2.003382511987654e-03   +5.070204625427815e-03   -1.124848680923560e-03; +3.569661088537424e-03   +4.071962948639036e-03   +9.415261920094925e-03   +1.035614211069571e-02   +6.059862153863538e-03   -3.717491158201694e-03   +1.934978279462200e-03   -1.357691595325364e-03; +2.682029206811951e-03   +7.838502990071970e-04   -6.311190033620035e-03   +5.417467898460469e-04   +9.361401353250253e-04   +3.186451110686390e-03   -6.196889279302419e-03   +6.409911425747280e-03; -6.177028306266283e-03   -4.427712727370386e-03   +5.749773446705455e-05   +3.815786192221391e-03   +6.429604062907217e-03   +3.714146615957007e-03   +7.579008639067782e-03   -3.299350476077026e-03; +2.048524704837568e-04   -5.249857666882837e-04   -4.026047431774374e-03   -5.549131595734172e-03   -7.579690484697539e-03   +9.353979420940253e-03   +4.797539901214606e-03   +6.443099423081828e-03; +5.176344043257008e-03   -5.455604699968156e-03   -9.424690179107699e-04   +7.077907219360254e-03   +9.932360902916741e-03   +9.253836058228946e-04   -1.187751130244376e-03   -1.669515636194195e-03; +4.980446360484676e-03   +6.023788016600276e-03   +6.136994446739271e-04   -3.467794297103032e-03   +7.056903036938443e-03   +1.076255067687021e-03   -2.076436482717247e-04   +2.926298042523341e-03; -1.181727350656972e-03   +2.845727957654948e-03   -2.546342206939760e-03   +8.352228636874914e-04   +3.595946351878936e-03   -6.344190174259398e-04   +9.941610443244018e-03   +4.610022598593127e-03; +6.150409680819750e-03   +1.060870561977496e-03   +1.655779947028683e-04   +2.705881199219830e-03   +7.976689414428577e-03   +2.126055446515866e-03   +4.667266450564389e-03   +7.425301862723568e-03; +1.140736237535347e-04   +3.890094436854469e-03   +2.863487069739754e-03   -1.749457030683641e-03   -2.749908273926943e-03   -1.789240738776495e-03   +5.426362771835327e-03   +1.556516500661585e-03; -1.329968873623031e-03   +1.485002169179863e-03   -2.400602615459327e-03   +4.902399347721542e-03   +1.904702284412081e-03   -4.762354592367443e-03   +3.785146641850812e-03   +2.723080869160202e-03; +7.079212718436078e-03   +3.862092134952201e-03   -2.061476770898214e-03   -9.351313446260166e-04   +7.801462239061781e-04   -5.601479846997047e-03   +4.965167370809963e-03   +3.921969620327299e-03];
L1E_L2E_iAMPA_netcon = [-1.118898410142264e-03   +4.136338153636701e-03   +1.867893992533423e-03   +4.659936544173392e-03   +1.236075749079742e-02   +1.031776198266992e-02   +5.314312055687245e-03   +6.461219329559936e-03   -4.127650564468333e-04   +2.364514069876882e-03   +3.337518825442426e-03   -1.838117545808866e-03   +6.300454287924947e-03   +1.693134737894711e-03   +9.025081635544697e-04   +5.204218344185810e-03; +1.654554367998162e-03   +8.636406242855313e-03   +2.561645503378652e-03   -3.416569233763234e-03   +2.936079337175975e-03   +6.495409808984691e-03   -2.194259007652785e-03   +3.806781833543966e-03   -8.223623016040648e-04   -3.579489620408710e-03   -3.454453327435316e-03   +1.972475451708341e-03   -3.743668969878489e-03   +1.872845939737775e-03   +9.630950498734076e-03   +2.322574832846760e-03; +5.795241836679140e-03   +7.580425547595021e-04   +6.723723706314980e-03   +8.784672111598491e-03   +5.567430059191865e-03   -9.708005207040317e-04   -3.508811798909586e-03   -6.143076057278163e-04   -3.525232694133225e-03   -2.914160436887272e-03   -2.227965047410573e-03   -1.835393668564852e-03   +1.724034609174828e-04   -9.346971911938465e-04   +7.113318011801997e-03   +1.915595471370851e-03; -1.114941607285488e-03   +3.992782879751057e-03   -3.868671222591828e-03   -1.471702593609247e-04   +1.838005655707105e-03   +6.704242670309309e-03   +8.799752246802035e-03   -2.408532826317151e-03   +1.458779549983704e-03   +4.259297920066097e-03   +2.993832201046736e-03   -5.045751629959161e-03   +3.588495452205326e-03   -1.011248547617517e-03   +5.616808839790830e-03   +4.383053983217102e-03; -8.390376676581618e-05   +1.822582795825217e-03   +3.993834193512711e-03   +4.447726173289472e-03   -9.281787262251892e-04   +3.330199104577891e-03   +9.265404455958233e-03   +3.642009533629140e-03   -2.656378876861942e-03   -8.563490364953116e-04   -7.051531979832440e-03   +8.277130297188609e-03   +4.005083774100684e-04   -1.056650833644775e-03   +7.651925598568251e-03   +4.251372513919551e-04; +3.196441829175836e-03   +1.135882198080525e-02   -4.513799535197294e-04   -6.812140040884361e-04   +1.410272493525404e-02   -8.370959833122254e-04   +2.597249502843164e-03   +5.996148830138225e-03   -5.582748154190008e-03   -4.836546789694066e-03   +7.682085696253063e-03   +5.275063817081337e-03   +8.909109946053744e-03   -4.889143663043142e-03   +3.282223558234297e-03   +2.674882757786220e-03; +1.266460484101990e-03   +4.461416330061809e-03   -2.109344648099800e-03   -1.208262392304403e-03   -1.203477271031358e-03   -3.256038644080479e-03   +7.749087514604725e-03   +5.205008803460106e-03   +7.236363760960551e-05   +2.692586723452673e-03   -8.989421051592804e-04   -3.562917599860830e-03   -3.755818370935087e-03   +1.095515583979967e-03   -1.854327497978425e-03   -6.401832977778888e-04; -5.639901036113761e-03   +1.856986639682836e-03   -1.886247424370847e-03   -3.744353122432237e-04   -3.856901063250071e-03   -4.802423581860442e-03   +3.477131157753114e-03   +7.872572628630840e-03   +3.761435440547111e-03   +1.523853331654834e-03   -8.383204257923745e-04   +1.207049529415051e-03   +2.868674281992635e-03   +8.703318483972307e-04   +2.824230424612251e-03   +4.185771532338400e-03];
L2I_L2E_iAMPA_netcon = [+3.513609575959791e-03   +1.181129118418139e-02   +2.652658612238196e-03   +8.812039395624891e-03   +1.378886407061611e-03   +3.335780444432537e-03   +1.939089281538479e-03   +3.906300772357317e-03; -4.865083418230940e-05   +1.775103880905274e-03   +5.498710433847500e-03   +6.064784167932247e-03   +2.631022313525800e-03   +7.428216587122448e-05   +2.962505248977140e-03   +5.543041475344654e-03; +4.441148401242679e-03   +4.402133546800497e-03   +6.501252475054344e-03   -4.572963945860658e-03   +1.841601210523664e-03   +7.849324509045306e-04   +9.830908712788566e-04   -1.465661987353089e-03; +1.326850589017726e-03   +4.695652616070137e-03   +9.160772498706308e-03   -2.538647152497278e-03   +6.878406001649209e-03   +3.303495834481835e-03   +3.010520107148368e-03   +1.489307861970304e-02; +5.251478466755898e-03   +2.438055228016337e-03   +3.037948573944210e-03   -6.540185334231873e-04   +2.812163256076934e-03   +6.750045127787383e-03   +2.676981148534588e-03   +3.517343044062362e-03; +3.066415234814512e-03   +2.820608177052325e-03   +4.830706534394183e-03   +1.657503171249302e-03   +6.971155482008015e-03   +4.536659899753930e-03   -1.293465469774237e-03   +9.653262680562515e-03; +2.112592900663372e-03   +5.451087758475650e-03   -3.416929177648337e-03   -9.081219321288932e-04   -1.641787136138384e-03   +8.355729519043870e-03   -4.721396719868678e-03   +5.641945060103312e-03; +3.674353224446966e-03   -1.223439724941557e-03   -2.279945074991443e-03   -5.524400988252472e-03   +4.450859663518596e-03   +5.870662153951984e-03   +3.927470081479982e-03   -2.965273570803568e-03];
L2E_L2I_iGABA_netcon = [+6.134800609819413e-03   -2.110564712285616e-03   +3.133405630601637e-03   +3.330418286119058e-03   +8.847890596041436e-03   +6.215255682357296e-03   +2.320900939745556e-03   +5.107904019937325e-03; -8.030479117827343e-03   +5.787154508414430e-03   +7.220951284956132e-03   -8.846077587321981e-04   +6.871939589350852e-03   +7.143718191275327e-03   +7.921226911325130e-03   -1.724427337612364e-03; +7.655187365225316e-03   -3.056819744057711e-03   -2.655107723850238e-03   +1.536388137860547e-03   +4.416423363794632e-03   -2.388976036009703e-03   +2.315536679055562e-04   +5.051872403338700e-03; +5.593451155068077e-03   -3.201432436359769e-03   +1.665169478285771e-03   +5.283028275605216e-03   +2.344711636368017e-03   +2.185448920049868e-03   -6.297938379947009e-04   +9.283073558101272e-04; +1.218131526233858e-03   +2.462757761576995e-03   +3.869133886303188e-03   +8.454658204096594e-03   +5.794408687275781e-03   -3.459815720619264e-03   +4.959155764209969e-03   +2.118097532435993e-03; +5.541261897782694e-03   -6.051473822232476e-03   +6.744196423237379e-04   +3.416340531976078e-03   +4.344903335993313e-03   -1.594357098966442e-03   +6.735164273863723e-03   +1.917356312753253e-03; +6.576163494789404e-03   +3.660261114517395e-03   -3.269439261820702e-03   -2.498793518977352e-03   -2.678417392153642e-04   +2.187059170983826e-03   -3.464101670450833e-03   +1.519867194337567e-03; +3.517142448260865e-03   +5.283211308694061e-03   +5.108181195237241e-03   -6.635709967689557e-03   +5.391471769514662e-03   +3.250542840071613e-03   +3.944807593339894e-03   +1.231180578372842e-03];
L3E_L2E_iAMPA_netcon = [-5.446120501446366e-04   +1.074914679630856e-02   -1.956517591400220e-03   -3.754511811593450e-03   -3.463537095464752e-03   +3.730398112933062e-03   +2.049134767188678e-03   +5.228639555255181e-03   -3.887767395555094e-03   +1.084665662835961e-03   +2.060582514204112e-03   +1.537243610350323e-03; +5.051299244474990e-03   +9.016957995088105e-03   +6.858076411932515e-03   +1.144095205889704e-03   -2.482189412996337e-03   +2.369657067461407e-03   +2.181653109434714e-03   +6.116538204078059e-03   +6.206221543902346e-03   -2.079697850403993e-03   +3.918801872836584e-03   +3.042215624873040e-03; -1.715690598593485e-03   +1.740042512293667e-03   -3.763767271888412e-03   +1.016654485665908e-03   -4.251192462140736e-03   +1.919456480848210e-03   +8.064998762970089e-04   +7.944203822639259e-03   +5.628648435692836e-03   -1.726885664825014e-05   +4.109800047081060e-03   +3.277860362440784e-03; +1.628604607566860e-04   +4.118142041455055e-03   +3.942140635103708e-03   +8.871775374929038e-03   -1.766477400533678e-03   -1.905264186191834e-03   +6.951102820505201e-03   +3.781695691107972e-03   +6.710390439509793e-03   +6.652412555371372e-03   +6.885547919604938e-03   -4.276534402250336e-05; +3.486394204710788e-03   +2.694979701204709e-04   -2.334028697191358e-03   +1.141514767294017e-02   -2.942852666598573e-03   +3.328753097702986e-03   +3.914111196866139e-03   -2.234499468531504e-03   -2.027776088701534e-04   +1.356777069821235e-02   +5.518829400858242e-03   +5.829420362126992e-03; +4.274105289195546e-03   -8.954148763615439e-05   -4.852044221412864e-03   -1.307063076554120e-04   +2.971146839427107e-04   +7.225169004488404e-03   +7.483458377524576e-03   +9.842438951333916e-03   -5.101862330916546e-05   -2.299075868771066e-03   +6.997882462216593e-03   +1.465117579833216e-03; +9.990109337983819e-03   -1.702031424169201e-04   +3.459947833421588e-03   +4.874912583239435e-04   -6.441785253601511e-04   +6.839181950284642e-03   -2.070584128011385e-03   +9.834379038190505e-03   -2.281229971297399e-03   -1.902176723870947e-03   +4.853676561926141e-03   +1.344125505319359e-03; -2.304667447886060e-03   -5.728107976567644e-04   +6.344414385798955e-03   +1.393529309388142e-03   +8.281540546092200e-03   -8.261793914952558e-03   -4.770626219067237e-03   -1.371838080059080e-03   -2.522996673661342e-03   +6.302733716882014e-03   +5.624644693263577e-03   +3.166741951258827e-03];
L3I_L2I_iGABA_netcon = [+2.940582230821721e-03   +7.869383852495453e-03   +1.182809688042043e-03   +4.643314474565799e-03   +8.003408350601281e-03   -4.192980318364905e-03   +9.584866898462174e-04   -3.128901955825978e-03   +1.115462517876562e-03   +5.332915082335820e-03   -5.039848456452811e-03   +4.325988224931160e-03; +1.955670179467945e-03   +1.219774546059870e-03   +2.750256520672221e-03   +1.234913860559317e-03   +7.525787712557049e-03   -6.578518088537857e-04   +5.312013511221358e-03   -5.803907753528444e-03   +6.300163139747294e-03   +9.182877454130302e-05   +1.036171537692931e-03   +3.061554638345010e-05; +1.523353485517846e-03   +1.376947166268565e-03   +1.289094400750603e-03   -2.644361846699788e-04   +6.765953156865776e-04   +1.073086333455294e-04   -6.414118954488793e-04   -8.971778110356088e-04   +4.663366022039187e-03   -5.828634457363433e-05   -3.465168802068465e-03   +4.502559379947824e-03; +6.895108795137374e-03   +5.995697838799136e-03   -3.490843819740075e-04   -3.155518728184007e-04   +7.970474891919942e-04   +7.597130022092723e-03   -6.014267253999152e-04   +7.216633063944228e-05   +6.818221682331197e-03   -3.993279074979717e-03   +3.255504324867178e-03   +5.637930463208538e-03; +1.380823038876871e-03   -3.892643543776335e-04   +1.752302434104161e-04   +2.485688286567767e-03   -6.156747321769502e-03   +7.932922292459484e-03   -8.778765126468907e-05   +3.671257229796818e-03   +5.562353251283183e-03   +7.521040567853200e-03   -6.805712647040050e-03   -1.203486863806038e-03; -4.922774166886253e-03   -2.104943677840597e-03   +3.133324033989551e-03   +1.779808001810275e-03   +1.456438888941246e-03   -7.718907600093981e-04   +1.790760937189615e-03   +3.088497087721779e-03   +3.600685686165683e-03   +5.825798480433676e-03   -4.649887255414055e-04   +2.291404307721766e-03; +5.184993086997714e-03   +1.179000508124197e-03   +4.199524257536131e-03   +3.875499176719891e-03   +5.588313631870746e-04   +3.762563450727285e-03   +2.587454134155406e-03   +4.708683163389695e-03   -4.259888163084454e-03   +9.165932100334388e-03   +1.620447802333061e-03   -2.610164592578477e-03; -1.659544941850341e-03   -4.896469780994587e-03   +2.192984746327801e-03   +3.556563076685536e-04   +7.203719064871265e-03   +5.828921286107659e-04   -5.390477697301260e-03   -1.161689245786488e-03   +7.148326209646539e-03   +1.212338944632047e-03   -2.375557952559294e-03   +5.174188530395298e-04];
L2E_L3E_iAMPA_netcon = [+1.390992653507104e-03   +3.036194980647238e-03   +6.130911234234213e-05   +7.998603150695983e-03   -1.295692907075661e-03   +1.594615316164867e-03   +1.823273594429114e-03   +7.155516494370096e-03; -6.194058240939905e-05   +3.158017498915028e-03   +6.995529766240925e-03   +1.006442975019971e-02   +2.535100292575820e-03   +6.194795717852355e-04   +1.893533388067226e-03   -3.842021268242752e-04; +1.608075457678276e-03   +5.143737243907304e-03   +3.756400447774445e-03   -2.416596487910981e-04   -1.098393052888674e-03   +8.787100063766751e-03   +1.905457931457758e-03   +6.311462064428154e-03; +6.011555999378619e-03   -2.773239274360914e-03   +3.490462445231137e-03   +2.690390385048705e-03   +2.612716166665906e-03   +3.855288314412485e-03   -6.151815743646021e-03   +4.333310371048885e-03; +1.938155351323579e-03   -4.400230629576905e-03   +7.085706720328141e-04   +3.325849365036730e-03   +5.960295991973140e-03   +1.977975227587799e-03   +7.167154481226998e-03   +1.563941433247257e-03; +5.101110977775903e-03   +4.389498634148373e-03   +2.973396435336109e-03   -2.832154827273202e-04   +5.223263428839076e-03   +9.167404024860909e-03   -2.038857745562042e-03   +4.111247098533921e-03; +6.629832773133295e-03   -8.292554901821016e-04   +2.289434770641558e-03   -4.712785367859882e-03   +1.245590075638782e-03   +1.797164499733055e-03   -8.398659458671764e-04   +3.938037686961153e-03; +1.084463796469622e-02   -4.791041727526558e-03   -1.992541726894281e-04   +2.756548843204772e-03   +4.712953870395158e-03   +2.166902207549291e-03   +1.220541018723048e-03   +7.179890775139251e-03; -1.801486555211657e-03   +3.836019099270400e-03   +1.947408351770673e-03   +7.687985308665931e-03   +5.719798878641406e-03   -3.975189203534960e-03   +9.682110494413352e-04   -4.082964278590602e-03; +8.027435954680762e-04   +5.047044784471421e-04   +3.508720682336752e-03   +2.525052492148155e-03   +4.788879615911468e-03   +2.913967410357098e-03   +3.457878116797141e-03   +3.726682744107495e-03; +1.446577550386086e-03   +2.974119617837826e-03   +4.199366651081511e-03   +6.987276828604258e-04   +1.303130260764025e-02   +1.113108220706564e-03   +1.280340219688956e-03   -2.204705206792690e-03; +7.287071057879752e-03   -2.007596435387600e-03   -6.387511986087554e-04   +5.305706840884375e-03   +6.314809016428873e-03   +1.369059558532463e-03   +3.229869774693894e-03   +6.960791057695136e-03];
L2I_L3I_iGABA_netcon = [+7.068930435860142e-03   +3.750518685541691e-04   +3.492661845433603e-03   +6.632766888038216e-03   +9.434189801396858e-03   +2.688639088880688e-03   +2.456280445270913e-03   +3.062720696899063e-03; +2.912224154284352e-03   -1.270268129954057e-04   +1.471896725170530e-03   -3.409415192756150e-03   +1.611050538769117e-03   +3.919758565972720e-03   -3.366249631849153e-03   +1.920149263930879e-03; +3.467350180275225e-03   -6.210599227801990e-04   +1.365246320184303e-03   -1.998593090973477e-03   +3.652202539013213e-03   +9.302139754112648e-03   +8.656449990630486e-03   +3.792309925709191e-03; -3.368882102293449e-03   +7.189998896450083e-03   -3.022889909803098e-03   +5.870120867087466e-03   -4.894184410332942e-03   +3.984833557485661e-04   +4.710707555719223e-03   +2.508454278691691e-03; -2.712448014660243e-03   -5.479755293648847e-03   -4.459446325893382e-03   -4.993901134593754e-04   +8.861430305917210e-03   +4.978653697211686e-03   +6.281765859440730e-03   +5.706195321401750e-03; -2.262195763611003e-03   -1.578607881688696e-03   +5.056996458808975e-03   +4.811316093921656e-05   -2.278022511050103e-03   -3.541276197437669e-03   +3.597355387652209e-03   +1.038136411895478e-02; -1.228537219458075e-03   -5.662734589155876e-04   +4.241564219509442e-03   +3.733703180940953e-03   +2.057485658398197e-03   -3.716050625968557e-03   -8.739793945222574e-04   +1.038695229767653e-03; +1.560374233946010e-03   -3.561842806584746e-04   +1.011386398283922e-02   -4.147303385062761e-03   +3.388807182862994e-03   +1.226214342128101e-02   +6.744020467105150e-03   -8.146478688010809e-04; +3.783029128539664e-03   +1.628143599250924e-03   +4.780437935104750e-03   +5.740360197070372e-04   +9.219890822357245e-04   -2.875051336817343e-03   +3.031170477893260e-03   +7.419351986269989e-03; +8.415096625346941e-03   +1.766512894603092e-03   +3.881550471749530e-03   +1.500087831255565e-03   +5.128511456410914e-03   -3.155823493252149e-04   +4.276175908969582e-03   +1.141181597404562e-03; -2.134418959988477e-03   +3.809269249825021e-03   +3.652813932816266e-03   +1.367127992871586e-03   -4.651431165643535e-05   +9.039349256383677e-03   +4.565182735071694e-03   +2.861937247609908e-03; +7.672549305467635e-04   -5.869596250766195e-03   +1.872970711610355e-03   +6.910728826450465e-03   -1.035601662735206e-03   +1.375545514062197e-03   +4.634189694110480e-03   +7.006079025788636e-03];
L3I_L3E_iAMPA_netcon = [+1.699781544145810e-03   +3.031238474615313e-05   -1.337137356428779e-03   +2.882927795252307e-03   +1.087038893185350e-02   +2.478046638577962e-03   +4.223201004419696e-03   -2.035563363016278e-03   +4.109732556208975e-03   +4.753946601126814e-03   -2.069515651183842e-03   +1.355308224159871e-03; -4.083088325276753e-04   +1.615519909378103e-04   +4.200452167489933e-03   +2.078788049125460e-03   +4.020486665121390e-03   -1.356068410030631e-04   +1.796486419013649e-03   -7.513247511965791e-04   +6.381575350763123e-04   +3.469837281813591e-03   +6.353087090364643e-04   +6.557130928076528e-03; -2.448128702519427e-03   +2.628387534182496e-03   +4.234723070203713e-03   +3.101532468424765e-03   +2.450049909780270e-03   +4.413814400836510e-03   +1.215535988392675e-03   +7.937555395215842e-03   -3.670257715522469e-03   +6.273807641083437e-03   -2.610381771815714e-03   +6.578037483825609e-03; +5.303493888755366e-03   +4.386860915550915e-03   +6.222569522994107e-03   +5.634971520967995e-03   +8.885481990526942e-03   +2.592517164174355e-03   +2.810399082789869e-03   +3.083239683708159e-05   -1.208653032804449e-03   +7.637760124253819e-03   +1.380091594769124e-03   +9.570397462999680e-03; -2.956822051916475e-03   +1.938365607118089e-03   +1.617740463072741e-03   +2.436649783768226e-03   +1.038054988564424e-03   +3.322612098936913e-03   +1.724743579255067e-03   -2.818723441753732e-03   +7.099944971559420e-03   -2.054646143643124e-03   +1.954439320324777e-03   +3.497092254493852e-03; +1.842102006389834e-03   +9.125992891802883e-03   +2.254731862886449e-03   +5.980321007241518e-03   +1.332028293098093e-03   +6.243540233548455e-04   +8.163847112880462e-03   -2.493298572050294e-03   -1.456240461737527e-03   +3.179614588304341e-03   -1.534188982538370e-04   -3.402664255417288e-03; -1.686936442044693e-03   -3.552042669852737e-03   -2.009879484297737e-03   +1.526918224305968e-03   +9.009316888584471e-03   +1.543045492314322e-03   +2.009974071404719e-04   +7.775407704738838e-03   +4.878996188853332e-03   +9.157559897474379e-03   +5.347008919594262e-03   +6.850675745649830e-03; +6.209779911945780e-03   -5.293756079408477e-04   +7.153182231228884e-03   +4.450681905485012e-04   +3.120925953387107e-03   +3.503137619992821e-03   +7.092824188976147e-03   -2.141012425566195e-04   +4.927098880979358e-03   +2.900464602895076e-03   +8.414767814879336e-03   -1.352339914226812e-03; -1.509290114299895e-03   -3.134425223204587e-03   -4.737981151180660e-04   +4.875208079623194e-04   +4.098014669964181e-04   +4.630421353589494e-03   -1.128578990436634e-04   +5.447031041929781e-03   +1.051005062747233e-02   +9.769518354205775e-04   +7.077273586422226e-03   -5.441980830220450e-03; -5.345145703971905e-05   +5.237007363507174e-03   +6.550125774671648e-03   +5.529508399290130e-04   +2.640112067638874e-03   -5.955458534997373e-04   +5.166921117461190e-04   +5.777161886520605e-03   +5.703335659946455e-03   +3.292268073471327e-03   -1.762882483852383e-03   -2.604212597121707e-03; +1.105771522349534e-03   -2.043648937212669e-03   +7.539533742607532e-03   +4.529466563776081e-03   -5.089367363601157e-03   +1.476051785844397e-03   +2.055441313754324e-03   -2.390336878405628e-05   -1.547334412589046e-04   +2.333039607382186e-03   +3.954771670119313e-03   -1.041246700809954e-03; -4.259064793285369e-03   -9.669485538915225e-04   -4.241812717333428e-03   +3.534435850497154e-03   +8.298760203998126e-03   -2.379667625553532e-04   +7.462488861693635e-03   -8.827918448141913e-03   -1.497634424408793e-04   -2.849728198713444e-03   +3.411491475743001e-03   +3.185212986592406e-03];
L3E_L3I_iGABA_netcon = [+1.260999655443435e-03   +3.355916662704328e-03   -1.105178301874268e-03   +7.952743243465956e-03   -3.469518423078670e-03   +9.103923066379820e-03   +3.510912023001613e-03   +5.965733834875998e-03   +1.463994212149716e-03   -1.012861271939648e-03   +1.629166760812734e-03   -3.115817560189526e-03; +1.122341263166276e-03   +1.043393654053376e-03   +1.092281605231469e-03   -2.699748637702766e-03   +2.784693351030706e-03   +3.250945610775899e-03   +3.339159868682221e-04   +3.274593513837628e-04   +7.010152148399935e-03   +1.060742306092723e-02   +4.360759755187318e-03   +3.056433577055241e-03; +2.490927992516271e-03   +2.878252483058141e-03   +3.154317014151484e-03   +4.568743851395311e-03   +2.271906464143012e-03   +4.040052032684871e-03   +6.211143227785178e-03   +1.062954613100200e-03   +5.008987326784602e-03   +5.661638539706754e-04   -6.066965668437871e-04   -5.812139324742940e-03; -2.584673702424530e-03   +4.014550313214601e-03   +2.238900625990041e-04   +1.088531086418332e-02   +6.829381377733436e-04   -5.393460566550071e-04   +6.047548525903820e-03   +3.429695693316953e-04   +2.077394580740044e-03   +3.147798898088528e-03   -5.003957505387964e-03   +4.722655521919507e-03; +4.894859597504584e-05   +1.802268125563583e-03   +3.947663857496311e-03   +2.146494988212854e-03   +5.980107315110428e-03   +5.406302462715435e-03   +2.259265887742896e-03   +5.260439313810839e-03   +4.294317365966038e-03   -8.856095591821911e-04   +3.068566697139275e-03   +3.980803323923608e-03; +5.292920345002347e-03   +1.028474371154350e-03   +8.017354465810421e-03   -3.412974337312891e-03   +8.507066869732336e-04   +8.607674465346354e-03   +5.090960790799232e-03   -1.514996586665190e-03   +3.198397828337366e-03   +2.222690249842615e-03   +4.592551835434352e-03   -4.053830716236087e-03; +3.218200318392100e-03   +6.313639817179702e-04   +7.838949419746552e-04   +1.549384385406547e-03   +2.960460131607140e-03   +5.725345337254394e-03   +1.144193776896020e-03   +3.890173637003122e-04   -3.763725417836704e-03   -3.478194484551054e-03   +1.558738342733638e-03   +4.374515030407186e-03; -2.145301810334891e-03   -1.073636722845883e-03   +2.587395717555836e-03   +7.881495094966006e-03   -7.752063384664008e-05   +4.822591060333651e-04   +7.012342659256146e-03   +5.731777177517407e-03   +7.374077717627982e-03   +7.824317013173305e-03   -3.647618833944121e-03   +5.435838359444552e-03; +1.623359801676827e-03   +1.925260501107585e-03   +5.197774769161249e-03   +3.314293014552824e-04   +3.203039972940536e-03   +6.817414471135342e-03   -3.538439026270783e-03   +7.890372785982211e-03   +1.369579814333294e-03   +3.599198228839308e-03   +6.263171428141131e-04   +4.910118116320398e-03; +2.494768480182747e-03   -4.870043204087519e-03   +6.812844751776655e-04   -4.478333910386664e-03   -2.678061396530366e-03   +7.381685555316621e-03   +1.909537195467318e-03   +4.917251334566152e-03   +7.997987069239397e-03   +1.317997714384900e-03   +6.651061077136132e-03   -3.197281664032447e-03; +2.468478806338684e-03   +2.708799779003921e-04   +3.275936740472529e-03   -2.742550193152532e-03   +6.451652829259085e-03   -1.473700894828054e-03   +9.477708801893095e-03   +1.067104615656576e-03   +1.273798904613707e-02   +7.341739701732677e-03   +5.620271717279126e-03   +5.660976546755415e-03; +7.199255719969538e-03   +7.429104497539678e-03   +4.071276998048145e-03   +5.017256777159747e-03   -5.053129482526892e-03   -9.540686825601132e-04   +3.503911919750469e-03   -7.977371136061860e-03   +1.030846828092905e-02   +6.534694211069170e-03   -3.538107475824526e-03   +4.518590184136513e-03];
L2E_Input1_iAMPA_netcon = [-1.374671965399421e-03   +1.183533371482247e-02   +4.260802186292323e-03   +2.642244324789572e-03   +8.149737593617637e-03   +2.610276194696710e-03   +2.085717287503488e-03   -1.474089526458025e-03];
L2I_Input2_iAMPA_netcon = [+7.472077737647723e-03   +8.583535828306071e-03   +5.109747985329555e-03   +3.335739735733614e-03   +5.832068786741665e-03   +3.581773351451435e-03   +3.015009754972034e-03   +8.273843575424619e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
