function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.606863408814700e-01   -4.463987808014631e-01   +3.123819098132852e-01   -4.674067762574757e-01   +1.000000000000000e+00   +3.503343798643059e-02   -5.040237873842383e-01   -2.482395823401340e-01   +2.460479043603244e-01   +2.541466069108476e-01   -5.455130764111675e-02   -7.349872224447015e-01   -4.856969101872446e-01   -5.653586109518068e-01   -5.646207102318567e-01   -3.222523891932431e-01; +2.222812720927619e-01   +6.946487161408170e-01   +3.108949704292189e-02   -2.802615105246212e-01   -4.173729414932896e-01   -3.202278098516360e-01   -8.914525917132958e-02   +1.872084084465949e-01   +8.034208527976882e-01   -1.568715961937970e-01   +5.135621496748748e-01   -8.510280143732891e-02   -2.807317256411577e-01   +7.393646200756833e-01   +4.770132463320547e-01   +2.818370230649328e-01; +5.419012392352495e-01   +5.705546307619901e-01   -2.302746155761212e-01   -4.576911981596512e-01   -9.551462109283178e-03   +4.284740398036974e-01   -1.252975495456386e-01   +8.210125540375942e-03   +2.700825841827683e-01   +9.114552262890475e-01   +4.070452091064917e-01   -8.723676645500247e-01   -1.968896635593263e-01   -5.204341366098344e-01   +2.456607142850812e-01   -7.972587287640229e-02; -2.302002056726380e-01   +1.815775850557260e-02   -2.457955722667685e-01   +2.859309374795170e-01   -4.174659664523269e-01   -4.144418333883582e-01   -6.975002296783815e-01   +3.209329575166821e-01   +4.831376416906449e-01   -2.068009120823759e-01   -2.213215380352350e-01   +6.129284059850723e-01   +6.387227560636789e-01   +4.337274018493312e-01   -2.334730237538920e-01   +9.192947976233715e-01; +8.580552731935606e-01   +1.074410437608827e-01   +4.477084335141184e-01   +4.220897331259685e-02   +5.389739214031559e-01   +1.595741049535354e-01   +2.420456636836590e-02   +6.246288599644407e-01   +5.887755662943137e-01   -2.079464803313801e-02   +1.639324214431018e-01   +1.204668918198912e-01   -2.492614880824552e-01   +5.077797425785593e-01   +7.058902524289782e-01   +1.984497410212768e-01; -3.905479957847426e-01   +5.009715160434431e-01   -1.947780037378104e-01   +1.184358375212122e-01   +7.559361929805150e-01   -5.042634270653741e-01   -1.141355999893667e-01   +8.950500867447478e-02   -7.812938047729114e-01   -7.227962828298121e-02   -6.704338377009196e-01   -7.205897028078516e-02   +4.588305562296291e-01   +1.254774580907728e-01   +1.572170789945390e-01   -3.760661583831046e-02; -5.489940110070407e-01   +4.651776274127002e-01   -9.857044862333644e-02   +5.971924598504945e-02   -3.746278850510860e-01   +3.195834275866700e-01   +5.092162392107445e-01   +6.165860036583795e-01   +4.725608050545922e-01   -1.355468253999950e-01   +2.476405275484709e-01   +4.004883631810271e-01   -5.336017549975921e-01   -5.797968586633275e-01   -5.873356527618455e-01   +3.180071076726613e-01; +1.864291929627139e-01   -3.858327300427594e-01   +2.928280978229478e-01   +5.429365088570777e-01   -2.056399954683640e-01   -1.091881751158997e-01   +2.459775343638486e-01   -5.958493285335719e-01   -6.041310831384751e-02   -1.823876483960833e-01   -5.078322552246202e-01   -4.911884870440735e-01   +2.515118073748577e-01   -2.403230142175714e-01   -1.957750273648012e-01   +3.174092248613039e-02; +1.505763062548700e-01   -2.645078758566099e-01   +6.147666717378545e-01   -8.473392098243575e-02   +1.962631434416587e-01   +5.989575710618048e-02   -3.734237072490457e-02   +1.951467406224976e-01   +5.068205703735628e-01   +2.979136327705827e-01   -1.888202763439037e-01   +3.489061415967831e-01   +6.337997697929212e-02   -5.772903110638009e-01   +3.881860919841347e-01   -4.057403405557413e-01; -4.709400644009651e-02   +4.862567956920940e-01   +1.962610268031365e-01   -4.961864926013876e-02   +6.728763703910210e-01   +3.511321629328638e-01   -4.059570102872818e-01   -1.412079827123658e-01   +3.727170092869553e-01   -6.514578535432176e-01   +2.453078674610251e-01   -4.095547678663743e-01   +3.757116818326023e-02   -2.709806619124267e-01   -2.782757348879483e-01   -2.355049407860831e-01; +1.667836048655134e-02   -4.892391693354919e-01   +1.847605332318154e-01   +3.540073661370298e-01   +5.605811391103379e-01   +7.591821480996500e-01   -2.447463613693525e-01   -7.811666479753877e-02   +2.841017146064941e-01   +8.174891486020889e-01   +1.067180771635670e-01   +3.812653721277640e-01   +2.014501911058570e-01   -2.523275322974212e-01   -7.518316649880588e-01   +4.311796871524182e-01; -7.127659974224532e-02   -1.296069946759193e-01   -7.615570005660555e-03   -5.841978422610291e-01   +1.884068572057536e-01   +2.810654490199044e-01   +8.174304356099113e-02   -5.715877128190870e-01   +2.741331689117942e-01   -2.854567793602839e-01   +3.900059005757448e-01   -2.751789269479201e-01   -6.132944035795209e-01   +4.805387753578100e-01   -3.504460408418337e-01   -2.507467179387768e-01; +6.876192258732320e-01   -1.435216861509639e-01   -3.326794582697137e-01   -9.966255571553015e-02   +2.352076127685652e-02   +7.301387028270846e-01   -5.084442450089711e-01   +4.548962585114676e-01   +5.513944840015469e-01   -6.939467597970421e-01   -7.662436285396775e-01   -2.200247195448497e-01   +8.315219067674343e-01   -1.943063321884675e-01   +2.986288421723676e-02   +5.082475656172911e-03; -5.450145024329426e-01   -3.614272079086672e-01   +2.889711096790846e-01   -4.876862489142094e-02   -1.588558028156170e-01   +6.369212677429202e-01   +4.258122833561326e-01   +6.192383024963205e-01   -4.605606947647736e-01   +6.387966357509145e-02   -2.163495539636393e-01   +5.915748148745147e-01   +3.791260340766379e-01   +9.010674979272226e-02   -6.637692988096826e-01   +5.294415483043122e-01; +1.567412769926838e-02   -3.607782481840077e-01   +4.823630743211358e-01   +1.815665751427062e-01   -7.391384655692453e-02   +9.471260807533415e-02   +7.428501354822109e-01   -2.047625877356167e-01   -5.887039903405531e-01   -4.962601141597255e-01   +5.894664907885633e-01   -5.724333084125156e-01   +6.386460393210684e-01   +3.450454386374016e-01   +4.026567498536939e-01   +9.269665638170835e-01; -2.882651264651278e-01   -2.745350389772397e-01   +4.377706651815267e-01   -4.067918842485212e-01   +5.234609825180028e-02   +2.164568528012073e-03   +5.507317348361943e-01   -9.744469608454220e-02   -3.500095245198268e-01   +4.250952147943661e-01   -5.406652707323334e-03   +1.433004286672343e-01   -1.990196371870348e-01   +3.781655261938396e-01   +2.780412132050193e-01   -2.433488420096402e-01];
L1E_L1I_iGABA_netcon = [+9.189371884357951e-02   -2.198352899719541e-01   -6.931614023040835e-01   +8.355016387944300e-02   +2.448691664009021e-02   +5.559467481614701e-01   -2.927022997366151e-01   -2.406687214157567e-01   +6.256183714966109e-01   +6.398896636964041e-01   +5.069869423329247e-01   +2.241558701681726e-01   +4.935813058205682e-01   -4.284881184351826e-01   -6.421796872900401e-02   -2.774331225958709e-01; -8.862194303752781e-02   -3.706262169614337e-01   +4.435743519764399e-01   +5.546651780644296e-01   -8.131461132185738e-03   +5.101127770046684e-02   -3.649990716081518e-01   +2.952745950025631e-01   -6.751134894163503e-01   +4.982656766519689e-01   +7.009398465739555e-02   -1.575451581706543e-01   +6.588174360399937e-01   +1.314511844131809e-01   -3.374415517998686e-01   -5.764192429283341e-01; -2.531325275277750e-01   +2.962053432157449e-01   +3.762089739467019e-01   -1.342968427881911e-02   +6.432874953987672e-01   -7.262435024298305e-01   +3.934489677977018e-02   +4.306235676043655e-01   -3.802346347650288e-01   +5.789226323764340e-01   +5.877100419664303e-01   -6.969923480453504e-01   +3.247927121971407e-01   +7.558125138127418e-01   -1.261758439981051e-01   +3.521094230890309e-01; +7.779270886610224e-01   -9.163076679119925e-01   +1.060913473748280e-01   +2.764739226540924e-01   +3.504107058686018e-01   +2.411853590173147e-01   -1.061316124097050e-03   +1.976325735249790e-01   -4.680033459297500e-01   -5.236794993350363e-01   -1.376485076048564e-01   +1.220955076857553e-01   +2.255887214521661e-01   -4.670984368186947e-01   -2.227758279182287e-01   -4.720131101268830e-01; +3.266382791383621e-01   +5.282870912543736e-01   -4.011036228370689e-01   +4.899497842800495e-02   +2.438206410058487e-01   -5.176234022626763e-01   +6.415074489183370e-01   -4.271869487798745e-01   -3.289921963696220e-01   +2.625848030340768e-01   -5.960889860915178e-01   +5.698748757734001e-01   -3.449413427685133e-01   -1.123219483986788e-01   +5.959011899451457e-01   -2.252715284717051e-01; +4.492102221606900e-01   +1.287398485836975e-01   +3.133212135834785e-01   -5.780146316544837e-01   +1.767785440974448e-01   +5.399625921514278e-01   +3.469379827447048e-02   +2.337168976444426e-01   +3.934577680907977e-01   +4.541631863436270e-01   +6.925809865777696e-01   -5.717857315288461e-02   -1.112863171201879e-02   -4.199056077818754e-01   +6.708848067656678e-01   -2.017940701529923e-01; -3.534732282869227e-01   -5.203837748620758e-01   +5.387584796956864e-01   +3.548298707211214e-01   -1.630485785805823e-02   -7.756785796246828e-01   +9.975453740949437e-02   +7.915988404906422e-01   -6.672140320100046e-01   +5.662395131280836e-01   +9.890063949724766e-02   +1.425452399732972e-03   +6.744868986736130e-01   -6.565720212463158e-01   +2.988865043378588e-01   +1.661741738139959e-01; -2.064945517683677e-01   +1.171264159581704e-02   -1.345217729660441e-01   -2.467642965275113e-01   -6.690289424507189e-01   +4.868567862223811e-01   +2.809454463448447e-01   +2.871781289776389e-01   -4.296095163766618e-01   -5.023500001608563e-01   +7.881135985180920e-01   +6.692707272611773e-01   +6.648263307912384e-01   +3.768097875167674e-01   +3.478530232707100e-01   +3.580253434759601e-01; +5.453496534220872e-01   -5.378765607297080e-01   -5.074355299103701e-01   +1.405634965957731e-01   -1.737751822143670e-01   -1.001207433452324e-01   -4.149193825679711e-01   +5.148547941461290e-01   +9.675031420580918e-02   +4.366590696810852e-01   +1.129057554202974e-01   -7.356570449363360e-01   -1.519562048764912e-01   +3.228216842000257e-02   +3.252006432431012e-01   -4.848891133469152e-01; -6.148454619580517e-01   +2.715490929720078e-01   -1.192869526609246e-01   +2.139931270686321e-01   -1.427540834856204e-01   -3.593492336546204e-01   +6.430533403293929e-01   -6.639168370628614e-01   -3.830821130411898e-01   +4.479689265694102e-01   +1.727392658321446e-01   +4.121744470224155e-02   -8.759524988878015e-02   +3.510516056462009e-01   -4.225485800534778e-01   -4.312348011961427e-01; -1.067846544673950e-02   +4.700687418522188e-01   +6.574502485217669e-02   +4.695583870410411e-01   -5.399153451056975e-01   +3.343067686278859e-01   +1.274587268293401e-01   -8.732383306712715e-01   +3.920890075814304e-01   -1.408848305171305e-02   +3.919942234709264e-01   +1.000000000000000e+00   +1.410671321546045e-01   -1.825214823709976e-01   -5.354017533793745e-01   -5.493831357282689e-01; +6.499625554242934e-02   -2.084837687958536e-01   -3.696315481124035e-01   -2.615356424851337e-01   -1.986243951087629e-02   +1.044089217886272e-01   -3.491109079073985e-01   -3.009991901423589e-01   -3.726605155607026e-01   +1.163096757477796e-01   +2.065562764575152e-01   -4.051392692090042e-01   +6.064532718669778e-01   +6.991310262779743e-01   +2.335314476885107e-01   -4.464258504411575e-01; -4.512550129214352e-02   -3.671137307775860e-02   -2.245977980434902e-01   -1.407249004264265e-01   +1.523373292095974e-01   -1.400480365154961e-01   -4.996857672762982e-01   +5.403686946707242e-02   -5.762503663512905e-01   +2.646361802013559e-01   +2.946599748346136e-01   +3.327447901894952e-01   -1.828251980090674e-01   -5.160178778080946e-01   -4.043418335750311e-01   -6.351258568762594e-02; -4.275673682560049e-02   +3.768028832413700e-01   -4.256892467214270e-02   +2.034058354097406e-01   +4.442419583579059e-02   +1.612596602016214e-01   +3.038418366547014e-01   -9.954961722071744e-02   +8.938657020877117e-02   -1.545215661600305e-01   -3.801960314127378e-01   +4.115768108338772e-01   -2.663823412613064e-01   +2.405475608591103e-01   +1.525697744715727e-01   -3.419749071386358e-01; +4.582385272589145e-01   -3.217661535875604e-01   -2.574587655998209e-01   -6.641997065408188e-01   -7.506801127624109e-02   -2.793488518198643e-01   +4.401967573460813e-01   +2.665907305856289e-01   -2.212038762762828e-01   +5.521589373605126e-01   -1.115559328801014e-02   -4.707325111797303e-01   +6.837151655149046e-02   +1.308277352397683e-01   -1.976955391035770e-01   -4.165687359376301e-01; +3.687894957433372e-02   +2.498514994116476e-01   +1.078985461282512e-01   +7.018103620321580e-01   +4.385181130975798e-01   -4.078093577214312e-01   +6.931173960207468e-02   -8.051428495366401e-01   -3.444795669382618e-01   -2.339809552859294e-01   -6.735034685174539e-01   -3.223068056238431e-01   -2.417214859413772e-01   +3.361672247759940e-01   +5.674513496819512e-02   -4.028033897769547e-01];
L2I_L1I_iGABA_netcon = [-6.159619520761919e-01   +1.905173484970817e-01   -3.881284924930507e-02   -2.223634622645170e-01   +7.041823528395798e-01   -3.782841445791937e-01   -4.308756923809171e-01   -3.228745483855941e-01; +3.530033446817755e-02   -3.171587232942991e-01   +2.525659585405597e-01   -7.233185071818647e-01   -8.710358999954094e-01   +5.457450525956264e-01   +4.855883588015453e-01   +4.237289305808334e-02; +2.509292068950688e-01   +4.412193459717753e-01   +2.630741728494114e-01   +5.693275900944763e-01   +1.875458968633328e-02   +5.730453209143727e-01   +8.020670347900374e-02   +2.321070028570919e-02; +5.157390491455645e-01   -3.370862226909226e-01   +1.688932964587025e-01   -3.983165486044271e-01   +4.042879429842562e-01   -2.104162896295848e-01   +1.273138781147909e-01   -6.936235598267158e-01; -5.201836185667034e-01   -1.266436997247347e-01   +8.366527524664376e-02   +5.882400790194670e-02   -1.089451187894400e-01   -2.477374787663213e-01   +3.235613279293484e-01   +1.547133663166310e-01; +5.991946031571577e-02   -8.150383209184567e-01   -6.073848001684966e-01   -1.001342717867773e-01   -1.747981269133059e-01   -4.926726273815994e-01   -1.590645030913988e-01   -9.812162302811985e-01; -5.792664185275873e-02   -3.356744455354097e-01   -6.611056250335223e-01   -6.346724456904200e-01   -2.097229135310629e-01   -1.453176194274753e-01   +5.017236450034347e-01   -5.909496997466406e-01; -3.310298766441575e-01   +3.142760938547786e-01   +7.919460941224677e-01   -9.133810189385842e-02   +4.646509233933505e-01   -3.045930178947166e-01   -3.447057765635591e-01   +2.950744184879197e-01; -5.176711287695723e-01   +5.057805237941583e-01   -2.223349142148625e-01   +5.561347661569442e-01   -1.120243677391242e-01   +3.189941847019371e-01   -1.123605767269710e-01   +1.324702774724749e-01; +5.746704215005506e-01   -1.048831300340553e-01   +1.044512511792009e-01   +3.718302856843643e-01   -2.311671958733867e-01   +2.754782926292457e-01   -2.502838080087365e-02   +5.617575166984690e-01; -5.998822036861869e-01   -5.486513857629514e-01   +6.177891898013914e-03   -1.318290674128148e-01   -3.505396648467250e-01   +1.111135391206777e-01   -5.919480315076712e-01   +1.663258993903849e-01; +3.920602534669806e-02   -2.061518982633304e-01   +3.869693208264437e-01   -9.361073806331024e-02   -1.996742936108799e-01   -5.110030249705885e-01   +2.232869038136155e-01   -1.838266644931236e-03; +1.795008000908872e-02   +6.017932858153836e-01   -1.000000000000000e+00   -2.376952350652558e-01   -8.332828129980768e-02   -1.650191282570662e-01   -6.735491255002762e-01   -4.362893054742251e-01; -1.323748108291324e-01   +3.492884329383075e-01   -1.315957881050092e-01   +5.757011689134209e-01   +7.163141165723135e-01   -8.356901349014701e-01   +6.083492441353968e-01   +5.158370514546138e-01; +1.929733426901508e-02   +5.032167792838125e-01   -5.527532034497377e-01   +6.548968399124001e-01   -7.835081382878477e-02   +2.351724498196849e-01   +1.741330240327854e-01   -7.064861122589943e-01; -7.957562582769363e-01   -2.838787038283370e-01   -1.711893412589027e-01   +4.413197224137255e-01   -1.587630067058256e-01   +1.293111383597816e-01   -4.436599964741405e-01   +3.054459247542795e-01];
L1I_L2I_iGABA_netcon = [-4.145804590879577e-01   -3.978742528470072e-01   -4.942271204896477e-01   -8.092771692433914e-01   -6.361246471914466e-01   +2.874325759959937e-01   +1.967816240003677e-01   +1.151201937638760e-01   -4.331379377346503e-01   +2.794248538588874e-01   -3.023763188838010e-01   -6.742882389847975e-01   +2.493895719139573e-01   +1.491755981835522e-01   +6.794836588727523e-01   +2.286689973968315e-01; +3.763020444225871e-01   +1.854430335745010e-01   +6.412793702042304e-01   +3.910538209831903e-01   +5.134851927093212e-01   +7.121855224956301e-01   -3.919918345967325e-01   +5.314564664744759e-02   -5.664907813858467e-01   +5.568780994878557e-01   +3.223923958584238e-01   -4.800082876916387e-02   -2.080293280766405e-01   +3.284821502574810e-01   -5.158577074023675e-01   +1.759179069354075e-01; +4.254482751660433e-01   +7.629264108326416e-01   -7.367476133069907e-02   +4.717804689051467e-01   +1.982106029242025e-01   +1.426954495785900e-01   +1.225026323066636e-01   -6.909113383051827e-01   -3.327896730930172e-01   +4.592058435985931e-01   +8.005462571558064e-01   +2.152350399620741e-03   -9.288267775023414e-02   +4.860884260377428e-01   -1.000000000000000e+00   +3.644881347812656e-01; +3.815040457391877e-01   +1.733724228200317e-02   -2.605437933373442e-01   +4.007758500034792e-02   -3.490469816820970e-01   +5.878766286888116e-01   -3.533916247180832e-01   -6.995711616823740e-01   +7.410173953598613e-01   +1.745955494535712e-01   +5.987929192103124e-01   +2.071228180427371e-01   +8.884682005024565e-01   -6.264225170792354e-01   +8.333292726738587e-01   +4.903984807195391e-01; -7.516961322988259e-01   +6.007406495129262e-01   +3.273928074774391e-01   +6.203384303987469e-02   +3.123625119944425e-01   -6.990488285732928e-01   +2.265317557569701e-01   +3.103945045313036e-01   -4.643852929368728e-01   -8.463669430973553e-02   -1.137804232587577e-01   +4.515254837139805e-01   -4.136613036210209e-01   +7.784679953673735e-01   +5.106317372264678e-01   -1.550043803278028e-02; +2.685050456492165e-01   +2.063716264764222e-01   -6.551554398031726e-01   +6.877558826594283e-01   -3.010426051560990e-01   +3.723007504609578e-01   -4.199489555624819e-01   -1.840519787882790e-01   -5.579432941446300e-02   +6.611312117197932e-02   -6.732176537939646e-01   +3.502133549548873e-01   +7.336873708032710e-01   +6.348443841110077e-01   -4.192764890038266e-01   -4.057383272135131e-01; -1.510364896622695e-01   +8.149348945076812e-01   -1.724728013051789e-01   +1.466425017935300e-01   -5.698627898039632e-01   +6.853464653483242e-01   -4.466167400210225e-02   -4.243499114499652e-01   +3.802501716804274e-01   +6.975216669565730e-01   -1.861326243968067e-01   +7.369699984007776e-01   +4.569384786823992e-01   +6.390137560892575e-01   +4.918732350014062e-01   -1.088414757319520e-01; +3.159158557136396e-01   -4.571686079910083e-01   -7.189861681091096e-01   +9.567391458295045e-02   -6.447989957040986e-01   +1.141264937682869e-01   +8.166915582622331e-02   -2.765484723873808e-01   +7.316637769720281e-01   -3.864277887157253e-01   +6.363568016526966e-02   -6.583073961317989e-01   +2.824063614617330e-01   -5.430844481778693e-01   +7.600093100452885e-01   -5.311427652386562e-01];
L2E_L1E_iAMPA_netcon = [+5.137775430663437e-02   +3.383113530294492e-01   +2.980797216477419e-01   -4.952804474585962e-01   -2.766479907025352e-01   -5.729378533497171e-01   +3.114037305715897e-01   +7.562171250623148e-01; -5.380387424504726e-01   -4.139027365126448e-01   -9.646696323756544e-02   +3.008405757001136e-01   +2.167500871928491e-01   +4.688653964138853e-01   -2.943299147780478e-01   +4.898557985840210e-01; -1.408316312301608e-01   +4.243843542993619e-01   -2.788596742374835e-01   +6.932482315525720e-01   -5.992499556240204e-01   -5.317117448051045e-01   -4.156518494916023e-01   -1.120614316595294e-01; +8.758566510384808e-01   -2.046424726591467e-01   -1.628200668550610e-01   +9.956910806646692e-01   +2.816222844136790e-01   +5.060063276149700e-01   +3.245631759792175e-01   -5.767703974077154e-01; +8.090993725764986e-01   -4.028626294642536e-01   -2.985036947425702e-01   -8.602925883623588e-01   -7.055191778425872e-01   +4.546670420399149e-01   -1.182512043760896e-01   -7.949261940777608e-02; +4.028729720309634e-01   +2.623676970866329e-01   +3.029901716291185e-01   -4.684401997508016e-01   -6.858020023868079e-01   +1.267703638985534e-01   +2.472496397153743e-02   +5.000435677715299e-01; -6.275299681170016e-01   -6.156151382081396e-01   -4.212917849916490e-01   -9.084944051120988e-02   +3.448123556422520e-01   +4.291855961783453e-01   -9.613065028503226e-02   -6.839565178418398e-01; +4.837309062234319e-01   +5.636008332184277e-01   -6.269391668278608e-01   -1.128784510930793e-02   +6.009669447744967e-01   -6.680228609332521e-01   -1.000000000000000e+00   +5.974685773886333e-01; +5.728110662993143e-01   -2.978428152679763e-01   +8.618000348191703e-01   +3.391348671957128e-02   +3.900551784759498e-01   +3.572037268271300e-01   +5.579287569851815e-01   -1.705992509623968e-01; -3.686846715807912e-01   +2.267295413431712e-01   -3.816092361912991e-02   +5.321853026451842e-01   +5.573488673284734e-01   +1.387541751826007e-01   +3.717268628881228e-01   -4.791107502472197e-01; -5.726064744305761e-01   -1.727927017421082e-01   -6.479172775692036e-01   -1.090355124476129e-01   -3.614163219143195e-01   -1.880374290032677e-01   +6.440523998038408e-01   -2.201027221345861e-01; +3.226420828852922e-01   +3.146585792221275e-01   +3.014007370115175e-01   -6.186412030952507e-01   -5.340247173863346e-01   -5.167884936297805e-01   +4.773406182739880e-01   -6.934276250189286e-01; -4.772183193275317e-01   +1.933755665771960e-01   +5.477536700006287e-01   -3.895757575844505e-01   -6.968610579015037e-01   +1.245801160064540e-01   -5.949900596008479e-01   -3.383168779408331e-02; +2.583143122705508e-01   +2.271060071392938e-01   +7.794451079660250e-02   -1.096137644977659e-01   +3.911350975838830e-01   -3.779955773748210e-01   +8.761878782908047e-01   +3.132337837023491e-02; +1.030348822847680e-01   +3.501883611953594e-01   +6.125157801486704e-01   +2.396383741295274e-01   -1.679704385470433e-01   -1.674182241286370e-01   +4.822100859739333e-01   +3.468542287499380e-01; +7.576900153729721e-01   +7.295199594687517e-01   -1.333821868689058e-01   +2.398290233823041e-01   +3.859230280417275e-01   +4.535045279357424e-02   +4.916988467491316e-01   +6.575887315287940e-01];
L1E_L2E_iAMPA_netcon = [-8.398046058199091e-02   +3.010786735820885e-01   +2.475931033202326e-01   +1.233391406821890e-01   -4.208223785874498e-01   -5.699642966552442e-01   -3.455979969120493e-01   -2.615498270795431e-01   +1.231077074890693e-01   +4.079318680950624e-01   -4.148641788240197e-01   -4.535239343140482e-01   -5.128653483097895e-02   -5.852626841775797e-01   -1.420686226459830e-01   +5.699965826323224e-01; -4.908349901975819e-01   +6.377297592519627e-01   +9.489844101277739e-02   -2.694664160864094e-01   +4.231162741831466e-01   +4.573458191954556e-01   +5.975294362204423e-03   -2.050971830525780e-01   +2.392075131601091e-01   +8.837736781133525e-01   -9.909143796258349e-02   +1.254380780970996e-01   +1.744107956526800e-01   -5.137535606740536e-02   -3.247237635407166e-01   -9.862968004942702e-01; -4.381201762281218e-01   +2.672236344850905e-01   -5.059333141538761e-01   -2.294848476608118e-01   +9.792625909244754e-01   -5.310081435243977e-01   +5.970896111048880e-01   -7.689550499339576e-02   +4.096455552814667e-02   +3.865172245127255e-01   -5.985391044506212e-02   -4.076370971561730e-01   -2.479357393684481e-01   +5.624471225889792e-01   -6.623709022494302e-01   +7.691162318544868e-02; +4.221928060763308e-01   +1.663999346003770e-02   +6.256498478707352e-01   -1.543941664592499e-01   -9.443564894890098e-02   -1.890070624425334e-02   -1.413721946537263e-01   -4.271980564919047e-01   -5.803597146422736e-01   +5.383990305271016e-01   +3.630059229861193e-01   -7.629027785888582e-01   +1.805925861899522e-01   -1.332009827666656e-02   -4.184074719530398e-01   +7.015229839724776e-02; -4.504080734209533e-01   +5.441943795326205e-01   +1.851628558477470e-01   -8.511361157754984e-01   +2.779029774666124e-01   -1.174558672484063e-01   +2.668368401122579e-01   -3.670918880643640e-01   +4.911724735197084e-01   -7.006835407990635e-01   +5.032438885475776e-01   -3.709596150120781e-01   +5.451555365070653e-01   -1.000000000000000e+00   +9.279362160191652e-01   -7.199403652096346e-01; +4.158282724237140e-01   +4.822194048861858e-01   +1.759375286238718e-01   +3.231470900653705e-02   -4.181681715503947e-01   -2.034968296505771e-01   +4.358661013547160e-02   -5.174948804748660e-01   +1.189613953541705e-01   -2.132126450506147e-01   +6.783527614122011e-01   -2.568474707533793e-01   -2.586770926482455e-01   -5.694256120915091e-02   -4.987133672665901e-02   +3.373414699695617e-01; +1.556580854145936e-01   -1.356334934465236e-01   +5.402189217876677e-01   +3.279576755279074e-01   -5.679854971569049e-01   -4.567149777404685e-01   -6.598930547457101e-01   +1.735449169868412e-01   -4.452591400692601e-01   -4.642833953447523e-01   -1.424573011861627e-01   -1.461274277889454e-01   -3.550301277311921e-01   +3.368762843697632e-01   +4.811780464376660e-01   -4.642618668026852e-02; +5.388977102927710e-01   +3.946317555095258e-01   +6.974256418609699e-01   -5.577248461636821e-01   +8.393480043912028e-01   +9.359784985863651e-01   -7.956158836217909e-01   +3.245096454597771e-01   +5.908266935492220e-01   -1.658568377727533e-03   -3.686106171281328e-01   -1.660963563455448e-01   +1.768212125510837e-01   -5.838780472730442e-01   +5.712815165866239e-02   +6.411024500951866e-01];
L2I_L2E_iAMPA_netcon = [-1.281992250270649e-01   -2.733420310489053e-01   -4.369963339384956e-01   +1.511285938555199e-01   +1.038392277699035e-01   +3.948399504327250e-01   +1.556739100655575e-01   -3.171894176473234e-01; +1.425647753270974e-01   +5.001658769911536e-01   +2.116098403448718e-01   -6.307448914567132e-01   -6.994277901053910e-01   +3.151074457374837e-01   +6.562262054369677e-02   +1.167187174372038e-01; -1.307430535853137e-01   -5.928144610145546e-02   +2.234384585419975e-01   -7.165946966164113e-02   -2.580899533890643e-01   +6.123797245571838e-01   +3.622506189647854e-01   -1.132379462470471e-01; +1.709804063330525e-01   +3.913030925831545e-01   +4.589670687964192e-02   -5.695747571215357e-01   -4.934662482777352e-01   +4.136207596253478e-01   +3.207137330436087e-01   +5.490392586767402e-01; +6.221295489089218e-01   +4.396925359364934e-01   +3.200978102654757e-01   -2.901579859926053e-01   -4.089921035064967e-01   -5.979495371553245e-01   -2.522976944243086e-01   +3.267286756205444e-01; -8.315326238414672e-01   +5.349504564197129e-01   -3.343563714174737e-01   -7.213083538039636e-01   +1.060999596793755e-01   -2.453846765016847e-01   +1.736002779680354e-01   -2.755112194215253e-02; +6.206657465041615e-01   +1.473810279214828e-01   -3.787802433396287e-01   -5.840150207239515e-02   +1.000000000000000e+00   +4.888314983775059e-01   -4.667188195783685e-01   -5.577862525154027e-01; -8.430617864547705e-01   +5.047003770335614e-01   -1.618765180093279e-01   -2.407212176536578e-01   -8.536335975320259e-01   -6.203274858703617e-03   -9.152985710383651e-02   -2.698269603347302e-01];
L2E_L2I_iGABA_netcon = [-4.590701727568080e-01   -4.564706829515725e-01   -3.488442036018062e-01   +7.303082892176923e-01   -6.813606398277353e-02   +4.501796875266814e-01   -1.000000000000000e+00   -1.424934653747499e-01; +7.711584455641908e-01   +9.694082133576998e-02   -4.419777652189964e-01   +6.672280870732908e-01   -5.121539197327302e-02   -8.132285036082756e-02   +4.208943508699923e-01   -3.824651563610260e-01; +2.775221728826197e-01   -5.839595113436254e-02   +3.980839639504080e-01   +4.457552242922945e-01   -4.739601832667913e-01   -6.219454718516078e-01   +5.145495323433736e-01   +6.991364438226617e-01; -3.418960291338031e-01   +7.933305735726855e-02   -7.029506733962922e-01   -4.874311100965766e-01   +3.272747398120486e-01   -1.139521312206075e-01   -8.211068875409679e-02   -5.611753218551568e-01; +3.510455276051422e-01   +8.846333947822435e-01   -2.572512789119170e-01   +6.584487817920425e-01   +4.636326521188831e-03   +1.175386435268971e-01   +9.661672710349641e-02   +3.595518391608112e-01; +1.953772323161264e-01   +8.904000315999157e-02   +3.822324904619135e-01   -4.807925704068632e-01   -2.792996657209023e-01   -3.682713997831285e-01   -4.473726014742351e-01   -6.075861433026879e-01; -1.902526773693143e-01   -1.693097878648119e-01   +2.105333071889830e-01   +7.759182296664487e-01   +6.385383797936299e-01   -1.574750733185672e-01   -4.148194911964133e-01   -4.164244265699377e-01; +6.054349710295513e-01   +2.685174065356660e-01   -3.921030143359726e-01   +1.646567116349558e-01   -5.853331081126688e-01   +1.537569432504751e-01   +8.614603990299141e-02   +2.529284343395777e-01];
L3E_L2E_iAMPA_netcon = [+3.681765320524716e-01   +4.191384665522510e-01   -5.876199658613305e-01   +3.341110541491902e-01   +2.460369227427072e-01   +6.395595000896835e-01   +4.050227303163838e-01   -3.722185198406419e-01   -9.470535454243556e-02   +5.954121324936826e-03   -3.977582892131479e-01   -3.549032926994197e-01; +5.043661490360108e-01   -1.815512084973060e-01   -3.623615116551163e-01   -5.444115914240390e-02   -2.081066327130323e-01   -3.022659063238120e-01   -3.380274236739882e-01   +2.440547761613517e-01   -1.001533050728935e-01   +4.673457032656912e-02   -6.309641308182544e-01   -1.415962803711353e-01; +6.679622160790057e-01   -6.730402425751816e-01   +3.792544366049824e-02   -1.072507268663461e-01   +4.187389990376332e-02   +6.041718944054206e-01   -4.479087466331832e-01   -7.492954332427536e-01   +1.208553033587117e-01   -1.402567170050246e-01   -1.063087174639430e-01   -1.557239399705677e-01; +2.659424567100930e-01   -7.048658230732247e-01   -4.692696378484391e-01   -7.163608636156828e-03   +4.948560620350475e-01   -3.162818276623888e-01   -1.010055082298994e-02   +4.994830246788305e-01   -6.133411312273738e-01   +6.890016765977558e-01   +3.476181314112050e-01   +3.063609673284752e-01; -1.349895757698094e-02   -2.004382367810199e-01   +2.055391389406672e-01   +6.820389124195255e-01   -4.350432102991605e-01   -4.078315366844045e-02   -4.222257268487294e-01   -2.866168155373220e-01   +3.164678842337144e-02   -3.410736699461310e-02   +1.081790118395609e-01   +3.444121544991400e-01; +1.178850483466573e-01   +6.512878613328383e-01   +1.486665860436062e-01   +9.693188447857806e-02   -4.228929048980585e-01   +1.000000000000000e+00   +2.743526853030214e-01   -5.319646523475705e-02   +6.581123714147569e-02   -1.900807112326987e-01   +3.631455353410934e-01   -7.663337675199108e-01; +5.581586825188219e-01   -1.289774902910894e-02   -5.452386980603142e-02   -5.651137745523062e-01   +3.054240146363718e-01   +1.487051839783132e-01   -6.098723797061493e-01   +3.523455591162126e-01   -1.681489469699768e-01   -4.608279847866240e-01   +1.257420043732854e-02   +1.918458575041131e-01; +7.132020050499429e-01   -4.854831733379901e-01   -2.086622917787968e-01   -3.552244841015805e-01   +4.396256704938673e-01   +2.932147172749674e-01   -5.573537257738412e-02   -2.819835185355219e-01   -1.496778636972096e-01   +7.929534019454466e-02   -2.137413082247384e-01   +3.614784871366603e-01];
L3I_L2I_iGABA_netcon = [+5.396081659692269e-02   +4.338714367306088e-01   +6.440392076116846e-01   -3.119897133842294e-01   +5.485249176082946e-01   +1.073681164909050e-02   -2.004851430930206e-03   -4.593194617323247e-01   +3.559808213870980e-01   -5.261078029125624e-02   -5.521296006764654e-01   +2.149872447083531e-02; -5.866498865984465e-01   +1.102651094679488e-01   -2.837900847675759e-01   +2.822794970553529e-01   -4.700816009695850e-01   +7.200286506476730e-02   +5.412253797865858e-01   +2.311196976862935e-01   -4.978648937493204e-01   +2.512839398397169e-01   +3.582149218645987e-02   +1.351131071828435e-02; -1.487668793551045e-01   +2.974559210059793e-01   +2.710380613931634e-01   -1.134665573380095e-01   +4.762374658301802e-01   +1.939019059958487e-02   -2.915728179468511e-01   +2.178570543322787e-01   +3.322039944657101e-01   -4.576492507682534e-02   +6.322987300340757e-01   +4.400574067804259e-01; -3.038094893882601e-01   -1.634393255761000e-01   -1.176460671043682e-01   +5.407505397304483e-01   +3.490168733151708e-01   -5.336259920400128e-01   +6.667434610723966e-01   +1.668598052983095e-01   +4.723906071310446e-01   -1.000000000000000e+00   +4.492337175698370e-01   -8.437706022764455e-01; +1.544376752380938e-01   -1.008987792738995e-01   +1.198886828381378e-01   +3.103045862772098e-01   +1.165623433897333e-01   -4.815476940820111e-01   -1.485461544855791e-01   -4.861260178166159e-01   -1.050109151037810e-01   +2.750556527740741e-01   +4.795759953504464e-01   -2.887054585602971e-01; +4.321598969492803e-01   +3.506131890222373e-01   -2.811775547387000e-01   -2.790420771872308e-01   -3.414863736876717e-01   -2.420192919077612e-02   +2.834732785891545e-01   -3.013938775133724e-01   -5.473700078603922e-01   -4.276867871802886e-01   +9.039212571461321e-02   -4.400664669759160e-01; -4.339805448498248e-01   -8.127669366800087e-01   -5.894589068940672e-01   -1.621186988344999e-01   -3.143384993427089e-01   -2.959624152059395e-01   -3.099212652616911e-01   -7.047943830967246e-01   -3.130189253277293e-01   +3.763875698922619e-02   +1.744666866997748e-01   +2.066144359308237e-02; -4.541931250891075e-01   +3.388283534064193e-01   +3.825233485146070e-01   -7.470570892390907e-02   +2.309839984630688e-01   -2.378664892099491e-01   +3.905594048178602e-01   -1.087924310747306e-01   +3.105322073229171e-02   -3.811621129795802e-01   -1.476022669400522e-01   -1.522602634556024e-01];
L2E_L3E_iAMPA_netcon = [+3.893190839503363e-01   +6.730595754273500e-02   -5.860333077497504e-01   +6.917259994900893e-01   -7.719356074539216e-01   -4.984009861263473e-01   +9.381518147811017e-02   +7.216769268848301e-01; +1.098113874233173e-01   +5.019202540780342e-01   -4.958272218684220e-01   +1.309810590474036e-01   -1.644126310383438e-01   -3.239607781232198e-01   +2.244617181945080e-01   -2.166303796480929e-01; +8.771958683910688e-01   -5.738131239878205e-01   +7.743058225876193e-02   -4.099036570614055e-01   -1.163373802391599e-01   -5.824367449128480e-01   -5.351329601429669e-01   -5.876377395661976e-03; -3.480155516803601e-01   -1.787167143324453e-01   -1.196722981575820e-02   -6.910136101080229e-01   -5.315133250424230e-01   -3.844224452544412e-01   +2.965391468815920e-01   +3.827904526136679e-01; +4.572894399093082e-01   +1.770529984248519e-01   +6.490787943408328e-01   -8.331064372021176e-01   +1.510447806388474e-01   -3.365211045546400e-02   -7.154509133501453e-01   +1.000000000000000e+00; +7.093550610069493e-01   -4.274687941332975e-02   +8.575816481017369e-01   +2.000020571374556e-01   +3.098079390744564e-01   +7.347970168287877e-01   -4.353543845369545e-01   +5.656018589901431e-01; -9.832378732563198e-01   +2.060297119177504e-01   +5.375348464182471e-01   +1.763934682613780e-02   -3.479619379960022e-01   -2.916117263992205e-02   -3.075575084707861e-01   -4.974520141368721e-01; +5.337929024991656e-01   +4.935558434825121e-01   -5.483328979838012e-01   +3.730013598653699e-01   +3.759485823344033e-01   -4.999976742952591e-01   -5.005237831453905e-01   -1.407295717565932e-01; -1.974221204195435e-01   +2.165436266334714e-02   +7.395930876296025e-01   +1.917185264861626e-01   -6.788278310164439e-01   -6.324914109283973e-01   -8.414036393711394e-01   -3.486700165183388e-01; -7.758407831253596e-01   +3.138307180938757e-01   -2.215970870255352e-01   -8.100463955694671e-01   -3.359506728858924e-01   +2.870277132022978e-01   +5.985467322457163e-01   -2.562167356560240e-01; +1.874561048800651e-01   -5.312017365352981e-01   -4.092665212079550e-01   +2.717265899782710e-01   -3.585797392395849e-01   -3.147138657333030e-01   +3.504375232156630e-01   -3.049837396250372e-01; -7.713119127747261e-01   +5.720100396369128e-01   +1.311927692702922e-01   -2.926859073172181e-01   +1.107302902609727e-01   -7.842740121952782e-02   -3.094406565825104e-01   +1.775274681756952e-01];
L2I_L3I_iGABA_netcon = [-3.466400388926637e-02   -9.308859063436994e-02   -5.707097789426528e-01   +1.635355695209287e-01   -2.353750231445441e-01   -1.942416106619812e-01   -3.811595838153604e-01   -1.460693460096111e-01; +1.378350486575807e-01   -7.134732522823762e-01   +1.169022723904673e-01   +6.351224400923688e-01   -3.279272368468227e-01   -6.013535728139725e-01   -2.366609416109268e-01   +8.228225525653841e-02; +1.256835391509040e-01   +8.228695640291739e-01   +3.084147785652664e-01   -1.492881986686237e-03   +6.724713183682842e-01   -2.782671116993897e-02   +6.329645260016082e-01   -4.123004429074896e-01; +3.477689259940003e-01   -5.274608999585496e-02   +2.336504340302493e-01   -3.147426665134821e-01   -1.560399777345517e-01   +1.970964706127187e-01   +4.531026368367100e-01   -1.868693371432039e-01; -1.921518669224019e-02   +3.693150102079746e-01   +5.119098343449366e-01   +5.634168964766100e-01   -3.196319896156347e-01   -4.509948115414732e-02   -2.502887393612191e-01   -6.705214349240709e-01; -2.763084661246857e-01   -5.252641577783217e-01   -5.493903573149804e-01   -5.835434933833082e-01   +3.160428685227904e-01   -7.190791224767678e-01   +6.354404089351685e-02   -1.503506390638153e-01; +5.522102656147447e-01   +6.099623502115125e-01   +1.428878445892403e-01   +3.669202184430157e-01   +1.796202540420795e-01   +1.000000000000000e+00   -2.003260731811456e-01   +4.236200626310335e-01; +6.784570405679248e-01   -6.086457696632144e-01   +7.087234938032765e-04   -4.067244864870848e-01   +1.704680322811413e-01   +2.941559244871028e-01   -3.033706585823435e-01   -3.132715788538838e-01; -6.727498098215833e-02   +4.609936277854121e-01   +7.510569380866043e-02   +4.587937960064058e-01   +4.435974154376868e-01   -3.904017085436490e-01   +2.579387213270764e-01   +9.617521364322335e-02; -4.427393530117466e-01   +2.210049412564361e-01   -4.197193895183928e-01   -5.263866027715499e-01   -6.645455214467482e-01   +1.537651168535739e-01   +8.467180301551813e-02   -1.274062098940261e-01; +2.140959239851120e-01   -4.028478524394226e-01   +5.694862479717974e-01   +5.888068845396647e-02   +6.677944834551122e-01   -4.407604915939214e-01   -2.708939415660508e-01   -2.755162455287071e-02; -3.799694406384768e-01   +2.841863361773380e-02   +5.701034196013705e-02   -4.633914672729096e-01   +9.145484030415731e-02   +1.837939137896270e-02   +8.636191798874937e-01   +2.475537862642771e-01];
L3I_L3E_iAMPA_netcon = [-1.851521325172668e-01   -3.958307820424804e-01   -1.088082884582715e-01   -4.874163755159161e-01   +1.748466155284460e-01   -1.983933603895650e-01   +5.919635873084796e-01   +4.206145781845249e-01   -8.040906199304284e-01   -1.761474014424088e-01   -4.946466045978069e-01   +6.371851420361757e-02; +1.273176433756128e-01   +3.697743903811007e-01   -2.038655235534564e-01   -7.896498890366054e-02   +1.328797452747245e-01   -7.769887800380585e-01   -1.911024098991434e-02   -3.960541558961336e-01   +3.121461709664652e-01   -1.263581341469893e-01   -7.152647718679363e-02   -1.038896032859988e-01; +1.802418473630199e-01   +1.124514512149113e-01   -8.871160175240206e-01   -4.605720643597176e-01   -6.605978893461534e-01   -1.760801307946974e-01   +9.195451218570309e-02   +5.249088981978265e-01   -6.104281400754913e-01   -7.307468218059453e-01   +8.839521537810846e-02   +3.344041273583407e-01; +3.921432177936588e-01   -6.132356114722440e-01   +9.307448849228768e-02   +4.003382915296486e-01   -4.900985801766972e-01   +6.766023631205236e-01   -5.267744685886504e-03   -7.825120586635346e-01   -2.939906852656210e-01   +5.355183254546760e-01   +2.347927242985814e-01   +1.288539848969548e-01; -2.277806805369174e-01   +4.388640696644923e-01   -1.252936024064986e-01   -3.581728586629007e-01   -8.235536669603177e-01   +4.792371077689133e-01   -1.056462917152815e-01   +8.276739193562394e-01   +3.840001247274893e-01   -2.978470202613284e-01   -4.026318629394695e-01   -4.693426789488236e-01; +6.354058051480006e-01   -4.723770153824770e-01   +8.124128907861485e-01   -3.438300933555126e-01   +8.541287822157586e-01   +5.862134735541111e-01   +3.170108208921740e-01   +3.113489667840197e-01   -2.051172378095136e-02   -9.644031943309585e-02   +7.347611498442704e-01   -3.030184828539665e-01; +2.022245883595973e-01   +5.666997787489908e-01   -1.931677909862880e-01   +4.504244458277738e-01   +9.716869150865042e-01   +7.097059091333575e-03   +3.424384583898371e-01   -2.755094792054428e-02   +3.090905144143075e-01   +4.374644982023748e-01   -1.513054275672201e-02   +3.496277023175280e-01; -5.086240340980920e-01   +2.022064836953980e-01   -5.319110828486674e-01   -3.722484310052521e-01   -1.291145109842357e-01   -5.116169790879783e-01   -3.453099681526647e-01   -7.992562908644458e-01   +1.897801925675159e-01   +4.410511720362750e-01   +4.159544442398246e-01   +3.289258373018229e-01; +5.587147531965102e-02   -5.521056879124530e-02   +3.975615327257401e-01   -3.583471704132932e-01   +6.531741878663482e-01   -3.470597858283643e-01   -4.311945006097353e-02   -4.197450389857528e-01   -1.803785416155178e-01   -5.442561722051754e-01   +2.539038553076184e-01   -3.623112624707381e-02; -3.843767641367482e-01   -2.727158692971726e-01   -2.115626981601721e-01   +6.501826878349196e-01   -1.573445115287585e-01   +3.104249517113082e-01   +8.688982147253896e-02   +5.505741128760878e-01   -4.063937449789481e-01   -3.847347199871048e-01   +2.324487372440512e-01   -3.275674351896229e-01; +2.044520184841259e-01   +2.980046904155618e-01   -5.502043174465526e-01   +2.202468543557659e-01   -5.695893677724226e-01   -2.468349035711689e-02   -3.834501657966341e-01   -3.276779634203906e-01   +9.012762529044979e-01   +1.606567457252346e-02   +2.588160115092606e-01   +5.315420070587279e-01; +7.121254051586355e-01   +2.292076779217588e-01   -7.477619589860500e-01   +1.822579167055507e-02   +1.000000000000000e+00   +6.479537117476801e-01   +2.096926939218039e-01   +2.160309842700919e-01   -9.804447442300465e-02   +6.874847360825630e-01   +2.702690147582927e-01   -2.618394916994965e-01];
L3E_L3I_iGABA_netcon = [+3.349440224550974e-01   -3.730481590656805e-01   +4.386410310246195e-01   -5.092754486955399e-01   -1.428197164109481e-03   -4.971898749652889e-01   +3.153580567014300e-01   -5.554100128114259e-01   -7.854158008988810e-01   +1.259255758521227e-02   -5.926563534044043e-01   +2.710100887709285e-01; +6.004134553261978e-01   -6.202915483089669e-01   +1.271593772648324e-01   +6.354716710081266e-01   -2.796613333501749e-01   +4.646499028047976e-01   +6.092209937576234e-01   +3.327893639203102e-01   +1.538389963895488e-01   -8.268988982011589e-02   -3.214854216511600e-01   +2.092128030927032e-01; -7.461548804334218e-01   +6.510024193712214e-01   +9.222184373828076e-01   -4.222704260062756e-01   +2.289071486556813e-02   +5.623885531621866e-02   +3.633293669561710e-01   -8.649889869266512e-02   -6.286968927742256e-01   +3.881024271925689e-01   -3.668966315605238e-02   -1.295146797406873e-01; -4.068166873048675e-01   -8.062996389071915e-02   +4.104674262692939e-01   +5.672198270904123e-02   +3.501964650353675e-01   +2.890252886555856e-01   -3.061977214094264e-01   -1.881501335806499e-01   -7.031238861264340e-01   -2.769540205317074e-01   -1.911229351704230e-01   +1.918569067362909e-02; -7.964576542262247e-01   +5.070185121427924e-01   +2.928941794811983e-02   -6.619771318727181e-01   -4.659885128810149e-01   -3.432630713774040e-01   -2.763230435960045e-01   +2.607031976676596e-02   -2.156542641585809e-01   +2.446245137960365e-01   -4.772002305820175e-01   +4.151373527849161e-02; +3.299521360043998e-01   -1.267890223183886e-01   -4.905627026930524e-01   -7.149108147077965e-01   +1.050864336968339e-01   -5.534677974114630e-01   +3.993182233684391e-01   -3.130202471270409e-01   +5.022698527112542e-02   -6.816000638959024e-01   -1.845796476896268e-01   -5.071630112257017e-02; -2.323476276013143e-01   -5.539249248155383e-01   +7.826940708792153e-02   -4.318525474615531e-01   +2.354103803983430e-01   -6.655117699427958e-01   -8.228714213976989e-03   +2.431115685501750e-02   +3.562411927541990e-01   -2.083554656069353e-01   -1.066538115671709e-01   +5.043498057365606e-01; -3.317313641048782e-01   +7.773136881271646e-01   -3.367405369562311e-01   +6.104570467932806e-02   -5.013262723999915e-01   -4.968492207384895e-01   +8.295198063549463e-01   -3.814938894049789e-01   -1.941458804137930e-01   +4.463806106853908e-01   +3.864618880935471e-01   +5.167096346966339e-02; -5.247818804702681e-01   -2.817204643016185e-01   -1.497273888839282e-01   -2.233029428484699e-01   +7.102815943735393e-01   +3.016036049868627e-01   +5.526753060096060e-01   +2.260710609283346e-01   +3.365942836998964e-01   +7.110865430172817e-01   -6.444143586343269e-02   -1.429406152264449e-01; -3.883263087276629e-01   +2.235373214646333e-01   +5.473368729383282e-02   -1.169700863351591e-01   +4.127670810635114e-01   -3.085702636803508e-01   +1.053446722793879e-01   +6.190238504571939e-01   +6.708534600861251e-01   -2.406293151474005e-01   +5.735187743683144e-02   -6.919110798547272e-01; +1.000000000000000e+00   -3.000110583349284e-01   -6.551971479349339e-02   +3.119060144758445e-01   +5.100814104697970e-01   -4.701935149403877e-01   -3.910912901957758e-01   +5.449543569273337e-01   +5.450551292414157e-01   -4.123439086838088e-01   -5.259928644075604e-01   +3.852994388141368e-01; +1.595841104307706e-01   -4.584800396517723e-01   +3.851378316368797e-01   -2.866855664576368e-01   +1.717902587148385e-01   +5.803063180444823e-01   +3.791764738940417e-01   +4.878633901336860e-01   +5.615849242987965e-02   -5.807711016014195e-01   -2.043819792225012e-01   +2.513830401490031e-01];
L2E_Input1_iAMPA_netcon = [+1.634199720103407e-01   +6.463440693271827e-02   +2.413641366956545e-02   +9.130124109916798e-02   -4.356960061448182e-01   +2.314125456851612e-03   -9.862566955997758e-01   +9.352851868755112e-01];
L2I_Input2_iAMPA_netcon = [-8.964322506070120e-01   +3.320947388249093e-01   +2.597307727781349e-02   +3.849799782747939e-01   -6.580113922233300e-01   -2.546929499197406e-01   +1.121222212343909e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
