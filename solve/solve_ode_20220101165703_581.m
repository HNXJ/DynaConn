function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.789445707419154e-01   +1.742650002888000e-01   +3.369369234166133e-01   +6.512923032846658e-01   +4.629754455484635e-01   +1.306545353606677e-01   +6.767727080777575e-01   +8.191060553729562e-01   -2.216212775435662e-01   +5.154157056250253e-01   -1.593638004242122e-01   +4.085261588984341e-01   +8.800343847603194e-02   +3.157724976625225e-01   +9.602932917967892e-01   +7.648685242424543e-01; +9.735345239982797e-02   +7.954853048167633e-01   +4.979255974655654e-01   +3.691147809053557e-01   +9.774996064284858e-02   +6.332111216259202e-01   +5.325163223868803e-01   +1.234497061122697e-01   +2.897109288246096e-01   +2.944956653805533e-01   +3.578649466914795e-01   +9.440331619687702e-01   +5.044679015940782e-01   +5.180855038405132e-01   +3.080129632424659e-01   +2.614932097500769e-01; +2.271061547276074e-01   -1.819283230603281e-02   +4.202950564284103e-01   -1.112015174239947e-01   +1.953174022068536e-01   +4.172438124431144e-01   +1.580656723237676e-02   +3.914828278961657e-01   +3.573021735681554e-01   +9.881251858199581e-01   +3.660700548725023e-01   +8.441653526367130e-01   +6.547803052555941e-02   +8.463943935322035e-01   +6.120645544699853e-01   -1.102648831676098e-01; +7.888373169019303e-01   +2.888998444290517e-01   +3.058203103465703e-01   +6.784767106471493e-02   +2.375033949110763e-01   +4.934388660076752e-01   +4.637872900433160e-01   -1.097679115760652e-01   +8.387310033592458e-01   +8.277370169703110e-01   +4.408376889025220e-01   +4.288235132580905e-01   +4.917308212773325e-01   +3.668225932860397e-01   +7.971690978147427e-01   +3.099063636941439e-02; +5.199409830594942e-01   +1.477434447092770e-01   +1.827123869568620e-01   +2.975401237369069e-01   -3.542367317132321e-03   +2.057312511348344e-02   +2.962728181923479e-01   +4.070005123420755e-01   +3.583082351640903e-01   +1.872397138445850e-01   +4.821850794154264e-01   +6.795759192212955e-02   +3.348353791700033e-01   +4.458741730946976e-01   +6.450267968572173e-01   +8.569567725203391e-01; +7.201953675480434e-01   +5.751154862539532e-02   +6.697649622749700e-01   +4.679779823104580e-01   +4.270731817617339e-01   -2.049367514438600e-01   -3.249250513178872e-01   +3.349924336405692e-01   +4.583948630507805e-01   +6.343729626255499e-01   +3.159772612504529e-03   +7.255947219378912e-01   +7.322876444690694e-01   +2.835332411135891e-01   +7.740051709879520e-02   -1.667891509562137e-01; -2.166307154760249e-01   +8.003483698139032e-01   +5.495574149753976e-01   +4.767339674856405e-01   +8.193740315487361e-02   +4.178515690685615e-01   +1.859736286539960e-01   +5.608894760258212e-01   +5.947026736903507e-01   +1.513491015458833e-01   +1.460060696938099e-02   +4.554936830646674e-01   +4.435819682702755e-01   +2.858658609522422e-01   +4.560119448629267e-01   +3.356523242640393e-01; +5.754943424571300e-01   +5.595194684629313e-01   +9.652789509956811e-01   +4.885920413528950e-01   +5.663196151382901e-01   +9.278675404191661e-01   +2.609310150450078e-01   +2.587068711619863e-01   +8.587832058765135e-01   +8.401856499160499e-01   +2.387208880520756e-01   +4.608502055460225e-01   -1.250673966725590e-01   +9.168649837001619e-01   +2.974539376921952e-01   +7.198219614804297e-02; +2.363781575194454e-01   +3.213217513016565e-01   +1.861181455325130e-01   +3.139662800868461e-01   +5.625359445353637e-01   -1.019077248151606e-01   +5.106676342062053e-01   +4.192507462898142e-01   -1.409767258000720e-01   +8.036596559008894e-01   +8.553154784613979e-01   +6.011020751631331e-01   +2.962876648946048e-01   +5.519881526470958e-01   +5.500676400521296e-01   +4.988460900945530e-01; +2.927047870120225e-01   +1.173729749348097e-01   +6.705237422623920e-01   +7.020287305768578e-01   +8.666009058066123e-01   +3.689781402658607e-01   +2.995218247673818e-01   +3.662569588262905e-01   +6.262104878495752e-01   +3.671558884860726e-01   +3.047069595349663e-01   +3.979637356595002e-01   -6.289336915910736e-02   +4.411616554877817e-01   -9.015451684970885e-02   +8.664466196375079e-01; +9.391248913497375e-01   +5.878626326320260e-01   +1.000000000000000e+00   +3.994099552205260e-01   +4.862425434387662e-01   -1.009171883268531e-01   +4.747947408808171e-01   -7.586278738032118e-02   -9.563111282628917e-02   +4.590788740344155e-02   +6.989233176067834e-01   +2.747699633082717e-01   +2.373582109915829e-01   +2.976346926488257e-01   +5.519739917603645e-02   +2.050563907785551e-01; +3.140309141755666e-01   +1.230072220794524e-01   +1.562350466589310e-01   +2.557691570146379e-01   +7.021587970731689e-01   +2.659851460198872e-01   -1.296770587855387e-03   +1.842726639232295e-01   +3.877808324269684e-01   +6.955331479598938e-02   +5.203603107013840e-01   +3.375858997020177e-01   +1.873082822659318e-01   +7.844293765322160e-03   -1.341640199221065e-01   +2.802618312919056e-01; -8.815270316271059e-02   +5.227517668358861e-01   +5.889384774886631e-01   +2.396612775362240e-01   +2.564013831229492e-01   +3.244225703621149e-01   +8.005411941162540e-01   +4.832617364292729e-01   +3.048820146172581e-01   +7.237900770212904e-01   +7.627764408080686e-01   +2.984989764950241e-01   +7.066221313328358e-01   +4.837086481507825e-01   +1.791140639436008e-01   +5.928194436972726e-01; +1.143254645011018e-01   +6.244601830245210e-01   +2.775760018577782e-01   +5.275750036940443e-01   +2.251922057367136e-01   +9.161669762734032e-01   +4.405239112011978e-01   +3.091820984838724e-01   -5.138864970351182e-02   +2.607025938354366e-01   +1.233827199044753e-02   +3.729745545947673e-01   +9.146325411867134e-01   +2.015155893431676e-01   -9.277365986141761e-02   +8.224839443260453e-01; +3.156298505455159e-01   +2.945487340843811e-01   +8.292701312226897e-01   +3.177681350275720e-01   -2.456488486010125e-01   +2.999100501211464e-01   +8.187887905877049e-01   +1.750478876640444e-01   +6.041979002083523e-01   +1.051408893822309e-01   +1.330608831712578e-01   +3.565986092855139e-01   +8.798496043805845e-01   +9.165059654812973e-01   +1.597566957771646e-01   +7.917365488709591e-01; +6.926884821222795e-01   -1.154485039863276e-01   -5.269298808221086e-02   +3.637153429058905e-01   +3.975250747294194e-01   +1.545754748213922e-01   +3.302767631272716e-01   +5.753968619845744e-01   +3.789216431961354e-01   +3.961673598496104e-01   +3.612288313238071e-01   +3.580297114437379e-01   +4.826344565094603e-01   +1.391822899080915e-01   +3.346251802320366e-01   +1.134223314246815e-02];
L1E_L1I_iGABA_netcon = [+6.865449244291393e-01   +3.803095226771510e-01   +5.097676310454823e-01   +4.830438123054084e-01   +4.029692607427349e-01   +2.599538637598291e-01   -4.876821517036733e-02   +2.596708218541737e-01   +9.170400131256172e-01   +3.338229132547935e-01   +1.531176328803676e-01   +6.764767349988487e-01   +4.073572949936837e-01   +3.631928123136171e-02   +4.960674434106297e-01   +2.894956543315205e-01; +9.274705257271906e-02   +7.801189925753794e-01   +4.573743396282878e-01   +1.634788680033516e-01   -9.742837836703537e-02   +5.735812272871339e-01   +2.962623047649638e-01   +9.147517257301984e-01   +6.846414944042918e-01   +2.028110082597579e-01   +4.243857674320429e-01   +7.208183252711590e-01   +4.484074842393856e-01   +1.384040589258812e-01   +6.542832785756563e-01   +9.724143208694593e-02; +4.387977400032350e-01   +2.798505255693602e-01   +4.524266172129563e-01   +4.509793516709904e-01   +4.507590952075555e-01   +1.506470234937860e-01   +3.992108640668179e-01   +3.465998653717202e-01   +7.032948353152345e-01   +6.432634117480471e-01   +2.268867365716598e-01   +4.109751026858248e-02   +4.758016542563523e-01   +1.000000000000000e+00   -5.667869764612048e-02   +1.925985856620331e-01; +2.690088870171765e-01   +1.371237951844458e-01   +4.145532174888776e-01   -1.597534395632503e-01   +7.291962643175623e-01   -1.577501602266865e-01   +3.785576888033007e-01   +5.149616999223154e-01   -9.390759440204675e-02   +7.921664712641122e-02   +3.710639138420146e-01   +1.606598558775088e-01   +3.955708655145523e-01   -1.682259232711529e-01   +8.686678944853263e-01   +2.367644024427754e-01; +3.158782469063605e-01   +3.235097463072619e-02   +4.014556971970050e-01   +3.835795027002298e-01   +2.280587716051918e-01   +2.946589632281162e-01   -1.867917185245799e-01   +1.238363233927254e-01   +2.742709495976332e-01   +6.208482330814786e-01   +3.334134552907375e-01   +3.306401917223549e-01   +3.699052421079355e-01   +5.903919636514446e-01   +8.590225562468518e-02   +9.772012659394330e-01; +7.263959933657532e-01   +2.449174024821755e-01   +4.604213585178554e-01   -6.539578210425741e-02   +2.738055333419962e-01   +2.999248842762328e-01   +2.143572027057641e-01   +7.449700801137919e-02   +6.878492639007435e-01   +2.305395195052421e-01   +5.482884292688823e-01   +2.407517788300225e-01   +3.901411689418967e-01   +3.739548295960137e-01   +9.050976418596635e-01   +6.079005278139643e-01; +3.015207563941015e-01   +4.920818753458400e-01   +5.918506307663990e-01   +4.662599176967965e-01   +5.234909296169865e-01   -1.982148532970295e-01   +1.903390901901462e-01   +2.825109640023065e-01   +2.881910175374630e-01   +2.627736314315158e-01   +1.325018755756146e-01   +7.299535156916918e-01   +5.545388620885365e-01   +4.814677292194821e-01   -9.831657872743711e-02   +3.924746987458058e-01; +6.834581069903759e-01   -7.076847598447102e-02   +6.200255689089971e-01   +2.976827481826921e-01   +9.100136890144597e-01   +6.086103867781434e-01   +1.782263604622044e-01   +3.724528448080133e-01   +4.801091876128386e-01   +9.100310758937076e-02   +7.871443805523022e-01   +4.680772590561258e-01   +5.726214763887575e-01   +4.157425785902088e-01   +4.966084842643603e-01   -1.759011352228814e-01; +4.367850784865167e-01   +5.239327687702445e-01   +2.420171621253433e-01   -2.252131929912911e-02   +3.915554469579947e-01   +8.569045375297595e-01   +4.607770625545430e-01   +2.771095089302441e-01   +1.766416941158050e-01   +2.921968628055561e-01   +3.829449343823297e-01   +6.409805868903180e-02   +6.434276998930034e-01   +4.365733539186668e-01   -5.557912886904096e-02   -6.247165379730302e-02; +5.709847298921833e-01   +1.000593293055088e-01   +8.182525097487829e-01   +5.206462085037235e-01   +2.289036449758272e-01   -2.755293771938294e-01   +3.615139672837986e-01   +7.719369974311938e-01   -1.171937155859507e-01   +2.506293011760252e-01   +9.588204689978463e-01   +8.376557093243547e-01   +1.368266445574293e-01   -1.467295492546648e-01   +5.268384538295038e-01   +3.733451670994283e-01; +1.640463393853333e-01   +3.970100573292257e-01   +4.610386706552745e-01   +2.083749882408684e-01   +7.283804986862403e-01   +2.274394133165400e-01   +9.201082117990390e-01   +9.300635250992417e-01   +3.605390022871549e-01   +4.473477193549772e-01   +5.769265341440402e-01   +1.555348121021597e-01   +3.042322219155515e-01   +2.124259386427524e-01   +1.123118545017345e-01   +9.480394637386702e-01; +7.836014979184727e-01   +4.975604426018851e-01   +5.709211647055115e-01   +5.587299148294878e-01   +8.878677074112439e-02   +5.049546843785784e-01   +2.697176982530403e-01   +5.954506975651167e-01   +3.076816892656046e-01   +5.173762848440568e-01   +6.488721291688313e-01   +2.199811325560199e-01   +7.001522227398871e-02   +7.755345041198474e-01   +3.402310218712898e-01   +4.867192949413607e-01; +1.312952212179184e-01   +3.082512516067435e-01   +6.250303480612674e-01   +5.554815360448054e-01   +9.692216011528552e-01   +7.988748044143599e-01   +7.912577347299179e-01   +6.667907018817668e-01   +6.120286553859331e-01   +2.058924653111159e-01   +3.254453415931623e-02   +7.992286433849493e-01   +3.484893746625881e-02   +3.437967857545939e-01   +4.477799892458956e-01   +9.806365147626221e-02; +9.054328601562464e-02   +8.371539218482107e-01   +1.800760797075039e-01   +1.501818300219871e-01   +2.717697898788710e-01   +2.341224652077688e-01   +4.896049285609974e-01   +3.211091368186646e-01   -2.587054636619154e-01   +2.732345623383217e-01   +6.798006294440857e-01   +6.958494050346868e-01   +3.442901568066021e-01   +6.937093932235329e-02   +3.836538392928078e-01   +2.274664856603824e-01; +6.099893176990364e-01   +3.205778628856615e-01   -2.165828009916349e-02   +6.113641104296037e-01   +2.522988191874266e-01   +7.200917093250909e-01   +4.099509360998040e-01   +5.017298571219448e-01   +3.312597588339393e-01   +4.036657511208323e-01   -7.915488261464111e-02   +6.675808381635570e-01   +5.693759658641420e-01   +7.439254530217918e-01   +7.144339079855225e-01   -1.780130123431424e-01; +7.545934655022061e-01   +2.496554450523830e-01   +5.235399026584604e-01   +3.652634458609529e-01   +9.991748886763916e-01   +2.072185611951578e-01   +3.932064565625550e-01   +1.143715202582428e-01   +5.738541790061358e-01   +3.976129572851215e-01   +6.024964271809516e-01   +6.571896684801569e-01   +8.625305883887358e-01   +5.307584507842693e-01   +7.121995714783804e-01   +2.138202454438483e-01];
L2I_L1I_iGABA_netcon = [+8.167626679606482e-01   +6.560022526956035e-01   +6.145923481818470e-01   -2.988609953870093e-01   +1.590506714805286e-01   +5.721342028571418e-01   +2.736218254665083e-01   +1.379981263194050e-01; +8.966375026720386e-02   +6.468058707863936e-01   +6.779706813437173e-01   +2.658824716367764e-01   +3.034152363054766e-01   +7.315425848332031e-01   -1.631049174060549e-01   +3.181057941393639e-01; -6.479637932437020e-02   +4.244465974781303e-01   -2.174923339231049e-01   +6.639699738434280e-01   +2.958726488581107e-01   +6.569485483563967e-01   +5.543098695387110e-01   +6.688447819832962e-01; +1.000000000000000e+00   +6.191596231813583e-02   +3.792548337666833e-01   +1.652513335412659e-01   +7.707588055838535e-01   +4.463027830083863e-01   +4.762089701630424e-01   +3.939716404168485e-01; +2.759513525217974e-01   +2.880177149668694e-01   +5.396751870276429e-01   +2.048043956618064e-01   +9.774034980381042e-01   +1.688917912241794e-01   +3.682961390594870e-01   +2.591635364938602e-01; -7.878855550733767e-02   +7.631161044091564e-01   +1.114181916826470e-01   +2.454162762805639e-01   +5.768966929713014e-01   +3.682376430206948e-01   +3.030007868774709e-01   +8.198196509316369e-01; +6.849594405217611e-02   +8.996511626352043e-01   +2.977564676332157e-01   +6.612826320622931e-01   +5.857735222899372e-01   +1.247861174388923e-01   +3.618473985945092e-01   +7.222077200146798e-01; +6.644057120435279e-01   +2.173066431879986e-01   +3.279743082345916e-01   +8.090721892072413e-01   +7.003975857313472e-01   +6.643231409717977e-01   +6.757050430794276e-01   +4.321514003172291e-01; +9.705150498609885e-01   -2.176315513925416e-02   +5.863693430184582e-01   +7.418366827630946e-01   +5.613529311463107e-01   +5.133117484093913e-01   -1.972888592972639e-01   +2.811406317723523e-01; +6.327022410311700e-01   +5.598178501868474e-01   +1.441043578134359e-01   +6.770923242509882e-01   +1.540357973527009e-01   +8.092812477857724e-01   +8.599174567562635e-01   +8.457628295884655e-01; +2.224323343751597e-01   +4.829963668572926e-01   +4.790069441941259e-01   +2.946583677634950e-01   +9.393264704701016e-01   +6.121736761007742e-01   +2.608410681640841e-02   +3.856827182639799e-01; +3.644252645465758e-01   +1.631599777173179e-01   +7.965032768057846e-01   +4.008337917903926e-01   +5.240059588693791e-01   +2.632490806621831e-01   +4.279202995084705e-01   +2.351399553767352e-01; +1.460973920076275e-01   +8.923706724822972e-01   +8.198765082298742e-01   +4.121116604917147e-01   +9.598740113594745e-02   +3.175616845653532e-02   +1.834134280402300e-01   +7.065850401847026e-01; +1.437804309996372e-02   +4.136760148365961e-01   +9.866178020299379e-01   +4.829122189521650e-01   +5.768629421656092e-01   +2.166334662181704e-01   +7.065826544906484e-02   +7.751369067326497e-01; +3.349041261183187e-01   +8.947010859381435e-01   -1.990522154538995e-02   +3.408868620363191e-01   +3.885625961232542e-01   -8.202123699854465e-02   -1.590169182624428e-02   +5.614979679184193e-01; +8.231089822181786e-02   -1.212362484573616e-01   -9.107619809736010e-02   +3.935436938868736e-01   -3.160903394165784e-02   +4.939521308661664e-02   +2.479329711723341e-01   +2.984043367505464e-02];
L1I_L2I_iGABA_netcon = [+6.465131126899096e-01   +5.399553698703712e-01   -1.678305574215177e-01   +2.404232379509608e-01   +7.453458894782743e-01   +3.267470067932786e-01   +2.379627092517595e-01   +2.554204950900076e-01   +3.771287635421194e-01   -1.726223682757623e-01   +4.658502807971063e-01   +5.025998227903899e-01   +5.251493211934697e-01   +4.355823149448383e-01   +5.762539857655178e-01   +6.895688225594698e-01; +7.035685033758124e-01   +7.052351105885238e-01   +5.658788925857725e-01   +3.432303714352132e-01   +6.217166936199007e-01   +4.369280640008780e-01   +4.198743187763730e-02   +1.045029274211894e-01   +2.387399185151696e-01   +5.610581784770895e-01   +1.442401411268788e-01   +3.473498158933185e-01   +5.541099898461155e-01   +4.531010504373496e-01   +6.250599824129113e-01   -1.095747892990184e-01; -1.200286191601594e-01   +3.595848500321872e-01   +7.318966734670683e-01   +4.641268443898547e-01   +1.312331526205196e-02   +4.138084053109251e-01   +3.154474587439614e-01   +1.000000000000000e+00   +2.654240514790258e-01   +3.760997407163418e-01   +1.166156490178817e-01   +7.985328872143567e-01   +6.719649299767064e-02   +1.678540256041739e-01   -2.290753369696379e-01   +4.586093808429222e-01; +4.349793356365542e-01   +3.060300239229450e-01   -1.692260689922032e-01   +1.140274125461738e-01   +4.376034957292117e-01   +5.933790755239688e-01   -6.380004930740962e-03   +2.615312911798385e-01   +2.655795461080259e-01   +7.295400580761048e-01   +7.249634579672369e-01   +8.152174014084410e-01   +5.103775417936073e-01   +6.390971491318630e-01   -7.447293285260362e-02   +8.942013624491412e-01; +8.500294026361035e-01   +6.039043882312076e-01   +9.424854186047997e-01   +6.724550384917106e-01   +5.317114299792439e-02   +7.620949839164927e-02   +5.944712135570104e-01   -7.711174766330096e-02   +4.901528065318994e-01   +1.064953254162248e-02   +4.494636672586140e-01   +3.867829098562228e-01   +1.211931167994098e-01   +8.313860877503487e-01   +4.847735209898825e-01   +5.896761809454935e-01; +8.671070144348366e-01   +3.964363226091273e-01   +2.522194709316941e-01   -2.082622718745498e-01   +3.040178486258135e-01   +3.993078661761354e-01   +3.637679715618047e-01   +6.374415587147904e-01   +8.028962762241074e-01   +1.628417796979294e-01   +3.420931870951410e-01   +5.946209419601004e-01   +6.375010991990204e-01   +5.072804137427659e-01   +5.302400563829612e-01   +4.939137498185045e-01; -1.233121595245912e-01   +3.814161069566335e-01   +6.507045050376795e-01   +4.529112646552855e-01   +1.159896657570696e-01   +4.420046118012987e-01   +3.966516713687938e-01   -1.446019367617465e-01   +7.169959787335526e-01   +3.172775675223143e-01   +7.937046225954134e-01   +9.706037228701132e-01   +3.406756470999143e-01   +3.553837644758335e-01   +7.838958690200113e-01   +4.587803833244526e-01; +5.707531956507761e-01   +4.330587498562814e-01   +3.234051225112573e-01   +6.530548996354372e-01   +2.154580887285203e-01   -2.650749587020947e-01   +9.452801661232221e-01   +3.315616965140147e-01   +6.547220575562880e-01   +5.313440907717588e-01   +7.038621290136826e-01   +4.774234123246963e-02   +9.258362146249374e-02   +2.594568379613874e-01   +1.178066973613437e-01   +9.267445558296034e-01];
L2E_L1E_iAMPA_netcon = [+5.653526500729024e-01   +3.177528891521514e-01   +4.103610950347392e-01   +4.794638210552329e-01   +5.045510152947141e-01   +4.975839343044728e-01   +2.274628409528956e-01   +4.851808229585862e-01; +1.725601954032252e-01   +6.895933791180544e-01   -1.716035434828717e-01   -2.228849622064624e-02   +6.330429116344887e-01   +6.556030082912238e-01   +1.420887269196910e-01   +1.736431734120722e-01; +3.412552247038894e-01   +8.647316118755134e-01   +5.684329670697108e-01   +7.154790127912970e-01   +1.936159136978432e-01   +7.989790218686743e-01   +2.492506634774168e-01   +3.854291902213982e-01; +4.067976755657586e-01   -1.383643454403616e-01   +8.605314670054955e-02   +8.692958416271256e-01   +2.749372597125435e-02   +1.682597582340362e-01   +4.027389352594856e-01   +4.859249185908955e-01; +3.822699161987721e-01   +6.080165186976715e-01   +2.194907551991130e-01   -9.427078132835076e-02   +3.732460587686913e-01   +6.209918105906526e-01   +1.047542194821860e-01   +1.948836640038188e-01; +3.275256542687663e-01   +3.243757378741922e-01   +6.616292190734442e-01   +4.492178874163786e-01   +4.373973841717815e-01   -4.702436628611817e-02   +2.310112437516749e-01   +8.777997034909357e-02; +3.550377599300767e-01   +5.806818702586611e-01   +6.996467436267905e-01   +8.456651189085377e-01   +3.872352790001818e-02   +1.603531405685931e-01   +5.315782749989908e-01   +1.000000000000000e+00; +1.596405458030031e-01   +3.200480282311416e-01   +2.252715887903191e-01   +5.019002764172268e-01   +1.741589809878130e-01   +9.275074980009690e-01   +7.921247038102012e-01   +4.602139685034518e-01; +2.766556450777861e-01   +5.100472460909034e-01   +2.957513262723565e-01   +8.488060070868209e-02   -3.257271998040457e-01   +5.423147119746615e-01   +9.167111487921129e-01   +5.181286234201142e-01; -1.233803088388705e-01   +1.865185697598251e-01   +3.196815162741206e-02   +3.632938974023834e-01   +4.608093640197071e-01   -2.000169174056019e-01   +6.480818595057314e-01   +7.310031166865296e-01; +1.767896989953938e-01   +6.847182160038302e-01   +1.264490377148957e-01   +9.158176204853244e-01   +4.877557218460605e-01   +8.383211038675843e-01   +2.443940839265875e-01   +3.276698947080317e-01; +3.121642661916584e-01   +4.796112823541894e-01   +1.424088547587310e-01   +9.976836380323807e-01   +5.547083287406237e-01   +5.046025277688114e-01   +4.328717215012289e-01   +3.240560028336157e-01; +2.808483104852975e-01   +7.218951874978923e-01   +3.775842887845254e-01   +6.078364569868672e-01   +5.853016749545960e-01   +3.345125340806205e-01   +2.476693433850246e-01   +5.351642237618703e-01; +3.330291803239253e-01   -8.112700362439740e-02   +2.003247898464428e-01   +2.621351225382488e-01   +3.501209402967428e-01   +3.325380512538995e-01   -1.663174669294986e-01   +3.730758030923619e-01; +4.715712084449748e-01   +6.073174035624292e-01   +2.669223865176631e-01   +2.900459812768069e-01   +9.500495719703511e-01   +4.176348954447539e-01   +6.114947951973382e-01   +7.952569078914913e-01; -1.880714367185114e-02   +4.920800266017666e-01   +6.464702671344186e-01   +3.228205331313486e-01   +5.033224506081038e-01   +5.901157112477593e-01   +1.264619640282585e-02   +6.978479830608634e-01];
L1E_L2E_iAMPA_netcon = [+2.492037351560404e-01   +8.890384355178263e-02   +3.583746429309307e-01   +4.574045855057300e-01   +5.975994502537939e-01   +9.752368311289725e-01   +2.902068302910040e-01   +8.585362930394601e-02   +3.135162985867020e-01   +6.367978078650030e-02   +8.094446464446166e-01   -1.887440834572006e-01   +5.220759456554501e-01   +1.233766124814920e-01   +2.210461911667609e-01   +7.913393933830156e-01; -1.660734157085628e-01   +5.463006510567280e-01   +4.209459412393103e-01   +6.032907809253708e-01   +8.415779665069093e-01   +3.277499212257173e-01   -1.444212007660961e-02   +7.860865229227203e-01   +3.745042188775248e-01   +7.882909572873615e-01   +4.593304938471376e-01   +4.014546944282694e-01   +6.972987323839633e-01   +8.222902987822392e-01   +2.270527006100613e-02   +4.656185237946213e-01; -6.819041920192186e-02   +5.012232527208731e-01   -3.847138020384262e-02   -1.146946245226707e-01   +4.595624959310186e-01   +7.336198107756000e-01   +1.677029584063541e-01   +9.870318800393231e-01   +5.136543610762612e-01   +3.822115456868286e-01   +1.217278414350601e-01   +4.624793931750538e-01   +3.846523703166073e-01   +2.349361687101194e-01   +2.031728539987865e-01   +6.046331399193730e-01; +5.762327390426910e-01   +1.000000000000000e+00   +8.551741335596742e-01   -1.011048061587470e-01   +4.279533826518032e-01   -1.982139503962552e-01   -1.306820635359890e-01   +8.211327153309650e-01   +2.932914868481443e-01   +2.328526757536325e-01   +2.943300235885946e-01   -1.535908939170189e-01   +3.725865385476825e-01   +7.172632624041678e-01   +5.952157184170639e-01   +2.634474980743379e-01; +1.925695741051900e-02   -1.986474994177632e-01   +1.650482625337579e-01   +4.257664680585238e-01   +4.945066215849382e-01   +2.269960003403229e-01   +8.932176372883205e-01   +3.396543670075231e-01   -3.682575848421363e-02   +3.846774404669353e-01   +2.930334452702462e-01   +6.758618319148892e-01   +1.807767641388796e-01   +5.998917751395174e-01   +6.626863544521785e-01   +3.992449404430728e-01; +1.312340570548907e-01   +6.105038053083787e-01   -2.821436161464541e-01   +4.056720275857389e-01   +3.297689626762667e-01   +3.864710016738991e-01   +2.575089960126771e-01   +6.095473968205627e-01   +1.289774689507194e-01   +4.898478269532698e-01   +7.029833074797161e-02   +7.643177049452636e-02   +3.113186557325412e-01   -5.363248754892657e-02   +6.309659458936805e-01   +4.708617910016818e-01; -2.237697522982939e-02   +1.015632821307034e-01   +7.001921139041648e-01   +2.831780413800707e-01   -1.995474552524724e-01   +5.998835563407749e-01   -1.549206641641220e-01   +5.750622595852540e-01   +8.822872694464733e-01   +7.425388922190879e-01   +1.122269346136979e-01   +5.410140240527451e-01   +4.401013485102003e-01   +7.902436359650866e-01   +6.506610941015921e-01   +4.168941286146256e-01; +7.062009770590213e-01   +5.594388819053734e-01   +3.917094454495756e-01   +4.643865783494630e-01   +6.377892530287185e-01   +3.646419441323746e-01   +1.955538154145086e-01   -2.508299886546552e-02   +3.708681164873750e-02   +2.633369157984641e-01   -6.785994101562887e-02   +5.324095157963370e-01   +3.678687207542461e-01   -5.535903020236085e-02   +7.130690488595138e-01   +7.934563220721012e-01];
L2I_L2E_iAMPA_netcon = [+4.103868204459609e-01   +2.365765971126038e-01   +3.348919674268823e-01   -1.786887293172478e-01   +3.288416313526336e-01   +5.229312527725789e-01   +4.441244662269949e-01   +1.167752828313641e-01; +5.729560342129487e-01   +5.369806586665046e-01   +4.732826460847755e-01   +2.709608745927692e-01   +3.703982548609505e-01   +3.655635624461742e-01   +5.866529931612611e-01   +4.144577258649541e-01; +5.641438304032740e-01   +9.100837432344716e-01   +5.690432562537016e-01   +1.845053216854804e-01   +5.797609459601516e-01   -2.913619996132141e-01   +2.469373495358085e-01   +1.780249127050287e-01; +1.084955422692061e-01   +5.251203722606365e-01   +2.621293700450359e-01   +4.918205693590180e-01   +1.662068869151922e-01   +5.667923008846169e-01   +5.821188348159224e-01   +7.793030467895115e-01; +2.733606865732111e-01   +1.311605706835325e-01   +4.330239507967465e-01   +1.712682204477811e-01   +6.251489258153099e-01   +5.803277362207120e-01   +3.487195000464290e-01   +6.864952738672048e-01; +6.428090139905618e-01   +3.282795637285910e-01   +7.294169611960402e-01   +2.915629181924277e-01   +1.012643628503043e-02   -6.196214161387944e-02   +2.500616378561581e-03   +9.575652593684124e-01; -3.271726652424815e-02   +5.866795642757930e-01   +7.448192308779014e-01   +6.704996159852116e-01   +9.677921341858510e-01   +8.332819743352718e-01   +6.791558727480410e-01   +3.552785067836266e-01; +8.772292945274262e-01   +3.426147916360744e-01   +1.000000000000000e+00   +5.253046597384157e-01   +1.121655206278271e-01   +3.589319721964698e-01   +5.787694157769627e-01   +4.760130754709139e-01];
L2E_L2I_iGABA_netcon = [+3.669079368849404e-01   +4.543254404979427e-01   +2.081327346705331e-01   +1.970709424110205e-01   +3.569055294376018e-01   +2.724251904105149e-01   +2.331189843147153e-01   +1.991739161778588e-01; +6.239706060879981e-01   -3.781115466083851e-02   +2.116508440066031e-01   +1.029478847645904e-01   +5.705310077911252e-01   +1.787323076897016e-01   +5.301141597808289e-01   +2.654613407676590e-01; +2.805196771592683e-02   +5.028575216595084e-01   +6.567631356266845e-01   +5.081447014221359e-01   +5.854043021513125e-01   +3.317352336839202e-01   +3.957201357316245e-01   +2.634988044137987e-01; +5.679444749958236e-01   +2.077600474338154e-01   +1.036044472122292e-01   +3.668685814557839e-01   +4.313833108824328e-01   +7.015163733831546e-01   +6.007228570880609e-01   +4.459309679873626e-01; +6.028357479811615e-01   +3.557177512492970e-01   +3.459077697291975e-01   +4.360786072286093e-01   -1.378891354727225e-01   +1.392478638257231e-01   +1.331899512274173e-01   +4.636480601084805e-01; +6.879931529848595e-01   +1.141069237400203e-01   +1.344926884885372e-01   +7.840828853358769e-01   -2.129251886896888e-01   +6.433044368994922e-01   +5.064088913206615e-01   +1.209255140954277e-01; +3.727290475540046e-01   +2.146865803838287e-01   +4.504956188245187e-01   +3.472006351684207e-01   +2.600352776639562e-01   +5.503599771573979e-01   +4.620858894594196e-01   +2.583552106889239e-01; +6.306472635086649e-02   +2.388913232847127e-01   +8.283606946605755e-01   +1.179008093122949e-01   +7.520484983866869e-01   +5.231355040809929e-01   +5.509896015324267e-01   +4.235486426060570e-01];
L3E_L2E_iAMPA_netcon = [+3.498422740300228e-01   +2.665597435360340e-01   +4.366109520123835e-01   +8.802929129396481e-02   -1.174593981462184e-01   -2.690241063745882e-03   +1.565438148779304e-01   +6.570918083835641e-01   +6.673932395688998e-01   -2.280005372439949e-01   +5.349224104275241e-01   +7.209017870612412e-01; +3.619567823928200e-01   +4.228857404958575e-01   +6.263728557468620e-01   +1.544573101978962e-01   +7.614463655140121e-01   -1.433976416773725e-01   -1.128685955671172e-01   +2.303171883197792e-01   +7.585791385215591e-01   +1.253971587824009e-01   +5.958743987786560e-01   +2.194468960350084e-01; +5.347246223486914e-01   +2.490573940053132e-01   +3.273186996795463e-02   +4.984183950994118e-01   -2.048152769596975e-01   +4.236525349755917e-01   +3.523927393748696e-01   +5.658804441401625e-01   +6.860005719728182e-01   +5.994251111838240e-01   +3.806868686953475e-02   +5.222974068350303e-01; -8.195804935229598e-02   +2.583418150057045e-01   +2.003311630170856e-01   +8.949716533159400e-01   +6.469030078416641e-01   +2.511817785023246e-01   +2.803643570742411e-01   +7.508950658061427e-01   +5.409801861634830e-01   +5.241042852385486e-01   +3.136476332968531e-01   -5.843797425837311e-02; +6.377850720748335e-01   +4.737956249973737e-01   -2.174064324094666e-02   +7.628335675638943e-01   +4.115985707920636e-01   +1.939909065359447e-01   +2.037292560331616e-01   +2.633680071915458e-01   +1.584158121220927e-01   +2.959678718146284e-01   +1.539828731244606e-01   +5.952847822908900e-01; +8.382417910350720e-01   -4.856598719381874e-02   -5.581065082899429e-02   +8.711805561181655e-01   +5.665973420504746e-01   +7.083293502967886e-01   +1.301449061640691e-01   +1.581433731366440e-01   +7.062344720654361e-01   +5.458123087050626e-01   +1.050361508533777e-01   +1.479571564912109e-01; +2.542921528593282e-01   -2.508029491885252e-01   +2.900647863795979e-01   +3.736067354901122e-01   +4.281248803599006e-01   +3.189549496825832e-01   +8.271380811200825e-01   +8.935787779945499e-03   +8.880794171355395e-01   +4.486397252994216e-01   +4.814618121141239e-01   +5.934986609764821e-01; +6.184082649044157e-01   +8.764165039268329e-01   +6.883467639458033e-01   +6.582373620946074e-01   +1.415747955062140e-01   +5.338165420105078e-01   +1.000000000000000e+00   +5.274846375398518e-01   +8.157781056758741e-01   -3.125411006644053e-01   +9.954234659614865e-01   -1.809123316203921e-02];
L3I_L2I_iGABA_netcon = [-9.425542746203140e-02   +4.333038929655527e-01   -2.122851390714803e-02   +3.433181698210619e-01   -8.561255957431937e-02   +6.042149750477954e-01   +9.926182895156122e-01   +4.698744295683351e-01   +4.015536483337223e-01   -1.051333284160441e-03   +5.241188820356110e-01   +3.366647263454479e-01; +7.868722425325450e-01   -2.430778357891567e-01   +2.965464615744884e-01   +6.942984197719856e-01   +1.489876048914756e-01   +8.213775491496597e-02   +6.599685909088073e-01   +6.399050901344044e-01   +5.788745620696417e-01   +3.220941025413383e-02   +6.390509987960713e-01   +4.513301232313013e-01; +4.212539224715024e-01   +4.584704375103834e-01   -2.990099953661494e-02   +5.828602965585464e-01   +9.763564924086359e-01   +6.835248250019552e-01   +3.591842024325684e-01   +3.664819350687119e-01   +1.723179533538534e-01   +1.664752441547920e-01   +8.316732466749619e-01   +6.628526494672969e-01; +3.303388675095622e-01   -8.853285784021704e-02   +6.942919213856862e-01   +2.714326626009104e-01   +6.146773566224681e-01   +5.539327474452439e-02   +1.199028657724720e-01   -1.848150572656868e-01   +4.022011999561345e-01   +1.173969942151804e-01   +4.483742708692055e-01   +6.112088029830416e-01; +4.677488866197227e-01   +5.778451142810748e-01   +6.306461151783427e-01   -2.834999821734035e-01   +4.084713604546331e-01   -1.466400152026702e-01   +1.811446594629495e-01   -2.134389942114434e-01   +5.029898280604996e-01   +6.770579290466799e-01   +8.245552347846428e-01   +2.892414887893044e-01; +9.273471256127740e-01   +6.421384857434093e-01   -1.345883403239731e-01   +3.104491487500169e-01   +6.149041141597231e-01   +1.000000000000000e+00   +3.611724559874168e-01   +5.589592977147975e-01   +6.526201099099777e-01   +1.404436693789748e-01   +9.384281193218287e-02   +6.354978196155471e-01; +6.317959392247458e-01   -9.698672579615149e-03   +2.958293525953666e-02   +7.089665092795390e-01   +7.678219217112360e-01   +4.971359692196843e-01   +3.214615818855711e-01   +2.507967508092747e-01   -6.343777337394244e-02   +3.534843385572737e-01   +3.055990687930134e-01   +2.664717594964286e-01; +6.076398859045750e-01   +7.528260678331374e-01   +6.469232274292487e-01   +4.929336699892288e-01   +3.586777038590388e-01   +5.758213483774012e-01   +3.398823726034882e-02   -4.263212892389192e-02   +2.849477398978510e-01   +6.900939452129663e-01   +5.957120591942977e-01   +3.186119808150212e-01];
L2E_L3E_iAMPA_netcon = [+6.069840566839875e-01   -4.548334912297142e-02   +3.235910335833728e-01   -7.722824637160708e-02   +3.001008029203306e-02   +4.400407636694820e-01   +7.519844228107100e-01   +5.232167914876525e-01; -2.658843726082553e-02   +2.164810204376714e-01   -2.618229164290117e-01   +4.912872540381715e-01   +9.036066529135098e-01   +6.617258519250018e-01   +9.075790626262603e-01   +1.773659557110494e-01; +7.942463287818113e-03   +3.003158522532882e-01   +6.049671885733375e-01   +3.238607788628105e-02   +5.435901244793709e-01   +7.022190748322650e-01   +3.486986917039880e-01   +4.002792762728241e-01; +5.716714983264968e-01   +8.026616396315780e-01   +9.175366462795326e-02   +7.250880583185544e-01   +5.098195173947460e-01   +1.724504740345140e-01   +1.590367489809953e-01   -7.021129422062694e-02; +5.970184613710570e-01   +5.925050099924077e-01   +8.610711055372019e-01   +6.352821217682960e-01   -1.863387506317799e-01   +1.131435156363818e-01   +1.842694852261457e-01   +5.057622590790387e-01; +5.438483873571220e-01   +8.439714716334281e-01   +4.819527810525329e-01   +9.974287300060144e-01   +9.492348452038074e-01   +4.475959119545484e-01   +4.633347617774515e-01   -6.662599095939252e-02; +8.582820109210897e-02   +3.993957661831816e-01   +9.113501601793483e-01   +6.519035903539594e-01   +3.657687928952587e-01   -1.723086233730078e-01   +5.648891399660136e-01   +5.416961799799973e-01; +4.667508687927036e-01   +4.381905365280556e-01   +9.911599188652634e-01   -2.404230489279594e-01   +2.304370992426519e-01   +1.081418776831450e-02   +1.341865151536643e-01   +2.849322448429873e-01; +4.244148777857329e-01   -2.303720512660472e-01   +1.167312129682210e-01   +4.112396848925781e-03   +3.580271870695795e-02   +4.738304380009701e-01   -8.896425568947439e-02   +7.936306985970451e-02; +8.555677559556337e-01   +7.426823753801262e-01   +4.223340939061081e-01   +3.018255117151023e-01   +3.789651522497657e-01   +5.624691034697727e-01   +5.301402605256498e-01   +8.924836067651831e-02; +3.856257951540418e-01   +8.127453928486240e-02   +5.548255193900833e-01   +7.544567985935909e-01   -5.097186348786156e-02   +7.562863680199038e-01   +4.660618060828355e-01   +1.608900270459427e-01; +4.188162131075264e-01   +2.479202135745102e-01   +7.541553654035432e-01   +2.071950976361937e-01   +8.093017277099634e-01   +2.782670437870868e-01   +4.831308157257702e-02   +7.600287419304874e-01];
L2I_L3I_iGABA_netcon = [+6.803945467828357e-01   +4.207300898046831e-01   +4.426370020237221e-01   +5.111354580146059e-01   +2.536847434103718e-01   -5.899080733275641e-02   +4.081707300606784e-01   +5.012840287117133e-01; +2.847378133178753e-01   -3.126353708013949e-02   +2.597387228456085e-01   +3.498406796174145e-01   +5.409333401554181e-01   +5.313638130698956e-01   +3.022995219622959e-01   +5.124794553156016e-01; +5.876427600704707e-01   -2.795174582233010e-02   +1.346804963448918e-01   +5.749009706359824e-01   +5.144727204188747e-01   +2.933801168928808e-01   +1.000000000000000e+00   +2.318927154040217e-02; +1.684013585101806e-01   +5.208232966039077e-01   +2.361867232177360e-01   +1.930477785215381e-01   +3.639266176683643e-02   +5.988371314917709e-01   +8.172290511113557e-01   -1.312163504133607e-02; +5.858674609717763e-01   +9.064636516885874e-02   +4.453762098473988e-01   +4.640829290656103e-01   +6.657855877760792e-01   +4.295713387065789e-01   +6.452335206071267e-01   +3.974897449528507e-01; +3.601730567987929e-01   -6.168798323087112e-02   +5.827668256620107e-01   +6.001611036715492e-02   +7.456586592538856e-01   +5.493259241725600e-01   +3.595945617522936e-01   +5.600734691606434e-01; +7.963588341551862e-01   +3.042863601265862e-01   +3.930598463077298e-01   +3.627335739540811e-01   +3.186926783366593e-01   +2.819111511584851e-01   +1.474305540597347e-01   +2.043615739288262e-01; +4.610130576733615e-01   +9.168887935432591e-01   +1.630538141983894e-01   +7.256501009314940e-01   +6.442903861011051e-01   +2.847425121132222e-01   +5.400127797361741e-01   +7.088022614141996e-01; -3.102693251252091e-02   -2.126586764529351e-01   +4.743479248374117e-01   +4.397073340727718e-01   +5.095329263690031e-02   +1.657453407762819e-01   +5.104740280368356e-01   +4.032365287649912e-01; +8.664477217114561e-01   +5.109253712682449e-01   +9.553672479795682e-01   +7.766032721001744e-01   +3.662646432977880e-01   +1.407627602924314e-01   +4.199730905192678e-01   +4.846445833541423e-01; +5.190259456189589e-01   +5.083850646008239e-01   -6.544476682875336e-02   +5.979982951142675e-01   +4.817484478461437e-01   +4.188132439450732e-01   +2.485391870318501e-01   +6.173887048673830e-01; +5.049544599500846e-01   +6.025713908650687e-02   +1.926112116395927e-03   +2.899538864931506e-01   +9.184211321635340e-02   +9.066946188494570e-01   +4.430281955891152e-01   +4.855496875054913e-01];
L3I_L3E_iAMPA_netcon = [+4.141121868701100e-01   -6.473859460363884e-02   +9.109463863082231e-01   +3.971604606818228e-01   +7.747392968680236e-02   +7.136108483110343e-01   +4.968442278746897e-01   +3.349735896657993e-01   +2.453836711064276e-01   +7.314698627519238e-01   +7.193410580539600e-01   +5.048419952436467e-01; +9.188123448442493e-01   -2.090452310228030e-01   +2.446896609379098e-01   +9.171408745714128e-01   +2.493193710432063e-01   +3.835224442501890e-02   +8.117943592143514e-01   +9.716429360792018e-01   +7.235795269892092e-01   -1.549507617997443e-01   +1.460933694230262e-02   +1.611207532304272e-01; +9.843481082115527e-01   +7.955295819657344e-01   +6.362425950338173e-02   +3.121857100629334e-01   +5.891562952909895e-02   +5.858608186616119e-01   +1.194690771796221e-01   +1.879395139113743e-01   +1.489800338729227e-01   +1.154230469770688e-01   +4.225432984732105e-01   +2.801049123105473e-01; +3.799500211598348e-01   +4.703899014033252e-02   +7.398214064684502e-01   +5.115059026026152e-01   +5.255423703095016e-01   +5.248125353536780e-01   +7.368684006034354e-01   +5.910819016106421e-01   +4.543865056264851e-01   -5.676147263498629e-02   +2.809153458969731e-01   +5.107424067776890e-01; +6.918533676200425e-01   +3.202041914693979e-01   +7.069500923880762e-01   +3.614413370355493e-01   +7.617552556588646e-02   +7.099310902145468e-01   +2.805731142847514e-01   +2.090963222094140e-01   +5.722790579383336e-01   +7.470008871475518e-01   +1.241048432614644e-01   +8.037841717000849e-01; +7.902761566143264e-01   +3.853615556319348e-01   +5.250420329551433e-01   +7.641481229580632e-02   +9.586715520156842e-01   -2.120382965304951e-01   +5.343447633310725e-01   +3.162845204955381e-01   +2.147968184104579e-01   +4.939587396320014e-01   +4.705034599513965e-01   +5.015114174330841e-01; +5.068458719294220e-01   +5.357545820523435e-02   -3.306428607183469e-02   +4.533956539575675e-01   +3.907211761192358e-02   -3.819348704664095e-02   +3.816695051406493e-01   +4.484574643937503e-01   +3.962412159834245e-02   +3.646734938653586e-01   +1.000000000000000e+00   +4.207128437240791e-01; +1.391938083757890e-01   +8.040730278526500e-01   +4.607940864329819e-01   +6.295917288783238e-02   +1.287559268528406e-01   +9.158813708859381e-01   +6.454041559356927e-02   +6.163236963675393e-01   +4.660798019455586e-01   +2.888834190186991e-03   +3.795581840266273e-01   +7.482465222900883e-01; +7.069667215081799e-01   +5.461321807286055e-01   +2.681259509145278e-01   -1.122372447908209e-01   +3.958809156555405e-01   +3.011654068417151e-01   +7.746286707458628e-01   +9.417935603408090e-02   +1.369069704222170e-02   +7.462317254305385e-02   +4.042263112976547e-01   +8.082174554627654e-02; +5.561986816871948e-01   +4.990205693682947e-01   +3.892260756188588e-01   +4.834222454918436e-01   -2.174354631925182e-01   +2.242160071738691e-01   +6.007678431330055e-01   -1.205682718693592e-01   +2.403335607318690e-01   +7.091265460534236e-01   +6.044917945957520e-01   +5.714716014472027e-02; +4.268077608373299e-01   +7.059778795666047e-01   +2.304322511228626e-01   +3.683798959645895e-01   +1.714052699729706e-01   +3.977949272007317e-01   +1.150049092065431e-01   +7.635328408793657e-01   +7.271316783304589e-01   +3.251026931641453e-01   -1.973061934651938e-01   +3.001612876543949e-01; +3.762998414630524e-01   +6.480128014337451e-02   +1.360689407032169e-01   +5.043248085662428e-01   +3.023244158869270e-01   +9.665655236304789e-01   +2.445890306927929e-01   +6.561075772232104e-01   -1.764478729145109e-01   +6.298730212067888e-01   -1.114295677577001e-01   +6.645338822059905e-01];
L3E_L3I_iGABA_netcon = [+1.685361915923409e-01   +3.311192716446306e-01   -2.135370800943193e-02   -3.488339744154966e-01   +5.762722169268732e-01   +1.232363993387007e-01   +7.683854611216415e-01   +1.837683463397951e-02   +4.562668114265943e-01   +4.553445475179039e-01   +6.455596921713846e-01   +6.680687049954852e-01; +3.561974894604211e-01   +6.331370478779463e-01   +5.088928191742378e-01   +7.454159501831069e-01   +1.980178152978601e-01   +2.322285543964910e-01   +8.347912961483109e-01   +1.887594568044932e-01   -1.893089086081763e-01   +1.713118056929405e-01   +7.328342975472903e-02   +1.015965895364069e-01; +3.007767473576534e-01   +3.741822378990765e-01   +5.477766235212432e-01   +2.369123900269153e-01   +6.619732333925730e-01   +2.743194375433809e-01   +8.396329052401927e-01   +5.053458257606923e-01   +4.433894604567566e-01   +1.462715607907867e-01   +4.764031469011566e-01   +2.308803084871945e-01; +1.126509841726896e-02   +2.799264218625356e-01   +2.996278830562603e-01   +2.727726262212865e-01   +1.317393052435034e-01   -4.890634896175802e-02   +5.441999863834420e-01   +7.681685552440991e-01   +4.024869434780755e-01   +4.372715888673179e-01   +3.890282200693708e-01   +4.289800143680584e-01; +9.173743908290363e-01   +6.458739094632454e-01   +3.437050116800376e-01   -7.837529734073741e-02   +2.805737507089032e-01   +4.967720860924654e-01   +6.447474318992424e-01   +4.291610518801107e-02   +9.192130440756550e-02   -3.030698827661930e-02   +1.643876044051047e-01   +4.954868541403419e-02; +6.816409891230653e-01   -2.421250622399577e-01   +2.169839623794106e-01   +5.181407089803464e-01   +9.475788000234769e-02   +2.983183676758577e-01   -1.883250589908505e-02   +5.858309497421872e-01   +1.299661503721982e-01   +6.596629241155509e-01   -2.116523571973285e-02   +5.257249166497705e-01; +3.916347006821183e-01   -1.584439651125863e-01   +7.788144993411363e-01   +3.897383918000438e-01   +3.003029797110613e-01   +2.948958715245836e-01   +2.852662882331332e-01   +6.310104287697991e-01   +2.892162098148316e-01   +9.526424594204510e-01   +3.293496306281541e-01   -1.102329800496814e-01; -1.879185039193449e-01   +5.337315294431492e-01   +9.445329861625149e-01   +2.930557629882798e-01   +2.568644135674368e-01   +2.652053113923581e-01   +9.138702019619178e-01   +5.926441743990410e-02   +6.210461568491962e-02   +9.912521024823104e-02   +3.246691697236397e-01   +6.992399087937385e-01; +6.401201469535847e-01   +2.478105107297502e-01   +6.357890149386133e-01   +8.015818418271479e-01   +3.693177114093469e-01   +3.142356333367619e-01   +5.207027766248983e-01   +4.148310497160130e-01   +1.659848318851266e-01   +3.420325692964172e-01   +1.421980917481224e-01   +3.898846961104350e-01; +2.050728432188185e-01   +1.656381507305375e-01   +5.757753307070506e-01   +5.919052641695675e-01   +1.501848539119592e-01   -7.591610072656305e-02   -1.454869218006636e-01   +7.662770030930710e-01   -1.057076254508965e-01   +7.211188566764845e-01   +3.622112598111379e-01   +4.747297128897659e-01; +9.280523012446547e-01   +6.218454472985163e-01   +4.578409742420474e-01   +7.205088069925817e-01   +1.286218773740238e-01   +1.957708193416791e-01   +6.309873264382920e-01   +6.368948472943720e-01   +3.249541234267500e-01   +4.917007099553857e-03   +4.686876845909359e-01   +5.996573647892789e-01; +5.029824236002294e-01   +7.138442338358042e-01   +1.000000000000000e+00   -1.171464101038299e-01   -1.694107744036055e-01   +3.942596111396930e-01   +1.145825993600798e-01   +3.600759508451515e-01   +1.597067067621451e-01   +7.552100076346179e-01   +6.655458492607484e-01   -2.365485861343993e-01];
L2E_Input1_iAMPA_netcon = [+1.758602790130005e-01   +2.237755679841301e-01   +7.789180804139539e-01   +1.027222497569863e-01   +8.527510089826422e-01   +2.825309273817941e-01   +9.758231874954981e-01   +2.544413135168725e-01];
L2I_Input2_iAMPA_netcon = [+3.710001703298037e-01   +6.736838462817294e-01   +8.145334985162265e-01   +5.002854039931608e-01   +5.784732041648722e-01   +1.186524726977465e-01   +6.673853991362907e-02   +4.373224420334706e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  33.63 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 60*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -60*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
