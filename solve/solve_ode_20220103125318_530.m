function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.430048352851536e-01   +7.521365333445346e-01   +8.997689415758556e-01   +1.704470542874753e-01   +2.024245402705799e-01   +7.459074405615821e-01   -5.178015062877547e-02   +3.844314796406893e-01   +2.949076468520819e-01   +2.365899715310395e-01   +3.856873966667685e-01   +1.769396572190973e-01   +5.097989469316704e-01   +3.013798520922987e-01   +2.390634415869935e-01   +2.366126826685973e-02; +9.363448182354298e-02   +9.752411990790033e-01   +8.613825680511941e-01   +7.780666326260698e-01   +3.461785721830178e-01   +7.223837053911355e-01   +7.190556795108037e-01   +1.161986857227617e-01   +1.126671675655571e-01   +7.421495329152544e-01   +5.429987594708546e-01   +6.527844096817343e-01   +4.750625596378857e-01   +2.699612880436493e-01   +6.770930078538134e-01   +2.590621833157154e-01; +2.555377631869213e-01   +3.126124757278330e-01   +4.116265494565957e-01   +5.595055971145403e-01   +5.633874314067604e-01   +4.059713174846716e-01   +2.064638941002432e-02   +6.558764421833242e-01   +3.041511642608583e-01   +5.212802167923724e-01   +8.552385056572217e-01   +2.326994773030971e-01   +4.648864185720140e-01   +1.510417030791634e-02   +3.711260055914553e-01   +9.528151973039193e-01; +1.837462408867282e-01   +6.332870228376430e-01   +1.108447707806665e-01   +2.455150210521479e-01   +8.849142748812542e-01   +7.785610192541630e-01   +1.940533591126385e-01   +5.719482774662964e-01   +7.689859831663705e-01   +8.210527556869612e-02   +2.173431354526512e-01   +8.575791204941496e-01   +5.339245451659920e-01   +1.518462910589859e-01   +6.052255665979605e-01   +4.471934951661607e-01; +7.035612820315644e-02   +7.316428969962872e-01   +8.340625989194788e-01   +7.388344390013520e-01   +5.272325047311149e-01   +3.378891329126399e-01   +4.706679074913983e-01   +2.510349348587378e-01   +2.632765787224797e-01   +4.961312282981101e-01   +2.140591494538359e-01   +6.474865715777498e-01   +3.724430147750376e-01   +7.723778278670610e-01   +2.485106454413115e-01   +8.761721864559229e-01; +1.113711367887365e-01   +1.853707148807107e-01   +7.508440974291933e-01   +7.642225530414318e-01   +6.049167584505163e-01   +9.031887084311407e-01   +3.325011098818930e-01   +4.014867132643476e-01   +8.438532203011040e-01   +8.726036419691681e-01   +8.664330744507381e-01   +2.353789086649666e-01   +3.734825262815996e-01   +1.660275608242919e-01   +8.516151282901444e-01   +3.617921465956399e-01; +3.161232347935216e-01   +7.474412280330867e-01   +5.452491879868340e-02   +3.593876036136588e-01   +8.511984914092015e-01   +5.326091127503857e-01   +4.765860203775649e-01   +6.159506186413337e-01   +8.921165079820529e-01   +9.431163966502211e-01   +6.646552925600037e-01   +8.160296441782718e-02   +3.650900011248231e-01   +3.536357872807467e-01   +6.900212953520517e-01   +8.706539941702000e-01; +6.917985536901846e-01   +7.242328539799517e-01   +7.466369621566101e-01   +3.594703782940801e-01   +6.473247666551647e-01   +4.637015887708739e-01   +5.634012201738525e-02   +4.052694466532407e-01   +9.937821572150186e-01   +9.010318229960913e-01   +2.014058578120420e-03   +7.247935980345243e-01   +8.211889402715117e-01   +5.574220230238170e-01   +2.747693083247864e-01   +8.446234442720525e-01; +4.997743467513858e-01   +5.992365207034698e-02   +2.755024148705467e-01   +3.844585406143852e-02   +4.836391295833858e-01   +1.151256184728731e-01   +2.026498821166088e-02   +5.591694368291914e-01   +4.565725391273219e-01   +7.575715406353766e-01   +7.586700826112943e-01   +5.588226786447836e-01   +3.038958136763379e-01   +1.650303422802704e-01   +9.822409465726011e-01   +7.303846755866601e-01; +7.005699253249590e-01   +4.986069989868467e-01   +5.587905081962429e-01   +2.713314374702761e-01   +4.497204009538019e-01   +3.569704123233773e-01   +5.641032497872024e-02   +2.596283298624534e-01   +7.074972001551764e-02   +8.018336172920193e-01   +4.487815406477989e-02   +7.981995984891375e-02   +3.282887168222109e-01   +7.203521481291058e-01   +2.927006196572607e-01   +8.318849134031318e-01; +4.166058035322003e-01   +5.661776791104100e-02   +1.204416121403342e-02   +1.385262706503091e-01   +9.412772066245525e-01   +5.739491902842628e-01   +2.637289204955299e-01   +1.825533539169320e-01   +1.762773750497121e-01   +8.537815625193759e-01   +1.061196141782625e-01   +7.375475704263247e-01   +5.243619130334347e-01   +8.332108694082846e-01   +2.687126196276505e-02   +1.135711379775939e-01; +1.672479566758200e-01   -2.395420700041348e-02   +9.475926821537579e-01   +5.094387976504754e-01   +6.668470482039511e-01   +5.216105128106414e-01   +6.996951317059529e-01   +4.178348456043468e-01   +6.159950273970664e-01   +1.263354782270377e-01   +3.588261827488546e-01   +8.066776045668673e-01   +9.132746930787219e-02   +4.751187774380223e-01   +3.808990019708485e-01   +9.809418672662951e-02; +4.721886659211921e-01   +3.462177384145431e-01   +6.422139198813659e-01   +2.676142657647606e-01   +5.618227137228821e-02   +4.561239904650621e-01   +4.677055810576450e-01   +7.116293031067702e-01   +2.525271908892772e-01   +8.801505099761460e-01   +1.303003616396925e-01   +4.383318490068374e-01   +2.042973868455356e-01   +2.163235808377770e-01   +3.159689230336626e-01   +2.244206374349540e-01; +1.034322157663365e-01   +8.777170638478057e-01   +7.677372741302798e-01   +7.084193585565800e-01   +7.703821064325463e-01   +5.622847176283368e-01   +3.272364638841884e-01   +7.607715270636518e-01   +3.831156851714496e-01   +4.408000200735843e-01   +8.784265526477822e-01   +6.167986806440308e-01   +5.735059779877749e-01   +5.320219865683030e-01   +1.379921203696522e-01   +3.612055191035396e-01; +1.342398657920343e-01   +2.434768679779915e-01   +7.026051536960018e-02   +4.192578797547668e-01   +4.233162741927471e-01   +7.872760091198325e-02   +6.539415042074406e-01   +2.905232287380719e-01   +8.424062379391857e-01   +5.095781495618965e-01   +8.361345967153894e-02   +8.559899363133291e-01   +6.481698936615790e-01   +1.841771747372556e-01   +7.074980425796901e-01   +1.397992130187088e-01; +5.532660202700107e-01   +2.782754092719709e-01   +3.082320418046240e-01   +6.265576281826551e-01   +5.366492603886592e-01   +6.031404087252021e-01   +2.695920287068485e-01   +1.057915044978457e-01   +5.857491093275549e-01   +4.584738324647862e-01   -1.972723203430390e-02   +3.873390589033507e-01   +1.838509609898742e-01   +9.232750971610194e-01   +9.150042507632520e-01   -1.721352740932628e-02];
L1E_L1I_iGABA_netcon = [-4.658161488006054e-02   +2.971016622151803e-01   +8.940133863759776e-01   +2.403057877942074e-01   +4.362359885118207e-01   +1.161703894017234e-01   +3.265362844479759e-01   +2.815459138827052e-02   +2.326539834493767e-01   +5.098755769336292e-02   +4.252753332345228e-01   +9.773293503021433e-01   +1.716829501794386e-01   +8.132785545018800e-01   +9.622411019347722e-02   +4.249529276445982e-01; +7.745728457506607e-01   +7.680777442711886e-01   +5.286268481860469e-01   +8.510563838355626e-01   +7.321586663510362e-01   +8.528193264900825e-01   +6.389773933510307e-01   +8.590005759413085e-01   +9.189076780328169e-01   +9.368839026419957e-01   +1.321134441314130e-01   +1.134916531795034e-01   +6.164490393038832e-01   +9.444620365515152e-01   +9.926810080248247e-01   +2.698753682394169e-01; +3.072705955146807e-01   +8.381014897731022e-01   +1.295045297843740e-01   +1.106177783272032e-01   +1.155316301553872e-01   +2.199476141398245e-01   +5.915301385362122e-01   -1.187233414668802e-02   +6.181980218874101e-02   +1.438621492419449e-01   +5.318929670155067e-01   +4.493789687821038e-01   +8.384622233803489e-01   +8.220154467758571e-01   +7.977466244750003e-01   +7.443615806632125e-01; +3.503625623357600e-01   +4.901217170565604e-01   +6.300385243295563e-01   +7.687410640360836e-01   +6.708784599249064e-01   +6.026909871583427e-01   +5.639831142239189e-01   +8.966307853935410e-01   +4.594730613805433e-02   +3.110399068428955e-01   +5.449712373675201e-01   +2.606135512971804e-01   +8.293729901458906e-01   +4.005712157369716e-01   +9.263416744698713e-01   +5.315879533402043e-01; +7.053371147635724e-01   +6.001528837831656e-01   +8.637416572325906e-01   +3.709970922373850e-01   +9.781545000627490e-01   +5.320694832679005e-01   +3.391856531804782e-01   +4.430231664485365e-01   +3.125322465588903e-01   +7.751785837701447e-02   +1.583910928583025e-02   +5.902135202206893e-01   +9.361683591366043e-01   +7.902004809471597e-01   +8.886769561969907e-03   +1.701888578412436e-01; +2.344398286896890e-01   -1.109218041742007e-02   +2.852424812180376e-01   +1.839690288599276e-01   -8.172419443544590e-03   +4.671690013626955e-01   +8.874132363663918e-01   +3.164114852759379e-01   +5.460698091157178e-01   +4.340719111930210e-01   +9.138720725794142e-01   +2.138739923581114e-01   +2.380330812989245e-01   +2.124177814105371e-01   +7.324563531344451e-01   +4.170799776169443e-01; +6.916787829672332e-01   +5.358870531356658e-01   +3.009790547446315e-01   +8.086337686626561e-01   +2.665818258102724e-01   +8.771197766195923e-01   +6.726410038692396e-01   +5.487363536549773e-01   +8.259015515378815e-01   +6.271919725119620e-01   +9.039686009046153e-01   +3.074325413681371e-01   +8.271818646812561e-01   +6.113524324441721e-01   +9.537820985803593e-01   +7.969665967914220e-01; +9.530023431240943e-01   +1.631164484075425e-01   +5.930940623650669e-01   +4.684647428635732e-01   +6.215946933936096e-01   +1.952676860355806e-01   +3.436203504377220e-01   +5.787872737552562e-01   +2.159364716025989e-01   +8.396455159113537e-01   +7.415743687676989e-01   +8.940467372425240e-01   +2.744509010338934e-01   +7.468181345973260e-01   +4.596926504131015e-01   +6.071084553432411e-01; +5.204950979400177e-01   +9.577865134242678e-01   +3.800177110330651e-01   +9.604375139631489e-01   +2.518482246183231e-01   +6.995741300969802e-01   +5.906996142686149e-01   +9.729363729988026e-01   +8.620930228993067e-01   +8.313655665820364e-02   +1.795410156903051e-01   +2.137526064106540e-01   +8.690806153335906e-01   +1.581676723707863e-03   +9.254312855249444e-02   +4.621636388607248e-01; +2.645189641221148e-01   +4.057812558894385e-01   +5.518113695346066e-01   +2.882335251471015e-01   +8.177583577514939e-01   +4.140038646632824e-01   +2.952296362558622e-01   +8.535191508599125e-01   +9.425004176178289e-01   +8.919487076732358e-01   +7.916378452428253e-01   +9.488905419945945e-01   +5.245967827741718e-01   +3.847024051914363e-01   +3.478471124774477e-01   +8.010244129064348e-01; +1.255011418713265e-01   +2.573139480765962e-01   +8.274745272298619e-01   +9.085968976969658e-01   +1.829204101564550e-01   +6.263821904033834e-01   +5.114563055183418e-02   +4.669116102158691e-01   +4.236124618539086e-01   +6.541961379297387e-01   +3.124400326734744e-01   +9.103067925925870e-01   +1.102466681807650e-01   +4.529293636514109e-01   +4.240216944255656e-01   +4.726731578505186e-01; +1.482441454426645e-01   +9.574306426911052e-01   +7.734444506529257e-01   +4.645522289778445e-01   +4.622052730386632e-01   +5.282069584623529e-02   +1.998359820292239e-01   +3.715042398444213e-01   +1.365017562964966e-01   +5.639424200867651e-01   +2.681313621179943e-01   +4.273152125924278e-01   +4.156043944783298e-01   +9.086495026294165e-01   +2.865339083425010e-02   +4.877416121322769e-01; +9.098728595502039e-01   +1.592889574394741e-01   +5.021694657281832e-01   +5.561657798558156e-01   +6.544881328924652e-01   +5.837900521748903e-01   +2.191096852186107e-01   +5.422406262214313e-01   +4.854385633926987e-01   +3.468208838290481e-01   +9.510535519960309e-01   +9.574395831448130e-01   +8.730633835749810e-01   +5.859887081917029e-01   +2.715106025576887e-01   +7.606090649055738e-01; +4.429243179299858e-01   +8.461972413184594e-01   +3.019602982022934e-01   +3.788812638362248e-01   +7.685647420665950e-01   +2.043424591236810e-01   +3.457530644842040e-01   +6.336892369223592e-01   +3.268240674861589e-01   +4.589135397259650e-01   +2.268390914262434e-01   +1.595017950248122e-01   +2.847029640889696e-01   +2.751291824596416e-01   +5.980492522419442e-01   +9.166279096367596e-01; +6.264784938251220e-01   +6.063458364614835e-01   +6.732878275120316e-01   +7.410897967693887e-01   +7.889716652184093e-01   +9.584482318364679e-02   +8.301358162387460e-01   +3.030560791051887e-01   +8.438366397834385e-01   +4.793753837405103e-01   +7.031602083985073e-01   +5.653223632507320e-01   +2.539717086842164e-01   +4.508783089780473e-01   +8.919511915122879e-01   +4.862906547004250e-01; +3.897001880356519e-01   +6.158164012800783e-01   +6.449788670625399e-01   +2.469755471369796e-01   +5.009611910945219e-01   +3.415708828833077e-01   +5.471705314751214e-01   +2.518972896506551e-01   +8.375366986673390e-01   +2.761026419170999e-01   +2.704533828630933e-01   +1.115794800920526e-01   +6.655958701898282e-02   +4.935787266306083e-01   +9.221045826194599e-01   +9.672864507859087e-01];
L2I_L1I_iGABA_netcon = [+6.712957195695476e-01   +4.596613975480830e-01   +7.309313125931653e-01   +5.200609698943139e-01   +9.356838059580818e-01   +6.874291768106640e-01   +9.137448739221226e-01   +4.077901326728418e-02; +4.988362404856742e-01   +6.239148794163824e-02   +1.949776944159523e-01   +8.860988807512741e-01   +1.941193341977859e-01   +7.522011372855489e-02   +8.223792781585104e-01   +6.963397571531624e-01; +1.000000000000000e+00   +5.128668780379725e-01   +6.617198847460470e-01   +6.144245757859472e-01   +7.874978137300400e-01   +7.274362667207228e-01   +2.850987039583788e-01   +1.994713915886903e-01; +3.500505338740730e-01   +1.638543564679460e-01   +9.070942068921551e-01   +4.090330862856442e-01   +7.603622143261070e-01   +3.458556852319007e-01   +8.631091633387414e-01   +1.815852676306740e-01; +7.259200557201140e-01   +4.772038689617692e-01   +6.456819437287888e-01   +2.674011070948549e-01   +9.175252795465560e-01   +3.777079444534085e-01   +5.412357023010450e-01   +2.127761881677361e-01; +5.318454425140461e-01   +5.851149471894200e-01   +7.544087418221609e-01   +2.124972294005086e-01   +1.917131587994347e-01   +7.903367204451491e-01   +9.299144909626378e-01   +5.829705027027202e-01; +8.900082692133331e-01   +4.391208859797431e-01   +2.124086842688187e-01   +2.492988061225785e-01   +7.221766921351580e-01   +1.919224228990057e-01   +5.963322787934660e-01   +3.554725916214919e-01; +9.195139405708708e-01   +4.028248958268898e-01   +6.284897861817068e-01   +9.185602513320157e-01   +1.060054932358173e-01   +4.348631847497291e-01   +4.559391499837505e-01   +2.233823161658185e-01; +7.122457242672139e-01   +2.084661539948461e-01   +4.701043816872220e-01   +3.559553231906621e-02   +7.886320114917603e-01   +3.517283784847758e-01   +7.468523070588748e-01   +7.298815764054437e-01; +4.419292082842222e-01   +8.613424436592469e-01   +6.689596419526961e-01   +8.176137509918292e-01   +3.905055106352993e-01   +7.992407401078139e-01   +8.815676178227246e-01   +2.635360215549838e-01; +5.054015765499855e-01   +6.153056864110459e-01   +4.469571720524433e-01   +4.107756484086382e-01   +5.096691690774762e-02   +8.844084098213884e-01   +6.304539868672241e-01   +4.677453664419388e-01; +5.967182213477891e-03   +3.929271621116213e-01   +3.487480456189508e-01   +4.140476591125991e-01   +3.597451329726445e-01   +5.326838934565030e-01   +2.745592970039770e-01   +5.390269492324069e-01; +3.964083466762499e-01   +1.919443756048186e-01   +6.285380766214775e-01   +7.400531943684833e-01   +2.155525956637812e-01   +6.362850834284691e-01   +3.888549022100489e-01   +7.450763216376933e-01; +4.661703790457734e-01   +4.500119085574636e-01   +7.028785760735378e-01   +3.597064452986279e-01   +8.412176086489209e-01   +4.023255319762809e-01   +3.573388494578325e-01   +3.211884729604751e-01; +6.111353433317275e-01   +1.804061344730526e-01   +2.804307937322772e-01   +2.566671533113359e-01   +5.596242986339197e-01   +5.554790283198379e-01   +3.093628302631850e-01   +6.834337347371143e-01; +7.525233225317814e-01   +5.056629072005529e-02   +7.238839349671328e-01   +2.613386053408635e-01   +3.871689923269019e-01   +6.311813791465868e-01   +1.053697708418962e-01   +2.754326048409802e-01];
L1I_L2I_iGABA_netcon = [+5.198307296640864e-01   +1.831259431984600e-01   +7.694682292799866e-01   +2.845976762655161e-01   +5.758033680447777e-01   +2.809131228010845e-01   +8.730069811375017e-01   +2.117263369042738e-01   +5.851784935748547e-01   +9.048519150171255e-01   +4.086388119845837e-01   +3.980755082789353e-01   -2.124541041045199e-02   +7.608353831713868e-01   +6.232968176416859e-01   +5.093274520595611e-01; +2.544114409003599e-02   +3.457544507535511e-02   +3.196591081577473e-01   +3.001678379058026e-01   +8.929678940884617e-01   +3.404348545100953e-01   +3.585961205028391e-01   +1.448508904173918e-01   +4.341570539010017e-01   +2.518235326977558e-01   +2.975205856483320e-01   +3.008752054471541e-01   +9.214486059800991e-01   +1.927384361828552e-01   +8.466626250876765e-01   +2.632670013278186e-01; +3.950652855885607e-01   +6.464078408830860e-01   +3.621294298053853e-01   +7.384328441747886e-01   +2.692087189673684e-01   +5.206919619851805e-01   +7.456163930060903e-01   +9.500219212288451e-02   +7.584069947970715e-01   +4.863634554693397e-01   +6.369889929877897e-01   +8.379863714194620e-01   +9.868201579598099e-01   +6.721289166366923e-01   +3.308062379312478e-01   +1.557779912221666e-01; +8.402139196785833e-01   +1.299067178619120e-01   +6.433527136704692e-01   +9.407646532818551e-01   +5.005296129572322e-01   +9.237658310355160e-01   +6.316371008466430e-01   +3.553171245502625e-02   +6.952447815731930e-02   +3.208057563337668e-01   +4.297737797048924e-01   +4.509958421943829e-01   +3.423982204168753e-01   +5.411504205315519e-01   +1.642888426252055e-01   +1.005658362245426e-01; +9.436906224327551e-01   +7.445969285078462e-01   +7.103764040816922e-01   +6.640484507547640e-01   +3.245826623145284e-01   +6.756756680074131e-01   +6.660411097965178e-01   +6.343132693613043e-01   +9.724577171696730e-02   +7.072848677923033e-01   +1.786777146017491e-01   +4.216207891544807e-01   +3.338722568344237e-02   +2.106256544500857e-01   +7.083409684829913e-01   +9.511923221528371e-01; +5.720069769266729e-01   +3.785582080853888e-01   +1.273345255759935e-01   +3.771844423813592e-01   +9.647955669905686e-01   +1.601094551888191e-01   +7.267117470718978e-01   +6.361776600092910e-01   +5.398738515620677e-01   +6.949131640852763e-01   +3.418942103396778e-01   +5.051006026784127e-01   +8.934193553429438e-01   +8.947520287540763e-02   +1.924639627711967e-01   +4.304214201951402e-02; +8.286531222826214e-01   +1.221093317140469e-01   +3.854249833240386e-01   +3.029408332128802e-01   +5.704394843158942e-01   +8.995771342659309e-01   +7.171668389271582e-02   +2.194434160431401e-01   +7.345850404426347e-01   +8.989803291158202e-01   +9.259052761291156e-01   +8.753083227459013e-01   +1.300035693122553e-01   +3.007230409117060e-01   +7.039566689326304e-03   +6.007894149546501e-01; +9.060374121974961e-01   +3.886109346122432e-01   +1.254946225838553e-02   +8.979676642450795e-01   +1.509377485589310e-01   +9.826349330036440e-01   +8.075930585187506e-01   -1.391667221621506e-02   +8.112351926788952e-01   +8.497757333233955e-02   +9.140268083735686e-01   -4.148674723102661e-03   +8.168084379924737e-01   +5.946670452415343e-02   +9.989664252649688e-01   +6.756751249940619e-01];
L2E_L1E_iAMPA_netcon = [+2.835997024191547e-01   +8.991087402818281e-01   +6.421900530129084e-01   +3.872751268444932e-02   +3.232489173013260e-01   +4.001900402973554e-01   +7.574612512058584e-02   +6.425395162516724e-01; +2.343585338474565e-01   +1.948649234588275e-01   +8.018528267838201e-01   +8.873418691387234e-01   +3.397675167918127e-01   +5.277706777264298e-01   +2.737353094746180e-01   +1.360820860057307e-01; +5.001246730442844e-01   +8.860941327427870e-01   +7.887626972784398e-01   +5.029292846841701e-02   +6.549347656626361e-01   +1.184974477091594e-02   +4.307379414916653e-01   +8.328984274297142e-01; +5.113153876791651e-01   +6.472369158723644e-01   +4.963424205697704e-02   +6.083493836238540e-01   +2.805722780114663e-01   +5.132760111012969e-01   +2.051181744295750e-01   +4.844678084790363e-01; +8.771654180213648e-01   +7.271137756566912e-01   +7.934426084790102e-01   +5.373086694817768e-01   +7.683694864247133e-01   +3.879855054617573e-01   +4.605878691214508e-01   +5.100786410895515e-01; +4.869377116870715e-01   +7.072261942680391e-01   +5.669053172534471e-02   +6.112638119354291e-01   +6.805730035653781e-01   +8.717765732239244e-01   +2.853687796552027e-01   +5.167220561046486e-02; +4.439050676406212e-01   +3.228652913125550e-01   +2.065899791276193e-01   +4.272134762634696e-01   +3.924251750653177e-01   +2.610730753570573e-01   +5.884398596574290e-01   +2.864323404911640e-01; +7.148696085486022e-01   +1.740367318691247e-01   -3.560475575961225e-02   +9.799118754444404e-01   +5.029950707978511e-01   +3.538826185558760e-01   +5.841323543121352e-01   +5.808754925665186e-01; +7.685106850567807e-01   +6.139900837790768e-01   +6.643855839801548e-01   +1.195522699989729e-01   +4.142714661118593e-01   +2.578562779286864e-01   +6.671475089501143e-02   +9.724118169855296e-01; -1.025123187109778e-03   +1.332114431225852e-01   +1.636454718932522e-01   +1.572449772118157e-01   +1.792795854035114e-01   +5.861232313208368e-01   +8.720817423302465e-01   +8.041348946843121e-01; +1.780349402550617e-02   +2.471333460426156e-01   +5.707970460734741e-01   +5.222142382427332e-01   +1.240804851645836e-01   +4.306371309297862e-01   +1.829564026027895e-01   +7.081872060285460e-01; +3.530518709280179e-01   +5.594575573062985e-01   +6.216477932181230e-01   +5.137863749574879e-01   +6.844931219553683e-01   +3.227417348269507e-01   +6.729746123319785e-01   +4.329194444217269e-01; +6.737619507888931e-01   +7.077796164056616e-01   +6.337667897914471e-01   +2.330657973416322e-01   +1.825988603895827e-01   +1.235332293188087e-01   +5.142909999364523e-02   +5.264344482470251e-01; +7.044091451113617e-01   +7.916939391948863e-01   +3.216648145371077e-02   +8.927212836377736e-01   +4.940701466988127e-01   +8.347366305021915e-01   +3.521656180215946e-02   +2.242981847592059e-01; +9.231117933060020e-01   +2.200388623932398e-01   +4.456228719280805e-01   +5.672003390187164e-01   +3.280212920034387e-01   +2.171084937423047e-01   +5.962016490694316e-01   +3.698174432819590e-01; +8.262155703720442e-01   +6.367452910810348e-01   +7.055144984714113e-01   +3.525469171505330e-01   +4.790204616288746e-01   +8.808348534366832e-01   +7.269209017664461e-01   +1.303404583711956e-01];
L1E_L2E_iAMPA_netcon = [+8.814941488800028e-01   +4.742291806114923e-01   +5.891544289973744e-01   +1.349894241258540e-01   +9.644573825818165e-01   +2.941775341753804e-01   +5.729433566567117e-01   +4.864813720813156e-01   +9.029396284524701e-01   +5.489384021747550e-01   +6.441917855193519e-01   +4.763972251398280e-01   +5.091452784059183e-01   +3.309713248922415e-01   +5.753713786533350e-01   +2.506910163696328e-01; +7.864349313305933e-01   +1.984958449042099e-01   +1.168780080934277e-01   +5.561634338028534e-01   +8.227154460366892e-01   +5.815048125667697e-01   +8.692023467836408e-01   +2.264257490940360e-01   +3.620343410102161e-01   +3.292246871361327e-01   +7.046049589060717e-01   +6.782752986386590e-01   +6.866819625797266e-01   +9.175978527333092e-01   +3.799731975358224e-01   +5.337957298788707e-01; +7.849203724569542e-01   +1.267964172726009e-01   +1.531173247150611e-01   +9.927917535860754e-01   +2.217134587676178e-01   +3.860767260881964e-01   +9.052193465489118e-01   +2.762568081435722e-01   +2.150699320199710e-01   +6.202304188249245e-01   +7.942703864404943e-01   +4.868304424344015e-01   +8.390310913501440e-01   +9.451886066646307e-01   +8.016151490261887e-01   +6.419642305249186e-01; +7.030368940844091e-01   +6.032600008125359e-02   +5.262549744344822e-01   +3.488089940996822e-01   +4.311474709889108e-01   +8.560733910162204e-01   +2.151460322006392e-01   +1.399191064642074e-01   +5.960922692527230e-01   +4.638716525523605e-01   +3.691451971496064e-01   +9.541641559659221e-01   +7.360639290047375e-01   +3.292421235267898e-02   +7.369292246655930e-01   +8.309661963062505e-01; +3.581814831943177e-02   +2.235000140789193e-01   +1.381172709891759e-01   +7.813350007035518e-01   +2.110154847132008e-01   +4.560245766965152e-01   +9.582355558138858e-01   +3.291749256561044e-01   +8.578438836910318e-02   +7.640830661474867e-01   +8.696298989733461e-02   +5.358363283983618e-01   +9.735765219356350e-02   +6.215294581477706e-01   +3.859425082562519e-01   +1.507755765476090e-01; +6.203026845241570e-01   +4.654219325832342e-01   +3.678542347931200e-01   -1.034881924103516e-01   +8.833555118582076e-01   +9.710677020238839e-02   +4.777207420070129e-01   +1.639894252798945e-01   +7.252709281699828e-01   -2.579461269131558e-02   +7.486860953286039e-01   +1.220453467876895e-02   +7.460084047352791e-01   +4.960540563984019e-01   +7.251503793759347e-01   +3.161281726673109e-01; +2.673019596789887e-01   +6.303074727405906e-01   +3.530336092886301e-01   +3.813783074699409e-01   +3.622271541247256e-01   +8.583476607246501e-01   +9.222464939199574e-01   +4.251398505607611e-01   +6.737221907715250e-01   +7.566030900405227e-01   +4.844394280032464e-02   +1.377930106066022e-01   +1.043601179210903e-01   +3.862447318684735e-01   +3.244163543447415e-01   +7.759989355416510e-01; +1.581527217600701e-01   +4.484352099761148e-01   +3.017160055133515e-01   +4.748578524458924e-01   +9.395673242731210e-01   +4.593366510159004e-01   +9.865859659381951e-01   +8.620458624465949e-01   +3.932588585185888e-01   +3.870772724733772e-02   +3.806252488461856e-01   +3.740716962295871e-01   +3.329191826045911e-01   +7.236613042673508e-01   +7.890594003645246e-02   +5.144415935377041e-01];
L2I_L2E_iAMPA_netcon = [+3.664494373136505e-01   +2.562847962394360e-01   +3.482025716753976e-01   +5.864930196979778e-01   +1.940465122339463e-01   +8.388802039785493e-01   +6.946731507692657e-01   +2.825563635436835e-01; +5.028585326597068e-01   +1.865346665877806e-01   +6.693566231194980e-01   +2.825861516550026e-01   +6.870425044322214e-01   +8.400541290936246e-01   +6.151881417258582e-02   +4.807725020340144e-01; +6.480646294881565e-01   -1.376884195295092e-02   +7.155310038744334e-01   +6.211740331286392e-01   +1.275618434900092e-01   +5.748771005969380e-01   +7.526938905741076e-01   +8.071843073532559e-02; +5.256709426866254e-01   +2.717955748825265e-01   +5.663180672981820e-02   +9.547760304677142e-01   +3.599790987852314e-01   +6.304028613178895e-01   +9.860206907167048e-01   +1.973469796993009e-01; +1.346789922398616e-01   +4.226776341047322e-01   +4.330068235372705e-01   +8.502996999702479e-01   +8.589888698112051e-01   +5.784595656294615e-01   +7.357649842627856e-01   +2.879821576730395e-01; +9.097920158510470e-01   +4.982469838251946e-01   +9.092998482871353e-01   +8.888564623391909e-01   +6.814717652170361e-01   +8.658448766636212e-01   +8.849512976954186e-01   +5.266027110593843e-01; +1.521538841201033e-01   +5.492956442229189e-01   +9.009218984023918e-01   +8.695246191133724e-01   +9.137480101849613e-02   +7.240685812729828e-01   +2.371647471382401e-01   +1.220944638937096e-01; +5.686206750035462e-01   +3.783364757356665e-01   +1.795896730537356e-01   +2.772361769631793e-01   +7.695650348672355e-01   +3.941391109455631e-01   +9.743976214206522e-01   +6.139758803069889e-01];
L2E_L2I_iGABA_netcon = [+4.282670084249504e-01   +5.934178106167788e-01   +6.186407903433664e-01   +4.753498492294251e-02   +4.632340302623249e-01   +5.038062830290206e-01   +2.828899291700904e-01   +7.290911808632804e-01; +3.959344383115744e-01   +3.443544413505116e-01   +4.044643273154887e-02   +4.668281060156724e-01   +4.447827839913478e-01   +6.070609113263472e-01   +4.712409152874891e-01   +4.779584517346363e-01; +5.853382703078087e-01   +5.065408150462575e-01   +3.868948403524898e-01   +5.632918218837896e-01   +3.125552312208598e-01   +2.609770733564854e-01   +1.877665502989282e-01   +1.000000000000000e+00; +7.449971720837207e-01   +5.479350259366891e-01   +3.759450911652730e-01   +8.607944785844330e-01   +2.014005948157560e-01   +7.769135624792728e-02   +1.377131522967800e-01   +4.055584278638629e-01; +5.115306698847144e-01   +7.893639451750353e-01   +4.936910911529778e-01   +7.673502528061474e-01   +3.761683681997134e-01   +6.814652783450877e-01   +6.376394049541846e-01   +3.507246262563602e-01; +4.002310905746521e-01   +2.828672570266140e-01   +4.508174905992591e-01   +3.631688595004272e-01   +7.730805744428451e-01   +8.221022758467180e-01   -1.166888226960597e-02   +4.269490806551069e-01; +3.385601809092022e-02   +4.791877857874280e-01   +8.431004103618860e-01   +5.957409021401593e-01   +4.749678083485218e-01   +4.020891736692668e-01   +9.029508849209876e-01   -4.125548999171785e-02; +8.723334426873813e-01   +5.415483759878725e-01   +8.472458193980164e-01   +4.668763839868039e-01   +8.669430712590472e-01   +5.187781469038183e-01   +3.209653396201833e-01   +3.637035036430140e-01];
L3E_L2E_iAMPA_netcon = [+2.509184884738102e-01   +9.042741713363880e-01   +4.587661158651264e-01   +8.006828866160873e-01   +1.605190471048615e-01   +4.265620109105607e-01   +3.933651610456855e-01   +1.105131055554318e-01   +1.519109442621263e-01   +5.529137948684576e-01   +1.646593239921728e-01   +4.530348685153540e-01; +2.823888084509402e-01   +4.582184637104318e-01   +1.657495666504336e-01   +2.107202307570323e-01   +6.018264369781836e-01   +8.868982846386503e-01   +6.832019829582129e-01   +5.720635008628157e-01   +2.646893335391212e-01   +2.679249365003200e-02   +1.618897260226307e-02   +6.461741583879599e-02; +8.229449132450628e-01   +3.794226180181421e-01   +5.573633241718886e-01   +1.591394075493011e-01   +8.621657521393806e-01   +8.654928608786073e-01   +5.097519111968688e-01   +6.227432663588911e-01   +7.177536614668005e-01   +3.676763536389223e-01   +4.300550000053189e-01   +9.069425798832115e-01; +1.764732510885574e-01   +4.646614151699824e-01   +1.534785660142483e-01   +8.235296408023263e-01   +4.902784141833722e-01   +5.752670182423535e-01   +8.706757645025029e-01   +2.817238750715571e-01   +8.281222456230442e-01   +8.263525522133947e-01   +4.341363117146567e-01   +2.042486468722020e-01; +2.167126814127221e-01   +7.912084453362992e-01   +4.422887959792736e-01   +1.334312735721513e-02   +2.396369871908481e-01   +9.846241488859778e-01   +1.338698949188316e-02   +6.720139748698428e-01   +7.477870621353638e-02   +8.654666106828843e-01   +2.549461314060125e-01   +2.515643757694858e-01; +3.666699515604662e-01   +3.970873727073522e-01   +8.426050992674980e-01   +9.990564371192652e-01   +3.739996726878928e-01   +9.401752165939193e-01   +7.467025575224795e-02   +3.481742566859931e-01   +5.014776360803954e-01   +8.144123437270389e-01   +6.012929653713409e-01   +8.677827676043576e-01; +1.624689044425955e-01   +4.605172499084930e-01   +5.780909276580194e-01   +6.976095635887918e-02   +6.515834177650380e-01   +5.028763715066963e-01   +7.885277939550079e-01   +1.396670589190741e-01   +4.382120551044542e-01   +4.115163595251266e-01   +9.804787114482370e-01   +7.255419684349027e-01; +6.029912211692365e-01   +3.223098471099380e-02   +3.802159392767070e-01   +1.595687915840094e-01   +3.766326867903075e-02   +9.009207775677242e-01   +3.916355279193128e-01   +4.357258604925477e-01   +8.662836417753422e-01   +1.000000000000000e+00   +9.450653397992513e-01   +3.189814158781463e-01];
L3I_L2I_iGABA_netcon = [-1.162641657529437e-03   +3.703748874636617e-02   +9.819283512616785e-02   +6.706986125755651e-01   +2.827417313322656e-02   +4.957232305527043e-01   +8.169023630125097e-01   +3.756006393220554e-01   +4.453705075657315e-01   +9.593998120670797e-01   +8.255953412461257e-01   +6.182606497429882e-01; +3.863898840326996e-01   +4.537741689196346e-01   +3.037634241149690e-01   -4.607141794427964e-03   +4.749339867455186e-01   +5.904200807004453e-01   +4.748350238646842e-01   +9.195398633667449e-01   +1.302311658553753e-01   +9.198095165818622e-01   +2.829629584067646e-01   +6.596348016788286e-01; +3.556887689249487e-01   +6.715429327970183e-01   +3.073537776804904e-01   +7.877182528772959e-01   +3.336851844407362e-01   +8.570493777454464e-01   +9.688178039186217e-01   +8.608205814008306e-03   +6.726116630829151e-01   +4.946723908818621e-01   +1.525495726974125e-01   +5.831418754632758e-01; +6.555684105853817e-01   +9.796578745393705e-01   +3.231231053409885e-01   +2.522070819401947e-01   +1.582378015635239e-01   +5.786585248302998e-01   +1.915284912690224e-01   +2.662186251984957e-01   +7.798060050667571e-02   +3.276683475102835e-01   +5.309277474515984e-01   +7.934862786826743e-01; +9.727257153281020e-01   +1.079783575124985e-01   +4.789080439853957e-01   +8.564451669918335e-01   +4.847742180155570e-01   +9.015035380856122e-01   +7.827256246380011e-02   +5.434181071198833e-01   +5.791375654458716e-01   +8.163201220658309e-01   +7.589617238024385e-01   +5.212212106787713e-01; +9.315105546417979e-01   +1.535063177420740e-01   +1.584511985209344e-01   +7.637782478129536e-01   +9.126741874987919e-01   +7.468132833769346e-01   +9.451362769766397e-01   +5.701865285597858e-01   +1.166786376628572e-01   +8.300518929687013e-01   +3.331783450758568e-01   +5.911886793958057e-01; +1.055075994638401e-01   +5.350373909658505e-01   +9.555012589732170e-01   +5.385830467511792e-01   +9.593136110064474e-01   +8.075400722257415e-01   +8.391067945322660e-01   +8.042441310377524e-01   +6.289544408828924e-01   +4.013219299917083e-01   +3.202949533606895e-01   +5.652004480561141e-01; +3.193682145394074e-01   -8.618227409028687e-03   +7.577594875225194e-01   +1.934380219276205e-01   +4.658593194987799e-01   +1.380796215288155e-02   -3.440128809751992e-02   +9.575846418495926e-01   +4.933575811630129e-01   +8.456642428026341e-02   +7.079789443250234e-01   +7.117762179245538e-02];
L2E_L3E_iAMPA_netcon = [+9.364749516007883e-01   +2.421890634916668e-01   +5.516228090010139e-01   +7.220366873569771e-01   -1.094622406485568e-02   +7.225129018414155e-01   +7.852864612124717e-01   +8.836164228182831e-02; +3.200603724539107e-01   +5.653861433138572e-01   +6.927641958146422e-01   +7.040936214604536e-01   +2.429469633034337e-01   +2.247861050434193e-01   +7.949537712238502e-01   +8.793278528804475e-02; +6.073492198893404e-01   +5.315331735776416e-01   +8.649794430506976e-01   +6.161040485141095e-01   +9.062998677336965e-01   +4.445115305237752e-01   +9.992519860198649e-01   +4.690245357810817e-01; +2.228164896172695e-01   +9.060039071100594e-01   +8.796226259795377e-01   +4.233451740369530e-01   +3.949726919817600e-01   +9.878090074268294e-01   +2.681308378507093e-01   +5.124031218055882e-01; +8.470263081257892e-02   +2.042024988804531e-01   +7.034276543331357e-01   -5.522683869742174e-02   +1.897563159854876e-01   +5.201310422925784e-01   +4.737528784113963e-01   +6.543273008041920e-01; +3.878265762936136e-01   +7.772059487643043e-01   +1.395327308518752e-01   +7.923433027923621e-01   +7.135206605344649e-02   -3.155330978230327e-02   +5.019004730711574e-01   +3.096272901955633e-01; +4.820762798990818e-01   +7.534663135591980e-01   +7.939754788714070e-01   +2.478193542596666e-01   +8.393569915675306e-01   +1.824928215357256e-01   +7.329408220652666e-01   +9.225574663526196e-01; +3.000646121193871e-02   +5.566322823837649e-01   +9.173156247380463e-01   +4.713864290126899e-01   +1.013306340131217e-01   +7.084197090917339e-01   +1.075181748553824e-01   +3.204966166118026e-01; +9.767891119375685e-01   +8.788645131841978e-01   +7.858081142427686e-02   +1.825001615275426e-01   +9.123801603917066e-02   +8.718333042992977e-01   +2.810729590504026e-01   +9.223706379075942e-01; +1.543315788069906e-01   +3.623288079567386e-01   +8.317358765213614e-01   +3.392069063740546e-01   +4.178379592446302e-01   +8.661169964247107e-01   +4.178881199973480e-02   +9.244941181047874e-01; +6.662951462590666e-01   +3.532281540234815e-01   +2.719937714471726e-01   +2.647946216454511e-01   +1.530790769665574e-01   +3.236636612330096e-01   +2.110868731617293e-01   +8.486443129167588e-02; +1.062035769673109e-01   +6.313115073075634e-01   +8.030589587510976e-01   +4.294772136719386e-01   +3.989022202543491e-02   +7.481916564516781e-01   +7.599508389145248e-01   +7.998870987127287e-01];
L2I_L3I_iGABA_netcon = [+3.779103968119416e-01   +6.300276199991239e-01   +2.477138586763364e-01   +6.735040526965196e-01   +4.918856878753555e-01   +4.431239409129409e-01   +3.917076161033504e-01   +4.806636379886098e-01; +3.646926375109872e-01   +1.254403695471122e-01   -4.353197206420885e-04   +8.352274011219749e-01   +6.781225202165501e-01   +5.652969042506716e-02   +8.621516715062506e-02   +6.029266986342403e-01; +3.374639658031692e-01   +6.165650557243054e-01   +4.286405633776668e-01   +9.329235786950286e-02   +8.243355139957446e-01   +6.180772532393620e-01   +1.846701820750476e-01   +1.155666131644243e-01; +6.123357126581580e-01   +8.390912404974176e-01   +5.955829481901870e-01   +4.534557587454232e-01   +4.978933315894268e-01   +6.592038328867119e-01   +3.891138510124038e-01   +6.805445282599003e-01; +9.739640743097390e-03   -7.002468832688680e-02   +9.785666243469816e-02   +6.587010754523005e-01   +1.705814072193168e-01   +6.539239861391644e-01   +4.811739568242189e-01   +2.814056583788297e-01; +5.153966728082729e-01   +4.195929101378770e-01   +4.234767599724750e-01   +6.570146916810211e-01   +2.517216482598052e-01   +8.272414515898316e-01   +3.814458270954100e-01   +1.098103213857536e-01; +2.349525835089586e-01   +2.621281142898226e-02   +4.434997796292517e-01   +9.982261461025848e-01   +6.370032006678489e-01   +8.811460769349277e-02   +2.428681331026248e-01   +8.457088524917803e-01; +2.023942008973691e-01   +8.984693041306422e-01   +9.144159459156191e-01   +9.175718203299218e-01   +4.871354797527688e-01   +9.294798362789844e-02   +7.164992736949222e-01   +1.634039520426054e-01; +3.315885675938395e-01   +5.448043174506032e-01   +2.537919587807643e-01   +1.591401584131058e-01   +3.710006840114918e-01   +2.608024984479766e-01   +5.720032661466137e-01   +4.366378815879944e-01; +3.865508435563275e-01   +1.818671716217825e-01   +1.976958897298260e-01   +4.021102675238338e-01   +9.081279819227200e-01   +4.808443702698928e-01   +4.725604908401866e-01   +9.089343810851109e-01; +6.177999593628969e-01   +8.327988025350831e-02   +2.854981492627191e-01   +5.581589942876153e-01   +5.193585272866187e-01   +6.992931826977721e-01   +9.051367174256256e-01   +6.028858132425271e-01; +3.476772292495657e-01   +1.903672409487238e-01   +6.152759863587561e-01   +2.830848975507215e-01   +1.156535088555541e-01   +3.158013613255389e-02   +2.976755711307538e-01   +6.544777116162251e-01];
L3I_L3E_iAMPA_netcon = [+1.121981720391475e-01   +6.636749278168601e-01   +5.729569210837857e-02   +1.954444853317385e-01   +2.808257773835358e-01   +6.028182075186013e-01   +7.141344304595827e-02   +3.169128929217871e-01   +5.372728576177926e-01   +3.193870034932682e-01   +6.227707600185254e-01   +9.270335591370388e-01; +3.884106305114003e-01   +8.670728990140398e-01   +2.346994521864579e-01   +3.639465194063528e-01   +7.538534218978988e-01   +4.320560134636199e-01   +4.016157518603520e-01   +3.932949876174906e-01   +6.275005926999468e-01   +2.985856360234803e-01   +7.067490575660005e-01   +1.988279490406923e-01; +4.974174764864935e-01   +3.883653201277493e-01   +7.969194359500469e-01   +8.671701206480148e-01   +5.890786244899615e-01   +6.248535801443357e-01   +9.909270778749287e-01   +4.374326644760783e-01   +1.947315057468538e-01   +3.054855378036778e-01   +9.367709144833217e-01   +8.201321233550479e-01; +4.900662300977698e-01   +1.167336187941846e-01   +5.172296889620062e-01   +7.547052539183510e-01   +4.065852964836902e-01   +6.139809666278165e-01   +5.751602871637017e-01   +7.148836724295801e-01   +5.178688049611553e-01   +2.209236935110559e-01   +4.532973466193423e-01   +5.096439596523833e-01; +9.342884167255990e-01   +8.306957373924028e-01   +6.028460995934847e-01   +5.256043303261148e-01   +2.531436097795363e-01   +3.141596885204145e-01   +2.373820758446663e-02   +2.190579085070467e-01   +1.661811052803816e-02   +2.628949292382642e-01   +3.438571216651227e-02   +5.222027852626248e-01; +3.647739418886307e-01   +1.932578908685364e-01   +6.678477134608596e-01   +4.709539275475080e-01   +9.889168068863948e-01   +6.157871035596789e-01   +2.738781686721046e-01   +7.310049670106143e-02   +1.768431922413063e-01   +5.855747058958876e-01   +3.028109916895498e-01   +1.019833414335358e-01; +4.538121191619989e-01   +2.088163552823970e-01   +8.534707653497382e-01   +8.639743369803602e-01   +1.042920566067180e-01   +2.828142938106922e-01   +4.012040384881202e-01   +1.454932352480771e-01   +9.055937934691152e-01   +7.242858157762863e-01   +2.926603585787075e-01   +4.863386538601105e-02; +4.018892492789723e-01   +3.926143343975219e-01   +2.934448859055467e-01   +6.152773273155459e-01   +8.455464360530071e-01   +2.468274041942713e-01   +4.198768929922634e-01   +3.185759019048549e-01   +3.076083686876167e-01   +2.450776473406147e-01   +6.930894258755159e-01   +5.609000927884183e-01; +3.253218723122044e-01   +5.357322585390515e-01   +3.994860176343560e-01   +5.933322666617772e-01   +5.754334880437385e-01   -3.552856051182814e-02   +5.993526766475078e-02   +4.364674330110600e-02   +3.082247274327487e-01   +2.210617200523197e-01   +8.776803879049855e-01   +8.784139109551747e-01; +7.331740417931060e-01   +5.784566837849469e-01   +5.816926257260308e-01   +4.178323082299863e-01   +4.430588514736200e-01   +4.187984229094154e-01   -4.905133725708795e-02   +6.618447308963402e-01   +4.563574556799648e-02   +9.135674564996867e-01   +4.800342497646498e-01   +1.422646228553199e-01; +4.919404353968240e-02   +2.913294603813124e-01   +6.626936122956005e-01   +2.619760298072387e-01   +4.148837776929112e-02   +5.131448622206890e-01   +9.963428035149889e-02   +7.688041280093130e-01   +7.144314145193518e-01   +1.628186939762448e-01   +6.718529531563916e-01   +3.029679179424751e-01; +6.127641388010860e-01   +6.519055301982238e-01   +3.883777219322410e-01   +6.330648992281952e-01   +6.668422318328929e-01   +3.856041486781917e-01   +2.886663377307434e-01   +7.969813318914512e-01   +6.262988806554620e-01   +4.225086488256835e-01   +5.317286699824401e-01   +4.032894125756004e-01];
L3E_L3I_iGABA_netcon = [+3.287719270156367e-01   +6.838361040685778e-01   +6.505411521940696e-01   +8.427156927314611e-01   +4.579771516842369e-01   +1.123987649030914e-01   +2.442343812467986e-01   +7.275532691326045e-01   +7.348705373076091e-01   +2.774918883367717e-01   +4.726948252331074e-01   +2.994182668419230e-01; +8.545454243033465e-01   +3.540302908216651e-01   +6.333174737287471e-01   +6.992582856067854e-02   +8.593451349582988e-01   +4.125808173439935e-01   +8.143744657784113e-01   +6.801820227269508e-01   +5.961254388723298e-01   +7.071388485383219e-01   +2.378474034385600e-01   +4.737457648080142e-01; +7.966456021962263e-01   +3.253946568288444e-01   +4.201232853161599e-01   +4.643989117906892e-01   +5.782129841786864e-01   +5.350014395741495e-01   +2.326433190731924e-01   +8.294143538287572e-01   +5.318559346278099e-01   +1.618757028255077e-01   +7.365218074325621e-01   +8.542046637610685e-01; +1.428133051730515e-01   +6.487365102345645e-01   +3.177860686978588e-01   +2.745731931652018e-01   +1.111362002392739e-01   +6.836871017972792e-01   +2.655333064847546e-01   +6.838958873204232e-02   +2.911398994841065e-01   +5.014390789792108e-01   +7.368637666091273e-01   +5.774947400472542e-01; +2.043951672108065e-01   +6.970800604958859e-01   +5.695507726115696e-01   +2.769032131412928e-01   +1.359031774833913e-01   +6.011346688234982e-01   +9.126029722282624e-01   +2.811062611736916e-01   +2.394990166035555e-01   +8.420558715919161e-01   +5.870262705788578e-01   +2.130055445047627e-01; +4.704583492185253e-01   +8.268379410674994e-01   +7.183463643698774e-01   +4.915658615571842e-01   +7.637233848853001e-01   +1.012134053844878e-01   +3.727732894350974e-01   +2.968870952422565e-01   +8.621762541391628e-01   +8.356238308952021e-01   +8.040067735159150e-01   +2.678050143943388e-01; +5.632805903603941e-01   +7.446330645547603e-01   +2.070879246579498e-01   +2.242354120317856e-03   +4.153731195747359e-01   +6.153131117774246e-01   +6.061770783647813e-01   +1.762486237663604e-01   +9.561165136431822e-01   +5.610199393370737e-01   -2.477526724898392e-02   +3.512414229005903e-01; +4.635868107371061e-01   +3.941094974390016e-01   +8.579548446697677e-01   +3.789179472660573e-01   +9.268830563783996e-02   +1.164405014167441e-01   +6.060452003471919e-01   +6.636923081927920e-02   +6.265146942315142e-01   +7.720025942726807e-01   +1.871166393112131e-01   +9.929065401256507e-01; +3.109645639895671e-01   +5.340099165870911e-01   +2.681148849205053e-01   +7.431938934598079e-01   +8.317413244223126e-01   +5.185488234223887e-02   +3.518779072512471e-01   +5.727233880721249e-01   +6.140615179835164e-01   +8.539362082926203e-01   +6.656472201214367e-01   +6.324762639695496e-01; +5.405842485430860e-02   +3.309388795475437e-02   +3.292050712305164e-01   +5.768712265254582e-01   +7.682384070516749e-01   +1.904811575438962e-01   +2.738053813789868e-02   +3.307662133490107e-01   +6.575887846350718e-01   +2.608037441299475e-01   +6.047037079649533e-01   +1.336578897435893e-02; +8.568476894911334e-01   +4.142830422236549e-02   +7.045222336256860e-01   +4.880578159644626e-01   +3.838744104900432e-01   +8.449973569233240e-01   +1.378233152744475e-01   +8.240088604407384e-01   +3.174609366606150e-01   +9.424108433715227e-01   +4.894791539653874e-01   +7.001039680752028e-01; +6.273286625573042e-01   +8.290491511805050e-01   +5.064437989327164e-01   +8.890814107404824e-01   +8.247325903435115e-01   +4.794880310297205e-01   +9.387080578123207e-01   +8.557346847220948e-01   +4.325217299047545e-01   +8.705439784534056e-01   +4.917092999001280e-01   +8.675265142572911e-01];
L2E_Input1_iAMPA_netcon = [+9.722660016401403e-01   +9.756696315133007e-01   +9.239684431123877e-01   +9.608758129040704e-01   +9.116730322663559e-01   +9.925729241382177e-01   +9.274441863335943e-01   +9.643248826315995e-01];
L2I_Input2_iAMPA_netcon = [+9.133559668722219e-01   +9.449627330082492e-01   +9.814453545732920e-01   +8.761961560433230e-01   +8.950040703870756e-01   +9.459309149816432e-01   +9.407443343997739e-01   +9.685537848068453e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
