function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.905129768400410e-03   +9.794923550722466e-02   +1.673915889710298e-01   +1.320818217170544e-01   +1.146871956225867e-01   +1.793567571939970e-01   +9.033547832160935e-02   +3.855986430680063e-02   +3.466988114258584e-02   +8.131417395272231e-02   +1.127041931359124e-01   +3.913664484204804e-02   +7.930376017593875e-02   +1.267560697154838e-01   +8.200108654171837e-02   +1.796032139423962e-02; +7.159148161422549e-02   +4.459470699161347e-03   +9.706317593522049e-02   +1.164353781172507e-01   +5.278321473721247e-02   +5.682547388805716e-02   +1.692932323221756e-01   +1.793505789375501e-01   +1.269037074010546e-01   +3.912451986656281e-02   +1.867827573809199e-01   +4.363491955070296e-02   +4.107559233772595e-02   -1.704095344958082e-03   +1.017029017616200e-01   +4.390048637698754e-03; +1.263278622538832e-01   +1.281668276392725e-01   +1.620617295979952e-01   +8.504507029042319e-02   +1.814046988046377e-02   +1.592778342013445e-01   +1.621982934600824e-01   +7.891409097136176e-02   +8.585396671711525e-02   +7.346209890619584e-02   +8.987720719850593e-02   +2.823987042232737e-02   +1.601650756704608e-02   +3.023764142659146e-02   +1.555545084649820e-01   +1.131656273935748e-01; -1.761682388102753e-04   +4.527684717967828e-03   +8.957134143185808e-02   +1.171122277802897e-01   +3.879393185255822e-02   +1.456755785680028e-01   +8.483953516760670e-02   +1.782656660148163e-01   +8.592898240643730e-02   +5.293275127399862e-02   +1.628823446661215e-01   +1.667304650982080e-01   +2.129129776298654e-02   +1.732039566342042e-01   +4.066419663076921e-02   +5.735974321905397e-02; +9.158821314226087e-02   +1.210995287282701e-01   +1.163690400767416e-01   +1.333558005718870e-01   +7.313074439322383e-02   +1.565532555773552e-01   +9.342072288978676e-02   +4.966064070564855e-02   +1.016786734081123e-01   +1.589966242244440e-01   +6.801965260220282e-02   +1.302722077061161e-01   +4.368411458868474e-02   +5.983169880554995e-02   +1.669458938654416e-01   +2.980505523996177e-02; +9.268239862850862e-02   +2.672993513065302e-02   +1.578048808771840e-01   +3.314860219279479e-02   +1.149896660889237e-01   +5.851417829678755e-02   +8.084527878057285e-02   +3.912294022362490e-02   +8.812294040664677e-02   +9.104360994201519e-02   +1.349624720489201e-01   +4.672392998019868e-02   +8.798466496885772e-02   +9.954484326055112e-02   +8.710447769238262e-02   +1.330183388780715e-01; +5.641873464536490e-02   +1.263139211956969e-01   +1.747746429683085e-01   +1.206954094951636e-01   +7.329510782599025e-02   +1.125106247779332e-01   +7.095764168608633e-02   +1.522984561623441e-01   +1.786167461326578e-01   +7.139014906751164e-02   +3.076735954608384e-02   +3.258346283474534e-02   +8.087295609512488e-02   +1.775567918159859e-01   +9.251747344947405e-03   +4.517260199090255e-02; +1.058760498090983e-01   +6.346219837695011e-02   +1.427839134330421e-01   +1.169013822663190e-01   +1.125613695158432e-01   +2.850830997005538e-02   +1.069709496524023e-02   +8.450273540662756e-02   +1.455333604788437e-01   +1.236090538700778e-01   +5.199242734517455e-02   +1.401804099079202e-01   +5.354856864035784e-02   +2.016883541477911e-02   +1.333679569647435e-01   +1.166071367197572e-01; +3.557367069939375e-03   +1.261218466334472e-01   +1.239487575874102e-01   +1.261008273935208e-01   +1.930668071416249e-02   +1.627775132932003e-01   +7.874812632793511e-02   +8.303759739338147e-02   +8.852059542826181e-02   +8.800466487286746e-02   +3.302149872964272e-02   +1.679945898567862e-01   -1.792934594976380e-03   +1.402155698120168e-01   +6.908009501132227e-02   +9.053597681889873e-02; +1.287834517270945e-01   +2.349278963692491e-02   +1.652943480304811e-01   +1.530851706088769e-01   +1.189489662452312e-01   +3.499598476595259e-02   +1.739359067744563e-02   +5.842139321421269e-03   +1.389096769477818e-01   +7.858433142015940e-02   +2.228190631775222e-02   +1.029731501393875e-01   +1.564208171791034e-01   +4.568786399116327e-02   +1.582916907565230e-01   +1.173939335987048e-01; +7.502316069094886e-02   +9.412132681148171e-02   +9.247506592435795e-02   +1.451941440532874e-01   +1.619361054962834e-01   +3.850975730894075e-02   +1.200065235721618e-01   +1.081756685046050e-01   +4.841383227711384e-02   +5.127582916069936e-02   +1.345086516467741e-01   +1.773715206238502e-01   +2.582852054515694e-02   +1.321005595257748e-01   +1.418114263993627e-01   +3.642320229768861e-02; +9.805257501380880e-02   +5.540413183842983e-02   +2.022022729132449e-02   +4.300678703867398e-03   +1.795960979763169e-01   +1.648888118309077e-01   +1.062475560903449e-02   +1.282532921232982e-01   +1.306350660133478e-01   +5.598838638828567e-02   +2.373160997427935e-02   -4.503637332075603e-04   +1.691110461273962e-01   +1.742543380869540e-02   +1.026926692462728e-01   +7.765727776986493e-02; +1.218268210925792e-01   +1.360234338308658e-01   +1.644631759608073e-01   +2.961974100809842e-02   +1.188352795339048e-01   +1.288897789248894e-01   +1.315595386483009e-01   +1.193205065740722e-01   +1.679824439188131e-01   +8.043161977567495e-02   +7.636884449841462e-02   +1.670462004438498e-01   +1.522223261673699e-01   +1.313480237594392e-01   +8.891699906254834e-02   +1.658703734850827e-01; +1.599527638988619e-01   +1.227184281495565e-01   +5.670544922601077e-02   +1.104287146406913e-01   +2.176324326123434e-02   +4.698419107243793e-02   +1.479235304139645e-02   +4.797294167525772e-02   +6.442279084095845e-02   +1.341554703778454e-01   +3.817665843604309e-02   +1.507483677870741e-01   +1.028048298024682e-01   +1.164869448258026e-01   +7.772877842818758e-02   +5.945002041082766e-02; +7.128081158773380e-03   +1.012403727959060e-01   +1.547357481949009e-01   +9.922777658883096e-02   +5.042194804045557e-02   +3.337730666713540e-02   +5.672784762846014e-02   +7.503732563863028e-02   +3.937122425025977e-02   +1.866045111030582e-01   +6.125955146599195e-02   +1.025809972717957e-02   +3.401427515200057e-02   +1.369697597618808e-01   +2.768982833711275e-03   +1.256862071375925e-01; +1.475362164242229e-01   +6.676114552617059e-02   +3.602492429826079e-02   +1.760199376139385e-01   +2.083449207484631e-02   +3.024812457375961e-02   +1.646927487667847e-01   +2.839423196329543e-02   +1.072628586517294e-01   +1.461033199729146e-01   +1.229327266622957e-01   +3.020092466632712e-02   +1.419052860021769e-01   +1.435342840071681e-01   +1.723764822080448e-01   +1.609489362382240e-01];
L1E_L1I_iGABA_netcon = [+9.351590418258406e-02   +1.145432512151075e-01   +7.401720391132697e-03   +5.799668031101428e-02   +1.506020320131896e-01   +7.293477107378579e-02   +6.776987409373871e-02   +4.175915733110870e-02   +2.117037043119645e-02   +6.526846901245126e-02   +6.347721104370761e-02   +1.097707648071562e-01   +5.543456590456037e-02   +1.645780096431570e-01   +4.024446572578808e-02   +9.361262688971125e-02; +2.136179525659895e-02   +1.696240600067110e-01   +9.168646355230621e-02   +1.621506512535909e-01   +8.390686619940042e-02   +8.040769815170591e-02   +3.333854285530501e-02   +8.928789126966208e-02   +9.322709179481367e-02   +2.729551544333880e-02   +3.348229825751570e-02   +1.338147849563115e-01   +8.701842453259319e-02   +1.308512664527992e-01   +9.212294814461428e-02   +1.350478242385893e-01; +1.173739610193098e-01   +1.876302160432399e-01   +1.487978159201851e-01   +1.224601802800812e-01   +1.879210055868836e-02   +1.072601195871145e-01   +1.241334213771006e-01   +1.616611386004984e-01   +1.630649654424291e-01   +1.779467013946930e-01   +1.233528771942406e-01   +9.594474143545989e-02   +1.783598402101339e-01   +1.519778705055334e-01   +7.964692979527410e-02   +1.092663040765780e-01; +1.589640980891760e-02   +2.626694184659784e-02   +1.646836061139826e-01   +1.223853836754921e-02   +3.214118585699501e-02   +1.315367587235918e-01   +1.328556318321863e-01   +1.032399688349332e-01   +9.487840611588395e-02   +1.780972878953427e-01   +1.190005650601893e-01   +1.449483305921541e-02   +6.870910216597888e-02   +3.578628937399836e-02   +1.676885455732465e-02   +1.823427054358330e-01; -1.531486210024826e-03   +1.606747735966878e-01   +9.146852393530072e-02   +2.174655195437998e-02   +7.750154794189515e-02   +1.535661058212145e-01   +1.340276817997917e-01   +7.503444829888369e-02   -1.510442168464393e-04   +3.126619329640126e-02   +1.306885361647628e-01   +2.082982461829937e-02   +1.545965230299220e-01   +8.727673216053504e-02   +1.191486184562299e-01   +9.840277223907683e-02; +1.454318025680833e-01   +1.720389161967860e-01   +2.146712234391547e-02   +1.262500232776861e-01   +6.925448511630987e-02   -4.012814313427544e-03   +1.284258299823691e-01   +5.352449842098270e-02   +1.556252496394382e-01   +2.370144008438762e-02   +1.757251738938572e-01   +2.541669027351548e-02   +6.744874316072215e-02   +2.499158859597331e-02   +9.983058237603176e-02   +2.270411918759447e-02; +9.709673710149287e-02   +3.661500124909693e-02   +2.355650799754755e-02   +4.774741987015942e-02   +3.768408373407842e-02   +7.130296227568493e-02   +5.606046655413944e-02   +1.013439454374789e-01   +1.645235801232154e-01   +3.112339862176074e-02   +1.437016023309225e-01   +1.906004281854719e-01   +1.826090667072146e-01   +9.123024682914467e-02   +9.679256265547820e-02   +5.628262083011971e-02; +5.310486833999188e-02   +3.879175588207995e-02   -3.347120125179372e-04   +2.406804869637259e-02   +1.303160568748706e-01   +9.395602873177115e-02   +9.159319937047246e-02   +1.133254686006131e-01   +3.974966575497244e-02   +8.080193735172898e-02   +1.566907373723688e-01   +1.770292544319279e-01   +1.008258237384856e-01   +8.783752055653327e-02   +3.033017606784583e-02   +1.324612690329127e-01; +5.519375028816795e-02   +1.149506221614163e-01   +5.448653119040595e-02   +1.004719308005180e-03   +3.027122790871869e-02   +1.254832029892028e-01   +1.499811928431679e-01   +1.643069546684646e-01   +6.712234533920215e-02   +2.052687344314321e-02   +1.380201599922341e-01   +6.976258595316584e-02   +1.619880791838504e-01   +1.790283094509539e-01   +1.097624816027746e-01   +1.652248603283225e-02; +8.756837249302632e-03   +7.423550498594869e-02   +3.324512977957895e-02   +1.052125975974875e-01   +6.966829265126309e-02   +1.533494045546320e-01   +5.312788832003778e-02   +3.948440349397556e-02   +1.693228357299787e-01   +1.407777983526298e-01   +4.223304249690297e-02   +1.132054733730541e-01   +1.390381885140685e-01   +3.559524118227082e-02   +1.427841639012604e-01   +3.582368441297297e-02; +1.595471504418433e-01   +2.110667806589512e-02   +6.121919408934837e-02   +7.454173072471382e-02   +9.933401893919631e-02   +1.207444836158222e-01   +8.108305004893465e-02   +1.789189743232305e-01   +5.755349632002759e-02   +7.247962955548322e-02   +1.095565837269312e-01   +9.362318688632859e-02   +4.335253830941380e-02   +1.787731012226216e-01   +1.618248856744332e-01   +6.245657686500718e-02; +3.404603849875524e-02   +1.688061547167160e-01   +1.059665885544008e-01   +1.704089674441395e-01   +1.794588593661627e-01   +1.210198210537949e-01   +9.095122109029265e-02   +3.068797605803533e-02   +1.324840776105781e-01   +9.114387827489148e-02   +6.295671116691789e-02   +1.503519322381155e-01   +1.302814339736486e-01   +8.622659357279140e-02   +1.488565120639497e-01   +4.508489096298374e-02; +1.304525419789428e-01   +2.046011700526667e-02   +1.022873174161425e-01   +2.444901099086423e-02   +9.857836164131174e-02   +1.097541764155443e-01   +1.106196208810220e-01   +4.282602466977110e-02   +1.374348561185380e-01   +1.605062022540394e-01   +3.460912889232435e-02   +1.412907685959726e-01   +1.785334018764332e-01   +1.158341382726503e-01   +6.512392513385454e-02   +2.263819382009378e-02; +4.507748758501760e-02   +5.240647473370366e-02   +4.515878887336899e-02   +1.841010506478477e-02   +3.827589037536881e-02   +1.611311915046965e-01   +1.739151574720065e-01   +1.397032107009465e-01   +8.216723998612489e-02   +1.171344739425141e-01   +1.833644643326751e-01   +1.362842001277038e-01   +1.152678841110749e-01   +1.592911136058527e-01   +1.201728933785969e-01   +1.336129556911105e-01; +7.856929150554787e-02   +3.180163213136022e-02   +8.539212424890918e-02   +1.569977404564431e-01   +1.130551744504416e-01   +9.441464654987916e-02   +2.129399789864607e-02   +6.111903144833692e-02   +3.078335114498780e-02   +9.821885483121622e-02   +5.179629661988083e-02   +8.160192024410870e-02   +6.555420214151796e-02   +4.168461892616330e-02   +2.620961246752854e-02   +5.616541972468406e-02; +8.186650211471960e-02   +8.379880026166549e-03   +3.836081321399472e-02   +1.689277372014221e-01   +1.765792051849332e-01   +1.443651740876338e-02   +3.562250080957026e-02   +1.494317678355661e-01   +1.500577320719299e-01   +2.319037994290718e-02   +7.021833062663250e-03   +1.130169317785267e-01   +1.225082409766123e-01   +9.839316622675517e-02   +7.338587096653126e-02   +8.697570700265637e-02];
L2I_L1I_iGABA_netcon = [+1.827703011706358e-01   +9.326249866183060e-02   +5.259929473562849e-02   +1.598439041825805e-01   +1.731594497031397e-01   +1.713019709257314e-01   +6.682231738161798e-02   +1.445874642195668e-01; +1.469767372907238e-01   +1.557273535758334e-01   +1.295740021417535e-01   +5.424166037391838e-02   +7.850093800468975e-02   +1.249368431778688e-01   +1.691516617308281e-01   +4.477129301263851e-02; +3.893026566832213e-02   +4.175739920604557e-02   +4.934294888636571e-02   +5.440855280322274e-03   +1.486125695956958e-01   +1.771080809735355e-01   +1.985733689567592e-02   +1.115180537292034e-01; +7.393046608689260e-02   +1.465361326209149e-01   +1.249340645838329e-01   +1.169489747614888e-01   +1.153662241131025e-01   +1.138933633852876e-01   +9.341956251107184e-02   +1.473784256268660e-01; +6.084689814587260e-02   +2.956992509039617e-02   +1.138662896365408e-01   +1.100137794052417e-01   +8.899726734841221e-02   +1.405147948524678e-01   +9.217588724949677e-02   +1.056636486980432e-01; +1.426089051370238e-01   +1.350954938062979e-01   +1.705175722400107e-01   +8.062033559520873e-02   +5.144122180784961e-02   +1.288025135947992e-01   +1.847858336725984e-03   +1.300842643075269e-01; +2.265091473453950e-02   +6.832311274790678e-02   +6.811712010134942e-02   +4.851745408937796e-02   +1.342840071005957e-01   +4.873938691384253e-02   +3.918750458359623e-02   +1.225109948183536e-01; +1.080053355866234e-01   +6.523481391654544e-02   +1.497405962808206e-01   +7.560413664380644e-02   +5.371886352688540e-02   +1.333622037020203e-01   +8.566978473852825e-02   +6.102892583927329e-02; +7.595713369299462e-02   +1.281487628113546e-01   +3.622046763585603e-02   +4.426738009596391e-02   +5.905856742927001e-02   +2.863827228576341e-02   +7.792256886170337e-02   +1.792419596556443e-01; +1.015443921436235e-01   +1.242696422036933e-01   +4.531892814372136e-02   +9.918026415918213e-02   +7.584204511678727e-03   +1.325621937429936e-01   +1.672125041280554e-01   +1.216726727719719e-01; +9.978075946338003e-02   +1.477814962780097e-01   +1.567967653783585e-01   +6.191273131272400e-02   +1.327244685489343e-01   +1.780784446000652e-01   +3.775477108421822e-02   +4.896560182520222e-02; +1.457144211042741e-01   +9.326177390777612e-02   +1.067557073857602e-01   +7.805934088812402e-02   +1.796982038801405e-01   +4.937873334007876e-02   +1.185852875290746e-01   +6.749346179333683e-02; +5.838498995498537e-02   +1.793874954743014e-01   +1.690381223729827e-01   +3.841056173139226e-02   +1.048685857954550e-01   +6.154119651398895e-02   +5.947550565315446e-02   +1.008655366640438e-01; +1.349281446175760e-01   +4.575848708288567e-02   +1.857714376684209e-01   +9.525433027601178e-02   +1.519251174259351e-01   +3.358373795917231e-02   +1.756946477664824e-01   +4.583171725193776e-02; +1.830600748397469e-01   +3.955658349603367e-02   +5.209820485933678e-02   +1.734193327805120e-01   +1.247509722633446e-01   +1.898974161733088e-02   +7.490080438996650e-02   +1.292193982880814e-01; +3.733746931986807e-02   +1.323948156650378e-01   +1.290830198148423e-01   +1.163020397062599e-01   +1.562841324013148e-01   +2.136395494697186e-02   +1.849682035256145e-01   +5.409807033905390e-02];
L1I_L2I_iGABA_netcon = [+1.090710829430383e-01   +1.263823171192223e-01   +5.393194595379690e-02   +1.342277150709607e-02   +9.835155118635534e-02   +6.507277419375775e-02   +1.781567698006795e-01   +1.307692945650775e-01   +7.354397331802270e-02   +1.404049783643921e-01   +2.572499748008897e-02   +5.671706419742294e-02   +1.865832358579280e-02   +3.377185010281772e-03   +3.347398685474846e-02   +1.506699930304784e-01; +1.489078895818354e-01   +1.129930284348033e-01   +7.512591109745557e-02   +8.679637028652985e-02   +1.725442160936723e-01   +8.480411327120020e-02   +1.229569870200546e-01   +1.769451827904235e-01   +8.515521844741131e-02   +1.794909152870302e-01   +1.192959323453952e-01   +6.865126561334994e-02   +8.812231669806811e-02   +1.477503212069356e-02   +1.933404027109111e-03   +1.658281764901633e-01; +1.597560631678488e-01   +1.093305582433007e-01   +3.544614533979858e-02   +1.511470513427354e-01   +6.100074706317565e-02   +1.618963421329906e-01   +1.369065238270414e-01   +1.223688482595577e-01   +6.983979123838066e-02   +6.935386309522286e-02   +1.267477967620415e-01   +7.390264512928986e-02   +6.169213023872970e-02   +3.154203442971230e-02   +1.122004865524553e-01   +2.533622219641839e-02; +7.131381226257544e-02   +7.178527849004492e-03   +1.107343359107536e-01   +1.586651221328343e-01   +1.852506340633739e-02   +4.295070210580953e-03   +6.782053884921065e-02   +6.099550205005667e-02   +1.424970130087093e-02   +1.208286925942879e-01   +1.039569134500671e-01   +8.836581547418716e-02   +4.123243587198348e-02   +1.313347428662429e-02   +1.473536038626038e-01   +9.799033400007857e-02; +1.450203077979225e-02   +1.545393914767444e-01   +1.509838496827323e-01   +1.240543650103129e-01   +1.107312092309615e-01   +9.378185874284570e-02   +1.158351165057475e-01   +1.574612957355894e-01   +1.136051618488838e-01   +4.006541209675441e-03   +6.223243202958578e-02   +4.231795596445324e-03   +4.857165455684995e-02   +1.622134466386613e-01   +3.768503023720920e-02   +9.104343297711849e-02; +1.177657897433997e-01   +1.333955315369666e-01   +2.313539688509134e-02   +1.634831230456307e-01   +1.086150681397161e-01   +1.781366596492771e-01   +1.349009436410455e-01   +1.554692275365764e-01   +1.023878480138333e-01   +1.059350671935101e-01   +1.848151921773805e-01   +1.499527558622622e-01   +2.941037014848731e-02   +1.658583380899025e-01   +1.344007546315627e-01   +1.695036652735099e-01; +1.405655041831660e-01   +2.196573510388267e-02   +1.580740098981155e-01   +1.840802557562969e-01   +7.501248991858529e-02   +1.804424164787823e-01   +9.621464193925276e-02   +9.001690143966715e-02   +3.577454258507676e-04   +1.068221854297309e-01   +5.617434958205982e-02   +6.391890488966283e-02   +1.434741221105841e-01   +7.536775193556394e-02   +1.505005251895334e-01   +1.045168127410141e-01; +1.340708745949783e-01   +1.563297346669122e-02   +1.654088350346504e-01   +1.317014783862537e-01   +1.705976592352318e-02   +1.473840927635496e-01   +1.115349668646780e-01   +1.453354671063066e-01   +6.265055077196077e-02   +1.635487027192536e-01   +5.196481355384844e-02   +9.352922044167040e-02   +9.442519350457937e-02   +5.722285122860816e-03   +1.639282878849913e-01   -1.797604059334117e-03];
L2E_L1E_iAMPA_netcon = [+1.470807598734948e-01   +5.570885627466497e-02   +2.770654707759334e-02   +1.838275765856057e-01   +7.564893137098831e-04   +8.866814573238939e-02   +1.272061801946987e-01   +1.859081218188089e-02; +1.771848189428634e-01   +1.581100003186298e-01   +1.040886845888145e-01   +7.152063899948735e-02   +9.231933743426046e-02   +3.653769902672635e-02   +1.704249894952526e-01   +7.595589595625619e-02; +1.771514365002938e-02   +2.334734755402487e-02   +5.615815120163326e-02   +2.591444536144643e-02   +1.153134824227734e-01   +1.519579779322724e-01   +5.776531889519321e-02   +5.886034857935592e-02; +5.181991974798430e-02   +1.334309198863493e-01   +3.605954344261166e-02   +1.261830404022377e-01   +1.410310355819831e-01   +5.492521346327295e-02   +1.689449331133532e-01   +1.532427020637221e-01; +3.048386350501641e-02   +1.848883739191906e-01   +2.579372790927770e-02   +3.875641031521298e-03   +1.707777755433966e-01   +1.756981789175212e-01   +1.231201365088561e-01   +8.196879343217721e-02; +1.291851758939948e-01   +9.331614720859915e-02   +1.750635783809245e-01   +1.423182668933621e-01   +1.278103515504037e-01   +4.567180997083140e-02   +1.443274814503369e-01   +1.269721960534137e-01; +1.742545220877710e-02   +6.086947784354651e-02   +4.798796904484631e-02   +8.361881873307984e-02   +1.675305104113636e-01   +8.694834521387036e-02   +3.200663086468276e-02   +6.459940739105718e-02; +8.969740103150494e-03   +2.438686902237379e-02   +9.686045981195715e-02   +1.227165536361292e-01   +7.034592277621977e-02   +1.658295371580900e-01   +1.748106228426047e-01   +1.701207809523385e-01; +6.693639501808507e-02   +1.621745494288140e-01   +7.325184622584776e-03   +4.741571339161913e-02   +2.572609414812260e-02   +1.819488167202176e-01   +1.069903522366055e-01   +1.556220575460480e-02; +4.930944445059943e-02   +5.171948440242761e-02   +1.588250912506936e-01   +7.031815721388421e-02   +1.492475520908145e-01   +1.552760079991827e-02   +2.474961502378840e-02   +1.732653741509981e-01; +1.086499812621640e-01   +8.818999353043437e-02   +3.360913589469610e-02   +1.124647877195008e-01   +7.933560307139596e-02   +7.878567304366164e-02   +1.118494510828977e-01   +1.643712115261695e-01; +4.558494269232988e-02   +8.413706328564145e-02   +1.507144793856351e-01   +1.368677296123822e-01   +1.244110615194966e-01   +3.317971043834681e-02   +1.875799411942877e-01   +4.587723108342395e-02; +1.081898241536203e-01   +1.560108265561164e-01   +4.432917441066700e-02   +8.831733685946719e-03   +1.805954525797815e-01   +1.264450966328562e-01   +7.749104336648129e-02   +1.501888550701257e-01; +7.458855586440825e-02   +9.272163964602075e-03   +2.038598495789196e-02   +1.281346073757663e-01   +1.404596374686502e-02   +5.519713273392440e-02   +9.179348551175805e-03   +1.404837397607480e-01; +5.299338079545744e-02   +3.731550639745289e-02   +1.284597302660910e-02   +1.427933842282957e-01   +1.708833546376896e-02   +1.661402693602146e-02   +7.540580708000418e-02   +4.149682612180345e-02; +2.813348830121969e-02   +8.587379978909493e-02   +2.018263486283947e-02   +9.755234361335675e-02   +4.684311251263461e-02   +1.004818317823448e-01   +2.175230202444350e-02   +1.512460773141517e-01];
L1E_L2E_iAMPA_netcon = [+6.701121370670746e-02   +2.853310792980595e-02   +1.756105520030144e-01   +1.739828112723795e-01   +5.911828484323386e-02   +1.797153160630713e-01   +9.111796576160047e-02   +1.804576891156338e-01   +2.573743488671125e-02   +1.198198858935078e-01   +1.139360712522084e-01   +1.416131293009562e-01   +6.915411677539909e-02   +1.248879405209747e-01   +1.053735088450109e-01   +9.084306821045537e-02; +7.216962237782616e-02   +9.475705281922930e-02   +3.864013661097934e-02   +1.434512874234416e-02   +1.421878517296794e-02   +1.196073350424803e-01   +1.387635894384632e-02   +6.169145070554430e-02   +4.706480756156212e-02   +6.456158571952289e-02   +4.919441077802860e-02   +1.747758144675444e-01   +2.823632897231377e-02   +4.681209555776165e-02   +1.092576448536953e-01   +4.830455171101044e-02; +6.423879329631203e-02   +1.091134431571794e-01   +1.680472766119261e-01   +1.689787646096796e-01   +1.739943240491259e-01   +2.110149667431729e-02   +5.807280239024626e-02   +1.541688834664019e-02   +7.797743547195143e-02   +1.107177773994919e-01   +5.615468642119942e-02   +2.132848843137351e-02   +1.336792657348865e-01   +1.130096718745825e-01   +1.581834733662717e-01   +1.592455826880372e-02; +1.407038509171419e-01   +7.591789019897746e-03   +4.120988202278685e-02   +3.516734271115795e-02   +1.320668446224544e-01   +5.864100814466493e-02   +1.712306994968059e-01   +1.632057621768535e-01   +1.403142186332795e-01   +1.459395753888536e-01   +8.448815663680821e-02   +9.918432015083098e-02   +1.730509456964502e-01   +6.241147885247653e-02   +1.713662706455767e-01   +1.813683213424836e-01; +2.781257367689629e-02   +1.633903066182067e-01   +1.601902267030975e-01   +7.325901629301476e-03   +3.208891181331566e-02   +1.502698528266397e-01   +1.678758979700322e-01   +3.240847269306619e-02   +1.083444653261543e-01   +7.854527462233639e-02   +1.045283163716814e-01   +1.416394907922846e-01   +4.561995484440720e-02   +1.038050821070116e-01   +1.840674578480486e-01   +1.094607968842850e-02; +9.740746519025225e-03   +1.615754597602979e-01   +5.185425459770496e-02   +1.544908256928620e-01   +1.853571048381409e-01   +1.622251079525761e-01   +1.000629612165905e-01   +1.710819462413908e-01   +6.112873957749789e-02   +7.594739347836657e-02   +1.574337461570901e-01   +1.669940374634032e-01   +1.541977287895368e-01   +1.152151190347314e-01   +3.713484979463026e-02   +1.025018730352039e-01; +6.131452866822133e-02   +3.808023637886047e-02   +1.074633904963224e-01   -3.868945819543935e-04   +7.181622485702024e-02   +9.413324980387891e-02   +1.420035033415453e-01   +1.094826044315763e-01   +1.085468896493201e-01   +1.489325133095967e-01   +1.230772426037725e-01   +2.482598515306186e-02   +7.279469758131224e-02   +1.036215191063252e-01   +4.688085052961151e-02   +6.007908400392607e-02; +1.405987417968435e-02   +9.641029262337471e-02   +8.625247253091356e-02   +7.576156920337569e-02   +1.373928021498544e-01   +1.822069270722376e-01   +1.764751044495720e-01   +1.198457827604058e-01   +1.612184705726644e-01   +7.943194333086150e-02   +6.340328301030820e-02   +1.803439922136024e-01   +1.253106266540337e-01   +1.681002399138542e-01   +6.109050582494488e-02   +1.832494107176388e-02];
L2I_L2E_iAMPA_netcon = [+1.207142660470524e-01   +4.545991550203369e-02   +1.659366106774929e-01   +8.801299481785051e-02   +1.447760568226845e-01   +6.104731009336199e-03   +3.115502719435420e-03   +1.684138303057849e-01; +3.110959425392149e-02   +1.887572427973539e-02   +3.537913400350038e-02   +1.567593271563966e-01   +1.432820353561008e-01   +7.164399200454374e-02   +1.288404616911710e-01   +9.028108991872655e-02; +1.540613791937001e-01   +1.379471366339615e-01   +1.509842518029952e-01   +1.392832170583941e-01   +9.664239735162609e-02   +9.390660536905072e-02   +9.247183971035544e-02   +1.391178710172038e-01; +7.234381947327945e-02   +2.972826068090070e-02   +1.693490851144218e-01   +8.216764045472429e-02   +1.754043683981759e-01   +3.010747522770180e-02   +8.412910314180978e-02   +1.552639082592283e-01; +1.235042716238640e-01   +1.592483395925368e-01   +1.156638053825894e-01   +1.122641686388450e-01   +1.674950981410327e-01   +1.376438709480416e-01   +7.747510672766528e-02   +1.333860836767190e-01; +1.125612083534640e-01   +3.343854345661140e-03   +1.612273142727228e-01   +1.375772053949293e-01   +9.800757660750425e-02   +3.890732020818615e-02   +2.240827971479108e-02   +1.279528321742088e-01; +1.800303126674403e-01   +8.705491477963749e-02   +3.262364678059009e-02   +7.808541105182144e-03   +2.368673727879927e-02   +3.914712086101439e-02   +3.021473974052883e-02   +3.965743225253757e-02; +1.712647494128775e-01   +5.479848302867189e-02   +1.035055516625180e-01   +8.505294286126658e-02   +1.579206139741891e-01   +4.858052102601246e-02   +2.047075770844789e-02   +8.340266559592899e-03];
L2E_L2I_iGABA_netcon = [+1.727160027800109e-01   +4.111975947705192e-02   +3.699428668734988e-02   +3.046798977823531e-02   +1.243801682778651e-01   +7.121792449757450e-02   +1.558797590920613e-01   +1.762478754758609e-01; +4.482155040767341e-02   +7.610311707144345e-02   +2.573385940211828e-02   +6.513222896264284e-03   +1.857764973422649e-01   +1.326106590547390e-01   +1.413166937744366e-01   +1.422297259564990e-02; +1.192098952424966e-01   +6.857922690716260e-02   +1.035589746305661e-01   +1.510829159028598e-02   +7.217282007410224e-02   +2.042538955935241e-02   +1.750175297893004e-01   +1.561370927331213e-01; +1.552795415796849e-01   +1.391089801573368e-02   +4.898699693559445e-02   +1.361538491666299e-01   +1.711316477295699e-01   +1.193303454827636e-01   +8.101695643782011e-02   +1.230795927736268e-01; +3.062781102135222e-02   +1.687142854237453e-01   +1.031290655528219e-02   +1.504230961465332e-01   +5.560548881532362e-02   +6.658273131254376e-02   +1.113036993814596e-02   +4.999707322751405e-02; +1.364898203837010e-01   +6.060857409269090e-03   +9.918574051823016e-02   +1.451087371899252e-01   +1.640548244163192e-01   +4.864687657657415e-02   +1.735204922913210e-01   +1.373467663910551e-01; +2.721717963826499e-02   +1.840183931838606e-01   +5.423788886099372e-02   +6.137592415177083e-03   +1.351651124719664e-01   +9.709307026408064e-02   +1.074022368929623e-01   +1.121325944817302e-01; +1.614971038544918e-01   +6.097981302512889e-02   +9.233289197502587e-02   +3.960613681866521e-02   +8.694554561145529e-02   +1.440291990028865e-01   +1.763181768776203e-01   +1.170959392177340e-01];
L3E_L2E_iAMPA_netcon = [+5.963469475071748e-02   +1.229120229047448e-01   +2.756234818301727e-02   +1.606151523207033e-02   -3.378555326459051e-03   +1.829091205547039e-01   +7.281958723975004e-02   +1.595677665523643e-01   +1.792895586052774e-02   +5.195744392096682e-02   +4.767628583380192e-02   +1.280944420249294e-02; +5.151773526182042e-02   +1.717904631158774e-01   +5.485082395429688e-02   +6.357261968479788e-02   +8.755595422604903e-02   +1.010980174591128e-01   +1.636116286044350e-01   +1.826419949644161e-01   +1.086203924938085e-01   +1.771861095238584e-01   +6.023798001782766e-02   +4.474286755251469e-02; +1.281134432036699e-02   +1.442087271470182e-01   +2.039147273145646e-02   +1.381306395893672e-01   +1.827837931922338e-03   +3.146908274372877e-03   +9.671110476593128e-02   +1.803554736306079e-01   +1.131452019881217e-01   +1.129443884503824e-01   +4.654115563166327e-02   +1.238510778130198e-01; +1.057150318239579e-02   +3.559681258993521e-02   +1.509921091508913e-01   +4.852595859826406e-02   +5.368363961712003e-02   -5.464095430295124e-03   +6.195232626138931e-02   +1.119686075343542e-02   +3.535063091628139e-02   +6.528318573929963e-02   +3.818146270638675e-02   +5.886073776866899e-02; +1.672052100140567e-01   +6.715776049558629e-02   +6.102308704370615e-02   +1.799510359057797e-01   +1.282505269008719e-01   +6.732614591987129e-02   +1.818610319523406e-01   +2.817203450336698e-02   +1.550187813403667e-01   +8.807682811973271e-02   +1.277383412653816e-01   +7.004713024575551e-02; +1.658720218190647e-01   +1.125862080346860e-01   +1.904863352339090e-02   +8.660246095138004e-02   +1.175125308525036e-01   +1.764150184721495e-01   +1.670310979604987e-01   +6.840654491493074e-02   +8.692751888440886e-02   -1.123038648078998e-03   +1.216911496019524e-01   +4.731504374870441e-02; +1.175904092631724e-01   +9.659713935898571e-02   +1.182871984553463e-01   +4.265235524083635e-02   +1.228298809443411e-02   +6.988275285585288e-02   +2.202398293058757e-03   +6.675744000207505e-02   +5.691620042638412e-02   +1.800423259683929e-02   -4.952972975783358e-04   +8.506465952771064e-02; +1.522764623948029e-01   +2.398002279781996e-02   -1.432471965553244e-03   +5.284076329508136e-02   +9.963854993724949e-02   +1.950040665353117e-02   +5.182913702372649e-03   +8.453606610614157e-02   +8.890013818800185e-02   +1.542258671222059e-01   +1.745031136130125e-02   +1.146485746005861e-01];
L3I_L2I_iGABA_netcon = [+1.768150366595988e-01   +9.512814160207675e-02   +1.211252635149758e-01   +5.182299870154089e-02   +1.790744404567889e-01   +7.696989651071572e-02   +9.910747391428176e-03   +3.181301050456033e-04   +1.591154821299314e-01   +8.613428606553876e-02   +1.641161941797286e-02   +1.394531692526980e-01; +1.653872454511566e-01   +1.792415279007612e-01   +1.611658737216775e-01   +3.221134344396850e-02   +9.217756565179880e-02   +1.522094681556267e-01   +9.624999088418447e-03   +4.187714972152440e-02   +9.059460683048617e-02   +1.248639863734777e-01   +2.525641831757468e-02   +1.185835347396382e-01; +2.215783339982593e-02   +1.607752988216711e-01   +1.690613677868616e-01   +2.699129785344295e-03   +1.262809739304261e-01   +3.902942824496120e-03   +1.152426341369704e-01   +1.746600649703866e-01   +1.319285366343576e-01   +6.816364013996270e-04   +1.182959400676478e-01   +2.204290096378803e-02; +1.816908905651276e-01   +3.636075637018652e-03   +8.490122159880001e-03   +1.211256535964517e-01   +1.630979730641511e-01   +9.950176157777933e-02   +4.239714107962775e-03   +9.906410446552574e-03   +1.632261559164817e-01   +1.499291094188954e-01   +1.876549138442359e-01   +9.781122806991223e-02; +3.207729746330360e-02   +1.781575022550631e-01   +7.558898623620385e-02   +8.108579470068143e-02   +1.099760553738683e-01   +1.724778941605135e-01   +7.385578947382447e-02   +2.782695142425982e-02   +1.890673270700773e-01   +9.474816143977123e-02   +4.204963061142639e-02   +3.324884993807208e-02; +1.012025094581579e-02   +1.228203270679756e-01   +3.668745672063829e-02   -1.700209580810886e-04   +2.513620674350124e-02   +1.229209928622014e-01   +1.293394958525670e-01   +4.618030719148881e-02   +7.468723357112958e-03   +1.398475512829167e-01   +1.600292032489883e-01   +1.259193385457266e-02; +1.131970575854398e-01   +1.637500446915005e-01   +1.073336239713456e-01   +1.271370372978736e-01   +7.868188699589408e-02   +5.306320578574222e-02   +1.265212446268919e-01   +3.719082922425863e-03   +1.581539373367458e-01   +7.120355431868730e-02   +8.982326184352982e-02   +1.330217025587043e-01; +9.455234585092367e-02   +3.174163078820268e-02   +6.448353672763482e-02   +1.125996795751020e-01   +6.463139746245079e-02   +2.082438955977740e-02   +4.495583090041209e-02   +4.948286737974102e-02   +1.047193654482065e-01   +1.752901347963656e-01   +5.005197551728750e-02   +5.456165599551026e-02];
L2E_L3E_iAMPA_netcon = [+1.248989289567789e-01   +1.241392029472437e-01   +4.673549846404725e-02   +1.541094306995500e-01   +1.222307917613961e-02   +9.209789841024060e-02   +1.292231016816670e-01   +1.758574744939504e-01; +1.015660870632405e-01   +1.356795878380831e-01   +1.381365079445006e-01   +1.450185940695057e-01   +1.393472618903860e-02   +1.008511074715367e-01   +1.579290503965471e-01   +1.276668054661002e-01; +1.517221162802398e-01   +1.610212843899703e-01   +1.543257189284918e-01   +1.720872167332940e-01   +1.072343255246726e-01   +1.176877773050225e-01   +1.611330905941969e-01   +1.087866693224395e-01; +7.142314338886437e-02   +1.778188192901179e-01   +1.592017815753709e-01   +1.117314118546664e-01   +9.096848465544380e-02   +9.841580292149828e-02   +5.332971750886210e-02   +3.234628786788879e-02; +2.594315683083774e-02   +1.018427116514948e-01   +4.766118005708631e-02   +1.722190741684059e-02   +3.351824193511473e-02   +9.699824541797326e-02   +1.626098971488558e-01   +1.396160199769133e-01; +8.655406018674447e-02   +1.886101533965360e-01   +1.664227945037632e-01   +1.041396111101348e-01   +9.457356394040677e-02   +1.805425218633482e-01   +1.354804138250494e-01   +1.808336398931869e-01; +8.782271198298880e-02   +1.747078962672207e-02   +9.642706479709454e-02   +2.176981302707844e-03   +6.293935425250036e-02   +1.492213705294622e-01   +6.734843635358956e-02   +1.421741677682485e-01; +1.736862674761032e-01   +1.268595604153836e-01   +8.675989897559676e-02   +1.485805465066149e-01   +6.511416949102815e-02   +1.442299191674022e-01   +9.269789532367205e-02   +7.661633038915146e-02; +9.140343006740946e-02   +1.028567705444018e-01   +1.657374957418866e-01   +1.161074190965267e-01   +1.089124710869229e-01   +6.588439831993174e-02   +1.068329438494938e-01   +1.245634676310037e-01; +4.409355973899483e-02   +2.695797558893851e-02   +1.437680153439560e-01   +1.610671591626385e-01   +1.673868430159587e-01   +5.437629016428435e-03   +2.893254360259343e-02   +1.166834990704944e-01; +1.085127253010070e-01   +5.956426357150497e-02   +1.355667427967295e-01   +1.527060868073921e-01   +1.678920369534060e-01   +1.828651955557283e-01   +4.511009841200636e-02   +6.235430266286938e-02; +2.196016170077441e-02   +1.101374555782630e-01   +8.034060105870014e-02   +1.631139042959767e-01   +8.837488063637440e-02   +4.174183465360878e-02   +1.149085531121251e-01   +1.621937209858229e-01];
L2I_L3I_iGABA_netcon = [+1.744311797724864e-01   +7.922536375488734e-02   +5.154031112792513e-02   +1.277854395307042e-01   +1.352218617834020e-01   +1.578728346394950e-01   +3.314054282219586e-03   +9.376142573506759e-02; +1.033919048265229e-01   +8.573068976784468e-02   +1.273051577276477e-01   +2.998541919217186e-02   +1.668983498383431e-01   +1.517990304062740e-01   +8.455803680528119e-02   +5.320648600014758e-02; +1.432552104880662e-01   +1.359710678277020e-01   +1.766881887439403e-01   +1.095799271233712e-01   +6.492721383381951e-02   +1.114294406303591e-01   +7.708309718714876e-02   +2.760818685502620e-02; +3.995910546824345e-02   +1.524722819004027e-01   +3.699722193698568e-02   +9.280257235131792e-02   +8.835571249277686e-03   +6.156650394108435e-02   +7.399461369688042e-02   +1.853509624423285e-01; +5.770166180343510e-02   +7.234397600271690e-02   +9.286954499639921e-02   +8.636014531412964e-02   +7.359726022805850e-02   +1.192273018669396e-01   +1.650360881677416e-02   +2.732455827428729e-02; +4.309151583501058e-03   +5.232585286803552e-02   +7.141064100039314e-02   +3.384310005512279e-02   +6.705559935492388e-02   +7.586005180955965e-02   +9.781108187732235e-02   +1.330361929901067e-01; +6.729146211110755e-02   +8.630664310498160e-02   +1.779790459829646e-01   +1.143809305813149e-01   +1.377332716472035e-01   +5.707548074131560e-02   +5.870650045050707e-02   +5.841398505365929e-02; +6.087708937610171e-03   +1.848942281926359e-01   +5.830035750862716e-02   +1.625684319193137e-01   -1.794138203138989e-03   +1.395781851139045e-01   +1.032284259528834e-01   +1.415680245883611e-01; +1.629210450630231e-01   +5.346332018926180e-02   +1.564909097584532e-01   +8.531456154201745e-03   +9.409449970835472e-02   +5.420876864911656e-02   +7.843800812390744e-02   +8.058742398817655e-02; +1.363374816207882e-01   +9.848068902867570e-02   +4.723235289380440e-02   +9.461884951632038e-02   +1.133763663944943e-01   +6.380260533645597e-02   +3.904775192739961e-02   +5.904450669936932e-02; +1.359200351382087e-01   +1.802816828223156e-01   +9.979970768658843e-02   +1.265742301173743e-01   +5.519750196155349e-02   +6.792237239464158e-02   +1.733418629975028e-01   +2.196105100366537e-02; +1.426891102384337e-01   -2.103776694705096e-04   +6.585067995994347e-02   +2.698709744840888e-02   +2.904995228798912e-02   +1.813926382262962e-01   +9.291540966611316e-02   +1.011373346413237e-01];
L3I_L3E_iAMPA_netcon = [+8.173709660979921e-02   +1.862197895898492e-01   +4.594778526808848e-02   +1.141991787883016e-01   +1.442812656290262e-01   +6.082622125634871e-02   +5.229505924425638e-02   +4.540001864312869e-02   +6.391036511365071e-02   +5.107942048555926e-02   +4.799257526989538e-02   +9.313242422404413e-03; +6.739074159946203e-02   +1.631707007076483e-01   +3.670325985366524e-02   +2.940876295227000e-02   +1.503090225828935e-02   +1.032658475259937e-01   +1.039230480452933e-01   +9.690298626625825e-02   +4.020676981428339e-02   +8.990526904199765e-02   +1.353919899222659e-01   +1.015596001947602e-01; +7.248941357360737e-03   +1.126173319558012e-01   +8.820940654691395e-02   +1.069771703240367e-01   +9.084099115340374e-02   +7.786655228121109e-02   +9.424021954894067e-02   +8.574016394493111e-02   +6.970339006964749e-02   +1.034143180475294e-01   +8.558866842461268e-02   +1.036759997012319e-01; +6.982703477676910e-02   +1.344330240809439e-01   +1.186717007535878e-01   +8.190522527298054e-02   +8.189222243481406e-02   +1.646425067659991e-01   +1.426887873820705e-01   +2.504848140205344e-02   +1.746779732751048e-01   +1.625750313572732e-01   +3.315094961267508e-02   +1.397445463901304e-01; +2.245645670993303e-02   +6.322680679901796e-02   +3.941577959801990e-03   +1.536553324114720e-01   +1.423289992268816e-01   +1.022505088963029e-01   +1.772321356422004e-01   +1.140365593456330e-02   +1.697798795394103e-01   +1.072699272450580e-01   +6.314906874827317e-02   +1.837265279732333e-02; +6.582414076798297e-02   +1.171905055570487e-01   +1.539485889016971e-01   +8.077581766032844e-02   +1.829117612140381e-01   +7.009797148929851e-04   +1.600644301066365e-01   +5.384322586716765e-02   +1.247080803106260e-01   +5.058753970818833e-03   +6.204086583898492e-02   +3.173013268054346e-02; +1.459553995754301e-01   +7.164706237698357e-02   +6.831382753840563e-02   +5.205424831819156e-02   +1.223690450125719e-01   +3.478779149903938e-02   +9.965640492516470e-02   +1.698616480727101e-01   +1.540277163395570e-01   +1.836148215608613e-01   +1.042886693162900e-01   +1.306516208503880e-01; +1.371317179326656e-01   +3.923497796730324e-02   +1.297598782236155e-01   +1.154441627505811e-01   +1.846856817983237e-01   +1.104827036480280e-01   +1.648292089719022e-02   +9.336703120701098e-02   +7.946150770533704e-02   +5.577168130631107e-02   +4.203561053561545e-02   +1.699469297196822e-01; +1.488153944178308e-02   +1.543175973312799e-01   +1.345987953020475e-01   +1.491881298365144e-01   +6.573230859424523e-02   +1.385523702960947e-01   +3.247753714543724e-02   +1.448492523028948e-01   +1.529917804317164e-01   +8.426083173680909e-02   +3.885110291989177e-02   +3.774363763365356e-02; +1.728702380250438e-01   +1.501168362883566e-01   +7.698643761559926e-02   +3.481776370620698e-02   +1.045119254243165e-01   +1.472868726685287e-01   +9.378529958384405e-02   +1.623595583643632e-01   +1.272580838060053e-01   +6.079128767981454e-02   +1.617065170470031e-01   +4.030382579751158e-02; +7.808577942102800e-02   +6.833057196221368e-02   +1.854159240652064e-01   +1.728411944822991e-01   +5.164091183204910e-03   +1.128193545004293e-01   +1.277895532306579e-02   +4.464790197014958e-02   +7.252707860032556e-03   +1.826753871747403e-01   +1.376296949472658e-01   +6.962781768135839e-02; +1.552549084122661e-02   +3.306923282983140e-02   +8.090620529772913e-03   +8.004597477686883e-02   +8.257516662138538e-02   +4.157457629907592e-02   +1.500179326338865e-01   +3.162743533245280e-02   +5.884317106175587e-02   +4.759864580780650e-02   +1.405604094301800e-01   +5.488771428570548e-02];
L3E_L3I_iGABA_netcon = [+3.588872801209421e-02   +8.407737385457269e-02   +6.209703606374370e-02   +1.668749102094835e-01   +1.514997259276345e-01   +9.888104606617371e-02   +6.313488965126603e-02   +1.416874614087235e-01   +1.161573953763850e-01   +1.362865861172853e-01   +1.149836387626553e-01   +4.951761491923055e-02; +1.430332589449029e-01   +1.191350781667959e-01   +6.279408523798891e-02   +9.026559062558062e-04   +6.575607213691455e-02   +1.368234694373330e-01   +1.229914379568478e-01   +1.812251614581494e-01   +1.546573080517613e-01   +8.476029121294078e-02   +2.492193079688819e-02   -1.751181015283047e-03; +1.089951900263644e-01   +1.808845169127440e-01   +1.813191484340692e-01   +1.527118495540631e-01   +5.176585514660327e-03   +1.405906723339608e-01   +1.126388046754374e-01   +1.269583612412864e-01   +7.553004121330699e-02   +7.699957502459302e-02   +4.912640215595308e-02   +2.361612570820072e-02; +8.100632472295889e-02   +2.042957364049238e-03   +3.142432938469124e-02   +1.300392755611963e-01   +1.297245398790803e-01   +4.868635006735825e-02   +7.890752431292639e-02   +7.016194028387401e-02   +1.805479275071279e-01   +8.758357967573986e-02   +6.016452515413352e-03   +1.122149449989285e-01; +8.234194827172132e-02   +7.668181855452817e-02   +1.859835004456018e-01   +4.604005683840023e-02   +9.452215319886278e-02   +1.409791738620347e-01   +1.804800437874914e-01   +1.752040386251899e-01   +4.618691109164525e-02   +1.107938782856562e-01   +1.548551489753617e-01   +1.009844031121125e-02; +1.269788295210305e-01   +8.901105399939206e-02   +1.554530366513644e-01   +1.327157319155160e-02   +1.024282233875362e-02   +1.856537724370198e-01   +1.250298002290143e-02   +1.065306307785789e-02   +1.524778221931360e-01   +1.075985202908546e-01   +4.747842250379091e-02   +3.927934152216946e-02; +1.035535558200663e-01   +6.689342171161226e-02   +9.454098253989321e-02   +1.053758202053437e-01   +1.246827511942188e-01   +9.101688889164986e-02   +5.888076500000984e-02   +6.210454677619900e-03   +6.604146576518410e-02   +3.058830430248892e-02   +6.015115304846685e-02   +1.315778634028083e-01; +5.593250801959008e-02   +2.503289416730530e-02   +2.236833084979502e-02   +1.666353494453746e-01   +8.354067490513140e-02   +1.448340989078514e-01   +9.736630113056888e-02   +1.416403875827243e-01   +1.461016065846956e-01   +1.559294439482564e-01   +2.935270365443236e-02   +1.118563557375888e-01; +4.904002261813631e-02   +3.345982769556560e-02   +1.439636750090255e-01   +5.100048148566620e-03   +1.733624740821536e-01   +1.634369803497386e-01   +3.248672191689597e-02   +1.363541847921515e-01   +4.280509309143229e-02   +7.106282006865312e-02   +8.068711281041724e-02   +1.097568390930317e-01; +1.521127991785225e-01   +5.941216679099622e-02   +1.521565284236272e-01   +5.955481123865668e-02   +6.976261270000103e-02   +1.812610186563174e-01   +1.389641914361172e-01   +1.049966640714116e-01   +1.744429787132428e-01   +1.818431069508548e-01   +3.410449698196961e-02   +8.219774810958900e-03; +9.768558404115128e-02   +2.603633675311510e-02   +3.798298131391142e-02   +3.952058727082503e-02   +1.446536654246019e-01   +9.488950195855413e-02   +1.616911484847653e-01   +1.136445695725102e-01   +1.083112832554262e-01   +3.709199896979607e-02   +1.385869019253222e-02   +1.466271936743536e-01; +1.201311630388878e-01   +9.257314320188255e-02   +1.846069733820221e-01   +1.282053921221659e-01   +3.923032556851095e-03   +9.312449804276321e-02   +1.822746798568866e-01   +1.546682907468559e-02   +1.403769827117261e-01   +7.151381362954044e-02   +8.896015402767073e-02   +7.541627109647228e-02];
L2E_Input1_iAMPA_netcon = [+1.845582641295667e-01   +1.886292677291114e-01   +1.898643459340507e-01   +1.873637650748110e-01   +1.879904681160345e-01   +1.932448530901193e-01   +1.881124976878442e-01   +1.858800093440557e-01];
L2I_Input2_iAMPA_netcon = [+1.853988074627741e-01   +1.928526039932311e-01   +1.846954409004073e-01   +1.859393366526840e-01   +1.836835364961457e-01   +1.858310287023808e-01   +1.843683318212934e-01   +1.827718848161690e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
