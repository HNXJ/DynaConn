function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.228048366773553e-03   -4.704776090046853e-03   -3.780782783094289e-02   +2.948212312567854e-02   +7.945069267792595e-02   +7.197254916992901e-02   +4.928844420627237e-02   -2.433310548366786e-02   +5.081719461647715e-04   +5.052873945932775e-03   +1.023138969002696e-01   +4.096404162567051e-02   +2.501310011838303e-02   +6.951372156073528e-02   +5.686740465870016e-02   +6.685953724281572e-02; +6.132664680684379e-02   +2.983966761771245e-02   +4.498108011233819e-02   +1.158858970029325e-02   +2.798585283169048e-02   -2.333461205102682e-02   +4.549079745233400e-02   +8.269733406851438e-03   +6.320930715586455e-03   -3.924240367749281e-02   +7.529759883622140e-02   +1.117927440114842e-02   -5.538177569065306e-02   +9.488783998542380e-02   -3.639687631627362e-03   +2.270937981220139e-02; +4.834719987346719e-02   +5.803447310727271e-02   +8.499967368659382e-02   -7.315119182108974e-03   +8.535250135733245e-02   +5.167593923627975e-02   +6.705526299324485e-02   -4.623232663092418e-02   -2.111114047380117e-02   +1.181850089277721e-02   +7.317721870894109e-02   +3.863646033215088e-03   +1.367392505068349e-02   -5.272422361770546e-02   +2.172081199291522e-02   +3.102623805838341e-02; +1.127708102697659e-02   +5.805035649501943e-02   +3.267239077227924e-02   +2.731138152134784e-02   +2.679073697857572e-02   +1.119825828121570e-01   +4.087734172861109e-02   -2.617488963287029e-02   +4.411872337530470e-02   +7.101349769167714e-02   +6.362036380307237e-02   +2.812392114847608e-02   +4.288719474837531e-02   +6.884209372955560e-02   -4.221256932803408e-02   +1.146387301567832e-02; -9.022575483909997e-03   +1.093679787249568e-01   +2.596952040667212e-02   -2.991207987598533e-02   -3.608361003106339e-02   -5.161623672429476e-03   +7.797829568113424e-02   -2.199928540649854e-02   +2.557789999194590e-02   +2.604536544421145e-02   +5.865354240634152e-02   +9.676959154232878e-02   -4.091612974108472e-03   +4.849774775220370e-02   -2.515179899584686e-02   +5.033293436703423e-02; +1.333947461140385e-02   -1.862051171070471e-02   +5.597543193635875e-02   -2.683632960691116e-02   +7.088669400213661e-02   +2.512302840128781e-02   +1.012368988197772e-02   +4.859330311673363e-02   +1.136759277398165e-03   +6.261524560608606e-03   +1.957021917134080e-02   +2.015088623873432e-02   +3.311604795832001e-02   +6.846683471299891e-02   +4.647368740992555e-04   +1.077922294955113e-01; +7.745034571302563e-02   +3.738739731697203e-02   +4.253517725418554e-02   +2.174243197278154e-02   +8.715948401951530e-03   +6.162549120065541e-02   +1.142486994214996e-01   -2.494699480592217e-02   +1.122378693002700e-02   +8.756988035031081e-02   -1.830343764365115e-02   +5.899605851898031e-02   +3.613435032750610e-02   +2.687321473597903e-02   +9.882399431068363e-02   +3.366827582697430e-02; +6.833108146979247e-02   +6.640308643589138e-02   +2.618844635005348e-02   +4.225154519564625e-02   +5.749440736888770e-02   +9.453319881004606e-02   +4.144676725755907e-02   +8.599466198489637e-02   +5.453621676653256e-02   +3.279419846298777e-02   -3.344943412672732e-02   +2.416443407924421e-02   +2.523520907224667e-02   +2.366755347067202e-02   +7.022042503866696e-03   -2.354269976407686e-02; +1.015636800052451e-01   +6.340134142945925e-02   -5.634099307717317e-03   +1.358399376754002e-01   +1.713580176463044e-02   -2.194916037554866e-02   +1.713843452228402e-03   +1.126234153612500e-02   +1.007115967893659e-01   +3.442786066509766e-02   +6.462463051066167e-02   +1.186899747494673e-02   -6.325064413250529e-02   +1.088425448411819e-01   -6.133872038961768e-03   +3.255716827538190e-03; -1.291622944551601e-02   +4.422694880164453e-02   +1.169366042145630e-01   -4.303455777652986e-02   +2.893283297084462e-02   +5.115326456444052e-02   -1.319228079804143e-03   +4.567892521145469e-02   -8.368303478270597e-03   +8.997112207427109e-02   +6.775478823377153e-02   +3.432833430384970e-02   -1.642420355087396e-02   +2.994259032533757e-02   +5.079893795235658e-02   +4.092453528573174e-02; +6.186675229317531e-02   +4.817395559456932e-02   -1.789422641838487e-02   +2.335918657754626e-02   +1.310796110825276e-01   +4.121682627857005e-02   +8.681338690931598e-02   +9.920039297862110e-02   +2.503265041256995e-02   +5.851306321985953e-02   +2.877992954615937e-02   +8.472042414691772e-02   +9.134972562617286e-02   +1.752732774173700e-02   +2.760618180054347e-02   -7.034915046545532e-03; +4.675469322194542e-02   +6.082146895278381e-02   +2.692509482832161e-02   +4.930111400078430e-02   +6.629962800844567e-02   +1.972274607637541e-02   +2.001931207367971e-02   -3.053501659730752e-02   +5.618308829510133e-03   +1.073105599888749e-02   +2.614722514205734e-02   +7.936784345530815e-02   -5.676593409053341e-02   -8.567641433024312e-03   +4.871541498318507e-02   +6.310306995098430e-02; +9.590940987052431e-02   +1.238448632840860e-02   +5.662168988041133e-02   +4.273431681489565e-02   +2.694582440267796e-03   +1.982158743542210e-02   +8.412486438788787e-02   +7.335958540411714e-03   +7.488601518983036e-02   -2.172612974899733e-03   +2.224449462515687e-02   +9.530032398282283e-03   -3.755222781138381e-02   -1.752252001205979e-02   +3.271494971114530e-02   +3.879334117674779e-02; -4.054835473383204e-03   -3.529266728080254e-03   -4.123434727592616e-02   +5.905036764302865e-02   +5.091947758989918e-03   -2.291526760907050e-03   +8.178739167854153e-02   +1.373552990905275e-01   -7.159303811547758e-02   +5.658500781909540e-02   +1.211629257647865e-01   +1.282150345871489e-02   -2.412045214677917e-02   +2.531176865528345e-02   +5.246346790375671e-02   +8.458210579218348e-02; +4.598617097499438e-02   +5.122469851456996e-02   +2.362376671325840e-02   +1.099005572465210e-01   +4.377356223282248e-02   -3.206532750799401e-02   +7.325291886162598e-02   +6.214561574072523e-02   -1.578461896844617e-02   -1.021976783372043e-03   -2.423683374141952e-02   +1.166209886826809e-02   -1.299964780275976e-02   -8.200006651544637e-03   +1.000591898139821e-01   +8.101569768381978e-02; +6.293157963728380e-02   -1.229941051449928e-02   +1.178997975300984e-02   +8.241985004885330e-02   +1.175748934201796e-01   +5.560928979141376e-02   -7.470935070882027e-03   -4.576391841708103e-02   -2.146145769157024e-02   -9.688966557274091e-02   +8.115507265876145e-03   +7.715287274702964e-02   +7.492519244443474e-02   +7.352252277063699e-02   -3.005872287484368e-02   +8.649007216908257e-02];
L1E_L1I_iGABA_netcon = [-4.869836452896076e-03   +6.707069522159405e-03   +5.193170499244932e-02   +7.288087813080493e-02   +2.774372588326408e-02   +1.055284621690420e-01   +9.774798302653907e-02   +3.816223807997050e-02   -4.470881287944191e-02   +7.094985423144880e-02   -4.152714317533203e-02   +5.486440286730659e-03   +9.741380706531329e-02   -1.158156243716391e-03   -1.797688271042279e-02   +1.320675901651267e-01; +2.667572259682403e-02   -4.519403966827305e-02   +3.668879993867750e-02   +1.149242163529276e-02   -5.602688350416595e-03   +2.986835707547991e-02   +3.132514407204923e-02   +6.779480825920024e-02   +2.194471987254110e-02   +1.552975900368318e-02   +2.824735591615588e-02   -1.972404038274850e-02   +3.965554866199052e-02   +5.347046304798386e-02   +3.586721131805613e-02   -1.077468912172453e-02; +1.475598362227511e-02   +6.300153092669204e-02   +4.632989690567388e-02   +9.401764185379204e-02   +3.041551505280405e-02   +7.550051942404172e-02   -3.207353570264956e-02   +6.179948471493613e-02   -7.807615132572589e-03   +3.543173447474774e-02   +4.975474530744378e-02   +1.030751312187409e-01   +4.887171788603723e-02   +3.050397808859735e-02   +4.265999316081408e-02   -1.747998489670794e-02; +5.532139311720082e-02   +3.236597013639535e-02   +3.748521608038897e-02   +2.379533272905568e-02   +5.691953020536381e-02   +1.242807635426845e-02   +3.008825257292920e-02   +5.899025211294627e-02   +3.275261159338691e-02   -9.341067380999046e-03   +3.075273398725772e-02   -3.561752765144362e-02   -2.097180536533909e-02   +7.871876183229023e-02   +7.580484750952218e-02   +6.165735462286241e-02; +3.786922042340992e-02   +4.813456346666481e-02   -1.594190901416468e-04   +4.584507480278468e-03   +7.777076518292050e-02   -2.293979029963382e-05   -6.888371444357967e-02   +3.042029877680280e-02   +3.861033057732990e-02   -1.285648214334510e-02   -5.119450661448367e-02   +4.766555229599136e-02   +1.245571406195837e-01   +3.919045755054230e-02   +1.859190804968215e-02   -3.715545834185065e-02; +4.665355497351040e-02   +4.783113259624477e-02   +1.385373883806033e-02   -4.746904288594985e-02   +3.829831170072232e-02   -1.124205968384599e-02   +8.074285519299704e-02   +1.134964688272954e-01   +1.119037786771484e-02   +3.626114405553762e-03   +7.710383659117903e-02   +2.252316303010284e-02   +7.453373548337888e-02   +7.626081574351781e-02   +3.914124600866135e-02   +1.112893463905228e-01; +3.148108595087128e-02   +2.695276816541771e-02   +6.510847442659828e-03   +6.544741350430991e-02   +9.177716769085680e-02   +2.347961080652725e-02   +5.272909736949316e-02   +2.902900326740456e-02   +5.049898932543586e-02   +5.920804499994263e-03   +1.371208134411851e-02   -1.141679734081372e-02   +1.565126410536122e-02   -6.036685683148031e-04   +1.918494277947735e-02   -5.955333490103177e-03; +2.674825909598888e-03   +4.925706190959780e-02   +6.580461848997505e-03   +6.528223214680767e-02   -3.698526217368253e-02   +2.954785521394486e-02   +1.228360298897279e-01   +3.414847803272363e-02   +4.783521000355889e-02   -2.476579387122790e-02   -2.795541327004950e-02   +9.651488372973338e-02   +2.568524943804851e-02   +7.405937073272547e-03   +3.093867727180674e-02   +2.490661361529444e-02; +2.926875657575464e-02   +1.948656384082664e-02   -1.941004960827262e-02   +8.253080703806714e-02   +4.112294046678190e-02   +7.606939527889811e-02   +7.978933620415408e-02   +2.728040977240360e-02   +6.831016155398961e-02   +2.446426598316022e-02   +4.117208144441654e-02   +2.454257172500906e-02   +6.334400072304620e-02   +3.699915553136371e-02   +5.800603554153824e-02   +1.027975643001549e-01; -1.290596357091545e-02   -8.553329197119557e-02   +3.165506589029928e-02   +9.364774918785393e-03   +1.037859945358810e-02   +4.461000398609543e-02   +3.772342326012790e-02   +7.338916257634746e-02   -3.822091710560729e-02   +6.804884827057950e-02   +2.288253421048582e-02   -1.997437312912213e-02   -1.442629855707274e-02   +1.242670021752428e-02   +3.036886686967778e-02   +2.944956924914011e-02; +6.227177689021718e-02   +2.577544184507214e-02   -1.485015373549100e-02   +1.679536540831562e-02   +1.583511052258751e-03   +4.132519081564429e-02   +1.008569163550235e-01   +8.335617963202879e-02   +6.197477207321801e-02   +3.484829151807391e-02   +4.088463049525977e-02   +7.827907179141408e-02   +6.170168918008569e-02   -1.646005813725144e-02   +8.920358720795220e-02   +9.528706661492397e-03; -3.549549214408572e-02   +8.191007040872791e-03   +4.843491964211832e-02   +2.944043014493438e-02   +1.822876626901717e-03   +8.510927071972572e-02   +3.678357107164797e-02   +3.335886561381070e-02   -1.302404746323326e-02   +6.042563537635872e-03   +1.261467875885469e-03   +4.045994842949258e-02   -9.130130669718323e-03   +8.583939438490347e-02   +3.416934901097106e-03   +2.810575845920436e-02; -2.529987965041279e-02   +8.890618713907188e-02   +1.795956859054194e-03   -5.815400834788982e-02   -1.155721010591589e-05   +3.962090265907314e-02   -1.262765065295793e-02   +9.736222290708474e-02   +8.309127716355051e-02   +2.380191974707078e-02   -1.478087959769003e-02   +6.332516693087625e-02   +2.403139365972958e-02   +9.245183744421398e-02   +2.469792676656161e-02   -3.881558860585680e-02; +7.631890938274366e-02   +1.663091163141044e-02   +7.118315522683903e-02   +7.418891534094003e-02   -1.373522099801410e-02   +1.887204030348245e-02   +1.085883968784350e-01   +1.037935865524850e-02   +3.953826545086865e-02   +7.650333452129668e-02   +1.999601838745859e-02   +6.116469106799756e-02   +1.099107293555987e-02   -1.565058838679462e-02   +1.264578004327778e-02   +1.588739400253969e-03; +4.723662286275982e-02   -5.732121997011922e-03   -5.989330766821723e-03   -1.587548196943048e-02   +5.397126079234148e-02   +7.967767448135971e-02   +9.321094873047612e-03   +1.357927522589435e-02   -1.191931777220047e-02   +7.400444904199481e-02   +4.937340165360867e-02   -1.231561031604850e-03   +7.436543870628946e-02   +1.358931891740194e-01   +1.390546443297649e-02   +5.992277284627814e-02; +2.931321947832413e-02   +1.832396459770997e-02   -5.357490529481989e-02   +4.522488985384398e-03   +7.928658989081865e-03   +5.522658522595808e-02   -3.376395667025778e-02   -7.007098776494174e-03   -1.592674810054911e-02   +6.128614593894522e-02   -1.626112504978273e-02   -1.233276396578467e-02   -1.134518429458015e-02   +2.477253032757198e-02   +8.831955321049884e-02   -2.130439624543182e-02];
L2I_L1I_iGABA_netcon = [+2.278710031617746e-02   +6.035115847499908e-02   +1.202588868165313e-01   +2.847288335152155e-02   -1.019239059679908e-02   +2.450110059617774e-02   +1.877437786084114e-02   +5.372418281915734e-02; +5.700782754028370e-02   +3.902918883454658e-02   +1.347588272905489e-02   -3.843922065038498e-02   +4.479558937236433e-02   +7.661951231031414e-02   +3.992962287231153e-02   +4.360833029216449e-02; +5.406914321497248e-02   +1.693321310732028e-02   -4.119864791838574e-03   +3.119013954211634e-02   +3.982487900249480e-02   +3.057311880216268e-02   +2.386829832801771e-02   +3.102708836223407e-02; +3.329970410598333e-02   +2.218983191809270e-02   +3.036457533730501e-02   -1.664387956970458e-03   +6.774486867753025e-02   +4.307448869362902e-02   +5.942057598756305e-02   +7.043428061067281e-02; +2.245245313510291e-02   +3.536430404069672e-02   +1.051349077516001e-01   +2.455728811459983e-02   -8.130147698144335e-03   +1.192803373537184e-01   +3.205236287286493e-02   +6.567597551013082e-02; +3.586872137315480e-02   +6.619346326792096e-02   +1.402497904692593e-01   +7.736397831033334e-02   +7.830781867443221e-02   +9.001020922257195e-02   +1.412492376344008e-03   +7.102084077160935e-02; +1.600607574218297e-01   +1.165320099192122e-02   +5.211379459701494e-02   +1.465105284498619e-03   +4.271849272786032e-02   +1.235350345380136e-01   -1.106562604790868e-02   +8.525554561772997e-02; +8.591262804514610e-02   +5.199760579717121e-02   +1.982996816475541e-02   +8.421568169141867e-02   +1.263744398921845e-01   +2.586612130368165e-02   +3.312919227334242e-02   +2.524065946915739e-02; +6.558701889676305e-02   +2.527862627092835e-02   +1.007495386386667e-01   +9.952452449171071e-03   -1.845096563365796e-03   +3.446497682866830e-02   +1.902912518433021e-02   +5.445973346900215e-02; -7.046625594077116e-03   +1.746562859232514e-02   +3.950916770990623e-02   +1.859117845408245e-02   +5.395377929716863e-02   +5.584114933484779e-02   +5.397524573949866e-02   +5.080821320672868e-02; +3.877149045407886e-02   -2.068243306224669e-02   +2.858586382060779e-02   -1.002328784458988e-02   +4.428740484169455e-02   +1.392301152905014e-02   +1.167727073878302e-01   +2.751370279702894e-02; -7.957982804948648e-03   +1.189010059355647e-01   -2.422377832855968e-02   +1.531828118965986e-02   +4.516206140493082e-02   +1.857899753477841e-03   +7.926412517340473e-02   +4.437333585546475e-02; -1.777301357315013e-02   -1.032848398013510e-02   +2.641663955738587e-02   +2.300684180496695e-02   +1.467526864181565e-03   +3.039245208880442e-02   +8.337528921077009e-02   -3.965928007904874e-02; -2.236593819716014e-02   +6.189300887667804e-02   +2.608648752238873e-03   -4.535582442204242e-02   +2.709741665221598e-02   +5.463695547826890e-02   +3.956670446956227e-02   +6.609052700714796e-02; -2.408763331751453e-02   +3.385415900678011e-02   +3.634690093040448e-02   +5.366130691173380e-02   +7.648323647343641e-02   +1.523052849908137e-02   -3.106728962951196e-02   +4.644993836173316e-02; +1.320235444920991e-01   +2.012661871416636e-02   +2.781734367821306e-03   +6.840430175774335e-02   +1.029500708987372e-01   +1.131714753728234e-01   +4.858271278197283e-02   +4.973670678214487e-02];
L1I_L2I_iGABA_netcon = [+3.956072625378212e-02   +6.481063486440371e-02   -6.107203952764871e-02   +5.446072715691883e-02   +1.509096539264371e-02   -4.418989504052675e-04   +1.226555797682999e-02   +2.781191996453506e-02   -4.295047544296514e-02   +5.236772600844588e-02   +2.207729520307146e-02   +4.047188440312775e-02   -7.973916953469802e-02   +1.179731653760704e-01   +7.924277810562298e-03   -5.641993786844475e-02; +1.053434760446620e-01   +9.165427800698425e-02   +8.489800362013055e-03   +8.373628819969926e-02   +4.180457730479276e-02   +3.808970967033917e-02   +5.581718193800544e-03   +1.043924879665348e-01   +2.324725471070428e-02   +8.957568231401164e-02   +1.764150768934875e-02   -3.587107974013992e-03   +6.224366263984565e-02   +7.116863323300282e-02   +4.668365845764347e-02   -1.858723957988836e-02; +6.036477517627967e-02   +4.714486788745253e-02   -4.457530294755771e-03   -2.960038954389915e-02   +9.660040847251769e-02   +8.817276800589607e-02   +4.010886343562466e-02   +7.909199603571629e-02   -8.625609391634748e-03   +5.167612372614980e-02   +6.569817650324952e-04   +4.274297468042367e-02   +8.425258639239319e-03   +5.132848658665827e-02   +3.561788602053852e-02   +1.146174481386809e-02; +7.568483395366840e-03   +9.128625920292270e-02   +3.810439858521199e-02   +4.342615699131385e-02   -5.801156415276882e-03   +8.491627243518954e-02   +8.225025336700374e-02   +4.305364532032312e-03   +3.495218470902922e-02   -3.813492736589616e-03   +1.180647684899013e-01   +6.405650387932267e-03   -1.180021584811979e-03   +1.102179446824746e-01   -9.346148299805160e-04   +1.679747072631934e-02; +1.439635469436421e-02   -2.283808928078750e-02   +4.870653735220203e-02   +3.182370906534468e-02   +9.428144546629533e-04   +6.077545511811722e-02   +3.713289637648892e-02   +1.276422588807662e-02   +2.753696254425599e-02   +5.691101390797520e-03   +3.058272800497192e-02   +4.421764204787950e-03   +4.071123061493109e-03   -2.550915057891239e-04   +1.284057840435304e-02   +2.643864352686564e-02; -9.037578955455636e-03   +3.526521503741298e-02   +1.834331825730794e-02   +3.776938152789579e-02   +3.521826955700937e-02   +1.780859183660579e-02   -2.407154264453524e-02   +4.745031818295155e-02   +7.857287099176619e-02   -3.003189513673606e-02   -6.229312012341169e-02   +6.225697531024169e-02   +8.505486453731964e-02   +6.354970353440095e-02   +9.208886633471668e-02   +6.271285939019867e-02; +6.053089892696404e-02   +4.996290747727738e-02   +3.297547291856540e-02   -5.391612060226544e-02   -3.447167319198798e-02   -7.444649635916123e-03   -4.726929729093383e-02   +4.572848820022637e-02   +7.774592011626538e-02   -5.797906920395517e-04   +7.066363349576574e-02   +4.138788236934642e-02   +6.720077135774850e-02   -3.621236255219650e-02   +8.499998360615599e-02   +1.921770382169894e-02; +4.391876211242741e-02   +7.521101942967583e-02   -7.319819384597873e-03   +4.963398128896917e-02   +5.736882114239243e-02   +1.031626775521199e-02   +2.958783163165746e-02   +4.355623921970661e-02   +7.036428381027224e-02   +4.846487165877367e-02   +5.188142350623155e-02   +8.688968388712881e-02   +5.924059318614655e-02   +2.516403412867023e-02   +5.290059085024409e-02   -8.708715529127995e-03];
L2E_L1E_iAMPA_netcon = [-6.825886912926154e-03   +9.148107960917543e-02   +1.228751544183937e-01   +3.406172923025719e-02   +2.167268486342140e-02   +1.833574677467096e-02   +3.063726312761954e-02   -5.484658849372723e-02; +1.370927868508409e-02   +2.711268817058832e-02   -4.109559498283787e-02   +7.485852525830942e-02   +9.628291628527727e-02   -1.646934002848564e-02   +9.094559377444889e-02   +7.923335772443572e-02; +2.193905098585893e-02   -1.208340540485163e-02   +1.178122371735583e-01   -1.307857756509174e-02   +1.128398385610542e-02   +8.732474378666902e-02   +4.147744003084015e-02   +4.197686385926917e-02; -5.345948151233553e-04   +5.329992869504334e-03   +1.138892151275708e-01   +3.766802296958464e-02   +7.213803351774489e-02   +1.790023900649763e-02   +8.886816025404090e-02   +1.217862145971331e-02; +1.470483223785532e-01   +5.574637651910602e-02   +3.431687994628620e-02   +9.916554711308882e-02   -6.818258948405659e-02   +2.533868567376430e-02   +7.227242829326829e-03   +9.786900134955129e-02; +9.909408459417667e-02   +6.781032701762320e-02   +3.747494782067143e-02   +3.241485163470875e-02   -2.779336218891813e-02   +5.427328800153380e-02   +3.177582064377778e-02   +8.792332087550911e-03; +8.684496206019873e-02   +9.175608234615445e-03   -1.056622777704657e-02   +5.938854889148514e-02   +2.126586785580909e-02   +1.109640725106681e-01   +1.318536614136936e-01   +5.442843295366149e-02; +6.412253394400055e-02   -2.120141594914635e-03   -5.356687204430275e-03   +6.160669198286205e-02   +3.556677438305878e-02   +3.450973640571564e-02   +1.046420074631570e-02   -1.881224390958589e-02; +1.196287228487621e-01   -1.285963862396650e-02   +8.414149942426646e-02   +3.480007417190985e-02   -3.297597475767024e-02   -6.958378743542538e-03   +1.446838631746870e-02   +9.708552427474818e-02; +5.922036738342392e-02   -1.637492997110839e-02   +5.265613306822316e-02   +3.651551353818083e-02   +1.199425478921632e-01   +1.833057643020213e-02   +1.138737936441233e-02   +5.226219363543456e-02; +2.673562018822722e-02   +1.149928537060870e-01   +3.469628475716018e-02   +2.355728257740681e-02   +1.738542600667938e-01   +1.763096103537827e-02   -1.318175494274858e-02   -1.209293971993968e-02; +4.536419929079188e-02   +3.169695781598104e-02   +1.015673254273107e-02   +1.137884385228684e-01   -6.724688491464324e-03   +2.026227049996099e-03   +6.729185054549246e-02   +6.611684004621084e-03; +3.291063890406862e-02   +3.291542394507786e-02   +6.749382560270854e-03   +2.076822671081865e-02   +5.753245835385380e-02   -1.601610214170483e-02   +8.001132290926663e-02   -4.443650782864337e-03; +8.274940358586762e-02   +1.000060759897824e-01   +3.707470987248185e-02   -2.689312989159532e-02   +1.919656098283570e-02   +9.729878932219443e-02   +2.839519336332769e-02   +6.043472162035511e-02; -3.903304526162294e-02   +7.738154110815819e-02   +3.646921159690853e-02   +1.832859427730118e-02   +2.282358108911471e-02   +8.287064889649252e-02   +1.286629674185980e-02   +6.104185143297823e-02; -1.808981853170395e-02   +2.665068156940736e-02   +1.662145380754914e-02   +2.499880455312305e-02   +7.670314282023284e-02   +2.982199811811948e-02   +6.736990552714453e-02   +2.855129473535794e-02];
L1E_L2E_iAMPA_netcon = [+3.323384514949695e-02   +2.188264216231384e-02   +3.904447925958333e-02   -2.718872769724753e-02   +9.170938549696640e-02   +8.649818128833953e-02   +8.053034855457214e-02   +1.354933923695346e-01   +7.363289030442068e-03   +6.443853009488804e-02   +8.735274300712963e-03   -1.395371076037277e-02   +2.905923898144699e-02   +2.056901711813597e-02   +1.158673762832568e-01   +2.591733508362346e-02; +1.043506876586673e-01   +1.018534260325475e-01   +2.874219690612853e-02   +8.552176390572901e-02   +2.522668777784672e-02   +2.475963927402685e-02   +9.018047559403640e-02   +9.493297338628243e-05   -1.772599668276688e-02   +5.065789868334391e-02   +4.972247309212981e-02   +6.342461744332185e-02   -8.524187530657290e-03   -1.637166998281694e-02   +3.689169264804595e-02   +5.874426220755782e-02; +8.665644609252270e-04   +1.221925708609032e-01   -3.544489644379757e-02   +4.984447389452863e-02   -1.252456104014230e-02   +5.250875637455216e-02   -8.406104068576430e-02   +1.383675086880257e-01   -7.497305006145918e-03   +3.177210876650257e-02   +8.097095034203727e-02   -5.742511808811201e-02   +5.526090293481262e-02   +3.825570237912737e-02   +8.962728735087372e-02   +1.161804206261550e-01; +5.151795928819580e-02   -1.012147136210104e-02   +2.150958167023184e-02   +1.720584182958439e-02   +6.141787277289404e-02   -1.315721715867141e-02   +9.348923855824417e-03   +1.177062547428514e-01   +3.108019197630278e-02   +6.442521332776006e-02   +4.503586560838627e-02   +5.363284664054315e-02   +1.340787983124680e-01   +1.486067150630539e-02   +1.617651610878643e-02   -5.569574075136885e-03; -4.319704465432068e-03   -9.167316409169660e-03   +5.562375502673508e-02   +6.295051609336454e-02   +9.352991826729792e-02   +2.526149345781754e-02   +1.622478075389210e-02   +8.030535663512262e-02   +7.158319394489748e-02   +5.269001117863228e-03   +1.438407722530922e-02   +1.044669844858431e-01   +9.560186726152695e-02   +1.902903483423189e-02   -6.271413757777980e-03   +6.253203061646147e-02; +2.417475601061717e-02   +6.272053385374596e-02   +1.497138177362115e-02   +1.076378458614825e-01   +3.949990666542035e-02   +2.256635049916588e-02   +5.686722073151049e-02   -1.151298624719145e-02   +1.863396560100861e-02   +5.857230830614864e-02   -3.755153352010340e-02   +4.203985895700859e-02   -1.019833635714602e-03   +7.758923404138533e-02   +6.248012150071165e-02   +2.528088784621312e-02; +9.406332183671041e-02   +2.025802372770286e-02   -3.731813850276883e-02   -7.267030549743587e-02   +4.307056393064940e-02   +9.176518093327639e-02   +1.879405288699512e-02   -5.161023200671155e-02   +1.610962486247344e-03   +1.748682740696135e-02   +6.484508666612900e-02   +2.658583986691690e-02   +2.877753908301173e-02   -2.239999503759088e-02   +2.377623208297135e-02   +3.651420781058572e-02; +2.286755089656340e-02   +3.038857410040218e-03   +6.728253645438256e-02   -5.385324495697442e-03   +3.793282685749522e-02   +9.608868798497354e-02   +2.254571274823736e-02   -2.179475439388038e-02   +5.523250094409318e-02   +1.161621820663615e-02   +7.755692021986831e-02   +4.625039614062572e-02   +9.203004857239308e-02   +8.010624787405904e-02   +5.558678177458270e-02   +1.179776553814590e-01];
L2I_L2E_iAMPA_netcon = [+1.105236901515993e-01   +2.328418718508540e-03   +5.281142067365670e-02   +3.806544301608665e-02   +7.143895296886360e-02   -9.053287175895174e-03   +2.510244077502052e-02   +4.869165831606746e-02; +1.092548422531247e-01   +7.032122565372396e-02   +2.939133283291932e-02   +6.468909260957841e-02   +5.977465234780407e-02   -5.455666077945745e-03   +6.128514241039734e-02   +3.009012474888343e-02; +6.709112111815620e-02   +1.995239382539894e-02   +2.992364513416354e-02   +8.830612485652554e-03   +1.164115085187230e-02   +8.846732853562807e-02   +8.897586318798557e-02   +6.378063604516246e-02; -3.588814077092143e-03   +6.968823159894652e-02   -7.522306450177919e-02   +2.266602922877844e-02   +8.147918348359379e-02   +4.928024695473737e-02   +1.238596991444220e-02   +1.617151338548325e-02; +9.061868696535254e-02   +2.533019515960411e-02   +2.415308434006511e-02   +6.120831361256921e-03   +3.213007938764484e-02   +6.423608253615555e-02   +1.843549173746790e-02   +9.244965378666370e-02; +4.123648818689937e-02   +8.205715748609493e-02   +2.741678298530268e-03   +1.021816267462637e-01   +4.174655968627575e-02   +6.609537673613408e-02   +1.991405784146760e-02   -2.470419220221108e-03; +7.755528844976467e-02   +5.045606141516735e-02   +9.096658181306592e-02   +9.003650623874748e-02   +1.952554346139065e-02   +4.884275826775084e-02   +9.224723984683504e-02   +2.480735878358593e-02; +1.418624956194643e-01   +9.136437736429515e-02   +4.146170513916429e-02   +3.084359388979805e-02   -3.855449090293029e-02   -2.337154506101057e-02   +1.229808838064098e-02   +1.031044933259580e-01];
L2E_L2I_iGABA_netcon = [+8.394778499391042e-02   +1.933089656963998e-02   +7.200835024976153e-02   +9.679780547407031e-02   -2.904134873334614e-02   +7.796372884941608e-02   +4.062536735721945e-02   +3.236630108411973e-02; +2.841931332935868e-02   +6.997299387146363e-02   +4.139243378227423e-02   +6.134204128241389e-02   +1.012715958296159e-01   -8.591672795254614e-03   -6.931295283317418e-03   -8.223196696915408e-02; +1.869585297065114e-02   +2.957110156674291e-02   +4.064294783015145e-02   +8.652265810819253e-02   +7.207444812440970e-02   +1.748924990723775e-02   +1.671442014407793e-02   +3.745670626693395e-02; -6.660186068336295e-02   +8.265283843399596e-02   +3.488396777556680e-02   +5.233841760794403e-02   +4.258431980434531e-02   +2.846510365397106e-02   +4.365773455771472e-02   +6.754772087468359e-02; +4.187437859577624e-02   +4.983103943849378e-02   +6.199163261097662e-02   -4.646099318451681e-03   +8.249802900963882e-02   +5.319831933509623e-02   +4.764551202159108e-02   +5.562513555316424e-02; +8.979390783360588e-03   +6.128359097282345e-02   +9.885382198192280e-02   +7.355113934043835e-02   +8.299449780697965e-03   +2.756699667282100e-02   +9.116547577491765e-02   +4.456117350116962e-02; +1.170738081846951e-01   -2.650165632457339e-02   +1.468444062883108e-02   +8.486079840235525e-02   +3.670523811877409e-02   -3.674045621636593e-02   +3.990210700520706e-02   +6.314275603631953e-02; -1.779988373124736e-02   -6.126264658638435e-02   +8.471493758168698e-02   +8.049308811234604e-02   +9.077163456000731e-04   +5.301412256576542e-02   -5.491372675417383e-02   +9.670010656853235e-03];
L3E_L2E_iAMPA_netcon = [+3.666227139165344e-02   +1.129398263804326e-01   +1.040969918133755e-01   +2.261159217930083e-02   +1.267023081548583e-01   +5.758415571328381e-02   +7.110863962635922e-02   +3.496500429571666e-02   +1.489268300481080e-02   -2.723315917508849e-02   -4.071363082395870e-02   +2.564671083915273e-02; +1.515313721875133e-02   +3.330025849697385e-02   +5.165447673085400e-03   +2.823226528035639e-02   +9.325756357067733e-02   -7.466803829586640e-03   +1.369669701646910e-02   -4.109630158000540e-02   +2.938729509879907e-02   +1.827770823938471e-02   +4.788525325354952e-02   -1.636301406051704e-02; +9.137693139741644e-03   +4.870101651398499e-02   +6.894235981288965e-03   +1.741745131092707e-02   -1.644984312833493e-02   +2.944401400325961e-02   +6.211274407860013e-02   +3.427936311973508e-02   -1.950104270883143e-02   +3.235087278888323e-02   +5.976012586956111e-02   -2.671519941513668e-02; +3.065949404740846e-02   +1.078229579055509e-01   +6.053303964279430e-02   +8.138239358035362e-02   +8.200059819720693e-02   +1.812084620249074e-02   +3.821672333192677e-02   +8.755093746695689e-02   +1.128516408868443e-01   +7.026794406663037e-02   +5.224787357186775e-02   -6.975808371355096e-03; +5.297089502831770e-02   +2.762132715318430e-03   +2.711249248565126e-02   +5.706102926008986e-02   -3.014061032726834e-02   +5.325224850655710e-02   +1.490208865681539e-02   -5.532624857850540e-02   +3.424455350312220e-02   +2.687322358383784e-02   +5.898730872757612e-02   +3.496491055433201e-02; +2.819405215534342e-02   +1.129022055672929e-01   +2.406584967538245e-02   +4.582471996491494e-02   +6.560576612535771e-02   +2.089842571638143e-02   +4.896060853395856e-02   +8.114530070604570e-02   +6.826045512163595e-02   +4.434370437931596e-02   +9.887712112524986e-02   -2.177685896515454e-02; +6.401021131393191e-02   +4.179626566806139e-02   +1.311704327498950e-02   -1.001029887646406e-02   +4.202439461567122e-03   +9.074651364783460e-03   +5.597164421728121e-03   +5.239464089907832e-02   +8.380906559925366e-02   +4.370488915751027e-02   +5.448525434840003e-02   +4.544644539057618e-02; -8.782887540423820e-04   +6.228482130575189e-02   +3.845248777652512e-02   +1.293491842993860e-02   +1.729973018702506e-02   +5.811184035274193e-02   +4.957296885472988e-02   +3.669213169865550e-02   +5.762259913117482e-02   +3.562974878859743e-02   +1.807498124170893e-02   +4.281832620710184e-02];
L3I_L2I_iGABA_netcon = [+3.949050569005715e-02   +7.170213630654143e-02   +3.649302529306986e-02   +3.515064836212946e-02   +9.798890621992876e-02   +4.320289279307713e-02   +3.132915086850703e-02   -1.150705292279562e-02   -1.032643374170405e-02   +1.120751951187061e-01   +4.317134150637483e-02   +4.568713145905031e-02; +8.964571208455072e-02   +1.712571672048390e-02   +3.143856082912557e-02   -5.317738785591594e-03   +4.848732301997707e-02   +4.269847864973715e-02   +2.723861855880775e-02   -9.149017274304673e-03   -1.874370849848337e-02   +2.279373597853925e-02   +4.877526283999047e-02   +2.795065569454572e-02; -5.061974166043581e-02   +7.368857727942085e-02   +3.077012702969886e-02   +4.317128513200428e-03   +8.299952561395127e-02   -5.756978241732594e-02   +2.730008766451517e-02   +9.032548185881623e-02   +2.110750838772901e-02   +6.385074805548673e-02   +7.098540779301404e-02   +1.014530698043342e-01; +4.805277323866944e-02   +8.168055299533114e-03   +3.878497510562408e-02   +3.830939333730191e-02   +2.119887260886601e-02   +6.120371671518365e-02   +3.234383455158889e-03   -5.282551662294341e-03   +5.256604478328564e-02   +1.096304133388702e-02   -5.112694279157948e-04   -1.435016959244808e-03; +5.290062734054551e-02   +3.562555326172454e-02   -3.038972876669452e-02   +5.201477232423515e-02   -4.440607777284072e-02   +3.148488785905622e-02   +8.159653746740028e-02   -4.193328133783492e-02   +1.157620897503833e-01   +2.188779697247295e-02   +1.857709164450220e-02   +1.042489491425587e-02; -8.924098187646730e-02   +7.242094695254542e-03   +5.531693980208999e-02   +6.847790584982837e-02   -1.834563796790485e-02   +1.528850026788930e-02   +7.200415968229811e-02   +1.990337515207600e-02   +7.662930806918716e-02   +5.938056065853593e-02   +7.190589418288142e-02   +1.560060376572958e-02; +9.217104642786837e-02   -5.338625309810958e-02   +4.659775610094655e-02   +5.549599853248258e-02   +3.183799174719385e-02   -7.663987033016293e-03   +6.722039987798320e-02   +3.436220620291599e-02   +1.885292320376144e-02   +1.377346952640038e-02   +1.244191928959684e-01   +3.257532409912958e-02; +7.580611674060005e-02   +1.674558483832228e-02   +4.682395649999885e-02   +3.696525774773978e-02   +7.947411841396535e-03   +8.338804268491901e-04   -9.417303484635594e-03   +2.056667815714838e-02   -3.514753527341069e-03   -1.042764195784539e-01   +1.209378137443602e-02   +8.111045114016574e-02];
L2E_L3E_iAMPA_netcon = [+2.663620813324893e-02   +1.032115033732207e-02   +4.801151203256169e-02   -4.589030629628803e-02   +1.323448408073342e-02   +6.528577513959179e-02   +5.045728614964452e-02   -5.442048446668849e-02; +7.026906366721835e-03   +7.207869953275052e-02   +2.414214216844413e-02   -2.218627065827499e-02   +1.169712851396068e-01   +8.892705360609481e-03   -1.336968112734773e-03   +3.319165390625358e-02; +5.730124668406023e-02   +8.383273688636712e-02   +5.336616829469297e-02   -3.514323081212049e-02   -2.710097284554613e-02   -4.168235716578858e-03   +1.462635177719127e-02   +6.178509065740708e-02; +2.180256185160409e-02   +4.224992708765224e-02   +1.691638257627719e-02   +5.421104590281642e-02   +1.028682931160642e-02   -2.671808243834785e-03   -1.074326137208626e-03   +1.351480290625173e-01; +4.556699422854594e-02   +4.195393822771475e-02   +2.987484889204632e-02   -1.464251191863911e-02   +8.930173927628504e-02   +5.660589151608606e-02   +4.642040887100043e-02   +7.803607676795656e-02; +8.814897684055747e-02   +5.179417479541441e-02   +7.771238973755464e-02   +3.252006881851123e-02   +1.180377190182622e-02   -1.422189894878889e-02   +3.029340281163530e-02   +1.378378482405405e-02; -1.146866270996965e-02   +6.052899210985261e-03   +1.122448658443781e-02   +2.289925834727758e-02   -2.725389361430186e-02   -5.071423654917679e-03   -2.536886057564702e-03   +6.666788793477935e-02; +5.895715270026905e-02   +4.487943452631569e-02   -1.183510677050769e-02   +2.766766791966571e-02   +3.227555412119006e-02   +3.185203581538953e-02   +1.818164854115652e-02   +4.254117048194745e-02; +8.727863735526969e-02   +3.375839825236543e-03   +3.086283677325708e-02   +2.309323372706227e-02   +3.548338428936698e-02   +5.938137727548738e-02   +1.055619168742124e-01   -5.129868451513066e-02; +3.341839163854144e-02   +6.032324324211607e-02   +3.179959118813355e-02   +2.170179377423554e-03   +7.325508154991130e-02   +2.001641467416812e-02   +3.439133636770077e-02   +7.794553941549080e-02; -5.315341680827870e-03   +2.087844511141711e-02   +1.542525275629840e-02   +8.043589040475837e-03   -4.780526130830328e-02   +6.554831152154990e-02   +6.998324911377307e-02   +1.185764401822162e-01; +7.419128719090118e-02   +3.778691441188163e-02   -3.854002418994826e-02   -2.455395185775317e-02   +1.131052499095422e-02   +1.080527395853892e-01   -1.876178936885551e-02   -1.718899154820960e-02];
L2I_L3I_iGABA_netcon = [+2.696260286570445e-02   +3.128685613457141e-02   +2.671787793008942e-02   +1.138233923165314e-01   +5.288779829856155e-02   -1.257022791778903e-02   -9.822616917707968e-04   +1.924158237893157e-02; +4.282209161595193e-02   +9.355377950161098e-02   +4.313111185529610e-02   +4.837805021084042e-02   +9.112645068068925e-02   +3.146574887730150e-02   -5.088492078169311e-02   +1.177773287300396e-02; +3.349648625384988e-02   +4.825379869655341e-02   -7.601618811933721e-02   -3.825894738060195e-02   +1.249388150617564e-02   +9.913245713974052e-02   +3.972696966769759e-02   +4.535796948754149e-02; -5.954433616377749e-03   +3.116123503308107e-02   +1.117901029406591e-01   +1.160574847402396e-01   -2.542408219157375e-02   +6.554666930358746e-02   +2.908006298662364e-02   +5.939260779003395e-02; -1.641995246031704e-02   +2.524455914125081e-02   -1.518457953872136e-02   +5.880399824469782e-04   +4.989279539702798e-02   +2.854964954384490e-02   -1.901758845911956e-02   +8.291280382433760e-03; +4.358772276380519e-03   +9.962872775979817e-02   +9.852958499349201e-02   +1.765131895087055e-03   +1.132943168996075e-02   +5.370513306546573e-02   -5.280292479483341e-02   +5.109093688457434e-02; -1.273918255575166e-02   +1.713466629757173e-02   +5.316431130509768e-02   +4.658799776311977e-02   +3.188602201353755e-02   +6.360639796378856e-02   -9.980612976340276e-03   +1.308982682458922e-02; +3.764929504241259e-02   +2.820116915831403e-02   +9.678932384296259e-03   +4.365265996079549e-02   +8.309546115895046e-03   +8.733469986543198e-03   -1.070415765465602e-03   +1.480542191954967e-02; +1.073258883930019e-01   -5.417506500462849e-02   +4.258035160591227e-02   +6.674851647001752e-03   +3.240397525133688e-02   +3.280335658581063e-02   -4.555590965337006e-02   +1.155399824277030e-01; +2.977826176488699e-02   +1.699971550283400e-02   +1.041851743195258e-01   +5.012800870719238e-02   +3.677339716899851e-02   +8.416137293888931e-02   +8.288659786235250e-02   +5.299529404175295e-02; +5.064014152456096e-02   -7.437156846019609e-02   +7.184257846385389e-02   +7.610210896819126e-02   +1.877050391778954e-02   -2.833822255779718e-02   -1.593075721886539e-03   +1.194681379283609e-02; +7.397858366976899e-02   +1.431323579547642e-02   +5.223056887313702e-03   +2.326636839568075e-02   -6.534324875603153e-03   +3.636150740447597e-03   +8.437578570039966e-02   +8.336573488780748e-02];
L3I_L3E_iAMPA_netcon = [+3.739829785819086e-02   +5.922533411615317e-02   +2.397436714190517e-02   -4.462015629913151e-02   +5.641429728196103e-02   +7.196340747472083e-02   +9.858906341286801e-02   +9.046040483023304e-02   +5.541528040147725e-02   +4.394895657804642e-02   +2.433183842383740e-02   -3.645859929032667e-02; +3.384680219082538e-02   +1.140127406931821e-03   +5.383100211132184e-02   +3.858778764504086e-02   +4.866160476725209e-02   +6.373069552737472e-03   +6.330286186773311e-03   +6.186653474930998e-02   +3.420671097905070e-02   -1.839981421903932e-02   +6.822339163613053e-02   +1.724020478801893e-02; +5.660216583712792e-02   +8.009829504096624e-02   +1.633194648552699e-02   +2.463308882341749e-02   -1.412833404423361e-02   +8.641918728542590e-02   +9.047840420400674e-02   +8.195105775461009e-02   +7.588030341696575e-02   -2.247584195509995e-02   +4.436361996699947e-02   +1.307333950220541e-02; +1.213072690602753e-02   +5.253978668260786e-02   +6.574294008721565e-02   -4.450248579490469e-02   +9.775012206071354e-03   +6.847434945407280e-02   +7.436243323289513e-02   +6.649504686011028e-02   +1.921231969783671e-02   +1.119826306029454e-02   +5.709902824691818e-02   +4.399901932200087e-03; +4.336734991122695e-02   +2.436673744752883e-02   -5.290274298998006e-03   +3.530531338625392e-02   +3.235045797582430e-03   +5.820738841944652e-02   +8.121698100995256e-02   +8.514527078269447e-02   +5.540989434316744e-02   -7.614003711205811e-04   -2.032025477943353e-02   +2.828969069854383e-02; +5.385168846531711e-02   +3.670508797380448e-02   +6.470837473675102e-02   +8.012304532132490e-02   +9.245724328499150e-02   -3.405788431239589e-02   +2.012565002661709e-02   +2.677077704880369e-02   +1.850132140986507e-02   +5.504710252449902e-02   +3.352649946937418e-02   +4.360317440716094e-02; +8.085164314183120e-02   +2.230916772334830e-02   -2.180004272596356e-02   -1.426232559993735e-03   +6.261439415289780e-02   +4.434504238018193e-02   +7.168190973585030e-02   +3.368409349606698e-02   +4.422775696074572e-02   +1.981626141894887e-02   +5.603985180598745e-02   +5.636237504325205e-03; -3.325552460372449e-02   -3.608070392493867e-02   +9.552627321438080e-02   +5.546143768933839e-02   +4.482883311443618e-02   +1.109708628323171e-01   -4.779263146568889e-02   -6.811064028427925e-02   +1.176766282924707e-01   +3.375802914183514e-02   -2.935913444196352e-02   +2.148747341842713e-02; +8.441655248475935e-02   +3.529042895731992e-03   -6.465143020183697e-02   +3.155574094723497e-02   +1.203512351618525e-01   +1.515002523991691e-02   +7.553545552987241e-02   +8.131057926970030e-02   -1.540920613624824e-02   +8.632679454966960e-02   -8.131935753728332e-02   +9.696362213858550e-02; +2.409625087138706e-02   -2.976244234202323e-02   -1.140842945808657e-02   -3.648881831511927e-02   +1.574386858185331e-02   +5.474925990161875e-02   +5.140610316008173e-02   +6.486405528853947e-03   -3.465724781570479e-02   +3.703369312515900e-02   +2.219894437274175e-02   -1.347517667032189e-03; +8.587432791442855e-02   +8.960903769698836e-02   +2.545342209103493e-02   +6.092138697802880e-02   +6.419300743580915e-04   +3.050290000087196e-02   +9.644519596558446e-03   +6.224678500200267e-02   +3.316866647618954e-02   -2.536205994362355e-02   -2.897955489123013e-02   +5.578344329444405e-02; -6.166523106886430e-02   -4.194376606208024e-02   -2.423323144233709e-02   -2.734388357197724e-03   +1.616029327929580e-02   +8.545541758003278e-02   +1.608911136352425e-04   +3.188832303767151e-03   +5.190485089160427e-02   +4.577679203290917e-02   +2.871134290191514e-02   +5.370004571662859e-02];
L3E_L3I_iGABA_netcon = [+6.329161909915590e-02   -4.741963772397160e-03   +6.109184075200316e-02   +2.383208194094119e-02   -5.028744515195951e-03   +7.792043396281925e-02   -3.881955420539277e-02   +1.240946920284418e-02   +3.629195849760551e-02   +7.713573955252283e-02   +2.181498642675903e-02   +5.051701682119666e-02; +6.255640608244924e-02   -9.576146717448877e-03   -3.049055042682218e-02   +5.411076878008835e-03   +4.320278193802561e-02   +1.014761132970239e-01   +6.951966068952652e-02   +7.956277955493921e-02   +5.618841311626306e-02   +3.527294932621370e-02   +4.956908330883437e-02   +7.936016348465037e-02; +5.038224988218831e-02   +7.588614849662813e-02   +7.918092997926636e-02   +3.981847846619624e-02   +5.383844825056325e-02   -3.787551652630960e-02   -1.427790778219948e-02   +1.027200064485107e-01   +9.983137696099406e-02   +8.454911957222479e-02   -6.453210393349200e-03   +1.457186541117315e-02; +4.371079821334344e-02   +1.151603183966385e-01   +8.789286159294307e-02   +1.721133212560949e-02   +1.256465635372852e-01   +7.436241319140487e-02   +5.952260435441293e-02   +5.366218134594102e-02   +1.234960780423108e-02   -4.425026103362650e-03   +4.779136855374556e-02   +4.296984945524783e-02; -2.945867459891727e-02   +6.570878553661522e-02   +9.897179622528932e-03   +4.674846147786859e-03   +4.914127410795573e-02   +1.013266335629815e-01   -6.994904859285153e-02   -7.826275403633998e-03   +4.217191435822086e-02   +1.158006006690995e-02   +1.444034810223136e-01   +8.982542945369952e-03; +1.473815619823347e-02   -1.139148042799467e-02   +8.901943585143018e-03   +4.904260235590110e-02   +2.539183559251893e-02   +6.459615152770581e-02   -4.919658301543457e-03   +1.187782098369473e-01   -1.210900379055549e-02   -1.950377510053562e-02   +5.078615377972415e-02   -4.954003716490272e-03; +1.046174720043855e-01   +1.367726020166787e-02   +1.473912493400596e-02   +1.079635567340379e-02   +2.088178296316894e-02   +3.805810288262985e-02   +9.968473063956601e-02   +1.786546239742777e-02   -2.860679628640296e-02   +6.916481921434232e-02   +4.632225394024934e-02   +1.190140403772186e-01; +8.044660210297677e-02   -1.978242592992712e-03   +1.194777905529341e-02   +2.365591116809197e-02   +2.675476944587952e-02   +9.374398821383524e-02   -5.118043988693194e-03   +1.103698839948648e-02   +2.650299682151500e-02   +4.801297367914043e-02   +1.186403302130192e-01   +8.340418321397727e-03; -2.094606969970727e-02   +1.020481804236218e-01   -2.548328614113348e-02   +3.351974404661236e-02   +2.086503034877257e-03   +7.309343612835582e-02   -8.736857991997712e-02   -8.504428441020125e-03   -6.294150736176098e-04   +6.627380073261342e-02   +7.150277547130029e-02   -1.405572485162002e-03; +8.053928208628983e-02   +2.837154612322424e-02   +8.175407123704781e-02   +2.209541111761203e-02   +2.760318157593591e-02   +3.614218798131713e-02   +7.742282754675402e-02   +8.647761357903737e-02   +5.527787583276089e-02   +6.427455897869726e-02   -5.668474244496549e-03   +1.186660858865393e-01; +7.270391298356908e-02   +5.236994481070018e-02   +5.492606172102805e-02   +4.049170029250792e-02   +3.974624017685985e-02   +5.545327343381976e-02   -1.664525206856838e-02   -8.581038982418731e-03   -3.012188559608124e-02   -4.966063837835456e-02   +4.398393086606997e-02   -3.468037004128722e-03; +1.148591325562498e-03   +4.054410487252952e-02   +1.827510596218523e-02   +8.916668731482563e-02   +6.200964448440695e-02   +5.872168858357634e-02   +1.471667374941232e-02   +3.795421168464058e-02   +1.594772345282900e-02   +8.793531779792170e-02   +2.475081445949998e-03   -1.283202097606851e-02];
L2E_Input1_iAMPA_netcon = [+7.376553477836466e-02   +3.174360454759730e-03   +1.037918555323053e-02   +5.108142244722318e-02   +1.325435713023166e-02   +4.110123663101153e-02   +4.418723708379389e-03   +6.518338664842120e-02];
L2I_Input2_iAMPA_netcon = [+4.451882379155554e-02   +1.644690655699104e-02   +4.500905427041006e-02   -2.291473011211567e-02   +6.366155796687943e-02   +3.388745896225029e-02   +6.322513746642686e-02   +7.930994054593279e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
