function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.441014787385616e-01   +9.824988659406551e-02   +4.969710875947891e-01   +7.141653251029058e-02   +7.459195488005275e-02   +4.148947195288010e-01   +1.159317761383022e-01   +2.888290624354252e-01   +1.730447183716099e-01   +5.634503648300518e-01   -4.596989927977169e-02   +2.051606485318264e-01   +1.877302225015892e-01   +3.917708224524130e-01   +3.412815320922808e-01   -1.094648230739851e-01; +4.633208246346735e-01   +2.378372713029395e-01   -1.850874403769275e-01   -2.797776786820153e-03   +5.089722813311149e-01   +4.075642357945754e-01   +4.883397986279660e-03   +2.965939157032346e-01   +4.136208413912265e-01   +2.163923381968447e-01   +3.619662387923357e-01   +3.884118331327684e-01   +3.134042149276314e-01   +7.317162496588462e-01   -1.873671351706133e-01   +3.024053148814941e-01; +4.610064416444110e-01   +3.907647709078610e-01   -1.797986618625351e-01   +2.504195174473460e-01   +4.608072905392947e-01   +1.949181300817912e-01   +1.166626972625061e-01   +2.218578213618163e-01   +1.348120503264009e-01   +5.137821945209633e-01   -1.800726459192903e-02   +1.022561432805388e-01   +4.017723590613660e-01   +3.959893544921275e-01   -1.250786256505091e-01   +3.021518375936132e-01; +4.839810241007341e-01   +1.306358358923607e-01   +4.862699987981502e-01   +9.967647711020572e-01   +5.800089085639192e-01   +4.663544711155223e-01   +7.152163410153350e-01   +8.132963370893583e-01   +8.003180849986526e-01   +3.812558006727312e-01   +3.877001659344007e-01   +1.674916858350721e-01   +2.650582182842825e-01   +3.916463272365969e-01   +1.669827328631088e-01   +3.115356604979104e-01; +3.754151654513323e-01   +5.400268125765055e-01   +3.570167576236530e-01   +8.762305711811155e-01   -8.684838240078999e-04   -4.506308538763597e-02   +1.107699683086469e-01   +8.427685501167185e-01   +3.799350963066497e-01   +2.968428969660557e-01   +8.223607319285952e-01   +3.567976374260470e-01   +6.191739932542422e-01   -3.814378758716711e-02   +1.053397030723439e-01   +5.930570940044295e-01; +1.895213913940777e-01   +3.419438325006057e-01   +4.657283509951687e-01   -1.271908317416671e-01   -1.193679989700498e-02   +6.431740024887327e-01   +2.844456099451211e-01   +4.897772999591160e-01   +3.344938186784441e-01   +4.020674133420448e-01   +1.045058449472989e-01   +4.882717409965742e-01   -4.326579373033036e-02   +3.824912975986346e-01   +2.563641499732320e-01   +6.728665388081094e-01; +4.417411430308384e-01   +6.087744309843646e-01   +1.915241285879993e-01   +1.406062711197255e-02   +3.544053771806123e-01   +5.255410627379131e-01   +5.156932636628930e-01   -6.642585525605306e-02   +1.687066353112181e-01   +2.579590567813559e-01   +5.032841713738100e-01   +4.581667377763211e-01   +4.999308535720939e-01   +1.252264785190716e-01   -6.862807184372580e-02   +3.913019786189760e-02; +5.950272000806974e-01   +7.068513173632633e-01   +3.250800524673796e-01   -9.961809249780657e-02   +3.115968419242796e-01   -4.895622181499235e-02   +3.951211874015137e-01   +1.795552925286772e-01   +3.411529060542541e-01   +4.658319119840373e-01   +1.986558209727489e-01   +1.775373795259990e-01   +2.586496026389928e-01   +2.052777512360154e-01   +3.210621347470811e-02   +5.279465144074473e-01; +2.993783235174811e-01   +3.666475694256249e-01   +3.716967078381119e-02   +3.247810595042419e-01   +5.772253787870332e-01   -1.160915652541593e-01   +3.136135610508174e-01   +4.195670024892909e-01   +2.235367122162638e-01   +1.344813392624926e-01   +4.558747946678254e-01   +4.512911595652636e-03   +1.703195195639922e-01   +2.834243516223819e-01   +3.065840275551151e-01   -8.455309696431372e-03; +2.832905837354851e-01   +5.592025122306264e-01   +2.707559919503937e-01   +2.974470715757243e-01   +4.608548312388098e-01   +4.550074944326966e-01   +6.136490693640899e-01   +2.625521583424500e-01   -4.313183064039786e-02   +1.677439940871766e-01   +2.610222192305594e-01   +4.139724396298088e-01   +5.925916286162448e-01   +4.785051625687262e-01   +3.154283158600137e-01   +4.116058589075153e-01; +3.413122292201215e-01   +3.182553071433072e-01   +1.160546209001211e-01   +5.675820419702968e-01   +5.073463457653880e-01   +2.078069372370877e-01   +3.341628850479887e-01   +5.875767609888928e-01   +4.348791862916085e-01   -2.205804643210214e-01   -1.191502706751262e-01   +5.104668871131861e-01   +4.248758551618355e-01   +3.307788893857144e-01   +2.937698418306954e-01   +2.317475872202522e-02; +1.811620012728800e-01   -8.040197451637870e-02   +3.635813019163461e-01   +4.142963488412205e-01   +2.957051592673907e-01   +6.155513854733834e-02   +1.483111269552260e-01   -1.774928637844387e-01   -1.389796325353807e-01   +4.277596035310651e-01   +2.619579368136530e-01   -2.440806783302940e-01   +5.322387508834699e-01   +6.013620543792956e-01   +7.226567810184070e-02   +2.663545026993729e-01; +1.497575722791480e-01   +1.879409997234146e-01   +8.748584377669183e-01   +6.774437519067930e-01   +4.806107537206153e-01   +7.889370059410340e-01   +2.590093979813647e-01   +3.264058308845108e-01   -5.936843407148069e-03   +1.086185192293565e-01   +3.179111939389137e-01   +6.285588716368355e-01   +4.754077642782855e-01   +4.964579635709384e-01   +3.174028376212443e-01   +2.853639015865498e-01; +4.279836267860130e-01   +6.691598526789444e-01   +4.487026086476345e-01   +4.451067365442329e-01   +7.001850105552682e-01   +3.976856365772604e-01   +1.643644224902867e-01   +1.192439044723830e-01   +4.382751528163116e-01   -9.948657580342542e-02   +3.945379343366188e-01   +9.461736610678537e-02   +1.400874998635890e-01   -7.077740292709259e-02   -1.153616488926489e-01   +4.897830589100881e-02; +8.165069133301532e-02   +4.054390756253403e-01   +2.871597253636923e-01   +4.960745687780301e-01   +3.038186257671933e-01   +8.274330829364097e-01   -8.761386417601409e-02   +1.644409252425170e-01   -1.161351020509714e-01   +4.220994673733459e-01   +4.277167381019539e-01   +6.636200115613390e-01   +4.965513881212296e-01   +7.008815051551276e-01   +3.023601537312851e-01   +1.255331104318048e-01; +4.323088782467127e-01   +1.145573009887523e-01   -2.949781613094135e-02   +4.475153382261852e-02   +6.285890230529840e-01   +2.902181986645203e-01   -3.304366066933505e-02   +8.000684070372956e-02   +3.924133787197159e-01   +3.570782646070050e-01   +2.811579377936345e-01   +3.000189091784258e-01   +4.451736706883011e-01   -2.514968419648885e-01   +5.871136314684321e-01   +2.562591587788247e-01];
L1E_L1I_iGABA_netcon = [+3.652114585776067e-01   +6.312152661645248e-01   +6.769185815330022e-01   -7.977327920527595e-02   +6.861765761136594e-02   -9.961478790969790e-02   +5.079765960731376e-01   +1.138380833758900e-01   +6.790321461449267e-01   +5.444886857896549e-01   +5.997253854258818e-01   +4.952395535480140e-01   +6.550043468731038e-01   +2.811235137321412e-01   +3.715524669251561e-01   +1.594422424921279e-01; -1.400206989824496e-02   +2.985857202965000e-01   +2.160785003261819e-01   +2.656163808783177e-01   +2.640022888100163e-01   +3.242788342015215e-01   +3.740919963761045e-01   -3.238448840707349e-01   +8.184733406624000e-01   +3.760667939894419e-01   +5.204291710550544e-01   +7.395744158501762e-02   +3.756656556094591e-01   +2.173224298214799e-01   +2.903372315930465e-01   +3.353934202050508e-01; +6.350399873753050e-01   +3.786195148331294e-01   +5.223144030545481e-01   +2.595848921996678e-02   +5.214824626882357e-01   +7.520396235789497e-01   +2.967502629371709e-01   +1.969991408990131e-01   +3.464088956426099e-01   +1.543400185886783e-01   +6.840222251660043e-01   +6.282004866008500e-01   +7.187468915048335e-01   +1.007949579196577e-01   +6.195051894620319e-01   +6.558724163008254e-01; +7.680106126478381e-02   -3.351394833037111e-02   +9.421647797844326e-02   +5.557031744828104e-01   +5.393795125442585e-01   +2.469409357330435e-01   +6.713805525315871e-01   +3.171997057804727e-01   +5.544163943392877e-01   +8.427338389938448e-01   +1.998585919957517e-01   +2.509857852195864e-01   +7.013660680125048e-01   +6.873903513509251e-03   +4.274928520600884e-01   +5.759830719453758e-01; +7.611655504194355e-02   +1.893885755345052e-01   -1.269195508646009e-01   +2.363558806798206e-01   +3.964728322337277e-01   +5.315927691490206e-01   +6.929230503576991e-01   +5.171032929556317e-01   +3.382741404145601e-01   +5.739230817601201e-01   +1.974676009129350e-01   +5.773997296838673e-01   +2.824359898300705e-01   +3.425625088487760e-01   +4.079141305463128e-01   +2.226360570532433e-01; +6.397249559604075e-01   +3.455269382148815e-01   +3.236438119332977e-01   +6.241883046150518e-02   +3.203986012962826e-01   +1.107437778994996e-01   +3.713403998989374e-01   +3.561605154845633e-01   -3.600282881071779e-02   +6.815935962627122e-01   +3.566660624745227e-01   +3.053003786401041e-01   +9.904748294549064e-02   +4.242810368003587e-01   +4.487951683286107e-01   +5.141338470166977e-01; +1.178379258348281e-01   +6.033161691517717e-01   +1.146695122322392e-01   +2.792745000361003e-01   -1.576765856877549e-02   -4.330279674892318e-01   +8.175884976072170e-01   +5.741804341886275e-01   +3.907277562763589e-01   -1.522174563414639e-01   +1.713905562993858e-01   +1.034078132091024e-02   +1.641318669273668e-01   +5.656398892479491e-01   +4.556640587615084e-01   +3.975781218738035e-01; +3.645847122594424e-01   +7.706190651929440e-01   +7.743695468655913e-01   +2.527130557521793e-01   +2.426885387504762e-01   +5.886671885914662e-01   +8.134907469477323e-02   -2.007951698768098e-01   +2.241217323067387e-01   +4.112194326296389e-01   +7.291134234948666e-01   -6.269347298210380e-02   +5.705928089857406e-01   +7.531857475261727e-01   +2.623796809103905e-01   +1.214169318925321e-03; -1.271352547569672e-02   +9.048530886449190e-02   +3.606160146385545e-01   +5.234780027858322e-01   +5.480432632853223e-01   +2.028367006366496e-01   +6.019258060503132e-01   +2.188858734337933e-01   +6.281350631220370e-01   +5.005654134850795e-02   -1.187159024981248e-01   +3.392811021484505e-01   +2.942781232114434e-01   +6.760878702681201e-01   +3.631008924956234e-01   +9.166447971408020e-02; +1.347005409608270e-02   +8.146393783628171e-01   +4.894237361333931e-01   +2.420670928815275e-02   +2.724564273000367e-01   +5.271877530804935e-01   +1.886249918105573e-01   +7.529561515389513e-02   +2.977344940238073e-01   +3.609205321260407e-01   +3.735150381051924e-01   +6.862431785255571e-01   +3.930264935668125e-01   +3.055587836986158e-01   +3.333009064825783e-01   +1.695065164035908e-02; +5.542807347173200e-02   +6.525601346848822e-01   +7.804778639023120e-01   +5.706632398853269e-01   +3.945577192292031e-01   +1.482940676878339e-01   +5.957644335767025e-02   +6.306080976920588e-01   +5.480783522567128e-01   +4.579750857104684e-01   +5.531395981514786e-01   +4.857417873516978e-01   +1.106497116146869e-01   +5.496165691821635e-01   +1.871368180079865e-01   +6.055675569499629e-01; +6.540644754292975e-01   -1.590481963079908e-02   +1.214530380633968e-01   +4.775918404437743e-01   +5.808697341012939e-01   +1.121589649613800e-01   +2.880669232777296e-01   +4.269199727889856e-01   +3.180678180786078e-02   +2.894300707331698e-01   +4.206281284518902e-01   +5.430332389089614e-01   +1.861901576812551e-02   +3.817189393362724e-02   +2.555888485986557e-01   +4.948506749686777e-01; +5.403533302768164e-01   +7.543530885433152e-01   +7.030479834018787e-01   +2.554227301838923e-01   +3.658224734404296e-01   +8.717602623247784e-01   +7.065401979812773e-02   +3.365264269579347e-01   +4.745255618565438e-01   +5.525719958042224e-01   +8.112159967613622e-01   +4.458741804144126e-02   +6.574266722525955e-01   +3.470989118407383e-01   +1.201341242831600e-01   +4.633474245297561e-01; +3.600942592785777e-01   +3.415933452621671e-01   +4.200121360791361e-01   +6.382529978081138e-01   +9.735708311328375e-01   +5.518449503007917e-01   +7.310861074711537e-01   -1.002154589662607e-01   +1.071291531935025e-01   +2.161402838155234e-01   +2.298615759456286e-02   +7.328038238322186e-01   +5.395596813966559e-01   +2.496691557740008e-01   +5.367054861962541e-01   +4.682873525843506e-01; +6.075092815329488e-01   +1.000000000000000e+00   +1.635649831817153e-01   -1.377353071371418e-01   +5.612257419998847e-01   +1.278154397589245e-01   +3.730705444277949e-01   +9.265811744992856e-02   +4.345192366560206e-01   -1.514380842755169e-01   +3.307194335306274e-01   +3.866045630899103e-01   +6.911119380401779e-01   -2.059862313272791e-01   +2.594328148678371e-01   -3.438478735554228e-01; -1.663062512688838e-01   +2.973963863121480e-01   +7.722430510414056e-01   -8.837445536862332e-03   +2.445914193087372e-01   +3.776825695109301e-01   +2.504016674843803e-01   +6.945466912744757e-01   +4.662690404877068e-01   +2.157399600011431e-01   +3.201150284079755e-01   +7.211019023831430e-01   -1.138052929029438e-01   +5.181241650519994e-02   +6.313418165815622e-02   +1.589855924133493e-01];
L2I_L1I_iGABA_netcon = [+3.172308602637136e-01   +1.262941445339247e-01   +7.829472968066974e-01   +1.131942903686689e-01   +5.657517291586603e-01   +5.881265038805467e-01   +6.272386678082595e-01   +1.000000000000000e+00; +2.551890291738093e-01   +1.599779048903930e-01   +3.696962458451148e-01   +3.984342168502860e-01   +5.989094473591466e-01   -9.599066400038744e-02   +1.622707745711644e-01   +4.613467907390274e-02; +6.154433133350161e-01   +5.128784443857495e-01   -1.126408553903137e-01   +2.583088676124130e-01   +5.709851026262269e-01   +1.605099747542671e-01   +4.362644938705962e-01   +3.501911872902511e-01; +5.012914770174824e-01   +5.159075593286281e-01   +6.583142469459291e-02   +4.145520506433113e-01   +5.086340192911751e-02   +5.497452248196847e-02   +2.429783051933824e-02   -4.786032343885432e-02; +3.162283669066382e-01   +5.052031302836233e-01   +4.660827386372762e-02   -1.249469349539651e-02   +5.621912890277084e-01   +1.460722198259047e-01   +4.858764721376809e-01   +5.144132694313636e-01; +5.376622653651881e-01   +4.547936604613833e-01   +5.467037786347272e-01   +5.641960002014087e-01   +3.892670181871242e-01   +7.265980590209115e-02   +4.492090395290683e-01   -2.798948102162694e-02; +2.715323382636796e-01   +6.312828510217567e-01   +4.160126468515290e-01   +7.174945026026475e-01   +1.284244904630577e-02   +1.462209393750628e-01   +1.903788117895421e-01   +4.195065791322567e-01; +5.544773626297275e-01   +3.703472748132211e-01   -1.079704342217510e-01   +3.766419329295418e-01   +2.285804120155945e-01   +4.472637292896841e-01   +3.514532098016710e-01   +1.946278495013420e-01; +2.493612190782305e-01   +1.991017090579130e-01   +5.052169635354926e-01   +2.162127280382363e-01   +2.537814434351521e-01   +9.305010157049555e-01   +3.384299750661761e-01   +9.129953447067883e-01; +5.857455423048969e-01   +3.526197058114682e-01   +2.782919209230854e-02   -1.859974144032170e-02   +4.944585781288667e-01   -3.382656996151073e-01   +1.754732402383123e-01   +3.889622513829752e-01; +2.758734592771639e-01   +6.293122284583107e-01   +3.471120706753832e-01   +8.101614451907700e-01   +1.756672427004712e-01   +4.053941059391390e-01   +8.419569702807740e-01   +7.224056068514230e-01; +5.502459858801519e-01   +9.221748684948105e-01   -1.823060784768423e-01   +7.797652823288512e-02   +2.643455062063253e-01   +5.228587282073417e-01   +3.666346600065739e-01   +2.513396359164452e-01; +9.223185109410540e-01   +2.651284081480534e-01   +5.662982930157423e-01   +5.801491075270579e-02   +4.494038163694478e-01   +1.109771723529582e-01   +6.536757184480896e-01   +2.150549598043894e-01; +5.616843539189007e-01   +3.316646175943279e-01   +4.979550089460375e-01   +1.877845424884214e-01   +3.798596140545442e-01   +2.815972409132206e-01   +4.359029178269945e-02   +3.812488773179411e-02; -1.523579423251867e-01   +7.737921603242208e-01   +5.800128684208125e-01   +1.771028510551156e-01   +3.343192249457922e-01   +5.854969140514374e-01   +1.094261932815925e-01   +4.445795488248055e-01; +1.422769282388988e-01   +5.968956655759861e-01   +1.829445215578181e-01   +3.296653936138164e-01   +1.997280335078641e-01   +3.544846604897364e-01   +2.234349773507181e-01   -7.951033475103819e-02];
L1I_L2I_iGABA_netcon = [+3.787015254127724e-01   +4.825357444967022e-01   +2.450282929597191e-01   +4.831427766762726e-01   +7.115985246427066e-01   -5.382875360909645e-02   +5.964797715248928e-01   +1.001874557201123e-01   +2.333553765650573e-01   +4.243615529013587e-01   +4.834500861716255e-01   +5.774079258417083e-01   +6.307509401282628e-01   +2.742138637041657e-01   -1.858338788968558e-02   +5.342095271950156e-01; +7.482769729602864e-01   +4.637765040174958e-01   +6.310327525524335e-01   +6.057641924545448e-01   +6.468514255979739e-01   +9.970163629522069e-01   +6.190741811410949e-01   +2.280347272606305e-01   +4.441548400910324e-01   +2.390557399663652e-02   -8.479748123378768e-03   +7.233153274884701e-01   +5.721668476418407e-01   +2.317859906011284e-01   +6.500024481604100e-01   +8.994744218400784e-01; +1.736354493535505e-01   +2.088083348678770e-02   +5.326122820121032e-01   +5.249018411860189e-01   +3.347792576219766e-01   +6.183515421424084e-01   +2.295427068753159e-01   +6.044318834373421e-01   +4.527889490609281e-01   +4.041498526252247e-01   -3.550148326378062e-02   +3.030461081276801e-01   -1.083597564786383e-01   +8.138085682590196e-01   +3.584068497468227e-01   +2.843822355427650e-01; -2.917942641866668e-01   +6.468842576873994e-01   +4.928933917497670e-01   -2.435411274587885e-02   +4.675958026995621e-01   +4.868786934306589e-01   +9.006793861911413e-01   +3.752776396053021e-01   +7.056834825076425e-01   +1.662204281177352e-01   +2.891695839864828e-01   +8.293260015729971e-01   +5.103874941013155e-01   +2.848245330600964e-01   +6.165433165011420e-01   +4.893600508185537e-01; +6.011023632336766e-01   +8.201525873822927e-01   +2.582315737886385e-01   +3.177133246162514e-01   +1.016735019087912e-01   +1.587786953502437e-01   +6.491383280904459e-01   +1.570592324456453e-01   -2.055792999978460e-01   +4.588191454583457e-01   +6.044184092683944e-01   +5.051861528195172e-01   +7.094878605664419e-02   +5.687553836624959e-02   +6.605352265724382e-01   +7.348745942667668e-01; +7.518748954068016e-01   +5.198421827751388e-01   +4.061496006175831e-01   -1.192221797509998e-01   +2.480128285578508e-01   +7.533824636334742e-02   +8.738341459421335e-01   +2.629184004851642e-01   +3.679010238259294e-01   +7.060658658523108e-01   +9.261781552525469e-01   +3.617894740425155e-02   +2.773701432484496e-01   +4.870074520117341e-01   +2.907018432270960e-01   +3.299917846744955e-01; +2.192883044542644e-01   +7.090545402341571e-01   +7.199188173704554e-01   +2.696839848567071e-01   +2.841142706952379e-01   +8.351372975676670e-01   +5.828242178653177e-01   +2.272784824620590e-01   +4.169292651021601e-02   -9.982274195384282e-02   +5.300783276413720e-01   +7.913165977102146e-02   +6.784701518254382e-01   +8.981847198170871e-01   +1.304327500978796e-01   +4.821872964110887e-01; +3.159467568406220e-01   +7.410985452889459e-01   +4.751245214686025e-01   +8.557948808494346e-01   +4.828370822762341e-01   +3.465020124528211e-01   +5.542237097843150e-01   -1.833277059715596e-01   -1.018682089035670e-01   +1.503202976778976e-01   +1.001803814988165e-01   +5.044804570203165e-01   +5.714723960760458e-02   +7.465347784410018e-01   +4.266627244587763e-01   +5.191279112120767e-01];
L2E_L1E_iAMPA_netcon = [+4.533727511864653e-02   +2.709592097694459e-01   +5.654472255010828e-01   +5.587673393072490e-01   +6.099063945049077e-01   +3.236506990322554e-01   +4.354394037051600e-01   +7.181196411599090e-01; +6.765319191129625e-01   +1.411044718737801e-01   +7.836474720769371e-02   +1.961163882688377e-01   +2.792754768657412e-01   +4.078203227330980e-01   +2.392604809693690e-01   +3.820934475386329e-01; +2.378101331132298e-01   +3.245372823081443e-01   +5.372770733266552e-01   +1.000000000000000e+00   +8.472218659965415e-02   +3.881829521309754e-01   -1.027276919561847e-01   +5.779029468293579e-01; +1.633490026989691e-01   +6.296813639013814e-02   +3.357988799402268e-01   +5.295363725182461e-01   +6.089174408080934e-01   +3.213527833205244e-01   +5.551983308901721e-01   +3.957702644339641e-01; +7.572281125471344e-01   +6.269313938717337e-01   +1.887210768371843e-01   +2.034682722693071e-01   +1.614770753494273e-01   +3.491267697792809e-01   +2.962718136561656e-01   +2.331535327178904e-01; +5.382230309025373e-01   +2.536670925929465e-01   +7.324542681512729e-01   +6.471308690594090e-01   +5.590538189518675e-01   +4.785621461615152e-01   +4.698148605932359e-01   +8.139774211681985e-01; +6.810504966013328e-01   +3.601309091073084e-01   +1.837029914551728e-01   -6.358672831441090e-02   +3.955638500759513e-01   +4.263412416263188e-01   +2.707527688720696e-01   +6.992420450334715e-01; +5.271716910941407e-01   +4.482321796869890e-01   +2.616545705298721e-01   +4.050646710072398e-01   +8.065268663333010e-02   -1.133508556405065e-01   +3.896989379412653e-01   +8.574878343490510e-01; +9.720640171871298e-02   +1.143806173973386e-01   +3.026788616393261e-01   +1.683492812168809e-01   +6.143884217598206e-01   +4.768661974552114e-01   +3.485331275497671e-01   +6.591098681911209e-02; +2.498581332697065e-01   +4.159018980027445e-01   +3.006456415541577e-01   +6.223215573452827e-01   +5.357810063018531e-01   -1.950937635600672e-01   +8.059937847587577e-01   +4.114933763988792e-02; +2.144278150640620e-02   +1.645883309313089e-01   +3.246392151262558e-01   +5.447183287067235e-01   +1.783881782410712e-01   +3.782963058881424e-01   +7.357730028265494e-01   +3.834425859228638e-01; +6.505517464792803e-01   +3.895146797710192e-02   -5.253598854796973e-02   +7.571843195478163e-01   +6.231469520785800e-01   +2.006884559673138e-01   +4.604223842712210e-01   +6.406712141812851e-01; +8.495829738127000e-02   +6.379418504957389e-01   +2.745110281676243e-01   +1.380902942634802e-01   +3.082130905710873e-01   +3.001862039596910e-01   -2.202762690360694e-02   +3.142907917398737e-01; +1.302860723697784e-02   +4.157463160955263e-01   +6.850175623686741e-01   +3.674323432266137e-01   +2.609845613963653e-01   +3.670511654721361e-01   +2.278013163934966e-01   +5.910896798805826e-01; +3.450591167032446e-01   +3.255083477680739e-01   +2.850284942078927e-01   +6.079969228963018e-01   +4.895081797665934e-01   +4.137782185058984e-01   +3.241945871622462e-01   +6.995154669268335e-01; +3.399620593239844e-01   +2.424997744168467e-01   +2.458639125172065e-01   +2.931210742322505e-01   +7.242272636678772e-01   +1.619119601876407e-01   -7.230124376845580e-02   +1.478306917615036e-01];
L1E_L2E_iAMPA_netcon = [+5.360112524681560e-01   +6.802338067162751e-01   +2.162357249317142e-01   +4.711814225751129e-01   -1.873181292473327e-01   +2.871268308835750e-01   -3.156838657250419e-02   +7.667188338893289e-01   +7.723189884804991e-01   +2.542204224105038e-01   +5.716542757212989e-01   +6.783098581425980e-01   +6.693247293707053e-01   +1.193538206047868e-01   -1.011057870328022e-01   +6.629659841395362e-01; +4.048210005884235e-01   +6.808998711755304e-01   +7.338568768886746e-01   +6.827008390355183e-01   +4.509943535084752e-01   +4.385682116863388e-01   +5.051629403615414e-01   -2.084547308310614e-01   +3.577729276477313e-01   +7.760899190423104e-01   +2.933408098001734e-01   -1.918866450232545e-01   +4.120080539011128e-01   +4.117983494164788e-02   +1.550263233910140e-01   +2.410824424476722e-01; +2.924530256312069e-02   +4.264494195991870e-01   +5.941978176967283e-01   +7.284551208723580e-01   -1.055212634896295e-01   +2.508202159203742e-01   +2.103498878449730e-02   +1.855231343396348e-01   +3.060097192806966e-01   +2.349315917586270e-01   +8.233016700513835e-01   +5.169568132267434e-01   +2.559176901685462e-01   +6.446855450622344e-01   +6.438290278786849e-01   +5.587497175841200e-01; -1.619935406506676e-01   +6.542786944526565e-01   +3.173954575163129e-01   +4.705402415010752e-01   -2.391537933802727e-02   +5.979469326113597e-01   -8.895529715047126e-02   +1.351137764689316e-02   +1.297509646855636e-01   +3.554861700675718e-01   +4.705322718047503e-01   +2.240469345095449e-01   +3.439117856094519e-01   +2.311843265283941e-01   +1.074273879766110e-01   +9.822475292756955e-02; +2.397601145565026e-01   +6.377120460558587e-01   +6.723613619145141e-01   +1.127275013981673e-01   +3.044886730914267e-01   +7.364104606901034e-01   +5.461326041158431e-01   +2.151805810490795e-01   +6.470841346100129e-01   +5.629003231402006e-01   +8.555990493947515e-01   -2.480299788135351e-02   +6.856807409102688e-01   +7.977503960271990e-01   +2.756157092128234e-01   +1.303671589747862e-01; +2.860262639193508e-01   +1.319543062691802e-02   +3.847538052781229e-01   +6.818393340290217e-01   +5.199117884084746e-01   +5.607836579195427e-01   +8.264544110416453e-01   +2.697652552101859e-01   +1.570472032457609e-01   +5.017164121567984e-01   +1.348335797180234e-01   +4.463955179634541e-01   +4.463440020890843e-01   +2.975774468725563e-01   +6.014909887497923e-01   +7.108090321557878e-01; +5.079036561398297e-01   +1.491094868995538e-01   +2.963550222369309e-01   +5.734943211387868e-01   +3.563496215581803e-01   +3.384058468143323e-01   +8.823685010284573e-01   +8.200730870184307e-01   +2.876223988378550e-01   +3.205076746558633e-01   +6.358052106477309e-01   +4.258773621728567e-01   +1.813374889661349e-01   +5.518801004850113e-01   +4.629591361503897e-01   +3.457640038967035e-01; +6.281684098929377e-01   +5.558276918646926e-01   +4.454438980526605e-01   +5.689380239036965e-02   +8.344739679502354e-01   +2.706140833928727e-01   +2.930967929507040e-01   +5.222857885347107e-01   +3.838348565308167e-01   +2.284631762234057e-01   +4.675282282178223e-01   +2.854814325187321e-01   -1.257424784323664e-01   -1.615470574723330e-01   +3.673789679926149e-01   +4.823511705151396e-01];
L2I_L2E_iAMPA_netcon = [+2.143388939238090e-01   +8.570047841840877e-01   +6.881592860011659e-01   +6.344812121742994e-01   +3.680023917075932e-01   -7.749616506526283e-02   +8.203407597749472e-01   +6.572196024380640e-01; +7.430125533234340e-01   +9.524216842722089e-01   +1.546766301358598e-01   -1.526705588833254e-01   +4.717256099915437e-01   -1.580039525298219e-01   +2.309804683029867e-01   +3.279830446089559e-01; +6.347949643494756e-01   +6.468908895580222e-01   +7.150981871751360e-01   +2.754964923108209e-01   +4.221128984560606e-01   +7.295286289147718e-01   +6.554161635096356e-02   +2.830658505950659e-01; +5.173946171457580e-01   +7.263579513465329e-01   +3.644178701523927e-01   +1.253315399947352e-01   +7.022636234001384e-01   +9.227742635481732e-01   +8.123965114137971e-01   +8.045920611012427e-01; +8.604191650186109e-01   +7.837970309157817e-02   +5.145973386314636e-01   -4.679343510145698e-02   +1.083022720701445e-01   +7.798212263280163e-01   +3.895173632859358e-01   +2.587913026722738e-01; +3.534105794796456e-02   +2.211487970845345e-01   -8.583043263697649e-03   +2.370982830723805e-01   -3.196778566974347e-02   +7.286089954156880e-01   +7.108709483680880e-01   +2.352052014404188e-01; +9.314031383504323e-01   +2.142769856465878e-01   +3.887776449663071e-01   +1.070157674450711e-01   +2.891107530281959e-01   +3.112165383958005e-01   +5.094882270604418e-01   +4.361844184414428e-01; +4.937266064877177e-02   +1.810229893457943e-01   +2.707075256199484e-01   +6.656588179466892e-02   +7.235193033887878e-01   +7.046677448103220e-01   +2.821234293845959e-01   +4.249618145677474e-02];
L2E_L2I_iGABA_netcon = [+8.240162755892874e-01   +7.510717345747502e-01   +7.822178991790041e-01   +5.739394609589233e-01   +4.791222149744732e-01   +2.217363014675652e-01   +2.896680008176102e-01   +3.140465224555050e-01; +4.246191051814687e-01   +7.427642290432348e-01   +1.000000000000000e+00   +9.550577252617909e-01   +2.929785809442382e-01   +3.432334448634376e-01   +5.286235230225825e-02   +7.833295355175482e-01; -9.254650084621091e-02   +5.926732407770222e-01   +8.577654094511190e-01   +6.757789389050086e-01   +5.115967992546323e-01   -1.258349984950470e-01   +5.675642992164506e-01   +1.710453327147555e-01; +4.935903863197857e-01   +2.799269905295135e-01   +7.514514493746892e-01   +1.243829653118195e-01   +5.128344948147088e-01   +3.441350495441488e-01   +2.526696706162022e-01   -2.499841430153679e-01; +4.412393784555112e-01   +9.260412131417773e-01   +6.042151430413225e-01   +4.430058113064295e-01   +4.028203179319363e-01   +2.260254956448132e-01   +7.108514523632652e-01   -9.751751942839852e-02; -1.015934327630065e-02   +1.469958148083588e-01   -2.394687244542013e-01   +3.836726804542177e-01   +6.951536694818901e-01   +4.166975226099859e-01   +4.422251198782330e-01   +7.281665257044163e-02; +4.586044375631578e-01   +7.191628961417760e-01   -2.235206331528830e-02   +5.391048460301846e-01   +4.766773817183166e-01   +7.972075609593205e-01   +4.735831059607434e-01   +7.384158545113763e-01; +3.256351870810294e-01   +2.530284326657796e-01   +3.430141483298756e-01   +6.818593891995243e-01   +4.149225684765315e-01   +2.615077134370803e-01   +2.755813406821836e-01   -5.129282248826145e-02];
L3E_L2E_iAMPA_netcon = [+2.547365462690130e-01   +2.023530469113062e-01   +5.844429588731257e-01   +2.392631155864084e-01   +4.007197491586876e-01   +3.828871967422370e-01   +4.468442315466465e-01   +5.064312286522022e-01   +2.434161360187582e-01   +6.091848976130678e-01   +8.170503368893501e-01   +3.981911822641506e-01; +3.585279506103716e-01   +1.888110407507462e-01   +5.479496712243130e-01   +4.046358340522216e-01   +1.280709484707137e-01   +2.738578322546458e-01   +8.071394517945440e-02   +7.822770086952803e-01   +2.502385620175881e-01   +3.235100190147050e-01   +3.959173512604872e-01   -8.700238182118268e-02; -5.064363168677299e-02   +1.715063031851072e-01   -1.086950494188111e-02   +5.088327723857591e-01   -3.180976266729890e-02   +2.830144781750299e-01   +1.963121951621370e-01   +2.356056678913579e-01   -5.884787159536719e-02   +8.500094785694880e-02   +2.393194412191950e-01   +2.368094966184506e-01; +4.256618348509106e-01   +2.930609143239695e-01   +5.422549239209255e-02   +3.324307037029121e-01   +4.335989070507466e-01   +1.894425519716237e-01   +2.345659413477435e-01   +2.275499752272047e-02   +6.332995081729423e-01   +2.379189242196991e-01   +4.676032315855966e-01   +5.214062663018982e-01; +7.490330228338934e-01   -1.485421706182770e-01   +5.166865762078006e-01   +4.497434498191463e-01   +3.094257702297151e-01   +7.877730564168773e-01   +4.704361236608514e-01   +6.442605014466268e-01   -1.423515714701998e-02   +6.565149272363434e-01   +5.243414536622775e-01   +3.879924109156547e-01; +6.918095654011188e-01   +4.220104834842590e-01   -8.854033240023287e-02   +5.798498888394562e-01   +9.683546024249551e-02   +6.526439159091701e-01   +5.803215198182484e-01   -8.982212720322302e-02   +1.994475447679771e-02   +6.496325518390633e-01   +2.569504893564661e-01   +4.627431523967838e-01; +8.895851655058870e-02   +4.836954919089521e-01   +1.630652348813551e-01   -1.423514186989527e-01   +9.428440089898359e-01   -3.065564295500891e-02   +2.796678949797817e-01   +5.409426298083003e-01   +1.632660989165436e-02   +4.812724835363135e-01   +1.738321575331443e-01   +6.704247782865556e-01; +2.752704252473249e-01   +6.655829776591966e-02   -6.165392184411831e-02   +8.951156337349947e-02   +5.599901934577078e-01   -1.090744749505234e-01   +4.466717864117967e-01   +1.234565005824496e-01   +1.777504617844865e-01   +4.193993885013433e-01   +5.911020886768791e-01   -6.505720183719606e-02];
L3I_L2I_iGABA_netcon = [+6.198352623382191e-01   +4.115571347800108e-01   +5.890200170756636e-01   +9.421499662056171e-02   +1.398235581556291e-01   +4.265269254121443e-01   +4.313639219065224e-01   +9.881731922626757e-02   +2.508557969598528e-01   +3.275022376403149e-01   +4.605180883266587e-01   +6.513857873645637e-01; +4.254270780565276e-01   -3.460782915344163e-01   -1.805319997436945e-01   +6.405279025414131e-01   +3.756721521404501e-01   +4.704270284327705e-01   +2.645337832375694e-01   +1.597700595724672e-01   +7.348740272171276e-01   +9.521201149043453e-02   +7.260597511760158e-01   +3.808826064909224e-01; +4.238017170344725e-02   +5.795612382125284e-01   +6.953671713994239e-01   +6.300493775904694e-01   -1.810810724469953e-02   +4.030763716632835e-01   +1.177522387591263e-01   +6.429914921266473e-01   +4.876434709191915e-01   +3.688332614502632e-01   +7.262507448621512e-01   +7.205496750593707e-01; -2.289692436535789e-01   +2.500536213560469e-01   +8.383023707957307e-01   +4.284813724232777e-01   +5.138968366585871e-01   +4.893765305909392e-01   +1.058381021213375e-01   +3.289687034942705e-01   +8.000090065121500e-03   +2.000059347869932e-01   +2.073411841804086e-02   +6.253780868657319e-02; +1.395216671239411e-01   +3.531331088288109e-01   +3.480867267466721e-02   +2.642127481200403e-03   +2.219418989649198e-01   +2.673468631172461e-01   +3.357451833534157e-02   +2.189825065734423e-01   +2.435843378446168e-01   +5.175119943920805e-01   +6.604666274579547e-01   +6.263284389098736e-01; +5.798005545227872e-02   +5.085885343479994e-01   -7.150219425566019e-03   +4.690993362174932e-01   +4.644050920190224e-02   +1.723569927895383e-01   -2.064388603471784e-01   +8.545925610116141e-02   +2.593709246010925e-02   +7.256605007740347e-01   +6.668198842784178e-01   +6.455667921224908e-01; +6.100270181056393e-01   +4.637266641535333e-01   +5.069318237715038e-01   +4.365565579018602e-01   +4.047640826093639e-01   +2.177645572976056e-01   +4.301753405642021e-01   +2.085825854663859e-01   +1.422572983665303e-01   +6.491935924691602e-01   +1.547002417494530e-01   +4.911459212503668e-01; +5.419046206655508e-01   +7.913866859755170e-01   +2.847605400390875e-01   +5.921799850792366e-02   +4.534749796617590e-01   -2.607666545291417e-01   +9.833042816192763e-01   +5.607918543783230e-01   +7.386153976061305e-01   +5.024386726837606e-01   +3.449139685574780e-01   +6.041203141775290e-01];
L2E_L3E_iAMPA_netcon = [+5.567451180408926e-02   +2.542436718648977e-01   +9.749582069225991e-02   +4.528889994277436e-01   +5.187559101368876e-01   +1.705522129803902e-01   +9.549021046245112e-02   +3.703028426946955e-02; +5.052806333635967e-01   +5.207974936874349e-01   +1.056644051000977e-01   +6.260120226047255e-01   +6.730022360645624e-02   +4.961054193406469e-01   +1.187481892285223e-01   +6.359053949598757e-01; +6.105036368121228e-01   +3.661954409662391e-01   +9.047464523517910e-02   -1.064167352101587e-01   +6.146162451255123e-01   +7.252186767243705e-03   +2.450552137623480e-01   +2.621160890063347e-01; +2.089877090061634e-01   +5.001231477418830e-01   +4.338284204266699e-01   +3.767674764511698e-01   +6.375961203514249e-01   +2.922168784459838e-01   +1.476421025270084e-01   +4.021695142043374e-01; +1.465685338457516e-01   -9.085281159719052e-02   +4.094857288894865e-01   +4.703788622494315e-01   +3.204262615499213e-01   +1.260961853092203e-01   +6.850632783160173e-01   +1.601519753217507e-01; +4.927163827886000e-01   +4.903506932551787e-01   +2.575123633131418e-01   +7.752410397265775e-01   +1.767302943141808e-01   +4.350488610525992e-01   +2.971045439259594e-01   +6.090909564477461e-01; -2.875138753137338e-01   +3.428965642596726e-01   +3.559514424808989e-01   +3.985925151256886e-01   +1.068868566336329e-01   +6.367881677386407e-02   +7.517842717861803e-01   +3.597185662062589e-01; +9.785617780315578e-02   +6.567513057423707e-01   +2.708140860889298e-01   +2.595663311691095e-01   +2.900842776203157e-01   +3.893453351648655e-01   +5.299767189839066e-01   +1.612713121619448e-01; +6.765895256595816e-01   +7.466406903011469e-01   +4.467882946631305e-01   +7.527171056745108e-01   +2.200533415631588e-01   +4.097432158721155e-01   +5.133519803619869e-01   +9.854060886858348e-01; +2.487839703031349e-01   +2.035840826304561e-02   +2.311823584263747e-01   +5.669146770028383e-01   +3.448646338664555e-01   +2.307855057000714e-01   +7.384101358073433e-01   -2.878908021961157e-01; +1.285716341673412e-01   +2.298194418825104e-01   +8.631425358234229e-02   -3.294432697447698e-02   +2.617827054790830e-01   -6.781386956802352e-02   +2.682446579490141e-01   +8.207728911534167e-01; +3.961476224411649e-01   +2.099460135613782e-01   +4.795183253173295e-01   +6.149120691211898e-01   +7.686505887616230e-01   +1.844723795640068e-01   -4.130771770235923e-02   +4.368193025944941e-01];
L2I_L3I_iGABA_netcon = [+2.613053212477016e-01   +3.667242372496045e-01   -1.214112735586749e-02   +9.973978447720780e-01   +3.004151537444412e-01   +9.732909372895576e-02   +5.451732001354417e-01   +2.716109927576920e-01; +2.507401300234257e-01   +1.188446600045237e-01   +1.196840415888866e-01   +2.922539396155813e-01   +7.166352096704320e-02   +3.691273307722917e-01   +9.129200337489899e-01   +2.399025619681190e-01; +4.486498505181708e-02   +4.399192198296930e-01   -9.706576443421970e-02   +6.792132553141541e-01   +1.778071902706131e-01   -2.600029962331432e-02   +2.088115884529392e-01   +4.054605419470511e-01; +6.098769306768217e-02   -4.372871998952773e-01   +3.524540176912795e-01   +5.209650868376212e-01   +7.459370886527059e-01   +2.263196069994245e-01   +4.678027080386085e-01   +2.154890689288655e-01; +3.001344801495603e-01   +5.145195445671433e-01   +3.054541744133817e-01   -9.826947513006731e-02   +3.324284950471816e-01   +2.083837984799140e-01   +2.962397431162269e-01   +5.459715538288241e-01; +1.036211767537440e-01   +4.065575298204446e-01   -7.456637147281706e-02   +4.723351319951452e-01   +4.348965422801497e-01   +7.734732181594567e-01   +1.064415382253681e-01   +3.926130794510723e-01; +5.627038778981884e-01   +2.755840637028606e-01   +3.362452566296162e-01   +4.715570709380967e-01   +3.499426305430515e-01   -1.850399912188795e-01   +1.065851740067317e-01   +3.207043707319586e-01; +4.517759723331689e-01   +6.667035499521363e-01   +5.753884502641023e-01   +2.296365940653596e-01   +9.700137948935147e-02   +5.263248502664126e-01   +2.624502176747316e-01   -9.975347369975929e-02; +1.283076675073882e-02   +6.094191633505696e-02   +2.426382836061078e-01   +3.595105091389116e-01   +5.198498493638003e-01   +4.963723299065017e-01   +4.199440938100877e-01   +2.399612186396698e-01; +5.088350431327818e-01   +9.954716355708960e-02   +3.786109758442298e-01   +3.183859940840423e-01   +3.876781288129627e-01   -1.007453535770982e-01   -1.116539613502453e-01   +3.550171277406640e-02; +3.550408890366302e-01   +8.094759756021563e-01   +2.865515146623737e-01   +5.325893504984098e-01   +2.140078084048344e-01   +7.210180920530371e-02   +3.325744797991191e-01   +1.788114381612712e-01; +8.180425774695337e-04   +2.851756644078103e-01   -3.397273493392008e-03   +2.208478541814536e-01   +7.360955512863909e-01   +5.412620900263040e-01   +6.945452312239477e-01   +2.298147075377073e-01];
L3I_L3E_iAMPA_netcon = [+2.303194400601158e-01   +7.284417372016552e-01   -1.934703075070950e-01   +2.965425049891541e-01   +1.000000000000000e+00   +9.149890829897700e-02   +5.160235225679882e-01   +6.617003174715826e-01   +5.240345487122171e-02   +1.599184335008013e-01   +2.096316323608756e-01   +3.298309466476010e-01; +6.508861604351905e-01   +8.787415636097563e-01   +3.172753152406180e-01   +3.272435166853048e-01   -2.204521609038687e-01   +6.902410333886591e-01   +5.389282064985077e-01   +8.448196712061810e-01   -6.848702650922514e-02   +7.741575537997413e-01   +3.676241543507814e-01   +5.154507799345487e-01; +5.031501369312673e-01   +6.077731125241992e-01   +6.469119134096947e-02   -2.392887078328883e-01   +7.752163070487381e-01   +6.668353901947701e-01   +4.242823820265943e-01   +8.422528879623348e-01   +8.851918499239959e-02   +3.877487834467039e-01   +8.438478960479452e-01   +4.964708548382338e-01; +7.306473284699316e-01   +3.213164178431775e-01   +3.951863313698485e-01   +8.770180277175440e-01   +7.430535425827430e-01   +8.666422670965510e-01   +7.855178039814493e-01   +6.984641924011018e-01   +3.073405783097155e-02   +6.456485325575031e-01   +2.866880126641186e-01   +7.434267529268248e-01; +5.337543309889399e-02   +9.663197744269202e-02   +2.978675238788830e-01   -1.598014014879615e-01   +6.365484258865366e-01   +8.382475100712760e-01   +1.309137970278379e-01   +7.756095463241185e-01   +8.644348515359286e-01   +2.997970686275512e-01   +6.510710718525680e-01   -2.367893156986426e-01; +2.370030118176424e-01   +8.511447467722347e-01   +1.716092805697362e-01   +4.892678385453004e-01   +4.716334725150568e-01   +1.247054068815908e-01   +3.923061984657286e-01   -1.815911780716502e-01   +3.317224362514144e-01   +2.567371016034978e-01   +3.521081471313304e-01   +2.805544414014471e-01; +1.793210160742406e-01   +2.022028595377217e-01   +2.242261115466132e-01   +9.689385694417285e-02   +9.027077926835739e-01   +3.601247017423423e-01   +4.303227535533433e-01   +5.709043042931058e-01   +1.414389422850948e-01   +6.088027368488377e-01   +2.505412745162796e-01   +2.284092269018478e-01; +2.681854213077470e-01   +3.893461334965621e-02   +4.558387101309861e-01   +6.175490111223057e-02   +2.581807823803195e-01   -1.028929429773722e-01   +9.149941209915352e-02   +2.854916693420227e-01   -1.077076201555431e-02   +7.279641626419745e-01   +3.376503140244722e-01   +3.970555052645519e-01; +2.661479546135468e-01   +3.407802813111537e-01   +4.083699923933629e-01   +1.964388978985722e-01   +4.229933329295752e-01   +1.228226107142742e-01   +2.543369558057555e-01   +1.819549238801332e-01   +5.488666734142384e-01   +1.277710153504773e-02   +3.051636591486733e-01   +5.508412976942002e-01; +6.094032067480266e-01   +6.674570112823822e-01   +4.162296654963253e-01   +5.480382049168716e-01   -1.096310826340988e-01   +5.181640645161742e-01   +6.773634419443406e-01   +5.864552979998657e-01   +7.504619852382458e-01   -1.839295623551351e-01   +6.406649480525495e-01   +3.112067080137909e-01; -1.540658479652146e-02   +1.384468086306674e-01   +3.433397205414856e-01   +4.316088591449510e-01   +1.348736663860848e-01   +2.358555504507648e-01   +9.884665237553399e-02   +7.078569554168903e-01   +8.452366311339716e-01   +7.536516189224418e-01   +1.844775030184866e-01   +3.712056417595367e-01; +5.088848354215920e-02   +4.939290309571125e-01   +1.483893278942550e-01   +5.961198792958259e-01   +8.778886535668818e-01   +7.995115411957579e-02   +2.021593657858663e-01   +3.430170335756203e-01   +5.282818958638780e-01   +3.371204543759591e-01   +4.295615320306131e-01   +2.341924959802072e-01];
L3E_L3I_iGABA_netcon = [+6.848478623040144e-01   +9.884537376466609e-02   +1.189642945457828e-01   +6.467987080583971e-01   +5.157258442490960e-01   +8.856679621971264e-01   +7.614420381380840e-01   +8.476127775077915e-01   +5.975574549637506e-01   +1.650311189572894e-01   +2.963552477268541e-01   +4.410484108055804e-01; +4.744430587952752e-01   +2.382843643490548e-01   +8.085210387719365e-01   +2.061764898824269e-01   +3.433260358914138e-01   +7.863889195770818e-01   +9.973604751399961e-01   +1.798372422470132e-01   +3.479373738357719e-01   +2.212973243881183e-01   +9.689146927467686e-02   +5.372452946555204e-01; -6.361197105751880e-02   +6.034320996137236e-02   -1.850918921235995e-01   +3.979276728973093e-01   +1.136506097790736e-01   +4.319852357709341e-01   +4.350258113616504e-01   +5.337187972795367e-01   +5.701282603292545e-01   +6.188079132385725e-01   +5.205519121519702e-01   +3.356817195323621e-01; +4.084053409131163e-01   +7.392017218602237e-01   +4.983199280770041e-01   +1.001661472074418e-01   +6.049973734029764e-01   +4.868179736933671e-03   +3.814928158556732e-01   +3.176931449436583e-01   +4.724850976206608e-01   +5.067427976465716e-02   +4.549825744627176e-01   +3.794497603524469e-01; -2.603879127063703e-02   -1.232989629510184e-01   +3.928860114273409e-01   +3.516160264759842e-01   +3.135655152758005e-01   +3.902682200408752e-02   +5.254322579800839e-01   +4.130253097653553e-01   +2.643055684676692e-01   +1.592638030222030e-01   +4.188399093026788e-01   -1.947093518980123e-02; -3.338626521021529e-02   +7.042620506482054e-02   +6.260227130854500e-01   +6.784816858595838e-01   +4.860927249140384e-01   +9.598795785096055e-02   +1.069565899798421e-01   +1.860344613994738e-01   +3.741880451403774e-01   +5.499474842432384e-01   +5.332588530179315e-01   -1.962165245191074e-01; +6.829448953956276e-01   +2.870681781719241e-01   +5.176443511266832e-01   +1.272320049991186e-01   +5.477270438138623e-01   +3.715846205789621e-01   -1.370503556361129e-01   +6.420885460735096e-01   +4.328408315352389e-01   +3.579393433144132e-01   +5.016968599789551e-01   +2.268174101428011e-01; +1.395782053814384e-01   +1.592136917297503e-02   +1.729128986103890e-01   +5.944354309799745e-01   +5.908964259360542e-01   +2.203392341385151e-01   +5.371269848567642e-01   +9.103628753999424e-02   +3.395167476746637e-01   +1.693221252755048e-01   +4.592695495506087e-01   +6.926476693720893e-01; +3.762971960326085e-01   +2.495833623043986e-01   +4.720008376599070e-01   +7.626805335694624e-01   +4.388632593557382e-01   -1.895831118151453e-01   +5.785139243261735e-01   +5.248184881617113e-01   +2.113356973835727e-01   +1.147630354132647e-01   +5.231146347560965e-01   +6.950746598915286e-01; +2.366602328171391e-01   +7.723264389777090e-01   +8.529678727827799e-01   +9.132600012252309e-01   +3.531210190604070e-01   +2.084016030709501e-01   +7.540420791294945e-01   -1.438757744473310e-01   +8.159038513729420e-01   +4.427093198510809e-01   +2.110490469665463e-01   +1.042436900021436e-01; +1.287255667905800e-01   +4.058023360352164e-01   +2.053906736272454e-01   +5.876281259935777e-01   +5.741205487815801e-01   +1.897630875263965e-01   +5.213403658726689e-01   +6.268796503112591e-01   +6.991427254635640e-01   +2.688750044844467e-01   +1.272948653372926e-01   +7.434724454287271e-01; +8.159771671767718e-01   +2.167626197305859e-01   +4.433851491199530e-01   +5.032420257713192e-01   +4.128973513450117e-01   +4.728937929637356e-01   +3.518420183609995e-01   +3.395292103814574e-01   +1.967536725819941e-01   +3.340363242391178e-01   -1.419115114694160e-01   +2.571521984555470e-01];
L2E_Input1_iAMPA_netcon = [+4.912598442954909e-01   +5.956403255256083e-01   +5.729086074328452e-01   +6.477487209019536e-01   +8.681444721714010e-01   +5.542802489877541e-01   +9.911722943402124e-01   +5.300583670095398e-01];
L2I_Input2_iAMPA_netcon = [+8.084161273041209e-01   +5.362170305505289e-01   +6.543175613996831e-01   +6.531993917538004e-01   +5.448893210519059e-01   +8.802078001699214e-01   +2.042533632371287e-01   +5.855379638956038e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
