function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.478801710164098e-01   +2.162063833914529e-01   +2.340630189952331e-01   +6.562571726629784e-02   +9.762058799903411e-01   +6.025455903547716e-02   +7.109294997585011e-01   +4.562525581487057e-01   +8.689632398437918e-01   +4.661621304024444e-01   +7.583653836590100e-01   +6.069133718440182e-01   +5.337959587257987e-01   +2.838973884178309e-02   +4.260642306317208e-01   +2.400063729890872e-01; +9.261554643360129e-01   +3.018199425127240e-01   +7.374642480065422e-01   +1.656596700944830e-01   +5.047337167594964e-01   +5.416077027862662e-01   +9.637622634413165e-01   +1.794092202287960e-01   +6.865573188958600e-01   +1.026034729455443e-01   +8.749417269407502e-01   +6.354945004375256e-01   +7.688926528303355e-01   +9.686110049360798e-01   +2.003686169640629e-01   +8.955551008255312e-01; +7.176014699762401e-01   +5.411191138189256e-01   +1.639119679032940e-01   +5.195457378770706e-01   +6.072536911851660e-01   +7.725028174184538e-01   +6.411858723987364e-01   +9.857484729555883e-01   +2.243925028517780e-01   +2.357858514125674e-01   +9.861568174249091e-02   +2.740317746189233e-01   +5.037731437187347e-01   +5.643101978980776e-01   +7.830222759733640e-02   +6.826853867865063e-01; +7.074465898856368e-01   +9.480640481009415e-01   +2.806227885239417e-01   +3.432575106809310e-02   +8.237282160540094e-02   +9.481943477388939e-01   +6.898846404726650e-01   +4.801108401081684e-01   +3.042210803311605e-01   +2.396123661661764e-02   +2.838351017177619e-01   +6.509816287229571e-01   +5.552557884378946e-01   +5.965748651518753e-01   +6.574485160267627e-01   +4.557791275150792e-01; +7.894577382007717e-02   +4.429282845415515e-01   +6.451887144437849e-01   +5.714001048551852e-01   +5.301562853330901e-01   +7.299751241634670e-01   +3.915345279162856e-01   +1.484087893608048e-01   +5.416532961335582e-01   +7.517280846859803e-01   +8.308343630360551e-01   +9.107370308041774e-01   +7.797552801432636e-01   +9.214588256890777e-02   +2.836356609167239e-01   +7.553467402719574e-01; +2.436973266503317e-02   +3.125203129292016e-01   +8.220944107879748e-01   +6.178527593952239e-01   +8.449913391581214e-01   +2.380272660739072e-01   +2.627289083192041e-02   +4.725888833604450e-01   +8.461284923360194e-01   +7.845710882837885e-01   +9.825590392307058e-01   +3.892936310747858e-01   +6.771400902106768e-01   +4.776610799803116e-02   +6.277459042666487e-01   +5.876003782284023e-02; +6.865894671699156e-01   +4.522113804162806e-01   +6.151434023715980e-01   +4.084388626159297e-01   +1.785658498181347e-01   +5.430467448629385e-01   +8.115723400777153e-01   +1.695522436287531e-01   +1.768860011617353e-01   +1.968668639877253e-01   +8.814574993980765e-01   +8.679388166437705e-01   +9.170101363586556e-01   +7.647859552272780e-01   +1.117951655767007e-01   +7.377971027099578e-01; +7.033675804943702e-01   +1.456506593544538e-01   +7.427145650741515e-01   +4.989135918948288e-01   +2.262704624832049e-01   +7.395825839499086e-01   +3.297578438846598e-01   +8.144449799596094e-01   +5.277934228185071e-01   +9.064244689367327e-01   +3.080594559447362e-01   +3.317243029301495e-01   +2.579649077096045e-01   +4.126602586512369e-01   +7.472487348680042e-01   +5.798424288453466e-01; +6.284585223117500e-01   +6.985701743660141e-01   +9.350734906246023e-01   +5.049037459863651e-01   +1.018296903963812e-01   +2.760318108228430e-01   +6.419109125471028e-01   +1.772341166214516e-01   +4.086193910749664e-01   +8.039468789520524e-01   +3.472384736512991e-01   +5.145661952698594e-01   +9.247373816323287e-01   +9.578988028156737e-01   +4.589533780271168e-01   +3.991686002161898e-01; +3.933037053241015e-01   +2.638605326301059e-01   +6.071880945595239e-01   +7.714872473565820e-01   +6.395677283537273e-01   +2.579089980967876e-01   +5.767643717255655e-01   +3.893815304418347e-03   +9.152547739699024e-02   +3.527276392039691e-02   +9.405487828372633e-01   +9.258501360204796e-02   +9.484107716059155e-01   +4.233926212882343e-01   +8.933801475418046e-01   +8.906443695919450e-01; +5.556371829707830e-01   +7.171260198226497e-01   +3.772665377847880e-01   +7.319506151459516e-01   +1.649234104419617e-02   +7.549665173585134e-01   +1.488849254289669e-01   +8.042042738391983e-01   +5.942255651125915e-01   +2.586164178832181e-01   +4.891975458769652e-01   +5.090473843030028e-01   +9.208343954856090e-01   +9.683069494492077e-01   +4.898232309061206e-01   +9.638716116707761e-01; +6.060102575828655e-01   +8.764174849572695e-01   +3.109409422718064e-01   +8.662673647428870e-01   +2.021619285433905e-01   +4.139694896869178e-01   +3.641428552293009e-01   +6.353839503073624e-01   +2.605699510570574e-01   +4.403676219885535e-01   +5.465477126526499e-01   +9.046048491097419e-01   +3.665877597081011e-01   +5.863743396266630e-01   +4.224055305080411e-01   +7.686019889207573e-01; +8.019425322080403e-01   +4.004570389492818e-01   +1.111786474024578e-01   +3.018400600226617e-01   +8.565930283456571e-01   +7.069599817601794e-01   +9.275348264760487e-01   +1.505509751811229e-02   +9.109415265511358e-01   +1.378524447963295e-01   +3.722567456135024e-01   +3.286071854458613e-01   +4.005543742085471e-02   +8.683991061397783e-01   +8.230582536345481e-01   +7.162094833403321e-02; +4.234884910861791e-01   +8.435887205739079e-02   +3.426125611691205e-01   +8.286277081719754e-01   +4.511239371729417e-01   +7.104517793929740e-01   +6.109212194611042e-01   +9.800668745197832e-01   +4.123916303110389e-01   +7.834965338461747e-01   +8.183891217003633e-01   +7.681675043716435e-01   +9.343378583283867e-01   +5.883188627533995e-01   +1.994127840257826e-01   +9.941018343326284e-01; +1.875340406214772e-01   +4.286928958441224e-01   +5.368764634341902e-01   +9.290754469220381e-01   +9.059513580857574e-01   +3.504886848788940e-01   +4.465593609105732e-01   +5.237127495316686e-01   +2.970928127276808e-01   +6.812965669846336e-01   +6.457578112653606e-02   +1.078944897826473e-01   +2.579732579137749e-01   +1.188923375544372e-01   +1.702000761078247e-01   +9.689226495672018e-01; +8.774936876322061e-01   +9.019607359043659e-01   +1.861196351150640e-02   +1.434179112838569e-01   +1.462448313269247e-01   +3.196340116418587e-01   +8.954686697030917e-01   +3.084020443445282e-01   +6.464744210451789e-01   +2.618187362990185e-01   +8.670086407687276e-01   +8.328697213080228e-01   +8.928096166046213e-01   +2.687589083780487e-01   +2.848729300990032e-01   +2.098182007720460e-01];
L1E_L1I_iGABA_netcon = [+7.901126562135761e-01   +8.470495014409828e-01   +1.739296176131797e-01   +2.007724631957331e-01   +5.344535758188168e-01   +8.225560894549133e-02   +8.464402652376298e-01   +6.465657224753291e-01   +5.988850632965366e-01   +9.647619926951676e-01   +3.503017145755027e-01   +4.582208585655755e-01   +5.060172556054034e-01   +7.901161560587507e-01   +4.358104099589900e-01   +7.038156760539511e-01; +1.775274823788754e-01   +3.739305777351730e-01   +9.358606445947570e-01   +8.231679607527893e-01   +7.161420632950775e-01   +3.785167653930068e-01   +9.053807615226216e-01   +5.013229501608898e-01   +3.258555112185135e-02   +7.408933717009686e-01   +2.339933192097079e-01   +2.053601392628500e-01   +9.686138885424711e-02   +9.575202253290312e-01   +6.327858411372091e-01   +3.385047219711321e-01; +8.293534505552500e-01   +5.954025437352238e-01   +3.711064882426285e-01   +4.772962912843709e-01   +7.169146747659864e-01   +2.391068251619836e-01   +5.067124181322140e-01   +8.562971999420919e-01   +7.941665769038344e-01   +6.857692594120636e-01   +2.009055463644871e-02   +9.989016632227726e-01   +6.179568288786255e-01   +8.242972777820786e-01   +8.019012037076100e-01   +3.106590947234084e-01; +2.334475457811473e-01   +7.867195410686958e-01   +3.318231642214086e-01   +8.014248384763308e-01   +1.445746263655938e-01   +1.856852320996949e-01   +9.286450306719721e-01   +3.836988875066387e-01   +7.564986520233393e-01   +2.284597430533563e-01   +8.110585596629206e-01   +9.247986085856649e-01   +9.537688050842895e-01   +8.709263972631099e-01   +2.959321872639918e-01   +5.575902699741071e-01; +5.926470423298354e-01   +9.920857820723784e-01   +2.641102263733505e-01   +3.454285705628268e-01   +1.091316609843286e-01   +3.742791409010665e-01   +8.927469447932930e-01   +6.084379859727179e-01   +4.141373941815387e-01   +3.350589894969056e-01   +8.071052488031287e-01   +2.118885076059220e-01   +2.679584071542818e-01   +4.848854364319236e-01   +8.577700912792880e-01   +9.390438727495720e-02; +1.319498677291495e-01   +7.333775256904823e-01   +1.727689040028924e-02   +6.358809107076698e-01   +7.142602382545645e-01   +1.343512566418339e-01   +1.122662113490546e-01   +7.762416239386825e-01   +6.054346064066007e-02   +7.593821111768552e-01   +9.346163027049644e-01   +4.307368498824862e-01   +5.439228248727205e-01   +2.492835041293329e-02   +6.631630001848808e-01   +6.101275384513624e-01; +9.358693657250191e-01   +3.205069932386195e-01   +3.954579381571827e-01   +4.292044425045447e-01   +8.849363778639996e-01   +4.822204867776879e-01   +9.059732572621320e-01   +7.523706143354014e-01   +2.080865658513653e-01   +1.929758110494196e-01   +2.263980173232417e-01   +6.555217248314160e-02   +5.384258531298040e-01   +2.735364581865941e-01   +6.793201151100333e-01   +7.761431597349907e-01; +7.394277754055988e-01   +4.931805725953110e-01   +2.572167609955134e-01   +1.655534698094644e-01   +4.357314203891459e-01   +8.450590257010798e-01   +6.312261255761784e-01   +2.145353271227666e-01   +5.003772204819634e-01   +8.910678574663677e-01   +6.000953058993580e-01   +2.069447148644237e-01   +8.574287411916541e-01   +9.489393017546938e-01   +2.821234004461536e-01   +8.200855100203974e-01; +8.806415477565183e-01   +6.128477065838102e-01   +4.010333374936021e-01   +1.560204151452402e-01   +2.476003746013826e-01   +5.473146166942733e-01   +8.871941991044455e-01   +4.870659195549681e-01   +7.474400893143143e-01   +8.237705823203552e-01   +9.713009209206735e-01   +3.971719211575233e-01   +1.273682585884879e-01   +4.453895378250816e-01   +3.811027967841268e-01   +4.733536236496104e-01; +2.973378728894382e-02   +6.111049223441909e-01   +1.687933829797000e-01   +7.299315395950550e-01   +2.790219109730961e-01   +8.216784822155933e-01   +7.520744410390172e-01   +3.316176181563217e-01   +5.478702590416203e-01   +9.306711818564505e-01   +1.561198124071285e-01   +3.964657073440595e-01   +2.256763504669163e-01   +4.531252881379654e-01   +6.907302011670160e-01   +1.033840788239289e-01; +8.904532756006073e-01   +9.751423015158189e-03   +7.346334498533307e-01   +4.536550456399231e-01   +6.224837542498760e-01   +9.388079617952090e-01   +1.401896102316091e-02   +6.976700103240223e-01   +1.304744238646580e-01   +7.882217012763245e-01   +4.754945920565309e-01   +8.410227533359920e-01   +4.981667516497182e-01   +9.988034428505255e-02   +5.915528842656012e-01   +8.245909199362307e-01; +2.251465107597626e-01   +1.341920620670616e-01   +3.306159801629630e-01   +6.848925529718086e-01   +3.327223832968182e-01   +9.523234256539314e-01   +7.535033637515409e-01   +1.349015949301428e-01   +9.739311257241086e-01   +7.563117928552739e-01   +6.843505830769542e-01   +1.082162009991159e-01   +3.536884977476307e-01   +2.376779891448435e-01   +7.721490428662503e-02   +6.613329058147087e-01; +7.561697961394739e-01   +1.640984382564721e-01   +3.471193005927771e-01   +7.212856886398809e-01   +6.601824532663219e-01   +2.538942422246616e-01   +7.488840805688052e-01   +3.499970595901798e-01   +2.566807231645890e-01   +3.822745715229123e-01   +1.001825351243785e-01   +8.399441733521880e-01   +6.977714498494205e-01   +8.225994831875895e-01   +3.303684984914146e-02   +2.101158177113398e-01; +3.172061552417950e-01   +8.915272190651589e-01   +7.691227355803765e-01   +2.931284061414753e-01   +6.651646746470642e-01   +4.597659624748761e-01   +1.866258222321636e-01   +8.167252327107958e-01   +6.773294571054577e-01   +1.874397555451170e-01   +8.721014213639445e-01   +8.334955668792529e-01   +9.918404461251091e-01   +9.348346787183469e-01   +3.197274907141463e-01   +8.472707109736024e-01; +6.676184014044891e-01   +1.455189440902007e-01   +9.125724552723481e-01   +9.489776210055745e-02   +4.521553721021712e-01   +9.879176671806226e-01   +2.690417260887188e-01   +7.144828808134197e-01   +8.145038784343560e-01   +7.097899481490362e-01   +6.224690579246506e-01   +2.962119163212895e-02   +9.683737986069807e-03   +6.707887124429952e-01   +7.546963776201980e-01   +2.268491006622494e-01; +1.893961840283074e-01   +2.401370029534302e-01   +2.405682763308048e-02   +7.750540210636102e-01   +8.716089483438072e-01   +7.109865184399401e-01   +8.943794470098536e-01   +3.806235055900384e-01   +9.660611386996550e-01   +6.834984900903008e-01   +5.773510661136526e-01   +2.354479184476279e-01   +1.769498700242614e-01   +7.529517718426981e-02   +9.979656273251212e-01   +6.869930376940461e-01];
L2I_L1I_iGABA_netcon = [+1.341681017827782e-01   +2.886296279280637e-01   +9.485620649533297e-01   +9.239838632250151e-01   +2.712691582496071e-01   +2.700683222248023e-01   +6.004878630277628e-01   +6.299110713619904e-02; +6.164969127733018e-01   +8.808087110339422e-01   +1.793493918885891e-02   +5.739631353441055e-01   +8.309826807760919e-01   +3.385182590126984e-01   +9.041838095670618e-01   +8.332655068880753e-01; +1.637147375938366e-01   +2.388320685360901e-01   +3.458578562140546e-01   +6.693822522005919e-01   +3.275033376936657e-01   +5.782786966154879e-01   +5.321133240157127e-01   +3.038044321079155e-01; +7.643390502846455e-01   +8.705968840841888e-01   +4.465049146591792e-01   +9.727685096976817e-01   +1.370925930690418e-01   +7.904762626809982e-01   +3.406692646709276e-01   +1.807736777431563e-01; +2.489973766103462e-01   +8.361297739430930e-01   +7.334517888926111e-01   +7.565155689134813e-01   +7.215929059639336e-01   +9.870207090388017e-02   +9.136049237860380e-01   +1.115043606826627e-02; +9.024828297791154e-01   +3.626046840472559e-01   +7.469814391245270e-01   +1.781892315180650e-01   +7.310187715172507e-01   +8.548830051266753e-01   +6.782069030122817e-01   +4.915448808050340e-01; +4.246730325993067e-01   +8.536133041061922e-02   +8.246567236210841e-01   +9.435645293365030e-01   +9.501740452293158e-01   +9.006699921170072e-01   +8.776637632113821e-01   +3.072798055021969e-01; +6.454786287407418e-01   +6.342521508989563e-01   +4.005570466026676e-02   +3.109701304524769e-01   +9.832481072013677e-02   +2.508961786074834e-01   +9.534047647314802e-01   +9.147218220805499e-01; +8.289339279813135e-02   +2.738879830996982e-01   +1.710878453160523e-01   +9.213453899944893e-01   +9.144967869420813e-01   +5.768641323128288e-01   +3.709465971956830e-01   +6.111431000149103e-03; +9.770347869613119e-01   +2.205146860320328e-02   +2.707109118022659e-01   +5.066288526836032e-01   +3.248977945513971e-01   +9.798374332472948e-02   +1.231009646184764e-01   +8.828374856368374e-01; +7.162778697993986e-01   +8.139064336225270e-01   +7.190571333101704e-01   +5.682913354005393e-01   +8.593155679512039e-01   +5.386039728374237e-02   +6.119468144846317e-01   +1.202298802861512e-02; +7.194538693665046e-01   +3.977146789215148e-01   +8.996919827302475e-01   +9.473576143241038e-01   +4.924870350871862e-01   +2.185005140540333e-01   +3.358598862136005e-01   +5.748205081557344e-01; +3.751676656566871e-01   +9.334029482089985e-01   +6.745441631879315e-01   +7.183034056566049e-01   +3.465713907234650e-01   +9.355524315467220e-01   +4.569617706803376e-01   +1.290429098834660e-01; +7.732714236813742e-02   +6.980503072623979e-01   +5.105930227417532e-02   +5.718650280575878e-01   +2.166373486113835e-01   +5.653078107598430e-02   +7.062476988493216e-02   +3.345040969528075e-01; +1.554083797065944e-01   +7.249203512370568e-01   +8.178334640882029e-01   +1.007829724526618e-01   +9.072759309488776e-02   +3.024360474903744e-01   +7.814518301852023e-01   +5.994627613806452e-01; +9.032581345038169e-01   +6.361771803481395e-01   +6.400835245875339e-01   +1.416067426032578e-01   +3.444988126196405e-01   +6.450479972815459e-01   +9.332254239412713e-01   +5.670779535872492e-01];
L1I_L2I_iGABA_netcon = [+3.704684493187294e-01   +1.774662113098219e-01   +9.358828248487125e-01   +8.605771041685736e-01   +8.180248143510087e-01   +4.976985540078638e-03   +3.256676595070432e-01   +5.991702035629265e-01   +6.916006943425032e-01   +7.202799192668518e-01   +9.836506970961059e-01   +3.326647929835775e-01   +6.299988836114575e-01   +7.339700400118798e-02   +3.993398087042382e-01   +2.682438424821602e-01; +1.241928586509314e-01   +1.938287528079293e-01   +8.067801825381624e-01   +3.192045947445452e-01   +9.224893927550724e-01   +2.704308338050829e-01   +3.000304124411197e-01   +2.652781211052069e-01   +4.631990512303408e-02   +3.313180853906950e-01   +7.930556480624074e-02   +2.755876198329998e-01   +4.592324481175695e-01   +2.498332304929665e-01   +5.311636791336956e-01   +2.204164386225480e-01; +2.378349125480355e-01   +6.274814202635959e-02   +2.500967727075544e-01   +3.435236004209118e-01   +2.330884637217704e-01   +5.096369683118244e-01   +9.480701139221336e-01   +8.978847710549172e-01   +7.934995714041282e-01   +1.232185859366397e-01   +6.487531513510505e-01   +1.447811283119487e-01   +1.809349360560653e-03   +2.229348888055123e-01   +3.091253050959196e-01   +3.993237352577887e-01; +8.947220152690145e-01   +6.723053118795728e-01   +7.871945858571827e-01   +8.882663757917882e-01   +7.865225982735629e-01   +7.167861504690756e-01   +4.112353574266931e-01   +3.349948111224745e-01   +6.493386537923282e-01   +1.153882703486886e-02   +3.696482880484742e-03   +5.744272975313461e-01   +5.172939657992205e-01   +9.810950004434909e-01   +3.439722226691702e-01   +9.128672067219805e-01; +4.717776112681639e-01   +2.471163879645228e-01   +1.651245302338137e-01   +9.224882304770489e-01   +2.791834008401021e-01   +8.421312054863180e-01   +2.831709468237370e-01   +4.845921820600529e-01   +6.919574430021019e-01   +7.204652300462661e-01   +2.962494493390454e-01   +6.925100978060418e-01   +4.422934773223159e-01   +1.369694809720816e-01   +5.676973890441269e-01   +1.513665977491341e-02; +8.382650748264197e-01   +1.201932607668065e-01   +8.519992099002390e-01   +9.424170345259817e-01   +8.586344377029971e-01   +1.839329041651167e-01   +1.360681236491775e-01   +2.257312527663710e-01   +1.651731179436341e-01   +7.408133140995775e-01   +9.893405561539824e-01   +7.865116888898072e-02   +8.572638024033754e-01   +1.798327945237188e-01   +4.914668261101280e-01   +5.484881466851648e-01; +9.498606909751962e-01   +7.811807642953064e-01   +8.847567559207411e-01   +9.360047562242603e-01   +1.226188858112115e-01   +2.463927564530877e-01   +9.730271848144367e-02   +2.547600354705445e-01   +1.741620496540149e-01   +7.425613427339560e-01   +6.683220938460587e-01   +5.525526899034972e-01   +7.179370659054035e-01   +5.843113255918582e-01   +9.925522801947766e-01   +8.999689135364098e-01; +3.850494566136430e-01   +5.451672967057153e-01   +4.132671831088686e-02   +2.136168875901833e-01   +9.699228968566718e-01   +4.077329455909261e-01   +9.641287506584597e-01   +8.012739523341208e-01   +9.454462960324743e-01   +9.229503869697900e-01   +5.840746211504612e-01   +7.020937902728738e-01   +3.536775417516401e-01   +5.298816309126583e-01   +5.105377753734325e-01   +5.339071435233579e-01];
L2E_L1E_iAMPA_netcon = [+2.360191918769748e-01   +6.160050224960097e-01   +1.075323533446374e-01   +1.603709552072847e-01   +7.431923012381106e-01   +1.518625048103853e-01   +8.935348307083004e-01   +5.104336449388307e-01; +9.466725263921568e-01   +4.680412932667738e-01   +1.016786160322771e-01   +2.272096157719184e-01   +3.240103532330937e-01   +4.717051375532194e-01   +1.637846630052235e-01   +2.301893414828607e-01; +2.873212987975172e-01   +1.748960276875092e-01   +6.277094688011330e-01   +3.868715495969384e-01   +7.268837611017789e-01   +8.588323567707650e-01   +5.431622807538090e-01   +7.999925745583283e-01; +8.043617812255445e-01   +5.480664374840641e-01   +8.445435066969611e-01   +9.630971711896592e-01   +3.405311287212966e-01   +2.841844129754911e-02   +7.946950722113846e-01   +5.229816784019763e-01; +6.675930881361635e-01   +6.906871729881890e-01   +3.113727417890100e-01   +5.002752984730823e-01   +6.564451321902784e-01   +3.707020173555087e-02   +7.014293493702034e-01   +4.571854332996378e-01; +1.165240921147666e-01   +6.646229927271570e-01   +4.442653246747890e-01   +1.913172014241920e-01   +9.456086259336882e-02   +6.061919510090780e-01   +6.850090494043117e-01   +6.279940835800690e-02; +1.248764850191564e-02   +8.899412355939816e-01   +9.593395447626014e-01   +1.692313395286810e-01   +7.372242211256167e-01   +4.363792334256055e-01   +6.777338412086653e-01   +1.097707380037070e-01; +2.287066989725484e-02   +1.796468266921069e-01   +3.394124997699466e-02   +2.210112955399395e-01   +8.632566774749193e-01   +3.031417042534216e-01   +5.806989020829010e-01   +5.980505508673216e-01; +7.489667095846433e-01   +7.805574757527424e-01   +1.578845439176696e-01   +6.622101941650922e-01   +7.491943519979537e-01   +2.946396829751908e-01   +7.820489656565428e-01   +4.828764323669202e-01; +8.783003800755391e-01   +4.568188486594549e-01   +2.402589207601047e-01   +4.198314953087288e-01   +1.283995248658875e-01   +3.418414595484396e-01   +6.855774481928191e-01   +6.885356339977378e-01; +5.971115857065973e-01   +1.147233519345640e-01   +6.118007712292391e-01   +2.182161456397507e-01   +3.417146943166341e-01   +2.406801330281996e-01   +5.126487818703270e-01   +7.872585735022952e-01; +4.699741703880440e-01   +4.355189869290690e-01   +6.064241577771504e-01   +6.501060106243131e-01   +7.164302452621566e-01   +8.687797460757168e-01   +6.197153898651639e-01   +7.316646490666343e-01; +8.022222090091876e-01   +6.462562991853074e-01   +1.784999886331622e-01   +5.877379787012456e-01   +4.732782997673061e-01   +5.120591709124209e-01   +5.738209404237714e-01   +5.963038406418570e-01; +5.189699167176117e-01   +6.501819256887493e-01   +1.103021325807669e-01   +5.616303617566811e-01   +5.219296505066094e-01   +1.495164788344251e-01   +7.736733436168854e-01   +9.339361274174374e-02; +3.782385586834590e-01   +1.083050491898689e-01   +5.250263974911922e-01   +5.932398496566538e-01   +3.220591746185303e-01   +8.188801690808251e-01   +2.742406018289364e-01   +5.141481001511894e-02; +1.724065620783993e-01   +5.584919852433237e-01   +2.549061794923443e-01   +4.061183606508463e-01   +9.404552345390785e-01   +4.046889718363126e-01   +8.333896776838282e-01   +7.334356580818099e-01];
L1E_L2E_iAMPA_netcon = [+2.785054618053163e-01   +4.658165740296640e-01   +6.116885390382487e-02   +8.214832487663083e-01   +1.056066072147471e-01   +7.874430933332758e-01   +3.489270537949092e-01   +5.057498909663410e-01   +1.568782827176793e-01   +3.278385378652137e-01   +1.319279459746582e-01   +1.115907624876308e-01   +4.883531904436959e-01   +4.429469278268742e-01   +9.536068237248185e-01   +5.896146672614100e-01; +5.624136557100035e-01   +5.214510257783097e-01   +2.604938818474293e-01   +6.684052340082736e-01   +3.989434611872045e-01   +6.139931336758545e-01   +8.187248225025158e-01   +7.342257524620119e-01   +7.762573333878661e-01   +9.520077353985129e-01   +4.111675099588663e-02   +7.682094261048346e-01   +2.908888131149278e-01   +8.928100600096628e-01   +3.885733112751506e-01   +4.373111734110102e-01; +5.801502538869219e-02   +2.622590284601192e-01   +9.809661588498041e-01   +7.669327904889549e-01   +4.455868903616069e-01   +9.307945888410261e-01   +9.419926122521527e-02   +3.562141254239169e-01   +6.200935608604525e-01   +6.911030710331790e-01   +5.653419259791092e-01   +6.966460035740060e-01   +6.710108613997556e-02   +3.146851145452886e-01   +6.774726443868708e-01   +3.721342568728879e-01; +1.951743755164198e-01   +5.401209727702151e-01   +9.486538165596489e-01   +6.660501874119243e-01   +4.257600251711530e-01   +6.421137044805157e-01   +5.166894989918465e-01   +9.461065308482206e-01   +7.265497915758338e-01   +1.855304974537516e-01   +2.448943095299458e-01   +5.324505161499687e-01   +4.057179515448951e-01   +5.999917872232752e-03   +8.013800221664036e-01   +2.021067647873374e-01; +6.348913949187687e-01   +3.489033231583034e-01   +9.398679234472272e-01   +1.296091507753367e-01   +8.507257016898365e-01   +5.949285855557684e-01   +8.068661836553085e-01   +7.776834100501405e-01   +8.702823131026394e-02   +7.811545431829736e-02   +7.419210480366242e-01   +9.832067826258051e-01   +9.456030864766427e-01   +3.928768322673621e-01   +8.589943308796332e-01   +2.080554881590908e-01; +5.271368609186730e-01   +2.091372749505206e-01   +6.161047375399357e-01   +1.383001378037882e-01   +3.911652982001571e-01   +6.888083505872243e-01   +7.096122863204333e-01   +2.971340889307921e-01   +1.485516995713341e-01   +8.352838961815912e-01   +5.315066832775022e-01   +9.023340577913337e-01   +7.044344235127612e-01   +9.501398522873078e-01   +8.242648958675848e-01   +5.173187216625188e-01; +9.366533133092885e-01   +6.795383403534005e-01   +6.501794502543681e-01   +5.787762390410873e-01   +9.744861635817286e-01   +1.047226067167714e-01   +9.265737122813575e-01   +2.072203523046984e-01   +8.173991300583247e-01   +7.907944357129078e-01   +4.111153973765647e-01   +7.940242777164503e-01   +7.883575945398410e-01   +4.903548781001710e-02   +5.892365325974891e-01   +4.617933114606519e-01; +9.731980561431963e-02   +8.789756880729975e-01   +7.940717774845881e-01   +6.585484052084254e-01   +3.183412200047314e-01   +3.814649600852740e-01   +2.877835301375311e-01   +6.506456448366582e-02   +6.735368567619616e-01   +2.186115409653784e-01   +6.663482491814309e-01   +9.900288928836040e-01   +9.507202714700480e-01   +1.894565064479397e-01   +6.825764065561050e-01   +4.183618164457367e-01];
L2I_L2E_iAMPA_netcon = [+2.126387900607518e-01   +6.819021296280717e-01   +1.582932118784363e-01   +6.544041962358511e-01   +7.922897736779555e-01   +2.761578747779880e-02   +9.548801823581984e-01   +4.426506144615894e-02; +2.704369392149567e-01   +4.501730368539426e-01   +1.855700486358491e-02   +5.488590833036666e-01   +5.802618489088157e-01   +5.099585357963606e-01   +3.774018474624175e-01   +2.631106986906873e-01; +1.102027189722454e-02   +6.033076942343616e-01   +9.745425967800958e-01   +3.915526612239072e-01   +4.324176752501780e-01   +6.614798857429689e-01   +2.117243163238602e-01   +9.889031371772028e-02; +4.686504937481765e-01   +1.677813116268237e-01   +5.168906245571077e-01   +9.428175441947794e-01   +2.623098875646607e-01   +7.030343299609676e-02   +8.750745082517239e-01   +2.673239532640684e-01; +2.978110274233670e-02   +8.824452443121218e-01   +7.158594609651975e-01   +6.751396678442489e-02   +2.590129101365726e-01   +9.417726322763592e-01   +9.077223542231599e-01   +4.421444508058867e-01; +1.152005803900075e-01   +7.974931797153526e-01   +9.238926520280279e-01   +9.797201459132775e-01   +7.952887924336964e-01   +3.713234437596136e-02   +5.418262800223104e-01   +8.109152155868611e-01; +5.621301453273934e-01   +4.786952814831926e-01   +5.527827373033700e-03   +7.032404998727800e-01   +4.603848718368574e-01   +2.852641752467052e-01   +1.514035012549944e-01   +7.652772590094070e-01; +1.633829055226070e-01   +5.734302628367958e-01   +5.075431666027378e-01   +2.352786663282740e-01   +8.814434363918310e-01   +3.816836224608791e-01   +8.718045015315863e-01   +7.673613747483812e-01];
L2E_L2I_iGABA_netcon = [+3.003492311289224e-01   +5.547384750680294e-01   +2.655158603522750e-01   +3.331741516517024e-01   +2.210489156134344e-01   +1.608136101995411e-01   +3.296238638259253e-01   +6.202458563897246e-01; +1.490983075992486e-01   +7.179381946139479e-01   +6.709801182023856e-01   +1.184424928223138e-02   +1.246915051979371e-01   +9.647792692025529e-01   +8.992079733766329e-01   +1.289999778109647e-01; +9.278574933908559e-01   +2.217865222591313e-01   +2.010607131012181e-01   +2.774144607895850e-01   +5.474886867086070e-01   +3.297114948353113e-01   +1.572017536178156e-01   +4.236178458760088e-01; +9.131323324426155e-02   +2.194915850777149e-01   +1.048828122913052e-01   +9.071426111262452e-01   +2.531189043969267e-01   +2.860843129002365e-01   +5.260077164269825e-01   +5.759665599880094e-01; +6.583575791385643e-01   +3.371465952644085e-01   +2.429722259617780e-01   +9.970189068716524e-01   +3.455803161891822e-01   +3.483820200809183e-01   +6.593646271079323e-01   +9.399518457913869e-01; +9.037697495065083e-01   +2.864296459590412e-01   +7.473548642102907e-01   +8.186446779289399e-01   +8.922145316881943e-01   +4.997287472569534e-02   +9.104158415767546e-01   +7.268879142276793e-01; +9.418200155687202e-01   +2.295933452910330e-01   +6.324941188541972e-01   +1.923994565602124e-01   +1.016180084288665e-02   +7.731854381054101e-01   +5.876155196568178e-01   +6.366504193924416e-02; +7.372483728918617e-01   +2.887855760095004e-01   +8.197184697577089e-01   +2.419732450257971e-01   +3.186442642563462e-01   +7.015141710172580e-01   +9.121593056096408e-01   +7.648204516244383e-01];
L3E_L2E_iAMPA_netcon = [+7.374173873230552e-01   +7.656789013518938e-01   +8.420929644558065e-01   +5.359595385551180e-01   +6.741465302161841e-01   +9.528743887006240e-01   +7.462567925972979e-01   +3.799561365350864e-01   +6.006547931609098e-01   +7.098321387698987e-01   +9.020676101534534e-01   +3.892559257306721e-01; +3.943788443994389e-01   +2.788661302901486e-01   +5.198469432402224e-01   +8.392169831755093e-01   +4.927536758687141e-01   +6.929696834982109e-01   +2.827060811571138e-01   +7.662869283945807e-01   +1.961345275493023e-01   +5.447267171288025e-01   +5.996987916516134e-01   +9.723667006434535e-01; +4.826864787129874e-01   +9.745410080529855e-01   +5.529291840881292e-01   +1.884941809522671e-01   +8.682613615221524e-01   +8.985553768097099e-01   +7.501779221929680e-01   +2.920685950646791e-01   +9.453540728171700e-01   +3.062702423931307e-01   +6.005113926629831e-01   +9.865871868272874e-01; +8.585482699065863e-01   +6.365776154477126e-01   +9.612454139168582e-01   +7.912932189263684e-01   +5.978059084212739e-01   +3.532032898289827e-01   +2.829009080102463e-02   +1.484500149647526e-01   +2.075616660138935e-02   +9.636360360689867e-01   +8.863144273572060e-01   +6.294585635008099e-01; +9.924656609225903e-01   +2.215619261977168e-01   +2.115153276103621e-01   +3.632394491471035e-01   +6.806090325510291e-01   +1.980563956196861e-01   +3.146080717891246e-01   +5.478626867640982e-01   +6.571306730693766e-01   +7.041410509828818e-01   +1.383585072683182e-01   +5.610323915348089e-01; +9.072690460536251e-01   +4.057830910459905e-01   +9.172433563239678e-01   +9.724390742881946e-01   +5.572012194263395e-01   +2.589720611894797e-01   +8.664981325696144e-01   +7.354411248458091e-01   +5.493658790784766e-01   +9.664156870916821e-01   +6.359733918064041e-01   +7.004816771683708e-01; +4.131785375562651e-01   +2.978523115023907e-01   +7.437711410040970e-02   +3.582210131581166e-01   +1.214432342066130e-01   +4.637787548979774e-01   +6.411237339274706e-01   +3.087855623095073e-01   +6.647519736673060e-01   +7.940514565750662e-01   +4.838839129944812e-01   +4.668412559967894e-02; +5.209477835211431e-01   +5.632071929579473e-01   +7.871062158768409e-01   +9.365047068732772e-01   +6.995704815603789e-01   +1.103513728503891e-02   +9.281476938850178e-01   +5.351374278890098e-02   +8.137326450929225e-01   +4.749277711427757e-02   +2.688701708832152e-01   +8.534655955485962e-01];
L3I_L2I_iGABA_netcon = [+4.571568685906894e-01   +9.616967682512908e-01   +4.167452390669879e-02   +3.305999892151110e-01   +5.688351876957038e-01   +5.506800284085454e-01   +8.776574554835435e-01   +9.557169440009819e-01   +6.180061256649516e-02   +1.163489530660179e-01   +2.346504199541655e-02   +6.713162759086964e-01; +3.914163277206971e-01   +6.870533422435801e-01   +4.328899684358846e-01   +2.889944882424218e-01   +9.955461946138333e-02   +2.703860267601974e-01   +3.419134975633301e-01   +6.219966832000939e-01   +6.408781252697351e-01   +5.180879908801617e-01   +7.174446590774808e-02   +7.770225214479770e-01; +6.464116072213367e-01   +2.642928779759162e-01   +1.341521718328967e-01   +1.783250803908373e-01   +3.244443536509439e-01   +6.879848057887868e-01   +6.581385970409903e-02   +3.543048599825351e-01   +1.402145526576001e-01   +4.784986152752513e-01   +4.109429309359663e-01   +2.837441252140600e-01; +2.314760615564904e-02   +3.516521612686117e-01   +2.376243392299239e-01   +1.578127135341982e-01   +5.194995998133589e-02   +7.840521378936512e-01   +7.393207792446397e-01   +7.952025616073846e-01   +8.807966670411188e-01   +6.101723589048438e-01   +6.286298888475376e-01   +2.394817488844501e-01; +4.643958674638899e-01   +3.246349633792934e-01   +1.664200768509265e-01   +3.224252734690181e-03   +3.083702525461820e-01   +2.988970270064705e-01   +5.493978523320208e-01   +7.884536078844401e-01   +1.096085306620189e-01   +7.252933006186424e-02   +1.626225467680431e-02   +6.487383533247237e-02; +3.310209651072942e-01   +7.150134842318506e-01   +3.132574781325907e-01   +1.740511709395609e-01   +1.464143246131834e-01   +7.482029474482119e-01   +8.406196467292123e-01   +4.893703449565370e-01   +6.952270518312734e-01   +2.339322414834180e-01   +8.107100693690494e-02   +8.881298556392260e-01; +2.410265739588517e-01   +3.966747850972385e-01   +6.669618847032714e-01   +7.596961280348535e-01   +9.424861658810365e-01   +6.751621343663782e-01   +9.829501552087077e-01   +3.284504000487722e-01   +3.411376934436732e-01   +7.479553093389277e-01   +5.297405741440642e-02   +6.745096028932472e-01; +9.136601323397623e-01   +7.489877979205100e-01   +6.728986627052381e-01   +4.990936806423175e-01   +7.662266443814859e-01   +7.413826451802950e-01   +7.353917277724878e-01   +7.572589778906570e-01   +3.677939399849167e-01   +8.076438299338613e-01   +2.446438358996303e-01   +2.600117495590459e-01];
L2E_L3E_iAMPA_netcon = [+5.067279048872454e-01   +6.454749211856446e-01   +8.706606496700626e-01   +6.824307805422589e-01   +7.866522369889134e-01   +1.113281340781821e-01   +8.635971114717992e-01   +5.332718199414901e-01; +5.593225916606230e-01   +5.636958520349779e-01   +2.146798652642044e-01   +9.491044389209234e-01   +8.168005971476392e-01   +9.387632983830689e-01   +5.346097558234367e-01   +7.312013399217654e-02; +9.305731921833369e-01   +3.353429557531337e-01   +5.273281363129478e-02   +2.600951029407111e-01   +8.104927266655317e-01   +2.300937437183799e-01   +1.461173398413882e-01   +6.961600185540895e-02; +8.408714527869047e-01   +1.291511037464366e-02   +3.076104960030586e-01   +3.644411611632536e-02   +2.834015633491616e-02   +5.122804857801159e-01   +9.976022018896591e-02   +5.130284454050126e-01; +3.655486067684844e-01   +6.853940162831482e-01   +8.551021362460806e-01   +5.399836521132025e-01   +2.507801957630685e-01   +6.832041045468832e-01   +6.355890034865088e-01   +9.934004926999427e-01; +5.541604188816389e-01   +2.619285209663644e-01   +5.201189645328004e-01   +3.636636925088352e-01   +7.295768007189167e-01   +1.773208293831494e-01   +6.300067419918529e-01   +3.278184832520444e-01; +8.159286632734010e-01   +9.630739246467213e-02   +4.666813446813332e-01   +4.749993843970349e-01   +5.774969488801891e-01   +1.621934961716986e-02   +3.019453604752438e-01   +5.069958830550301e-01; +2.652720204557113e-01   +3.967389780652134e-01   +8.013493397332930e-01   +8.380953623306295e-01   +9.613521913838635e-01   +2.832687051152729e-01   +4.402172729305385e-01   +7.325919897927466e-01; +3.510472019336380e-01   +8.954170049109513e-01   +6.481825022230006e-01   +5.366815497725153e-02   +5.149062341933482e-01   +3.113821399579821e-01   +6.102970886941860e-01   +5.714466430944914e-01; +3.489629552432267e-01   +1.056692299960591e-01   +4.391043325264815e-01   +1.379926375603213e-01   +4.591970325284706e-01   +1.935937164107182e-01   +4.518406918233731e-01   +5.568045334558669e-02; +7.339997149482034e-01   +5.631265529493016e-01   +3.729219334205650e-01   +1.980896837183499e-02   +1.503476094474179e-01   +4.934266078946280e-01   +4.830776990257658e-01   +5.831768896016256e-01; +9.034832501456375e-01   +5.926985739181220e-01   +1.231269555980843e-01   +2.818136803793828e-01   +8.076605753927346e-02   +9.509476203436829e-02   +7.576011238934700e-01   +7.204701916229436e-01];
L2I_L3I_iGABA_netcon = [+3.359976180637692e-02   +6.677914436171085e-01   +9.274562369886807e-02   +2.331940314533065e-02   +8.845971410760027e-01   +3.380709216740105e-01   +8.913558758948276e-01   +1.534115418072687e-01; +6.101793899559367e-01   +4.112720479448511e-01   +3.863215578158854e-01   +8.025479268092809e-01   +4.511965015531844e-01   +6.807424646442013e-01   +6.954490968974708e-01   +5.861530744585298e-01; +6.340652043799867e-01   +2.372814339241458e-01   +7.730122236122540e-01   +4.886201497274834e-01   +4.867673930802638e-01   +5.649074127125402e-01   +2.170533811250134e-01   +4.757671798287203e-01; +5.876589250767000e-01   +5.310768970193479e-01   +7.813186764217100e-01   +2.139414351826746e-01   +3.085111936564988e-01   +9.599119653324398e-01   +3.824109419104733e-01   +1.863528081893463e-01; +4.779024544832574e-01   +8.276639666005353e-01   +3.576534464487044e-01   +2.621028345550958e-02   +2.092285221595972e-01   +3.440318657315170e-01   +8.663073362380251e-01   +6.394147562628374e-01; +8.457152055067798e-01   +2.017724461422469e-01   +6.811136005400831e-01   +3.488577984352790e-01   +4.654527708862243e-01   +9.476135105080574e-02   +8.444504978906116e-01   +3.998968780023764e-01; +6.005201124019360e-01   +7.709551142942510e-01   +3.502412617097851e-01   +5.229100826105232e-01   +8.756140348139065e-01   +7.305588798650842e-01   +9.289158353723470e-01   +1.045312121154404e-01; +7.824143750501383e-01   +3.914665929921815e-01   +3.879465746397867e-01   +8.400997222555208e-01   +1.093491103965876e-01   +6.899704545370081e-01   +3.367595651911779e-01   +1.093097353472272e-02; +9.267120334559010e-01   +2.252347893745085e-01   +4.776175481568223e-02   +6.544697606739189e-01   +7.343228038897255e-01   +3.533190116342302e-01   +2.039233407896679e-01   +3.501139672891949e-01; +6.853786099004568e-01   +3.855216255295169e-01   +4.978546014286567e-02   +6.747261525433751e-01   +6.233890849540520e-01   +7.205446756152351e-01   +3.739982149806491e-01   +9.736518937140775e-01; +2.171905880154967e-02   +5.113309899524370e-01   +3.281454821086350e-01   +9.919569100969166e-01   +2.282154440860299e-01   +5.146325511271055e-02   +2.820523651392465e-01   +1.856642454100247e-01; +7.208013302064881e-01   +8.852050567724826e-01   +9.557726336614349e-01   +1.924704637242327e-01   +6.741560815863635e-01   +1.084537963925256e-01   +6.908831719490388e-01   +5.107671271310323e-01];
L3I_L3E_iAMPA_netcon = [+9.981843025921189e-01   +6.782651931901670e-01   +5.283444038471022e-01   +5.896204916602454e-02   +4.247904272759386e-01   +7.861439737189115e-01   +4.101707929023654e-01   +5.899003006527744e-01   +2.519883895195093e-01   +4.877343049045056e-01   +8.176164010806558e-01   +8.081722585063671e-01; +3.611591910231322e-01   +2.638868117016336e-01   +1.933899400848335e-01   +1.121558747760099e-02   +9.782201979936919e-01   +5.974720928495049e-01   +5.930022225319876e-01   +7.958692119110128e-01   +8.145508783985476e-01   +9.523314331547572e-02   +8.412433167560103e-01   +7.180761238856788e-01; +5.971074727280825e-01   +1.106746081210996e-02   +6.229017592069093e-01   +2.032044994377827e-01   +7.713791572434486e-01   +2.487740070799176e-01   +3.645761928329294e-01   +1.846280624728002e-01   +2.385329267839957e-01   +5.948669084349678e-02   +2.435846218807219e-01   +7.310871882119040e-01; +8.295442372416124e-01   +6.847369299745032e-01   +8.319534667137185e-02   +5.723916932270402e-01   +1.853464930207714e-01   +5.713872972257527e-01   +6.332797504200746e-01   +6.460592740089384e-01   +6.531480548971792e-01   +2.163436700093146e-01   +9.154175582396022e-01   +7.990185480491344e-01; +7.456672281628198e-01   +7.180146062910313e-01   +1.704656340716861e-01   +3.323993308239884e-01   +2.924824783558944e-01   +7.851508219478887e-03   +2.858201846774164e-01   +5.349215155301723e-02   +3.154133505464128e-01   +5.580524876806436e-01   +9.396889530060418e-01   +3.157490614658091e-01; +9.222570014422593e-02   +1.182308685285869e-01   +5.957462180447020e-01   +4.489539018314445e-01   +6.347071756003072e-01   +3.620092062482946e-01   +9.847287535693727e-02   +6.598109229829515e-01   +2.966330125879043e-01   +5.620640314970778e-01   +2.014561166993423e-01   +8.545886423899238e-01; +3.112306167911051e-01   +3.389989773850867e-01   +7.459398130477777e-01   +3.710956647718378e-02   +9.246435754775000e-01   +1.209464917253996e-01   +5.809823126880572e-01   +1.444169223950059e-01   +5.400188785804824e-01   +1.553207306187384e-01   +3.532233460732565e-01   +5.083510919146684e-01; +1.188428032965335e-01   +7.429300587867855e-01   +9.801356204673095e-01   +1.315450149882951e-01   +1.527615834320004e-01   +8.132925944901733e-01   +6.079353121202736e-01   +2.599432305427849e-01   +3.131950356052452e-01   +6.427040743787010e-01   +4.466646401215666e-01   +7.966311004217930e-01; +2.028579536190456e-01   +3.384141804067895e-01   +3.672129787693799e-01   +8.729924773495825e-01   +2.807850378499765e-01   +8.709549206209760e-01   +8.638800480691892e-01   +6.321610248932684e-01   +7.358716858525336e-01   +1.843630413674091e-01   +6.655756089221757e-01   +9.860156446558516e-01; +3.874773170612458e-01   +2.316013712616125e-01   +7.785778590436345e-01   +6.512230161895827e-02   +7.767690232562108e-01   +4.156213467093633e-01   +5.163714684200392e-01   +6.001279441289519e-01   +7.041600638771712e-01   +1.288535919254172e-01   +7.858191763336779e-01   +9.442053666217934e-01; +4.183564149195704e-01   +3.558488105298299e-01   +3.585437787039233e-01   +8.030346649608718e-01   +4.168062233941113e-01   +6.586301630436586e-01   +6.698841557659800e-01   +3.521809374471365e-01   +2.587469340171745e-01   +3.095214552740451e-01   +7.090382461133290e-01   +8.326297059634863e-01; +4.755104413977670e-01   +4.900152811054150e-01   +4.607238266409931e-01   +3.636052605139941e-01   +6.933486005314629e-01   +5.549402164709853e-01   +4.570486636694309e-01   +3.743421180556762e-01   +5.397485754620642e-01   +1.388586247693187e-01   +5.888005423954487e-01   +1.732884552226128e-01];
L3E_L3I_iGABA_netcon = [+2.142423773522190e-01   +8.355931634829930e-01   +1.864770065720146e-01   +5.126303300166483e-01   +3.069240496563508e-01   +7.888460040977950e-01   +1.399115671770320e-01   +7.950444672772458e-01   +8.686696710552215e-01   +2.451868247084368e-01   +8.776824135663497e-02   +1.700575405299088e-01; +6.936225647511594e-01   +3.718623790141479e-01   +3.709989792214927e-01   +4.972192098397904e-01   +3.582054761698883e-01   +3.670558150338985e-01   +3.014266491037355e-01   +4.029548245111646e-01   +9.230071742070878e-02   +2.380415640901992e-01   +4.623143543263258e-01   +9.046157373630059e-01; +4.486266905291583e-01   +1.848548069149495e-01   +1.348735548353346e-01   +7.612235929079125e-02   +1.971371025324730e-01   +2.524224513999154e-01   +8.159218974094284e-02   +9.552731703922135e-02   +2.427235608994537e-01   +7.794983715563287e-01   +8.346536529927605e-01   +8.662635726806472e-01; +3.064515143675175e-01   +9.619601055946561e-01   +5.439088694700137e-01   +2.290210624038873e-01   +8.357965368344125e-01   +3.815888372708299e-01   +8.763254342595734e-01   +5.790685867430579e-01   +3.721608246693985e-01   +7.824034347670699e-01   +3.919963656258360e-01   +2.387467492656620e-01; +1.127596353411405e-01   +2.732740521917112e-01   +2.199589131753310e-01   +3.147557786203599e-01   +7.380915008965161e-02   +1.677091599654815e-01   +5.844130540463556e-01   +2.488214147243858e-01   +8.336213495571293e-01   +1.269235482383179e-01   +4.849021988828799e-01   +6.137503177391139e-01; +4.691128641255662e-01   +4.821913463395633e-02   +9.003467955240502e-01   +5.892636280701085e-01   +4.047423374427206e-02   +9.707866618176412e-01   +3.711013352173587e-02   +5.422395999315038e-01   +5.746960573367828e-01   +5.763257962353262e-01   +5.576747569634244e-02   +1.293089129301085e-01; +6.271481538847162e-01   +3.136422210922833e-01   +5.823623743072609e-01   +3.934702959817014e-01   +9.755546973306010e-01   +8.398319917607560e-01   +5.116039863043210e-01   +2.436603215655397e-02   +1.005375984093115e-03   +7.464210943254701e-01   +4.008457733464210e-01   +2.776877397273623e-01; +2.852608186766024e-01   +1.262251667612946e-01   +9.448693877722401e-01   +9.208536457477644e-01   +3.131358989285541e-01   +3.707031882208749e-01   +2.386241034289893e-02   +4.781957891278876e-01   +7.789996176849552e-01   +1.034100328415904e-01   +4.966679271424518e-01   +5.483513168103376e-01; +2.633543847910624e-02   +6.506059105229565e-01   +2.059277698242253e-01   +6.401708101806916e-01   +1.616127860576202e-01   +2.651138686997497e-01   +1.063944397458902e-01   +1.200249587689728e-01   +3.933532633059474e-01   +3.641259427587829e-02   +5.223605463800259e-01   +4.756250028905151e-01; +8.953589165414785e-01   +1.617100183471220e-01   +1.085101605290648e-01   +2.666205913701937e-01   +4.140750398536484e-01   +9.193589074472881e-01   +8.980218605945740e-01   +1.333843454963124e-01   +9.263572132522637e-01   +7.340774338390842e-01   +7.031273845095499e-01   +9.858473420090206e-01; +3.672022351663825e-01   +9.348248130110625e-01   +6.543025670200653e-01   +3.090352274814547e-01   +4.939410622065483e-01   +3.546512929012141e-01   +8.558841866348664e-01   +5.034859497833208e-01   +9.279164240804801e-01   +9.179718373826716e-01   +1.481715907856329e-02   +4.214049079066652e-01; +2.044496196115575e-03   +5.430231777437062e-01   +6.741821427998526e-01   +8.242271018775812e-01   +3.406481873668188e-01   +1.197416848330628e-01   +6.195466129797038e-01   +5.250440106468729e-01   +2.447228917510424e-01   +9.286531651124402e-01   +1.828044037171862e-01   +5.005382043505308e-01];
L2E_Input1_iAMPA_netcon = [+5.335916157575712e-01   +2.910275260196787e-01   +3.800442975226175e-01   +3.785986062979833e-01   +2.054497030016873e-01   +7.209224079770287e-01   +4.712009027467812e-02   +7.699906286808189e-01];
L2I_Input2_iAMPA_netcon = [+8.949591283597556e-01   +7.124061483535830e-01   +5.862844504387098e-01   +1.913274892342697e-01   +1.395550092709595e-01   +9.907127845973465e-01   +3.793449245894913e-01   +7.126554460559472e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  5.6 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
