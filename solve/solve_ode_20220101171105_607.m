function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.870799625029032e-02   +1.680280470822736e-01   +1.215599127037004e-01   +3.802627816436999e-02   +1.813148147753373e-02   +9.719415280209286e-02   +3.862247079034321e-01   +3.841355916402172e-01   +3.496076431229664e-01   +3.787967544553491e-01   +1.224218422045120e-01   +2.821398938803308e-01   +2.182985414934733e-01   +2.197817935679532e-02   +3.402799848159481e-01   +6.277419886287751e-02; +2.903591039322204e-01   +3.283847464567461e-01   +1.549795807208103e-01   +1.812944869451057e-01   +3.829394187180111e-01   +3.877610476448222e-01   +1.703910439129152e-01   +1.230965586073340e-01   +3.655324522605816e-01   +3.464888781904613e-01   +1.386193338762958e-02   +1.082512567018620e-01   +3.125897445137233e-01   +4.177982957838592e-01   +1.543610023647597e-01   +3.949349866723375e-01; +1.224293724293799e-01   +2.816926966863459e-01   +4.784864236130640e-02   +4.049363398471101e-01   +2.030203609798735e-01   +2.116504006307413e-01   +3.300565689485181e-01   +3.788175704008813e-01   +3.003116147490079e-01   +6.509111952699906e-02   +5.454607939626030e-02   +1.602282776099951e-01   +2.413807269253741e-01   +2.126712351686271e-01   +3.217465667576967e-01   +1.765375449875962e-01; +2.364022785833593e-01   +2.068227211614707e-01   +2.727271765603961e-01   +2.373491219261540e-01   +3.041855614028781e-01   +1.835683834533028e-01   +3.552169450524373e-01   +2.085474464940342e-01   +2.461770813123189e-01   +2.452653521910661e-01   +3.913587520075250e-01   +2.825656225508181e-01   +4.508251972439287e-02   +3.768691212970463e-01   +1.991976363448795e-01   +1.360676261150599e-01; +3.860973840964032e-01   +2.350616884220162e-01   +2.307604451910291e-01   +2.358590755176182e-01   +2.550910189501828e-01   +2.481426363738479e-02   +3.796668147261817e-01   +2.043519055388150e-01   +1.228837283045437e-01   +3.576764234812209e-01   +1.461906428710392e-02   +3.476728860257267e-01   +1.193326531907701e-01   +3.914109312419372e-01   +7.345319853345986e-02   +3.337767733460114e-01; +3.580065352017723e-01   +9.241787077402155e-02   +2.515377448402859e-01   +1.924600302011198e-01   +2.813184730914092e-01   +6.429774171897881e-02   +2.229989258173078e-02   +1.036688824505026e-01   +3.658114101585990e-01   +2.610823361463588e-01   +8.219306595858500e-02   +4.049615671171150e-01   +1.462361947525780e-01   +3.698742421177252e-01   +1.150729495822749e-02   +1.197020693331285e-01; +1.026150264605883e-01   +2.532132370743609e-01   +3.358940476553237e-01   +1.548653036376105e-01   +2.900536557518480e-01   +2.780613398992323e-01   +2.438267866526198e-01   +2.237188159407012e-02   +3.441056062124415e-02   +1.745096418994861e-01   +2.185057092048518e-01   +3.265256085432999e-01   +2.917677885720608e-01   +3.837059018110315e-01   +1.601647056631848e-01   +3.347246914695509e-01; +1.262313770335545e-01   +2.318613863645944e-01   +8.417174902713759e-03   +3.790949529879328e-01   +1.484792475734979e-01   +2.437483767422777e-02   +3.020279550589265e-01   +3.547372394059453e-01   +1.250964072229305e-01   +7.712774093537984e-02   +9.611402746719359e-02   +3.998864876330449e-01   +3.367366139847697e-01   +6.396660764647083e-02   +1.613705921609693e-01   +9.040592460981761e-02; +3.093471707327909e-01   +2.264884310453920e-01   +2.700071491099764e-01   +2.017219280385776e-01   +2.459251473428413e-01   +3.772727522348351e-01   +6.194566558691986e-02   +3.130274148757790e-01   +2.014024590424238e-01   +1.091922606901892e-01   +3.047994894498348e-01   +3.848398187417541e-01   +1.151802188630409e-01   +1.655102387415005e-01   +4.030870454712590e-01   +3.714872818407461e-01; +3.276648465850424e-01   +1.008685771137422e-01   +6.337418369219981e-02   +6.812832260331764e-02   +6.116469535474217e-02   +4.143881969864976e-02   +9.214002137071095e-03   +3.904563353850237e-02   +1.455917580264562e-01   +2.969607295379737e-01   +1.466930627915803e-01   +6.568948532505625e-04   +2.520510502752886e-01   +2.866851229671943e-01   +4.790405441575647e-02   +5.242597437723155e-02; +4.034273128887192e-01   +3.867211909283597e-01   +3.086842850073575e-02   +2.156097659358898e-01   +2.519445509124547e-01   +1.074453348046871e-01   +3.324199264070709e-01   +3.199872301553816e-01   +1.619055498428818e-01   +2.651131566439731e-01   +3.496969879502821e-01   +3.490353527480353e-01   +4.445698363830346e-02   +2.339315960927587e-01   +1.574130859726691e-01   +2.055163248010615e-02; +3.433048422637509e-01   +4.033778896957975e-01   +1.920480870243329e-01   +1.851297697602973e-01   -4.015673959073748e-04   +1.855598102042457e-01   +3.593761760059270e-01   +2.829065925003486e-01   +3.321639300937430e-01   +1.689539237635470e-01   +3.211544308385050e-01   +2.350608276124788e-01   +2.551426061955420e-01   +1.786338095659751e-01   +3.217419374101826e-01   +3.355993078235623e-01; +3.436022127180076e-01   +1.015888634073891e-01   +1.572070455896971e-01   +1.389384997950719e-01   +3.782130380149283e-01   +1.319181003456273e-01   +3.183715890653193e-01   +2.580784100626005e-01   +2.181493227287634e-01   +2.933112608631946e-01   +2.148310297771428e-01   +2.018152160872771e-01   +3.151010938428552e-01   +6.812946241407698e-02   +3.406684521908684e-01   +8.687895613590652e-03; +1.170381562120003e-01   +4.572175487096414e-03   +1.733643435224884e-01   +1.304180122616221e-02   +3.638884410375026e-01   +2.528832593186822e-01   +3.181285319950111e-01   +2.662098914608129e-01   +2.802524268076181e-01   +3.862512848261846e-01   +2.297067513369846e-01   +4.580081635836048e-02   +7.369205004054627e-02   +3.832941189531746e-01   +1.899403404830463e-01   +1.266314270640118e-02; +1.140426694284443e-01   +2.859427190599490e-01   +1.298843203862126e-01   +1.027565687582652e-01   +3.168020515163784e-01   +1.956082226310928e-01   +2.235701458231799e-01   +7.024330401905558e-02   +1.315941831644385e-03   +3.612074440752973e-01   +3.127079840368142e-01   +3.567853391740651e-01   +5.110091204276369e-02   +9.145372780703340e-02   +3.680215679693356e-01   +2.182425226935551e-01; +2.741135566120411e-01   +1.727116951749556e-01   +1.755671039006991e-03   +3.984964858086755e-01   +3.066851034000614e-01   +2.277904929497873e-01   +1.500312433689781e-01   +3.860113728909055e-01   +2.665633446540674e-01   +3.551952818951594e-01   +2.943234713917289e-01   +6.211188474740710e-02   +3.516767383974513e-01   +3.484411328499397e-01   +2.794836708519587e-01   +1.113226057208243e-01];
L1E_L1I_iGABA_netcon = [+2.999721852510575e-01   +4.051639804545338e-01   +3.202910022227135e-01   +1.858327169828835e-01   +3.033581817886086e-01   +1.876831929304304e-02   +3.886740513651648e-01   +3.816778858385459e-01   +3.664112013747878e-01   +1.293672242229376e-02   +6.366440296143127e-03   +1.778983484706274e-01   +1.168804267378542e-01   +2.037408882906552e-01   +1.408159921055516e-01   +1.838414996476286e-01; +1.893725525495274e-01   +3.971187319614340e-01   +1.752330667208108e-01   +2.079947389043789e-01   +1.085645396690605e-01   +3.355997383897192e-01   +2.312530933804695e-01   +4.026263918317032e-01   -2.186871102773977e-03   +2.249477654942559e-01   +1.500160001674183e-01   +1.100053749921163e-01   +4.282419244340815e-02   +1.375290394624976e-01   +1.613068182699558e-01   +3.505340623211751e-01; +3.466292338339643e-01   +3.549040242471888e-01   +4.013320617491897e-01   +3.308553153765537e-01   +6.629789827418127e-02   +3.214638510023861e-01   +1.517935973661315e-01   +1.513533660925820e-01   +1.436941987840533e-01   +3.390936174311435e-01   +1.704689696811036e-01   +2.270497125654814e-01   +3.399444053390268e-01   +2.592409862869562e-01   +9.483611519565843e-02   +3.254073187586816e-01; +4.875863478147974e-02   +2.874930785452779e-01   +1.432859925414942e-01   +2.469573651763534e-01   +3.961807606640333e-01   +1.654998811559480e-01   +1.534254433004657e-01   +3.249070242846461e-01   +2.968774693534559e-01   +2.970907330178270e-01   +2.322629322367255e-01   +3.992760001967178e-01   +1.428329800005226e-01   +2.910773354786075e-01   +3.951213049601340e-01   +3.124499651845711e-01; +1.624959961547017e-01   +1.924990733421293e-01   +2.206918796081181e-01   +3.923160082841861e-01   +1.564666656278983e-01   +1.502454610441577e-01   +2.282057884301671e-01   +4.023460509655393e-01   +1.286471154638379e-01   +1.559553763145110e-02   +3.762274538198497e-01   +1.678180446328131e-01   +3.300391674121950e-01   +3.532982988773197e-01   +2.472026948802593e-01   +4.908296655844389e-02; +4.035149172811578e-01   +2.408692116714168e-01   +3.724168237017337e-02   +1.256256787703503e-01   +1.905690633287147e-01   +9.352430293750208e-02   +2.652393944996753e-02   +1.072160433513151e-01   +2.939613001861742e-01   +3.833752824428366e-01   +1.703794312488273e-01   +2.014826212132125e-02   +2.613509438337847e-01   +2.237380175586069e-01   +8.340633496850226e-02   +3.068288691628387e-01; +3.323654090331244e-02   +8.863572590431987e-02   +2.696677243642828e-01   +1.058057119082791e-01   +2.039093758235890e-01   +8.672746838532132e-02   +1.465581378880833e-01   +4.946410985388768e-02   +1.532093947076451e-01   +3.283596718881308e-01   +3.125772351847474e-01   +1.407371622657336e-01   +1.373254717840169e-02   +9.477425377345620e-02   +2.475142118158310e-01   +1.986396940707237e-01; +3.655297451971983e-01   +6.892814316222125e-02   +1.176832615541354e-01   +2.653503760933724e-01   +2.567348586951099e-01   +1.648079296466732e-01   +9.047234202201140e-02   +1.401183828755629e-01   +2.431984022497959e-02   +4.889789530229256e-02   +8.059190903436111e-02   +3.805287182201561e-01   +6.131388161384472e-02   +1.222404644647203e-01   +2.772807997065440e-01   +3.527520429163835e-01; +6.654993902422884e-02   +1.720093917807888e-01   +1.103073278327329e-01   +1.571786898337936e-01   +1.359786984711032e-02   +2.075770952766602e-02   +8.930688925760748e-02   +1.014405164181482e-01   +2.744111899535557e-01   +8.436271803679535e-02   +7.576512071791175e-02   +3.417851635410611e-01   +2.656425765364865e-01   +8.032913135698855e-02   +3.369489962235453e-01   +3.720952376993276e-01; +9.334579340313334e-02   +2.565799028248277e-01   +4.640429783079104e-02   +1.898446506735032e-01   +1.172691593263473e-01   +2.267445626076889e-01   +3.782110065439662e-01   +5.936371853425053e-02   +3.645247092154212e-01   +1.947626819317071e-01   +2.903769216765046e-01   +3.614313781177465e-01   +2.726511025584970e-02   +2.592939878372978e-01   +1.668969287072062e-01   +3.569525525427145e-01; +3.963293937212650e-01   +3.086367792944071e-01   +3.652410783434139e-01   +1.358300377226519e-01   +1.182832806020061e-01   +2.230157054834963e-01   +1.284300332502322e-01   +2.697357219274284e-01   +3.065226433412287e-01   +2.813219900596749e-02   +2.231220220222579e-02   +2.790302732190338e-01   +1.989359260745167e-01   +3.289841141543560e-01   +1.595275512585697e-01   +3.225771972733019e-02; +3.737168473538147e-01   +1.486663927953898e-01   +4.043684824694805e-01   +1.372264353798668e-01   +1.255784575814273e-01   +3.326577896361159e-01   +1.574265019494975e-02   +3.294273439595293e-01   +7.138552333286946e-02   +3.142633813886410e-01   +3.492801831022546e-01   +8.529850846561131e-02   +2.113587853240975e-01   +1.967361613418512e-01   +3.831141560345798e-01   +1.624891706735578e-01; +9.926574691041483e-03   +1.051280287561733e-01   +1.393326016674536e-01   +9.030959045628910e-02   +2.907907907179759e-01   +1.734008597807510e-01   +6.098574252680998e-03   +2.119704740683042e-01   +2.574055983853610e-01   +1.720825192538096e-01   +4.025209452519470e-01   +1.617056576350897e-01   +4.923509779998468e-03   +2.980545689808869e-01   +4.158960338886151e-02   +3.510193475798783e-01; +1.836311693868052e-02   +3.344711401830580e-01   +2.487014932459554e-01   +9.697959661582439e-02   +2.660505692306284e-01   +2.624381331333941e-01   +3.234962203648890e-01   +7.834708748891393e-02   +3.556959046826748e-01   +3.688880878063298e-01   +1.539509746804549e-01   +5.435931479608830e-02   +3.890536098632115e-01   +3.938542763937026e-01   +1.234599710978498e-01   +3.376364538992442e-01; +5.268414325381179e-03   +2.662843959409195e-01   +3.314641474909640e-02   +1.376083669055572e-01   +7.525286400015441e-02   +3.310741961572974e-01   +3.324330691545367e-01   +3.396953355921372e-01   +2.294801859922411e-01   +2.342904893553882e-01   +1.891314643325634e-01   +2.122199728226148e-01   +2.453392189446734e-01   +9.654576273309176e-02   +1.654613223606640e-01   +1.362514234259382e-01; +1.302403886584194e-02   +2.393764737756570e-01   +1.390452851089774e-01   +1.565338995304811e-01   +3.765757399835687e-01   +3.517838527266379e-01   +9.044637807431739e-02   +3.748282769294343e-01   +3.198110944802355e-01   +7.438634711889849e-02   +1.247582706686975e-01   +3.377449402262241e-01   +3.971746190540252e-01   +3.539373914361869e-01   +2.071202227959311e-01   +2.216009440581653e-01];
L2I_L1I_iGABA_netcon = [+3.469897935315784e-03   +2.710641759732649e-01   +3.528979257488063e-02   +3.592341922170880e-01   +2.096162884612933e-01   +3.192581858328561e-01   +1.743283698699533e-01   +5.112646262424158e-02; +1.280734810580329e-01   +1.852841254647900e-02   +3.006185391576311e-01   +8.663285170428850e-02   +9.062622443105803e-02   +9.239998994643124e-02   +3.501079084532978e-01   +2.076269434200579e-01; +2.744205922165610e-01   +1.590175844664523e-01   +1.854669038963971e-01   +2.448109314180304e-01   +4.301704347309690e-02   +3.930596445791568e-01   +1.091049149269062e-01   +1.710931836843076e-03; +3.212344028910618e-01   +3.737326060392164e-01   +2.492691218716835e-01   +2.565518656779536e-01   +2.711252812941162e-01   +9.103926622809808e-02   +3.740679120682688e-01   +3.239437836016493e-01; +2.569065037095790e-01   +5.723451812390021e-02   +1.012709253681199e-01   +3.559249643752982e-01   +1.979546334481654e-02   +3.445691945052247e-01   +1.104867240592949e-01   +1.968892458078554e-01; +2.477400773815093e-01   +3.638041764807638e-02   +3.587637643263130e-01   +1.696241092127025e-01   +3.020881125427524e-01   +3.422065707948909e-01   +4.148897803632237e-01   +9.389245729293658e-02; +3.205452767251704e-01   +1.317202122632359e-01   +3.931685671587341e-01   +2.479547489437691e-01   +5.449666089458158e-02   +1.476035940899080e-01   +8.451808987247317e-02   +3.787824775937564e-01; +6.983974128543408e-02   +3.324542531169188e-01   +1.444982970502322e-03   +3.450117354321606e-01   +3.986302955569358e-01   +9.941960647848788e-02   +2.087342177033433e-01   +1.285796636814811e-01; +2.724618174700037e-01   +2.723284726901848e-01   +1.362273652901635e-01   +2.913860438450140e-01   +2.654674776664087e-01   +1.146939985506204e-01   +1.584108106485427e-01   +1.167285332410014e-01; +2.211108574516555e-01   +1.347307314338418e-01   +1.787443289834439e-01   +2.800824526231975e-01   +4.961522703569682e-02   +3.045561477057229e-01   +1.936110561149532e-01   +2.497769490834585e-01; +1.934750918487891e-01   +2.483213233972940e-01   +2.192177742449414e-02   +1.581655217995976e-02   +1.949209725289044e-01   +9.650491149704128e-02   +1.230912662719288e-01   +2.025701152457882e-01; +9.327755948928521e-02   +2.617961880711503e-01   +5.281498609352871e-02   +1.550125080756856e-01   +5.583854104620729e-02   +2.251134531155997e-01   +1.723077203281797e-01   +2.623033996478755e-01; +3.075977234566792e-01   +2.405847729003123e-01   +8.933686476844996e-02   +2.114226712668849e-01   +1.061351675094947e-02   +2.550673303433183e-01   +8.087864685617567e-02   +3.851312354087105e-01; +2.118440340432907e-01   +2.104846103058615e-01   +6.499203231420657e-02   +4.037187056949806e-01   +1.729694522145617e-01   +4.053983156747711e-01   +2.859647615448790e-02   +2.411844391045133e-01; +1.109899331408263e-01   +1.922586058507149e-01   +4.411894926500291e-02   +2.485034382149067e-01   +6.214219952279462e-02   +1.435293537490915e-01   +3.608755476094887e-02   +8.741996451056314e-02; +5.257977092149190e-02   +2.414640914803692e-01   +2.611269211857167e-01   +3.437287715908226e-01   +6.693263939736158e-02   +3.707458106845101e-01   +3.965819501565606e-01   +2.254887534523379e-03];
L1I_L2I_iGABA_netcon = [+2.322928516797192e-01   +1.212035675062330e-01   +1.792553828334816e-01   +1.131837542022877e-01   +5.273920376365340e-02   +3.091126351700928e-01   +1.874240011441988e-01   +3.462548332979279e-01   +1.328448035090855e-01   +2.935486584739552e-01   +2.891652088334814e-01   +3.549925026772166e-01   +1.758741878245545e-01   +3.370231418189465e-01   +2.603080474469507e-01   +1.770758197624777e-01; +1.023789174799534e-02   +6.340205634109947e-02   +1.103794888752831e-01   +8.316034748707034e-03   +3.768374576871689e-01   +2.677192440143512e-01   +3.006211897166111e-01   +2.726525811360865e-01   +2.650487823798415e-01   +1.530595047889675e-01   +1.208874432816530e-02   +1.605702275728290e-01   +2.350224038757838e-01   -6.940564788311785e-04   +3.382455208598121e-02   +2.558866613632533e-01; +5.108425308121728e-02   +4.645752970655034e-02   +5.414112354687260e-03   +9.580744216232864e-03   +4.045599729948642e-01   +2.768825926760617e-01   +3.819378400173722e-01   +3.559581244792809e-01   +1.162321706058951e-01   +1.176565720774932e-01   +7.515639352629641e-02   +8.853878002982400e-02   +3.551286031046238e-01   +9.505290269570255e-02   +1.174684865848199e-01   +2.661513479451109e-02; +2.168952979878226e-01   +3.398266865524024e-01   +2.153390271773461e-01   +1.384517433532026e-01   +1.163955164089980e-01   +2.229810434668591e-01   +1.740412143356564e-01   +3.394903945131871e-02   +1.014880935202035e-01   +2.219978555043864e-01   +3.743219370948452e-01   +3.769620476315811e-01   +3.355066325324349e-02   +4.870891929404920e-02   +1.458989308537017e-01   +2.421699740145392e-01; +1.685419723398092e-01   +1.181171490051554e-01   +3.775706121794253e-02   +3.617139567213085e-01   +2.234733593077771e-01   +3.438189930500278e-01   +5.667502639159445e-02   +2.142783508809676e-01   +3.870118103682100e-01   +2.373254270472102e-01   +3.578244083732574e-01   +1.080164485156532e-01   +6.021783662900608e-02   +4.002444511486470e-01   +3.432620415351456e-01   +4.009058422643030e-01; +1.316144349254192e-01   +2.940162648036181e-01   +1.284913377808383e-01   +3.216331639368971e-01   +1.777122676292522e-01   +3.074790823388152e-01   +3.361312667036776e-01   +2.712127701282708e-01   +1.603078248924266e-01   +4.048789841383524e-02   +2.305374550747489e-01   +3.596629711520034e-01   +1.149171474235866e-01   +2.590850312301987e-01   +3.706932720439396e-01   +1.385004515453140e-01; +3.877705750435713e-01   +3.328981229693301e-02   +2.475514170356057e-02   +9.362329540766297e-02   +4.046238339905343e-01   +2.432084214255935e-01   +3.902358888516757e-01   +1.709642105009512e-01   +3.839245279569811e-01   +1.018826755072944e-01   +4.016957937617953e-01   +2.163670673325597e-01   +1.733670786314197e-01   +2.238814911962316e-01   +9.636334127024146e-02   +3.133242235716921e-01; +3.070764658158258e-01   +2.686470534502771e-01   +1.051300658753589e-01   +1.210208023974772e-01   +3.442032245332626e-01   +1.580687732824194e-01   +1.124600027922949e-02   +6.392689090079919e-02   +1.575559141639777e-01   +1.242486027228431e-01   +4.826863253840116e-02   +3.765884244422638e-01   +1.411887662335430e-02   +8.200424296912256e-02   +3.919557103376758e-01   +3.974028793496509e-01];
L2E_L1E_iAMPA_netcon = [+3.709906941643681e-01   +1.609441997319956e-01   +2.771181144267807e-01   +2.359955751436788e-01   +3.966740908632926e-02   +1.353344316697449e-01   +3.579970505166708e-01   +2.618622788675252e-02; +1.309665418184252e-01   +1.266231670188360e-01   +3.307785320396839e-01   +9.560946492732697e-02   +2.885427208603226e-01   +2.331898418359717e-02   +1.295125528519997e-01   +2.885843262894198e-01; +1.245723685447148e-01   +6.801124165540737e-02   +3.051548294694563e-01   +2.758208655713008e-01   +1.998039190772914e-01   -7.544435152815247e-03   +8.606584908948034e-02   +1.505663599346674e-01; +2.373816413258097e-01   +7.943413085196920e-02   +1.123776091454036e-01   +3.898334753230981e-01   +2.219093501178447e-01   +9.204187542855082e-02   +2.582193044684207e-01   +6.945384645696022e-03; +7.454391871888760e-02   +2.093744862049236e-01   +3.477206206514952e-02   +1.372113144895934e-02   +1.049874739809024e-01   +2.199569892370516e-01   +9.856903694358471e-02   +1.063903240840127e-01; +1.023236668761999e-01   +2.156324110276592e-01   +6.326989187075881e-02   +1.860588063046948e-01   +3.691786176338831e-01   +3.986954154325397e-01   -3.799876561361054e-03   +3.386397264476447e-01; +1.658697649331739e-01   +1.686318031702137e-01   +3.890202500888985e-01   +1.598017024652792e-01   +1.077217261255064e-01   +4.773222966652504e-02   +1.772949152017180e-01   +2.034328608453604e-01; +8.376835400025046e-02   +7.706194023602443e-03   +2.968384851410805e-01   +2.830481208888641e-01   +1.227808708002971e-01   +2.094911831757623e-01   +3.326419572650408e-01   +3.235993422234806e-01; +1.076305769099160e-01   +3.424618499026000e-01   +1.907089445873462e-02   +3.449719966671169e-01   +2.749596375378666e-01   +1.163894750245729e-01   +1.170306992280704e-01   +1.387491646091459e-01; +5.370639626375425e-02   +3.654450168581624e-01   +2.986615267902353e-01   +3.305624217531520e-01   +1.751148911928058e-01   +4.026710105042974e-01   +3.940973612215011e-01   +2.761653748986940e-01; +3.312662418482995e-01   +1.437190536938774e-01   +2.240762780279395e-01   +5.553758507808935e-02   +1.999373139322458e-01   +3.009560456665942e-01   +1.234711355807677e-01   +8.803606964195763e-02; +2.473998236532872e-01   +3.961046219135486e-01   +1.578713134912236e-01   +3.512102434946406e-01   +3.960515856419554e-01   +3.205908700866075e-01   +1.993989430388378e-01   +3.950017981142455e-01; +2.052688781572580e-01   +2.281284657329780e-01   +8.393924657292381e-02   +3.565450329004884e-01   +4.799374703054386e-02   +1.686799561590422e-02   +1.043745794888420e-01   +1.378218392064889e-01; +1.689396207201476e-01   +2.234322456281231e-01   +3.723186767127134e-01   +1.579475735288594e-01   +1.970877721353479e-01   +2.554142229697506e-01   +3.582771900112927e-01   +2.062818951278902e-01; +3.287165973217470e-01   +1.023672043350375e-01   +1.599524498692641e-01   +8.381181159030274e-02   +9.148017061657612e-02   +3.206964340238646e-01   +3.822422558644782e-01   +2.592282120604207e-01; +2.414156058726192e-01   +9.165659430849555e-03   +1.177281825634510e-01   +3.089772057439890e-01   +1.890590097472238e-01   +3.124667370785737e-02   +2.103071106341773e-01   +3.022467676001324e-01];
L1E_L2E_iAMPA_netcon = [+5.160013930739261e-02   +1.445567206200777e-01   +3.046551006676536e-01   +2.999566567766002e-01   +1.542190223070115e-01   +2.412804654913205e-01   +2.285709847758699e-01   +3.691998104792701e-01   +3.251592020144751e-01   +1.984716904295562e-01   +1.271518039140013e-01   +3.920313435229628e-01   +1.835499260249133e-01   +1.184952554741149e-01   +2.295746301907573e-01   +1.081461640811726e-02; +3.066818704658671e-01   +2.637800666311252e-01   +3.897893856980942e-01   +8.962169358399866e-02   +1.727733213539613e-01   +2.861471557695041e-01   +2.836078383680217e-01   +1.429422940231067e-02   +1.009139311353926e-01   +1.192635483356619e-01   +2.911317682927201e-01   +2.440929519163863e-02   +3.289702818461020e-01   +2.052720162126404e-01   +1.126586499185640e-01   +3.175313703769381e-01; +1.426673224796980e-01   +1.705375924487202e-01   +9.455995109068416e-02   +4.094507282570013e-01   +2.354952949840045e-01   +2.329620352229410e-01   +3.429412766120520e-01   +1.129732069017009e-01   +2.554633125475563e-03   +9.112406465550509e-02   +7.600972397313886e-02   +2.410040659210625e-01   +3.703484294489703e-01   +7.163989950216931e-02   +1.412840378063100e-01   +2.220231510426959e-01; +6.945666065125002e-02   +1.369106625426879e-01   -9.112086690746084e-04   +1.939801082992800e-01   +3.273974894897320e-01   +3.358591262962913e-01   +2.453217586975309e-02   +9.085777386610687e-02   +3.498913068866427e-01   +1.723326908242560e-01   +3.287783600774398e-01   +1.377370099854670e-01   +4.115323144937266e-01   +1.249623777128269e-01   +8.479632323428242e-02   +2.142356866099782e-01; +8.534172795103281e-02   +6.962732042662120e-02   +1.494759033365409e-01   +2.057963016981910e-01   +1.212734970287499e-01   +2.471821358525494e-01   +2.566471167504686e-01   +1.770057700469281e-01   +1.130543484827254e-01   +2.773479171820508e-01   +1.312567594837891e-01   +2.430947896852421e-01   +5.796109877019669e-02   +1.577648822233848e-01   +3.636181730166412e-01   +1.290742665264569e-02; +1.987310847125445e-01   +2.121339727333481e-01   +2.509555629482920e-02   +1.949186126761603e-01   +1.299680234091435e-02   +1.533002133508810e-01   +2.530119536272017e-01   +2.849606369961197e-01   +1.075026008816980e-01   +3.267165434853672e-01   +3.563335885199622e-01   +1.216752373682989e-01   +6.804381210401034e-02   +2.127504877088095e-01   +1.948191820529802e-02   +2.476590705034087e-01; +2.808706370788558e-01   +6.715449592051824e-02   +1.959027636064456e-01   +2.821830590629779e-01   +7.305451426637941e-02   +3.371098446145064e-01   +3.388506600396471e-01   +4.768807390958962e-02   +3.849137214718688e-01   +3.697830396056452e-01   +2.275657979340325e-01   +1.603757688862216e-01   +1.175758537734215e-01   +1.351558948664369e-01   +3.066798014388218e-01   +1.815743301049423e-01; +5.605596373134785e-02   +1.413787491487809e-01   +4.425929555867029e-02   +9.708150067268075e-02   +3.399807248883744e-01   +1.085023798200103e-01   +9.688199267492474e-02   +2.932697405615876e-01   +3.641578560847967e-01   +2.638691238858996e-01   +1.216792691407893e-01   +3.656874698356764e-01   +1.139740135472867e-01   +4.391276727374947e-02   +3.711578141217863e-01   +2.892321602811314e-01];
L2I_L2E_iAMPA_netcon = [+2.333681831648827e-01   +3.176379290085576e-01   +3.432301530465540e-01   +3.640960684489643e-01   +1.239717506557921e-01   +4.047832037518892e-01   +3.275373267245619e-01   +1.948011800484058e-01; +6.373656698184732e-02   +2.847636767043614e-01   +2.090635424514387e-01   +2.494299663177246e-01   +1.442135471844230e-01   +2.016234595409539e-02   +3.152899167264102e-01   +2.548439154468028e-01; +1.932176779876652e-01   +8.938360131835026e-02   +3.751968737233148e-01   +2.449393043684215e-01   +2.051306670142019e-01   +3.940238899109953e-01   +3.691044067097290e-02   +6.572777430504496e-02; +1.238273611352115e-01   +3.062523460015157e-01   +3.446647162304373e-01   +2.929805653603514e-01   +4.084803406308688e-01   +3.948837391843917e-01   +2.506059054116169e-01   +3.629212585123095e-01; +1.163226503512466e-01   +4.704749483610909e-02   +3.648245512729005e-01   +3.979793649923640e-01   +3.330362288160165e-01   +4.012651162860771e-02   +2.482154078116985e-01   +3.255490859436221e-01; +7.449116790574481e-02   +3.239705346756064e-01   +2.841411593410756e-01   +2.200911732424967e-01   +2.446492017874926e-01   +2.866115279485974e-02   +2.480926487804916e-01   +3.338858328967534e-01; +3.188789109573423e-02   +2.911273267087189e-01   +2.336061753640132e-01   +1.525315817289651e-02   +3.680882347778690e-01   +1.668998870776726e-01   +3.102499273922713e-01   +3.420556883497177e-01; +3.388872211051337e-01   +1.349979867382890e-01   +2.560573146045848e-01   +2.899774588977765e-01   +6.743343896539086e-02   +3.224646547178462e-01   +1.779652605155898e-01   +1.880603028753277e-01];
L2E_L2I_iGABA_netcon = [+8.001893642222122e-02   +2.947621651153154e-01   +3.825940894817670e-01   +3.004780057584254e-01   +4.014403339501162e-01   +3.182361491361114e-01   +3.766975160058297e-01   +1.924344724982194e-02; +3.931036504181366e-01   +3.464634038803368e-01   +2.004315797750965e-01   +3.150478478349377e-01   +1.764043709545480e-03   +3.557955619583200e-01   +8.953174271943734e-02   +8.135601236703754e-02; +1.197363557778280e-01   +1.187762350094187e-01   +2.745430568809432e-01   +1.322266215091110e-01   +3.974367676561681e-01   +8.806831609683827e-02   +6.082070900552232e-02   +8.826774448706048e-02; +2.963065207748476e-01   +2.663440517927037e-01   +6.251385949287165e-02   +2.487450124763025e-01   +5.388816052716393e-02   +2.037426458877254e-01   +3.352070613702913e-01   +2.027151872029261e-01; +2.876040919606478e-01   +2.224065986445253e-01   +3.235496445931024e-01   +2.117399134973861e-01   +5.855775560257400e-02   +2.459921301825619e-01   +3.928767338108317e-01   +1.793835886095884e-01; +2.695523300544936e-01   +1.126849375311685e-01   +4.064213151793610e-01   +5.182249748883299e-02   +2.541961486810272e-01   +1.656662266691099e-01   +3.336994817999680e-01   +3.144609405381856e-01; +3.919431147492732e-01   +2.584350660384757e-02   +2.346109798546549e-01   +1.250591938976532e-01   +1.096775726380958e-01   +3.988184301239411e-01   +3.370377433248899e-01   +1.090608359571301e-01; +3.972874187967192e-01   +3.659999954429156e-01   +3.432798391205316e-01   +4.850995759937443e-02   +3.970853578414367e-01   +5.620959297810602e-02   +3.352076777983458e-01   +3.640033445801811e-01];
L3E_L2E_iAMPA_netcon = [+2.816727857315614e-01   +2.233970943544360e-02   +2.185447189840298e-01   +6.528293697079261e-02   -1.897454465463897e-03   +4.864368022342067e-02   +1.182549439673933e-01   +3.499233921699104e-01   +1.501688578184619e-01   +1.780369024165417e-02   +1.434276078646931e-01   +3.839078406867993e-01; +3.213834223721349e-01   +3.335022621903899e-01   +1.149063873592050e-02   +2.175040515793859e-01   +3.307338760880120e-01   +3.022832595003406e-01   +2.829333276966464e-01   +2.184308564141192e-01   +3.301524117371340e-01   +3.883814246731489e-02   +1.992311115390752e-01   +1.009301480155234e-01; +2.607938811941207e-01   +1.855909751182628e-01   +3.629170491317255e-01   +2.548079679265601e-01   +2.766410314602661e-01   +5.150649991063252e-02   +1.559465182944835e-01   +2.197391129376459e-01   +9.483095961952219e-02   +2.321808885552461e-01   +2.207367247429749e-01   +3.947430252735999e-01; +8.500275699279554e-02   +7.053687255845355e-03   +3.158042287178276e-01   +1.874631579039241e-01   +2.358352181717141e-01   +1.319142169166665e-01   +2.309687374237797e-01   +2.283918751888612e-01   +7.187242721139031e-02   +3.766590465486788e-01   +1.894520429724542e-01   +9.079247913100459e-02; +2.370659981879583e-01   +1.999587396628682e-01   +1.201248751397285e-01   +1.850018135575804e-01   +3.367202511898309e-01   +2.568732744534527e-01   +3.400540313879142e-01   +3.158488520937896e-01   +1.040592190714056e-01   +3.711692805962138e-01   +2.010615301388456e-01   +3.105792613587027e-01; +2.565402006792712e-01   +3.638452972002623e-01   +3.696107606844365e-01   +7.550457924400013e-02   +2.347397134124977e-01   +1.617193100274569e-01   +6.777778527957454e-02   +6.988554695294348e-02   +2.607099542378190e-01   +6.713330074636667e-02   +7.323139183681734e-02   +2.048190718240448e-01; +3.811042884173083e-01   +2.167945882474678e-01   +3.863746496800992e-01   +3.235131660694801e-01   +1.315892078251125e-01   +2.708200284793387e-01   +2.492823727780545e-01   +1.185971121524354e-01   +2.062677424731765e-01   +2.056757416534362e-02   +3.774358020570139e-01   +3.829435348303405e-01; +2.183749781235030e-01   +3.511989986150021e-01   +3.772526102347435e-01   +4.030359017766252e-01   +2.048621615178809e-02   +2.861778374140436e-01   +3.153255779684724e-01   +6.552839532918603e-02   +3.840800125138252e-01   +3.355138149573405e-01   +4.752153532386024e-02   +6.800805089012552e-02];
L3I_L2I_iGABA_netcon = [+3.264304981996954e-01   +2.695743775668847e-01   +1.754684633806112e-01   +3.574720662481813e-01   +3.316429703667061e-01   +3.790159273667877e-01   +2.889883956876443e-02   +4.101230184319578e-01   +3.501221421323990e-01   +1.802277341910184e-01   +5.217227141063708e-02   +6.884741298613758e-02; +2.867644024366545e-01   +1.790275827633804e-01   +2.700809575893844e-01   +2.632631717945061e-01   +2.569540273965834e-01   +2.541723978452820e-02   +9.654293227015907e-02   +3.739579999831197e-01   +1.565396190652581e-01   +2.755916958686778e-01   +3.046254994856511e-01   +1.523915965029262e-02; +8.008228089768027e-02   +2.089571464468165e-01   +3.345176686578453e-01   +3.986369108068464e-01   +1.212667375857113e-01   +3.490604167700345e-01   +2.214831822489678e-02   +1.670465025420572e-01   +1.986801060265357e-01   +1.356728217319704e-01   +3.729735804469465e-02   +2.039193473502108e-01; +3.094879984081234e-01   +1.495141639406681e-01   +3.824969444342176e-01   +4.048212414123492e-01   +6.347918156639645e-02   +2.890520594549339e-01   +2.465466402189305e-01   +2.479434509691202e-01   +2.642232645383524e-01   +1.297145885144150e-01   +2.671169481730170e-01   +3.075033323325050e-01; +9.191325688534950e-02   +3.879810273851518e-01   +3.343701335563531e-01   +1.881706579117257e-02   +1.683933065375708e-01   +3.267336408240515e-01   +2.324779369391318e-01   +3.805541094836353e-01   +1.013066448085994e-01   +2.753094853030162e-01   +3.031640523155307e-01   +2.302441059925532e-01; +1.333710478803939e-01   +3.108529187044777e-01   +2.733203072650138e-01   +2.591582011808095e-01   +3.713004438545223e-02   +1.204604849236404e-01   +2.297701882191606e-01   +3.091539057235338e-01   +3.955294730305179e-01   +1.009986872974195e-01   +2.196667379927112e-01   +1.959351416596522e-02; +2.803809518970341e-01   +2.281550955247864e-01   +2.253962434896893e-01   +2.969645014276492e-01   +2.356456104131366e-01   +1.347519217268864e-01   +6.000704813824997e-02   +8.778796373494967e-02   +9.712963057684951e-02   +3.624758303973802e-01   +3.828986456513775e-01   +3.024271173470059e-01; +2.615997266258584e-01   +3.509132948879059e-01   +3.031130012221441e-01   +3.952899842048282e-01   +4.082113058628366e-01   +5.771398877059664e-02   +3.515528318533507e-01   +3.452841066435183e-01   +2.729604217016743e-01   +4.023690124135887e-01   +2.710436676670256e-02   +2.014630838685562e-01];
L2E_L3E_iAMPA_netcon = [+1.587472646867691e-01   +3.502455050939156e-01   +1.362631798065836e-01   +3.864803400798309e-01   +2.168704575275130e-01   +2.769371555155153e-01   +2.841194187019844e-01   +1.732138557299567e-01; +1.653292346694498e-02   +9.930600470530279e-02   +2.660595863962182e-01   +1.520301192708280e-01   +1.648009780622288e-01   +2.165097974825472e-01   +3.347799483011247e-01   +3.667478849020125e-01; +3.875465434930018e-01   +1.397064276308427e-01   -3.400518041017177e-03   +2.006872521745704e-01   +2.412113155454586e-01   +3.805759161568298e-01   +2.007886431759116e-01   +2.469908634436874e-01; -7.205932066139627e-03   +3.247024702449206e-01   +1.377774697539244e-01   +3.921433395484394e-01   +3.393194704527503e-01   +3.341381282678092e-01   +1.263600990359320e-01   +3.118840953679513e-01; +1.906651720256810e-01   +1.220651996489381e-01   +7.399204526752733e-02   +2.549926563876304e-01   +2.620879613384214e-01   +2.666232119457464e-02   +5.888473393559459e-02   +2.444253493917407e-01; +3.145253541030090e-01   +8.889822109086253e-02   +4.694298132920580e-02   +1.240940748070333e-01   +4.110837942917738e-01   +3.325538526744394e-01   +9.376233455108948e-02   +2.106033353665183e-02; +2.951591253742331e-01   +2.216946537694359e-01   +2.382444753951629e-01   +2.460144938129548e-02   +1.939094198749109e-01   +3.420367294242079e-01   +4.033607539026020e-01   +2.292109910743869e-02; +1.919723289293122e-01   +3.087210014890721e-01   +3.221740776954382e-01   +1.041112736047297e-01   +2.301756736538723e-01   +2.392438272060523e-01   +2.338160059259291e-01   +2.989062541136969e-01; +1.150111390503319e-01   +1.862271218068960e-01   +2.573896652993725e-01   +4.274580345558215e-02   +2.541385491172060e-01   +1.106672918850649e-01   +1.633586154866187e-01   +3.716294672396313e-01; +1.168192333486824e-01   +2.530891078634639e-01   +2.407147698691483e-01   +1.411055041234079e-01   +1.001758147338829e-01   +2.233355758440009e-01   +2.585192590202928e-01   +1.763821065660714e-01; +1.737630255815986e-01   +1.010951616164771e-01   +3.455576316046270e-01   +3.432234542353095e-01   +1.860964202993180e-01   +1.890748615885249e-01   +4.033174763530284e-01   +1.287500063751835e-01; +8.710355608368525e-02   +1.865592064780490e-01   +2.030848284722273e-01   +3.764749283805235e-01   +1.090641894302287e-01   +2.278152376670492e-01   +1.764573955196868e-01   +1.610169954318842e-01];
L2I_L3I_iGABA_netcon = [+1.646884066769358e-01   +6.815322898257542e-02   +4.127705866534353e-01   +2.653818907986187e-01   +2.318779622733849e-01   +3.254028514455983e-01   +2.619518443087022e-01   +3.471333318220280e-01; +9.995423515787361e-02   +3.057219029220060e-01   +3.749374966667419e-01   +2.398275066418399e-01   +3.952129638670979e-01   +1.956030082344720e-01   +2.665602811908733e-01   +3.078297276203162e-01; +1.105237378988206e-01   +4.844379725214746e-02   +1.162898385898901e-01   +8.539755527167756e-02   +1.900374091529557e-02   +1.054681085912461e-01   +2.966673898376053e-01   +2.095583990461436e-01; +2.152797270319639e-01   +3.120303280358099e-01   +4.471767048216321e-02   +1.190127119266617e-01   +3.976287537124202e-02   +3.661221174574293e-01   +3.360197993740529e-01   +3.990471889719425e-01; +3.276536068827672e-01   +3.372514936430557e-01   +3.634529345061839e-01   +3.459549729169257e-01   +4.010619128793197e-01   +1.657431450387982e-02   +2.904752427189548e-01   +3.142028056126713e-01; +1.910163819009672e-01   +1.978951793591762e-02   +6.560430443392207e-02   +1.878685103017647e-01   +1.163096764722724e-01   +1.877843071869403e-01   +2.044262546535468e-02   +3.149442993629152e-01; +2.851698885094834e-02   +2.683849925493169e-01   +1.286083531878238e-01   +4.081590537762658e-01   +3.545845063213283e-01   +1.876932868140635e-01   +3.182318218021861e-01   +3.967748431343086e-01; +2.361485504608622e-02   +6.733545210276580e-02   +1.914683892715669e-01   +2.026200453088260e-01   +2.226522480175454e-03   +3.867587887600509e-01   +2.075227375126404e-02   +3.613984112242992e-02; +1.207989209085956e-01   +1.705829088418830e-01   +2.135897918057335e-01   +3.969708034060562e-02   +3.603094589362211e-01   +3.086064584551416e-02   +2.004353496307637e-01   +1.605527812137167e-01; +2.568325902363293e-01   -3.362331179866666e-03   +3.115467373349636e-01   +2.849807943279073e-01   +1.674831207780774e-01   +3.469819579859266e-01   +3.902680331694882e-02   +1.634246442682077e-01; +4.093698001898213e-01   +1.151367605368084e-01   +3.256089141509806e-01   +2.579924026816874e-01   +1.573877996886958e-01   +1.890971896998621e-01   +2.643496988238694e-01   +1.883656458038509e-01; +3.670543229488505e-01   +1.509986975524076e-01   +3.097399177574737e-01   +1.419441197464870e-01   +1.875961275975283e-01   +2.632214143159227e-01   +2.218345229071452e-02   +2.354489974504208e-01];
L3I_L3E_iAMPA_netcon = [+1.492126373407901e-01   +8.995880221143600e-02   +2.274953453965788e-01   +6.004092633073727e-02   +2.346570468632027e-01   +2.254275045047635e-01   +2.516491177111043e-01   +3.820253859362666e-01   +1.230493272783691e-01   +1.903263412766538e-01   +1.489423822327680e-02   +2.933692463210692e-01; +2.791413111780816e-01   +1.937843520862409e-01   +8.947000106447918e-02   +1.749225128639651e-01   +2.991277996236327e-01   +2.685852461934943e-02   +9.135515233665285e-02   +1.715526751786822e-01   +3.708810350518384e-01   +2.647887628035753e-01   +1.107592543820237e-01   +3.630977427823035e-01; +7.619289369845068e-02   +2.239862673950799e-02   +1.114803438403740e-01   +1.955036492726742e-01   +1.123120712049945e-01   +5.323927321750889e-02   +9.385501447282679e-02   +3.645801271472514e-01   +7.631878528689334e-02   +1.097112823604285e-01   +3.021046395944403e-01   +3.641325535209964e-01; +2.968567171723413e-01   +2.907277263087175e-01   +1.198711332802104e-01   +4.028446150579014e-01   +2.563967492097692e-01   +2.713073809510378e-01   +3.287393323539788e-01   +1.114744204238072e-01   +1.679295471188903e-02   +3.590951398891113e-01   +4.933885437165126e-02   +1.163182541213888e-01; +5.839649988390517e-02   +2.517208905240853e-01   +1.254254622525962e-01   +5.423770701579601e-02   +6.103784263192377e-02   +2.347474439229294e-01   +2.693212845680478e-01   +1.595406111286188e-01   +1.964237718093526e-01   +1.798307848592844e-01   +2.143054644862815e-01   +2.782024007730037e-01; +2.189223393229970e-01   +2.569580221309232e-01   +1.039939902882374e-01   +1.849162658086744e-01   +2.403619354333219e-01   +1.084222230212982e-01   +2.574813784378142e-01   +3.610947855974020e-01   +3.728054505212728e-01   +1.119476986896342e-03   +5.924031453038005e-02   +4.538920624223504e-02; +3.434992909533041e-01   +3.057150625156305e-01   +5.190896550855462e-02   +2.415202942367261e-01   +2.808325579758392e-01   +2.190819391396251e-01   +3.611321323060199e-01   +3.897237539159987e-01   +3.860309296872690e-01   +9.887822160606038e-02   +3.519661323145257e-01   +3.620277528460387e-01; +1.191755771385719e-01   +2.852301928407135e-02   +6.732549885753972e-02   +2.142861275546144e-02   +3.409046609121648e-01   +3.023802934173262e-01   +2.021935642618400e-01   +1.181917844457722e-01   +2.520898559098994e-01   +2.234391441510594e-02   +1.609529708269990e-01   +1.035880068441893e-01; +2.194543959043972e-01   +3.371911419255950e-02   +2.014176020104249e-02   +2.861014958624106e-01   +8.681637476435830e-02   +3.768916018655685e-01   +5.118778271692835e-03   +2.357341235975514e-01   +2.875446755313461e-01   +2.703629736209535e-01   +1.498320032638341e-01   +2.566229969936031e-01; +1.879224287891203e-01   +2.847144762850277e-01   +2.496118066694022e-01   +4.048089610544845e-01   +3.644484533428948e-01   +1.130049192705778e-01   +2.280671881851015e-01   +2.409528769208933e-01   +6.868979428736545e-02   +2.426600669151986e-01   +1.766261611016761e-01   +7.575744553380118e-02; +3.990870489617388e-02   +3.371533228241928e-01   +5.730333069330327e-02   +2.441665120168734e-02   +3.219346735965772e-01   +4.018050462634725e-01   +2.423358466586013e-01   +2.775319947059143e-01   +2.136857647856759e-01   +6.026480100489714e-02   +2.756066719784565e-01   +3.615910923711865e-02; +9.108100353868638e-02   +2.597326823476045e-01   +8.966844889582927e-02   +3.280813847751779e-01   +3.503338829358141e-01   +1.319093594728297e-01   +1.091173030293751e-01   +2.471285069859143e-01   +2.604523210381327e-02   +1.234517693244159e-01   +2.260056853052547e-01   +9.468824122290802e-02];
L3E_L3I_iGABA_netcon = [+3.318828920976535e-01   +2.364056173385232e-01   +9.809642731542047e-02   +2.252739519606944e-01   +2.262313196161299e-01   +5.317418655849425e-02   +2.254516267716177e-01   +3.177646782956700e-01   +2.379331906273044e-01   +8.390313719401792e-02   +9.666165491737380e-02   +2.200226253278283e-02; +2.587688331693410e-01   +5.606808112495847e-02   +1.277379494327091e-01   +3.559204177138523e-01   +1.604484336955648e-01   +3.667548996164010e-01   +2.920737975452234e-01   +3.131520234659938e-01   +1.210844970256586e-01   +1.698978825034252e-01   +1.896906790039875e-01   +2.020478880936553e-01; +9.664008158570370e-02   +1.138258556471128e-01   +3.983736383904032e-01   +3.125011959737926e-01   +3.345623776387143e-01   +9.211012499574289e-02   +1.997453528354244e-01   +3.497503502718383e-01   +3.163563534917988e-01   +1.930003117305898e-01   +4.031056676092543e-02   +9.485074940880138e-02; +1.093342317608932e-01   +1.534544861992454e-01   +3.570112330462035e-01   +2.982091897190760e-01   +7.408052198438815e-02   +3.176657962546518e-01   +1.376625147813169e-01   +2.382428625701988e-01   +1.403507814131675e-02   +3.787475211066718e-01   +3.975157825616797e-01   +1.521136347964170e-01; +3.119573633754120e-01   +1.750164164221172e-01   +3.182428548256178e-01   +1.137455537103254e-01   +2.609483040989346e-01   +1.190409627925200e-01   +3.963906495820115e-01   +1.477398614022652e-01   +3.170053497115803e-01   +2.030157738623369e-01   +1.692704688358496e-01   +1.880048276338527e-01; +3.859966658353150e-01   +1.592718105921385e-01   +2.404084914134011e-01   +6.199125315812173e-02   +3.221038058404115e-01   +4.674501539230812e-02   +3.413375247523226e-01   +1.150565094659586e-01   +2.938557641990339e-03   +1.066167090986997e-01   +3.086839950165624e-01   +9.781288904737677e-02; +2.526264521180836e-01   +3.040088413418059e-01   +1.430627905251194e-01   +8.717386125231866e-02   +6.846409658137767e-02   +3.983741677490835e-01   +5.033984335545944e-02   +3.730325660276654e-01   +2.619949881839225e-01   +3.060345356813186e-01   +1.451513813392314e-01   +1.019964146931369e-01; +1.110264038234424e-01   +2.003613756215836e-01   -1.998193033164205e-03   +3.776333160991839e-01   +7.449630413751436e-02   +1.548673150491862e-01   +1.008233042928882e-02   +6.015108137474823e-02   +3.122725120698826e-01   +3.060600455979229e-01   +1.944141496987835e-01   +1.880571609996524e-01; +3.161507183897667e-01   +8.544241740414185e-02   +3.694719194496273e-02   +2.827785547180708e-01   +1.891262771227653e-01   +3.703230926267292e-02   +2.409127939091320e-01   +1.294519329545435e-01   +3.643018790063508e-01   +3.593054439936256e-01   +8.742212462564017e-02   +4.061643872656359e-01; +2.333309377381793e-01   +3.932905534319755e-01   +4.096935093271613e-01   +2.941562142270869e-01   +7.363624921497960e-02   +3.454250897406280e-01   +1.718114291194664e-01   +1.164715559624846e-01   +2.325521145575056e-01   +3.363215560596582e-02   +2.670507282520055e-01   +3.926800757990239e-01; +4.653416203528080e-02   +1.981107794802129e-01   +3.624358918201309e-01   +2.564054944838631e-02   +2.214065418617211e-01   +3.447797016410281e-01   +2.715408242517110e-01   +1.180882991215337e-01   +1.128630506892300e-01   +1.889010258693930e-01   +3.180477347994790e-01   +3.766600336642988e-01; +2.942727820782267e-01   +5.152721088094786e-02   +2.721794224155704e-01   +3.163102967413103e-01   +3.503266617017963e-01   +6.457479262073020e-02   +2.920489300814754e-01   +3.162099365371647e-01   +1.875239935984924e-01   +3.168562853030145e-01   +1.384227947380827e-01   +1.427216920709490e-02];
L2E_Input1_iAMPA_netcon = [+2.778205325947035e-01   +2.464393364617591e-02   +5.421514418896724e-02   +3.742867667106658e-01   +8.886116600613840e-02   +3.670971239676021e-01   +3.432898134048917e-01   +2.101225123401664e-01];
L2I_Input2_iAMPA_netcon = [+3.575124939493712e-01   +8.645795164504332e-02   +3.955850433114781e-01   +3.552763964877918e-01   +2.746462752723297e-01   +3.618369829438584e-01   +1.435206430986297e-01   +3.151037466076285e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
