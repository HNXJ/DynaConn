function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.167969553762120e-01   +2.509567564717053e-01   +7.084162549358891e-02   +4.653126108937778e-01   +7.938116263399952e-01   +5.715859494308733e-01   +6.935912520218317e-01   +7.123372674414155e-02   +7.595469858257052e-02   +8.289634720690692e-03   +7.805635081928201e-01   +1.114523622479080e-01   +7.344138185431714e-01   +9.184890485814463e-01   +2.692829499751991e-01   +3.678005619605836e-01; +6.991253142816625e-01   +4.520755446851125e-01   +4.726891863207803e-01   +7.172069529312983e-01   +3.854186907285289e-01   +2.749895090665706e-01   +5.483138314082190e-01   +2.228713294886522e-01   +1.442986629248709e-01   -1.066083982474436e-02   +1.878429475717512e-01   +4.010609341978025e-01   -6.203232801368276e-02   +8.067329508959280e-01   +2.908446688314069e-01   +6.493155676859382e-01; +3.864359983569288e-01   +1.173882515800319e-01   +7.098709112658382e-01   +3.660995353306633e-01   +3.731599027648050e-01   +3.397446485765118e-01   +9.515195292854259e-01   +3.771125482531258e-01   +1.807459528207374e-01   +6.218322241459635e-02   +4.875541843309621e-01   +9.551208798641420e-01   +5.532777336244279e-01   +1.945354966375343e-01   +5.490658149823661e-01   +9.225902876526795e-02; +5.779072341155371e-01   +4.680873225882448e-01   +1.118878606275359e-01   +3.417054921442576e-01   +8.989137016013884e-02   +6.368157540685575e-01   +6.923059579584564e-01   +5.620191187672129e-01   +7.415120729101292e-01   +1.666380648178034e-01   +5.515058306310852e-01   +2.962037628456299e-01   +7.529262953849493e-01   +6.575451110247152e-01   +1.426476519888114e-01   +4.773538944475557e-01; +1.680313267134549e-01   +5.446053466888852e-01   +3.004518310995317e-01   +2.225619880764645e-01   +2.687446277490445e-01   +4.132681006071517e-01   +1.934829769492592e-01   +1.583663687563722e-01   +6.068852747208022e-01   +3.496721613098175e-01   +2.012763932880063e-01   +6.320356853987510e-01   +5.728005874809943e-01   +6.237435655849254e-01   +2.804168032927871e-01   +6.279928660277260e-01; +1.385622561493133e-01   +2.627807573577529e-01   +3.220888104178216e-01   +9.353297712722197e-03   +8.990783624212637e-01   +8.716537050863360e-01   +6.148361947558360e-01   +5.619334695870035e-01   +4.061491313498828e-01   +1.837502130617099e-01   +2.110896474066121e-01   +3.326138461454748e-01   +1.905418577189587e-01   +4.159504247639604e-01   +4.189176766673297e-01   +9.406026257434423e-01; +8.218925223612347e-01   +2.284784613222876e-01   +6.156026733137320e-01   +5.946244527638511e-01   +5.664469879607773e-01   +7.358151257353384e-01   +1.751815671220127e-01   +2.334312317837400e-01   +5.928425466118726e-01   +7.659472764349951e-01   +3.200390576494324e-01   +1.785040261809684e-01   +4.905083750494927e-01   +2.859859580610987e-01   +4.548022159839068e-01   +1.745154496084360e-01; -7.594340342733281e-02   +7.878330989719420e-01   +3.954391708829563e-01   +2.859566256088358e-01   +4.404805832331211e-01   +9.403442109906284e-01   +6.215541975987552e-01   +6.549912852097617e-01   +8.276388688492106e-01   +3.220991758089542e-01   +9.452451659831626e-02   +3.478048464050084e-01   +7.185453011815909e-01   +3.852111278416472e-01   +3.882889878803290e-01   +1.294514134289051e-01; +9.208144592174869e-01   +8.589852484675923e-01   +4.840928568671699e-01   +8.745851348324919e-01   +2.685562598608782e-01   +1.911935505458102e-01   -1.139510548508037e-01   +3.473397044962665e-01   +6.825156731824098e-01   +3.080482819518989e-01   +3.433921797257949e-01   +7.049135023301665e-01   +1.472652117451381e-01   +8.971691302124266e-01   +1.855643847136963e-01   +2.281618779117254e-01; -4.248661930618768e-02   -8.066998759322500e-02   +6.222976961750182e-01   -3.314587886777637e-02   +9.487408278148490e-01   +5.720813096387987e-01   +6.859237814823016e-02   +2.460500592176366e-01   +1.056088458667705e-01   +6.562994957478496e-01   +4.956512474080625e-01   +4.491789555860292e-01   +2.721063852504831e-01   +4.630501375218853e-01   +1.614017207215020e-01   +6.033173407804550e-01; +2.720620061287689e-01   +2.429995918419031e-01   +2.953917534953120e-02   +4.107389710947207e-01   +5.125753635901352e-01   +3.402838865911462e-02   +6.546575023407064e-01   +5.035933867891532e-01   +8.621832391557324e-03   +5.336301954484020e-01   +3.207641554281659e-01   +5.995643501330733e-01   +5.453901164884795e-01   +3.028374211616873e-01   +3.156952081776260e-01   +1.622775116644276e-01; +4.347270734341112e-01   +5.882990874312088e-01   +6.278962837128582e-01   +4.288798368233496e-02   +5.867438102246010e-01   +4.228065445285463e-01   +5.300964865744763e-01   +3.642970567258019e-02   +7.266743062282840e-01   +3.969194233451029e-01   +5.380182187516370e-01   +7.897603355807976e-01   +1.637642575351375e-02   +2.362273777258873e-02   +5.682507628700353e-01   +4.425720534590817e-01; +8.751830682211927e-01   +7.303414223174325e-01   +5.811492355695166e-01   +3.147752399988314e-01   +1.533156943735053e-01   +1.132687313151935e-01   +2.900406329329169e-01   +6.034573480375006e-01   +4.961390000511429e-01   +2.312491320905866e-01   +2.793976378572192e-01   -6.945534253235672e-02   +1.629874727128392e-03   +3.484999806579813e-01   +7.424809151299929e-01   +4.846121437312302e-01; +6.290321787761833e-01   +2.000245823110897e-01   +6.189530072591787e-01   +7.303245780076150e-01   +3.249465620743097e-01   +1.478399646699826e-01   +9.694598475875381e-01   +6.182749161084381e-01   +3.177555290479463e-01   +1.512265197888716e-01   +6.995836177825243e-01   +5.557917684282099e-04   +4.619889710784216e-01   +2.935619390583519e-01   +6.130292009732252e-01   +7.371286675169677e-01; +2.901203533411600e-01   +5.082857365526854e-01   +3.648318963041686e-01   +5.829649756654229e-01   +4.025302280549204e-01   +3.292432589963220e-01   +3.345833969907394e-01   +6.927825772143039e-01   +3.100199092498215e-01   +3.320408043291405e-01   +1.713834225759233e-01   +3.981124702542118e-01   +4.953639810594564e-01   +5.798746909807385e-01   +4.992805848970251e-01   +5.955424718227516e-01; +4.826798629465374e-01   +1.404965135996690e-01   +1.908297531900289e-01   +8.651887813974297e-01   +8.522783364645246e-01   +5.404554233342553e-01   +2.541566563091971e-01   +2.236900662795537e-01   +2.837482313721473e-01   -5.522747196323441e-02   +2.331650162762422e-01   +4.157513054847436e-01   +7.529147742499256e-01   +4.113841075757391e-01   +5.163351828281730e-01   +4.920904711138262e-01];
L1E_L1I_iGABA_netcon = [+3.850387378493413e-01   -4.301444866023846e-02   +3.512686659920912e-01   +3.223126498322707e-01   +8.305520640649219e-01   +2.408887377153107e-01   +6.201151391541857e-01   +7.781555405209825e-01   -6.632005752976024e-02   +6.132668232587182e-01   -4.612337522457272e-02   +4.964036443922302e-01   +7.964109371227918e-01   +3.429057336409280e-01   +2.939232004688673e-01   +6.223121233989970e-01; +3.260009208538940e-01   +1.621608871104915e-01   +1.524268413039865e-01   +5.198823552663155e-01   -6.701551359032303e-02   +2.411792017313192e-01   +1.564612764793410e-01   +5.369743346997464e-01   +5.634698671855801e-01   +7.411430778563592e-01   +2.664169370158410e-01   +4.489240650602811e-01   +4.791986543461187e-01   +6.546504060895899e-01   +6.493446823374347e-01   +6.419498560816963e-01; +4.264326763523490e-01   +9.002670293022227e-01   +2.616339590223222e-01   +7.582090376022255e-01   +4.865885981679958e-01   +4.213262913789539e-01   +3.256918519165124e-02   +2.256142176092729e-01   +4.295900140966902e-01   +5.611133699240777e-01   +3.786227582925158e-01   +3.035743575774619e-01   +5.240266932032707e-01   +3.573540946763816e-01   +9.756566601550426e-02   +9.626845804537271e-02; +4.663893472880570e-01   +6.090251784677908e-01   +1.570765506290176e-01   +1.961619522372013e-01   +5.904777687774604e-01   +3.204953160272819e-01   +5.799555179260408e-01   +7.507690416044515e-01   +4.485228723946393e-01   +6.841282910357337e-02   +7.467227001318605e-03   +7.048673515766855e-02   +2.757579599832340e-01   +7.616166138150000e-01   +3.139627236305302e-01   +5.151415385464426e-01; +6.555326270569838e-01   +1.046217458515564e-01   +4.093514646252583e-01   +2.824244669947060e-01   +7.844115388767148e-01   +3.306891167539025e-01   -9.177279661722583e-02   +4.113901413564897e-01   +2.129906675801971e-01   +2.290589481654530e-01   +5.902825120625690e-02   +3.190585432452121e-01   +6.207211392968240e-01   +1.124387613846299e-01   +4.392266016368110e-02   +1.829809571485494e-01; +7.299159804390344e-02   +7.153597855979739e-01   +2.509967662382582e-01   +2.147078686240054e-01   +1.400603128719959e-01   +5.875310021989418e-01   +4.942139621904175e-01   +6.897795424082747e-01   +4.956265874181207e-01   +6.541524229439108e-01   +6.346940321665232e-01   +7.085329797898486e-01   +2.605468027381304e-01   +2.417757768986000e-01   +2.740202902609026e-01   +5.885367685032938e-01; +3.820467043045547e-01   +3.076322848980974e-01   +3.803104312751910e-01   +9.361790391054980e-01   +6.801941180478512e-01   +1.288188496901680e-01   +3.317182013370221e-01   +8.397149529825609e-01   +4.207480893282020e-01   +3.704488582283773e-01   +4.243319743674017e-01   +3.238207301899639e-01   +6.490707885407084e-01   +2.707765459585054e-01   +3.136701116983805e-01   +4.359394427038951e-01; -5.927585660157063e-02   +3.871535607296655e-01   -7.246637466054556e-02   +1.578175169246238e-01   +1.951680079842504e-01   +4.367125669630559e-01   +7.591839885224770e-01   +4.185814171709291e-01   +2.982600415088884e-01   +5.085861130515235e-03   +1.848992673740256e-01   +1.027799413135505e-01   +6.007228427310248e-01   +1.387159653406826e-01   +3.533453959335449e-02   +2.112679963150008e-01; +7.906486906339676e-01   +8.813790564123695e-01   +3.395575881143226e-01   +6.916094150601364e-01   +1.862825704898526e-01   +6.227058014723617e-01   +5.150804439157030e-01   +3.731119714250082e-01   +3.521620955581415e-01   +4.521437637739556e-01   +5.392153645497644e-01   +4.695877769528713e-01   +2.971618115396183e-01   +1.913548264373684e-01   +5.863415187260170e-01   +6.851134864009625e-01; +2.349562834157710e-01   +9.406353367149520e-02   +5.555438415131588e-01   +3.367630512193197e-01   +1.056510550387269e-01   +2.898446020825961e-01   +3.518415758302151e-01   +5.585278929953468e-01   +2.740774343625089e-01   +7.996583923189778e-01   +4.245916951287025e-01   +3.225706996585744e-01   +3.624941203245478e-01   +3.502039967755233e-01   +1.108310218254410e-01   +2.155435492946682e-01; +4.687309897215613e-01   +4.339463109151764e-01   -7.125474913210258e-02   +8.584099728495321e-01   +3.839337674672059e-01   +7.879314343388958e-01   +1.468431735100417e-01   +8.631912259549082e-01   +4.463337101299609e-01   +8.417803617494437e-01   +6.770733235209376e-01   +5.927842270723167e-01   +5.511939213078362e-01   +2.166764879938073e-01   +7.012357377156486e-01   +4.562249689036663e-01; +1.547126420210057e-01   +7.322542495802199e-01   +5.794272936734888e-01   -7.608557331650352e-02   -5.019318917738221e-02   +3.645494690702068e-01   +7.042700091006873e-01   +8.381808916259077e-01   +2.935280413247871e-01   +2.489829597216642e-01   -6.323934358909834e-02   +2.955273817493144e-01   +6.023272232590553e-01   +5.182575640460584e-01   +4.570771001861365e-01   +2.135726899039931e-01; +3.866932291119800e-01   +8.429477533028423e-01   +6.196208488408351e-01   +3.852734214759915e-04   +8.259988804095092e-03   +5.158091733943796e-01   +5.323743158039755e-01   +6.372717765808454e-01   +3.225569709721239e-01   +2.697872909860956e-01   +1.413730435296227e-01   +4.042616221506627e-01   +4.502548530423072e-01   +5.100538429324576e-01   -1.077078967227793e-01   +2.899242500770683e-01; +6.300744511975446e-01   +3.920788641535394e-01   +5.736937119505148e-01   +4.215310314479441e-01   +1.428203621729455e-01   +2.590936282280505e-01   +8.213324818208099e-01   +1.536422372848751e-02   +8.147937536210775e-01   +9.326536685185172e-01   +3.751474380550942e-01   +6.077660459470509e-01   +3.951042137369659e-02   +5.245215634827214e-01   +4.770678432781062e-01   +5.472524433803791e-01; +5.123702146642555e-01   +2.405156664343714e-01   +8.008543712999458e-02   +2.507671116592093e-01   +4.219350200638751e-01   +3.932575510532398e-01   +8.103490883737130e-04   +8.502425521551933e-02   +1.358504216941445e-01   +7.589464832788261e-01   +1.895330392109743e-01   +3.338096316935664e-01   +5.328688726890656e-01   +7.467829793968289e-01   -1.333989876477996e-01   +6.846407268521240e-01; +2.974679190146439e-01   -5.588436026236418e-02   +3.701187421112445e-01   +1.636905712679926e-01   +4.488774675444936e-01   +7.826394162888559e-01   +3.041473890720756e-01   +1.638388718383663e-02   +2.057800160961222e-01   +4.856077304443128e-01   +1.599880619755350e-01   +4.810218032616191e-01   +2.892458221568986e-02   +6.361396862669970e-01   +4.785577239176597e-01   +2.585986949186149e-01];
L2I_L1I_iGABA_netcon = [+3.089656560621765e-01   +1.344461934183022e-01   +3.736162113057214e-01   +3.686950752585309e-01   +1.222341351164764e-01   +6.818822262025193e-01   +2.150125218782411e-01   +6.023391524062236e-01; +5.268954658943817e-01   +2.315092005763949e-01   +4.625122196424959e-01   -4.428569284518977e-02   +8.495858125529567e-01   +6.502999249177412e-01   +5.424704905781181e-01   +4.867660224536454e-01; +4.090720445465109e-01   +5.466828436714876e-01   +3.838302073629893e-01   +2.505964873809162e-01   +2.999515373127050e-01   -4.459172547906391e-02   +5.416560679471332e-01   +2.520695189581226e-01; +3.964769119933567e-02   +4.714528338966923e-01   +1.181500556051030e-01   +3.420448270140096e-01   +3.097141639696662e-01   +5.546779292314676e-01   +7.962677154939212e-01   +9.671292030343823e-01; +6.977905313254401e-02   -3.923766466944962e-02   +6.018186510724683e-01   -1.347037802004462e-01   +1.782936004042236e-01   +5.122647037493993e-01   +7.545822181099722e-01   +5.545168239887674e-01; +1.752351982620171e-01   +4.785201691107910e-01   +8.036002730388723e-01   +6.180502466993928e-01   +3.764146508047450e-01   +6.303350090099413e-01   +4.121772571236430e-01   +4.199018668858693e-01; +9.402152389419030e-01   +3.034304409915692e-01   +1.021545566917189e-01   +3.751205118645468e-01   +1.116220992312346e-01   +8.298005881440302e-01   +1.079627058758228e-01   +6.667517918665675e-01; +1.660404662814295e-01   +7.266099481301129e-01   +1.236339367617990e-01   +7.249191533961645e-01   +4.669483354853589e-01   +4.572230949505572e-01   +6.446738184940534e-01   +3.951687736589065e-01; +3.909464590902675e-03   +3.482451706255796e-01   +6.750625653449411e-01   +8.348207464936592e-01   +7.070020638298850e-01   +3.690834685077645e-01   +3.529216512343138e-02   +6.696765011183692e-01; +6.593011480124014e-01   +3.748343305134091e-01   +1.501818061847168e-01   +2.921868346713782e-01   +6.429120502997194e-01   +7.119701203477876e-01   +2.697977946317849e-01   +4.910602039462245e-01; +2.744485517237581e-02   +3.985982824159298e-01   +5.301673990756238e-01   +9.977647680203044e-02   +5.318848308925689e-01   +3.945386929063431e-01   +6.494797576980178e-01   +1.460639282749623e-01; +2.949610040630884e-01   +5.574840826372308e-01   +5.749510289455134e-01   +3.085445559275874e-01   +5.209445650048707e-01   +1.211237829554451e-01   +6.166876611487218e-01   +5.840251546273488e-01; +5.184917199488079e-01   +3.943031733929644e-01   +4.857635919992512e-01   +4.652624348672793e-01   +3.013950737557925e-01   +6.268773209896548e-01   +2.568177505730647e-01   +3.680169421452460e-02; +4.924334268949800e-01   +6.589985114778741e-01   +4.740353337580540e-01   +2.954635983767930e-01   +1.980679219338512e-01   +4.088120195273577e-01   +5.126984544617037e-01   +3.876696322343818e-01; -1.381431551456340e-01   +4.947488585107443e-01   +2.992097681884541e-01   +2.903392084624107e-01   +3.334131895739995e-01   +2.049630633740196e-01   +8.676461860810915e-01   +6.693320510764771e-01; +7.448936271448880e-01   +2.156971509538333e-02   +3.832846709008341e-01   +6.298730993882553e-01   +6.048455729439628e-01   +6.567350681415164e-01   +3.901017152669273e-01   +7.911520276596986e-01];
L1I_L2I_iGABA_netcon = [+7.545259344565067e-01   +4.152165229114955e-01   +2.675646049972004e-01   +3.160401149614813e-01   +5.485551515648968e-01   +1.154535155029877e-01   +5.469513541455042e-01   +3.103600055820854e-01   +8.238800647301957e-02   +8.229617772213257e-01   +6.175881514300906e-01   +2.649511350006295e-01   -1.221269389294610e-01   +1.398072905764599e-01   +6.986512212691771e-01   -9.424142029817117e-02; +6.278792563188573e-01   +5.899490448291345e-01   +1.636278787209494e-02   +5.666944386325670e-01   +1.261217045983111e-01   +7.809048594939197e-01   +3.170289184952935e-01   +7.580451434714764e-01   +8.301522372409468e-01   +7.166892361254632e-01   +2.895322891734010e-01   +5.322430878324400e-02   +5.016652926400651e-01   +9.282234427093624e-01   +8.769867302440603e-01   +3.190013601034494e-02; +3.465404044287972e-01   +2.792352056527774e-01   +3.484507636507325e-02   -5.593823439335641e-02   +5.121801594485715e-01   +5.024440446596831e-01   +5.626667417384149e-01   +6.494838397576856e-01   +3.967318683248615e-01   +3.497663941471131e-01   -3.167467847451941e-02   +2.731217983654964e-01   +8.082962211311503e-01   +9.503615107761421e-01   +3.148341031635090e-01   +1.596461316054897e-01; +4.222203537299319e-01   +6.836418202800656e-01   +6.105269199747996e-01   +5.180181310397709e-01   +2.293930649211152e-01   +8.505563321837569e-01   +3.248686333825456e-01   +3.829023508264607e-01   +7.306246715534903e-01   +6.048484065566802e-01   +7.935954187565162e-01   +2.364018549917812e-02   +5.749932117696011e-01   +5.340749558440282e-01   +1.459821769267695e-01   +2.890777361030067e-01; +6.716944781057105e-01   +3.711341090555739e-02   +5.159180679437892e-01   +3.592666466778664e-01   +1.691665684058668e-01   +2.918048973179011e-01   +7.556237477668700e-01   +1.458720848401899e-01   +2.248129530200513e-01   +5.265175202996737e-01   +3.822275581526478e-01   +3.488423759901252e-01   +3.918673865853434e-02   +3.581655934444334e-01   +1.659895269335192e-01   +2.329579065551732e-01; +3.561605277212057e-01   -9.406822652592156e-03   +1.559907632781208e-01   +5.066810442688158e-01   +6.849548137824448e-01   +7.609783251553794e-01   +3.558052923307874e-01   +7.618385599720920e-02   +3.980124019650855e-01   +4.642675176606124e-01   +4.714914584158146e-02   +6.612257537570559e-01   +3.224047011304906e-01   +5.404382964179900e-01   +7.638505403199358e-01   -2.288575369709223e-03; +6.238211248876828e-01   +9.296318906206609e-01   +1.447547376373040e-01   -1.022351280400599e-01   +3.889980425974063e-01   +6.044023549053216e-01   +1.032518492190321e-01   +2.728352903523143e-02   +5.793455925814319e-01   +2.522118483977012e-01   +5.321573545743703e-01   +4.245313621584193e-01   -1.119291608296460e-01   +4.811589164663982e-01   +2.406395564069021e-01   +8.519781656535158e-01; +8.285127406122775e-01   +3.271465042116654e-01   +4.832306669693191e-02   +4.195574193216055e-01   +7.393431136597295e-01   +4.152758120190776e-01   +4.129200511488369e-01   +1.848402317684205e-01   +7.680919783094450e-01   +3.850273257862537e-01   +5.535830713697150e-02   +5.129441457307712e-01   +6.779370122446327e-01   +5.436148924344955e-01   +7.061831140586048e-01   +1.212693323812702e-01];
L2E_L1E_iAMPA_netcon = [-1.117204068730215e-02   +6.333281336785529e-01   +4.046662599332633e-01   +4.001799031144714e-01   +5.749577612061668e-02   +6.328736079306241e-01   +1.312567717750140e-01   -5.438846554295235e-02; -5.534138250234744e-03   +1.421148382127882e-01   +3.291594211571477e-02   +6.507158496326522e-01   +5.845457561623097e-01   +6.064826819946529e-01   +7.755479415550979e-01   +8.234568772254331e-01; +1.707450238841861e-01   +1.231257615429783e-01   +7.659158577208680e-01   +4.304207839976426e-01   +1.656699730751294e-01   +6.561588569908028e-01   +7.544398217580447e-01   +2.442079347668807e-01; +2.527598344246386e-01   +5.980677807818726e-01   +2.034826656012897e-01   +3.517477511954260e-01   +7.609637361875746e-01   +3.692915921084128e-01   +4.141041585026513e-01   +7.535999728758965e-03; +7.792286543289055e-01   +4.376115897571151e-01   +5.386645958422525e-01   +6.357161754001743e-01   +1.332630693834507e-01   +3.921103206485508e-02   +4.041430083293743e-02   +7.593993222208868e-01; +9.113639452302802e-01   +5.645905883954581e-01   +3.754936837143882e-01   +2.315023615298890e-01   +6.373057705188656e-01   +6.160203408556532e-01   +4.954194360297061e-01   +6.759768336363475e-01; +2.472419112303483e-01   +4.210070248060108e-01   +2.093000778781537e-01   +4.572686114307232e-01   +2.562495675452691e-01   +5.637879517400366e-01   +8.029498289190432e-01   -1.034613493230993e-01; +5.234894132882772e-01   +9.145336134345056e-02   +3.512856936643185e-01   +7.644042468974905e-01   +3.897428111528544e-01   +2.066137354739452e-01   +5.994415345471977e-01   +3.204135665514325e-01; +7.684697073071478e-01   +1.436877296411159e-01   +7.141702445823572e-01   +3.576333526551890e-01   +4.591806160326092e-01   +5.492565522657386e-01   +6.903023270823615e-01   +3.672640311260951e-01; +5.941945004881630e-01   +6.398816548775736e-01   +6.112890689368912e-01   -8.518836602002196e-02   +7.561718747352576e-01   +2.622244819729563e-01   +5.832181436374206e-01   +4.343716397480464e-01; +1.187927634306948e-01   +4.575080545777306e-01   -4.527937172639032e-02   +1.877663423582656e-01   +8.855960543574763e-01   +8.275346264820977e-01   +2.140169422117267e-01   +2.801844814818580e-01; +4.695034466534915e-01   +3.325856526013835e-02   +1.259366291929091e-01   +2.296023228671908e-01   +3.348554248816383e-01   +3.053953351787768e-01   +6.781368536249366e-01   +3.701236840922452e-01; +7.297627411407589e-01   +6.950173654585501e-02   +6.344755966361147e-01   +1.870284732623531e-01   +8.306501337111454e-01   +3.011534233948029e-01   +5.126155095585785e-01   +4.153432386896896e-01; +6.411144241159479e-01   +7.708329388405766e-01   +1.912604595269741e-01   +3.970208723932255e-01   +4.516716878856490e-01   +5.614773834994294e-01   +8.332628860244671e-01   +1.498354995628950e-01; +6.558888679261224e-02   +6.305775490559070e-01   +2.400424649353859e-01   +6.182687371782486e-02   +2.815719440802688e-01   +8.361472771292260e-01   +1.491022657213893e-01   +4.196408953298986e-01; +2.723498184111872e-01   +7.020115679315329e-01   +6.230794598203051e-01   +4.800749941457426e-01   +4.631500762306859e-01   +6.005037363810288e-01   +4.642115461100640e-01   +2.471965401750760e-01];
L1E_L2E_iAMPA_netcon = [+3.314091699432377e-01   +6.216520843510613e-01   +4.433775904077136e-01   +1.590008576142909e-01   +1.494540452836854e-01   +4.559609684068103e-01   +1.418908462289282e-01   +7.014361950776317e-01   +1.388363969542558e-01   +5.833854983117814e-01   +2.026310540903206e-01   +2.964749914708190e-01   +1.889873737729427e-01   +2.049112819854958e-01   +7.419263025068793e-01   +2.933315171197721e-01; +5.081917044439848e-01   +8.330206963955684e-01   +6.225504913373068e-01   +6.899735051526248e-01   +4.885961156196802e-01   +6.625465563147376e-01   +3.237903170742372e-01   +1.105755427664220e-01   +9.943955209579651e-02   +1.361895962278032e-01   +6.465377530107457e-01   +4.438305621404124e-01   +3.253929121894789e-03   +9.444995742700643e-02   +8.047537666843115e-01   +4.803164704041619e-01; +3.258902519892840e-01   +8.626958289525872e-01   +2.801873089845017e-02   +2.293400311183975e-01   +4.219063807844896e-01   +8.416172023734301e-01   -1.083892786036962e-01   +6.512663418997113e-01   +3.029581531982147e-01   +8.211364200549712e-01   +6.740030754514601e-01   +2.496178787008180e-01   +2.397472504662637e-01   +8.088911407990370e-01   +7.062433503494683e-01   +6.962832920529817e-01; +7.435462493902865e-01   +2.048605637535045e-01   +5.976169849706354e-01   +1.457154771334946e-01   +5.905387377111984e-01   +2.732376411239489e-01   +8.314595316829493e-01   +5.174840056967041e-01   +4.764765323210122e-01   +7.437537642983805e-01   +3.860945549290749e-01   +2.636771234264577e-01   +8.689328144526152e-01   +5.440245581886376e-01   +6.442917939500161e-01   +1.815239696431782e-01; +3.503361868945491e-01   +2.554438104175080e-01   +3.857084620752655e-01   +8.735612144843229e-01   +1.770732343722541e-01   +4.538221357294773e-01   +5.242847243293861e-01   +8.334091583355316e-01   +4.265012794417653e-01   +4.253057443085611e-01   -7.989553067417661e-02   +5.455345107976787e-01   +7.641422028756262e-01   +1.225111470738282e-01   +8.085264640847909e-01   +9.333051368073233e-01; +5.803522480136674e-01   +7.149296533098748e-01   +1.974985454971114e-01   +8.326514891368473e-01   -1.382512411782456e-01   +2.060337500269118e-01   +2.579350200967727e-01   +6.339947634920856e-01   +5.936198691501124e-01   +4.774891433836442e-01   -4.028784553222778e-02   +1.151955148700013e-01   +1.266527988109611e-01   +5.099307660094148e-01   +5.014504836215339e-01   +1.364170507704012e-01; +6.212532218761823e-01   +2.814556549885899e-01   +3.192016741228270e-01   +9.497922464082709e-03   +6.345085381136770e-01   +5.804277579911825e-01   +4.728080263153053e-01   +2.009624714379022e-01   -6.792587692275966e-02   -4.641586204776816e-02   +9.582848228993193e-01   +2.693089419481733e-01   -1.514914577510360e-01   +1.868637230572888e-01   +2.399994400323181e-01   +1.655290108125939e-01; +3.851590542549016e-02   +4.714518385001034e-01   +3.136602935092832e-01   +5.565488935755523e-01   +1.279065661283379e-01   +7.330617221286552e-01   +6.285823081585451e-01   -3.802927640431225e-02   +5.414111809020705e-01   +5.341377022034580e-01   +5.014344764650451e-01   +4.364741184898216e-02   +8.313927092496909e-01   +4.604871084645507e-01   +6.041867272639891e-01   +6.347890984931025e-01];
L2I_L2E_iAMPA_netcon = [+9.178553132918325e-01   +4.637530706525386e-01   +5.605745540612304e-01   +6.912812375172236e-01   +6.782218288125956e-01   +1.569857801852900e-01   +2.868465932280222e-01   +6.019544947817090e-02; +8.822731792213823e-01   +5.792024964680498e-02   +1.165051398492497e-01   +6.633765666427637e-01   +8.277794282379970e-01   +1.688985685373095e-01   +6.429929132902886e-01   +2.754056101113856e-01; +7.853736422813115e-01   +1.277046248138194e-03   -5.376428158399824e-02   +5.578736419227233e-01   +6.901522236341484e-01   +5.463829455253395e-01   +6.367671648817651e-01   +7.205417039603703e-01; +4.613613374727245e-01   +6.082157857811671e-01   -6.067353128880029e-02   +5.260513316803326e-01   +7.487620722009408e-01   +8.061473779210919e-01   +1.623469663204757e-05   +6.180363073515280e-02; +3.076540738859568e-01   +3.071991344500771e-01   +4.527537731644440e-01   +2.110161302393441e-01   +6.325671270491290e-01   +4.900311062653015e-01   +5.294214699869794e-01   +4.484842697760060e-01; +3.618753003367851e-01   +5.173957144556387e-01   +2.004699741178129e-01   +2.227277428575136e-01   +4.688069190914034e-01   +7.137225441390045e-01   +5.690458757010228e-01   +3.025229172720556e-01; +4.316095828574493e-03   +3.490487557486858e-01   +6.681786533047163e-01   +3.858812353021955e-01   +4.483707688134513e-01   +4.732312470232799e-01   +6.701674047215055e-01   +2.742533425813591e-01; +6.313861312823370e-01   +9.216919121071327e-01   +5.901635003788963e-01   +4.481201744671673e-01   +1.053061736393992e-01   +1.826191341624683e-01   +3.509495910123099e-01   +6.394303965379824e-01];
L2E_L2I_iGABA_netcon = [+7.162447402902137e-01   +4.222499478639382e-01   +6.198714722185046e-01   +7.895735904000216e-01   +2.309403488773785e-01   +9.010662826522092e-01   +5.958411373205319e-01   +3.052930883934338e-01; +7.485955735546046e-01   +7.248149657186164e-01   +7.763706595101697e-01   +2.159014816163908e-01   +5.458694579102329e-01   +3.816088011925833e-01   +4.114596284411641e-01   -1.510662100902457e-02; +8.256508583111081e-01   +2.985716351046301e-01   +4.947379026906198e-01   +6.008121419456767e-01   +4.066462809380540e-01   +2.127839756820547e-01   +7.095505152362391e-01   +3.788952131318303e-01; -1.406355474662634e-01   +6.959219701537088e-01   +5.273085838074747e-01   +2.174411733992546e-01   +6.703038411054590e-01   +6.604602372210167e-02   +5.776496339477830e-01   +4.022938276800949e-01; +6.106434658434539e-01   +2.465977587105364e-01   +6.929604810924570e-01   +6.317783147586377e-01   +1.732405504260268e-01   +6.129267383166107e-01   +3.279062895601675e-01   +4.925786755321216e-01; -9.305865299435276e-02   -7.967255187171378e-02   +4.110025146489019e-01   +3.140392925426719e-01   +5.867355539943628e-01   +8.204854224708175e-01   +6.841272825285669e-01   +3.521673254803838e-01; +8.341463961865379e-01   -3.029509881249443e-02   +4.406876883504527e-01   +2.415795148857521e-01   +6.553289305190768e-01   +1.390485825395858e-02   +8.452147980010699e-01   +6.408984871516826e-02; +4.258419816899835e-02   -4.362575411061285e-02   +3.887948820606584e-01   +3.448792389597233e-01   +3.183402792988832e-01   +5.049552829293635e-01   -1.370254216957553e-01   +6.760453103413088e-01];
L3E_L2E_iAMPA_netcon = [+5.940975405593494e-01   +5.896547455393100e-01   +7.783993763406272e-01   +3.145178789359481e-01   +8.821002116894883e-01   +5.654718936826407e-01   +6.588584365410587e-01   +2.116342993754020e-01   +2.669617223539384e-01   +1.329390534376424e-01   +4.406375923187877e-01   +7.171660990997558e-01; -4.255371228009538e-02   +6.446021243236232e-01   +1.624417801676620e-02   +5.041121393967648e-01   +3.975498693908771e-01   +1.422400394342405e-01   +8.951185529289676e-01   -5.668103264737924e-02   +2.083388833238498e-01   +3.003181369830831e-01   +3.135939160930057e-01   +6.438969200810235e-01; +1.443881114909230e-01   -1.072263261732584e-01   +2.438426547915741e-01   +1.182456358570621e-01   +7.056973712463310e-02   +9.461471068223624e-02   +7.642463507037086e-01   +3.866345632442876e-01   +2.504480198032947e-01   +6.303399913142896e-01   +8.536152112793660e-01   +2.076833131244637e-01; +4.811126518066192e-01   +3.139236769694650e-01   +4.030281000198306e-01   +3.604099463556812e-01   +5.042296851695098e-01   +2.961179338053932e-01   +5.906539427289539e-01   +7.248179595389822e-01   +4.598123854701817e-01   +6.181443079091773e-01   +4.451932999398986e-01   +6.912438091021130e-01; +5.588236042132095e-01   +5.058909585262632e-01   +4.455877449012310e-01   +5.482909087944297e-01   +2.553971085948021e-01   +4.757668612721353e-01   -1.332776566668111e-01   -3.520429839532793e-02   +3.338280844062703e-02   +3.930200465093445e-01   +4.385334851490769e-01   +7.938160566342090e-01; +1.562248047367525e-01   +4.868690206736500e-01   +1.882943216695800e-01   +8.619071355817158e-01   +4.196317215461637e-01   +2.576140678235697e-01   +3.061802208148185e-01   +4.707733827619246e-01   +7.277968617307988e-01   +4.712636021629525e-01   +5.622383974862593e-01   +2.253148521648343e-01; +2.984413224781554e-01   +7.044589101928538e-01   +7.441163244529488e-01   +4.575405526580575e-03   +4.870996597245876e-01   -9.165802324614074e-02   +2.032181349759983e-01   +6.109146291853627e-01   +3.352086472193050e-01   +1.567568794431581e-01   +1.578351667583729e-01   +8.906009052780745e-02; +5.891781609316582e-01   +4.397654704337672e-01   +3.446367359716949e-01   +4.493376663773663e-01   +4.582077147412978e-01   +7.230734279503375e-01   +6.840258500484819e-01   +3.385042211244478e-01   +5.776464915100741e-01   +7.493187027352379e-01   +2.388461124072944e-01   +6.367653343844092e-01];
L3I_L2I_iGABA_netcon = [+2.534079884516590e-01   +5.935999383722845e-01   +8.466779423421874e-01   +2.740625360008258e-02   +6.117243617086541e-01   +7.692737380178677e-02   +3.982983414011091e-01   +2.524707613376136e-02   -2.488234786257870e-02   +1.818171105056526e-01   -7.903878061159442e-03   +6.911910523538776e-01; +5.163301814261851e-01   +2.212860373860528e-01   +1.803529616355374e-01   +1.671422503825793e-01   +1.811609786592966e-01   +6.537247031379675e-01   +6.809722753063858e-01   -6.720033376859347e-02   +4.738085794839376e-01   +7.456641984423833e-01   +4.372371188726454e-01   +3.703442820694865e-01; -1.479810661976085e-02   +3.632222961969425e-01   +1.577519045165395e-01   +9.067985977913605e-02   +6.809903213786266e-01   -6.577607012015174e-02   +5.859531654160562e-01   +5.819300645616486e-01   +1.027899052261371e-01   +3.763808728533367e-01   +4.206526769745624e-01   +7.427641352173326e-01; +3.752441266769710e-01   +4.889400349754428e-01   +6.444185230452474e-01   +4.637891401695444e-01   +3.218900421151300e-01   +6.966042883400055e-01   +2.715148482409397e-01   +1.830120164154206e-01   +5.665040068296292e-01   +4.684709343303173e-02   +4.832861450875534e-01   +1.041448205321643e-01; +1.469368910776202e-01   +7.356504313891072e-01   +3.154422208484357e-01   +6.866926062670901e-01   +5.463010461287107e-01   +4.183471029355182e-01   +5.756959511449267e-01   +2.095160436864050e-01   +6.940291614336626e-01   +1.431588935980450e-01   +2.080589639992241e-01   +1.243546374770448e-01; +1.053734266611950e-01   +2.972570582456015e-01   +6.911336742887764e-01   +1.808269569256932e-01   +1.854955765549522e-01   +1.753247892937985e-01   +3.950011304984848e-01   +5.274093933944146e-01   +4.936659344808182e-01   +1.735515948589472e-01   +4.839307453258129e-01   +2.472104581095434e-01; +6.017242268454015e-01   +1.566415895782752e-01   +3.909171329898084e-01   +6.336461236514531e-01   +6.080183453146261e-01   +2.002076242826479e-01   +8.775944615775215e-01   +5.676183568944624e-01   +1.646254619613123e-01   +5.445776838077794e-01   +4.819734491340933e-01   +1.593412211047840e-01; +3.859340774238807e-01   +7.226446014384438e-01   -2.995196495128123e-02   +3.928442228777652e-01   +1.992140237943662e-01   -5.890349873918441e-02   +1.670185119431126e-01   +4.403247417957900e-01   +2.370107676768671e-01   -1.080611556633737e-01   +2.840044196763311e-01   +3.070683850359378e-01];
L2E_L3E_iAMPA_netcon = [+5.480772569908209e-01   +1.827066818302505e-01   +8.314170450007722e-01   +3.098829047456453e-02   +3.362097936609691e-01   +2.859787825824949e-01   +8.551135411885852e-02   +1.454071450302573e-01; -8.966415828494573e-02   +4.946010624296895e-01   +8.246812400086121e-01   +3.567106758345598e-01   +9.584074430299743e-01   +4.422359040042612e-01   +2.568073449159449e-01   +7.194703583069987e-01; +6.637025162122232e-01   +5.494692357957894e-01   +3.478635537645229e-01   +2.325210278733895e-02   -2.042438097921120e-02   +9.259236414626948e-01   +4.403564500985995e-01   +6.672909483831955e-01; +2.865580390475092e-01   +5.791543697280789e-01   +4.047606833275657e-01   +6.894129305877923e-01   +2.611859348328169e-01   +2.323850074430873e-01   +6.667941915726487e-01   +6.740640190713563e-01; +3.995504671372520e-01   +4.164668337674665e-01   -3.940439242136365e-02   +1.365166914039813e-01   +3.820088714337819e-01   +3.367139441778980e-01   +4.685179957247157e-01   +6.054929455634128e-01; +4.303967733491358e-01   +6.200573237892576e-01   +4.238907581391365e-01   +1.422580861278160e-01   +4.274960619104909e-01   -3.130672649837130e-02   +7.448684529358672e-01   +2.204908593231164e-01; +5.372418653847504e-01   +4.714012427548782e-01   +4.043224376704122e-01   +4.156888517494680e-01   +1.687693208704398e-01   +6.944396749178516e-01   +5.691320695006062e-01   +1.388223118028194e-01; +3.591903995115916e-01   +3.315082210797077e-01   +1.877918587147481e-01   +1.978230652666290e-01   +3.083894878284888e-01   +2.967165321514277e-01   +4.660155059101762e-01   +2.397177987354336e-01; +5.001955972870028e-01   +6.140664563941254e-01   +6.789145561160975e-01   +6.952590114960573e-01   +5.176422636671578e-01   +5.290087282814129e-01   +9.310430810305534e-01   -1.664891350725688e-02; +5.387673843723166e-01   +6.933848646682979e-01   +4.045333014942994e-01   +4.442374878700590e-01   +4.448257114958096e-01   +2.032952946234857e-01   -1.214222233822321e-02   -8.643083485927713e-02; +5.066542099176303e-01   +5.101536038909089e-01   +9.222817888621787e-02   +3.233108481223066e-01   +5.044154654073499e-02   +5.365134009304013e-01   +4.594736698220998e-01   +6.252001194633118e-01; +5.019364011874992e-01   +8.172179775574303e-01   +4.508037187518631e-01   +1.515663274172380e-01   +3.897927818863636e-01   +4.939111885668194e-01   +6.517326476889498e-01   -7.052363996655839e-02];
L2I_L3I_iGABA_netcon = [+4.607965805742834e-02   +3.208584235376886e-01   +2.457515881911975e-01   +5.868464059626054e-01   +1.089355116536883e-01   +2.883539949971639e-01   +5.820918258112888e-01   -1.478986213412589e-01; +7.956602859956984e-01   +5.822408994442769e-01   +3.217049445274776e-01   +1.511426693736857e-01   +5.699582128399925e-01   +2.044309662878543e-01   -3.315672661572007e-02   +4.124274847467508e-01; +4.539229276021765e-01   +2.842959857002482e-01   +2.300281850122040e-01   +2.489069597183598e-01   +3.928489838076383e-01   +7.841086327749124e-01   +4.464932571017020e-01   +6.275311621169689e-01; +1.552160322767807e-01   +6.025813025083946e-01   +6.139632899758390e-01   +6.598507615653540e-01   -1.663905442910735e-02   +3.437882200903958e-01   +4.561132595804496e-01   +5.993307508035848e-01; +2.325876337935677e-01   +3.020099738278513e-01   +2.121211509854970e-01   +1.006296833578286e-01   +3.669055609789681e-01   +5.954866849055132e-01   -1.443022293258456e-02   +4.588699099655981e-02; -2.149697607590567e-02   +4.928680784884674e-01   +6.454591032431174e-01   +1.409218780051081e-01   +1.524443576999449e-01   +3.837224798044414e-01   +1.562760140511181e-01   +5.091535149500656e-01; +2.744573126570783e-01   +3.699995306877688e-01   +6.558843605837610e-01   +4.818321249785749e-01   +2.518609289583276e-01   +3.001927282100073e-01   +5.715401690201812e-01   +1.478956435007239e-01; +4.041988174154024e-01   +7.564015658806372e-02   +2.765903438762551e-01   +5.001901755077568e-01   +1.936536457025787e-02   +2.603651536134500e-01   +2.874967718175131e-01   +2.856200226823185e-01; +4.038119181487889e-01   -2.712015469563403e-02   +3.805222411931805e-01   +1.981517175655024e-01   +1.696636730520928e-01   -5.493663807918722e-02   -8.872415103997628e-03   +5.273748171483189e-01; +6.718149500219828e-01   -6.010985263006342e-02   +8.904396403071153e-01   +2.490330226883302e-01   +3.592052343942678e-01   +7.165036997535034e-01   +9.088809418333720e-01   +4.347818701244097e-01; +5.225311059021966e-01   +1.397326532293639e-01   +4.971481398033586e-01   +5.447148326798916e-02   +3.248521323894661e-01   +3.852985988447117e-01   -8.401107376993691e-02   +1.757922319691545e-01; +5.685151723207882e-01   +3.074030306621429e-01   -3.104606120656689e-03   +1.822456876795923e-01   +5.025328766635671e-01   +4.876402132215140e-01   +7.943931433561785e-01   +5.306147809368333e-01];
L3I_L3E_iAMPA_netcon = [+3.394054280972172e-01   +5.689622913547988e-01   +4.503767090141709e-01   +6.040031129762951e-01   +6.294998406428177e-01   +1.246143327366859e-01   +5.792250763331760e-01   +7.145920536100201e-01   +2.152677220070199e-01   +9.909651720950192e-02   +4.787702157546541e-01   +4.593149882150519e-01; +5.262453094250568e-01   +7.372450047244021e-02   +1.789631346359684e-01   +6.521663219795009e-01   +6.839973613521902e-01   +1.776862569608154e-01   +1.500033341674466e-01   +2.572913148295707e-01   +5.247620178060292e-01   +2.590673416945496e-01   +6.614273779416893e-01   +6.498907166853766e-01; +5.153336930400992e-01   +4.709158982468434e-01   +2.071503030371933e-01   +3.858873608323564e-01   +8.096268897476727e-02   +8.718991673800033e-01   +6.893689746834166e-01   +4.191941827604095e-01   +5.814893619423035e-02   -7.989503186417002e-03   +2.856945178757311e-01   +6.763411867109420e-02; +3.204648705948605e-01   +4.046429573589585e-01   +8.396220147019406e-01   +3.077079509556434e-01   +1.975153645349446e-01   +2.037770991494532e-01   +5.320172364101216e-01   +4.380068624780212e-01   +7.035013322431419e-01   +7.268019785922127e-01   +2.358593160591408e-01   +1.591467965539773e-01; +3.664432023445412e-01   +5.700872944579588e-01   +2.634963408835488e-01   +3.651757871777833e-01   +4.182537424203749e-01   +6.215556838539100e-01   +5.846281692196947e-01   +5.003359201841990e-01   +5.002610424987616e-01   +3.263467803341206e-01   +3.052378716853360e-01   +2.556340053245939e-01; +1.912451133477759e-01   +4.893584129085982e-01   +8.127270147333150e-01   +4.780034966819357e-01   +3.848078614533132e-01   +3.906513228539147e-01   +4.591281522078317e-01   +2.854651921928234e-01   -5.878006087803145e-03   +2.262500247674685e-01   +2.163078310703979e-01   +8.393110864806884e-02; +4.506495479519047e-01   +4.327376464820671e-01   +2.085166812198638e-01   +3.949945814654749e-01   +7.962261017090385e-01   +6.337167570049270e-01   +3.993251583764339e-01   +1.391202333259957e-01   +8.138819744494499e-01   +2.130324039805250e-01   +5.237784761792325e-02   +6.217380735414468e-01; +1.936312029333740e-01   +1.121498042529388e-01   +7.123121386918688e-01   +5.204254340878552e-01   +4.322806895536720e-01   +6.383517754126607e-01   +2.849291283533050e-01   +5.795497435845343e-02   +6.323410498926437e-01   +7.993366293582118e-01   +2.447918650844051e-01   +3.573730965447223e-01; +3.838996504137547e-01   +4.875124222576004e-01   +4.987245194900836e-02   +4.115380793016735e-01   +5.969042455517422e-01   +3.087928791671135e-01   +8.645289551333856e-01   +1.811687688104582e-01   +2.637543192218900e-01   +3.755533340228864e-01   -1.330695204008848e-01   +5.313337472711291e-01; +2.523298341825775e-01   +5.587168165827386e-02   -5.061047933813165e-02   +4.439293929796265e-02   +2.102556912275660e-01   +2.122843116648438e-01   +3.241306873395220e-01   +7.633969523858025e-02   +7.866368162219933e-02   +7.020871635749371e-01   +4.860518954012823e-01   +7.150327282310256e-02; +5.966421130277714e-01   +5.660669054482069e-01   +1.393515298156602e-01   +6.765813155076680e-01   -6.105043884144725e-02   +4.087336853546480e-01   +4.356884548560430e-01   +8.070048467220671e-01   +2.883867118533671e-01   +3.207666783901888e-01   +1.579983824815193e-02   +5.037113634256913e-01; +1.688235041368939e-02   +1.491140317789171e-01   +1.280816306616430e-01   +3.816680259270748e-02   +2.312618424354654e-01   +4.879002578212723e-01   +4.265232062598760e-01   +4.738578595529552e-01   +3.144712087484315e-01   +1.800769440655223e-02   +5.103926267864971e-01   +2.088811478864860e-01];
L3E_L3I_iGABA_netcon = [+3.365952735328208e-01   +2.901192514422760e-01   +2.868060060907072e-01   +3.669115023630685e-01   +8.771299886024467e-02   +1.495978738771582e-01   +4.881599952036984e-01   +8.224205723410889e-02   +9.044717757721232e-02   +9.068129627026633e-01   +7.042960012211245e-01   +5.025625446869153e-01; +2.028375957194072e-01   +3.824041390234832e-01   +2.406728025290901e-01   +1.412371907044704e-02   +5.507950659319446e-01   +7.698829603121774e-01   +6.013623303680398e-01   +4.910765166486704e-01   +6.365118836472152e-01   +2.935635835817315e-01   +6.842077518575758e-01   +4.282393184993876e-01; +2.013739622702942e-01   +4.460562054820479e-01   +7.623590796872339e-01   +5.239326918234414e-01   +7.427863463034882e-01   +3.527065657239731e-01   +8.496608460905965e-02   +6.463102765775223e-01   +6.039903281573790e-01   +8.669765059319967e-01   +1.525120343342386e-01   +1.323524399372213e-01; +7.049425061106590e-01   +5.908697819900042e-01   +7.622929240881794e-01   +4.616162384626230e-01   +7.556873722891517e-01   +8.384133864129401e-01   +5.788841771880632e-01   +5.480511798707577e-01   +5.643309229280014e-01   +3.025740483256185e-01   +6.592533059968828e-01   +2.891597661575538e-01; +1.102913394817244e-01   +5.943550165016492e-01   +7.387465095489379e-01   +3.253735645931803e-01   +1.795182973936860e-01   +7.032071442525893e-01   +1.351925636245025e-01   +6.819816534808145e-01   +2.019864655006952e-01   +5.356703356494456e-01   +7.418363867247215e-01   +2.239247279827321e-01; +3.282864752991791e-01   +1.029886895932154e-01   +8.106130387864989e-01   +6.667274047649703e-01   +5.721372256128759e-01   +1.418716914656352e-02   +3.831818305545316e-02   +5.854118237273983e-01   +5.060416354341958e-01   +5.324574644349274e-02   +6.686978757906906e-02   +2.239867854746647e-01; +8.116138702627117e-01   +2.507781300962343e-01   +7.845624346726962e-01   +7.395550486327798e-02   +5.398603639414825e-01   +6.073010147658618e-02   +6.308492265717335e-01   +3.136421635573468e-01   +6.668740003131259e-02   +4.389746509802286e-01   +4.338393370102649e-01   +4.450342232596159e-01; +5.733683461303603e-01   +9.519199822088809e-02   +3.572743464781541e-01   +1.641829607768663e-01   +2.033327662083425e-01   +8.470982275290185e-01   +2.549466209677203e-01   +5.572222991770437e-01   +2.084676976381724e-01   +8.232839784828559e-01   +5.651425408791384e-01   +2.989499090060487e-01; +1.775101121885420e-01   +8.713140472279890e-01   +4.250230611245028e-01   +6.348367032881050e-01   +1.677599134483626e-01   +2.024165848387436e-01   +1.009649298922817e-01   +1.436450993679318e-01   +6.017539162252651e-01   +7.650216877210155e-01   +3.774229288428826e-01   +1.828846025670080e-01; +5.247012241635495e-01   +6.652538706394607e-01   +3.520984817163523e-01   +1.046999739268189e-01   +1.199938968458567e-01   +2.455219399153789e-01   +2.965786229502911e-01   +2.466277345853240e-01   +4.768205832852230e-01   +4.087742613569374e-01   +3.143431879341368e-01   +7.279338798469889e-01; +5.960470385975875e-01   +8.504000304592768e-01   +6.171616782926506e-01   +4.886639306729235e-01   +4.142610919766903e-01   +8.795389106819790e-03   +5.175975860275113e-01   +1.286275884798986e-01   +1.519575935430201e-01   +7.286581994172897e-02   +6.876763483078467e-01   +2.314245057477779e-01; +1.515233970256111e-01   +5.498773369917347e-01   +5.805383732917243e-01   +5.516160482143897e-01   +7.442058987530384e-01   +7.450038716501586e-01   +1.801393921425665e-01   +1.151173787586084e-01   +6.594522331524326e-01   +6.595045253985623e-01   +1.466419449568616e-01   +4.506828949749178e-02];
L2E_Input1_iAMPA_netcon = [+6.992937895755930e-01   +6.705426711852124e-02   +1.993899248818423e-01   +5.701928840391037e-01   +2.660931807642722e-01   +5.644444591796458e-01   +1.088793506459641e-01   -1.707642546853109e-01];
L2I_Input2_iAMPA_netcon = [+4.676359341028548e-01   +3.790406796526091e-01   +7.471405619672548e-01   -8.473211503768091e-03   +6.272598904368631e-01   +5.998686970677990e-01   +7.104939822561499e-01   +3.801785558269359e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
