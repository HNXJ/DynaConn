function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.927550527835772e-01   +4.478245835343777e-01   +4.875857715570565e-01   +6.412156132746192e-01   -4.475290156484207e-01   +3.612460930360808e-01   +7.109267590767483e-02   -1.091186724288843e-01   -2.085654069662808e-01   +7.039499570001764e-01   +2.870905490337469e-01   -3.485309604234119e-01   -1.845752773367555e-01   -6.683165520246029e-01   -2.383257271309699e-01   +4.370284535449144e-02; +7.489055926609610e-02   +8.375314317022984e-01   -6.505591872761732e-01   +6.079544688945688e-01   +4.366256350638183e-01   -5.948045667286574e-01   +3.805183943000690e-01   +1.807417978205560e-01   -7.377651226463894e-01   +1.190899894267112e-01   -4.790234267737785e-01   +2.483674810232162e-01   +2.182579899551107e-01   +2.833605458289825e-01   +8.736615042499808e-01   -6.124973253848560e-02; +2.421377050597852e-01   +6.160704116212774e-01   +4.128098977519288e-01   -4.528803440416839e-01   +1.415226346081696e-01   +1.397726129434932e-01   -4.863260220087149e-01   -2.252828981895159e-01   +5.454059852108839e-01   +3.986278689857722e-01   -3.973664234396216e-01   +7.090280221661396e-01   -2.487798099927222e-01   -3.926215905644857e-01   -1.815521795264796e-01   -4.855752739324812e-01; -1.220515674348815e-01   +4.882667526471923e-01   +3.429592159431726e-01   +2.189522365450625e-01   +2.502185530904651e-02   -2.809478007835282e-01   +9.794837971024420e-02   +4.067644571131722e-02   -2.176906746167138e-01   +1.928546657164153e-01   +3.593932563534561e-01   -2.679575955267107e-01   -5.487498813395453e-02   +5.181130659293601e-01   -4.077999912511806e-01   -4.823722778192891e-01; -4.300329630124676e-01   +3.919300609669906e-01   +2.916874289975117e-01   +3.281415925853549e-01   -1.360414529214277e-01   +9.179584803917352e-01   +2.701797481160893e-02   +3.255740326613861e-01   -3.797713897813965e-01   +7.172181591575514e-01   -2.991558446741500e-01   -1.554608962575816e-01   +4.371080799888863e-01   -1.490634602534402e-01   +2.262454403218914e-01   +1.596546774342763e-01; +9.366056138349521e-02   -5.490335885208999e-01   +2.104677790379629e-01   -2.810444509717138e-01   -1.899791894589439e-01   +9.067631374507454e-01   +1.407705281261192e-01   -3.394391280676371e-02   -6.151712901806563e-01   -2.677833181333909e-01   +5.106748224152414e-01   +1.664631279309991e-02   +4.996544169031754e-02   +2.249969370783274e-01   +3.353344075012897e-01   +4.503689191389626e-01; -3.345822263308287e-01   +6.921922339423314e-01   +1.513693174611810e-02   -4.531382247896399e-01   +4.989420683399781e-01   -4.235461239986236e-01   +2.578134658107716e-01   -2.699892966494384e-01   +2.073294274397623e-01   +4.326410762765102e-01   -4.036233895566888e-01   +9.611575187472132e-02   -2.953881639415153e-01   +4.611743656923938e-01   -4.651118539102313e-01   -3.869042023247978e-01; -5.535620511831579e-01   -9.425446287928950e-02   +4.044137778280834e-01   -2.292375857164064e-01   +6.962050361193335e-01   -4.081972277926270e-01   +3.973170911359504e-01   +1.840087726150948e-01   +3.588904614191106e-01   +6.432861614413131e-01   +2.555400683815561e-01   -2.879443214079240e-01   -1.644585199278365e-02   +5.383669635821238e-01   -4.513148266831591e-02   +3.209003582140961e-01; -1.640281195620016e-01   +1.213853645246404e-01   +5.856854332662689e-02   -2.127034323223745e-01   -6.291727027272978e-02   +2.275553508616794e-01   +2.160833795331233e-01   +3.958550914097040e-01   +9.327207323615387e-02   +1.266378741175469e-01   -4.260855293672026e-01   +2.618345156680790e-02   +1.249709365528413e-01   +4.056582877449119e-01   +1.224699275061673e-01   -1.375870321710637e-01; -1.286534506094244e-01   -2.302414443912073e-01   +6.317488698821251e-02   -2.695968036334239e-01   -8.179008566486925e-01   +2.113910516199183e-01   -2.199872534037581e-01   -1.298294872573579e-01   +2.346735817822570e-01   -1.683528058742871e-01   +9.208973638146908e-02   -1.191185080323533e-02   +2.064675308774756e-02   -8.057075224014337e-02   +2.593096591739242e-02   -9.649193172238271e-03; -1.487818576308604e-01   +5.140139249791883e-01   +5.723289290098654e-01   +2.564308423377481e-01   -3.105542123362253e-01   -3.418148528370872e-01   +1.514575441905953e-01   -5.057805526093632e-01   +3.242344432264477e-01   +2.865419238827839e-01   +3.585979381806373e-01   -2.435187845355085e-01   +2.566979729147458e-02   +6.143770299510897e-01   -3.001441146891923e-01   -5.274634224179385e-01; +2.221338677279962e-01   -7.669518116391758e-01   +4.375457521892130e-01   +2.229733103740806e-01   +1.000000000000000e+00   -1.997638457974041e-01   -3.492757491072849e-01   -1.326790496554217e-01   +3.148781014341059e-01   -2.837988814856841e-01   +2.463810861293980e-01   +3.181374756371909e-01   +7.754029634375671e-02   -2.658027655465560e-01   -3.618318389856114e-01   -1.817382482552366e-01; +2.601973735966233e-01   +8.861902848962316e-01   -6.263919672822692e-02   -1.709650000721945e-01   -3.473257646247786e-01   -7.428839842720090e-01   -2.917385931797129e-01   +6.761638288817349e-01   +2.721980935524193e-01   -6.825725914513736e-01   +6.942564067043927e-02   -2.070661318322528e-01   -1.726908434500750e-01   -4.595294168528432e-01   -2.579447029681064e-01   +7.603101208826478e-01; +2.105442002360573e-01   +2.240313151787754e-01   +1.136954346301418e-01   +2.594208527886990e-01   -3.275665102125134e-01   -4.919461477704667e-03   -1.687794212790452e-01   +4.234942905779184e-01   -8.251526900743846e-01   -3.427023313741847e-01   +1.792197392569395e-01   -1.134144125641320e-01   -2.068548037747367e-01   +8.445584687201617e-02   +6.215788684303444e-01   -3.754404607934093e-01; -4.475089380749397e-02   -1.589442814005300e-01   +5.134930129537196e-01   +3.554449837996462e-01   +4.296657706768348e-01   -4.097404168228756e-02   +6.179901853208902e-01   -1.057692180730948e-01   +4.820096030708203e-01   +1.281422004453094e-01   -2.449235066696255e-01   +5.972952105322139e-01   -6.645398147247222e-02   +4.126197246626843e-02   -4.698951797077342e-01   +6.091594775789754e-01; -3.003280933861763e-02   -4.495003803294216e-01   +6.340859348921209e-02   -3.418468190293049e-01   +1.720167650510842e-01   -1.068437773240598e-01   -4.645535334151615e-01   +3.533386621966151e-01   -1.192143249759039e-02   -5.133658740855200e-01   -2.031523420452366e-01   -5.334628026888023e-02   +1.866137685052915e-01   -3.583117451524966e-01   +4.494590903713045e-01   +5.372100802423228e-02];
L1E_L1I_iGABA_netcon = [-2.611247267450945e-02   +6.857016404601832e-02   -7.585375412804112e-01   -7.951717617498674e-01   -1.107651754005437e-01   -7.760114836042429e-01   -3.233046422976155e-02   +1.771992717405424e-02   +7.613338452378613e-01   +2.452647903512190e-01   -3.956979653988692e-01   -2.913986506297824e-01   +6.147568265957528e-01   -9.741354592794244e-02   -3.968617385312498e-01   -5.283937565054704e-01; +2.132234890171912e-01   -1.347191761685485e-01   +4.947303132640339e-01   +7.616417288057667e-01   +1.456252330905003e-03   -2.568362367686317e-01   +7.519576182077436e-02   +6.167969068515364e-01   +2.566211222447609e-01   +4.249621801349688e-01   -2.331138704423492e-01   +2.334644228712746e-01   +8.560423563487548e-01   -1.001510591915733e-01   +7.942884868829472e-01   -2.901700067337671e-01; +4.706580372385097e-04   -4.768151067667531e-01   -9.196804583193741e-02   -2.084172599719459e-01   +3.434864274302063e-02   +1.724940841267061e-01   +1.656999540083156e-01   -5.729232590406131e-01   +5.927609125149736e-01   +2.004104090291147e-01   +2.442541332870936e-01   +3.823013775512994e-01   +6.139255490109454e-01   +4.920354403046761e-01   -3.643230250745209e-01   +8.453176681233374e-01; -6.957502152052694e-01   -8.366184712002136e-01   +6.990321488047970e-01   +2.676872125223388e-01   -1.238761361497407e-01   -2.108876321152468e-02   -6.718378288107427e-02   -2.631952767792357e-01   -1.791614510703819e-01   +5.760788344194633e-01   -8.016578532113198e-01   +1.596042974201765e-01   +2.893442522077482e-01   +1.096503138647043e-01   -6.831303007524875e-02   +1.067266750425386e-01; -3.914020763327498e-02   +4.475843408828117e-03   +1.547392153822518e-01   +1.847304296525823e-01   +4.477472204373507e-01   +4.775646839126252e-01   -6.085224428937006e-01   +3.304358343939264e-01   +2.179273415182955e-01   -3.388285062672917e-01   -3.218064047594090e-01   +6.075590005821551e-01   -7.118847013956239e-01   +1.013688864575646e-04   +3.989698562423972e-01   -4.571809451047751e-03; -3.836728210029235e-01   -2.903473276588661e-01   -1.722153978171506e-01   +2.509716704947025e-01   -9.766336649770158e-02   +8.515707589539872e-01   -4.394842192826574e-01   +2.273926627545375e-02   +1.788050996553761e-01   +7.766632425963687e-01   -4.839010952784225e-01   +5.367194823204079e-01   +7.124215135793381e-01   +4.348782831704788e-01   -1.828904440365290e-01   -4.524074390345154e-01; -3.743289824941298e-01   +3.312054882095770e-01   -2.263910561445593e-01   -4.760723187740536e-02   -5.222679504284650e-03   -6.643663673581630e-01   -7.560139423030798e-02   +8.949780136796384e-04   -3.098213021509439e-01   -3.859053814140100e-01   +6.619346474787355e-01   -5.410154896286237e-01   +5.622463219565201e-01   -7.441621184737857e-01   +4.751419813045882e-02   +2.674539046198690e-01; +6.533869648877632e-01   +3.053977210876880e-01   +3.447198965035735e-01   +2.918691596353264e-01   -4.332924482925036e-01   -3.808794625128010e-01   +7.832565344683606e-02   +5.580153933949350e-02   +4.568844384442001e-01   -4.885381072127843e-01   -5.811765882950007e-01   -1.510067687279533e-01   +3.061586805633786e-01   +3.570954041208005e-01   +6.333098040889813e-01   -5.685401999901456e-01; +2.931253915111018e-01   +1.079206692912462e-01   -9.040735974705136e-01   -1.903423295682742e-01   +1.193788240684271e-01   -7.588909731393925e-02   -7.815443637884658e-01   -3.477699545999952e-02   +8.851011425593929e-01   +1.678155768571021e-01   +5.428951074835185e-01   -8.695914930068870e-01   +7.495843062836738e-01   +3.676445872550868e-02   -2.702824640102011e-01   -3.264328698541238e-01; -3.985376129913678e-01   -1.003622447773371e-01   -6.405216058842194e-01   +2.463711726703313e-01   +3.532941529895988e-01   +8.327368964988868e-03   +5.034474285227368e-01   +4.967034416053182e-01   +5.625075751680431e-02   +3.953694218570732e-01   +1.210922657235270e-01   -3.316612633265764e-02   -6.281864127913098e-01   -2.769079169125578e-01   -3.097460118240397e-01   -4.349613705529476e-01; -6.342670216108930e-01   -4.440451896908123e-01   -5.410331459239272e-02   +8.247919116471328e-01   -2.864486989836273e-01   -4.938725362569063e-04   +1.068414688495991e-01   +2.744409646280190e-01   -5.570591011705693e-01   +9.543606571243701e-02   -2.494530156037615e-01   -7.000886591851566e-01   +1.517331648947212e-01   +2.579051695123796e-01   -1.488973896828800e-01   +6.356770142818485e-02; -1.929319566470524e-01   -1.190021810804286e-01   -8.682756166828591e-02   -3.022796190449328e-01   -1.375087456519626e-01   +7.537091753711159e-02   -2.043732634398814e-01   -2.369306287658562e-01   -2.827889247450942e-01   +7.584813868754114e-01   +1.950184592104592e-01   -4.824571408976992e-01   +9.790576433767556e-02   +9.080188858192315e-01   -6.310349197168760e-01   -5.998200066340544e-01; +7.161228238767935e-03   +4.114243260460176e-01   -9.168454925375377e-02   +8.009913510619617e-01   +2.169258477376352e-01   +4.069224044015110e-02   -3.514416418378042e-01   -2.882206543814002e-01   -3.400424652477568e-01   -5.840465006438197e-01   -1.521333693192583e-01   -1.167857001391222e-01   +1.512839798616896e-01   -2.850862721110377e-01   -3.331634759206076e-02   -1.837890659738115e-01; -5.513171697808914e-01   +7.564614969082952e-01   +1.275134397036228e-01   +3.776511275722519e-01   -6.806868915220834e-01   -4.227627739448445e-01   +6.225903539034345e-01   -1.688212158930753e-01   -4.395089083745346e-02   -2.988629551181896e-01   +5.446796225329166e-01   +5.611111845216891e-01   -2.218785561177161e-03   +1.715124596562050e-01   -5.935633218143002e-01   -5.881057345608466e-01; -7.147024744573098e-02   -1.573529486129245e-01   +9.872755599936514e-01   +4.040013728063904e-02   +3.273980734455118e-01   +2.306201746713588e-03   -3.839850472990315e-01   -8.257334610226670e-01   +5.196298935270929e-01   +1.205564282519032e-01   +2.894500398715397e-01   -7.140726933591066e-01   -2.358256552095879e-01   +2.768966636613187e-01   +2.287123480825342e-01   +3.622894726128246e-01; +5.116578110009140e-02   -9.944723462241761e-03   -3.514146229713056e-01   -4.734898314121982e-01   -4.624288354533158e-01   +5.831514857258968e-01   +2.642713520224687e-01   +5.993420786754416e-02   -1.284035825921725e-01   -2.105457291238026e-01   -1.971605305157375e-01   -8.834605228616577e-02   -3.384053328734536e-01   +3.413597274304888e-01   +4.359006763920522e-01   +1.985376064013967e-01];
L2I_L1I_iGABA_netcon = [+2.048440547879843e-01   -3.210163575767512e-01   -1.573761810358678e-02   +3.668909897889815e-01   -4.145587688167464e-01   -2.951996037677123e-01   +6.950832595358755e-02   -4.736813993047458e-01; -1.345067838791626e-01   +4.956413733523355e-01   -7.486575146543956e-01   -4.308945549977267e-01   -5.963110491594800e-02   +3.439426018531946e-02   -9.955053521664821e-02   +3.779709837054337e-01; -5.542627840865779e-02   +7.192863917861982e-02   -4.150242837045167e-01   -1.885203643886137e-01   -3.118572890404520e-01   +8.214353362942352e-02   -2.744990869720005e-01   +4.418973571714251e-01; +6.109256488383642e-01   +7.190830507625392e-01   +4.315984101503336e-01   -1.075728551390726e-01   -1.737389909263114e-01   -5.243241621655474e-01   -3.885320228371926e-01   -4.285787751643502e-01; -2.249754751278700e-01   +5.189670458836244e-01   +4.396357847727949e-01   +3.625032345857449e-01   -8.065828343282558e-01   +5.612181945682428e-01   +8.294773963056038e-01   -2.995076307664239e-01; +1.310048228599925e-01   +2.530917002383128e-01   +6.059444964988298e-01   +2.870026546997918e-01   +1.803428153775908e-01   -1.035907318462573e-01   +4.476427716022476e-01   +3.367518217446769e-01; +2.117424632096399e-02   +6.431105547627922e-01   +3.124319332182513e-02   -5.171346598296460e-01   -1.099931602642465e-01   +2.791899306238035e-01   +3.519798109262547e-01   -3.696542659461590e-01; +5.146453017615498e-01   -3.737290092981533e-01   -2.419711565215084e-01   -6.173345121332204e-03   +2.074900065512905e-01   +1.306233020192874e-02   +4.083219560882418e-01   +1.102232070384045e-01; +2.543402775768200e-01   +3.787528265949651e-01   +4.390265972743568e-01   +8.841311288306979e-01   +6.441488459224831e-01   -4.173390249460245e-01   -7.630025111565616e-03   +3.320403530494637e-02; +4.672983068044747e-01   +3.682051333888419e-01   +1.205992984447419e-01   -1.703197400516559e-01   +3.452959181661565e-01   +2.841186894941490e-01   +3.339458566788377e-01   -4.537334154142216e-01; +1.328074100110015e-01   +1.329531289575253e-01   +4.765035719148441e-01   +5.867538949648623e-01   -3.678054920550091e-01   -5.981879285771432e-01   +6.587379621039494e-01   +2.889098088851698e-01; -2.125733556598756e-01   +4.849003340538747e-01   +2.159951266969346e-01   -1.558173443977698e-01   -3.947841162866702e-01   -4.786352706862024e-01   -5.013877293359110e-01   +1.814169307426319e-01; -2.921854344335834e-01   +3.704901765513329e-01   -4.231281556379657e-01   +2.110630269721973e-01   -4.585924134107949e-01   -3.764726080024732e-01   -1.077523978821163e-01   -3.153553138635647e-01; +9.682859934603824e-02   +5.084113972514803e-01   -3.981068034067632e-02   +9.872598934083824e-01   +2.258567911037145e-01   +4.069389426847327e-01   -8.783256315665918e-01   +6.456303269921999e-01; +3.745829697549217e-02   -1.285846122940885e-01   -9.329937760873579e-03   -2.666642380039219e-01   +7.281144156933088e-01   +1.971135521789893e-01   -2.720273798279524e-01   -4.143870691456975e-01; +7.665751175804353e-01   -1.000000000000000e+00   +2.677569391450372e-02   -4.859226042098775e-02   +9.611677039027636e-03   +2.410548969700977e-01   +2.234524061417005e-01   +6.674860516246596e-01];
L1I_L2I_iGABA_netcon = [+3.632786738927024e-01   -1.051909707760288e-01   -3.009392151785948e-01   +2.258145690474129e-01   -6.018808785423648e-01   -5.401937003220906e-01   +8.402383399685115e-02   -1.459944243542189e-01   +3.760708862204497e-01   +4.891022517008253e-01   +6.540713258885561e-01   -9.468828374127818e-03   +2.646636256901993e-01   +2.328466634725315e-01   +4.990330024942172e-01   +2.235437821948817e-01; +5.059638317657282e-01   -4.449939214641693e-01   +6.154139947420133e-01   -7.118832301213495e-01   +1.122663534752706e-01   -8.361231640289039e-02   +3.542072079239538e-01   +1.753062640834924e-01   -2.419114850858137e-01   +3.333370957124219e-01   +1.321556211782512e-01   -3.969941906143319e-01   -2.778414876803393e-01   -1.790588170676913e-01   +5.374734598876554e-01   -6.716022939646223e-01; -6.129582036943558e-01   +3.392799617119065e-01   +3.147847851985883e-02   -2.887304589011856e-01   -9.433587902777947e-02   -6.481480086131277e-01   +3.977973308022328e-01   +3.782259711789233e-02   -4.053355662865382e-01   -1.716058259408560e-01   +3.001127495609187e-02   +7.209491865634050e-01   +4.914066257834984e-02   +7.304480881253016e-02   +1.000000000000000e+00   +1.604952934861249e-01; +3.355301468364401e-01   +7.771752002787674e-02   -9.290528017495735e-02   -1.032907872381447e-01   -4.793906348095267e-01   -2.278061341610576e-01   -2.532125415324485e-01   -6.047383913256656e-02   +1.038761429566790e-01   -2.803525472060214e-01   +7.113026641095158e-01   -3.083569247464979e-02   +3.532441212437973e-01   +9.261657669574240e-01   -2.470891867833372e-01   +2.165376868974813e-01; +6.840618226772552e-02   +1.120084040286129e-01   +5.706340821426993e-01   +1.817986838534990e-01   -3.359335132537936e-01   -2.020036062266213e-01   -4.037257169422219e-01   -1.429537094435774e-01   -6.310081853132939e-02   +1.879092822946673e-01   +2.879984731615134e-02   -7.134311592305103e-01   -7.920835692263813e-02   -3.048870732453812e-01   -2.550226171906322e-01   +4.741167130441448e-01; +8.459388984748722e-01   +3.967305594183098e-01   -3.719531472967296e-01   +8.847028138459651e-02   +2.830662146622220e-02   -5.752005211894246e-01   +3.320870088593218e-01   +3.202576608050400e-01   +7.128888042137798e-03   -4.769482150261521e-02   +4.247366986070629e-01   +3.811819841251085e-01   -1.121651899562591e-01   +2.061960494012646e-01   +2.839946019587828e-01   +9.981792014207061e-04; +1.586204445560433e-01   +2.405802330961613e-01   +8.405534427057232e-01   +2.525920878006924e-01   +8.277509347906185e-02   +2.578797245687705e-01   -2.979382929123878e-01   -5.837366912210066e-01   +2.871640450554067e-02   +2.833784657894464e-01   +6.598161653417157e-01   -4.694460075674854e-01   -3.642163576052910e-01   -3.138876895283271e-01   +3.300974571875335e-01   -4.180774341235374e-01; -6.845095556924839e-02   -6.882406409149172e-02   +1.962815165150080e-01   +4.832261778724256e-01   -1.499765964369182e-01   -2.808092185417495e-01   -7.699928746596327e-02   +3.065470709841273e-01   -6.688960369493205e-02   +2.630105336366956e-02   -5.561698709123306e-01   +1.751755779884842e-01   +1.673313448516371e-01   +1.097343120402251e-01   -1.256548541998129e-01   +2.692388196303159e-01];
L2E_L1E_iAMPA_netcon = [-1.075132668402073e-01   +2.952181314199923e-01   -5.437974865872838e-01   -3.990225946599411e-01   +5.636831446214784e-02   +4.549044534519424e-02   +1.565068032978941e-01   +2.003339051256955e-01; +4.206248195363030e-01   +9.964302322705626e-01   +2.021877773181823e-01   +4.965358539775070e-01   -1.092395601052687e-01   -5.932374584467116e-01   +2.331709203756330e-01   -2.226042932278442e-01; +4.690992341938410e-01   -4.189077166248398e-01   +5.825073023432228e-02   +2.307513606004812e-01   -7.568389796650363e-01   +3.995606995642923e-01   +4.300814987072522e-01   +5.038279345334092e-01; +6.469409105309233e-01   +3.467207082341741e-01   +7.702298110192296e-01   -3.223620326682039e-01   -7.409664446508705e-01   +3.427563298286093e-01   -1.895768470961486e-01   +2.526271822348461e-01; -2.489551743213035e-01   +6.763971259507982e-01   +1.903678367674185e-01   +1.476768440643778e-01   +8.225027733134719e-01   +5.587922655232908e-01   -2.048668980525119e-01   -1.954385133314767e-01; +2.592451999004913e-01   +3.249780706859839e-01   -5.383556003413179e-01   -2.125353237369675e-01   +1.168017023267051e-01   +1.000000000000000e+00   -1.231774163326950e-01   -3.252700594021851e-01; -5.589716769425498e-02   +1.627165521331842e-01   +2.365488915979969e-01   +2.267159914570605e-01   +9.885302580736509e-02   -8.909603505982928e-01   +2.219967564635158e-01   +7.972563493333749e-01; -4.807137514625302e-01   -2.940064573785840e-02   -9.992197321139371e-01   -6.338679878577101e-02   -6.181191247806446e-01   -2.198636754171114e-01   -1.546912170981230e-01   -8.339405303688620e-01; -3.694194319159776e-01   -3.521646877253386e-01   -3.412521568470946e-01   -2.440700951089483e-01   +1.469265450619526e-01   -1.794476494166332e-02   -1.152669585953015e-01   +4.483697476618820e-01; +5.045305818403507e-02   -1.304905458218600e-01   -3.902467122280949e-02   +3.379347390415101e-01   -3.160608145556080e-01   +7.683144433490621e-02   -3.323231262230599e-01   -1.833537355952420e-01; +2.724526321128304e-01   +4.018560744054622e-01   +1.422094133692140e-01   +2.183576317319266e-01   -9.696938874891865e-01   +5.210133868587523e-01   +2.496150178312997e-01   +2.936355021392825e-01; -3.326789615075480e-01   +1.597750988753398e-02   -2.016145955567748e-02   +3.668672880557932e-01   -6.684312771402480e-02   -2.407359912929455e-01   -4.823766327679768e-02   +2.981821117654903e-01; -6.851564463319925e-01   -8.857447624212335e-02   +2.072884628374168e-01   -5.189777299900391e-01   +4.588923399763882e-01   +1.596730000050126e-01   -1.218882336842420e-02   -4.765679714368867e-01; -3.245224713842944e-01   -1.435117051502639e-01   +1.793254868682687e-01   +1.407825666575193e-01   +2.596535767339955e-01   +1.052322216800691e-02   -9.797621066754161e-01   +7.162049770920926e-01; +2.332495662156954e-01   -8.026065402219837e-02   -6.174675570726297e-01   +1.906722137829517e-01   +6.478569723941368e-01   -3.728839350558423e-01   +2.678519908023621e-01   -3.363435974330695e-01; +2.412069799451782e-01   -4.659011357403687e-02   -1.228239328495076e-01   +2.706046639199967e-01   +7.107612971243883e-02   +7.090139723110452e-02   -2.970471130155392e-01   -3.002818990258560e-01];
L1E_L2E_iAMPA_netcon = [-4.439086771935208e-01   -3.943710661785529e-02   +2.800923644936458e-01   +2.131652635404865e-01   +8.602215618182181e-01   +3.727513324168519e-01   +1.199965840262253e-01   -5.758550034137321e-01   -1.167157308029116e-01   +3.911627928997866e-02   -2.614572410540857e-01   +1.277264983176896e-01   +6.279291568390964e-02   -4.339657183494103e-01   -1.820926079369434e-02   -6.869414744101126e-01; +1.275025656805472e-01   -1.318834568079029e-01   -3.088654158924238e-01   +3.814039987640714e-01   -1.742712035971996e-01   -4.287704142519068e-01   -4.420019661215284e-01   -4.598540226398717e-02   -3.556251990277427e-02   +3.341940592883841e-01   +3.634337810175838e-01   -4.178429105669494e-01   -7.779718660502520e-01   +4.886254325669331e-02   +6.941293997486528e-01   -8.554619677440840e-01; -1.926590288043712e-01   +3.571636466635673e-01   +2.255487223025464e-01   -7.216681722359903e-01   -3.654476455956023e-01   -2.379706689840946e-01   -2.532881064808218e-01   +3.909648165126595e-02   -5.131521655435265e-01   +5.972568135602785e-02   -3.161571101054667e-01   -2.212013240961621e-01   +2.049577459062826e-01   -7.460014223328362e-01   -1.641275212435186e-01   +4.762383036605676e-01; +2.091733169658716e-01   -3.367797236324819e-01   -1.952150872539286e-01   -9.269727546876652e-02   -2.336253629554852e-01   +2.901288430542984e-01   +2.155679690397193e-01   -1.315562961894406e-01   -1.585955987489634e-01   -3.089668746668173e-01   +3.076980366075086e-01   -4.378473761100627e-01   -3.380630385952284e-02   +1.130759499702036e-01   -3.382372583313736e-01   +6.219357847431448e-01; -8.070431595074627e-01   +2.011890960317040e-01   +9.576498703530840e-01   +5.848874888525702e-01   -5.513047111933077e-01   -6.610452677361753e-01   +7.465417163000150e-01   +3.028302606336016e-01   -5.369223240963594e-01   +3.139175397974861e-01   -1.956422513038222e-01   +6.125032489643585e-01   -3.618419811792489e-01   +8.670776428378360e-02   -2.034521969926922e-02   +2.457618211843147e-01; +2.258577376742111e-01   +4.048991644836075e-01   +3.284341985282734e-01   -7.910017783751953e-02   +8.251900348881069e-03   +1.062940706440186e-01   -6.584454913465984e-02   -1.460033140040415e-01   +4.390295360509004e-01   -1.879885917015031e-01   +1.053180567217929e-02   -1.926494097016850e-01   +1.608162242003835e-01   +8.258972223590051e-01   -6.637495136345545e-01   -5.286775004970451e-02; -2.463532122982518e-01   +2.713081468934853e-01   +2.447677560827421e-03   +8.098528363280663e-01   -6.561303856790366e-01   +7.953546513004608e-01   -2.434625597592375e-01   +2.640645963050099e-01   +3.394762956945103e-01   -3.675444977235504e-01   +6.113459241164509e-01   -3.564269110722827e-01   +3.660612361724571e-01   +3.828749791286915e-01   -2.573851456998130e-01   +3.683996585944704e-01; +5.818953992719225e-01   -1.403947706121284e-01   -2.486192045644451e-01   -1.529834385163670e-02   -1.138856163807637e-01   +5.434385877030434e-02   -8.236859568558652e-02   +3.625083244352498e-03   -6.161674920874349e-01   -1.612637998079897e-01   +8.700829542567650e-01   -3.354920157217499e-01   +3.364601658104330e-01   -1.760323648684608e-01   -3.521271113547847e-01   -2.247249660700301e-01];
L2I_L2E_iAMPA_netcon = [-1.816578101526014e-01   +1.498687675113093e-01   +5.445674386495681e-01   +2.165258651452562e-01   +7.174556151467359e-02   +3.927660000946778e-01   +7.209539547263998e-02   -5.465121104428320e-01; +5.985217457198747e-02   -2.801242282458141e-01   -8.517274752587890e-01   -3.999370658481484e-01   +2.825175079593971e-01   -2.508112198064893e-01   -5.333631315695452e-01   -3.657768097984453e-03; +3.433159651676944e-01   -1.857166228121622e-01   +7.114674322666981e-02   -2.911528181256487e-01   -3.960038989231157e-01   +5.613945328502441e-01   -3.870599247626340e-01   -4.752696662116465e-01; -3.686697055457469e-02   -7.916942867629688e-01   -2.365622796027120e-02   -3.442551701629848e-01   +2.656487630806250e-02   +7.029990538560857e-02   -9.062897557965641e-02   -3.678208413057510e-02; -7.396303715586333e-01   +4.389671256528928e-01   +4.455044404916136e-01   +4.290469636485311e-03   -4.985501027798941e-01   -4.831900577381470e-02   -7.733930506155997e-01   +6.799425111506573e-01; -3.192142097418165e-01   -5.640662541719168e-01   +1.367457658021693e-01   -1.900580894643049e-01   -4.013333943648540e-01   -1.398934972800626e-01   +4.882100349723056e-02   -8.334149819801959e-01; +2.311929002417587e-01   -1.000000000000000e+00   +5.341579149481598e-01   -5.675415646538536e-01   -1.817221793836978e-01   +4.555277421353161e-01   -7.310904568386946e-01   -7.979667323608308e-01; +6.439004228948857e-01   -4.965960209771489e-01   -4.702929390061471e-01   +2.649060286938597e-01   -6.025638394050437e-02   -4.672116963526732e-01   +6.257256472005914e-01   -4.040340703111900e-01];
L2E_L2I_iGABA_netcon = [-3.295579166663531e-01   +6.753919357552834e-01   -5.096943146086270e-01   +1.445843473752966e-01   +1.513235666043276e-01   +4.861472007473417e-01   +2.663471901470831e-01   -6.918228052972845e-01; -1.727318123328584e-02   +2.436912701946101e-02   -1.580584996988137e-01   +4.713157684032805e-01   -6.365585882800864e-01   +5.632603117192503e-01   +6.166971518462271e-01   -1.183036174123031e-01; +1.161648089301240e-01   -3.943461186952764e-01   +3.248269342751333e-01   +2.578630236339563e-01   +5.114290935904482e-01   -7.550360564046776e-03   -1.996003948970402e-01   +1.678858134629260e-01; +1.000000000000000e+00   -1.443895079157506e-01   +2.835288067642382e-01   -6.241516521505281e-03   -3.321919409653311e-01   -1.714538874081160e-01   -2.894330581005428e-01   +3.188071019892648e-01; +8.109418867298326e-01   +1.335762123624668e-01   +1.792101131341304e-01   +3.732307772139880e-01   +2.071489344773949e-01   +4.231086119169704e-02   -5.371060704051334e-01   -1.576283384070354e-01; +8.552799232884237e-02   -3.131837081983011e-01   -2.021531295311616e-01   -4.199364907707481e-01   -8.553759636908395e-01   -4.986884178650056e-01   +1.456470422292240e-01   +2.141209725237659e-01; -2.230499367553446e-01   +1.131193750754598e-01   +3.437131761717515e-01   -1.858750830184027e-01   -3.107382745197856e-01   +4.193166820208957e-01   -4.141883162314985e-02   -4.661307684163308e-01; -2.535341055202210e-01   +2.156125264341011e-02   +5.609335535019747e-01   -4.693178666410167e-01   +2.275238438244330e-01   -4.275873804460140e-01   -2.106812247690669e-01   +8.013809510486377e-01];
L3E_L2E_iAMPA_netcon = [-2.492122823720263e-01   -3.747314201969010e-02   -7.981919057164233e-02   -3.852864976306121e-01   -1.642744932675840e-01   +6.265284123142021e-01   +4.058534926475379e-01   -4.226037128870167e-01   +1.898563037819751e-01   +1.230272998356162e-01   +2.988414840110769e-01   +3.151020227275199e-01; -2.758020324663374e-01   +5.908333780649737e-01   -7.392039100290737e-03   -9.483680671700839e-02   +4.348735680900871e-01   -9.912091088362465e-01   -1.368608816189324e-01   +4.384910807379780e-01   +2.491093752836767e-01   +1.149801580641969e-01   -5.116016177246024e-03   +3.264738853415557e-01; -5.514878271066742e-01   -1.394559397436625e-01   +6.757209185372020e-01   -4.575201609254410e-01   +1.934842656068811e-01   +4.670805682982108e-01   -4.901329417727991e-01   -3.196641423264548e-01   +8.338754077415992e-01   +3.028122289516191e-01   -4.031478611590461e-02   -3.428908139794558e-01; +7.491204904308510e-01   -3.792548419704718e-01   -4.717503486913445e-01   +5.375904997738296e-02   +8.760470205901620e-01   -1.767516502454438e-01   -6.413549828272929e-01   +1.249724944744476e-01   +4.199797547988695e-01   +3.156752914900206e-01   -9.231380344082922e-01   +1.001025787743008e-01; -5.290543765836146e-01   +2.002547970671184e-01   -2.628011459729060e-01   -2.650955278791262e-01   +3.994485556691654e-01   +5.171150703096870e-01   -7.176456809283036e-01   -6.406608046822504e-02   +1.246667912113016e-01   +6.315895340959290e-01   -3.825709511130205e-01   +8.268499963817616e-02; +9.110893643599960e-01   -2.945329972959829e-01   -6.271524867931229e-01   -9.966642999351057e-01   +3.934832493243353e-01   +8.632333881600760e-01   +3.100215359969586e-01   +9.587192465624452e-01   +2.343995441644237e-02   -1.499735461697071e-01   +6.767396968845589e-01   +2.244333315621028e-01; +1.255113911594613e-02   +2.755457639430461e-01   +5.752798620607998e-01   -7.317939695224804e-02   -2.763946433491205e-01   -1.687407642372426e-02   +7.528886852763331e-03   -5.794059340836933e-01   -2.795455534673918e-02   -5.761656631202021e-01   -6.554126658430286e-01   -5.639354127862151e-02; -3.609731718663542e-02   -1.629528587948032e-01   +2.329424655669244e-01   -2.891911748146766e-01   +1.248186400784935e-01   +2.320941281352856e-01   -2.936972590252797e-01   -1.240082693323641e-02   -8.162276728444695e-01   -1.459279406778705e-01   +2.690797794823707e-01   -7.054849868346226e-01];
L3I_L2I_iGABA_netcon = [+2.306363614441953e-01   -3.263803731479389e-02   +6.168278935921778e-01   -9.549900002490883e-02   +8.671184318373266e-01   +1.513658220652597e-01   +3.943012752039286e-01   -4.871811954158196e-01   +7.386471339643427e-02   +6.573590398409825e-01   -3.079149466249534e-01   -3.076531768598469e-02; -3.429086520382157e-01   +4.146769351960634e-01   -3.157771148149272e-01   +3.035402677190547e-01   -9.111342768424764e-02   -1.172229673981242e-01   -1.169116557601572e-01   +5.451055140042284e-01   +8.115342957602543e-01   -7.234215225163216e-01   +3.430288119422932e-01   +5.631277999652941e-01; -8.606356789616895e-02   -2.258166239247101e-01   +6.057745378762703e-01   +4.450800735910958e-01   -5.808455843260808e-02   +6.964668207075880e-01   -6.667248327394184e-01   -8.386761810490867e-02   -2.334716918569118e-01   +8.833578763481251e-01   +2.605135956333261e-01   +4.728192380001286e-01; -1.990948308931082e-01   -1.506715587290362e-01   -4.013838761794515e-01   -2.745851748570429e-01   +7.929557631458480e-02   -1.336872700785898e-01   +2.807234858489913e-01   +3.624715808739742e-01   +3.510631808364609e-01   +2.138007591051397e-01   +4.690942252210075e-01   -6.408303641088166e-02; -5.916133081642337e-03   +1.497996560172983e-01   -4.673112380416945e-01   +4.214426352071960e-01   -1.227329472509417e-01   -2.430872086932486e-01   +2.259308143563392e-03   -4.102665310424130e-01   +9.566118551951991e-02   -6.179964931711782e-01   +3.004319503728817e-01   -1.727673537103488e-01; -4.647786546508133e-01   +8.069348808367043e-02   +6.222232000751199e-01   +2.118810138631726e-02   -4.430314110544782e-01   -7.363854325747409e-01   -3.730929505119570e-01   -1.197782067863441e-01   -1.000000000000000e+00   +7.856856409707516e-01   +2.926172154145886e-02   -2.674805327300200e-01; -2.442784188617700e-01   -7.963932727848683e-01   -4.965879041696306e-01   +4.158944492597558e-01   -1.149660113945335e-01   +1.942461673236679e-01   +3.472796680158026e-01   +5.141228837247396e-01   +3.963413982037587e-01   -2.322710241966350e-01   -3.435267770845985e-01   +2.423786519988791e-01; -6.948571506741048e-02   -6.445731923833645e-01   +2.866528512611728e-01   +1.377508796348283e-01   -5.218845443803277e-01   +4.006654937695510e-01   -2.633786815144035e-01   -1.156041088041194e-01   +2.258693488776633e-01   +1.227273157209342e-01   -2.406315385916032e-01   -3.201218700472378e-01];
L2E_L3E_iAMPA_netcon = [+3.994513516176560e-01   +2.335286681136137e-01   +3.448198482102836e-01   -3.040365953903547e-01   -8.013187414883809e-01   +9.862273585196266e-01   +3.742640273183068e-02   +1.772932967297469e-01; -2.896280365901881e-01   +2.862073597474796e-01   +2.989755748650762e-01   -1.627236965099023e-01   +2.627930452280102e-01   -6.505356116096900e-01   +2.183162804413634e-01   -9.183985554240170e-02; -1.462790428913552e-01   -5.103336118950237e-01   -1.886352422915829e-01   -8.532558151844120e-01   +6.210019930547811e-01   -3.745670851484363e-01   +1.468861755928287e-01   +5.527310518510649e-01; -2.714143151502356e-01   +2.684765955472387e-01   +3.545967497899217e-01   -3.855816227826704e-01   -4.880937976811629e-01   -4.665124242993275e-01   +2.987882775984717e-01   +2.004908678609778e-01; -2.065497461147414e-01   +1.553025845425021e-03   -5.610017220642587e-01   -9.579617981237426e-02   +2.129618532314914e-01   -3.740854161290604e-01   +4.714274184286356e-01   -5.987507980772666e-01; +5.724708858124938e-01   +7.422751374291234e-01   +5.711713037198349e-01   -1.680008734436779e-01   +1.542139405010237e-01   -4.068709638256292e-01   -1.404149352797739e-01   +7.236901611386698e-02; -3.900093070251075e-01   -6.533344467242319e-02   -3.179445411611619e-01   +8.853203890969640e-01   +1.956774918416837e-01   -6.296920549579418e-01   -2.803691179207078e-01   +4.027832023893253e-01; -3.260163283513444e-01   +2.694439512301418e-01   +5.582672184219628e-01   +5.694104410975107e-02   -1.032882653418780e-01   -1.421805522120133e-01   -7.004821959591401e-01   +3.459859475079324e-01; +2.527566967554286e-01   +7.428617222677830e-01   +5.031545880395207e-01   -4.387525890699840e-01   +4.105444587001504e-01   -3.896533792924984e-01   -1.275864425563745e-01   +5.459418121914433e-02; -4.906952167926852e-01   -2.445297990702847e-01   +1.642413756221696e-01   +2.070452116737851e-01   -6.034808255161881e-01   +2.227566029670870e-01   -2.576006178479576e-01   +3.129843702012180e-01; -1.931466961795055e-01   +2.888697013311367e-01   -1.449504277075776e-01   -3.811718328319442e-01   -1.047241034960267e-02   +1.542847086864367e-01   +2.444511461075731e-01   -1.098863975829855e-01; -2.921432345067414e-01   -5.027687842678501e-01   -3.310913250945414e-01   -1.737005454853642e-01   -2.325444506911787e-01   -8.963617244146938e-02   -3.929089178783631e-01   +5.628072009786086e-01];
L2I_L3I_iGABA_netcon = [+4.470159577353605e-01   +3.561438393246635e-01   +2.459083796720986e-01   +4.748004075312808e-01   -7.234651426665614e-02   -3.575584424091194e-02   +7.177445863791049e-02   +7.766077304902934e-01; -2.850468410370477e-02   +2.300643579465200e-01   -7.842821692764133e-01   -2.455338253924451e-01   -4.593437989266892e-01   +4.343841144070127e-01   +9.728128769179365e-01   +4.503196899535836e-02; +3.520214508883036e-01   +4.283116720893119e-01   -1.333926492463294e-02   +4.909518173181524e-01   -4.145444022507352e-01   -4.436090703868186e-01   -1.184332925040865e-01   +7.741085426216665e-02; +2.095857170158279e-01   +3.312436377781780e-03   +4.931204654782816e-01   -2.716384764107504e-01   +1.794127950464559e-01   -2.749577142522636e-01   -7.674220439198256e-01   +2.189140188314637e-02; -7.256207821763791e-02   +4.935827000360949e-01   -1.469369765544820e-01   +1.135950974445916e-01   -4.987332870544596e-01   +5.374728415863106e-01   +6.674890935328730e-01   -9.169164043518052e-02; -6.605949260996075e-02   -3.085341255690980e-01   +4.345994396406433e-02   -1.310212728993492e-01   +6.006344741620138e-01   -2.425562136043918e-01   -2.827044569667851e-01   +4.904552788276987e-01; +4.949598939526973e-01   -1.945264789497864e-01   -7.627937937747660e-02   +2.868801330255438e-01   +2.898536794086641e-01   +2.861383309808211e-01   -2.564693307778176e-02   +5.692081520874057e-01; -7.926118393784196e-02   +2.656394978636999e-01   -4.105989998955498e-01   +3.180058977819751e-01   +3.217171268347703e-01   +1.274597605526247e-01   -7.013709633758747e-01   -4.396359330386848e-01; -3.044604932495716e-01   -4.325593134620096e-01   +4.017818849577817e-01   -4.922121394399596e-01   +4.158151006616009e-01   -4.157543683324816e-02   -7.841716575392317e-01   +3.100961359466252e-01; +2.231883291005472e-02   -3.597531266304136e-01   -2.664066413052598e-01   +3.927159332448310e-02   -5.921481280707703e-01   -1.825541945080417e-01   +5.550493903752243e-01   -3.161515751776425e-01; +6.400315431255928e-01   -9.712607546336294e-03   +2.217231957726762e-01   -2.656531399933694e-01   +5.943051180257199e-01   +9.689758856955992e-01   -8.384342395564889e-02   -4.617577848610113e-01; +3.039397842374814e-01   -2.232429159521153e-01   -4.296452858430761e-01   -5.763246054543416e-01   -1.092053924463114e-01   +1.017941696725872e-02   +4.253455647595125e-01   +2.895461477200725e-01];
L3I_L3E_iAMPA_netcon = [-4.528532778320538e-01   -6.112439585646402e-02   +6.087444036305867e-01   -1.135369489423729e-01   -9.141742662725061e-02   +9.527683157642506e-01   +4.375351625259160e-01   -1.000000000000000e+00   +2.402431678275486e-01   -9.398058605907054e-02   +3.369345827891469e-01   -2.514509113163638e-01; -8.390084840444787e-01   -1.816620679291279e-01   -5.940387571968440e-02   -2.491390546196034e-01   +5.356419052559744e-01   +3.542085250764279e-01   -6.035111970579224e-01   -3.225338574570473e-01   -9.103140252912784e-02   +3.354260998244165e-01   +1.203828231589946e-01   -3.135863413308935e-01; -2.881839970409322e-01   -2.782381955142994e-01   -7.178655759423948e-02   +8.142220530927204e-01   +7.494204874772481e-02   -3.803368760545470e-02   +4.821087747595465e-01   +1.728390974921948e-01   +6.000696809005636e-01   -2.109332040795658e-01   -5.653335693016242e-01   +1.814854042712990e-01; +3.660166872637677e-01   -4.378053196567404e-01   +5.565053468777192e-01   +3.870805214604553e-01   +5.447060380929510e-02   -1.094186761398542e-01   +6.382463906054865e-01   -4.672175313979023e-01   +1.006883347071009e-01   -1.005272789847200e-03   +6.161420909248183e-02   +4.046115652673300e-01; -2.718596460275620e-01   -1.268707354964906e-01   +2.007068333345844e-01   +3.070961535920624e-01   +2.651079302361479e-01   -1.462907783886317e-01   -3.646750543116731e-01   +1.724625359323768e-01   +1.181166750649247e-02   -1.412490522230483e-01   +5.175082729442304e-01   +1.515982147382959e-01; -1.239426508986632e-01   -3.430045084141266e-01   +4.772150653669885e-01   -3.456121067428183e-02   +8.775956410627617e-02   +3.782866447879171e-01   +1.996685203802037e-01   -4.851993867150282e-01   -3.941784190482384e-01   +4.343661172591737e-02   +3.697402447088974e-01   +5.324205329030270e-01; -7.731639479570234e-01   +3.591715472041886e-01   -1.682100433890598e-01   +2.423721732254941e-02   -2.025238890364093e-01   -2.658595729771215e-01   -5.298367259267565e-02   +2.372110088667304e-01   +3.228994930193708e-01   +1.911193799932559e-01   -6.664696418432824e-02   -4.277564961961134e-01; +1.170768696820537e-01   -2.881755332921546e-01   -4.437941748284399e-02   +2.809712010491380e-01   +7.137413461966054e-02   -7.114982592646502e-02   -5.720024003983835e-01   +2.385294197420612e-01   +5.078601859853155e-02   +4.047093266408421e-01   -4.966758322574650e-02   -1.913800333586730e-01; +2.372732390944131e-01   +1.593862174074375e-01   +8.628423299413587e-02   -6.204526411123945e-01   -8.755413033067568e-02   -2.801159646036694e-01   -7.861657501602277e-02   -5.532730197261516e-01   +5.702626116247362e-01   +4.498541021228975e-01   -2.407008638145313e-01   +6.547772965472726e-02; +5.317319825222767e-01   -1.669156814822480e-01   +2.167654924432011e-01   +5.069892294390065e-01   +2.379367982435010e-01   +3.051556704940216e-02   +2.736875541815846e-01   +6.373599253620558e-01   +1.540633496264316e-01   +1.749995195792499e-01   +4.398610412317551e-01   -7.021219019439855e-01; +1.668262744605094e-01   +5.718705705227070e-01   -1.525530584952062e-01   +4.893607246857946e-01   -2.326635470422842e-01   -6.079566430688549e-01   +7.980637719249244e-01   -7.461722429889089e-02   -2.439881213966941e-02   +4.495379681773549e-01   +1.148225488908746e-01   -1.033026064977775e-01; -1.178700105818581e-01   +3.611259497741407e-01   +3.150574128529788e-01   -1.406326310631624e-01   -5.143148499574963e-01   -3.487818755463458e-01   +4.455576273089875e-01   -2.264843564212535e-01   -6.535674989676898e-02   +6.595705454021253e-01   +6.737636929615809e-02   +3.139271237278529e-01];
L3E_L3I_iGABA_netcon = [+2.895606456663393e-01   +2.113439847373232e-01   -4.158188929995090e-01   -5.794482860392253e-01   -2.978839143505049e-02   -6.147647274031773e-01   -1.275010720796703e-01   -8.577359729697656e-02   -4.279395375873099e-02   -8.736391035767130e-02   -2.704909845974072e-01   -1.185065531845297e-01; +1.270184613979170e-01   -7.992292134002189e-01   +4.222236604701625e-01   +6.464832382399316e-01   +4.321159559377782e-02   +6.771320017076512e-01   +2.020048749241430e-01   -2.591627801695915e-01   +8.534825654609031e-01   -3.530714006174875e-01   +4.231468591854691e-01   +3.482391360587287e-01; -1.653236375856209e-01   +1.302076250983293e-01   -3.907873593714647e-01   +2.663109454192156e-01   +5.313913784073881e-01   -9.384571821668639e-02   +6.482786500217017e-01   +4.978958409701131e-01   +2.392673766904874e-01   -1.491310178972013e-01   -7.969449867045378e-02   -5.003071961994338e-02; -5.780623962363376e-01   +4.697261488410701e-01   -3.937083703855996e-01   -5.443754011986665e-01   -9.344968402904050e-01   +9.103969767752209e-01   -1.038084894116211e-01   +4.653339677721550e-02   -1.240018805740834e-01   +4.709615203724246e-01   -1.964611146177618e-01   -2.208212229985082e-01; -2.022853087173431e-01   +2.376449430566183e-01   -2.459024505379431e-01   -2.665951743589340e-01   +4.295046991536266e-01   +2.600728030938196e-01   -3.405679974044074e-02   +7.036422574288151e-01   +2.752152194147238e-02   -1.049893487632230e-01   -1.031265555421121e-01   -4.766471878330461e-01; +1.026377751660292e-01   -5.282304141197746e-01   -1.505725589452482e-01   +3.500693558248519e-01   +3.984041132196515e-02   +9.784383833074415e-01   -4.538923365965893e-02   -4.352188064822627e-01   -4.463779259942823e-01   -2.410203428222985e-01   -1.297724783260044e-01   -3.458539525264205e-01; -9.009224173519955e-03   +3.990205285758726e-01   -2.618123394974527e-01   +2.474071169751885e-01   +3.411402168194874e-01   +3.593609994259878e-01   -2.305735515931369e-01   -3.370458026846403e-01   +7.237243688581703e-02   +4.943340054184980e-01   +6.069834872175476e-01   -4.385321604491245e-01; +1.937851209993568e-01   -2.463768197112049e-01   -3.721018954663051e-02   -4.263918468585134e-01   +1.660555722394187e-01   +1.446123211512279e-01   +6.082177075447101e-01   +3.638373709453495e-01   +1.838850538301655e-01   -5.541830281601337e-01   -5.202036601229831e-01   -2.480322339086600e-01; +3.911145584351640e-01   +1.264293135460769e-01   +6.297462528844046e-01   -1.891249387153877e-02   +3.294434543257312e-02   +4.920019572241048e-01   +6.011673860776693e-01   -4.227285418123209e-01   -5.872555543981522e-01   +9.416532057839580e-02   -9.162375575175455e-01   +2.508801704773089e-02; +1.482510583806880e-02   -2.461926420328968e-01   -7.737376363363026e-02   -3.029342518715368e-03   -1.592990721645329e-01   -4.435215599148586e-02   +4.371243725122727e-01   +2.148836610244524e-01   +6.852737989374317e-01   +3.134915756360201e-01   -4.613926562976103e-01   +3.314141518198409e-01; -2.558502483524301e-01   -4.938336926830751e-01   +1.080249112798987e-01   -1.302587155949627e-01   +6.293970421946181e-01   +1.674496491485769e-02   +4.936441211318192e-01   +3.130597652850528e-01   -6.823657756195096e-02   -4.283453598966619e-01   +2.545958979438680e-01   -4.473133687778607e-01; -6.409247015168757e-01   +1.000000000000000e+00   +3.438925420231341e-01   +4.258187733078195e-02   -3.495556329152782e-01   +3.321668186329127e-01   -4.462780334936255e-01   +7.865636347245003e-02   +1.454269950326077e-02   -5.896013974595966e-01   -2.811262292477067e-01   -1.993183583948146e-01];
L2E_Input1_iAMPA_netcon = [-8.816408210374860e-01   -4.952169743329664e-01   -4.022510240585663e-01   +9.237712363867263e-01   +1.205224996341165e-01   +2.426447251141176e-01   -1.000481021818446e-01   -4.373370274248397e-01];
L2I_Input2_iAMPA_netcon = [-1.406289655562699e-01   -2.459454589542679e-01   -6.880955777158937e-01   +6.120411054474815e-01   +5.037903685689389e-01   -5.105413767777410e-01   +6.777343822627804e-01   -6.542152125501546e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
