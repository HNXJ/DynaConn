function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.392735261776039e-01   -2.772102950696560e-01   +1.900274071881210e-01   +8.246495106359460e-02   +3.032740487325467e-01   -2.645962963478220e-01   -2.154997242244097e-01   -1.617475092558603e-01   -3.300799883598061e-01   -8.139894644885343e-02   -4.378376926873002e-01   -3.194959728630650e-01   +1.837137517856511e-01   +4.706292477986032e-02   -3.342308645208572e-01   -4.275626556965931e-01; +4.012409806504516e-01   +1.216177687606175e-01   +2.838126354403081e-01   -3.769574485312072e-02   -2.076876034997408e-01   +1.943097013387921e-01   -3.480870742814013e-02   +6.265754581506147e-02   -8.827328893635461e-02   +2.098465098417811e-01   +5.608218852595304e-02   +5.467789606949286e-02   -2.322450684144548e-01   -3.254010144745252e-01   +4.213665731388533e-01   +2.170214618456137e-01; +8.672357149970926e-02   +4.362009060371111e-03   -8.237732733850783e-02   -4.235872623006313e-02   +1.461782618407983e-02   -3.322214136818089e-01   -1.085962179577359e-01   +6.298178934068899e-02   +1.001398848741325e-01   +1.581576162996262e-02   +2.416332540374316e-01   -4.082472575922940e-01   -5.474557143590203e-01   +2.345812616547257e-01   +2.744201440269837e-01   -1.148183735009490e-01; -1.583798926958530e-01   -9.519535290112459e-02   +3.213305742603481e-01   -3.452650670195374e-01   +1.233825699308612e-01   -4.966176847798920e-02   +2.971015304269816e-01   +4.692690135985196e-01   -3.598621542541322e-02   -2.549956566344917e-01   +1.267213142774200e-01   -3.959879977029762e-02   +1.712525343392035e-01   +3.759091514662785e-01   +4.038167797177175e-01   +3.382961075934982e-01; -1.239055356660405e-01   +1.176429096483880e-01   -2.360338858704639e-03   +2.323850951574484e-01   -6.354453986717648e-03   +1.556241329011767e-01   +1.228231461399248e-01   -5.324769714067662e-02   +6.699993426574488e-02   +1.961575552695716e-01   -7.603774423436160e-02   -3.781796521747631e-02   +1.354862148129494e-01   +8.782524010075383e-02   +1.085732853319788e-01   +4.886579151584112e-02; -1.455424312350664e-01   -1.621446290992009e-01   -4.702357342343496e-01   -5.359016526337079e-02   -1.751413761375018e-01   +2.367538581675838e-01   -3.088530867236258e-02   -7.568889591435496e-02   +2.341772840876268e-01   +2.350668216789690e-01   -1.149805759621487e-01   -1.364032403230780e-01   -2.895614622329191e-01   +2.643673448542775e-01   +1.692887816033965e-01   -7.631476727376882e-02; -8.528802599651081e-03   -7.089807734015624e-02   +4.709204120285505e-03   -1.859936750647816e-01   +1.612462664490157e-01   +3.195931900587605e-01   -9.904141444352663e-02   -1.355447642506770e-01   -4.782789552325476e-01   -2.485351172193476e-01   -1.179722803526860e-01   +1.659402113427985e-01   +5.741776906505206e-01   +2.969393267016496e-01   +3.183753106354563e-01   -3.456989351758514e-01; -5.375255477381381e-02   +2.116908519500652e-01   +8.838520884610869e-02   -2.428322484471618e-02   -3.447012837299287e-01   +2.045545125559047e-01   +4.736216393554105e-02   -1.999214050275809e-01   +2.208354202421878e-02   -1.996929591237111e-01   -3.063492489937488e-01   +4.054213187101670e-01   +3.499119540501764e-01   +2.217984229026190e-01   -5.247488601680253e-02   +3.700262759129581e-01; -9.058452970366504e-03   +1.474790434528288e-01   +1.463787465164209e-01   +1.223463436872839e-01   -1.361983974014097e-01   +6.034470724762361e-02   -2.363503421426643e-01   +7.441692053741376e-02   -3.225939192261629e-02   -8.964365671381100e-02   -2.897796987247516e-01   -4.251297228384936e-01   +3.769527127192046e-01   -6.686593466187001e-02   +1.448226464956341e-01   -1.774042742287398e-01; -4.305035388123407e-02   -1.420628236088738e-01   +5.689052488871957e-02   -3.737367577774991e-02   -3.114692289183472e-01   +1.504709991377209e-01   -1.937723478214425e-01   -3.968196238715771e-01   -2.291874825392054e-01   -3.284968834694424e-01   +1.828508603379224e-01   -1.006932386395193e-01   +1.830414042953442e-01   +6.235348211697764e-02   -1.547119546787198e-01   +5.932898973906359e-02; +1.202181729800267e-02   +1.275321451315758e-01   -2.557359897014098e-02   +1.665672754412804e-01   -1.175607841049150e-01   +2.679022543616263e-01   -1.047708439491439e-01   +1.632863371696068e-01   -1.979676355514143e-01   +1.504300775594666e-01   +1.697180984100634e-01   -9.980453047592855e-02   +2.617048686307192e-01   -2.455666203397620e-01   -7.106041663159311e-02   +3.289625542070237e-01; +1.681304163403575e-01   -1.059754492138350e-01   -1.602687608971554e-01   +3.298683530502497e-02   -5.015544275318828e-01   +1.266942232821918e-01   -2.628429047824809e-01   -2.206386905137049e-01   +1.377747530869356e-01   +1.794327090559094e-01   +2.260018404561770e-01   -5.519232494154214e-02   +1.010505927760649e-01   +1.653743378389903e-01   -1.314426333388899e-02   +1.529823046270790e-01; +2.118333441357871e-02   -8.007368535775630e-02   +3.052913868136261e-01   -9.066312214593454e-02   +3.589498479785549e-01   -2.402372503541869e-01   +1.198978421475581e-02   -2.810946773842351e-01   +1.741559243947136e-01   -5.198497095008879e-02   -2.519449045917479e-01   -1.184434317376224e-01   +4.454730609421940e-02   -1.358132524551720e-01   +2.210720713844215e-01   +9.086081366900201e-02; +2.163145497850734e-02   +1.547100527199535e-01   +2.651077146759029e-02   +1.935907848485310e-02   +8.610340054680102e-02   -2.908950739905193e-01   +1.041155110728074e-01   +7.791547181368957e-03   +5.573579869271747e-03   -2.013035732880256e-01   +7.971640931816357e-02   +1.870284327002363e-01   -9.579853990728110e-02   -6.943743686448654e-02   -1.062587212128566e-01   -3.065740728322341e-01; +2.508041988980356e-01   +2.934780983343722e-01   -7.769857723489404e-02   -4.389545757067251e-01   -1.714639504474306e-01   -1.770246025660017e-01   -1.081234237349764e-01   +4.514455743191594e-01   +1.072870841604183e-01   +1.352401277040692e-01   -1.319808045702409e-01   +1.929808147328152e-02   -3.783816250355072e-01   -3.845634329107878e-02   +2.152972732940947e-01   -1.193208641858211e-02; -2.207107653464928e-01   +2.060793231661314e-01   +1.333442286504352e-01   -1.923338759107456e-01   -3.833955240511908e-01   +1.670457866221483e-01   +1.846156217388096e-01   -1.687923241511544e-01   -6.957188695814627e-02   -3.033391404110619e-01   +2.242315596590148e-02   -7.501636482828261e-02   -6.203392879586547e-02   -5.039953386042642e-01   +1.171935330795672e-02   +4.664885483107002e-01];
L1E_L1I_iGABA_netcon = [-5.745176280395208e-01   -6.437377840452338e-02   -1.783080178227797e-01   -1.592159110279307e-01   +3.817526874370293e-01   +6.472936530246692e-02   +5.010435265389324e-02   -2.813693521370989e-01   +4.421945243684930e-01   -2.986827606618745e-01   +5.706835233354862e-02   -2.924037559185323e-01   +1.217515356843068e-01   -1.429402943409356e-01   -3.337933332554271e-01   -6.015287491094813e-02; +2.580066850552915e-02   +4.299784209139815e-02   -2.052758908155621e-01   +3.349201431527740e-02   -3.518153764499197e-01   +4.324741696055407e-01   +6.970302252661620e-02   +1.788893376490666e-02   -2.026567963405518e-01   -1.358036442184309e-01   +3.768508036140500e-01   -6.049428074475161e-02   -4.993188972304912e-01   -1.521154700315779e-01   -2.007358765670526e-01   -1.132210088185213e-01; +9.940466547441662e-02   -1.236170529834083e-01   -1.164509829356844e-01   -4.872402241441567e-01   +7.447188902534180e-03   -9.484122062898417e-02   -2.512315015474910e-01   -2.101695801037239e-01   +8.487271475390788e-02   +3.778213322850623e-01   -3.541132749588466e-02   -5.448317171934129e-01   -2.709973287376732e-01   +7.701820182258397e-02   -1.642999442699745e-01   +2.195337721304888e-01; -1.596295348342788e-01   +1.910725600149703e-01   +3.728581445555022e-02   +3.093221383061137e-02   -3.049394921643819e-02   -2.791669447493050e-01   +7.898082379905393e-02   -2.471547675185795e-01   -2.194167042235166e-01   +3.082797471555982e-01   +2.430383560032671e-01   -9.145921617570751e-02   -9.305532251806031e-02   -1.639409310711534e-01   -2.311526507945503e-01   -2.382991553119754e-02; +3.190126886813064e-01   +8.240555720043796e-02   -5.137857071329731e-01   -6.741675081103927e-02   -5.675859544946357e-01   -1.575065772979669e-01   +8.634846018452932e-02   +6.328286338787412e-02   -1.952792244581395e-01   -1.944041507697785e-01   +4.092544230967804e-03   -6.952333306872026e-02   -3.687803199005439e-01   +1.535315419606237e-01   -5.894242344604353e-02   -4.958301727127509e-03; +3.054053037295908e-01   -5.374653056238320e-02   +7.645135713492512e-03   +4.629370382098856e-02   -1.660775962627695e-01   -1.515066746638704e-01   +2.307118666813752e-01   -3.234519901472938e-01   -1.692358343166883e-01   -1.305526401230136e-01   +3.089196343963594e-01   +8.391934741859568e-02   +5.813466777749100e-01   +1.261631936811945e-01   +1.138882865780526e-01   +5.375008370172933e-02; -9.357348360885720e-02   -1.127272281089223e-01   -4.002522921339609e-02   +1.738592580287157e-01   -5.471690553279323e-01   +4.174294368286061e-01   -5.786749232157724e-02   +7.377138932572883e-02   -2.729239882589057e-01   -7.822409814375483e-02   +6.238623119262130e-03   +7.813992364448891e-02   +3.577767717776433e-01   -1.218199499976054e-01   -1.318413545123136e-01   +3.227057729268747e-01; +1.114164860492887e-01   -3.245442497234523e-01   +4.800053053303579e-02   +2.635973564852457e-01   +2.543281548683091e-01   -9.069214644203408e-02   +3.622476399482052e-02   -2.006755495463619e-01   +1.543027755919983e-01   +1.645570785412217e-01   +1.001103773698699e-01   +6.728035382967269e-02   -2.177602992557043e-01   -3.825070303653489e-01   -1.320087304501745e-01   -4.103076404438619e-03; +1.647178259391475e-01   +8.291747494581989e-02   +3.135664327217252e-02   +2.208933573878433e-01   -2.225242015748392e-01   -1.637541783534771e-01   +2.642110878611335e-02   +9.679188125571037e-02   -1.966831374311449e-01   -3.422315083817375e-01   +5.364909238128790e-01   +1.578971340641084e-01   +2.043259635628847e-01   +1.900521693338026e-01   -2.414233914221565e-01   +5.867301496332721e-02; +1.143357387351325e-01   -1.463897694997468e-01   -2.897907694934332e-02   -1.043221768424801e-01   +4.223272780608310e-02   +3.081232486751427e-01   -3.248365222882139e-01   -7.816728788650737e-02   +1.689244458021886e-01   -9.646873308276854e-02   -1.373961805126670e-01   +2.760058673617343e-01   +4.102412662645816e-01   -2.810092068312715e-01   -2.435430484094512e-01   -2.640785466915361e-01; -3.064575417832475e-01   -5.982292128555777e-03   -3.812963195724614e-02   -1.545131562624301e-01   -4.396480728547653e-01   +8.118623455031850e-02   -4.311763487692710e-01   -2.848682644569637e-01   +7.044583870653168e-02   -2.321758042562823e-01   -1.604331608467993e-02   -1.865579107117617e-01   -2.491167313732228e-01   +5.663900418817182e-01   +3.378416821371073e-02   -1.416381256088649e-01; +1.241773190244468e-01   +1.614817483670916e-01   -7.816158727029357e-02   -2.908042493649183e-01   +3.281232910894981e-02   +5.048126034823783e-03   +2.661224499912337e-01   +7.243709922655085e-03   +1.867082555980111e-01   +3.517846636696436e-01   +1.740577002247025e-01   +2.090317918680567e-01   -1.999860145541190e-01   -4.077927173910431e-02   -1.600251680261139e-01   -6.023847803396104e-02; -8.105887621348846e-03   +9.416859209124254e-02   +6.183605495881103e-02   -3.027049904651609e-01   +4.115243458683810e-01   -5.087881890838038e-02   -3.600637448030634e-01   +5.710849056735219e-02   -1.449336714411804e-01   -2.010273253451243e-01   -1.965841436326478e-01   +2.858886212154652e-01   +2.216045885260334e-01   -6.536886750620946e-02   +3.514749025580852e-01   +4.055412122792517e-01; -1.618116473309948e-01   -3.507195397710053e-02   -1.132492713706723e-02   -4.639700236924699e-01   +8.252945937326923e-02   +9.836141124024916e-02   -1.366518435420875e-01   -5.058864400252946e-02   +1.053604942518799e-01   -3.008254041622772e-01   +8.811086467100003e-02   -4.776063522214348e-01   +2.199440685011125e-01   -1.438736522821861e-01   -2.952889932847769e-01   +2.941591915550471e-02; -3.126541351855731e-02   -2.940292060628471e-01   +8.284010136505304e-02   +7.007960684976385e-02   +1.014992358500921e-01   +1.572652456275211e-01   -1.357288921530257e-01   +8.879919497330456e-02   -6.556081977443534e-02   -1.586671726778085e-01   -1.311293707444845e-01   +6.977431590028502e-02   -1.791219133094670e-01   -4.418034780323010e-01   +2.481848016407502e-01   -6.774251417773837e-02; +1.717279762269493e-01   -4.826957608600491e-01   -1.445116320816622e-01   +3.608950825391610e-01   -4.381050441251185e-01   +6.187305448470724e-02   +2.159737928219163e-01   +4.991999034284435e-02   -5.691229764331496e-02   +1.918315768241502e-02   -8.749249483514827e-02   +2.693760350625769e-01   +2.098200580463578e-01   -3.568860647238448e-01   +1.927815732818840e-01   -4.228627547921269e-01];
L2I_L1I_iGABA_netcon = [+1.002466036655149e-01   -3.302705902137105e-01   +4.016605606115058e-01   +1.555433144849326e-01   +3.305375414000319e-01   +4.952196665673021e-01   +5.039375380035380e-01   -2.415739848496958e-01; -3.081122236549763e-02   -1.249623930796812e-01   +2.852564352466724e-01   -5.676573984377239e-01   -2.010242139413226e-01   +1.814034722909114e-01   +3.988216802611619e-03   -8.623998787916502e-02; +2.054495513349287e-02   -6.902643644844719e-02   +1.682575253454126e-01   -3.708382392546783e-02   +1.187748447637955e-01   -7.861272670485363e-02   +2.121590638387308e-01   +1.439933248672400e-02; +7.180955907687425e-02   +4.488956300708588e-01   -8.294491599756815e-02   +1.820243505408188e-01   -2.227866493744367e-02   +1.892078448033728e-01   -3.685459796050995e-02   -3.359161751894803e-01; -2.308592308922556e-01   +9.597229933287296e-02   +2.412209174017188e-01   +4.138645193359811e-02   -7.629758263970590e-02   -1.034882443326518e-01   +1.743368291389913e-02   -5.495662057732296e-02; -1.143980575483861e-02   -1.370164603935073e-01   -1.037730982446032e-01   -8.191106912376979e-02   +3.071552246390106e-01   +9.796384481868711e-02   +1.469030350630950e-01   +2.386950189508280e-01; -1.869117581029175e-01   +4.957376880282657e-02   -7.189510901629989e-02   -3.907790717285795e-02   +1.074139534129695e-01   -3.217899460206298e-01   -4.435721655249174e-01   -3.866408524865106e-01; +1.423126398548652e-01   +1.617277962626617e-01   -8.415499503836578e-02   -8.255083076694789e-02   -3.623132133695984e-01   -4.212066741885668e-01   -2.453087705618558e-01   +3.754161415553577e-01; +2.221869423192535e-01   +2.053829602089483e-01   +1.733344619218252e-01   +1.341251845197723e-01   -5.412227965892824e-02   +8.531292777508653e-02   +1.432429209395828e-01   +3.202005608213510e-01; +5.796858672993788e-03   -3.115506003248427e-01   +1.712176689137236e-01   +8.300880680764867e-02   -3.512377196007858e-01   +6.960657380368659e-02   +2.462496713624994e-01   -1.879296930743263e-01; +2.371703700868396e-01   +2.803084458108389e-01   -2.858815192725145e-01   -2.955913161523929e-01   -2.896013939525340e-01   +6.121910282902293e-03   +3.106469665080273e-01   +1.986651135048794e-01; +2.435178699537301e-02   +4.648033687999168e-01   +3.539265984548892e-01   +1.828367606072892e-01   -5.372234255833760e-03   +2.176790248248803e-01   +3.037912485864852e-01   +3.630471756411762e-01; +8.453219212978390e-02   -1.173885426980345e-01   +2.220026671974895e-01   -4.039849293501463e-01   -1.297238306956221e-01   +2.412479369475415e-01   +6.865195205375250e-02   +1.260901515272873e-01; -1.596575738069280e-01   -3.502367877678511e-01   +2.098977164051314e-01   +1.039381174253013e-02   -1.351511495789656e-02   -2.000399417438563e-01   -1.606297754023261e-01   +4.442717482617822e-01; +6.172465774820973e-03   -4.176639562704628e-01   +2.763373745172146e-01   -3.851757980270674e-01   +2.471369719052552e-01   -4.147807320204577e-02   +2.634815350111532e-01   +3.744486818612469e-02; +1.303265765506965e-01   -2.715533759176660e-01   +1.783549603945563e-01   -2.526562956072838e-02   +1.366279671940896e-01   -3.246417307358889e-01   +3.784657278119241e-01   -3.992891948512725e-03];
L1I_L2I_iGABA_netcon = [-6.566422764476264e-02   -3.585030380938977e-01   -5.916231656543733e-01   -1.076915064165735e-01   -1.807839973348470e-01   +2.086085526990433e-01   -1.887859068127611e-01   +3.471771317654893e-01   -5.209440383072573e-01   -6.416196719305259e-02   +5.812262066301760e-01   -1.478857468537403e-01   +2.682704375416969e-01   +8.825993343756842e-02   -1.573272583257872e-01   -5.173981176869351e-02; -1.866801480134901e-01   +2.191491736773021e-01   +3.343985189814110e-01   -3.568325963373059e-01   +5.351840800587623e-02   -3.517034572074161e-01   +1.047688625714825e-01   -5.822595901886591e-01   -1.986641741745501e-01   -3.080750316106559e-01   +1.197569306555551e-01   +3.012544647785464e-01   -2.231861033275465e-01   -2.308361965023154e-01   +1.507355352424988e-01   +9.829072222290176e-02; -1.092425252376100e-01   -1.292008285693976e-01   -2.521280782282679e-01   +8.058269850649968e-02   +1.367605160914645e-01   +1.674319338562982e-01   +6.480492665954429e-02   -2.782984091724532e-01   +2.267823585688806e-01   -5.399592798139596e-02   -1.809174081157791e-01   -1.227758492876107e-01   +1.198205646909899e-01   -2.225389756968613e-01   +1.224839408882255e-01   -1.941794330729804e-01; +4.090259821744676e-01   -3.867241834881532e-01   +4.020521505777887e-01   +1.373784696352762e-01   -4.483291593891747e-01   -1.409332089447388e-02   -2.710448868190201e-01   +2.013373106835219e-01   -3.111828609574972e-01   -2.257245841253875e-01   +2.447806242097169e-01   -1.186640812792933e-01   -2.125852204079860e-01   -8.615878410134270e-02   +2.779196080654780e-01   +1.846261226566844e-01; -6.089390015197546e-02   +1.913234384900067e-01   +3.962673962763724e-01   -3.590567119643650e-02   +9.340528113627422e-02   -2.230069629464380e-01   +2.872276094673393e-01   +4.515571374917123e-01   +1.439061717701474e-01   +8.607107927196982e-02   -4.319311587389656e-02   -1.044172662087381e-01   +5.129924947820694e-02   -1.013458425077032e-01   -1.793270832873823e-01   +2.970203117403430e-01; -2.777235185471211e-03   -2.041554821871053e-01   +2.844257749279799e-01   -3.295930595301220e-01   -3.508453822285568e-03   +1.639137317671975e-01   +4.411556289583625e-01   +5.236792106969859e-02   +5.574423246289632e-02   +1.169597999079588e-01   -2.018770521428631e-01   +1.465218787955085e-01   +1.694074017841912e-01   -3.064875236516090e-01   +7.879496634391935e-02   +1.780719627005490e-01; -4.416649668222866e-01   +4.939537836839070e-01   -1.706538633867445e-02   +4.020994399933204e-02   +2.433016659370183e-01   +3.452933534015108e-03   +7.428191572894018e-02   +1.847614163242053e-01   +1.028628997940992e-01   +1.281078343240790e-01   -2.034203348231117e-01   +4.273430221995947e-01   +1.741393236151254e-01   +4.488816866662064e-02   -3.148611671063365e-01   +8.276972572914951e-02; -1.196002239694728e-01   -1.202019942549546e-01   +2.210721127839566e-01   -1.700396079302742e-01   +3.989054939834528e-01   -3.912718738113863e-01   +2.627903813699916e-01   -1.327055786630743e-01   +1.982605948191818e-01   -1.315659430310072e-01   -5.164884737026003e-01   -1.234847010863440e-01   -2.893529644207286e-01   -1.698630143576567e-01   +1.149388521572814e-01   -3.047462304409689e-01];
L2E_L1E_iAMPA_netcon = [+3.696969621886585e-01   -1.623225585967588e-01   -3.198360380706232e-01   -6.321179866486920e-03   -4.617460930381734e-04   +1.153991914637373e-02   -2.431400209602335e-01   +2.377648397800323e-02; +2.025681915355917e-01   +1.146303508375644e-01   +3.413392307433196e-02   +1.343667754819908e-01   -2.327495839998708e-01   +2.084206140684369e-01   -1.704701449939269e-02   +3.349895969996521e-01; +3.527831450509018e-01   +2.766975309194913e-01   +4.895370128087157e-02   +3.533300570523598e-01   -8.257090669349892e-02   -1.141432901135459e-01   -1.754297112533454e-01   -1.705346274876037e-02; -3.834591819615946e-01   -7.042925637575637e-03   -1.920217748046480e-01   -1.428517810529481e-01   -1.558306228420780e-01   -3.327609570041180e-01   +1.747381296785283e-01   +2.950227809767652e-02; +1.062305764937987e-01   +5.627504378090403e-02   -2.346211047147919e-01   +9.593546190486694e-02   -8.877399838214194e-02   +3.336010786301410e-01   -4.226122637502559e-02   -2.509912190716620e-01; -9.197992945784637e-02   -2.967945222913724e-01   -4.474040614792635e-02   +1.393760990446366e-01   +1.581924280341750e-01   +1.316994682418014e-01   -4.040710029065923e-02   -1.135345948697615e-01; -3.407191897623625e-01   +6.464832623724950e-02   -2.121618262632913e-01   +8.869593969871428e-02   -9.773783792532841e-02   -1.251108412310971e-01   -3.303856362270169e-01   +2.023381709857447e-01; +2.858705377754150e-04   +2.866556323250931e-02   +1.411745556146820e-01   -1.441464322460561e-01   +4.210599045003909e-01   -7.423875644215287e-02   +3.686067013175373e-02   -4.430620217319703e-01; +9.095466324451448e-03   -1.752672171121945e-01   -1.465660395490516e-01   -1.059739313443691e-01   +1.681010736336101e-01   +6.229172793913583e-02   -3.641098629279614e-01   -3.199465122323812e-01; +8.569539927206990e-02   -1.805052046146307e-01   +2.267907781049526e-01   -3.352179548728644e-01   -2.428823467859259e-01   -1.573999997467501e-01   -1.859573063136811e-01   +2.969376744833194e-01; +2.243705692785296e-01   -1.172575841276758e-01   +1.762536427726418e-01   +1.422359007092633e-01   -3.742796313070438e-01   -1.469991471531701e-02   +7.797583899330335e-02   +2.498569834823522e-01; +6.069950584371805e-02   +1.286830391113363e-01   -5.918526063289631e-02   +1.056440962399853e-01   +1.836252533839943e-01   -3.750507475481980e-01   +1.110451235861300e-01   -3.874695855986073e-02; -9.615325955495299e-02   -3.222152491674135e-01   +6.381818521848190e-02   +2.257616188633548e-01   +3.889221798676983e-01   -5.442925597830575e-02   -1.500274439314629e-01   -3.959816064282303e-01; -2.297982534785832e-01   -1.235020870358188e-01   -3.579678060637667e-01   -4.734977470862336e-01   +2.139745627397966e-01   +4.169386552683746e-02   +1.165169074235018e-01   -2.754872096420093e-01; +3.466648627458302e-02   +2.633347150887633e-01   +8.318438604019496e-02   -2.268632401966795e-02   -3.040755963212587e-01   -6.930186214062792e-02   +7.660553506993364e-02   +2.086213378783590e-01; -1.344566744422412e-01   -2.695059597117774e-01   +1.513191493618685e-01   +1.980262165425533e-01   -1.650766439648134e-01   +2.960080324883228e-02   -5.006608803132946e-02   +3.664805235643965e-01];
L1E_L2E_iAMPA_netcon = [+2.836402036370622e-01   -1.724307330860585e-02   +2.284772831049813e-01   +2.681518440567743e-01   -1.995465550490990e-01   +8.161269828697482e-02   -1.781651514515318e-01   +6.095306682971099e-02   +6.258664280622761e-02   +2.561101092757294e-02   -7.594184839594517e-02   -8.439498374440463e-02   +8.941654941213070e-02   +2.292951698885219e-02   +5.252022113437849e-02   +5.748599900684631e-03; -2.346350730446195e-02   -5.060903978498302e-02   +1.854753469801854e-01   +3.936442089544365e-01   -3.388664093353566e-01   +9.071157719396405e-02   +6.556050253695198e-02   -3.144904351760308e-02   -1.027929522614414e-01   +4.074794172642577e-01   +2.628195923512820e-02   +9.353653614782623e-02   -5.757809274659630e-02   -2.113159466618545e-02   +4.007598270075868e-02   -6.820053782577426e-02; -2.663156825401315e-01   -1.697674126128530e-01   -1.177604070183435e-01   +1.448901798898481e-01   +4.419058741363412e-03   +8.038546782167902e-02   -3.909995026136837e-02   -2.762811010923668e-01   -9.035760685262892e-02   +3.242926296411198e-01   +4.171931166707843e-01   -5.084436275422838e-02   +9.313673415530846e-02   +3.860415580647761e-02   -1.199607398570243e-01   -1.321584395965426e-01; -3.104417356621263e-01   +6.315664389857083e-02   +2.204773836302773e-01   +2.281552429616744e-01   -1.068032335744981e-01   -7.027272509561064e-02   +2.377511792460477e-01   +6.097288742373688e-02   -3.865520491882377e-01   -1.059387688950561e-01   +1.860406412083671e-01   -2.491462697821555e-01   -1.146236135954394e-01   +1.174763069538202e-01   -2.196597172628006e-01   +2.621383972158820e-01; -1.085381513612192e-01   +2.954073341434269e-01   +3.369917299263417e-01   -1.580506680343233e-01   +2.245472612603187e-01   +5.934926838405269e-01   +3.198492244398986e-02   -3.477734137215273e-01   +5.349280231644502e-01   -1.984968929215823e-01   -1.256104282541942e-02   +1.639238522244189e-01   +2.515685934430207e-01   +3.461208136916437e-02   +4.266168199715833e-02   +7.723608650366184e-02; +2.070233802851009e-01   -3.457139430253489e-01   -1.647337648861831e-01   -1.194332173607508e-01   -1.492149997074873e-02   -1.730855891394966e-01   -2.152669127263222e-01   +7.962272999296621e-02   -4.589785544163048e-02   +4.596861404939728e-01   +1.509202662961289e-01   +1.563416427609856e-01   +1.640655655903053e-01   -1.670371555523009e-02   +1.052018301850944e-01   +1.942121479228308e-01; -5.851601100314678e-02   -6.842814994371420e-02   -9.055492120089950e-03   +3.875613909960995e-03   +3.550150045848566e-01   -1.747039217447128e-01   -2.995047262904602e-01   -3.044928157323162e-01   +1.835907943285531e-01   +2.811370018530779e-01   +2.383500085574955e-01   -4.130581537068659e-01   -1.377182831560922e-01   +8.792388813473140e-02   -8.997257475117634e-02   -2.286279069927621e-01; +1.149271175433458e-01   -3.702807241824000e-01   -1.694389063037604e-01   +1.851114957831484e-02   +1.004057712327664e-02   -3.433343861453625e-01   -1.358525868551744e-01   +2.414369543504892e-01   +3.528631662159433e-01   +3.792797794239059e-01   +2.935341116657700e-01   -3.308593169037052e-02   -6.137297497614095e-02   -1.566568356604500e-02   -1.387436034923588e-01   -1.520479876543173e-01];
L2I_L2E_iAMPA_netcon = [+4.623303624150248e-01   +2.000920400299661e-02   +1.419822334789691e-01   +2.317594986067318e-01   +4.169120588340517e-01   +1.397394096487772e-01   +1.612148403793928e-01   +2.116201210997648e-02; -2.138292649682274e-01   +1.762390750502486e-01   +2.312732386209469e-01   -9.395229936995574e-02   -5.390655086105130e-02   +1.514327938698486e-01   -3.135896936383467e-01   +3.200503997806889e-01; -1.133536825741626e-01   +8.562310440300158e-02   -6.929495387919969e-02   +3.272789705411270e-01   +1.176067745377026e-01   +4.711074700888330e-01   +1.671803331570486e-01   +1.222235484035565e-01; +4.275575770304390e-02   -3.905005122914379e-01   +1.020464136212354e-01   -5.357984894997911e-02   +4.793076672660097e-02   -1.171740132672347e-01   +4.284774003760311e-02   -8.479122970965194e-02; -3.628669023305997e-03   -1.494671258616081e-01   -2.382075520156714e-01   +3.215855675329614e-01   +3.092695982964334e-01   +1.720584877691983e-02   -2.138101710121763e-01   +4.403873703892783e-02; -1.131287543592987e-01   +3.270868819695822e-01   +7.460212607555458e-02   -4.539114701690689e-03   +2.171563609752680e-02   +2.321394028230435e-01   +1.329489734717681e-01   +9.816066389693079e-02; +4.041025378209613e-01   +1.475854516413340e-01   -2.661820816943258e-02   +4.001181963726321e-01   -3.295386464417663e-01   +1.424752702282761e-01   -1.189613026072449e-01   -6.817076410033689e-02; -1.236155954606236e-02   +7.091471587897415e-02   +1.178204831358857e-02   -2.725588695830787e-01   -2.782800826394455e-02   -4.319867709611488e-01   +2.020193110155788e-01   -9.628844208430706e-02];
L2E_L2I_iGABA_netcon = [+1.339201948910386e-01   -1.795905134284926e-01   +2.889129889813138e-01   -1.217170669081657e-01   -2.113905519820147e-02   -4.251105154711382e-01   -3.276399582379533e-01   -3.296622838590976e-01; +3.965952761573671e-01   -2.041972535783364e-01   +2.078625495398485e-01   +2.206079076174586e-01   +4.089238205736497e-01   +4.585980854749955e-03   -3.705383257482781e-01   +2.161926145807958e-01; +1.136983814241917e-01   -5.287263950324694e-02   -8.949161464446133e-02   -3.088998273165682e-01   +4.756233297168471e-01   -5.152126789209899e-03   -1.200990258338133e-01   +3.170726537372905e-01; +3.775966554744011e-01   -5.487709429993036e-02   +3.406541094606851e-01   -2.053402591476043e-01   +8.930863963139081e-02   -1.374707273534168e-01   -3.416435407943987e-01   -3.420485388359544e-01; -1.895109432777202e-01   +1.520814513824756e-01   -2.440603369192558e-01   -2.199316401093408e-01   +1.017455020369505e-01   +1.127350076540544e-01   +2.558264845776483e-02   +3.632912112783506e-01; +3.138091799046975e-01   +2.337503704827113e-01   -7.510599875719379e-02   -1.473162327817189e-01   +2.747172865171869e-02   -2.199608067840977e-01   -2.126320490779380e-01   +1.720317511639861e-01; -4.038781254910255e-01   -4.574076315896363e-01   +2.474824027556704e-01   -8.795618790551299e-02   +3.198873358545075e-02   +3.737186826638269e-01   +2.919817573876817e-01   -7.468683909344155e-02; -2.156425396719949e-01   -4.196482659274992e-01   -4.383576865570358e-01   +2.330608623257830e-01   +2.016388223508656e-02   +1.461330518189040e-01   +1.390790609517051e-01   +5.702575188170173e-02];
L3E_L2E_iAMPA_netcon = [+3.056272644864148e-01   +6.985242240389877e-02   -1.611669679999652e-01   -1.460595699770214e-01   +1.930361600909771e-01   -3.113778715358868e-01   -2.413550102067436e-01   +4.415254602313223e-02   -2.777476200677543e-01   +3.555178844110993e-01   -1.002933320749039e-01   -3.088067763921132e-02; +3.960469630377150e-02   +1.230356260810079e-01   +5.878828509111380e-02   -1.998619521532366e-01   -1.320527036146877e-01   +3.034259423759206e-02   +3.715163397758811e-01   +8.715289396099300e-02   -2.959589344124354e-01   -4.490199835345683e-01   +1.346827657089892e-01   -1.924054683689879e-01; +2.245338655481349e-01   +3.974780539038826e-01   +3.353134054256705e-02   +2.747808575314789e-01   -2.044460915064991e-01   +3.491645084362475e-01   -2.422331016771458e-01   +1.294074889003251e-01   +1.270889747675168e-01   -1.157722622576207e-01   -1.177671741391645e-02   +2.001270977366057e-01; -1.611286780833814e-01   -2.634344363994207e-02   -2.788595400511389e-01   -2.179273112580325e-01   +4.022943992174497e-01   +4.193196196984949e-01   +4.162580666361862e-02   +2.750900974142850e-01   -1.384633679986394e-01   -2.769086911093309e-01   +2.594133892677618e-01   -3.197607105692808e-02; -4.493215273560754e-01   +1.749872019412700e-01   -2.239038422873269e-01   +4.202899558140449e-02   +1.858139575595998e-01   +3.146765907516964e-01   +1.141277098736735e-01   -4.294601676442923e-01   +1.177320979495078e-02   +1.979841063372177e-01   -4.284478798582777e-01   -2.246670115162293e-01; -4.345507480007124e-02   +7.537099741247155e-02   -8.540267644376820e-03   +3.359284251169489e-01   -4.333669806593351e-01   +3.311151439718693e-02   +7.540585558784499e-02   +2.863567199823535e-01   -5.702198583975258e-02   -4.484482583049730e-01   -2.243901232239139e-02   -1.513495206554536e-01; -2.547852496103790e-01   -1.152982053156586e-01   +2.821420326169678e-01   +2.181147803300466e-02   +2.896561294406095e-01   -3.795610951408336e-01   -6.363546184083962e-02   -1.780165242268604e-01   +2.160500073630751e-01   -2.473332973254190e-01   -3.345372407986519e-01   -2.508905569358200e-01; -2.699335907276268e-01   +3.502586497092932e-01   +1.331294573045009e-01   -3.439836003966438e-01   +1.897446259217877e-01   +1.024864331942390e-01   +1.284401275149087e-01   -2.868625551023119e-01   -1.958480368606799e-01   +6.780102498670462e-02   -2.265665005316168e-01   +6.653816434893484e-02];
L3I_L2I_iGABA_netcon = [-7.175621869928965e-02   -1.426560802664045e-01   -1.159732652614702e-01   +1.757068592350022e-01   -2.106084783007693e-02   +4.181859182997502e-02   -4.762890047700344e-01   -8.087432836975100e-02   +1.072083699070782e-01   -3.404710746456629e-01   +9.318240154639014e-02   -3.169772312129444e-01; -4.472916728329336e-02   +1.788766360208209e-01   -5.368439372791600e-01   -5.912688016090789e-02   +2.421163009945871e-01   +9.954279748134197e-02   +1.073210453258437e-01   +1.188892233216903e-01   -5.026230385298013e-02   +7.532531829635446e-02   +1.046764942190699e-01   +2.393476917801017e-01; -2.628403996658277e-01   -2.989613466246720e-01   -1.545537475300077e-01   +2.159797817701197e-01   +1.377061411206719e-01   -1.213150093143110e-01   -2.668552423373222e-01   -3.226917608594602e-01   +1.974246385331104e-01   -1.781728796019108e-01   +1.658301436076385e-01   +4.239463413719856e-01; +4.171776048912554e-01   -2.758643334672282e-01   +3.864107692839430e-01   +2.630795764441183e-01   -2.703433439512649e-01   +3.738260702317163e-01   +4.845413065841203e-02   -2.346931818333695e-01   -2.415770807459228e-01   +9.665643895177299e-02   +5.369979188906587e-02   +7.407854117165383e-02; +2.086883921849392e-01   -4.453487697677629e-02   -6.261160838553043e-02   -7.597007375643740e-02   -2.552304377829241e-01   -2.068829969756832e-01   +4.143050021105781e-01   -8.634448257994055e-02   -2.208215546702662e-01   +3.684512439219621e-01   +1.681730969396916e-01   -2.578302709940680e-01; -4.590717823857968e-02   +3.209675337931465e-01   -1.079954512903631e-01   +1.890255546116325e-01   -1.190125551025006e-01   -3.828242577565260e-01   +3.304493995381133e-01   +6.733838062253658e-02   +5.286086547943611e-02   +1.291979476602967e-01   +3.189443749613985e-01   -8.242118511627525e-02; -3.435027637863872e-01   -1.575628719804370e-01   +1.985714771328070e-01   +1.086966961727590e-01   -2.449459128271886e-01   +4.147715586134172e-02   +1.728605682579327e-01   -3.160370375751326e-02   +1.609168716710102e-01   +2.740613948286824e-01   +2.013096053580864e-01   -3.452739421358288e-01; +2.077448871824277e-01   +1.647604486484923e-01   -5.999530188874273e-02   -7.458150660914087e-02   +6.338585759694026e-02   -5.655071195231301e-02   +5.389558471859215e-02   -2.238892520849374e-01   +2.237802588784335e-02   +1.759577620442018e-01   +1.179928912200380e-01   -1.024314999239578e-01];
L2E_L3E_iAMPA_netcon = [-5.735559889901373e-02   -2.033096390860524e-01   +4.705508485563199e-02   +2.763822366070658e-01   +1.411828492939735e-02   -1.137393948536112e-01   -7.343566642532173e-02   +3.288284752205471e-02; -5.373176461699025e-02   -1.600041338431265e-01   +1.366252252131261e-01   +5.226599912760241e-01   +5.658700109863843e-03   +8.263052467565399e-02   -1.005987491884085e-01   +1.301550753288877e-01; -1.579399067067294e-01   -1.976497389700341e-01   -2.876999214468546e-01   +1.051391074210766e-01   -4.255521577650844e-02   +2.621873792217089e-01   -1.589914821740078e-02   -1.033235113287762e-03; +8.773372574359761e-02   -1.168717843627175e-01   -2.267215840763765e-01   -2.695351469990013e-01   +8.866623749030353e-02   +3.159551355250108e-01   -2.401804556042143e-02   -3.069471353143292e-01; +8.909982189037705e-02   +2.129066150015042e-01   +3.003511848343404e-01   +9.026444652938968e-02   +1.612759567656084e-01   -1.369890376127094e-01   -8.261300504450839e-02   +1.201931456829744e-01; -7.020936317713869e-02   +1.040817194165968e-01   -8.792440525137729e-02   -1.620353919423506e-01   +9.491330613349899e-02   -3.566541092638039e-01   -2.669464035618521e-01   +2.644938168558038e-01; -8.466352279828671e-02   -4.875893469529474e-01   -1.428856351339599e-01   -2.578674771141758e-01   -5.775209357337677e-02   -5.336192302684588e-02   +3.165785712664954e-01   +1.727051741829832e-01; -1.448092921688394e-01   -2.956326396938097e-01   +4.455750580558764e-02   +6.280418944838653e-02   +1.322774704670541e-01   -3.681743262116458e-01   -3.408834108746318e-02   -1.943453871730176e-02; -2.177374202657892e-01   +2.865166304591802e-01   -7.694684713962829e-02   -8.039336376951206e-02   -1.365740143965446e-01   +2.097292764501117e-01   +2.279212535174302e-02   -6.819350850621243e-02; +3.397631514823107e-01   -2.546774782267553e-01   -2.770417126601368e-02   -7.485306556082774e-02   -1.221053954301181e-01   -5.529806943314827e-02   +4.543242794866521e-02   -2.408389036639962e-01; +1.171234167383706e-01   +2.184546574793357e-01   -1.984549738824348e-01   +2.271789447218907e-01   -4.831960512572767e-02   +5.328795814424198e-02   -2.389387693521056e-01   -1.866289255300362e-01; +2.330467857828291e-01   +6.583420090894523e-02   +1.410786160126070e-01   +2.176617619677224e-01   -3.938434512415654e-01   -3.474015816549022e-01   -1.253278467475026e-01   +1.540014361604667e-01];
L2I_L3I_iGABA_netcon = [-7.370050499971138e-02   -2.086153894080142e-01   +1.690872134268032e-01   +5.626613409659480e-01   +4.816755623627300e-02   +1.367628651260915e-01   -7.035546479011254e-02   -2.461545022061579e-01; -1.263414798229505e-02   +4.612111378735936e-02   -2.544562219825222e-01   -4.111484310249242e-01   -2.764605067806729e-01   +2.251167744977535e-01   -2.787938373865383e-01   +7.406233628702050e-02; +2.525500357275543e-01   +1.665515390719939e-01   -3.747782492839581e-01   +1.524706581015187e-01   -1.010666839526069e-01   -3.672140808045536e-01   -2.319924455875010e-02   +2.182228006179297e-01; +1.620324213459690e-01   -1.378925228825771e-02   -4.797916127682972e-01   -2.099625890903713e-01   +3.554139116414088e-01   +4.050471526854399e-01   +1.048209333849854e-01   -3.657031021048722e-01; +8.281754872283413e-02   -6.687604134191415e-03   -8.218469040571239e-02   +5.571651997523527e-01   +1.586008498567033e-01   +1.965050246122044e-01   +4.171852604940400e-01   -5.887723677386902e-02; +1.827841774674109e-01   +1.578778639715225e-01   -1.674653048922535e-01   -3.266985271108933e-01   -2.439411212558040e-01   -1.832629864902253e-01   -2.492804374485738e-01   +1.269476980522412e-01; +1.257315408506107e-01   +2.851183837194466e-01   +1.132977006389646e-01   -8.390771898616022e-02   +8.434540693608635e-02   +3.487373122083854e-01   +1.875204455070253e-02   -2.114508082189711e-01; +3.618014563054379e-01   +1.081425846914592e-01   -6.913195677256521e-02   -5.861642902083575e-02   -4.603146944164052e-02   -4.069689526768013e-01   +1.777496480968889e-01   -3.931356758350182e-02; -2.611716513640641e-01   +3.553452414895183e-01   -2.733044054719788e-01   -4.237280645894562e-02   -6.200115966336106e-02   -1.144715768323576e-02   -1.540953806893761e-01   -9.820557858885767e-02; +4.092250084048169e-01   +2.684612595069702e-02   -2.475938506066815e-01   +2.704690945718868e-01   -6.507279740308465e-03   -1.460204762994443e-01   -2.048459465435280e-01   +4.203087112241053e-01; -1.465617723475575e-02   +1.442081504201124e-01   -3.932478484185289e-02   -1.903023175624161e-01   -7.207176860561873e-02   -1.878923661090740e-01   -3.615349961746543e-01   +1.373089096065920e-02; +3.045834115477332e-01   -4.716981628093932e-02   -1.076114087412331e-01   -1.254171200686623e-01   +3.202443349951045e-01   -1.450677284485487e-01   +4.479094662786354e-02   +2.894481132915354e-01];
L3I_L3E_iAMPA_netcon = [+1.693289985125959e-01   +2.826075662995658e-01   -3.635950629589727e-01   +3.710106328072034e-01   +2.821662736001737e-01   +1.111350085589700e-01   +1.388784736818725e-01   +1.859373036545334e-01   -4.322121151220917e-02   +3.761024200380652e-01   +2.186911596798420e-01   -6.410120202151659e-02; +3.477974175166648e-01   -2.768324121457887e-01   -1.283348483280370e-01   -2.455226740360114e-01   -2.742460301522028e-01   +4.427819497755343e-02   -1.195475573703813e-01   +2.104349318459041e-01   -2.746437945731125e-01   +5.808974053281010e-02   -1.140248177369058e-01   -2.036260302119266e-01; +1.717831702925867e-01   -1.305972190714721e-01   +4.226912002657737e-02   -1.188934625015690e-01   +1.009102592497559e-01   +4.019549242427753e-02   -1.238505000291371e-01   -4.402675201433940e-01   -2.423741608457634e-01   +2.827106967790047e-01   -1.943087203943015e-01   -4.583867499972722e-01; +1.246813080133585e-01   +2.203771831474360e-01   -1.864496774065394e-01   -1.752993275578175e-01   -1.849889903353014e-01   +3.820162080731786e-02   -5.698949725237768e-02   -1.554100793956274e-02   -1.260745837916671e-01   +1.651832164556805e-01   +5.037579303833207e-01   +2.313569227500849e-02; -2.619538673609029e-01   -4.198771698312803e-01   -7.064849684815580e-02   +1.248056133302209e-01   +5.631654861192838e-02   -1.670467423072126e-01   -3.007049057866195e-02   +9.255184048308814e-02   -1.381402235804878e-01   +1.835048034342665e-01   +5.222869501120494e-02   -2.505238838074597e-01; +1.445178177720537e-01   -2.116957888540646e-01   -1.545186822132590e-02   +8.545470271436020e-02   +3.495284699100888e-01   +2.655586639604844e-02   -3.960446920485270e-01   -8.260872271951303e-02   +4.669637509976884e-02   -2.323069253893138e-02   -1.704735894263825e-01   -1.419020508853838e-01; -1.265839857685326e-01   -1.102964482614202e-01   +1.657074193973392e-01   +3.262802577530322e-01   +1.256567283060585e-01   -8.903829536304432e-03   +1.415196792207332e-01   -1.942625949192552e-01   -2.115919324989663e-01   -7.779612404188803e-02   +2.240731338167868e-01   +1.528282246038264e-01; -6.929176959885736e-03   -7.060120144581544e-03   +2.732740146148011e-03   +2.835283013211878e-01   +2.073690757129189e-01   -2.162806555196633e-01   +1.808499688780996e-01   +2.036953782242716e-01   -2.406101572726008e-01   -4.548853932589367e-02   +2.266119650712250e-01   -3.983159967038304e-02; +1.914975673165726e-01   -2.362376612596067e-01   +3.778882106802073e-01   -5.121541293985514e-02   -1.356298031985118e-01   -1.266315981373607e-01   +1.749937157971125e-01   -2.423836017473178e-02   -3.437535476225388e-01   +1.293527914267265e-02   -2.613824897024498e-01   +1.951919515229341e-01; +1.707016098512853e-02   -1.618111939152622e-01   -3.064522578628447e-01   +3.329337851373712e-01   -2.349714518636456e-01   -3.637702092005624e-02   +1.018719217355768e-01   +1.923448187871369e-01   +3.685804558702969e-01   -1.663717454378402e-01   -2.084094478126410e-01   -4.314874728269534e-01; -6.997216718810512e-02   -4.152776691055304e-01   +1.114637000345194e-01   -4.174888967118456e-01   -1.812929866480107e-01   +2.516953753416174e-01   +3.170826015231419e-01   +2.773923770040984e-01   +2.735475042316932e-01   +4.948274134634682e-02   -2.727560105296299e-02   +4.449480858346262e-01; -1.969929812545613e-01   +2.848630294072155e-01   +3.383931567445708e-02   +3.429909468476036e-01   -2.606788936075813e-01   -1.431447372808678e-01   -1.474368499507448e-01   +6.025520373283161e-02   +1.490595225204502e-01   -2.473626955302964e-01   +1.596535894012373e-02   -2.038740212179809e-01];
L3E_L3I_iGABA_netcon = [-1.599638183729544e-01   -1.667609511196812e-01   +3.423775306777482e-02   -6.675411090057037e-02   +2.362354823301494e-01   -2.197626815657565e-01   +3.684024961988289e-02   +1.795952856392942e-01   -2.547347523851741e-01   +3.787089292732798e-01   +1.464663747851227e-01   -1.612890899918005e-01; +2.445597361728348e-01   +1.509877174155180e-01   -1.665591997683560e-01   -2.219345311593886e-01   +2.359548371617437e-01   -1.069194219299815e-01   -1.586183733211560e-01   -3.069012051799498e-01   +5.768592118416069e-02   +1.689120210331037e-01   +1.094269878270016e-01   +4.725175624926927e-01; -2.190850400500682e-01   +1.628647670171983e-01   +2.457459245081885e-01   -1.522297195397670e-01   +2.929632289596252e-01   -1.877477300109513e-03   -2.522052212526241e-02   -2.791371012253072e-01   -8.813562116227500e-02   +2.415547290594471e-02   -3.091284007753456e-02   -3.957665817927011e-02; +2.576790532944105e-01   -1.775043523762101e-01   +7.961124698018941e-02   +2.518931481482308e-01   -2.577708555737339e-01   -1.938974309411446e-01   -3.218460826457220e-01   -1.968634615613165e-01   -1.500007180930787e-01   +1.943195326088933e-01   -1.164631894870579e-01   -7.548956892044179e-02; +7.144769146610846e-02   +5.607810375835143e-02   +1.448887905965519e-01   -2.504575724750310e-01   +2.136567723724911e-02   +2.715636252920768e-01   -2.222763209856033e-01   -1.406776886443870e-01   -5.394940806657969e-02   +1.175554028948672e-02   -5.596815559156607e-02   +2.241076241634096e-03; +5.722291095481591e-02   -8.333804916692164e-02   -3.491026130945157e-01   +3.542164670374179e-01   +2.223929090585454e-01   +1.968468493267122e-01   +4.176800974411901e-02   -3.807734508833869e-01   +1.998506349086565e-01   +3.052459723795808e-02   -2.629350842687274e-02   -1.870299545158914e-01; -3.647363374161233e-02   +2.182086350065302e-01   -9.806116676596810e-02   +1.213370778883785e-02   +3.666427506353538e-01   +3.954982116218549e-01   +3.411848814533410e-01   -1.052589954788587e-01   +1.462494836676433e-01   +8.580049802238504e-03   -7.054154788916910e-02   -3.344775424415984e-02; -1.283853058033617e-01   -4.515544714904028e-02   -1.992301750055167e-01   +3.838484228161129e-02   -2.149191378670471e-01   -1.870451826058019e-01   -1.021220661838127e-01   +5.192017150554724e-01   -3.446878941676439e-01   +1.419196694689695e-01   -1.405991238824125e-01   +3.641145268332729e-01; +6.293155384830276e-02   +7.956289453023188e-02   +1.568846351124403e-01   +2.102014778280336e-01   +2.167729871128082e-02   +8.417419776174009e-02   +3.700814376790854e-02   +3.086753336779349e-01   +3.655379576948876e-01   +5.298878191096897e-01   +2.304342869921840e-01   -1.744531897109840e-01; +5.465709871229070e-02   -9.794318261694672e-02   +2.026360702358094e-02   +1.230992342700324e-01   +5.140134933594517e-01   -6.584185838663449e-02   +9.525866563450804e-02   -3.851178053204707e-02   +3.190372595554185e-02   +9.731177874871091e-02   +1.534619833077011e-01   +9.678809648773792e-02; +1.382579490462719e-01   +3.961881865791355e-01   +2.162502148494633e-01   +5.275158666280189e-01   +9.068099789671513e-02   -1.168686811317136e-01   +6.735010762649912e-02   +3.210710988122433e-01   -1.996679173065122e-01   +2.733893638804837e-01   -4.186995375922057e-01   -2.054081442897015e-01; -2.469555422323830e-01   -2.998784757302368e-01   +3.850726829991803e-02   -3.667969595382876e-01   +8.783618355568833e-02   +2.207797373548813e-01   -8.768600296577556e-04   -5.569135111089789e-02   -2.142477492371346e-01   -2.001967718327154e-01   +1.513630233510952e-01   -1.653845123503644e-01];
L2E_Input1_iAMPA_netcon = [-3.693124165299415e-01   -1.042264598386424e-01   -3.703837409416602e-01   +1.412343327964756e-01   +3.870594502929861e-01   -4.068745665976101e-01   -4.439871390517400e-01   +1.016565036350497e-01];
L2I_Input2_iAMPA_netcon = [-2.603243959284814e-01   -2.192979470707918e-01   -1.840104129783888e-01   +2.842838177386052e-01   +7.491173207074460e-02   -4.615484096810461e-02   -8.451514407877225e-03   -1.958088318528564e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
