function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.115832293461046e-02   -1.357061228594713e-01   +4.062710157033349e-02   +5.093235111102221e-02   +1.380230510872430e-01   -2.582706321007519e-01   -4.985472932632388e-02   -2.515634143058372e-01   -1.995845404362980e-01   +7.205448527909737e-02   -3.527856657721212e-01   -1.542297376605752e-01   -3.536844524628820e-02   -1.815873783053449e-01   -3.279595503047616e-01   -4.152248161419982e-01; +4.279393944806330e-01   +1.279401889359329e-01   +1.285438760439352e-01   -2.246385021223019e-01   -1.714257072750970e-01   -2.177081905715833e-02   -1.453740205387419e-01   -1.459971324096583e-01   -2.338038701136056e-01   +2.845883166881688e-01   -1.380755933962269e-01   +1.199595444418857e-01   -2.694202730008693e-01   -3.284223801370979e-01   +3.385659080916962e-01   +2.448360062480031e-01; +1.089269009987767e-01   -1.256703313448825e-01   -2.291649323509193e-01   -2.629288818278517e-02   -3.066189628415124e-02   -3.643299797280570e-01   +4.290087410384698e-02   +1.816245614304092e-01   -3.844791072841697e-02   +5.623250727389294e-02   +2.774285336038315e-01   -3.568998932228334e-01   -4.271713486738090e-01   +2.561609406552041e-01   +2.511514230559097e-01   -2.230708077238409e-01; -3.513206964280446e-01   -1.626906537167024e-02   +3.842919132040046e-01   -1.932725206523910e-01   -5.083156186269204e-02   -2.074881691192946e-01   +2.077205890977877e-01   +3.241544832208317e-01   +2.168727406336343e-01   -2.242516127546600e-01   +4.237309596760048e-01   -2.228693518106261e-01   -6.621312951142488e-03   +2.572525228370305e-01   +4.499508757026145e-01   +3.442415947105431e-01; +5.899043560300150e-02   +1.722340603839518e-01   -1.333424167815110e-01   +2.125637961428229e-01   -9.437714871792233e-02   -1.410582387256776e-02   +1.244347160548230e-01   +1.972698575461985e-01   -3.857143164267892e-02   +1.274938492719207e-02   +1.728234625908930e-01   -3.330236864389846e-02   +2.183988856865773e-01   +1.272235901374491e-01   -1.145325926354143e-01   +3.621094373871897e-03; -2.453722421932804e-01   -1.924993280098639e-01   -4.174498768954616e-01   -2.312418211585937e-01   -5.274436942484022e-02   +2.814623138762088e-01   +6.387387521720550e-02   -2.581500332183043e-01   +8.550664480565186e-02   +8.457777974195430e-02   -2.851754640759396e-01   -2.387079590847025e-01   -1.726125307182215e-01   +9.782420683796481e-02   +4.056314560536202e-01   -2.790267693954803e-01; +2.175705736103501e-01   -2.265661555675194e-02   -2.651614096221857e-02   -5.843415457464962e-02   +8.333656134158593e-02   +5.725113030302733e-01   +7.401672557713905e-02   -4.207700938138298e-01   -4.956335298738336e-01   -1.740208801887236e-01   -1.307852383232549e-01   +3.229437869711496e-02   +4.825815214668194e-01   +1.741749067656355e-01   +2.692766051998131e-01   -1.840706650814664e-01; +9.252809226211009e-03   +1.479922455757507e-01   -3.949303068582552e-02   -2.797202632474107e-01   -5.348451108327906e-01   +1.985170440251957e-01   -7.028931934672165e-02   -1.527227456553946e-01   +1.658430995370026e-01   -4.017803262079514e-02   -1.860522774690706e-01   +3.335170587887430e-01   +2.133022531092610e-01   +8.173105249863379e-02   +1.801089172495406e-01   +2.117061801835667e-01; +2.595630786248889e-01   +2.764889881515670e-01   +4.309081300452162e-01   +1.506660411104062e-01   -1.046598870755145e-01   -4.039868789693557e-02   -1.776530282330266e-01   +1.228329482918272e-01   +2.164689289450513e-01   +9.632685268657934e-02   -3.430495450124446e-01   -5.758550376541645e-01   +4.373165105698920e-01   +9.028994255157405e-02   +1.624130476596947e-01   -2.075008189019031e-01; +1.452881441415111e-01   -4.143352342336484e-01   +1.486242045680703e-01   -2.414674023111116e-02   -1.625746726936049e-01   -7.553986170064358e-02   +2.961337916240636e-02   -2.331065621652404e-01   -6.468390804932232e-02   -1.660359172968255e-01   +2.153033247750882e-01   -2.302783135111368e-01   +2.659620428615556e-01   -1.579241721256467e-01   +1.074662228964188e-02   +2.322808525324414e-01; -7.780901220048730e-02   -4.213859193401603e-02   +2.921156521352917e-02   +2.283898914733851e-01   +9.335417539175862e-02   +4.682871484584444e-01   +7.674374584592580e-02   +1.353802264723654e-01   -5.106293403232637e-01   +1.410317434084625e-01   +4.371266139144383e-01   +7.295749419626224e-02   +1.142421377720279e-01   -3.402641108856391e-01   -3.575475514210452e-03   +3.705000104242885e-01; -5.180868948133943e-02   -2.940231145304235e-02   -8.528656129350050e-02   +1.742026184474577e-01   -4.301400790174058e-01   +3.309228539937499e-01   -1.798045885558384e-01   -3.097070038902686e-01   +1.283678667648356e-01   +1.698755471440878e-02   +1.230482729809660e-01   +1.325929782103959e-01   -1.925958264439094e-02   -3.993913568516366e-02   +2.270835416648885e-02   +2.104131801219882e-01; +6.444200658435037e-02   +8.990443085430989e-03   +1.905518161792955e-01   -2.600222504747692e-01   +2.067349533017930e-01   -1.854502545551688e-01   +4.983587340089826e-02   -1.254156579873077e-01   +1.120121301630890e-01   -6.225292241827547e-02   -8.620448283827954e-02   -1.973856666524247e-01   +6.814592570279696e-02   -3.348490535225501e-01   +3.302533347416919e-01   +3.430118351316510e-01; +1.573668577951340e-01   +1.334148916048048e-02   -1.187357999057236e-01   -4.199821578229142e-02   +1.168643927477025e-01   -9.516689846749718e-02   +3.983562498604811e-01   -1.261751304454982e-01   +1.506509404163249e-01   -2.626771267717676e-01   +3.728121580437751e-01   -1.532053387200433e-02   +1.247019698586789e-01   -7.557083980809419e-03   -1.791808098100454e-01   -3.807449941453170e-01; +1.442567520480226e-01   +2.599819974373817e-01   -3.703587997221977e-02   -5.303474281459075e-01   +3.170370335369332e-02   -4.758968845712712e-01   -1.352917651911108e-01   +4.292498975424056e-01   +1.040511582365033e-01   +8.978597666672952e-02   +6.621506757277211e-02   +2.416663192351078e-01   -2.810962287522052e-01   -1.004077956210625e-02   +3.467040054821944e-01   +3.881548946992733e-02; -2.554732103972424e-02   +1.978345207476199e-01   +6.909434430863337e-03   -5.791596157222927e-02   -2.255295898212757e-01   -1.895582250537273e-02   +2.113088319612969e-01   -1.813399516669902e-01   +5.372341144506895e-02   -1.707518440142369e-01   +6.386772678708119e-02   +1.384316977065840e-01   +1.582301851972618e-01   -4.542208357963040e-01   +1.009914336473781e-01   +3.364857474741446e-01];
L1E_L1I_iGABA_netcon = [-5.687943815509221e-01   -9.273016727613131e-02   -1.354689362535624e-02   -2.281231571795332e-01   +2.577513573778767e-01   -1.851236774602452e-01   +2.702241500910956e-01   -3.200827901373363e-01   +2.811529428406742e-01   -3.136153752001011e-01   +2.313254410754272e-01   -1.573397857069000e-01   -7.515495928532964e-02   -3.833406153224262e-01   -2.394799010474941e-01   -6.542651572739280e-02; -2.304493734432252e-01   -1.866687717376333e-01   -2.440252500822689e-01   -2.248524364550773e-01   -1.712140833531297e-01   +3.015248409275476e-01   +1.189799583875761e-01   +2.137177806087896e-01   -2.273719503826460e-01   -5.683734482477272e-02   +2.445067186135522e-01   -9.207158256728740e-02   -3.997487081117580e-01   +1.922660562771322e-04   +4.512807543307837e-03   -8.426219145672052e-02; +5.787971426889083e-02   -6.988420030661649e-02   -1.136757872382774e-01   -3.716222213256863e-01   +2.247906440765351e-01   -1.309591288915365e-01   -7.581005954374771e-02   -1.092407875338072e-02   -1.231998753867824e-01   +3.432635120270535e-01   +1.758367365306635e-01   -4.306404258847523e-01   -6.850528923550368e-02   +5.677869092111543e-02   -8.431065640819893e-02   +1.723202220993833e-01; -2.505386722772480e-01   +3.102428104779411e-01   -7.902689035758026e-03   -3.871362826330389e-02   -2.729770314942519e-01   -3.647670626610921e-01   -1.046058709700288e-01   -1.222949814532328e-01   -2.060393318998324e-01   +4.671287487419367e-01   +1.658443732870544e-01   +1.405255151557385e-01   -2.919380691323399e-01   -1.767637761219522e-01   -2.040238752286409e-01   -1.241078043723889e-01; +2.287356781312486e-01   +1.078899167955136e-01   -5.348193073396060e-01   -2.136970100242603e-01   -5.018685429576800e-01   -1.125978624083660e-01   +7.490545697158488e-02   +1.576215894949535e-01   -2.298723585765802e-01   -1.144591695166518e-01   +2.141688600584052e-01   +1.316107063774618e-01   -1.968843154075449e-01   +2.350045914073899e-01   -2.453576852875665e-01   +1.331298688663051e-01; +2.559622148758710e-01   +1.271539443920506e-01   -3.927034276228489e-02   -4.128206807675201e-02   -1.499836834784117e-01   +1.125224212511335e-02   +7.361756541515943e-02   -1.340825472932532e-01   -2.678764876154636e-01   -7.613492663634654e-03   +1.701768355975114e-01   -7.775176178122548e-02   +5.219429100405177e-01   +2.559399430517054e-01   +3.448750047111264e-01   -2.643496524003844e-02; +1.484813955336405e-01   +1.011298667546903e-02   +2.227772532917099e-02   +3.037631400536190e-01   -4.844329743099911e-01   +2.539299272041419e-01   +8.037167919571062e-02   +8.330141004024308e-02   -3.333178927790419e-01   -1.453272028209904e-01   +4.222954997203736e-02   +3.237066570302854e-01   +3.586488220880343e-01   -3.082271407842021e-01   +6.963161601959898e-02   +2.940544624683833e-01; +2.015522472159399e-01   -3.321117260381384e-01   +7.784620296124595e-02   +2.825114525430034e-01   +2.866883724458837e-01   -1.064296598110827e-01   +2.042515644088420e-01   -1.827889464727866e-01   +1.246271139305392e-01   +4.527992535320288e-01   -7.701913653140890e-02   +7.402277035511530e-02   -2.829570517886447e-01   -2.300270301833076e-01   -1.084649439897487e-01   -4.669812158526024e-02; +1.119984965833721e-01   +1.236470310569227e-01   -1.884523740903989e-01   +7.967335147870321e-02   -1.522308305365952e-01   -3.199805222730636e-01   -9.173156924107129e-02   +2.736022148471295e-02   -5.542972582752510e-02   -3.519254388244937e-01   +4.142115200712777e-01   +1.810740079496743e-01   +2.273303352380917e-01   +1.560848878588712e-01   -1.739358678910707e-01   +7.533666281139752e-03; +5.387192226472132e-03   +5.396006258045974e-02   -2.447806928621204e-01   -3.060225115032968e-01   +1.605873603275193e-02   +2.099802808689181e-01   -2.586506962386463e-01   -2.767645502421575e-01   +2.168185542705451e-01   -1.560018026100458e-01   -2.650236078971629e-01   +1.757769186159927e-01   +3.673745901036370e-01   -1.660802040712183e-01   -2.211805209196797e-01   -1.993860235586612e-01; -2.095540757896191e-01   -1.176606071770517e-01   +2.233214807012649e-01   -2.383211547137844e-02   -4.360820134142306e-01   +4.085685532336202e-03   -2.658013651223903e-01   -3.618383984946000e-01   +3.382413986198490e-01   -1.769660471134316e-01   -2.540730421726025e-01   -1.872589724437722e-01   -3.555872064940092e-01   +4.518831375604343e-01   -7.014214085796527e-02   -1.207702520814969e-01; +9.943868358318453e-02   +2.535326218866657e-01   -2.739076394736918e-02   -9.057464258136672e-02   -3.891072684526486e-04   +5.847159452193215e-02   +2.319344501633393e-01   -2.287279682337573e-02   +3.618746298795641e-01   +4.706356630690578e-01   +1.952779562675542e-01   +2.391906429660539e-01   -1.508458485708166e-01   -2.329609817252323e-01   -6.795043653394812e-02   -1.299000716230581e-01; -6.634610938212482e-02   +2.900865855088932e-01   -1.649076023548843e-01   -3.822988054021841e-01   +3.283460000411514e-01   -1.595411608159386e-01   -2.433719386371941e-01   +3.646095851592292e-02   -1.698396489875310e-01   +3.512904216965831e-03   -1.817885309865586e-01   +1.488150634320911e-01   +2.119834624967663e-01   -3.416173862621433e-01   +3.099411118626292e-01   +2.768136627549244e-01; -4.540169911931503e-01   +9.037765757376814e-02   -2.744991890593765e-01   -4.324518218191469e-01   -1.325325157976227e-01   +8.342579696005065e-02   -5.859685548231225e-02   +1.370027424453109e-01   +3.338081853857641e-01   -1.262637705795858e-01   +2.463030312443167e-01   -3.924028577972440e-01   +5.310372771140247e-02   -1.008468126054110e-01   -1.792467267699611e-01   +1.096163389789111e-02; +9.097032013073106e-02   -1.015039484039757e-01   +8.448464452492763e-02   -3.506800341315343e-02   -2.018665024628735e-02   +6.346509850398438e-02   -2.799096616000224e-01   +1.984963623486171e-01   +1.605474574365156e-01   +5.711845843182324e-02   -3.062159151461523e-01   -4.696518216819784e-02   +1.861818006845979e-02   -5.470120486120307e-01   +1.194490153500139e-01   -6.633033461815270e-02; +1.780681569601870e-01   -3.838836466901722e-01   -1.463866274518743e-01   +3.168106183249436e-01   -3.200494561418483e-01   +2.166318148323178e-01   +1.222626483851500e-01   -1.433047820795878e-01   -3.114808367766088e-01   +2.894937181089453e-01   -2.451697636774065e-02   +7.807945907546059e-02   +1.118049624460049e-02   -3.456210019252627e-01   +2.181796438896543e-01   -5.278127362072899e-01];
L2I_L1I_iGABA_netcon = [+1.843176949081914e-01   -3.596259608063180e-01   +3.014761589000969e-01   -2.045120318691532e-02   +4.701310975225714e-01   +3.483154898912600e-01   +3.786684712725429e-01   -1.019351994549992e-01; +2.230053888295744e-01   -2.754106775441090e-01   +2.096902517125070e-01   -5.345475537784929e-01   -1.806394934524720e-01   +3.913385220522913e-03   +1.044990496389214e-01   -9.072389276466862e-02; -6.960307954208453e-02   -3.002346944677198e-01   +5.834114354347059e-03   -2.370373001086754e-01   +6.254420341271860e-02   -2.544461092943001e-01   +2.326251641715052e-01   +9.903646568358196e-02; +1.178621489146054e-01   +3.960111036287642e-01   -1.836760201889902e-01   +8.799116946014060e-02   -1.250732209568355e-01   +1.968523916625417e-01   +1.416014745011630e-01   -2.363438130626545e-01; -3.611092555548080e-01   +7.327596102332085e-02   +3.353510859996700e-01   +1.167992465163881e-01   +7.622285179932659e-02   -1.367168068191562e-01   +2.078969926823250e-01   -3.922216214153013e-02; +1.322101417430628e-01   -1.402403103832414e-01   +1.382524717237740e-01   -1.232963149337900e-01   +3.282860373305186e-01   +1.576268634149370e-01   +1.803392704209775e-01   +1.044655117834570e-01; -2.668882096415607e-01   +5.448941743470462e-02   -1.245795218742036e-01   -8.762672140844294e-02   +7.473686928824276e-02   -1.859082508366451e-01   -3.088083242330349e-01   -3.403309393318963e-01; +3.517735785001979e-01   +3.252176759626985e-01   -3.732647140343813e-02   +1.640262651108707e-01   -3.932252066159188e-01   -3.475299041056124e-01   -2.376742601966504e-01   +2.067126702628228e-01; +7.356473072062372e-02   +2.271705282231339e-01   -3.073097420110038e-02   +3.601764412546829e-01   +4.567858137495800e-03   +1.581217847977520e-02   +3.487082034613437e-01   +1.745197461000252e-01; +1.947752620488326e-01   -1.581495701946123e-01   -4.355683615930686e-02   -9.447586209952408e-02   -3.199074169854720e-01   +2.721386427149407e-02   +2.489652276914769e-01   -5.103429148365596e-02; +7.268229216306643e-02   +3.722466567354206e-01   -1.539649125653456e-01   -4.401925618591073e-01   -1.941007850102011e-01   +1.940905661640877e-01   +1.619293645666926e-01   +4.336143728048836e-01; +1.721079571192371e-01   +3.589992630877504e-01   +1.892044428921461e-01   +3.811369011358584e-01   +1.067235162992280e-01   +3.611443015368042e-01   +3.292194294774639e-01   +3.016948100499677e-01; +1.872930720959733e-01   -5.835646238902169e-02   +2.020744298459892e-01   -2.319943924241291e-01   -3.827508368222218e-01   +1.582844296402303e-01   -6.701613220554620e-02   +1.591170291828272e-01; -3.905820190729792e-02   -3.313597494196415e-01   +2.871531687117846e-01   -7.593565753078629e-02   -1.353189861649063e-01   -6.375044981380956e-02   +6.151229762441474e-02   +3.131298779456192e-01; +2.442500112809491e-01   -2.777447131846988e-01   +3.401610887083053e-01   -4.156959116927197e-01   +2.243646254223480e-01   -3.035546062992164e-01   +1.808663303995234e-01   +2.800590163643052e-01; +6.364948801183695e-02   -1.459524021148859e-01   +4.200257739469418e-01   +3.643710014649627e-02   +1.645649963707496e-01   -1.366651125403768e-01   +2.275367041681328e-01   -6.227288376721905e-02];
L1I_L2I_iGABA_netcon = [+2.160987040977974e-03   -3.043996064056292e-01   -5.058058572888089e-01   -1.246556501319106e-01   -2.911956950509175e-01   +9.378617631869426e-02   +2.819068078739434e-02   +2.624989950986275e-01   -4.329200565710550e-01   +1.451629788082930e-01   +4.741113787852587e-01   +8.663039369566565e-02   +3.989739038655986e-01   +9.778737218121851e-02   -1.630149945884874e-01   +1.485541048339400e-01; -1.152221764693989e-01   +8.866583755189950e-02   +1.820098391584392e-01   -1.899045986332114e-01   +1.512404867687753e-01   -1.698857994956728e-01   -7.165909086000566e-03   -5.047496143779459e-01   -2.542074329350659e-01   -1.401394470553994e-01   -1.520604298673121e-02   +2.047813534471913e-01   -3.401235197610124e-02   -3.413447629711630e-02   +4.198825234652241e-01   +5.660100477030930e-02; -8.357373764671419e-02   +3.294827725405369e-02   -4.754120388043119e-02   -7.593481809921288e-02   +3.063172819030747e-01   +3.091403590772071e-01   -1.900246023319840e-01   -2.013991548879359e-01   +1.807165240952733e-01   +1.956039680174523e-01   -2.922209234948783e-02   +9.248500184445763e-02   +2.165058795528234e-01   -3.959820194574040e-01   +1.581836263290875e-01   -1.829215327387311e-01; +4.448646001700107e-01   -2.661634357255904e-01   +3.852741710285537e-01   +2.778467964564397e-01   -4.913960876195681e-01   -2.287339787036327e-01   -2.541006449613890e-01   +1.234446519140311e-01   -2.972270807103612e-01   -2.213068821912059e-01   +2.614503616037109e-01   -2.810318818127155e-01   -1.175027964820409e-01   -1.521485297606626e-01   +3.186232763414540e-01   +8.078445038463784e-02; -2.317477933420094e-01   +3.840939916377332e-01   +3.206157809071826e-01   +2.995067435136434e-02   +1.556845062223712e-01   -1.834024660922751e-01   +2.739820953400187e-01   +4.171687714536126e-01   +1.891645593383415e-01   -7.049562427026251e-02   +3.684689327949878e-02   -7.773412458622775e-02   +1.526974199707175e-02   -1.642794406114189e-01   -1.004572522665369e-01   +3.432843346196244e-01; -1.234874513893827e-01   -4.137084374832259e-01   +1.621832600579869e-01   -4.013290198404809e-01   +6.367874631461068e-02   -3.069240574215613e-03   +3.183991702697196e-01   +8.278563682534060e-02   +1.604181924236651e-02   +1.034403921496716e-01   -2.598518195149235e-01   +4.240586257162908e-02   +2.350736231481118e-01   -1.972285481326123e-01   +2.168426853994919e-01   +3.331399689134559e-01; -4.632540885313621e-01   +4.743881190718244e-01   -1.233242577106385e-01   +6.667624548035082e-02   +2.603102676216957e-01   +8.047484987392893e-02   -1.052279210082198e-01   +4.000515238385249e-01   -1.253630708155545e-02   +2.178586156427813e-01   -2.227731863415429e-01   +5.373549457512430e-01   +3.646902911786244e-02   +1.546271658973382e-01   -3.057800333879148e-01   -1.227125079905513e-01; -1.646136635005183e-02   +1.062375908852856e-02   +4.093005679952039e-02   -2.865564888148284e-02   +3.969287069806036e-01   -2.877473680307711e-01   +3.913615088913076e-01   -1.285619936078621e-01   +2.582457491745485e-01   -3.013093321633048e-01   -3.978452746481986e-01   -3.935037828729411e-01   -3.875483943013226e-01   +2.059053315551251e-02   +3.508654228900794e-01   -1.218488983106109e-01];
L2E_L1E_iAMPA_netcon = [+3.940925091674904e-01   -1.493693185250135e-01   -2.555696244560507e-01   -1.764505393652753e-01   -2.021945591927883e-01   +8.465174723683280e-02   -2.228840757309559e-01   -1.186949709678798e-01; +1.379648861280433e-01   -5.812988048268364e-02   +1.767023816219435e-02   +1.269629116031697e-01   -4.610891342452590e-01   +3.026345074357391e-01   +1.750581294673943e-01   +2.616156740089329e-01; +2.736208960205848e-01   +3.500294183587873e-01   +1.036739085915351e-01   +1.827799774293956e-01   -2.809692245764289e-01   -8.069508569274578e-02   -9.961186920032894e-02   -5.017543802842428e-02; -3.622845827952639e-01   +2.479440628860052e-01   -3.376275804138192e-01   -3.870102199407828e-01   -2.272884451173798e-02   -3.570206814052322e-01   +6.989599549193780e-02   +7.257271877827259e-02; +6.179129904265884e-02   +2.508744981834008e-01   -1.197895200417075e-01   -7.163537312285988e-02   -2.392636015786419e-01   +4.836780688022981e-01   +1.511520917139634e-01   -1.157533864600094e-01; +6.179881922662564e-02   -2.497802225193788e-01   -1.321054356916944e-01   +3.475014455736368e-01   +1.162664401961992e-01   -8.981750091555302e-02   +5.463751551016841e-02   +2.875050644464130e-02; -5.422686875660083e-01   -5.649427517875583e-02   -3.799334521295080e-01   +6.385022935988886e-02   +1.497677656367173e-01   -2.000634048491406e-02   -3.102380172403661e-01   +2.814115508039339e-03; -1.266875402032507e-01   -2.033870896954618e-02   +2.007812584334291e-01   -3.283070995714067e-02   +3.440951290100963e-01   -9.325428023338037e-03   -1.582322029643249e-01   -3.248528536770851e-01; -1.358060005923743e-01   -4.376154681265534e-02   -1.144665756622436e-01   +9.552376049085209e-02   +1.550907291387930e-01   +1.524462216732157e-01   -2.801814960911402e-01   -3.747146781172844e-01; -1.591640939034592e-01   -2.463342967110710e-01   +2.642156029117524e-01   -2.515098450112500e-01   -3.578703420418313e-01   -1.130817027138085e-01   -2.814024451484461e-01   +2.049631006818439e-01; +1.065029652164790e-01   -1.244282856574707e-01   +1.539290837797586e-01   +3.551835397448677e-01   -2.020633031216066e-01   -1.884355634277914e-01   +8.053655760306508e-02   +1.643636758346778e-01; +3.029097056194666e-01   -4.753942413583351e-02   -2.648079453441909e-01   +2.797250519414648e-01   +3.000061650514535e-01   -1.967573832832069e-01   +7.010251873426643e-02   -1.415271126963287e-01; -6.043769832158266e-02   -3.084627997069730e-01   +1.905371690877159e-01   +2.985154849312915e-02   +3.202022976517835e-01   +1.829078488879268e-01   +6.860601183914634e-02   -4.231490161698132e-01; -2.281706017288632e-02   -4.276568554280943e-01   -3.066659184484020e-01   -4.194379594988732e-01   +2.032993035972144e-01   -1.238357707587722e-01   +1.951008086323959e-01   -2.715251918579359e-01; +2.899231708573450e-01   +2.038416215006150e-01   +1.561534334400735e-01   -8.497943453256582e-02   -3.469549683454805e-01   +8.005770358056066e-02   -5.282802170854850e-02   +3.719283393941238e-01; -3.754495992797870e-01   -7.428903101924442e-02   +3.042137787043268e-02   +1.819034815526352e-01   -2.422015517633242e-01   -1.025522119803855e-01   -2.108027351524787e-01   +2.664347259859333e-01];
L1E_L2E_iAMPA_netcon = [+1.382397825842036e-01   -1.445958096121192e-01   +1.138054401295872e-01   +2.016278849264033e-01   -1.780324700412063e-02   -1.110815402538190e-01   -6.991399139002065e-02   +1.221647234588971e-01   -1.745459779150297e-01   -1.335870215390941e-01   -9.888234343934124e-02   -1.823270220751033e-01   -1.609831321092401e-01   -5.642902417901774e-03   -1.175369382563711e-01   +1.762716837600528e-01; -1.563472678434852e-01   -2.854253593503933e-01   +1.600667080567834e-01   +2.813343264795709e-01   -2.585204942495311e-01   +2.916566922473173e-01   +3.002669668217248e-01   +1.794557466244830e-01   -1.724861994892771e-01   +2.884571889761509e-01   -5.684723481804610e-02   +1.136701880937266e-01   -6.024717444083827e-02   +5.100053231273180e-02   +1.949941907434275e-01   -1.500074632415062e-01; -2.364673107087145e-01   -2.954951249329434e-01   +6.658206909879233e-02   +2.327644498664191e-01   -5.444862967884551e-02   +1.704444185813839e-01   -1.329145963898051e-01   -1.993973101292948e-01   -1.527801984035272e-01   +3.323128138701771e-01   +2.575972090307257e-01   -2.700371409369452e-01   +2.498505006173227e-01   +2.022673751762859e-01   +1.116655355426317e-01   -9.910956692594605e-02; -1.243364320051773e-01   +2.634774729463215e-02   +1.836741999398789e-01   +1.383388292098056e-01   -1.396180361357698e-01   +2.993068146130440e-02   +2.598177083776365e-02   +6.728876036765388e-03   -3.231835283797163e-01   -1.918958359555807e-01   +6.518160424659038e-02   -2.131191106580180e-01   -3.158562911986337e-01   +3.207482631480519e-01   -1.297628415370825e-01   +9.169208801520354e-02; -1.071500667513031e-01   +2.014504770815561e-01   +2.161105435850139e-01   -1.571848498972451e-01   +1.545343870127499e-01   +5.624758964435658e-01   -1.717013780673415e-02   -2.320397285907941e-01   +4.228531575406927e-01   -2.665859385760893e-01   -1.805068499209959e-02   +2.444102373700436e-01   +2.408465818941373e-01   +4.579457060635339e-02   -8.951863981957281e-02   +2.231461452519152e-01; +1.138739842859912e-01   -5.150347097622580e-01   -1.361819820654562e-01   -2.968846295718233e-01   +6.643564109133150e-02   -1.277429829340920e-01   -3.012955339406674e-01   -7.355877114137235e-02   -1.363386342722390e-01   +3.421793870642617e-01   +3.993014085196301e-01   -7.053491495389635e-02   +1.068218016220772e-01   +8.784352672098134e-02   +7.410727418440868e-02   +7.730328467486880e-02; -1.257151046702209e-02   -7.637935806533103e-03   +4.533493954847569e-02   -1.945263620352507e-01   +3.056930647179400e-01   -1.693873707284475e-02   -3.306616519650751e-01   -3.434544275121696e-01   +1.014572967930815e-01   +2.710962833204821e-01   +2.206080524948756e-01   -4.408788052559059e-01   -5.189190982587710e-02   +1.664763235346544e-01   +9.976509338559837e-02   -8.112472819369537e-02; +2.799531668698259e-02   -4.143400254652463e-01   -2.445459299370666e-01   -2.232387519958122e-01   +5.921881341282122e-02   -2.555855330211633e-01   -9.035899953893095e-02   +1.698315517554262e-01   +2.949538231348107e-01   +2.817374032468892e-01   +5.281566613674764e-01   +1.732349181282093e-01   +1.085892136939873e-02   +9.006262651488722e-02   -4.017759059618693e-02   -8.868794598959620e-02];
L2I_L2E_iAMPA_netcon = [+3.882321185715263e-01   -1.282650150407596e-01   +1.779319275977092e-01   +9.615549980302990e-02   +3.804392229875415e-01   +5.611170122398228e-02   +1.660794766081740e-01   +2.406025732594384e-01; -2.414732397115172e-01   +2.168337336470674e-01   +3.980151280353526e-02   -1.051684584738032e-01   +1.220547143972749e-01   +3.615548645380583e-01   -1.717794235867786e-01   +1.855572808851638e-01; -2.746804492606814e-02   +8.113728045052215e-02   -2.095339854593702e-01   +3.145334874088298e-01   +2.312221216666089e-01   +3.558399848235632e-01   +4.252825644509629e-01   -1.024085838988629e-01; +6.665890939183247e-02   -2.913457120715670e-01   -6.283978270350063e-02   -4.417622158858374e-02   +1.579772067391773e-01   -1.585750409258369e-01   +3.888348366715078e-02   -4.362366953057709e-02; +1.740860059454610e-01   -1.549634172663844e-02   -2.616586707052877e-01   +2.647331178207495e-01   +2.138352893036855e-01   +1.534027629491346e-01   -1.043366035338846e-01   -1.528678036103963e-01; -1.462435223580746e-01   +1.818978997794504e-01   -1.433114937266243e-01   +1.932009618259495e-01   -1.108998329278141e-01   +6.461732965508007e-02   +2.410763257650675e-01   +8.152465536147294e-02; +3.627535389586505e-01   +3.164744347372622e-02   -2.836240974041904e-01   +2.343129787889229e-01   -2.901973261483162e-01   +3.290535664415228e-01   -6.791723687793724e-03   -2.271578866974864e-01; -1.813565454419256e-01   +8.702470061184091e-02   -6.198933667446702e-02   -2.973839315069386e-01   +2.366030306279589e-01   -4.396631129724707e-01   +2.030162725111154e-01   +1.218202127378560e-01];
L2E_L2I_iGABA_netcon = [+1.572092904081613e-01   -2.798230673093898e-02   +2.128408343048913e-01   -7.154276967301824e-02   +5.105628822654101e-02   -2.764697569496449e-01   -2.318525453286850e-01   -2.541625540818021e-01; +2.954274477316849e-01   -4.514037671494689e-01   +2.738158603083964e-01   +3.616352720923914e-01   +2.949565998524413e-01   -1.860484687792811e-01   -2.757073548657909e-01   +4.367562564670451e-01; +6.089434789458302e-02   -7.430458157795729e-02   -8.783413822416913e-03   -2.377685739387057e-01   +4.286250619074986e-01   -1.973368224493201e-01   +5.869756363113553e-02   +3.616483603677231e-01; +3.504749692406728e-01   +9.328748611622467e-02   +3.260981033595556e-01   -1.939938336059837e-01   +2.162033911524260e-01   -4.701881739507796e-02   -2.227260857373645e-01   -2.057630309191432e-01; -7.334870330341182e-02   -1.248657635578393e-02   -2.104057770677574e-01   -1.406461087345179e-01   +2.317546573369520e-01   +1.063144386770607e-01   +1.620041516944842e-01   +3.260807614287491e-01; +3.933231314634465e-01   +2.080518222049471e-02   -3.458367561137566e-01   -1.537338886818621e-01   +1.828785990675968e-01   -1.168913757736378e-01   -2.516700099709141e-01   +7.257908651758679e-02; -3.218147885622898e-01   -3.965158086408199e-01   +1.764609053298169e-01   -1.166450803935511e-01   -7.618208473348906e-02   +3.269986893309629e-01   +2.262586860951028e-01   +1.002360246624004e-01; -3.517471758523267e-01   -3.020284664086639e-01   -3.651476919567657e-01   +2.991539123204358e-01   +2.097572352345206e-01   -5.628438696798006e-02   +9.525054927357460e-02   +2.476907721758377e-01];
L3E_L2E_iAMPA_netcon = [+1.768514714020080e-01   +1.880445452175931e-01   -2.331301537041748e-01   -1.277074114563219e-01   +5.086135853976776e-01   -2.569483683855734e-01   -2.020673057862658e-01   +2.205286832322537e-01   -2.927936648295474e-01   +2.558911520309038e-01   -2.203928639793128e-01   -2.566199457437952e-01; -1.031057986796318e-01   +3.561455980074973e-02   +1.131481157610765e-03   +1.130449200220014e-02   -7.040060597253289e-02   -1.975244207408045e-01   +2.515565752952642e-01   +1.721593843428435e-01   -2.981645484303063e-01   -2.956290571771523e-01   -8.271588157140358e-02   -4.887041717234498e-01; +1.362319090923648e-01   +6.217046176293912e-01   +5.359364323752906e-02   +9.988139425380693e-02   -2.793679841830676e-01   +3.127044467675987e-01   -2.677547291486742e-01   +2.363605854694101e-02   -1.090366557703021e-01   -3.600536492586414e-01   +1.580951686404387e-01   +3.686052400394265e-01; +7.025314971880886e-03   +2.268448864169500e-01   -4.871111822984289e-01   -8.843190073675167e-02   +3.163502980520416e-01   +3.662671340311499e-01   -4.942292621793010e-02   +1.360472940037536e-01   -1.190334431787465e-01   -1.943569414556331e-01   +6.411967206294265e-02   +1.017073203943428e-02; -3.264103340317822e-01   -3.932981728574142e-02   -1.050728212675134e-01   +2.970293728794839e-01   +2.265099454762648e-01   +4.738856195150987e-01   +7.462460496038843e-02   -2.729912166126152e-01   +4.022319481718803e-02   +2.138706869678861e-01   -3.381640576423143e-01   -9.969280220117729e-02; +1.499034810710362e-01   -5.187969931437109e-02   -7.293459189656307e-02   +3.790577490492771e-01   -3.998090263620365e-01   +2.674509455573796e-01   +4.922559741595040e-02   +9.405757181079967e-02   +9.121715223603324e-02   -4.389904521643272e-01   +1.216038789708535e-01   -2.013436105115263e-01; -4.080400014815136e-01   -1.602970331846996e-01   +3.359187476939158e-01   -8.450983015208768e-02   +1.076704292042073e-01   -2.261837841474858e-01   -1.887326056899280e-02   -4.188680982591322e-01   +2.947085630331071e-01   -1.262371188883712e-01   -1.707910055836425e-01   -1.779162802038150e-01; -1.776928547036890e-01   +3.574822920765985e-01   +1.693589260352265e-01   -4.031123101049812e-01   +4.452376816866762e-01   -1.131712413826516e-02   +1.701175886460128e-01   -4.758095979145986e-01   -1.081447439085377e-01   +1.992746788708710e-01   -3.567239216181038e-01   +1.399576247705541e-01];
L3I_L2I_iGABA_netcon = [-1.461695561629960e-01   +4.133595553481526e-02   -3.281833609281763e-01   +2.129420746776589e-01   -1.543415923330100e-01   +2.101166178512003e-01   -3.471875355309688e-01   -3.280097716749490e-01   +1.416220457897563e-02   -2.613564228909746e-01   -2.147806581764930e-02   -2.279912739951243e-01; +1.072872798216626e-01   -4.724878570818723e-02   -4.308082454749803e-01   -2.623120562007673e-01   +1.253345156106362e-01   +1.616097755237118e-02   +4.237802904430535e-02   +7.668587899538026e-02   -5.418698667947001e-02   +1.445146660606402e-01   +2.512267067241528e-02   +3.755865606145247e-01; -2.072067135022155e-01   -2.066839224713369e-01   -6.378843019759600e-02   +3.594213620384368e-01   +9.638396729972756e-02   -3.961103669354734e-01   -2.499200946945350e-01   -4.818611882057300e-01   +5.552926789057140e-02   -1.102329560297425e-01   +4.515411068715539e-02   +2.820511931108202e-01; +4.265315494212720e-01   -1.132491257094673e-01   +3.568725306698329e-01   +1.338796385674894e-01   -7.081863460630440e-02   +2.713740185346800e-01   -2.029295963362995e-01   -2.511877414153806e-01   -1.040445491087424e-01   -2.179063070535808e-03   +1.632768345661748e-01   +1.246820773506647e-01; +4.051233084142986e-01   -5.559282694580656e-02   -2.927729717523788e-02   +1.067655825926556e-01   -1.940374730908381e-01   -3.335303540539729e-01   +4.627167696366075e-01   -1.688893821406317e-01   -2.800951874791732e-01   +3.837172011550612e-01   +1.249271719387172e-01   -3.849817849102860e-01; -2.581663986257886e-01   +3.081486082902509e-01   +1.347991707681814e-01   +6.141225479002778e-02   -2.301284977573715e-01   -3.715483474248171e-01   +1.519823063360153e-01   +2.904995697816561e-01   -1.976875014024883e-01   +1.442516202699587e-01   +3.391849439200452e-01   -2.578113217375118e-01; -3.384797308273294e-01   -6.623029601209690e-02   +3.388010907570840e-02   -8.446430115006325e-02   -1.565896371501034e-01   +3.749268196791106e-02   +2.413157938604604e-01   +1.311733733281151e-01   +1.155243690487920e-01   +3.358339649817502e-01   +5.111002066131562e-02   -2.696291625964424e-01; +3.074978815276662e-01   +1.325826384479996e-01   -1.284591018161881e-01   -8.410971385356042e-03   +1.823900256629794e-01   -3.298603702762727e-01   +2.682368211950555e-01   -3.741325560180958e-02   +5.746891261136826e-02   +3.716311730300522e-01   -1.127961755802251e-01   -1.305824130737102e-01];
L2E_L3E_iAMPA_netcon = [-8.979810026811995e-02   -6.125751884468567e-02   -2.652855541995550e-02   +2.930101154643160e-01   -1.657363137522547e-01   -1.071391837859868e-01   -2.708038760653296e-01   +6.407506176532822e-02; -1.736066840494910e-01   -2.315780518862206e-01   +7.533116309200530e-02   +5.275019607569771e-01   -1.489267418859365e-01   +1.716805869601990e-01   -3.630203732871636e-01   +1.001469672117528e-02; -2.768132403266684e-01   -4.262668873187478e-01   -1.451515510170343e-01   +1.903966528269366e-02   -9.315510465807883e-02   +2.607393408326386e-01   +8.007554761647781e-02   -1.782965018937363e-01; +8.780578587402116e-02   +1.170872645410849e-01   -2.850188771225967e-02   -3.751704132187642e-01   -2.005056515428957e-02   +1.791426726543496e-01   +1.210113957181305e-01   -1.204967581148571e-01; -1.540669906646793e-01   -6.200406645460593e-03   +2.106762825016317e-01   +2.247161275055436e-01   +1.006884268940169e-01   -5.356012106940455e-02   -2.958448678014381e-01   +2.832766147133133e-01; -3.298066890665935e-01   +1.659773269768640e-01   -8.505882670141535e-02   -1.497783641119692e-02   +2.364367153300832e-01   -2.185982360881898e-01   -9.719224435820217e-02   +3.261291156497196e-01; -1.863685224008143e-01   -4.595157094095851e-01   -2.882950035938588e-01   -5.655140171544684e-02   +6.152162956865452e-02   +1.332516651140655e-01   +1.659781781759794e-01   +2.200295466835860e-01; +3.735004952505203e-02   -1.280246402192132e-01   +2.105607965575481e-01   +4.094158892551836e-02   +3.134828202620494e-01   -2.578384039760174e-01   -6.368474535203839e-05   -1.619937476580186e-01; -2.307035990807359e-01   +9.564131258469374e-02   +6.864478560192273e-02   -1.359277548510918e-02   -2.587474683466470e-01   +2.747829033922927e-05   +1.963277581086847e-01   -1.239260419600909e-01; +4.487228673453018e-01   -3.174843631576855e-01   -2.412544322653075e-01   +6.721460338483698e-02   -2.993860679767987e-01   -8.510068955953440e-02   +1.138439970541432e-01   -3.996571136776075e-01; -7.984530464558563e-02   +8.152425418523433e-02   -3.728173696316017e-01   +1.453655753067892e-01   +1.077309674309773e-01   +5.251415312155889e-03   -9.569571934230287e-02   +4.868199161040865e-03; +1.034976313702628e-01   -4.877795647065687e-02   +1.738768876023390e-01   +1.554092777985541e-01   -3.864849296123035e-01   -1.998375728375392e-01   -1.569602186445107e-01   +2.760207059323591e-01];
L2I_L3I_iGABA_netcon = [-1.656659926764734e-02   -1.147617868710876e-01   -2.619977178900462e-02   +4.774270198315709e-01   -1.313503949738072e-01   -5.605090794600581e-02   +1.059694867630721e-01   -5.762644631014599e-02; -5.836308356220601e-02   -8.263535493263183e-02   -3.701018590217105e-01   -3.353132072128013e-01   -1.219263065286652e-01   +2.637761941461887e-01   -1.504259731629436e-01   -9.971895188059829e-02; +1.648969595851670e-01   +1.939354753452402e-01   -3.188487198484806e-01   +5.277354896288980e-02   -4.417674694870035e-02   -2.005177881068674e-01   +7.449714481123854e-02   +7.995965581372270e-02; +2.293584272432592e-03   +7.404341490053362e-02   -3.935135605797925e-01   -5.484371629901572e-02   +3.456497746947578e-01   +4.622558514758775e-01   +2.823884186778443e-01   -3.503690728452583e-01; +1.153624879209371e-01   +5.472960603555321e-02   -6.476508068749678e-02   +4.427482041852271e-01   -1.066646198694593e-03   +1.491668892246743e-01   +3.355369047579578e-01   +1.617883772735574e-01; +4.006158948169877e-01   +1.378793205626135e-01   -3.761343351180269e-02   -3.092375227480123e-01   -1.264791239316186e-01   -2.147802614443037e-02   -1.769797031111576e-01   -6.646454778034570e-02; +2.277186527672140e-01   +1.066216765046392e-01   +3.858854842523420e-01   -2.440636766997988e-01   -1.115674722104949e-01   +2.277830450351114e-01   -7.638492454067727e-02   -3.406830872812033e-01; +2.013997710505494e-01   +3.877840260255901e-01   +8.610396380114989e-02   -1.122318562654227e-01   -2.286027295077095e-01   -3.590882220019064e-01   +2.794747470227746e-01   +1.630018119495054e-01; -1.801571659361442e-01   +3.463333869132132e-01   -1.017270033423533e-01   -2.198253220484039e-02   +1.794782700100047e-01   +1.398134370424408e-01   -1.756864156413253e-01   +4.206368522637000e-02; +2.541566456014357e-01   -8.030119476308503e-02   -1.768511077507574e-01   +9.181393582660294e-02   -6.261749005482847e-02   -2.021840036217448e-01   -1.582829922050782e-01   +3.465157336122728e-01; -4.031003418028724e-02   +2.323845056914423e-01   -2.272270332563316e-01   +1.250958517941517e-02   -3.056718432213654e-01   -3.245880209724193e-01   -3.039516824065032e-01   +1.697556777790430e-01; +1.672211413805154e-01   -9.920327283840030e-02   -3.366302406480950e-01   +5.480563974970304e-02   +1.864123041410876e-01   -2.262735938127294e-01   +2.832824316741842e-01   +1.667847539230929e-01];
L3I_L3E_iAMPA_netcon = [-2.271840455835063e-02   +1.574185335375907e-01   -1.877055113450126e-01   +3.438011696470519e-01   +2.379161120358384e-01   +2.556949093165464e-01   +4.262225296524348e-03   +1.548472754332023e-03   -4.254550522246067e-02   +2.145591113620784e-01   +1.763458229346009e-01   +1.713488871735320e-01; +3.412431533859475e-01   -1.821726429215016e-01   -7.994128557852528e-02   -1.365131821039155e-01   -3.397679409438764e-01   -5.323951411839123e-02   -5.731301665588454e-02   +3.971417957572893e-01   -4.530667727756221e-01   -3.721739948084113e-02   -8.208255401305313e-02   -2.455931467997543e-01; +2.599899468231031e-02   +4.231955696609244e-02   +2.809067021116817e-02   -3.381204605084818e-01   +1.997345156567489e-01   +2.832188544490084e-01   -3.577250400175969e-01   -3.079640722001642e-01   -1.914511246095083e-01   +3.822488810102623e-01   -1.384818835090488e-01   -3.040466900935940e-01; -1.069862945738790e-01   +2.672517611815930e-01   +3.936287921878301e-02   -1.365692263886961e-01   +2.522062724308027e-02   -1.956496566015253e-02   +3.303969640012697e-02   +1.153625829799309e-01   -2.656890321908417e-01   +1.558628859874381e-01   +3.882028068196512e-01   +4.281435155945374e-02; -2.289105885151247e-01   -2.635924152257623e-01   -3.909855514153869e-02   +8.300199655177531e-02   +2.156442153169537e-01   -1.742794627866011e-01   -1.109660184656977e-01   +1.111430541690545e-01   +4.549169103147038e-02   +4.923631417170482e-02   +1.181126413643109e-01   -1.442067074933541e-01; +1.494307069087878e-01   -1.576945146179438e-01   -1.383202194597468e-02   -5.688888438250189e-03   +2.716478278626125e-01   -2.600350839092227e-02   -5.024784064107873e-01   -9.606294507926753e-02   -6.429939208297958e-03   -4.643857224427569e-02   -8.354689851144900e-02   -7.185610461300632e-03; -3.044578814680968e-01   -1.820285735231864e-01   +1.433221807133525e-01   +3.820422259494461e-01   +8.093674535068376e-02   -1.442157702934582e-02   -1.408820910420402e-02   +2.223008127905420e-02   -8.289272552899399e-02   +8.379369527767402e-02   +2.888248895453338e-01   -3.494842745332914e-02; +1.599191420267118e-01   -2.480941563523053e-01   +3.632850858517612e-02   +3.629162683418478e-01   +6.554600430778579e-02   -3.426255701714831e-02   +3.707555212830839e-02   +2.633635790219091e-01   -2.938526677423024e-02   -9.079753200352043e-02   +8.229517458827651e-02   +2.432765884094755e-02; +4.303988329681832e-02   -8.550531674874917e-02   +4.162876957508505e-01   +2.857542435279734e-02   -9.223346171061048e-03   -1.909592136525308e-01   +1.127177901439705e-01   -2.253604649272656e-03   -3.592894493593676e-01   -1.760407842396099e-01   -2.866451371853972e-01   +3.230289764276255e-01; +3.215413697642072e-02   -1.838213183527752e-01   -3.872578492112017e-01   +2.316015755546759e-01   -1.039354578989757e-01   -5.511073386260162e-02   +1.997331973512146e-01   +4.488097328071597e-02   +3.496575207715157e-01   +2.554750089997621e-02   -1.726015424063293e-01   -3.528770391263649e-01; -1.989929400482663e-01   -4.321703175200400e-01   -4.840735933711898e-02   -2.881943424286617e-01   +1.851024853262190e-03   +1.532103192756657e-01   +2.124833807086853e-01   +2.816520671433975e-01   +1.326356964856332e-01   -5.549012160768889e-02   -1.744337614454758e-01   +4.026297773941562e-01; -3.613676567657813e-01   +1.067229086617526e-01   -9.986506915407839e-02   +2.561136928413017e-01   -1.986393642610180e-01   -5.480738947014174e-02   -2.978931502825215e-01   +1.628831113335056e-01   +6.981912155990351e-02   -5.691297518535554e-02   +1.066256702565290e-01   -2.180010867201811e-01];
L3E_L3I_iGABA_netcon = [-6.394689775176507e-02   -2.237956275765329e-02   +2.734784686705037e-01   -5.326498174524005e-02   +1.045296131596961e-01   -2.051247024604123e-01   +1.435505632584968e-01   +3.319194651353208e-01   -1.929579648877583e-01   +3.664642472754827e-01   +4.178386872369418e-01   -2.087693769912498e-01; +1.287937866035716e-01   +2.714638826260605e-01   +4.351958718529914e-02   -2.846915593215033e-01   +3.254862132264562e-01   -2.979435680742299e-01   -2.173140914315132e-01   -2.140819873512808e-01   +2.983191336508690e-01   +1.371192190326258e-01   +3.430813149766677e-01   +3.248132382821493e-01; -3.992341142653674e-01   +2.006257142823346e-01   +1.446971490709116e-01   -2.898384824363098e-01   +2.728675326456259e-01   +1.055504581411496e-02   -2.074529151507707e-01   -7.663122997621730e-02   -2.294978290952379e-01   +1.847351816793171e-01   +9.962777685930933e-02   -1.381995029353615e-02; +5.500200835610047e-02   -3.822551610944370e-01   +4.201174330677618e-02   +4.812405084853666e-02   -3.401632816928817e-01   -1.036803146449689e-01   -2.923289211473074e-01   -3.070384268281059e-01   -4.311996757641672e-01   +9.885917539907126e-02   -1.455405522304288e-01   -1.237395360066306e-01; -6.524421807634065e-02   -1.281714576345798e-01   +1.887974880800688e-01   -2.818536537062002e-01   +2.360155984845562e-01   +2.222046900371519e-01   -2.029440840967440e-01   -1.482730438430437e-01   -3.192035162263741e-01   -1.631674243825564e-01   -5.978066347948460e-02   +1.127393245634313e-01; +1.599957046878764e-02   -1.367669421502926e-01   -2.181486307068578e-01   +4.268090063045861e-01   +2.157423252116680e-02   +1.945857066352288e-01   +2.181181926043347e-01   -2.365082494003920e-01   +3.070531866044036e-02   -2.012965045689268e-01   +1.438759559282293e-01   -2.856636518753038e-01; +2.128197591826114e-02   +1.951459291066289e-02   -1.930448485719323e-01   -2.358759373062664e-01   +2.548124045742988e-01   +3.590765291719744e-01   +2.234191435148435e-01   +1.464458056580379e-02   +1.840348116719355e-01   -1.301710313427700e-01   -1.131927041484357e-01   -1.116444005645290e-01; -4.162371001440160e-02   -1.916233522440379e-01   +2.046864722793970e-02   -1.782927679709126e-01   -1.264005287355737e-01   -3.123150281246340e-01   -2.485843233338081e-01   +4.215132836086449e-01   -3.208616277955791e-01   +1.729062395095529e-01   -1.606699099858798e-01   +4.389144770061345e-01; -1.820225125137344e-01   +1.655900346152891e-01   +2.311827848015613e-01   +1.102089890509241e-01   -2.234675799080968e-01   +1.969812684687073e-01   +1.325961247399926e-02   +1.583298400767069e-01   +1.963772617797975e-01   +4.207521646433917e-01   +7.642352086781216e-02   -1.155418998799021e-01; +2.017564642842592e-01   -1.735358240828913e-02   +5.597869937559338e-02   +3.062587042335053e-01   +4.987444045566206e-01   +1.409357875925547e-01   +1.067525321612136e-01   -3.194136531038395e-01   +1.994778143118472e-02   +1.514195886752827e-01   +8.770537750514930e-02   +9.147020948142036e-02; +1.092179224536295e-02   +3.423638281205647e-01   +1.189785361905948e-01   +4.395693658069909e-01   +2.716996179277715e-01   -1.291585280730167e-02   +5.679875959252011e-02   +3.575856950935412e-01   +1.940582931211188e-02   +4.072211026036086e-01   -4.241618593968456e-01   -6.786314058181242e-02; -1.546403959082241e-01   -3.431566046709643e-01   +7.795972034580240e-02   -3.522196701648117e-01   +2.149931461938500e-01   +2.176178030130281e-01   +2.717879166509434e-01   +1.217411312143290e-01   -3.401921468645197e-01   -2.449047839591421e-01   +2.299817400886769e-01   -4.530997684426272e-02];
L2E_Input1_iAMPA_netcon = [-2.142485250572493e-01   -1.195285623241793e-01   -4.710845895154786e-01   -7.963451613862776e-02   +3.202136038696024e-01   -3.478025360484512e-01   -3.545524944431254e-01   +1.626111142260180e-01];
L2I_Input2_iAMPA_netcon = [-1.646071626777611e-01   -3.458539040807642e-01   -4.141256079114368e-02   +2.941132413388420e-01   -2.529491641237419e-03   +8.495688807687897e-02   +1.917455753634327e-01   -1.333115004680554e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
