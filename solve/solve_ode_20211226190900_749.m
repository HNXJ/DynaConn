function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.887231588591206e-02   +1.527164402447524e-01   +1.995265656563381e-01   +2.000856126538239e-01   -1.817876158175721e-01   -5.700359334770980e-02   +1.348422082037304e-01   -1.911711082875784e-01   -1.305221877403336e-01   -1.312424813550771e-01   +2.260602269258530e-01   +3.194905120183797e-02   +9.801790988158460e-02   -1.880143795656122e-01   +1.924017031790737e-01   -2.177182755116906e-01; +3.821851573819058e-01   -1.114185647701347e-01   -1.820302310226914e-02   +8.614816402954528e-02   -1.539443725280236e-01   -2.575788923318695e-01   +5.755472257415745e-02   -1.591104176706340e-01   -2.026589476953730e-01   +3.344867677799058e-02   +1.003510761906106e-01   -2.516741317971838e-01   +8.072189875609745e-02   -1.334024226263224e-01   -6.677008199580856e-02   +1.052120267375363e-01; +2.722135329802772e-02   -1.863713252725664e-01   -2.606842009290328e-01   +3.692291477333329e-02   +3.526674518973237e-01   -1.344148538858499e-01   -9.460744597108482e-02   -3.205194038879408e-01   +2.492165821810437e-01   +1.969200745537453e-01   -2.577743645327608e-01   -3.027365629081235e-02   +3.955119069414480e-02   -4.525446551007410e-02   +4.601363032617641e-02   +2.504252917181403e-01; -1.945113167395652e-01   +1.560689788685388e-01   -5.194671110611815e-02   +2.649643488236610e-01   -3.161329189239974e-01   -1.321320366733124e-02   +1.165552173140846e-01   -1.070852249732610e-01   +2.677932893803056e-01   -6.794432193000166e-02   +4.953260853841734e-03   -1.460217154052500e-01   +1.209800429235770e-01   -1.828080926630708e-01   +8.717247066584161e-02   +4.338803970944505e-02; -1.826091247770494e-01   +2.939758858886591e-01   +2.371801095866560e-01   +1.059515132653499e-01   -1.594920929972315e-01   -2.291419797054841e-01   -1.948819133096884e-02   -3.875816730773954e-02   +2.703701826694155e-02   -1.531325291252862e-01   +1.150334915662155e-01   +2.280229887262612e-02   +1.933348866859442e-01   +1.134101618225809e-01   +1.894927212344323e-01   +3.300817563680753e-01; +2.023306131563378e-01   -2.760260139765893e-01   +7.765697735868321e-03   +7.712810963868272e-02   +1.322114842843710e-01   +2.582193250858267e-02   -2.146290119612971e-01   +5.253743102735797e-04   +1.144815069979819e-01   +3.952955140390459e-02   -8.496600473596308e-02   -6.001563576435442e-02   -1.309281982100681e-01   -3.197376426986649e-01   +1.653324596992628e-01   +1.069741396154784e-01; -1.584702369265684e-01   -3.451504664964900e-02   +5.300058717992076e-02   -2.172416808006621e-02   +8.702256808629399e-02   -1.902273684282427e-01   +6.133854360549496e-02   +1.408909465874978e-01   -6.789910132272241e-02   -3.374834390264936e-01   -5.443267200059511e-02   -4.062486217334536e-01   +1.827065650543570e-02   +4.739164009582574e-02   +2.169607870259312e-02   -9.174100744183598e-02; +3.110306821434192e-01   +5.679702172695304e-02   +1.803649243558463e-01   +6.535218377587551e-02   -2.619923641356638e-01   -3.089897181883392e-01   -9.148140783909492e-03   -1.713159298494901e-01   +8.864629584564446e-02   -2.624682012309637e-01   -1.611006964190774e-02   +3.295840027213448e-04   -1.377804428041580e-01   -2.400906395816115e-01   +1.369810797216588e-01   +6.100891489504991e-02; -2.248069642980910e-01   -6.225350274294385e-02   +1.957584683092682e-01   +7.497884069175766e-02   -1.946484887822424e-01   -3.941774811914643e-01   +1.284714592805389e-01   -1.671464378349705e-01   +2.913970285697320e-02   +6.746081910431795e-02   -1.873091510104403e-01   +8.986202250075057e-02   -1.596895049845280e-01   -3.499736837798047e-02   +6.006559944886879e-02   -2.177682548611400e-01; -3.507290527822442e-01   +2.729981400858928e-01   +1.019625745822803e-01   +9.047904553604513e-02   -1.344517313088975e-01   +1.466685074162759e-01   -1.874075936293562e-02   +5.865290771684155e-02   -1.000704722603351e-01   +1.966273631411489e-01   +1.054549445768578e-01   -8.406057696348994e-02   +8.123487979609476e-03   +2.101723991276330e-01   -1.691054764130567e-01   -1.214503659509005e-02; +9.041653791427312e-02   -3.330112317807334e-02   +7.165714626046167e-02   +1.165054894614676e-02   -1.845567394734169e-01   -7.493593389416564e-02   -1.795248698729426e-01   +1.063959599268465e-01   -8.344622020819167e-02   +1.911039191238001e-01   +3.166995650544576e-01   +9.269835241480771e-02   -1.295877868605887e-01   -1.059887339954629e-01   +3.168471871420678e-02   -1.766161502996570e-01; +2.088220343641737e-01   +1.875831385872939e-01   -2.185270864944049e-01   +8.149449539374508e-02   +2.201329266360869e-01   -6.537531539485146e-02   +2.107639281992259e-01   +1.106466744237525e-01   +1.826526129736560e-01   +3.155691240710429e-01   +1.323812705794190e-01   +6.390453088242506e-02   +7.880124183612898e-02   +2.991822382967103e-01   +3.578838633776012e-03   -4.346254584390952e-01; -8.001261202479931e-02   -1.626092933310256e-01   +3.438403058834977e-02   +1.222736190809416e-01   -2.035507316158122e-01   -3.272734236439039e-01   +2.957673113826391e-02   +2.613137430516898e-01   +9.612948685549735e-02   -3.255244428276455e-01   +3.224867536425220e-02   -9.870308450644881e-02   +8.730781519141056e-02   -2.499115884563701e-01   +4.907115690624837e-02   +1.601053851383681e-01; +1.089540372517269e-01   -2.479587569009436e-01   +4.380557011323581e-03   -1.292516308688374e-03   +2.027334737968686e-01   +2.543099327666606e-01   +2.237610861663850e-02   +8.033889457981714e-03   -1.822158404928299e-01   -2.357156814664832e-01   -1.571076385389591e-01   +9.702091377100672e-02   -1.537846962988924e-02   -1.376487841858056e-01   +1.788943197116454e-01   +1.538878441291008e-01; +1.980122282095949e-02   +2.031461616707800e-01   +2.470495040930345e-01   +3.954697168843192e-02   -1.885733059544568e-02   +4.720140076041483e-02   -1.629268733589938e-02   -2.078605016806448e-02   -3.240630262562384e-02   +2.944362512571780e-02   +1.919152241876563e-01   -6.877201161458761e-02   -1.421529716258678e-01   +2.150598045928169e-01   +2.269015553212042e-01   +1.035382172826187e-01; +1.355569996922924e-01   -2.535226054771053e-01   +2.386901113802143e-01   -9.689404076262924e-02   -1.145749520926236e-02   +7.935290528390321e-02   -2.250489833283892e-01   -1.303783361641401e-01   -3.309111939411861e-01   -2.899239472225774e-01   -2.038089438586619e-01   +1.073222362483190e-01   +7.376438509874693e-02   -6.723976313696961e-02   -2.409060721779829e-01   +1.229358917216067e-01];
L1E_L1I_iGABA_netcon = [-1.317244859866974e-01   -5.755565712942128e-02   -2.503650101809660e-01   +3.853858913021079e-01   +7.069307626313977e-02   +2.378370551064318e-01   +6.224304645754306e-02   -1.383278465323941e-01   -1.428224884170409e-01   -1.575074549403284e-01   +4.542992934650662e-02   +1.686688609404869e-01   -2.938437417544170e-01   -1.411513859061719e-01   -3.269298765176762e-01   +7.226712527209204e-02; -2.773113966591320e-02   -2.298028637796271e-01   -6.493821287707674e-02   +2.804266922211197e-01   +3.598672133124901e-03   -2.553278685022561e-01   -1.411404193671947e-01   +1.254599888948559e-01   -1.900617502212933e-01   -5.864415100593222e-02   -1.915593083712500e-01   -2.889510149762142e-02   +2.915136280791699e-01   -7.672628409869765e-02   +3.168652416016465e-03   +5.612471969059808e-02; -8.544199025440331e-02   -1.056258191948912e-01   -4.178920158626352e-02   -4.149282574932434e-01   -1.355393770712234e-01   -5.902496257463072e-02   -4.385297704327064e-02   -1.622294459349956e-01   -5.598765223548861e-02   -2.070717649992991e-01   +3.033919481929256e-01   -5.254042176798124e-02   -1.444164324998358e-01   -6.421280161605625e-02   -2.033151425172806e-02   -8.746377336509675e-02; +2.201821171848685e-02   +1.031268997915569e-01   +1.322219349099097e-01   -1.200386133223016e-01   +2.927758649841186e-01   -3.390178982619364e-01   +3.796355545273379e-01   +1.362833729979654e-01   -3.066363372701168e-02   -1.039324411963269e-01   +2.221872490104499e-01   +8.929958825673605e-02   -1.620864902356210e-02   -3.593343593857413e-02   -3.441564634896116e-02   +4.820691046025968e-02; +2.990825044686985e-02   -7.354623399271588e-02   -3.720119540565388e-02   -8.017640225800488e-02   -1.269606035311949e-01   +1.401729296584270e-02   -1.194530082661753e-02   -5.404083863941600e-02   -2.730248718730459e-02   +2.174873974004370e-01   -4.123323205389871e-01   -4.641247782076056e-01   -3.133895932246106e-01   +2.035308551111316e-01   -2.353611545142866e-01   -1.753409278333823e-01; +1.390847386452073e-01   +9.899146453217392e-02   +7.823335970859682e-02   -1.684038233455572e-01   -5.783042786103150e-02   -3.420021755720052e-01   -4.574357029402587e-02   -2.480550946010142e-01   +3.461767159209946e-01   +2.992359012583580e-02   -1.166015429439154e-01   +9.327493305624832e-02   -3.557679497256319e-02   +1.314233592706329e-01   -3.002984035740340e-01   -2.655575840433206e-01; -1.428696293629516e-01   +2.097508090467729e-01   -4.925382160646014e-02   -8.853117138187439e-02   -3.674183752279976e-02   -3.620701124387156e-01   -2.713769850314836e-01   +9.686878395656483e-02   -2.793900082923478e-01   +7.334559915780438e-02   +3.158290833360551e-01   +1.297438864212642e-02   +7.777386083841049e-02   -2.263294541648717e-01   +8.792452879537116e-02   -2.576933126639235e-02; +3.598929287345543e-01   +2.610283589271792e-02   +5.626676399912184e-03   +9.662489462174169e-02   -1.173009517080156e-02   +8.218661081258649e-02   +1.480196768974408e-01   -2.846161860106358e-01   +2.098283260161785e-01   +1.602572224170357e-01   +2.498239195043484e-01   -1.532210851613030e-01   +6.202343078514874e-03   +3.769428668234682e-01   -2.122652548122190e-01   -1.949273644493643e-01; -3.543048987222437e-01   +3.685090332551356e-02   +3.534358090589813e-02   +2.479993635048902e-01   -7.593428481277004e-02   +7.594221798376437e-02   +6.460458554217688e-02   +9.167475047522439e-02   +2.815772422006356e-01   +7.108617439950846e-02   -3.371250182127601e-01   +1.667062541198338e-01   -1.224687809141633e-01   -2.707613293059424e-01   +1.034643052111565e-01   -6.573285268536072e-02; +1.590932642841152e-01   +4.745051267013005e-02   -1.009847369820195e-01   -2.937129847198018e-01   -1.331351030007309e-01   +2.615723865683156e-01   +4.237578282822696e-02   +9.002606895232626e-02   +9.033732115308046e-02   +1.041776750619217e-01   +1.049240099757461e-01   -2.498873705762092e-01   -2.382922623361283e-01   -1.081243297649667e-01   -2.255911342019430e-02   +1.900577629909883e-01; -1.652750218077501e-01   +1.643158994618575e-01   +2.363915503720111e-01   -2.066740545030574e-02   -5.557733966127110e-02   -1.473132904317856e-01   +1.259842363493548e-01   +1.412678175823826e-01   -2.349417027015941e-01   +1.543203331441526e-01   -1.240349954867610e-01   -8.652119647127490e-02   +3.671209436561689e-01   -7.709303084305161e-03   +2.451190964277585e-01   +1.557891864726559e-01; -4.151619046464875e-01   +1.600078631829345e-02   +1.396846866986317e-01   +3.679502748668851e-01   -8.900509689265643e-02   -1.030524325942399e-02   +1.949815176670200e-01   -1.155459203281416e-01   +1.437699226252053e-01   +1.778168652734295e-01   +3.372939447787970e-01   +1.262288436068325e-01   -1.415753797902083e-01   -1.140188792998637e-02   +2.132415713704012e-01   +4.378663076429780e-01; +1.408042130000516e-02   -2.857549715466559e-01   +6.637883672343772e-02   +1.910062937670013e-01   -2.574176502074645e-02   -1.125936874045795e-01   -1.969773459589815e-01   +6.847321971805750e-03   -1.848575334905601e-01   +1.305520704568303e-01   -2.933243595409065e-01   -4.312681757039758e-02   +7.919545298859365e-02   -1.746634991098996e-01   +1.886952669505220e-01   +2.284505666945510e-01; +5.041848375539691e-03   -3.454322285412682e-02   +2.831629413537075e-01   +1.555924110286205e-01   +7.545067670467981e-02   +3.290358878356661e-01   +5.571849861502561e-02   +1.815385363745624e-01   -1.350828422413292e-01   +5.708538183151861e-02   +2.170593332660338e-01   +1.042647966810200e-01   -1.904887604533708e-02   -2.985807262855127e-01   +1.515475561428459e-01   -7.749032040578935e-02; -2.237591155926210e-01   -9.730259453600443e-02   +2.675112118604189e-01   -3.066995924112008e-01   -1.387787221389120e-01   +8.815469006170717e-02   +3.011274295849571e-01   -4.102649902930033e-02   +2.146963097398270e-01   -1.551749421611063e-01   +2.420673479026390e-01   -1.192814486778934e-01   -1.393141734846210e-01   -2.162435920189909e-02   +2.648328367338317e-01   -1.412099472262174e-01; +1.385477824865425e-01   -6.809306690478784e-02   -1.856066183262474e-01   -1.193024298873611e-01   -8.401097128390783e-02   -1.084845903682616e-01   +3.524187902262915e-01   -2.101754049634795e-01   -5.978020217154736e-02   -1.744715567933800e-01   +8.770367461503339e-02   -2.674455109509488e-02   -1.002689092869912e-01   -3.915408293949602e-02   +1.990243445747304e-01   -2.181283991643142e-01];
L2I_L1I_iGABA_netcon = [+7.095087138832848e-03   +1.989515952259414e-01   -9.761384432431712e-02   -2.575210307473265e-01   -2.582604282120381e-02   -1.820885268360573e-01   -9.322091923656092e-02   +1.844975232960849e-01; +5.978323562739614e-02   -3.380109395794928e-01   -1.321686414563594e-02   +1.530977700222882e-01   -3.085574638562347e-01   +3.588822869493349e-02   +3.174529592139422e-01   +2.761748993643191e-02; +1.109210411811278e-01   +3.745336086553090e-01   +1.951230195247191e-01   -1.894058821850184e-01   +3.819906751768489e-01   +4.759778151106264e-02   -9.265316810007306e-02   +1.109625912988531e-01; +9.413444177683448e-03   -1.163835832552367e-01   +3.554007707435300e-02   -1.685530623325084e-01   +1.331904884737667e-01   +1.809427041910312e-01   -2.275939420227227e-01   -1.875093338590292e-01; -3.137567299880122e-01   -2.248624052143215e-02   -1.680956186215028e-01   -5.059518658818254e-02   -4.488668718665489e-03   -5.025253963920027e-02   -4.615011171570443e-02   -1.314874857960113e-02; -1.922096005917595e-01   -1.171504326806359e-01   +2.626350403616134e-02   +2.581577897932065e-01   +5.001009039441920e-02   -1.982088420431355e-01   +1.063789168597372e-01   -8.544449011114502e-02; -3.820675260621031e-01   +1.760974514091527e-02   +3.346653312532898e-01   -8.787554565962066e-02   -2.049877242045324e-01   +1.761320516843818e-01   +8.562405295210250e-02   +1.079793027646019e-01; -9.790888797248279e-03   -4.569434911218541e-01   -7.962020155869287e-02   +1.264737563224962e-01   +3.264350871846164e-01   +2.343969334992853e-02   -5.808476645387679e-02   -9.245013180195236e-02; +2.017091763093072e-01   +3.537075864057085e-02   -2.841176856246477e-01   -2.634662667728083e-01   +7.245213181818186e-02   +1.687001315213992e-01   -1.116986761891532e-01   +2.742008008267655e-01; +3.235585061576970e-02   +2.306822539246213e-02   -4.371031955976507e-02   -1.614497950745969e-01   -1.420685899404843e-01   -1.207593522446873e-01   +1.927659289358273e-02   +1.593394700621283e-01; +5.528275855503528e-02   -1.791752783550007e-01   -3.829458883426468e-02   -1.308679209914870e-01   +3.219997362799670e-01   -1.042084551404719e-01   +7.407430276064488e-02   +8.149716705496224e-02; -8.952526686175510e-02   +2.307863958074781e-01   +7.219227991791484e-02   +2.834890947506021e-01   +9.421106712561506e-02   -9.952092675138938e-02   -9.503857217579327e-04   -2.017928844351651e-01; -4.035735388454791e-02   +2.934840386418292e-01   +1.505733540994236e-02   +2.737841809958291e-01   +2.660040786660431e-01   +1.737996538623754e-02   +1.768694574443354e-02   -5.556959116506145e-02; +2.886877389574143e-01   -9.761961952360759e-04   -1.836800198377482e-02   -3.774916175084575e-03   +2.685953586579900e-01   -9.321396603957696e-02   -1.519267478637953e-01   +8.925797662685218e-03; +1.959521680209859e-01   +3.080876722134401e-02   -1.902194008417673e-01   -9.858971937379418e-02   -1.203635063556518e-01   -8.181381265087151e-02   -2.442748928166920e-02   -4.660094635101170e-02; +5.129015467564377e-02   -2.123966087565396e-01   +2.287564319006686e-01   +9.450122368684578e-03   +4.095845657180019e-02   +3.321834900871353e-01   +2.428369866431531e-01   +6.764300277901303e-02];
L1I_L2I_iGABA_netcon = [-1.578392924689839e-01   -4.686959834370356e-02   -8.093335051470484e-02   +1.864231094012521e-01   -2.098443249043254e-01   -6.381778002913954e-02   -1.160725137093286e-01   -6.991437740201115e-02   +1.693207313545169e-01   -3.288483616098513e-01   +4.098497504273592e-01   -1.380239517670063e-01   +1.120103595170770e-01   +3.452247494299987e-02   -3.222474694346543e-01   -2.071047144661757e-01; -3.978802614413064e-02   -3.754276713513121e-02   +8.050249648551804e-02   +2.796067781506151e-01   -2.326235104725781e-01   +9.580358196447789e-02   +8.363940095223964e-02   +8.598485726758716e-02   +1.518717711152612e-01   -2.964681715778741e-01   -1.171601588705903e-01   +4.501377180578483e-02   +7.994440121581613e-02   +2.917469612801202e-02   -1.469779241567074e-01   +1.084816484720189e-01; -3.045255522931079e-01   -1.695402861857857e-01   +7.127161964343078e-02   +1.403446679935579e-01   +2.600912344027041e-01   -2.579213816772364e-01   -8.320106964405741e-02   +2.484973446461926e-01   -7.740781390292038e-02   +2.853915357773190e-01   -3.932213615987443e-02   -3.310767138169435e-02   -1.313829973113343e-01   +4.518069821421716e-02   +2.424717862705073e-01   -1.272094875455251e-01; -8.880243465003719e-02   +2.349411338318897e-01   -1.521507866413298e-01   -1.257842668212555e-01   +6.907152018249574e-02   -4.197362617856627e-02   +1.244948493285306e-01   +1.907194207750212e-01   +1.122340673653045e-01   -1.559198239810815e-02   +2.040693734355773e-01   +5.332314454965098e-03   +8.161384085126470e-02   +3.620052998535131e-01   -5.131092535587745e-03   -1.735169974771932e-01; +1.513543268364299e-01   -1.104353318413067e-01   +3.502452064264100e-01   -1.290094264043779e-01   -4.158945358505579e-02   -1.412738077982013e-01   +1.093880000019467e-01   +1.829793043087451e-02   +1.950959908376042e-01   +1.211714634511070e-01   -7.134554223451120e-04   +1.141931079442236e-01   +2.066843777256503e-01   -5.643520508749812e-02   +2.739638138857450e-01   +3.125777180513035e-01; +1.154942103233888e-01   +1.381150033789500e-01   +5.283048182980148e-02   +7.298117185946773e-02   -2.087671147251456e-01   -1.664240669135802e-01   -4.781256659098748e-03   +3.895936163852083e-01   +8.463583533925893e-02   -3.268078061190197e-01   -1.232897386581546e-01   -9.820393958469008e-02   -2.389528565397387e-03   +8.317562486748019e-02   -1.139549665945361e-02   -1.410096788278098e-01; +2.505807944276082e-01   -4.985898045780945e-02   -1.409970399123789e-01   +1.223464857419274e-01   -2.784509836136771e-01   +2.474132898565481e-01   +1.528947791655852e-02   -8.651436572936429e-02   -2.082784909463026e-01   -7.080495259602765e-02   +2.092476966051819e-01   -5.728080757380029e-02   -8.577079921909865e-02   -3.648398908502033e-02   +8.554255404474753e-02   -1.716488456093880e-01; -6.946649258443589e-02   +2.158934981181836e-01   +2.045212851626999e-01   -2.541812168486544e-01   -8.802762908692932e-03   -2.443828134578457e-01   -1.784800269318844e-01   -5.257933505321802e-02   -3.528621345073092e-01   +1.639949298925464e-01   -2.243002063032416e-02   -2.219145303791024e-01   +1.605697687712053e-01   +7.739445294288187e-02   -2.414673458857276e-01   +1.404449782576779e-01];
L2E_L1E_iAMPA_netcon = [+1.984514382186656e-01   -2.593401054511856e-01   +5.692752919835134e-03   +1.088858140604937e-01   -1.050482092581741e-01   -2.964291296885834e-01   +1.274329971238077e-01   -3.520963403396733e-01; +3.053495753258615e-02   -2.422787182958431e-01   -3.607830119500216e-01   +1.510614444455680e-01   +3.340501248073972e-01   +1.969522510566480e-01   -1.605223538706398e-01   -4.616940542553291e-02; +5.241036700427902e-02   +1.542524162980976e-01   -3.502001917499131e-01   -8.657333973459545e-02   -1.520463187115159e-01   -1.148752921317476e-01   -2.105573055788408e-01   -2.214989548265674e-01; +2.845224923724833e-01   -3.050756975804274e-02   +1.042381490128775e-01   -1.472824992479670e-01   +6.330659074039124e-02   +1.640118409483622e-02   -4.107197026657003e-03   +1.926561988159514e-01; +8.168829904060723e-02   -3.630392797852550e-01   +1.307103758329249e-01   +1.136512139129250e-01   +3.454012063252631e-01   -1.535358275527367e-01   +1.216970035311485e-02   -5.445626118760467e-02; -2.906674311899674e-01   +1.279753938936451e-03   -6.127339761293264e-02   +3.262399808561065e-01   +1.327817206452353e-01   +9.169566418194564e-02   +2.648975538964979e-01   +2.371986088529874e-01; +2.549228518868305e-02   -8.245624788081760e-02   -2.167185278026912e-01   -2.381683816820344e-01   +2.905305322271444e-01   +2.019371990820387e-01   -1.191894614508143e-01   +1.291931540380292e-01; -1.935447416483226e-02   +2.066179648765575e-01   +9.821800960796574e-02   -2.420180360806946e-01   -1.102996802372418e-01   -2.811809245861385e-01   -8.079789894639651e-02   +4.307072825256274e-02; -8.823220939752148e-02   -3.305467620725163e-01   +4.097121402486993e-02   +9.873964132223828e-03   +1.009742257947971e-01   -1.636061243146006e-01   -4.678119384117677e-02   +6.391751196465353e-02; +8.184789692229685e-02   +8.784767830614029e-02   -8.404635226934694e-02   +5.899706087837538e-02   -3.257073262491565e-01   +7.547643289233147e-02   -1.786480709272516e-01   -2.200945830182113e-02; -7.773519851108923e-02   +2.236781669460180e-01   +7.521844112273282e-02   -2.525496375598098e-01   +2.092854343712965e-02   +2.398648337270645e-01   +3.236384458127794e-01   +4.174793337394728e-02; -4.285919243061151e-02   -2.168309669737469e-01   -1.548802865382376e-01   -3.159033493158933e-01   -2.273552446129699e-01   +1.278542045569331e-01   +2.369106629740397e-01   +1.817139909701164e-01; +7.560265515469303e-02   +1.634582027776177e-01   -1.262912838811772e-01   +1.446387458729268e-01   +4.067548440050374e-01   +3.055153039149005e-02   +2.454538118805725e-01   -1.175639273745835e-01; +1.679672383195691e-01   -1.196576019538698e-01   -8.966723506561118e-02   +2.217775522000101e-02   -2.569220692293497e-01   -4.022054535871303e-02   -4.613581456883716e-02   +1.103296006854328e-01; -9.670773436382059e-02   -5.689473076061200e-02   -9.959617190490035e-02   +1.203215120604934e-01   -8.285159751465686e-02   -9.277982687421746e-02   -3.334321630423798e-01   +9.098057031122143e-02; -1.624607658195636e-01   +5.218240003869547e-02   +3.292869377173648e-01   +1.906762203002732e-01   -1.577700135340829e-01   -2.489863537904834e-01   +1.983620793433798e-01   -2.147377183651265e-02];
L1E_L2E_iAMPA_netcon = [+7.888046392825150e-02   -7.305691227646194e-02   -3.490601355970001e-01   -2.227481881133046e-01   -1.345227104315930e-01   -3.333140974753963e-01   -3.756461075228859e-02   -2.300591733828933e-01   +1.805764835833598e-01   +1.866362243474556e-03   +4.121957454540864e-02   +1.035254251288874e-01   +2.660331016862080e-01   +2.185596521529973e-01   +2.048875287141382e-02   -1.432123530451242e-02; +1.125712012422184e-01   +3.470306698268549e-01   -6.976503706975121e-02   -7.887270367279611e-02   +2.433255228198756e-01   +1.794186257962301e-01   +1.234282753337088e-01   +1.522842634276063e-01   +2.096633922727937e-01   -1.234009579487172e-01   -6.891899648768042e-02   +2.841526014922858e-01   +2.717963467848576e-01   -4.062273082284873e-01   +1.316820434999670e-01   -1.397564676863882e-01; -1.201100543365003e-01   +9.267809197331757e-02   -2.071911574573808e-02   +1.640493851116411e-01   +2.256878082953712e-01   +2.576116660148311e-01   +4.362226035737922e-02   +5.800969793469239e-02   -8.493936154167764e-02   +5.389100255487652e-02   +2.774088593290636e-02   +1.997635440231713e-01   -2.832332540992878e-01   -1.530374881692811e-01   +3.442812793014884e-01   -2.529189047600306e-01; +1.240941924080874e-01   -2.440779143469637e-01   -1.558002572402775e-01   -3.960782094024188e-01   +6.445658944670585e-02   -1.119739534110305e-01   +2.181707523217123e-01   -1.706411784284846e-01   -2.293792875732663e-01   -2.917733793401507e-01   -1.747795805470126e-01   +1.621930825291888e-01   +5.306000415338796e-02   +6.776291858632301e-02   +1.362437232738288e-02   -1.674623421395477e-01; +2.951434461846495e-01   +2.420425058157103e-01   -3.277976777433435e-01   +4.070621733255688e-01   +2.074133624014336e-01   +1.177617277714076e-01   -1.341343373067526e-01   +1.005349931561641e-01   +1.606686188499619e-02   -2.402414715283794e-02   +1.933928166905850e-01   +1.917854248331952e-01   -3.351560257513982e-02   +1.403026658895688e-01   -1.698255578588245e-01   +1.554716374469060e-01; -6.738300355327366e-02   +3.473078016261481e-02   -1.903626877018869e-01   -6.920539471153137e-02   -1.953398000362615e-01   +2.002755039136658e-02   +1.964068593845210e-01   +6.901671445150417e-02   -3.392703143269766e-01   +2.004506972352850e-02   -6.644197489994343e-02   +1.128724587125064e-01   -3.178423294235784e-01   -1.034461142222100e-01   +1.683988210615570e-01   +7.906163916645158e-02; +2.226199428492873e-01   -1.431459460566305e-01   -3.610098410390448e-02   -3.175281064843700e-01   +2.184292551631473e-01   +1.083061702542357e-01   -1.739158768444945e-01   -3.718856755400360e-01   +2.106390299634616e-01   -1.799483352626192e-01   -2.476104190917733e-01   +1.248741796246223e-01   +6.477720280088660e-02   +1.474436765631245e-01   +1.049632301294719e-01   +2.396903459831257e-01; -2.777956481898537e-01   +1.125056615556007e-01   +1.749122543343687e-01   -5.091779513897048e-02   +7.987098887439995e-02   -2.970604925566428e-01   +3.039057557856041e-02   -3.443379810033822e-01   +3.043502393624493e-01   -1.386689155669011e-01   +1.062140054290786e-01   +1.039613937994608e-01   -8.619358328779544e-02   -3.043030924038448e-01   +4.252051633199266e-01   -1.713697472874737e-01];
L2I_L2E_iAMPA_netcon = [-2.470889359068631e-01   +4.649352388913136e-02   -6.218107761605354e-02   -1.652846970153292e-01   -7.975187512398296e-02   +2.548870242512360e-02   -1.497522199529732e-01   -2.751719485203196e-01; +1.514365499199957e-01   +1.156692693072627e-01   +1.862249459755013e-01   -2.786868216939273e-01   -2.319345997372579e-01   +6.123782286128188e-02   +1.886616304238783e-01   +1.715539897990591e-01; +3.727477571436045e-01   +2.075276767697918e-01   -3.136571807207596e-01   +1.651242343345322e-01   -3.349176779642324e-01   -1.355558498962671e-01   +4.495881010217364e-01   -1.280892898791988e-01; +1.208579353535122e-01   -1.907396275787239e-03   -2.463799274989593e-01   +3.060008376763543e-01   -1.697613364041952e-02   +2.808388042385206e-01   -1.025317686879321e-01   -2.262210702588389e-01; -1.103684781206463e-01   -6.616776134201305e-02   -1.985944444959397e-01   +2.047048290922316e-01   +2.083297644688226e-01   -4.100005601279842e-02   +1.464302299468327e-01   +8.786942917214477e-03; -5.011287357928937e-01   -1.657052146222722e-01   -3.881333535665166e-03   +1.397366169257611e-01   +3.154781763925265e-01   -1.126785036348977e-01   -5.919510700161286e-04   -1.064551438746483e-01; -7.783606336726789e-02   -2.061404527319898e-01   +2.649319447553074e-02   +8.836869432897063e-02   -3.308496996677379e-01   -7.074574603124620e-02   -3.332352200641134e-02   +1.895698871939264e-01; -1.539900672541490e-02   +2.729840945358480e-01   -2.225084712937039e-01   +3.441002628862095e-01   +3.305314847735094e-03   +5.305276518173873e-02   -1.301620682589154e-01   +2.088346225603198e-01];
L2E_L2I_iGABA_netcon = [-2.591949107414964e-01   -2.930243256172452e-02   +1.685017885427205e-01   +9.167866664134022e-02   +8.029995861817556e-02   +2.441967764199353e-01   +1.007110802767534e-02   +2.629534528175731e-01; -2.424697842568757e-01   +1.653008863733677e-01   +1.433842149466476e-01   +2.209276601592819e-01   +2.497308842351316e-01   -6.512227734026474e-02   +3.141124412370178e-02   +4.444873578980215e-02; -7.841131347947328e-02   +2.468096910079635e-01   -3.413167107371772e-01   +1.331821567159152e-01   -1.895811834766591e-01   +2.268810217897566e-01   +2.281077981317320e-01   +7.672630340118397e-02; -1.053456706783644e-01   +3.040173936547213e-02   -2.709640452479088e-01   +1.135710222883442e-02   +2.025443455282947e-01   +3.283668446120060e-01   -4.407348634657368e-01   +1.853602314309181e-01; +2.900016948711019e-01   +2.595031527389171e-01   +1.777799400943192e-01   -2.060417094772341e-01   -2.231672369404473e-01   +1.528296287701473e-01   +3.047681505950822e-01   +6.872935417893759e-02; +2.226103103598844e-01   +9.457156362949980e-02   -2.383333338984991e-01   -1.278633594973844e-01   +1.743338683162139e-01   +5.241832889905122e-02   +3.440983779417175e-01   +2.472804384304275e-01; -1.730463351996755e-01   -3.991919312076050e-01   +1.107611550391290e-01   -2.789487525372868e-02   +1.463222280703074e-01   -1.378349641565187e-01   +5.101097865284229e-03   -3.331158255024727e-01; -4.750663782931617e-02   +1.241453778930854e-02   +9.343280969014411e-02   +2.561312468632623e-01   -1.681138633451915e-01   +2.048669695077806e-01   +3.003008416984995e-02   -3.489381396490257e-03];
L3E_L2E_iAMPA_netcon = [-1.944874723274036e-02   -4.730803347339250e-02   +2.063759326951834e-01   -1.229149053369331e-01   -2.038584117597810e-01   -2.981279704516300e-01   +1.250420784064283e-01   +1.987993929903271e-01   -7.465905291589604e-02   -1.230175425926522e-01   -1.313656608976508e-01   -2.021482039058149e-01; +2.617322401552510e-01   +8.714910743064197e-02   +3.606195379952959e-01   -1.897160314737028e-01   -2.142980984010450e-01   +3.314463499991542e-01   +1.131943849046690e-01   +1.244872607866466e-01   +1.009512578462380e-01   +3.201000679567021e-01   -1.884521240642812e-01   +1.982833740332960e-01; -3.578767298520279e-02   -9.832680324994500e-02   +1.210387175523012e-01   +3.919235118740995e-01   +1.227163346971933e-01   -1.872245613116092e-01   +1.329976624112476e-01   -1.005403226081726e-01   -2.060609282123390e-01   +1.191091237373370e-01   -1.673720941798775e-01   -1.202898352176072e-02; +2.819670815003522e-01   -1.892844297738906e-01   -4.014661259589829e-01   +2.535576824817698e-03   +4.957751359517436e-02   -2.886552812311313e-01   -1.426418321762643e-02   -2.130295728253753e-01   +2.908086563701664e-01   -2.341941481228784e-01   -2.920287375257719e-01   +1.365858612387184e-01; +4.465556388581837e-02   +2.419800998433259e-01   -9.219384700472863e-02   +9.640421061036938e-02   -1.448068558468495e-01   -7.778209529219446e-02   +1.397561249259293e-01   -1.145401876790641e-01   +1.559159688213780e-01   +2.743303720846185e-01   +2.281496103929016e-01   +1.339426236551104e-01; +3.514660033694651e-03   +1.852979610445353e-01   +6.782664629696772e-02   +1.383932265605445e-01   +6.473356000213812e-02   +4.142702473670948e-02   -5.838949707543693e-02   -2.780873132430108e-02   -9.008894228494396e-02   +1.172695380628995e-01   -3.756302898660249e-02   -2.309743447852444e-01; -1.842551798962896e-01   +1.910622967432468e-01   -9.162285075564837e-02   +2.658572780136492e-02   -2.777986675869972e-01   -1.160471335696838e-01   -1.697467581758828e-02   -9.844068330819276e-02   -1.412271808296026e-01   -7.297081396270198e-02   -8.104410041505083e-02   +2.438561685290217e-01; +1.657903300386503e-01   +4.833772943327712e-02   -4.607398616041260e-01   -1.840383778715787e-01   +1.687925476428104e-01   -2.355419230763271e-01   +6.976753984326325e-02   -3.420617793087438e-01   -1.111575772829166e-01   +1.139717991548829e-01   -5.895722239529187e-02   +1.712347968832328e-01];
L3I_L2I_iGABA_netcon = [+2.749262615655549e-01   +3.210979655704586e-02   +1.093589164697349e-01   +4.217832550409534e-02   -3.936954858912429e-01   +1.663645200989594e-02   +2.268061522505503e-01   -1.071263514410799e-01   -1.271478332210028e-01   -2.372095093354484e-01   +3.051655475520094e-01   +4.795351572771298e-02; -9.018296619916621e-02   -3.224663744555346e-01   -4.333789699182758e-03   -7.642292374744344e-02   -1.332027576584331e-01   -2.140898622476151e-01   -2.906133354272658e-01   +7.981497977989595e-02   -1.829171108129671e-01   +8.057330044938386e-02   -1.804748912903429e-01   +2.258333665375404e-01; +2.991713028676348e-01   +7.356262411483702e-02   +1.450176593972143e-02   +3.244794687049090e-01   -1.047154446185520e-01   +3.062019911017488e-01   -2.508611206845041e-01   -2.359813667148104e-01   +2.030611028237838e-01   -3.796767385108520e-02   +1.142955407217257e-01   +1.537061716733128e-01; +3.310314725962025e-01   -2.776762877880817e-01   +1.159800523496191e-02   -4.917962866435993e-02   -2.380871792589397e-01   -4.010292182408558e-02   -3.532196179132009e-01   +1.868532222817935e-02   +5.784304434625172e-02   +1.535411152131052e-01   -9.006767604495670e-02   -4.101762259040698e-01; +7.365929499651333e-02   -8.449333525733971e-02   -5.339726802687948e-02   -1.778440383199619e-01   +1.544790838695698e-01   -3.959819957576952e-03   +2.647908791192246e-01   +1.354414949352434e-01   +4.279421398986021e-01   -1.157450800028166e-02   -2.957043041706329e-01   +1.986787552580919e-01; -1.040416405492535e-01   -3.201054699382567e-01   -3.477246919205811e-02   +4.291822961133974e-02   -1.607390945625797e-01   +1.769439050164170e-01   -5.260547469592680e-02   +1.371465366476008e-01   -2.693465341258293e-01   -1.053827089099972e-01   -1.770157900710889e-01   -3.525378185344897e-02; +1.086835928050886e-01   +5.503822365728116e-02   -3.568258345563903e-02   -9.577226086940886e-03   -1.814436923546390e-02   +2.943624812169188e-02   -1.888913087372351e-01   +1.487950599603709e-01   +1.952577144386876e-01   +2.962090621174605e-01   -2.958025915655392e-01   +7.001453166408697e-02; +1.165594471895417e-01   +3.534025125128694e-02   +7.118202857470698e-02   -6.056668433952649e-02   -1.050149414096310e-01   -8.534563478663729e-02   -2.141369383205465e-02   -1.688114882472187e-02   +6.686834352026257e-02   +2.549682859030032e-01   -1.595398399527618e-01   +1.720832264798917e-01];
L2E_L3E_iAMPA_netcon = [+1.141600341567156e-01   -1.217383867234043e-01   +2.325328389179368e-01   +6.460118381117903e-02   +1.212649156474962e-01   +3.901420558553312e-01   -8.683098123410732e-02   +1.889362368321692e-01; +2.229970741208840e-01   -1.092662133580133e-01   -2.401935341711862e-02   -1.421663277640811e-01   -2.648836276262095e-01   +6.298891918695532e-02   -1.705904902307104e-01   +1.032796242373264e-01; +1.307651782955327e-01   +3.201823393025867e-01   -1.850434660254488e-02   -1.554438012653174e-01   -2.697283545883291e-01   -1.704745819842155e-01   -4.116034943668227e-02   -9.267849797915712e-02; -1.888887596440113e-01   +1.943564376953026e-01   +1.384585251381139e-01   +1.072149642075066e-01   -1.501671408955909e-01   -3.194797903755796e-02   -8.334320293756753e-02   +2.990999049669352e-01; -8.662380220209968e-02   +1.874922758557135e-01   +4.530329865839693e-02   -1.530569856581204e-01   +1.454912031538302e-01   +5.902506062417529e-02   -1.818444236860615e-01   +1.791376967051203e-01; -2.701856134047150e-01   +3.922993661106738e-02   +1.150457323399785e-01   -4.394906771806788e-02   +8.133578947505879e-02   -2.562387068554990e-01   -1.724252499347205e-02   -1.111238667166855e-01; -9.085389880842956e-02   -2.344234091052341e-01   -1.703771364272974e-01   +7.608644355422411e-02   +3.621660564822249e-01   -1.368258961653925e-01   +4.108949209779063e-01   -4.063186891718835e-01; +4.300952575784422e-01   -1.456514187825847e-01   +4.315542022352570e-02   +5.242267963921895e-02   +2.346760215591303e-01   -7.760594357179151e-02   +2.188922925066206e-01   +2.122140434195434e-01; +2.393436300499403e-01   +4.216040301243727e-02   +2.179965870116762e-03   +1.765758975464707e-01   +3.826858164093825e-01   -8.440149562798367e-02   -9.412507729982046e-02   -3.669806978441208e-01; +9.933993253025597e-02   +1.459046142841087e-01   -4.770712286939169e-02   +1.721265660242751e-01   -2.204790920613220e-01   -7.900161219435857e-02   -6.574038009835928e-03   +2.656130920770245e-01; -1.267321291492325e-01   -1.944600161789770e-01   -2.924728066837827e-01   +1.262610830009832e-01   -2.058979250331238e-01   +4.903063550030936e-02   +4.411961300813967e-02   -1.605715142926290e-01; -2.031715081262979e-01   -9.491147492314561e-02   -8.617906802838882e-02   +4.524707696014835e-02   +8.676782548144543e-02   -1.156671099093180e-01   +3.404078341377128e-02   +3.884851966475149e-01];
L2I_L3I_iGABA_netcon = [-2.850973394813774e-01   -8.938592723188546e-03   +1.800172124276829e-02   +3.954200092382031e-01   +1.589000342530665e-01   -2.046724310201588e-01   -2.707235583779032e-01   +5.587777109582809e-02; -1.924515877410383e-01   +1.048366446815914e-01   +1.057583639624292e-01   -1.094635117847647e-01   +1.391803346224826e-01   -1.129153937926794e-01   -9.347985405761763e-02   -2.430028705490850e-01; +2.371490202165040e-01   -1.616694635078207e-01   -2.012170369230942e-01   +1.476537393846502e-01   +6.884394339025830e-02   +8.464516161704200e-02   +2.206528228273780e-01   -8.788955961962169e-02; +9.669118771328226e-02   -1.924781555146096e-01   +2.736339141850341e-02   +2.522523120635086e-01   -1.246920349852020e-01   +2.228938912351403e-01   -2.578536227684264e-01   +1.635050704608529e-01; -1.370571141644514e-01   +1.408027061030189e-01   +7.417658311264394e-02   -3.495346651363586e-02   -7.200688863947158e-02   +8.055264541465465e-02   -7.904711461117148e-02   +3.895971548751997e-02; +1.141589948618758e-02   +1.335912153508979e-01   -6.500138272696879e-02   -1.816758907217539e-01   -1.876648730823161e-01   -2.090382121198975e-01   -2.268335879574649e-01   -1.457321020184879e-01; -1.521088939738469e-01   +1.989437440780801e-01   -1.326485887619021e-01   +6.360985934668396e-02   +3.232281504497816e-01   +4.534602126497778e-02   -6.751864930589699e-02   -1.693243115458220e-01; +1.201723772181624e-01   +2.626760607851220e-01   +2.787077168019610e-02   +2.282247346033691e-01   +1.999710645036232e-01   +2.166324752647334e-01   +1.481720095418377e-01   +2.460386406696186e-02; -1.153228645465184e-01   -3.110946175019952e-01   -2.635954766237663e-01   +6.037119366382316e-02   -1.195747145146570e-01   +3.361462814118968e-01   -2.050890794503754e-01   +3.204197947917898e-01; +2.057885423162306e-01   +2.552560253306571e-02   +1.615216962575190e-01   -8.516748705364664e-02   +1.785153050230318e-01   +1.788994385813197e-01   +1.151753551661253e-02   +2.598885663097945e-01; +1.489513429532462e-01   +1.501589497488368e-01   +1.203758088091050e-01   +4.795611525909221e-02   -1.454428206920833e-01   +1.542416246552034e-01   +2.135256216944490e-01   +1.146682550186486e-01; -2.200512630182811e-01   -1.048826698987610e-01   -5.482470151729479e-03   -1.961455636283937e-01   +1.132944488078628e-01   -4.323890986937554e-02   +4.209355836990395e-01   -1.650422942774627e-02];
L3I_L3E_iAMPA_netcon = [+2.418455985472261e-01   +2.547204921387766e-02   -2.012678395838350e-01   +2.069650189325026e-01   -1.588173549696712e-01   +9.474735450204722e-02   -5.725688245841964e-03   +2.283830621397474e-01   -1.114143519626849e-01   -1.254337601757270e-01   +6.210946811711651e-03   -2.160554501761799e-01; -1.559336233905564e-01   -1.682795807064318e-01   -9.880641966298093e-02   -1.163447782355288e-01   -3.356964482655450e-01   -1.735904312600512e-01   +8.176560549007675e-02   -2.518764078835711e-02   +3.600219767070069e-02   -1.889530437811099e-01   +2.641563231253408e-01   -4.038132908149590e-02; +2.815205754740943e-01   +1.693958918089387e-01   -7.968464745715970e-03   -1.249813262789723e-03   +1.734097466965676e-01   +1.253607833282451e-02   +1.937130859463244e-01   +4.493930577417624e-01   +9.922458891104481e-02   -2.350473260768792e-01   +1.124779532255825e-01   +1.416325296377068e-01; +2.221907061345761e-01   +1.727678910514873e-01   +2.173601606917882e-01   -5.694049051862984e-02   -6.740344766635736e-02   +2.908848619893294e-02   -9.420755776250593e-02   +1.644660748652722e-02   -1.615985932442688e-01   -2.233188014002791e-01   +3.285870000310145e-02   +2.699125550521616e-01; -7.086071317433738e-03   +1.539320021615806e-02   -3.623841454590323e-01   +8.598801412457273e-02   -6.434261642193768e-02   -8.215144902279194e-02   -7.204884414315785e-02   +1.201249649319098e-01   -3.852510676880461e-02   -3.279913832400126e-02   -4.111545470499280e-01   -2.802961765173295e-01; -1.096689853346694e-02   +9.489180275418960e-02   +7.843976317437049e-02   +6.678178494773611e-02   -1.648161459870077e-01   +2.648476499362425e-01   -1.835428268740835e-02   +5.035168143940547e-02   -3.952907156548929e-01   -6.575338241277535e-02   +1.743315843521666e-01   +1.969955334838542e-01; +1.234242844067372e-01   +2.044078979665773e-01   +9.053957457875839e-02   -2.312251597296596e-01   -1.761153967970776e-01   +4.752660154629150e-02   -7.052273832470062e-02   +1.691187278118326e-01   +1.079635828180279e-01   -3.680264972477731e-01   +1.269406665688455e-02   -4.742203594682852e-01; +5.143957737633748e-02   -1.796047759397081e-01   +7.041314103227975e-02   +3.190537377169628e-01   -9.325074087817778e-02   -3.040123669127894e-02   -2.944090780639129e-01   -2.416447680545917e-01   +4.486031516150172e-01   +2.121756545580145e-01   -6.766261708298706e-02   -2.565145344732007e-01; +7.953095675891975e-02   -9.534788252204068e-02   +3.692798848952661e-02   -9.672024449867435e-02   -4.177287451893467e-02   +1.081737709642210e-01   -1.072981999786481e-01   +8.924278411008640e-02   -8.946742377356227e-02   +1.599954963930687e-01   +1.048988877956224e-01   +7.942667326705984e-02; +7.119339622531025e-02   -2.368352663090030e-01   -1.571631131174379e-02   +1.103595756532177e-01   +4.190666653276021e-01   +1.529626776795711e-01   -4.671133709430603e-01   +5.651835797073942e-03   +2.645941908083380e-02   +3.258816753958488e-02   -1.290934152374942e-01   +4.157581505691323e-01; -1.293013861487798e-02   -3.122924875770557e-01   -3.397301062908449e-01   -1.154130512329711e-01   -1.744824598240987e-01   +1.047547110653352e-01   +2.427763371190090e-01   +3.147310218515587e-01   -8.406209500950224e-03   +1.185608106808230e-01   +2.521250660167561e-01   -1.127960835828357e-01; -2.084072756323515e-01   +1.324706701623942e-01   -6.872911493058713e-02   +2.776754911312413e-01   -2.360979918264985e-01   +1.079841654672458e-01   +3.903978049221912e-02   -4.906330198728507e-02   +4.701923991283831e-01   +6.022502170495066e-02   -5.376337953832634e-02   +5.102441466188464e-02];
L3E_L3I_iGABA_netcon = [-9.793775927020340e-03   -8.208565040427376e-02   -9.091612706691260e-03   -1.987903807311345e-01   -1.454170761649280e-01   -3.152236710121324e-01   -1.380905440547542e-01   -2.007188941643740e-01   -3.888887806798810e-02   -2.713330103150645e-01   +3.027835054579678e-01   -1.723073850830547e-01; -1.469030793559932e-01   +6.605907577257708e-03   +6.871847293437661e-02   -1.265493446465074e-02   +1.879816492010031e-02   -1.331423092184434e-01   -1.612542082453758e-01   -1.896509682592032e-01   -1.574414341070105e-01   -3.299506892894919e-01   +2.620989062362711e-01   -4.050811988863018e-01; +4.649775806659349e-02   +1.070506998613146e-01   +1.120191298152408e-01   -2.864059198755531e-01   +1.603604465884727e-01   +3.308779055579294e-01   -3.401437732936428e-02   -2.922694859348832e-01   -3.328161604042600e-01   -2.226452466439446e-01   +3.643950401979619e-01   -7.295954071178018e-02; +4.666003610091244e-01   -1.424021896966603e-01   +3.658532455398400e-01   +4.455396269904521e-02   -2.530437605879691e-02   +4.105642796078482e-02   -3.463427292968202e-02   -9.198507109517608e-03   -1.700603689821022e-01   -7.161644059159439e-02   -1.624677976689212e-01   -1.626832350851620e-01; -2.955390198339446e-01   -2.375172149995433e-02   -1.179728021120206e-01   +8.979842113113681e-02   +1.045368198951621e-01   -7.868068890064668e-02   -1.543323758330339e-01   +1.697763206452698e-01   +3.691583690040538e-01   +2.367774860593322e-04   +1.997988399946796e-01   -3.195017972277119e-02; -1.379979251107334e-01   +2.737855959997845e-01   -2.746898067543539e-01   +2.516807022229026e-01   +8.830558973095176e-02   +3.908502829535549e-01   -1.922206108486716e-01   +2.775585908763188e-01   -8.498298769026857e-02   -1.686802084543334e-01   -7.412421732908463e-02   -1.088965924878143e-01; +1.627236849858639e-01   +5.109464963154189e-02   +3.459683448292785e-01   +1.217767036907502e-01   -1.349452659333917e-01   -3.736128528777822e-01   -1.699839246901551e-01   -1.003842465024204e-01   -3.826624371456224e-01   -1.951746832377090e-02   -1.637869270683899e-01   -4.068231170913381e-02; +7.135318839749837e-02   +9.592229584768296e-02   +2.034636318228772e-02   +1.368518542524433e-01   +9.462822639206915e-02   +5.358796283673471e-02   +9.073986253259055e-03   +1.407950434544746e-01   +6.974500867947649e-02   -9.400047189557427e-03   +3.213931756152639e-01   -4.708520639594968e-02; -5.687598671996373e-02   +1.414058970462922e-02   -2.486835238344490e-01   -3.224478508428445e-01   -8.721549108028680e-02   +2.280658897027053e-01   +3.464851745385706e-01   -2.274920285913514e-01   +8.759559119391913e-02   +1.478665990492416e-02   -2.688227162177594e-01   +3.689611059156978e-02; +4.282131684028504e-01   +1.331297819832353e-01   +1.307377882957259e-01   -4.975384947690002e-02   -2.988169793660524e-01   -2.064415101442034e-01   -3.344034380924502e-02   +2.483944748403507e-01   +7.271571247510700e-02   -3.742331838975364e-02   +7.622658308276548e-02   -7.054215556776869e-02; +1.092534692064764e-01   +9.552346414796985e-03   -2.177567347345861e-01   -2.066846894569992e-02   -2.637306282626376e-02   -1.825490297079651e-01   +2.347007871898074e-01   -1.673116121713133e-01   -3.105026815562488e-01   +2.957941094359044e-01   +2.325152765527631e-02   -2.756017656773412e-01; +1.458314523500635e-01   -3.061781617795478e-01   -2.680761568465853e-02   +1.881452173323026e-01   -2.419917742851503e-03   +2.617827505544060e-01   -2.993210420889826e-01   +2.307968380008045e-01   +3.668743360499698e-01   -2.782745274321167e-01   +2.472075074711238e-01   +2.898306102974341e-01];
L2E_Input1_iAMPA_netcon = [+4.913334911989910e-02   +9.732027180195030e-02   -8.270686960587698e-02   -1.582040650644708e-01   -3.184364882270481e-01   +2.605477216824023e-01   -3.839833402637405e-01   +6.506756845057146e-02];
L2I_Input2_iAMPA_netcon = [+8.962973550375831e-02   -9.097963268435574e-02   -5.318410546736661e-02   +1.944725416412819e-01   +2.546408370483635e-02   +3.579013139797144e-02   -3.889132019377434e-01   +2.888799493443769e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
