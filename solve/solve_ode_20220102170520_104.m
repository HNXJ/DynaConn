function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.435137464224416e-04   +1.453362419567205e-02   +2.145079580000520e-02   +2.026493997930708e-02   +1.840656136313557e-02   +3.044747700055371e-02   +7.002052560559005e-03   +3.439035394758201e-03   +4.449655745407960e-03   +1.127011472889461e-02   +1.401240373534423e-02   +8.369363521406178e-03   +1.665330829327621e-02   +2.533032411484821e-02   +1.576747108250055e-02   -1.623385943659558e-03; +1.200628092705840e-02   -2.719462147630645e-03   +1.620153289787297e-02   +2.071385022113425e-02   +7.179446129926366e-03   +4.808075477476701e-03   +2.868528564395057e-02   +2.512292450695806e-02   +2.201771529173452e-02   +1.112077542262668e-02   +3.022268968336242e-02   +8.341487690286288e-03   +5.093741550429545e-04   -5.839035549562450e-03   +1.088926267728063e-02   +3.207378595429721e-03; +1.220001335867260e-02   +1.882494342312689e-02   +2.030963909979482e-02   +1.375350731322130e-02   -1.974367730052985e-03   +2.633129796622946e-02   +2.382741988734482e-02   +1.306514465933481e-02   +1.089368984714689e-02   +4.371020656769178e-03   +1.439397941562734e-02   +6.468043861724827e-03   +3.753312062672494e-03   +8.857421288347888e-03   +2.221128271311477e-02   +1.460905874036797e-02; -3.246334953209657e-03   -4.088810081162910e-03   +9.258229501504196e-03   +2.023221488890701e-02   +3.401541887404953e-03   +1.790126566692210e-02   +1.688884081104937e-02   +2.170879980367126e-02   +1.130200798602994e-02   +6.744285355007559e-03   +2.820453164857202e-02   +2.010645812817912e-02   +1.177393481440138e-02   +2.799929700640309e-02   +1.088191629831614e-02   +6.800536256019814e-03; +1.470718464442060e-02   +1.488802384711861e-02   +1.609195147715036e-02   +1.825174807360581e-02   +1.291547869314036e-02   +2.750198392837853e-02   +8.326991864563435e-03   +7.314231961212138e-03   +2.114222562764519e-02   +2.899122877509705e-02   +1.611113915458217e-02   +1.983727801984837e-02   +6.092982846617759e-03   +4.668576305639547e-03   +3.090168017536508e-02   +2.217404691031642e-03; +1.210636597866191e-02   +2.563362679110682e-03   +2.008106948106192e-02   +4.290497408526170e-03   +1.475407471739534e-02   +1.204015131507543e-02   +1.206487290503781e-02   +7.221525051596333e-03   +1.412553717030126e-02   +1.822550361213647e-02   +2.253288362409155e-02   +1.227789385543695e-02   +1.389692891578365e-02   +8.359373951418721e-03   +1.155147519337694e-02   +1.863670228338430e-02; +6.213797348557527e-03   +1.548189530266038e-02   +2.548490133365657e-02   +2.002056337368615e-02   +1.692227882443310e-02   +1.504671770619899e-02   +5.847051111376417e-03   +2.764449373592718e-02   +2.762990826041537e-02   +5.628255740856325e-03   -8.907045488513979e-04   +5.799650723653156e-03   +9.954181623074345e-03   +2.511855654584630e-02   -1.998161712511379e-03   +2.677412992009064e-03; +1.877495949331157e-02   +1.009660409409076e-02   +2.372148495518089e-02   +2.202563686159515e-02   +1.570916778372497e-02   -1.174593838364671e-03   +3.202669123137911e-03   +1.491583789444678e-02   +2.360003063395940e-02   +2.198984425121644e-02   +7.108970278497603e-03   +1.543852778435808e-02   +7.938219746745651e-03   +4.781209428925927e-03   +2.193525997687756e-02   +1.997676706173488e-02; +4.793673822534469e-03   +2.374586630025823e-02   +1.663231469785151e-02   +1.574412183310061e-02   +3.367918067463797e-03   +2.291206747615796e-02   +1.055155521216183e-02   +1.454616544502152e-02   +1.157544560276274e-02   +1.419971434126370e-02   +1.139302645352445e-02   +2.485660475182444e-02   +1.790724584581771e-03   +2.300722248923850e-02   +4.819307730733380e-03   +7.241456272966624e-03; +1.185045062332921e-02   +4.936646452647321e-03   +2.509257877126200e-02   +1.710777327828504e-02   +1.286970633028084e-02   +5.336144322868646e-03   +2.241068161503474e-03   +6.144582038348069e-04   +1.574757942468100e-02   +9.939355548945454e-03   +7.053304120209302e-03   +1.618641440739468e-02   +2.769544440755983e-02   +1.659765819652441e-02   +2.883890588534025e-02   +1.728370063182125e-02; +6.817780653026138e-03   +9.393240482778852e-03   +1.817060750362065e-02   +2.193404796784326e-02   +1.738099048731592e-02   +7.535422685486219e-03   +1.949044779106714e-02   +2.200125587914901e-02   +7.410870989846916e-03   +7.006455045692027e-03   +1.862281403182115e-02   +2.338017891514664e-02   +2.574756069814275e-03   +1.359833724969705e-02   +2.211698639990721e-02   +1.272595098658881e-02; +1.904657543464786e-02   +7.145910354242312e-03   -6.251085036507599e-05   -2.528846445826985e-04   +2.076251187644406e-02   +2.697900793167729e-02   +1.459793826639260e-03   +1.985130262641991e-02   +1.789402395748894e-02   +8.263152822138667e-03   -1.153466541734520e-04   -2.382192745769747e-03   +2.559705259036038e-02   +3.740327702905508e-03   +1.907522399168866e-02   +1.363833790451830e-02; +2.130296683325545e-02   +1.807850764442657e-02   +1.802475789759555e-02   +3.712783263625868e-03   +2.207370718864927e-02   +1.212520474398389e-02   +1.919518115425565e-02   +2.119680541079418e-02   +2.404401035216341e-02   +9.033294163357439e-03   +7.465327125300445e-03   +2.787522872778195e-02   +1.653016612667476e-02   +1.592287165067651e-02   +1.598957029637629e-02   +2.328570517553967e-02; +2.433986006103991e-02   +2.034952189645639e-02   +1.019394263098558e-02   +1.542986580275799e-02   +3.138872677555899e-03   +6.421907973250708e-03   +3.247436770057397e-03   +3.121118334328699e-03   +1.163267307501507e-03   +2.334353130430211e-02   +6.854540285186137e-03   +2.843750570681149e-02   +1.867583757675083e-02   +1.451604469000893e-02   +8.408727425955078e-03   +1.329432019907955e-02; +2.449913708768404e-03   +1.846886114135436e-02   +2.721158598386900e-02   +1.488609403548786e-02   +1.558072023409593e-02   +9.847959394245646e-03   +9.174221236957181e-03   +1.583087187243955e-02   +4.830450475513340e-03   +2.453466050342954e-02   +1.581682865458250e-02   +1.722113705994696e-03   +2.845755549161326e-03   +2.522592493904875e-02   -2.905922344671616e-03   +1.518819567124283e-02; +2.635896835397183e-02   +5.052997609917803e-03   +5.496074854794628e-03   +2.950806677269617e-02   -1.204362676647820e-03   +6.164648735490125e-03   +2.070709500637844e-02   +8.285633527012691e-04   +1.006341424490855e-02   +2.318789761734122e-02   +2.023087228623026e-02   +2.003338476787777e-03   +2.311186070854612e-02   +2.055860364960551e-02   +2.379768801118843e-02   +2.423739747663862e-02];
L1E_L1I_iGABA_netcon = [+1.145162581090989e-02   +2.130362753882485e-02   -3.385471474060678e-04   +1.215583418281540e-02   +2.278103833047000e-02   +1.177693594928845e-02   +1.533204189513124e-02   +7.120510496106357e-03   +1.281176147385690e-03   +5.707604699010539e-03   +4.133792017083301e-03   +1.253512523495389e-02   +1.110108412225384e-02   +2.296812689668757e-02   +1.728810166817187e-03   +9.761677342692890e-03; +4.560071945423782e-03   +2.080074070915419e-02   +1.079918545761552e-02   +2.328952584901818e-02   +1.275085302640443e-02   +1.358499876568748e-02   +2.319179496998424e-03   +1.640757247820850e-02   +1.582252337259385e-02   +2.546042820435665e-03   +2.615380183123215e-03   +2.115028754093415e-02   +8.101188763135802e-03   +1.327872718533994e-02   +1.161024972646864e-02   +2.654998570065777e-02; +1.177553249720962e-02   +3.269652485082701e-02   +2.476847864593481e-02   +1.989773895025161e-02   +3.548582959612993e-03   +1.568119244956566e-02   +2.060986335818381e-02   +1.946306683864506e-02   +2.710245675675482e-02   +2.281259653250063e-02   +1.960391914863534e-02   +1.285773407077892e-02   +2.616572939220203e-02   +2.321481806349269e-02   +1.087645546966285e-02   +1.941347179764710e-02; +1.060556877361241e-03   +9.340157941768640e-03   +2.527514118520605e-02   +7.083179993095727e-03   -3.976603122672169e-03   +1.637741471697723e-02   +2.090756715771447e-02   +1.327539799951838e-02   +1.299737961911598e-02   +2.517001309699005e-02   +1.568192147854625e-02   +3.156465138594456e-03   +1.381849853575868e-02   +9.939736238864258e-03   +3.087128498498692e-03   +2.470511812195496e-02; +7.848939105582502e-04   +2.514331718747019e-02   +1.210622794649292e-02   +4.074729228311911e-03   +1.788055848143403e-02   +2.063501974893802e-02   +1.684799956808164e-02   +1.347684195512238e-02   +4.257190859561539e-03   +6.185374828944888e-03   +2.573880943092841e-02   +2.683542804568142e-03   +1.953720909607183e-02   +9.707453121096929e-03   +1.460351195584165e-02   +7.371110347934074e-03; +2.132992215182982e-02   +2.005311918868593e-02   +2.361479690038775e-03   +1.769157991977821e-02   +6.992689264376314e-03   -2.283166391241325e-03   +2.166129835172512e-02   +7.418506009909018e-03   +2.354321827760976e-02   +3.344039493227642e-03   +1.603505876996984e-02   +5.513913788033254e-03   +1.137670743054092e-02   +1.121428543222372e-03   +2.031196372522683e-02   +1.221699555792170e-03; +1.438467118033254e-02   +7.683255231769155e-03   +2.843617416412679e-03   +9.751719413168342e-03   +6.240562399847197e-03   +1.270148610245519e-02   +9.346398065266341e-03   +1.101343089844218e-02   +2.661429240211483e-02   +6.498535380244023e-03   +2.371018252560251e-02   +2.722298341062777e-02   +3.455650951012560e-02   +1.824381240875973e-02   +1.423021669837126e-02   +7.438854898341014e-03; +4.724877338510148e-03   +3.816120488238248e-03   +5.535779252760744e-04   +1.616190888082707e-03   +1.678473813389367e-02   +1.305738999736485e-02   +1.149257582503813e-02   +1.533788767372678e-02   +3.492662611389264e-03   +1.191579086046497e-02   +1.942423209841825e-02   +3.585610238303896e-02   +1.156786431043780e-02   +1.423099687444556e-02   +2.098488598183261e-03   +2.183597447083105e-02; +6.055132439865617e-03   +1.092096514021225e-02   +6.255470008555278e-03   -1.943631631773141e-03   +1.063006086780625e-02   +1.950266902760775e-02   +2.962604118368195e-02   +2.631914391644915e-02   +7.303153752428009e-03   +3.981496897352598e-03   +2.173435639582566e-02   +9.528488268319920e-03   +2.524776208852299e-02   +2.917630456910270e-02   +1.241455880785108e-02   +6.393821861661044e-03; +5.182059352879026e-03   +9.169499134945139e-03   +1.687032048181136e-03   +2.061519089486265e-02   +6.325930166647055e-03   +2.244663487078756e-02   +1.386130555154112e-02   +2.949971922576754e-03   +2.633949111190716e-02   +2.121250146112358e-02   +2.105894912340323e-03   +1.852176624503016e-02   +2.729885856210173e-02   +1.355252199982545e-02   +1.351193909377557e-02   +7.497315781498870e-03; +2.598307284286715e-02   +2.389919319871250e-03   +8.677160803558022e-03   +1.309614851204450e-02   +1.933270384506297e-02   +1.405099250856095e-02   +1.750174930081892e-02   +2.769228930349808e-02   +1.229819878295341e-02   +1.090065120653937e-02   +1.937433914185671e-02   +1.818914102509732e-02   +7.070770568571430e-03   +2.991305753105745e-02   +2.218594119537965e-02   +6.295294235719212e-03; +1.176358152366466e-02   +2.657474062750273e-02   +1.348542571723935e-02   +2.594736260477220e-02   +2.894192236244337e-02   +1.595644333766951e-02   +1.552072908706369e-02   +1.764141734492007e-03   +1.934611972702207e-02   +1.157816452728319e-02   -2.495684901597377e-04   +2.302719872960200e-02   +1.536618168224311e-02   +2.051827358029885e-02   +1.722725415452589e-02   +7.928838795557025e-03; +2.375617685644582e-02   +3.002801777941452e-03   +1.553927532900210e-02   +3.021443238598715e-03   +1.035122800039234e-02   +1.610136058703577e-02   +1.101987424764282e-02   +6.393278670346652e-03   +2.108418208018606e-02   +2.646934179609461e-02   +1.037963987414923e-02   +1.963563503991868e-02   +3.257510587123408e-02   +2.100080907871432e-02   +7.321780291181758e-03   +4.454672284233064e-03; +1.206551972576617e-02   +2.507092352627254e-03   +1.542514703967966e-03   -2.845932391520472e-03   +2.149463191955929e-03   +2.276206711158178e-02   +3.070539419403229e-02   +2.178124899219452e-02   +8.699638342018399e-03   +1.488951073975754e-02   +2.078995798958722e-02   +1.668536322747663e-02   +1.634271886166462e-02   +2.668168981121822e-02   +2.138016130937278e-02   +2.101147397806189e-02; +1.778117606598090e-02   +4.930099875826801e-03   +1.076138381132933e-02   +2.316236579938247e-02   +1.629908077644951e-02   +1.063271517560158e-02   +4.227524293506371e-03   +1.001780283839031e-02   +4.203732130349126e-03   +2.115062332858888e-02   +8.378289023041453e-03   +1.463178910291724e-02   +5.290999196254884e-03   +5.443620991575097e-04   +5.330561674125836e-03   +1.174684804907643e-02; +1.513600600193161e-02   +5.916186564269078e-03   +9.931222092242946e-03   +2.513779706886886e-02   +2.677637216022774e-02   +5.935354322402575e-03   +8.111011775793382e-03   +2.463764442290726e-02   +2.222563059487283e-02   +2.729994172531793e-03   -1.725791590240730e-03   +1.457944901629151e-02   +2.266432718230633e-02   +1.928902298363095e-02   +9.540768018352720e-03   +1.602463269132205e-02];
L2I_L1I_iGABA_netcon = [+3.292035521899003e-02   +8.395093800585989e-03   +3.972571002184629e-03   +2.677318454448258e-02   +3.043421493147562e-02   +2.180213166167816e-02   +8.306864418981499e-03   +2.483569825067533e-02; +2.067079225596564e-02   +2.383034828613382e-02   +1.510057101369398e-02   +1.263924984300373e-02   +1.489206746722247e-02   +2.156542888004567e-02   +1.930159410473187e-02   +4.179873862828654e-03; +5.479197858609263e-03   +9.735659178206575e-03   +2.807270452241821e-03   +5.627892467411141e-03   +2.679705401744149e-02   +2.837058967796334e-02   +7.615711373642449e-03   +1.866257600762055e-02; +4.402981405782345e-03   +2.542422784726033e-02   +1.842786145811786e-02   +1.701656848793729e-02   +1.681078792110985e-02   +1.529314901219651e-02   +1.332291777115930e-02   +2.841967302476459e-02; +8.501459042583849e-03   +6.331832545807773e-03   +2.258007557862696e-02   +1.540331899923972e-02   +9.135343999115687e-03   +2.458038057426441e-02   +1.372608918035626e-02   +2.206310378282273e-02; +2.239830435447606e-02   +2.068183435298689e-02   +2.436573693550013e-02   +1.475580024483363e-02   +1.286920982672612e-02   +1.747217816160641e-02   -2.141851790525648e-03   +1.860592426946106e-02; +2.673203984991715e-04   +1.115237650228358e-02   +1.236830650085122e-02   +1.333662494949357e-02   +2.051352853070911e-02   +6.799738477529671e-03   +8.404197179681328e-03   +2.411092803545131e-02; +1.299723747955348e-02   +9.444747909371755e-03   +2.318722425439803e-02   +1.117182813835604e-02   +5.367738381172437e-03   +2.159941454100562e-02   +1.640564265579597e-02   +5.224235376817657e-03; +1.422528944811674e-02   +1.419426549741375e-02   +1.230383149159120e-02   +9.376490349933321e-03   +8.821880744520436e-03   +5.908811714593438e-03   +1.392298038373509e-02   +2.590928166638143e-02; +9.154295349492858e-03   +1.507701794038174e-02   -4.296685420689606e-03   +1.290857471695545e-02   +4.893853197170294e-03   +1.886770156102587e-02   +2.829161369403801e-02   +1.450438339900180e-02; +6.503940265702060e-03   +2.336096169866385e-02   +2.656164120937804e-02   +7.554214466084471e-03   +2.029676997768749e-02   +2.458980377080553e-02   +1.768265054102866e-03   +9.506369800286660e-03; +2.344204109160196e-02   +1.165337724964204e-02   +1.820947150882342e-02   +8.782349242912943e-03   +2.539040060338448e-02   +4.045797281838883e-03   +1.837891219677009e-02   +6.088345566678112e-03; +4.940149140879776e-03   +2.780761472190951e-02   +2.527148075373549e-02   +3.324712580930007e-03   +1.574540347326036e-02   +5.807451153560192e-03   +1.036193601306063e-02   +1.847456794547246e-02; +2.584816358070618e-02   +4.008407442050616e-03   +3.045125394358931e-02   +1.686826149155359e-02   +2.544812911000385e-02   +6.225587185098287e-03   +2.611824045943539e-02   +7.124470727222140e-03; +2.770594404563723e-02   +1.065756944198216e-02   +5.737613952566325e-03   +3.004205432049665e-02   +1.930428719658841e-02   +4.550508708645877e-04   +1.247020324401077e-02   +1.964406739202793e-02; +1.907204180614833e-03   +1.902533170054932e-02   +1.707722861799936e-02   +1.807407178393104e-02   +2.631686143840669e-02   -1.915413700998780e-03   +2.371779800893624e-02   +9.088541099086734e-03];
L1I_L2I_iGABA_netcon = [+2.077024168820439e-02   +1.631130490054333e-02   +5.554690225704552e-03   +4.296071234394344e-03   +1.451260003859827e-02   +1.250305535185168e-02   +2.455802980637264e-02   +2.071217537406779e-02   +1.234381663565545e-02   +2.531909344324603e-02   +2.523258248410796e-03   +5.279168308166126e-03   +5.386666660215175e-03   +3.478814009099069e-03   +7.591371189226059e-03   +2.892692267361000e-02; +2.538606509895852e-02   +1.654519443845322e-02   +1.287448412111329e-02   +1.099195328231575e-02   +2.094278372430916e-02   +1.738677086308999e-02   +1.083685360445652e-02   +2.700849973692507e-02   +1.295099657075914e-02   +3.168284297598618e-02   +1.500102958123461e-02   +8.476345870411600e-03   +1.528431229981974e-02   +4.726516812554538e-03   +6.207850961462247e-03   +2.640371805199911e-02; +1.971645260575533e-02   +1.875078389930309e-02   +1.199421578756738e-03   +2.110739837601637e-02   +1.374234116614071e-02   +2.513264787207579e-02   +1.966492549307871e-02   +2.018618118342138e-02   +1.284477412266661e-02   +1.684481951906289e-02   +1.645779604333985e-02   +1.256367371456842e-02   +1.416429936856887e-02   +3.108657443669461e-03   +2.095291209841708e-02   +5.634206101400631e-03; +1.298649168208630e-02   -2.177267216629213e-03   +1.897914388566442e-02   +2.898347996532604e-02   +3.027111032631037e-03   +2.568983553908604e-03   +1.357924581121035e-02   +1.041234608201157e-02   +5.717743499365801e-03   +1.824825489033107e-02   +1.268668298938543e-02   +1.027182522412898e-02   +8.652434089385036e-03   +2.040527200321071e-03   +2.151786311407945e-02   +1.569676270991849e-02; +3.114034089137953e-03   +2.660254246270206e-02   +2.422317114914853e-02   +2.214731472469069e-02   +2.165057019891798e-02   +1.731060056085826e-02   +1.778171160446406e-02   +2.880267799554109e-02   +1.052370988636120e-02   +4.905989936143589e-03   +1.087953279108721e-02   -5.252937129969384e-04   +4.970835565279983e-03   +2.851776762289465e-02   +9.622865931322375e-03   +1.871421067493579e-02; +1.797875983237144e-02   +1.765608067427850e-02   +1.647365421071059e-03   +2.707680829289461e-02   +1.140254352656942e-02   +2.438444948139998e-02   +2.204922204021540e-02   +2.697740414049592e-02   +2.089387612579687e-02   +1.515713535643985e-02   +2.223962294310388e-02   +1.607321687387924e-02   +5.084077152282303e-03   +2.742351127477221e-02   +2.161471946439197e-02   +2.506117971991153e-02; +2.534878546813037e-02   +8.334924412962639e-03   +2.176742028105265e-02   +2.675177451706556e-02   +1.407081869592345e-02   +3.266892720652887e-02   +1.645236773134403e-02   +1.408801651739847e-02   -5.343362224713743e-03   +2.078362352263285e-02   +1.473787105806005e-02   +8.134897014062784e-03   +2.353587707280362e-02   +8.786792095236771e-03   +2.627412801806788e-02   +1.353244838251166e-02; +2.333595532032223e-02   +1.195672712321191e-04   +2.213321830770082e-02   +2.278256537787002e-02   -2.168559948073523e-04   +2.225131433836669e-02   +2.048948991103071e-02   +2.325808059385643e-02   +1.232020857549828e-02   +2.195026958743710e-02   +6.851710521383887e-03   +1.431154067594947e-02   +1.275490395161516e-02   -2.257040848824167e-03   +2.444680307061178e-02   +1.971728902137598e-03];
L2E_L1E_iAMPA_netcon = [+2.028259711433861e-02   +6.988215863088834e-03   +1.901006689494240e-03   +3.108344695048169e-02   -1.327706327983704e-03   +9.571393815916658e-03   +1.867889535551491e-02   +6.285970434547259e-03; +2.170701844894745e-02   +2.607102525184941e-02   +1.659262854896915e-02   +6.399892659979978e-03   +1.774430335330196e-02   +1.076866407562089e-02   +3.033847298566870e-02   +1.281047295618691e-02; -4.457466886948393e-03   +3.758152025973275e-03   +2.898283856430740e-03   +1.045878316587675e-02   +1.671361945000061e-02   +3.117226062285645e-02   +1.006226064641284e-02   +9.036538339396279e-03; +9.594646011434319e-03   +2.259741858578056e-02   +6.843409760584843e-03   +2.052763581461888e-02   +2.599924781851879e-02   +8.800069939469763e-03   +2.278031680410436e-02   +3.078850973733601e-02; +4.582399744350534e-03   +2.948349591883853e-02   +4.125788108265873e-03   -6.035749923878696e-03   +2.518343430443138e-02   +2.853363292844771e-02   +2.132552322853410e-02   +1.253680644770983e-02; +1.706060436202099e-02   +1.103543320260382e-02   +2.620187864020643e-02   +2.212264494570371e-02   +1.779829585764512e-02   +6.290992323697122e-03   +1.477660248851809e-02   +1.818104942308307e-02; +5.173988959216719e-03   +1.059378565805492e-02   +6.106610068904407e-03   +1.237688827957654e-02   +2.503314642180690e-02   +1.285036005986418e-02   +2.515359713892645e-03   +1.084648080578364e-02; +2.703458957364123e-03   -3.527745707593529e-04   +1.329559930306487e-02   +1.901443399041291e-02   +9.605068198164653e-03   +3.192794511213885e-02   +2.276971794933194e-02   +2.129438623441144e-02; +6.079038291725223e-03   +2.386239350863743e-02   +4.387843438889491e-03   +5.545409256072891e-03   +3.378396725995633e-03   +3.145002834454860e-02   +1.207674426147202e-02   +4.578870282420846e-03; +9.465287383397598e-03   +2.760342251496603e-03   +2.870258651232260e-02   +1.344564946320634e-02   +3.049480821899496e-02   +2.524839344621680e-03   +9.178610214576772e-03   +1.942029278588334e-02; +2.024671568384313e-02   +8.654526094794947e-03   -1.679432535648382e-03   +1.922173082613017e-02   +1.364445746468068e-02   +6.522123266340258e-03   +2.039796503868943e-02   +2.315032117346586e-02; +8.317775445579430e-03   +1.001020880225060e-02   +2.062511296323482e-02   +1.568550184069525e-02   +1.343927995541193e-02   +6.480286428563090e-03   +2.525980760372095e-02   +9.778883276176187e-04; +1.264270924123744e-02   +2.003699089990229e-02   -1.367705610348539e-03   +5.312065721544723e-03   +2.521713155345974e-02   +1.319921728030933e-02   +1.454589900776892e-02   +2.281999399096385e-02; +9.943570852934647e-03   +4.539005881985404e-03   +1.437901107280415e-03   +2.721026224737612e-02   +3.616094500826387e-03   +5.018396286399791e-03   +5.543156149918449e-03   +2.799877531049286e-02; +9.221641011790793e-03   +9.014831585028834e-03   +1.371802235574272e-03   +2.856652085584507e-02   +4.433937437674342e-03   +6.008224794504429e-03   +1.496057022470657e-02   +2.409564098018915e-03; +8.065204868356844e-03   +1.562897591925036e-02   +1.243020778480588e-03   +1.221552780555176e-02   +7.157975910174791e-04   +1.847632229753552e-02   +3.754818380566762e-03   +2.577498321194263e-02];
L1E_L2E_iAMPA_netcon = [-4.074633315143578e-04   +5.376967782858875e-03   +2.359158562311609e-02   +2.300607553757295e-02   +1.307648596046471e-02   +2.529150821555599e-02   +1.640698354740613e-02   +2.872713114613704e-02   +5.924357821623825e-03   +1.305582864857874e-02   +1.604917840632468e-02   +1.513789875711019e-02   +9.711170196451518e-03   +1.920756971653534e-02   +2.142178820100487e-02   +1.866472563082744e-02; +7.011929789839515e-03   +2.214068308185860e-02   -3.120917699652615e-03   +7.669924116947705e-03   +3.529110182234722e-03   +1.923241876702355e-02   -4.650724300600794e-04   +4.665229100226014e-03   +1.966418502412184e-03   +8.650433111639676e-03   +1.146960839904073e-02   +2.522647349827943e-02   +1.235351735828906e-03   +5.847716116199417e-03   +1.563193016129621e-02   +1.092656317233475e-02; +8.522358358788958e-03   +1.684507155820345e-02   +2.372154006418099e-02   +2.407071505895020e-02   +3.064901841802151e-02   +8.461111905918774e-03   +1.443232430029425e-02   -2.337968831298126e-03   +1.112045708908717e-02   +1.592303148484688e-02   +9.434535906762824e-03   +3.760116684583498e-03   +1.402705680106371e-02   +1.244452938702075e-02   +2.837742891987054e-02   -2.610672260355849e-03; +1.621502036707765e-02   -5.432803543509783e-03   +3.637196271243427e-03   +4.050630935752418e-03   +2.290184680073945e-02   +1.355366646248028e-02   +2.660887568504137e-02   +3.123305167835966e-02   +2.197478403965821e-02   +2.279930083449317e-02   +8.450453430580226e-03   +1.284215919621475e-02   +2.889960875435317e-02   +5.911144297654531e-03   +2.670543172432053e-02   +2.494524472984154e-02; +4.551313187569631e-03   +3.245724390124440e-02   +1.700962442852708e-02   -5.305580634091388e-03   +5.767152392628263e-03   +1.903440090849310e-02   +2.128801713898130e-02   +2.483569135518672e-03   +1.991586626513976e-02   +8.981521164547260e-03   +1.067437323748511e-02   +2.258574202009227e-02   +4.974047407852417e-03   +1.383469693602177e-02   +2.870025762739512e-02   +4.071676901030249e-03; -2.663960568496099e-03   +2.405063686729933e-02   +7.109269482885222e-03   +2.750417820987524e-02   +2.390871728614113e-02   +2.466423390951824e-02   +9.708909494462013e-03   +2.030350691014918e-02   +1.511109685127199e-02   +9.059121980374712e-03   +1.959325723135700e-02   +2.742825020300816e-02   +2.480887949675009e-02   +1.696513332853031e-02   +3.439963622170270e-03   +1.806464723944716e-02; +7.091742258011253e-03   +1.981328358801246e-03   +2.146271568407846e-02   +5.521107724225643e-03   +1.029186260026338e-02   +1.646419594155248e-02   +1.503367744221033e-02   +2.131644094200101e-02   +1.663203026794291e-02   +2.203932962643743e-02   +1.830605882942791e-02   -2.404866545105713e-04   +1.235549161606572e-02   +1.616707841179063e-02   +5.970529842450845e-03   +9.815276094438033e-03; +1.481631788847426e-03   +1.146674265867770e-02   +1.290757193222626e-02   +1.109119859697526e-02   +1.525865015811786e-02   +2.566110879645587e-02   +2.036953254810088e-02   +1.514274326503546e-02   +2.503652110273775e-02   +1.087345226063782e-02   +8.562848711339669e-03   +2.940395366828111e-02   +2.009136086370585e-02   +2.152667237072583e-02   +1.031133938130359e-02   +2.110462447379233e-03];
L2I_L2E_iAMPA_netcon = [+1.401639619618699e-02   +9.556129020232075e-03   +2.259709863190138e-02   +1.847442795261443e-02   +2.611442626750925e-02   +7.180505734700850e-03   -1.300327585302814e-03   +2.245135071057715e-02; +5.187310289151317e-03   +9.141087544229378e-04   +6.586412022543598e-03   +2.190922029310609e-02   +2.321440639255477e-02   +1.248151483905774e-02   +2.228980235795301e-02   +1.714127784312946e-02; +2.183841435537411e-02   +2.451964733077944e-02   +2.164593159870381e-02   +2.128530218466511e-02   +1.893885093185015e-02   +1.183967083305434e-02   +1.393320946803255e-02   +2.139025230033166e-02; +1.114574389884571e-02   +6.796336718595130e-03   +2.903755985911378e-02   +1.184149846140028e-02   +2.989342224581670e-02   +1.567599107208649e-03   +3.787811936550975e-03   +2.541505629852014e-02; +1.498750741441215e-02   +2.207443029038094e-02   +7.377852674270759e-03   +1.601204526033763e-02   +2.364638745707521e-02   +1.689725994256565e-02   +1.238518150929854e-02   +2.094221753720529e-02; +2.106760792480503e-02   +1.257480897060385e-03   +2.539876341626472e-02   +2.146396950880021e-02   +1.359949069659742e-02   +7.795110267660127e-03   +1.765997493082843e-03   +2.334537924003783e-02; +2.884961321449370e-02   +8.520868078842711e-03   -2.843480573482721e-03   +2.129502036371809e-03   +5.915233814271554e-03   +8.567507413290522e-03   +4.771296199108143e-03   +7.896250530127671e-03; +2.213727945386360e-02   +4.849633647316541e-03   +1.170563315155337e-02   +1.606339247108722e-02   +1.926928904769965e-02   +9.743078678534706e-03   +5.963664789192641e-03   +5.126285401025703e-03];
L2E_L2I_iGABA_netcon = [+2.356683865514773e-02   +6.553048986453797e-03   +2.727801020840563e-03   +6.212946307727501e-03   +2.688101598782539e-02   +8.949858888532366e-03   +1.904667131496125e-02   +2.911412256220542e-02; +5.322695395817553e-03   +1.623213739711423e-02   +7.001455195672795e-03   +1.037005686580847e-03   +3.105599100505107e-02   +2.004170525117145e-02   +2.019032342825914e-02   -3.487547567605868e-03; +1.630301853104636e-02   +8.886419227337339e-03   +1.172049454798509e-02   +4.615512970791923e-03   +8.245858587290681e-03   -4.772974907641569e-03   +3.265475786366420e-02   +1.889340362283721e-02; +2.246056776016699e-02   -2.459348212378109e-03   +4.557813010763427e-04   +2.045394913352121e-02   +2.205335820361031e-02   +2.652395107392690e-02   +1.295304642970008e-02   +1.319587132018318e-02; +6.587414748985330e-03   +1.803840207849475e-02   +5.992320368742194e-03   +2.270339409878041e-02   +1.341497890019791e-02   +1.323218884528316e-02   +3.374554412827933e-03   +4.070299725724961e-03; +2.012641953238945e-02   -6.430588722477990e-03   +1.609893691399553e-02   +2.488162946978337e-02   +2.258121125073584e-02   +1.453449079530810e-02   +2.859534027046058e-02   +2.215951264987270e-02; +4.015413012658137e-03   +3.352180131934600e-02   +8.194962530237158e-03   -4.200536358092954e-03   +2.156968566083134e-02   +6.416223627694973e-03   +1.273123879919797e-02   +1.211538892407419e-02; +2.261726899030470e-02   +1.163364927568142e-02   +1.169299566890176e-02   +1.080401996937911e-02   +1.206323849131390e-02   +1.928988152569665e-02   +2.266119327537789e-02   +2.278597932255369e-02];
L3E_L2E_iAMPA_netcon = [+1.052163482438522e-02   +1.941724386902505e-02   +4.561362802941095e-03   -3.773284236873172e-03   -3.931532946647797e-03   +2.605523083323349e-02   +1.110984452364947e-02   +2.545053134167042e-02   +4.525330423705618e-03   +7.207181499556678e-03   +1.040094565746066e-02   +9.721127982686780e-04; +1.056610327964198e-02   +2.601114925023073e-02   +8.278087294467924e-03   +1.341896351198706e-02   +2.101413549096904e-02   +1.397826118873518e-02   +2.598674836539546e-02   +2.629541029492036e-02   +1.765973370206417e-02   +2.428101740802724e-02   +1.461379709631000e-02   +6.432679955031216e-03; +1.321373900059926e-03   +2.408616584201881e-02   -1.501256341254309e-03   +2.248598086490079e-02   -1.192390106621508e-03   -2.007774580510669e-03   +1.289009466649513e-02   +2.774145908108068e-02   +1.644948834920914e-02   +1.015355152836178e-02   +6.204507466070537e-03   +1.372440387822474e-02; +2.519008673415517e-03   +1.021971286734111e-02   +2.344005519097061e-02   +1.285290340009868e-02   +6.086766145096564e-03   +1.837895547723266e-04   +7.340532746598591e-03   +1.235070019433413e-03   +2.277606161490743e-03   +1.313221710323128e-02   +8.256885267097037e-03   +1.051071523839161e-02; +2.594664251636470e-02   +6.787762837907199e-03   +9.584659340169206e-03   +2.637148494553875e-02   +1.890927180528892e-02   +1.095431699646689e-02   +2.349947512589800e-02   +3.310612122513806e-03   +1.946274936949168e-02   +1.801221455548913e-02   +2.403492930443033e-02   +1.319058336437899e-02; +1.934581331195367e-02   +1.492476771018481e-02   +3.543245513798507e-03   +8.257522413745701e-03   +1.148328545032884e-02   +2.930179804857924e-02   +3.190483406774366e-02   +8.558047449829260e-03   +1.676586516087668e-02   +1.548147059159630e-03   +2.031362776418901e-02   +1.217763869769240e-03; +2.003361076944391e-02   +1.049741049608195e-02   +1.348938269021178e-02   +9.502729650517430e-03   -4.388881849248903e-03   +1.607733218445367e-02   +2.431021425855868e-03   +1.359032749315135e-02   +9.517553196886913e-03   +3.266416964722220e-04   +8.075519358267606e-04   +9.325502764979928e-03; +2.396523250423603e-02   +3.360123935443965e-03   -8.773929625336285e-04   +1.238709409566601e-02   +9.047235647385366e-03   +1.298525337983653e-03   +3.006051493690198e-03   +1.131154329392974e-02   +1.039039916850824e-02   +2.789107016341976e-02   -3.813619168138000e-04   +1.891234287063923e-02];
L3I_L2I_iGABA_netcon = [+3.015237448053638e-02   +1.958509886697081e-02   +1.745679480018304e-02   +1.425199919197993e-02   +2.427696549004734e-02   +1.448744864875863e-02   +8.819774041358523e-04   -1.871738310691466e-03   +2.993051213527718e-02   +1.391752920387132e-02   +3.805246555986152e-03   +2.334842551275628e-02; +2.350827644781345e-02   +3.126736900263371e-02   +2.435988143746913e-02   +7.650658295820349e-03   +1.015095305284199e-02   +1.553876385771931e-02   +3.874737995476276e-04   +2.378938531263873e-03   +1.588099444581339e-02   +1.564188068218024e-02   -8.277660209617555e-06   +1.716854322269223e-02; -1.880158608565436e-03   +1.859122556873103e-02   +2.498396460322048e-02   +7.787061960490313e-04   +2.276218612285009e-02   +7.460947489959023e-04   +1.852414229405538e-02   +2.419716931488895e-02   +1.939710942342737e-02   -1.094940578826060e-03   +1.383677040446689e-02   -5.719021766363839e-04; +2.739269342551023e-02   -2.944720863981930e-04   -1.146809240774644e-03   +2.016528690035674e-02   +2.527003215397362e-02   +1.725255180724312e-02   -7.921501326503928e-04   +5.443618292640808e-03   +2.841825450469844e-02   +1.683117086551024e-02   +2.370628505534699e-02   +1.885542339616488e-02; +6.690711656574922e-03   +3.379790151077276e-02   +5.447198665648230e-03   +1.172910186042925e-02   +1.906739324617159e-02   +2.598188620721401e-02   +6.150135271677483e-03   -8.182443371346070e-04   +2.501378216779568e-02   +1.784880883630844e-02   +1.296036105987592e-04   +9.447962837039270e-03; +7.440595193635472e-04   +2.217323323104987e-02   +9.093319057214815e-03   +3.029928971461982e-03   -5.226051216844724e-04   +1.431126800089670e-02   +2.443160576121704e-02   +1.566969826273149e-03   +1.688571111215615e-03   +1.786130588383157e-02   +2.019134405968084e-02   +6.060676324453308e-03; +1.736365738641850e-02   +2.207550559258427e-02   +2.032069455994425e-02   +2.457762164713783e-02   +1.301308982120370e-02   +7.952745280914657e-03   +1.369628966928592e-02   +5.511842386763286e-03   +2.018732766220121e-02   +7.482657818599268e-03   +1.266626944804604e-02   +1.797753104524882e-02; +1.160986812491914e-02   -7.742608984179684e-04   +1.156474310036320e-02   +1.455641632761537e-02   +1.375865343305607e-02   +3.330666382922821e-03   +2.213777220658913e-03   +1.584067701305709e-03   +1.435123565894208e-02   +2.056103381014285e-02   +6.242451592027963e-03   +1.064686118171444e-02];
L2E_L3E_iAMPA_netcon = [+2.055058448406736e-02   +1.340505766449121e-02   +1.223832492755247e-02   +2.232662356389085e-02   -2.928140956970264e-03   +1.856329263145777e-02   +2.083246928661472e-02   +3.011822190108305e-02; +1.868812862217704e-02   +1.946956711195794e-02   +2.274034853942091e-02   +1.570577175996339e-02   -3.213054609391482e-04   +1.583332310769912e-02   +2.889968875785807e-02   +1.578704870123497e-02; +2.250788849532022e-02   +2.368150707695689e-02   +3.094498138751553e-02   +2.671451569764315e-02   +2.240061958304064e-02   +2.149992131284509e-02   +1.825344854444288e-02   +2.161481648805535e-02; +1.347051742341316e-02   +2.470282469560293e-02   +2.087270924238305e-02   +1.230491025248993e-02   +1.324458970340329e-02   +1.603051235165419e-02   +7.404390527839412e-03   +5.475341111099681e-03; +8.755503632637909e-05   +1.534754925493310e-02   +5.082575164577036e-03   +1.500978443086613e-03   +5.232038885948726e-03   +1.380339164310829e-02   +2.232374836355945e-02   +2.123222182702546e-02; +1.766468670026588e-02   +2.524290922530860e-02   +2.464762136352626e-02   +1.325415564608164e-02   +1.679933475682753e-02   +3.084361286910201e-02   +1.478839538130490e-02   +2.310139730924056e-02; +1.183896235422657e-02   -1.268689009203047e-03   +1.418769673101526e-02   -2.581619946725273e-05   +9.335814544137327e-03   +2.650501270777707e-02   +3.112562043283675e-03   +1.740557752617401e-02; +2.752784528004675e-02   +1.987513840194637e-02   +1.738832664421381e-02   +2.622239994498941e-02   +9.266497630841898e-03   +2.283490841549030e-02   +1.649566376154312e-02   +1.513495741416752e-02; +1.072315962091814e-02   +1.681824349860559e-02   +2.807479299308355e-02   +1.677384702284296e-02   +1.317249503609625e-02   +8.331161115605439e-03   +2.152009224068511e-02   +1.943997487270787e-02; +4.700293286349509e-03   +6.413558398138563e-03   +1.992655039529598e-02   +2.619636276910418e-02   +2.847245771122496e-02   +4.917322525081587e-04   -1.089747628386191e-06   +2.177891864359249e-02; +1.756431230528062e-02   +8.567587131818138e-03   +1.936960127173685e-02   +2.104960492994740e-02   +2.960985902518974e-02   +3.211173805278429e-02   +5.533586728324688e-03   +6.402924658708698e-03; -1.705082488781212e-03   +1.886144972126607e-02   +1.011624332520300e-02   +2.227615206246639e-02   +1.559433766820878e-02   +5.399753486484518e-03   +1.945045717654229e-02   +2.531892539496505e-02];
L2I_L3I_iGABA_netcon = [+2.809650280792732e-02   +1.184906032824735e-02   +8.762056861894884e-03   +1.378331922196054e-02   +2.318333336346216e-02   +2.710244145051931e-02   -1.708891649262032e-03   +1.393330389958122e-02; +1.526661296964660e-02   +8.934997812857892e-03   +2.307636295630976e-02   +1.232160431139863e-03   +2.541643714404823e-02   +2.189876472749221e-02   +1.703468021537839e-02   +1.116177867160440e-02; +1.950300259498632e-02   +2.055159870530985e-02   +2.270697899446962e-02   +1.586355188485021e-02   +1.437916179201306e-02   +1.241323136602212e-02   +9.102373621744835e-03   +5.170019793820295e-04; +6.517191546634891e-03   +2.537852566773389e-02   -2.376778054901329e-05   +1.122715728069237e-02   -2.013354231477992e-03   +1.063083278717034e-02   +1.218083031637289e-02   +2.418774432194956e-02; +9.291408360582403e-03   +1.169644245001814e-02   +1.610637984540110e-02   +9.844091318965340e-03   +9.596984686768430e-03   +1.565640618799987e-02   +3.378706403760435e-03   +9.571326401011956e-03; +2.712206906512512e-04   +2.112813562591975e-03   +1.171350717800453e-02   +5.349416834013434e-03   +1.100408535447871e-02   +1.190819453982387e-02   +9.986319549046378e-03   +2.238250969253084e-02; +1.087839775733682e-02   +1.015410880353406e-02   +2.739504071630456e-02   +1.837918290889142e-02   +2.077937970773559e-02   +8.393397015085697e-03   +1.157257560222785e-02   +1.345993716399605e-02; -3.782392227374542e-03   +3.118223977135757e-02   +3.719229722505700e-03   +1.990947283430968e-02   +7.036582240494362e-03   +2.225954700046819e-02   +1.640392840157139e-02   +1.441648321350695e-02; +2.083156695377949e-02   +1.328839826765024e-02   +2.238559366613632e-02   +2.477061879998800e-03   +1.565786708087160e-02   +2.774452565900787e-03   +8.609505039326417e-03   +1.511687524703989e-02; +1.880267805077213e-02   +1.440869900679733e-02   +1.974354993822911e-03   +9.161004918213091e-03   +1.315578021734190e-02   +1.085314846114781e-03   +8.856840576856043e-03   +1.213312767930693e-02; +2.094676062220163e-02   +2.843537396038545e-02   +1.631084787576625e-02   +2.190205713000657e-02   +1.026407424862263e-02   +1.313093709727121e-02   +2.370952372623824e-02   +5.295255916912311e-03; +1.522749764295383e-02   -5.354223562783482e-03   +7.241272828374784e-03   +8.183321545197129e-03   +7.243733175952674e-03   +2.233296298508760e-02   +1.747280359335553e-02   +1.802232038256969e-02];
L3I_L3E_iAMPA_netcon = [+1.488224572829982e-02   +2.463575060809945e-02   +8.106848111848515e-03   +1.635639558328594e-02   +2.010478616140057e-02   +1.477225150565548e-02   +6.773013438628976e-03   -3.136319396310866e-04   +1.472078745679420e-02   +1.376425346281761e-02   +1.025860526582506e-02   +5.796436933087200e-03; +1.049352573895724e-02   +2.050283596109656e-02   +7.291960837952495e-03   +4.639247786610476e-03   -2.625753783637099e-03   +1.627982395164179e-02   +1.799580878700593e-02   +7.632860233842819e-03   +6.264643414003897e-03   +1.565851583317736e-02   +2.097145037988614e-02   +1.390787484219084e-02; -9.577081934202287e-04   +1.529632830599716e-02   +9.973729269393487e-03   +1.942455608358955e-02   +1.459434586396061e-02   +1.299615125974006e-02   +1.187197715194846e-02   +8.838915217836368e-03   +1.523468773504247e-02   +1.676846972438831e-02   +8.066488749807022e-03   +1.520342228134940e-02; +1.110854022577126e-02   +2.180128072422078e-02   +1.850275647945969e-02   +1.135659809437912e-02   +2.095830670411380e-02   +2.370829934915300e-02   +2.299154408457582e-02   +5.862442151573210e-03   +2.549562430364793e-02   +2.776018692308380e-02   +1.238586888710769e-02   +1.846350507215782e-02; +6.444324324313004e-03   +9.424019408830902e-03   +4.634574853812083e-03   +1.927587880519598e-02   +1.900749714395437e-02   +1.472078734050020e-02   +2.565095152285064e-02   -1.545005606570864e-03   +2.095927740639746e-02   +1.053637081073104e-02   +1.011715162468371e-02   +2.329683490853973e-03; +7.744952988706868e-03   +1.440908030298320e-02   +2.483486783926163e-02   +1.638439292750989e-02   +2.385050993407454e-02   +5.471372763339965e-03   +1.942323656721661e-02   +8.701925711755602e-03   +1.761050526455212e-02   +4.595319434412342e-03   +3.835495298306002e-03   +4.841593852851689e-03; +2.825394956456734e-02   +1.424028592782519e-02   +1.115370946467207e-02   +1.165066611542242e-02   +1.234793494327148e-02   +9.776551440195092e-03   +1.548906301489100e-02   +2.883836116026408e-02   +2.604994796831454e-02   +3.001839225221775e-02   +8.060739637772289e-03   +2.172227307680866e-02; +2.133225094509174e-02   +4.285789254193466e-03   +1.760674238202599e-02   +1.916610922871825e-02   +2.809238004977150e-02   +1.635399475283622e-02   -1.389542413036480e-03   +1.724807447906250e-02   +1.547341120916666e-02   +3.425887834183359e-03   +8.631787127204244e-03   +3.143917868762405e-02; +2.408172953729498e-03   +2.200385483966107e-02   +1.698597166025985e-02   +1.932655352123473e-02   +1.091082407785808e-02   +2.070265402391668e-02   +8.344851919088616e-03   +2.472704005903721e-02   +2.163433809991129e-02   +1.067084838141933e-02   +8.350200057960203e-03   +4.713420191605715e-03; +2.366255199119759e-02   +2.480305171323988e-02   +1.852934205590602e-02   +7.333955517622053e-03   +1.510947903185987e-02   +2.216968508109583e-02   +1.523448294628172e-02   +2.802877260401417e-02   +2.489760092593620e-02   +7.965026023681820e-03   +2.239573981880977e-02   +7.287676709214018e-03; +1.392995194305741e-02   +1.338549207187439e-02   +2.739472069771204e-02   +2.659653650873347e-02   -1.845338254015655e-03   +1.995457250504548e-02   +1.629755838214001e-03   +6.267925199833186e-03   -8.029782883768096e-04   +2.718649490766833e-02   +1.542841774876278e-02   +9.700273184823237e-03; -3.122218148722357e-03   +7.019485263021070e-03   +5.205384668120894e-03   +2.157327544806579e-02   +9.583441989722672e-03   +1.285389517148447e-02   +2.180681941996397e-02   +2.159983467036919e-04   +6.634689662990286e-03   +2.104241471752944e-03   +2.346241102582952e-02   +1.267795685633319e-02];
L3E_L3I_iGABA_netcon = [-4.540560111698055e-03   +1.276993599578794e-02   +7.038439797439975e-03   +3.067664573185153e-02   +1.992497863093978e-02   +1.605031672130829e-02   +1.379076127858664e-02   +2.117289991504086e-02   +1.485757623109814e-02   +1.866363481601737e-02   +1.347131140678851e-02   +1.749844164386130e-03; +1.815569203057662e-02   +2.182630758187602e-02   +8.715982932954700e-03   +4.655417995506696e-03   +9.564163961701821e-03   +2.249113137976461e-02   +1.999906883615188e-02   +3.336214440717911e-02   +2.516172364865140e-02   +1.262737638696397e-02   +5.504149964722492e-03   -3.474794919399944e-03; +1.250001388760561e-02   +2.910588436809719e-02   +1.859079567579123e-02   +2.190235379867718e-02   +2.736979745433854e-04   +2.154002440756167e-02   +1.753266683475286e-02   +2.159060383788147e-02   +8.554386299464940e-03   +1.063523993241742e-02   +8.262495799219180e-03   +1.309280127589055e-03; +9.406869278659724e-03   -1.110817823112128e-03   +4.160558676667611e-04   +2.366027303715660e-02   +1.778498249196375e-02   +6.559392633808914e-03   +2.928182090844966e-03   +1.144193321197660e-02   +2.650738114012056e-02   +6.650665265290301e-03   -7.270358360407540e-04   +1.519546883078808e-02; +9.698548151073034e-03   +1.144467614174234e-02   +3.439159978618377e-02   +4.791245372206249e-03   +8.058783414579353e-03   +1.799767546732934e-02   +3.027365241249956e-02   +2.786257374718530e-02   +8.694523929440617e-03   +2.130738091889770e-02   +2.864590496755505e-02   -3.898815062400673e-04; +1.977698411900908e-02   +9.303801536385523e-03   +1.907951404090056e-02   +7.381043827109872e-03   +3.578180902791098e-03   +3.336337436026067e-02   +1.268137018530298e-03   -5.423590022241347e-03   +2.142244780585509e-02   +1.826076239496492e-02   +8.090317481652003e-03   +2.244086051011156e-03; +1.409054535895462e-02   +1.293104674720310e-02   +1.185395374287773e-02   +1.688871707016551e-02   +1.558853675963020e-02   +8.619156467875332e-03   +4.832789085594068e-03   +3.890191417125476e-03   +1.470547930212291e-02   +4.235059045861885e-03   +3.468264782966226e-03   +1.552272698019641e-02; +6.110451377837293e-03   +9.970621012790185e-04   +8.330983178549977e-03   +2.891377314544435e-02   +7.472880442701915e-03   +1.710936002850431e-02   +1.223871335731900e-02   +2.044654569710211e-02   +2.308370407983320e-02   +2.125212266275751e-02   +5.138772829735653e-03   +1.884492595822292e-02; +8.991919158220365e-03   +1.607620306535700e-03   +2.498147855680564e-02   +3.818197351934122e-03   +3.118585284730094e-02   +2.442384500216017e-02   +9.180013745364044e-03   +2.332341876748715e-02   +6.156635547421866e-03   +3.775222094413642e-03   +9.024988126241218e-03   +1.730704187180705e-02; +2.191445345782361e-02   +1.097315910406660e-02   +2.665931046514869e-02   +4.415208945411730e-03   +2.042011473531240e-03   +3.549463996781314e-02   +1.889117677960414e-02   +1.212647421844543e-02   +3.021889942839914e-02   +2.602462358564697e-02   +1.049432115326939e-02   -1.512175917662310e-03; +1.208963963223251e-02   +3.196974112832724e-03   +8.552977889959120e-03   +2.413961538767036e-03   +1.387622705717712e-02   +1.270213365788997e-02   +3.057877652108610e-02   +2.101524058766886e-02   +1.941937520051815e-02   +7.411881300796690e-03   -3.181355082577252e-03   +2.297491941450758e-02; +1.635259590661976e-02   +1.362734081361657e-02   +2.653874550332740e-02   +2.165628811190162e-02   +5.048082193719729e-03   +7.078876369856117e-03   +2.752725071311180e-02   -1.604943450424193e-03   +2.341508997167393e-02   +1.421228142463622e-02   +1.270706185194900e-02   +1.347841098725857e-02];
L2E_Input1_iAMPA_netcon = [+2.775918957885535e-02   +2.972545463279781e-02   +2.279878631327667e-02   +2.492195283401927e-02   +3.002160407829064e-02   +3.307660093130064e-02   +2.927935079143202e-02   +2.114702160911348e-02];
L2I_Input2_iAMPA_netcon = [+2.402548818908619e-02   +2.478407791840496e-02   +3.375683047236204e-02   +2.060197474784530e-02   +2.175276230389078e-02   +3.235178852029812e-02   +2.867469128291257e-02   +2.392121069393456e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
