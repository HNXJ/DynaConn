function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.653328195077965e-01   -2.057084720994040e-01   -5.171618257756435e-01   -1.053153541247793e-01   -3.508494728361997e-01   -3.533973572957322e-01   -1.189263262045935e-01   +4.296306382608932e-01   -2.945200737848095e-01   +1.814106400609256e-01   +4.504725347505377e-01   -5.680508362358869e-02   -1.009488289648176e-01   +6.244852763309099e-01   -2.584578427438924e-01   +1.185917562677355e-01; -1.333624384640044e-01   +1.415334355826611e-01   -3.663155826778187e-01   -4.589833141270132e-01   +4.381052475843437e-02   -2.594846604923177e-01   +3.764741451748183e-03   +8.309737893207692e-02   -4.037773091060972e-01   -3.005609745917317e-01   +1.096379132572473e-02   -3.261762774858769e-01   +4.144616136028731e-02   -4.277877505385367e-01   -3.663977581406705e-01   +1.016009887531492e-01; -2.058541095572833e-01   +5.224813044121810e-01   +5.184447254183200e-01   -2.908903512353026e-01   -3.459168364815233e-01   +6.640095120735966e-01   +5.116002639472066e-01   +6.408525070842452e-01   +2.245673103073438e-01   -3.422248535795125e-01   +3.935113523682688e-01   -2.254492719205266e-01   +7.713746764839478e-01   +7.295449067321540e-01   -6.041947223122524e-01   -2.507200422416070e-01; -2.291116796392932e-01   -2.200323867959559e-01   +4.290414245902869e-01   -3.767256556664239e-01   -2.298978222769625e-01   +6.841084416654082e-01   -2.293663877644614e-01   +2.397495834431727e-01   -2.212979256778430e-01   -2.612422810398415e-01   -2.513972247047713e-01   -9.481104771136314e-02   -1.135500326715882e-01   -2.647011419908041e-01   -5.250770744389627e-01   -1.284698541723878e-02; +3.634290348140679e-01   +4.297912441540471e-01   -4.804220730596368e-01   -7.202447089999860e-02   -6.573104934780928e-01   +5.176359269870903e-01   +7.672618596509054e-02   +2.713619589011082e-01   +1.430019478900973e-01   -3.810754236818220e-02   -6.654723026190401e-02   -5.725804545944079e-01   +1.345427287965610e-01   +3.892088227977565e-01   +4.485354165528548e-01   -3.925871223482902e-01; -1.021530907622350e-01   +1.951569571763733e-01   +1.215224973401449e-01   -1.137609303353038e-01   -6.724523918525942e-01   -2.191736406036699e-01   -7.782747313912763e-05   -4.863772919203370e-01   -6.629782050611341e-01   +1.781049011978665e-01   -6.508305420581648e-01   +4.347615379385822e-01   +1.164187822907334e-01   -2.652773125788159e-01   +5.761079233497275e-01   +2.750314626888318e-01; -3.313363883670705e-01   -3.369532313697746e-01   +3.153224363688298e-02   +2.522452490326119e-01   +3.662816295884193e-01   -5.056589866501736e-01   +1.139516154957814e-01   +4.284516444666391e-01   -2.983920810133647e-01   -1.873078707268691e-01   -2.805885458601527e-01   -1.812388540782463e-01   +8.471966432288411e-02   +5.872351085621781e-01   -3.736900172160972e-01   +6.474422092648918e-02; -2.917134966042038e-01   -2.780998258970542e-01   +3.010716877715550e-02   +7.191493364951117e-01   -1.843098337549477e-01   +1.123046819399981e-01   -2.057189758276424e-01   -6.520660267327695e-01   -5.928205322374290e-01   -2.009676514410650e-01   +6.677618960761029e-01   -2.320338311361805e-01   +4.057664049837399e-01   -7.112792594933676e-01   +1.514327643444229e-01   -1.428257412969237e-03; +1.203710631479417e-01   +2.884894611153496e-01   -3.963899475696682e-01   -3.519702498195898e-02   +7.850819386522870e-02   +3.550541002930285e-03   +3.056825531406158e-01   -7.687481874336354e-01   +2.940715815587859e-01   +1.983096933754430e-01   +3.640499080044246e-01   +2.708228669321460e-01   -4.266348287359089e-01   -8.006475230814038e-02   +2.607248073513707e-01   +4.086799185025470e-01; -2.070903769712316e-01   +3.784847345538455e-01   +4.028722918427572e-01   +5.730202908034518e-01   -1.939433336845896e-01   -3.013349722075860e-01   -3.225477538234284e-01   +4.858581024358186e-01   -4.626986485925474e-02   -8.767967566435741e-01   +4.186345852071191e-01   -2.069771065235662e-01   -3.216206889155808e-01   +1.505141258722205e-01   +9.997046945150477e-02   +2.375481028796743e-01; -2.034057200047537e-01   -3.660655849353412e-01   -6.737101857208546e-01   +6.506056125587001e-03   +6.522667723656897e-02   +5.521869232526853e-01   +6.058026613172918e-01   +4.707841751567224e-01   -9.243208763444338e-02   +1.182460602045822e-01   -2.185492357211744e-03   +1.056371485226171e-01   -5.224767972806499e-01   +1.092988972473241e-01   -8.419283973698294e-02   -5.622003754149804e-01; -2.626097067051205e-01   +4.701381476711583e-01   +6.247918718252451e-01   +5.365907538064708e-01   +8.159850454370510e-01   -2.184182139539650e-01   +3.260567362011283e-01   -3.459566834182162e-01   -5.333066992931313e-02   +3.160861603923756e-01   +1.727931054089935e-01   -1.067150248728305e-02   +3.813302692784486e-01   -7.983985143790310e-01   +1.214042592513778e-01   +1.461705777614982e-01; -1.818381310275272e-01   -5.520854471613803e-01   +1.374001936780492e-02   -6.487644267288211e-01   +1.127298377016792e-01   -2.366020257357398e-01   -3.161562132270182e-01   +3.978836447300889e-01   +5.753093337991584e-01   +5.959108502161479e-01   +2.323011901306222e-01   +8.121360611911380e-02   +5.038683768844658e-01   +2.603239142186405e-01   -2.485829054361899e-01   -2.702061535482125e-01; -1.668638355103921e-01   +1.065210094192454e-01   +4.383407978361680e-01   -4.919360243657635e-02   +3.746486766681335e-01   +7.292633241907634e-02   -1.647677702793089e-01   +9.509758862737618e-02   -9.433192651629105e-02   +3.096908519922129e-02   -1.001856794232099e-03   -3.625741783795299e-01   +8.405765086142036e-02   +4.085104430257645e-02   -2.099497658250264e-02   +8.557802708231112e-02; -2.424392495916652e-03   -7.483147236340143e-02   -2.325060237796363e-01   +3.441961807777062e-01   -1.594118243757953e-01   +2.476612655601157e-01   -5.094450097809116e-01   -2.398812676122564e-01   +6.861128465052134e-01   -1.879601475470472e-01   +6.776281716414029e-01   -4.644044430673562e-01   +1.798416725562433e-01   +5.324313114392922e-02   -2.165514413189393e-01   -2.729041405222687e-02; -9.517137138184861e-03   -9.502058065823955e-02   -1.871556117725356e-01   +5.169075010985449e-01   +9.098919335286401e-02   +2.175685346901355e-01   -1.246180064885701e-01   -8.653615789076385e-01   -2.238539717088597e-01   +7.454528789095212e-01   +7.817800855700896e-02   -1.427699601838107e-01   -5.956340496635008e-03   -1.048897414724695e-02   +4.966126566532779e-01   -4.821839170816017e-01];
L1E_L1I_iGABA_netcon = [+8.769792599710605e-02   -1.285641227886930e-01   +8.508880152344434e-01   +6.369798032266292e-01   -3.373255276558805e-01   -3.104655717589577e-01   -1.874933940623413e-01   +3.877799570820322e-01   +6.856073935733122e-01   +7.941735358894058e-01   -2.996641255681527e-01   -1.746917406914116e-01   +1.539134449967916e-01   -1.625297410570808e-02   +6.525387873784978e-02   -2.806725341426174e-01; +7.395312591009550e-01   +2.959531413312033e-01   +1.131560550529809e-01   +3.475436939108295e-01   -3.225026274513939e-01   -3.166252663063416e-01   -6.188077365299632e-02   +1.657678190658573e-01   +8.219937621423717e-02   +2.400203771188150e-01   -4.943181072707492e-01   +2.625160256439788e-01   +2.341157818181951e-01   +4.040728301296677e-01   -8.547514400139802e-03   -3.867348731918597e-01; +1.525835662543238e-01   -8.842800673939002e-02   -1.531302855838669e-01   -6.213708320597242e-02   +3.308855853582383e-02   +1.170686561220910e-01   -2.434880249340956e-01   +8.020728113532849e-02   +3.076118842485237e-01   +2.855571925237466e-01   +1.053977203070084e-01   -2.476408660860768e-01   +3.247800154152115e-01   +5.736967214530989e-02   -6.407492608419360e-02   -4.886237174910461e-01; +5.102152996425663e-03   -1.371801978230685e-01   +1.427422680235928e-01   -2.804435221741051e-01   +3.583640870234898e-01   -1.798390556076276e-01   +4.882091074806311e-02   +3.063794699464167e-01   -7.085382886895808e-04   -5.918250971667899e-01   +4.533472982376940e-01   +2.501934366559716e-01   +3.270389624506516e-01   +1.064936669133499e-01   -1.453957703937876e-01   -4.627064642403964e-01; +5.186083958502066e-01   -8.307654546265977e-02   +1.007402398540733e-01   +4.678430478921499e-01   +5.331860090952751e-01   +9.346835272848877e-02   -3.860826344138995e-01   +6.198740672203079e-01   +9.392085444471239e-02   -6.707026211379873e-01   -2.143776591950639e-02   +1.762612046368829e-01   -6.701287642848793e-01   +3.946453583732217e-01   +1.893746475373451e-01   +2.223816894834517e-01; -2.929466203256521e-01   +1.238315377370917e-01   -4.695878542970353e-02   +5.075441313066325e-01   +1.293831696270480e-01   +2.072012200706639e-01   +5.002711054052587e-02   -2.325214624674758e-01   -4.287864091091279e-02   +3.292597428014912e-02   +1.976845486097029e-02   +2.211184859737472e-02   +1.349186899827975e-01   +4.183851597475001e-01   +3.928863331618977e-01   +6.622571174047405e-01; -1.920160292723268e-01   +2.884216566398426e-01   +1.402512363433144e-01   +2.315280484890407e-01   +2.738402657630261e-01   -1.382419919175790e-01   -1.402213020337677e-01   -1.060340585991989e-01   -1.214614008407715e-01   +1.988411415322790e-01   -7.605877114611535e-02   -4.792813913210801e-01   -1.605254228787521e-01   +2.404369345498227e-01   -6.029123856271896e-02   +2.483522022710301e-01; -4.072694582621219e-01   -5.514450795002801e-01   -2.977172519728009e-01   -2.240795985050963e-01   -3.955914314802535e-01   -2.655077279553009e-01   +5.107098319581167e-01   -1.594525330136923e-01   -6.133968514730421e-01   -3.197374952132813e-01   +9.873286724160288e-02   +1.502633459958658e-01   +2.847637981732990e-01   +3.804013802355578e-01   -2.687114073056979e-01   +1.088698652227783e-01; -2.668320405324387e-01   +1.353835299821327e-02   -2.459324331122855e-01   -2.058170425855588e-01   +1.032392337361547e-01   -3.725055690170898e-03   -2.506138188200552e-01   +2.205356023984708e-01   +1.365686144719660e-01   +5.135776144009655e-01   +4.546966230582078e-02   -6.478670120191580e-01   +8.896706679715550e-03   +5.490642185499270e-01   +5.024074106070884e-01   +5.289502260958037e-01; -1.759569665649553e-01   +2.036858304184271e-01   +4.865078589436685e-01   +8.431360129984192e-02   +9.981242656960673e-02   +7.006790924293687e-01   -2.260661768939606e-01   -1.763994576234452e-01   -7.235725640459393e-01   +3.791020993853212e-01   +1.540693898271884e-01   -2.219682617959374e-01   +1.666347428462556e-01   +2.101252443323733e-02   +3.735295760233362e-02   -1.079905946382770e-01; -1.075992543467818e-01   +2.408926562322858e-01   -3.092384007259522e-01   -6.156245116613922e-02   -2.797847876185768e-01   -7.638609798390147e-01   +1.727410280198883e-01   +1.933306708076991e-01   -2.240224546797837e-01   -6.108887264482721e-01   +4.404207955152902e-01   -2.179000363084338e-02   +1.294244427509862e-01   -1.922649696527629e-02   -1.742541985204766e-01   -5.936048705739991e-02; +4.857925062632867e-01   +3.321452481738096e-01   +2.559309624464691e-01   +1.402803851379344e-01   +6.487494739086598e-01   +8.808955857170259e-03   +2.815364656275528e-01   -4.329328639598867e-02   +2.439823163180530e-01   +1.760871604463032e-02   +4.480904517117660e-01   +5.034007058788272e-01   -6.252149391850053e-01   -2.297037772610197e-01   +1.792953481721074e-01   -3.391937923502938e-01; -5.175226847141413e-01   +4.564994266739399e-02   +6.504290952004669e-01   -3.288245483886080e-01   -1.541863608183532e-01   -2.737369869275592e-01   -5.673834035903014e-01   -1.132190711838617e-01   -4.614234835128546e-02   -3.938495339413928e-03   -2.646198155069641e-01   +2.630429136619344e-03   -1.333683322674797e-01   -2.869305427807164e-02   -1.003704612198667e-01   +4.828848764359261e-01; -3.169977802976531e-01   +2.007174689641990e-01   -2.273857199709851e-01   -7.135654580094274e-01   +2.080005650700208e-01   -1.839166210895002e-01   -2.566355681075437e-02   +2.412522432431319e-01   +3.418633111924978e-02   -2.896777655726090e-02   -7.709162373336727e-02   -1.646228635151719e-01   -1.388754048384253e-01   +4.935591405830785e-01   +2.275751615778772e-01   -3.008375232263890e-01; +3.717018284732045e-01   +4.207599227413607e-01   +2.564357114506224e-01   +2.656402026471075e-01   +2.210730939545543e-01   -4.175064535164520e-01   -3.543707029165319e-01   -5.089805033061136e-01   +3.863461373816171e-01   -2.568443127888330e-01   -1.126810663489269e-01   +4.612599922614712e-01   -2.292875565633297e-01   +3.051170396940103e-02   -2.648479049729223e-03   +3.784226745030105e-01; -7.885115587123960e-01   +2.527722157852264e-01   +1.932742548402082e-02   -5.697885521136736e-02   -2.338616112846921e-01   -5.058836961487246e-01   -1.936538619617811e-02   -5.412423527046428e-01   -6.811839012854273e-03   +5.137185220647711e-01   +9.882037565241836e-02   +2.628875499943574e-01   +2.717209562442182e-01   +3.498120642695161e-01   +1.864493949183417e-01   -4.975258098070970e-02];
L2I_L1I_iGABA_netcon = [-4.820338997793839e-01   +1.352369616614627e-01   +5.194638650836436e-02   -1.068008494819984e-01   -1.762241553791617e-01   -3.277019505317216e-01   -3.753287291333410e-02   +8.347365946554006e-02; -4.096246228253908e-02   -6.266474363354582e-01   +2.328715864575079e-01   -5.554536278604066e-02   -3.407070399856104e-01   +9.977092571938642e-02   +1.607264842415332e-01   +2.215027029052091e-02; -4.810396730123042e-01   -3.799101489825784e-01   -5.700115200359846e-02   +5.038345325213743e-01   +4.211779945522847e-01   +3.678034056949983e-01   -4.007853294371276e-01   +8.427149803533615e-02; +1.450758197693714e-01   -3.203473764046710e-01   -1.216714876546330e-01   +6.632228031918889e-01   -5.507013750477432e-01   +8.401693082362622e-01   +4.649340245583177e-01   -2.924475018603399e-02; -7.771695423421670e-01   -6.757242680388706e-02   +4.884207404736579e-04   +7.781947828174807e-02   -4.087835477451245e-02   -9.922341239779560e-02   -2.672498760728862e-01   +1.701417751173710e-01; +1.507822638992173e-02   +8.500725143894697e-01   -4.976563822395043e-01   +9.888239779653431e-02   +5.713292293131346e-01   +6.618082963869906e-02   +5.536098160939069e-01   -1.652889493732434e-01; -2.293477139793011e-01   -3.510957730218870e-01   +1.177250219939916e-01   -8.130457157779583e-01   +4.834048426428157e-01   -6.026755116357022e-01   -2.064091389267672e-01   +3.465703885349629e-01; -1.109186837495003e-01   -1.853139644321856e-01   +1.321672033429424e-01   +3.017291897906159e-01   -5.832221418404067e-02   +1.319292997031701e-01   -5.524015586495024e-01   +2.401837169195081e-01; +7.264114069173254e-02   +7.482583843459692e-02   -5.303326077352920e-01   -3.463152552661006e-01   -7.081592764357400e-02   -1.328568997025687e-01   -7.368276301858712e-04   -1.708490518254059e-01; -2.617632595342228e-01   +6.062960754701764e-01   +6.850527123036833e-01   -4.006669238798390e-01   +1.776274696241179e-02   +1.275421239191662e-01   -2.097955172516264e-01   -2.640724691735709e-01; +8.960967449163518e-02   +2.381421919564863e-01   +7.823649725747020e-02   -3.634431760802109e-02   -1.255794461587552e-01   -9.311799825618997e-02   -2.587770579558966e-01   +6.323921665035812e-02; -4.115746056348780e-02   -6.421275823882550e-03   -6.210311106897038e-02   +1.129645586010806e-01   -1.827012003206923e-01   -3.001393092400636e-01   -5.998595576275657e-01   -3.018648402620414e-01; -3.964633852836924e-01   +2.498728845954759e-01   -2.929588588135292e-01   +3.614678773092773e-01   -1.752906388780766e-01   +1.894129509971689e-01   +2.394886732914462e-01   +4.541271521387321e-01; +4.563957293666597e-01   +1.905413591459490e-01   -4.056797068171323e-01   +7.092611545749848e-02   -1.913162558943606e-01   -2.590665888096993e-01   +2.701342602770934e-01   -2.483294825525129e-01; +1.232860865968002e-01   -1.575423795915554e-01   +2.323924841292416e-02   -4.051194424686028e-01   -7.676934680549022e-02   +3.173644662866012e-01   +2.195445050681644e-03   -4.036448085903093e-01; +5.639948244286239e-03   +3.108676613176755e-01   +2.226994655575158e-01   -1.098759154346483e-01   +5.330817132549576e-01   +1.057269250960136e-01   -1.834326260005236e-01   +2.919671509308010e-01];
L1I_L2I_iGABA_netcon = [+4.787069314272251e-01   +3.202378203953121e-02   +1.355813964984292e-01   +5.330245367972886e-01   +1.386666996615940e-02   +4.352893472944061e-01   +2.641405193154414e-01   +7.007412280231911e-01   +1.074216106801236e-01   -3.500275207408541e-01   +5.208395762864649e-01   +5.976884240583853e-02   -6.994800458268517e-02   +6.891267538790847e-01   +7.279504704478420e-01   +4.144658868543621e-01; -2.438723763518393e-02   -5.735528180307691e-02   +7.537422144595382e-02   +3.783748966672032e-01   +2.181856719376941e-01   -5.215030216412569e-01   +4.763300079794278e-01   -3.320118318441618e-01   -3.948513429570514e-01   +6.784519640773307e-02   +2.830704698626967e-02   +4.641914806337459e-01   -5.416745801023561e-01   +2.044084755761686e-01   -7.619115388229919e-02   -1.912038649228734e-02; -4.859437306250579e-01   +2.256114334276011e-01   +2.006744512064292e-02   -5.239522921586776e-01   -8.111004294296146e-01   -2.859329670658474e-01   +2.292727856195801e-01   +6.379677519667259e-02   -2.109431467190088e-01   -2.426874050663965e-01   +8.094722002665535e-01   -2.563787476952594e-01   +7.977831563357916e-01   -8.050192099378731e-02   +8.114038217650363e-02   -4.497791941169723e-01; +1.278095847573706e-01   +2.079491536579440e-01   +5.216955817160936e-02   -2.696127855301924e-01   -9.140818609336968e-02   -4.743328369138532e-02   -2.489210323704902e-01   +4.219949024567278e-01   -9.569160298302198e-02   -3.081184771901534e-01   -2.549968854499783e-01   -3.165814001896394e-01   -5.723667406095215e-01   -4.728353608674193e-01   +2.120472807519613e-01   +3.404045641226882e-01; -3.200003086295609e-02   -4.969890888246271e-01   -2.758372492073374e-01   +5.631118754734442e-01   -2.546977558531479e-02   -1.479988198217908e-01   -6.274723533926809e-01   -3.165203890935057e-01   +2.033619905467625e-01   +2.676178502353306e-01   -2.641548558530331e-01   -1.932762805565033e-01   +5.751512080915346e-02   -2.362572348478668e-01   -5.905561356460368e-02   -3.514869987865498e-01; +6.193200749606997e-01   -1.172933840672022e-01   -2.513673802989726e-01   -4.908659937742533e-01   -1.284172148831803e-01   -4.319389922847157e-01   +7.101724623978234e-03   -3.441637333164929e-01   -3.065297162422936e-01   +5.172873790178151e-02   -3.636139769735496e-01   -1.324310261942812e-01   -6.491090646489248e-02   -4.387671516048198e-01   -4.471119597316370e-02   -1.550219524217069e-01; +2.279416604990808e-01   +4.021614777155773e-01   -3.392604172375057e-01   +4.072041377851912e-01   -1.518307067268442e-01   +5.086640828924315e-02   +5.453191223097873e-02   -5.610854672097415e-01   -4.994371779507577e-01   +5.082357058528247e-01   +2.316455223877164e-01   +2.415410443901151e-01   +9.343888347035229e-02   +1.691981467575440e-01   -3.668147734554066e-02   +6.801558988367105e-01; +1.081512640018986e-01   +1.537819716933261e-01   +8.668292996535725e-01   -2.607807341058306e-01   -3.476491738122586e-01   -3.355716978124020e-01   +1.397542566097200e-01   -4.256292153313546e-01   -1.080380713728801e-02   -9.275618766456137e-01   +3.219874196037240e-01   -2.190488384715953e-01   -3.754129707756566e-01   -1.451535917195729e-01   -3.147029940484713e-01   +4.557994685203579e-02];
L2E_L1E_iAMPA_netcon = [+1.945858386295109e-01   +1.316783922892584e-03   +3.975138776035071e-01   +6.850305613223487e-03   -1.142273558654711e-01   -2.129638208923414e-01   -2.326888276690546e-01   -1.342242216216344e-01; -2.097426785078930e-01   -1.768204492905196e-01   +1.967662369217699e-01   -2.786777310022961e-01   +5.079295583707448e-02   -7.815701368219063e-02   -2.704302490343545e-01   +2.786205903422764e-01; -4.070457188578365e-01   -7.141096439444217e-03   -6.913279474531789e-01   +1.510750875093500e-01   -3.888894530202223e-01   -4.760941812200992e-01   +5.230892396856488e-01   -5.210816220566985e-01; -5.414718270730118e-03   +2.154728687353513e-02   +1.965672587993720e-01   -3.652838082112201e-01   -1.156430058513258e-01   -5.818971893906565e-02   -8.574769776529642e-03   -7.124921418144414e-01; +6.035480197441989e-03   -1.807156598897071e-01   -2.723454122647377e-01   +1.223717188355593e-01   +4.477879920433967e-01   -1.055881374355207e-02   +8.596094455112785e-02   +1.051282215959117e-01; -1.286583153950744e-01   +3.037331415934845e-01   -2.528786863590700e-01   -3.935174439777963e-02   -6.387475402499743e-01   +4.248386377404530e-01   +1.696422111246422e-01   +3.885311200350171e-01; +4.208264203735046e-02   +2.689564981407967e-01   +5.095965277381018e-01   -1.429586348890869e-01   -1.675566141117667e-01   +5.774834754950835e-01   +4.225362540088133e-01   +5.528346039774072e-01; +6.424991789980072e-01   -6.831729680102064e-01   -4.693464759957285e-01   -5.979241230818999e-02   +6.122913036831448e-02   +9.261108580739033e-02   +1.653494221186785e-01   -4.017007483397615e-01; -3.972165354482055e-01   -3.355616030183761e-01   +2.907232636699026e-01   -1.350713020285158e-01   +7.072883639352305e-01   +2.927013399718487e-03   -8.249209950108718e-02   +5.728036705711735e-01; +4.879432321554916e-02   +1.014082033500336e-01   -5.649535365595838e-01   +4.042019659847919e-01   +5.740781265484328e-01   -5.840878354634066e-01   -4.302642570527790e-01   +6.267774543036120e-01; +1.762535531902949e-02   +8.433161465315502e-01   -1.157739701245699e-01   -3.104470113550656e-01   +3.123068190441222e-01   -5.280397490281645e-01   -3.630433913991279e-02   -5.921149726644003e-01; +4.056867302830331e-01   +1.274623250094063e-01   +2.461520089398161e-01   -4.650529574541403e-01   +1.259291387431988e-01   -2.674125241106841e-01   -2.307044707384069e-01   +2.083515360472583e-01; -3.335116646531882e-01   -4.437121768308103e-02   +4.203684148276486e-01   +4.483373530697825e-01   -2.362989636379820e-01   -5.289158842710752e-02   -6.969551052755726e-02   -3.240245134523914e-02; +2.017300442875536e-01   +7.835042966596445e-01   -2.682417431985116e-01   -3.550960596495482e-01   -1.056650099721343e-01   +1.939999722555836e-01   +3.103410436727690e-01   -2.387583422971566e-01; -6.945791514154435e-01   +2.543680314044634e-01   -1.174144773605357e-01   -3.167683461482263e-01   +1.422898148708532e-01   -1.112734856193769e-01   -2.038439580307108e-01   +2.311599130364926e-01; -3.059407869734088e-02   +6.633048935143877e-01   +3.736382834964164e-01   +5.391099499038512e-01   -3.926878261034897e-01   -2.514151593857372e-02   +3.794253016234948e-02   +3.459562874862766e-01];
L1E_L2E_iAMPA_netcon = [-1.911787948564002e-02   -1.483890855822362e-01   +4.538787164546031e-02   -2.987197288826590e-01   -5.060971535328935e-01   -1.832777873599858e-01   -2.933436072580000e-02   -4.038685216720837e-02   +1.081324983148325e-02   +3.266152767671084e-01   -5.411495111987796e-01   -1.878517964586460e-01   -6.405274437421707e-02   -1.069430603857955e-01   -2.293944100239912e-01   +2.024867993445630e-01; -7.332766826403492e-02   +8.198611475607749e-02   +6.566983667436980e-01   -1.139231594277191e-01   +1.170138133629989e-01   +9.847493791514605e-02   +2.956606658885141e-01   +5.226327528913821e-01   +2.243608257739989e-02   -3.025808003377760e-01   +3.641042570471098e-01   +5.377933421787555e-01   -4.960535022464041e-01   -4.895863284084770e-01   +3.328798080859192e-01   -4.338738739886423e-01; +4.946411146012946e-03   -2.122554032593573e-01   +3.686619767760387e-01   +1.657213883813584e-01   +4.709607450988895e-01   -8.152675918138796e-02   +1.519766204601582e-01   +1.573948898572655e-01   -9.355061188086439e-02   +1.457301382094538e-01   +2.144093201378398e-01   -1.579079679340222e-01   +2.634349666401462e-01   +3.292775830224798e-01   -3.435991878010568e-02   +2.984504330695427e-01; -1.883922307253740e-01   -4.347916528863924e-01   -3.248965866427454e-01   -5.003679105689218e-03   -6.623640480113723e-01   -1.911407739923189e-01   -1.228056822836010e-02   +1.267950929237477e-01   -5.405024273707089e-01   -4.821593284940546e-02   +3.874239444024220e-02   -4.201999960201347e-01   +5.234676754003289e-01   -2.633924688994942e-01   -3.533588938742379e-01   +2.121364983524712e-01; +1.639257775019781e-01   +2.035193688437100e-01   -3.551064689765892e-01   -3.144939518552683e-01   +4.511917207323821e-01   -2.643770654560835e-01   -4.231800785677418e-01   +4.389931957894777e-01   +2.439757569575030e-01   +8.003075134420993e-01   +1.862092937585350e-01   +2.509215600939608e-01   -3.532617199216239e-01   +2.816599296990989e-01   -2.724026849680317e-01   +3.701711921445906e-01; +2.631544430853588e-01   +2.672482649083249e-02   -2.176757067719455e-01   -2.323030450036873e-03   -2.761163729318072e-01   +8.396207683563263e-01   -7.036862715330719e-02   +3.848089858482482e-01   -4.587515958824560e-01   +8.831344645816304e-02   -3.690975602092965e-01   +1.728384976982154e-01   +4.483738508102518e-01   +1.063081892155983e-01   +4.590613844037895e-02   +3.509264371261772e-01; -3.512613046067675e-01   +1.409908063011730e-01   -3.647422768318160e-01   -1.313740196283702e-01   +2.226445127279847e-02   -1.465496452468163e-01   +2.267603331571106e-01   +3.907421263922046e-01   +7.329500494544895e-02   +6.203946348385172e-02   +1.858851511732788e-01   -5.907853502011365e-01   -3.369643420454414e-01   -2.037109177574840e-01   +6.248596622913130e-02   +7.119299336730859e-01; -9.287597313919550e-02   +2.774760333585468e-01   -3.460701387581955e-01   +6.509251779777390e-01   +5.616451603415995e-02   +2.323992805739502e-01   +4.133191106422341e-01   +2.608547234659821e-01   -3.866680154240419e-01   +1.716541492343917e-01   -5.788063623046134e-01   -3.437897008062569e-01   -2.266259059307943e-01   -6.859666638813322e-03   -1.466405124632220e-01   -4.033702882606030e-02];
L2I_L2E_iAMPA_netcon = [-4.161819655471302e-01   -3.739940550144958e-01   +4.513456700380560e-01   +4.004806963561985e-01   -2.165698354570930e-01   -1.675676245601225e-01   -2.760375965137286e-01   +3.415000096629732e-01; +1.315267551262043e-01   +3.453627790785913e-01   -2.911531534480838e-01   -2.211617684540321e-01   -3.689027469296052e-02   -1.054829848999987e-01   -1.151302444399602e-01   +3.397177139823171e-02; -2.573116830542527e-01   +4.308437471107058e-01   -2.940759413491821e-01   +1.483470043321736e-03   +5.222839154170579e-01   -3.621763634248955e-01   +4.757085344625247e-01   +5.775847621604254e-01; +9.675563625600406e-02   +1.392902893648102e-01   -2.208146907476589e-02   -4.365970502603082e-01   +1.253721173664839e-01   +2.943393383566203e-01   -7.910989297694523e-02   +2.164187955279535e-01; -4.519649062182478e-01   +1.808153976767931e-01   -7.241762737161712e-01   -2.181889856258452e-01   -5.650461069482875e-01   +3.114049445292912e-01   -2.330026757799293e-01   -1.261445192166004e-02; +3.836105053807273e-01   -1.897396675268845e-01   -9.345619071328075e-01   +3.646832708677986e-01   +1.757142149985841e-01   -2.778099569887728e-01   -5.918899633551886e-02   -6.827796047183450e-01; +4.427884815729100e-02   +1.853719791659186e-01   -3.383085249467244e-01   +1.148662754146129e-01   +1.726989325731788e-01   +2.440213901639485e-01   -3.231536029993373e-01   -8.299767965655133e-02; +1.797445490540424e-01   -2.096412853379244e-01   +4.935920076949740e-02   +3.553175283353197e-01   -2.823744506541009e-01   +6.068005343040174e-02   -1.283580906544306e-01   +7.558754136760368e-02];
L2E_L2I_iGABA_netcon = [-2.521161427709214e-01   +3.781379725969159e-01   +6.427997680392488e-01   -2.512650113467798e-02   -1.263468038537010e-01   +2.892840817015080e-01   +3.331166268477946e-01   +1.450967910795841e-01; -1.385562270503719e-01   +6.563393443005080e-01   +3.511617918952160e-01   +1.567272656203624e-02   +3.481749930806912e-01   +2.960784110785156e-01   -2.976431879246282e-01   +3.644695532821754e-01; -2.791785134652970e-01   -1.830919554929150e-02   -2.835504856953742e-01   -4.904690265384798e-01   -9.390611122470950e-02   +1.960595920250688e-01   -4.009822189102893e-01   -3.984017236454275e-01; -3.898655663396862e-01   +2.586932724228788e-01   -2.527556523098533e-01   +5.408390639278927e-01   -5.577491614254654e-02   +4.188119467886109e-01   -4.087010101519368e-01   +1.731294853285305e-01; +1.317594677046766e-01   +2.061317264918749e-01   -5.651714698833991e-01   +1.000000000000000e+00   -6.152772321510941e-01   +4.783229415740621e-01   +9.390164516890284e-03   +2.758348809884278e-01; -1.979870202436181e-01   +3.185841530075745e-02   +6.440221109141624e-01   -1.666785879510739e-01   -1.641816028618800e-01   +2.010536308666688e-01   +4.981732527832416e-01   -3.092178913313420e-01; -5.568272002077954e-02   +8.979342690619155e-02   -7.044023731197429e-01   +1.359917568201242e-01   +1.767227256664065e-01   -7.890766430390232e-02   +1.354687529262104e-01   +4.331574466466548e-01; -2.551736150220847e-01   -6.462177605273702e-01   -5.532471125199599e-02   -5.520583138695994e-01   +1.446783750428918e-01   -2.711849443629265e-02   +3.002171806853799e-01   -3.330936330297560e-01];
L3E_L2E_iAMPA_netcon = [+1.770573238589035e-01   +1.277746682286046e-01   +2.350143011400595e-01   -6.091017301789861e-01   -1.471475753284423e-01   -1.631210820930227e-01   +1.433781127169904e-01   -4.410115165369269e-02   -9.115312699479794e-02   +5.883802981821825e-01   -5.432787955599395e-02   -8.408017312659193e-01; +3.256051669980429e-01   +2.701866987344047e-01   -1.904054048120597e-01   +1.135898823699752e-01   +4.867417299174319e-01   +4.119698518052914e-01   +3.203449414902737e-01   -7.221573310686051e-02   -1.465919032953833e-02   +1.624923184754636e-01   -1.064853590837334e-01   +5.884983594658659e-01; -2.662976288597638e-01   +8.781250941760643e-02   -7.361066248087442e-01   -4.688787585806385e-02   +4.906955498678225e-02   +1.312488487053049e-01   +3.391092204215578e-01   -4.635325204750836e-01   +5.394064258608116e-01   +4.033054042088052e-01   -2.146507823265585e-01   -6.766981787831213e-01; +9.643946512305450e-02   -5.652702445219283e-01   +7.686337471507573e-02   -5.000326781266710e-01   +1.026052598477165e-01   -5.706722812225375e-01   +7.430315508348982e-01   -3.773102112117921e-01   +3.209576821288913e-01   -4.150972423154325e-01   +4.619422362629161e-03   +4.732793480525026e-01; +7.121520056735984e-01   +4.181009621539563e-01   +7.392065907099362e-01   -2.758581574151555e-01   +9.049774329914370e-01   -1.864118109981900e-01   -4.394524904001911e-01   +4.147850145594406e-02   -1.795949391689116e-01   +3.359704302639302e-01   +2.326336465714842e-01   -4.625569418509065e-01; +4.400514280743666e-01   -5.177933751073086e-02   +3.897181306024505e-02   +5.446288988364052e-01   +2.571636801153648e-01   +6.118090171780079e-02   +3.323730219383493e-01   +5.304507297447449e-01   +4.207902284596718e-01   -8.644369449085122e-02   +2.662875192863378e-01   -5.080361081971347e-01; -7.613266045196770e-01   +4.686929713903293e-01   -1.295604200781960e-01   -7.110002455729195e-01   -4.613885494098421e-02   +4.057175765192269e-01   -2.695960971104535e-01   +3.082964653638658e-01   -8.916815310845134e-01   +3.487109352911387e-02   -6.750931105401068e-01   +1.074281364750788e-01; -1.118614827536395e-01   +5.281793989057776e-01   -6.813397640720814e-02   -3.881006305943777e-03   +5.289690709511061e-02   +8.060526427922234e-03   -3.154966676816727e-01   +2.286662777698958e-02   -2.996549202841255e-01   +8.559965390104129e-01   -2.846054926806751e-01   -3.659840328974711e-01];
L3I_L2I_iGABA_netcon = [-4.836692573264025e-01   -2.997995377894744e-02   +2.852685769862112e-01   +1.649666080915340e-01   +3.124611364159271e-01   -7.916036874204908e-02   +2.851901427153501e-01   +4.166400613408751e-01   -2.138109110885181e-01   -4.903344915935899e-01   -4.947324052304500e-02   -8.927667947801810e-03; -2.175840232049840e-01   +8.113727200181559e-01   +5.847367418294416e-01   +2.860596231637352e-01   -6.576421270543681e-01   -2.953501952364407e-02   +2.177596153143971e-01   +2.938224869599338e-01   -5.390424855387813e-01   -2.111961628381483e-01   -3.259326811384564e-01   +2.755006061287824e-01; -4.086195183067420e-01   -7.043872837666526e-02   +2.219205066069689e-01   -2.166427298806593e-01   -7.488921517511452e-01   -2.512565699097363e-01   -5.221426299305816e-01   +3.488678158796261e-01   -6.180889336057754e-01   +3.604346925604506e-01   -2.811140074619127e-02   -7.054165556419845e-02; +3.214526454776096e-01   -5.453595673568470e-03   -9.348188871371478e-01   +8.145261653242587e-01   +3.007626350683235e-01   -8.076110890252923e-01   -1.868869198751261e-01   +2.238077380653697e-01   +4.416609639346466e-01   -6.074590540546017e-01   +5.147920859846882e-01   -5.549202823938755e-01; -1.401094091995360e-01   +5.112790012521764e-01   +2.751812400174015e-01   +3.912063975562061e-01   +6.041359632877952e-02   +4.092707795653070e-01   +9.598753057755507e-02   +2.328291722373207e-02   +2.022649605988730e-01   +4.803754821153058e-01   -2.169608067848030e-01   -1.151445281517460e-02; -6.714378751865110e-02   -5.342582092886496e-01   -4.355025635373642e-01   +1.012977869322669e-01   -3.087739922200292e-01   +1.115024026846811e-01   +1.015054967063633e-01   +5.338410513198991e-01   +2.558948423222672e-01   +4.776058541436709e-01   +6.904441514977232e-02   -5.966269600323394e-01; +3.922061089653569e-01   +4.106523754535593e-01   +4.891090718600155e-01   -1.483787712828790e-01   -1.704287778900802e-01   -2.290207348841709e-01   -2.541784760885992e-01   +5.539072044323851e-02   -1.911677573463778e-01   +4.315486007145951e-01   +1.991929385207450e-01   -1.310517147235713e-01; +4.746293092817325e-01   +2.715013315151604e-01   +1.641528714649236e-01   +2.528337002954012e-01   +8.526135028007177e-03   +2.703634083613823e-01   +3.551244899123422e-01   -9.502287594631055e-01   +1.381569041153459e-01   +2.528752088725201e-01   -4.885783413905964e-01   +1.468151966000530e-01];
L2E_L3E_iAMPA_netcon = [-1.245191503408208e-01   -4.861858987615557e-02   +7.098204158874941e-02   -2.016430459800927e-01   -8.918819631159747e-02   -3.935388390702688e-01   -1.798295582849681e-01   -2.063283621728152e-01; +5.025239259873794e-01   +3.101539978474803e-01   +1.288794022276568e-01   -7.598305983880588e-01   -1.528749688315360e-01   -4.708111013569027e-01   -2.720712105940231e-01   +6.820997933914040e-02; +2.460962837385396e-01   -3.018833776003931e-01   +6.035924021705235e-01   -2.528297605184423e-01   -4.692475772773066e-01   -5.012222733035274e-01   +5.907993444837749e-01   +5.083211805365335e-01; +2.835124570693618e-01   +1.745851836490496e-01   -2.771866862927597e-01   +1.446036547192243e-01   -6.137823722949443e-01   +1.352274447831348e-01   +5.795421539095498e-01   +5.791463686518361e-01; -1.075192387937618e-01   -7.560591888005931e-02   +5.653849666497814e-01   +2.975949753630939e-01   +2.602506356742610e-01   +2.805010953207125e-02   +2.620598359865899e-01   -1.576329929561045e-01; -4.481616074959668e-02   +2.658161511357092e-01   -1.217918278084699e-01   +3.416101861111688e-01   -6.887036924515043e-01   -1.983916727371356e-01   +4.949944551927559e-01   +7.118241209825290e-01; -4.038125608672654e-01   +3.298950409524842e-01   -5.693273615218819e-01   -7.133554587199327e-01   +5.579340517801920e-01   +1.726417159021691e-01   -2.140644984145806e-01   -4.591181558548638e-01; +3.416713975462773e-01   -8.414728678685859e-02   -2.182821446208966e-01   -4.260765997597428e-01   -3.252932895945381e-01   +3.781088779213492e-01   -5.356294060372265e-01   +1.919460872405389e-03; +2.915832329693153e-02   +3.626709606818876e-02   -2.979668868476376e-01   +6.716453627876992e-02   -1.377968112238928e-02   +4.185913621216569e-01   +1.906707778592594e-01   -5.465189325703629e-02; +2.986213176354567e-02   -1.533920697536515e-01   +3.077396257720512e-02   +4.434586039952373e-01   +3.477865264013777e-01   -1.640640532477706e-01   -4.293511332290804e-01   +8.781157388076261e-02; -4.007447020969966e-01   +9.625906412749533e-02   -2.156675079809866e-01   +1.925838011845083e-01   +7.351091082580197e-01   -1.372344688959236e-01   +4.189104000419335e-02   +2.178928442604213e-01; -6.760082477376197e-01   +3.122975178749791e-01   -5.975686475419828e-01   -3.387825595678193e-02   +4.151400958294597e-01   -4.513870503128872e-01   -4.094677461732010e-01   +4.658340750105470e-01];
L2I_L3I_iGABA_netcon = [-8.346766623038112e-01   -5.880802166357340e-01   +4.690237168723299e-01   +6.427636700821361e-01   -3.741465872042070e-01   -2.178121961154258e-02   +3.939022567398668e-01   +8.485607558080360e-01; +5.256303935350998e-02   +7.202647533349009e-02   +3.288796731896757e-01   -2.334594054913044e-01   +1.058763852106506e-01   +4.580797279099418e-01   +8.693247906884341e-02   +7.161050429243837e-03; -1.393288048875353e-01   -1.878054743650575e-01   -6.010350083790610e-01   -2.648828493569915e-01   -2.098864395819701e-01   +1.381539099176734e-01   -1.072669565143008e-01   +9.190990792778998e-02; +1.188308566935760e-01   +2.283754461877717e-02   -1.056379651533111e-01   +2.418898517078210e-01   -3.538964293584697e-01   -4.052224349699260e-01   +7.536411701558118e-02   +3.827342649503282e-02; -1.148154676303849e-01   +1.007604859912502e-01   -2.145364487322067e-01   -2.272476225871236e-01   -2.244807272333642e-01   -3.176158025437843e-01   +4.935831830584310e-01   +6.394498440803241e-02; +1.514177559607390e-01   +2.221546103293393e-01   -1.050036984593244e-01   -3.064842507095659e-01   -1.138187640027474e-03   +7.889874474679714e-02   +6.095696084500050e-02   -1.423291970448365e-01; +5.125637045705178e-03   +1.030201270972922e-01   -2.782846261848385e-01   -3.007684265556736e-01   -1.411334866562949e-01   +8.039538307115146e-01   +6.015558446686228e-01   +4.828776779346729e-01; +3.483599921485859e-01   -1.973323878328970e-01   +1.234361617747830e-01   -7.109002217065617e-02   -3.545970920264296e-01   +2.391593514508396e-01   -4.172833211695790e-01   +4.873728999029150e-01; +5.749323836111753e-01   +1.047110372150153e-01   -1.937603712542459e-01   +4.446069380803194e-02   -1.977557801616510e-01   -2.429676026151312e-01   -1.983238076527359e-01   +4.615761711854312e-01; +1.399146201837176e-01   +7.967395804402656e-02   +7.919550135083331e-01   -3.641720385591393e-01   -5.230472795408979e-01   +2.960225414247674e-01   +4.034674424372289e-01   -1.310550704344073e-01; -3.663822799160336e-01   -2.680491584920384e-01   +5.014201487988600e-02   +4.487870708959275e-01   +2.050732249877293e-01   +1.119094300770209e-01   -4.457008083174741e-01   +5.085358915404681e-01; +1.012129405680777e-01   +1.710909861739934e-01   -4.467388360079538e-02   +5.170656777084656e-01   -2.880566813916744e-01   -1.481827622575091e-01   -4.702855138212704e-01   -2.025586484446390e-02];
L3I_L3E_iAMPA_netcon = [+3.913801273402946e-01   -2.835618982015209e-01   -3.130828499313884e-01   -2.445806228078454e-01   +2.805975659969841e-01   +1.722251520277661e-01   +1.624777620069282e-01   +2.552180619387423e-01   +5.092262732619165e-01   -7.121280960107694e-01   -1.082053258041604e-01   +1.307183675242656e-01; +2.430248830726801e-01   +1.206669348975260e-01   -3.352142675747566e-01   +6.100118655834896e-01   -2.594514344658944e-01   -1.185047773065203e-01   -5.704733231873493e-02   -8.631693888209144e-02   +3.489344112038515e-01   +2.642575148345405e-01   +8.316099902643624e-02   -3.135599694060791e-01; +3.606925505505025e-01   -5.588264190797383e-01   -1.878091324760343e-01   -4.510368297912490e-01   -2.230207424120713e-01   -4.382144595548983e-02   -2.975969568786008e-02   -5.475589305068106e-01   +2.641910694354496e-01   +3.141835118758570e-01   -9.928940328253755e-03   -1.479440448974656e-01; -3.210652501728355e-01   +2.728326312735135e-01   +6.181747303888121e-01   +5.287493051903390e-02   +2.486435293312374e-01   -1.269490010388346e-01   +4.271433608386411e-01   +1.433399536488191e-01   -7.905530226509632e-01   -4.266612299597743e-01   -1.270483903687382e-01   +1.753993515196614e-01; +8.636513927725126e-02   +1.819983435308591e-01   -1.083567241441408e-01   +2.681924023138990e-01   -2.372877218362285e-01   -4.571973281695139e-01   +2.742502411695576e-01   +1.398595211927689e-01   +1.231968319558355e-01   +5.368760079489316e-01   -2.628089485075144e-01   -2.911625338098426e-01; -1.375453865800870e-01   +3.657605690123544e-02   +7.158447196412296e-02   +2.001091935708114e-01   +1.659092678546022e-01   -4.335046451012892e-01   +1.866144284690477e-01   +1.883941731550924e-01   -3.502824248293425e-01   +8.024865553249727e-02   +1.264671026388561e-02   -4.496455129669186e-01; -9.780002949935310e-02   +9.485196487832430e-02   +6.557271203225831e-02   -3.824942421681133e-01   -5.355528820642143e-01   -3.707308716105402e-01   -1.188263873680139e-01   -1.945976710172687e-01   +1.514205186397543e-01   +6.075271627510795e-01   +3.255530501686248e-01   -2.378014857905714e-01; -2.723112685578464e-01   +3.326576897522532e-01   +3.983995991012200e-01   +6.574372313319386e-02   +1.757302686888598e-02   +4.630337147146383e-01   -5.146169797732800e-01   +2.266035345576394e-01   +1.742213752664240e-01   +4.845460032024465e-01   -5.991732801996936e-01   -3.901647708868537e-01; +5.713875310267977e-01   +1.465123544291422e-01   +2.157496541123502e-02   -1.509795087044890e-01   -7.946262391706337e-02   +3.093074909098025e-01   -1.276599198070054e-01   -7.386647230199987e-01   -2.339993157478782e-01   -5.574049089354394e-01   +1.514839110445854e-01   +1.448376720546845e-01; -2.236494917857663e-01   +1.842771942008408e-01   +1.447061032615826e-01   -8.841832713784152e-02   +2.944506237600897e-03   +2.277297345534379e-02   +5.594385911154884e-02   -8.117168381773041e-02   +2.130591702545676e-01   -8.022049275329090e-01   -2.559131208241843e-01   +1.749182991050178e-01; -1.648673304860889e-01   +1.888195850896945e-03   -6.052648218322000e-01   -1.168715084891146e-01   +2.289590605571286e-01   +1.876853000704220e-01   -7.368803222031459e-02   -5.145851676502005e-01   +4.376265389840425e-01   -7.167355751535461e-01   -5.375814998961430e-01   -5.036042117062445e-01; +4.727055964938470e-01   -4.741170228555659e-01   +6.633749503016756e-01   +2.677258756519724e-01   +4.443835490948641e-01   -4.723651135933070e-02   +2.758024080754497e-01   -2.362477830888504e-01   -5.771529959207642e-01   +3.862376265055238e-01   -2.438941718810580e-01   -1.679434881788428e-01];
L3E_L3I_iGABA_netcon = [+1.663402793188327e-01   -2.238151153029199e-01   +2.231452425617930e-01   +4.537288928337094e-01   -2.358897159840311e-02   +2.760195259226729e-01   -4.077357003661383e-01   -4.545583010974931e-01   +3.327512359972875e-01   -2.804470008073831e-02   -7.876425270804741e-02   -2.813718009751668e-01; -3.559750866291741e-01   +6.448789052770787e-01   -5.881363829188122e-01   -7.346886704142127e-01   -2.096079786558150e-01   +1.498905850239527e-01   -2.661421718207901e-01   -1.321794460063563e-01   -8.227342182714238e-01   +4.736304170366576e-01   -3.134991833770168e-01   -5.721397708963057e-01; -1.708926363779947e-01   +1.999701832847303e-02   -3.937132518227509e-01   +3.376202271676308e-01   -3.364399184463182e-01   +7.289828636021309e-01   +3.755791395397680e-01   -4.981872077720036e-01   -2.601518555771055e-01   +8.792353000737460e-02   +1.857365184906324e-01   +4.638575480685246e-01; +5.143568812580486e-01   +2.466870657186837e-01   -7.792167352405160e-01   +3.429279201818363e-01   +3.864161395093422e-01   +4.460629532419802e-01   -4.931927787849261e-02   +2.521566698615977e-01   -2.079975959245517e-01   -1.590239758698207e-01   +1.780561475735510e-01   +6.362228828238788e-02; +3.108775112341119e-01   +4.496627973401320e-01   +6.413598206269376e-01   +2.202414625975861e-02   -1.513871186483688e-01   -2.931221979302584e-01   +9.818625666343265e-01   -4.637914869198775e-01   -2.860413707872600e-03   +2.403068845571755e-01   -6.638876628092119e-02   -1.844522995472314e-01; -3.967925991704495e-01   -6.436438372909212e-02   +6.545557670803955e-02   +1.352556417373124e-01   -3.058111604593582e-02   +7.610686348181308e-01   +1.913058418339049e-01   -1.703324413002291e-01   +5.616960576138329e-01   -2.133169586557221e-01   -5.029333114167484e-01   +1.255772207633149e-01; -1.335342239101059e-02   -4.349741844570221e-01   -9.768746881159618e-02   +1.893441495206405e-01   -4.247545253846891e-01   +1.842711003739576e-01   +2.053488542165226e-01   +1.109059036096521e-01   -3.527636396763923e-01   +8.224032628604699e-02   +4.732670455353518e-01   +2.588353134256314e-01; -3.501084731650602e-01   -7.032498420453099e-01   +1.233430735857763e-01   -6.601322725111096e-01   +3.100269877678681e-01   +3.789481577463464e-01   +7.281190512024294e-03   +6.371199555294264e-01   +2.820920618026146e-01   +5.856024559017261e-01   -2.289761923749422e-01   +2.099972697736270e-01; -3.175739575299331e-01   +4.397060718507509e-01   +1.188132331566538e-01   -5.341586496181387e-01   -1.604321430604903e-01   +7.654452505503204e-01   -8.144040309280140e-02   +6.428852333700905e-01   -1.567501959587378e-02   -1.315692533978175e-01   -4.573658469921519e-01   +1.172097826760636e-01; -7.841265079263195e-01   +2.834392559178144e-01   +5.380447951841996e-02   +1.082206062288173e-01   +1.724374395096077e-01   +1.204349433073734e-01   -1.516529580278123e-01   -1.185084546459877e-01   +1.343005562857933e-01   -2.959950699151194e-01   -5.398988201839640e-01   -6.633590775566427e-01; -4.383587715587721e-02   -8.477880347431810e-02   +4.218954480086784e-01   +2.457925741734815e-02   -4.959451910869018e-01   +3.458210080539816e-01   +7.150771435099418e-01   -1.119729894770410e-01   +1.764371565818802e-01   +1.286424529877058e-01   -2.164368891496577e-01   -2.326639561963532e-01; -5.975823897724302e-01   -2.826936131608554e-01   +2.647860504965323e-02   -4.865450949733861e-01   -8.845632478006872e-02   +2.920304489374223e-01   +7.117295130882428e-01   -6.485012929778740e-01   +7.527113703907010e-01   -4.881993723785242e-01   +4.979127978178922e-01   +5.346124333217273e-01];
L2E_Input1_iAMPA_netcon = [-8.446116076883195e-02   -1.166903152812177e-01   -2.396972297318772e-01   -2.742499224552812e-01   -5.010917431057135e-01   +2.933698455819432e-01   +3.042465513616816e-01   +7.357178351328423e-01];
L2I_Input2_iAMPA_netcon = [+4.540189817532143e-01   +5.498796704631691e-01   +1.280819498543255e-01   +5.813860618087193e-01   -9.618511554371589e-01   +2.411597328209704e-01   +2.067627196978710e-01   +6.311010523227351e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
